function J_(c,f){for(var y=0;y<f.length;y++){const C=f[y];if(typeof C!="string"&&!Array.isArray(C)){for(const N in C)if(N!=="default"&&!(N in c)){const k=Object.getOwnPropertyDescriptor(C,N);k&&Object.defineProperty(c,N,k.get?k:{enumerable:!0,get:()=>C[N]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const N of document.querySelectorAll('link[rel="modulepreload"]'))C(N);new MutationObserver(N=>{for(const k of N)if(k.type==="childList")for(const R of k.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&C(R)}).observe(document,{childList:!0,subtree:!0});function y(N){const k={};return N.integrity&&(k.integrity=N.integrity),N.referrerPolicy&&(k.referrerPolicy=N.referrerPolicy),N.crossOrigin==="use-credentials"?k.credentials="include":N.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function C(N){if(N.ep)return;N.ep=!0;const k=y(N);fetch(N.href,k)}})();var kg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function f0(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var F1={exports:{}},bm={};var Rx;function G2(){if(Rx)return bm;Rx=1;var c=Symbol.for("react.transitional.element"),f=Symbol.for("react.fragment");function y(C,N,k){var R=null;if(k!==void 0&&(R=""+k),N.key!==void 0&&(R=""+N.key),"key"in N){k={};for(var h in N)h!=="key"&&(k[h]=N[h])}else k=N;return N=k.ref,{$$typeof:c,type:C,key:R,ref:N!==void 0?N:null,props:k}}return bm.Fragment=f,bm.jsx=y,bm.jsxs=y,bm}var Dx;function H2(){return Dx||(Dx=1,F1.exports=G2()),F1.exports}var O=H2(),j1={exports:{}},ki={};var Nx;function q2(){if(Nx)return ki;Nx=1;var c=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),R=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),H=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),be=Symbol.iterator;function Ce(Oe){return Oe===null||typeof Oe!="object"?null:(Oe=be&&Oe[be]||Oe["@@iterator"],typeof Oe=="function"?Oe:null)}var Ee={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ye=Object.assign,he={};function ke(Oe,Xe,It){this.props=Oe,this.context=Xe,this.refs=he,this.updater=It||Ee}ke.prototype.isReactComponent={},ke.prototype.setState=function(Oe,Xe){if(typeof Oe!="object"&&typeof Oe!="function"&&Oe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Oe,Xe,"setState")},ke.prototype.forceUpdate=function(Oe){this.updater.enqueueForceUpdate(this,Oe,"forceUpdate")};function nt(){}nt.prototype=ke.prototype;function Qe(Oe,Xe,It){this.props=Oe,this.context=Xe,this.refs=he,this.updater=It||Ee}var dt=Qe.prototype=new nt;dt.constructor=Qe,ye(dt,ke.prototype),dt.isPureReactComponent=!0;var Ut=Array.isArray;function wt(){}var tt={H:null,A:null,T:null,S:null},Je=Object.prototype.hasOwnProperty;function He(Oe,Xe,It){var Nt=It.ref;return{$$typeof:c,type:Oe,key:Xe,ref:Nt!==void 0?Nt:null,props:It}}function pt(Oe,Xe){return He(Oe.type,Xe,Oe.props)}function Pe(Oe){return typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===c}function ot(Oe){var Xe={"=":"=0",":":"=2"};return"$"+Oe.replace(/[=:]/g,function(It){return Xe[It]})}var gt=/\/+/g;function Rt(Oe,Xe){return typeof Oe=="object"&&Oe!==null&&Oe.key!=null?ot(""+Oe.key):Xe.toString(36)}function Ie(Oe){switch(Oe.status){case"fulfilled":return Oe.value;case"rejected":throw Oe.reason;default:switch(typeof Oe.status=="string"?Oe.then(wt,wt):(Oe.status="pending",Oe.then(function(Xe){Oe.status==="pending"&&(Oe.status="fulfilled",Oe.value=Xe)},function(Xe){Oe.status==="pending"&&(Oe.status="rejected",Oe.reason=Xe)})),Oe.status){case"fulfilled":return Oe.value;case"rejected":throw Oe.reason}}throw Oe}function Se(Oe,Xe,It,Nt,$t){var Bt=typeof Oe;(Bt==="undefined"||Bt==="boolean")&&(Oe=null);var Mn=!1;if(Oe===null)Mn=!0;else switch(Bt){case"bigint":case"string":case"number":Mn=!0;break;case"object":switch(Oe.$$typeof){case c:case f:Mn=!0;break;case $:return Mn=Oe._init,Se(Mn(Oe._payload),Xe,It,Nt,$t)}}if(Mn)return $t=$t(Oe),Mn=Nt===""?"."+Rt(Oe,0):Nt,Ut($t)?(It="",Mn!=null&&(It=Mn.replace(gt,"$&/")+"/"),Se($t,Xe,It,"",function(ri){return ri})):$t!=null&&(Pe($t)&&($t=pt($t,It+($t.key==null||Oe&&Oe.key===$t.key?"":(""+$t.key).replace(gt,"$&/")+"/")+Mn)),Xe.push($t)),1;Mn=0;var Tn=Nt===""?".":Nt+":";if(Ut(Oe))for(var Rn=0;Rn<Oe.length;Rn++)Nt=Oe[Rn],Bt=Tn+Rt(Nt,Rn),Mn+=Se(Nt,Xe,It,Bt,$t);else if(Rn=Ce(Oe),typeof Rn=="function")for(Oe=Rn.call(Oe),Rn=0;!(Nt=Oe.next()).done;)Nt=Nt.value,Bt=Tn+Rt(Nt,Rn++),Mn+=Se(Nt,Xe,It,Bt,$t);else if(Bt==="object"){if(typeof Oe.then=="function")return Se(Ie(Oe),Xe,It,Nt,$t);throw Xe=String(Oe),Error("Objects are not valid as a React child (found: "+(Xe==="[object Object]"?"object with keys {"+Object.keys(Oe).join(", ")+"}":Xe)+"). If you meant to render a collection of children, use an array instead.")}return Mn}function je(Oe,Xe,It){if(Oe==null)return Oe;var Nt=[],$t=0;return Se(Oe,Nt,"","",function(Bt){return Xe.call(It,Bt,$t++)}),Nt}function st(Oe){if(Oe._status===-1){var Xe=Oe._result;Xe=Xe(),Xe.then(function(It){(Oe._status===0||Oe._status===-1)&&(Oe._status=1,Oe._result=It)},function(It){(Oe._status===0||Oe._status===-1)&&(Oe._status=2,Oe._result=It)}),Oe._status===-1&&(Oe._status=0,Oe._result=Xe)}if(Oe._status===1)return Oe._result.default;throw Oe._result}var mt=typeof reportError=="function"?reportError:function(Oe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Xe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Oe=="object"&&Oe!==null&&typeof Oe.message=="string"?String(Oe.message):String(Oe),error:Oe});if(!window.dispatchEvent(Xe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Oe);return}console.error(Oe)},Xt={map:je,forEach:function(Oe,Xe,It){je(Oe,function(){Xe.apply(this,arguments)},It)},count:function(Oe){var Xe=0;return je(Oe,function(){Xe++}),Xe},toArray:function(Oe){return je(Oe,function(Xe){return Xe})||[]},only:function(Oe){if(!Pe(Oe))throw Error("React.Children.only expected to receive a single React element child.");return Oe}};return ki.Activity=K,ki.Children=Xt,ki.Component=ke,ki.Fragment=y,ki.Profiler=N,ki.PureComponent=Qe,ki.StrictMode=C,ki.Suspense=V,ki.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=tt,ki.__COMPILER_RUNTIME={__proto__:null,c:function(Oe){return tt.H.useMemoCache(Oe)}},ki.cache=function(Oe){return function(){return Oe.apply(null,arguments)}},ki.cacheSignal=function(){return null},ki.cloneElement=function(Oe,Xe,It){if(Oe==null)throw Error("The argument must be a React element, but you passed "+Oe+".");var Nt=ye({},Oe.props),$t=Oe.key;if(Xe!=null)for(Bt in Xe.key!==void 0&&($t=""+Xe.key),Xe)!Je.call(Xe,Bt)||Bt==="key"||Bt==="__self"||Bt==="__source"||Bt==="ref"&&Xe.ref===void 0||(Nt[Bt]=Xe[Bt]);var Bt=arguments.length-2;if(Bt===1)Nt.children=It;else if(1<Bt){for(var Mn=Array(Bt),Tn=0;Tn<Bt;Tn++)Mn[Tn]=arguments[Tn+2];Nt.children=Mn}return He(Oe.type,$t,Nt)},ki.createContext=function(Oe){return Oe={$$typeof:R,_currentValue:Oe,_currentValue2:Oe,_threadCount:0,Provider:null,Consumer:null},Oe.Provider=Oe,Oe.Consumer={$$typeof:k,_context:Oe},Oe},ki.createElement=function(Oe,Xe,It){var Nt,$t={},Bt=null;if(Xe!=null)for(Nt in Xe.key!==void 0&&(Bt=""+Xe.key),Xe)Je.call(Xe,Nt)&&Nt!=="key"&&Nt!=="__self"&&Nt!=="__source"&&($t[Nt]=Xe[Nt]);var Mn=arguments.length-2;if(Mn===1)$t.children=It;else if(1<Mn){for(var Tn=Array(Mn),Rn=0;Rn<Mn;Rn++)Tn[Rn]=arguments[Rn+2];$t.children=Tn}if(Oe&&Oe.defaultProps)for(Nt in Mn=Oe.defaultProps,Mn)$t[Nt]===void 0&&($t[Nt]=Mn[Nt]);return He(Oe,Bt,$t)},ki.createRef=function(){return{current:null}},ki.forwardRef=function(Oe){return{$$typeof:h,render:Oe}},ki.isValidElement=Pe,ki.lazy=function(Oe){return{$$typeof:$,_payload:{_status:-1,_result:Oe},_init:st}},ki.memo=function(Oe,Xe){return{$$typeof:H,type:Oe,compare:Xe===void 0?null:Xe}},ki.startTransition=function(Oe){var Xe=tt.T,It={};tt.T=It;try{var Nt=Oe(),$t=tt.S;$t!==null&&$t(It,Nt),typeof Nt=="object"&&Nt!==null&&typeof Nt.then=="function"&&Nt.then(wt,mt)}catch(Bt){mt(Bt)}finally{Xe!==null&&It.types!==null&&(Xe.types=It.types),tt.T=Xe}},ki.unstable_useCacheRefresh=function(){return tt.H.useCacheRefresh()},ki.use=function(Oe){return tt.H.use(Oe)},ki.useActionState=function(Oe,Xe,It){return tt.H.useActionState(Oe,Xe,It)},ki.useCallback=function(Oe,Xe){return tt.H.useCallback(Oe,Xe)},ki.useContext=function(Oe){return tt.H.useContext(Oe)},ki.useDebugValue=function(){},ki.useDeferredValue=function(Oe,Xe){return tt.H.useDeferredValue(Oe,Xe)},ki.useEffect=function(Oe,Xe){return tt.H.useEffect(Oe,Xe)},ki.useEffectEvent=function(Oe){return tt.H.useEffectEvent(Oe)},ki.useId=function(){return tt.H.useId()},ki.useImperativeHandle=function(Oe,Xe,It){return tt.H.useImperativeHandle(Oe,Xe,It)},ki.useInsertionEffect=function(Oe,Xe){return tt.H.useInsertionEffect(Oe,Xe)},ki.useLayoutEffect=function(Oe,Xe){return tt.H.useLayoutEffect(Oe,Xe)},ki.useMemo=function(Oe,Xe){return tt.H.useMemo(Oe,Xe)},ki.useOptimistic=function(Oe,Xe){return tt.H.useOptimistic(Oe,Xe)},ki.useReducer=function(Oe,Xe,It){return tt.H.useReducer(Oe,Xe,It)},ki.useRef=function(Oe){return tt.H.useRef(Oe)},ki.useState=function(Oe){return tt.H.useState(Oe)},ki.useSyncExternalStore=function(Oe,Xe,It){return tt.H.useSyncExternalStore(Oe,Xe,It)},ki.useTransition=function(){return tt.H.useTransition()},ki.version="19.2.3",ki}var kx;function Ny(){return kx||(kx=1,j1.exports=q2()),j1.exports}var De=Ny();const na=f0(De);var U1={exports:{}},vm={},V1={exports:{}},G1={};var Px;function Z2(){return Px||(Px=1,(function(c){function f(Se,je){var st=Se.length;Se.push(je);e:for(;0<st;){var mt=st-1>>>1,Xt=Se[mt];if(0<N(Xt,je))Se[mt]=je,Se[st]=Xt,st=mt;else break e}}function y(Se){return Se.length===0?null:Se[0]}function C(Se){if(Se.length===0)return null;var je=Se[0],st=Se.pop();if(st!==je){Se[0]=st;e:for(var mt=0,Xt=Se.length,Oe=Xt>>>1;mt<Oe;){var Xe=2*(mt+1)-1,It=Se[Xe],Nt=Xe+1,$t=Se[Nt];if(0>N(It,st))Nt<Xt&&0>N($t,It)?(Se[mt]=$t,Se[Nt]=st,mt=Nt):(Se[mt]=It,Se[Xe]=st,mt=Xe);else if(Nt<Xt&&0>N($t,st))Se[mt]=$t,Se[Nt]=st,mt=Nt;else break e}}return je}function N(Se,je){var st=Se.sortIndex-je.sortIndex;return st!==0?st:Se.id-je.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var k=performance;c.unstable_now=function(){return k.now()}}else{var R=Date,h=R.now();c.unstable_now=function(){return R.now()-h}}var V=[],H=[],$=1,K=null,be=3,Ce=!1,Ee=!1,ye=!1,he=!1,ke=typeof setTimeout=="function"?setTimeout:null,nt=typeof clearTimeout=="function"?clearTimeout:null,Qe=typeof setImmediate<"u"?setImmediate:null;function dt(Se){for(var je=y(H);je!==null;){if(je.callback===null)C(H);else if(je.startTime<=Se)C(H),je.sortIndex=je.expirationTime,f(V,je);else break;je=y(H)}}function Ut(Se){if(ye=!1,dt(Se),!Ee)if(y(V)!==null)Ee=!0,wt||(wt=!0,ot());else{var je=y(H);je!==null&&Ie(Ut,je.startTime-Se)}}var wt=!1,tt=-1,Je=5,He=-1;function pt(){return he?!0:!(c.unstable_now()-He<Je)}function Pe(){if(he=!1,wt){var Se=c.unstable_now();He=Se;var je=!0;try{e:{Ee=!1,ye&&(ye=!1,nt(tt),tt=-1),Ce=!0;var st=be;try{t:{for(dt(Se),K=y(V);K!==null&&!(K.expirationTime>Se&&pt());){var mt=K.callback;if(typeof mt=="function"){K.callback=null,be=K.priorityLevel;var Xt=mt(K.expirationTime<=Se);if(Se=c.unstable_now(),typeof Xt=="function"){K.callback=Xt,dt(Se),je=!0;break t}K===y(V)&&C(V),dt(Se)}else C(V);K=y(V)}if(K!==null)je=!0;else{var Oe=y(H);Oe!==null&&Ie(Ut,Oe.startTime-Se),je=!1}}break e}finally{K=null,be=st,Ce=!1}je=void 0}}finally{je?ot():wt=!1}}}var ot;if(typeof Qe=="function")ot=function(){Qe(Pe)};else if(typeof MessageChannel<"u"){var gt=new MessageChannel,Rt=gt.port2;gt.port1.onmessage=Pe,ot=function(){Rt.postMessage(null)}}else ot=function(){ke(Pe,0)};function Ie(Se,je){tt=ke(function(){Se(c.unstable_now())},je)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(Se){Se.callback=null},c.unstable_forceFrameRate=function(Se){0>Se||125<Se?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Je=0<Se?Math.floor(1e3/Se):5},c.unstable_getCurrentPriorityLevel=function(){return be},c.unstable_next=function(Se){switch(be){case 1:case 2:case 3:var je=3;break;default:je=be}var st=be;be=je;try{return Se()}finally{be=st}},c.unstable_requestPaint=function(){he=!0},c.unstable_runWithPriority=function(Se,je){switch(Se){case 1:case 2:case 3:case 4:case 5:break;default:Se=3}var st=be;be=Se;try{return je()}finally{be=st}},c.unstable_scheduleCallback=function(Se,je,st){var mt=c.unstable_now();switch(typeof st=="object"&&st!==null?(st=st.delay,st=typeof st=="number"&&0<st?mt+st:mt):st=mt,Se){case 1:var Xt=-1;break;case 2:Xt=250;break;case 5:Xt=1073741823;break;case 4:Xt=1e4;break;default:Xt=5e3}return Xt=st+Xt,Se={id:$++,callback:je,priorityLevel:Se,startTime:st,expirationTime:Xt,sortIndex:-1},st>mt?(Se.sortIndex=st,f(H,Se),y(V)===null&&Se===y(H)&&(ye?(nt(tt),tt=-1):ye=!0,Ie(Ut,st-mt))):(Se.sortIndex=Xt,f(V,Se),Ee||Ce||(Ee=!0,wt||(wt=!0,ot()))),Se},c.unstable_shouldYield=pt,c.unstable_wrapCallback=function(Se){var je=be;return function(){var st=be;be=je;try{return Se.apply(this,arguments)}finally{be=st}}}})(G1)),G1}var Ox;function X2(){return Ox||(Ox=1,V1.exports=Z2()),V1.exports}var H1={exports:{}},Ro={};var zx;function W2(){if(zx)return Ro;zx=1;var c=Ny();function f(V){var H="https://react.dev/errors/"+V;if(1<arguments.length){H+="?args[]="+encodeURIComponent(arguments[1]);for(var $=2;$<arguments.length;$++)H+="&args[]="+encodeURIComponent(arguments[$])}return"Minified React error #"+V+"; visit "+H+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function y(){}var C={d:{f:y,r:function(){throw Error(f(522))},D:y,C:y,L:y,m:y,X:y,S:y,M:y},p:0,findDOMNode:null},N=Symbol.for("react.portal");function k(V,H,$){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:N,key:K==null?null:""+K,children:V,containerInfo:H,implementation:$}}var R=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(V,H){if(V==="font")return"";if(typeof H=="string")return H==="use-credentials"?H:""}return Ro.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Ro.createPortal=function(V,H){var $=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!H||H.nodeType!==1&&H.nodeType!==9&&H.nodeType!==11)throw Error(f(299));return k(V,H,null,$)},Ro.flushSync=function(V){var H=R.T,$=C.p;try{if(R.T=null,C.p=2,V)return V()}finally{R.T=H,C.p=$,C.d.f()}},Ro.preconnect=function(V,H){typeof V=="string"&&(H?(H=H.crossOrigin,H=typeof H=="string"?H==="use-credentials"?H:"":void 0):H=null,C.d.C(V,H))},Ro.prefetchDNS=function(V){typeof V=="string"&&C.d.D(V)},Ro.preinit=function(V,H){if(typeof V=="string"&&H&&typeof H.as=="string"){var $=H.as,K=h($,H.crossOrigin),be=typeof H.integrity=="string"?H.integrity:void 0,Ce=typeof H.fetchPriority=="string"?H.fetchPriority:void 0;$==="style"?C.d.S(V,typeof H.precedence=="string"?H.precedence:void 0,{crossOrigin:K,integrity:be,fetchPriority:Ce}):$==="script"&&C.d.X(V,{crossOrigin:K,integrity:be,fetchPriority:Ce,nonce:typeof H.nonce=="string"?H.nonce:void 0})}},Ro.preinitModule=function(V,H){if(typeof V=="string")if(typeof H=="object"&&H!==null){if(H.as==null||H.as==="script"){var $=h(H.as,H.crossOrigin);C.d.M(V,{crossOrigin:$,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0})}}else H==null&&C.d.M(V)},Ro.preload=function(V,H){if(typeof V=="string"&&typeof H=="object"&&H!==null&&typeof H.as=="string"){var $=H.as,K=h($,H.crossOrigin);C.d.L(V,$,{crossOrigin:K,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0,type:typeof H.type=="string"?H.type:void 0,fetchPriority:typeof H.fetchPriority=="string"?H.fetchPriority:void 0,referrerPolicy:typeof H.referrerPolicy=="string"?H.referrerPolicy:void 0,imageSrcSet:typeof H.imageSrcSet=="string"?H.imageSrcSet:void 0,imageSizes:typeof H.imageSizes=="string"?H.imageSizes:void 0,media:typeof H.media=="string"?H.media:void 0})}},Ro.preloadModule=function(V,H){if(typeof V=="string")if(H){var $=h(H.as,H.crossOrigin);C.d.m(V,{as:typeof H.as=="string"&&H.as!=="script"?H.as:void 0,crossOrigin:$,integrity:typeof H.integrity=="string"?H.integrity:void 0})}else C.d.m(V)},Ro.requestFormReset=function(V){C.d.r(V)},Ro.unstable_batchedUpdates=function(V,H){return V(H)},Ro.useFormState=function(V,H,$){return R.H.useFormState(V,H,$)},Ro.useFormStatus=function(){return R.H.useHostTransitionStatus()},Ro.version="19.2.3",Ro}var Lx;function eb(){if(Lx)return H1.exports;Lx=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(f){console.error(f)}}return c(),H1.exports=W2(),H1.exports}var Bx;function Y2(){if(Bx)return vm;Bx=1;var c=X2(),f=Ny(),y=eb();function C(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)o+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function N(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function k(r){var o=r,g=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(g=o.return),r=o.return;while(r)}return o.tag===3?g:null}function R(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function h(r){if(r.tag===31){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function V(r){if(k(r)!==r)throw Error(C(188))}function H(r){var o=r.alternate;if(!o){if(o=k(r),o===null)throw Error(C(188));return o!==r?null:r}for(var g=r,S=o;;){var L=g.return;if(L===null)break;var U=L.alternate;if(U===null){if(S=L.return,S!==null){g=S;continue}break}if(L.child===U.child){for(U=L.child;U;){if(U===g)return V(L),r;if(U===S)return V(L),o;U=U.sibling}throw Error(C(188))}if(g.return!==S.return)g=L,S=U;else{for(var ne=!1,ve=L.child;ve;){if(ve===g){ne=!0,g=L,S=U;break}if(ve===S){ne=!0,S=L,g=U;break}ve=ve.sibling}if(!ne){for(ve=U.child;ve;){if(ve===g){ne=!0,g=U,S=L;break}if(ve===S){ne=!0,S=U,g=L;break}ve=ve.sibling}if(!ne)throw Error(C(189))}}if(g.alternate!==S)throw Error(C(190))}if(g.tag!==3)throw Error(C(188));return g.stateNode.current===g?r:o}function $(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=$(r),o!==null)return o;r=r.sibling}return null}var K=Object.assign,be=Symbol.for("react.element"),Ce=Symbol.for("react.transitional.element"),Ee=Symbol.for("react.portal"),ye=Symbol.for("react.fragment"),he=Symbol.for("react.strict_mode"),ke=Symbol.for("react.profiler"),nt=Symbol.for("react.consumer"),Qe=Symbol.for("react.context"),dt=Symbol.for("react.forward_ref"),Ut=Symbol.for("react.suspense"),wt=Symbol.for("react.suspense_list"),tt=Symbol.for("react.memo"),Je=Symbol.for("react.lazy"),He=Symbol.for("react.activity"),pt=Symbol.for("react.memo_cache_sentinel"),Pe=Symbol.iterator;function ot(r){return r===null||typeof r!="object"?null:(r=Pe&&r[Pe]||r["@@iterator"],typeof r=="function"?r:null)}var gt=Symbol.for("react.client.reference");function Rt(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===gt?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case ye:return"Fragment";case ke:return"Profiler";case he:return"StrictMode";case Ut:return"Suspense";case wt:return"SuspenseList";case He:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Ee:return"Portal";case Qe:return r.displayName||"Context";case nt:return(r._context.displayName||"Context")+".Consumer";case dt:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case tt:return o=r.displayName||null,o!==null?o:Rt(r.type)||"Memo";case Je:o=r._payload,r=r._init;try{return Rt(r(o))}catch{}}return null}var Ie=Array.isArray,Se=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,je=y.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,st={pending:!1,data:null,method:null,action:null},mt=[],Xt=-1;function Oe(r){return{current:r}}function Xe(r){0>Xt||(r.current=mt[Xt],mt[Xt]=null,Xt--)}function It(r,o){Xt++,mt[Xt]=r.current,r.current=o}var Nt=Oe(null),$t=Oe(null),Bt=Oe(null),Mn=Oe(null);function Tn(r,o){switch(It(Bt,o),It($t,r),It(Nt,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?Du(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=Du(o),r=$0(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Xe(Nt),It(Nt,r)}function Rn(){Xe(Nt),Xe($t),Xe(Bt)}function ri(r){r.memoizedState!==null&&It(Mn,r);var o=Nt.current,g=$0(o,r.type);o!==g&&(It($t,r),It(Nt,g))}function _i(r){$t.current===r&&(Xe(Nt),Xe($t)),Mn.current===r&&(Xe(Mn),Ed._currentValue=st)}var $n,Kn;function Qn(r){if($n===void 0)try{throw Error()}catch(g){var o=g.stack.trim().match(/\n( *(at )?)/);$n=o&&o[1]||"",Kn=-1<g.stack.indexOf(`
    at`)?" (<anonymous>)":-1<g.stack.indexOf("@")?"@unknown:0:0":""}return`
`+$n+r+Kn}var ti=!1;function Bi(r,o){if(!r||ti)return"";ti=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(o){var ln=function(){throw Error()};if(Object.defineProperty(ln.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ln,[])}catch(Gt){var Lt=Gt}Reflect.construct(r,[],ln)}else{try{ln.call()}catch(Gt){Lt=Gt}r.call(ln.prototype)}}else{try{throw Error()}catch(Gt){Lt=Gt}(ln=r())&&typeof ln.catch=="function"&&ln.catch(function(){})}}catch(Gt){if(Gt&&Lt&&typeof Gt.stack=="string")return[Gt.stack,Lt.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var L=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");L&&L.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=S.DetermineComponentFrameRoot(),ne=U[0],ve=U[1];if(ne&&ve){var rt=ne.split(`
`),Pt=ve.split(`
`);for(L=S=0;S<rt.length&&!rt[S].includes("DetermineComponentFrameRoot");)S++;for(;L<Pt.length&&!Pt[L].includes("DetermineComponentFrameRoot");)L++;if(S===rt.length||L===Pt.length)for(S=rt.length-1,L=Pt.length-1;1<=S&&0<=L&&rt[S]!==Pt[L];)L--;for(;1<=S&&0<=L;S--,L--)if(rt[S]!==Pt[L]){if(S!==1||L!==1)do if(S--,L--,0>L||rt[S]!==Pt[L]){var Kt=`
`+rt[S].replace(" at new "," at ");return r.displayName&&Kt.includes("<anonymous>")&&(Kt=Kt.replace("<anonymous>",r.displayName)),Kt}while(1<=S&&0<=L);break}}}finally{ti=!1,Error.prepareStackTrace=g}return(g=r?r.displayName||r.name:"")?Qn(g):""}function si(r,o){switch(r.tag){case 26:case 27:case 5:return Qn(r.type);case 16:return Qn("Lazy");case 13:return r.child!==o&&o!==null?Qn("Suspense Fallback"):Qn("Suspense");case 19:return Qn("SuspenseList");case 0:case 15:return Bi(r.type,!1);case 11:return Bi(r.type.render,!1);case 1:return Bi(r.type,!0);case 31:return Qn("Activity");default:return""}}function Yt(r){try{var o="",g=null;do o+=si(r,g),g=r,r=r.return;while(r);return o}catch(S){return`
Error generating stack: `+S.message+`
`+S.stack}}var fn=Object.prototype.hasOwnProperty,di=c.unstable_scheduleCallback,gn=c.unstable_cancelCallback,Zn=c.unstable_shouldYield,Yi=c.unstable_requestPaint,fi=c.unstable_now,ci=c.unstable_getCurrentPriorityLevel,ct=c.unstable_ImmediatePriority,oe=c.unstable_UserBlockingPriority,ue=c.unstable_NormalPriority,ge=c.unstable_LowPriority,qe=c.unstable_IdlePriority,$e=c.log,bt=c.unstable_setDisableYieldValue,at=null,fe=null;function de(r){if(typeof $e=="function"&&bt(r),fe&&typeof fe.setStrictMode=="function")try{fe.setStrictMode(at,r)}catch{}}var Me=Math.clz32?Math.clz32:yt,Ue=Math.log,xt=Math.LN2;function yt(r){return r>>>=0,r===0?32:31-(Ue(r)/xt|0)|0}var qt=256,Ot=262144,cn=4194304;function Ke(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function kn(r,o,g){var S=r.pendingLanes;if(S===0)return 0;var L=0,U=r.suspendedLanes,ne=r.pingedLanes;r=r.warmLanes;var ve=S&134217727;return ve!==0?(S=ve&~U,S!==0?L=Ke(S):(ne&=ve,ne!==0?L=Ke(ne):g||(g=ve&~r,g!==0&&(L=Ke(g))))):(ve=S&~U,ve!==0?L=Ke(ve):ne!==0?L=Ke(ne):g||(g=S&~r,g!==0&&(L=Ke(g)))),L===0?0:o!==0&&o!==L&&(o&U)===0&&(U=L&-L,g=o&-o,U>=g||U===32&&(g&4194048)!==0)?o:L}function Fn(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function wn(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _n(){var r=cn;return cn<<=1,(cn&62914560)===0&&(cn=4194304),r}function gi(r){for(var o=[],g=0;31>g;g++)o.push(r);return o}function Yn(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function nn(r,o,g,S,L,U){var ne=r.pendingLanes;r.pendingLanes=g,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=g,r.entangledLanes&=g,r.errorRecoveryDisabledLanes&=g,r.shellSuspendCounter=0;var ve=r.entanglements,rt=r.expirationTimes,Pt=r.hiddenUpdates;for(g=ne&~g;0<g;){var Kt=31-Me(g),ln=1<<Kt;ve[Kt]=0,rt[Kt]=-1;var Lt=Pt[Kt];if(Lt!==null)for(Pt[Kt]=null,Kt=0;Kt<Lt.length;Kt++){var Gt=Lt[Kt];Gt!==null&&(Gt.lane&=-536870913)}g&=~ln}S!==0&&Jt(r,S,0),U!==0&&L===0&&r.tag!==0&&(r.suspendedLanes|=U&~(ne&~o))}function Jt(r,o,g){r.pendingLanes|=o,r.suspendedLanes&=~o;var S=31-Me(o);r.entangledLanes|=o,r.entanglements[S]=r.entanglements[S]|1073741824|g&261930}function Bn(r,o){var g=r.entangledLanes|=o;for(r=r.entanglements;g;){var S=31-Me(g),L=1<<S;L&o|r[S]&o&&(r[S]|=o),g&=~L}}function Di(r,o){var g=o&-o;return g=(g&42)!==0?1:Fi(g),(g&(r.suspendedLanes|o))!==0?0:g}function Fi(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Zt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function xi(){var r=je.p;return r!==0?r:(r=window.event,r===void 0?32:Th(r.type))}function bn(r,o){var g=je.p;try{return je.p=r,o()}finally{je.p=g}}var Rr=Math.random().toString(36).slice(2),vi="__reactFiber$"+Rr,jt="__reactProps$"+Rr,Gn="__reactContainer$"+Rr,ni="__reactEvents$"+Rr,vs="__reactListeners$"+Rr,ws="__reactHandles$"+Rr,ia="__reactResources$"+Rr,ai="__reactMarker$"+Rr;function Rs(r){delete r[vi],delete r[jt],delete r[ni],delete r[vs],delete r[ws]}function Sr(r){var o=r[vi];if(o)return o;for(var g=r.parentNode;g;){if(o=g[Gn]||g[vi]){if(g=o.alternate,o.child!==null||g!==null&&g.child!==null)for(r=vf(r);r!==null;){if(g=r[vi])return g;r=vf(r)}return o}r=g,g=r.parentNode}return null}function ji(r){if(r=r[vi]||r[Gn]){var o=r.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return r}return null}function da(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(C(33))}function us(r){var o=r[ia];return o||(o=r[ia]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function dr(r){r[ai]=!0}var an=new Set,Es={};function Hn(r,o){hs(r,o),hs(r+"Capture",o)}function hs(r,o){for(Es[r]=o,r=0;r<o.length;r++)an.add(o[r])}var Yo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pi={},Ai={};function yi(r){return fn.call(Ai,r)?!0:fn.call(Pi,r)?!1:Yo.test(r)?Ai[r]=!0:(Pi[r]=!0,!1)}function fo(r,o,g){if(yi(o))if(g===null)r.removeAttribute(o);else{switch(typeof g){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var S=o.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+g)}}function fa(r,o,g){if(g===null)r.removeAttribute(o);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+g)}}function Ds(r,o,g,S){if(S===null)r.removeAttribute(g);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(g);return}r.setAttributeNS(o,g,""+S)}}function Jn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Ra(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function uu(r,o,g){var S=Object.getOwnPropertyDescriptor(r.constructor.prototype,o);if(!r.hasOwnProperty(o)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var L=S.get,U=S.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return L.call(this)},set:function(ne){g=""+ne,U.call(this,ne)}}),Object.defineProperty(r,o,{enumerable:S.enumerable}),{getValue:function(){return g},setValue:function(ne){g=""+ne},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function or(r){if(!r._valueTracker){var o=Ra(r)?"checked":"value";r._valueTracker=uu(r,o,""+r[o])}}function vt(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var g=o.getValue(),S="";return r&&(S=Ra(r)?r.checked?"true":"false":r.value),r=S,r!==g?(o.setValue(r),!0):!1}function tn(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var xn=/[\n"\\]/g;function on(r){return r.replace(xn,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function pn(r,o,g,S,L,U,ne,ve){r.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?r.type=ne:r.removeAttribute("type"),o!=null?ne==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+Jn(o)):r.value!==""+Jn(o)&&(r.value=""+Jn(o)):ne!=="submit"&&ne!=="reset"||r.removeAttribute("value"),o!=null?Te(r,ne,Jn(o)):g!=null?Te(r,ne,Jn(g)):S!=null&&r.removeAttribute("value"),L==null&&U!=null&&(r.defaultChecked=!!U),L!=null&&(r.checked=L&&typeof L!="function"&&typeof L!="symbol"),ve!=null&&typeof ve!="function"&&typeof ve!="symbol"&&typeof ve!="boolean"?r.name=""+Jn(ve):r.removeAttribute("name")}function ft(r,o,g,S,L,U,ne,ve){if(U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(r.type=U),o!=null||g!=null){if(!(U!=="submit"&&U!=="reset"||o!=null)){or(r);return}g=g!=null?""+Jn(g):"",o=o!=null?""+Jn(o):g,ve||o===r.value||(r.value=o),r.defaultValue=o}S=S??L,S=typeof S!="function"&&typeof S!="symbol"&&!!S,r.checked=ve?r.checked:!!S,r.defaultChecked=!!S,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(r.name=ne),or(r)}function Te(r,o,g){o==="number"&&tn(r.ownerDocument)===r||r.defaultValue===""+g||(r.defaultValue=""+g)}function zn(r,o,g,S){if(r=r.options,o){o={};for(var L=0;L<g.length;L++)o["$"+g[L]]=!0;for(g=0;g<r.length;g++)L=o.hasOwnProperty("$"+r[g].value),r[g].selected!==L&&(r[g].selected=L),L&&S&&(r[g].defaultSelected=!0)}else{for(g=""+Jn(g),o=null,L=0;L<r.length;L++){if(r[L].value===g){r[L].selected=!0,S&&(r[L].defaultSelected=!0);return}o!==null||r[L].disabled||(o=r[L])}o!==null&&(o.selected=!0)}}function $i(r,o,g){if(o!=null&&(o=""+Jn(o),o!==r.value&&(r.value=o),g==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=g!=null?""+Jn(g):""}function Dr(r,o,g,S){if(o==null){if(S!=null){if(g!=null)throw Error(C(92));if(Ie(S)){if(1<S.length)throw Error(C(93));S=S[0]}g=S}g==null&&(g=""),o=g}g=Jn(o),r.defaultValue=g,S=r.textContent,S===g&&S!==""&&S!==null&&(r.value=S),or(r)}function Da(r,o){if(o){var g=r.firstChild;if(g&&g===r.lastChild&&g.nodeType===3){g.nodeValue=o;return}}r.textContent=o}var pa=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tr(r,o,g){var S=o.indexOf("--")===0;g==null||typeof g=="boolean"||g===""?S?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":S?r.setProperty(o,g):typeof g!="number"||g===0||pa.has(o)?o==="float"?r.cssFloat=g:r[o]=(""+g).trim():r[o]=g+"px"}function Xn(r,o,g){if(o!=null&&typeof o!="object")throw Error(C(62));if(r=r.style,g!=null){for(var S in g)!g.hasOwnProperty(S)||o!=null&&o.hasOwnProperty(S)||(S.indexOf("--")===0?r.setProperty(S,""):S==="float"?r.cssFloat="":r[S]="");for(var L in o)S=o[L],o.hasOwnProperty(L)&&g[L]!==S&&Tr(r,L,S)}else for(var U in o)o.hasOwnProperty(U)&&Tr(r,U,o[U])}function Ui(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ko=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ui(r){return ko.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Fs(){}var $o=null;function Ko(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var wi=null,yr=null;function Gi(r){var o=ji(r);if(o&&(r=o.stateNode)){var g=r[jt]||null;e:switch(r=o.stateNode,o.type){case"input":if(pn(r,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name),o=g.name,g.type==="radio"&&o!=null){for(g=r;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll('input[name="'+on(""+o)+'"][type="radio"]'),o=0;o<g.length;o++){var S=g[o];if(S!==r&&S.form===r.form){var L=S[jt]||null;if(!L)throw Error(C(90));pn(S,L.value,L.defaultValue,L.defaultValue,L.checked,L.defaultChecked,L.type,L.name)}}for(o=0;o<g.length;o++)S=g[o],S.form===r.form&&vt(S)}break e;case"textarea":$i(r,g.value,g.defaultValue);break e;case"select":o=g.value,o!=null&&zn(r,!!g.multiple,o,!1)}}}var hn=!1;function lr(r,o,g){if(hn)return r(o,g);hn=!0;try{var S=r(o);return S}finally{if(hn=!1,(wi!==null||yr!==null)&&(ff(),wi&&(o=wi,r=yr,yr=wi=null,Gi(o),r)))for(o=0;o<r.length;o++)Gi(r[o])}}function oi(r,o){var g=r.stateNode;if(g===null)return null;var S=g[jt]||null;if(S===null)return null;g=S[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(r=r.type,S=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!S;break e;default:r=!1}if(r)return null;if(g&&typeof g!="function")throw Error(C(231,o,typeof g));return g}var Mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ra=!1;if(Mi)try{var Kr={};Object.defineProperty(Kr,"passive",{get:function(){ra=!0}}),window.addEventListener("test",Kr,Kr),window.removeEventListener("test",Kr,Kr)}catch{ra=!1}var ma=null,js=null,Nr=null;function Na(){if(Nr)return Nr;var r,o=js,g=o.length,S,L="value"in ma?ma.value:ma.textContent,U=L.length;for(r=0;r<g&&o[r]===L[r];r++);var ne=g-r;for(S=1;S<=ne&&o[g-S]===L[U-S];S++);return Nr=L.slice(r,1<S?1-S:void 0)}function Ns(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function Xa(){return!0}function Us(){return!1}function zr(r){function o(g,S,L,U,ne){this._reactName=g,this._targetInst=L,this.type=S,this.nativeEvent=U,this.target=ne,this.currentTarget=null;for(var ve in r)r.hasOwnProperty(ve)&&(g=r[ve],this[ve]=g?g(U):U[ve]);return this.isDefaultPrevented=(U.defaultPrevented!=null?U.defaultPrevented:U.returnValue===!1)?Xa:Us,this.isPropagationStopped=Us,this}return K(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=Xa)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=Xa)},persist:function(){},isPersistent:Xa}),o}var ds={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ss=zr(ds),Qo=K({},ds,{view:0,detail:0}),Jo=zr(Qo),er,el,Si,pi=K({},Qo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rl,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Si&&(Si&&r.type==="mousemove"?(er=r.screenX-Si.screenX,el=r.screenY-Si.screenY):el=er=0,Si=r),er)},movementY:function(r){return"movementY"in r?r.movementY:el}}),Hi=zr(pi),Oi=K({},pi,{dataTransfer:0}),tl=zr(Oi),fs=K({},Qo,{relatedTarget:0}),nl=zr(fs),zt=K({},ds,{animationName:0,elapsedTime:0,pseudoElement:0}),Ci=zr(zt),Qr=K({},ds,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),rc=zr(Qr),jh=K({},ds,{data:0}),Yu=zr(jh),sa={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},po={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kr(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=xr[r])?!!o[r]:!1}function Rl(){return kr}var Ar=K({},Qo,{key:function(r){if(r.key){var o=sa[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Ns(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?po[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rl,charCode:function(r){return r.type==="keypress"?Ns(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ns(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Cr=zr(Ar),il=K({},pi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nr=zr(il),ii=K({},Qo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rl}),Bd=zr(ii),ir=K({},ds,{propertyName:0,elapsedTime:0,pseudoElement:0}),mo=zr(ir),Wa=K({},pi,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),$u=zr(Wa),ga=K({},ds,{newState:0,oldState:0}),rl=zr(ga),Dl=[9,13,27,32],Lr=Mi&&"CompositionEvent"in window,Nl=null;Mi&&"documentMode"in document&&(Nl=document.documentMode);var kl=Mi&&"TextEvent"in window&&!Nl,sc=Mi&&(!Lr||Nl&&8<Nl&&11>=Nl),Ea=" ",hu=!1;function Mc(r,o){switch(r){case"keyup":return Dl.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ac(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ya=!1;function $a(r,o){switch(r){case"compositionend":return ac(o);case"keypress":return o.which!==32?null:(hu=!0,Ea);case"textInput":return r=o.data,r===Ea&&hu?null:r;default:return null}}function Rc(r,o){if(Ya)return r==="compositionend"||!Lr&&Mc(r,o)?(r=Na(),Nr=js=ma=null,Ya=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return sc&&o.locale!=="ko"?null:o.data;default:return null}}var Sa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dc(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!Sa[r.type]:o==="textarea"}function Ta(r,o,g,S){wi?yr?yr.push(S):yr=[S]:wi=S,o=yf(o,"onChange"),0<o.length&&(g=new Ss("onChange","change",null,g,S),r.push({event:g,listeners:o}))}var Pl=null,sl=null;function Uh(r){hg(r,0)}function oc(r){var o=da(r);if(vt(o))return r}function ks(r,o){if(r==="change")return o}var Ku=!1;if(Mi){var Ol;if(Mi){var ka="oninput"in document;if(!ka){var Vi=document.createElement("div");Vi.setAttribute("oninput","return;"),ka=typeof Vi.oninput=="function"}Ol=ka}else Ol=!1;Ku=Ol&&(!document.documentMode||9<document.documentMode)}function al(){Pl&&(Pl.detachEvent("onpropertychange",le),sl=Pl=null)}function le(r){if(r.propertyName==="value"&&oc(sl)){var o=[];Ta(o,sl,r,Ko(r)),lr(Uh,o)}}function a(r,o,g){r==="focusin"?(al(),Pl=o,sl=g,Pl.attachEvent("onpropertychange",le)):r==="focusout"&&al()}function u(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return oc(sl)}function m(r,o){if(r==="click")return oc(o)}function v(r,o){if(r==="input"||r==="change")return oc(o)}function w(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var I=typeof Object.is=="function"?Object.is:w;function P(r,o){if(I(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var g=Object.keys(r),S=Object.keys(o);if(g.length!==S.length)return!1;for(S=0;S<g.length;S++){var L=g[S];if(!fn.call(o,L)||!I(r[L],o[L]))return!1}return!0}function F(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function q(r,o){var g=F(r);r=0;for(var S;g;){if(g.nodeType===3){if(S=r+g.textContent.length,r<=o&&S>=o)return{node:g,offset:o-r};r=S}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=F(g)}}function te(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?te(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function ce(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=tn(r.document);o instanceof r.HTMLIFrameElement;){try{var g=typeof o.contentWindow.location.href=="string"}catch{g=!1}if(g)r=o.contentWindow;else break;o=tn(r.document)}return o}function xe(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var ze=Mi&&"documentMode"in document&&11>=document.documentMode,it=null,lt=null,Tt=null,Ft=!1;function vn(r,o,g){var S=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;Ft||it==null||it!==tn(S)||(S=it,"selectionStart"in S&&xe(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Tt&&P(Tt,S)||(Tt=S,S=yf(lt,"onSelect"),0<S.length&&(o=new Ss("onSelect","select",null,o,g),r.push({event:o,listeners:S}),o.target=it)))}function yn(r,o){var g={};return g[r.toLowerCase()]=o.toLowerCase(),g["Webkit"+r]="webkit"+o,g["Moz"+r]="moz"+o,g}var un={animationend:yn("Animation","AnimationEnd"),animationiteration:yn("Animation","AnimationIteration"),animationstart:yn("Animation","AnimationStart"),transitionrun:yn("Transition","TransitionRun"),transitionstart:yn("Transition","TransitionStart"),transitioncancel:yn("Transition","TransitionCancel"),transitionend:yn("Transition","TransitionEnd")},Ni={},Pn={};Mi&&(Pn=document.createElement("div").style,"AnimationEvent"in window||(delete un.animationend.animation,delete un.animationiteration.animation,delete un.animationstart.animation),"TransitionEvent"in window||delete un.transitionend.transition);function Ur(r){if(Ni[r])return Ni[r];if(!un[r])return r;var o=un[r],g;for(g in o)if(o.hasOwnProperty(g)&&g in Pn)return Ni[r]=o[g];return r}var aa=Ur("animationend"),Ts=Ur("animationiteration"),rr=Ur("animationstart"),Vr=Ur("transitionrun"),Ps=Ur("transitionstart"),Ka=Ur("transitioncancel"),As=Ur("transitionend"),Qu=new Map,du="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");du.push("scrollEnd");function Qa(r,o){Qu.set(r,o),Hn(o,[r])}var ol=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Aa=[],zl=0,Nc=0;function kc(){for(var r=zl,o=Nc=zl=0;o<r;){var g=Aa[o];Aa[o++]=null;var S=Aa[o];Aa[o++]=null;var L=Aa[o];Aa[o++]=null;var U=Aa[o];if(Aa[o++]=null,S!==null&&L!==null){var ne=S.pending;ne===null?L.next=L:(L.next=ne.next,ne.next=L),S.pending=L}U!==0&&Fd(g,L,U)}}function Ju(r,o,g,S){Aa[zl++]=r,Aa[zl++]=o,Aa[zl++]=g,Aa[zl++]=S,Nc|=S,r.lanes|=S,r=r.alternate,r!==null&&(r.lanes|=S)}function lc(r,o,g,S){return Ju(r,o,g,S),fu(r)}function go(r,o){return Ju(r,null,null,o),fu(r)}function Fd(r,o,g){r.lanes|=g;var S=r.alternate;S!==null&&(S.lanes|=g);for(var L=!1,U=r.return;U!==null;)U.childLanes|=g,S=U.alternate,S!==null&&(S.childLanes|=g),U.tag===22&&(r=U.stateNode,r===null||r._visibility&1||(L=!0)),r=U,U=U.return;return r.tag===3?(U=r.stateNode,L&&o!==null&&(L=31-Me(g),r=U.hiddenUpdates,S=r[L],S===null?r[L]=[o]:S.push(o),o.lane=g|536870912),U):null}function fu(r){if(50<df)throw df=0,P0=null,Error(C(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var bi={};function Vh(r,o,g,S){this.tag=r,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ja(r,o,g,S){return new Vh(r,o,g,S)}function Gh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function eo(r,o){var g=r.alternate;return g===null?(g=Ja(r.tag,o,r.key,r.mode),g.elementType=r.elementType,g.type=r.type,g.stateNode=r.stateNode,g.alternate=r,r.alternate=g):(g.pendingProps=o,g.type=r.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=r.flags&65011712,g.childLanes=r.childLanes,g.lanes=r.lanes,g.child=r.child,g.memoizedProps=r.memoizedProps,g.memoizedState=r.memoizedState,g.updateQueue=r.updateQueue,o=r.dependencies,g.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},g.sibling=r.sibling,g.index=r.index,g.ref=r.ref,g.refCleanup=r.refCleanup,g}function ep(r,o){r.flags&=65011714;var g=r.alternate;return g===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=g.childLanes,r.lanes=g.lanes,r.child=g.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=g.memoizedProps,r.memoizedState=g.memoizedState,r.updateQueue=g.updateQueue,r.type=g.type,o=g.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function Hh(r,o,g,S,L,U){var ne=0;if(S=r,typeof r=="function")Gh(r)&&(ne=1);else if(typeof r=="string")ne=Xp(r,g,Nt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case He:return r=Ja(31,g,o,L),r.elementType=He,r.lanes=U,r;case ye:return cc(g.children,L,U,o);case he:ne=8,L|=24;break;case ke:return r=Ja(12,g,o,L|2),r.elementType=ke,r.lanes=U,r;case Ut:return r=Ja(13,g,o,L),r.elementType=Ut,r.lanes=U,r;case wt:return r=Ja(19,g,o,L),r.elementType=wt,r.lanes=U,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Qe:ne=10;break e;case nt:ne=9;break e;case dt:ne=11;break e;case tt:ne=14;break e;case Je:ne=16,S=null;break e}ne=29,g=Error(C(130,r===null?"null":typeof r,"")),S=null}return o=Ja(ne,g,o,L),o.elementType=r,o.type=S,o.lanes=U,o}function cc(r,o,g,S){return r=Ja(7,r,S,o),r.lanes=g,r}function jd(r,o,g){return r=Ja(6,r,null,o),r.lanes=g,r}function qh(r){var o=Ja(18,null,null,0);return o.stateNode=r,o}function uc(r,o,g){return o=Ja(4,r.children!==null?r.children:[],r.key,o),o.lanes=g,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var pu=new WeakMap;function Ca(r,o){if(typeof r=="object"&&r!==null){var g=pu.get(r);return g!==void 0?g:(o={value:r,source:o,stack:Yt(o)},pu.set(r,o),o)}return{value:r,source:o,stack:Yt(o)}}var hc=[],dc=0,Pc=null,fc=0,Os=[],Vs=0,ll=null,cl=1,Pa="";function Ll(r,o){hc[dc++]=fc,hc[dc++]=Pc,Pc=r,fc=o}function Ud(r,o,g){Os[Vs++]=cl,Os[Vs++]=Pa,Os[Vs++]=ll,ll=r;var S=cl;r=Pa;var L=32-Me(S)-1;S&=~(1<<L),g+=1;var U=32-Me(o)+L;if(30<U){var ne=L-L%5;U=(S&(1<<ne)-1).toString(32),S>>=ne,L-=ne,cl=1<<32-Me(o)+L|g<<L|S,Pa=U+r}else cl=1<<U|g<<L|S,Pa=r}function Oc(r){r.return!==null&&(Ll(r,1),Ud(r,1,0))}function mu(r){for(;r===Pc;)Pc=hc[--dc],hc[dc]=null,fc=hc[--dc],hc[dc]=null;for(;r===ll;)ll=Os[--Vs],Os[Vs]=null,Pa=Os[--Vs],Os[Vs]=null,cl=Os[--Vs],Os[Vs]=null}function Vd(r,o){Os[Vs++]=cl,Os[Vs++]=Pa,Os[Vs++]=ll,cl=o.id,Pa=o.overflow,ll=r}var Gs=null,_r=null,Li=!1,Bl=null,to=!1,Xr=Error(C(519));function Oa(r){var o=Error(C(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fl(Ca(o,r)),Xr}function za(r){var o=r.stateNode,g=r.type,S=r.memoizedProps;switch(o[vi]=r,o[jt]=S,g){case"dialog":Wi("cancel",o),Wi("close",o);break;case"iframe":case"object":case"embed":Wi("load",o);break;case"video":case"audio":for(g=0;g<Ru.length;g++)Wi(Ru[g],o);break;case"source":Wi("error",o);break;case"img":case"image":case"link":Wi("error",o),Wi("load",o);break;case"details":Wi("toggle",o);break;case"input":Wi("invalid",o),ft(o,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0);break;case"select":Wi("invalid",o);break;case"textarea":Wi("invalid",o),Dr(o,S.value,S.defaultValue,S.children)}g=S.children,typeof g!="string"&&typeof g!="number"&&typeof g!="bigint"||o.textContent===""+g||S.suppressHydrationWarning===!0||W0(o.textContent,g)?(S.popover!=null&&(Wi("beforetoggle",o),Wi("toggle",o)),S.onScroll!=null&&Wi("scroll",o),S.onScrollEnd!=null&&Wi("scrollend",o),S.onClick!=null&&(o.onclick=Fs),o=!0):o=!1,o||Oa(r,!0)}function eh(r){for(Gs=r.return;Gs;)switch(Gs.tag){case 5:case 31:case 13:to=!1;return;case 27:case 3:to=!0;return;default:Gs=Gs.return}}function ul(r){if(r!==Gs)return!1;if(!Li)return eh(r),Li=!0,!1;var o=r.tag,g;if((g=o!==3&&o!==27)&&((g=o===5)&&(g=r.type,g=!(g!=="form"&&g!=="button")||jp(r.type,r.memoizedProps)),g=!g),g&&_r&&Oa(r),eh(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(317));_r=Ks(r)}else if(o===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(317));_r=Ks(r)}else o===27?(o=_r,ku(r.type)?(r=co,co=null,_r=r):_r=o):_r=Gs?qo(r.stateNode.nextSibling):null;return!0}function hl(){_r=Gs=null,Li=!1}function dl(){var r=Bl;return r!==null&&(Ao===null?Ao=r:Ao.push.apply(Ao,r),Bl=null),r}function Fl(r){Bl===null?Bl=[r]:Bl.push(r)}var jl=Oe(null),yo=null,fl=null;function Ul(r,o,g){It(jl,o._currentValue),o._currentValue=g}function pl(r){r._currentValue=jl.current,Xe(jl)}function Zh(r,o,g){for(;r!==null;){var S=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,S!==null&&(S.childLanes|=o)):S!==null&&(S.childLanes&o)!==o&&(S.childLanes|=o),r===g)break;r=r.return}}function Xh(r,o,g,S){var L=r.child;for(L!==null&&(L.return=r);L!==null;){var U=L.dependencies;if(U!==null){var ne=L.child;U=U.firstContext;e:for(;U!==null;){var ve=U;U=L;for(var rt=0;rt<o.length;rt++)if(ve.context===o[rt]){U.lanes|=g,ve=U.alternate,ve!==null&&(ve.lanes|=g),Zh(U.return,g,r),S||(ne=null);break e}U=ve.next}}else if(L.tag===18){if(ne=L.return,ne===null)throw Error(C(341));ne.lanes|=g,U=ne.alternate,U!==null&&(U.lanes|=g),Zh(ne,g,r),ne=null}else ne=L.child;if(ne!==null)ne.return=L;else for(ne=L;ne!==null;){if(ne===r){ne=null;break}if(L=ne.sibling,L!==null){L.return=ne.return,ne=L;break}ne=ne.return}L=ne}}function no(r,o,g,S){r=null;for(var L=o,U=!1;L!==null;){if(!U){if((L.flags&524288)!==0)U=!0;else if((L.flags&262144)!==0)break}if(L.tag===10){var ne=L.alternate;if(ne===null)throw Error(C(387));if(ne=ne.memoizedProps,ne!==null){var ve=L.type;I(L.pendingProps.value,ne.value)||(r!==null?r.push(ve):r=[ve])}}else if(L===Mn.current){if(ne=L.alternate,ne===null)throw Error(C(387));ne.memoizedState.memoizedState!==L.memoizedState.memoizedState&&(r!==null?r.push(Ed):r=[Ed])}L=L.return}r!==null&&Xh(o,r,g,S),o.flags|=262144}function gu(r){for(r=r.firstContext;r!==null;){if(!I(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Vl(r){yo=r,fl=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ps(r){return Wh(yo,r)}function th(r,o){return yo===null&&Vl(r),Wh(r,o)}function Wh(r,o){var g=o._currentValue;if(o={context:o,memoizedValue:g,next:null},fl===null){if(r===null)throw Error(C(308));fl=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else fl=fl.next=o;return g}var Gd=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(g,S){r.push(S)}};this.abort=function(){o.aborted=!0,r.forEach(function(g){return g()})}},tp=c.unstable_scheduleCallback,Hd=c.unstable_NormalPriority,as={$$typeof:Qe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ml(){return{controller:new Gd,data:new Map,refCount:0}}function yu(r){r.refCount--,r.refCount===0&&tp(Hd,function(){r.controller.abort()})}var ya=null,io=0,zc=0,xa=null;function y0(r,o){if(ya===null){var g=ya=[];io=0,zc=G0(),xa={status:"pending",value:void 0,then:function(S){g.push(S)}}}return io++,o.then(xu,xu),o}function xu(){if(--io===0&&ya!==null){xa!==null&&(xa.status="fulfilled");var r=ya;ya=null,zc=0,xa=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function nh(r,o){var g=[],S={status:"pending",value:null,reason:null,then:function(L){g.push(L)}};return r.then(function(){S.status="fulfilled",S.value=o;for(var L=0;L<g.length;L++)(0,g[L])(o)},function(L){for(S.status="rejected",S.reason=L,L=0;L<g.length;L++)(0,g[L])(void 0)}),S}var zs=Se.S;Se.S=function(r,o){Wm=fi(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&y0(r,o),zs!==null&&zs(r,o)};var Po=Oe(null);function Yh(){var r=Po.current;return r!==null?r:qr.pooledCache}function $h(r,o){o===null?It(Po,Po.current):It(Po,o.pool)}function np(){var r=Yh();return r===null?null:{parent:as._currentValue,pool:r}}var Oo=Error(C(460)),pc=Error(C(474)),La=Error(C(542)),Cn={then:function(){}};function ih(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Kh(r,o,g){switch(g=r[g],g===void 0?r.push(o):g!==o&&(o.then(Fs,Fs),o=g),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Qh(r),r;default:if(typeof o.status=="string")o.then(Fs,Fs);else{if(r=qr,r!==null&&100<r.shellSuspendCounter)throw Error(C(482));r=o,r.status="pending",r.then(function(S){if(o.status==="pending"){var L=o;L.status="fulfilled",L.value=S}},function(S){if(o.status==="pending"){var L=o;L.status="rejected",L.reason=S}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Qh(r),r}throw zo=o,Oo}}function xo(r){try{var o=r._init;return o(r._payload)}catch(g){throw g!==null&&typeof g=="object"&&typeof g.then=="function"?(zo=g,Oo):g}}var zo=null;function _u(){if(zo===null)throw Error(C(459));var r=zo;return zo=null,r}function Qh(r){if(r===Oo||r===La)throw Error(C(483))}var gl=null,Lc=0;function rh(r){var o=Lc;return Lc+=1,gl===null&&(gl=[]),Kh(gl,r,o)}function yl(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function Jh(r,o){throw o.$$typeof===be?Error(C(525)):(r=Object.prototype.toString.call(o),Error(C(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function sh(r){function o(_t,ht){if(r){var Dt=_t.deletions;Dt===null?(_t.deletions=[ht],_t.flags|=16):Dt.push(ht)}}function g(_t,ht){if(!r)return null;for(;ht!==null;)o(_t,ht),ht=ht.sibling;return null}function S(_t){for(var ht=new Map;_t!==null;)_t.key!==null?ht.set(_t.key,_t):ht.set(_t.index,_t),_t=_t.sibling;return ht}function L(_t,ht){return _t=eo(_t,ht),_t.index=0,_t.sibling=null,_t}function U(_t,ht,Dt){return _t.index=Dt,r?(Dt=_t.alternate,Dt!==null?(Dt=Dt.index,Dt<ht?(_t.flags|=67108866,ht):Dt):(_t.flags|=67108866,ht)):(_t.flags|=1048576,ht)}function ne(_t){return r&&_t.alternate===null&&(_t.flags|=67108866),_t}function ve(_t,ht,Dt,rn){return ht===null||ht.tag!==6?(ht=jd(Dt,_t.mode,rn),ht.return=_t,ht):(ht=L(ht,Dt),ht.return=_t,ht)}function rt(_t,ht,Dt,rn){var li=Dt.type;return li===ye?Kt(_t,ht,Dt.props.children,rn,Dt.key):ht!==null&&(ht.elementType===li||typeof li=="object"&&li!==null&&li.$$typeof===Je&&xo(li)===ht.type)?(ht=L(ht,Dt.props),yl(ht,Dt),ht.return=_t,ht):(ht=Hh(Dt.type,Dt.key,Dt.props,null,_t.mode,rn),yl(ht,Dt),ht.return=_t,ht)}function Pt(_t,ht,Dt,rn){return ht===null||ht.tag!==4||ht.stateNode.containerInfo!==Dt.containerInfo||ht.stateNode.implementation!==Dt.implementation?(ht=uc(Dt,_t.mode,rn),ht.return=_t,ht):(ht=L(ht,Dt.children||[]),ht.return=_t,ht)}function Kt(_t,ht,Dt,rn,li){return ht===null||ht.tag!==7?(ht=cc(Dt,_t.mode,rn,li),ht.return=_t,ht):(ht=L(ht,Dt),ht.return=_t,ht)}function ln(_t,ht,Dt){if(typeof ht=="string"&&ht!==""||typeof ht=="number"||typeof ht=="bigint")return ht=jd(""+ht,_t.mode,Dt),ht.return=_t,ht;if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case Ce:return Dt=Hh(ht.type,ht.key,ht.props,null,_t.mode,Dt),yl(Dt,ht),Dt.return=_t,Dt;case Ee:return ht=uc(ht,_t.mode,Dt),ht.return=_t,ht;case Je:return ht=xo(ht),ln(_t,ht,Dt)}if(Ie(ht)||ot(ht))return ht=cc(ht,_t.mode,Dt,null),ht.return=_t,ht;if(typeof ht.then=="function")return ln(_t,rh(ht),Dt);if(ht.$$typeof===Qe)return ln(_t,th(_t,ht),Dt);Jh(_t,ht)}return null}function Lt(_t,ht,Dt,rn){var li=ht!==null?ht.key:null;if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number"||typeof Dt=="bigint")return li!==null?null:ve(_t,ht,""+Dt,rn);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case Ce:return Dt.key===li?rt(_t,ht,Dt,rn):null;case Ee:return Dt.key===li?Pt(_t,ht,Dt,rn):null;case Je:return Dt=xo(Dt),Lt(_t,ht,Dt,rn)}if(Ie(Dt)||ot(Dt))return li!==null?null:Kt(_t,ht,Dt,rn,null);if(typeof Dt.then=="function")return Lt(_t,ht,rh(Dt),rn);if(Dt.$$typeof===Qe)return Lt(_t,ht,th(_t,Dt),rn);Jh(_t,Dt)}return null}function Gt(_t,ht,Dt,rn,li){if(typeof rn=="string"&&rn!==""||typeof rn=="number"||typeof rn=="bigint")return _t=_t.get(Dt)||null,ve(ht,_t,""+rn,li);if(typeof rn=="object"&&rn!==null){switch(rn.$$typeof){case Ce:return _t=_t.get(rn.key===null?Dt:rn.key)||null,rt(ht,_t,rn,li);case Ee:return _t=_t.get(rn.key===null?Dt:rn.key)||null,Pt(ht,_t,rn,li);case Je:return rn=xo(rn),Gt(_t,ht,Dt,rn,li)}if(Ie(rn)||ot(rn))return _t=_t.get(Dt)||null,Kt(ht,_t,rn,li,null);if(typeof rn.then=="function")return Gt(_t,ht,Dt,rh(rn),li);if(rn.$$typeof===Qe)return Gt(_t,ht,Dt,th(ht,rn),li);Jh(ht,rn)}return null}function jn(_t,ht,Dt,rn){for(var li=null,mr=null,Un=ht,ei=ht=0,qi=null;Un!==null&&ei<Dt.length;ei++){Un.index>ei?(qi=Un,Un=null):qi=Un.sibling;var hr=Lt(_t,Un,Dt[ei],rn);if(hr===null){Un===null&&(Un=qi);break}r&&Un&&hr.alternate===null&&o(_t,Un),ht=U(hr,ht,ei),mr===null?li=hr:mr.sibling=hr,mr=hr,Un=qi}if(ei===Dt.length)return g(_t,Un),Li&&Ll(_t,ei),li;if(Un===null){for(;ei<Dt.length;ei++)Un=ln(_t,Dt[ei],rn),Un!==null&&(ht=U(Un,ht,ei),mr===null?li=Un:mr.sibling=Un,mr=Un);return Li&&Ll(_t,ei),li}for(Un=S(Un);ei<Dt.length;ei++)qi=Gt(Un,_t,ei,Dt[ei],rn),qi!==null&&(r&&qi.alternate!==null&&Un.delete(qi.key===null?ei:qi.key),ht=U(qi,ht,ei),mr===null?li=qi:mr.sibling=qi,mr=qi);return r&&Un.forEach(function(ru){return o(_t,ru)}),Li&&Ll(_t,ei),li}function hi(_t,ht,Dt,rn){if(Dt==null)throw Error(C(151));for(var li=null,mr=null,Un=ht,ei=ht=0,qi=null,hr=Dt.next();Un!==null&&!hr.done;ei++,hr=Dt.next()){Un.index>ei?(qi=Un,Un=null):qi=Un.sibling;var ru=Lt(_t,Un,hr.value,rn);if(ru===null){Un===null&&(Un=qi);break}r&&Un&&ru.alternate===null&&o(_t,Un),ht=U(ru,ht,ei),mr===null?li=ru:mr.sibling=ru,mr=ru,Un=qi}if(hr.done)return g(_t,Un),Li&&Ll(_t,ei),li;if(Un===null){for(;!hr.done;ei++,hr=Dt.next())hr=ln(_t,hr.value,rn),hr!==null&&(ht=U(hr,ht,ei),mr===null?li=hr:mr.sibling=hr,mr=hr);return Li&&Ll(_t,ei),li}for(Un=S(Un);!hr.done;ei++,hr=Dt.next())hr=Gt(Un,_t,ei,hr.value,rn),hr!==null&&(r&&hr.alternate!==null&&Un.delete(hr.key===null?ei:hr.key),ht=U(hr,ht,ei),mr===null?li=hr:mr.sibling=hr,mr=hr);return r&&Un.forEach(function(gm){return o(_t,gm)}),Li&&Ll(_t,ei),li}function Or(_t,ht,Dt,rn){if(typeof Dt=="object"&&Dt!==null&&Dt.type===ye&&Dt.key===null&&(Dt=Dt.props.children),typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case Ce:e:{for(var li=Dt.key;ht!==null;){if(ht.key===li){if(li=Dt.type,li===ye){if(ht.tag===7){g(_t,ht.sibling),rn=L(ht,Dt.props.children),rn.return=_t,_t=rn;break e}}else if(ht.elementType===li||typeof li=="object"&&li!==null&&li.$$typeof===Je&&xo(li)===ht.type){g(_t,ht.sibling),rn=L(ht,Dt.props),yl(rn,Dt),rn.return=_t,_t=rn;break e}g(_t,ht);break}else o(_t,ht);ht=ht.sibling}Dt.type===ye?(rn=cc(Dt.props.children,_t.mode,rn,Dt.key),rn.return=_t,_t=rn):(rn=Hh(Dt.type,Dt.key,Dt.props,null,_t.mode,rn),yl(rn,Dt),rn.return=_t,_t=rn)}return ne(_t);case Ee:e:{for(li=Dt.key;ht!==null;){if(ht.key===li)if(ht.tag===4&&ht.stateNode.containerInfo===Dt.containerInfo&&ht.stateNode.implementation===Dt.implementation){g(_t,ht.sibling),rn=L(ht,Dt.children||[]),rn.return=_t,_t=rn;break e}else{g(_t,ht);break}else o(_t,ht);ht=ht.sibling}rn=uc(Dt,_t.mode,rn),rn.return=_t,_t=rn}return ne(_t);case Je:return Dt=xo(Dt),Or(_t,ht,Dt,rn)}if(Ie(Dt))return jn(_t,ht,Dt,rn);if(ot(Dt)){if(li=ot(Dt),typeof li!="function")throw Error(C(150));return Dt=li.call(Dt),hi(_t,ht,Dt,rn)}if(typeof Dt.then=="function")return Or(_t,ht,rh(Dt),rn);if(Dt.$$typeof===Qe)return Or(_t,ht,th(_t,Dt),rn);Jh(_t,Dt)}return typeof Dt=="string"&&Dt!==""||typeof Dt=="number"||typeof Dt=="bigint"?(Dt=""+Dt,ht!==null&&ht.tag===6?(g(_t,ht.sibling),rn=L(ht,Dt),rn.return=_t,_t=rn):(g(_t,ht),rn=jd(Dt,_t.mode,rn),rn.return=_t,_t=rn),ne(_t)):g(_t,ht)}return function(_t,ht,Dt,rn){try{Lc=0;var li=Or(_t,ht,Dt,rn);return gl=null,li}catch(Un){if(Un===Oo||Un===La)throw Un;var mr=Ja(29,Un,null,_t.mode);return mr.lanes=rn,mr.return=_t,mr}}}var xl=sh(!0),qd=sh(!1),_l=!1;function ed(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ah(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function bl(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Gl(r,o,g){var S=r.updateQueue;if(S===null)return null;if(S=S.shared,(wr&2)!==0){var L=S.pending;return L===null?o.next=o:(o.next=L.next,L.next=o),S.pending=o,o=fu(r),Fd(r,null,g),o}return Ju(r,S,o,g),fu(r)}function _o(r,o,g){if(o=o.updateQueue,o!==null&&(o=o.shared,(g&4194048)!==0)){var S=o.lanes;S&=r.pendingLanes,g|=S,o.lanes=g,Bn(r,g)}}function cr(r,o){var g=r.updateQueue,S=r.alternate;if(S!==null&&(S=S.updateQueue,g===S)){var L=null,U=null;if(g=g.firstBaseUpdate,g!==null){do{var ne={lane:g.lane,tag:g.tag,payload:g.payload,callback:null,next:null};U===null?L=U=ne:U=U.next=ne,g=g.next}while(g!==null);U===null?L=U=o:U=U.next=o}else L=U=o;g={baseState:S.baseState,firstBaseUpdate:L,lastBaseUpdate:U,shared:S.shared,callbacks:S.callbacks},r.updateQueue=g;return}r=g.lastBaseUpdate,r===null?g.firstBaseUpdate=o:r.next=o,g.lastBaseUpdate=o}var Zd=!1;function Hl(){if(Zd){var r=xa;if(r!==null)throw r}}function mc(r,o,g,S){Zd=!1;var L=r.updateQueue;_l=!1;var U=L.firstBaseUpdate,ne=L.lastBaseUpdate,ve=L.shared.pending;if(ve!==null){L.shared.pending=null;var rt=ve,Pt=rt.next;rt.next=null,ne===null?U=Pt:ne.next=Pt,ne=rt;var Kt=r.alternate;Kt!==null&&(Kt=Kt.updateQueue,ve=Kt.lastBaseUpdate,ve!==ne&&(ve===null?Kt.firstBaseUpdate=Pt:ve.next=Pt,Kt.lastBaseUpdate=rt))}if(U!==null){var ln=L.baseState;ne=0,Kt=Pt=rt=null,ve=U;do{var Lt=ve.lane&-536870913,Gt=Lt!==ve.lane;if(Gt?(Xi&Lt)===Lt:(S&Lt)===Lt){Lt!==0&&Lt===zc&&(Zd=!0),Kt!==null&&(Kt=Kt.next={lane:0,tag:ve.tag,payload:ve.payload,callback:null,next:null});e:{var jn=r,hi=ve;Lt=o;var Or=g;switch(hi.tag){case 1:if(jn=hi.payload,typeof jn=="function"){ln=jn.call(Or,ln,Lt);break e}ln=jn;break e;case 3:jn.flags=jn.flags&-65537|128;case 0:if(jn=hi.payload,Lt=typeof jn=="function"?jn.call(Or,ln,Lt):jn,Lt==null)break e;ln=K({},ln,Lt);break e;case 2:_l=!0}}Lt=ve.callback,Lt!==null&&(r.flags|=64,Gt&&(r.flags|=8192),Gt=L.callbacks,Gt===null?L.callbacks=[Lt]:Gt.push(Lt))}else Gt={lane:Lt,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null},Kt===null?(Pt=Kt=Gt,rt=ln):Kt=Kt.next=Gt,ne|=Lt;if(ve=ve.next,ve===null){if(ve=L.shared.pending,ve===null)break;Gt=ve,ve=Gt.next,Gt.next=null,L.lastBaseUpdate=Gt,L.shared.pending=null}}while(!0);Kt===null&&(rt=ln),L.baseState=rt,L.firstBaseUpdate=Pt,L.lastBaseUpdate=Kt,U===null&&(L.shared.lanes=0),Kc|=ne,r.lanes=ne,r.memoizedState=ln}}function oh(r,o){if(typeof r!="function")throw Error(C(191,r));r.call(o)}function td(r,o){var g=r.callbacks;if(g!==null)for(r.callbacks=null,r=0;r<g.length;r++)oh(g[r],o)}var Bc=Oe(null),lh=Oe(0);function Xd(r,o){r=$c,It(lh,r),It(Bc,o),$c=r|o.baseLanes}function ro(){It(lh,$c),It(Bc,Bc.current)}function Fc(){$c=lh.current,Xe(Bc),Xe(lh)}var Dn=Oe(null),Ln=null;function bo(r){var o=r.alternate;It(Jr,Jr.current&1),It(Dn,r),Ln===null&&(o===null||Bc.current!==null||o.memoizedState!==null)&&(Ln=r)}function bu(r){It(Jr,Jr.current),It(Dn,r),Ln===null&&(Ln=r)}function ch(r){r.tag===22?(It(Jr,Jr.current),It(Dn,r),Ln===null&&(Ln=r)):os()}function os(){It(Jr,Jr.current),It(Dn,Dn.current)}function Wr(r){Xe(Dn),Ln===r&&(Ln=null),Xe(Jr)}var Jr=Oe(0);function uh(r){for(var o=r;o!==null;){if(o.tag===13){var g=o.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||Ua(g)||Is(g)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var ql=0,Ii=null,sr=null,Ti=null,Gr=!1,vo=!1,Lo=!1,jc=0,Uc=0,Zl=null,Wd=0;function Br(){throw Error(C(321))}function Bo(r,o){if(o===null)return!1;for(var g=0;g<o.length&&g<r.length;g++)if(!I(r[g],o[g]))return!1;return!0}function vu(r,o,g,S,L,U){return ql=U,Ii=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Se.H=r===null||r.memoizedState===null?vr:ms,Lo=!1,U=g(S,L),Lo=!1,vo&&(U=hh(o,g,S,L)),wu(r),U}function wu(r){Se.H=ur;var o=sr!==null&&sr.next!==null;if(ql=0,Ti=sr=Ii=null,Gr=!1,Uc=0,Zl=null,o)throw Error(C(300));r===null||Zs||(r=r.dependencies,r!==null&&gu(r)&&(Zs=!0))}function hh(r,o,g,S){Ii=r;var L=0;do{if(vo&&(Zl=null),Uc=0,vo=!1,25<=L)throw Error(C(301));if(L+=1,Ti=sr=null,r.updateQueue!=null){var U=r.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}Se.H=Cs,U=o(g,S)}while(vo);return U}function dh(){var r=Se.H,o=r.useState()[0];return o=typeof o.then=="function"?Vc(o):o,r=r.useState()[0],(sr!==null?sr.memoizedState:null)!==r&&(Ii.flags|=1024),o}function fh(){var r=jc!==0;return jc=0,r}function gc(r,o,g){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~g}function Xl(r){if(Gr){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Gr=!1}ql=0,Ti=sr=Ii=null,vo=!1,Uc=jc=0,Zl=null}function oa(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ti===null?Ii.memoizedState=Ti=r:Ti=Ti.next=r,Ti}function Hr(){if(sr===null){var r=Ii.alternate;r=r!==null?r.memoizedState:null}else r=sr.next;var o=Ti===null?Ii.memoizedState:Ti.next;if(o!==null)Ti=o,sr=r;else{if(r===null)throw Ii.alternate===null?Error(C(467)):Error(C(310));sr=r,r={memoizedState:sr.memoizedState,baseState:sr.baseState,baseQueue:sr.baseQueue,queue:sr.queue,next:null},Ti===null?Ii.memoizedState=Ti=r:Ti=Ti.next=r}return Ti}function vl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Vc(r){var o=Uc;return Uc+=1,Zl===null&&(Zl=[]),r=Kh(Zl,r,o),o=Ii,(Ti===null?o.memoizedState:Ti.next)===null&&(o=o.alternate,Se.H=o===null||o.memoizedState===null?vr:ms),r}function Gc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Vc(r);if(r.$$typeof===Qe)return ps(r)}throw Error(C(438,String(r)))}function Eu(r){var o=null,g=Ii.updateQueue;if(g!==null&&(o=g.memoCache),o==null){var S=Ii.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(o={data:S.data.map(function(L){return L.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),g===null&&(g=vl(),Ii.updateQueue=g),g.memoCache=o,g=o.data[o.index],g===void 0)for(g=o.data[o.index]=Array(r),S=0;S<r;S++)g[S]=pt;return o.index++,g}function Fo(r,o){return typeof o=="function"?o(r):o}function E(r){var o=Hr();return t(o,sr,r)}function t(r,o,g){var S=r.queue;if(S===null)throw Error(C(311));S.lastRenderedReducer=g;var L=r.baseQueue,U=S.pending;if(U!==null){if(L!==null){var ne=L.next;L.next=U.next,U.next=ne}o.baseQueue=L=U,S.pending=null}if(U=r.baseState,L===null)r.memoizedState=U;else{o=L.next;var ve=ne=null,rt=null,Pt=o,Kt=!1;do{var ln=Pt.lane&-536870913;if(ln!==Pt.lane?(Xi&ln)===ln:(ql&ln)===ln){var Lt=Pt.revertLane;if(Lt===0)rt!==null&&(rt=rt.next={lane:0,revertLane:0,gesture:null,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null}),ln===zc&&(Kt=!0);else if((ql&Lt)===Lt){Pt=Pt.next,Lt===zc&&(Kt=!0);continue}else ln={lane:0,revertLane:Pt.revertLane,gesture:null,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null},rt===null?(ve=rt=ln,ne=U):rt=rt.next=ln,Ii.lanes|=Lt,Kc|=Lt;ln=Pt.action,Lo&&g(U,ln),U=Pt.hasEagerState?Pt.eagerState:g(U,ln)}else Lt={lane:ln,revertLane:Pt.revertLane,gesture:Pt.gesture,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null},rt===null?(ve=rt=Lt,ne=U):rt=rt.next=Lt,Ii.lanes|=ln,Kc|=ln;Pt=Pt.next}while(Pt!==null&&Pt!==o);if(rt===null?ne=U:rt.next=ve,!I(U,r.memoizedState)&&(Zs=!0,Kt&&(g=xa,g!==null)))throw g;r.memoizedState=U,r.baseState=ne,r.baseQueue=rt,S.lastRenderedState=U}return L===null&&(S.lanes=0),[r.memoizedState,S.dispatch]}function s(r){var o=Hr(),g=o.queue;if(g===null)throw Error(C(311));g.lastRenderedReducer=r;var S=g.dispatch,L=g.pending,U=o.memoizedState;if(L!==null){g.pending=null;var ne=L=L.next;do U=r(U,ne.action),ne=ne.next;while(ne!==L);I(U,o.memoizedState)||(Zs=!0),o.memoizedState=U,o.baseQueue===null&&(o.baseState=U),g.lastRenderedState=U}return[U,S]}function d(r,o,g){var S=Ii,L=Hr(),U=Li;if(U){if(g===void 0)throw Error(C(407));g=g()}else g=o();var ne=!I((sr||L).memoizedState,g);if(ne&&(L.memoizedState=g,Zs=!0),L=L.queue,Ct(M.bind(null,S,L,r),[r]),L.getSnapshot!==o||ne||Ti!==null&&Ti.memoizedState.tag&1){if(S.flags|=2048,Ve(9,{destroy:void 0},T.bind(null,S,L,g,o),null),qr===null)throw Error(C(349));U||(ql&127)!==0||x(S,o,g)}return g}function x(r,o,g){r.flags|=16384,r={getSnapshot:o,value:g},o=Ii.updateQueue,o===null?(o=vl(),Ii.updateQueue=o,o.stores=[r]):(g=o.stores,g===null?o.stores=[r]:g.push(r))}function T(r,o,g,S){o.value=g,o.getSnapshot=S,z(o)&&j(r)}function M(r,o,g){return g(function(){z(o)&&j(r)})}function z(r){var o=r.getSnapshot;r=r.value;try{var g=o();return!I(r,g)}catch{return!0}}function j(r){var o=go(r,2);o!==null&&Io(o,r,2)}function Z(r){var o=oa();if(typeof r=="function"){var g=r;if(r=g(),Lo){de(!0);try{g()}finally{de(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fo,lastRenderedState:r},o}function W(r,o,g,S){return r.baseState=g,t(r,sr,typeof S=="function"?S:Fo)}function ee(r,o,g,S,L){if(so(r))throw Error(C(485));if(r=o.action,r!==null){var U={payload:L,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){U.listeners.push(ne)}};Se.T!==null?g(!0):U.isTransition=!1,S(U),g=o.pending,g===null?(U.next=o.pending=U,J(o,U)):(U.next=g.next,o.pending=g.next=U)}}function J(r,o){var g=o.action,S=o.payload,L=r.state;if(o.isTransition){var U=Se.T,ne={};Se.T=ne;try{var ve=g(L,S),rt=Se.S;rt!==null&&rt(ne,ve),se(r,o,ve)}catch(Pt){Ae(r,o,Pt)}finally{U!==null&&ne.types!==null&&(U.types=ne.types),Se.T=U}}else try{U=g(L,S),se(r,o,U)}catch(Pt){Ae(r,o,Pt)}}function se(r,o,g){g!==null&&typeof g=="object"&&typeof g.then=="function"?g.then(function(S){pe(r,o,S)},function(S){return Ae(r,o,S)}):pe(r,o,g)}function pe(r,o,g){o.status="fulfilled",o.value=g,Ne(o),r.state=g,o=r.pending,o!==null&&(g=o.next,g===o?r.pending=null:(g=g.next,o.next=g,J(r,g)))}function Ae(r,o,g){var S=r.pending;if(r.pending=null,S!==null){S=S.next;do o.status="rejected",o.reason=g,Ne(o),o=o.next;while(o!==S)}r.action=null}function Ne(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function Re(r,o){return o}function Be(r,o){if(Li){var g=qr.formState;if(g!==null){e:{var S=Ii;if(Li){if(_r){t:{for(var L=_r,U=to;L.nodeType!==8;){if(!U){L=null;break t}if(L=qo(L.nextSibling),L===null){L=null;break t}}U=L.data,L=U==="F!"||U==="F"?L:null}if(L){_r=qo(L.nextSibling),S=L.data==="F!";break e}}Oa(S)}S=!1}S&&(o=g[0])}}return g=oa(),g.memoizedState=g.baseState=o,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Re,lastRenderedState:o},g.queue=S,g=Su.bind(null,Ii,S),S.dispatch=g,S=Z(!1),U=Fa.bind(null,Ii,!1,S.queue),S=oa(),L={state:o,dispatch:null,action:r,pending:null},S.queue=L,g=ee.bind(null,Ii,L,U,g),L.dispatch=g,S.memoizedState=r,[o,g,!1]}function We(r){var o=Hr();return Le(o,sr,r)}function Le(r,o,g){if(o=t(r,o,Re)[0],r=E(Fo)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var S=Vc(o)}catch(ne){throw ne===Oo?La:ne}else S=o;o=Hr();var L=o.queue,U=L.dispatch;return g!==o.memoizedState&&(Ii.flags|=2048,Ve(9,{destroy:void 0},Ze.bind(null,L,g),null)),[S,U,r]}function Ze(r,o){r.action=o}function et(r){var o=Hr(),g=sr;if(g!==null)return Le(o,g,r);Hr(),o=o.memoizedState,g=Hr();var S=g.queue.dispatch;return g.memoizedState=r,[o,S,!1]}function Ve(r,o,g,S){return r={tag:r,create:g,deps:S,inst:o,next:null},o=Ii.updateQueue,o===null&&(o=vl(),Ii.updateQueue=o),g=o.lastEffect,g===null?o.lastEffect=r.next=r:(S=g.next,g.next=r,r.next=S,o.lastEffect=r),r}function ut(){return Hr().memoizedState}function Mt(r,o,g,S){var L=oa();Ii.flags|=r,L.memoizedState=Ve(1|o,{destroy:void 0},g,S===void 0?null:S)}function Et(r,o,g,S){var L=Hr();S=S===void 0?null:S;var U=L.memoizedState.inst;sr!==null&&S!==null&&Bo(S,sr.memoizedState.deps)?L.memoizedState=Ve(o,U,g,S):(Ii.flags|=r,L.memoizedState=Ve(1|o,U,g,S))}function At(r,o){Mt(8390656,8,r,o)}function Ct(r,o){Et(2048,8,r,o)}function dn(r){Ii.flags|=4;var o=Ii.updateQueue;if(o===null)o=vl(),Ii.updateQueue=o,o.events=[r];else{var g=o.events;g===null?o.events=[r]:g.push(r)}}function mn(r){var o=Hr().memoizedState;return dn({ref:o,nextImpl:r}),function(){if((wr&2)!==0)throw Error(C(440));return o.impl.apply(void 0,arguments)}}function Qt(r,o){return Et(4,2,r,o)}function En(r,o){return Et(4,4,r,o)}function mi(r,o){if(typeof o=="function"){r=r();var g=o(r);return function(){typeof g=="function"?g():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function ar(r,o,g){g=g!=null?g.concat([r]):null,Et(4,4,mi.bind(null,o,r),g)}function Ir(){}function br(r,o){var g=Hr();o=o===void 0?null:o;var S=g.memoizedState;return o!==null&&Bo(o,S[1])?S[0]:(g.memoizedState=[r,o],r)}function Fr(r,o){var g=Hr();o=o===void 0?null:o;var S=g.memoizedState;if(o!==null&&Bo(o,S[1]))return S[0];if(S=r(),Lo){de(!0);try{r()}finally{de(!1)}}return g.memoizedState=[S,o],S}function fr(r,o,g){return g===void 0||(ql&1073741824)!==0&&(Xi&261930)===0?r.memoizedState=o:(r.memoizedState=g,r=$m(),Ii.lanes|=r,Kc|=r,g)}function Yr(r,o,g,S){return I(g,o)?g:Bc.current!==null?(r=fr(r,g,S),I(r,o)||(Zs=!0),r):(ql&42)===0||(ql&1073741824)!==0&&(Xi&261930)===0?(Zs=!0,r.memoizedState=g):(r=$m(),Ii.lanes|=r,Kc|=r,o)}function jr(r,o,g,S,L){var U=je.p;je.p=U!==0&&8>U?U:8;var ne=Se.T,ve={};Se.T=ve,Fa(r,!1,o,g);try{var rt=L(),Pt=Se.S;if(Pt!==null&&Pt(ve,rt),rt!==null&&typeof rt=="object"&&typeof rt.then=="function"){var Kt=nh(rt,S);Uo(r,o,Kt,Co(r))}else Uo(r,o,S,Co(r))}catch(ln){Uo(r,o,{then:function(){},status:"rejected",reason:ln},Co())}finally{je.p=U,ne!==null&&ve.types!==null&&(ne.types=ve.types),Se.T=ne}}function Hs(){}function es(r,o,g,S){if(r.tag!==5)throw Error(C(476));var L=ts(r).queue;jr(r,L,o,st,g===null?Hs:function(){return qs(r),g(S)})}function ts(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:st,baseState:st,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fo,lastRenderedState:st},next:null};var g={};return o.next={memoizedState:g,baseState:g,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fo,lastRenderedState:g},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function qs(r){var o=ts(r);o.next===null&&(o=r.alternate.memoizedState),Uo(r,o.next.queue,{},Co())}function wl(){return ps(Ed)}function El(){return Hr().memoizedState}function jo(){return Hr().memoizedState}function Ba(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var g=Co();r=bl(g);var S=Gl(o,r,g);S!==null&&(Io(S,o,g),_o(S,o,g)),o={cache:ml()},r.payload=o;return}o=o.return}}function Hc(r,o,g){var S=Co();g={lane:S,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},so(r)?wo(o,g):(g=lc(r,o,g,S),g!==null&&(Io(g,r,S),Eo(g,o,S)))}function Su(r,o,g){var S=Co();Uo(r,o,g,S)}function Uo(r,o,g,S){var L={lane:S,revertLane:0,gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null};if(so(r))wo(o,L);else{var U=r.alternate;if(r.lanes===0&&(U===null||U.lanes===0)&&(U=o.lastRenderedReducer,U!==null))try{var ne=o.lastRenderedState,ve=U(ne,g);if(L.hasEagerState=!0,L.eagerState=ve,I(ve,ne))return Ju(r,o,L,0),qr===null&&kc(),!1}catch{}if(g=lc(r,o,L,S),g!==null)return Io(g,r,S),Eo(g,o,S),!0}return!1}function Fa(r,o,g,S){if(S={lane:2,revertLane:G0(),gesture:null,action:S,hasEagerState:!1,eagerState:null,next:null},so(r)){if(o)throw Error(C(479))}else o=lc(r,g,S,2),o!==null&&Io(o,r,2)}function so(r){var o=r.alternate;return r===Ii||o!==null&&o===Ii}function wo(r,o){vo=Gr=!0;var g=r.pending;g===null?o.next=o:(o.next=g.next,g.next=o),r.pending=o}function Eo(r,o,g){if((g&4194048)!==0){var S=o.lanes;S&=r.pendingLanes,g|=S,o.lanes=g,Bn(r,g)}}var ur={readContext:ps,use:Gc,useCallback:Br,useContext:Br,useEffect:Br,useImperativeHandle:Br,useLayoutEffect:Br,useInsertionEffect:Br,useMemo:Br,useReducer:Br,useRef:Br,useState:Br,useDebugValue:Br,useDeferredValue:Br,useTransition:Br,useSyncExternalStore:Br,useId:Br,useHostTransitionStatus:Br,useFormState:Br,useActionState:Br,useOptimistic:Br,useMemoCache:Br,useCacheRefresh:Br};ur.useEffectEvent=Br;var vr={readContext:ps,use:Gc,useCallback:function(r,o){return oa().memoizedState=[r,o===void 0?null:o],r},useContext:ps,useEffect:At,useImperativeHandle:function(r,o,g){g=g!=null?g.concat([r]):null,Mt(4194308,4,mi.bind(null,o,r),g)},useLayoutEffect:function(r,o){return Mt(4194308,4,r,o)},useInsertionEffect:function(r,o){Mt(4,2,r,o)},useMemo:function(r,o){var g=oa();o=o===void 0?null:o;var S=r();if(Lo){de(!0);try{r()}finally{de(!1)}}return g.memoizedState=[S,o],S},useReducer:function(r,o,g){var S=oa();if(g!==void 0){var L=g(o);if(Lo){de(!0);try{g(o)}finally{de(!1)}}}else L=o;return S.memoizedState=S.baseState=L,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:L},S.queue=r,r=r.dispatch=Hc.bind(null,Ii,r),[S.memoizedState,r]},useRef:function(r){var o=oa();return r={current:r},o.memoizedState=r},useState:function(r){r=Z(r);var o=r.queue,g=Su.bind(null,Ii,o);return o.dispatch=g,[r.memoizedState,g]},useDebugValue:Ir,useDeferredValue:function(r,o){var g=oa();return fr(g,r,o)},useTransition:function(){var r=Z(!1);return r=jr.bind(null,Ii,r.queue,!0,!1),oa().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,g){var S=Ii,L=oa();if(Li){if(g===void 0)throw Error(C(407));g=g()}else{if(g=o(),qr===null)throw Error(C(349));(Xi&127)!==0||x(S,o,g)}L.memoizedState=g;var U={value:g,getSnapshot:o};return L.queue=U,At(M.bind(null,S,U,r),[r]),S.flags|=2048,Ve(9,{destroy:void 0},T.bind(null,S,U,g,o),null),g},useId:function(){var r=oa(),o=qr.identifierPrefix;if(Li){var g=Pa,S=cl;g=(S&~(1<<32-Me(S)-1)).toString(32)+g,o="_"+o+"R_"+g,g=jc++,0<g&&(o+="H"+g.toString(32)),o+="_"}else g=Wd++,o="_"+o+"r_"+g.toString(32)+"_";return r.memoizedState=o},useHostTransitionStatus:wl,useFormState:Be,useActionState:Be,useOptimistic:function(r){var o=oa();o.memoizedState=o.baseState=r;var g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=g,o=Fa.bind(null,Ii,!0,g),g.dispatch=o,[r,o]},useMemoCache:Eu,useCacheRefresh:function(){return oa().memoizedState=Ba.bind(null,Ii)},useEffectEvent:function(r){var o=oa(),g={impl:r};return o.memoizedState=g,function(){if((wr&2)!==0)throw Error(C(440));return g.impl.apply(void 0,arguments)}}},ms={readContext:ps,use:Gc,useCallback:br,useContext:ps,useEffect:Ct,useImperativeHandle:ar,useInsertionEffect:Qt,useLayoutEffect:En,useMemo:Fr,useReducer:E,useRef:ut,useState:function(){return E(Fo)},useDebugValue:Ir,useDeferredValue:function(r,o){var g=Hr();return Yr(g,sr.memoizedState,r,o)},useTransition:function(){var r=E(Fo)[0],o=Hr().memoizedState;return[typeof r=="boolean"?r:Vc(r),o]},useSyncExternalStore:d,useId:El,useHostTransitionStatus:wl,useFormState:We,useActionState:We,useOptimistic:function(r,o){var g=Hr();return W(g,sr,r,o)},useMemoCache:Eu,useCacheRefresh:jo};ms.useEffectEvent=mn;var Cs={readContext:ps,use:Gc,useCallback:br,useContext:ps,useEffect:Ct,useImperativeHandle:ar,useInsertionEffect:Qt,useLayoutEffect:En,useMemo:Fr,useReducer:s,useRef:ut,useState:function(){return s(Fo)},useDebugValue:Ir,useDeferredValue:function(r,o){var g=Hr();return sr===null?fr(g,r,o):Yr(g,sr.memoizedState,r,o)},useTransition:function(){var r=s(Fo)[0],o=Hr().memoizedState;return[typeof r=="boolean"?r:Vc(r),o]},useSyncExternalStore:d,useId:El,useHostTransitionStatus:wl,useFormState:et,useActionState:et,useOptimistic:function(r,o){var g=Hr();return sr!==null?W(g,sr,r,o):(g.baseState=r,[r,g.queue.dispatch])},useMemoCache:Eu,useCacheRefresh:jo};Cs.useEffectEvent=mn;function nd(r,o,g,S){o=r.memoizedState,g=g(S,o),g=g==null?o:K({},o,g),r.memoizedState=g,r.lanes===0&&(r.updateQueue.baseState=g)}var id={enqueueSetState:function(r,o,g){r=r._reactInternals;var S=Co(),L=bl(S);L.payload=o,g!=null&&(L.callback=g),o=Gl(r,L,S),o!==null&&(Io(o,r,S),_o(o,r,S))},enqueueReplaceState:function(r,o,g){r=r._reactInternals;var S=Co(),L=bl(S);L.tag=1,L.payload=o,g!=null&&(L.callback=g),o=Gl(r,L,S),o!==null&&(Io(o,r,S),_o(o,r,S))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var g=Co(),S=bl(g);S.tag=2,o!=null&&(S.callback=o),o=Gl(r,S,g),o!==null&&(Io(o,r,g),_o(o,r,g))}};function yc(r,o,g,S,L,U,ne){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(S,U,ne):o.prototype&&o.prototype.isPureReactComponent?!P(g,S)||!P(L,U):!0}function ip(r,o,g,S){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(g,S),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(g,S),o.state!==r&&id.enqueueReplaceState(o,o.state,null)}function xc(r,o){var g=o;if("ref"in o){g={};for(var S in o)S!=="ref"&&(g[S]=o[S])}if(r=r.defaultProps){g===o&&(g=K({},g));for(var L in r)g[L]===void 0&&(g[L]=r[L])}return g}function rd(r){ol(r)}function Wl(r){console.error(r)}function Yl(r){ol(r)}function Vo(r,o){try{var g=r.onUncaughtError;g(o.value,{componentStack:o.stack})}catch(S){setTimeout(function(){throw S})}}function sd(r,o,g){try{var S=r.onCaughtError;S(g.value,{componentStack:g.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(L){setTimeout(function(){throw L})}}function ph(r,o,g){return g=bl(g),g.tag=3,g.payload={element:null},g.callback=function(){Vo(r,o)},g}function mh(r){return r=bl(r),r.tag=3,r}function gh(r,o,g,S){var L=g.type.getDerivedStateFromError;if(typeof L=="function"){var U=S.value;r.payload=function(){return L(U)},r.callback=function(){sd(o,g,S)}}var ne=g.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(r.callback=function(){sd(o,g,S),typeof L!="function"&&(Qc===null?Qc=new Set([this]):Qc.add(this));var ve=S.stack;this.componentDidCatch(S.value,{componentStack:ve!==null?ve:""})})}function rp(r,o,g,S,L){if(g.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(o=g.alternate,o!==null&&no(o,g,L,!0),g=Dn.current,g!==null){switch(g.tag){case 31:case 13:return Ln===null?pf():g.alternate===null&&gs===0&&(gs=3),g.flags&=-257,g.flags|=65536,g.lanes=L,S===Cn?g.flags|=16384:(o=g.updateQueue,o===null?g.updateQueue=new Set([S]):o.add(S),Mp(r,S,L)),!1;case 22:return g.flags|=65536,S===Cn?g.flags|=16384:(o=g.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([S])},g.updateQueue=o):(g=o.retryQueue,g===null?o.retryQueue=new Set([S]):g.add(S)),Mp(r,S,L)),!1}throw Error(C(435,g.tag))}return Mp(r,S,L),pf(),!1}if(Li)return o=Dn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=L,S!==Xr&&(r=Error(C(422),{cause:S}),Fl(Ca(r,g)))):(S!==Xr&&(o=Error(C(423),{cause:S}),Fl(Ca(o,g))),r=r.current.alternate,r.flags|=65536,L&=-L,r.lanes|=L,S=Ca(S,g),L=ph(r.stateNode,S,L),cr(r,L),gs!==4&&(gs=2)),!1;var U=Error(C(520),{cause:S});if(U=Ca(U,g),uf===null?uf=[U]:uf.push(U),gs!==4&&(gs=2),o===null)return!0;S=Ca(S,g),g=o;do{switch(g.tag){case 3:return g.flags|=65536,r=L&-L,g.lanes|=r,r=ph(g.stateNode,S,r),cr(g,r),!1;case 1:if(o=g.type,U=g.stateNode,(g.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(Qc===null||!Qc.has(U))))return g.flags|=65536,L&=-L,g.lanes|=L,L=mh(L),gh(L,r,g,S),cr(g,L),!1}g=g.return}while(g!==null);return!1}var sp=Error(C(461)),Zs=!1;function la(r,o,g,S){o.child=r===null?qd(o,null,g,S):xl(o,r.child,g,S)}function km(r,o,g,S,L){g=g.render;var U=o.ref;if("ref"in S){var ne={};for(var ve in S)ve!=="ref"&&(ne[ve]=S[ve])}else ne=S;return Vl(o),S=vu(r,o,g,ne,U,L),ve=fh(),r!==null&&!Zs?(gc(r,o,L),bc(r,o,L)):(Li&&ve&&Oc(o),o.flags|=1,la(r,o,S,L),o.child)}function ap(r,o,g,S,L){if(r===null){var U=g.type;return typeof U=="function"&&!Gh(U)&&U.defaultProps===void 0&&g.compare===null?(o.tag=15,o.type=U,x0(r,o,U,S,L)):(r=Hh(g.type,null,S,o,o.mode,L),r.ref=o.ref,r.return=o,o.child=r)}if(U=r.child,!Kd(r,L)){var ne=U.memoizedProps;if(g=g.compare,g=g!==null?g:P,g(ne,S)&&r.ref===o.ref)return bc(r,o,L)}return o.flags|=1,r=eo(U,S),r.ref=o.ref,r.return=o,o.child=r}function x0(r,o,g,S,L){if(r!==null){var U=r.memoizedProps;if(P(U,S)&&r.ref===o.ref)if(Zs=!1,o.pendingProps=S=U,Kd(r,L))(r.flags&131072)!==0&&(Zs=!0);else return o.lanes=r.lanes,bc(r,o,L)}return b0(r,o,g,S,L)}function _0(r,o,g,S){var L=S.children,U=r!==null?r.memoizedState:null;if(r===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),S.mode==="hidden"){if((o.flags&128)!==0){if(U=U!==null?U.baseLanes|g:g,r!==null){for(S=o.child=r.child,L=0;S!==null;)L=L|S.lanes|S.childLanes,S=S.sibling;S=L&~U}else S=0,o.child=null;return Pm(r,o,U,g,S)}if((g&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&$h(o,U!==null?U.cachePool:null),U!==null?Xd(o,U):ro(),ch(o);else return S=o.lanes=536870912,Pm(r,o,U!==null?U.baseLanes|g:g,g,S)}else U!==null?($h(o,U.cachePool),Xd(o,U),os(),o.memoizedState=null):(r!==null&&$h(o,null),ro(),os());return la(r,o,L,g),o.child}function _c(r,o){return r!==null&&r.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Pm(r,o,g,S,L){var U=Yh();return U=U===null?null:{parent:as._currentValue,pool:U},o.memoizedState={baseLanes:g,cachePool:U},r!==null&&$h(o,null),ro(),ch(o),r!==null&&no(r,o,S,!0),o.childLanes=L,null}function qc(r,o){return o=hp({mode:o.mode,children:o.children},r.mode),o.ref=r.ref,r.child=o,o.return=r,o}function Yd(r,o,g){return xl(o,r.child,null,g),r=qc(o,o.pendingProps),r.flags|=2,Wr(o),o.memoizedState=null,r}function op(r,o,g){var S=o.pendingProps,L=(o.flags&128)!==0;if(o.flags&=-129,r===null){if(Li){if(S.mode==="hidden")return r=qc(o,S),o.lanes=536870912,_c(null,r);if(bu(o),(r=_r)?(r=Pu(r,to),r=r!==null&&r.data==="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:ll!==null?{id:cl,overflow:Pa}:null,retryLane:536870912,hydrationErrors:null},g=qh(r),g.return=o,o.child=g,Gs=o,_r=null)):r=null,r===null)throw Oa(o);return o.lanes=536870912,null}return qc(o,S)}var U=r.memoizedState;if(U!==null){var ne=U.dehydrated;if(bu(o),L)if(o.flags&256)o.flags&=-257,o=Yd(r,o,g);else if(o.memoizedState!==null)o.child=r.child,o.flags|=128,o=null;else throw Error(C(558));else if(Zs||no(r,o,g,!1),L=(g&r.childLanes)!==0,Zs||L){if(S=qr,S!==null&&(ne=Di(S,g),ne!==0&&ne!==U.retryLane))throw U.retryLane=ne,go(r,ne),Io(S,r,ne),sp;pf(),o=Yd(r,o,g)}else r=U.treeContext,_r=qo(ne.nextSibling),Gs=o,Li=!0,Bl=null,to=!1,r!==null&&Vd(o,r),o=qc(o,S),o.flags|=4096;return o}return r=eo(r.child,{mode:S.mode,children:S.children}),r.ref=o.ref,o.child=r,r.return=o,r}function lp(r,o){var g=o.ref;if(g===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof g!="function"&&typeof g!="object")throw Error(C(284));(r===null||r.ref!==g)&&(o.flags|=4194816)}}function b0(r,o,g,S,L){return Vl(o),g=vu(r,o,g,S,void 0,L),S=fh(),r!==null&&!Zs?(gc(r,o,L),bc(r,o,L)):(Li&&S&&Oc(o),o.flags|=1,la(r,o,g,L),o.child)}function Om(r,o,g,S,L,U){return Vl(o),o.updateQueue=null,g=hh(o,S,g,L),wu(r),S=fh(),r!==null&&!Zs?(gc(r,o,U),bc(r,o,U)):(Li&&S&&Oc(o),o.flags|=1,la(r,o,g,U),o.child)}function zm(r,o,g,S,L){if(Vl(o),o.stateNode===null){var U=bi,ne=g.contextType;typeof ne=="object"&&ne!==null&&(U=ps(ne)),U=new g(S,U),o.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=id,o.stateNode=U,U._reactInternals=o,U=o.stateNode,U.props=S,U.state=o.memoizedState,U.refs={},ed(o),ne=g.contextType,U.context=typeof ne=="object"&&ne!==null?ps(ne):bi,U.state=o.memoizedState,ne=g.getDerivedStateFromProps,typeof ne=="function"&&(nd(o,g,ne,S),U.state=o.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(ne=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),ne!==U.state&&id.enqueueReplaceState(U,U.state,null),mc(o,S,U,L),Hl(),U.state=o.memoizedState),typeof U.componentDidMount=="function"&&(o.flags|=4194308),S=!0}else if(r===null){U=o.stateNode;var ve=o.memoizedProps,rt=xc(g,ve);U.props=rt;var Pt=U.context,Kt=g.contextType;ne=bi,typeof Kt=="object"&&Kt!==null&&(ne=ps(Kt));var ln=g.getDerivedStateFromProps;Kt=typeof ln=="function"||typeof U.getSnapshotBeforeUpdate=="function",ve=o.pendingProps!==ve,Kt||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ve||Pt!==ne)&&ip(o,U,S,ne),_l=!1;var Lt=o.memoizedState;U.state=Lt,mc(o,S,U,L),Hl(),Pt=o.memoizedState,ve||Lt!==Pt||_l?(typeof ln=="function"&&(nd(o,g,ln,S),Pt=o.memoizedState),(rt=_l||yc(o,g,rt,S,Lt,Pt,ne))?(Kt||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(o.flags|=4194308)):(typeof U.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=S,o.memoizedState=Pt),U.props=S,U.state=Pt,U.context=ne,S=rt):(typeof U.componentDidMount=="function"&&(o.flags|=4194308),S=!1)}else{U=o.stateNode,ah(r,o),ne=o.memoizedProps,Kt=xc(g,ne),U.props=Kt,ln=o.pendingProps,Lt=U.context,Pt=g.contextType,rt=bi,typeof Pt=="object"&&Pt!==null&&(rt=ps(Pt)),ve=g.getDerivedStateFromProps,(Pt=typeof ve=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ne!==ln||Lt!==rt)&&ip(o,U,S,rt),_l=!1,Lt=o.memoizedState,U.state=Lt,mc(o,S,U,L),Hl();var Gt=o.memoizedState;ne!==ln||Lt!==Gt||_l||r!==null&&r.dependencies!==null&&gu(r.dependencies)?(typeof ve=="function"&&(nd(o,g,ve,S),Gt=o.memoizedState),(Kt=_l||yc(o,g,Kt,S,Lt,Gt,rt)||r!==null&&r.dependencies!==null&&gu(r.dependencies))?(Pt||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(S,Gt,rt),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(S,Gt,rt)),typeof U.componentDidUpdate=="function"&&(o.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof U.componentDidUpdate!="function"||ne===r.memoizedProps&&Lt===r.memoizedState||(o.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ne===r.memoizedProps&&Lt===r.memoizedState||(o.flags|=1024),o.memoizedProps=S,o.memoizedState=Gt),U.props=S,U.state=Gt,U.context=rt,S=Kt):(typeof U.componentDidUpdate!="function"||ne===r.memoizedProps&&Lt===r.memoizedState||(o.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ne===r.memoizedProps&&Lt===r.memoizedState||(o.flags|=1024),S=!1)}return U=S,lp(r,o),S=(o.flags&128)!==0,U||S?(U=o.stateNode,g=S&&typeof g.getDerivedStateFromError!="function"?null:U.render(),o.flags|=1,r!==null&&S?(o.child=xl(o,r.child,null,L),o.child=xl(o,null,g,L)):la(r,o,g,L),o.memoizedState=U.state,r=o.child):r=bc(r,o,L),r}function Lm(r,o,g,S){return hl(),o.flags|=256,la(r,o,g,S),o.child}var cp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $d(r){return{baseLanes:r,cachePool:np()}}function up(r,o,g){return r=r!==null?r.childLanes&~g:0,o&&(r|=Ia),r}function v0(r,o,g){var S=o.pendingProps,L=!1,U=(o.flags&128)!==0,ne;if((ne=U)||(ne=r!==null&&r.memoizedState===null?!1:(Jr.current&2)!==0),ne&&(L=!0,o.flags&=-129),ne=(o.flags&32)!==0,o.flags&=-33,r===null){if(Li){if(L?bo(o):os(),(r=_r)?(r=Pu(r,to),r=r!==null&&r.data!=="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:ll!==null?{id:cl,overflow:Pa}:null,retryLane:536870912,hydrationErrors:null},g=qh(r),g.return=o,o.child=g,Gs=o,_r=null)):r=null,r===null)throw Oa(o);return Is(r)?o.lanes=32:o.lanes=536870912,null}var ve=S.children;return S=S.fallback,L?(os(),L=o.mode,ve=hp({mode:"hidden",children:ve},L),S=cc(S,L,g,null),ve.return=o,S.return=o,ve.sibling=S,o.child=ve,S=o.child,S.memoizedState=$d(g),S.childLanes=up(r,ne,g),o.memoizedState=cp,_c(null,S)):(bo(o),w0(o,ve))}var rt=r.memoizedState;if(rt!==null&&(ve=rt.dehydrated,ve!==null)){if(U)o.flags&256?(bo(o),o.flags&=-257,o=dp(r,o,g)):o.memoizedState!==null?(os(),o.child=r.child,o.flags|=128,o=null):(os(),ve=S.fallback,L=o.mode,S=hp({mode:"visible",children:S.children},L),ve=cc(ve,L,g,null),ve.flags|=2,S.return=o,ve.return=o,S.sibling=ve,o.child=S,xl(o,r.child,null,g),S=o.child,S.memoizedState=$d(g),S.childLanes=up(r,ne,g),o.memoizedState=cp,o=_c(null,S));else if(bo(o),Is(ve)){if(ne=ve.nextSibling&&ve.nextSibling.dataset,ne)var Pt=ne.dgst;ne=Pt,S=Error(C(419)),S.stack="",S.digest=ne,Fl({value:S,source:null,stack:null}),o=dp(r,o,g)}else if(Zs||no(r,o,g,!1),ne=(g&r.childLanes)!==0,Zs||ne){if(ne=qr,ne!==null&&(S=Di(ne,g),S!==0&&S!==rt.retryLane))throw rt.retryLane=S,go(r,S),Io(ne,r,S),sp;Ua(ve)||pf(),o=dp(r,o,g)}else Ua(ve)?(o.flags|=192,o.child=r.child,o=null):(r=rt.treeContext,_r=qo(ve.nextSibling),Gs=o,Li=!0,Bl=null,to=!1,r!==null&&Vd(o,r),o=w0(o,S.children),o.flags|=4096);return o}return L?(os(),ve=S.fallback,L=o.mode,rt=r.child,Pt=rt.sibling,S=eo(rt,{mode:"hidden",children:S.children}),S.subtreeFlags=rt.subtreeFlags&65011712,Pt!==null?ve=eo(Pt,ve):(ve=cc(ve,L,g,null),ve.flags|=2),ve.return=o,S.return=o,S.sibling=ve,o.child=S,_c(null,S),S=o.child,ve=r.child.memoizedState,ve===null?ve=$d(g):(L=ve.cachePool,L!==null?(rt=as._currentValue,L=L.parent!==rt?{parent:rt,pool:rt}:L):L=np(),ve={baseLanes:ve.baseLanes|g,cachePool:L}),S.memoizedState=ve,S.childLanes=up(r,ne,g),o.memoizedState=cp,_c(r.child,S)):(bo(o),g=r.child,r=g.sibling,g=eo(g,{mode:"visible",children:S.children}),g.return=o,g.sibling=null,r!==null&&(ne=o.deletions,ne===null?(o.deletions=[r],o.flags|=16):ne.push(r)),o.child=g,o.memoizedState=null,g)}function w0(r,o){return o=hp({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function hp(r,o){return r=Ja(22,r,null,o),r.lanes=0,r}function dp(r,o,g){return xl(o,r.child,null,g),r=w0(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function E0(r,o,g){r.lanes|=o;var S=r.alternate;S!==null&&(S.lanes|=o),Zh(r.return,o,g)}function S0(r,o,g,S,L,U){var ne=r.memoizedState;ne===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:S,tail:g,tailMode:L,treeForkCount:U}:(ne.isBackwards=o,ne.rendering=null,ne.renderingStartTime=0,ne.last=S,ne.tail=g,ne.tailMode=L,ne.treeForkCount=U)}function fp(r,o,g){var S=o.pendingProps,L=S.revealOrder,U=S.tail;S=S.children;var ne=Jr.current,ve=(ne&2)!==0;if(ve?(ne=ne&1|2,o.flags|=128):ne&=1,It(Jr,ne),la(r,o,S,g),S=Li?fc:0,!ve&&r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&E0(r,g,o);else if(r.tag===19)E0(r,g,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(L){case"forwards":for(g=o.child,L=null;g!==null;)r=g.alternate,r!==null&&uh(r)===null&&(L=g),g=g.sibling;g=L,g===null?(L=o.child,o.child=null):(L=g.sibling,g.sibling=null),S0(o,!1,L,g,U,S);break;case"backwards":case"unstable_legacy-backwards":for(g=null,L=o.child,o.child=null;L!==null;){if(r=L.alternate,r!==null&&uh(r)===null){o.child=L;break}r=L.sibling,L.sibling=g,g=L,L=r}S0(o,!0,g,null,U,S);break;case"together":S0(o,!1,null,null,void 0,S);break;default:o.memoizedState=null}return o.child}function bc(r,o,g){if(r!==null&&(o.dependencies=r.dependencies),Kc|=o.lanes,(g&o.childLanes)===0)if(r!==null){if(no(r,o,g,!1),(g&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(C(153));if(o.child!==null){for(r=o.child,g=eo(r,r.pendingProps),o.child=g,g.return=o;r.sibling!==null;)r=r.sibling,g=g.sibling=eo(r,r.pendingProps),g.return=o;g.sibling=null}return o.child}function Kd(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&gu(r)))}function Qd(r,o,g){switch(o.tag){case 3:Tn(o,o.stateNode.containerInfo),Ul(o,as,r.memoizedState.cache),hl();break;case 27:case 5:ri(o);break;case 4:Tn(o,o.stateNode.containerInfo);break;case 10:Ul(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,bu(o),null;break;case 13:var S=o.memoizedState;if(S!==null)return S.dehydrated!==null?(bo(o),o.flags|=128,null):(g&o.child.childLanes)!==0?v0(r,o,g):(bo(o),r=bc(r,o,g),r!==null?r.sibling:null);bo(o);break;case 19:var L=(r.flags&128)!==0;if(S=(g&o.childLanes)!==0,S||(no(r,o,g,!1),S=(g&o.childLanes)!==0),L){if(S)return fp(r,o,g);o.flags|=128}if(L=o.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),It(Jr,Jr.current),S)break;return null;case 22:return o.lanes=0,_0(r,o,g,o.pendingProps);case 24:Ul(o,as,r.memoizedState.cache)}return bc(r,o,g)}function ja(r,o,g){if(r!==null)if(r.memoizedProps!==o.pendingProps)Zs=!0;else{if(!Kd(r,g)&&(o.flags&128)===0)return Zs=!1,Qd(r,o,g);Zs=(r.flags&131072)!==0}else Zs=!1,Li&&(o.flags&1048576)!==0&&Ud(o,fc,o.index);switch(o.lanes=0,o.tag){case 16:e:{var S=o.pendingProps;if(r=xo(o.elementType),o.type=r,typeof r=="function")Gh(r)?(S=xc(r,S),o.tag=1,o=zm(null,o,r,S,g)):(o.tag=0,o=b0(null,o,r,S,g));else{if(r!=null){var L=r.$$typeof;if(L===dt){o.tag=11,o=km(null,o,r,S,g);break e}else if(L===tt){o.tag=14,o=ap(null,o,r,S,g);break e}}throw o=Rt(r)||r,Error(C(306,o,""))}}return o;case 0:return b0(r,o,o.type,o.pendingProps,g);case 1:return S=o.type,L=xc(S,o.pendingProps),zm(r,o,S,L,g);case 3:e:{if(Tn(o,o.stateNode.containerInfo),r===null)throw Error(C(387));S=o.pendingProps;var U=o.memoizedState;L=U.element,ah(r,o),mc(o,S,null,g);var ne=o.memoizedState;if(S=ne.cache,Ul(o,as,S),S!==U.cache&&Xh(o,[as],g,!0),Hl(),S=ne.element,U.isDehydrated)if(U={element:S,isDehydrated:!1,cache:ne.cache},o.updateQueue.baseState=U,o.memoizedState=U,o.flags&256){o=Lm(r,o,S,g);break e}else if(S!==L){L=Ca(Error(C(424)),o),Fl(L),o=Lm(r,o,S,g);break e}else for(r=o.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,_r=qo(r.firstChild),Gs=o,Li=!0,Bl=null,to=!0,g=qd(o,null,S,g),o.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(hl(),S===L){o=bc(r,o,g);break e}la(r,o,S,g)}o=o.child}return o;case 26:return lp(r,o),r===null?(g=rm(o.type,null,o.pendingProps,null))?o.memoizedState=g:Li||(g=o.type,r=o.pendingProps,S=bf(Bt.current).createElement(g),S[vi]=o,S[jt]=r,ua(S,g,r),dr(S),o.stateNode=S):o.memoizedState=rm(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return ri(o),r===null&&Li&&(S=o.stateNode=yg(o.type,o.pendingProps,Bt.current),Gs=o,to=!0,L=_r,ku(o.type)?(co=L,_r=qo(S.firstChild)):_r=L),la(r,o,o.pendingProps.children,g),lp(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&Li&&((L=S=_r)&&(S=_a(S,o.type,o.pendingProps,to),S!==null?(o.stateNode=S,Gs=o,_r=qo(S.firstChild),to=!1,L=!0):L=!1),L||Oa(o)),ri(o),L=o.type,U=o.pendingProps,ne=r!==null?r.memoizedProps:null,S=U.children,jp(L,U)?S=null:ne!==null&&jp(L,ne)&&(o.flags|=32),o.memoizedState!==null&&(L=vu(r,o,dh,null,null,g),Ed._currentValue=L),lp(r,o),la(r,o,S,g),o.child;case 6:return r===null&&Li&&((r=g=_r)&&(g=ec(g,o.pendingProps,to),g!==null?(o.stateNode=g,Gs=o,_r=null,r=!0):r=!1),r||Oa(o)),null;case 13:return v0(r,o,g);case 4:return Tn(o,o.stateNode.containerInfo),S=o.pendingProps,r===null?o.child=xl(o,null,S,g):la(r,o,S,g),o.child;case 11:return km(r,o,o.type,o.pendingProps,g);case 7:return la(r,o,o.pendingProps,g),o.child;case 8:return la(r,o,o.pendingProps.children,g),o.child;case 12:return la(r,o,o.pendingProps.children,g),o.child;case 10:return S=o.pendingProps,Ul(o,o.type,S.value),la(r,o,S.children,g),o.child;case 9:return L=o.type._context,S=o.pendingProps.children,Vl(o),L=ps(L),S=S(L),o.flags|=1,la(r,o,S,g),o.child;case 14:return ap(r,o,o.type,o.pendingProps,g);case 15:return x0(r,o,o.type,o.pendingProps,g);case 19:return fp(r,o,g);case 31:return op(r,o,g);case 22:return _0(r,o,g,o.pendingProps);case 24:return Vl(o),S=ps(as),r===null?(L=Yh(),L===null&&(L=qr,U=ml(),L.pooledCache=U,U.refCount++,U!==null&&(L.pooledCacheLanes|=g),L=U),o.memoizedState={parent:S,cache:L},ed(o),Ul(o,as,L)):((r.lanes&g)!==0&&(ah(r,o),mc(o,null,null,g),Hl()),L=r.memoizedState,U=o.memoizedState,L.parent!==S?(L={parent:S,cache:S},o.memoizedState=L,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=L),Ul(o,as,S)):(S=U.cache,Ul(o,as,S),S!==L.cache&&Xh(o,[as],g,!0))),la(r,o,o.pendingProps.children,g),o.child;case 29:throw o.pendingProps}throw Error(C(156,o.tag))}function vc(r){r.flags|=4}function Jd(r,o,g,S,L){if((o=(r.mode&32)!==0)&&(o=!1),o){if(r.flags|=16777216,(L&335544128)===L)if(r.stateNode.complete)r.flags|=8192;else if(z0())r.flags|=8192;else throw zo=Cn,pc}else r.flags&=-16777217}function Bm(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Sf(o))if(z0())r.flags|=8192;else throw zo=Cn,pc}function ef(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?_n():536870912,r.lanes|=o,vh|=o)}function tf(r,o){if(!Li)switch(r.tailMode){case"hidden":o=r.tail;for(var g=null;o!==null;)o.alternate!==null&&(g=o),o=o.sibling;g===null?r.tail=null:g.sibling=null;break;case"collapsed":g=r.tail;for(var S=null;g!==null;)g.alternate!==null&&(S=g),g=g.sibling;S===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:S.sibling=null}}function ns(r){var o=r.alternate!==null&&r.alternate.child===r.child,g=0,S=0;if(o)for(var L=r.child;L!==null;)g|=L.lanes|L.childLanes,S|=L.subtreeFlags&65011712,S|=L.flags&65011712,L.return=r,L=L.sibling;else for(L=r.child;L!==null;)g|=L.lanes|L.childLanes,S|=L.subtreeFlags,S|=L.flags,L.return=r,L=L.sibling;return r.subtreeFlags|=S,r.childLanes=g,o}function Fm(r,o,g){var S=o.pendingProps;switch(mu(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ns(o),null;case 1:return ns(o),null;case 3:return g=o.stateNode,S=null,r!==null&&(S=r.memoizedState.cache),o.memoizedState.cache!==S&&(o.flags|=2048),pl(as),Rn(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(r===null||r.child===null)&&(ul(o)?vc(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,dl())),ns(o),null;case 26:var L=o.type,U=o.memoizedState;return r===null?(vc(o),U!==null?(ns(o),Bm(o,U)):(ns(o),Jd(o,L,null,S,g))):U?U!==r.memoizedState?(vc(o),ns(o),Bm(o,U)):(ns(o),o.flags&=-16777217):(r=r.memoizedProps,r!==S&&vc(o),ns(o),Jd(o,L,r,S,g)),null;case 27:if(_i(o),g=Bt.current,L=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==S&&vc(o);else{if(!S){if(o.stateNode===null)throw Error(C(166));return ns(o),null}r=Nt.current,ul(o)?za(o):(r=yg(L,S,g),o.stateNode=r,vc(o))}return ns(o),null;case 5:if(_i(o),L=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==S&&vc(o);else{if(!S){if(o.stateNode===null)throw Error(C(166));return ns(o),null}if(U=Nt.current,ul(o))za(o);else{var ne=bf(Bt.current);switch(U){case 1:U=ne.createElementNS("http://www.w3.org/2000/svg",L);break;case 2:U=ne.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;default:switch(L){case"svg":U=ne.createElementNS("http://www.w3.org/2000/svg",L);break;case"math":U=ne.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;case"script":U=ne.createElement("div"),U.innerHTML="<script><\/script>",U=U.removeChild(U.firstChild);break;case"select":U=typeof S.is=="string"?ne.createElement("select",{is:S.is}):ne.createElement("select"),S.multiple?U.multiple=!0:S.size&&(U.size=S.size);break;default:U=typeof S.is=="string"?ne.createElement(L,{is:S.is}):ne.createElement(L)}}U[vi]=o,U[jt]=S;e:for(ne=o.child;ne!==null;){if(ne.tag===5||ne.tag===6)U.appendChild(ne.stateNode);else if(ne.tag!==4&&ne.tag!==27&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===o)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===o)break e;ne=ne.return}ne.sibling.return=ne.return,ne=ne.sibling}o.stateNode=U;e:switch(ua(U,L,S),L){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}S&&vc(o)}}return ns(o),Jd(o,o.type,r===null?null:r.memoizedProps,o.pendingProps,g),null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==S&&vc(o);else{if(typeof S!="string"&&o.stateNode===null)throw Error(C(166));if(r=Bt.current,ul(o)){if(r=o.stateNode,g=o.memoizedProps,S=null,L=Gs,L!==null)switch(L.tag){case 27:case 5:S=L.memoizedProps}r[vi]=o,r=!!(r.nodeValue===g||S!==null&&S.suppressHydrationWarning===!0||W0(r.nodeValue,g)),r||Oa(o,!0)}else r=bf(r).createTextNode(S),r[vi]=o,o.stateNode=r}return ns(o),null;case 31:if(g=o.memoizedState,r===null||r.memoizedState!==null){if(S=ul(o),g!==null){if(r===null){if(!S)throw Error(C(318));if(r=o.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(557));r[vi]=o}else hl(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ns(o),r=!1}else g=dl(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),r=!0;if(!r)return o.flags&256?(Wr(o),o):(Wr(o),null);if((o.flags&128)!==0)throw Error(C(558))}return ns(o),null;case 13:if(S=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(L=ul(o),S!==null&&S.dehydrated!==null){if(r===null){if(!L)throw Error(C(318));if(L=o.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(C(317));L[vi]=o}else hl(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ns(o),L=!1}else L=dl(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=L),L=!0;if(!L)return o.flags&256?(Wr(o),o):(Wr(o),null)}return Wr(o),(o.flags&128)!==0?(o.lanes=g,o):(g=S!==null,r=r!==null&&r.memoizedState!==null,g&&(S=o.child,L=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(L=S.alternate.memoizedState.cachePool.pool),U=null,S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(U=S.memoizedState.cachePool.pool),U!==L&&(S.flags|=2048)),g!==r&&g&&(o.child.flags|=8192),ef(o,o.updateQueue),ns(o),null);case 4:return Rn(),r===null&&Z0(o.stateNode.containerInfo),ns(o),null;case 10:return pl(o.type),ns(o),null;case 19:if(Xe(Jr),S=o.memoizedState,S===null)return ns(o),null;if(L=(o.flags&128)!==0,U=S.rendering,U===null)if(L)tf(S,!1);else{if(gs!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(U=uh(r),U!==null){for(o.flags|=128,tf(S,!1),r=U.updateQueue,o.updateQueue=r,ef(o,r),o.subtreeFlags=0,r=g,g=o.child;g!==null;)ep(g,r),g=g.sibling;return It(Jr,Jr.current&1|2),Li&&Ll(o,S.treeForkCount),o.child}r=r.sibling}S.tail!==null&&fi()>hf&&(o.flags|=128,L=!0,tf(S,!1),o.lanes=4194304)}else{if(!L)if(r=uh(U),r!==null){if(o.flags|=128,L=!0,r=r.updateQueue,o.updateQueue=r,ef(o,r),tf(S,!0),S.tail===null&&S.tailMode==="hidden"&&!U.alternate&&!Li)return ns(o),null}else 2*fi()-S.renderingStartTime>hf&&g!==536870912&&(o.flags|=128,L=!0,tf(S,!1),o.lanes=4194304);S.isBackwards?(U.sibling=o.child,o.child=U):(r=S.last,r!==null?r.sibling=U:o.child=U,S.last=U)}return S.tail!==null?(r=S.tail,S.rendering=r,S.tail=r.sibling,S.renderingStartTime=fi(),r.sibling=null,g=Jr.current,It(Jr,L?g&1|2:g&1),Li&&Ll(o,S.treeForkCount),r):(ns(o),null);case 22:case 23:return Wr(o),Fc(),S=o.memoizedState!==null,r!==null?r.memoizedState!==null!==S&&(o.flags|=8192):S&&(o.flags|=8192),S?(g&536870912)!==0&&(o.flags&128)===0&&(ns(o),o.subtreeFlags&6&&(o.flags|=8192)):ns(o),g=o.updateQueue,g!==null&&ef(o,g.retryQueue),g=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(g=r.memoizedState.cachePool.pool),S=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(S=o.memoizedState.cachePool.pool),S!==g&&(o.flags|=2048),r!==null&&Xe(Po),null;case 24:return g=null,r!==null&&(g=r.memoizedState.cache),o.memoizedState.cache!==g&&(o.flags|=2048),pl(as),ns(o),null;case 25:return null;case 30:return null}throw Error(C(156,o.tag))}function w1(r,o){switch(mu(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return pl(as),Rn(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return _i(o),null;case 31:if(o.memoizedState!==null){if(Wr(o),o.alternate===null)throw Error(C(340));hl()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 13:if(Wr(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(C(340));hl()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return Xe(Jr),null;case 4:return Rn(),null;case 10:return pl(o.type),null;case 22:case 23:return Wr(o),Fc(),r!==null&&Xe(Po),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return pl(as),null;case 25:return null;default:return null}}function pp(r,o){switch(mu(o),o.tag){case 3:pl(as),Rn();break;case 26:case 27:case 5:_i(o);break;case 4:Rn();break;case 31:o.memoizedState!==null&&Wr(o);break;case 13:Wr(o);break;case 19:Xe(Jr);break;case 10:pl(o.type);break;case 22:case 23:Wr(o),Fc(),r!==null&&Xe(Po);break;case 24:pl(as)}}function ad(r,o){try{var g=o.updateQueue,S=g!==null?g.lastEffect:null;if(S!==null){var L=S.next;g=L;do{if((g.tag&r)===r){S=void 0;var U=g.create,ne=g.inst;S=U(),ne.destroy=S}g=g.next}while(g!==L)}}catch(ve){Er(o,o.return,ve)}}function Zc(r,o,g){try{var S=o.updateQueue,L=S!==null?S.lastEffect:null;if(L!==null){var U=L.next;S=U;do{if((S.tag&r)===r){var ne=S.inst,ve=ne.destroy;if(ve!==void 0){ne.destroy=void 0,L=o;var rt=g,Pt=ve;try{Pt()}catch(Kt){Er(L,rt,Kt)}}}S=S.next}while(S!==U)}}catch(Kt){Er(o,o.return,Kt)}}function jm(r){var o=r.updateQueue;if(o!==null){var g=r.stateNode;try{td(o,g)}catch(S){Er(r,r.return,S)}}}function Um(r,o,g){g.props=xc(r.type,r.memoizedProps),g.state=r.memoizedState;try{g.componentWillUnmount()}catch(S){Er(r,o,S)}}function nf(r,o){try{var g=r.ref;if(g!==null){switch(r.tag){case 26:case 27:case 5:var S=r.stateNode;break;case 30:S=r.stateNode;break;default:S=r.stateNode}typeof g=="function"?r.refCleanup=g(S):g.current=S}}catch(L){Er(r,o,L)}}function Go(r,o){var g=r.ref,S=r.refCleanup;if(g!==null)if(typeof S=="function")try{S()}catch(L){Er(r,o,L)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof g=="function")try{g(null)}catch(L){Er(r,o,L)}else g.current=null}function mp(r){var o=r.type,g=r.memoizedProps,S=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":g.autoFocus&&S.focus();break e;case"img":g.src?S.src=g.src:g.srcSet&&(S.srcset=g.srcSet)}}catch(L){Er(r,r.return,L)}}function gp(r,o,g){try{var S=r.stateNode;mg(S,r.type,g,o),S[jt]=o}catch(L){Er(r,r.return,L)}}function Tu(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&ku(r.type)||r.tag===4}function yh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Tu(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&ku(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function T0(r,o,g){var S=r.tag;if(S===5||S===6)r=r.stateNode,o?(g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g).insertBefore(r,o):(o=g.nodeType===9?g.body:g.nodeName==="HTML"?g.ownerDocument.body:g,o.appendChild(r),g=g._reactRootContainer,g!=null||o.onclick!==null||(o.onclick=Fs));else if(S!==4&&(S===27&&ku(r.type)&&(g=r.stateNode,o=null),r=r.child,r!==null))for(T0(r,o,g),r=r.sibling;r!==null;)T0(r,o,g),r=r.sibling}function yp(r,o,g){var S=r.tag;if(S===5||S===6)r=r.stateNode,o?g.insertBefore(r,o):g.appendChild(r);else if(S!==4&&(S===27&&ku(r.type)&&(g=r.stateNode),r=r.child,r!==null))for(yp(r,o,g),r=r.sibling;r!==null;)yp(r,o,g),r=r.sibling}function Vm(r){var o=r.stateNode,g=r.memoizedProps;try{for(var S=r.type,L=o.attributes;L.length;)o.removeAttributeNode(L[0]);ua(o,S,g),o[vi]=r,o[jt]=g}catch(U){Er(r,r.return,U)}}var Xc=!1,Xs=!1,A0=!1,Gm=typeof WeakSet=="function"?WeakSet:Set,Ws=null;function E1(r,o){if(r=r.containerInfo,_f=Mf,r=ce(r),xe(r)){if("selectionStart"in r)var g={start:r.selectionStart,end:r.selectionEnd};else e:{g=(g=r.ownerDocument)&&g.defaultView||window;var S=g.getSelection&&g.getSelection();if(S&&S.rangeCount!==0){g=S.anchorNode;var L=S.anchorOffset,U=S.focusNode;S=S.focusOffset;try{g.nodeType,U.nodeType}catch{g=null;break e}var ne=0,ve=-1,rt=-1,Pt=0,Kt=0,ln=r,Lt=null;t:for(;;){for(var Gt;ln!==g||L!==0&&ln.nodeType!==3||(ve=ne+L),ln!==U||S!==0&&ln.nodeType!==3||(rt=ne+S),ln.nodeType===3&&(ne+=ln.nodeValue.length),(Gt=ln.firstChild)!==null;)Lt=ln,ln=Gt;for(;;){if(ln===r)break t;if(Lt===g&&++Pt===L&&(ve=ne),Lt===U&&++Kt===S&&(rt=ne),(Gt=ln.nextSibling)!==null)break;ln=Lt,Lt=ln.parentNode}ln=Gt}g=ve===-1||rt===-1?null:{start:ve,end:rt}}else g=null}g=g||{start:0,end:0}}else g=null;for(Y0={focusedElem:r,selectionRange:g},Mf=!1,Ws=o;Ws!==null;)if(o=Ws,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,Ws=r;else for(;Ws!==null;){switch(o=Ws,U=o.alternate,r=o.flags,o.tag){case 0:if((r&4)!==0&&(r=o.updateQueue,r=r!==null?r.events:null,r!==null))for(g=0;g<r.length;g++)L=r[g],L.ref.impl=L.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&U!==null){r=void 0,g=o,L=U.memoizedProps,U=U.memoizedState,S=g.stateNode;try{var jn=xc(g.type,L);r=S.getSnapshotBeforeUpdate(jn,U),S.__reactInternalSnapshotBeforeUpdate=r}catch(hi){Er(g,g.return,hi)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,g=r.nodeType,g===9)Jl(r);else if(g===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Jl(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(C(163))}if(r=o.sibling,r!==null){r.return=o.return,Ws=r;break}Ws=o.return}}function C0(r,o,g){var S=g.flags;switch(g.tag){case 0:case 11:case 15:To(r,g),S&4&&ad(5,g);break;case 1:if(To(r,g),S&4)if(r=g.stateNode,o===null)try{r.componentDidMount()}catch(ne){Er(g,g.return,ne)}else{var L=xc(g.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(L,o,r.__reactInternalSnapshotBeforeUpdate)}catch(ne){Er(g,g.return,ne)}}S&64&&jm(g),S&512&&nf(g,g.return);break;case 3:if(To(r,g),S&64&&(r=g.updateQueue,r!==null)){if(o=null,g.child!==null)switch(g.child.tag){case 27:case 5:o=g.child.stateNode;break;case 1:o=g.child.stateNode}try{td(r,o)}catch(ne){Er(g,g.return,ne)}}break;case 27:o===null&&S&4&&Vm(g);case 26:case 5:To(r,g),o===null&&S&4&&mp(g),S&512&&nf(g,g.return);break;case 12:To(r,g);break;case 31:To(r,g),S&4&&rf(r,g);break;case 13:To(r,g),S&4&&sf(r,g),S&64&&(r=g.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(g=B0.bind(null,g),$s(r,g))));break;case 22:if(S=g.memoizedState!==null||Xc,!S){o=o!==null&&o.memoizedState!==null||Xs,L=Xc;var U=Xs;Xc=S,(Xs=o)&&!U?Wc(r,g,(g.subtreeFlags&8772)!==0):To(r,g),Xc=L,Xs=U}break;case 30:break;default:To(r,g)}}function od(r){var o=r.alternate;o!==null&&(r.alternate=null,od(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&Rs(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var ls=null,Ki=!1;function So(r,o,g){for(g=g.child;g!==null;)I0(r,o,g),g=g.sibling}function I0(r,o,g){if(fe&&typeof fe.onCommitFiberUnmount=="function")try{fe.onCommitFiberUnmount(at,g)}catch{}switch(g.tag){case 26:Xs||Go(g,o),So(r,o,g),g.memoizedState?g.memoizedState.count--:g.stateNode&&(g=g.stateNode,g.parentNode.removeChild(g));break;case 27:Xs||Go(g,o);var S=ls,L=Ki;ku(g.type)&&(ls=g.stateNode,Ki=!1),So(r,o,g),bd(g.stateNode),ls=S,Ki=L;break;case 5:Xs||Go(g,o);case 6:if(S=ls,L=Ki,ls=null,So(r,o,g),ls=S,Ki=L,ls!==null)if(Ki)try{(ls.nodeType===9?ls.body:ls.nodeName==="HTML"?ls.ownerDocument.body:ls).removeChild(g.stateNode)}catch(U){Er(g,o,U)}else try{ls.removeChild(g.stateNode)}catch(U){Er(g,o,U)}break;case 18:ls!==null&&(Ki?(r=ls,gg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,g.stateNode),Fu(r)):gg(ls,g.stateNode));break;case 4:S=ls,L=Ki,ls=g.stateNode.containerInfo,Ki=!0,So(r,o,g),ls=S,Ki=L;break;case 0:case 11:case 14:case 15:Zc(2,g,o),Xs||Zc(4,g,o),So(r,o,g);break;case 1:Xs||(Go(g,o),S=g.stateNode,typeof S.componentWillUnmount=="function"&&Um(g,o,S)),So(r,o,g);break;case 21:So(r,o,g);break;case 22:Xs=(S=Xs)||g.memoizedState!==null,So(r,o,g),Xs=S;break;default:So(r,o,g)}}function rf(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Fu(r)}catch(g){Er(o,o.return,g)}}}function sf(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Fu(r)}catch(g){Er(o,o.return,g)}}function af(r){switch(r.tag){case 31:case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new Gm),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new Gm),o;default:throw Error(C(435,r.tag))}}function of(r,o){var g=af(r);o.forEach(function(S){if(!g.has(S)){g.add(S);var L=A1.bind(null,r,S);S.then(L,L)}})}function ao(r,o){var g=o.deletions;if(g!==null)for(var S=0;S<g.length;S++){var L=g[S],U=r,ne=o,ve=ne;e:for(;ve!==null;){switch(ve.tag){case 27:if(ku(ve.type)){ls=ve.stateNode,Ki=!1;break e}break;case 5:ls=ve.stateNode,Ki=!1;break e;case 3:case 4:ls=ve.stateNode.containerInfo,Ki=!0;break e}ve=ve.return}if(ls===null)throw Error(C(160));I0(U,ne,L),ls=null,Ki=!1,U=L.alternate,U!==null&&(U.return=null),L.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)xp(o,r),o=o.sibling}var oo=null;function xp(r,o){var g=r.alternate,S=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ao(o,r),ca(r),S&4&&(Zc(3,r,r.return),ad(3,r),Zc(5,r,r.return));break;case 1:ao(o,r),ca(r),S&512&&(Xs||g===null||Go(g,g.return)),S&64&&Xc&&(r=r.updateQueue,r!==null&&(S=r.callbacks,S!==null&&(g=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=g===null?S:g.concat(S))));break;case 26:var L=oo;if(ao(o,r),ca(r),S&512&&(Xs||g===null||Go(g,g.return)),S&4){var U=g!==null?g.memoizedState:null;if(S=r.memoizedState,g===null)if(S===null)if(r.stateNode===null){e:{S=r.type,g=r.memoizedProps,L=L.ownerDocument||L;t:switch(S){case"title":U=L.getElementsByTagName("title")[0],(!U||U[ai]||U[vi]||U.namespaceURI==="http://www.w3.org/2000/svg"||U.hasAttribute("itemprop"))&&(U=L.createElement(S),L.head.insertBefore(U,L.querySelector("head > title"))),ua(U,S,g),U[vi]=r,dr(U),S=U;break e;case"link":var ne=lm("link","href",L).get(S+(g.href||""));if(ne){for(var ve=0;ve<ne.length;ve++)if(U=ne[ve],U.getAttribute("href")===(g.href==null||g.href===""?null:g.href)&&U.getAttribute("rel")===(g.rel==null?null:g.rel)&&U.getAttribute("title")===(g.title==null?null:g.title)&&U.getAttribute("crossorigin")===(g.crossOrigin==null?null:g.crossOrigin)){ne.splice(ve,1);break t}}U=L.createElement(S),ua(U,S,g),L.head.appendChild(U);break;case"meta":if(ne=lm("meta","content",L).get(S+(g.content||""))){for(ve=0;ve<ne.length;ve++)if(U=ne[ve],U.getAttribute("content")===(g.content==null?null:""+g.content)&&U.getAttribute("name")===(g.name==null?null:g.name)&&U.getAttribute("property")===(g.property==null?null:g.property)&&U.getAttribute("http-equiv")===(g.httpEquiv==null?null:g.httpEquiv)&&U.getAttribute("charset")===(g.charSet==null?null:g.charSet)){ne.splice(ve,1);break t}}U=L.createElement(S),ua(U,S,g),L.head.appendChild(U);break;default:throw Error(C(468,S))}U[vi]=r,dr(U),S=U}r.stateNode=S}else Ef(L,r.type,r.stateNode);else r.stateNode=om(L,S,r.memoizedProps);else U!==S?(U===null?g.stateNode!==null&&(g=g.stateNode,g.parentNode.removeChild(g)):U.count--,S===null?Ef(L,r.type,r.stateNode):om(L,S,r.memoizedProps)):S===null&&r.stateNode!==null&&gp(r,r.memoizedProps,g.memoizedProps)}break;case 27:ao(o,r),ca(r),S&512&&(Xs||g===null||Go(g,g.return)),g!==null&&S&4&&gp(r,r.memoizedProps,g.memoizedProps);break;case 5:if(ao(o,r),ca(r),S&512&&(Xs||g===null||Go(g,g.return)),r.flags&32){L=r.stateNode;try{Da(L,"")}catch(jn){Er(r,r.return,jn)}}S&4&&r.stateNode!=null&&(L=r.memoizedProps,gp(r,L,g!==null?g.memoizedProps:L)),S&1024&&(A0=!0);break;case 6:if(ao(o,r),ca(r),S&4){if(r.stateNode===null)throw Error(C(162));S=r.memoizedProps,g=r.stateNode;try{g.nodeValue=S}catch(jn){Er(r,r.return,jn)}}break;case 3:if(Zp=null,L=oo,oo=Gp(o.containerInfo),ao(o,r),oo=L,ca(r),S&4&&g!==null&&g.memoizedState.isDehydrated)try{Fu(o.containerInfo)}catch(jn){Er(r,r.return,jn)}A0&&(A0=!1,lf(r));break;case 4:S=oo,oo=Gp(r.stateNode.containerInfo),ao(o,r),ca(r),oo=S;break;case 12:ao(o,r),ca(r);break;case 31:ao(o,r),ca(r),S&4&&(S=r.updateQueue,S!==null&&(r.updateQueue=null,of(r,S)));break;case 13:ao(o,r),ca(r),r.child.flags&8192&&r.memoizedState!==null!=(g!==null&&g.memoizedState!==null)&&(vp=fi()),S&4&&(S=r.updateQueue,S!==null&&(r.updateQueue=null,of(r,S)));break;case 22:L=r.memoizedState!==null;var rt=g!==null&&g.memoizedState!==null,Pt=Xc,Kt=Xs;if(Xc=Pt||L,Xs=Kt||rt,ao(o,r),Xs=Kt,Xc=Pt,ca(r),S&8192)e:for(o=r.stateNode,o._visibility=L?o._visibility&-2:o._visibility|1,L&&(g===null||rt||Xc||Xs||$l(r)),g=null,o=r;;){if(o.tag===5||o.tag===26){if(g===null){rt=g=o;try{if(U=rt.stateNode,L)ne=U.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{ve=rt.stateNode;var ln=rt.memoizedProps.style,Lt=ln!=null&&ln.hasOwnProperty("display")?ln.display:null;ve.style.display=Lt==null||typeof Lt=="boolean"?"":(""+Lt).trim()}}catch(jn){Er(rt,rt.return,jn)}}}else if(o.tag===6){if(g===null){rt=o;try{rt.stateNode.nodeValue=L?"":rt.memoizedProps}catch(jn){Er(rt,rt.return,jn)}}}else if(o.tag===18){if(g===null){rt=o;try{var Gt=rt.stateNode;L?Ri(Gt,!0):Ri(rt.stateNode,!1)}catch(jn){Er(rt,rt.return,jn)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;g===o&&(g=null),o=o.return}g===o&&(g=null),o.sibling.return=o.return,o=o.sibling}S&4&&(S=r.updateQueue,S!==null&&(g=S.retryQueue,g!==null&&(S.retryQueue=null,of(r,g))));break;case 19:ao(o,r),ca(r),S&4&&(S=r.updateQueue,S!==null&&(r.updateQueue=null,of(r,S)));break;case 30:break;case 21:break;default:ao(o,r),ca(r)}}function ca(r){var o=r.flags;if(o&2){try{for(var g,S=r.return;S!==null;){if(Tu(S)){g=S;break}S=S.return}if(g==null)throw Error(C(160));switch(g.tag){case 27:var L=g.stateNode,U=yh(r);yp(r,U,L);break;case 5:var ne=g.stateNode;g.flags&32&&(Da(ne,""),g.flags&=-33);var ve=yh(r);yp(r,ve,ne);break;case 3:case 4:var rt=g.stateNode.containerInfo,Pt=yh(r);T0(r,Pt,rt);break;default:throw Error(C(161))}}catch(Kt){Er(r,r.return,Kt)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function lf(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;lf(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function To(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)C0(r,o.alternate,o),o=o.sibling}function $l(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:Zc(4,o,o.return),$l(o);break;case 1:Go(o,o.return);var g=o.stateNode;typeof g.componentWillUnmount=="function"&&Um(o,o.return,g),$l(o);break;case 27:bd(o.stateNode);case 26:case 5:Go(o,o.return),$l(o);break;case 22:o.memoizedState===null&&$l(o);break;case 30:$l(o);break;default:$l(o)}r=r.sibling}}function Wc(r,o,g){for(g=g&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var S=o.alternate,L=r,U=o,ne=U.flags;switch(U.tag){case 0:case 11:case 15:Wc(L,U,g),ad(4,U);break;case 1:if(Wc(L,U,g),S=U,L=S.stateNode,typeof L.componentDidMount=="function")try{L.componentDidMount()}catch(Pt){Er(S,S.return,Pt)}if(S=U,L=S.updateQueue,L!==null){var ve=S.stateNode;try{var rt=L.shared.hiddenCallbacks;if(rt!==null)for(L.shared.hiddenCallbacks=null,L=0;L<rt.length;L++)oh(rt[L],ve)}catch(Pt){Er(S,S.return,Pt)}}g&&ne&64&&jm(U),nf(U,U.return);break;case 27:Vm(U);case 26:case 5:Wc(L,U,g),g&&S===null&&ne&4&&mp(U),nf(U,U.return);break;case 12:Wc(L,U,g);break;case 31:Wc(L,U,g),g&&ne&4&&rf(L,U);break;case 13:Wc(L,U,g),g&&ne&4&&sf(L,U);break;case 22:U.memoizedState===null&&Wc(L,U,g),nf(U,U.return);break;case 30:break;default:Wc(L,U,g)}o=o.sibling}}function _p(r,o){var g=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(g=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==g&&(r!=null&&r.refCount++,g!=null&&yu(g))}function Yc(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&yu(r))}function Kl(r,o,g,S){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)M0(r,o,g,S),o=o.sibling}function M0(r,o,g,S){var L=o.flags;switch(o.tag){case 0:case 11:case 15:Kl(r,o,g,S),L&2048&&ad(9,o);break;case 1:Kl(r,o,g,S);break;case 3:Kl(r,o,g,S),L&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&yu(r)));break;case 12:if(L&2048){Kl(r,o,g,S),r=o.stateNode;try{var U=o.memoizedProps,ne=U.id,ve=U.onPostCommit;typeof ve=="function"&&ve(ne,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(rt){Er(o,o.return,rt)}}else Kl(r,o,g,S);break;case 31:Kl(r,o,g,S);break;case 13:Kl(r,o,g,S);break;case 23:break;case 22:U=o.stateNode,ne=o.alternate,o.memoizedState!==null?U._visibility&2?Kl(r,o,g,S):xh(r,o):U._visibility&2?Kl(r,o,g,S):(U._visibility|=2,wc(r,o,g,S,(o.subtreeFlags&10256)!==0||!1)),L&2048&&_p(ne,o);break;case 24:Kl(r,o,g,S),L&2048&&Yc(o.alternate,o);break;default:Kl(r,o,g,S)}}function wc(r,o,g,S,L){for(L=L&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var U=r,ne=o,ve=g,rt=S,Pt=ne.flags;switch(ne.tag){case 0:case 11:case 15:wc(U,ne,ve,rt,L),ad(8,ne);break;case 23:break;case 22:var Kt=ne.stateNode;ne.memoizedState!==null?Kt._visibility&2?wc(U,ne,ve,rt,L):xh(U,ne):(Kt._visibility|=2,wc(U,ne,ve,rt,L)),L&&Pt&2048&&_p(ne.alternate,ne);break;case 24:wc(U,ne,ve,rt,L),L&&Pt&2048&&Yc(ne.alternate,ne);break;default:wc(U,ne,ve,rt,L)}o=o.sibling}}function xh(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var g=r,S=o,L=S.flags;switch(S.tag){case 22:xh(g,S),L&2048&&_p(S.alternate,S);break;case 24:xh(g,S),L&2048&&Yc(S.alternate,S);break;default:xh(g,S)}o=o.sibling}}var ld=8192;function _h(r,o,g){if(r.subtreeFlags&ld)for(r=r.child;r!==null;)Hm(r,o,g),r=r.sibling}function Hm(r,o,g){switch(r.tag){case 26:_h(r,o,g),r.flags&ld&&r.memoizedState!==null&&cm(g,oo,r.memoizedState,r.memoizedProps);break;case 5:_h(r,o,g);break;case 3:case 4:var S=oo;oo=Gp(r.stateNode.containerInfo),_h(r,o,g),oo=S;break;case 22:r.memoizedState===null&&(S=r.alternate,S!==null&&S.memoizedState!==null?(S=ld,ld=16777216,_h(r,o,g),ld=S):_h(r,o,g));break;default:_h(r,o,g)}}function qm(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function cf(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var g=0;g<o.length;g++){var S=o[g];Ws=S,cd(S,r)}qm(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Zm(r),r=r.sibling}function Zm(r){switch(r.tag){case 0:case 11:case 15:cf(r),r.flags&2048&&Zc(9,r,r.return);break;case 3:cf(r);break;case 12:cf(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,bp(r)):cf(r);break;default:cf(r)}}function bp(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var g=0;g<o.length;g++){var S=o[g];Ws=S,cd(S,r)}qm(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:Zc(8,o,o.return),bp(o);break;case 22:g=o.stateNode,g._visibility&2&&(g._visibility&=-3,bp(o));break;default:bp(o)}r=r.sibling}}function cd(r,o){for(;Ws!==null;){var g=Ws;switch(g.tag){case 0:case 11:case 15:Zc(8,g,o);break;case 23:case 22:if(g.memoizedState!==null&&g.memoizedState.cachePool!==null){var S=g.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:yu(g.memoizedState.cache)}if(S=g.child,S!==null)S.return=g,Ws=S;else e:for(g=r;Ws!==null;){S=Ws;var L=S.sibling,U=S.return;if(od(S),S===g){Ws=null;break e}if(L!==null){L.return=U,Ws=L;break e}Ws=U}}}var S1={getCacheForType:function(r){var o=ps(as),g=o.data.get(r);return g===void 0&&(g=r(),o.data.set(r,g)),g},cacheSignal:function(){return ps(as).controller.signal}},Xm=typeof WeakMap=="function"?WeakMap:Map,wr=0,qr=null,Zi=null,Xi=0,Pr=0,lo=null,Sl=!1,Au=!1,R0=!1,$c=0,gs=0,Kc=0,bh=0,D0=0,Ia=0,vh=0,uf=null,Ao=null,N0=!1,vp=0,Wm=0,hf=1/0,ud=null,Qc=null,Ys=0,Jc=null,hd=null,Tl=0,k0=0,wp=null,Ym=null,df=0,P0=null;function Co(){return(wr&2)!==0&&Xi!==0?Xi&-Xi:Se.T!==null?G0():xi()}function $m(){if(Ia===0)if((Xi&536870912)===0||Li){var r=Ot;Ot<<=1,(Ot&3932160)===0&&(Ot=262144),Ia=r}else Ia=536870912;return r=Dn.current,r!==null&&(r.flags|=32),Ia}function Io(r,o,g){(r===qr&&(Pr===2||Pr===9)||r.cancelPendingCommit!==null)&&(fd(r,0),Cu(r,Xi,Ia,!1)),Yn(r,g),((wr&2)===0||r!==qr)&&(r===qr&&((wr&2)===0&&(bh|=g),gs===4&&Cu(r,Xi,Ia,!1)),Ql(r))}function Ls(r,o,g){if((wr&6)!==0)throw Error(C(327));var S=!g&&(o&127)===0&&(o&r.expiredLanes)===0||Fn(r,o),L=S?pd(r,o):Tp(r,o,!0),U=S;do{if(L===0){Au&&!S&&Cu(r,o,0,!1);break}else{if(g=r.current.alternate,U&&!T1(g)){L=Tp(r,o,!1),U=!1;continue}if(L===2){if(U=o,r.errorRecoveryDisabledLanes&U)var ne=0;else ne=r.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){o=ne;e:{var ve=r;L=uf;var rt=ve.current.memoizedState.isDehydrated;if(rt&&(fd(ve,ne).flags|=256),ne=Tp(ve,ne,!1),ne!==2){if(R0&&!rt){ve.errorRecoveryDisabledLanes|=U,bh|=U,L=4;break e}U=Ao,Ao=L,U!==null&&(Ao===null?Ao=U:Ao.push.apply(Ao,U))}L=ne}if(U=!1,L!==2)continue}}if(L===1){fd(r,0),Cu(r,o,0,!0);break}e:{switch(S=r,U=L,U){case 0:case 1:throw Error(C(345));case 4:if((o&4194048)!==o)break;case 6:Cu(S,o,Ia,!Sl);break e;case 2:Ao=null;break;case 3:case 5:break;default:throw Error(C(329))}if((o&62914560)===o&&(L=vp+300-fi(),10<L)){if(Cu(S,o,Ia,!Sl),kn(S,0,!0)!==0)break e;Tl=o,S.timeoutHandle=Vp(dd.bind(null,S,g,Ao,ud,N0,o,Ia,bh,vh,Sl,U,"Throttled",-0,0),L);break e}dd(S,g,Ao,ud,N0,o,Ia,bh,vh,Sl,U,null,-0,0)}}break}while(!0);Ql(r)}function dd(r,o,g,S,L,U,ne,ve,rt,Pt,Kt,ln,Lt,Gt){if(r.timeoutHandle=-1,ln=o.subtreeFlags,ln&8192||(ln&16785408)===16785408){ln={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fs},Hm(o,U,ln);var jn=(U&62914560)===U?vp-fi():(U&4194048)===U?Wm-fi():0;if(jn=um(ln,jn),jn!==null){Tl=U,r.cancelPendingCommit=jn(tg.bind(null,r,o,U,g,S,L,ne,ve,rt,Kt,ln,null,Lt,Gt)),Cu(r,U,ne,!Pt);return}}tg(r,o,U,g,S,L,ne,ve,rt)}function T1(r){for(var o=r;;){var g=o.tag;if((g===0||g===11||g===15)&&o.flags&16384&&(g=o.updateQueue,g!==null&&(g=g.stores,g!==null)))for(var S=0;S<g.length;S++){var L=g[S],U=L.getSnapshot;L=L.value;try{if(!I(U(),L))return!1}catch{return!1}}if(g=o.child,o.subtreeFlags&16384&&g!==null)g.return=o,o=g;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Cu(r,o,g,S){o&=~D0,o&=~bh,r.suspendedLanes|=o,r.pingedLanes&=~o,S&&(r.warmLanes|=o),S=r.expirationTimes;for(var L=o;0<L;){var U=31-Me(L),ne=1<<U;S[U]=-1,L&=~ne}g!==0&&Jt(r,g,o)}function ff(){return(wr&6)===0?(Ho(0),!1):!0}function Ep(){if(Zi!==null){if(Pr===0)var r=Zi.return;else r=Zi,fl=yo=null,Xl(r),gl=null,Lc=0,r=Zi;for(;r!==null;)pp(r.alternate,r),r=r.return;Zi=null}}function fd(r,o){var g=r.timeoutHandle;g!==-1&&(r.timeoutHandle=-1,K0(g)),g=r.cancelPendingCommit,g!==null&&(r.cancelPendingCommit=null,g()),Tl=0,Ep(),qr=r,Zi=g=eo(r.current,null),Xi=o,Pr=0,lo=null,Sl=!1,Au=Fn(r,o),R0=!1,vh=Ia=D0=bh=Kc=gs=0,Ao=uf=null,N0=!1,(o&8)!==0&&(o|=o&32);var S=r.entangledLanes;if(S!==0)for(r=r.entanglements,S&=o;0<S;){var L=31-Me(S),U=1<<L;o|=r[L],S&=~U}return $c=o,kc(),g}function O0(r,o){Ii=null,Se.H=ur,o===Oo||o===La?(o=_u(),Pr=3):o===pc?(o=_u(),Pr=4):Pr=o===sp?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,lo=o,Zi===null&&(gs=1,Vo(r,Ca(o,r.current)))}function z0(){var r=Dn.current;return r===null?!0:(Xi&4194048)===Xi?Ln===null:(Xi&62914560)===Xi||(Xi&536870912)!==0?r===Ln:!1}function wh(){var r=Se.H;return Se.H=ur,r===null?ur:r}function Sp(){var r=Se.A;return Se.A=S1,r}function pf(){gs=4,Sl||(Xi&4194048)!==Xi&&Dn.current!==null||(Au=!0),(Kc&134217727)===0&&(bh&134217727)===0||qr===null||Cu(qr,Xi,Ia,!1)}function Tp(r,o,g){var S=wr;wr|=2;var L=wh(),U=Sp();(qr!==r||Xi!==o)&&(ud=null,fd(r,o)),o=!1;var ne=gs;e:do try{if(Pr!==0&&Zi!==null){var ve=Zi,rt=lo;switch(Pr){case 8:Ep(),ne=6;break e;case 3:case 2:case 9:case 6:Dn.current===null&&(o=!0);var Pt=Pr;if(Pr=0,lo=null,md(r,ve,rt,Pt),g&&Au){ne=0;break e}break;default:Pt=Pr,Pr=0,lo=null,md(r,ve,rt,Pt)}}Ap(),ne=gs;break}catch(Kt){O0(r,Kt)}while(!0);return o&&r.shellSuspendCounter++,fl=yo=null,wr=S,Se.H=L,Se.A=U,Zi===null&&(qr=null,Xi=0,kc()),ne}function Ap(){for(;Zi!==null;)Qm(Zi)}function pd(r,o){var g=wr;wr|=2;var S=wh(),L=Sp();qr!==r||Xi!==o?(ud=null,hf=fi()+500,fd(r,o)):Au=Fn(r,o);e:do try{if(Pr!==0&&Zi!==null){o=Zi;var U=lo;t:switch(Pr){case 1:Pr=0,lo=null,md(r,o,U,1);break;case 2:case 9:if(ih(U)){Pr=0,lo=null,Jm(o);break}o=function(){Pr!==2&&Pr!==9||qr!==r||(Pr=7),Ql(r)},U.then(o,o);break e;case 3:Pr=7;break e;case 4:Pr=5;break e;case 7:ih(U)?(Pr=0,lo=null,Jm(o)):(Pr=0,lo=null,md(r,o,U,7));break;case 5:var ne=null;switch(Zi.tag){case 26:ne=Zi.memoizedState;case 5:case 27:var ve=Zi;if(ne?Sf(ne):ve.stateNode.complete){Pr=0,lo=null;var rt=ve.sibling;if(rt!==null)Zi=rt;else{var Pt=ve.return;Pt!==null?(Zi=Pt,Cp(Pt)):Zi=null}break t}}Pr=0,lo=null,md(r,o,U,5);break;case 6:Pr=0,lo=null,md(r,o,U,6);break;case 8:Ep(),gs=6;break e;default:throw Error(C(462))}}Km();break}catch(Kt){O0(r,Kt)}while(!0);return fl=yo=null,Se.H=S,Se.A=L,wr=g,Zi!==null?0:(qr=null,Xi=0,kc(),gs)}function Km(){for(;Zi!==null&&!Zn();)Qm(Zi)}function Qm(r){var o=ja(r.alternate,r,$c);r.memoizedProps=r.pendingProps,o===null?Cp(r):Zi=o}function Jm(r){var o=r,g=o.alternate;switch(o.tag){case 15:case 0:o=Om(g,o,o.pendingProps,o.type,void 0,Xi);break;case 11:o=Om(g,o,o.pendingProps,o.type.render,o.ref,Xi);break;case 5:Xl(o);default:pp(g,o),o=Zi=ep(o,$c),o=ja(g,o,$c)}r.memoizedProps=r.pendingProps,o===null?Cp(r):Zi=o}function md(r,o,g,S){fl=yo=null,Xl(o),gl=null,Lc=0;var L=o.return;try{if(rp(r,L,o,g,Xi)){gs=1,Vo(r,Ca(g,r.current)),Zi=null;return}}catch(U){if(L!==null)throw Zi=L,U;gs=1,Vo(r,Ca(g,r.current)),Zi=null;return}o.flags&32768?(Li||S===1?r=!0:Au||(Xi&536870912)!==0?r=!1:(Sl=r=!0,(S===2||S===9||S===3||S===6)&&(S=Dn.current,S!==null&&S.tag===13&&(S.flags|=16384))),eg(o,r)):Cp(o)}function Cp(r){var o=r;do{if((o.flags&32768)!==0){eg(o,Sl);return}r=o.return;var g=Fm(o.alternate,o,$c);if(g!==null){Zi=g;return}if(o=o.sibling,o!==null){Zi=o;return}Zi=o=r}while(o!==null);gs===0&&(gs=5)}function eg(r,o){do{var g=w1(r.alternate,r);if(g!==null){g.flags&=32767,Zi=g;return}if(g=r.return,g!==null&&(g.flags|=32768,g.subtreeFlags=0,g.deletions=null),!o&&(r=r.sibling,r!==null)){Zi=r;return}Zi=r=g}while(r!==null);gs=6,Zi=null}function tg(r,o,g,S,L,U,ne,ve,rt){r.cancelPendingCommit=null;do Ip();while(Ys!==0);if((wr&6)!==0)throw Error(C(327));if(o!==null){if(o===r.current)throw Error(C(177));if(U=o.lanes|o.childLanes,U|=Nc,nn(r,g,U,ne,ve,rt),r===qr&&(Zi=qr=null,Xi=0),hd=o,Jc=r,Tl=g,k0=U,wp=L,Ym=S,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,og(ue,function(){return ag(),null})):(r.callbackNode=null,r.callbackPriority=0),S=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||S){S=Se.T,Se.T=null,L=je.p,je.p=2,ne=wr,wr|=4;try{E1(r,o,g)}finally{wr=ne,je.p=L,Se.T=S}}Ys=1,ng(),ig(),rg()}}function ng(){if(Ys===1){Ys=0;var r=Jc,o=hd,g=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||g){g=Se.T,Se.T=null;var S=je.p;je.p=2;var L=wr;wr|=4;try{xp(o,r);var U=Y0,ne=ce(r.containerInfo),ve=U.focusedElem,rt=U.selectionRange;if(ne!==ve&&ve&&ve.ownerDocument&&te(ve.ownerDocument.documentElement,ve)){if(rt!==null&&xe(ve)){var Pt=rt.start,Kt=rt.end;if(Kt===void 0&&(Kt=Pt),"selectionStart"in ve)ve.selectionStart=Pt,ve.selectionEnd=Math.min(Kt,ve.value.length);else{var ln=ve.ownerDocument||document,Lt=ln&&ln.defaultView||window;if(Lt.getSelection){var Gt=Lt.getSelection(),jn=ve.textContent.length,hi=Math.min(rt.start,jn),Or=rt.end===void 0?hi:Math.min(rt.end,jn);!Gt.extend&&hi>Or&&(ne=Or,Or=hi,hi=ne);var _t=q(ve,hi),ht=q(ve,Or);if(_t&&ht&&(Gt.rangeCount!==1||Gt.anchorNode!==_t.node||Gt.anchorOffset!==_t.offset||Gt.focusNode!==ht.node||Gt.focusOffset!==ht.offset)){var Dt=ln.createRange();Dt.setStart(_t.node,_t.offset),Gt.removeAllRanges(),hi>Or?(Gt.addRange(Dt),Gt.extend(ht.node,ht.offset)):(Dt.setEnd(ht.node,ht.offset),Gt.addRange(Dt))}}}}for(ln=[],Gt=ve;Gt=Gt.parentNode;)Gt.nodeType===1&&ln.push({element:Gt,left:Gt.scrollLeft,top:Gt.scrollTop});for(typeof ve.focus=="function"&&ve.focus(),ve=0;ve<ln.length;ve++){var rn=ln[ve];rn.element.scrollLeft=rn.left,rn.element.scrollTop=rn.top}}Mf=!!_f,Y0=_f=null}finally{wr=L,je.p=S,Se.T=g}}r.current=o,Ys=2}}function ig(){if(Ys===2){Ys=0;var r=Jc,o=hd,g=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||g){g=Se.T,Se.T=null;var S=je.p;je.p=2;var L=wr;wr|=4;try{C0(r,o.alternate,o)}finally{wr=L,je.p=S,Se.T=g}}Ys=3}}function rg(){if(Ys===4||Ys===3){Ys=0,Yi();var r=Jc,o=hd,g=Tl,S=Ym;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Ys=5:(Ys=0,hd=Jc=null,sg(r,r.pendingLanes));var L=r.pendingLanes;if(L===0&&(Qc=null),Zt(g),o=o.stateNode,fe&&typeof fe.onCommitFiberRoot=="function")try{fe.onCommitFiberRoot(at,o,void 0,(o.current.flags&128)===128)}catch{}if(S!==null){o=Se.T,L=je.p,je.p=2,Se.T=null;try{for(var U=r.onRecoverableError,ne=0;ne<S.length;ne++){var ve=S[ne];U(ve.value,{componentStack:ve.stack})}}finally{Se.T=o,je.p=L}}(Tl&3)!==0&&Ip(),Ql(r),L=r.pendingLanes,(g&261930)!==0&&(L&42)!==0?r===P0?df++:(df=0,P0=r):df=0,Ho(0)}}function sg(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,yu(o)))}function Ip(){return ng(),ig(),rg(),ag()}function ag(){if(Ys!==5)return!1;var r=Jc,o=k0;k0=0;var g=Zt(Tl),S=Se.T,L=je.p;try{je.p=32>g?32:g,Se.T=null,g=wp,wp=null;var U=Jc,ne=Tl;if(Ys=0,hd=Jc=null,Tl=0,(wr&6)!==0)throw Error(C(331));var ve=wr;if(wr|=4,Zm(U.current),M0(U,U.current,ne,g),wr=ve,Ho(0,!1),fe&&typeof fe.onPostCommitFiberRoot=="function")try{fe.onPostCommitFiberRoot(at,U)}catch{}return!0}finally{je.p=L,Se.T=S,sg(r,o)}}function L0(r,o,g){o=Ca(g,o),o=ph(r.stateNode,o,2),r=Gl(r,o,2),r!==null&&(Yn(r,2),Ql(r))}function Er(r,o,g){if(r.tag===3)L0(r,r,g);else for(;o!==null;){if(o.tag===3){L0(o,r,g);break}else if(o.tag===1){var S=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Qc===null||!Qc.has(S))){r=Ca(g,r),g=mh(2),S=Gl(o,g,2),S!==null&&(gh(g,S,o,r),Yn(S,2),Ql(S));break}}o=o.return}}function Mp(r,o,g){var S=r.pingCache;if(S===null){S=r.pingCache=new Xm;var L=new Set;S.set(o,L)}else L=S.get(o),L===void 0&&(L=new Set,S.set(o,L));L.has(g)||(R0=!0,L.add(g),r=Iu.bind(null,r,o,g),o.then(r,r))}function Iu(r,o,g){var S=r.pingCache;S!==null&&S.delete(o),r.pingedLanes|=r.suspendedLanes&g,r.warmLanes&=~g,qr===r&&(Xi&g)===g&&(gs===4||gs===3&&(Xi&62914560)===Xi&&300>fi()-vp?(wr&2)===0&&fd(r,0):D0|=g,vh===Xi&&(vh=0)),Ql(r)}function mf(r,o){o===0&&(o=_n()),r=go(r,o),r!==null&&(Yn(r,o),Ql(r))}function B0(r){var o=r.memoizedState,g=0;o!==null&&(g=o.retryLane),mf(r,g)}function A1(r,o){var g=0;switch(r.tag){case 31:case 13:var S=r.stateNode,L=r.memoizedState;L!==null&&(g=L.retryLane);break;case 19:S=r.stateNode;break;case 22:S=r.stateNode._retryCache;break;default:throw Error(C(314))}S!==null&&S.delete(o),mf(r,g)}function og(r,o){return di(r,o)}var Rp=null,gd=null,F0=!1,Dp=!1,j0=!1,eu=0;function Ql(r){r!==gd&&r.next===null&&(gd===null?Rp=gd=r:gd=gd.next=r),Dp=!0,F0||(F0=!0,V0())}function Ho(r,o){if(!j0&&Dp){j0=!0;do for(var g=!1,S=Rp;S!==null;){if(r!==0){var L=S.pendingLanes;if(L===0)var U=0;else{var ne=S.suspendedLanes,ve=S.pingedLanes;U=(1<<31-Me(42|r)+1)-1,U&=L&~(ne&~ve),U=U&201326741?U&201326741|1:U?U|2:0}U!==0&&(g=!0,gf(S,U))}else U=Xi,U=kn(S,S===qr?U:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(U&3)===0||Fn(S,U)||(g=!0,gf(S,U));S=S.next}while(g);j0=!1}}function Mu(){U0()}function U0(){Dp=F0=!1;var r=0;eu!==0&&Up()&&(r=eu);for(var o=fi(),g=null,S=Rp;S!==null;){var L=S.next,U=Np(S,o);U===0?(S.next=null,g===null?Rp=L:g.next=L,L===null&&(gd=g)):(g=S,(r!==0||(U&3)!==0)&&(Dp=!0)),S=L}Ys!==0&&Ys!==5||Ho(r),eu!==0&&(eu=0)}function Np(r,o){for(var g=r.suspendedLanes,S=r.pingedLanes,L=r.expirationTimes,U=r.pendingLanes&-62914561;0<U;){var ne=31-Me(U),ve=1<<ne,rt=L[ne];rt===-1?((ve&g)===0||(ve&S)!==0)&&(L[ne]=wn(ve,o)):rt<=o&&(r.expiredLanes|=ve),U&=~ve}if(o=qr,g=Xi,g=kn(r,r===o?g:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),S=r.callbackNode,g===0||r===o&&(Pr===2||Pr===9)||r.cancelPendingCommit!==null)return S!==null&&S!==null&&gn(S),r.callbackNode=null,r.callbackPriority=0;if((g&3)===0||Fn(r,g)){if(o=g&-g,o===r.callbackPriority)return o;switch(S!==null&&gn(S),Zt(g)){case 2:case 8:g=oe;break;case 32:g=ue;break;case 268435456:g=qe;break;default:g=ue}return S=lg.bind(null,r),g=di(g,S),r.callbackPriority=o,r.callbackNode=g,o}return S!==null&&S!==null&&gn(S),r.callbackPriority=2,r.callbackNode=null,2}function lg(r,o){if(Ys!==0&&Ys!==5)return r.callbackNode=null,r.callbackPriority=0,null;var g=r.callbackNode;if(Ip()&&r.callbackNode!==g)return null;var S=Xi;return S=kn(r,r===qr?S:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),S===0?null:(Ls(r,S,o),Np(r,fi()),r.callbackNode!=null&&r.callbackNode===g?lg.bind(null,r):null)}function gf(r,o){if(Ip())return null;Ls(r,o,!0)}function V0(){J0(function(){(wr&6)!==0?di(ct,Mu):U0()})}function G0(){if(eu===0){var r=zc;r===0&&(r=qt,qt<<=1,(qt&261888)===0&&(qt=256)),eu=r}return eu}function kp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:ui(""+r)}function Pp(r,o){var g=o.ownerDocument.createElement("input");return g.name=o.name,g.value=o.value,r.id&&g.setAttribute("form",r.id),o.parentNode.insertBefore(g,o),r=new FormData(r),g.parentNode.removeChild(g),r}function yd(r,o,g,S,L){if(o==="submit"&&g&&g.stateNode===L){var U=kp((L[jt]||null).action),ne=S.submitter;ne&&(o=(o=ne[jt]||null)?kp(o.formAction):ne.getAttribute("formAction"),o!==null&&(U=o,ne=null));var ve=new Ss("action","action",null,S,L);r.push({event:ve,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(eu!==0){var rt=ne?Pp(L,ne):new FormData(L);es(g,{pending:!0,data:rt,method:L.method,action:U},null,rt)}}else typeof U=="function"&&(ve.preventDefault(),rt=ne?Pp(L,ne):new FormData(L),es(g,{pending:!0,data:rt,method:L.method,action:U},U,rt))},currentTarget:L}]})}}for(var Op=0;Op<du.length;Op++){var zp=du[Op],H0=zp.toLowerCase(),cg=zp[0].toUpperCase()+zp.slice(1);Qa(H0,"on"+cg)}Qa(aa,"onAnimationEnd"),Qa(Ts,"onAnimationIteration"),Qa(rr,"onAnimationStart"),Qa("dblclick","onDoubleClick"),Qa("focusin","onFocus"),Qa("focusout","onBlur"),Qa(Vr,"onTransitionRun"),Qa(Ps,"onTransitionStart"),Qa(Ka,"onTransitionCancel"),Qa(As,"onTransitionEnd"),hs("onMouseEnter",["mouseout","mouseover"]),hs("onMouseLeave",["mouseout","mouseover"]),hs("onPointerEnter",["pointerout","pointerover"]),hs("onPointerLeave",["pointerout","pointerover"]),Hn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Hn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Hn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Hn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Hn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Hn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ru="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ug=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ru));function hg(r,o){o=(o&4)!==0;for(var g=0;g<r.length;g++){var S=r[g],L=S.event;S=S.listeners;e:{var U=void 0;if(o)for(var ne=S.length-1;0<=ne;ne--){var ve=S[ne],rt=ve.instance,Pt=ve.currentTarget;if(ve=ve.listener,rt!==U&&L.isPropagationStopped())break e;U=ve,L.currentTarget=Pt;try{U(L)}catch(Kt){ol(Kt)}L.currentTarget=null,U=rt}else for(ne=0;ne<S.length;ne++){if(ve=S[ne],rt=ve.instance,Pt=ve.currentTarget,ve=ve.listener,rt!==U&&L.isPropagationStopped())break e;U=ve,L.currentTarget=Pt;try{U(L)}catch(Kt){ol(Kt)}L.currentTarget=null,U=rt}}}}function Wi(r,o){var g=o[ni];g===void 0&&(g=o[ni]=new Set);var S=r+"__bubble";g.has(S)||(Bp(o,r,2,!1),g.add(S))}function q0(r,o,g){var S=0;o&&(S|=4),Bp(g,r,S,o)}var Lp="_reactListening"+Math.random().toString(36).slice(2);function Z0(r){if(!r[Lp]){r[Lp]=!0,an.forEach(function(g){g!=="selectionchange"&&(ug.has(g)||q0(g,!1,r),q0(g,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[Lp]||(o[Lp]=!0,q0("selectionchange",!1,o))}}function Bp(r,o,g,S){switch(Th(o)){case 2:var L=Rf;break;case 8:L=Tg;break;default:L=dm}g=L.bind(null,o,g,r),L=void 0,!ra||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(L=!0),S?L!==void 0?r.addEventListener(o,g,{capture:!0,passive:L}):r.addEventListener(o,g,!0):L!==void 0?r.addEventListener(o,g,{passive:L}):r.addEventListener(o,g,!1)}function Ec(r,o,g,S,L){var U=S;if((o&1)===0&&(o&2)===0&&S!==null)e:for(;;){if(S===null)return;var ne=S.tag;if(ne===3||ne===4){var ve=S.stateNode.containerInfo;if(ve===L)break;if(ne===4)for(ne=S.return;ne!==null;){var rt=ne.tag;if((rt===3||rt===4)&&ne.stateNode.containerInfo===L)return;ne=ne.return}for(;ve!==null;){if(ne=Sr(ve),ne===null)return;if(rt=ne.tag,rt===5||rt===6||rt===26||rt===27){S=U=ne;continue e}ve=ve.parentNode}}S=S.return}lr(function(){var Pt=U,Kt=Ko(g),ln=[];e:{var Lt=Qu.get(r);if(Lt!==void 0){var Gt=Ss,jn=r;switch(r){case"keypress":if(Ns(g)===0)break e;case"keydown":case"keyup":Gt=Cr;break;case"focusin":jn="focus",Gt=nl;break;case"focusout":jn="blur",Gt=nl;break;case"beforeblur":case"afterblur":Gt=nl;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Gt=Hi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Gt=tl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Gt=Bd;break;case aa:case Ts:case rr:Gt=Ci;break;case As:Gt=mo;break;case"scroll":case"scrollend":Gt=Jo;break;case"wheel":Gt=$u;break;case"copy":case"cut":case"paste":Gt=rc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Gt=nr;break;case"toggle":case"beforetoggle":Gt=rl}var hi=(o&4)!==0,Or=!hi&&(r==="scroll"||r==="scrollend"),_t=hi?Lt!==null?Lt+"Capture":null:Lt;hi=[];for(var ht=Pt,Dt;ht!==null;){var rn=ht;if(Dt=rn.stateNode,rn=rn.tag,rn!==5&&rn!==26&&rn!==27||Dt===null||_t===null||(rn=oi(ht,_t),rn!=null&&hi.push(xd(ht,rn,Dt))),Or)break;ht=ht.return}0<hi.length&&(Lt=new Gt(Lt,jn,null,g,Kt),ln.push({event:Lt,listeners:hi}))}}if((o&7)===0){e:{if(Lt=r==="mouseover"||r==="pointerover",Gt=r==="mouseout"||r==="pointerout",Lt&&g!==$o&&(jn=g.relatedTarget||g.fromElement)&&(Sr(jn)||jn[Gn]))break e;if((Gt||Lt)&&(Lt=Kt.window===Kt?Kt:(Lt=Kt.ownerDocument)?Lt.defaultView||Lt.parentWindow:window,Gt?(jn=g.relatedTarget||g.toElement,Gt=Pt,jn=jn?Sr(jn):null,jn!==null&&(Or=k(jn),hi=jn.tag,jn!==Or||hi!==5&&hi!==27&&hi!==6)&&(jn=null)):(Gt=null,jn=Pt),Gt!==jn)){if(hi=Hi,rn="onMouseLeave",_t="onMouseEnter",ht="mouse",(r==="pointerout"||r==="pointerover")&&(hi=nr,rn="onPointerLeave",_t="onPointerEnter",ht="pointer"),Or=Gt==null?Lt:da(Gt),Dt=jn==null?Lt:da(jn),Lt=new hi(rn,ht+"leave",Gt,g,Kt),Lt.target=Or,Lt.relatedTarget=Dt,rn=null,Sr(Kt)===Pt&&(hi=new hi(_t,ht+"enter",jn,g,Kt),hi.target=Dt,hi.relatedTarget=Or,rn=hi),Or=rn,Gt&&jn)t:{for(hi=dg,_t=Gt,ht=jn,Dt=0,rn=_t;rn;rn=hi(rn))Dt++;rn=0;for(var li=ht;li;li=hi(li))rn++;for(;0<Dt-rn;)_t=hi(_t),Dt--;for(;0<rn-Dt;)ht=hi(ht),rn--;for(;Dt--;){if(_t===ht||ht!==null&&_t===ht.alternate){hi=_t;break t}_t=hi(_t),ht=hi(ht)}hi=null}else hi=null;Gt!==null&&X0(ln,Lt,Gt,hi,!1),jn!==null&&Or!==null&&X0(ln,Or,jn,hi,!0)}}e:{if(Lt=Pt?da(Pt):window,Gt=Lt.nodeName&&Lt.nodeName.toLowerCase(),Gt==="select"||Gt==="input"&&Lt.type==="file")var mr=ks;else if(Dc(Lt))if(Ku)mr=v;else{mr=u;var Un=a}else Gt=Lt.nodeName,!Gt||Gt.toLowerCase()!=="input"||Lt.type!=="checkbox"&&Lt.type!=="radio"?Pt&&Ui(Pt.elementType)&&(mr=ks):mr=m;if(mr&&(mr=mr(r,Pt))){Ta(ln,mr,g,Kt);break e}Un&&Un(r,Lt,Pt),r==="focusout"&&Pt&&Lt.type==="number"&&Pt.memoizedProps.value!=null&&Te(Lt,"number",Lt.value)}switch(Un=Pt?da(Pt):window,r){case"focusin":(Dc(Un)||Un.contentEditable==="true")&&(it=Un,lt=Pt,Tt=null);break;case"focusout":Tt=lt=it=null;break;case"mousedown":Ft=!0;break;case"contextmenu":case"mouseup":case"dragend":Ft=!1,vn(ln,g,Kt);break;case"selectionchange":if(ze)break;case"keydown":case"keyup":vn(ln,g,Kt)}var ei;if(Lr)e:{switch(r){case"compositionstart":var qi="onCompositionStart";break e;case"compositionend":qi="onCompositionEnd";break e;case"compositionupdate":qi="onCompositionUpdate";break e}qi=void 0}else Ya?Mc(r,g)&&(qi="onCompositionEnd"):r==="keydown"&&g.keyCode===229&&(qi="onCompositionStart");qi&&(sc&&g.locale!=="ko"&&(Ya||qi!=="onCompositionStart"?qi==="onCompositionEnd"&&Ya&&(ei=Na()):(ma=Kt,js="value"in ma?ma.value:ma.textContent,Ya=!0)),Un=yf(Pt,qi),0<Un.length&&(qi=new Yu(qi,r,null,g,Kt),ln.push({event:qi,listeners:Un}),ei?qi.data=ei:(ei=ac(g),ei!==null&&(qi.data=ei)))),(ei=kl?$a(r,g):Rc(r,g))&&(qi=yf(Pt,"onBeforeInput"),0<qi.length&&(Un=new Yu("onBeforeInput","beforeinput",null,g,Kt),ln.push({event:Un,listeners:qi}),Un.data=ei)),yd(ln,r,Pt,g,Kt)}hg(ln,o)})}function xd(r,o,g){return{instance:r,listener:o,currentTarget:g}}function yf(r,o){for(var g=o+"Capture",S=[];r!==null;){var L=r,U=L.stateNode;if(L=L.tag,L!==5&&L!==26&&L!==27||U===null||(L=oi(r,g),L!=null&&S.unshift(xd(r,L,U)),L=oi(r,o),L!=null&&S.push(xd(r,L,U))),r.tag===3)return S;r=r.return}return[]}function dg(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function X0(r,o,g,S,L){for(var U=o._reactName,ne=[];g!==null&&g!==S;){var ve=g,rt=ve.alternate,Pt=ve.stateNode;if(ve=ve.tag,rt!==null&&rt===S)break;ve!==5&&ve!==26&&ve!==27||Pt===null||(rt=Pt,L?(Pt=oi(g,U),Pt!=null&&ne.unshift(xd(g,Pt,rt))):L||(Pt=oi(g,U),Pt!=null&&ne.push(xd(g,Pt,rt)))),g=g.return}ne.length!==0&&r.push({event:o,listeners:ne})}var fg=/\r\n?/g,pg=/\u0000|\uFFFD/g;function xf(r){return(typeof r=="string"?r:""+r).replace(fg,`
`).replace(pg,"")}function W0(r,o){return o=xf(o),xf(r)===o}function pr(r,o,g,S,L,U){switch(g){case"children":typeof S=="string"?o==="body"||o==="textarea"&&S===""||Da(r,S):(typeof S=="number"||typeof S=="bigint")&&o!=="body"&&Da(r,""+S);break;case"className":fa(r,"class",S);break;case"tabIndex":fa(r,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":fa(r,g,S);break;case"style":Xn(r,S,U);break;case"data":if(o!=="object"){fa(r,"data",S);break}case"src":case"href":if(S===""&&(o!=="a"||g!=="href")){r.removeAttribute(g);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){r.removeAttribute(g);break}S=ui(""+S),r.setAttribute(g,S);break;case"action":case"formAction":if(typeof S=="function"){r.setAttribute(g,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof U=="function"&&(g==="formAction"?(o!=="input"&&pr(r,o,"name",L.name,L,null),pr(r,o,"formEncType",L.formEncType,L,null),pr(r,o,"formMethod",L.formMethod,L,null),pr(r,o,"formTarget",L.formTarget,L,null)):(pr(r,o,"encType",L.encType,L,null),pr(r,o,"method",L.method,L,null),pr(r,o,"target",L.target,L,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){r.removeAttribute(g);break}S=ui(""+S),r.setAttribute(g,S);break;case"onClick":S!=null&&(r.onclick=Fs);break;case"onScroll":S!=null&&Wi("scroll",r);break;case"onScrollEnd":S!=null&&Wi("scrollend",r);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(C(61));if(g=S.__html,g!=null){if(L.children!=null)throw Error(C(60));r.innerHTML=g}}break;case"multiple":r.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":r.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){r.removeAttribute("xlink:href");break}g=ui(""+S),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",g);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?r.setAttribute(g,""+S):r.removeAttribute(g);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?r.setAttribute(g,""):r.removeAttribute(g);break;case"capture":case"download":S===!0?r.setAttribute(g,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?r.setAttribute(g,S):r.removeAttribute(g);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?r.setAttribute(g,S):r.removeAttribute(g);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?r.removeAttribute(g):r.setAttribute(g,S);break;case"popover":Wi("beforetoggle",r),Wi("toggle",r),fo(r,"popover",S);break;case"xlinkActuate":Ds(r,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":Ds(r,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":Ds(r,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":Ds(r,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":Ds(r,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":Ds(r,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":Ds(r,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":Ds(r,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":Ds(r,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":fo(r,"is",S);break;case"innerText":case"textContent":break;default:(!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(g=Bs.get(g)||g,fo(r,g,S))}}function Fp(r,o,g,S,L,U){switch(g){case"style":Xn(r,S,U);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(C(61));if(g=S.__html,g!=null){if(L.children!=null)throw Error(C(60));r.innerHTML=g}}break;case"children":typeof S=="string"?Da(r,S):(typeof S=="number"||typeof S=="bigint")&&Da(r,""+S);break;case"onScroll":S!=null&&Wi("scroll",r);break;case"onScrollEnd":S!=null&&Wi("scrollend",r);break;case"onClick":S!=null&&(r.onclick=Fs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Es.hasOwnProperty(g))e:{if(g[0]==="o"&&g[1]==="n"&&(L=g.endsWith("Capture"),o=g.slice(2,L?g.length-7:void 0),U=r[jt]||null,U=U!=null?U[g]:null,typeof U=="function"&&r.removeEventListener(o,U,L),typeof S=="function")){typeof U!="function"&&U!==null&&(g in r?r[g]=null:r.hasAttribute(g)&&r.removeAttribute(g)),r.addEventListener(o,S,L);break e}g in r?r[g]=S:S===!0?r.setAttribute(g,""):fo(r,g,S)}}}function ua(r,o,g){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Wi("error",r),Wi("load",r);var S=!1,L=!1,U;for(U in g)if(g.hasOwnProperty(U)){var ne=g[U];if(ne!=null)switch(U){case"src":S=!0;break;case"srcSet":L=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(C(137,o));default:pr(r,o,U,ne,g,null)}}L&&pr(r,o,"srcSet",g.srcSet,g,null),S&&pr(r,o,"src",g.src,g,null);return;case"input":Wi("invalid",r);var ve=U=ne=L=null,rt=null,Pt=null;for(S in g)if(g.hasOwnProperty(S)){var Kt=g[S];if(Kt!=null)switch(S){case"name":L=Kt;break;case"type":ne=Kt;break;case"checked":rt=Kt;break;case"defaultChecked":Pt=Kt;break;case"value":U=Kt;break;case"defaultValue":ve=Kt;break;case"children":case"dangerouslySetInnerHTML":if(Kt!=null)throw Error(C(137,o));break;default:pr(r,o,S,Kt,g,null)}}ft(r,U,ve,rt,Pt,ne,L,!1);return;case"select":Wi("invalid",r),S=ne=U=null;for(L in g)if(g.hasOwnProperty(L)&&(ve=g[L],ve!=null))switch(L){case"value":U=ve;break;case"defaultValue":ne=ve;break;case"multiple":S=ve;default:pr(r,o,L,ve,g,null)}o=U,g=ne,r.multiple=!!S,o!=null?zn(r,!!S,o,!1):g!=null&&zn(r,!!S,g,!0);return;case"textarea":Wi("invalid",r),U=L=S=null;for(ne in g)if(g.hasOwnProperty(ne)&&(ve=g[ne],ve!=null))switch(ne){case"value":S=ve;break;case"defaultValue":L=ve;break;case"children":U=ve;break;case"dangerouslySetInnerHTML":if(ve!=null)throw Error(C(91));break;default:pr(r,o,ne,ve,g,null)}Dr(r,S,L,U);return;case"option":for(rt in g)g.hasOwnProperty(rt)&&(S=g[rt],S!=null)&&(rt==="selected"?r.selected=S&&typeof S!="function"&&typeof S!="symbol":pr(r,o,rt,S,g,null));return;case"dialog":Wi("beforetoggle",r),Wi("toggle",r),Wi("cancel",r),Wi("close",r);break;case"iframe":case"object":Wi("load",r);break;case"video":case"audio":for(S=0;S<Ru.length;S++)Wi(Ru[S],r);break;case"image":Wi("error",r),Wi("load",r);break;case"details":Wi("toggle",r);break;case"embed":case"source":case"link":Wi("error",r),Wi("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Pt in g)if(g.hasOwnProperty(Pt)&&(S=g[Pt],S!=null))switch(Pt){case"children":case"dangerouslySetInnerHTML":throw Error(C(137,o));default:pr(r,o,Pt,S,g,null)}return;default:if(Ui(o)){for(Kt in g)g.hasOwnProperty(Kt)&&(S=g[Kt],S!==void 0&&Fp(r,o,Kt,S,g,void 0));return}}for(ve in g)g.hasOwnProperty(ve)&&(S=g[ve],S!=null&&pr(r,o,ve,S,g,null))}function mg(r,o,g,S){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var L=null,U=null,ne=null,ve=null,rt=null,Pt=null,Kt=null;for(Gt in g){var ln=g[Gt];if(g.hasOwnProperty(Gt)&&ln!=null)switch(Gt){case"checked":break;case"value":break;case"defaultValue":rt=ln;default:S.hasOwnProperty(Gt)||pr(r,o,Gt,null,S,ln)}}for(var Lt in S){var Gt=S[Lt];if(ln=g[Lt],S.hasOwnProperty(Lt)&&(Gt!=null||ln!=null))switch(Lt){case"type":U=Gt;break;case"name":L=Gt;break;case"checked":Pt=Gt;break;case"defaultChecked":Kt=Gt;break;case"value":ne=Gt;break;case"defaultValue":ve=Gt;break;case"children":case"dangerouslySetInnerHTML":if(Gt!=null)throw Error(C(137,o));break;default:Gt!==ln&&pr(r,o,Lt,Gt,S,ln)}}pn(r,ne,ve,rt,Pt,Kt,U,L);return;case"select":Gt=ne=ve=Lt=null;for(U in g)if(rt=g[U],g.hasOwnProperty(U)&&rt!=null)switch(U){case"value":break;case"multiple":Gt=rt;default:S.hasOwnProperty(U)||pr(r,o,U,null,S,rt)}for(L in S)if(U=S[L],rt=g[L],S.hasOwnProperty(L)&&(U!=null||rt!=null))switch(L){case"value":Lt=U;break;case"defaultValue":ve=U;break;case"multiple":ne=U;default:U!==rt&&pr(r,o,L,U,S,rt)}o=ve,g=ne,S=Gt,Lt!=null?zn(r,!!g,Lt,!1):!!S!=!!g&&(o!=null?zn(r,!!g,o,!0):zn(r,!!g,g?[]:"",!1));return;case"textarea":Gt=Lt=null;for(ve in g)if(L=g[ve],g.hasOwnProperty(ve)&&L!=null&&!S.hasOwnProperty(ve))switch(ve){case"value":break;case"children":break;default:pr(r,o,ve,null,S,L)}for(ne in S)if(L=S[ne],U=g[ne],S.hasOwnProperty(ne)&&(L!=null||U!=null))switch(ne){case"value":Lt=L;break;case"defaultValue":Gt=L;break;case"children":break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(C(91));break;default:L!==U&&pr(r,o,ne,L,S,U)}$i(r,Lt,Gt);return;case"option":for(var jn in g)Lt=g[jn],g.hasOwnProperty(jn)&&Lt!=null&&!S.hasOwnProperty(jn)&&(jn==="selected"?r.selected=!1:pr(r,o,jn,null,S,Lt));for(rt in S)Lt=S[rt],Gt=g[rt],S.hasOwnProperty(rt)&&Lt!==Gt&&(Lt!=null||Gt!=null)&&(rt==="selected"?r.selected=Lt&&typeof Lt!="function"&&typeof Lt!="symbol":pr(r,o,rt,Lt,S,Gt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var hi in g)Lt=g[hi],g.hasOwnProperty(hi)&&Lt!=null&&!S.hasOwnProperty(hi)&&pr(r,o,hi,null,S,Lt);for(Pt in S)if(Lt=S[Pt],Gt=g[Pt],S.hasOwnProperty(Pt)&&Lt!==Gt&&(Lt!=null||Gt!=null))switch(Pt){case"children":case"dangerouslySetInnerHTML":if(Lt!=null)throw Error(C(137,o));break;default:pr(r,o,Pt,Lt,S,Gt)}return;default:if(Ui(o)){for(var Or in g)Lt=g[Or],g.hasOwnProperty(Or)&&Lt!==void 0&&!S.hasOwnProperty(Or)&&Fp(r,o,Or,void 0,S,Lt);for(Kt in S)Lt=S[Kt],Gt=g[Kt],!S.hasOwnProperty(Kt)||Lt===Gt||Lt===void 0&&Gt===void 0||Fp(r,o,Kt,Lt,S,Gt);return}}for(var _t in g)Lt=g[_t],g.hasOwnProperty(_t)&&Lt!=null&&!S.hasOwnProperty(_t)&&pr(r,o,_t,null,S,Lt);for(ln in S)Lt=S[ln],Gt=g[ln],!S.hasOwnProperty(ln)||Lt===Gt||Lt==null&&Gt==null||pr(r,o,ln,Lt,S,Gt)}function Mo(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function _d(){if(typeof performance.getEntriesByType=="function"){for(var r=0,o=0,g=performance.getEntriesByType("resource"),S=0;S<g.length;S++){var L=g[S],U=L.transferSize,ne=L.initiatorType,ve=L.duration;if(U&&ve&&Mo(ne)){for(ne=0,ve=L.responseEnd,S+=1;S<g.length;S++){var rt=g[S],Pt=rt.startTime;if(Pt>ve)break;var Kt=rt.transferSize,ln=rt.initiatorType;Kt&&Mo(ln)&&(rt=rt.responseEnd,ne+=Kt*(rt<ve?1:(ve-Pt)/(rt-Pt)))}if(--S,o+=8*(U+ne)/(L.duration/1e3),r++,10<r)break}}if(0<r)return o/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var _f=null,Y0=null;function bf(r){return r.nodeType===9?r:r.ownerDocument}function Du(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function $0(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function jp(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Nu=null;function Up(){var r=window.event;return r&&r.type==="popstate"?r===Nu?!1:(Nu=r,!0):(Nu=null,!1)}var Vp=typeof setTimeout=="function"?setTimeout:void 0,K0=typeof clearTimeout=="function"?clearTimeout:void 0,Q0=typeof Promise=="function"?Promise:void 0,J0=typeof queueMicrotask=="function"?queueMicrotask:typeof Q0<"u"?function(r){return Q0.resolve(null).then(r).catch(em)}:Vp;function em(r){setTimeout(function(){throw r})}function ku(r){return r==="head"}function gg(r,o){var g=o,S=0;do{var L=g.nextSibling;if(r.removeChild(g),L&&L.nodeType===8)if(g=L.data,g==="/$"||g==="/&"){if(S===0){r.removeChild(L),Fu(o);return}S--}else if(g==="$"||g==="$?"||g==="$~"||g==="$!"||g==="&")S++;else if(g==="html")bd(r.ownerDocument.documentElement);else if(g==="head"){g=r.ownerDocument.head,bd(g);for(var U=g.firstChild;U;){var ne=U.nextSibling,ve=U.nodeName;U[ai]||ve==="SCRIPT"||ve==="STYLE"||ve==="LINK"&&U.rel.toLowerCase()==="stylesheet"||g.removeChild(U),U=ne}}else g==="body"&&bd(r.ownerDocument.body);g=L}while(g);Fu(o)}function Ri(r,o){var g=r;r=0;do{var S=g.nextSibling;if(g.nodeType===1?o?(g._stashedDisplay=g.style.display,g.style.display="none"):(g.style.display=g._stashedDisplay||"",g.getAttribute("style")===""&&g.removeAttribute("style")):g.nodeType===3&&(o?(g._stashedText=g.nodeValue,g.nodeValue=""):g.nodeValue=g._stashedText||""),S&&S.nodeType===8)if(g=S.data,g==="/$"){if(r===0)break;r--}else g!=="$"&&g!=="$?"&&g!=="$~"&&g!=="$!"||r++;g=S}while(g)}function Jl(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var g=o;switch(o=o.nextSibling,g.nodeName){case"HTML":case"HEAD":case"BODY":Jl(g),Rs(g);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(g.rel.toLowerCase()==="stylesheet")continue}r.removeChild(g)}}function _a(r,o,g,S){for(;r.nodeType===1;){var L=g;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!S&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(S){if(!r[ai])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(U=r.getAttribute("rel"),U==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(U!==L.rel||r.getAttribute("href")!==(L.href==null||L.href===""?null:L.href)||r.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin)||r.getAttribute("title")!==(L.title==null?null:L.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(U=r.getAttribute("src"),(U!==(L.src==null?null:L.src)||r.getAttribute("type")!==(L.type==null?null:L.type)||r.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin))&&U&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var U=L.name==null?null:""+L.name;if(L.type==="hidden"&&r.getAttribute("name")===U)return r}else return r;if(r=qo(r.nextSibling),r===null)break}return null}function ec(r,o,g){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!g||(r=qo(r.nextSibling),r===null))return null;return r}function Pu(r,o){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=qo(r.nextSibling),r===null))return null;return r}function Ua(r){return r.data==="$?"||r.data==="$~"}function Is(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function $s(r,o){var g=r.ownerDocument;if(r.data==="$~")r._reactRetry=o;else if(r.data!=="$?"||g.readyState!=="loading")o();else{var S=function(){o(),g.removeEventListener("DOMContentLoaded",S)};g.addEventListener("DOMContentLoaded",S),r._reactRetry=S}}function qo(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return r}var co=null;function Ks(r){r=r.nextSibling;for(var o=0;r;){if(r.nodeType===8){var g=r.data;if(g==="/$"||g==="/&"){if(o===0)return qo(r.nextSibling);o--}else g!=="$"&&g!=="$!"&&g!=="$?"&&g!=="$~"&&g!=="&"||o++}r=r.nextSibling}return null}function vf(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var g=r.data;if(g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"){if(o===0)return r;o--}else g!=="/$"&&g!=="/&"||o++}r=r.previousSibling}return null}function yg(r,o,g){switch(o=bf(g),r){case"html":if(r=o.documentElement,!r)throw Error(C(452));return r;case"head":if(r=o.head,!r)throw Error(C(453));return r;case"body":if(r=o.body,!r)throw Error(C(454));return r;default:throw Error(C(451))}}function bd(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);Rs(r)}var ba=new Map,Eh=new Set;function Gp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Sc=je.d;je.d={f:xg,r:_g,D:nm,C:Va,L:tc,m:Ga,X:Hp,S:zu,M:im};function xg(){var r=Sc.f(),o=ff();return r||o}function _g(r){var o=ji(r);o!==null&&o.tag===5&&o.type==="form"?qs(o):Sc.r(r)}var Ou=typeof document>"u"?null:document;function tm(r,o,g){var S=Ou;if(S&&typeof o=="string"&&o){var L=on(o);L='link[rel="'+r+'"][href="'+L+'"]',typeof g=="string"&&(L+='[crossorigin="'+g+'"]'),Eh.has(L)||(Eh.add(L),r={rel:r,crossOrigin:g,href:o},S.querySelector(L)===null&&(o=S.createElement("link"),ua(o,"link",r),dr(o),S.head.appendChild(o)))}}function nm(r){Sc.D(r),tm("dns-prefetch",r,null)}function Va(r,o){Sc.C(r,o),tm("preconnect",r,o)}function tc(r,o,g){Sc.L(r,o,g);var S=Ou;if(S&&r&&o){var L='link[rel="preload"][as="'+on(o)+'"]';o==="image"&&g&&g.imageSrcSet?(L+='[imagesrcset="'+on(g.imageSrcSet)+'"]',typeof g.imageSizes=="string"&&(L+='[imagesizes="'+on(g.imageSizes)+'"]')):L+='[href="'+on(r)+'"]';var U=L;switch(o){case"style":U=Sh(r);break;case"script":U=tu(r)}ba.has(U)||(r=K({rel:"preload",href:o==="image"&&g&&g.imageSrcSet?void 0:r,as:o},g),ba.set(U,r),S.querySelector(L)!==null||o==="style"&&S.querySelector(vd(U))||o==="script"&&S.querySelector(wd(U))||(o=S.createElement("link"),ua(o,"link",r),dr(o),S.head.appendChild(o)))}}function Ga(r,o){Sc.m(r,o);var g=Ou;if(g&&r){var S=o&&typeof o.as=="string"?o.as:"script",L='link[rel="modulepreload"][as="'+on(S)+'"][href="'+on(r)+'"]',U=L;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":U=tu(r)}if(!ba.has(U)&&(r=K({rel:"modulepreload",href:r},o),ba.set(U,r),g.querySelector(L)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(g.querySelector(wd(U)))return}S=g.createElement("link"),ua(S,"link",r),dr(S),g.head.appendChild(S)}}}function zu(r,o,g){Sc.S(r,o,g);var S=Ou;if(S&&r){var L=us(S).hoistableStyles,U=Sh(r);o=o||"default";var ne=L.get(U);if(!ne){var ve={loading:0,preload:null};if(ne=S.querySelector(vd(U)))ve.loading=5;else{r=K({rel:"stylesheet",href:r,"data-precedence":o},g),(g=ba.get(U))&&wf(r,g);var rt=ne=S.createElement("link");dr(rt),ua(rt,"link",r),rt._p=new Promise(function(Pt,Kt){rt.onload=Pt,rt.onerror=Kt}),rt.addEventListener("load",function(){ve.loading|=1}),rt.addEventListener("error",function(){ve.loading|=2}),ve.loading|=4,nu(ne,o,S)}ne={type:"stylesheet",instance:ne,count:1,state:ve},L.set(U,ne)}}}function Hp(r,o){Sc.X(r,o);var g=Ou;if(g&&r){var S=us(g).hoistableScripts,L=tu(r),U=S.get(L);U||(U=g.querySelector(wd(L)),U||(r=K({src:r,async:!0},o),(o=ba.get(L))&&qp(r,o),U=g.createElement("script"),dr(U),ua(U,"link",r),g.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},S.set(L,U))}}function im(r,o){Sc.M(r,o);var g=Ou;if(g&&r){var S=us(g).hoistableScripts,L=tu(r),U=S.get(L);U||(U=g.querySelector(wd(L)),U||(r=K({src:r,async:!0,type:"module"},o),(o=ba.get(L))&&qp(r,o),U=g.createElement("script"),dr(U),ua(U,"link",r),g.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},S.set(L,U))}}function rm(r,o,g,S){var L=(L=Bt.current)?Gp(L):null;if(!L)throw Error(C(446));switch(r){case"meta":case"title":return null;case"style":return typeof g.precedence=="string"&&typeof g.href=="string"?(o=Sh(g.href),g=us(L).hoistableStyles,S=g.get(o),S||(S={type:"style",instance:null,count:0,state:null},g.set(o,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(g.rel==="stylesheet"&&typeof g.href=="string"&&typeof g.precedence=="string"){r=Sh(g.href);var U=us(L).hoistableStyles,ne=U.get(r);if(ne||(L=L.ownerDocument||L,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},U.set(r,ne),(U=L.querySelector(vd(r)))&&!U._p&&(ne.instance=U,ne.state.loading=5),ba.has(r)||(g={rel:"preload",as:"style",href:g.href,crossOrigin:g.crossOrigin,integrity:g.integrity,media:g.media,hrefLang:g.hrefLang,referrerPolicy:g.referrerPolicy},ba.set(r,g),U||am(L,r,g,ne.state))),o&&S===null)throw Error(C(528,""));return ne}if(o&&S!==null)throw Error(C(529,""));return null;case"script":return o=g.async,g=g.src,typeof g=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=tu(g),g=us(L).hoistableScripts,S=g.get(o),S||(S={type:"script",instance:null,count:0,state:null},g.set(o,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(C(444,r))}}function Sh(r){return'href="'+on(r)+'"'}function vd(r){return'link[rel="stylesheet"]['+r+"]"}function sm(r){return K({},r,{"data-precedence":r.precedence,precedence:null})}function am(r,o,g,S){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?S.loading=1:(o=r.createElement("link"),S.preload=o,o.addEventListener("load",function(){return S.loading|=1}),o.addEventListener("error",function(){return S.loading|=2}),ua(o,"link",g),dr(o),r.head.appendChild(o))}function tu(r){return'[src="'+on(r)+'"]'}function wd(r){return"script[async]"+r}function om(r,o,g){if(o.count++,o.instance===null)switch(o.type){case"style":var S=r.querySelector('style[data-href~="'+on(g.href)+'"]');if(S)return o.instance=S,dr(S),S;var L=K({},g,{"data-href":g.href,"data-precedence":g.precedence,href:null,precedence:null});return S=(r.ownerDocument||r).createElement("style"),dr(S),ua(S,"style",L),nu(S,g.precedence,r),o.instance=S;case"stylesheet":L=Sh(g.href);var U=r.querySelector(vd(L));if(U)return o.state.loading|=4,o.instance=U,dr(U),U;S=sm(g),(L=ba.get(L))&&wf(S,L),U=(r.ownerDocument||r).createElement("link"),dr(U);var ne=U;return ne._p=new Promise(function(ve,rt){ne.onload=ve,ne.onerror=rt}),ua(U,"link",S),o.state.loading|=4,nu(U,g.precedence,r),o.instance=U;case"script":return U=tu(g.src),(L=r.querySelector(wd(U)))?(o.instance=L,dr(L),L):(S=g,(L=ba.get(U))&&(S=K({},g),qp(S,L)),r=r.ownerDocument||r,L=r.createElement("script"),dr(L),ua(L,"link",S),r.head.appendChild(L),o.instance=L);case"void":return null;default:throw Error(C(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(S=o.instance,o.state.loading|=4,nu(S,g.precedence,r));return o.instance}function nu(r,o,g){for(var S=g.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),L=S.length?S[S.length-1]:null,U=L,ne=0;ne<S.length;ne++){var ve=S[ne];if(ve.dataset.precedence===o)U=ve;else if(U!==L)break}U?U.parentNode.insertBefore(r,U.nextSibling):(o=g.nodeType===9?g.head:g,o.insertBefore(r,o.firstChild))}function wf(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function qp(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var Zp=null;function lm(r,o,g){if(Zp===null){var S=new Map,L=Zp=new Map;L.set(g,S)}else L=Zp,S=L.get(g),S||(S=new Map,L.set(g,S));if(S.has(r))return S;for(S.set(r,null),g=g.getElementsByTagName(r),L=0;L<g.length;L++){var U=g[L];if(!(U[ai]||U[vi]||r==="link"&&U.getAttribute("rel")==="stylesheet")&&U.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=U.getAttribute(o)||"";ne=r+ne;var ve=S.get(ne);ve?ve.push(U):S.set(ne,[U])}}return S}function Ef(r,o,g){r=r.ownerDocument||r,r.head.insertBefore(g,o==="title"?r.querySelector("head > title"):null)}function Xp(r,o,g){if(g===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(r=o.disabled,typeof o.precedence=="string"&&r==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Sf(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function cm(r,o,g,S){if(g.type==="stylesheet"&&(typeof S.media!="string"||matchMedia(S.media).matches!==!1)&&(g.state.loading&4)===0){if(g.instance===null){var L=Sh(S.href),U=o.querySelector(vd(L));if(U){o=U._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(r.count++,r=Af.bind(r),o.then(r,r)),g.state.loading|=4,g.instance=U,dr(U);return}U=o.ownerDocument||o,S=sm(S),(L=ba.get(L))&&wf(S,L),U=U.createElement("link"),dr(U);var ne=U;ne._p=new Promise(function(ve,rt){ne.onload=ve,ne.onerror=rt}),ua(U,"link",S),g.instance=U}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(g,o),(o=g.state.preload)&&(g.state.loading&3)===0&&(r.count++,g=Af.bind(r),o.addEventListener("load",g),o.addEventListener("error",g))}}var Tf=0;function um(r,o){return r.stylesheets&&r.count===0&&If(r,r.stylesheets),0<r.count||0<r.imgCount?function(g){var S=setTimeout(function(){if(r.stylesheets&&If(r,r.stylesheets),r.unsuspend){var U=r.unsuspend;r.unsuspend=null,U()}},6e4+o);0<r.imgBytes&&Tf===0&&(Tf=62500*_d());var L=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&If(r,r.stylesheets),r.unsuspend)){var U=r.unsuspend;r.unsuspend=null,U()}},(r.imgBytes>Tf?50:800)+o);return r.unsuspend=g,function(){r.unsuspend=null,clearTimeout(S),clearTimeout(L)}}:null}function Af(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)If(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Cf=null;function If(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Cf=new Map,o.forEach(bg,r),Cf=null,Af.call(r))}function bg(r,o){if(!(o.state.loading&4)){var g=Cf.get(r);if(g)var S=g.get(null);else{g=new Map,Cf.set(r,g);for(var L=r.querySelectorAll("link[data-precedence],style[data-precedence]"),U=0;U<L.length;U++){var ne=L[U];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(g.set(ne.dataset.precedence,ne),S=ne)}S&&g.set(null,S)}L=o.instance,ne=L.getAttribute("data-precedence"),U=g.get(ne)||S,U===S&&g.set(null,L),g.set(ne,L),this.count++,S=Af.bind(this),L.addEventListener("load",S),L.addEventListener("error",S),U?U.parentNode.insertBefore(L,U.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(L,r.firstChild)),o.state.loading|=4}}var Ed={$$typeof:Qe,Provider:null,Consumer:null,_currentValue:st,_currentValue2:st,_threadCount:0};function C1(r,o,g,S,L,U,ne,ve,rt){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=gi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gi(0),this.hiddenUpdates=gi(null),this.identifierPrefix=S,this.onUncaughtError=L,this.onCaughtError=U,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=rt,this.incompleteTransitions=new Map}function hm(r,o,g,S,L,U,ne,ve,rt,Pt,Kt,ln){return r=new C1(r,o,g,ne,rt,Pt,Kt,ln,ve),o=1,U===!0&&(o|=24),U=Ja(3,null,null,o),r.current=U,U.stateNode=r,o=ml(),o.refCount++,r.pooledCache=o,o.refCount++,U.memoizedState={element:S,isDehydrated:g,cache:o},ed(U),r}function vg(r){return r?(r=bi,r):bi}function wg(r,o,g,S,L,U){L=vg(L),S.context===null?S.context=L:S.pendingContext=L,S=bl(o),S.payload={element:g},U=U===void 0?null:U,U!==null&&(S.callback=U),g=Gl(r,S,o),g!==null&&(Io(g,r,o),_o(g,r,o))}function Wp(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var g=r.retryLane;r.retryLane=g!==0&&g<o?g:o}}function Yp(r,o){Wp(r,o),(r=r.alternate)&&Wp(r,o)}function Eg(r){if(r.tag===13||r.tag===31){var o=go(r,67108864);o!==null&&Io(o,r,67108864),Yp(r,67108864)}}function Sg(r){if(r.tag===13||r.tag===31){var o=Co();o=Fi(o);var g=go(r,o);g!==null&&Io(g,r,o),Yp(r,o)}}var Mf=!0;function Rf(r,o,g,S){var L=Se.T;Se.T=null;var U=je.p;try{je.p=2,dm(r,o,g,S)}finally{je.p=U,Se.T=L}}function Tg(r,o,g,S){var L=Se.T;Se.T=null;var U=je.p;try{je.p=8,dm(r,o,g,S)}finally{je.p=U,Se.T=L}}function dm(r,o,g,S){if(Mf){var L=Df(S);if(L===null)Ec(r,o,S,Sd,g),Ag(r,S);else if(M1(L,r,o,g,S))S.stopPropagation();else if(Ag(r,S),o&4&&-1<I1.indexOf(r)){for(;L!==null;){var U=ji(L);if(U!==null)switch(U.tag){case 3:if(U=U.stateNode,U.current.memoizedState.isDehydrated){var ne=Ke(U.pendingLanes);if(ne!==0){var ve=U;for(ve.pendingLanes|=2,ve.entangledLanes|=2;ne;){var rt=1<<31-Me(ne);ve.entanglements[1]|=rt,ne&=~rt}Ql(U),(wr&6)===0&&(hf=fi()+500,Ho(0))}}break;case 31:case 13:ve=go(U,2),ve!==null&&Io(ve,U,2),ff(),Yp(U,2)}if(U=Df(S),U===null&&Ec(r,o,S,Sd,g),U===L)break;L=U}L!==null&&S.stopPropagation()}else Ec(r,o,S,null,g)}}function Df(r){return r=Ko(r),$p(r)}var Sd=null;function $p(r){if(Sd=null,r=Sr(r),r!==null){var o=k(r);if(o===null)r=null;else{var g=o.tag;if(g===13){if(r=R(o),r!==null)return r;r=null}else if(g===31){if(r=h(o),r!==null)return r;r=null}else if(g===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Sd=r,null}function Th(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ci()){case ct:return 2;case oe:return 8;case ue:case ge:return 32;case qe:return 268435456;default:return 32}default:return 32}}var Kp=!1,Lu=null,Al=null,Bu=null,Nf=new Map,Td=new Map,iu=[],I1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ag(r,o){switch(r){case"focusin":case"focusout":Lu=null;break;case"dragenter":case"dragleave":Al=null;break;case"mouseover":case"mouseout":Bu=null;break;case"pointerover":case"pointerout":Nf.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Td.delete(o.pointerId)}}function kf(r,o,g,S,L,U){return r===null||r.nativeEvent!==U?(r={blockedOn:o,domEventName:g,eventSystemFlags:S,nativeEvent:U,targetContainers:[L]},o!==null&&(o=ji(o),o!==null&&Eg(o)),r):(r.eventSystemFlags|=S,o=r.targetContainers,L!==null&&o.indexOf(L)===-1&&o.push(L),r)}function M1(r,o,g,S,L){switch(o){case"focusin":return Lu=kf(Lu,r,o,g,S,L),!0;case"dragenter":return Al=kf(Al,r,o,g,S,L),!0;case"mouseover":return Bu=kf(Bu,r,o,g,S,L),!0;case"pointerover":var U=L.pointerId;return Nf.set(U,kf(Nf.get(U)||null,r,o,g,S,L)),!0;case"gotpointercapture":return U=L.pointerId,Td.set(U,kf(Td.get(U)||null,r,o,g,S,L)),!0}return!1}function Cg(r){var o=Sr(r.target);if(o!==null){var g=k(o);if(g!==null){if(o=g.tag,o===13){if(o=R(g),o!==null){r.blockedOn=o,bn(r.priority,function(){Sg(g)});return}}else if(o===31){if(o=h(g),o!==null){r.blockedOn=o,bn(r.priority,function(){Sg(g)});return}}else if(o===3&&g.stateNode.current.memoizedState.isDehydrated){r.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Pf(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var g=Df(r.nativeEvent);if(g===null){g=r.nativeEvent;var S=new g.constructor(g.type,g);$o=S,g.target.dispatchEvent(S),$o=null}else return o=ji(g),o!==null&&Eg(o),r.blockedOn=g,!1;o.shift()}return!0}function Ig(r,o,g){Pf(r)&&g.delete(o)}function Of(){Kp=!1,Lu!==null&&Pf(Lu)&&(Lu=null),Al!==null&&Pf(Al)&&(Al=null),Bu!==null&&Pf(Bu)&&(Bu=null),Nf.forEach(Ig),Td.forEach(Ig)}function Qp(r,o){r.blockedOn===o&&(r.blockedOn=null,Kp||(Kp=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,Of)))}var Jp=null;function Mg(r){Jp!==r&&(Jp=r,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){Jp===r&&(Jp=null);for(var o=0;o<r.length;o+=3){var g=r[o],S=r[o+1],L=r[o+2];if(typeof S!="function"){if($p(S||g)===null)continue;break}var U=ji(g);U!==null&&(r.splice(o,3),o-=3,es(U,{pending:!0,data:L,method:g.method,action:S},S,L))}}))}function Fu(r){function o(rt){return Qp(rt,r)}Lu!==null&&Qp(Lu,r),Al!==null&&Qp(Al,r),Bu!==null&&Qp(Bu,r),Nf.forEach(o),Td.forEach(o);for(var g=0;g<iu.length;g++){var S=iu[g];S.blockedOn===r&&(S.blockedOn=null)}for(;0<iu.length&&(g=iu[0],g.blockedOn===null);)Cg(g),g.blockedOn===null&&iu.shift();if(g=(r.ownerDocument||r).$$reactFormReplay,g!=null)for(S=0;S<g.length;S+=3){var L=g[S],U=g[S+1],ne=L[jt]||null;if(typeof U=="function")ne||Mg(g);else if(ne){var ve=null;if(U&&U.hasAttribute("formAction")){if(L=U,ne=U[jt]||null)ve=ne.formAction;else if($p(L)!==null)continue}else ve=ne.action;typeof ve=="function"?g[S+1]=ve:(g.splice(S,3),S-=3),Mg(g)}}}function fm(){function r(U){U.canIntercept&&U.info==="react-transition"&&U.intercept({handler:function(){return new Promise(function(ne){return L=ne})},focusReset:"manual",scroll:"manual"})}function o(){L!==null&&(L(),L=null),S||setTimeout(g,20)}function g(){if(!S&&!navigation.transition){var U=navigation.currentEntry;U&&U.url!=null&&navigation.navigate(U.url,{state:U.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var S=!1,L=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(g,100),function(){S=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),L!==null&&(L(),L=null)}}}function pm(r){this._internalRoot=r}e0.prototype.render=pm.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(C(409));var g=o.current,S=Co();wg(g,S,r,o,null,null)},e0.prototype.unmount=pm.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;wg(r.current,2,null,r,null,null),ff(),o[Gn]=null}};function e0(r){this._internalRoot=r}e0.prototype.unstable_scheduleHydration=function(r){if(r){var o=xi();r={blockedOn:null,target:r,priority:o};for(var g=0;g<iu.length&&o!==0&&o<iu[g].priority;g++);iu.splice(g,0,r),g===0&&Cg(r)}};var mm=f.version;if(mm!=="19.2.3")throw Error(C(527,mm,"19.2.3"));je.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(C(188)):(r=Object.keys(r).join(","),Error(C(268,r)));return r=H(o),r=r!==null?$(r):null,r=r===null?null:r.stateNode,r};var Rg={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Se,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var t0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t0.isDisabled&&t0.supportsFiber)try{at=t0.inject(Rg),fe=t0}catch{}}return vm.createRoot=function(r,o){if(!N(r))throw Error(C(299));var g=!1,S="",L=rd,U=Wl,ne=Yl;return o!=null&&(o.unstable_strictMode===!0&&(g=!0),o.identifierPrefix!==void 0&&(S=o.identifierPrefix),o.onUncaughtError!==void 0&&(L=o.onUncaughtError),o.onCaughtError!==void 0&&(U=o.onCaughtError),o.onRecoverableError!==void 0&&(ne=o.onRecoverableError)),o=hm(r,1,!1,null,null,g,S,null,L,U,ne,fm),r[Gn]=o.current,Z0(r),new pm(o)},vm.hydrateRoot=function(r,o,g){if(!N(r))throw Error(C(299));var S=!1,L="",U=rd,ne=Wl,ve=Yl,rt=null;return g!=null&&(g.unstable_strictMode===!0&&(S=!0),g.identifierPrefix!==void 0&&(L=g.identifierPrefix),g.onUncaughtError!==void 0&&(U=g.onUncaughtError),g.onCaughtError!==void 0&&(ne=g.onCaughtError),g.onRecoverableError!==void 0&&(ve=g.onRecoverableError),g.formState!==void 0&&(rt=g.formState)),o=hm(r,1,!0,o,g??null,S,L,rt,U,ne,ve,fm),o.context=vg(null),g=o.current,S=Co(),S=Fi(S),L=bl(S),L.callback=null,Gl(g,L,S),g=S,o.current.lanes=g,Yn(o,g),Ql(o),r[Gn]=o.current,Z0(r),new e0(o)},vm.version="19.2.3",vm}var Fx;function $2(){if(Fx)return U1.exports;Fx=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(f){console.error(f)}}return c(),U1.exports=Y2(),U1.exports}var K2=$2();const Q2=f0(K2),J2="modulepreload",ew=function(c){return"/parlens-pwa/"+c},jx={},Gg=function(f,y,C){let N=Promise.resolve();if(y&&y.length>0){let H=function($){return Promise.all($.map(K=>Promise.resolve(K).then(be=>({status:"fulfilled",value:be}),be=>({status:"rejected",reason:be}))))};var R=H;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),V=h?.nonce||h?.getAttribute("nonce");N=H(y.map($=>{if($=ew($),$ in jx)return;jx[$]=!0;const K=$.endsWith(".css"),be=K?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${$}"]${be}`))return;const Ce=document.createElement("link");if(Ce.rel=K?"stylesheet":J2,K||(Ce.as="script"),Ce.crossOrigin="",Ce.href=$,V&&Ce.setAttribute("nonce",V),document.head.appendChild(Ce),K)return new Promise((Ee,ye)=>{Ce.addEventListener("load",Ee),Ce.addEventListener("error",()=>ye(new Error(`Unable to preload CSS for ${$}`)))})}))}function k(h){const V=new Event("vite:preloadError",{cancelable:!0});if(V.payload=h,window.dispatchEvent(V),!V.defaultPrevented)throw h}return N.then(h=>{for(const V of h||[])V.status==="rejected"&&k(V.reason);return f().catch(k)})};function Ux(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`Wrong positive integer: ${c}`)}function tb(c,...f){if(!(c instanceof Uint8Array))throw new Error("Expected Uint8Array");if(f.length>0&&!f.includes(c.length))throw new Error(`Expected Uint8Array of length ${f}, not of length=${c.length}`)}function tw(c){if(typeof c!="function"||typeof c.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ux(c.outputLen),Ux(c.blockLen)}function Hg(c,f=!0){if(c.destroyed)throw new Error("Hash instance has been destroyed");if(f&&c.finished)throw new Error("Hash#digest() has already been called")}function nw(c,f){tb(c);const y=f.outputLen;if(c.length<y)throw new Error(`digestInto() expects output buffer of length at least ${y}`)}const q1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const nb=c=>c instanceof Uint8Array,Z1=c=>new DataView(c.buffer,c.byteOffset,c.byteLength),Uu=(c,f)=>c<<32-f|c>>>f,iw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!iw)throw new Error("Non little-endian hardware is not supported");function rw(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function ky(c){if(typeof c=="string"&&(c=rw(c)),!nb(c))throw new Error(`expected Uint8Array, got ${typeof c}`);return c}function sw(...c){const f=new Uint8Array(c.reduce((C,N)=>C+N.length,0));let y=0;return c.forEach(C=>{if(!nb(C))throw new Error("Uint8Array expected");f.set(C,y),y+=C.length}),f}let ib=class{clone(){return this._cloneInto()}};function aw(c){const f=C=>c().update(ky(C)).digest(),y=c();return f.outputLen=y.outputLen,f.blockLen=y.blockLen,f.create=()=>c(),f}function rb(c=32){if(q1&&typeof q1.getRandomValues=="function")return q1.getRandomValues(new Uint8Array(c));throw new Error("crypto.getRandomValues must be defined")}function ow(c,f,y,C){if(typeof c.setBigUint64=="function")return c.setBigUint64(f,y,C);const N=BigInt(32),k=BigInt(4294967295),R=Number(y>>N&k),h=Number(y&k),V=C?4:0,H=C?0:4;c.setUint32(f+V,R,C),c.setUint32(f+H,h,C)}let lw=class extends ib{constructor(f,y,C,N){super(),this.blockLen=f,this.outputLen=y,this.padOffset=C,this.isLE=N,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(f),this.view=Z1(this.buffer)}update(f){Hg(this);const{view:y,buffer:C,blockLen:N}=this;f=ky(f);const k=f.length;for(let R=0;R<k;){const h=Math.min(N-this.pos,k-R);if(h===N){const V=Z1(f);for(;N<=k-R;R+=N)this.process(V,R);continue}C.set(f.subarray(R,R+h),this.pos),this.pos+=h,R+=h,this.pos===N&&(this.process(y,0),this.pos=0)}return this.length+=f.length,this.roundClean(),this}digestInto(f){Hg(this),nw(f,this),this.finished=!0;const{buffer:y,view:C,blockLen:N,isLE:k}=this;let{pos:R}=this;y[R++]=128,this.buffer.subarray(R).fill(0),this.padOffset>N-R&&(this.process(C,0),R=0);for(let K=R;K<N;K++)y[K]=0;ow(C,N-8,BigInt(this.length*8),k),this.process(C,0);const h=Z1(f),V=this.outputLen;if(V%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const H=V/4,$=this.get();if(H>$.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<H;K++)h.setUint32(4*K,$[K],k)}digest(){const{buffer:f,outputLen:y}=this;this.digestInto(f);const C=f.slice(0,y);return this.destroy(),C}_cloneInto(f){f||(f=new this.constructor),f.set(...this.get());const{blockLen:y,buffer:C,length:N,finished:k,destroyed:R,pos:h}=this;return f.length=N,f.pos=h,f.finished=k,f.destroyed=R,N%y&&f.buffer.set(C),f}};const cw=(c,f,y)=>c&f^~c&y,uw=(c,f,y)=>c&f^c&y^f&y,hw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Cd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Id=new Uint32Array(64);let dw=class extends lw{constructor(){super(64,32,8,!1),this.A=Cd[0]|0,this.B=Cd[1]|0,this.C=Cd[2]|0,this.D=Cd[3]|0,this.E=Cd[4]|0,this.F=Cd[5]|0,this.G=Cd[6]|0,this.H=Cd[7]|0}get(){const{A:f,B:y,C,D:N,E:k,F:R,G:h,H:V}=this;return[f,y,C,N,k,R,h,V]}set(f,y,C,N,k,R,h,V){this.A=f|0,this.B=y|0,this.C=C|0,this.D=N|0,this.E=k|0,this.F=R|0,this.G=h|0,this.H=V|0}process(f,y){for(let K=0;K<16;K++,y+=4)Id[K]=f.getUint32(y,!1);for(let K=16;K<64;K++){const be=Id[K-15],Ce=Id[K-2],Ee=Uu(be,7)^Uu(be,18)^be>>>3,ye=Uu(Ce,17)^Uu(Ce,19)^Ce>>>10;Id[K]=ye+Id[K-7]+Ee+Id[K-16]|0}let{A:C,B:N,C:k,D:R,E:h,F:V,G:H,H:$}=this;for(let K=0;K<64;K++){const be=Uu(h,6)^Uu(h,11)^Uu(h,25),Ce=$+be+cw(h,V,H)+hw[K]+Id[K]|0,ye=(Uu(C,2)^Uu(C,13)^Uu(C,22))+uw(C,N,k)|0;$=H,H=V,V=h,h=R+Ce|0,R=k,k=N,N=C,C=Ce+ye|0}C=C+this.A|0,N=N+this.B|0,k=k+this.C|0,R=R+this.D|0,h=h+this.E|0,V=V+this.F|0,H=H+this.G|0,$=$+this.H|0,this.set(C,N,k,R,h,V,H,$)}roundClean(){Id.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const cy=aw(()=>new dw);const sb=BigInt(0),r1=BigInt(1),fw=BigInt(2),s1=c=>c instanceof Uint8Array,pw=Array.from({length:256},(c,f)=>f.toString(16).padStart(2,"0"));function u0(c){if(!s1(c))throw new Error("Uint8Array expected");let f="";for(let y=0;y<c.length;y++)f+=pw[c[y]];return f}function ab(c){const f=c.toString(16);return f.length&1?`0${f}`:f}function Py(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);return BigInt(c===""?"0":`0x${c}`)}function h0(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const f=c.length;if(f%2)throw new Error("padded hex string expected, got unpadded hex of length "+f);const y=new Uint8Array(f/2);for(let C=0;C<y.length;C++){const N=C*2,k=c.slice(N,N+2),R=Number.parseInt(k,16);if(Number.isNaN(R)||R<0)throw new Error("Invalid byte sequence");y[C]=R}return y}function Ml(c){return Py(u0(c))}function Oy(c){if(!s1(c))throw new Error("Uint8Array expected");return Py(u0(Uint8Array.from(c).reverse()))}function Pd(c,f){return h0(c.toString(16).padStart(f*2,"0"))}function zy(c,f){return Pd(c,f).reverse()}function mw(c){return h0(ab(c))}function Do(c,f,y){let C;if(typeof f=="string")try{C=h0(f)}catch(k){throw new Error(`${c} must be valid hex string, got "${f}". Cause: ${k}`)}else if(s1(f))C=Uint8Array.from(f);else throw new Error(`${c} must be hex string or Uint8Array`);const N=C.length;if(typeof y=="number"&&N!==y)throw new Error(`${c} expected ${y} bytes, got ${N}`);return C}function Wf(...c){const f=new Uint8Array(c.reduce((C,N)=>C+N.length,0));let y=0;return c.forEach(C=>{if(!s1(C))throw new Error("Uint8Array expected");f.set(C,y),y+=C.length}),f}function gw(c,f){if(c.length!==f.length)return!1;for(let y=0;y<c.length;y++)if(c[y]!==f[y])return!1;return!0}function yw(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function xw(c){let f;for(f=0;c>sb;c>>=r1,f+=1);return f}function _w(c,f){return c>>BigInt(f)&r1}const bw=(c,f,y)=>c|(y?r1:sb)<<BigInt(f),Ly=c=>(fw<<BigInt(c-1))-r1,X1=c=>new Uint8Array(c),Vx=c=>Uint8Array.from(c);function ob(c,f,y){if(typeof c!="number"||c<2)throw new Error("hashLen must be a number");if(typeof f!="number"||f<2)throw new Error("qByteLen must be a number");if(typeof y!="function")throw new Error("hmacFn must be a function");let C=X1(c),N=X1(c),k=0;const R=()=>{C.fill(1),N.fill(0),k=0},h=(...K)=>y(N,C,...K),V=(K=X1())=>{N=h(Vx([0]),K),C=h(),K.length!==0&&(N=h(Vx([1]),K),C=h())},H=()=>{if(k++>=1e3)throw new Error("drbg: tried 1000 values");let K=0;const be=[];for(;K<f;){C=h();const Ce=C.slice();be.push(Ce),K+=C.length}return Wf(...be)};return(K,be)=>{R(),V(K);let Ce;for(;!(Ce=be(H()));)V();return R(),Ce}}const vw={bigint:c=>typeof c=="bigint",function:c=>typeof c=="function",boolean:c=>typeof c=="boolean",string:c=>typeof c=="string",stringOrUint8Array:c=>typeof c=="string"||c instanceof Uint8Array,isSafeInteger:c=>Number.isSafeInteger(c),array:c=>Array.isArray(c),field:(c,f)=>f.Fp.isValid(c),hash:c=>typeof c=="function"&&Number.isSafeInteger(c.outputLen)};function Nm(c,f,y={}){const C=(N,k,R)=>{const h=vw[k];if(typeof h!="function")throw new Error(`Invalid validator "${k}", expected function`);const V=c[N];if(!(R&&V===void 0)&&!h(V,c))throw new Error(`Invalid param ${String(N)}=${V} (${typeof V}), expected ${k}`)};for(const[N,k]of Object.entries(f))C(N,k,!1);for(const[N,k]of Object.entries(y))C(N,k,!0);return c}const ww=Object.freeze(Object.defineProperty({__proto__:null,bitGet:_w,bitLen:xw,bitMask:Ly,bitSet:bw,bytesToHex:u0,bytesToNumberBE:Ml,bytesToNumberLE:Oy,concatBytes:Wf,createHmacDrbg:ob,ensureBytes:Do,equalBytes:gw,hexToBytes:h0,hexToNumber:Py,numberToBytesBE:Pd,numberToBytesLE:zy,numberToHexUnpadded:ab,numberToVarBytesBE:mw,utf8ToBytes:yw,validateObject:Nm},Symbol.toStringTag,{value:"Module"}));const Za=BigInt(0),ha=BigInt(1),Gf=BigInt(2),Ew=BigInt(3),uy=BigInt(4),Gx=BigInt(5),Hx=BigInt(8);BigInt(9);BigInt(16);function ho(c,f){const y=c%f;return y>=Za?y:f+y}function Sw(c,f,y){if(y<=Za||f<Za)throw new Error("Expected power/modulo > 0");if(y===ha)return Za;let C=ha;for(;f>Za;)f&ha&&(C=C*c%y),c=c*c%y,f>>=ha;return C}function Ac(c,f,y){let C=c;for(;f-- >Za;)C*=C,C%=y;return C}function hy(c,f){if(c===Za||f<=Za)throw new Error(`invert: expected positive integers, got n=${c} mod=${f}`);let y=ho(c,f),C=f,N=Za,k=ha;for(;y!==Za;){const h=C/y,V=C%y,H=N-k*h;C=y,y=V,N=k,k=H}if(C!==ha)throw new Error("invert: does not exist");return ho(N,f)}function Tw(c){const f=(c-ha)/Gf;let y,C,N;for(y=c-ha,C=0;y%Gf===Za;y/=Gf,C++);for(N=Gf;N<c&&Sw(N,f,c)!==c-ha;N++);if(C===1){const R=(c+ha)/uy;return function(V,H){const $=V.pow(H,R);if(!V.eql(V.sqr($),H))throw new Error("Cannot find square root");return $}}const k=(y+ha)/Gf;return function(h,V){if(h.pow(V,f)===h.neg(h.ONE))throw new Error("Cannot find square root");let H=C,$=h.pow(h.mul(h.ONE,N),y),K=h.pow(V,k),be=h.pow(V,y);for(;!h.eql(be,h.ONE);){if(h.eql(be,h.ZERO))return h.ZERO;let Ce=1;for(let ye=h.sqr(be);Ce<H&&!h.eql(ye,h.ONE);Ce++)ye=h.sqr(ye);const Ee=h.pow($,ha<<BigInt(H-Ce-1));$=h.sqr(Ee),K=h.mul(K,Ee),be=h.mul(be,$),H=Ce}return K}}function Aw(c){if(c%uy===Ew){const f=(c+ha)/uy;return function(C,N){const k=C.pow(N,f);if(!C.eql(C.sqr(k),N))throw new Error("Cannot find square root");return k}}if(c%Hx===Gx){const f=(c-Gx)/Hx;return function(C,N){const k=C.mul(N,Gf),R=C.pow(k,f),h=C.mul(N,R),V=C.mul(C.mul(h,Gf),R),H=C.mul(h,C.sub(V,C.ONE));if(!C.eql(C.sqr(H),N))throw new Error("Cannot find square root");return H}}return Tw(c)}const Cw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Iw(c){const f={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},y=Cw.reduce((C,N)=>(C[N]="function",C),f);return Nm(c,y)}function Mw(c,f,y){if(y<Za)throw new Error("Expected power > 0");if(y===Za)return c.ONE;if(y===ha)return f;let C=c.ONE,N=f;for(;y>Za;)y&ha&&(C=c.mul(C,N)),N=c.sqr(N),y>>=ha;return C}function Rw(c,f){const y=new Array(f.length),C=f.reduce((k,R,h)=>c.is0(R)?k:(y[h]=k,c.mul(k,R)),c.ONE),N=c.inv(C);return f.reduceRight((k,R,h)=>c.is0(R)?k:(y[h]=c.mul(k,y[h]),c.mul(k,R)),N),y}function lb(c,f){const y=f!==void 0?f:c.toString(2).length,C=Math.ceil(y/8);return{nBitLength:y,nByteLength:C}}function Dw(c,f,y=!1,C={}){if(c<=Za)throw new Error(`Expected Field ORDER > 0, got ${c}`);const{nBitLength:N,nByteLength:k}=lb(c,f);if(k>2048)throw new Error("Field lengths over 2048 bytes are not supported");const R=Aw(c),h=Object.freeze({ORDER:c,BITS:N,BYTES:k,MASK:Ly(N),ZERO:Za,ONE:ha,create:V=>ho(V,c),isValid:V=>{if(typeof V!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof V}`);return Za<=V&&V<c},is0:V=>V===Za,isOdd:V=>(V&ha)===ha,neg:V=>ho(-V,c),eql:(V,H)=>V===H,sqr:V=>ho(V*V,c),add:(V,H)=>ho(V+H,c),sub:(V,H)=>ho(V-H,c),mul:(V,H)=>ho(V*H,c),pow:(V,H)=>Mw(h,V,H),div:(V,H)=>ho(V*hy(H,c),c),sqrN:V=>V*V,addN:(V,H)=>V+H,subN:(V,H)=>V-H,mulN:(V,H)=>V*H,inv:V=>hy(V,c),sqrt:C.sqrt||(V=>R(h,V)),invertBatch:V=>Rw(h,V),cmov:(V,H,$)=>$?H:V,toBytes:V=>y?zy(V,k):Pd(V,k),fromBytes:V=>{if(V.length!==k)throw new Error(`Fp.fromBytes: expected ${k}, got ${V.length}`);return y?Oy(V):Ml(V)}});return Object.freeze(h)}function cb(c){if(typeof c!="bigint")throw new Error("field order must be bigint");const f=c.toString(2).length;return Math.ceil(f/8)}function ub(c){const f=cb(c);return f+Math.ceil(f/2)}function Nw(c,f,y=!1){const C=c.length,N=cb(f),k=ub(f);if(C<16||C<k||C>1024)throw new Error(`expected ${k}-1024 bytes of input, got ${C}`);const R=y?Ml(c):Oy(c),h=ho(R,f-ha)+ha;return y?zy(h,N):Pd(h,N)}const kw=BigInt(0),W1=BigInt(1);function Pw(c,f){const y=(N,k)=>{const R=k.negate();return N?R:k},C=N=>{const k=Math.ceil(f/N)+1,R=2**(N-1);return{windows:k,windowSize:R}};return{constTimeNegate:y,unsafeLadder(N,k){let R=c.ZERO,h=N;for(;k>kw;)k&W1&&(R=R.add(h)),h=h.double(),k>>=W1;return R},precomputeWindow(N,k){const{windows:R,windowSize:h}=C(k),V=[];let H=N,$=H;for(let K=0;K<R;K++){$=H,V.push($);for(let be=1;be<h;be++)$=$.add(H),V.push($);H=$.double()}return V},wNAF(N,k,R){const{windows:h,windowSize:V}=C(N);let H=c.ZERO,$=c.BASE;const K=BigInt(2**N-1),be=2**N,Ce=BigInt(N);for(let Ee=0;Ee<h;Ee++){const ye=Ee*V;let he=Number(R&K);R>>=Ce,he>V&&(he-=be,R+=W1);const ke=ye,nt=ye+Math.abs(he)-1,Qe=Ee%2!==0,dt=he<0;he===0?$=$.add(y(Qe,k[ke])):H=H.add(y(dt,k[nt]))}return{p:H,f:$}},wNAFCached(N,k,R,h){const V=N._WINDOW_SIZE||1;let H=k.get(N);return H||(H=this.precomputeWindow(N,V),V!==1&&k.set(N,h(H))),this.wNAF(V,H,R)}}}function hb(c){return Iw(c.Fp),Nm(c,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lb(c.n,c.nBitLength),...c,p:c.Fp.ORDER})}function Ow(c){const f=hb(c);Nm(f,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:y,Fp:C,a:N}=f;if(y){if(!C.eql(N,C.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof y!="object"||typeof y.beta!="bigint"||typeof y.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...f})}const{bytesToNumberBE:zw,hexToBytes:Lw}=ww,qf={Err:class extends Error{constructor(f=""){super(f)}},_parseInt(c){const{Err:f}=qf;if(c.length<2||c[0]!==2)throw new f("Invalid signature integer tag");const y=c[1],C=c.subarray(2,y+2);if(!y||C.length!==y)throw new f("Invalid signature integer: wrong length");if(C[0]&128)throw new f("Invalid signature integer: negative");if(C[0]===0&&!(C[1]&128))throw new f("Invalid signature integer: unnecessary leading zero");return{d:zw(C),l:c.subarray(y+2)}},toSig(c){const{Err:f}=qf,y=typeof c=="string"?Lw(c):c;if(!(y instanceof Uint8Array))throw new Error("ui8a expected");let C=y.length;if(C<2||y[0]!=48)throw new f("Invalid signature tag");if(y[1]!==C-2)throw new f("Invalid signature: incorrect length");const{d:N,l:k}=qf._parseInt(y.subarray(2)),{d:R,l:h}=qf._parseInt(k);if(h.length)throw new f("Invalid signature: left bytes after parsing");return{r:N,s:R}},hexFromSig(c){const f=H=>Number.parseInt(H[0],16)&8?"00"+H:H,y=H=>{const $=H.toString(16);return $.length&1?`0${$}`:$},C=f(y(c.s)),N=f(y(c.r)),k=C.length/2,R=N.length/2,h=y(k),V=y(R);return`30${y(R+k+4)}02${V}${N}02${h}${C}`}},Dh=BigInt(0),Cc=BigInt(1);BigInt(2);const qx=BigInt(3);BigInt(4);function Bw(c){const f=Ow(c),{Fp:y}=f,C=f.toBytes||((Ee,ye,he)=>{const ke=ye.toAffine();return Wf(Uint8Array.from([4]),y.toBytes(ke.x),y.toBytes(ke.y))}),N=f.fromBytes||(Ee=>{const ye=Ee.subarray(1),he=y.fromBytes(ye.subarray(0,y.BYTES)),ke=y.fromBytes(ye.subarray(y.BYTES,2*y.BYTES));return{x:he,y:ke}});function k(Ee){const{a:ye,b:he}=f,ke=y.sqr(Ee),nt=y.mul(ke,Ee);return y.add(y.add(nt,y.mul(Ee,ye)),he)}if(!y.eql(y.sqr(f.Gy),k(f.Gx)))throw new Error("bad generator point: equation left != right");function R(Ee){return typeof Ee=="bigint"&&Dh<Ee&&Ee<f.n}function h(Ee){if(!R(Ee))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function V(Ee){const{allowedPrivateKeyLengths:ye,nByteLength:he,wrapPrivateKey:ke,n:nt}=f;if(ye&&typeof Ee!="bigint"){if(Ee instanceof Uint8Array&&(Ee=u0(Ee)),typeof Ee!="string"||!ye.includes(Ee.length))throw new Error("Invalid key");Ee=Ee.padStart(he*2,"0")}let Qe;try{Qe=typeof Ee=="bigint"?Ee:Ml(Do("private key",Ee,he))}catch{throw new Error(`private key must be ${he} bytes, hex or bigint, not ${typeof Ee}`)}return ke&&(Qe=ho(Qe,nt)),h(Qe),Qe}const H=new Map;function $(Ee){if(!(Ee instanceof K))throw new Error("ProjectivePoint expected")}class K{constructor(ye,he,ke){if(this.px=ye,this.py=he,this.pz=ke,ye==null||!y.isValid(ye))throw new Error("x required");if(he==null||!y.isValid(he))throw new Error("y required");if(ke==null||!y.isValid(ke))throw new Error("z required")}static fromAffine(ye){const{x:he,y:ke}=ye||{};if(!ye||!y.isValid(he)||!y.isValid(ke))throw new Error("invalid affine point");if(ye instanceof K)throw new Error("projective point not allowed");const nt=Qe=>y.eql(Qe,y.ZERO);return nt(he)&&nt(ke)?K.ZERO:new K(he,ke,y.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(ye){const he=y.invertBatch(ye.map(ke=>ke.pz));return ye.map((ke,nt)=>ke.toAffine(he[nt])).map(K.fromAffine)}static fromHex(ye){const he=K.fromAffine(N(Do("pointHex",ye)));return he.assertValidity(),he}static fromPrivateKey(ye){return K.BASE.multiply(V(ye))}_setWindowSize(ye){this._WINDOW_SIZE=ye,H.delete(this)}assertValidity(){if(this.is0()){if(f.allowInfinityPoint&&!y.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:ye,y:he}=this.toAffine();if(!y.isValid(ye)||!y.isValid(he))throw new Error("bad point: x or y not FE");const ke=y.sqr(he),nt=k(ye);if(!y.eql(ke,nt))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:ye}=this.toAffine();if(y.isOdd)return!y.isOdd(ye);throw new Error("Field doesn't support isOdd")}equals(ye){$(ye);const{px:he,py:ke,pz:nt}=this,{px:Qe,py:dt,pz:Ut}=ye,wt=y.eql(y.mul(he,Ut),y.mul(Qe,nt)),tt=y.eql(y.mul(ke,Ut),y.mul(dt,nt));return wt&&tt}negate(){return new K(this.px,y.neg(this.py),this.pz)}double(){const{a:ye,b:he}=f,ke=y.mul(he,qx),{px:nt,py:Qe,pz:dt}=this;let Ut=y.ZERO,wt=y.ZERO,tt=y.ZERO,Je=y.mul(nt,nt),He=y.mul(Qe,Qe),pt=y.mul(dt,dt),Pe=y.mul(nt,Qe);return Pe=y.add(Pe,Pe),tt=y.mul(nt,dt),tt=y.add(tt,tt),Ut=y.mul(ye,tt),wt=y.mul(ke,pt),wt=y.add(Ut,wt),Ut=y.sub(He,wt),wt=y.add(He,wt),wt=y.mul(Ut,wt),Ut=y.mul(Pe,Ut),tt=y.mul(ke,tt),pt=y.mul(ye,pt),Pe=y.sub(Je,pt),Pe=y.mul(ye,Pe),Pe=y.add(Pe,tt),tt=y.add(Je,Je),Je=y.add(tt,Je),Je=y.add(Je,pt),Je=y.mul(Je,Pe),wt=y.add(wt,Je),pt=y.mul(Qe,dt),pt=y.add(pt,pt),Je=y.mul(pt,Pe),Ut=y.sub(Ut,Je),tt=y.mul(pt,He),tt=y.add(tt,tt),tt=y.add(tt,tt),new K(Ut,wt,tt)}add(ye){$(ye);const{px:he,py:ke,pz:nt}=this,{px:Qe,py:dt,pz:Ut}=ye;let wt=y.ZERO,tt=y.ZERO,Je=y.ZERO;const He=f.a,pt=y.mul(f.b,qx);let Pe=y.mul(he,Qe),ot=y.mul(ke,dt),gt=y.mul(nt,Ut),Rt=y.add(he,ke),Ie=y.add(Qe,dt);Rt=y.mul(Rt,Ie),Ie=y.add(Pe,ot),Rt=y.sub(Rt,Ie),Ie=y.add(he,nt);let Se=y.add(Qe,Ut);return Ie=y.mul(Ie,Se),Se=y.add(Pe,gt),Ie=y.sub(Ie,Se),Se=y.add(ke,nt),wt=y.add(dt,Ut),Se=y.mul(Se,wt),wt=y.add(ot,gt),Se=y.sub(Se,wt),Je=y.mul(He,Ie),wt=y.mul(pt,gt),Je=y.add(wt,Je),wt=y.sub(ot,Je),Je=y.add(ot,Je),tt=y.mul(wt,Je),ot=y.add(Pe,Pe),ot=y.add(ot,Pe),gt=y.mul(He,gt),Ie=y.mul(pt,Ie),ot=y.add(ot,gt),gt=y.sub(Pe,gt),gt=y.mul(He,gt),Ie=y.add(Ie,gt),Pe=y.mul(ot,Ie),tt=y.add(tt,Pe),Pe=y.mul(Se,Ie),wt=y.mul(Rt,wt),wt=y.sub(wt,Pe),Pe=y.mul(Rt,ot),Je=y.mul(Se,Je),Je=y.add(Je,Pe),new K(wt,tt,Je)}subtract(ye){return this.add(ye.negate())}is0(){return this.equals(K.ZERO)}wNAF(ye){return Ce.wNAFCached(this,H,ye,he=>{const ke=y.invertBatch(he.map(nt=>nt.pz));return he.map((nt,Qe)=>nt.toAffine(ke[Qe])).map(K.fromAffine)})}multiplyUnsafe(ye){const he=K.ZERO;if(ye===Dh)return he;if(h(ye),ye===Cc)return this;const{endo:ke}=f;if(!ke)return Ce.unsafeLadder(this,ye);let{k1neg:nt,k1:Qe,k2neg:dt,k2:Ut}=ke.splitScalar(ye),wt=he,tt=he,Je=this;for(;Qe>Dh||Ut>Dh;)Qe&Cc&&(wt=wt.add(Je)),Ut&Cc&&(tt=tt.add(Je)),Je=Je.double(),Qe>>=Cc,Ut>>=Cc;return nt&&(wt=wt.negate()),dt&&(tt=tt.negate()),tt=new K(y.mul(tt.px,ke.beta),tt.py,tt.pz),wt.add(tt)}multiply(ye){h(ye);let he=ye,ke,nt;const{endo:Qe}=f;if(Qe){const{k1neg:dt,k1:Ut,k2neg:wt,k2:tt}=Qe.splitScalar(he);let{p:Je,f:He}=this.wNAF(Ut),{p:pt,f:Pe}=this.wNAF(tt);Je=Ce.constTimeNegate(dt,Je),pt=Ce.constTimeNegate(wt,pt),pt=new K(y.mul(pt.px,Qe.beta),pt.py,pt.pz),ke=Je.add(pt),nt=He.add(Pe)}else{const{p:dt,f:Ut}=this.wNAF(he);ke=dt,nt=Ut}return K.normalizeZ([ke,nt])[0]}multiplyAndAddUnsafe(ye,he,ke){const nt=K.BASE,Qe=(Ut,wt)=>wt===Dh||wt===Cc||!Ut.equals(nt)?Ut.multiplyUnsafe(wt):Ut.multiply(wt),dt=Qe(this,he).add(Qe(ye,ke));return dt.is0()?void 0:dt}toAffine(ye){const{px:he,py:ke,pz:nt}=this,Qe=this.is0();ye==null&&(ye=Qe?y.ONE:y.inv(nt));const dt=y.mul(he,ye),Ut=y.mul(ke,ye),wt=y.mul(nt,ye);if(Qe)return{x:y.ZERO,y:y.ZERO};if(!y.eql(wt,y.ONE))throw new Error("invZ was invalid");return{x:dt,y:Ut}}isTorsionFree(){const{h:ye,isTorsionFree:he}=f;if(ye===Cc)return!0;if(he)return he(K,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:ye,clearCofactor:he}=f;return ye===Cc?this:he?he(K,this):this.multiplyUnsafe(f.h)}toRawBytes(ye=!0){return this.assertValidity(),C(K,this,ye)}toHex(ye=!0){return u0(this.toRawBytes(ye))}}K.BASE=new K(f.Gx,f.Gy,y.ONE),K.ZERO=new K(y.ZERO,y.ONE,y.ZERO);const be=f.nBitLength,Ce=Pw(K,f.endo?Math.ceil(be/2):be);return{CURVE:f,ProjectivePoint:K,normPrivateKeyToScalar:V,weierstrassEquation:k,isWithinCurveOrder:R}}function Fw(c){const f=hb(c);return Nm(f,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...f})}function jw(c){const f=Fw(c),{Fp:y,n:C}=f,N=y.BYTES+1,k=2*y.BYTES+1;function R(Ie){return Dh<Ie&&Ie<y.ORDER}function h(Ie){return ho(Ie,C)}function V(Ie){return hy(Ie,C)}const{ProjectivePoint:H,normPrivateKeyToScalar:$,weierstrassEquation:K,isWithinCurveOrder:be}=Bw({...f,toBytes(Ie,Se,je){const st=Se.toAffine(),mt=y.toBytes(st.x),Xt=Wf;return je?Xt(Uint8Array.from([Se.hasEvenY()?2:3]),mt):Xt(Uint8Array.from([4]),mt,y.toBytes(st.y))},fromBytes(Ie){const Se=Ie.length,je=Ie[0],st=Ie.subarray(1);if(Se===N&&(je===2||je===3)){const mt=Ml(st);if(!R(mt))throw new Error("Point is not on curve");const Xt=K(mt);let Oe=y.sqrt(Xt);const Xe=(Oe&Cc)===Cc;return(je&1)===1!==Xe&&(Oe=y.neg(Oe)),{x:mt,y:Oe}}else if(Se===k&&je===4){const mt=y.fromBytes(st.subarray(0,y.BYTES)),Xt=y.fromBytes(st.subarray(y.BYTES,2*y.BYTES));return{x:mt,y:Xt}}else throw new Error(`Point of length ${Se} was invalid. Expected ${N} compressed bytes or ${k} uncompressed bytes`)}}),Ce=Ie=>u0(Pd(Ie,f.nByteLength));function Ee(Ie){const Se=C>>Cc;return Ie>Se}function ye(Ie){return Ee(Ie)?h(-Ie):Ie}const he=(Ie,Se,je)=>Ml(Ie.slice(Se,je));class ke{constructor(Se,je,st){this.r=Se,this.s=je,this.recovery=st,this.assertValidity()}static fromCompact(Se){const je=f.nByteLength;return Se=Do("compactSignature",Se,je*2),new ke(he(Se,0,je),he(Se,je,2*je))}static fromDER(Se){const{r:je,s:st}=qf.toSig(Do("DER",Se));return new ke(je,st)}assertValidity(){if(!be(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!be(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Se){return new ke(this.r,this.s,Se)}recoverPublicKey(Se){const{r:je,s:st,recovery:mt}=this,Xt=tt(Do("msgHash",Se));if(mt==null||![0,1,2,3].includes(mt))throw new Error("recovery id invalid");const Oe=mt===2||mt===3?je+f.n:je;if(Oe>=y.ORDER)throw new Error("recovery id 2 or 3 invalid");const Xe=(mt&1)===0?"02":"03",It=H.fromHex(Xe+Ce(Oe)),Nt=V(Oe),$t=h(-Xt*Nt),Bt=h(st*Nt),Mn=H.BASE.multiplyAndAddUnsafe(It,$t,Bt);if(!Mn)throw new Error("point at infinify");return Mn.assertValidity(),Mn}hasHighS(){return Ee(this.s)}normalizeS(){return this.hasHighS()?new ke(this.r,h(-this.s),this.recovery):this}toDERRawBytes(){return h0(this.toDERHex())}toDERHex(){return qf.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return h0(this.toCompactHex())}toCompactHex(){return Ce(this.r)+Ce(this.s)}}const nt={isValidPrivateKey(Ie){try{return $(Ie),!0}catch{return!1}},normPrivateKeyToScalar:$,randomPrivateKey:()=>{const Ie=ub(f.n);return Nw(f.randomBytes(Ie),f.n)},precompute(Ie=8,Se=H.BASE){return Se._setWindowSize(Ie),Se.multiply(BigInt(3)),Se}};function Qe(Ie,Se=!0){return H.fromPrivateKey(Ie).toRawBytes(Se)}function dt(Ie){const Se=Ie instanceof Uint8Array,je=typeof Ie=="string",st=(Se||je)&&Ie.length;return Se?st===N||st===k:je?st===2*N||st===2*k:Ie instanceof H}function Ut(Ie,Se,je=!0){if(dt(Ie))throw new Error("first arg must be private key");if(!dt(Se))throw new Error("second arg must be public key");return H.fromHex(Se).multiply($(Ie)).toRawBytes(je)}const wt=f.bits2int||function(Ie){const Se=Ml(Ie),je=Ie.length*8-f.nBitLength;return je>0?Se>>BigInt(je):Se},tt=f.bits2int_modN||function(Ie){return h(wt(Ie))},Je=Ly(f.nBitLength);function He(Ie){if(typeof Ie!="bigint")throw new Error("bigint expected");if(!(Dh<=Ie&&Ie<Je))throw new Error(`bigint expected < 2^${f.nBitLength}`);return Pd(Ie,f.nByteLength)}function pt(Ie,Se,je=Pe){if(["recovered","canonical"].some(Rn=>Rn in je))throw new Error("sign() legacy options not supported");const{hash:st,randomBytes:mt}=f;let{lowS:Xt,prehash:Oe,extraEntropy:Xe}=je;Xt==null&&(Xt=!0),Ie=Do("msgHash",Ie),Oe&&(Ie=Do("prehashed msgHash",st(Ie)));const It=tt(Ie),Nt=$(Se),$t=[He(Nt),He(It)];if(Xe!=null){const Rn=Xe===!0?mt(y.BYTES):Xe;$t.push(Do("extraEntropy",Rn))}const Bt=Wf(...$t),Mn=It;function Tn(Rn){const ri=wt(Rn);if(!be(ri))return;const _i=V(ri),$n=H.BASE.multiply(ri).toAffine(),Kn=h($n.x);if(Kn===Dh)return;const Qn=h(_i*h(Mn+Kn*Nt));if(Qn===Dh)return;let ti=($n.x===Kn?0:2)|Number($n.y&Cc),Bi=Qn;return Xt&&Ee(Qn)&&(Bi=ye(Qn),ti^=1),new ke(Kn,Bi,ti)}return{seed:Bt,k2sig:Tn}}const Pe={lowS:f.lowS,prehash:!1},ot={lowS:f.lowS,prehash:!1};function gt(Ie,Se,je=Pe){const{seed:st,k2sig:mt}=pt(Ie,Se,je),Xt=f;return ob(Xt.hash.outputLen,Xt.nByteLength,Xt.hmac)(st,mt)}H.BASE._setWindowSize(8);function Rt(Ie,Se,je,st=ot){const mt=Ie;if(Se=Do("msgHash",Se),je=Do("publicKey",je),"strict"in st)throw new Error("options.strict was renamed to lowS");const{lowS:Xt,prehash:Oe}=st;let Xe,It;try{if(typeof mt=="string"||mt instanceof Uint8Array)try{Xe=ke.fromDER(mt)}catch($n){if(!($n instanceof qf.Err))throw $n;Xe=ke.fromCompact(mt)}else if(typeof mt=="object"&&typeof mt.r=="bigint"&&typeof mt.s=="bigint"){const{r:$n,s:Kn}=mt;Xe=new ke($n,Kn)}else throw new Error("PARSE");It=H.fromHex(je)}catch($n){if($n.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Xt&&Xe.hasHighS())return!1;Oe&&(Se=f.hash(Se));const{r:Nt,s:$t}=Xe,Bt=tt(Se),Mn=V($t),Tn=h(Bt*Mn),Rn=h(Nt*Mn),ri=H.BASE.multiplyAndAddUnsafe(It,Tn,Rn)?.toAffine();return ri?h(ri.x)===Nt:!1}return{CURVE:f,getPublicKey:Qe,getSharedSecret:Ut,sign:gt,verify:Rt,ProjectivePoint:H,Signature:ke,utils:nt}}let db=class extends ib{constructor(f,y){super(),this.finished=!1,this.destroyed=!1,tw(f);const C=ky(y);if(this.iHash=f.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const N=this.blockLen,k=new Uint8Array(N);k.set(C.length>N?f.create().update(C).digest():C);for(let R=0;R<k.length;R++)k[R]^=54;this.iHash.update(k),this.oHash=f.create();for(let R=0;R<k.length;R++)k[R]^=106;this.oHash.update(k),k.fill(0)}update(f){return Hg(this),this.iHash.update(f),this}digestInto(f){Hg(this),tb(f,this.outputLen),this.finished=!0,this.iHash.digestInto(f),this.oHash.update(f),this.oHash.digestInto(f),this.destroy()}digest(){const f=new Uint8Array(this.oHash.outputLen);return this.digestInto(f),f}_cloneInto(f){f||(f=Object.create(Object.getPrototypeOf(this),{}));const{oHash:y,iHash:C,finished:N,destroyed:k,blockLen:R,outputLen:h}=this;return f=f,f.finished=N,f.destroyed=k,f.blockLen=R,f.outputLen=h,f.oHash=y._cloneInto(f.oHash),f.iHash=C._cloneInto(f.iHash),f}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const fb=(c,f,y)=>new db(c,f).update(y).digest();fb.create=(c,f)=>new db(c,f);function Uw(c){return{hash:c,hmac:(f,...y)=>fb(c,f,sw(...y)),randomBytes:rb}}function Vw(c,f){const y=C=>jw({...c,...Uw(C)});return Object.freeze({...y(f),create:y})}const a1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),qg=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),pb=BigInt(1),Zg=BigInt(2),Zx=(c,f)=>(c+f/Zg)/f;function mb(c){const f=a1,y=BigInt(3),C=BigInt(6),N=BigInt(11),k=BigInt(22),R=BigInt(23),h=BigInt(44),V=BigInt(88),H=c*c*c%f,$=H*H*c%f,K=Ac($,y,f)*$%f,be=Ac(K,y,f)*$%f,Ce=Ac(be,Zg,f)*H%f,Ee=Ac(Ce,N,f)*Ce%f,ye=Ac(Ee,k,f)*Ee%f,he=Ac(ye,h,f)*ye%f,ke=Ac(he,V,f)*he%f,nt=Ac(ke,h,f)*ye%f,Qe=Ac(nt,y,f)*$%f,dt=Ac(Qe,R,f)*Ee%f,Ut=Ac(dt,C,f)*H%f,wt=Ac(Ut,Zg,f);if(!dy.eql(dy.sqr(wt),c))throw new Error("Cannot find square root");return wt}const dy=Dw(a1,void 0,void 0,{sqrt:mb}),p0=Vw({a:BigInt(0),b:BigInt(7),Fp:dy,n:qg,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:c=>{const f=qg,y=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),C=-pb*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),N=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),k=y,R=BigInt("0x100000000000000000000000000000000"),h=Zx(k*c,f),V=Zx(-C*c,f);let H=ho(c-h*y-V*N,f),$=ho(-h*C-V*k,f);const K=H>R,be=$>R;if(K&&(H=f-H),be&&($=f-$),H>R||$>R)throw new Error("splitScalar: Endomorphism failed, k="+c);return{k1neg:K,k1:H,k2neg:be,k2:$}}}},cy),o1=BigInt(0),gb=c=>typeof c=="bigint"&&o1<c&&c<a1,Gw=c=>typeof c=="bigint"&&o1<c&&c<qg,Xx={};function Xg(c,...f){let y=Xx[c];if(y===void 0){const C=cy(Uint8Array.from(c,N=>N.charCodeAt(0)));y=Wf(C,C),Xx[c]=y}return cy(Wf(y,...f))}const By=c=>c.toRawBytes(!0).slice(1),fy=c=>Pd(c,32),Y1=c=>ho(c,a1),Sm=c=>ho(c,qg),Fy=p0.ProjectivePoint,Hw=(c,f,y)=>Fy.BASE.multiplyAndAddUnsafe(c,f,y);function py(c){let f=p0.utils.normPrivateKeyToScalar(c),y=Fy.fromPrivateKey(f);return{scalar:y.hasEvenY()?f:Sm(-f),bytes:By(y)}}function yb(c){if(!gb(c))throw new Error("bad x: need 0 < x < p");const f=Y1(c*c),y=Y1(f*c+BigInt(7));let C=mb(y);C%Zg!==o1&&(C=Y1(-C));const N=new Fy(c,C,pb);return N.assertValidity(),N}function xb(...c){return Sm(Ml(Xg("BIP0340/challenge",...c)))}function qw(c){return py(c).bytes}function Zw(c,f,y=rb(32)){const C=Do("message",c),{bytes:N,scalar:k}=py(f),R=Do("auxRand",y,32),h=fy(k^Ml(Xg("BIP0340/aux",R))),V=Xg("BIP0340/nonce",h,N,C),H=Sm(Ml(V));if(H===o1)throw new Error("sign failed: k is zero");const{bytes:$,scalar:K}=py(H),be=xb($,N,C),Ce=new Uint8Array(64);if(Ce.set($,0),Ce.set(fy(Sm(K+be*k)),32),!_b(Ce,C,N))throw new Error("sign: Invalid signature produced");return Ce}function _b(c,f,y){const C=Do("signature",c,64),N=Do("message",f),k=Do("publicKey",y,32);try{const R=yb(Ml(k)),h=Ml(C.subarray(0,32));if(!gb(h))return!1;const V=Ml(C.subarray(32,64));if(!Gw(V))return!1;const H=xb(fy(h),By(R),N),$=Hw(R,V,Sm(-H));return!(!$||!$.hasEvenY()||$.toAffine().x!==h)}catch{return!1}}const Gu={getPublicKey:qw,sign:Zw,verify:_b,utils:{randomPrivateKey:p0.utils.randomPrivateKey,lift_x:yb,pointToBytes:By,numberToBytesBE:Pd,bytesToNumberBE:Ml,taggedHash:Xg,mod:ho}},$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const jy=c=>c instanceof Uint8Array,K1=c=>new DataView(c.buffer,c.byteOffset,c.byteLength),Vu=(c,f)=>c<<32-f|c>>>f,Xw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Xw)throw new Error("Non little-endian hardware is not supported");const Ww=Array.from({length:256},(c,f)=>f.toString(16).padStart(2,"0"));function ss(c){if(!jy(c))throw new Error("Uint8Array expected");let f="";for(let y=0;y<c.length;y++)f+=Ww[c[y]];return f}function Od(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const f=c.length;if(f%2)throw new Error("padded hex string expected, got unpadded hex of length "+f);const y=new Uint8Array(f/2);for(let C=0;C<y.length;C++){const N=C*2,k=c.slice(N,N+2),R=Number.parseInt(k,16);if(Number.isNaN(R)||R<0)throw new Error("Invalid byte sequence");y[C]=R}return y}function Yw(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function Tm(c){if(typeof c=="string"&&(c=Yw(c)),!jy(c))throw new Error(`expected Uint8Array, got ${typeof c}`);return c}function l1(...c){const f=new Uint8Array(c.reduce((C,N)=>C+N.length,0));let y=0;return c.forEach(C=>{if(!jy(C))throw new Error("Uint8Array expected");f.set(C,y),y+=C.length}),f}class bb{clone(){return this._cloneInto()}}function vb(c){const f=C=>c().update(Tm(C)).digest(),y=c();return f.outputLen=y.outputLen,f.blockLen=y.blockLen,f.create=()=>c(),f}function wb(c=32){if($1&&typeof $1.getRandomValues=="function")return $1.getRandomValues(new Uint8Array(c));throw new Error("crypto.getRandomValues must be defined")}function my(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`Wrong positive integer: ${c}`)}function $w(c){if(typeof c!="boolean")throw new Error(`Expected boolean, not ${c}`)}function Eb(c,...f){if(!(c instanceof Uint8Array))throw new Error("Expected Uint8Array");if(f.length>0&&!f.includes(c.length))throw new Error(`Expected Uint8Array of length ${f}, not of length=${c.length}`)}function Kw(c){if(typeof c!="function"||typeof c.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");my(c.outputLen),my(c.blockLen)}function Qw(c,f=!0){if(c.destroyed)throw new Error("Hash instance has been destroyed");if(f&&c.finished)throw new Error("Hash#digest() has already been called")}function Jw(c,f){Eb(c);const y=f.outputLen;if(c.length<y)throw new Error(`digestInto() expects output buffer of length at least ${y}`)}const Hu={number:my,bool:$w,bytes:Eb,hash:Kw,exists:Qw,output:Jw};function eE(c,f,y,C){if(typeof c.setBigUint64=="function")return c.setBigUint64(f,y,C);const N=BigInt(32),k=BigInt(4294967295),R=Number(y>>N&k),h=Number(y&k),V=C?4:0,H=C?0:4;c.setUint32(f+V,R,C),c.setUint32(f+H,h,C)}class tE extends bb{constructor(f,y,C,N){super(),this.blockLen=f,this.outputLen=y,this.padOffset=C,this.isLE=N,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(f),this.view=K1(this.buffer)}update(f){Hu.exists(this);const{view:y,buffer:C,blockLen:N}=this;f=Tm(f);const k=f.length;for(let R=0;R<k;){const h=Math.min(N-this.pos,k-R);if(h===N){const V=K1(f);for(;N<=k-R;R+=N)this.process(V,R);continue}C.set(f.subarray(R,R+h),this.pos),this.pos+=h,R+=h,this.pos===N&&(this.process(y,0),this.pos=0)}return this.length+=f.length,this.roundClean(),this}digestInto(f){Hu.exists(this),Hu.output(f,this),this.finished=!0;const{buffer:y,view:C,blockLen:N,isLE:k}=this;let{pos:R}=this;y[R++]=128,this.buffer.subarray(R).fill(0),this.padOffset>N-R&&(this.process(C,0),R=0);for(let K=R;K<N;K++)y[K]=0;eE(C,N-8,BigInt(this.length*8),k),this.process(C,0);const h=K1(f),V=this.outputLen;if(V%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const H=V/4,$=this.get();if(H>$.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<H;K++)h.setUint32(4*K,$[K],k)}digest(){const{buffer:f,outputLen:y}=this;this.digestInto(f);const C=f.slice(0,y);return this.destroy(),C}_cloneInto(f){f||(f=new this.constructor),f.set(...this.get());const{blockLen:y,buffer:C,length:N,finished:k,destroyed:R,pos:h}=this;return f.length=N,f.pos=h,f.finished=k,f.destroyed=R,N%y&&f.buffer.set(C),f}}const nE=(c,f,y)=>c&f^~c&y,iE=(c,f,y)=>c&f^c&y^f&y,rE=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Md=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Rd=new Uint32Array(64);class Sb extends tE{constructor(){super(64,32,8,!1),this.A=Md[0]|0,this.B=Md[1]|0,this.C=Md[2]|0,this.D=Md[3]|0,this.E=Md[4]|0,this.F=Md[5]|0,this.G=Md[6]|0,this.H=Md[7]|0}get(){const{A:f,B:y,C,D:N,E:k,F:R,G:h,H:V}=this;return[f,y,C,N,k,R,h,V]}set(f,y,C,N,k,R,h,V){this.A=f|0,this.B=y|0,this.C=C|0,this.D=N|0,this.E=k|0,this.F=R|0,this.G=h|0,this.H=V|0}process(f,y){for(let K=0;K<16;K++,y+=4)Rd[K]=f.getUint32(y,!1);for(let K=16;K<64;K++){const be=Rd[K-15],Ce=Rd[K-2],Ee=Vu(be,7)^Vu(be,18)^be>>>3,ye=Vu(Ce,17)^Vu(Ce,19)^Ce>>>10;Rd[K]=ye+Rd[K-7]+Ee+Rd[K-16]|0}let{A:C,B:N,C:k,D:R,E:h,F:V,G:H,H:$}=this;for(let K=0;K<64;K++){const be=Vu(h,6)^Vu(h,11)^Vu(h,25),Ce=$+be+nE(h,V,H)+rE[K]+Rd[K]|0,ye=(Vu(C,2)^Vu(C,13)^Vu(C,22))+iE(C,N,k)|0;$=H,H=V,V=h,h=R+Ce|0,R=k,k=N,N=C,C=Ce+ye|0}C=C+this.A|0,N=N+this.B|0,k=k+this.C|0,R=R+this.D|0,h=h+this.E|0,V=V+this.F|0,H=H+this.G|0,$=$+this.H|0,this.set(C,N,k,R,h,V,H,$)}roundClean(){Rd.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class sE extends Sb{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const zd=vb(()=>new Sb);vb(()=>new sE);function m0(c){if(!Number.isSafeInteger(c))throw new Error(`Wrong integer: ${c}`)}function zh(...c){const f=(N,k)=>R=>N(k(R)),y=Array.from(c).reverse().reduce((N,k)=>N?f(N,k.encode):k.encode,void 0),C=c.reduce((N,k)=>N?f(N,k.decode):k.decode,void 0);return{encode:y,decode:C}}function Lh(c){return{encode:f=>{if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return f.map(y=>{if(m0(y),y<0||y>=c.length)throw new Error(`Digit index outside alphabet: ${y} (alphabet: ${c.length})`);return c[y]})},decode:f=>{if(!Array.isArray(f)||f.length&&typeof f[0]!="string")throw new Error("alphabet.decode input should be array of strings");return f.map(y=>{if(typeof y!="string")throw new Error(`alphabet.decode: not string element=${y}`);const C=c.indexOf(y);if(C===-1)throw new Error(`Unknown letter: "${y}". Allowed: ${c}`);return C})}}}function Bh(c=""){if(typeof c!="string")throw new Error("join separator should be string");return{encode:f=>{if(!Array.isArray(f)||f.length&&typeof f[0]!="string")throw new Error("join.encode input should be array of strings");for(let y of f)if(typeof y!="string")throw new Error(`join.encode: non-string input=${y}`);return f.join(c)},decode:f=>{if(typeof f!="string")throw new Error("join.decode input should be string");return f.split(c)}}}function c1(c,f="="){if(m0(c),typeof f!="string")throw new Error("padding chr should be string");return{encode(y){if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("padding.encode input should be array of strings");for(let C of y)if(typeof C!="string")throw new Error(`padding.encode: non-string input=${C}`);for(;y.length*c%8;)y.push(f);return y},decode(y){if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("padding.encode input should be array of strings");for(let N of y)if(typeof N!="string")throw new Error(`padding.decode: non-string input=${N}`);let C=y.length;if(C*c%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;C>0&&y[C-1]===f;C--)if(!((C-1)*c%8))throw new Error("Invalid padding: string has too much padding");return y.slice(0,C)}}}function Tb(c){if(typeof c!="function")throw new Error("normalize fn should be function");return{encode:f=>f,decode:f=>c(f)}}function Wx(c,f,y){if(f<2)throw new Error(`convertRadix: wrong from=${f}, base cannot be less than 2`);if(y<2)throw new Error(`convertRadix: wrong to=${y}, base cannot be less than 2`);if(!Array.isArray(c))throw new Error("convertRadix: data should be array");if(!c.length)return[];let C=0;const N=[],k=Array.from(c);for(k.forEach(R=>{if(m0(R),R<0||R>=f)throw new Error(`Wrong integer: ${R}`)});;){let R=0,h=!0;for(let V=C;V<k.length;V++){const H=k[V],$=f*R+H;if(!Number.isSafeInteger($)||f*R/f!==R||$-H!==f*R)throw new Error("convertRadix: carry overflow");if(R=$%y,k[V]=Math.floor($/y),!Number.isSafeInteger(k[V])||k[V]*y+R!==$)throw new Error("convertRadix: carry overflow");if(h)k[V]?h=!1:C=V;else continue}if(N.push(R),h)break}for(let R=0;R<c.length-1&&c[R]===0;R++)N.push(0);return N.reverse()}const Ab=(c,f)=>f?Ab(f,c%f):c,Wg=(c,f)=>c+(f-Ab(c,f));function gy(c,f,y,C){if(!Array.isArray(c))throw new Error("convertRadix2: data should be array");if(f<=0||f>32)throw new Error(`convertRadix2: wrong from=${f}`);if(y<=0||y>32)throw new Error(`convertRadix2: wrong to=${y}`);if(Wg(f,y)>32)throw new Error(`convertRadix2: carry overflow from=${f} to=${y} carryBits=${Wg(f,y)}`);let N=0,k=0;const R=2**y-1,h=[];for(const V of c){if(m0(V),V>=2**f)throw new Error(`convertRadix2: invalid data word=${V} from=${f}`);if(N=N<<f|V,k+f>32)throw new Error(`convertRadix2: carry overflow pos=${k} from=${f}`);for(k+=f;k>=y;k-=y)h.push((N>>k-y&R)>>>0);N&=2**k-1}if(N=N<<y-k&R,!C&&k>=f)throw new Error("Excess padding");if(!C&&N)throw new Error(`Non-zero padding: ${N}`);return C&&k>0&&h.push(N>>>0),h}function aE(c){return m0(c),{encode:f=>{if(!(f instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Wx(Array.from(f),2**8,c)},decode:f=>{if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Wx(f,c,2**8))}}}function Ld(c,f=!1){if(m0(c),c<=0||c>32)throw new Error("radix2: bits should be in (0..32]");if(Wg(8,c)>32||Wg(c,8)>32)throw new Error("radix2: carry overflow");return{encode:y=>{if(!(y instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return gy(Array.from(y),8,c,!f)},decode:y=>{if(!Array.isArray(y)||y.length&&typeof y[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(gy(y,c,8,f))}}}function Yx(c){if(typeof c!="function")throw new Error("unsafeWrapper fn should be function");return function(...f){try{return c.apply(null,f)}catch{}}}const oE=zh(Ld(4),Lh("0123456789ABCDEF"),Bh("")),lE=zh(Ld(5),Lh("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),c1(5),Bh(""));zh(Ld(5),Lh("0123456789ABCDEFGHIJKLMNOPQRSTUV"),c1(5),Bh(""));zh(Ld(5),Lh("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Bh(""),Tb(c=>c.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Ph=zh(Ld(6),Lh("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),c1(6),Bh("")),cE=zh(Ld(6),Lh("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),c1(6),Bh("")),Uy=c=>zh(aE(58),Lh(c),Bh("")),yy=Uy("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Uy("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Uy("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const $x=[0,2,3,5,6,7,9,10,11],uE={encode(c){let f="";for(let y=0;y<c.length;y+=8){const C=c.subarray(y,y+8);f+=yy.encode(C).padStart($x[C.length],"1")}return f},decode(c){let f=[];for(let y=0;y<c.length;y+=11){const C=c.slice(y,y+11),N=$x.indexOf(C.length),k=yy.decode(C);for(let R=0;R<k.length-N;R++)if(k[R]!==0)throw new Error("base58xmr: wrong padding");f=f.concat(Array.from(k.slice(k.length-N)))}return Uint8Array.from(f)}},xy=zh(Lh("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Bh("")),Kx=[996825010,642813549,513874426,1027748829,705979059];function wm(c){const f=c>>25;let y=(c&33554431)<<5;for(let C=0;C<Kx.length;C++)(f>>C&1)===1&&(y^=Kx[C]);return y}function Qx(c,f,y=1){const C=c.length;let N=1;for(let k=0;k<C;k++){const R=c.charCodeAt(k);if(R<33||R>126)throw new Error(`Invalid prefix (${c})`);N=wm(N)^R>>5}N=wm(N);for(let k=0;k<C;k++)N=wm(N)^c.charCodeAt(k)&31;for(let k of f)N=wm(N)^k;for(let k=0;k<6;k++)N=wm(N);return N^=y,xy.encode(gy([N%2**30],30,5,!1))}function Cb(c){const f=c==="bech32"?1:734539939,y=Ld(5),C=y.decode,N=y.encode,k=Yx(C);function R($,K,be=90){if(typeof $!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof $}`);if(!Array.isArray(K)||K.length&&typeof K[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof K}`);const Ce=$.length+7+K.length;if(be!==!1&&Ce>be)throw new TypeError(`Length ${Ce} exceeds limit ${be}`);return $=$.toLowerCase(),`${$}1${xy.encode(K)}${Qx($,K,f)}`}function h($,K=90){if(typeof $!="string")throw new Error(`bech32.decode input should be string, not ${typeof $}`);if($.length<8||K!==!1&&$.length>K)throw new TypeError(`Wrong string length: ${$.length} (${$}). Expected (8..${K})`);const be=$.toLowerCase();if($!==be&&$!==$.toUpperCase())throw new Error("String must be lowercase or uppercase");$=be;const Ce=$.lastIndexOf("1");if(Ce===0||Ce===-1)throw new Error('Letter "1" must be present between prefix and data only');const Ee=$.slice(0,Ce),ye=$.slice(Ce+1);if(ye.length<6)throw new Error("Data must be at least 6 characters long");const he=xy.decode(ye).slice(0,-6),ke=Qx(Ee,he,f);if(!ye.endsWith(ke))throw new Error(`Invalid checksum in ${$}: expected "${ke}"`);return{prefix:Ee,words:he}}const V=Yx(h);function H($){const{prefix:K,words:be}=h($,!1);return{prefix:K,words:be,bytes:C(be)}}return{encode:R,decode:h,decodeToBytes:H,decodeUnsafe:V,fromWords:C,fromWordsUnsafe:k,toWords:N}}const Xu=Cb("bech32");Cb("bech32m");const hE={encode:c=>new TextDecoder().decode(c),decode:c=>new TextEncoder().encode(c)},dE=zh(Ld(4),Lh("0123456789abcdef"),Bh(""),Tb(c=>{if(typeof c!="string"||c.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof c} with length ${c.length}`);return c.toLowerCase()})),fE={utf8:hE,hex:dE,base16:oE,base32:lE,base64:Ph,base64url:cE,base58:yy,base58xmr:uE};`${Object.keys(fE).join(", ")}`;function Q1(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`positive integer expected, not ${c}`)}function Jx(c){if(typeof c!="boolean")throw new Error(`boolean expected, not ${c}`)}function pE(c){return c instanceof Uint8Array||c!=null&&typeof c=="object"&&c.constructor.name==="Uint8Array"}function qu(c,...f){if(!pE(c))throw new Error("Uint8Array expected");if(f.length>0&&!f.includes(c.length))throw new Error(`Uint8Array expected of length ${f}, not of length=${c.length}`)}const No=c=>new Uint32Array(c.buffer,c.byteOffset,Math.floor(c.byteLength/4)),mE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mE)throw new Error("Non little-endian hardware is not supported");const gE=Array.from({length:256},(c,f)=>f.toString(16).padStart(2,"0"));function s0(c){qu(c);let f="";for(let y=0;y<c.length;y++)f+=gE[c[y]];return f}const Ih={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function e_(c){if(c>=Ih._0&&c<=Ih._9)return c-Ih._0;if(c>=Ih._A&&c<=Ih._F)return c-(Ih._A-10);if(c>=Ih._a&&c<=Ih._f)return c-(Ih._a-10)}function Ib(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const f=c.length,y=f/2;if(f%2)throw new Error("padded hex string expected, got unpadded hex of length "+f);const C=new Uint8Array(y);for(let N=0,k=0;N<y;N++,k+=2){const R=e_(c.charCodeAt(k)),h=e_(c.charCodeAt(k+1));if(R===void 0||h===void 0){const V=c[k]+c[k+1];throw new Error('hex string expected, got non-hex character "'+V+'" at index '+k)}C[N]=R*16+h}return C}function yE(c,f){if(f==null||typeof f!="object")throw new Error("options must be defined");return Object.assign(c,f)}function xE(c,f){if(c.length!==f.length)return!1;let y=0;for(let C=0;C<c.length;C++)y|=c[C]^f[C];return y===0}const _E=(c,f)=>(Object.assign(f,c),f),Nd=16,bE=283;function Vy(c){return c<<1^bE&-(c>>7)}function a0(c,f){let y=0;for(;f>0;f>>=1)y^=c&-(f&1),c=Vy(c);return y}const _y=(()=>{let c=new Uint8Array(256);for(let y=0,C=1;y<256;y++,C^=Vy(C))c[y]=C;const f=new Uint8Array(256);f[0]=99;for(let y=0;y<255;y++){let C=c[255-y];C|=C<<8,f[c[y]]=(C^C>>4^C>>5^C>>6^C>>7^99)&255}return f})(),vE=_y.map((c,f)=>_y.indexOf(f)),wE=c=>c<<24|c>>>8,J1=c=>c<<8|c>>>24;function Mb(c,f){if(c.length!==256)throw new Error("Wrong sbox length");const y=new Uint32Array(256).map((H,$)=>f(c[$])),C=y.map(J1),N=C.map(J1),k=N.map(J1),R=new Uint32Array(256*256),h=new Uint32Array(256*256),V=new Uint16Array(256*256);for(let H=0;H<256;H++)for(let $=0;$<256;$++){const K=H*256+$;R[K]=y[H]^C[$],h[K]=N[H]^k[$],V[K]=c[H]<<8|c[$]}return{sbox:c,sbox2:V,T0:y,T1:C,T2:N,T3:k,T01:R,T23:h}}const Gy=Mb(_y,c=>a0(c,3)<<24|c<<16|c<<8|a0(c,2)),Rb=Mb(vE,c=>a0(c,11)<<24|a0(c,13)<<16|a0(c,9)<<8|a0(c,14)),EE=(()=>{const c=new Uint8Array(16);for(let f=0,y=1;f<16;f++,y=Vy(y))c[f]=y;return c})();function Db(c){qu(c);const f=c.length;if(![16,24,32].includes(f))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${f}`);const{sbox2:y}=Gy,C=No(c),N=C.length,k=h=>Zu(y,h,h,h,h),R=new Uint32Array(f+28);R.set(C);for(let h=N;h<R.length;h++){let V=R[h-1];h%N===0?V=k(wE(V))^EE[h/N-1]:N>6&&h%N===4&&(V=k(V)),R[h]=R[h-N]^V}return R}function SE(c){const f=Db(c),y=f.slice(),C=f.length,{sbox2:N}=Gy,{T0:k,T1:R,T2:h,T3:V}=Rb;for(let H=0;H<C;H+=4)for(let $=0;$<4;$++)y[H+$]=f[C-H-4+$];f.fill(0);for(let H=4;H<C-4;H++){const $=y[H],K=Zu(N,$,$,$,$);y[H]=k[K&255]^R[K>>>8&255]^h[K>>>16&255]^V[K>>>24]}return y}function Dd(c,f,y,C,N,k){return c[y<<8&65280|C>>>8&255]^f[N>>>8&65280|k>>>24&255]}function Zu(c,f,y,C,N){return c[f&255|y&65280]|c[C>>>16&255|N>>>16&65280]<<16}function t_(c,f,y,C,N){const{sbox2:k,T01:R,T23:h}=Gy;let V=0;f^=c[V++],y^=c[V++],C^=c[V++],N^=c[V++];const H=c.length/4-2;for(let Ee=0;Ee<H;Ee++){const ye=c[V++]^Dd(R,h,f,y,C,N),he=c[V++]^Dd(R,h,y,C,N,f),ke=c[V++]^Dd(R,h,C,N,f,y),nt=c[V++]^Dd(R,h,N,f,y,C);f=ye,y=he,C=ke,N=nt}const $=c[V++]^Zu(k,f,y,C,N),K=c[V++]^Zu(k,y,C,N,f),be=c[V++]^Zu(k,C,N,f,y),Ce=c[V++]^Zu(k,N,f,y,C);return{s0:$,s1:K,s2:be,s3:Ce}}function TE(c,f,y,C,N){const{sbox2:k,T01:R,T23:h}=Rb;let V=0;f^=c[V++],y^=c[V++],C^=c[V++],N^=c[V++];const H=c.length/4-2;for(let Ee=0;Ee<H;Ee++){const ye=c[V++]^Dd(R,h,f,N,C,y),he=c[V++]^Dd(R,h,y,f,N,C),ke=c[V++]^Dd(R,h,C,y,f,N),nt=c[V++]^Dd(R,h,N,C,y,f);f=ye,y=he,C=ke,N=nt}const $=c[V++]^Zu(k,f,N,C,y),K=c[V++]^Zu(k,y,f,N,C),be=c[V++]^Zu(k,C,y,f,N),Ce=c[V++]^Zu(k,N,C,y,f);return{s0:$,s1:K,s2:be,s3:Ce}}function Nb(c,f){if(!f)return new Uint8Array(c);if(qu(f),f.length<c)throw new Error(`aes: wrong destination length, expected at least ${c}, got: ${f.length}`);return f}function AE(c){if(qu(c),c.length%Nd!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Nd}`)}function CE(c,f,y){let C=c.length;const N=C%Nd;if(!f&&N!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const k=No(c);if(f){let V=Nd-N;V||(V=Nd),C=C+V}const R=Nb(C,y),h=No(R);return{b:k,o:h,out:R}}function IE(c,f){if(!f)return c;const y=c.length;if(!y)throw new Error("aes/pcks5: empty ciphertext not allowed");const C=c[y-1];if(C<=0||C>16)throw new Error(`aes/pcks5: wrong padding byte: ${C}`);const N=c.subarray(0,-C);for(let k=0;k<C;k++)if(c[y-k-1]!==C)throw new Error("aes/pcks5: wrong padding");return N}function ME(c){const f=new Uint8Array(16),y=No(f);f.set(c);const C=Nd-c.length;for(let N=Nd-C;N<Nd;N++)f[N]=C;return y}const kb=_E({blockSize:16,nonceLength:16},function(f,y,C={}){qu(f),qu(y,16);const N=!C.disablePadding;return{encrypt:(k,R)=>{const h=Db(f),{b:V,o:H,out:$}=CE(k,N,R),K=No(y);let be=K[0],Ce=K[1],Ee=K[2],ye=K[3],he=0;for(;he+4<=V.length;)be^=V[he+0],Ce^=V[he+1],Ee^=V[he+2],ye^=V[he+3],{s0:be,s1:Ce,s2:Ee,s3:ye}=t_(h,be,Ce,Ee,ye),H[he++]=be,H[he++]=Ce,H[he++]=Ee,H[he++]=ye;if(N){const ke=ME(k.subarray(he*4));be^=ke[0],Ce^=ke[1],Ee^=ke[2],ye^=ke[3],{s0:be,s1:Ce,s2:Ee,s3:ye}=t_(h,be,Ce,Ee,ye),H[he++]=be,H[he++]=Ce,H[he++]=Ee,H[he++]=ye}return h.fill(0),$},decrypt:(k,R)=>{AE(k);const h=SE(f),V=No(y),H=Nb(k.length,R),$=No(k),K=No(H);let be=V[0],Ce=V[1],Ee=V[2],ye=V[3];for(let he=0;he+4<=$.length;){const ke=be,nt=Ce,Qe=Ee,dt=ye;be=$[he+0],Ce=$[he+1],Ee=$[he+2],ye=$[he+3];const{s0:Ut,s1:wt,s2:tt,s3:Je}=TE(h,be,Ce,Ee,ye);K[he++]=Ut^ke,K[he++]=wt^nt,K[he++]=tt^Qe,K[he++]=Je^dt}return h.fill(0),IE(H,N)}}}),Pb=c=>Uint8Array.from(c.split("").map(f=>f.charCodeAt(0))),RE=Pb("expand 16-byte k"),DE=Pb("expand 32-byte k"),NE=No(RE),Ob=No(DE);Ob.slice();function Mr(c,f){return c<<f|c>>>32-f}function by(c){return c.byteOffset%4===0}const Pg=64,kE=16,zb=2**32-1,n_=new Uint32Array;function PE(c,f,y,C,N,k,R,h){const V=N.length,H=new Uint8Array(Pg),$=No(H),K=by(N)&&by(k),be=K?No(N):n_,Ce=K?No(k):n_;for(let Ee=0;Ee<V;R++){if(c(f,y,C,$,R,h),R>=zb)throw new Error("arx: counter overflow");const ye=Math.min(Pg,V-Ee);if(K&&ye===Pg){const he=Ee/4;if(Ee%4!==0)throw new Error("arx: invalid block position");for(let ke=0,nt;ke<kE;ke++)nt=he+ke,Ce[nt]=be[nt]^$[ke];Ee+=Pg;continue}for(let he=0,ke;he<ye;he++)ke=Ee+he,k[ke]=N[ke]^H[he];Ee+=ye}}function OE(c,f){const{allowShortKeys:y,extendNonceFn:C,counterLength:N,counterRight:k,rounds:R}=yE({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},f);if(typeof c!="function")throw new Error("core must be a function");return Q1(N),Q1(R),Jx(k),Jx(y),(h,V,H,$,K=0)=>{qu(h),qu(V),qu(H);const be=H.length;if($||($=new Uint8Array(be)),qu($),Q1(K),K<0||K>=zb)throw new Error("arx: counter overflow");if($.length<be)throw new Error(`arx: output (${$.length}) is shorter than data (${be})`);const Ce=[];let Ee=h.length,ye,he;if(Ee===32)ye=h.slice(),Ce.push(ye),he=Ob;else if(Ee===16&&y)ye=new Uint8Array(32),ye.set(h),ye.set(h,16),he=NE,Ce.push(ye);else throw new Error(`arx: invalid 32-byte key, got length=${Ee}`);by(V)||(V=V.slice(),Ce.push(V));const ke=No(ye);if(C){if(V.length!==24)throw new Error("arx: extended nonce must be 24 bytes");C(he,ke,No(V.subarray(0,16)),ke),V=V.subarray(16)}const nt=16-N;if(nt!==V.length)throw new Error(`arx: nonce must be ${nt} or 16 bytes`);if(nt!==12){const dt=new Uint8Array(12);dt.set(V,k?0:12-V.length),V=dt,Ce.push(V)}const Qe=No(V);for(PE(c,he,ke,Qe,H,$,K,R);Ce.length>0;)Ce.pop().fill(0);return $}}function zE(c,f,y,C,N,k=20){let R=c[0],h=c[1],V=c[2],H=c[3],$=f[0],K=f[1],be=f[2],Ce=f[3],Ee=f[4],ye=f[5],he=f[6],ke=f[7],nt=N,Qe=y[0],dt=y[1],Ut=y[2],wt=R,tt=h,Je=V,He=H,pt=$,Pe=K,ot=be,gt=Ce,Rt=Ee,Ie=ye,Se=he,je=ke,st=nt,mt=Qe,Xt=dt,Oe=Ut;for(let It=0;It<k;It+=2)wt=wt+pt|0,st=Mr(st^wt,16),Rt=Rt+st|0,pt=Mr(pt^Rt,12),wt=wt+pt|0,st=Mr(st^wt,8),Rt=Rt+st|0,pt=Mr(pt^Rt,7),tt=tt+Pe|0,mt=Mr(mt^tt,16),Ie=Ie+mt|0,Pe=Mr(Pe^Ie,12),tt=tt+Pe|0,mt=Mr(mt^tt,8),Ie=Ie+mt|0,Pe=Mr(Pe^Ie,7),Je=Je+ot|0,Xt=Mr(Xt^Je,16),Se=Se+Xt|0,ot=Mr(ot^Se,12),Je=Je+ot|0,Xt=Mr(Xt^Je,8),Se=Se+Xt|0,ot=Mr(ot^Se,7),He=He+gt|0,Oe=Mr(Oe^He,16),je=je+Oe|0,gt=Mr(gt^je,12),He=He+gt|0,Oe=Mr(Oe^He,8),je=je+Oe|0,gt=Mr(gt^je,7),wt=wt+Pe|0,Oe=Mr(Oe^wt,16),Se=Se+Oe|0,Pe=Mr(Pe^Se,12),wt=wt+Pe|0,Oe=Mr(Oe^wt,8),Se=Se+Oe|0,Pe=Mr(Pe^Se,7),tt=tt+ot|0,st=Mr(st^tt,16),je=je+st|0,ot=Mr(ot^je,12),tt=tt+ot|0,st=Mr(st^tt,8),je=je+st|0,ot=Mr(ot^je,7),Je=Je+gt|0,mt=Mr(mt^Je,16),Rt=Rt+mt|0,gt=Mr(gt^Rt,12),Je=Je+gt|0,mt=Mr(mt^Je,8),Rt=Rt+mt|0,gt=Mr(gt^Rt,7),He=He+pt|0,Xt=Mr(Xt^He,16),Ie=Ie+Xt|0,pt=Mr(pt^Ie,12),He=He+pt|0,Xt=Mr(Xt^He,8),Ie=Ie+Xt|0,pt=Mr(pt^Ie,7);let Xe=0;C[Xe++]=R+wt|0,C[Xe++]=h+tt|0,C[Xe++]=V+Je|0,C[Xe++]=H+He|0,C[Xe++]=$+pt|0,C[Xe++]=K+Pe|0,C[Xe++]=be+ot|0,C[Xe++]=Ce+gt|0,C[Xe++]=Ee+Rt|0,C[Xe++]=ye+Ie|0,C[Xe++]=he+Se|0,C[Xe++]=ke+je|0,C[Xe++]=nt+st|0,C[Xe++]=Qe+mt|0,C[Xe++]=dt+Xt|0,C[Xe++]=Ut+Oe|0}const Lb=OE(zE,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Bb extends bb{constructor(f,y){super(),this.finished=!1,this.destroyed=!1,Hu.hash(f);const C=Tm(y);if(this.iHash=f.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const N=this.blockLen,k=new Uint8Array(N);k.set(C.length>N?f.create().update(C).digest():C);for(let R=0;R<k.length;R++)k[R]^=54;this.iHash.update(k),this.oHash=f.create();for(let R=0;R<k.length;R++)k[R]^=106;this.oHash.update(k),k.fill(0)}update(f){return Hu.exists(this),this.iHash.update(f),this}digestInto(f){Hu.exists(this),Hu.bytes(f,this.outputLen),this.finished=!0,this.iHash.digestInto(f),this.oHash.update(f),this.oHash.digestInto(f),this.destroy()}digest(){const f=new Uint8Array(this.oHash.outputLen);return this.digestInto(f),f}_cloneInto(f){f||(f=Object.create(Object.getPrototypeOf(this),{}));const{oHash:y,iHash:C,finished:N,destroyed:k,blockLen:R,outputLen:h}=this;return f=f,f.finished=N,f.destroyed=k,f.blockLen=R,f.outputLen=h,f.oHash=y._cloneInto(f.oHash),f.iHash=C._cloneInto(f.iHash),f}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const u1=(c,f,y)=>new Bb(c,f).update(y).digest();u1.create=(c,f)=>new Bb(c,f);function LE(c,f,y){return Hu.hash(c),u1(c,Tm(y),Tm(f))}const ey=new Uint8Array([0]),i_=new Uint8Array;function BE(c,f,y,C=32){if(Hu.hash(c),Hu.number(C),C>255*c.outputLen)throw new Error("Length should be <= 255*HashLen");const N=Math.ceil(C/c.outputLen);y===void 0&&(y=i_);const k=new Uint8Array(N*c.outputLen),R=u1.create(c,f),h=R._cloneInto(),V=new Uint8Array(R.outputLen);for(let H=0;H<N;H++)ey[0]=H+1,h.update(H===0?i_:V).update(y).update(ey).digestInto(V),k.set(V,c.outputLen*H),R._cloneInto(h);return R.destroy(),h.destroy(),V.fill(0),ey.fill(0),k.slice(0,C)}var FE=Object.defineProperty,bs=(c,f)=>{for(var y in f)FE(c,y,{get:f[y],enumerable:!0})},Uf=Symbol("verified"),jE=c=>c instanceof Object;function Hy(c){if(!jE(c)||typeof c.kind!="number"||typeof c.content!="string"||typeof c.created_at!="number"||typeof c.pubkey!="string"||!c.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(c.tags))return!1;for(let f=0;f<c.tags.length;f++){let y=c.tags[f];if(!Array.isArray(y))return!1;for(let C=0;C<y.length;C++)if(typeof y[C]!="string")return!1}return!0}var UE={};bs(UE,{Queue:()=>jb,QueueNode:()=>Fb,binarySearch:()=>qy,bytesToHex:()=>ss,hexToBytes:()=>Od,insertEventIntoAscendingList:()=>GE,insertEventIntoDescendingList:()=>VE,normalizeURL:()=>Hf,utf8Decoder:()=>kh,utf8Encoder:()=>cu});var kh=new TextDecoder("utf-8"),cu=new TextEncoder;function Hf(c){try{c.indexOf("://")===-1&&(c="wss://"+c);let f=new URL(c);return f.protocol==="http:"?f.protocol="ws:":f.protocol==="https:"&&(f.protocol="wss:"),f.pathname=f.pathname.replace(/\/+/g,"/"),f.pathname.endsWith("/")&&(f.pathname=f.pathname.slice(0,-1)),(f.port==="80"&&f.protocol==="ws:"||f.port==="443"&&f.protocol==="wss:")&&(f.port=""),f.searchParams.sort(),f.hash="",f.toString()}catch{throw new Error(`Invalid URL: ${c}`)}}function VE(c,f){const[y,C]=qy(c,N=>f.id===N.id?0:f.created_at===N.created_at?-1:N.created_at-f.created_at);return C||c.splice(y,0,f),c}function GE(c,f){const[y,C]=qy(c,N=>f.id===N.id?0:f.created_at===N.created_at?-1:f.created_at-N.created_at);return C||c.splice(y,0,f),c}function qy(c,f){let y=0,C=c.length-1;for(;y<=C;){const N=Math.floor((y+C)/2),k=f(c[N]);if(k===0)return[N,!0];k<0?C=N-1:y=N+1}return[y,!1]}var Fb=class{value;next=null;prev=null;constructor(c){this.value=c}},jb=class{first;last;constructor(){this.first=null,this.last=null}enqueue(c){const f=new Fb(c);return this.last?this.last===this.first?(this.last=f,this.last.prev=this.first,this.first.next=f):(f.prev=this.last,this.last.next=f,this.last=f):(this.first=f,this.last=f),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const f=this.first;return this.first=null,this.last=null,f.value}const c=this.first;return this.first=c.next,this.first&&(this.first.prev=null),c.value}},HE=class{generateSecretKey(){return Gu.utils.randomPrivateKey()}getPublicKey(f){return ss(Gu.getPublicKey(f))}finalizeEvent(f,y){const C=f;return C.pubkey=ss(Gu.getPublicKey(y)),C.id=Fg(C),C.sig=ss(Gu.sign(Fg(C),y)),C[Uf]=!0,C}verifyEvent(f){if(typeof f[Uf]=="boolean")return f[Uf];const y=Fg(f);if(y!==f.id)return f[Uf]=!1,!1;try{const C=Gu.verify(f.sig,y,f.pubkey);return f[Uf]=C,C}catch{return f[Uf]=!1,!1}}};function qE(c){if(!Hy(c))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content])}function Fg(c){let f=zd(cu.encode(qE(c)));return ss(f)}var h1=new HE,Ub=h1.generateSecretKey,Am=h1.getPublicKey,Ic=h1.finalizeEvent,d1=h1.verifyEvent,ZE={};bs(ZE,{Application:()=>r3,BadgeAward:()=>eS,BadgeDefinition:()=>KS,BlockedRelaysList:()=>kS,BlossomServerList:()=>jS,BookmarkList:()=>RS,Bookmarksets:()=>WS,Calendar:()=>h3,CalendarEventRSVP:()=>d3,ChannelCreation:()=>Xb,ChannelHideMessage:()=>$b,ChannelMessage:()=>Yb,ChannelMetadata:()=>Wb,ChannelMuteUser:()=>Kb,ChatMessage:()=>tS,ClassifiedListing:()=>o3,ClientAuth:()=>Jb,Comment:()=>uS,CommunitiesList:()=>DS,CommunityDefinition:()=>g3,CommunityPostApproval:()=>xS,Contacts:()=>KE,CreateOrUpdateProduct:()=>e3,CreateOrUpdateStall:()=>JS,Curationsets:()=>YS,Date:()=>c3,DirectMessageRelaysList:()=>BS,DraftClassifiedListing:()=>l3,DraftLong:()=>n3,Emojisets:()=>i3,EncryptedDirectMessage:()=>QE,EventDeletion:()=>JE,FavoriteRelays:()=>OS,FileMessage:()=>iS,FileMetadata:()=>cS,FileServerPreference:()=>FS,Followsets:()=>qS,ForumThread:()=>nS,GenericRepost:()=>$y,Genericlists:()=>ZS,GiftWrap:()=>Qb,GroupMetadata:()=>y3,HTTPAuth:()=>Ky,Handlerinformation:()=>m3,Handlerrecommendation:()=>p3,Highlights:()=>TS,InterestsList:()=>zS,Interestsets:()=>QS,JobFeedback:()=>vS,JobRequest:()=>_S,JobResult:()=>bS,Label:()=>yS,LightningPubRPC:()=>VS,LiveChatMessage:()=>hS,LiveEvent:()=>s3,LongFormArticle:()=>t3,Metadata:()=>YE,Mutelist:()=>CS,NWCWalletInfo:()=>US,NWCWalletRequest:()=>ev,NWCWalletResponse:()=>GS,NormalVideo:()=>sS,NostrConnect:()=>HS,OpenTimestamps:()=>oS,Photo:()=>rS,Pinlist:()=>IS,Poll:()=>lS,PollResponse:()=>AS,PrivateDirectMessage:()=>Zb,ProblemTracker:()=>pS,ProfileBadges:()=>$S,PublicChatsList:()=>NS,Reaction:()=>Yy,RecommendRelay:()=>$E,RelayList:()=>MS,RelayReview:()=>f3,Relaysets:()=>XS,Report:()=>mS,Reporting:()=>gS,Repost:()=>Wy,Seal:()=>qb,SearchRelaysList:()=>PS,ShortTextNote:()=>Hb,ShortVideo:()=>aS,Time:()=>u3,UserEmojiList:()=>LS,UserStatuses:()=>a3,Voice:()=>dS,VoiceComment:()=>fS,Zap:()=>SS,ZapGoal:()=>wS,ZapRequest:()=>ES,classifyKind:()=>XE,isAddressableKind:()=>Xy,isEphemeralKind:()=>Gb,isKind:()=>WE,isRegularKind:()=>Vb,isReplaceableKind:()=>Zy});function Vb(c){return c<1e4&&c!==0&&c!==3}function Zy(c){return c===0||c===3||1e4<=c&&c<2e4}function Gb(c){return 2e4<=c&&c<3e4}function Xy(c){return 3e4<=c&&c<4e4}function XE(c){return Vb(c)?"regular":Zy(c)?"replaceable":Gb(c)?"ephemeral":Xy(c)?"parameterized":"unknown"}function WE(c,f){const y=f instanceof Array?f:[f];return Hy(c)&&y.includes(c.kind)||!1}var YE=0,Hb=1,$E=2,KE=3,QE=4,JE=5,Wy=6,Yy=7,eS=8,tS=9,nS=11,qb=13,Zb=14,iS=15,$y=16,rS=20,sS=21,aS=22,Xb=40,Wb=41,Yb=42,$b=43,Kb=44,oS=1040,Qb=1059,lS=1068,cS=1063,uS=1111,hS=1311,dS=1222,fS=1244,pS=1971,mS=1984,gS=1984,yS=1985,xS=4550,_S=5999,bS=6999,vS=7e3,wS=9041,ES=9734,SS=9735,TS=9802,AS=1018,CS=1e4,IS=10001,MS=10002,RS=10003,DS=10004,NS=10005,kS=10006,PS=10007,OS=10012,zS=10015,LS=10030,BS=10050,FS=10096,jS=10063,US=13194,VS=21e3,Jb=22242,ev=23194,GS=23195,HS=24133,Ky=27235,qS=3e4,ZS=30001,XS=30002,WS=30003,YS=30004,$S=30008,KS=30009,QS=30015,JS=30017,e3=30018,t3=30023,n3=30024,i3=30030,r3=30078,s3=30311,a3=30315,o3=30402,l3=30403,c3=31922,u3=31923,h3=31924,d3=31925,f3=31987,p3=31989,m3=31990,g3=34550,y3=39e3;function x3(c,f){if(c.ids&&c.ids.indexOf(f.id)===-1||c.kinds&&c.kinds.indexOf(f.kind)===-1||c.authors&&c.authors.indexOf(f.pubkey)===-1)return!1;for(let y in c)if(y[0]==="#"){let C=y.slice(1),N=c[`#${C}`];if(N&&!f.tags.find(([k,R])=>k===y.slice(1)&&N.indexOf(R)!==-1))return!1}return!(c.since&&f.created_at<c.since||c.until&&f.created_at>c.until)}function _3(c,f){for(let y=0;y<c.length;y++)if(x3(c[y],f))return!0;return!1}var b3={};bs(b3,{getHex64:()=>f1,getInt:()=>tv,getSubscriptionId:()=>nv,matchEventId:()=>v3,matchEventKind:()=>E3,matchEventPubkey:()=>w3});function f1(c,f){let y=f.length+3,C=c.indexOf(`"${f}":`)+y,N=c.slice(C).indexOf('"')+C+1;return c.slice(N,N+64)}function tv(c,f){let y=f.length,C=c.indexOf(`"${f}":`)+y+3,N=c.slice(C),k=Math.min(N.indexOf(","),N.indexOf("}"));return parseInt(N.slice(0,k),10)}function nv(c){let f=c.slice(0,22).indexOf('"EVENT"');if(f===-1)return null;let y=c.slice(f+7+1).indexOf('"');if(y===-1)return null;let C=f+7+1+y,N=c.slice(C+1,80).indexOf('"');if(N===-1)return null;let k=C+1+N;return c.slice(C+1,k)}function v3(c,f){return f===f1(c,"id")}function w3(c,f){return f===f1(c,"pubkey")}function E3(c,f){return f===tv(c,"kind")}var S3={};bs(S3,{makeAuthEvent:()=>iv});function iv(c,f){return{kind:Jb,created_at:Math.floor(Date.now()/1e3),tags:[["relay",c],["challenge",f]],content:""}}async function T3(){return new Promise((c,f)=>{try{if(typeof MessageChannel<"u"){const y=new MessageChannel,C=()=>{y.port1.removeEventListener("message",C),c()};y.port1.addEventListener("message",C),y.port2.postMessage(0),y.port1.start()}else typeof setImmediate<"u"?setImmediate(c):typeof setTimeout<"u"?setTimeout(c,0):c()}catch(y){console.error("during yield: ",y),f(y)}})}var A3=c=>(c[Uf]=!0,!0),rv=class extends Error{constructor(c,f){super(`Tried to send message '${c} on a closed connection to ${f}.`),this.name="SendingOnClosedConnection"}},sv=class{url;_connected=!1;onclose=null;onnotice=c=>console.debug(`NOTICE from ${this.url}: ${c}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new jb;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(c,f){this.url=Hf(c),this.verifyEvent=f.verifyEvent,this._WebSocket=f.websocketImplementation||WebSocket,this.enablePing=f.enablePing,this.enableReconnect=f.enableReconnect||!1}static async connect(c,f){const y=new sv(c,f);return await y.connect(),y}closeAllSubscriptions(c){for(let[f,y]of this.openSubs)y.close(c);this.openSubs.clear();for(let[f,y]of this.openEventPublishes)y.reject(new Error(c));this.openEventPublishes.clear();for(let[f,y]of this.openCountRequests)y.reject(new Error(c));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const c=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},c)}handleHardClose(c){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const f=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!f?this.reconnect():this.closeAllSubscriptions(c)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((c,f)=>{this.connectionTimeoutHandle=setTimeout(()=>{f("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(y){clearTimeout(this.connectionTimeoutHandle),f(y);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const y=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const C of this.openSubs.values()){if(C.eosed=!1,y)for(let N=0;N<C.filters.length;N++)C.lastEmitted&&(C.filters[N].since=C.lastEmitted+1);C.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),c()},this.ws.onerror=y=>{clearTimeout(this.connectionTimeoutHandle),f(y.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=y=>{clearTimeout(this.connectionTimeoutHandle),f(y.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(c=>{this.ws.once("pong",()=>c(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((c,f)=>{if(!this.connectionPromise)return f(new Error(`no connection to ${this.url}, can't ping`));try{const y=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{c(!0),y.close()},onclose(){c(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(y){f(y)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(f=>setTimeout(()=>f(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await T3();this.queueRunning=!1}handleNext(){const c=this.incomingMessageQueue.dequeue();if(!c)return!1;const f=nv(c);if(f){const y=this.openSubs.get(f);if(!y)return;const C=f1(c,"id"),N=y.alreadyHaveEvent?.(C);if(y.receivedEvent?.(this,C),N)return}try{let y=JSON.parse(c);switch(y[0]){case"EVENT":{const C=this.openSubs.get(y[1]),N=y[2];this.verifyEvent(N)&&_3(C.filters,N)&&C.onevent(N),(!C.lastEmitted||C.lastEmitted<N.created_at)&&(C.lastEmitted=N.created_at);return}case"COUNT":{const C=y[1],N=y[2],k=this.openCountRequests.get(C);k&&(k.resolve(N.count),this.openCountRequests.delete(C));return}case"EOSE":{const C=this.openSubs.get(y[1]);if(!C)return;C.receivedEose();return}case"OK":{const C=y[1],N=y[2],k=y[3],R=this.openEventPublishes.get(C);R&&(clearTimeout(R.timeout),N?R.resolve(k):R.reject(new Error(k)),this.openEventPublishes.delete(C));return}case"CLOSED":{const C=y[1],N=this.openSubs.get(C);if(!N)return;N.closed=!0,N.close(y[2]);return}case"NOTICE":{this.onnotice(y[1]);return}case"AUTH":{this.challenge=y[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(y[1])?.oncustom?.(y);return}}}catch{return}}async send(c){if(!this.connectionPromise)throw new rv(c,this.url);this.connectionPromise.then(()=>{this.ws?.send(c)})}async auth(c){const f=this.challenge;if(!f)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(y,C)=>{try{let N=await c(iv(this.url,f)),k=setTimeout(()=>{let R=this.openEventPublishes.get(N.id);R&&(R.reject(new Error("auth timed out")),this.openEventPublishes.delete(N.id))},this.publishTimeout);this.openEventPublishes.set(N.id,{resolve:y,reject:C,timeout:k}),this.send('["AUTH",'+JSON.stringify(N)+"]")}catch(N){console.warn("subscribe auth function failed:",N)}}),this.authPromise)}async publish(c){const f=new Promise((y,C)=>{const N=setTimeout(()=>{const k=this.openEventPublishes.get(c.id);k&&(k.reject(new Error("publish timed out")),this.openEventPublishes.delete(c.id))},this.publishTimeout);this.openEventPublishes.set(c.id,{resolve:y,reject:C,timeout:N})});return this.send('["EVENT",'+JSON.stringify(c)+"]"),f}async count(c,f){this.serial++;const y=f?.id||"count:"+this.serial,C=new Promise((N,k)=>{this.openCountRequests.set(y,{resolve:N,reject:k})});return this.send('["COUNT","'+y+'",'+JSON.stringify(c).substring(1)),C}subscribe(c,f){const y=this.prepareSubscription(c,f);return y.fire(),y}prepareSubscription(c,f){this.serial++;const y=f.id||(f.label?f.label+":":"sub:")+this.serial,C=new C3(this,y,c,f);return this.openSubs.set(y,C),C}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(c){this.incomingMessageQueue.enqueue(c.data),this.queueRunning||this.runQueue()}},C3=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(c,f,y,C){if(y.length===0)throw new Error("subscription can't be created with zero filters");this.relay=c,this.filters=y,this.id=f,this.alreadyHaveEvent=C.alreadyHaveEvent,this.receivedEvent=C.receivedEvent,this.eoseTimeout=C.eoseTimeout||c.baseEoseTimeout,this.oneose=C.oneose,this.onclose=C.onclose,this.onevent=C.onevent||(N=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,N)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(c="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(f){if(!(f instanceof rv))throw f}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(c)}},I3;try{I3=WebSocket}catch{}var M3=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(c){this.verifyEvent=c.verifyEvent,this._WebSocket=c.websocketImplementation,this.enablePing=c.enablePing,this.enableReconnect=c.enableReconnect||!1,this.automaticallyAuth=c.automaticallyAuth}async ensureRelay(c,f){c=Hf(c);let y=this.relays.get(c);if(y||(y=new sv(c,{verifyEvent:this.trustedRelayURLs.has(c)?A3:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),y.onclose=()=>{y&&!y.enableReconnect&&this.relays.delete(c)},f?.connectionTimeout&&(y.connectionTimeout=f.connectionTimeout),this.relays.set(c,y)),this.automaticallyAuth){const C=this.automaticallyAuth(c);C&&(y.onauth=C)}return await y.connect(),y}close(c){c.map(Hf).forEach(f=>{this.relays.get(f)?.close(),this.relays.delete(f)})}subscribe(c,f,y){const C=[];for(let N=0;N<c.length;N++){const k=Hf(c[N]);C.find(R=>R.url===k)||C.push({url:k,filter:f})}return this.subscribeMap(C,y)}subscribeMany(c,f,y){const C=[],N=[];for(let k=0;k<c.length;k++){const R=Hf(c[k]);N.indexOf(R)===-1&&(N.push(R),C.push({url:R,filter:f}))}return this.subscribeMap(C,y)}subscribeMap(c,f){const y=new Map;for(const be of c){const{url:Ce,filter:Ee}=be;y.has(Ce)||y.set(Ce,[]),y.get(Ce).push(Ee)}const C=Array.from(y.entries()).map(([be,Ce])=>({url:be,filters:Ce}));this.trackRelays&&(f.receivedEvent=(be,Ce)=>{let Ee=this.seenOn.get(Ce);Ee||(Ee=new Set,this.seenOn.set(Ce,Ee)),Ee.add(be)});const N=new Set,k=[],R=[];let h=be=>{R[be]||(R[be]=!0,R.filter(Ce=>Ce).length===C.length&&(f.oneose?.(),h=()=>{}))};const V=[];let H=(be,Ce)=>{V[be]||(h(be),V[be]=Ce,V.filter(Ee=>Ee).length===C.length&&(f.onclose?.(V),H=()=>{}))};const $=be=>{if(f.alreadyHaveEvent?.(be))return!0;const Ce=N.has(be);return N.add(be),Ce},K=Promise.all(C.map(async({url:be,filters:Ce},Ee)=>{let ye;try{ye=await this.ensureRelay(be,{connectionTimeout:f.maxWait?Math.max(f.maxWait*.8,f.maxWait-1e3):void 0})}catch(ke){H(Ee,ke?.message||String(ke));return}let he=ye.subscribe(Ce,{...f,oneose:()=>h(Ee),onclose:ke=>{ke.startsWith("auth-required: ")&&f.onauth?ye.auth(f.onauth).then(()=>{ye.subscribe(Ce,{...f,oneose:()=>h(Ee),onclose:nt=>{H(Ee,nt)},alreadyHaveEvent:$,eoseTimeout:f.maxWait})}).catch(nt=>{H(Ee,`auth was required and attempted, but failed with: ${nt}`)}):H(Ee,ke)},alreadyHaveEvent:$,eoseTimeout:f.maxWait});k.push(he)}));return{async close(be){await K,k.forEach(Ce=>{Ce.close(be)})}}}subscribeEose(c,f,y){const C=this.subscribe(c,f,{...y,oneose(){C.close("closed automatically on eose")}});return C}subscribeManyEose(c,f,y){const C=this.subscribeMany(c,f,{...y,oneose(){C.close("closed automatically on eose")}});return C}async querySync(c,f,y){return new Promise(async C=>{const N=[];this.subscribeEose(c,f,{...y,onevent(k){N.push(k)},onclose(k){C(N)}})})}async get(c,f,y){f.limit=1;const C=await this.querySync(c,f,y);return C.sort((N,k)=>k.created_at-N.created_at),C[0]||null}publish(c,f,y){return c.map(Hf).map(async(C,N,k)=>{if(k.indexOf(C)!==N)return Promise.reject("duplicate url");let R=await this.ensureRelay(C);return R.publish(f).catch(async h=>{if(h instanceof Error&&h.message.startsWith("auth-required: ")&&y?.onauth)return await R.auth(y.onauth),R.publish(f);throw h}).then(h=>{if(this.trackRelays){let V=this.seenOn.get(f.id);V||(V=new Set,this.seenOn.set(f.id,V)),V.add(R)}return h})})}listConnectionStatus(){const c=new Map;return this.relays.forEach((f,y)=>c.set(y,f.connected)),c}destroy(){this.relays.forEach(c=>c.close()),this.relays=new Map}},av;try{av=WebSocket}catch{}var R3=class extends M3{constructor(c){super({verifyEvent:d1,websocketImplementation:av,...c})}},Zf={};bs(Zf,{BECH32_REGEX:()=>ov,Bech32MaxSize:()=>Qy,NostrTypeGuard:()=>D3,decode:()=>p1,decodeNostrURI:()=>k3,encodeBytes:()=>g1,naddrEncode:()=>F3,neventEncode:()=>B3,noteEncode:()=>z3,nprofileEncode:()=>L3,npubEncode:()=>O3,nsecEncode:()=>P3});var D3={isNProfile:c=>/^nprofile1[a-z\d]+$/.test(c||""),isNEvent:c=>/^nevent1[a-z\d]+$/.test(c||""),isNAddr:c=>/^naddr1[a-z\d]+$/.test(c||""),isNSec:c=>/^nsec1[a-z\d]{58}$/.test(c||""),isNPub:c=>/^npub1[a-z\d]{58}$/.test(c||""),isNote:c=>/^note1[a-z\d]+$/.test(c||""),isNcryptsec:c=>/^ncryptsec1[a-z\d]+$/.test(c||"")},Qy=5e3,ov=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function N3(c){const f=new Uint8Array(4);return f[0]=c>>24&255,f[1]=c>>16&255,f[2]=c>>8&255,f[3]=c&255,f}function k3(c){try{return c.startsWith("nostr:")&&(c=c.substring(6)),p1(c)}catch{return{type:"invalid",data:null}}}function p1(c){let{prefix:f,words:y}=Xu.decode(c,Qy),C=new Uint8Array(Xu.fromWords(y));switch(f){case"nprofile":{let N=ty(C);if(!N[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(N[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ss(N[0][0]),relays:N[1]?N[1].map(k=>kh.decode(k)):[]}}}case"nevent":{let N=ty(C);if(!N[0]?.[0])throw new Error("missing TLV 0 for nevent");if(N[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(N[2]&&N[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(N[3]&&N[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ss(N[0][0]),relays:N[1]?N[1].map(k=>kh.decode(k)):[],author:N[2]?.[0]?ss(N[2][0]):void 0,kind:N[3]?.[0]?parseInt(ss(N[3][0]),16):void 0}}}case"naddr":{let N=ty(C);if(!N[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!N[2]?.[0])throw new Error("missing TLV 2 for naddr");if(N[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!N[3]?.[0])throw new Error("missing TLV 3 for naddr");if(N[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:kh.decode(N[0][0]),pubkey:ss(N[2][0]),kind:parseInt(ss(N[3][0]),16),relays:N[1]?N[1].map(k=>kh.decode(k)):[]}}}case"nsec":return{type:f,data:C};case"npub":case"note":return{type:f,data:ss(C)};default:throw new Error(`unknown prefix ${f}`)}}function ty(c){let f={},y=c;for(;y.length>0;){let C=y[0],N=y[1],k=y.slice(2,2+N);if(y=y.slice(2+N),k.length<N)throw new Error(`not enough data to read on TLV ${C}`);f[C]=f[C]||[],f[C].push(k)}return f}function P3(c){return g1("nsec",c)}function O3(c){return g1("npub",Od(c))}function z3(c){return g1("note",Od(c))}function m1(c,f){let y=Xu.toWords(f);return Xu.encode(c,y,Qy)}function g1(c,f){return m1(c,f)}function L3(c){let f=Jy({0:[Od(c.pubkey)],1:(c.relays||[]).map(y=>cu.encode(y))});return m1("nprofile",f)}function B3(c){let f;c.kind!==void 0&&(f=N3(c.kind));let y=Jy({0:[Od(c.id)],1:(c.relays||[]).map(C=>cu.encode(C)),2:c.author?[Od(c.author)]:[],3:f?[new Uint8Array(f)]:[]});return m1("nevent",y)}function F3(c){let f=new ArrayBuffer(4);new DataView(f).setUint32(0,c.kind,!1);let y=Jy({0:[cu.encode(c.identifier)],1:(c.relays||[]).map(C=>cu.encode(C)),2:[Od(c.pubkey)],3:[new Uint8Array(f)]});return m1("naddr",y)}function Jy(c){let f=[];return Object.entries(c).reverse().forEach(([y,C])=>{C.forEach(N=>{let k=new Uint8Array(N.length+2);k.set([parseInt(y)],0),k.set([N.length],1),k.set(N,2),f.push(k)})}),l1(...f)}var j3={};bs(j3,{decrypt:()=>U3,encrypt:()=>lv});function lv(c,f,y){const C=c instanceof Uint8Array?ss(c):c,N=p0.getSharedSecret(C,"02"+f),k=cv(N);let R=Uint8Array.from(wb(16)),h=cu.encode(y),V=kb(k,R).encrypt(h),H=Ph.encode(new Uint8Array(V)),$=Ph.encode(new Uint8Array(R.buffer));return`${H}?iv=${$}`}function U3(c,f,y){const C=c instanceof Uint8Array?ss(c):c;let[N,k]=y.split("?iv="),R=p0.getSharedSecret(C,"02"+f),h=cv(R),V=Ph.decode(k),H=Ph.decode(N),$=kb(h,V).decrypt(H);return kh.decode($)}function cv(c){return c.slice(1,33)}var V3={};bs(V3,{NIP05_REGEX:()=>ex,isNip05:()=>G3,isValid:()=>Z3,queryProfile:()=>uv,searchDomain:()=>q3,useFetchImplementation:()=>H3});var ex=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,G3=c=>ex.test(c||""),y1;try{y1=fetch}catch{}function H3(c){y1=c}async function q3(c,f=""){try{const y=`https://${c}/.well-known/nostr.json?name=${f}`,C=await y1(y,{redirect:"manual"});if(C.status!==200)throw Error("Wrong response code");return(await C.json()).names}catch{return{}}}async function uv(c){const f=c.match(ex);if(!f)return null;const[,y="_",C]=f;try{const N=`https://${C}/.well-known/nostr.json?name=${y}`,k=await y1(N,{redirect:"manual"});if(k.status!==200)throw Error("Wrong response code");const R=await k.json(),h=R.names[y];return h?{pubkey:h,relays:R.relays?.[h]}:null}catch{return null}}async function Z3(c,f){const y=await uv(f);return y?y.pubkey===c:!1}var X3={};bs(X3,{parse:()=>W3});function W3(c){const f={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let y,C;for(let N=c.tags.length-1;N>=0;N--){const k=c.tags[N];if(k[0]==="e"&&k[1]){const[R,h,V,H,$]=k,K={id:h,relays:V?[V]:[],author:$};if(H==="root"){f.root=K;continue}if(H==="reply"){f.reply=K;continue}if(H==="mention"){f.mentions.push(K);continue}y?C=K:y=K,f.mentions.push(K);continue}if(k[0]==="q"&&k[1]){const[R,h,V]=k;f.quotes.push({id:h,relays:V?[V]:[]})}if(k[0]==="p"&&k[1]){f.profiles.push({pubkey:k[1],relays:k[2]?[k[2]]:[]});continue}}return f.root||(f.root=C||y||f.reply),f.reply||(f.reply=y||f.root),[f.reply,f.root].forEach(N=>{if(!N)return;let k=f.mentions.indexOf(N);if(k!==-1&&f.mentions.splice(k,1),N.author){let R=f.profiles.find(h=>h.pubkey===N.author);R&&R.relays&&(N.relays||(N.relays=[]),R.relays.forEach(h=>{N.relays?.indexOf(h)===-1&&N.relays.push(h)}),R.relays=N.relays)}}),f.mentions.forEach(N=>{if(N.author){let k=f.profiles.find(R=>R.pubkey===N.author);k&&k.relays&&(N.relays||(N.relays=[]),k.relays.forEach(R=>{N.relays.indexOf(R)===-1&&N.relays.push(R)}),k.relays=N.relays)}}),f}var Y3={};bs(Y3,{fetchRelayInformation:()=>K3,useFetchImplementation:()=>$3});var hv;try{hv=fetch}catch{}function $3(c){hv=c}async function K3(c){return await(await fetch(c.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var Q3={};bs(Q3,{fastEventHash:()=>fv,getPow:()=>dv,minePow:()=>J3});function dv(c){let f=0;for(let y=0;y<64;y+=8){const C=parseInt(c.substring(y,y+8),16);if(C===0)f+=32;else{f+=Math.clz32(C);break}}return f}function J3(c,f){let y=0;const C=c,N=["nonce",y.toString(),f.toString()];for(C.tags.push(N);;){const k=Math.floor(new Date().getTime()/1e3);if(k!==C.created_at&&(y=0,C.created_at=k),N[1]=(++y).toString(),C.id=fv(C),dv(C.id)>=f)break}return C}function fv(c){return ss(zd(cu.encode(JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content]))))}var eT={};bs(eT,{unwrapEvent:()=>hT,unwrapManyEvents:()=>dT,wrapEvent:()=>Av,wrapManyEvents:()=>uT});var tT={};bs(tT,{createRumor:()=>wv,createSeal:()=>Ev,createWrap:()=>Sv,unwrapEvent:()=>sx,unwrapManyEvents:()=>Tv,wrapEvent:()=>Yg,wrapManyEvents:()=>lT});var Cm={};bs(Cm,{decrypt:()=>rx,encrypt:()=>ix,getConversationKey:()=>tx,v2:()=>aT});var pv=1,mv=65535;function tx(c,f){const y=p0.getSharedSecret(c,"02"+f).subarray(1,33);return LE(zd,y,"nip44-v2")}function gv(c,f){const y=BE(zd,c,f,76);return{chacha_key:y.subarray(0,32),chacha_nonce:y.subarray(32,44),hmac_key:y.subarray(44,76)}}function nx(c){if(!Number.isSafeInteger(c)||c<1)throw new Error("expected positive integer");if(c<=32)return 32;const f=1<<Math.floor(Math.log2(c-1))+1,y=f<=256?32:f/8;return y*(Math.floor((c-1)/y)+1)}function nT(c){if(!Number.isSafeInteger(c)||c<pv||c>mv)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const f=new Uint8Array(2);return new DataView(f.buffer).setUint16(0,c,!1),f}function iT(c){const f=cu.encode(c),y=f.length,C=nT(y),N=new Uint8Array(nx(y)-y);return l1(C,f,N)}function rT(c){const f=new DataView(c.buffer).getUint16(0),y=c.subarray(2,2+f);if(f<pv||f>mv||y.length!==f||c.length!==2+nx(f))throw new Error("invalid padding");return kh.decode(y)}function yv(c,f,y){if(y.length!==32)throw new Error("AAD associated data must be 32 bytes");const C=l1(y,f);return u1(zd,c,C)}function sT(c){if(typeof c!="string")throw new Error("payload must be a valid string");const f=c.length;if(f<132||f>87472)throw new Error("invalid payload length: "+f);if(c[0]==="#")throw new Error("unknown encryption version");let y;try{y=Ph.decode(c)}catch(k){throw new Error("invalid base64: "+k.message)}const C=y.length;if(C<99||C>65603)throw new Error("invalid data length: "+C);const N=y[0];if(N!==2)throw new Error("unknown encryption version "+N);return{nonce:y.subarray(1,33),ciphertext:y.subarray(33,-32),mac:y.subarray(-32)}}function ix(c,f,y=wb(32)){const{chacha_key:C,chacha_nonce:N,hmac_key:k}=gv(f,y),R=iT(c),h=Lb(C,N,R),V=yv(k,h,y);return Ph.encode(l1(new Uint8Array([2]),y,h,V))}function rx(c,f){const{nonce:y,ciphertext:C,mac:N}=sT(c),{chacha_key:k,chacha_nonce:R,hmac_key:h}=gv(f,y),V=yv(h,C,y);if(!xE(V,N))throw new Error("invalid MAC");const H=Lb(k,R,C);return rT(H)}var aT={utils:{getConversationKey:tx,calcPaddedLen:nx},encrypt:ix,decrypt:rx},oT=2880*60,xv=()=>Math.round(Date.now()/1e3),_v=()=>Math.round(xv()-Math.random()*oT),bv=(c,f)=>tx(c,f),vv=(c,f,y)=>ix(JSON.stringify(c),bv(f,y)),r_=(c,f)=>JSON.parse(rx(c.content,bv(f,c.pubkey)));function wv(c,f){const y={created_at:xv(),content:"",tags:[],...c,pubkey:Am(f)};return y.id=Fg(y),y}function Ev(c,f,y){return Ic({kind:qb,content:vv(c,f,y),created_at:_v(),tags:[]},f)}function Sv(c,f){const y=Ub();return Ic({kind:Qb,content:vv(c,y,f),created_at:_v(),tags:[["p",f]]},y)}function Yg(c,f,y){const C=wv(c,f),N=Ev(C,f,y);return Sv(N,y)}function lT(c,f,y){if(!y||y.length===0)throw new Error("At least one recipient is required.");const C=Am(f),N=[Yg(c,f,C)];return y.forEach(k=>{N.push(Yg(c,f,k))}),N}function sx(c,f){const y=r_(c,f);return r_(y,f)}function Tv(c,f){let y=[];return c.forEach(C=>{y.push(sx(C,f))}),y.sort((C,N)=>C.created_at-N.created_at),y}function cT(c,f,y,C){const N={created_at:Math.ceil(Date.now()/1e3),kind:Zb,tags:[],content:f};return(Array.isArray(c)?c:[c]).forEach(({publicKey:R,relayUrl:h})=>{N.tags.push(h?["p",R,h]:["p",R])}),C&&N.tags.push(["e",C.eventId,C.relayUrl||"","reply"]),y&&N.tags.push(["subject",y]),N}function Av(c,f,y,C,N){const k=cT(f,y,C,N);return Yg(k,c,f.publicKey)}function uT(c,f,y,C,N){if(!f||f.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Am(c)},...f].map(R=>Av(c,R,y,C,N))}var hT=sx,dT=Tv,fT={};bs(fT,{finishRepostEvent:()=>pT,getRepostedEvent:()=>mT,getRepostedEventPointer:()=>Cv});function pT(c,f,y,C){let N;const k=[...c.tags??[],["e",f.id,y],["p",f.pubkey]];return f.kind===Hb?N=Wy:(N=$y,k.push(["k",String(f.kind)])),Ic({kind:N,tags:k,content:c.content===""||f.tags?.find(R=>R[0]==="-")?"":JSON.stringify(f),created_at:c.created_at},C)}function Cv(c){if(![Wy,$y].includes(c.kind))return;let f,y;for(let C=c.tags.length-1;C>=0&&(f===void 0||y===void 0);C--){const N=c.tags[C];N.length>=2&&(N[0]==="e"&&f===void 0?f=N:N[0]==="p"&&y===void 0&&(y=N))}if(f!==void 0)return{id:f[1],relays:[f[2],y?.[2]].filter(C=>typeof C=="string"),author:y?.[1]}}function mT(c,{skipVerification:f}={}){const y=Cv(c);if(y===void 0||c.content==="")return;let C;try{C=JSON.parse(c.content)}catch{return}if(C.id===y.id&&!(!f&&!d1(C)))return C}var gT={};bs(gT,{NOSTR_URI_REGEX:()=>ax,parse:()=>xT,test:()=>yT});var ax=new RegExp(`nostr:(${ov.source})`);function yT(c){return typeof c=="string"&&new RegExp(`^${ax.source}$`).test(c)}function xT(c){const f=c.match(new RegExp(`^${ax.source}$`));if(!f)throw new Error(`Invalid Nostr URI: ${c}`);return{uri:f[0],value:f[1],decoded:p1(f[1])}}var _T={};bs(_T,{finishReactionEvent:()=>bT,getReactedEventPointer:()=>vT});function bT(c,f,y){const C=f.tags.filter(N=>N.length>=2&&(N[0]==="e"||N[0]==="p"));return Ic({...c,kind:Yy,tags:[...c.tags??[],...C,["e",f.id],["p",f.pubkey]],content:c.content??"+"},y)}function vT(c){if(c.kind!==Yy)return;let f,y;for(let C=c.tags.length-1;C>=0&&(f===void 0||y===void 0);C--){const N=c.tags[C];N.length>=2&&(N[0]==="e"&&f===void 0?f=N:N[0]==="p"&&y===void 0&&(y=N))}if(!(f===void 0||y===void 0))return{id:f[1],relays:[f[2],y[2]].filter(C=>C!==void 0),author:y[1]}}var wT={};bs(wT,{parse:()=>ST});var s_=/\W/m,a_=/[^\w\/] |[^\w\/]$|$|,| /m,ET=42;function*ST(c){let f=[];if(typeof c!="string"){for(let k=0;k<c.tags.length;k++){const R=c.tags[k];R[0]==="emoji"&&R.length>=3&&f.push({type:"emoji",shortcode:R[1],url:R[2]})}c=c.content}const y=c.length;let C=0,N=0;e:for(;N<y;){const k=c.indexOf(":",N),R=c.indexOf("#",N);if(k===-1&&R===-1)break e;if(k===-1||R>=0&&R<k){if(R===0||c[R-1]===" "){const h=c.slice(R+1,R+ET).match(s_),V=h?R+1+h.index:y;yield{type:"text",text:c.slice(C,R)},yield{type:"hashtag",value:c.slice(R+1,V)},N=V,C=N;continue e}N=R+1;continue e}if(c.slice(k-5,k)==="nostr"){const h=c.slice(k+60).match(s_),V=h?k+60+h.index:y;try{let H,{data:$,type:K}=p1(c.slice(k+1,V));switch(K){case"npub":H={pubkey:$};break;case"note":H={id:$};break;case"nsec":N=V+1;continue;default:H=$}C!==k-5&&(yield{type:"text",text:c.slice(C,k-5)}),yield{type:"reference",pointer:H},N=V,C=N;continue e}catch{N=k+1;continue e}}else if(c.slice(k-5,k)==="https"||c.slice(k-4,k)==="http"){const h=c.slice(k+4).match(a_),V=h?k+4+h.index:y,H=c[k-1]==="s"?5:4;try{let $=new URL(c.slice(k-H,V));if($.hostname.indexOf(".")===-1)throw new Error("invalid url");if(C!==k-H&&(yield{type:"text",text:c.slice(C,k-H)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test($.pathname)){yield{type:"image",url:$.toString()},N=V,C=N;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test($.pathname)){yield{type:"video",url:$.toString()},N=V,C=N;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test($.pathname)){yield{type:"audio",url:$.toString()},N=V,C=N;continue e}yield{type:"url",url:$.toString()},N=V,C=N;continue e}catch{N=V+1;continue e}}else if(c.slice(k-3,k)==="wss"||c.slice(k-2,k)==="ws"){const h=c.slice(k+4).match(a_),V=h?k+4+h.index:y,H=c[k-1]==="s"?3:2;try{let $=new URL(c.slice(k-H,V));if($.hostname.indexOf(".")===-1)throw new Error("invalid ws url");C!==k-H&&(yield{type:"text",text:c.slice(C,k-H)}),yield{type:"relay",url:$.toString()},N=V,C=N;continue e}catch{N=V+1;continue e}}else{for(let h=0;h<f.length;h++){const V=f[h];if(c[k+V.shortcode.length+1]===":"&&c.slice(k+1,k+V.shortcode.length+1)===V.shortcode){C!==k&&(yield{type:"text",text:c.slice(C,k)}),yield V,N=k+V.shortcode.length+2,C=N;continue e}}N=k+1;continue e}}C!==y&&(yield{type:"text",text:c.slice(C)})}var TT={};bs(TT,{channelCreateEvent:()=>AT,channelHideMessageEvent:()=>MT,channelMessageEvent:()=>IT,channelMetadataEvent:()=>CT,channelMuteUserEvent:()=>RT});var AT=(c,f)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Ic({kind:Xb,tags:[...c.tags??[]],content:y,created_at:c.created_at},f)},CT=(c,f)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Ic({kind:Wb,tags:[["e",c.channel_create_event_id],...c.tags??[]],content:y,created_at:c.created_at},f)},IT=(c,f)=>{const y=[["e",c.channel_create_event_id,c.relay_url,"root"]];return c.reply_to_channel_message_event_id&&y.push(["e",c.reply_to_channel_message_event_id,c.relay_url,"reply"]),Ic({kind:Yb,tags:[...y,...c.tags??[]],content:c.content,created_at:c.created_at},f)},MT=(c,f)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Ic({kind:$b,tags:[["e",c.channel_message_event_id],...c.tags??[]],content:y,created_at:c.created_at},f)},RT=(c,f)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return Ic({kind:Kb,tags:[["p",c.pubkey_to_mute],...c.tags??[]],content:y,created_at:c.created_at},f)},DT={};bs(DT,{EMOJI_SHORTCODE_REGEX:()=>Iv,matchAll:()=>NT,regex:()=>ox,replaceAll:()=>kT});var Iv=/:(\w+):/,ox=()=>new RegExp(`\\B${Iv.source}\\B`,"g");function*NT(c){const f=c.matchAll(ox());for(const y of f)try{const[C,N]=y;yield{shortcode:C,name:N,start:y.index,end:y.index+C.length}}catch{}}function kT(c,f){return c.replaceAll(ox(),(y,C)=>f({shortcode:y,name:C}))}var PT={};bs(PT,{useFetchImplementation:()=>OT,validateGithub:()=>zT});var lx;try{lx=fetch}catch{}function OT(c){lx=c}async function zT(c,f,y){try{return await(await lx(`https://gist.github.com/${f}/${y}/raw`)).text()===`Verifying that I control the following Nostr public key: ${c}`}catch{return!1}}var LT={};bs(LT,{makeNwcRequestEvent:()=>FT,parseConnectionString:()=>BT});function BT(c){const{host:f,pathname:y,searchParams:C}=new URL(c),N=y||f,k=C.get("relay"),R=C.get("secret");if(!N||!k||!R)throw new Error("invalid connection string");return{pubkey:N,relay:k,secret:R}}async function FT(c,f,y){const N=lv(f,c,JSON.stringify({method:"pay_invoice",params:{invoice:y}})),k={kind:ev,created_at:Math.round(Date.now()/1e3),content:N,tags:[["p",c]]};return Ic(k,f)}var jT={};bs(jT,{normalizeIdentifier:()=>UT});function UT(c){return c=c.trim().toLowerCase(),c=c.normalize("NFKC"),Array.from(c).map(f=>new RegExp("\\p{Letter}","u").test(f)||new RegExp("\\p{Number}","u").test(f)?f:"-").join("")}var VT={};bs(VT,{getSatoshisAmountFromBolt11:()=>WT,getZapEndpoint:()=>HT,makeZapReceipt:()=>XT,makeZapRequest:()=>qT,useFetchImplementation:()=>GT,validateZapRequest:()=>ZT});var cx;try{cx=fetch}catch{}function GT(c){cx=c}async function HT(c){try{let f="",{lud06:y,lud16:C}=JSON.parse(c.content);if(C){let[R,h]=C.split("@");f=new URL(`/.well-known/lnurlp/${R}`,`https://${h}`).toString()}else if(y){let{words:R}=Xu.decode(y,1e3),h=Xu.fromWords(R);f=kh.decode(h)}else return null;let k=await(await cx(f)).json();if(k.allowsNostr&&k.nostrPubkey)return k.callback}catch{}return null}function qT(c){let f={kind:9734,created_at:Math.round(Date.now()/1e3),content:c.comment||"",tags:[["p","pubkey"in c?c.pubkey:c.event.pubkey],["amount",c.amount.toString()],["relays",...c.relays]]};if("event"in c){if(f.tags.push(["e",c.event.id]),Zy(c.event.kind)){const y=["a",`${c.event.kind}:${c.event.pubkey}:`];f.tags.push(y)}else if(Xy(c.event.kind)){let y=c.event.tags.find(([N,k])=>N==="d"&&k);if(!y)throw new Error("d tag not found or is empty");const C=["a",`${c.event.kind}:${c.event.pubkey}:${y[1]}`];f.tags.push(C)}f.tags.push(["k",c.event.kind.toString()])}return f}function ZT(c){let f;try{f=JSON.parse(c)}catch{return"Invalid zap request JSON."}if(!Hy(f))return"Zap request is not a valid Nostr event.";if(!d1(f))return"Invalid signature on zap request.";let y=f.tags.find(([k,R])=>k==="p"&&R);if(!y)return"Zap request doesn't have a 'p' tag.";if(!y[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let C=f.tags.find(([k,R])=>k==="e"&&R);return C&&!C[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":f.tags.find(([k,R])=>k==="relays"&&R)?null:"Zap request doesn't have a 'relays' tag."}function XT({zapRequest:c,preimage:f,bolt11:y,paidAt:C}){let N=JSON.parse(c),k=N.tags.filter(([h])=>h==="e"||h==="p"||h==="a"),R={kind:9735,created_at:Math.round(C.getTime()/1e3),content:"",tags:[...k,["P",N.pubkey],["bolt11",y],["description",c]]};return f&&R.tags.push(["preimage",f]),R}function WT(c){if(c.length<50)return 0;c=c.substring(0,50);const f=c.lastIndexOf("1");if(f===-1)return 0;const y=c.substring(0,f);if(!y.startsWith("lnbc"))return 0;const C=y.substring(4);if(C.length<1)return 0;const N=C[C.length-1],k=N.charCodeAt(0)-48,R=k>=0&&k<=9;let h=C.length-1;if(R&&h++,h<1)return 0;const V=parseInt(C.substring(0,h));switch(N){case"m":return V*1e5;case"u":return V*100;case"n":return V/10;case"p":return V/1e4;default:return V*1e8}}var YT={};bs(YT,{Negentropy:()=>Rv,NegentropyStorageVector:()=>QT,NegentropySync:()=>JT});var ny=97,c0=32,Mv=16,Ff={Skip:0,Fingerprint:1,IdList:2},Nh=class{_raw;length;constructor(c){typeof c=="number"?(this._raw=new Uint8Array(c),this.length=0):c instanceof Uint8Array?(this._raw=new Uint8Array(c),this.length=c.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(c){if(c instanceof Nh&&(c=c.unwrap()),typeof c.length!="number")throw Error("bad length");const f=c.length+this.length;if(this.capacity<f){const y=this._raw,C=Math.max(this.capacity*2,f);this._raw=new Uint8Array(C),this._raw.set(y)}this._raw.set(c,this.length),this.length+=c.length}shift(){const c=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,c}shiftN(c=1){const f=this._raw.subarray(0,c);return this._raw=this._raw.subarray(c),this.length-=c,f}};function Og(c){let f=0;for(;;){if(c.length===0)throw Error("parse ends prematurely");let y=c.shift();if(f=f<<7|y&127,(y&128)===0)break}return f}function Mh(c){if(c===0)return new Nh(new Uint8Array([0]));let f=[];for(;c!==0;)f.push(c&127),c>>>=7;f.reverse();for(let y=0;y<f.length-1;y++)f[y]|=128;return new Nh(new Uint8Array(f))}function $T(c){return jg(c,1)[0]}function jg(c,f){if(c.length<f)throw Error("parse ends prematurely");return c.shiftN(f)}var KT=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(c0)}add(c){let f=0,y=0,C=new DataView(this.buf.buffer),N=new DataView(c.buffer);for(let k=0;k<8;k++){let R=k*4,h=C.getUint32(R,!0),V=N.getUint32(R,!0),H=h;H+=f,H+=V,H>4294967295&&(y=1),C.setUint32(R,H&4294967295,!0),f=y,y=0}}negate(){let c=new DataView(this.buf.buffer);for(let y=0;y<8;y++){let C=y*4;c.setUint32(C,~c.getUint32(C,!0))}let f=new Uint8Array(c0);f[0]=1,this.add(f)}getFingerprint(c){let f=new Nh;return f.extend(this.buf),f.extend(Mh(c)),zd(f.unwrap()).subarray(0,Mv)}},QT=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(c,f){if(this.sealed)throw Error("already sealed");const y=Ib(f);if(y.byteLength!==c0)throw Error("bad id size for added item");this.items.push({timestamp:c,id:y})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(iy);for(let c=1;c<this.items.length;c++)if(iy(this.items[c-1],this.items[c])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(c){if(this._checkSealed(),c>=this.items.length)throw Error("out of range");return this.items[c]}iterate(c,f,y){this._checkSealed(),this._checkBounds(c,f);for(let C=c;C<f&&y(this.items[C],C);++C);}findLowerBound(c,f,y){return this._checkSealed(),this._checkBounds(c,f),this._binarySearch(this.items,c,f,C=>iy(C,y)<0)}fingerprint(c,f){let y=new KT;return y.setToZero(),this.iterate(c,f,C=>(y.add(C.id),!0)),y.getFingerprint(f-c)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(c,f){if(c>f||f>this.items.length)throw Error("bad range")}_binarySearch(c,f,y,C){let N=y-f;for(;N>0;){let k=f,R=Math.floor(N/2);k+=R,C(c[k])?(f=++k,N-=R+1):N=R}return f}},Rv=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(c,f=6e4){if(f<4096)throw Error("frameSizeLimit too small");this.storage=c,this.frameSizeLimit=f,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(c,f){return{timestamp:c,id:f||new Uint8Array(0)}}initiate(){let c=new Nh;return c.extend(new Uint8Array([ny])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),c),s0(c.unwrap())}reconcile(c,f,y){const C=new Nh(Ib(c));this.lastTimestampIn=this.lastTimestampOut=0;let N=new Nh;N.extend(new Uint8Array([ny]));let k=$T(C);if(k<96||k>111)throw Error("invalid negentropy protocol version byte");if(k!==ny)throw Error("unsupported negentropy protocol version requested: "+(k-96));let R=this.storage.size(),h=this._bound(0),V=0,H=!1;for(;C.length!==0;){let $=new Nh,K=()=>{H&&(H=!1,$.extend(this.encodeBound(h)),$.extend(Mh(Ff.Skip)))},be=this.decodeBound(C),Ce=Og(C),Ee=V,ye=this.storage.findLowerBound(V,R,be);if(Ce===Ff.Skip)H=!0;else if(Ce===Ff.Fingerprint){let he=jg(C,Mv),ke=this.storage.fingerprint(Ee,ye);Dv(he,ke)!==0?(K(),this.splitRange(Ee,ye,be,$)):H=!0}else if(Ce===Ff.IdList){let he=Og(C),ke={};for(let nt=0;nt<he;nt++){let Qe=jg(C,c0);ke[s0(Qe)]=Qe}if(H=!0,this.storage.iterate(Ee,ye,nt=>{let Qe=nt.id;const dt=s0(Qe);return ke[dt]?delete ke[s0(Qe)]:f?.(dt),!0}),y)for(let nt of Object.values(ke))y(s0(nt))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(N.length+$.length)){let he=this.storage.fingerprint(ye,R);N.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),N.extend(Mh(Ff.Fingerprint)),N.extend(he);break}else N.extend($);V=ye,h=be}return N.length===1?null:s0(N.unwrap())}splitRange(c,f,y,C){let N=f-c,k=16;if(N<k*2)C.extend(this.encodeBound(y)),C.extend(Mh(Ff.IdList)),C.extend(Mh(N)),this.storage.iterate(c,f,R=>(C.extend(R.id),!0));else{let R=Math.floor(N/k),h=N%k,V=c;for(let H=0;H<k;H++){let $=R+(H<h?1:0),K=this.storage.fingerprint(V,V+$);V+=$;let be;if(V===f)be=y;else{let Ce,Ee;this.storage.iterate(V-1,V+1,(ye,he)=>(he===V-1?Ce=ye:Ee=ye,!0)),be=this.getMinimalBound(Ce,Ee)}C.extend(this.encodeBound(be)),C.extend(Mh(Ff.Fingerprint)),C.extend(K)}}}exceededFrameSizeLimit(c){return c>this.frameSizeLimit-200}decodeTimestampIn(c){let f=Og(c);return f=f===0?Number.MAX_VALUE:f-1,this.lastTimestampIn===Number.MAX_VALUE||f===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(f+=this.lastTimestampIn,this.lastTimestampIn=f,f)}decodeBound(c){let f=this.decodeTimestampIn(c),y=Og(c);if(y>c0)throw Error("bound key too long");let C=jg(c,y);return{timestamp:f,id:C}}encodeTimestampOut(c){if(c===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,Mh(0);let f=c;return c-=this.lastTimestampOut,this.lastTimestampOut=f,Mh(c+1)}encodeBound(c){let f=new Nh;return f.extend(this.encodeTimestampOut(c.timestamp)),f.extend(Mh(c.id.length)),f.extend(c.id),f}getMinimalBound(c,f){if(f.timestamp!==c.timestamp)return this._bound(f.timestamp);{let y=0,C=f.id,N=c.id;for(let k=0;k<c0&&C[k]===N[k];k++)y++;return this._bound(f.timestamp,f.id.subarray(0,y+1))}}};function Dv(c,f){for(let y=0;y<c.byteLength;y++){if(c[y]<f[y])return-1;if(c[y]>f[y])return 1}return c.byteLength>f.byteLength?1:c.byteLength<f.byteLength?-1:0}function iy(c,f){return c.timestamp===f.timestamp?Dv(c.id,f.id):c.timestamp-f.timestamp}var JT=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(c,f,y,C={}){this.relay=c,this.storage=f,this.neg=new Rv(f),this.onhave=C.onhave,this.onneed=C.onneed,this.filter=y,this.subscription=this.relay.prepareSubscription([{}],{label:C.label||"negentropy"}),this.subscription.oncustom=N=>{switch(N[0]){case"NEG-MSG":{N.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${N}`);try{const k=this.neg.reconcile(N[2],this.onhave,this.onneed);k?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${k}"]`):(this.close(),C.onclose?.())}catch(k){console.error("negentropy reconcile error:",k),C?.onclose?.(`reconcile error: ${k}`)}break}case"NEG-CLOSE":{const k=N[2];console.warn("negentropy error:",k),C.onclose?.(k);break}case"NEG-ERR":C.onclose?.()}}}async start(){const c=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${c}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},eA={};bs(eA,{getToken:()=>tA,hashPayload:()=>ux,unpackEventFromToken:()=>kv,validateEvent:()=>Fv,validateEventKind:()=>Ov,validateEventMethodTag:()=>Lv,validateEventPayloadTag:()=>Bv,validateEventTimestamp:()=>Pv,validateEventUrlTag:()=>zv,validateToken:()=>nA});var Nv="Nostr ";async function tA(c,f,y,C=!1,N){const k={kind:Ky,tags:[["u",c],["method",f]],created_at:Math.round(new Date().getTime()/1e3),content:""};N&&k.tags.push(["payload",ux(N)]);const R=await y(k);return(C?Nv:"")+Ph.encode(cu.encode(JSON.stringify(R)))}async function nA(c,f,y){const C=await kv(c).catch(k=>{throw k});return await Fv(C,f,y).catch(k=>{throw k})}async function kv(c){if(!c)throw new Error("Missing token");c=c.replace(Nv,"");const f=kh.decode(Ph.decode(c));if(!f||f.length===0||!f.startsWith("{"))throw new Error("Invalid token");return JSON.parse(f)}function Pv(c){return c.created_at?Math.round(new Date().getTime()/1e3)-c.created_at<60:!1}function Ov(c){return c.kind===Ky}function zv(c,f){const y=c.tags.find(C=>C[0]==="u");return y?y.length>0&&y[1]===f:!1}function Lv(c,f){const y=c.tags.find(C=>C[0]==="method");return y?y.length>0&&y[1].toLowerCase()===f.toLowerCase():!1}function ux(c){const f=zd(cu.encode(JSON.stringify(c)));return ss(f)}function Bv(c,f){const y=c.tags.find(N=>N[0]==="payload");if(!y)return!1;const C=ux(f);return y.length>0&&y[1]===C}async function Fv(c,f,y,C){if(!d1(c))throw new Error("Invalid nostr event, signature invalid");if(!Ov(c))throw new Error("Invalid nostr event, kind invalid");if(!Pv(c))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!zv(c,f))throw new Error("Invalid nostr event, url tag invalid");if(!Lv(c,y))throw new Error("Invalid nostr event, method tag invalid");if(C&&typeof C=="object"&&Object.keys(C).length>0&&!Bv(c,C))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const o_=c=>Array.from(c).map(f=>f.toString(16).padStart(2,"0")).join(""),jv=De.createContext(null),iA=({children:c})=>{const[f,y]=De.useState(localStorage.getItem("parlens_pubkey")),[C]=De.useState(()=>new R3({enablePing:!0,enableReconnect:!0})),N=async(h,V,H)=>{let $="",K=null;if(h==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");$=await window.nostr.getPublicKey()}else if(h==="nsec"&&V)try{const be=Zf.decode(V);if(be.type!=="nsec")throw new Error("Not an nsec");K=be.data,$=Am(K),localStorage.setItem("parlens_privkey",o_(K))}catch{throw new Error("Invalid nsec format")}else h==="create"&&(K=Ub(),$=Am(K),localStorage.setItem("parlens_privkey",o_(K)));if(y($),localStorage.setItem("parlens_pubkey",$),h==="create"&&H&&K)try{const be=Ic({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:H,display_name:H,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${$}`})},K);await Promise.any([C.publish(["wss://relay.damus.io","wss://nos.lol"],be)])}catch(be){console.warn("Failed to publish metadata:",be)}},k=()=>{y(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},R=async h=>{const V=localStorage.getItem("parlens_privkey");if(V){const H=new Uint8Array(V.match(/.{1,2}/g).map($=>parseInt($,16)));return Ic(h,H)}if(window.nostr)return await window.nostr.signEvent(h);throw new Error("No signing method available")};return O.jsx(jv.Provider,{value:{pubkey:f,login:N,logout:k,pool:C,signEvent:R},children:c})},Wu=()=>{const c=De.useContext(jv);if(!c)throw new Error("useAuth must be used within AuthProvider");return c};const rA=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),sA=c=>c.replace(/^([A-Z])|[\s-_]+(\w)/g,(f,y,C)=>C?C.toUpperCase():y.toLowerCase()),l_=c=>{const f=sA(c);return f.charAt(0).toUpperCase()+f.slice(1)},Uv=(...c)=>c.filter((f,y,C)=>!!f&&f.trim()!==""&&C.indexOf(f)===y).join(" ").trim(),aA=c=>{for(const f in c)if(f.startsWith("aria-")||f==="role"||f==="title")return!0};var oA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const lA=De.forwardRef(({color:c="currentColor",size:f=24,strokeWidth:y=2,absoluteStrokeWidth:C,className:N="",children:k,iconNode:R,...h},V)=>De.createElement("svg",{ref:V,...oA,width:f,height:f,stroke:c,strokeWidth:C?Number(y)*24/Number(f):y,className:Uv("lucide",N),...!k&&!aA(h)&&{"aria-hidden":"true"},...h},[...R.map(([H,$])=>De.createElement(H,$)),...Array.isArray(k)?k:[k]]));const Ji=(c,f)=>{const y=De.forwardRef(({className:C,...N},k)=>De.createElement(lA,{ref:k,iconNode:f,className:Uv(`lucide-${rA(l_(c))}`,`lucide-${c}`,C),...N}));return y.displayName=l_(c),y};const cA=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Vv=Ji("arrow-left",cA);const uA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Gv=Ji("arrow-right",uA);const hA=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],dA=Ji("arrow-up-down",hA);const fA=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],pA=Ji("arrow-up",fA);const mA=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],gA=Ji("ban",mA);const yA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Xf=Ji("check",yA);const xA=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],kd=Ji("chevron-down",xA);const _A=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Yf=Ji("chevron-right",_A);const bA=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],x1=Ji("chevron-up",bA);const vA=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Hv=Ji("clock",vA);const wA=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],hx=Ji("copy",wA);const EA=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],SA=Ji("ellipsis-vertical",EA);const TA=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],dx=Ji("eye-off",TA);const AA=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],CA=Ji("eye",AA);const IA=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],MA=Ji("folder-open",IA);const RA=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],vy=Ji("key",RA);const DA=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],NA=Ji("locate-fixed",DA);const kA=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],zg=Ji("locate",kA);const PA=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Oh=Ji("map-pin",PA);const OA=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],zA=Ji("map-pinned",OA);const LA=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],BA=Ji("navigation",LA);const FA=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],$f=Ji("pencil",FA);const jA=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],$g=Ji("plus",jA);const UA=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],VA=Ji("qr-code",UA);const GA=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],c_=Ji("radio",GA);const HA=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],qA=Ji("rotate-cw",HA);const ZA=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],qv=Ji("route",ZA);const XA=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],WA=Ji("save",XA);const YA=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],$A=Ji("scan-line",YA);const KA=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Zv=Ji("search",KA);const QA=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Xv=Ji("shield",QA);const JA=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],u_=Ji("star",JA);const eC=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Kf=Ji("trash-2",eC);const tC=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],h_=Ji("trash",tC);const nC=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],iC=Ji("user-plus",nC);const rC=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],sC=Ji("user",rC);const aC=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],oC=Ji("users",aC);const lC=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Il=Ji("x",lC),cC=De.createContext(null);function uC(c,f){const y=Array.isArray(c)?c[0]:c?c.x:0,C=Array.isArray(c)?c[1]:c?c.y:0,N=Array.isArray(f)?f[0]:f?f.x:0,k=Array.isArray(f)?f[1]:f?f.y:0;return y===N&&C===k}function Cl(c,f){if(c===f)return!0;if(!c||!f)return!1;if(Array.isArray(c)){if(!Array.isArray(f)||c.length!==f.length)return!1;for(let y=0;y<c.length;y++)if(!Cl(c[y],f[y]))return!1;return!0}else if(Array.isArray(f))return!1;if(typeof c=="object"&&typeof f=="object"){const y=Object.keys(c),C=Object.keys(f);if(y.length!==C.length)return!1;for(const N of y)if(!f.hasOwnProperty(N)||!Cl(c[N],f[N]))return!1;return!0}return!1}function d_(c){return{longitude:c.center.lng,latitude:c.center.lat,zoom:c.zoom,pitch:c.pitch,bearing:c.bearing,padding:c.padding}}function f_(c,f){const y=f.viewState||f,C={};if("longitude"in y&&"latitude"in y&&(y.longitude!==c.center.lng||y.latitude!==c.center.lat)){const N=c.center.constructor;C.center=new N(y.longitude,y.latitude)}return"zoom"in y&&y.zoom!==c.zoom&&(C.zoom=y.zoom),"bearing"in y&&y.bearing!==c.bearing&&(C.bearing=y.bearing),"pitch"in y&&y.pitch!==c.pitch&&(C.pitch=y.pitch),y.padding&&c.padding&&!Cl(y.padding,c.padding)&&(C.padding=y.padding),C}const hC=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function p_(c){if(!c)return null;if(typeof c=="string"||("toJS"in c&&(c=c.toJS()),!c.layers))return c;const f={};for(const C of c.layers)f[C.id]=C;const y=c.layers.map(C=>{let N=null;"interactive"in C&&(N=Object.assign({},C),delete N.interactive);const k=f[C.ref];if(k){N=N||Object.assign({},C),delete N.ref;for(const R of hC)R in k&&(N[R]=k[R])}return N||C});return{...c,layers:y}}const m_={version:8,sources:{},layers:[]},g_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},y_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},x_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},dC=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],fC=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class d0{constructor(f,y,C){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=N=>{const k=this.props[x_[N.type]];k?k(N):N.type==="error"&&console.error(N.error)},this._onCameraEvent=N=>{if(this._internalUpdate)return;N.viewState=this._propsedCameraUpdate||d_(this._map.transform);const k=this.props[y_[N.type]];k&&k(N)},this._onCameraUpdate=N=>this._internalUpdate?N:(this._propsedCameraUpdate=d_(N),f_(N,this.props)),this._onPointerEvent=N=>{(N.type==="mousemove"||N.type==="mouseout")&&this._updateHover(N);const k=this.props[g_[N.type]];k&&(this.props.interactiveLayerIds&&N.type!=="mouseover"&&N.type!=="mouseout"&&(N.features=this._hoveredFeatures||this._queryRenderedFeatures(N.point)),k(N),delete N.features)},this._MapClass=f,this.props=y,this._initialize(C)}get map(){return this._map}setProps(f){const y=this.props;this.props=f;const C=this._updateSettings(f,y),N=this._updateSize(f),k=this._updateViewState(f);this._updateStyle(f,y),this._updateStyleComponents(f),this._updateHandlers(f,y),(C||N||k&&!this._map.isMoving())&&this.redraw()}static reuse(f,y){const C=d0.savedMaps.pop();if(!C)return null;const N=C.map,k=N.getContainer();for(y.className=k.className;k.childNodes.length>0;)y.appendChild(k.childNodes[0]);N._container=y;const R=N._resizeObserver;R&&(R.disconnect(),R.observe(y)),C.setProps({...f,styleDiffing:!1}),N.resize();const{initialViewState:h}=f;return h&&(h.bounds?N.fitBounds(h.bounds,{...h.fitBoundsOptions,duration:0}):C._updateViewState(h)),N.isStyleLoaded()?N.fire("load"):N.once("style.load",()=>N.fire("load")),N._update(),C}_initialize(f){const{props:y}=this,{mapStyle:C=m_}=y,N={...y,...y.initialViewState,container:f,style:p_(C)},k=N.initialViewState||N.viewState||N;if(Object.assign(N,{center:[k.longitude||0,k.latitude||0],zoom:k.zoom||0,pitch:k.pitch||0,bearing:k.bearing||0}),y.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,y.gl)}const R=new this._MapClass(N);k.padding&&R.setPadding(k.padding),y.cursor&&(R.getCanvas().style.cursor=y.cursor),R.transformCameraUpdate=this._onCameraUpdate,R.on("style.load",()=>{this._styleComponents={light:R.getLight(),sky:R.getSky(),projection:R.getProjection?.(),terrain:R.getTerrain()},this._updateStyleComponents(this.props)}),R.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const h in g_)R.on(h,this._onPointerEvent);for(const h in y_)R.on(h,this._onCameraEvent);for(const h in x_)R.on(h,this._onEvent);this._map=R}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),d0.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const f=this._map;f.style&&(f._frame&&(f._frame.cancel(),f._frame=null),f._render())}_updateSize(f){const{viewState:y}=f;if(y){const C=this._map;if(y.width!==C.transform.width||y.height!==C.transform.height)return C.resize(),!0}return!1}_updateViewState(f){const y=this._map,C=y.transform;if(!y.isMoving()){const k=f_(C,f);if(Object.keys(k).length>0)return this._internalUpdate=!0,y.jumpTo(k),this._internalUpdate=!1,!0}return!1}_updateSettings(f,y){const C=this._map;let N=!1;for(const k of dC)k in f&&!Cl(f[k],y[k])&&(N=!0,C[`set${k[0].toUpperCase()}${k.slice(1)}`]?.call(C,f[k]));return N}_updateStyle(f,y){if(f.cursor!==y.cursor&&(this._map.getCanvas().style.cursor=f.cursor||""),f.mapStyle!==y.mapStyle){const{mapStyle:C=m_,styleDiffing:N=!0}=f,k={diff:N};"localIdeographFontFamily"in f&&(k.localIdeographFontFamily=f.localIdeographFontFamily),this._map.setStyle(p_(C),k)}}_updateStyleComponents({light:f,projection:y,sky:C,terrain:N}){const k=this._map,R=this._styleComponents;k.style._loaded&&(f&&!Cl(f,R.light)&&(R.light=f,k.setLight(f)),y&&!Cl(y,R.projection)&&y!==R.projection?.type&&(R.projection=typeof y=="string"?{type:y}:y,k.setProjection?.(R.projection)),C&&!Cl(C,R.sky)&&(R.sky=C,k.setSky(C)),N!==void 0&&!Cl(N,R.terrain)&&(!N||k.getSource(N.source))&&(R.terrain=N,k.setTerrain(N)))}_updateHandlers(f,y){const C=this._map;for(const N of fC){const k=f[N]??!0,R=y[N]??!0;Cl(k,R)||(k?C[N].enable(k):C[N].disable())}}_queryRenderedFeatures(f){const y=this._map,{interactiveLayerIds:C=[]}=this.props;try{return y.queryRenderedFeatures(f,{layers:C.filter(y.getLayer.bind(y))})}catch{return[]}}_updateHover(f){const{props:y}=this;if(y.interactiveLayerIds&&(y.onMouseMove||y.onMouseEnter||y.onMouseLeave)){const N=f.type,k=this._hoveredFeatures?.length>0,R=this._queryRenderedFeatures(f.point),h=R.length>0;!h&&k&&(f.type="mouseleave",this._onPointerEvent(f)),this._hoveredFeatures=R,h&&!k&&(f.type="mouseenter",this._onPointerEvent(f)),f.type=N}else this._hoveredFeatures=null}}d0.savedMaps=[];const pC=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function mC(c){if(!c)return null;const f=c.map,y={getMap:()=>f};for(const C of gC(f))!(C in y)&&!pC.includes(C)&&(y[C]=f[C].bind(f));return y}function gC(c){const f=new Set;let y=c;for(;y;){for(const C of Object.getOwnPropertyNames(y))C[0]!=="_"&&typeof c[C]=="function"&&C!=="fire"&&C!=="setEventedParent"&&f.add(C);y=Object.getPrototypeOf(y)}return Array.from(f)}const yC=typeof document<"u"?De.useLayoutEffect:De.useEffect;function xC(c,f){const{RTLTextPlugin:y,maxParallelImageRequests:C,workerCount:N,workerUrl:k}=f;if(y&&c.getRTLTextPluginStatus&&c.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:R,lazy:h=!0}=typeof y=="string"?{pluginUrl:y}:y;c.setRTLTextPlugin(R,V=>{V&&console.error(V)},h)}C!==void 0&&c.setMaxParallelImageRequests(C),N!==void 0&&c.setWorkerCount(N),k!==void 0&&c.setWorkerUrl(k)}const g0=De.createContext(null);function _C(c,f){const y=De.useContext(cC),[C,N]=De.useState(null),k=De.useRef(),{current:R}=De.useRef({mapLib:null,map:null});De.useEffect(()=>{const H=c.mapLib;let $=!0,K;return Promise.resolve(H||Gg(()=>Promise.resolve().then(()=>LC),void 0)).then(be=>{if(!$)return;if(!be)throw new Error("Invalid mapLib");const Ce="Map"in be?be:be.default;if(!Ce.Map)throw new Error("Invalid mapLib");xC(Ce,c),c.reuseMaps&&(K=d0.reuse(c,k.current)),K||(K=new d0(Ce.Map,c,k.current)),R.map=mC(K),R.mapLib=Ce,N(K),y?.onMapMount(R.map,c.id)}).catch(be=>{const{onError:Ce}=c;Ce?Ce({type:"error",target:null,originalEvent:null,error:be}):console.error(be)}),()=>{$=!1,K&&(y?.onMapUnmount(c.id),c.reuseMaps?K.recycle():K.destroy())}},[]),yC(()=>{C&&C.setProps(c)}),De.useImperativeHandle(f,()=>R.map,[C]);const h=De.useMemo(()=>({position:"relative",width:"100%",height:"100%",...c.style}),[c.style]),V={height:"100%"};return De.createElement("div",{id:c.id,ref:k,style:h},C&&De.createElement(g0.Provider,{value:R},De.createElement("div",{"mapboxgl-children":"",style:V},c.children)))}const bC=De.forwardRef(_C);var Wv=eb();const vC=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Fh(c,f){if(!c||!f)return;const y=c.style;for(const C in f){const N=f[C];Number.isFinite(N)&&!vC.test(C)?y[C]=`${N}px`:y[C]=N}}function Yv(c,f){if(c===f)return null;const y=__(c),C=__(f),N=[];for(const k of C)y.has(k)||N.push(k);for(const k of y)C.has(k)||N.push(k);return N.length===0?null:N}function __(c){return new Set(c?c.trim().split(/\s+/):[])}const jf=De.memo(De.forwardRef((c,f)=>{const{map:y,mapLib:C}=De.useContext(g0),N=De.useRef({props:c}),k=De.useMemo(()=>{let ke=!1;De.Children.forEach(c.children,dt=>{dt&&(ke=!0)});const nt={...c,element:ke?document.createElement("div"):void 0},Qe=new C.Marker(nt);return Qe.setLngLat([c.longitude,c.latitude]),Qe.getElement().addEventListener("click",dt=>{N.current.props.onClick?.({type:"click",target:Qe,originalEvent:dt})}),Qe.on("dragstart",dt=>{const Ut=dt;Ut.lngLat=k.getLngLat(),N.current.props.onDragStart?.(Ut)}),Qe.on("drag",dt=>{const Ut=dt;Ut.lngLat=k.getLngLat(),N.current.props.onDrag?.(Ut)}),Qe.on("dragend",dt=>{const Ut=dt;Ut.lngLat=k.getLngLat(),N.current.props.onDragEnd?.(Ut)}),Qe},[]);De.useEffect(()=>(k.addTo(y.getMap()),()=>{k.remove()}),[]);const{longitude:R,latitude:h,offset:V,style:H,draggable:$=!1,popup:K=null,rotation:be=0,rotationAlignment:Ce="auto",pitchAlignment:Ee="auto"}=c;De.useEffect(()=>{Fh(k.getElement(),H)},[H]),De.useImperativeHandle(f,()=>k,[]);const ye=N.current.props;(k.getLngLat().lng!==R||k.getLngLat().lat!==h)&&k.setLngLat([R,h]),V&&!uC(k.getOffset(),V)&&k.setOffset(V),k.isDraggable()!==$&&k.setDraggable($),k.getRotation()!==be&&k.setRotation(be),k.getRotationAlignment()!==Ce&&k.setRotationAlignment(Ce),k.getPitchAlignment()!==Ee&&k.setPitchAlignment(Ee),k.getPopup()!==K&&k.setPopup(K);const he=Yv(ye.className,c.className);if(he)for(const ke of he)k.toggleClassName(ke);return N.current.props=c,Wv.createPortal(c.children,k.getElement())}));De.memo(De.forwardRef((c,f)=>{const{map:y,mapLib:C}=De.useContext(g0),N=De.useMemo(()=>document.createElement("div"),[]),k=De.useRef({props:c}),R=De.useMemo(()=>{const h={...c},V=new C.Popup(h);return V.setLngLat([c.longitude,c.latitude]),V.once("open",H=>{k.current.props.onOpen?.(H)}),V},[]);if(De.useEffect(()=>{const h=V=>{k.current.props.onClose?.(V)};return R.on("close",h),R.setDOMContent(N).addTo(y.getMap()),()=>{R.off("close",h),R.isOpen()&&R.remove()}},[]),De.useEffect(()=>{Fh(R.getElement(),c.style)},[c.style]),De.useImperativeHandle(f,()=>R,[]),R.isOpen()){const h=k.current.props;(R.getLngLat().lng!==c.longitude||R.getLngLat().lat!==c.latitude)&&R.setLngLat([c.longitude,c.latitude]),c.offset&&!Cl(h.offset,c.offset)&&R.setOffset(c.offset),(h.anchor!==c.anchor||h.maxWidth!==c.maxWidth)&&(R.options.anchor=c.anchor,R.setMaxWidth(c.maxWidth));const V=Yv(h.className,c.className);if(V)for(const H of V)R.toggleClassName(H);k.current.props=c}return Wv.createPortal(c.children,N)}));function Jf(c,f,y,C){const N=De.useContext(g0),k=De.useMemo(()=>c(N),[]);return De.useEffect(()=>{const R=f,h=null,V=typeof f=="function"?f:null,{map:H}=N;return H.hasControl(k)||(H.addControl(k,R?.position),h&&h(N)),()=>{V&&V(N),H.hasControl(k)&&H.removeControl(k)}},[]),k}function wC(c){const f=Jf(({mapLib:y})=>new y.AttributionControl(c),{position:c.position});return De.useEffect(()=>{Fh(f._container,c.style)},[c.style]),null}De.memo(wC);function EC(c){const f=Jf(({mapLib:y})=>new y.FullscreenControl({container:c.containerId&&document.getElementById(c.containerId)}),{position:c.position});return De.useEffect(()=>{Fh(f._controlContainer,c.style)},[c.style]),null}De.memo(EC);function SC(c,f){const y=De.useRef({props:c}),C=Jf(({mapLib:N})=>{const k=new N.GeolocateControl(c),R=k._setupUI;return k._setupUI=()=>{k._container.hasChildNodes()||R()},k.on("geolocate",h=>{y.current.props.onGeolocate?.(h)}),k.on("error",h=>{y.current.props.onError?.(h)}),k.on("outofmaxbounds",h=>{y.current.props.onOutOfMaxBounds?.(h)}),k.on("trackuserlocationstart",h=>{y.current.props.onTrackUserLocationStart?.(h)}),k.on("trackuserlocationend",h=>{y.current.props.onTrackUserLocationEnd?.(h)}),k},{position:c.position});return y.current.props=c,De.useImperativeHandle(f,()=>C,[]),De.useEffect(()=>{Fh(C._container,c.style)},[c.style]),null}De.memo(De.forwardRef(SC));function TC(c){const f=Jf(({mapLib:y})=>new y.NavigationControl(c),{position:c.position});return De.useEffect(()=>{Fh(f._container,c.style)},[c.style]),null}De.memo(TC);function AC(c){const f=Jf(({mapLib:k})=>new k.ScaleControl(c),{position:c.position}),y=De.useRef(c),C=y.current;y.current=c;const{style:N}=c;return c.maxWidth!==void 0&&c.maxWidth!==C.maxWidth&&(f.options.maxWidth=c.maxWidth),c.unit!==void 0&&c.unit!==C.unit&&f.setUnit(c.unit),De.useEffect(()=>{Fh(f._container,N)},[N]),null}De.memo(AC);function CC(c){const f=Jf(({mapLib:y})=>new y.TerrainControl(c),{position:c.position});return De.useEffect(()=>{Fh(f._container,c.style)},[c.style]),null}De.memo(CC);function IC(c){const f=Jf(({mapLib:y})=>new y.LogoControl(c),{position:c.position});return De.useEffect(()=>{Fh(f._container,c.style)},[c.style]),null}De.memo(IC);function Kg(c,f){if(!c)throw new Error(f)}let MC=0;function RC(c,f,y){if(c.style&&c.style._loaded){const C={...y};return delete C.id,delete C.children,c.addSource(f,C),c.getSource(f)}return null}function DC(c,f,y){Kg(f.id===y.id,"source id changed"),Kg(f.type===y.type,"source type changed");let C="",N=0;for(const R in f)R!=="children"&&R!=="id"&&!Cl(y[R],f[R])&&(C=R,N++);if(!N)return;const k=f.type;if(k==="geojson")c.setData(f.data);else if(k==="image")c.updateImage({url:f.url,coordinates:f.coordinates});else switch(C){case"coordinates":c.setCoordinates?.(f.coordinates);break;case"url":c.setUrl?.(f.url);break;case"tiles":c.setTiles?.(f.tiles);break;default:console.warn(`Unable to update <Source> prop: ${C}`)}}function b_(c){const f=De.useContext(g0).map.getMap(),y=De.useRef(c),[,C]=De.useState(0),N=De.useMemo(()=>c.id||`jsx-source-${MC++}`,[]);De.useEffect(()=>{if(f){const R=()=>setTimeout(()=>C(h=>h+1),0);return f.on("styledata",R),R(),()=>{if(f.off("styledata",R),f.style&&f.style._loaded&&f.getSource(N)){const h=f.getStyle()?.layers;if(h)for(const V of h)V.source===N&&f.removeLayer(V.id);f.removeSource(N)}}}},[f]);let k=f&&f.style&&f.getSource(N);return k?DC(k,c,y.current):k=RC(f,N,c),y.current=c,k&&De.Children.map(c.children,R=>R&&De.cloneElement(R,{source:N}))||null}function NC(c,f,y,C){if(Kg(y.id===C.id,"layer id changed"),Kg(y.type===C.type,"layer type changed"),y.type==="custom"||C.type==="custom")return;const{layout:N={},paint:k={},filter:R,minzoom:h,maxzoom:V,beforeId:H}=y;if(H!==C.beforeId&&c.moveLayer(f,H),N!==C.layout){const $=C.layout||{};for(const K in N)Cl(N[K],$[K])||c.setLayoutProperty(f,K,N[K]);for(const K in $)N.hasOwnProperty(K)||c.setLayoutProperty(f,K,void 0)}if(k!==C.paint){const $=C.paint||{};for(const K in k)Cl(k[K],$[K])||c.setPaintProperty(f,K,k[K]);for(const K in $)k.hasOwnProperty(K)||c.setPaintProperty(f,K,void 0)}Cl(R,C.filter)||c.setFilter(f,R),(h!==C.minzoom||V!==C.maxzoom)&&c.setLayerZoomRange(f,h,V)}function kC(c,f,y){if(c.style&&c.style._loaded&&(!("source"in y)||c.getSource(y.source))){const C={...y,id:f};delete C.beforeId,c.addLayer(C,y.beforeId)}}let PC=0;function v_(c){const f=De.useContext(g0).map.getMap(),y=De.useRef(c),[,C]=De.useState(0),N=De.useMemo(()=>c.id||`jsx-layer-${PC++}`,[]);if(De.useEffect(()=>{if(f){const R=()=>C(h=>h+1);return f.on("styledata",R),R(),()=>{f.off("styledata",R),f.style&&f.style._loaded&&f.getLayer(N)&&f.removeLayer(N)}}},[f]),f&&f.style&&f.getLayer(N))try{NC(f,N,c,y.current)}catch(R){console.warn(R)}else kC(f,N,c);return y.current=c,null}var Ug={exports:{}};var OC=Ug.exports,w_;function zC(){return w_||(w_=1,(function(c,f){(function(y,C){c.exports=C()})(OC,(function(){var y={},C={};function N(R,h,V){if(C[R]=V,R==="index"){var H="var sharedModule = {}; ("+C.shared+")(sharedModule); ("+C.worker+")(sharedModule);",$={};return C.shared($),C.index(y,$),typeof window<"u"&&y.setWorkerUrl(window.URL.createObjectURL(new Blob([H],{type:"text/javascript"}))),y}}N("shared",["exports"],(function(R){function h(i,e,n,l){return new(n||(n=Promise))((function(p,_){function b(B){try{D(l.next(B))}catch(G){_(G)}}function A(B){try{D(l.throw(B))}catch(G){_(G)}}function D(B){var G;B.done?p(B.value):(G=B.value,G instanceof n?G:new n((function(X){X(G)}))).then(b,A)}D((l=l.apply(i,e||[])).next())}))}function V(i,e){this.x=i,this.y=e}function H(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var $,K;typeof SuppressedError=="function"&&SuppressedError,V.prototype={clone(){return new V(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(i,e){const n=Math.cos(i),l=Math.sin(i),p=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:V},V.convert=function(i){if(i instanceof V)return i;if(Array.isArray(i))return new V(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new V(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var be=(function(){if(K)return $;function i(e,n,l,p){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=p}return K=1,$=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,p=0;p<8;p++){var _=this.sampleCurveX(l)-e;if(Math.abs(_)<n)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=_/b}var A=0,D=1;for(l=e,p=0;p<20&&(_=this.sampleCurveX(l),!(Math.abs(_-e)<n));p++)e>_?A=l:D=l,l=.5*(D-A)+A;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},$})(),Ce=H(be);let Ee,ye;function he(){return Ee==null&&(Ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ee}function ke(){if(ye==null&&(ye=!1,he())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const p=4*l;e.fillStyle=`rgb(${p},${p+1},${p+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&n[l]!==l){ye=!0;break}}}return ye||!1}var nt=1e-6,Qe=typeof Float32Array<"u"?Float32Array:Array;function dt(){var i=new Qe(9);return Qe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ut(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function wt(){var i=new Qe(3);return Qe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function tt(i){var e=i[0],n=i[1],l=i[2];return Math.sqrt(e*e+n*n+l*l)}function Je(i,e,n){var l=new Qe(3);return l[0]=i,l[1]=e,l[2]=n,l}function He(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function pt(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function Pe(i,e,n){var l=e[0],p=e[1],_=e[2],b=n[0],A=n[1],D=n[2];return i[0]=p*D-_*A,i[1]=_*b-l*D,i[2]=l*A-p*b,i}var ot,gt=tt;function Rt(i,e,n){var l=e[0],p=e[1],_=e[2],b=e[3];return i[0]=n[0]*l+n[4]*p+n[8]*_+n[12]*b,i[1]=n[1]*l+n[5]*p+n[9]*_+n[13]*b,i[2]=n[2]*l+n[6]*p+n[10]*_+n[14]*b,i[3]=n[3]*l+n[7]*p+n[11]*_+n[15]*b,i}function Ie(){var i=new Qe(4);return Qe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Se(i,e,n,l){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",_=Math.PI/360;e*=_,l*=_,n*=_;var b=Math.sin(e),A=Math.cos(e),D=Math.sin(n),B=Math.cos(n),G=Math.sin(l),X=Math.cos(l);switch(p){case"xyz":i[0]=b*B*X+A*D*G,i[1]=A*D*X-b*B*G,i[2]=A*B*G+b*D*X,i[3]=A*B*X-b*D*G;break;case"xzy":i[0]=b*B*X-A*D*G,i[1]=A*D*X-b*B*G,i[2]=A*B*G+b*D*X,i[3]=A*B*X+b*D*G;break;case"yxz":i[0]=b*B*X+A*D*G,i[1]=A*D*X-b*B*G,i[2]=A*B*G-b*D*X,i[3]=A*B*X+b*D*G;break;case"yzx":i[0]=b*B*X+A*D*G,i[1]=A*D*X+b*B*G,i[2]=A*B*G-b*D*X,i[3]=A*B*X-b*D*G;break;case"zxy":i[0]=b*B*X-A*D*G,i[1]=A*D*X+b*B*G,i[2]=A*B*G+b*D*X,i[3]=A*B*X-b*D*G;break;case"zyx":i[0]=b*B*X-A*D*G,i[1]=A*D*X+b*B*G,i[2]=A*B*G-b*D*X,i[3]=A*B*X+b*D*G;break;default:throw new Error("Unknown angle order "+p)}return i}function je(){var i=new Qe(2);return Qe!=Float32Array&&(i[0]=0,i[1]=0),i}function st(i,e){var n=new Qe(2);return n[0]=i,n[1]=e,n}wt(),ot=new Qe(4),Qe!=Float32Array&&(ot[0]=0,ot[1]=0,ot[2]=0,ot[3]=0),wt(),Je(1,0,0),Je(0,1,0),Ie(),Ie(),dt(),je();const mt=8192;function Xt(i,e,n){return e*(mt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function Oe(i,e){return(i%e+e)%e}function Xe(i,e,n){return i*(1-n)+e*n}function It(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Nt(i,e,n,l){const p=new Ce(i,e,n,l);return _=>p.solve(_)}const $t=Nt(.25,.1,.25,1);function Bt(i,e,n){return Math.min(n,Math.max(e,i))}function Mn(i,e,n){const l=n-e,p=((i-e)%l+l)%l+e;return p===e?n:p}function Tn(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}let Rn=1;function ri(i,e,n){const l={};for(const p in i)l[p]=e.call(this,i[p],p,i);return l}function _i(i,e,n){const l={};for(const p in i)e.call(this,i[p],p,i)&&(l[p]=i[p]);return l}function $n(i){return Array.isArray(i)?i.map($n):typeof i=="object"&&i?ri(i,$n):i}const Kn={};function Qn(i){Kn[i]||(typeof console<"u"&&console.warn(i),Kn[i]=!0)}function ti(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Bi(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let si=null;function Yt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const fn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function di(i,e,n,l,p){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const b=_?.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const A=b.startsWith("BGR"),D=new Uint8ClampedArray(l*p*4);if(yield _.copyTo(D,(function(B,G,X,Y,Q){const ie=4*Math.max(-G,0),re=(Math.max(0,X)-X)*Y*4+ie,ae=4*Y,me=Math.max(0,G),Fe=Math.max(0,X);return{rect:{x:me,y:Fe,width:Math.min(B.width,G+Y)-me,height:Math.min(B.height,X+Q)-Fe},layout:[{offset:re,stride:ae}]}})(i,e,n,l,p)),A)for(let B=0;B<D.length;B+=4){const G=D[B];D[B]=D[B+2],D[B+2]=G}return D}finally{_.close()}}))}let gn,Zn;function Yi(i,e,n,l){return i.addEventListener(e,n,l),{unsubscribe:()=>{i.removeEventListener(e,n,l)}}}function fi(i){return i*Math.PI/180}function ci(i){return i/Math.PI*180}const ct={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},oe={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ue="AbortError";class ge extends Error{constructor(e=ue){super(e instanceof Error?e.message:e),this.name=ue,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function qe(i){return i.name===ue}const $e={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function bt(i){return $e.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const at="global-dispatcher";class fe extends Error{constructor(e,n,l,p){super(`AJAXError: ${n} (${e}): ${l}`),this.status=e,this.statusText=n,this.url=l,this.body=p}}const de=()=>Bi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Me=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=bt(i.url);if(l)return l(i,e);if(Bi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:at},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(de())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,p){return h(this,void 0,void 0,(function*(){const _=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:de(),signal:p.signal});let b,A;l.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{b=yield fetch(_)}catch(B){throw qe(B)?B:new fe(0,B.message,l.url,new Blob)}if(!b.ok){const B=yield b.blob();throw new fe(b.status,b.statusText,l.url,B)}A=l.type==="arrayBuffer"||l.type==="image"?b.arrayBuffer():l.type==="json"?b.json():b.text();const D=yield A;return p.signal.throwIfAborted(),{data:D,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}}))})(i,e);if(Bi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:at},e)}var n;return(function(l,p){return new Promise(((_,b)=>{var A;const D=new XMLHttpRequest;D.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(D.responseType="arraybuffer");for(const B in l.headers)D.setRequestHeader(B,l.headers[B]);l.type==="json"&&(D.responseType="text",!((A=l.headers)===null||A===void 0)&&A.Accept||D.setRequestHeader("Accept","application/json")),D.withCredentials=l.credentials==="include",D.onerror=()=>{b(new Error(D.statusText))},D.onload=()=>{if(!p.signal.aborted)if((D.status>=200&&D.status<300||D.status===0)&&D.response!==null){let B=D.response;if(l.type==="json")try{B=JSON.parse(D.response)}catch(G){return void b(G)}_({data:B,cacheControl:D.getResponseHeader("Cache-Control"),expires:D.getResponseHeader("Expires")})}else{const B=new Blob([D.response],{type:D.getResponseHeader("Content-Type")});b(new fe(D.status,D.statusText,l.url,B))}},p.signal.addEventListener("abort",(()=>{D.abort(),b(new ge(p.signal.reason))})),D.send(l.body)}))})(i,e)};function Ue(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function xt(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function yt(i,e,n){if(n&&n[i]){const l=n[i].indexOf(e);l!==-1&&n[i].splice(l,1)}}class qt{constructor(e,n={}){Tn(this,n),this.type=e}}class Ot extends qt{constructor(e,n={}){super("error",Tn({error:e},n))}}class cn{on(e,n){return this._listeners=this._listeners||{},xt(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return yt(e,n,this._listeners),yt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},xt(e,n,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,n){typeof e=="string"&&(e=new qt(e,n||{}));const l=e.type;if(this.listens(l)){e.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const A of p)A.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const A of _)yt(l,A,this._oneTimeListeners),A.call(this,e);const b=this._eventedParent;b&&(Tn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(e))}else e instanceof Ot&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const kn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Fn(i,e){const n={};for(const l in i)l!=="ref"&&(n[l]=i[l]);return kn.forEach((l=>{l in e&&(n[l]=e[l])})),n}function wn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!wn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!wn(i[n],e[n]))return!1;return!0}return i===e}function _n(i,e){i.push(e)}function gi(i,e,n){_n(n,{command:"addSource",args:[i,e[i]]})}function Yn(i,e,n){_n(e,{command:"removeSource",args:[i]}),n[i]=!0}function nn(i,e,n,l){Yn(i,n,l),gi(i,e,n)}function Jt(i,e,n){let l;for(l in i[n])if(Object.prototype.hasOwnProperty.call(i[n],l)&&l!=="data"&&!wn(i[n][l],e[n][l]))return!1;for(l in e[n])if(Object.prototype.hasOwnProperty.call(e[n],l)&&l!=="data"&&!wn(i[n][l],e[n][l]))return!1;return!0}function Bn(i,e,n,l,p,_){i=i||{},e=e||{};for(const b in i)Object.prototype.hasOwnProperty.call(i,b)&&(wn(i[b],e[b])||n.push({command:_,args:[l,b,e[b],p]}));for(const b in e)Object.prototype.hasOwnProperty.call(e,b)&&!Object.prototype.hasOwnProperty.call(i,b)&&(wn(i[b],e[b])||n.push({command:_,args:[l,b,e[b],p]}))}function Di(i){return i.id}function Fi(i,e){return i[e.id]=e,i}class Zt{constructor(e,n,l,p){this.message=(e?`${e}: `:"")+l,p&&(this.identifier=p),n!=null&&n.__line__&&(this.line=n.__line__)}}function xi(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}class bn extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Rr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,p]of n)this.bindings[l]=p}concat(e){return new Rr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const vi={kind:"null"},jt={kind:"number"},Gn={kind:"string"},ni={kind:"boolean"},vs={kind:"color"},ws={kind:"projectionDefinition"},ia={kind:"object"},ai={kind:"value"},Rs={kind:"collator"},Sr={kind:"formatted"},ji={kind:"padding"},da={kind:"colorArray"},us={kind:"numberArray"},dr={kind:"resolvedImage"},an={kind:"variableAnchorOffsetCollection"};function Es(i,e){return{kind:"array",itemType:i,N:e}}function Hn(i){if(i.kind==="array"){const e=Hn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const hs=[vi,jt,Gn,ni,vs,ws,Sr,ia,Es(ai),ji,us,da,dr,an];function Yo(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Yo(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of hs)if(!Yo(n,e))return null}}return`Expected ${Hn(i)} but found ${Hn(e)} instead.`}function Pi(i,e){return e.some((n=>n.kind===i.kind))}function Ai(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function yi(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const fo=.96422,fa=.82521,Ds=4/29,Jn=6/29,Ra=3*Jn*Jn,uu=Jn*Jn*Jn,or=Math.PI/180,vt=180/Math.PI;function tn(i){return(i%=360)<0&&(i+=360),i}function xn([i,e,n,l]){let p,_;const b=pn((.2225045*(i=on(i))+.7168786*(e=on(e))+.0606169*(n=on(n)))/1);i===e&&e===n?p=_=b:(p=pn((.4360747*i+.3850649*e+.1430804*n)/fo),_=pn((.0139322*i+.0971045*e+.7141733*n)/fa));const A=116*b-16;return[A<0?0:A,500*(p-b),200*(b-_),l]}function on(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function pn(i){return i>uu?Math.pow(i,1/3):i/Ra+Ds}function ft([i,e,n,l]){let p=(i+16)/116,_=isNaN(e)?p:p+e/500,b=isNaN(n)?p:p-n/200;return p=1*zn(p),_=fo*zn(_),b=fa*zn(b),[Te(3.1338561*_-1.6168667*p-.4906146*b),Te(-.9787684*_+1.9161415*p+.033454*b),Te(.0719453*_-.2289914*p+1.4052427*b),l]}function Te(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function zn(i){return i>Jn?i*i*i:Ra*(i-Ds)}const $i=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Dr(i,e){return $i(i,e)?i[e]:void 0}function Da(i){return parseInt(i.padEnd(2,i),16)/255}function pa(i,e){return Tr(e?i/100:i,0,1)}function Tr(i,e,n){return Math.min(Math.max(e,i),n)}function Xn(i){return!i.some(Number.isNaN)}const Ui={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Bs(i,e,n){return i+n*(e-i)}function ko(i,e,n){return i.map(((l,p)=>Bs(l,e[p],n)))}class ui{constructor(e,n,l,p=1,_=!0){this.r=e,this.g=n,this.b=l,this.a=p,_||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[e,n,l,p]))}static parse(e){if(e instanceof ui)return e;if(typeof e!="string")return;const n=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Dr(Ui,l);if(p){const[b,A,D]=p;return[b/255,A/255,D/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const b=l.length<6?1:2;let A=1;return[Da(l.slice(A,A+=b)),Da(l.slice(A,A+=b)),Da(l.slice(A,A+=b)),Da(l.slice(A,A+b)||"ff")]}if(l.startsWith("rgb")){const b=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[A,D,B,G,X,Y,Q,ie,re,ae,me,Fe]=b,_e=[G||" ",Q||" ",ae].join("");if(_e==="  "||_e==="  /"||_e===",,"||_e===",,,"){const we=[B,Y,re].join(""),Ge=we==="%%%"?100:we===""?255:0;if(Ge){const Ye=[Tr(+D/Ge,0,1),Tr(+X/Ge,0,1),Tr(+ie/Ge,0,1),me?pa(+me,Fe):1];if(Xn(Ye))return Ye}}return}}const _=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[b,A,D,B,G,X,Y,Q,ie]=_,re=[D||" ",G||" ",Y].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ae=[+A,Tr(+B,0,100),Tr(+X,0,100),Q?pa(+Q,ie):1];if(Xn(ae))return(function([me,Fe,_e,we]){function Ge(Ye){const St=(Ye+me/30)%12,Wt=Fe*Math.min(_e,1-_e);return _e-Wt*Math.max(-1,Math.min(St-3,9-St,1))}return me=tn(me),Fe/=100,_e/=100,[Ge(0),Ge(8),Ge(4),we]})(ae)}}})(e);return n?new ui(...n,!1):void 0}get rgb(){const{r:e,g:n,b:l,a:p}=this,_=p||1/0;return this.overwriteGetter("rgb",[e/_,n/_,l/_,p])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,l,p,_]=xn(e),b=Math.sqrt(l*l+p*p);return[Math.round(1e4*b)?tn(Math.atan2(p,l)*vt):NaN,b,n,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",xn(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,l,p]=this.rgb;return`rgba(${[e,n,l].map((_=>Math.round(255*_))).join(",")},${p})`}static interpolate(e,n,l,p="rgb"){switch(p){case"rgb":{const[_,b,A,D]=ko(e.rgb,n.rgb,l);return new ui(_,b,A,D,!1)}case"hcl":{const[_,b,A,D]=e.hcl,[B,G,X,Y]=n.hcl;let Q,ie;if(isNaN(_)||isNaN(B))isNaN(_)?isNaN(B)?Q=NaN:(Q=B,A!==1&&A!==0||(ie=G)):(Q=_,X!==1&&X!==0||(ie=b));else{let _e=B-_;B>_&&_e>180?_e-=360:B<_&&_-B>180&&(_e+=360),Q=_+l*_e}const[re,ae,me,Fe]=(function([_e,we,Ge,Ye]){return _e=isNaN(_e)?0:_e*or,ft([Ge,Math.cos(_e)*we,Math.sin(_e)*we,Ye])})([Q,ie??Bs(b,G,l),Bs(A,X,l),Bs(D,Y,l)]);return new ui(re,ae,me,Fe,!1)}case"lab":{const[_,b,A,D]=ft(ko(e.lab,n.lab,l));return new ui(_,b,A,D,!1)}}}}ui.black=new ui(0,0,0,1),ui.white=new ui(1,1,1,1),ui.transparent=new ui(0,0,0,0),ui.red=new ui(1,0,0,1);class Fs{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const $o=["bottom","center","top"];class Ko{constructor(e,n,l,p,_,b){this.text=e,this.image=n,this.scale=l,this.fontStack=p,this.textColor=_,this.verticalAlign=b}}class wi{constructor(e){this.sections=e}static fromString(e){return new wi([new Ko(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof wi?e:wi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class yr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof yr)return e;if(typeof e=="number")return new yr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new yr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new yr(ko(e.values,n.values,l))}}class Gi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Gi)return e;if(typeof e=="number")return new Gi([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new Gi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new Gi(ko(e.values,n.values,l))}}class hn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof hn)return e;if(typeof e=="string"){const l=ui.parse(e);return l?new hn([l]):void 0}if(!Array.isArray(e))return;const n=[];for(const l of e){if(typeof l!="string")return;const p=ui.parse(l);if(!p)return;n.push(p)}return new hn(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l,p="rgb"){const _=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let b=0;b<e.values.length;b++)_.push(ui.interpolate(e.values[b],n.values[b],l,p));return new hn(_)}}class lr extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const oi=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Mi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Mi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const l=e[n],p=e[n+1];if(typeof l!="string"||!oi.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new Mi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){const p=e.values,_=n.values;if(p.length!==_.length)throw new lr(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const b=[];for(let A=0;A<p.length;A+=2){if(p[A]!==_[A])throw new lr(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${p[A]}, to[${A}]: ${_[A]}`);b.push(p[A]);const[D,B]=p[A+1],[G,X]=_[A+1];b.push([Bs(D,G,l),Bs(B,X,l)])}return new Mi(b)}}class ra{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ra({name:e,available:!1}):null}}class Kr{constructor(e,n,l){this.from=e,this.to=n,this.transition=l}static interpolate(e,n,l){return new Kr(e,n,l)}static parse(e){return e instanceof Kr?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Kr(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Kr(e.from,e.to,e.transition):typeof e=="string"?new Kr(e,e,1):void 0}}function ma(i,e,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,n,l]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function js(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Kr||i instanceof ui||i instanceof Fs||i instanceof wi||i instanceof yr||i instanceof Gi||i instanceof hn||i instanceof Mi||i instanceof ra)return!0;if(Array.isArray(i)){for(const e of i)if(!js(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!js(i[e]))return!1;return!0}return!1}function Nr(i){if(i===null)return vi;if(typeof i=="string")return Gn;if(typeof i=="boolean")return ni;if(typeof i=="number")return jt;if(i instanceof ui)return vs;if(i instanceof Kr)return ws;if(i instanceof Fs)return Rs;if(i instanceof wi)return Sr;if(i instanceof yr)return ji;if(i instanceof Gi)return us;if(i instanceof hn)return da;if(i instanceof Mi)return an;if(i instanceof ra)return dr;if(Array.isArray(i)){const e=i.length;let n;for(const l of i){const p=Nr(l);if(n){if(n===p)continue;n=ai;break}n=p}return Es(n||ai,e)}return ia}function Na(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ui||i instanceof Kr||i instanceof wi||i instanceof yr||i instanceof Gi||i instanceof hn||i instanceof Mi||i instanceof ra?i.toString():JSON.stringify(i)}class Ns{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!js(e[1]))return n.error("invalid value");const l=e[1];let p=Nr(l);const _=n.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new Ns(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Xa={string:Gn,number:jt,boolean:ni,object:ia};class Us{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,p=1;const _=e[0];if(_==="array"){let A,D;if(e.length>2){const B=e[1];if(typeof B!="string"||!(B in Xa)||B==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);A=Xa[B],p++}else A=ai;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);D=e[2],p++}l=Es(A,D)}else{if(!Xa[_])throw new Error(`Types doesn't contain name = ${_}`);l=Xa[_]}const b=[];for(;p<e.length;p++){const A=n.parse(e[p],p,ai);if(!A)return null;b.push(A)}return new Us(l,b)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!Yo(this.type,Nr(l)))return l;if(n===this.args.length-1)throw new lr(`Expected value to be of type ${Hn(this.type)}, but found ${Hn(Nr(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const zr={"to-boolean":ni,"to-color":vs,"to-number":jt,"to-string":Gn};class ds{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0];if(!zr[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");const p=zr[l],_=[];for(let b=1;b<e.length;b++){const A=n.parse(e[b],b,ai);if(!A)return null;_.push(A)}return new ds(p,_)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,l;for(const p of this.args){if(n=p.evaluate(e),l=null,n instanceof ui)return n;if(typeof n=="string"){const _=e.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ma(n[0],n[1],n[2],n[3]),!l))return new ui(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new lr(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(e);const p=yr.parse(n);if(p)return p}throw new lr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(e);const p=Gi.parse(n);if(p)return p}throw new lr(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(e);const p=hn.parse(n);if(p)return p}throw new lr(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(e);const p=Mi.parse(n);if(p)return p}throw new lr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const p=Number(n);if(!isNaN(p))return p}throw new lr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return wi.fromString(Na(this.args[0].evaluate(e)));case"resolvedImage":return ra.fromString(Na(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Na(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Ss=["Unknown","Point","LineString","Polygon"];class Qo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ss[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=ui.parse(e),this._parseColorCache.set(e,n)),n}}class Jo{constructor(e,n,l=[],p,_=new Rr,b=[]){this.registry=e,this.path=l,this.key=l.map((A=>`[${A}]`)).join(""),this.scope=_,this.errors=b,this.expectedType=p,this._isConstant=n}parse(e,n,l,p,_={}){return n?this.concat(n,l,p)._parse(e,_):this._parse(e,_)}_parse(e,n){function l(p,_,b){return b==="assert"?new Us(_,[p]):b==="coerce"?new ds(_,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let b=_.parse(e,this);if(!b)return null;if(this.expectedType){const A=this.expectedType,D=b.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||D.kind!=="value"){if(A.kind==="projectionDefinition"&&["string","array"].includes(D.kind)||["color","formatted","resolvedImage"].includes(A.kind)&&["value","string"].includes(D.kind)||["padding","numberArray"].includes(A.kind)&&["value","number","array"].includes(D.kind)||A.kind==="colorArray"&&["value","string","array"].includes(D.kind)||A.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(D.kind))b=l(b,A,n.typeAnnotation||"coerce");else if(this.checkSubtype(A,D))return null}else b=l(b,A,n.typeAnnotation||"assert")}if(!(b instanceof Ns)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const A=new Qo;try{b=new Ns(b.type,b.evaluate(A))}catch(D){return this.error(D.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){const p=typeof e=="number"?this.path.concat(e):this.path,_=l?this.scope.concat(l):this.scope;return new Jo(this.registry,this._isConstant,p,n||null,_,this.errors)}error(e,...n){const l=`${this.key}${n.map((p=>`[${p}]`)).join("")}`;this.errors.push(new bn(l,e))}checkSubtype(e,n){const l=Yo(e,n);return l&&this.error(l),l}}class er{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let _=1;_<e.length-1;_+=2){const b=e[_];if(typeof b!="string")return n.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const A=n.parse(e[_+1],_+1);if(!A)return null;l.push([b,A])}const p=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return p?new er(l,p):null}outputDefined(){return this.result.outputDefined()}}class el{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new el(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Si{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,jt),p=n.parse(e[2],2,Es(n.expectedType||ai));return l&&p?new Si(p.type.itemType,l,p):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new lr(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new lr(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new lr(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class pi{constructor(e,n){this.type=ni,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,ai),p=n.parse(e[2],2,ai);return l&&p?Pi(l.type,[ni,Gn,jt,vi,ai])?new pi(l,p):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!Ai(n,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(Nr(n))} instead.`);if(!Ai(l,["string","array"]))throw new lr(`Expected second argument to be of type array or string, but found ${Hn(Nr(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Hi{constructor(e,n,l){this.type=jt,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,ai),p=n.parse(e[2],2,ai);if(!l||!p)return null;if(!Pi(l.type,[ni,Gn,jt,vi,ai]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(l.type)} instead`);if(e.length===4){const _=n.parse(e[3],3,jt);return _?new Hi(l,p,_):null}return new Hi(l,p)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Ai(n,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(Nr(n))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(e)),Ai(l,["string"])){const _=l.indexOf(n,p);return _===-1?-1:[...l.slice(0,_)].length}if(Ai(l,["array"]))return l.indexOf(n,p);throw new lr(`Expected second argument to be of type array or string, but found ${Hn(Nr(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Oi{constructor(e,n,l,p,_,b){this.inputType=e,this.type=n,this.input=l,this.cases=p,this.outputs=_,this.otherwise=b}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,p;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);const _={},b=[];for(let B=2;B<e.length-1;B+=2){let G=e[B];const X=e[B+1];Array.isArray(G)||(G=[G]);const Y=n.concat(B);if(G.length===0)return Y.error("Expected at least one branch label.");for(const ie of G){if(typeof ie!="number"&&typeof ie!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return Y.error("Numeric branch labels must be integer values.");if(l){if(Y.checkSubtype(l,Nr(ie)))return null}else l=Nr(ie);if(_[String(ie)]!==void 0)return Y.error("Branch labels must be unique.");_[String(ie)]=b.length}const Q=n.parse(X,B,p);if(!Q)return null;p=p||Q.type,b.push(Q)}const A=n.parse(e[1],1,ai);if(!A)return null;const D=n.parse(e[e.length-1],e.length-1,p);return D?A.type.kind!=="value"&&n.concat(1).checkSubtype(l,A.type)?null:new Oi(l,p,A,_,b,D):null}evaluate(e){const n=this.input.evaluate(e);return(Nr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class tl{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const p=[];for(let b=1;b<e.length-1;b+=2){const A=n.parse(e[b],b,ni);if(!A)return null;const D=n.parse(e[b+1],b+1,l);if(!D)return null;p.push([A,D]),l=l||D.type}const _=n.parse(e[e.length-1],e.length-1,l);if(!_)return null;if(!l)throw new Error("Can't infer output type");return new tl(l,p,_)}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class fs{constructor(e,n,l,p){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=p}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,ai),p=n.parse(e[2],2,jt);if(!l||!p)return null;if(!Pi(l.type,[Es(ai),Gn,ai]))return n.error(`Expected first argument to be of type array or string, but found ${Hn(l.type)} instead`);if(e.length===4){const _=n.parse(e[3],3,jt);return _?new fs(l.type,l,p,_):null}return new fs(l.type,l,p)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let p;if(this.endIndex&&(p=this.endIndex.evaluate(e)),Ai(n,["string"]))return[...n].slice(l,p).join("");if(Ai(n,["array"]))return n.slice(l,p);throw new lr(`Expected first argument to be of type array or string, but found ${Hn(Nr(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function nl(i,e){const n=i.length-1;let l,p,_=0,b=n,A=0;for(;_<=b;)if(A=Math.floor((_+b)/2),l=i[A],p=i[A+1],l<=e){if(A===n||e<p)return A;_=A+1}else{if(!(l>e))throw new lr("Input is not a number.");b=A-1}return 0}class zt{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[p,_]of l)this.labels.push(p),this.outputs.push(_)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,jt);if(!l)return null;const p=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let b=1;b<e.length;b+=2){const A=b===1?-1/0:e[b],D=e[b+1],B=b,G=b+1;if(typeof A!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(p.length&&p[p.length-1][0]>=A)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const X=n.parse(D,G,_);if(!X)return null;_=_||X.type,p.push([A,X])}return new zt(_,l,p)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const _=n.length;return p>=n[_-1]?l[_-1].evaluate(e):l[nl(n,p)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Ci(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Qr,rc,jh=(function(){if(rc)return Qr;function i(e,n,l,p){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=p}return rc=1,Qr=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,p=0;p<8;p++){var _=this.sampleCurveX(l)-e;if(Math.abs(_)<n)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=_/b}var A=0,D=1;for(l=e,p=0;p<20&&(_=this.sampleCurveX(l),!(Math.abs(_-e)<n));p++)e>_?A=l:D=l,l=.5*(D-A)+A;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Qr})(),Yu=Ci(jh);class sa{constructor(e,n,l,p,_){this.type=e,this.operator=n,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[b,A]of _)this.labels.push(b),this.outputs.push(A)}static interpolationFactor(e,n,l,p){let _=0;if(e.name==="exponential")_=po(n,e.base,l,p);else if(e.name==="linear")_=po(n,1,l,p);else if(e.name==="cubic-bezier"){const b=e.controlPoints;_=new Yu(b[0],b[1],b[2],b[3]).solve(po(n,1,l,p))}return _}static parse(e,n){let[l,p,_,...b]=e;if(!Array.isArray(p)||p.length===0)return n.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const B=p[1];if(typeof B!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:B}}else{if(p[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const B=p.slice(1);if(B.length!==4||B.some((G=>typeof G!="number"||G<0||G>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:B}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,jt),!_)return null;const A=[];let D=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==da?n.expectedType&&n.expectedType.kind!=="value"&&(D=n.expectedType):D=vs;for(let B=0;B<b.length;B+=2){const G=b[B],X=b[B+1],Y=B+3,Q=B+4;if(typeof G!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(A.length&&A[A.length-1][0]>=G)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const ie=n.parse(X,Q,D);if(!ie)return null;D=D||ie.type,A.push([G,ie])}return yi(D,jt)||yi(D,ws)||yi(D,vs)||yi(D,ji)||yi(D,us)||yi(D,da)||yi(D,an)||yi(D,Es(jt))?new sa(D,l,p,_,A):n.error(`Type ${Hn(D)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const _=n.length;if(p>=n[_-1])return l[_-1].evaluate(e);const b=nl(n,p),A=sa.interpolationFactor(this.interpolation,p,n[b],n[b+1]),D=l[b].evaluate(e),B=l[b+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Bs(D,B,A);case"color":return ui.interpolate(D,B,A);case"padding":return yr.interpolate(D,B,A);case"colorArray":return hn.interpolate(D,B,A);case"numberArray":return Gi.interpolate(D,B,A);case"variableAnchorOffsetCollection":return Mi.interpolate(D,B,A);case"array":return ko(D,B,A);case"projectionDefinition":return Kr.interpolate(D,B,A)}case"interpolate-hcl":switch(this.type.kind){case"color":return ui.interpolate(D,B,A,"hcl");case"colorArray":return hn.interpolate(D,B,A,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ui.interpolate(D,B,A,"lab");case"colorArray":return hn.interpolate(D,B,A,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function po(i,e,n,l){const p=l-n,_=i-n;return p===0?0:e===1?_/p:(Math.pow(e,_)-1)/(Math.pow(e,p)-1)}const xr={color:ui.interpolate,number:Bs,padding:yr.interpolate,numberArray:Gi.interpolate,colorArray:hn.interpolate,variableAnchorOffsetCollection:Mi.interpolate,array:ko};class kr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=null;const p=n.expectedType;p&&p.kind!=="value"&&(l=p);const _=[];for(const A of e.slice(1)){const D=n.parse(A,1+_.length,l,void 0,{typeAnnotation:"omit"});if(!D)return null;l=l||D.type,_.push(D)}if(!l)throw new Error("No output type");const b=p&&_.some((A=>Yo(p,A.type)));return new kr(b?ai:l,_)}evaluate(e){let n,l=null,p=0;for(const _ of this.args)if(p++,l=_.evaluate(e),l&&l instanceof ra&&!l.available&&(n||(n=l.name),l=null,p===this.args.length&&(l=n)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Rl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ar(i,e,n,l){return l.compare(e,n)===0}function Cr(i,e,n){const l=i!=="=="&&i!=="!=";return class $v{constructor(_,b,A){this.type=ni,this.lhs=_,this.rhs=b,this.collator=A,this.hasUntypedArgument=_.type.kind==="value"||b.type.kind==="value"}static parse(_,b){if(_.length!==3&&_.length!==4)return b.error("Expected two or three arguments.");const A=_[0];let D=b.parse(_[1],1,ai);if(!D)return null;if(!Rl(A,D.type))return b.concat(1).error(`"${A}" comparisons are not supported for type '${Hn(D.type)}'.`);let B=b.parse(_[2],2,ai);if(!B)return null;if(!Rl(A,B.type))return b.concat(2).error(`"${A}" comparisons are not supported for type '${Hn(B.type)}'.`);if(D.type.kind!==B.type.kind&&D.type.kind!=="value"&&B.type.kind!=="value")return b.error(`Cannot compare types '${Hn(D.type)}' and '${Hn(B.type)}'.`);l&&(D.type.kind==="value"&&B.type.kind!=="value"?D=new Us(B.type,[D]):D.type.kind!=="value"&&B.type.kind==="value"&&(B=new Us(D.type,[B])));let G=null;if(_.length===4){if(D.type.kind!=="string"&&B.type.kind!=="string"&&D.type.kind!=="value"&&B.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(G=b.parse(_[3],3,Rs),!G)return null}return new $v(D,B,G)}evaluate(_){const b=this.lhs.evaluate(_),A=this.rhs.evaluate(_);if(l&&this.hasUntypedArgument){const D=Nr(b),B=Nr(A);if(D.kind!==B.kind||D.kind!=="string"&&D.kind!=="number")throw new lr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${D.kind}, ${B.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const D=Nr(b),B=Nr(A);if(D.kind!=="string"||B.kind!=="string")return e(_,b,A)}return this.collator?n(_,b,A,this.collator.evaluate(_)):e(_,b,A)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const il=Cr("==",(function(i,e,n){return e===n}),Ar),nr=Cr("!=",(function(i,e,n){return e!==n}),(function(i,e,n,l){return!Ar(0,e,n,l)})),ii=Cr("<",(function(i,e,n){return e<n}),(function(i,e,n,l){return l.compare(e,n)<0})),Bd=Cr(">",(function(i,e,n){return e>n}),(function(i,e,n,l){return l.compare(e,n)>0})),ir=Cr("<=",(function(i,e,n){return e<=n}),(function(i,e,n,l){return l.compare(e,n)<=0})),mo=Cr(">=",(function(i,e,n){return e>=n}),(function(i,e,n,l){return l.compare(e,n)>=0}));class Wa{constructor(e,n,l){this.type=Rs,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const p=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,ni);if(!p)return null;const _=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,ni);if(!_)return null;let b=null;return l.locale&&(b=n.parse(l.locale,1,Gn),!b)?null:new Wa(p,_,b)}evaluate(e){return new Fs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class $u{constructor(e,n,l,p,_){this.type=Gn,this.number=e,this.locale=n,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,jt);if(!l)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return n.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=n.parse(p.locale,1,Gn),!_))return null;let b=null;if(p.currency&&(b=n.parse(p.currency,1,Gn),!b))return null;let A=null;if(p["min-fraction-digits"]&&(A=n.parse(p["min-fraction-digits"],1,jt),!A))return null;let D=null;return p["max-fraction-digits"]&&(D=n.parse(p["max-fraction-digits"],1,jt),!D)?null:new $u(l,_,b,A,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ga{constructor(e){this.type=Sr,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const p=[];let _=!1;for(let b=1;b<=e.length-1;++b){const A=e[b];if(_&&typeof A=="object"&&!Array.isArray(A)){_=!1;let D=null;if(A["font-scale"]&&(D=n.parse(A["font-scale"],1,jt),!D))return null;let B=null;if(A["text-font"]&&(B=n.parse(A["text-font"],1,Es(Gn)),!B))return null;let G=null;if(A["text-color"]&&(G=n.parse(A["text-color"],1,vs),!G))return null;let X=null;if(A["vertical-align"]){if(typeof A["vertical-align"]=="string"&&!$o.includes(A["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${A["vertical-align"]}' instead.`);if(X=n.parse(A["vertical-align"],1,Gn),!X)return null}const Y=p[p.length-1];Y.scale=D,Y.font=B,Y.textColor=G,Y.verticalAlign=X}else{const D=n.parse(e[b],1,ai);if(!D)return null;const B=D.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:D,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ga(p)}evaluate(e){return new wi(this.sections.map((n=>{const l=n.content.evaluate(e);return Nr(l)===dr?new Ko("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Ko(Na(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class rl{constructor(e){this.type=dr,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Gn);return l?new rl(l):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),l=ra.fromString(n);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(n)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class Dl{constructor(e){this.type=jt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Hn(l.type)} instead.`):new Dl(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new lr(`Expected value to be of type string or array, but found ${Hn(Nr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Lr=8192;function Nl(i,e){const n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(n*p*Lr),Math.round(l*p*Lr)]}function kl(i,e){const n=Math.pow(2,e.z);return[(p=(i[0]/Lr+e.x)/n,360*p-180),(l=(i[1]/Lr+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,p}function sc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ea(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function hu(i,e,n){const l=i[0]-e[0],p=i[1]-e[1],_=i[0]-n[0],b=i[1]-n[1];return l*b-_*p==0&&l*_<=0&&p*b<=0}function Mc(i,e,n,l){return(p=[l[0]-n[0],l[1]-n[1]])[0]*(_=[e[0]-i[0],e[1]-i[1]])[1]-p[1]*_[0]!=0&&!(!Dc(i,e,n,l)||!Dc(n,l,i,e));var p,_}function ac(i,e,n){for(const l of n)for(let p=0;p<l.length-1;++p)if(Mc(i,e,l[p],l[p+1]))return!0;return!1}function Ya(i,e,n=!1){let l=!1;for(const A of e)for(let D=0;D<A.length-1;D++){if(hu(i,A[D],A[D+1]))return n;(_=A[D])[1]>(p=i)[1]!=(b=A[D+1])[1]>p[1]&&p[0]<(b[0]-_[0])*(p[1]-_[1])/(b[1]-_[1])+_[0]&&(l=!l)}var p,_,b;return l}function $a(i,e){for(const n of e)if(Ya(i,n))return!0;return!1}function Rc(i,e){for(const n of i)if(!Ya(n,e))return!1;for(let n=0;n<i.length-1;++n)if(ac(i[n],i[n+1],e))return!1;return!0}function Sa(i,e){for(const n of e)if(Rc(i,n))return!0;return!1}function Dc(i,e,n,l){const p=l[0]-n[0],_=l[1]-n[1],b=(i[0]-n[0])*_-p*(i[1]-n[1]),A=(e[0]-n[0])*_-p*(e[1]-n[1]);return b>0&&A<0||b<0&&A>0}function Ta(i,e,n){const l=[];for(let p=0;p<i.length;p++){const _=[];for(let b=0;b<i[p].length;b++){const A=Nl(i[p][b],n);sc(e,A),_.push(A)}l.push(_)}return l}function Pl(i,e,n){const l=[];for(let p=0;p<i.length;p++){const _=Ta(i[p],e,n);l.push(_)}return l}function sl(i,e,n,l){if(i[0]<n[0]||i[0]>n[2]){const p=.5*l;let _=i[0]-n[0]>p?-l:n[0]-i[0]>p?l:0;_===0&&(_=i[0]-n[2]>p?-l:n[2]-i[0]>p?l:0),i[0]+=_}sc(e,i)}function Uh(i,e,n,l){const p=Math.pow(2,l.z)*Lr,_=[l.x*Lr,l.y*Lr],b=[];for(const A of i)for(const D of A){const B=[D.x+_[0],D.y+_[1]];sl(B,e,n,p),b.push(B)}return b}function oc(i,e,n,l){const p=Math.pow(2,l.z)*Lr,_=[l.x*Lr,l.y*Lr],b=[];for(const D of i){const B=[];for(const G of D){const X=[G.x+_[0],G.y+_[1]];sc(e,X),B.push(X)}b.push(B)}if(e[2]-e[0]<=p/2){(A=e)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const D of b)for(const B of D)sl(B,e,n,p)}var A;return b}class ks{constructor(e,n){this.type=ni,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(js(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const p=[];for(const _ of l.features){const{type:b,coordinates:A}=_.geometry;b==="Polygon"&&p.push(A),b==="MultiPolygon"&&p.push(...A)}if(p.length)return new ks(l,{type:"MultiPolygon",coordinates:p})}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ks(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new ks(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(l.type==="Polygon"){const A=Ta(l.coordinates,_,b),D=Uh(n.geometry(),p,_,b);if(!Ea(p,_))return!1;for(const B of D)if(!Ya(B,A))return!1}if(l.type==="MultiPolygon"){const A=Pl(l.coordinates,_,b),D=Uh(n.geometry(),p,_,b);if(!Ea(p,_))return!1;for(const B of D)if(!$a(B,A))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(l.type==="Polygon"){const A=Ta(l.coordinates,_,b),D=oc(n.geometry(),p,_,b);if(!Ea(p,_))return!1;for(const B of D)if(!Rc(B,A))return!1}if(l.type==="MultiPolygon"){const A=Pl(l.coordinates,_,b),D=oc(n.geometry(),p,_,b);if(!Ea(p,_))return!1;for(const B of D)if(!Sa(B,A))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ku=class{constructor(i=[],e=(n,l)=>n<l?-1:n>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,l=e[i];for(;i>0;){const p=i-1>>1,_=e[p];if(n(l,_)>=0)break;e[i]=_,i=p}e[i]=l}_down(i){const{data:e,compare:n}=this,l=this.length>>1,p=e[i];for(;i<l;){let _=1+(i<<1);const b=_+1;if(b<this.length&&n(e[b],e[_])<0&&(_=b),n(e[_],p)>=0)break;e[i]=e[_],i=_}e[i]=p}};function Ol(i,e,n=0,l=i.length-1,p=Vi){for(;l>n;){if(l-n>600){const D=l-n+1,B=e-n+1,G=Math.log(D),X=.5*Math.exp(2*G/3),Y=.5*Math.sqrt(G*X*(D-X)/D)*(B-D/2<0?-1:1);Ol(i,e,Math.max(n,Math.floor(e-B*X/D+Y)),Math.min(l,Math.floor(e+(D-B)*X/D+Y)),p)}const _=i[e];let b=n,A=l;for(ka(i,n,e),p(i[l],_)>0&&ka(i,n,l);b<A;){for(ka(i,b,A),b++,A--;p(i[b],_)<0;)b++;for(;p(i[A],_)>0;)A--}p(i[n],_)===0?ka(i,n,A):(A++,ka(i,A,l)),A<=e&&(n=A+1),e<=A&&(l=A-1)}}function ka(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function Vi(i,e){return i<e?-1:i>e?1:0}function al(i,e){if(i.length<=1)return[i];const n=[];let l,p;for(const _ of i){const b=a(_);b!==0&&(_.area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(l&&n.push(l),l=[_]):l.push(_))}if(l&&n.push(l),e>1)for(let _=0;_<n.length;_++)n[_].length<=e||(Ol(n[_],e,1,n[_].length-1,le),n[_]=n[_].slice(0,e));return n}function le(i,e){return e.area-i.area}function a(i){let e=0;for(let n,l,p=0,_=i.length,b=_-1;p<_;b=p++)n=i[p],l=i[b],e+=(l.x-n.x)*(n.y+l.y);return e}const u=1/298.257223563,m=u*(2-u),v=Math.PI/180;class w{constructor(e){const n=6378.137*v*1e3,l=Math.cos(e*v),p=1/(1-m*(1-l*l)),_=Math.sqrt(p);this.kx=n*_*l,this.ky=n*_*p*(1-m)}distance(e,n){const l=this.wrap(e[0]-n[0])*this.kx,p=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+p*p)}pointOnLine(e,n){let l,p,_,b,A=1/0;for(let D=0;D<e.length-1;D++){let B=e[D][0],G=e[D][1],X=this.wrap(e[D+1][0]-B)*this.kx,Y=(e[D+1][1]-G)*this.ky,Q=0;X===0&&Y===0||(Q=(this.wrap(n[0]-B)*this.kx*X+(n[1]-G)*this.ky*Y)/(X*X+Y*Y),Q>1?(B=e[D+1][0],G=e[D+1][1]):Q>0&&(B+=X/this.kx*Q,G+=Y/this.ky*Q)),X=this.wrap(n[0]-B)*this.kx,Y=(n[1]-G)*this.ky;const ie=X*X+Y*Y;ie<A&&(A=ie,l=B,p=G,_=D,b=Q)}return{point:[l,p],index:_,t:Math.max(0,Math.min(1,b))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function I(i,e){return e[0]-i[0]}function P(i){return i[1]-i[0]+1}function F(i,e){return i[1]>=i[0]&&i[1]<e}function q(i,e){if(i[0]>i[1])return[null,null];const n=P(i);if(e){if(n===2)return[i,null];const p=Math.floor(n/2);return[[i[0],i[0]+p],[i[0]+p,i[1]]]}if(n===1)return[i,null];const l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function te(i,e){if(!F(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)sc(n,i[l]);return n}function ce(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const l of n)sc(e,l);return e}function xe(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function ze(i,e,n){if(!xe(i)||!xe(e))return NaN;let l=0,p=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(p=i[1]-e[3]),i[3]<e[1]&&(p=e[1]-i[3]),n.distance([0,0],[l,p])}function it(i,e,n){const l=n.pointOnLine(e,i);return n.distance(i,l.point)}function lt(i,e,n,l,p){const _=Math.min(it(i,[n,l],p),it(e,[n,l],p)),b=Math.min(it(n,[i,e],p),it(l,[i,e],p));return Math.min(_,b)}function Tt(i,e,n,l,p){if(!F(e,i.length)||!F(l,n.length))return 1/0;let _=1/0;for(let b=e[0];b<e[1];++b){const A=i[b],D=i[b+1];for(let B=l[0];B<l[1];++B){const G=n[B],X=n[B+1];if(Mc(A,D,G,X))return 0;_=Math.min(_,lt(A,D,G,X,p))}}return _}function Ft(i,e,n,l,p){if(!F(e,i.length)||!F(l,n.length))return NaN;let _=1/0;for(let b=e[0];b<=e[1];++b)for(let A=l[0];A<=l[1];++A)if(_=Math.min(_,p.distance(i[b],n[A])),_===0)return _;return _}function vn(i,e,n){if(Ya(i,e,!0))return 0;let l=1/0;for(const p of e){const _=p[0],b=p[p.length-1];if(_!==b&&(l=Math.min(l,it(i,[b,_],n)),l===0))return l;const A=n.pointOnLine(p,i);if(l=Math.min(l,n.distance(i,A.point)),l===0)return l}return l}function yn(i,e,n,l){if(!F(e,i.length))return NaN;for(let _=e[0];_<=e[1];++_)if(Ya(i[_],n,!0))return 0;let p=1/0;for(let _=e[0];_<e[1];++_){const b=i[_],A=i[_+1];for(const D of n)for(let B=0,G=D.length,X=G-1;B<G;X=B++){const Y=D[X],Q=D[B];if(Mc(b,A,Y,Q))return 0;p=Math.min(p,lt(b,A,Y,Q,l))}}return p}function un(i,e){for(const n of i)for(const l of n)if(Ya(l,e,!0))return!0;return!1}function Ni(i,e,n,l=1/0){const p=ce(i),_=ce(e);if(l!==1/0&&ze(p,_,n)>=l)return l;if(Ea(p,_)){if(un(i,e))return 0}else if(un(e,i))return 0;let b=1/0;for(const A of i)for(let D=0,B=A.length,G=B-1;D<B;G=D++){const X=A[G],Y=A[D];for(const Q of e)for(let ie=0,re=Q.length,ae=re-1;ie<re;ae=ie++){const me=Q[ae],Fe=Q[ie];if(Mc(X,Y,me,Fe))return 0;b=Math.min(b,lt(X,Y,me,Fe,n))}}return b}function Pn(i,e,n,l,p,_){if(!_)return;const b=ze(te(l,_),p,n);b<e&&i.push([b,_,[0,0]])}function Ur(i,e,n,l,p,_,b){if(!_||!b)return;const A=ze(te(l,_),te(p,b),n);A<e&&i.push([A,_,b])}function aa(i,e,n,l,p=1/0){let _=Math.min(l.distance(i[0],n[0][0]),p);if(_===0)return _;const b=new Ku([[0,[0,i.length-1],[0,0]]],I),A=ce(n);for(;b.length>0;){const D=b.pop();if(D[0]>=_)continue;const B=D[1],G=e?50:100;if(P(B)<=G){if(!F(B,i.length))return NaN;if(e){const X=yn(i,B,n,l);if(isNaN(X)||X===0)return X;_=Math.min(_,X)}else for(let X=B[0];X<=B[1];++X){const Y=vn(i[X],n,l);if(_=Math.min(_,Y),_===0)return 0}}else{const X=q(B,e);Pn(b,_,l,i,A,X[0]),Pn(b,_,l,i,A,X[1])}}return _}function Ts(i,e,n,l,p,_=1/0){let b=Math.min(_,p.distance(i[0],n[0]));if(b===0)return b;const A=new Ku([[0,[0,i.length-1],[0,n.length-1]]],I);for(;A.length>0;){const D=A.pop();if(D[0]>=b)continue;const B=D[1],G=D[2],X=e?50:100,Y=l?50:100;if(P(B)<=X&&P(G)<=Y){if(!F(B,i.length)&&F(G,n.length))return NaN;let Q;if(e&&l)Q=Tt(i,B,n,G,p),b=Math.min(b,Q);else if(e&&!l){const ie=i.slice(B[0],B[1]+1);for(let re=G[0];re<=G[1];++re)if(Q=it(n[re],ie,p),b=Math.min(b,Q),b===0)return b}else if(!e&&l){const ie=n.slice(G[0],G[1]+1);for(let re=B[0];re<=B[1];++re)if(Q=it(i[re],ie,p),b=Math.min(b,Q),b===0)return b}else Q=Ft(i,B,n,G,p),b=Math.min(b,Q)}else{const Q=q(B,e),ie=q(G,l);Ur(A,b,p,i,n,Q[0],ie[0]),Ur(A,b,p,i,n,Q[0],ie[1]),Ur(A,b,p,i,n,Q[1],ie[0]),Ur(A,b,p,i,n,Q[1],ie[1])}}return b}function rr(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class Vr{constructor(e,n){this.type=jt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(js(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new Vr(l,l.features.map((p=>rr(p.geometry))).flat());if(l.type==="Feature")return new Vr(l,rr(l.geometry));if("type"in l&&"coordinates"in l)return new Vr(l,rr(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const p=n.geometry(),_=p.flat().map((D=>kl([D.x,D.y],n.canonical)));if(p.length===0)return NaN;const b=new w(_[0][1]);let A=1/0;for(const D of l){switch(D.type){case"Point":A=Math.min(A,Ts(_,!1,[D.coordinates],!1,b,A));break;case"LineString":A=Math.min(A,Ts(_,!1,D.coordinates,!0,b,A));break;case"Polygon":A=Math.min(A,aa(_,!1,D.coordinates,b,A))}if(A===0)return A}return A})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const p=n.geometry(),_=p.flat().map((D=>kl([D.x,D.y],n.canonical)));if(p.length===0)return NaN;const b=new w(_[0][1]);let A=1/0;for(const D of l){switch(D.type){case"Point":A=Math.min(A,Ts(_,!0,[D.coordinates],!1,b,A));break;case"LineString":A=Math.min(A,Ts(_,!0,D.coordinates,!0,b,A));break;case"Polygon":A=Math.min(A,aa(_,!0,D.coordinates,b,A))}if(A===0)return A}return A})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,l){const p=n.geometry();if(p.length===0||p[0].length===0)return NaN;const _=al(p,0).map((D=>D.map((B=>B.map((G=>kl([G.x,G.y],n.canonical))))))),b=new w(_[0][0][0][1]);let A=1/0;for(const D of l)for(const B of _){switch(D.type){case"Point":A=Math.min(A,aa([D.coordinates],!1,B,b,A));break;case"LineString":A=Math.min(A,aa(D.coordinates,!0,B,b,A));break;case"Polygon":A=Math.min(A,Ni(B,D.coordinates,b,A))}if(A===0)return A}return A})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ps{constructor(e){this.type=ai,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ps(l)}evaluate(e){var n;const l=(n=e.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?Dr(l,this.key):null}eachChild(){}outputDefined(){return!1}}const Ka={"==":il,"!=":nr,">":Bd,"<":ii,">=":mo,"<=":ir,array:Us,at:Si,boolean:Us,case:tl,coalesce:kr,collator:Wa,format:ga,image:rl,in:pi,"index-of":Hi,interpolate:sa,"interpolate-hcl":sa,"interpolate-lab":sa,length:Dl,let:er,literal:Ns,match:Oi,number:Us,"number-format":$u,object:Us,slice:fs,step:zt,string:Us,"to-boolean":ds,"to-color":ds,"to-number":ds,"to-string":ds,var:el,within:ks,distance:Vr,"global-state":Ps};class As{constructor(e,n,l,p){this.name=e,this.type=n,this._evaluate=l,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const l=e[0],p=As.definitions[l];if(!p)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,A=b.filter((([B])=>!Array.isArray(B)||B.length===e.length-1));let D=null;for(const[B,G]of A){D=new Jo(n.registry,Aa,n.path,null,n.scope);const X=[];let Y=!1;for(let Q=1;Q<e.length;Q++){const ie=e[Q],re=Array.isArray(B)?B[Q-1]:B.type,ae=D.parse(ie,1+X.length,re);if(!ae){Y=!0;break}X.push(ae)}if(!Y)if(Array.isArray(B)&&B.length!==X.length)D.error(`Expected ${B.length} arguments, but found ${X.length} instead.`);else{for(let Q=0;Q<X.length;Q++){const ie=Array.isArray(B)?B[Q]:B.type,re=X[Q];D.concat(Q+1).checkSubtype(ie,re.type)}if(D.errors.length===0)return new As(l,_,G,X)}}if(A.length===1)n.errors.push(...D.errors);else{const B=(A.length?A:b).map((([X])=>{return Y=X,Array.isArray(Y)?`(${Y.map(Hn).join(", ")})`:`(${Hn(Y.type)}...)`;var Y})).join(" | "),G=[];for(let X=1;X<e.length;X++){const Y=n.parse(e[X],1+G.length);if(!Y)return null;G.push(Hn(Y.type))}n.error(`Expected arguments of type ${B}, but found (${G.join(", ")}) instead.`)}return null}static register(e,n){As.definitions=n;for(const l in n)e[l]=As}}function Qu(i,[e,n,l,p]){e=e.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);const _=p?p.evaluate(i):1,b=ma(e,n,l,_);if(b)throw new lr(b);return new ui(e/255,n/255,l/255,_,!1)}function du(i,e){return i in e}function Qa(i,e){const n=e[i];return n===void 0?null:n}function ol(i){return{type:i}}function Aa(i){if(i instanceof el)return Aa(i.boundExpression);if(i instanceof As&&i.name==="error"||i instanceof Wa||i instanceof ks||i instanceof Vr||i instanceof Ps)return!1;const e=i instanceof ds||i instanceof Us;let n=!0;return i.eachChild((l=>{n=e?n&&Aa(l):n&&l instanceof Ns})),!!n&&zl(i)&&kc(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function zl(i){if(i instanceof As&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ks||i instanceof Vr)return!1;let e=!0;return i.eachChild((n=>{e&&!zl(n)&&(e=!1)})),e}function Nc(i){if(i instanceof As&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!Nc(n)&&(e=!1)})),e}function kc(i,e){if(i instanceof As&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((l=>{n&&!kc(l,e)&&(n=!1)})),n}function Ju(i){return{result:"success",value:i}}function lc(i){return{result:"error",value:i}}function go(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Fd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function fu(i){return!!i.expression&&i.expression.interpolated}function bi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Vh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Nr(i)===ia}function Ja(i){return i}function Gh(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),p=i.type||(fu(e)?"exponential":"interval"),_=(function(G){switch(G.type){case"color":return ui.parse;case"padding":return yr.parse;case"numberArray":return Gi.parse;case"colorArray":return hn.parse;default:return null}})(e);if(_&&((i=xi({},i)).stops&&(i.stops=i.stops.map((G=>[G[0],_(G[1])]))),i.default=_(i.default?i.default:e.default)),i.colorSpace&&(b=i.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var b;const A=(function(G){switch(G){case"exponential":return cc;case"interval":return Hh;case"categorical":return ep;case"identity":return jd;default:throw new Error(`Unknown function type "${G}"`)}})(p);let D,B;if(p==="categorical"){D=Object.create(null);for(const G of i.stops)D[G[0]]=G[1];B=typeof i.stops[0][0]}if(n){const G={},X=[];for(let ie=0;ie<i.stops.length;ie++){const re=i.stops[ie],ae=re[0].zoom;G[ae]===void 0&&(G[ae]={zoom:ae,type:i.type,property:i.property,default:i.default,stops:[]},X.push(ae)),G[ae].stops.push([re[0].value,re[1]])}const Y=[];for(const ie of X)Y.push([G[ie].zoom,Gh(G[ie],e)]);const Q={name:"linear"};return{kind:"composite",interpolationType:Q,interpolationFactor:sa.interpolationFactor.bind(void 0,Q),zoomStops:Y.map((ie=>ie[0])),evaluate:({zoom:ie},re)=>cc({stops:Y,base:i.base},e,ie).evaluate(ie,re)}}if(l){const G=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:G,interpolationFactor:sa.interpolationFactor.bind(void 0,G),zoomStops:i.stops.map((X=>X[0])),evaluate:({zoom:X})=>A(i,e,X,D,B)}}return{kind:"source",evaluate(G,X){const Y=X&&X.properties?X.properties[i.property]:void 0;return Y===void 0?eo(i.default,e.default):A(i,e,Y,D,B)}}}function eo(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function ep(i,e,n,l,p){return eo(typeof n===p?l[n]:void 0,i.default,e.default)}function Hh(i,e,n){if(bi(n)!=="number")return eo(i.default,e.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const p=nl(i.stops.map((_=>_[0])),n);return i.stops[p][1]}function cc(i,e,n){const l=i.base!==void 0?i.base:1;if(bi(n)!=="number")return eo(i.default,e.default);const p=i.stops.length;if(p===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[p-1][0])return i.stops[p-1][1];const _=nl(i.stops.map((G=>G[0])),n),b=(function(G,X,Y,Q){const ie=Q-Y,re=G-Y;return ie===0?0:X===1?re/ie:(Math.pow(X,re)-1)/(Math.pow(X,ie)-1)})(n,l,i.stops[_][0],i.stops[_+1][0]),A=i.stops[_][1],D=i.stops[_+1][1],B=xr[e.type]||Ja;return typeof A.evaluate=="function"?{evaluate(...G){const X=A.evaluate.apply(void 0,G),Y=D.evaluate.apply(void 0,G);if(X!==void 0&&Y!==void 0)return B(X,Y,b,i.colorSpace)}}:B(A,D,b,i.colorSpace)}function jd(i,e,n){switch(e.type){case"color":n=ui.parse(n);break;case"formatted":n=wi.fromString(n.toString());break;case"resolvedImage":n=ra.fromString(n.toString());break;case"padding":n=yr.parse(n);break;case"colorArray":n=hn.parse(n);break;case"numberArray":n=Gi.parse(n);break;default:bi(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return eo(n,i.default,e.default)}As.register(Ka,{error:[{kind:"error"},[Gn],(i,[e])=>{throw new lr(e.evaluate(i))}],typeof:[Gn,[ai],(i,[e])=>Hn(Nr(e.evaluate(i)))],"to-rgba":[Es(jt,4),[vs],(i,[e])=>{const[n,l,p,_]=e.evaluate(i).rgb;return[255*n,255*l,255*p,_]}],rgb:[vs,[jt,jt,jt],Qu],rgba:[vs,[jt,jt,jt,jt],Qu],has:{type:ni,overloads:[[[Gn],(i,[e])=>du(e.evaluate(i),i.properties())],[[Gn,ia],(i,[e,n])=>du(e.evaluate(i),n.evaluate(i))]]},get:{type:ai,overloads:[[[Gn],(i,[e])=>Qa(e.evaluate(i),i.properties())],[[Gn,ia],(i,[e,n])=>Qa(e.evaluate(i),n.evaluate(i))]]},"feature-state":[ai,[Gn],(i,[e])=>Qa(e.evaluate(i),i.featureState||{})],properties:[ia,[],i=>i.properties()],"geometry-type":[Gn,[],i=>i.geometryType()],id:[ai,[],i=>i.id()],zoom:[jt,[],i=>i.globals.zoom],"heatmap-density":[jt,[],i=>i.globals.heatmapDensity||0],elevation:[jt,[],i=>i.globals.elevation||0],"line-progress":[jt,[],i=>i.globals.lineProgress||0],accumulated:[ai,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[jt,ol(jt),(i,e)=>{let n=0;for(const l of e)n+=l.evaluate(i);return n}],"*":[jt,ol(jt),(i,e)=>{let n=1;for(const l of e)n*=l.evaluate(i);return n}],"-":{type:jt,overloads:[[[jt,jt],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[jt],(i,[e])=>-e.evaluate(i)]]},"/":[jt,[jt,jt],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[jt,[jt,jt],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[jt,[],()=>Math.LN2],pi:[jt,[],()=>Math.PI],e:[jt,[],()=>Math.E],"^":[jt,[jt,jt],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[jt,[jt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[jt,[jt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[jt,[jt],(i,[e])=>Math.log(e.evaluate(i))],log2:[jt,[jt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[jt,[jt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[jt,[jt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[jt,[jt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[jt,[jt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[jt,[jt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[jt,[jt],(i,[e])=>Math.atan(e.evaluate(i))],min:[jt,ol(jt),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[jt,ol(jt),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[jt,[jt],(i,[e])=>Math.abs(e.evaluate(i))],round:[jt,[jt],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[jt,[jt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[jt,[jt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ni,[Gn,ai],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[ni,[ai],(i,[e])=>i.id()===e.value],"filter-type-==":[ni,[Gn],(i,[e])=>i.geometryType()===e.value],"filter-<":[ni,[Gn,ai],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l<p}],"filter-id-<":[ni,[ai],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[ni,[Gn,ai],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l>p}],"filter-id->":[ni,[ai],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[ni,[Gn,ai],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[ni,[ai],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[ni,[Gn,ai],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[ni,[ai],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[ni,[ai],(i,[e])=>e.value in i.properties()],"filter-has-id":[ni,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ni,[Es(Gn)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ni,[Es(ai)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ni,[Gn,Es(ai)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ni,[Gn,Es(ai)],(i,[e,n])=>(function(l,p,_,b){for(;_<=b;){const A=_+b>>1;if(p[A]===l)return!0;p[A]>l?b=A-1:_=A+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ni,overloads:[[[ni,ni],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[ol(ni),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:ni,overloads:[[[ni,ni],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[ol(ni),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[ni,[ni],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ni,[Gn],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Gn,[Gn],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Gn,[Gn],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Gn,ol(ai),(i,e)=>e.map((n=>Na(n.evaluate(i)))).join("")],"resolved-locale":[Gn,[Rs],(i,[e])=>e.evaluate(i).resolvedLocale()]});class qh{constructor(e,n,l){this.expression=e,this._warningHistory={},this._evaluator=new Qo,this._defaultValue=n?(function(p){if(p.type==="color"&&Vh(p.default))return new ui(0,0,0,0);switch(p.type){case"color":return ui.parse(p.default)||null;case"padding":return yr.parse(p.default)||null;case"numberArray":return Gi.parse(p.default)||null;case"colorArray":return hn.parse(p.default)||null;case"variableAnchorOffsetCollection":return Mi.parse(p.default)||null;case"projectionDefinition":return Kr.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=Vs(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,p,_,b){this._globalState&&(e=Vs(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new lr(`Expected value to be one of ${Object.keys(this._enumValues).map((D=>JSON.stringify(D))).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function uc(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ka}function pu(i,e,n){const l=new Jo(Ka,Aa,[],e?(function(_){const b={color:vs,string:Gn,number:jt,enum:Gn,boolean:ni,formatted:Sr,padding:ji,numberArray:us,colorArray:da,projectionDefinition:ws,resolvedImage:dr,variableAnchorOffsetCollection:an};return _.type==="array"?Es(b[_.value]||ai,_.length):b[_.type]})(e):void 0),p=l.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Ju(new qh(p,e,n)):lc(l.errors)}class Ca{constructor(e,n,l){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Nc(n.expression),this.globalStateRefs=Os(n.expression),this._globalState=l}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=Vs(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,_,b)}evaluate(e,n,l,p,_,b){return this._globalState&&(e=Vs(e,this._globalState)),this._styleExpression.evaluate(e,n,l,p,_,b)}}class hc{constructor(e,n,l,p,_){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Nc(n.expression),this.globalStateRefs=Os(n.expression),this.interpolationType=p,this._globalState=_}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=Vs(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,_,b)}evaluate(e,n,l,p,_,b){return this._globalState&&(e=Vs(e,this._globalState)),this._styleExpression.evaluate(e,n,l,p,_,b)}interpolationFactor(e,n,l){return this.interpolationType?sa.interpolationFactor(this.interpolationType,e,n,l):0}}function dc(i,e,n){const l=pu(i,e,n);if(l.result==="error")return l;const p=l.value.expression,_=zl(p);if(!_&&!go(e))return lc([new bn("","data expressions not supported")]);const b=kc(p,["zoom"]);if(!b&&!Fd(e))return lc([new bn("","zoom expressions not supported")]);const A=fc(p);return A||b?A instanceof bn?lc([A]):A instanceof sa&&!fu(e)?lc([new bn("",'"interpolate" expressions cannot be used with this property')]):Ju(A?new hc(_?"camera":"composite",l.value,A.labels,A instanceof sa?A.interpolation:void 0,n):new Ca(_?"constant":"source",l.value,n)):lc([new bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Pc{constructor(e,n){this._parameters=e,this._specification=n,xi(this,Gh(this._parameters,this._specification))}static deserialize(e){return new Pc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fc(i){let e=null;if(i instanceof er)e=fc(i.result);else if(i instanceof kr){for(const n of i.args)if(e=fc(n),e)break}else(i instanceof zt||i instanceof sa)&&i.input instanceof As&&i.input.name==="zoom"&&(e=i);return e instanceof bn||i.eachChild((n=>{const l=fc(n);l instanceof bn?e=l:!e&&l?e=new bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new bn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Os(i,e=new Set){return i instanceof Ps&&e.add(i.key),i.eachChild((n=>{Os(n,e)})),e}function Vs(i,e){const{zoom:n,heatmapDensity:l,elevation:p,lineProgress:_,isSupportedScript:b,accumulated:A}=i??{};return{zoom:n,heatmapDensity:l,elevation:p,lineProgress:_,isSupportedScript:b,accumulated:A,globalState:e}}function ll(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ll(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const cl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pa(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ll(i)||(i=Oc(i));const n=pu(i,cl,e);if(n.result==="error")throw new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,p,_)=>n.value.evaluate(l,p,{},_),needGeometry:Ud(i),getGlobalStateRefs:()=>Os(n.value.expression)}}function Ll(i,e){return i<e?-1:i>e?1:0}function Ud(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Ud(i[e]))return!0;return!1}function Oc(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?mu(i[1],i[2],"=="):e==="!="?_r(mu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?mu(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Oc))):e==="all"?["all"].concat(i.slice(1).map(Oc)):e==="none"?["all"].concat(i.slice(1).map(Oc).map(_r)):e==="in"?Vd(i[1],i.slice(2)):e==="!in"?_r(Vd(i[1],i.slice(2))):e==="has"?Gs(i[1]):e!=="!has"||_r(Gs(i[1]));var n}function mu(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Vd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Ll)]]:["filter-in-small",i,["literal",e]]}}function Gs(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function _r(i){return["!",i]}function Li(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let p="[";for(const _ of i)p+=`${Li(_)},`;return`${p}]`}const n=Object.keys(i).sort();let l="{";for(let p=0;p<n.length;p++)l+=`${JSON.stringify(n[p])}:${Li(i[n[p]])},`;return`${l}}`}function Bl(i){let e="";for(const n of kn)e+=`/${Li(i[n])}`;return e}function to(i){const e=i.value;return e?[new Zt(i.key,e,"constants have been deprecated as of v8")]:[]}function Xr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Oa(i){if(Array.isArray(i))return i.map(Oa);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Oa(i[n]);return e}return Xr(i)}function za(i){const e=i.key,n=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},_=i.style,b=i.styleSpec,A=i.validateSpec;let D=[];const B=bi(n);if(B!=="object")return[new Zt(e,n,`object expected, ${B} found`)];for(const G in n){const X=G.split(".")[0],Y=Dr(l,X)||l["*"];let Q;if(Dr(p,X))Q=p[X];else if(Dr(l,X)){if(n[G]===void 0)continue;Q=A}else if(p["*"])Q=p["*"];else{if(!l["*"]){D.push(new Zt(e,n[G],`unknown property "${G}"`));continue}Q=A}D=D.concat(Q({key:(e&&`${e}.`)+G,value:n[G],valueSpec:Y,style:_,styleSpec:b,object:n,objectKey:G,validateSpec:A},n))}for(const G in l)p[G]||l[G].required&&l[G].default===void 0&&n[G]===void 0&&D.push(new Zt(e,n,`missing required property "${G}"`));return D}function eh(i){const e=i.value,n=i.valueSpec,l=i.style,p=i.styleSpec,_=i.key,b=i.arrayElementValidator||i.validateSpec;if(bi(e)!=="array")return[new Zt(_,e,`array expected, ${bi(e)} found`)];if(n.length&&e.length!==n.length)return[new Zt(_,e,`array length ${n.length} expected, length ${e.length} found`)];let A={type:n.value,values:n.values};p.$version<7&&(A.function=n.function),bi(n.value)==="object"&&(A=n.value);let D=[];for(let B=0;B<e.length;B++)D=D.concat(b({array:e,arrayIndex:B,value:e[B],valueSpec:A,validateSpec:i.validateSpec,style:l,styleSpec:p,key:`${_}[${B}]`}));return D}function ul(i){const e=i.key,n=i.value,l=i.valueSpec;let p=bi(n);return p==="number"&&n!=n&&(p="NaN"),p!=="number"?[new Zt(e,n,`number expected, ${p} found`)]:"minimum"in l&&n<l.minimum?[new Zt(e,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new Zt(e,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function hl(i){const e=i.valueSpec,n=Xr(i.value.type);let l,p,_,b={};const A=n!=="categorical"&&i.value.property===void 0,D=!A,B=bi(i.value.stops)==="array"&&bi(i.value.stops[0])==="array"&&bi(i.value.stops[0][0])==="object",G=za({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Q){if(n==="identity")return[new Zt(Q.key,Q.value,'identity function may not have a "stops" property')];let ie=[];const re=Q.value;return ie=ie.concat(eh({key:Q.key,value:re,valueSpec:Q.valueSpec,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:X})),bi(re)==="array"&&re.length===0&&ie.push(new Zt(Q.key,re,"array must have at least one stop")),ie},default:function(Q){return Q.validateSpec({key:Q.key,value:Q.value,valueSpec:e,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec})}}});return n==="identity"&&A&&G.push(new Zt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||G.push(new Zt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!fu(i.valueSpec)&&G.push(new Zt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(D&&!go(i.valueSpec)?G.push(new Zt(i.key,i.value,"property functions not supported")):A&&!Fd(i.valueSpec)&&G.push(new Zt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!B||i.value.property!==void 0||G.push(new Zt(i.key,i.value,'"property" property is required')),G;function X(Q){let ie=[];const re=Q.value,ae=Q.key;if(bi(re)!=="array")return[new Zt(ae,re,`array expected, ${bi(re)} found`)];if(re.length!==2)return[new Zt(ae,re,`array length 2 expected, length ${re.length} found`)];if(B){if(bi(re[0])!=="object")return[new Zt(ae,re,`object expected, ${bi(re[0])} found`)];if(re[0].zoom===void 0)return[new Zt(ae,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new Zt(ae,re,"object stop key must have value")];if(_&&_>Xr(re[0].zoom))return[new Zt(ae,re[0].zoom,"stop zoom values must appear in ascending order")];Xr(re[0].zoom)!==_&&(_=Xr(re[0].zoom),p=void 0,b={}),ie=ie.concat(za({key:`${ae}[0]`,value:re[0],valueSpec:{zoom:{}},validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:ul,value:Y}}))}else ie=ie.concat(Y({key:`${ae}[0]`,value:re[0],validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec},re));return uc(Oa(re[1]))?ie.concat([new Zt(`${ae}[1]`,re[1],"expressions are not allowed in function stops.")]):ie.concat(Q.validateSpec({key:`${ae}[1]`,value:re[1],valueSpec:e,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec}))}function Y(Q,ie){const re=bi(Q.value),ae=Xr(Q.value),me=Q.value!==null?Q.value:ie;if(l){if(re!==l)return[new Zt(Q.key,me,`${re} stop domain type must match previous stop domain type ${l}`)]}else l=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new Zt(Q.key,me,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&n!=="categorical"){let Fe=`number expected, ${re} found`;return go(e)&&n===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Zt(Q.key,me,Fe)]}return n!=="categorical"||re!=="number"||isFinite(ae)&&Math.floor(ae)===ae?n!=="categorical"&&re==="number"&&p!==void 0&&ae<p?[new Zt(Q.key,me,"stop domain values must appear in ascending order")]:(p=ae,n==="categorical"&&ae in b?[new Zt(Q.key,me,"stop domain values must be unique")]:(b[ae]=!0,[])):[new Zt(Q.key,me,`integer expected, found ${ae}`)]}}function dl(i){const e=(i.expressionContext==="property"?dc:pu)(Oa(i.value),i.valueSpec);if(e.result==="error")return e.value.map((l=>new Zt(`${i.key}${l.key}`,i.value,l.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Zt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Nc(n))return[new Zt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Nc(n))return[new Zt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!kc(n,["zoom","feature-state"]))return[new Zt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!zl(n))return[new Zt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fl(i){const e=i.key,n=i.value,l=bi(n);return l!=="string"?[new Zt(e,n,`color expected, ${l} found`)]:ui.parse(String(n))?[]:[new Zt(e,n,`color expected, "${n}" found`)]}function jl(i){const e=i.key,n=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(Xr(n))===-1&&p.push(new Zt(e,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(Xr(n))===-1&&p.push(new Zt(e,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function yo(i){return ll(Oa(i.value))?dl(xi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):fl(i)}function fl(i){const e=i.value,n=i.key;if(bi(e)!=="array")return[new Zt(n,e,`array expected, ${bi(e)} found`)];const l=i.styleSpec;let p,_=[];if(e.length<1)return[new Zt(n,e,"filter array must have at least 1 element")];switch(_=_.concat(jl({key:`${n}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Xr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Xr(e[1])==="$type"&&_.push(new Zt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new Zt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=bi(e[1]),p!=="string"&&_.push(new Zt(`${n}[1]`,e[1],`string expected, ${p} found`)));for(let b=2;b<e.length;b++)p=bi(e[b]),Xr(e[1])==="$type"?_=_.concat(jl({key:`${n}[${b}]`,value:e[b],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Zt(`${n}[${b}]`,e[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<e.length;b++)_=_.concat(fl({key:`${n}[${b}]`,value:e[b],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=bi(e[1]),e.length!==2?_.push(new Zt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Zt(`${n}[1]`,e[1],`string expected, ${p} found`))}return _}function Ul(i,e){const n=i.key,l=i.validateSpec,p=i.style,_=i.styleSpec,b=i.value,A=i.objectKey,D=_[`${e}_${i.layerType}`];if(!D)return[];const B=A.match(/^(.*)-transition$/);if(e==="paint"&&B&&D[B[1]]&&D[B[1]].transition)return l({key:n,value:b,valueSpec:_.transition,style:p,styleSpec:_});const G=i.valueSpec||D[A];if(!G)return[new Zt(n,b,`unknown property "${A}"`)];let X;if(bi(b)==="string"&&go(G)&&!G.tokens&&(X=/^{([^}]+)}$/.exec(b)))return[new Zt(n,b,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const Y=[];return i.layerType==="symbol"&&A==="text-font"&&Vh(Oa(b))&&Xr(b.type)==="identity"&&Y.push(new Zt(n,b,'"text-font" does not support identity functions')),Y.concat(l({key:i.key,value:b,valueSpec:G,style:p,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:A}))}function pl(i){return Ul(i,"paint")}function Zh(i){return Ul(i,"layout")}function Xh(i){let e=[];const n=i.value,l=i.key,p=i.style,_=i.styleSpec;if(bi(n)!=="object")return[new Zt(l,n,`object expected, ${bi(n)} found`)];n.type||n.ref||e.push(new Zt(l,n,'either "type" or "ref" is required'));let b=Xr(n.type);const A=Xr(n.ref);if(n.id){const D=Xr(n.id);for(let B=0;B<i.arrayIndex;B++){const G=p.layers[B];Xr(G.id)===D&&e.push(new Zt(l,n.id,`duplicate layer id "${n.id}", previously used at line ${G.id.__line__}`))}}if("ref"in n){let D;["type","source","source-layer","filter","layout"].forEach((B=>{B in n&&e.push(new Zt(l,n[B],`"${B}" is prohibited for ref layers`))})),p.layers.forEach((B=>{Xr(B.id)===A&&(D=B)})),D?D.ref?e.push(new Zt(l,n.ref,"ref cannot reference another ref layer")):b=Xr(D.type):e.push(new Zt(l,n.ref,`ref layer "${A}" not found`))}else if(b!=="background")if(n.source){const D=p.sources&&p.sources[n.source],B=D&&Xr(D.type);D?B==="vector"&&b==="raster"?e.push(new Zt(l,n.source,`layer "${n.id}" requires a raster source`)):B!=="raster-dem"&&b==="hillshade"||B!=="raster-dem"&&b==="color-relief"?e.push(new Zt(l,n.source,`layer "${n.id}" requires a raster-dem source`)):B==="raster"&&b!=="raster"?e.push(new Zt(l,n.source,`layer "${n.id}" requires a vector source`)):B!=="vector"||n["source-layer"]?B==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?e.push(new Zt(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!n.paint||!n.paint["line-gradient"]||B==="geojson"&&D.lineMetrics||e.push(new Zt(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Zt(l,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Zt(l,n.source,`source "${n.source}" not found`))}else e.push(new Zt(l,n,'missing required property "source"'));return e=e.concat(za({key:l,value:n,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:n.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:yo,layout:D=>za({layer:n,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":B=>Zh(xi({layerType:b},B))}}),paint:D=>za({layer:n,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,validateSpec:D.validateSpec,objectElementValidators:{"*":B=>pl(xi({layerType:b},B))}})}})),e}function no(i){const e=i.value,n=i.key,l=bi(e);return l!=="string"?[new Zt(n,e,`string expected, ${l} found`)]:[]}const gu={promoteId:function({key:i,value:e}){if(bi(e)==="string")return no({key:i,value:e});{const n=[];for(const l in e)n.push(...no({key:`${i}.${l}`,value:e[l]}));return n}}};function Vl(i){const e=i.value,n=i.key,l=i.styleSpec,p=i.style,_=i.validateSpec;if(!e.type)return[new Zt(n,e,'"type" is required')];const b=Xr(e.type);let A;switch(b){case"vector":case"raster":return A=za({key:n,value:e,valueSpec:l[`source_${b.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:gu,validateSpec:_}),A;case"raster-dem":return A=(function(D){var B;const G=(B=D.sourceName)!==null&&B!==void 0?B:"",X=D.value,Y=D.styleSpec,Q=Y.source_raster_dem,ie=D.style;let re=[];const ae=bi(X);if(X===void 0)return re;if(ae!=="object")return re.push(new Zt("source_raster_dem",X,`object expected, ${ae} found`)),re;const me=Xr(X.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],_e=D.value.encoding?`"${D.value.encoding}"`:"Default";for(const we in X)!me&&Fe.includes(we)?re.push(new Zt(we,X[we],`In "${G}": "${we}" is only valid when "encoding" is set to "custom". ${_e} encoding found`)):Q[we]?re=re.concat(D.validateSpec({key:we,value:X[we],valueSpec:Q[we],validateSpec:D.validateSpec,style:ie,styleSpec:Y})):re.push(new Zt(we,X[we],`unknown property "${we}"`));return re})({sourceName:n,value:e,style:i.style,styleSpec:l,validateSpec:_}),A;case"geojson":if(A=za({key:n,value:e,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:_,objectElementValidators:gu}),e.cluster)for(const D in e.clusterProperties){const[B,G]=e.clusterProperties[D],X=typeof B=="string"?[B,["accumulated"],["get",D]]:B;A.push(...dl({key:`${n}.${D}.map`,value:G,expressionContext:"cluster-map"})),A.push(...dl({key:`${n}.${D}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return A;case"video":return za({key:n,value:e,valueSpec:l.source_video,style:p,validateSpec:_,styleSpec:l});case"image":return za({key:n,value:e,valueSpec:l.source_image,style:p,validateSpec:_,styleSpec:l});case"canvas":return[new Zt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return jl({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ps(i){const e=i.value,n=i.styleSpec,l=n.light,p=i.style;let _=[];const b=bi(e);if(e===void 0)return _;if(b!=="object")return _=_.concat([new Zt("light",e,`object expected, ${b} found`)]),_;for(const A in e){const D=A.match(/^(.*)-transition$/);_=_.concat(D&&l[D[1]]&&l[D[1]].transition?i.validateSpec({key:A,value:e[A],valueSpec:n.transition,validateSpec:i.validateSpec,style:p,styleSpec:n}):l[A]?i.validateSpec({key:A,value:e[A],valueSpec:l[A],validateSpec:i.validateSpec,style:p,styleSpec:n}):[new Zt(A,e[A],`unknown property "${A}"`)])}return _}function th(i){const e=i.value,n=i.styleSpec,l=n.sky,p=i.style,_=bi(e);if(e===void 0)return[];if(_!=="object")return[new Zt("sky",e,`object expected, ${_} found`)];let b=[];for(const A in e)b=b.concat(l[A]?i.validateSpec({key:A,value:e[A],valueSpec:l[A],style:p,styleSpec:n}):[new Zt(A,e[A],`unknown property "${A}"`)]);return b}function Wh(i){const e=i.value,n=i.styleSpec,l=n.terrain,p=i.style;let _=[];const b=bi(e);if(e===void 0)return _;if(b!=="object")return _=_.concat([new Zt("terrain",e,`object expected, ${b} found`)]),_;for(const A in e)_=_.concat(l[A]?i.validateSpec({key:A,value:e[A],valueSpec:l[A],validateSpec:i.validateSpec,style:p,styleSpec:n}):[new Zt(A,e[A],`unknown property "${A}"`)]);return _}function Gd(i){let e=[];const n=i.value,l=i.key;if(Array.isArray(n)){const p=[],_=[];for(const b in n)n[b].id&&p.includes(n[b].id)&&e.push(new Zt(l,n,`all the sprites' ids must be unique, but ${n[b].id} is duplicated`)),p.push(n[b].id),n[b].url&&_.includes(n[b].url)&&e.push(new Zt(l,n,`all the sprites' URLs must be unique, but ${n[b].url} is duplicated`)),_.push(n[b].url),e=e.concat(za({key:`${l}[${b}]`,value:n[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return no({key:l,value:n})}function tp(i){return!!i&&i.constructor===Object}function Hd(i){return tp(i.value)?[]:[new Zt(i.key,i.value,`object expected, ${bi(i.value)} found`)]}const as={"*":()=>[],array:eh,boolean:function(i){const e=i.value,n=i.key,l=bi(e);return l!=="boolean"?[new Zt(n,e,`boolean expected, ${l} found`)]:[]},number:ul,color:Fl,constants:to,enum:jl,filter:yo,function:hl,layer:Xh,object:za,source:Vl,light:ps,sky:th,terrain:Wh,projection:function(i){const e=i.value,n=i.styleSpec,l=n.projection,p=i.style,_=bi(e);if(e===void 0)return[];if(_!=="object")return[new Zt("projection",e,`object expected, ${_} found`)];let b=[];for(const A in e)b=b.concat(l[A]?i.validateSpec({key:A,value:e[A],valueSpec:l[A],style:p,styleSpec:n}):[new Zt(A,e[A],`unknown property "${A}"`)]);return b},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const l=bi(n);return l!=="array"||(function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"})(n)||(function(p){return!!["interpolate","step","literal"].includes(p[0])})(n)?["array","string"].includes(l)?[]:[new Zt(e,n,`projection expected, invalid type "${l}" found`)]:[new Zt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:no,formatted:function(i){return no(i).length===0?[]:dl(i)},resolvedImage:function(i){return no(i).length===0?[]:dl(i)},padding:function(i){const e=i.key,n=i.value;if(bi(n)==="array"){if(n.length<1||n.length>4)return[new Zt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let p=[];for(let _=0;_<n.length;_++)p=p.concat(i.validateSpec({key:`${e}[${_}]`,value:n[_],validateSpec:i.validateSpec,valueSpec:l}));return p}return ul({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(bi(n)==="array"){const l={type:"number"};if(n.length<1)return[new Zt(e,n,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<n.length;_++)p=p.concat(i.validateSpec({key:`${e}[${_}]`,value:n[_],validateSpec:i.validateSpec,valueSpec:l}));return p}return ul({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(bi(n)==="array"){if(n.length<1)return[new Zt(e,n,"array length at least 1 expected, length 0 found")];let l=[];for(let p=0;p<n.length;p++)l=l.concat(Fl({key:`${e}[${p}]`,value:n[p]}));return l}return Fl({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,l=bi(n),p=i.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new Zt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let b=0;b<n.length;b+=2)_=_.concat(jl({key:`${e}[${b}]`,value:n[b],valueSpec:p.layout_symbol["text-anchor"]})),_=_.concat(eh({key:`${e}[${b+1}]`,value:n[b+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:p}));return _},sprite:Gd,state:Hd,fontFaces:function(i){const e=i.key,n=i.value,l=i.validateSpec,p=i.styleSpec,_=i.style;if(!tp(n))return[new Zt(e,n,`object expected, ${bi(n)} found`)];const b=[];for(const A in n){const D=n[A],B=bi(D);if(B==="string")b.push(...no({key:`${e}.${A}`,value:D}));else if(B==="array"){const G={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[X,Y]of D.entries())b.push(...za({key:`${e}.${A}[${X}]`,value:Y,valueSpec:G,styleSpec:p,style:_,validateSpec:l}))}else b.push(new Zt(`${e}.${A}`,D,`string or array expected, ${B} found`))}return b}};function ml(i){const e=i.value,n=i.valueSpec,l=i.styleSpec;return i.validateSpec=ml,n.expression&&Vh(Xr(e))?hl(i):n.expression&&uc(Oa(e))?dl(i):n.type&&as[n.type]?as[n.type](i):za(xi({},i,{valueSpec:n.type?l[n.type]:n}))}function yu(i){const e=i.value,n=i.key,l=no(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Zt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Zt(n,e,'"glyphs" url must include a "{range}" token'))),l}function ya(i,e=Ke){let n=[];return n=n.concat(ml({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:ml,objectElementValidators:{glyphs:yu,"*":()=>[]}})),i.constants&&(n=n.concat(to({key:"constants",value:i.constants}))),zc(n)}function io(i){return function(e){return i(Object.assign({},e,{validateSpec:ml}))}}function zc(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function xa(i){return function(...e){return zc(i.apply(this,e))}}ya.source=xa(io(Vl)),ya.sprite=xa(io(Gd)),ya.glyphs=xa(io(yu)),ya.light=xa(io(ps)),ya.sky=xa(io(th)),ya.terrain=xa(io(Wh)),ya.state=xa(io(Hd)),ya.layer=xa(io(Xh)),ya.filter=xa(io(yo)),ya.paintProperty=xa(io(pl)),ya.layoutProperty=xa(io(Zh));const y0={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class xu{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=pu(e,y0,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=Os(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const nh=Ke,zs=ya,Po=zs.light,Yh=zs.sky,$h=zs.paintProperty,np=zs.layoutProperty;function Oo(i,e){let n=!1;if(e&&e.length)for(const l of e)i.fire(new Ot(new Error(l.message))),n=!0;return n}class pc{constructor(e,n,l){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const b=new Int32Array(this.arrayBuffer);e=b[0],this.d=(n=b[1])+2*(l=b[2]);for(let D=0;D<this.d*this.d;D++){const B=b[3+D],G=b[3+D+1];p.push(B===G?null:b.subarray(B,G))}const A=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],A),this.bboxes=b.subarray(A),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=l,this.scale=n/e,this.uid=0;const _=l/n*e;this.min=-_,this.max=e+_}insert(e,n,l,p,_){this._forEachCell(n,l,p,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,l,p,_,b){this.cells[_].push(b)}query(e,n,l,p,_){const b=this.min,A=this.max;if(e<=b&&n<=b&&A<=l&&A<=p&&!_)return Array.prototype.slice.call(this.keys);{const D=[];return this._forEachCell(e,n,l,p,this._queryCell,D,{},_),D}}_queryCell(e,n,l,p,_,b,A,D){const B=this.cells[_];if(B!==null){const G=this.keys,X=this.bboxes;for(let Y=0;Y<B.length;Y++){const Q=B[Y];if(A[Q]===void 0){const ie=4*Q;(D?D(X[ie+0],X[ie+1],X[ie+2],X[ie+3]):e<=X[ie+2]&&n<=X[ie+3]&&l>=X[ie+0]&&p>=X[ie+1])?(A[Q]=!0,b.push(G[Q])):A[Q]=!1}}}}_forEachCell(e,n,l,p,_,b,A,D){const B=this._convertToCellCoord(e),G=this._convertToCellCoord(n),X=this._convertToCellCoord(l),Y=this._convertToCellCoord(p);for(let Q=B;Q<=X;Q++)for(let ie=G;ie<=Y;ie++){const re=this.d*ie+Q;if((!D||D(this._convertFromCellCoord(Q),this._convertFromCellCoord(ie),this._convertFromCellCoord(Q+1),this._convertFromCellCoord(ie+1)))&&_.call(this,e,n,l,p,re,b,A,D))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let l=0;for(let b=0;b<this.cells.length;b++)l+=this.cells[b].length;const p=new Int32Array(n+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let _=n;for(let b=0;b<e.length;b++){const A=e[b];p[3+b]=_,p.set(A,_),_+=A.length}return p[3+e.length]=_,p.set(this.keys,_),_+=this.keys.length,p[3+e.length+1]=_,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer}static serialize(e,n){const l=e.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(e){return new pc(e.buffer)}}const La={};function Cn(i,e,n={}){if(La[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),La[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Cn("Object",Object),Cn("Set",Set),Cn("TransferableGridIndex",pc),Cn("Color",ui),Cn("Error",Error),Cn("AJAXError",fe),Cn("ResolvedImage",ra),Cn("StylePropertyFunction",Pc),Cn("StyleExpression",qh,{omit:["_evaluator"]}),Cn("ZoomDependentExpression",hc),Cn("ZoomConstantExpression",Ca),Cn("CompoundExpression",As,{omit:["_evaluate"]});for(const i in Ka)Ka[i]._classRegistryKey||Cn(`Expression_${i}`,Ka[i]);function ih(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Kh(i){return i.$name||i.constructor._classRegistryKey}function xo(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=Kh(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ih(i)||Yt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function zo(i,e){if(xo(i))return(ih(i)||Yt(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const _=[];for(const b of i)_.push(zo(b,e));return _}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=Kh(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!La[n])throw new Error(`${n} is not registered.`);const{klass:l}=La[n],p=l.serialize?l.serialize(i,e):{};if(l.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||La[n].omit.indexOf(_)>=0)continue;const b=i[_];p[_]=La[n].shallow.indexOf(_)>=0?b:zo(b,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(p.$name=n),p}function _u(i){if(xo(i))return i;if(Array.isArray(i))return i.map(_u);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=Kh(i)||"Object";if(!La[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=La[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const l=Object.create(n.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const _=i[p];l[p]=La[e].shallow.indexOf(p)>=0?_:_u(_)}return l}class Qh{constructor(){this.first=!0}update(e,n){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function gl(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Lc(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function rh(i){return/\s/u.test(String.fromCodePoint(i))}function yl(i){for(const e of i)if(Lc(e.codePointAt(0)))return!0;return!1}function Jh(i){for(const e of i)if(!qd(e.codePointAt(0)))return!1;return!0}function sh(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const xl=sh(["Arab","Dupl","Mong","Ougr","Syrc"]);function qd(i){return!xl.test(String.fromCodePoint(i))}function _l(i){return!(Lc(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const ed=sh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ah(i){return ed.test(String.fromCodePoint(i))}function bl(i,e){return!(!e&&ah(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Gl(i){for(const e of i)if(ah(e.codePointAt(0)))return!0;return!1}const _o=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(_o.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,l=new Promise((_=>{this.loadScriptResolve=_}));e(n);const p=new Promise((_=>setTimeout((()=>_()),this.TIMEOUT)));if(yield Promise.race([l,p]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class cr{constructor(e,n){this.isSupportedScript=Zd,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new Qh,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}function Zd(i){return(function(e,n){for(const l of e)if(!bl(l.codePointAt(0),n))return!1;return!0})(i,_o.getRTLTextPluginStatus()==="loaded")}const Hl="-transition";class mc{constructor(e,n,l){this.property=e,this.value=n,this.expression=(function(p,_,b){if(Vh(p))return new Pc(p,_);if(uc(p)){const A=dc(p,_,b);if(A.result==="error")throw new Error(A.value.map((D=>`${D.key}: ${D.message}`)).join(", "));return A.value}{let A=p;return _.type==="color"&&typeof p=="string"?A=ui.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?_.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?A=Mi.parse(p):_.type==="projectionDefinition"&&typeof p=="string"&&(A=Kr.parse(p)):A=hn.parse(p):A=Gi.parse(p):A=yr.parse(p),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>A}}})(n===void 0?e.specification.default:n,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class oh{constructor(e,n){this.property=e,this.value=new mc(e,void 0,n)}transitioned(e,n){return new Bc(this.property,this.value,n,Tn({},e.transition,this.transition),e.now)}untransitioned(){return new Bc(this.property,this.value,null,{},0)}}class td{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return $n(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new oh(this._values[e].property,this._globalState)),this._values[e].value=new mc(this._values[e].property,n===null?void 0:$n(n),this._globalState)}getTransition(e){return $n(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new oh(this._values[e].property,this._globalState)),this._values[e].transition=$n(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const p=this.getTransition(n);p!==void 0&&(e[`${n}${Hl}`]=p)}return e}transitioned(e,n){const l=new lh(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(e,n._values[p]);return l}untransitioned(){const e=new lh(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Bc{constructor(e,n,l,p,_){this.property=e,this.value=n,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const p=e.now||0,_=this.value.possiblyEvaluate(e,n,l),b=this.prior;if(b){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return b.possiblyEvaluate(e,n,l);{const A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(e,n,l),_,It(A))}}return _}}class lh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const p=new Fc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,n,l);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Xd{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return $n(this._values[e].value)}setValue(e,n){this._values[e]=new mc(this._values[e].property,n===null?void 0:$n(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const p=new Fc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,n,l);return p}}class ro{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,p){return this.property.evaluate(this.value,this.parameters,e,n,l,p)}}class Fc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Dn{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,l){const p=xr[this.specification.type];return p?p(e,n,l):e}}class Ln{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,p){return new ro(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,p)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new ro(this,{kind:"constant",value:void 0},e.parameters);const p=xr[this.specification.type];if(p){const _=p(e.value.value,n.value.value,l);return new ro(this,{kind:"constant",value:_},e.parameters)}return e}evaluate(e,n,l,p,_,b){return e.kind==="constant"?e.value:e.evaluate(n,l,p,_,b)}}class bo extends Ln{possiblyEvaluate(e,n,l,p){if(e.value===void 0)return new ro(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const _=e.expression.evaluate(n,null,{},l,p),b=e.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,A=this._calculate(b,b,b,n);return new ro(this,{kind:"constant",value:A},n)}if(e.expression.kind==="camera"){const _=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new ro(this,{kind:"constant",value:_},n)}return new ro(this,e.expression,n)}evaluate(e,n,l,p,_,b){if(e.kind==="source"){const A=e.evaluate(n,l,p,_,b);return this._calculate(A,A,A,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},l,p),e.evaluate({zoom:Math.floor(n.zoom)},l,p),e.evaluate({zoom:Math.floor(n.zoom)+1},l,p),n):e.value}_calculate(e,n,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class bu{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const _=e.expression.evaluate(n,null,{},l,p);return this._calculate(_,_,_,n)}return this._calculate(e.expression.evaluate(new cr(Math.floor(n.zoom-1),n)),e.expression.evaluate(new cr(Math.floor(n.zoom),n)),e.expression.evaluate(new cr(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class ch{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,p){return!!e.expression.evaluate(n,null,{},l,p)}interpolate(){return!1}}class os{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const p=this.defaultPropertyValues[n]=new mc(l,void 0,void 0),_=this.defaultTransitionablePropertyValues[n]=new oh(l,void 0);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=p.possiblyEvaluate({})}}}Cn("DataDrivenProperty",Ln),Cn("DataConstantProperty",Dn),Cn("CrossFadedDataDrivenProperty",bo),Cn("CrossFadedProperty",bu),Cn("ColorRampProperty",ch);class Wr extends cn{constructor(e,n,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(p,_){return new xu(p,_)})(this.visibility,l),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Pa(e.filter,l)),n.layout&&(this._unevaluatedLayout=new Xd(n.layout,l)),n.paint)){this._transitionablePaint=new td(n.paint,l);for(const p in e.paint)this.setPaintProperty(p,e.paint[p],{validate:!1});for(const p in e.layout)this.setLayoutProperty(p,e.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fc(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=Pa(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const p of l.getGlobalStateRefs())e.add(p)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const p=this._transitionablePaint._values[l].value;for(const _ of p.getGlobalStateRefs()){const b=(e=n.get(_))!==null&&e!==void 0?e:[];b.push({name:l,value:p.value}),n.set(_,b)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,l={}){if(n==null||!this._validate(np,`layers.${this.id}.layout.${e}`,e,n,l))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith(Hl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,l={}){if(n!=null&&this._validate($h,`layers.${this.id}.paint.${e}`,e,n,l))return!1;if(e.endsWith(Hl))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const p=this._transitionablePaint._values[e],_=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),A=p.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const D=this._transitionablePaint._values[e].value;return D.isDataDriven()||b||_||this._handleOverridablePaintPropertyUpdate(e,A,D)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),_i(e,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}_validate(e,n,l,p,_={}){return(!_||_.validate!==!1)&&Oo(this,e.call(zs,{key:n,layerType:this.type,objectKey:l,value:p,styleSpec:Ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ro&&go(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Jr;var uh={get paint(){return Jr=Jr||new os({"raster-opacity":new Dn(Ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new Dn(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dn(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dn(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Dn(Ke.paint_raster["raster-saturation"]),"raster-contrast":new Dn(Ke.paint_raster["raster-contrast"]),"raster-resampling":new Dn(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Dn(Ke.paint_raster["raster-fade-duration"])})}};class ql extends Wr{constructor(e,n){super(e,uh,n)}}const Ii={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class sr{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gr(i,e=1){let n=0,l=0;return{members:i.map((p=>{const _=Ii[p.type].BYTES_PER_ELEMENT,b=n=vo(n,Math.max(e,_)),A=p.components||1;return l=Math.max(l,_),n+=_*A,{name:p.name,type:p.type,components:A,offset:b}})),size:vo(n,Math.max(l,e)),alignment:e}}function vo(i,e){return Math.ceil(i/e)*e}class Lo extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.int16[p+0]=n,this.int16[p+1]=l,e}}Lo.prototype.bytesPerElement=4,Cn("StructArrayLayout2i4",Lo);class jc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.int16[_+0]=n,this.int16[_+1]=l,this.int16[_+2]=p,e}}jc.prototype.bytesPerElement=6,Cn("StructArrayLayout3i6",jc);class Uc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,p)}emplace(e,n,l,p,_){const b=4*e;return this.int16[b+0]=n,this.int16[b+1]=l,this.int16[b+2]=p,this.int16[b+3]=_,e}}Uc.prototype.bytesPerElement=8,Cn("StructArrayLayout4i8",Uc);class Zl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,A){const D=6*e;return this.int16[D+0]=n,this.int16[D+1]=l,this.int16[D+2]=p,this.int16[D+3]=_,this.int16[D+4]=b,this.int16[D+5]=A,e}}Zl.prototype.bytesPerElement=12,Cn("StructArrayLayout2i4i12",Zl);class Wd extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,A){const D=4*e,B=8*e;return this.int16[D+0]=n,this.int16[D+1]=l,this.uint8[B+4]=p,this.uint8[B+5]=_,this.uint8[B+6]=b,this.uint8[B+7]=A,e}}Wd.prototype.bytesPerElement=8,Cn("StructArrayLayout2i4ub8",Wd);class Br extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.float32[p+0]=n,this.float32[p+1]=l,e}}Br.prototype.bytesPerElement=8,Cn("StructArrayLayout2f8",Br);class Bo extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,A,D,B,G){const X=this.length;return this.resize(X+1),this.emplace(X,e,n,l,p,_,b,A,D,B,G)}emplace(e,n,l,p,_,b,A,D,B,G,X){const Y=10*e;return this.uint16[Y+0]=n,this.uint16[Y+1]=l,this.uint16[Y+2]=p,this.uint16[Y+3]=_,this.uint16[Y+4]=b,this.uint16[Y+5]=A,this.uint16[Y+6]=D,this.uint16[Y+7]=B,this.uint16[Y+8]=G,this.uint16[Y+9]=X,e}}Bo.prototype.bytesPerElement=20,Cn("StructArrayLayout10ui20",Bo);class vu extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,A,D){const B=this.length;return this.resize(B+1),this.emplace(B,e,n,l,p,_,b,A,D)}emplace(e,n,l,p,_,b,A,D,B){const G=8*e;return this.uint16[G+0]=n,this.uint16[G+1]=l,this.uint16[G+2]=p,this.uint16[G+3]=_,this.uint16[G+4]=b,this.uint16[G+5]=A,this.uint16[G+6]=D,this.uint16[G+7]=B,e}}vu.prototype.bytesPerElement=16,Cn("StructArrayLayout8ui16",vu);class wu extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,A,D,B,G,X,Y){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,n,l,p,_,b,A,D,B,G,X,Y)}emplace(e,n,l,p,_,b,A,D,B,G,X,Y,Q){const ie=12*e;return this.int16[ie+0]=n,this.int16[ie+1]=l,this.int16[ie+2]=p,this.int16[ie+3]=_,this.uint16[ie+4]=b,this.uint16[ie+5]=A,this.uint16[ie+6]=D,this.uint16[ie+7]=B,this.int16[ie+8]=G,this.int16[ie+9]=X,this.int16[ie+10]=Y,this.int16[ie+11]=Q,e}}wu.prototype.bytesPerElement=24,Cn("StructArrayLayout4i4ui4i24",wu);class hh extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.float32[_+0]=n,this.float32[_+1]=l,this.float32[_+2]=p,e}}hh.prototype.bytesPerElement=12,Cn("StructArrayLayout3f12",hh);class dh extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}dh.prototype.bytesPerElement=4,Cn("StructArrayLayout1ul4",dh);class fh extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,A,D,B){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,l,p,_,b,A,D,B)}emplace(e,n,l,p,_,b,A,D,B,G){const X=10*e,Y=5*e;return this.int16[X+0]=n,this.int16[X+1]=l,this.int16[X+2]=p,this.int16[X+3]=_,this.int16[X+4]=b,this.int16[X+5]=A,this.uint32[Y+3]=D,this.uint16[X+8]=B,this.uint16[X+9]=G,e}}fh.prototype.bytesPerElement=20,Cn("StructArrayLayout6i1ul2ui20",fh);class gc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,A){const D=6*e;return this.int16[D+0]=n,this.int16[D+1]=l,this.int16[D+2]=p,this.int16[D+3]=_,this.int16[D+4]=b,this.int16[D+5]=A,e}}gc.prototype.bytesPerElement=12,Cn("StructArrayLayout2i2i2i12",gc);class Xl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,p,_)}emplace(e,n,l,p,_,b){const A=4*e,D=8*e;return this.float32[A+0]=n,this.float32[A+1]=l,this.float32[A+2]=p,this.int16[D+6]=_,this.int16[D+7]=b,e}}Xl.prototype.bytesPerElement=16,Cn("StructArrayLayout2f1f2i16",Xl);class oa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,A){const D=16*e,B=4*e,G=8*e;return this.uint8[D+0]=n,this.uint8[D+1]=l,this.float32[B+1]=p,this.float32[B+2]=_,this.int16[G+6]=b,this.int16[G+7]=A,e}}oa.prototype.bytesPerElement=16,Cn("StructArrayLayout2ub2f2i16",oa);class Hr extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=l,this.uint16[_+2]=p,e}}Hr.prototype.bytesPerElement=6,Cn("StructArrayLayout3ui6",Hr);class vl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie,re,ae,me){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie,re,ae,me)}emplace(e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie,re,ae,me,Fe){const _e=24*e,we=12*e,Ge=48*e;return this.int16[_e+0]=n,this.int16[_e+1]=l,this.uint16[_e+2]=p,this.uint16[_e+3]=_,this.uint32[we+2]=b,this.uint32[we+3]=A,this.uint32[we+4]=D,this.uint16[_e+10]=B,this.uint16[_e+11]=G,this.uint16[_e+12]=X,this.float32[we+7]=Y,this.float32[we+8]=Q,this.uint8[Ge+36]=ie,this.uint8[Ge+37]=re,this.uint8[Ge+38]=ae,this.uint32[we+10]=me,this.int16[_e+22]=Fe,e}}vl.prototype.bytesPerElement=48,Cn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vl);class Vc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie,re,ae,me,Fe,_e,we,Ge,Ye,St,Wt,Vt,en,Sn,sn){const Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie,re,ae,me,Fe,_e,we,Ge,Ye,St,Wt,Vt,en,Sn,sn)}emplace(e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie,re,ae,me,Fe,_e,we,Ge,Ye,St,Wt,Vt,en,Sn,sn,Ht){const kt=32*e,Nn=16*e;return this.int16[kt+0]=n,this.int16[kt+1]=l,this.int16[kt+2]=p,this.int16[kt+3]=_,this.int16[kt+4]=b,this.int16[kt+5]=A,this.int16[kt+6]=D,this.int16[kt+7]=B,this.uint16[kt+8]=G,this.uint16[kt+9]=X,this.uint16[kt+10]=Y,this.uint16[kt+11]=Q,this.uint16[kt+12]=ie,this.uint16[kt+13]=re,this.uint16[kt+14]=ae,this.uint16[kt+15]=me,this.uint16[kt+16]=Fe,this.uint16[kt+17]=_e,this.uint16[kt+18]=we,this.uint16[kt+19]=Ge,this.uint16[kt+20]=Ye,this.uint16[kt+21]=St,this.uint16[kt+22]=Wt,this.uint32[Nn+12]=Vt,this.float32[Nn+13]=en,this.float32[Nn+14]=Sn,this.uint16[kt+30]=sn,this.uint16[kt+31]=Ht,e}}Vc.prototype.bytesPerElement=64,Cn("StructArrayLayout8i15ui1ul2f2ui64",Vc);class Gc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Gc.prototype.bytesPerElement=4,Cn("StructArrayLayout1f4",Gc);class Eu extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.uint16[6*e+0]=n,this.float32[_+1]=l,this.float32[_+2]=p,e}}Eu.prototype.bytesPerElement=12,Cn("StructArrayLayout1ui2f12",Eu);class Fo extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=4*e;return this.uint32[2*e+0]=n,this.uint16[_+2]=l,this.uint16[_+3]=p,e}}Fo.prototype.bytesPerElement=8,Cn("StructArrayLayout1ul2ui8",Fo);class E extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.uint16[p+0]=n,this.uint16[p+1]=l,e}}E.prototype.bytesPerElement=4,Cn("StructArrayLayout2ui4",E);class t extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,Cn("StructArrayLayout1ui2",t);class s extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,p)}emplace(e,n,l,p,_){const b=4*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=p,this.float32[b+3]=_,e}}s.prototype.bytesPerElement=16,Cn("StructArrayLayout4f16",s);class d extends sr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new V(this.anchorPointX,this.anchorPointY)}}d.prototype.size=20;class x extends fh{get(e){return new d(this,e)}}Cn("CollisionBoxArray",x);class T extends sr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}T.prototype.size=48;class M extends vl{get(e){return new T(this,e)}}Cn("PlacedSymbolArray",M);class z extends sr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}z.prototype.size=64;class j extends Vc{get(e){return new z(this,e)}}Cn("SymbolInstanceArray",j);class Z extends Gc{getoffsetX(e){return this.float32[1*e+0]}}Cn("GlyphOffsetArray",Z);class W extends jc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Cn("SymbolLineVertexArray",W);class ee extends sr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class J extends Eu{get(e){return new ee(this,e)}}Cn("TextAnchorOffsetArray",J);class se extends sr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}se.prototype.size=8;class pe extends Fo{get(e){return new se(this,e)}}Cn("FeatureIndexArray",pe);class Ae extends Lo{}class Ne extends Lo{}class Re extends Lo{}class Be extends Zl{}class We extends Wd{}class Le extends Br{}class Ze extends Bo{}class et extends vu{}class Ve extends wu{}class ut extends hh{}class Mt extends dh{}class Et extends gc{}class At extends oa{}class Ct extends Hr{}class dn extends E{}const mn=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qt}=mn;class En{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,l,p){const _=this.segments[this.segments.length-1];return e>En.MAX_VERTEX_ARRAY_LENGTH&&Qn(`Max vertices per segment is ${En.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${En.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+e>En.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p?this.createNewSegment(n,l,p):_}createNewSegment(e,n,l){const p={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(p.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(e,n,l){return this.prepareSegment(0,e,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,p){return new En([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function mi(i,e){return 256*(i=Bt(Math.floor(i),0,255))+Bt(Math.floor(e),0,255)}En.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Cn("SegmentVector",En);const ar=Gr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ir=Gr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var br,Fr,fr,Yr={exports:{}},jr={exports:{}},Hs={exports:{}},es=(function(){if(fr)return Yr.exports;fr=1;var i=(br||(br=1,jr.exports=function(n,l){var p,_,b,A,D,B,G,X;for(_=n.length-(p=3&n.length),b=l,D=3432918353,B=461845907,X=0;X<_;)G=255&n.charCodeAt(X)|(255&n.charCodeAt(++X))<<8|(255&n.charCodeAt(++X))<<16|(255&n.charCodeAt(++X))<<24,++X,b=27492+(65535&(A=5*(65535&(b=(b^=G=(65535&(G=(G=(65535&G)*D+(((G>>>16)*D&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(G=0,p){case 3:G^=(255&n.charCodeAt(X+2))<<16;case 2:G^=(255&n.charCodeAt(X+1))<<8;case 1:b^=G=(65535&(G=(G=(65535&(G^=255&n.charCodeAt(X)))*D+(((G>>>16)*D&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295}return b^=n.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),jr.exports),e=(Fr||(Fr=1,Hs.exports=function(n,l){for(var p,_=n.length,b=l^_,A=0;_>=4;)p=1540483477*(65535&(p=255&n.charCodeAt(A)|(255&n.charCodeAt(++A))<<8|(255&n.charCodeAt(++A))<<16|(255&n.charCodeAt(++A))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++A;switch(_){case 3:b^=(255&n.charCodeAt(A+2))<<16;case 2:b^=(255&n.charCodeAt(A+1))<<8;case 1:b=1540483477*(65535&(b^=255&n.charCodeAt(A)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),Hs.exports);return Yr.exports=i,Yr.exports.murmur3=i,Yr.exports.murmur2=e,Yr.exports})(),ts=H(es);class qs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,l,p){this.ids.push(wl(e)),this.positions.push(n,l,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=wl(e);let l=0,p=this.ids.length-1;for(;l<p;){const b=l+p>>1;this.ids[b]>=n?p=b:l=b+1}const _=[];for(;this.ids[l]===n;)_.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return _}static serialize(e,n){const l=new Float64Array(e.ids),p=new Uint32Array(e.positions);return El(l,p,0,l.length-1),n&&n.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(e){const n=new qs;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function wl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:ts(String(i))}function El(i,e,n,l){for(;n<l;){const p=i[n+l>>1];let _=n-1,b=l+1;for(;;){do _++;while(i[_]<p);do b--;while(i[b]>p);if(_>=b)break;jo(i,_,b),jo(e,3*_,3*b),jo(e,3*_+1,3*b+1),jo(e,3*_+2,3*b+2)}b-n<l-b?(El(i,e,n,b),n=b+1):(El(i,e,b+1,l),l=b)}}function jo(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}Cn("FeaturePositionMap",qs);class Ba{constructor(e,n){this.gl=e.gl,this.location=n}}class Hc extends Ba{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Su extends Ba{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Uo extends Ba{constructor(e,n){super(e,n),this.current=ui.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Fa=new Float32Array(16);function so(i){return[mi(255*i.r,255*i.g),mi(255*i.b,255*i.a)]}class wo{constructor(e,n,l){this.value=e,this.uniformNames=n.map((p=>`u_${p}`)),this.type=l}setUniform(e,n,l){e.set(l.constantOr(this.value))}getBinding(e,n,l){return this.type==="color"?new Uo(e,n):new Hc(e,n)}}class Eo{constructor(e,n){this.uniformNames=n.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,l,p){let _=null;p==="u_pattern_to"?_=this.patternTo:p==="u_pattern_from"?_=this.patternFrom:p==="u_dasharray_to"?_=this.dashTo:p==="u_dasharray_from"?_=this.dashFrom:p==="u_pixel_ratio_to"?_=this.pixelRatioTo:p==="u_pixel_ratio_from"&&(_=this.pixelRatioFrom),_!==null&&e.set(_)}getBinding(e,n,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Su(e,n):new Hc(e,n)}}class ur{constructor(e,n,l,p){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((_=>({name:`a_${_}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,n,l){const p=this.paintVertexArray.length,_=this.expression.evaluate(new cr(0,l),n,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(p,e,_)}updatePaintArray(e,n,l,p,_){const b=this.expression.evaluate(new cr(0,_),l,p);this._setPaintValue(e,n,b)}_setPaintValue(e,n,l){if(this.type==="color"){const p=so(l);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vr{constructor(e,n,l,p,_,b){this.expression=e,this.uniformNames=n.map((A=>`u_${A}_t`)),this.type=l,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map((A=>({name:`a_${A}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(e,n,l){const p=this.expression.evaluate(new cr(this.zoom,l),n,{},l.canonical,[],l.formattedSection),_=this.expression.evaluate(new cr(this.zoom+1,l),n,{},l.canonical,[],l.formattedSection),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,p,_)}updatePaintArray(e,n,l,p,_){const b=this.expression.evaluate(new cr(this.zoom,_),l,p),A=this.expression.evaluate(new cr(this.zoom+1,_),l,p);this._setPaintValue(e,n,b,A)}_setPaintValue(e,n,l,p){if(this.type==="color"){const _=so(l),b=so(p);for(let A=e;A<n;A++)this.paintVertexArray.emplace(A,_[0],_[1],b[0],b[1])}else{for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,p=Bt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,n,l){return new Hc(e,n)}}class ms{constructor(e,n,l,p,_,b){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,n,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,this.getPositionIds(n),l)}updatePaintArray(e,n,l,p,_){this._setPaintValues(e,n,this.getPositionIds(l),_)}_setPaintValues(e,n,l,p){const _=this.getPositions(p);if(!_||!l)return;const b=_[l.min],A=_[l.mid],D=_[l.max];if(b&&A&&D)for(let B=e;B<n;B++)this.emplace(this.zoomInPaintVertexArray,B,A,b),this.emplace(this.zoomOutPaintVertexArray,B,A,D)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Cs extends ms{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return ar.members}emplace(e,n,l,p){e.emplace(n,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],l.pixelRatio,p.pixelRatio)}}class nd extends ms{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Ir.members}emplace(e,n,l,p){e.emplace(n,0,l.y,l.height,l.width,0,p.y,p.height,p.width)}}class id{constructor(e,n,l){this.binders={},this._buffers=[];const p=[];for(const _ in e.paint._values){if(!l(_))continue;const b=e.paint.get(_);if(!(b instanceof ro&&go(b.property.specification)))continue;const A=ip(_,e.type),D=b.value,B=b.property.specification.type,G=b.property.useIntegerZoom,X=b.property.specification["property-type"],Y=X==="cross-faded"||X==="cross-faded-data-driven";if(D.kind==="constant")this.binders[_]=Y?new Eo(D.value,A):new wo(D.value,A,B),p.push(`/u_${_}`);else if(D.kind==="source"||Y){const Q=xc(_,B,"source");this.binders[_]=Y?_==="line-dasharray"?new nd(D,B,G,n,Q,e.id):new Cs(D,B,G,n,Q,e.id):new ur(D,A,B,Q),p.push(`/a_${_}`)}else{const Q=xc(_,B,"composite");this.binders[_]=new vr(D,A,B,G,n,Q),p.push(`/z_${_}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ur||n instanceof vr?n.maxValue:0}populatePaintArrays(e,n,l){for(const p in this.binders){const _=this.binders[p];(_ instanceof ur||_ instanceof vr||_ instanceof ms)&&_.populatePaintArray(e,n,l)}}setConstantPatternPositions(e,n){for(const l in this.binders){const p=this.binders[l];p instanceof Eo&&p.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const l in this.binders){const p=this.binders[l];p instanceof Eo&&p.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,l,p,_){let b=!1;for(const A in e){const D=n.getPositions(A);for(const B of D){const G=l.feature(B.index);for(const X in this.binders){const Y=this.binders[X];if((Y instanceof ur||Y instanceof vr||Y instanceof ms)&&Y.expression.isStateDependent===!0){const Q=p.paint.get(X);Y.expression=Q.value,Y.updatePaintArray(B.start,B.end,G,e[A],_),b=!0}}}}return b}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof wo||l instanceof Eo)&&e.push(...l.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof ur||l instanceof vr)for(let p=0;p<l.paintVertexAttributes.length;p++)e.push(l.paintVertexAttributes[p].name);else if(l instanceof ms){const p=l.getVertexAttributes();for(const _ of p)e.push(_.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof wo||l instanceof Eo||l instanceof vr)for(const p of l.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const l=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof wo||_ instanceof Eo||_ instanceof vr){for(const b of _.uniformNames)if(n[b]){const A=_.getBinding(e,n[b],b);l.push({name:b,property:p,binding:A})}}}return l}setUniforms(e,n,l,p){for(const{name:_,property:b,binding:A}of n)this.binders[b].setUniform(A,p,l.get(b),_)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(e&&l instanceof ms){const p=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof ur||l instanceof vr)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof ur||l instanceof vr||l instanceof ms)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ur||n instanceof vr||n instanceof ms)&&n.destroy()}}}class yc{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new id(p,n,l);this.needsUpload=!1,this._featureMap=new qs,this._bufferOffset=0}populatePaintArrays(e,n,l,p){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,n,p);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,p){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,n,_,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ip(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function xc(i,e,n){const l={color:{source:Br,composite:s},number:{source:Gc,composite:Br}},p=(function(_){return{"line-pattern":{source:Ze,composite:Ze},"fill-pattern":{source:Ze,composite:Ze},"fill-extrusion-pattern":{source:Ze,composite:Ze},"line-dasharray":{source:et,composite:et}}[_]})(i);return p&&p[n]||l[e][n]}Cn("ConstantBinder",wo),Cn("CrossFadedConstantBinder",Eo),Cn("SourceExpressionBinder",ur),Cn("CrossFadedPatternBinder",Cs),Cn("CrossFadedDasharrayBinder",nd),Cn("CompositeExpressionBinder",vr),Cn("ProgramConfiguration",id,{omit:["_buffers"]}),Cn("ProgramConfigurationSet",yc);const rd=Math.pow(2,14)-1,Wl=-rd-1;function Yl(i){const e=mt/i.extent,n=i.loadGeometry();for(let l=0;l<n.length;l++){const p=n[l];for(let _=0;_<p.length;_++){const b=p[_],A=Math.round(b.x*e),D=Math.round(b.y*e);b.x=Bt(A,Wl,rd),b.y=Bt(D,Wl,rd),(A<b.x||A>b.x+1||D<b.y||D>b.y+1)&&Qn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Vo(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Yl(i):[]}}const sd=-32768;function ph(i,e,n,l,p){i.emplaceBack(sd+8*e+l,sd+8*n+p)}class mh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Ne,this.indexArray=new Ct,this.segments=new En,this.programConfigurations=new yc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){const p=this.layers[0],_=[];let b=null,A=!1,D=p.type==="heatmap";if(p.type==="circle"){const G=p;b=G.layout.get("circle-sort-key"),A=!b.isConstant(),D=D||G.paint.get("circle-pitch-alignment")==="map"}const B=D?n.subdivisionGranularity.circle:1;for(const{feature:G,id:X,index:Y,sourceLayerIndex:Q}of e){const ie=this.layers[0]._featureFilter.needGeometry,re=Vo(G,ie);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),re,l))continue;const ae=A?b.evaluate(re,{},l):void 0,me={id:X,properties:G.properties,type:G.type,sourceLayerIndex:Q,index:Y,geometry:ie?re.geometry:Yl(G),patterns:{},sortKey:ae};_.push(me)}A&&_.sort(((G,X)=>G.sortKey-X.sortKey));for(const G of _){const{geometry:X,index:Y,sourceLayerIndex:Q}=G,ie=e[Y].feature;this.addFeature(G,X,Y,l,B),n.featureIndex.insert(ie,X,Y,Q,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,p,_=1){let b;switch(_){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const A=b.length;for(const D of n)for(const B of D){const G=B.x,X=B.y;if(G<0||G>=mt||X<0||X>=mt)continue;const Y=this.segments.prepareSegment(A*A,this.layoutVertexArray,this.indexArray,e.sortKey),Q=Y.vertexLength;for(let ie=0;ie<A;ie++)for(let re=0;re<A;re++)ph(this.layoutVertexArray,G,X,b[re],b[ie]);for(let ie=0;ie<A-1;ie++)for(let re=0;re<A-1;re++){const ae=Q+ie*A+re,me=Q+(ie+1)*A+re;this.indexArray.emplaceBack(ae,me+1,ae+1),this.indexArray.emplaceBack(ae,me,me+1)}Y.vertexLength+=A*A,Y.primitiveLength+=(A-1)*(A-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:p})}}function gh(i,e){for(let n=0;n<i.length;n++)if(_c(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(_c(i,e[n]))return!0;return!!la(i,e)}function rp(i,e,n){return!!_c(i,e)||!!ap(e,i,n)}function sp(i,e){if(i.length===1)return _0(e,i[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let p=0;p<l.length;p++)if(_c(i,l[p]))return!0}for(let n=0;n<i.length;n++)if(_0(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(la(i,e[n]))return!0;return!1}function Zs(i,e,n){if(i.length>1){if(la(i,e))return!0;for(let l=0;l<e.length;l++)if(ap(e[l],i,n))return!0}for(let l=0;l<i.length;l++)if(ap(i[l],e,n))return!0;return!1}function la(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const l=i[n],p=i[n+1];for(let _=0;_<e.length-1;_++)if(km(l,p,e[_],e[_+1]))return!0}return!1}function km(i,e,n,l){return ti(i,n,l)!==ti(e,n,l)&&ti(i,e,n)!==ti(i,e,l)}function ap(i,e,n){const l=n*n;if(e.length===1)return i.distSqr(e[0])<l;for(let p=1;p<e.length;p++)if(x0(i,e[p-1],e[p])<l)return!0;return!1}function x0(i,e,n){const l=e.distSqr(n);if(l===0)return i.distSqr(e);const p=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/l;return i.distSqr(p<0?e:p>1?n:n.sub(e)._mult(p)._add(e))}function _0(i,e){let n,l,p,_=!1;for(let b=0;b<i.length;b++){n=i[b];for(let A=0,D=n.length-1;A<n.length;D=A++)l=n[A],p=n[D],l.y>e.y!=p.y>e.y&&e.x<(p.x-l.x)*(e.y-l.y)/(p.y-l.y)+l.x&&(_=!_)}return _}function _c(i,e){let n=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const _=i[l],b=i[p];_.y>e.y!=b.y>e.y&&e.x<(b.x-_.x)*(e.y-_.y)/(b.y-_.y)+_.x&&(n=!n)}return n}function Pm(i,e,n){const l=n[0],p=n[2];if(i.x<l.x&&e.x<l.x||i.x>p.x&&e.x>p.x||i.y<l.y&&e.y<l.y||i.y>p.y&&e.y>p.y)return!1;const _=ti(i,e,n[0]);return _!==ti(i,e,n[1])||_!==ti(i,e,n[2])||_!==ti(i,e,n[3])}function qc(i,e,n){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Yd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function op(i,e,n,l,p){if(!e[0]&&!e[1])return i;const _=V.convert(e)._mult(p);n==="viewport"&&_._rotate(-l);const b=[];for(let A=0;A<i.length;A++)b.push(i[A].sub(_));return b}function lp(i){const e=[];for(let n=0;n<i.length;n++){const l=i[n],p=e.at(-1);(n===0||p&&!l.equals(p))&&e.push(l)}return e}function b0({queryGeometry:i,size:e},n){return rp(i,n,e)}function Om({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){return rp(i,_,e*(n.projectTileCoordinates(_.x,_.y,l,p).signedDistanceFromCamera/n.cameraToCenterDistance))}function zm({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){const b=n.projectTileCoordinates(_.x,_.y,l,p).signedDistanceFromCamera,A=e*(n.cameraToCenterDistance/b);return rp(i,$d(_,n,l,p),A)}function Lm({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){return rp(i,$d(_,n,l,p),e)}function cp({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p,pitchAlignment:_="map",pitchScale:b="map"},A){const D=_==="map"?b==="map"?b0:Om:b==="map"?zm:Lm,B={queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p};for(const G of A)for(const X of G)if(D(B,X))return!0;return!1}function $d(i,e,n,l){const p=e.projectTileCoordinates(i.x,i.y,n,l).point;return new V((.5*p.x+.5)*e.width,(.5*-p.y+.5)*e.height)}let up,v0;Cn("CircleBucket",mh,{omit:["layers"]});var w0={get paint(){return v0=v0||new os({"circle-radius":new Ln(Ke.paint_circle["circle-radius"]),"circle-color":new Ln(Ke.paint_circle["circle-color"]),"circle-blur":new Ln(Ke.paint_circle["circle-blur"]),"circle-opacity":new Ln(Ke.paint_circle["circle-opacity"]),"circle-translate":new Dn(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Dn(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dn(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dn(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ln(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ln(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ln(Ke.paint_circle["circle-stroke-opacity"])})},get layout(){return up=up||new os({"circle-sort-key":new Ln(Ke.layout_circle["circle-sort-key"])})}};class hp extends Wr{constructor(e,n){super(e,w0,n)}createBucket(e){return new mh(e)}queryRadius(e){const n=e;return qc("circle-radius",this,n)+qc("circle-stroke-width",this,n)+Yd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,unwrappedTileID:A,getElevation:D}){const B=op(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,b),G=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),X=this.paint.get("circle-pitch-scale"),Y=this.paint.get("circle-pitch-alignment");let Q,ie;return Y==="map"?(Q=B,ie=G*b):(Q=(function(re,ae,me,Fe){return re.map((_e=>$d(_e,ae,me,Fe)))})(B,_,A,D),ie=G),cp({queryGeometry:Q,size:ie,transform:_,unwrappedTileID:A,getElevation:D,pitchAlignment:Y,pitchScale:X},p)}}class dp extends mh{}let E0;Cn("HeatmapBucket",dp,{omit:["layers"]});var S0={get paint(){return E0=E0||new os({"heatmap-radius":new Ln(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ln(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dn(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ch(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dn(Ke.paint_heatmap["heatmap-opacity"])})}};function fp(i,{width:e,height:n},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*n*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*n*l}`)}else p=new Uint8Array(e*n*l);return i.width=e,i.height=n,i.data=p,i}function bc(i,{width:e,height:n},l){if(e===i.width&&n===i.height)return;const p=fp({},{width:e,height:n},l);Kd(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},l),i.width=e,i.height=n,i.data=p.data}function Kd(i,e,n,l,p,_){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||n.x>i.width-p.width||n.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||l.x>e.width-p.width||l.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,A=e.data;if(b===A)throw new Error("srcData equals dstData, so image is already copied");for(let D=0;D<p.height;D++){const B=((n.y+D)*i.width+n.x)*_,G=((l.y+D)*e.width+l.x)*_;for(let X=0;X<p.width*_;X++)A[G+X]=b[B+X]}return e}class Qd{constructor(e,n){fp(this,e,1,n)}resize(e){bc(this,e,1)}clone(){return new Qd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,_){Kd(e,n,l,p,_,1)}}class ja{constructor(e,n){fp(this,e,4,n)}resize(e){bc(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,_){Kd(e,n,l,p,_,4)}setPixel(e,n,l){const p=4*(e*this.width+n);this.data[p+0]=Math.round(255*l.r/l.a),this.data[p+1]=Math.round(255*l.g/l.a),this.data[p+2]=Math.round(255*l.b/l.a),this.data[p+3]=Math.round(255*l.a)}}function vc(i){const e={},n=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new ja({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const _=(b,A,D)=>{e[i.evaluationKey]=D;const B=i.expression.evaluate(e);p.setPixel(b/4/n,A/4,B)};if(i.clips)for(let b=0,A=0;b<l;++b,A+=4*n)for(let D=0,B=0;D<n;D++,B+=4){const G=D/(n-1),{start:X,end:Y}=i.clips[b];_(A,B,X*(1-G)+Y*G)}else for(let b=0,A=0;b<n;b++,A+=4)_(0,A,b/(n-1));return p}Cn("AlphaImage",Qd),Cn("RGBAImage",ja);const Jd="big-fb";class Bm extends Wr{createBucket(e){return new dp(e)}constructor(e,n){super(e,S0,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Jd)&&this.heatmapFbos.delete(Jd)}queryRadius(e){return qc("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,unwrappedTileID:A,getElevation:D}){return cp({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,l)*b,transform:_,unwrappedTileID:A,getElevation:D},p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let ef;var tf={get paint(){return ef=ef||new os({"hillshade-illumination-direction":new Dn(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Dn(Ke.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Dn(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dn(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dn(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dn(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dn(Ke.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Dn(Ke.paint_hillshade["hillshade-method"])})}};class ns extends Wr{constructor(e,n){super(e,tf,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const _=Math.max(e.length,n.length,l.length,p.length);e=e.concat(Array(_-e.length).fill(e.at(-1))),n=n.concat(Array(_-n.length).fill(n.at(-1))),l=l.concat(Array(_-l.length).fill(l.at(-1))),p=p.concat(Array(_-p.length).fill(p.at(-1)));const b=n.map(fi);return{directionRadians:e.map(fi),altitudeRadians:b,shadowColor:p,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Fm;var w1={get paint(){return Fm=Fm||new os({"color-relief-opacity":new Dn(Ke["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ch(Ke["paint_color-relief"]["color-relief-color"])})}};class pp{constructor(e,n,l,p){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,p)}update(e,n,l){const{width:p,height:_}=e,b=!(this.size&&this.size[0]===p&&this.size[1]===_||l),{context:A}=this,{gl:D}=A;if(this.useMipmap=!!(n&&n.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!n||n.premultiply!==!1)),b)this.size=[p,_],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Yt(e)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,e):D.texImage2D(D.TEXTURE_2D,0,this.format,p,_,0,this.format,D.UNSIGNED_BYTE,e.data);else{const{x:B,y:G}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Yt(e)?D.texSubImage2D(D.TEXTURE_2D,0,B,G,D.RGBA,D.UNSIGNED_BYTE,e):D.texSubImage2D(D.TEXTURE_2D,0,B,G,p,_,D.RGBA,D.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D),A.pixelStoreUnpackFlipY.setDefault(),A.pixelStoreUnpack.setDefault(),A.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,l){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),l!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=_.LINEAR),e!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,e),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ad{constructor(e,n,l,p=1,_=1,b=1,A=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Qn(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const D=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=_,this.blueFactor=b,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let B=0;B<D;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(D,B)]=this.data[this._idx(D-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,D)]=this.data[this._idx(B,D-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(D,-1)]=this.data[this._idx(D-1,0)],this.data[this._idx(-1,D)]=this.data[this._idx(0,D-1)],this.data[this._idx(D,D)]=this.data[this._idx(D-1,D-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<D;B++)for(let G=0;G<D;G++){const X=this.get(B,G);X>this.max&&(this.max=X),X<this.min&&(this.min=X)}}get(e,n){const l=new Uint8Array(this.data.buffer),p=4*this._idx(e,n);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,l){return e*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return Zc(e,this.getUnpackVector())}getPixels(){return new ja({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=n*this.dim,_=n*this.dim+this.dim,b=l*this.dim,A=l*this.dim+this.dim;switch(n){case-1:p=_-1;break;case 1:_=p+1}switch(l){case-1:b=A-1;break;case 1:A=b+1}const D=-n*this.dim,B=-l*this.dim;for(let G=b;G<A;G++)for(let X=p;X<_;X++)this.data[this._idx(X,G)]=e.data[this._idx(X+D,G+B)]}}function Zc(i,e){const n=e[0],l=e[1],p=e[2],_=e[3],b=Math.min(n,l,p),A=Math.round((i+_)/b);return{r:Math.floor(A*b/n)%256,g:Math.floor(A*b/l)%256,b:Math.floor(A*b/p)%256}}Cn("DEMData",ad);class jm extends Wr{constructor(e,n){super(e,w1,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Ca&&l._styleExpression.expression instanceof sa){this.colorRampExpression=l;const b=l._styleExpression.expression;n.elevationStops=b.labels,n.colorStops=[];for(const A of n.elevationStops)n.colorStops.push(b.evaluate({globals:{elevation:A}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[ui.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const p={elevationStops:[],colorStops:[]},_=(n.elevationStops.length-1)/(e-1);for(let b=0;b<n.elevationStops.length-.5;b+=_)p.elevationStops.push(n.elevationStops[Math.round(b)]),p.colorStops.push(n.colorStops[Math.round(b)]);return Qn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(n),_=new ja({width:p.colorStops.length,height:1}),b=new ja({width:p.colorStops.length,height:1});for(let A=0;A<p.elevationStops.length;A++){const D=Zc(p.elevationStops[A],l);b.setPixel(0,A,new ui(D.r/255,D.g/255,D.b/255,1)),_.setPixel(0,A,p.colorStops[A])}return this.colorRampTextures={elevationTexture:new pp(e,b,e.gl.RGBA),colorTexture:new pp(e,_,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Um=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:nf}=Um;function Go(i,e,n){const l=n.patternDependencies;let p=!1;for(const _ of e){const b=_.paint.get(`${i}-pattern`);b.isConstant()||(p=!0);const A=b.constantOr(null);A&&(p=!0,l[A.to]=!0,l[A.from]=!0)}return p}function mp(i,e,n,l,p){const{zoom:_}=l,b=p.patternDependencies;for(const A of e){const D=A.paint.get(`${i}-pattern`).value;if(D.kind!=="constant"){let B=D.evaluate({zoom:_-1},n,{},p.availableImages),G=D.evaluate({zoom:_},n,{},p.availableImages),X=D.evaluate({zoom:_+1},n,{},p.availableImages);B=B&&B.name?B.name:B,G=G&&G.name?G.name:G,X=X&&X.name?X.name:X,b[B]=!0,b[G]=!0,b[X]=!0,n.patterns[A.id]={min:B,mid:G,max:X}}}return n}function gp(i,e,n,l,p){let _;if(p===(function(b,A,D,B){let G=0;for(let X=A,Y=D-B;X<D;X+=B)G+=(b[Y]-b[X])*(b[X+1]+b[Y+1]),Y=X;return G})(i,e,n,l)>0)for(let b=e;b<n;b+=l)_=ao(b/l|0,i[b],i[b+1],_);else for(let b=n-l;b>=e;b-=l)_=ao(b/l|0,i[b],i[b+1],_);return _&&So(_,_.next)&&(oo(_),_=_.next),_}function Tu(i,e){if(!i)return i;e||(e=i);let n,l=i;do if(n=!1,l.steiner||!So(l,l.next)&&Ki(l.prev,l,l.next)!==0)l=l.next;else{if(oo(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function yh(i,e,n,l,p,_,b){if(!i)return;!b&&_&&(function(D,B,G,X){let Y=D;do Y.z===0&&(Y.z=Ws(Y.x,Y.y,B,G,X)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==D);Y.prevZ.nextZ=null,Y.prevZ=null,(function(Q){let ie,re=1;do{let ae,me=Q;Q=null;let Fe=null;for(ie=0;me;){ie++;let _e=me,we=0;for(let Ye=0;Ye<re&&(we++,_e=_e.nextZ,_e);Ye++);let Ge=re;for(;we>0||Ge>0&&_e;)we!==0&&(Ge===0||!_e||me.z<=_e.z)?(ae=me,me=me.nextZ,we--):(ae=_e,_e=_e.nextZ,Ge--),Fe?Fe.nextZ=ae:Q=ae,ae.prevZ=Fe,Fe=ae;me=_e}Fe.nextZ=null,re*=2}while(ie>1)})(Y)})(i,l,p,_);let A=i;for(;i.prev!==i.next;){const D=i.prev,B=i.next;if(_?yp(i,l,p,_):T0(i))e.push(D.i,i.i,B.i),oo(i),i=B.next,A=B.next;else if((i=B)===A){b?b===1?yh(i=Vm(Tu(i),e),e,n,l,p,_,2):b===2&&Xc(i,e,n,l,p,_):yh(Tu(i),e,n,l,p,_,1);break}}}function T0(i){const e=i.prev,n=i,l=i.next;if(Ki(e,n,l)>=0)return!1;const p=e.x,_=n.x,b=l.x,A=e.y,D=n.y,B=l.y,G=Math.min(p,_,b),X=Math.min(A,D,B),Y=Math.max(p,_,b),Q=Math.max(A,D,B);let ie=l.next;for(;ie!==e;){if(ie.x>=G&&ie.x<=Y&&ie.y>=X&&ie.y<=Q&&od(p,A,_,D,b,B,ie.x,ie.y)&&Ki(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function yp(i,e,n,l){const p=i.prev,_=i,b=i.next;if(Ki(p,_,b)>=0)return!1;const A=p.x,D=_.x,B=b.x,G=p.y,X=_.y,Y=b.y,Q=Math.min(A,D,B),ie=Math.min(G,X,Y),re=Math.max(A,D,B),ae=Math.max(G,X,Y),me=Ws(Q,ie,e,n,l),Fe=Ws(re,ae,e,n,l);let _e=i.prevZ,we=i.nextZ;for(;_e&&_e.z>=me&&we&&we.z<=Fe;){if(_e.x>=Q&&_e.x<=re&&_e.y>=ie&&_e.y<=ae&&_e!==p&&_e!==b&&od(A,G,D,X,B,Y,_e.x,_e.y)&&Ki(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,we.x>=Q&&we.x<=re&&we.y>=ie&&we.y<=ae&&we!==p&&we!==b&&od(A,G,D,X,B,Y,we.x,we.y)&&Ki(we.prev,we,we.next)>=0))return!1;we=we.nextZ}for(;_e&&_e.z>=me;){if(_e.x>=Q&&_e.x<=re&&_e.y>=ie&&_e.y<=ae&&_e!==p&&_e!==b&&od(A,G,D,X,B,Y,_e.x,_e.y)&&Ki(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;we&&we.z<=Fe;){if(we.x>=Q&&we.x<=re&&we.y>=ie&&we.y<=ae&&we!==p&&we!==b&&od(A,G,D,X,B,Y,we.x,we.y)&&Ki(we.prev,we,we.next)>=0)return!1;we=we.nextZ}return!0}function Vm(i,e){let n=i;do{const l=n.prev,p=n.next.next;!So(l,p)&&I0(l,n,n.next,p)&&af(l,p)&&af(p,l)&&(e.push(l.i,n.i,p.i),oo(n),oo(n.next),n=i=p),n=n.next}while(n!==i);return Tu(n)}function Xc(i,e,n,l,p,_){let b=i;do{let A=b.next.next;for(;A!==b.prev;){if(b.i!==A.i&&ls(b,A)){let D=of(b,A);return b=Tu(b,b.next),D=Tu(D,D.next),yh(b,e,n,l,p,_,0),void yh(D,e,n,l,p,_,0)}A=A.next}b=b.next}while(b!==i)}function Xs(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function A0(i,e){const n=(function(p,_){let b=_;const A=p.x,D=p.y;let B,G=-1/0;if(So(p,b))return b;do{if(So(p,b.next))return b.next;if(D<=b.y&&D>=b.next.y&&b.next.y!==b.y){const re=b.x+(D-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(re<=A&&re>G&&(G=re,B=b.x<b.next.x?b:b.next,re===A))return B}b=b.next}while(b!==_);if(!B)return null;const X=B,Y=B.x,Q=B.y;let ie=1/0;b=B;do{if(A>=b.x&&b.x>=Y&&A!==b.x&&C0(D<Q?A:G,D,Y,Q,D<Q?G:A,D,b.x,b.y)){const re=Math.abs(D-b.y)/(A-b.x);af(b,p)&&(re<ie||re===ie&&(b.x>B.x||b.x===B.x&&Gm(B,b)))&&(B=b,ie=re)}b=b.next}while(b!==X);return B})(i,e);if(!n)return e;const l=of(n,i);return Tu(l,l.next),Tu(n,n.next)}function Gm(i,e){return Ki(i.prev,i,e.prev)<0&&Ki(e.next,i,i.next)<0}function Ws(i,e,n,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function E1(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function C0(i,e,n,l,p,_,b,A){return(p-b)*(e-A)>=(i-b)*(_-A)&&(i-b)*(l-A)>=(n-b)*(e-A)&&(n-b)*(_-A)>=(p-b)*(l-A)}function od(i,e,n,l,p,_,b,A){return!(i===b&&e===A)&&C0(i,e,n,l,p,_,b,A)}function ls(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,l){let p=n;do{if(p.i!==n.i&&p.next.i!==n.i&&p.i!==l.i&&p.next.i!==l.i&&I0(p,p.next,n,l))return!0;p=p.next}while(p!==n);return!1})(i,e)&&(af(i,e)&&af(e,i)&&(function(n,l){let p=n,_=!1;const b=(n.x+l.x)/2,A=(n.y+l.y)/2;do p.y>A!=p.next.y>A&&p.next.y!==p.y&&b<(p.next.x-p.x)*(A-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==n);return _})(i,e)&&(Ki(i.prev,i,e.prev)||Ki(i,e.prev,e))||So(i,e)&&Ki(i.prev,i,i.next)>0&&Ki(e.prev,e,e.next)>0)}function Ki(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function So(i,e){return i.x===e.x&&i.y===e.y}function I0(i,e,n,l){const p=sf(Ki(i,e,n)),_=sf(Ki(i,e,l)),b=sf(Ki(n,l,i)),A=sf(Ki(n,l,e));return p!==_&&b!==A||!(p!==0||!rf(i,n,e))||!(_!==0||!rf(i,l,e))||!(b!==0||!rf(n,i,l))||!(A!==0||!rf(n,e,l))}function rf(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function sf(i){return i>0?1:i<0?-1:0}function af(i,e){return Ki(i.prev,i,i.next)<0?Ki(i,e,i.next)>=0&&Ki(i,i.prev,e)>=0:Ki(i,e,i.prev)<0||Ki(i,i.next,e)<0}function of(i,e){const n=xp(i.i,i.x,i.y),l=xp(e.i,e.x,e.y),p=i.next,_=e.prev;return i.next=e,e.prev=i,n.next=p,p.prev=n,l.next=n,n.prev=l,_.next=l,l.prev=_,l}function ao(i,e,n,l){const p=xp(i,e,n);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function oo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function xp(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ca{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class lf{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}lf.noSubdivision=new lf({fill:new ca(0,0),line:new ca(0,0),tile:new ca(0,0),stencil:new ca(0,0),circle:1}),Cn("SubdivisionGranularityExpression",ca),Cn("SubdivisionGranularitySetting",lf);const To=-32768,$l=32767;class Wc{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=mt/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),p=0|Math.round(n),_=this._getKey(l,p);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,b),this._vertexBuffer.push(l,p),b}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(p,_){const b=[];for(let A=0;A<_.length;A+=3){const D=_[A],B=_[A+1],G=_[A+2],X=p[2*D],Y=p[2*D+1];(p[2*B]-X)*(p[2*G+1]-Y)-(p[2*B+1]-Y)*(p[2*G]-X)>0?(b.push(D),b.push(G),b.push(B)):(b.push(D),b.push(B),b.push(G))}return b})(this._vertexBuffer,e);const n=[],l=e.length;for(let p=0;p<l;p+=3){const _=[e[p+0],e[p+1],e[p+2]],b=[this._vertexBuffer[2*e[p+0]+0],this._vertexBuffer[2*e[p+0]+1],this._vertexBuffer[2*e[p+1]+0],this._vertexBuffer[2*e[p+1]+1],this._vertexBuffer[2*e[p+2]+0],this._vertexBuffer[2*e[p+2]+1]];let A=1/0,D=1/0,B=-1/0,G=-1/0;for(let re=0;re<3;re++){const ae=b[2*re],me=b[2*re+1];A=Math.min(A,ae),B=Math.max(B,ae),D=Math.min(D,me),G=Math.max(G,me)}if(A===B||D===G)continue;const X=Math.floor(A/this._granularityCellSize),Y=Math.ceil(B/this._granularityCellSize),Q=Math.floor(D/this._granularityCellSize),ie=Math.ceil(G/this._granularityCellSize);if(X!==Y||Q!==ie)for(let re=Q;re<ie;re++){const ae=this._scanlineGenerateVertexRingForCellRow(re,b,_);Kl(this._vertexBuffer,ae,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(e,n,l){const p=e*this._granularityCellSize,_=p+this._granularityCellSize,b=[];for(let A=0;A<3;A++){const D=n[2*A],B=n[2*A+1],G=n[2*(A+1)%6],X=n[(2*(A+1)+1)%6],Y=n[2*(A+2)%6],Q=n[(2*(A+2)+1)%6],ie=G-D,re=X-B,ae=ie===0,me=re===0,Fe=(p-B)/re,_e=(_-B)/re,we=Math.min(Fe,_e),Ge=Math.max(Fe,_e);if(!me&&(we>=1||Ge<=0)||me&&(B<p||B>_)){X>=p&&X<=_&&b.push(l[(A+1)%3]);continue}!me&&we>0&&b.push(this._vertexToIndex(D+ie*we,B+re*we));const Ye=D+ie*Math.max(we,0),St=D+ie*Math.min(Ge,1);ae||this._generateIntraEdgeVertices(b,D,B,G,X,Ye,St),!me&&Ge<1&&b.push(this._vertexToIndex(D+ie*Ge,B+re*Ge)),(me||X>=p&&X<=_)&&b.push(l[(A+1)%3]),!me&&(X<=p||X>=_)&&this._generateInterEdgeVertices(b,D,B,G,X,Y,Q,St,p,_)}return b}_generateIntraEdgeVertices(e,n,l,p,_,b,A){const D=p-n,B=_-l,G=B===0,X=G?Math.min(n,p):Math.min(b,A),Y=G?Math.max(n,p):Math.max(b,A),Q=Math.floor(X/this._granularityCellSize)+1,ie=Math.ceil(Y/this._granularityCellSize)-1;if(G?n<p:b<A)for(let re=Q;re<=ie;re++){const ae=re*this._granularityCellSize;e.push(this._vertexToIndex(ae,l+B*(ae-n)/D))}else for(let re=ie;re>=Q;re--){const ae=re*this._granularityCellSize;e.push(this._vertexToIndex(ae,l+B*(ae-n)/D))}}_generateInterEdgeVertices(e,n,l,p,_,b,A,D,B,G){const X=_-l,Y=b-p,Q=A-_,ie=(B-_)/Q,re=(G-_)/Q,ae=Math.min(ie,re),me=Math.max(ie,re),Fe=p+Y*ae;let _e=Math.floor(Math.min(Fe,D)/this._granularityCellSize)+1,we=Math.ceil(Math.max(Fe,D)/this._granularityCellSize)-1,Ge=D<Fe;const Ye=Q===0;if(Ye&&(A===B||A===G))return;if(Ye||ae>=1||me<=0){const Wt=l-A,Vt=b+(n-b)*Math.min((B-A)/Wt,(G-A)/Wt);_e=Math.floor(Math.min(Vt,D)/this._granularityCellSize)+1,we=Math.ceil(Math.max(Vt,D)/this._granularityCellSize)-1,Ge=D<Vt}const St=X>0?G:B;if(Ge)for(let Wt=_e;Wt<=we;Wt++)e.push(this._vertexToIndex(Wt*this._granularityCellSize,St));else for(let Wt=we;Wt>=_e;Wt--)e.push(this._vertexToIndex(Wt*this._granularityCellSize,St))}_generateOutline(e){const n=[];for(const l of e){const p=Yc(l,this._granularity,!0),_=this._pointArrayToIndices(p),b=[];for(let A=1;A<_.length;A++)b.push(_[A-1]),b.push(_[A]);n.push(b)}return n}_handlePoles(e){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(e,n,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const l=e[n+1];l===To&&(e[n+1]=-32767),l===$l&&(e[n+1]=32766)}}_generatePoleQuad(e,n,l,p,_,b){p>_!=(b===To)?(e.push(n),e.push(l),e.push(this._vertexToIndex(p,b)),e.push(l),e.push(this._vertexToIndex(_,b)),e.push(this._vertexToIndex(p,b))):(e.push(l),e.push(n),e.push(this._vertexToIndex(p,b)),e.push(this._vertexToIndex(_,b)),e.push(l),e.push(this._vertexToIndex(p,b)))}_fillPoles(e,n,l){const p=this._vertexBuffer,_=mt,b=e.length;for(let A=2;A<b;A+=3){const D=e[A-2],B=e[A-1],G=e[A],X=p[2*D],Y=p[2*D+1],Q=p[2*B],ie=p[2*B+1],re=p[2*G],ae=p[2*G+1];n&&(Y===0&&ie===0&&this._generatePoleQuad(e,D,B,X,Q,To),ie===0&&ae===0&&this._generatePoleQuad(e,B,G,Q,re,To),ae===0&&Y===0&&this._generatePoleQuad(e,G,D,re,X,To)),l&&(Y===_&&ie===_&&this._generatePoleQuad(e,D,B,X,Q,$l),ie===_&&ae===_&&this._generatePoleQuad(e,B,G,Q,re,$l),ae===_&&Y===_&&this._generatePoleQuad(e,G,D,re,X,$l))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:p}=(function(A){const D=[],B=[];for(const G of A)if(G.length!==0){G!==A[0]&&D.push(B.length/2);for(let X=0;X<G.length;X++)B.push(G[X].x),B.push(G[X].y)}return{flattened:B,holeIndices:D}})(e);let _;this._initializeVertices(l);try{const A=(function(B,G,X=2){const Y=G&&G.length,Q=Y?G[0]*X:B.length;let ie=gp(B,0,Q,X,!0);const re=[];if(!ie||ie.next===ie.prev)return re;let ae,me,Fe;if(Y&&(ie=(function(_e,we,Ge,Ye){const St=[];for(let Wt=0,Vt=we.length;Wt<Vt;Wt++){const en=gp(_e,we[Wt]*Ye,Wt<Vt-1?we[Wt+1]*Ye:_e.length,Ye,!1);en===en.next&&(en.steiner=!0),St.push(E1(en))}St.sort(Xs);for(let Wt=0;Wt<St.length;Wt++)Ge=A0(St[Wt],Ge);return Ge})(B,G,ie,X)),B.length>80*X){ae=B[0],me=B[1];let _e=ae,we=me;for(let Ge=X;Ge<Q;Ge+=X){const Ye=B[Ge],St=B[Ge+1];Ye<ae&&(ae=Ye),St<me&&(me=St),Ye>_e&&(_e=Ye),St>we&&(we=St)}Fe=Math.max(_e-ae,we-me),Fe=Fe!==0?32767/Fe:0}return yh(ie,re,X,ae,me,Fe,0),re})(l,p),D=this._convertIndices(l,A);_=this._subdivideTrianglesScanline(D)}catch(A){console.error(A)}let b=[];return n&&(b=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:b}}_convertIndices(e,n){const l=[];for(let p=0;p<n.length;p++)l.push(this._vertexToIndex(e[2*n[p]],e[2*n[p]+1]));return l}_pointArrayToIndices(e){const n=[];for(let l=0;l<e.length;l++){const p=e[l];n.push(this._vertexToIndex(p.x,p.y))}return n}}function _p(i,e,n,l=!0){return new Wc(n,e).subdividePolygonInternal(i,l)}function Yc(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],p=i[i.length-1],_=n&&(l.x!==p.x||l.y!==p.y);if(e<2)return _?[...i,i[0]]:[...i];const b=Math.floor(mt/e),A=[];A.push(new V(i[0].x,i[0].y));const D=i.length,B=_?D:D-1;for(let G=0;G<B;G++){const X=i[G],Y=G<D-1?i[G+1]:i[0],Q=X.x,ie=X.y,re=Y.x,ae=Y.y,me=Q!==re,Fe=ie!==ae;if(!me&&!Fe)continue;const _e=re-Q,we=ae-ie,Ge=Math.abs(_e),Ye=Math.abs(we);let St=Q,Wt=ie;for(;;){const en=_e>0?(Math.floor(St/b)+1)*b:(Math.ceil(St/b)-1)*b,Sn=we>0?(Math.floor(Wt/b)+1)*b:(Math.ceil(Wt/b)-1)*b,sn=Math.abs(St-en),Ht=Math.abs(Wt-Sn),kt=Math.abs(St-re),Nn=Math.abs(Wt-ae),In=me?sn/Ge:Number.POSITIVE_INFINITY,On=Fe?Ht/Ye:Number.POSITIVE_INFINITY;if((kt<=sn||!me)&&(Nn<=Ht||!Fe))break;if(In<On&&me||!Fe){St=en,Wt+=we*In;const An=new V(St,Math.round(Wt));A[A.length-1].x===An.x&&A[A.length-1].y===An.y||A.push(An)}else{St+=_e*On,Wt=Sn;const An=new V(Math.round(St),Wt);A[A.length-1].x===An.x&&A[A.length-1].y===An.y||A.push(An)}}const Vt=new V(re,ae);A[A.length-1].x===Vt.x&&A[A.length-1].y===Vt.y||A.push(Vt)}return A}function Kl(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,p=i[2*e[0]];for(let D=1;D<e.length;D++){const B=i[2*e[D]];B<p&&(p=B,l=D)}const _=e.length;let b=l,A=(b+1)%_;for(;;){const D=b-1>=0?b-1:_-1,B=(A+1)%_,G=i[2*e[D]],X=i[2*e[B]],Y=i[2*e[b]],Q=i[2*e[b]+1],ie=i[2*e[A]+1];let re=!1;if(G<X)re=!0;else if(G>X)re=!1;else{const ae=ie-Q,me=-(i[2*e[A]]-Y),Fe=Q<ie?1:-1;((G-Y)*ae+(i[2*e[D]+1]-Q)*me)*Fe>((X-Y)*ae+(i[2*e[B]+1]-Q)*me)*Fe&&(re=!0)}if(re){const ae=e[D],me=e[b],Fe=e[A];ae!==me&&ae!==Fe&&me!==Fe&&n.push(Fe,me,ae),b--,b<0&&(b=_-1)}else{const ae=e[B],me=e[b],Fe=e[A];ae!==me&&ae!==Fe&&me!==Fe&&n.push(Fe,me,ae),A++,A>=_&&(A=0)}if(D===B)break}}function M0(i,e,n,l,p,_,b,A,D){const B=p.length/2,G=b&&A&&D;if(B<En.MAX_VERTEX_ARRAY_LENGTH){const X=e.prepareSegment(B,n,l),Y=X.vertexLength;for(let re=0;re<_.length;re+=3)l.emplaceBack(Y+_[re],Y+_[re+1],Y+_[re+2]);let Q,ie;X.vertexLength+=B,X.primitiveLength+=_.length/3,G&&(ie=b.prepareSegment(B,n,A),Q=ie.vertexLength,ie.vertexLength+=B);for(let re=0;re<p.length;re+=2)i(p[re],p[re+1]);if(G)for(let re=0;re<D.length;re++){const ae=D[re];for(let me=1;me<ae.length;me+=2)A.emplaceBack(Q+ae[me-1],Q+ae[me]);ie.primitiveLength+=ae.length/2}}else(function(X,Y,Q,ie,re,ae){const me=[];for(let Ye=0;Ye<ie.length/2;Ye++)me.push(-1);const Fe={count:0};let _e=0,we=X.getOrCreateLatestSegment(Y,Q),Ge=we.vertexLength;for(let Ye=2;Ye<re.length;Ye+=3){const St=re[Ye-2],Wt=re[Ye-1],Vt=re[Ye];let en=me[St]<_e,Sn=me[Wt]<_e,sn=me[Vt]<_e;we.vertexLength+((en?1:0)+(Sn?1:0)+(sn?1:0))>En.MAX_VERTEX_ARRAY_LENGTH&&(we=X.createNewSegment(Y,Q),_e=Fe.count,en=!0,Sn=!0,sn=!0,Ge=0);const Ht=wc(me,ie,ae,Fe,St,en,we),kt=wc(me,ie,ae,Fe,Wt,Sn,we),Nn=wc(me,ie,ae,Fe,Vt,sn,we);Q.emplaceBack(Ge+Ht-_e,Ge+kt-_e,Ge+Nn-_e),we.primitiveLength++}})(e,n,l,p,_,i),G&&(function(X,Y,Q,ie,re,ae){const me=[];for(let Ye=0;Ye<ie.length/2;Ye++)me.push(-1);const Fe={count:0};let _e=0,we=X.getOrCreateLatestSegment(Y,Q),Ge=we.vertexLength;for(let Ye=0;Ye<re.length;Ye++){const St=re[Ye];for(let Wt=1;Wt<re[Ye].length;Wt+=2){const Vt=St[Wt-1],en=St[Wt];let Sn=me[Vt]<_e,sn=me[en]<_e;we.vertexLength+((Sn?1:0)+(sn?1:0))>En.MAX_VERTEX_ARRAY_LENGTH&&(we=X.createNewSegment(Y,Q),_e=Fe.count,Sn=!0,sn=!0,Ge=0);const Ht=wc(me,ie,ae,Fe,Vt,Sn,we),kt=wc(me,ie,ae,Fe,en,sn,we);Q.emplaceBack(Ge+Ht-_e,Ge+kt-_e),we.primitiveLength++}}})(b,n,A,p,D,i),e.forceNewSegmentOnNextPrepare(),b?.forceNewSegmentOnNextPrepare()}function wc(i,e,n,l,p,_,b){if(_){const A=l.count;return n(e[2*p],e[2*p+1]),i[p]=l.count,l.count++,b.vertexLength++,A}return i[p]}class xh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Re,this.indexArray=new Ct,this.indexArray2=new dn,this.programConfigurations=new yc(e.layers,e.zoom),this.segments=new En,this.segments2=new En,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Go("fill",this.layers,n);const p=this.layers[0].layout.get("fill-sort-key"),_=!p.isConstant(),b=[];for(const{feature:A,id:D,index:B,sourceLayerIndex:G}of e){const X=this.layers[0]._featureFilter.needGeometry,Y=Vo(A,X);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),Y,l))continue;const Q=_?p.evaluate(Y,{},l,n.availableImages):void 0,ie={id:D,properties:A.properties,type:A.type,sourceLayerIndex:G,index:B,geometry:X?Y.geometry:Yl(A),patterns:{},sortKey:Q};b.push(ie)}_&&b.sort(((A,D)=>A.sortKey-D.sortKey));for(const A of b){const{geometry:D,index:B,sourceLayerIndex:G}=A;if(this.hasDependencies){const X=mp("fill",this.layers,A,{zoom:this.zoom},n);this.patternFeatures.push(X)}else this.addFeature(A,D,B,l,{},n.subdivisionGranularity);n.featureIndex.insert(e[B].feature,D,B,G,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,n,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,p,_,b){for(const A of al(n,500)){const D=_p(A,p,b.fill.getGranularityForZoomLevel(p.z)),B=this.layoutVertexArray;M0(((G,X)=>{B.emplaceBack(G,X)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles,this.segments2,this.indexArray2,D.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,canonical:p})}}let ld,_h;Cn("FillBucket",xh,{omit:["layers","patternFeatures"]});var Hm={get paint(){return _h=_h||new os({"fill-antialias":new Dn(Ke.paint_fill["fill-antialias"]),"fill-opacity":new Ln(Ke.paint_fill["fill-opacity"]),"fill-color":new Ln(Ke.paint_fill["fill-color"]),"fill-outline-color":new Ln(Ke.paint_fill["fill-outline-color"]),"fill-translate":new Dn(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Dn(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new bo(Ke.paint_fill["fill-pattern"])})},get layout(){return ld=ld||new os({"fill-sort-key":new Ln(Ke.layout_fill["fill-sort-key"])})}};class qm extends Wr{constructor(e,n){super(e,Hm,n)}recalculate(e,n){super.recalculate(e,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new xh(e)}queryRadius(){return Yd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:l,pixelsToTileUnits:p}){return sp(op(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,p),n)}isTileClipped(){return!0}}const cf=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Zm=Gr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bp}=cf;class cd{constructor(e,n,l,p,_){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=p,this._values=_,e.readFields(S1,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let p,_=1,b=0,A=0,D=0;for(;e.pos<n;){if(b<=0){const B=e.readVarint();_=7&B,b=B>>3}if(b--,_===1||_===2)A+=e.readSVarint(),D+=e.readSVarint(),_===1&&(p&&l.push(p),p=[]),p&&p.push(new V(A,D));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&l.push(p),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,p=0,_=0,b=0,A=1/0,D=-1/0,B=1/0,G=-1/0;for(;e.pos<n;){if(p<=0){const X=e.readVarint();l=7&X,p=X>>3}if(p--,l===1||l===2)_+=e.readSVarint(),b+=e.readSVarint(),_<A&&(A=_),_>D&&(D=_),b<B&&(B=b),b>G&&(G=b);else if(l!==7)throw new Error(`unknown command ${l}`)}return[A,B,D,G]}toGeoJSON(e,n,l){const p=this.extent*Math.pow(2,l),_=this.extent*e,b=this.extent*n,A=this.loadGeometry();function D(Y){return[360*(Y.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(Y.y+b)/p)*Math.PI))-90]}function B(Y){return Y.map(D)}let G;if(this.type===1){const Y=[];for(const ie of A)Y.push(ie[0]);const Q=B(Y);G=Y.length===1?{type:"Point",coordinates:Q[0]}:{type:"MultiPoint",coordinates:Q}}else if(this.type===2){const Y=A.map(B);G=Y.length===1?{type:"LineString",coordinates:Y[0]}:{type:"MultiLineString",coordinates:Y}}else{if(this.type!==3)throw new Error("unknown feature type");{const Y=Xm(A),Q=[];for(const ie of Y)Q.push(ie.map(B));G=Q.length===1?{type:"Polygon",coordinates:Q[0]}:{type:"MultiPolygon",coordinates:Q}}}const X={type:"Feature",geometry:G,properties:this.properties};return this.id!=null&&(X.id=this.id),X}}function S1(i,e,n){i===1?e.id=n.readVarint():i===2?(function(l,p){const _=l.readVarint()+l.pos;for(;l.pos<_;){const b=p._keys[l.readVarint()],A=p._values[l.readVarint()];p.properties[b]=A}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function Xm(i){const e=i.length;if(e<=1)return[i];const n=[];let l,p;for(let _=0;_<e;_++){const b=wr(i[_]);b!==0&&(p===void 0&&(p=b<0),p===b<0?(l&&n.push(l),l=[i[_]]):l&&l.push(i[_]))}return l&&n.push(l),n}function wr(i){let e=0;for(let n,l,p=0,_=i.length,b=_-1;p<_;b=p++)n=i[p],l=i[b],e+=(l.x-n.x)*(n.y+l.y);return e}cd.types=["Unknown","Point","LineString","Polygon"];class qr{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Zi,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new cd(this._pbf,n,this.extent,this._keys,this._values)}}function Zi(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(l){let p=null;const _=l.readVarint()+l.pos;for(;l.pos<_;){const b=l.readVarint()>>3;p=b===1?l.readString():b===2?l.readFloat():b===3?l.readDouble():b===4?l.readVarint64():b===5?l.readVarint():b===6?l.readSVarint():b===7?l.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p})(n))}class Xi{constructor(e,n){this.layers=e.readFields(Pr,{},n)}}function Pr(i,e,n){if(i===3){const l=new qr(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const lo=Math.pow(2,13);function Sl(i,e,n,l,p,_,b,A){i.emplaceBack(e,n,2*Math.floor(l*lo)+b,p*lo*2,_*lo*2,Math.round(A))}class Au{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Be,this.centroidVertexArray=new Ae,this.indexArray=new Ct,this.programConfigurations=new yc(e.layers,e.zoom),this.segments=new En,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.features=[],this.hasDependencies=Go("fill-extrusion",this.layers,n);for(const{feature:p,id:_,index:b,sourceLayerIndex:A}of e){const D=this.layers[0]._featureFilter.needGeometry,B=Vo(p,D);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),B,l))continue;const G={id:_,sourceLayerIndex:A,index:b,geometry:D?B.geometry:Yl(p),properties:p.properties,type:p.type,patterns:{}};this.hasDependencies?this.features.push(mp("fill-extrusion",this.layers,G,{zoom:this.zoom},n)):this.addFeature(G,G.geometry,b,l,{},n.subdivisionGranularity),n.featureIndex.insert(p,G.geometry,b,A,this.index,!0)}}addFeatures(e,n,l){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,n,l,e.subdivisionGranularity)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Zm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,l,p,_,b){for(const A of al(n,500)){const D={x:0,y:0,sampleCount:0},B=this.layoutVertexArray.length;this.processPolygon(D,p,e,A,b);const G=this.layoutVertexArray.length-B,X=Math.floor(D.x/D.sampleCount),Y=Math.floor(D.y/D.sampleCount);for(let Q=0;Q<G;Q++)this.centroidVertexArray.emplaceBack(X,Y)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,canonical:p})}processPolygon(e,n,l,p,_){if(p.length<1||gs(p[0]))return;for(const X of p)X.length!==0&&R0(e,X);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},A=_.fill.getGranularityForZoomLevel(n.z),D=cd.types[l.type]==="Polygon";for(const X of p){if(X.length===0||gs(X))continue;const Y=Yc(X,A,D);this._generateSideFaces(Y,b)}if(!D)return;const B=_p(p,n,A,!1),G=this.layoutVertexArray;M0(((X,Y)=>{Sl(G,X,Y,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,B.verticesFlattened,B.indicesTriangles)}_generateSideFaces(e,n){let l=0;for(let p=1;p<e.length;p++){const _=e[p],b=e[p-1];if($c(_,b))continue;n.segment.vertexLength+4>En.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const A=_.sub(b)._perp()._unit(),D=b.dist(_);l+D>32768&&(l=0),Sl(this.layoutVertexArray,_.x,_.y,A.x,A.y,0,0,l),Sl(this.layoutVertexArray,_.x,_.y,A.x,A.y,0,1,l),l+=D,Sl(this.layoutVertexArray,b.x,b.y,A.x,A.y,0,0,l),Sl(this.layoutVertexArray,b.x,b.y,A.x,A.y,0,1,l);const B=n.segment.vertexLength;this.indexArray.emplaceBack(B,B+2,B+1),this.indexArray.emplaceBack(B+1,B+2,B+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function R0(i,e){for(let n=0;n<e.length;n++){const l=e[n];n===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function $c(i,e){return i.x===e.x&&(i.x<0||i.x>mt)||i.y===e.y&&(i.y<0||i.y>mt)}function gs(i){return i.every((e=>e.x<0))||i.every((e=>e.x>mt))||i.every((e=>e.y<0))||i.every((e=>e.y>mt))}let Kc;Cn("FillExtrusionBucket",Au,{omit:["layers","features"]});var bh={get paint(){return Kc=Kc||new os({"fill-extrusion-opacity":new Dn(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ln(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dn(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dn(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bo(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ln(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ln(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dn(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class D0 extends Wr{constructor(e,n){super(e,bh,n)}createBucket(e){return new Au(e)}queryRadius(){return Yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,pixelPosMatrix:A}){const D=op(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,b),B=this.paint.get("fill-extrusion-height").evaluate(n,l),G=this.paint.get("fill-extrusion-base").evaluate(n,l),X=(function(Q,ie){const re=[];for(const ae of Q){const me=[ae.x,ae.y,0,1];Rt(me,me,ie),re.push(new V(me[0]/me[3],me[1]/me[3]))}return re})(D,A),Y=(function(Q,ie,re,ae){const me=[],Fe=[],_e=ae[8]*ie,we=ae[9]*ie,Ge=ae[10]*ie,Ye=ae[11]*ie,St=ae[8]*re,Wt=ae[9]*re,Vt=ae[10]*re,en=ae[11]*re;for(const Sn of Q){const sn=[],Ht=[];for(const kt of Sn){const Nn=kt.x,In=kt.y,On=ae[0]*Nn+ae[4]*In+ae[12],An=ae[1]*Nn+ae[5]*In+ae[13],Vn=ae[2]*Nn+ae[6]*In+ae[14],Qi=ae[3]*Nn+ae[7]*In+ae[15],zi=Vn+Ge,is=Qi+Ye,Ha=On+St,Qs=An+Wt,rs=Vn+Vt,$r=Qi+en,gr=new V((On+_e)/is,(An+we)/is);gr.z=zi/is,sn.push(gr);const ys=new V(Ha/$r,Qs/$r);ys.z=rs/$r,Ht.push(ys)}me.push(sn),Fe.push(Ht)}return[me,Fe]})(p,G,B,A);return(function(Q,ie,re){let ae=1/0;sp(re,ie)&&(ae=vh(re,ie[0]));for(let me=0;me<ie.length;me++){const Fe=ie[me],_e=Q[me];for(let we=0;we<Fe.length-1;we++){const Ge=Fe[we],Ye=[Ge,Fe[we+1],_e[we+1],_e[we],Ge];gh(re,Ye)&&(ae=Math.min(ae,vh(re,Ye)))}}return ae!==1/0&&ae})(Y[0],Y[1],X)}}function Ia(i,e){return i.x*e.x+i.y*e.y}function vh(i,e){if(i.length===1){let n=0;const l=e[n++];let p;for(;!p||l.equals(p);)if(p=e[n++],!p)return 1/0;for(;n<e.length;n++){const _=e[n],b=i[0],A=p.sub(l),D=_.sub(l),B=b.sub(l),G=Ia(A,A),X=Ia(A,D),Y=Ia(D,D),Q=Ia(B,A),ie=Ia(B,D),re=G*Y-X*X,ae=(Y*Q-X*ie)/re,me=(G*ie-X*Q)/re,Fe=l.z*(1-ae-me)+p.z*ae+_.z*me;if(isFinite(Fe))return Fe}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}const uf=Gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ao}=uf,N0=Gr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vp}=N0,Wm=Math.cos(Math.PI/180*37.5),hf=Math.pow(2,14)/.5;class ud{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new We,this.layoutVertexArray2=new Le,this.indexArray=new Ct,this.programConfigurations=new yc(e.layers,e.zoom),this.segments=new En,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Go("line",this.layers,n)||this.hasLineDasharray(this.layers);const p=this.layers[0].layout.get("line-sort-key"),_=!p.isConstant(),b=[];for(const{feature:A,id:D,index:B,sourceLayerIndex:G}of e){const X=this.layers[0]._featureFilter.needGeometry,Y=Vo(A,X);if(!this.layers[0]._featureFilter.filter(new cr(this.zoom),Y,l))continue;const Q=_?p.evaluate(Y,{},l):void 0,ie={id:D,properties:A.properties,type:A.type,sourceLayerIndex:G,index:B,geometry:X?Y.geometry:Yl(A),patterns:{},dashes:{},sortKey:Q};b.push(ie)}_&&b.sort(((A,D)=>A.sortKey-D.sortKey));for(const A of b){const{geometry:D,index:B,sourceLayerIndex:G}=A;this.hasDependencies?(Go("line",this.layers,n)?mp("line",this.layers,A,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,A,this.zoom,n),this.patternFeatures.push(A)):this.addFeature(A,D,B,l,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[B].feature,D,B,G,this.index)}}update(e,n,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l,dashPositions:p})}addFeatures(e,n,l,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,l,p,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ao),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,p,_,b,A){const D=this.layers[0].layout,B=D.get("line-join").evaluate(e,{}),G=D.get("line-cap"),X=D.get("line-miter-limit"),Y=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const Q of n)this.addLine(Q,e,B,G,X,Y,p,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,dashPositions:b,canonical:p})}addLine(e,n,l,p,_,b,A,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Yc(e,A?D.line.getGranularityForZoomLevel(A.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _e=0;_e<e.length-1;_e++)this.totalDistance+=e[_e].dist(e[_e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const B=cd.types[n.type]==="Polygon";let G=e.length;for(;G>=2&&e[G-1].equals(e[G-2]);)G--;let X=0;for(;X<G-1&&e[X].equals(e[X+1]);)X++;if(G<(B?3:2))return;l==="bevel"&&(_=1.05);const Y=this.overscaling<=16?122880/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray);let ie,re,ae,me,Fe;this.e1=this.e2=-1,B&&(ie=e[G-2],Fe=e[X].sub(ie)._unit()._perp());for(let _e=X;_e<G;_e++){if(ae=_e===G-1?B?e[X+1]:void 0:e[_e+1],ae&&e[_e].equals(ae))continue;Fe&&(me=Fe),ie&&(re=ie),ie=e[_e],Fe=ae?ae.sub(ie)._unit()._perp():me,me=me||Fe;let we=me.add(Fe);we.x===0&&we.y===0||we._unit();const Ge=me.x*Fe.x+me.y*Fe.y,Ye=we.x*Fe.x+we.y*Fe.y,St=Ye!==0?1/Ye:1/0,Wt=2*Math.sqrt(2-2*Ye),Vt=Ye<Wm&&re&&ae,en=me.x*Fe.y-me.y*Fe.x>0;if(Vt&&_e>X){const Ht=ie.dist(re);if(Ht>2*Y){const kt=ie.sub(ie.sub(re)._mult(Y/Ht)._round());this.updateDistance(re,kt),this.addCurrentVertex(kt,me,0,0,Q),re=kt}}const Sn=re&&ae;let sn=Sn?l:B?"butt":p;if(Sn&&sn==="round"&&(St<b?sn="miter":St<=2&&(sn="fakeround")),sn==="miter"&&St>_&&(sn="bevel"),sn==="bevel"&&(St>2&&(sn="flipbevel"),St<_&&(sn="miter")),re&&this.updateDistance(re,ie),sn==="miter")we._mult(St),this.addCurrentVertex(ie,we,0,0,Q);else if(sn==="flipbevel"){if(St>100)we=Fe.mult(-1);else{const Ht=St*me.add(Fe).mag()/me.sub(Fe).mag();we._perp()._mult(Ht*(en?-1:1))}this.addCurrentVertex(ie,we,0,0,Q),this.addCurrentVertex(ie,we.mult(-1),0,0,Q)}else if(sn==="bevel"||sn==="fakeround"){const Ht=-Math.sqrt(St*St-1),kt=en?Ht:0,Nn=en?0:Ht;if(re&&this.addCurrentVertex(ie,me,kt,Nn,Q),sn==="fakeround"){const In=Math.round(180*Wt/Math.PI/20);for(let On=1;On<In;On++){let An=On/In;if(An!==.5){const Qi=An-.5;An+=An*Qi*(An-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*Qi*Qi+(.848013+Ge*(.215638*Ge-1.06021)))}const Vn=Fe.sub(me)._mult(An)._add(me)._unit()._mult(en?-1:1);this.addHalfVertex(ie,Vn.x,Vn.y,!1,en,0,Q)}}ae&&this.addCurrentVertex(ie,Fe,-kt,-Nn,Q)}else if(sn==="butt")this.addCurrentVertex(ie,we,0,0,Q);else if(sn==="square"){const Ht=re?1:-1;this.addCurrentVertex(ie,we,Ht,Ht,Q)}else sn==="round"&&(re&&(this.addCurrentVertex(ie,me,0,0,Q),this.addCurrentVertex(ie,me,1,1,Q,!0)),ae&&(this.addCurrentVertex(ie,Fe,-1,-1,Q,!0),this.addCurrentVertex(ie,Fe,0,0,Q)));if(Vt&&_e<G-1){const Ht=ie.dist(ae);if(Ht>2*Y){const kt=ie.add(ae.sub(ie)._mult(Y/Ht)._round());this.updateDistance(ie,kt),this.addCurrentVertex(kt,Fe,0,0,Q),ie=kt}}}}addCurrentVertex(e,n,l,p,_,b=!1){const A=n.y*p-n.x,D=-n.y-n.x*p;this.addHalfVertex(e,n.x+n.y*l,n.y-n.x*l,b,!1,l,_),this.addHalfVertex(e,A,D,b,!0,-p,_),this.distance>hf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,l,p,_,b))}addHalfVertex({x:e,y:n},l,p,_,b,A,D){const B=.5*(this.lineClips?this.scaledDistance*(hf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(n<<1)+(b?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(A===0?0:A<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const G=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,G,this.e2),D.primitiveLength++),b?this.e2=G:this.e1=G}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const l=n.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,n,l,p){for(const _ of e){const b=_.paint.get("line-dasharray");if(!b||b.value.kind==="constant")continue;const A=_.layout.get("line-cap")==="round",D={dasharray:b.value.evaluate({zoom:l-1},n,{}),round:A},B={dasharray:b.value.evaluate({zoom:l},n,{}),round:A},G={dasharray:b.value.evaluate({zoom:l+1},n,{}),round:A},X=`${D.dasharray.join(",")},${D.round}`,Y=`${B.dasharray.join(",")},${B.round}`,Q=`${G.dasharray.join(",")},${G.round}`;p.dashDependencies[X]=D,p.dashDependencies[Y]=B,p.dashDependencies[Q]=G,n.dashes[_.id]={min:X,mid:Y,max:Q}}}}let Qc,Ys;Cn("LineBucket",ud,{omit:["layers","patternFeatures"]});var Jc={get paint(){return Ys=Ys||new os({"line-opacity":new Ln(Ke.paint_line["line-opacity"]),"line-color":new Ln(Ke.paint_line["line-color"]),"line-translate":new Dn(Ke.paint_line["line-translate"]),"line-translate-anchor":new Dn(Ke.paint_line["line-translate-anchor"]),"line-width":new Ln(Ke.paint_line["line-width"]),"line-gap-width":new Ln(Ke.paint_line["line-gap-width"]),"line-offset":new Ln(Ke.paint_line["line-offset"]),"line-blur":new Ln(Ke.paint_line["line-blur"]),"line-dasharray":new bo(Ke.paint_line["line-dasharray"]),"line-pattern":new bo(Ke.paint_line["line-pattern"]),"line-gradient":new ch(Ke.paint_line["line-gradient"])})},get layout(){return Qc=Qc||new os({"line-cap":new Dn(Ke.layout_line["line-cap"]),"line-join":new Ln(Ke.layout_line["line-join"]),"line-miter-limit":new Dn(Ke.layout_line["line-miter-limit"]),"line-round-limit":new Dn(Ke.layout_line["line-round-limit"]),"line-sort-key":new Ln(Ke.layout_line["line-sort-key"])})}};class hd extends Ln{possiblyEvaluate(e,n){return n=new cr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,p){return n=Tn({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,p)}}let Tl;class k0 extends Wr{constructor(e,n){super(e,Jc,n),this.gradientVersion=0,Tl||(Tl=new hd(Jc.paint.properties["line-width"].specification),Tl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof zt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Tl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new ud(e)}queryRadius(e){const n=e,l=wp(qc("line-width",this,n),qc("line-gap-width",this,n)),p=qc("line-offset",this,n);return l/2+Math.abs(p)+Yd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b}){const A=op(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,b),D=b/2*wp(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),B=this.paint.get("line-offset").evaluate(n,l);return B&&(p=(function(G,X){const Y=[];for(let Q=0;Q<G.length;Q++){const ie=lp(G[Q]),re=[];for(let ae=0;ae<ie.length;ae++){const me=ie[ae],Fe=ie[ae-1],_e=ie[ae+1],we=ae===0?new V(0,0):me.sub(Fe)._unit()._perp(),Ge=ae===ie.length-1?new V(0,0):_e.sub(me)._unit()._perp(),Ye=we._add(Ge)._unit(),St=Ye.x*Ge.x+Ye.y*Ge.y;St!==0&&Ye._mult(1/St),re.push(Ye._mult(X)._add(me))}Y.push(re)}return Y})(p,B*b)),(function(G,X,Y){for(let Q=0;Q<X.length;Q++){const ie=X[Q];if(G.length>=3){for(let re=0;re<ie.length;re++)if(_c(G,ie[re]))return!0}if(Zs(G,ie,Y))return!0}return!1})(A,p,D)}isTileClipped(){return!0}}function wp(i,e){return e>0?e+2*i:i}const Ym=Gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),df=Gr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const P0=Gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Gr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Co=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$m=Gr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Io(i,e,n){return i.sections.forEach((l=>{l.text=(function(p,_,b){const A=_.layout.get("text-transform").evaluate(b,{});return A==="uppercase"?p=p.toLocaleUpperCase():A==="lowercase"&&(p=p.toLocaleLowerCase()),_o.applyArabicShaping&&(p=_o.applyArabicShaping(p)),p})(l.text,e,n)})),i}Gr([{name:"triangle",components:3,type:"Uint16"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gr([{type:"Float32",name:"offsetX"}]),Gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Ls=24;const dd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},T1={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Cu={40:!0};function ff(i,e,n,l,p,_){if("fontStack"in e){const b=n[e.fontStack],A=b&&b[i];return A?A.metrics.advance*e.scale+p:0}{const b=l[e.imageName];return b?b.displaySize[0]*e.scale*Ls/_+p:0}}function Ep(i,e,n,l){const p=Math.pow(i-e,2);return l?i<e?p/2:2*p:p+Math.abs(n)*n}function fd(i,e,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function O0(i,e,n,l,p,_){let b=null,A=Ep(e,n,p,_);for(const D of l){const B=Ep(e-D.x,n,p,_)+D.badness;B<=A&&(b=D,A=B)}return{index:i,x:e,priorBreak:b,badness:A}}function z0(i){return i?z0(i.priorBreak).concat(i.index):[]}class wh{constructor(e="",n=[],l=[]){this.text=e,this.sections=n,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,n){const l=new wh;for(let p=0;p<e.sections.length;p++){const _=e.sections[p];_.image?l.addImageSection(_):l.addTextSection(_,n)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",l={premature:!0,value:void 0};const p=e[Symbol.iterator]();let _=p.next();const b=e[Symbol.iterator]();b.next();let A=b.next();for(;!_.done;)n+=!A.done&&_l(A.value.codePointAt(0))&&!dd[A.value]||!l.premature&&_l(l.value.codePointAt(0))&&!dd[l.value]||!dd[_.value]?_.value:dd[_.value],l={value:_.value,premature:!1},_=p.next(),A=b.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,l=this.text.match(/\S\s*$/),p=l?l[0].length-1:0;this.text=this.text.substring(n,this.text.length-p),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-p)}substring(e,n){const l=[...this.text].slice(e,n).join(""),p=this.sectionIndex.slice(e,n);return new wh(l,this.sections,p)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,l=0;for(let p=0;p<this.length();p++){const _=this.getSection(p);if("imageName"in _){const b=e[_.imageName];if(!b)continue;const A=b.displaySize;n=Math.max(n,A[0]),l=Math.max(l,A[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Qn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):Qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,l,p,_){const b=[],A=this.determineAverageLineWidth(e,n,l,p,_),D=this.hasZeroWidthSpaces();let B=0,G=0;const X=this.text[Symbol.iterator]();let Y=X.next();const Q=this.text[Symbol.iterator]();Q.next();let ie=Q.next();const re=this.text[Symbol.iterator]();re.next(),re.next();let ae=re.next();for(;!Y.done;){const me=this.getSection(G),Fe=Y.value.codePointAt(0);if(rh(Fe)||(B+=ff(Fe,me,l,p,e,_)),!ie.done){const _e=gl(Fe),we=ie.value.codePointAt(0);(T1[Fe]||_e||"imageName"in me||!ae.done&&Cu[we])&&b.push(O0(G+1,B,A,b,fd(Fe,we,_e&&D),!1))}G++,Y=X.next(),ie=Q.next(),ae=re.next()}return z0(O0(this.length(),B,A,b,0,!0))}determineAverageLineWidth(e,n,l,p,_){let b=0,A=0;for(const D of this.text){const B=this.getSection(A);b+=ff(D.codePointAt(0),B,l,p,e,_),A++}return b/Math.max(1,Math.ceil(b/n))}}const Sp=4294967296,pf=1/Sp,Tp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Ap{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,l=this.length){for(;this.pos<l;){const p=this.readVarint(),_=p>>3,b=this.pos;this.type=7&p,e(_,n,this),this.pos===b&&this.skip(p)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Sp;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Sp;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let l,p;return p=n[this.pos++],l=127&p,p<128?l:(p=n[this.pos++],l|=(127&p)<<7,p<128?l:(p=n[this.pos++],l|=(127&p)<<14,p<128?l:(p=n[this.pos++],l|=(127&p)<<21,p<128?l:(p=n[this.pos],l|=(15&p)<<28,(function(_,b,A){const D=A.buf;let B,G;if(G=D[A.pos++],B=(112&G)>>4,G<128||(G=D[A.pos++],B|=(127&G)<<3,G<128)||(G=D[A.pos++],B|=(127&G)<<10,G<128)||(G=D[A.pos++],B|=(127&G)<<17,G<128)||(G=D[A.pos++],B|=(127&G)<<24,G<128)||(G=D[A.pos++],B|=(1&G)<<31,G<128))return pd(_,B,b);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&Tp?Tp.decode(this.buf.subarray(n,e)):(function(l,p,_){let b="",A=p;for(;A<_;){const D=l[A];let B,G,X,Y=null,Q=D>239?4:D>223?3:D>191?2:1;if(A+Q>_)break;Q===1?D<128&&(Y=D):Q===2?(B=l[A+1],(192&B)==128&&(Y=(31&D)<<6|63&B,Y<=127&&(Y=null))):Q===3?(B=l[A+1],G=l[A+2],(192&B)==128&&(192&G)==128&&(Y=(15&D)<<12|(63&B)<<6|63&G,(Y<=2047||Y>=55296&&Y<=57343)&&(Y=null))):Q===4&&(B=l[A+1],G=l[A+2],X=l[A+3],(192&B)==128&&(192&G)==128&&(192&X)==128&&(Y=(15&D)<<18|(63&B)<<12|(63&G)<<6|63&X,(Y<=65535||Y>=1114112)&&(Y=null))),Y===null?(Y=65533,Q=1):Y>65535&&(Y-=65536,b+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),b+=String.fromCharCode(Y),A+=Q}return b})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*pf),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*pf),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,l){let p,_;if(n>=0?(p=n%4294967296|0,_=n/4294967296|0):(p=~(-n%4294967296),_=~(-n/4294967296),4294967295^p?p=p+1|0:(p=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(b,A,D){D.buf[D.pos++]=127&b|128,b>>>=7,D.buf[D.pos++]=127&b|128,b>>>=7,D.buf[D.pos++]=127&b|128,b>>>=7,D.buf[D.pos++]=127&b|128,D.buf[D.pos]=127&(b>>>=7)})(p,0,l),(function(b,A){const D=(7&b)<<4;A.buf[A.pos++]|=D|((b>>>=3)?128:0),b&&(A.buf[A.pos++]=127&b|((b>>>=7)?128:0),b&&(A.buf[A.pos++]=127&b|((b>>>=7)?128:0),b&&(A.buf[A.pos++]=127&b|((b>>>=7)?128:0),b&&(A.buf[A.pos++]=127&b|((b>>>=7)?128:0),b&&(A.buf[A.pos++]=127&b)))))})(_,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(p,_,b){for(let A,D,B=0;B<_.length;B++){if(A=_.charCodeAt(B),A>55295&&A<57344){if(!D){A>56319||B+1===_.length?(p[b++]=239,p[b++]=191,p[b++]=189):D=A;continue}if(A<56320){p[b++]=239,p[b++]=191,p[b++]=189,D=A;continue}A=D-55296<<10|A-56320|65536,D=null}else D&&(p[b++]=239,p[b++]=191,p[b++]=189,D=null);A<128?p[b++]=A:(A<2048?p[b++]=A>>6|192:(A<65536?p[b++]=A>>12|224:(p[b++]=A>>18|240,p[b++]=A>>12&63|128),p[b++]=A>>6&63|128),p[b++]=63&A|128)}return b})(this.buf,e,this.pos);const l=this.pos-n;l>=128&&Km(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let l=0;l<n;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,n){this.pos++;const l=this.pos;e(n,this);const p=this.pos-l;p>=128&&Km(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p}writeMessage(e,n,l){this.writeTag(e,2),this.writeRawMessage(n,l)}writePackedVarint(e,n){n.length&&this.writeMessage(e,Qm,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,Jm,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,eg,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,md,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,Cp,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,tg,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,ng,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,ig,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,rg,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function pd(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Km(i,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let p=n.pos-1;p>=i;p--)n.buf[p+l]=n.buf[p]}function Qm(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function Jm(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function md(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function Cp(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function eg(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function tg(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function ng(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function ig(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function rg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function sg(i,e,n){i===1&&n.readMessage(Ip,e)}function Ip(i,e,n){if(i===3){const{id:l,bitmap:p,width:_,height:b,left:A,top:D,advance:B}=n.readMessage(ag,{});e.push({id:l,bitmap:new Qd({width:_+6,height:b+6},p),metrics:{width:_,height:b,left:A,top:D,advance:B}})}}function ag(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function L0(i){let e=0,n=0;for(const b of i)e+=b.w*b.h,n=Math.max(n,b.w);i.sort(((b,A)=>A.h-b.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let p=0,_=0;for(const b of i)for(let A=l.length-1;A>=0;A--){const D=l[A];if(!(b.w>D.w||b.h>D.h)){if(b.x=D.x,b.y=D.y,_=Math.max(_,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===D.w&&b.h===D.h){const B=l.pop();B&&A<l.length&&(l[A]=B)}else b.h===D.h?(D.x+=b.w,D.w-=b.w):b.w===D.w?(D.y+=b.h,D.h-=b.h):(l.push({x:D.x+b.w,y:D.y,w:D.w-b.w,h:b.h}),D.y+=b.h,D.h-=b.h);break}}return{w:p,h:_,fill:e/(p*_)||0}}class Er{constructor(e,{pixelRatio:n,version:l,stretchX:p,stretchY:_,content:b,textFitWidth:A,textFitHeight:D}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=p,this.stretchY=_,this.content=b,this.version=l,this.textFitWidth=A,this.textFitHeight=D}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Mp{constructor(e,n){const l={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,l,_),this.addImages(n,p,_);const{w:b,h:A}=L0(_),D=new ja({width:b||1,height:A||1});for(const B in e){const G=e[B],X=l[B].paddedRect;ja.copy(G.data,D,{x:0,y:0},{x:X.x+1,y:X.y+1},G.data)}for(const B in n){const G=n[B],X=p[B].paddedRect,Y=X.x+1,Q=X.y+1,ie=G.data.width,re=G.data.height;ja.copy(G.data,D,{x:0,y:0},{x:Y,y:Q},G.data),ja.copy(G.data,D,{x:0,y:re-1},{x:Y,y:Q-1},{width:ie,height:1}),ja.copy(G.data,D,{x:0,y:0},{x:Y,y:Q+re},{width:ie,height:1}),ja.copy(G.data,D,{x:ie-1,y:0},{x:Y-1,y:Q},{width:1,height:re}),ja.copy(G.data,D,{x:0,y:0},{x:Y+ie,y:Q},{width:1,height:re})}this.image=D,this.iconPositions=l,this.patternPositions=p}addImages(e,n,l){for(const p in e){const _=e[p],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(b),n[p]=new Er(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[p,_]=e.tl;l.update(n.data,void 0,{x:p,y:_})}}var Iu;function mf(i,e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie){const re=wh.fromFeature(i,p);let ae;X===R.az.vertical&&re.verticalizePunctuation();let me=re.determineLineBreaks(B,_,e,l,Q);const{processBidirectionalText:Fe,processStyledBidirectionalText:_e}=_o;if(Fe&&re.sections.length===1){ae=[],me=me.map((St=>re.toCodeUnitIndex(St)));const Ye=Fe(re.toString(),me);for(const St of Ye){const Wt=[...St].map((()=>0));ae.push(new wh(St,re.sections,Wt))}}else if(_e){ae=[],me=me.map((Vt=>re.toCodeUnitIndex(Vt)));let Ye=0;const St=[];for(const Vt of re.text)St.push(...Array(Vt.length).fill(re.sectionIndex[Ye])),Ye++;const Wt=_e(re.text,St,me);for(const Vt of Wt){const en=[];let Sn="";for(const sn of Vt[0])en.push(Vt[1][Sn.length]),Sn+=sn;ae.push(new wh(Vt[0],re.sections,en))}}else ae=(function(Ye,St){const Wt=[];let Vt=0;for(const en of St)Wt.push(Ye.substring(Vt,en)),Vt=en;return Vt<Ye.length()&&Wt.push(Ye.substring(Vt,Ye.length())),Wt})(re,me);const we=[],Ge={positionedLines:we,text:re.toString(),top:G[1],bottom:G[1],left:G[0],right:G[0],writingMode:X,iconsInText:!1,verticalizable:!1};return(function(Ye,St,Wt,Vt,en,Sn,sn,Ht,kt,Nn,In,On){let An=0,Vn=0,Qi=0,zi=0;const is=Ht==="right"?1:Ht==="left"?0:.5,Ha=Ls/On;let Qs=0;for(const gr of en){gr.trim();const ys=gr.getMaxScale(),Ms={positionedGlyphs:[],lineOffset:0};Ye.positionedLines[Qs]=Ms;const Zr=Ms.positionedGlyphs;let Zo=0;if(!gr.length()){Vn+=Sn,++Qs;continue}const qa=A1(Vt,gr,Ha);let Xo=0;for(const va of gr.text){const cs=gr.getSection(Xo),Js=va.codePointAt(0),xs=Rp(kt,In,Js),wa={glyph:Js,imageName:null,x:An,y:Vn+-17,vertical:xs,scale:1,fontStack:"",sectionIndex:gr.getSectionIndex(Xo),metrics:null,rect:null};let Ah;if("fontStack"in cs){if(Ah=gd(cs,Js,xs,qa,St,Wt),!Ah)continue;wa.fontStack=cs.fontStack}else{if(Ye.iconsInText=!0,cs.scale*=Ha,Ah=F0(cs,xs,ys,qa,Vt),!Ah)continue;Zo=Math.max(Zo,Ah.imageOffset),wa.imageName=cs.imageName}const{rect:su,metrics:_m,baselineOffset:Ad}=Ah;wa.y+=Ad,wa.scale=cs.scale,wa.metrics=_m,wa.rect=su,Zr.push(wa),xs?(Ye.verticalizable=!0,An+=("imageName"in cs?_m.advance:Ls)*cs.scale+Nn):An+=_m.advance*cs.scale+Nn,Xo++}Zr.length!==0&&(Qi=Math.max(An-Nn,Qi),Dp(Zr,0,Zr.length-1,is)),An=0,Ms.lineOffset=Math.max(Zo,(ys-1)*Ls);const Tc=Sn*ys+Zo;Vn+=Tc,zi=Math.max(Tc,zi),++Qs}const{horizontalAlign:rs,verticalAlign:$r}=B0(sn);(function(gr,ys,Ms,Zr,Zo,qa,Xo,Tc,va){const cs=(ys-Ms)*Zo;let Js=0;Js=qa!==Xo?-Tc*Zr- -17:-Zr*va*Xo+.5*Xo;for(const xs of gr)for(const wa of xs.positionedGlyphs)wa.x+=cs,wa.y+=Js})(Ye.positionedLines,is,rs,$r,Qi,zi,Sn,Vn,en.length),Ye.top+=-$r*Vn,Ye.bottom=Ye.top+Vn,Ye.left+=-rs*Qi,Ye.right=Ye.left+Qi})(Ge,e,n,l,ae,b,A,D,X,B,Y,ie),!(function(Ye){for(const St of Ye)if(St.positionedGlyphs.length!==0)return!1;return!0})(we)&&Ge}function B0(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function A1(i,e,n){const l=e.getMaxScale()*Ls,{maxImageWidth:p,maxImageHeight:_}=e.getMaxImageSize(i),b=Math.max(l,_*n);return{verticalLineContentWidth:Math.max(l,p*n),horizontalLineContentHeight:b}}function og(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function Rp(i,e,n){return!(i===R.az.horizontal||!e&&!Lc(n)||e&&(rh(n)||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function gd(i,e,n,l,p,_){const b=_[i.fontStack],A=(function(B,G,X,Y){if(B&&B.rect)return B;const Q=G[X.fontStack],ie=Q&&Q[Y];return ie?{rect:null,metrics:ie.metrics}:null})(b&&b[e],p,i,e);if(A===null)return null;let D;if(n)D=l.verticalLineContentWidth-i.scale*Ls;else{const B=og(i.verticalAlign);D=(l.horizontalLineContentHeight-i.scale*Ls)*B}return{rect:A.rect,metrics:A.metrics,baselineOffset:D}}function F0(i,e,n,l,p){const _=p[i.imageName];if(!_)return null;const b=_.paddedRect,A=_.displaySize,D={width:A[0],height:A[1],left:1,top:-3,advance:e?A[1]:A[0]};let B;if(e)B=l.verticalLineContentWidth-A[1]*i.scale;else{const G=og(i.verticalAlign);B=(l.horizontalLineContentHeight-A[1]*i.scale)*G}return{rect:b,metrics:D,baselineOffset:B,imageOffset:(e?A[0]:A[1])*i.scale-Ls*n}}function Dp(i,e,n,l){if(l===0)return;const p=i[n],_=(i[n].x+p.metrics.advance*p.scale)*l;for(let b=e;b<=n;b++)i[b].x-=_}function j0(i,e,n){const{horizontalAlign:l,verticalAlign:p}=B0(n),_=e[0]-i.displaySize[0]*l,b=e[1]-i.displaySize[1]*p;return{image:i,top:b,bottom:b+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function eu(i){var e,n;let l=i.left,p=i.top,_=i.right-l,b=i.bottom-p;const A=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",D=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",B=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(D==="proportional"){if(A==="stretchOnly"&&_/b<B||A==="proportional"){const G=Math.ceil(b*B);l*=G/_,_=G}}else if(A==="proportional"&&D==="stretchOnly"&&B!==0&&_/b>B){const G=Math.ceil(_/B);p*=G/b,b=G}return{x1:l,y1:p,x2:l+_,y2:p+b}}function Ql(i,e,n,l,p,_){const b=i.image;let A;if(b.content){const ae=b.content,me=b.pixelRatio||1;A=[ae[0]/me,ae[1]/me,b.displaySize[0]-ae[2]/me,b.displaySize[1]-ae[3]/me]}const D=e.left*_,B=e.right*_;let G,X,Y,Q;n==="width"||n==="both"?(Q=p[0]+D-l[3],X=p[0]+B+l[1]):(Q=p[0]+(D+B-b.displaySize[0])/2,X=Q+b.displaySize[0]);const ie=e.top*_,re=e.bottom*_;return n==="height"||n==="both"?(G=p[1]+ie-l[0],Y=p[1]+re+l[2]):(G=p[1]+(ie+re-b.displaySize[1])/2,Y=G+b.displaySize[1]),{image:b,top:G,right:X,bottom:Y,left:Q,collisionPadding:A}}Cn("ImagePosition",Er),Cn("ImageAtlas",Mp),R.az=void 0,(Iu=R.az||(R.az={}))[Iu.none=0]="none",Iu[Iu.horizontal=1]="horizontal",Iu[Iu.vertical=2]="vertical",Iu[Iu.horizontalOnly=3]="horizontalOnly";const Ho=128,Mu=32640;function U0(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new cr(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=n;let _=0;for(;_<l.length&&l[_]<=i;)_++;_=Math.max(0,_-1);let b=_;for(;b<l.length&&l[b]<i+1;)b++;b=Math.min(l.length-1,b);const A=l[_],D=l[b];return n.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:D,interpolationType:p}:{kind:"camera",minZoom:A,maxZoom:D,minSize:n.evaluate(new cr(A)),maxSize:n.evaluate(new cr(D)),interpolationType:p}}}function Np(i,e,n){let l="never";const p=i.get(e);return p?l=p:i.get(n)&&(l="always"),l}const lg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gf(i,e,n,l,p,_,b,A,D,B,G,X,Y){const Q=A?Math.min(Mu,Math.round(A[0])):0,ie=A?Math.min(Mu,Math.round(A[1])):0;i.emplaceBack(e,n,Math.round(32*l),Math.round(32*p),_,b,(Q<<1)+(D?1:0),ie,16*B,16*G,256*X,256*Y)}function V0(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function G0(i){for(const e of i.sections)if(Gl(e.text))return!0;return!1}class kp{constructor(e){this.layoutVertexArray=new Ve,this.indexArray=new Ct,this.programConfigurations=e,this.segments=new En,this.dynamicLayoutVertexArray=new ut,this.opacityVertexArray=new Mt,this.hasVisibleVertices=!1,this.placedSymbolArray=new M}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ym.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,df.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,lg,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Cn("SymbolBuffers",kp);class Pp{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new En,this.collisionVertexArray=new At}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,P0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Cn("CollisionBuffers",Pp);class yd{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=U0(this.zoom,n["text-size"]),this.iconSizeData=U0(this.zoom,n["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=Np(l,"text-overlap","text-allow-overlap")!=="never"||Np(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((b=>R.az[b]))),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=e.sourceID}createArrays(){this.text=new kp(new yc(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new kp(new yc(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Z,this.lineVertexArray=new W,this.symbolInstances=new j,this.textAnchorOffsets=new J}calculateGlyphDependencies(e,n,l,p,_){for(const b of e)if(n[b.codePointAt(0)]=!0,(l||p)&&_){const A=dd[b];A&&(n[A.codePointAt(0)]=!0)}}populate(e,n,l){const p=this.layers[0],_=p.layout,b=_.get("text-font"),A=_.get("text-field"),D=_.get("icon-image"),B=(A.value.kind!=="constant"||A.value.value instanceof wi&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),G=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,X=_.get("symbol-sort-key");if(this.features=[],!B&&!G)return;const Y=n.iconDependencies,Q=n.glyphDependencies,ie=n.availableImages,re=new cr(this.zoom);for(const{feature:ae,id:me,index:Fe,sourceLayerIndex:_e}of e){const we=p._featureFilter.needGeometry,Ge=Vo(ae,we);if(!p._featureFilter.filter(re,Ge,l))continue;let Ye,St;if(we||(Ge.geometry=Yl(ae)),B){const Vt=p.getValueAndResolveTokens("text-field",Ge,l,ie),en=wi.factory(Vt),Sn=this.hasRTLText=this.hasRTLText||G0(en);(!Sn||_o.getRTLTextPluginStatus()==="unavailable"||Sn&&_o.isParsed())&&(Ye=Io(en,p,Ge))}if(G){const Vt=p.getValueAndResolveTokens("icon-image",Ge,l,ie);St=Vt instanceof ra?Vt:ra.fromString(Vt)}if(!Ye&&!St)continue;const Wt=this.sortFeaturesByKey?X.evaluate(Ge,{},l):void 0;if(this.features.push({id:me,text:Ye,icon:St,index:Fe,sourceLayerIndex:_e,geometry:Ge.geometry,properties:ae.properties,type:cd.types[ae.type],sortKey:Wt}),St&&(Y[St.name]=!0),Ye){const Vt=b.evaluate(Ge,{},l).join(","),en=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(R.az.vertical)>=0;for(const Sn of Ye.sections)if(Sn.image)Y[Sn.image.name]=!0;else{const sn=yl(Ye.toString()),Ht=Sn.fontStack||Vt,kt=Q[Ht]=Q[Ht]||{};this.calculateGlyphDependencies(Sn.text,kt,en,this.allowVerticalPlacement,sn)}}}_.get("symbol-placement")==="line"&&(this.features=(function(ae){const me={},Fe={},_e=[];let we=0;function Ge(Vt){_e.push(ae[Vt]),we++}function Ye(Vt,en,Sn){const sn=Fe[Vt];return delete Fe[Vt],Fe[en]=sn,_e[sn].geometry[0].pop(),_e[sn].geometry[0]=_e[sn].geometry[0].concat(Sn[0]),sn}function St(Vt,en,Sn){const sn=me[en];return delete me[en],me[Vt]=sn,_e[sn].geometry[0].shift(),_e[sn].geometry[0]=Sn[0].concat(_e[sn].geometry[0]),sn}function Wt(Vt,en,Sn){const sn=Sn?en[0][en[0].length-1]:en[0][0];return`${Vt}:${sn.x}:${sn.y}`}for(let Vt=0;Vt<ae.length;Vt++){const en=ae[Vt],Sn=en.geometry,sn=en.text?en.text.toString():null;if(!sn){Ge(Vt);continue}const Ht=Wt(sn,Sn),kt=Wt(sn,Sn,!0);if(Ht in Fe&&kt in me&&Fe[Ht]!==me[kt]){const Nn=St(Ht,kt,Sn),In=Ye(Ht,kt,_e[Nn].geometry);delete me[Ht],delete Fe[kt],Fe[Wt(sn,_e[In].geometry,!0)]=In,_e[Nn].geometry=null}else Ht in Fe?Ye(Ht,kt,Sn):kt in me?St(Ht,kt,Sn):(Ge(Vt),me[Ht]=we-1,Fe[kt]=we-1)}return _e.filter((Vt=>Vt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ae,me)=>ae.sortKey-me.sortKey))}update(e,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(n[e.segment+1]),_=e.dist(n[e.segment]);const b={};for(let A=e.segment+1;A<n.length;A++)b[A]={x:n[A].x,y:n[A].y,tileUnitDistanceFromAnchor:p},A<n.length-1&&(p+=n[A+1].dist(n[A]));for(let A=e.segment||0;A>=0;A--)b[A]={x:n[A].x,y:n[A].y,tileUnitDistanceFromAnchor:_},A>0&&(_+=n[A-1].dist(n[A]));for(let A=0;A<n.length;A++){const D=b[A];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,p,_,b,A,D,B,G,X,Y){const Q=e.indexArray,ie=e.layoutVertexArray,re=e.segments.prepareSegment(4*n.length,ie,Q,this.canOverlap?b.sortKey:void 0),ae=this.glyphOffsetArray.length,me=re.vertexLength,Fe=this.allowVerticalPlacement&&A===R.az.vertical?Math.PI/2:0,_e=b.text&&b.text.sections;for(let we=0;we<n.length;we++){const{tl:Ge,tr:Ye,bl:St,br:Wt,tex:Vt,pixelOffsetTL:en,pixelOffsetBR:Sn,minFontScaleX:sn,minFontScaleY:Ht,glyphOffset:kt,isSDF:Nn,sectionIndex:In}=n[we],On=re.vertexLength,An=kt[1];gf(ie,D.x,D.y,Ge.x,An+Ge.y,Vt.x,Vt.y,l,Nn,en.x,en.y,sn,Ht),gf(ie,D.x,D.y,Ye.x,An+Ye.y,Vt.x+Vt.w,Vt.y,l,Nn,Sn.x,en.y,sn,Ht),gf(ie,D.x,D.y,St.x,An+St.y,Vt.x,Vt.y+Vt.h,l,Nn,en.x,Sn.y,sn,Ht),gf(ie,D.x,D.y,Wt.x,An+Wt.y,Vt.x+Vt.w,Vt.y+Vt.h,l,Nn,Sn.x,Sn.y,sn,Ht),V0(e.dynamicLayoutVertexArray,D,Fe),Q.emplaceBack(On,On+2,On+1),Q.emplaceBack(On+1,On+2,On+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),we!==n.length-1&&In===n[we+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,b,b.index,{imagePositions:{},canonical:Y,formattedSection:_e&&_e[In]})}e.placedSymbolArray.emplaceBack(D.x,D.y,ae,this.glyphOffsetArray.length-ae,me,B,G,D.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],A,0,!1,0,X)}_addCollisionDebugVertex(e,n,l,p,_,b){return n.emplaceBack(0,0),e.emplaceBack(l.x,l.y,p,_,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(e,n,l,p,_,b,A){const D=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),B=D.vertexLength,G=_.layoutVertexArray,X=_.collisionVertexArray,Y=A.anchorX,Q=A.anchorY;this._addCollisionDebugVertex(G,X,b,Y,Q,new V(e,n)),this._addCollisionDebugVertex(G,X,b,Y,Q,new V(l,n)),this._addCollisionDebugVertex(G,X,b,Y,Q,new V(l,p)),this._addCollisionDebugVertex(G,X,b,Y,Q,new V(e,p)),D.vertexLength+=4;const ie=_.indexArray;ie.emplaceBack(B,B+1),ie.emplaceBack(B+1,B+2),ie.emplaceBack(B+2,B+3),ie.emplaceBack(B+3,B),D.primitiveLength+=4}addDebugCollisionBoxes(e,n,l,p){for(let _=e;_<n;_++){const b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pp(Et,Co.members,dn),this.iconCollisionBox=new Pp(Et,Co.members,dn);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,l,p,_,b,A,D,B){const G={};for(let X=n;X<l;X++){const Y=e.get(X);G.textBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},G.textFeatureIndex=Y.featureIndex;break}for(let X=p;X<_;X++){const Y=e.get(X);G.verticalTextBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},G.verticalTextFeatureIndex=Y.featureIndex;break}for(let X=b;X<A;X++){const Y=e.get(X);G.iconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},G.iconFeatureIndex=Y.featureIndex;break}for(let X=D;X<B;X++){const Y=e.get(X);G.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,anchorPointX:Y.anchorPointX,anchorPointY:Y.anchorPointY},G.verticalIconFeatureIndex=Y.featureIndex;break}return G}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),p=l.vertexStartIndex+4*l.numGlyphs;for(let _=l.vertexStartIndex;_<p;_+=4)e.indexArray.emplaceBack(_,_+2,_+1),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),p=[],_=[],b=[];for(let A=0;A<this.symbolInstances.length;++A){b.push(A);const D=this.symbolInstances.get(A);p.push(0|Math.round(n*D.anchorX+l*D.anchorY)),_.push(D.featureIndex)}return b.sort(((A,D)=>p[A]-p[D]||_[D]-_[A])),b}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((p,_,b)=>{p>=0&&b.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Op,zp;Cn("SymbolBucket",yd,{omit:["layers","collisionBoxArray","features","compareText"]}),yd.MAX_GLYPHS=65535,yd.addDynamicAttributes=V0;var H0={get paint(){return zp=zp||new os({"icon-opacity":new Ln(Ke.paint_symbol["icon-opacity"]),"icon-color":new Ln(Ke.paint_symbol["icon-color"]),"icon-halo-color":new Ln(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ln(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ln(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Dn(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dn(Ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ln(Ke.paint_symbol["text-opacity"]),"text-color":new Ln(Ke.paint_symbol["text-color"],{runtimeType:vs,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ln(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new Ln(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Ln(Ke.paint_symbol["text-halo-blur"]),"text-translate":new Dn(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new Dn(Ke.paint_symbol["text-translate-anchor"])})},get layout(){return Op=Op||new os({"symbol-placement":new Dn(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Dn(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dn(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ln(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dn(Ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Dn(Ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Dn(Ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Dn(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dn(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dn(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ln(Ke.layout_symbol["icon-size"]),"icon-text-fit":new Dn(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dn(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ln(Ke.layout_symbol["icon-image"]),"icon-rotate":new Ln(Ke.layout_symbol["icon-rotate"]),"icon-padding":new Ln(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Dn(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Ln(Ke.layout_symbol["icon-offset"]),"icon-anchor":new Ln(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dn(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dn(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dn(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new Ln(Ke.layout_symbol["text-field"]),"text-font":new Ln(Ke.layout_symbol["text-font"]),"text-size":new Ln(Ke.layout_symbol["text-size"]),"text-max-width":new Ln(Ke.layout_symbol["text-max-width"]),"text-line-height":new Dn(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Ln(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new Ln(Ke.layout_symbol["text-justify"]),"text-radial-offset":new Ln(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dn(Ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ln(Ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ln(Ke.layout_symbol["text-anchor"]),"text-max-angle":new Dn(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Dn(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new Ln(Ke.layout_symbol["text-rotate"]),"text-padding":new Dn(Ke.layout_symbol["text-padding"]),"text-keep-upright":new Dn(Ke.layout_symbol["text-keep-upright"]),"text-transform":new Ln(Ke.layout_symbol["text-transform"]),"text-offset":new Ln(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new Dn(Ke.layout_symbol["text-allow-overlap"]),"text-overlap":new Dn(Ke.layout_symbol["text-overlap"]),"text-ignore-placement":new Dn(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new Dn(Ke.layout_symbol["text-optional"])})}};class cg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:vi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Cn("FormatSectionOverride",cg,{omit:["defaultValue"]});class Ru extends Wr{constructor(e,n){super(e,H0,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const _ of l)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,l,p){const _=this.layout.get(e).evaluate(n,{},l,p),b=this._unevaluatedLayout._values[e];return b.isDataDriven()||uc(b.value)||!_?_:(function(A,D){return D.replace(/{([^{}]+)}/g,((B,G)=>A&&G in A?String(A[G]):""))})(n.properties,_)}createBucket(e){return new yd(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of H0.paint.overridableProperties){if(!Ru.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new cg(n),p=new qh(l,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new Ca("source",p):new hc("composite",p,n.value.zoomStops),this.paint._values[e]=new ro(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&Ru.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),p=H0.paint.properties[n];let _=!1;const b=A=>{for(const D of A)if(p.overrides&&p.overrides.hasOverride(D))return void(_=!0)};if(l.value.kind==="constant"&&l.value.value instanceof wi)b(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const A=B=>{_||(B instanceof Ns&&Nr(B.value)===Sr?b(B.value.sections):B instanceof ga?b(B.sections):B.eachChild(A))},D=l.value;D._styleExpression&&A(D._styleExpression.expression)}return _}}let ug;var hg={get paint(){return ug=ug||new os({"background-color":new Dn(Ke.paint_background["background-color"]),"background-pattern":new bu(Ke.paint_background["background-pattern"]),"background-opacity":new Dn(Ke.paint_background["background-opacity"])})}};class Wi extends Wr{constructor(e,n){super(e,hg,n)}}class q0 extends Wr{constructor(e,n){super(e,{},n),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Lp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Z0={once:!0},Bp=63710088e-1;class Ec{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ec(Mn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,p=e.lat*n,_=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((e.lng-this.lng)*n);return Bp*Math.acos(Math.min(_,1))}static convert(e){if(e instanceof Ec)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ec(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ec(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xd=2*Math.PI*Bp;function yf(i){return xd*Math.cos(i*Math.PI/180)}function dg(i){return(180+i)/360}function X0(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function fg(i,e){return i/yf(e)}function pg(i){return 360*i-180}function xf(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function W0(i,e){return i*yf(xf(e))}class pr{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=Ec.convert(e);return new pr(dg(l.lng),X0(l.lat),fg(n,l.lat))}toLngLat(){return new Ec(pg(this.x),xf(this.y))}toAltitude(){return W0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xd*(e=xf(this.y),1/Math.cos(e*Math.PI/180));var e}}function Fp(i,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class ua{constructor(e,n,l){if(!(function(p,_,b){return!(p<0||p>25||b<0||b>=Math.pow(2,p)||_<0||_>=Math.pow(2,p))})(e,n,l))throw new Error(`x=${n}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=l,this.key=_d(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,l){const p=(function(b,A,D){var B=Fp(256*b,256*(A=Math.pow(2,D)-A-1),D),G=Fp(256*(b+1),256*(A+1),D);return B[0]+","+B[1]+","+G[0]+","+G[1]})(this.x,this.y,this.z),_=(function(b,A,D){let B,G="";for(let X=b;X>0;X--)B=1<<X-1,G+=(A&B?1:0)+(D&B?2:0);return G})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,_).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new V((e.x*n-this.x)*mt,(e.y*n-this.y)*mt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mg{constructor(e,n){this.wrap=e,this.canonical=n,this.key=_d(e,n.z,n.z,n.x,n.y)}}class Mo{constructor(e,n,l,p,_){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=n,this.canonical=new ua(l,+p,+_),this.key=_d(n,e,l,p,_)}clone(){return new Mo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new Mo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mo(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?_d(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):_d(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Mo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new Mo(n,this.wrap,n,l,p),new Mo(n,this.wrap,n,l+1,p),new Mo(n,this.wrap,n,l,p+1),new Mo(n,this.wrap,n,l+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Mo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Mo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new pr(e.x-this.wrap,e.y))}}function _d(i,e,n,l,p){(i*=2)<0&&(i=-1*i-1);const _=1<<n;return(_*_*i+_*p+l).toString(36)+n.toString(36)+e.toString(36)}function _f(i,e){return e?i.properties[e]:i.id}function Y0(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const p=i.addOrUpdateProperties.findIndex((_=>_.key===l));p>-1&&i.addOrUpdateProperties.splice(p,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function bf(i){var e,n;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((p=>[p.id,p]))),l.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((p=>[p.id,p]))),l}Cn("CanonicalTileID",ua),Cn("OverscaledTileID",Mo,{omit:["terrainRttPosMatrix32f"]});class Du{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new Du;return n.extend(e(new V(this.minX,this.minY))),n.extend(e(new V(this.maxX,this.minY))),n.extend(e(new V(this.minX,this.maxY))),n.extend(e(new V(this.maxX,this.maxY))),n}static fromPoints(e){const n=new Du;for(const l of e)n.extend(l);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class $0{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class jp{constructor(e,n,l,p,_){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=p,this._z=n,this.properties=e.properties,this.id=_}projectPoint(e,n,l,p){return[360*(e.x+n)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/p)*Math.PI))-90]}projectLine(e,n,l,p){return e.map((_=>this.projectPoint(_,n,l,p)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),l=e.extent*this._x,p=e.extent*this._y,_=e.loadGeometry();switch(e.type){case 1:{const b=[];for(const D of _)b.push(D[0]);const A=this.projectLine(b,l,p,n);this._geometry=b.length===1?{type:"Point",coordinates:A[0]}:{type:"MultiPoint",coordinates:A};break}case 2:{const b=_.map((A=>this.projectLine(A,l,p,n)));this._geometry=b.length===1?{type:"LineString",coordinates:b[0]}:{type:"MultiLineString",coordinates:b};break}case 3:{const b=Xm(_),A=[];for(const D of b)A.push(D.map((B=>this.projectLine(B,l,p,n))));this._geometry=A.length===1?{type:"Polygon",coordinates:A[0]}:{type:"MultiPolygon",coordinates:A};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class Nu{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,l){this._name=e,this.dataBuffer=n,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Up extends Nu{}class Vp extends Up{getValueFromBuffer(e){return this.dataBuffer[e]}}class K0 extends Up{getValueFromBuffer(e){return this.dataBuffer[e]}}class Q0 extends Nu{delta;constructor(e,n,l,p){super(e,n,p),this.delta=l}}class J0 extends Q0{constructor(e,n,l,p){super(e,Int32Array.of(n),l,p)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class em extends Nu{constructor(e,n,l){super(e,Int32Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class ku{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,l,p,_=4096){this._name=e,this._geometryVector=n,this._idVector=l,this._propertyVectors=p,this._extent=_}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const p=e?.next().value,_={};for(const b of this.propertyVectors){if(!b)continue;const A=b.name,D=b.getValue(n);D!==null&&(_[A]=D)}n++,yield{id:l,geometry:p,properties:_}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const _={coordinates:n[l],type:this.geometryVector.geometryType(l)},b={};for(const A of this.propertyVectors){if(!A)continue;const D=A.name,B=A.getValue(l);B!==null&&(b[D]=B)}e.push({id:p,geometry:_,properties:b})}return e}containsMaxSaveIntegerValues(e){return e instanceof Vp||e instanceof em&&e instanceof J0||e instanceof K0}}class gg{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Ri,Jl,_a,ec,Pu,Ua,Is,$s,qo,co;function Ks(i,e,n){const l=new Int32Array(n);let p=0,_=e.get();for(let b=0;b<l.length;b++){let A=i[_++],D=127&A;A<128||(A=i[_++],D|=(127&A)<<7,A<128||(A=i[_++],D|=(127&A)<<14,A<128||(A=i[_++],D|=(127&A)<<21,A<128||(A=i[_++],D|=(15&A)<<28)))),l[p++]=D}return e.set(_),l}function vf(i,e,n){const l=new BigInt64Array(n);for(let p=0;p<l.length;p++)l[p]=Gp(i,e);return l}function yg(i,e){let n,l;return l=i[e.get()],e.increment(),n=127&l,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<7,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<14,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<21,l<128?n:(l=i[e.get()],n|=(15&l)<<28,(function(p,_,b){let A,D;if(D=_[b.get()],b.increment(),A=(112&D)>>4,D<128||(D=_[b.get()],b.increment(),A|=(127&D)<<3,D<128)||(D=_[b.get()],b.increment(),A|=(127&D)<<10,D<128)||(D=_[b.get()],b.increment(),A|=(127&D)<<17,D<128)||(D=_[b.get()],b.increment(),A|=(127&D)<<24,D<128)||(D=_[b.get()],b.increment(),A|=(1&D)<<31,D<128))return 4294967296*A+(p>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function bd(i,e,n,l){throw new Error("FastPFor is not implemented yet.")}function ba(i){return i>>>1^-(1&i)}function Eh(i){return i>>1n^-(1n&i)}function Gp(i,e){let n=0n,l=0,p=e.get();for(;p<i.length;){const _=i[p++];if(n|=BigInt(127&_)<<BigInt(l),!(128&_))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(p),n}function Sc(i,e,n){const l=new Int32Array(n);let p=0;for(let _=0;_<e;_++){const b=i[_];l.fill(i[_+e],p,p+b),p+=b}return l}function xg(i,e,n){const l=new BigInt64Array(n);let p=0;for(let _=0;_<e;_++){const b=Number(i[_]);l.fill(i[_+e],p,p+b),p+=b}return l}function _g(i,e,n){const l=new Float64Array(n);let p=0;for(let _=0;_<e;_++){const b=i[_];l.fill(i[_+e],p,p+b),p+=b}return l}function Ou(i){const e=i.length/4*4;let n=1;if(e>=4)for(let l=i[0];n<e-4;n+=4)l=i[n]+=l,l=i[n+1]+=l,l=i[n+2]+=l,l=i[n+3]+=l;for(;n!=i.length;)i[n]+=i[n-1],++n}function tm(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const l=i[n],p=i[n+1],_=i[n+2],b=i[n+3];i[n]=(l>>>1^-(1&l))+i[n-2],i[n+1]=(p>>>1^-(1&p))+i[n-1],i[n+2]=(_>>>1^-(1&_))+i[n],i[n+3]=(b>>>1^-(1&b))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(Ri||(Ri={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(Jl||(Jl={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(_a||(_a={}));class nm{_dictionaryType;_offsetType;_lengthType;constructor(e,n,l){this._dictionaryType=e,this._offsetType=n,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Va(i,e){const n=(function(l,p){const _=l[p.get()],b=Object.values(_a)[_>>4];let A=null;switch(b){case _a.DATA:A=new nm(Object.values(ec)[15&_]);break;case _a.OFFSET:A=new nm(null,Object.values(Pu)[15&_]);break;case _a.LENGTH:A=new nm(null,null,Object.values(Ua)[15&_])}p.increment();const D=l[p.get()],B=Object.values(Ri)[D>>5],G=Object.values(Ri)[D>>2&7],X=Object.values(Jl)[3&D];p.increment();const Y=Ks(l,p,2),Q=Y[0];return{physicalStreamType:b,logicalStreamType:A,logicalLevelTechnique1:B,logicalLevelTechnique2:G,physicalLevelTechnique:X,numValues:Q,byteLength:Y[1],decompressedCount:Q}})(i,e);return n.logicalLevelTechnique1===Ri.MORTON?(function(l,p,_){const b=Ks(p,_,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:b[0],coordinateShift:b[1]}})(n,i,e):Ri.RLE!==n.logicalLevelTechnique1&&Ri.RLE!==n.logicalLevelTechnique2||Jl.NONE===n.physicalLevelTechnique?n:(function(l,p,_){const b=Ks(p,_,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:b[1],runs:b[0],numRleValues:b[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(ec||(ec={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(Pu||(Pu={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Ua||(Ua={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Is||(Is={}));class tc{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const l=Math.floor(e/8);this.values[l]=this.values[l]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Ga(i,e,n,l,p){return(function(_,b,A){switch(b.logicalLevelTechnique1){case Ri.DELTA:return b.logicalLevelTechnique2===Ri.RLE?(function(D,B,G){const X=new Int32Array(G);let Y=0,Q=0;for(let ie=0;ie<B;ie++){const re=D[ie],ae=ba(D[ie+B]);for(let me=0;me<re;me++)Q+=ae,X[Y++]=Q}return X})(_,b.runs,b.numRleValues):((function(D){D[0]=D[0]>>>1^-(1&D[0]);const B=D.length/4*4;let G=1;if(B>=4)for(;G<B-4;G+=4){const X=D[G],Y=D[G+1],Q=D[G+2],ie=D[G+3];D[G]=(X>>>1^-(1&X))+D[G-1],D[G+1]=(Y>>>1^-(1&Y))+D[G],D[G+2]=(Q>>>1^-(1&Q))+D[G+1],D[G+3]=(ie>>>1^-(1&ie))+D[G+2]}for(;G!=D.length;++G)D[G]=(D[G]>>>1^-(1&D[G]))+D[G-1]})(_),_);case Ri.RLE:return(function(D,B,G){return G?(function(X,Y,Q){const ie=new Int32Array(Q);let re=0;for(let ae=0;ae<Y;ae++){const me=X[ae];let Fe=X[ae+Y];Fe=Fe>>>1^-(1&Fe),ie.fill(Fe,re,re+me),re+=me}return ie})(D,B.runs,B.numRleValues):Sc(D,B.runs,B.numRleValues)})(_,b,A);case Ri.MORTON:return Ou(_),_;case Ri.COMPONENTWISE_DELTA:return tm(_),_;case Ri.NONE:return A&&(function(D){for(let B=0;B<D.length;B++){const G=D[B];D[B]=G>>>1^-(1&G)}})(_),_;default:throw new Error(`The specified Logical level technique is not supported: ${b.logicalLevelTechnique1}`)}})(Hp(i,e,n),n,l)}function zu(i,e,n){return(function(l,p){if(p.logicalLevelTechnique1===Ri.DELTA&&p.logicalLevelTechnique2===Ri.NONE)return(function(b){const A=new Int32Array(b.length+1);A[0]=0,A[1]=ba(b[0]);let D=A[1],B=2;for(;B!=A.length;++B){const G=b[B-1];D+=G>>>1^-(1&G),A[B]=A[B-1]+D}return A})(l);if(p.logicalLevelTechnique1===Ri.RLE&&p.logicalLevelTechnique2===Ri.NONE)return(function(b,A,D){const B=new Int32Array(D+1);B[0]=0;let G=1,X=B[0];for(let Y=0;Y<A;Y++){const Q=b[Y],ie=b[Y+A];for(let re=G;re<G+Q;re++)B[re]=ie+X,X=B[re];G+=Q}return B})(l,p.runs,p.numRleValues);if(p.logicalLevelTechnique1===Ri.NONE&&p.logicalLevelTechnique2===Ri.NONE){(function(b){let A=0;for(let D=0;D<b.length;D++)b[D]+=A,A=b[D]})(l);const _=new Int32Array(p.numValues+1);return _[0]=0,_.set(l,1),_}if(p.logicalLevelTechnique1===Ri.DELTA&&p.logicalLevelTechnique2===Ri.RLE){const _=(function(b,A,D){const B=new Int32Array(D+1);B[0]=0;let G=1,X=B[0];for(let Y=0;Y<A;Y++){const Q=b[Y];let ie=b[Y+A];ie=ie>>>1^-(1&ie);for(let re=G;re<G+Q;re++)B[re]=ie+X,X=B[re];G+=Q}return B})(l,p.runs,p.numRleValues);return Ou(_),_}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Hp(i,e,n),n)}function Hp(i,e,n){const l=n.physicalLevelTechnique;if(l===Jl.FAST_PFOR)return bd();if(l===Jl.VARINT)return Ks(i,e,n.numValues);if(l===Jl.NONE){const p=e.get();e.add(n.byteLength);const _=i.subarray(p,e.get());return new Int32Array(_)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function im(i,e,n,l){const p=Hp(i,e,n);if(p.length===1){const _=p[0];return l?ba(_):_}return l?(function(_){return ba(_[1])})(p):(function(_){return _[1]})(p)}function rm(i,e,n){return(function(l){if(l.length==2){const p=ba(l[1]);return[p,p]}return[ba(l[2]),ba(l[3])]})(Hp(i,e,n))}function Sh(i,e,n){return(function(l){if(l.length==2){const p=Eh(l[1]);return[p,p]}return[Eh(l[2]),Eh(l[3])]})(vf(i,e,n.numValues))}function vd(i,e,n,l){return(function(p,_,b){switch(_.logicalLevelTechnique1){case Ri.DELTA:return _.logicalLevelTechnique2===Ri.RLE?(function(A,D,B){const G=new BigInt64Array(B);let X=0,Y=0n;for(let Q=0;Q<D;Q++){const ie=Number(A[Q]),re=Eh(A[Q+D]);for(let ae=0;ae<ie;ae++)Y+=re,G[X++]=Y}return G})(p,_.runs,_.numRleValues):((function(A){A[0]=A[0]>>1n^-(1n&A[0]);const D=A.length/4*4;let B=1;if(D>=4)for(;B<D-4;B+=4){const G=A[B],X=A[B+1],Y=A[B+2],Q=A[B+3];A[B]=(G>>1n^-(1n&G))+A[B-1],A[B+1]=(X>>1n^-(1n&X))+A[B],A[B+2]=(Y>>1n^-(1n&Y))+A[B+1],A[B+3]=(Q>>1n^-(1n&Q))+A[B+2]}for(;B!=A.length;++B)A[B]=(A[B]>>1n^-(1n&A[B]))+A[B-1]})(p),p);case Ri.RLE:return(function(A,D,B){return B?(function(G,X,Y){const Q=new BigInt64Array(Y);let ie=0;for(let re=0;re<X;re++){const ae=Number(G[re]);let me=G[re+X];me=me>>1n^-(1n&me),Q.fill(me,ie,ie+ae),ie+=ae}return Q})(A,D.runs,D.numRleValues):xg(A,D.runs,D.numRleValues)})(p,_,b);case Ri.NONE:return b&&(function(A){for(let D=0;D<A.length;D++){const B=A[D];A[D]=B>>1n^-(1n&B)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${_.logicalLevelTechnique1}`)}})(vf(i,e,n.numValues),n,l)}function sm(i,e,n,l){const p=vf(i,e,n.numValues);if(p.length===1){const _=p[0];return l?Eh(_):_}return l?(function(_){return Eh(_[1])})(p):(function(_){return _[1]})(p)}function am(i,e,n,l,p){return(function(_,b,A,D){switch(b.logicalLevelTechnique1){case Ri.DELTA:return b.logicalLevelTechnique2===Ri.RLE&&(_=Sc(_,b.runs,b.numRleValues)),(function(B,G){const X=new Int32Array(B.size());let Y=0;B.get(0)?(X[0]=B.get(0)?G[0]>>>1^-(1&G[0]):0,Y=1):X[0]=0;let Q=1;for(;Q!=X.length;++Q)X[Q]=B.get(Q)?X[Q-1]+(G[Y]>>>1^-(1&G[Y++])):X[Q-1];return X})(D,_);case Ri.RLE:return(function(B,G,X,Y){const Q=G;return X?(function(ie,re,ae){const me=new Int32Array(ie.size());let Fe=0;for(let _e=0;_e<ae;_e++){const we=re[_e];let Ge=re[_e+ae];Ge=Ge>>>1^-(1&Ge);for(let Ye=Fe;Ye<Fe+we;Ye++)ie.get(Ye)?me[Ye]=Ge:(me[Ye]=0,Fe++);Fe+=we}return me})(Y,B,Q.runs):(function(ie,re,ae){const me=new Int32Array(ie.size());let Fe=0;for(let _e=0;_e<ae;_e++){const we=re[_e],Ge=re[_e+ae];for(let Ye=Fe;Ye<Fe+we;Ye++)ie.get(Ye)?me[Ye]=Ge:(me[Ye]=0,Fe++);Fe+=we}return me})(Y,B,Q.runs)})(_,b,A,D);case Ri.MORTON:return Ou(_),_;case Ri.COMPONENTWISE_DELTA:return tm(_),_;case Ri.NONE:return _=A?(function(B,G){const X=new Int32Array(B.size());let Y=0,Q=0;for(;Q!=X.length;++Q)if(B.get(Q)){const ie=G[Y++];X[Q]=ie>>>1^-(1&ie)}else X[Q]=0;return X})(D,_):(function(B,G){const X=new Int32Array(B.size());let Y=0,Q=0;for(;Q!=X.length;++Q)X[Q]=B.get(Q)?G[Y++]:0;return X})(D,_),_;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===Jl.FAST_PFOR?bd():Ks(i,e,n.numValues),n,l,p)}function tu(i,e,n,l){const p=i.logicalLevelTechnique1;if(p===Ri.RLE)return i.runs===1?Is.CONST:Is.FLAT;const _=e instanceof tc?e.size():e;if(p===Ri.DELTA&&i.logicalLevelTechnique2===Ri.RLE){const b=i.runs,A=2;if(i.numRleValues!==_)return Is.FLAT;if(b===1)return Is.SEQUENCE;if(b===2){const D=l.get();let B;if(i.physicalLevelTechnique===Jl.VARINT)B=Ks(n,l,4);else{const G=l.get();B=new Int32Array(n.buffer,n.byteOffset+G,4)}if(l.set(D),B[2]===A&&B[3]===A)return Is.SEQUENCE}}return i.numValues===1?Is.CONST:Is.FLAT}class wd extends Up{getValueFromBuffer(e){return this.dataBuffer[e]}}class om extends Q0{constructor(e,n,l,p){super(e,BigInt64Array.of(n),l,p)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class nu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,l){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function wf(i,e,n){return{x:qp(i,e)-n,y:qp(i>>1,e)-n}}function qp(i,e){let n=0;for(let l=0;l<e;l++)n|=(i&1<<2*l)>>l;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})($s||($s={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(qo||(qo={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(co||(co={}));class Zp{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function lm(i){const e=new Array(i.numGeometries);let n=1,l=1,p=1,_=0;const b=new Zp;let A=0,D=0;const B=i.mortonSettings,G=i.topologyVector,X=G.geometryOffsets,Y=G.partOffsets,Q=G.ringOffsets,ie=i.vertexOffsets,re=i.containsPolygonGeometry(),ae=i.vertexBuffer;for(let me=0;me<i.numGeometries;me++){const Fe=i.geometryType(me);if(Fe===$s.POINT){if(ie&&ie.length!==0)if(i.vertexBufferType===co.VEC_2){const _e=2*ie[D++],we=new V(ae[_e],ae[_e+1]);e[_++]=b.createPoint(we)}else{const _e=wf(ae[ie[D++]],B.numBits,B.coordinateShift),we=new V(_e.x,_e.y);e[_++]=b.createPoint(we)}else{const _e=new V(ae[A++],ae[A++]);e[_++]=b.createPoint(_e)}X&&p++,Y&&n++,Q&&l++}else if(Fe===$s.MULTIPOINT){const _e=X[p]-X[p-1];p++;const we=new Array(_e);if(ie&&ie.length!==0){for(let Ge=0;Ge<_e;Ge++){const Ye=2*ie[D++];we[Ge]=new V(ae[Ye],ae[Ye+1])}e[_++]=b.createMultiPoint(we)}else{for(let Ge=0;Ge<_e;Ge++){const Ye=ae[A++],St=ae[A++];we[Ge]=new V(Ye,St)}e[_++]=b.createMultiPoint(we)}}else if(Fe===$s.LINESTRING){let _e,we=0;re?(we=Q[l]-Q[l-1],l++):we=Y[n]-Y[n-1],n++,ie&&ie.length!==0?(_e=i.vertexBufferType===co.VEC_2?Tf(ae,ie,D,we,!1):um(ae,ie,D,we,!1,B),D+=we):(_e=cm(ae,A,we,!1),A+=2*we),e[_++]=b.createLineString(_e),X&&p++}else if(Fe===$s.POLYGON){const _e=Y[n]-Y[n-1];n++;const we=new Array(_e-1);let Ge=Q[l]-Q[l-1];if(l++,ie&&ie.length!==0){const Ye=i.vertexBufferType===co.VEC_2?Xp(ae,ie,D,Ge):Sf(ae,ie,D,Ge,0,B);D+=Ge;for(let St=0;St<we.length;St++)Ge=Q[l]-Q[l-1],l++,we[St]=i.vertexBufferType===co.VEC_2?Xp(ae,ie,D,Ge):Sf(ae,ie,D,Ge,0,B),D+=Ge;e[_++]=b.createPolygon(Ye,we)}else{const Ye=Ef(ae,A,Ge);A+=2*Ge;for(let St=0;St<we.length;St++)Ge=Q[l]-Q[l-1],l++,we[St]=Ef(ae,A,Ge),A+=2*Ge;e[_++]=b.createPolygon(Ye,we)}X&&p++}else if(Fe===$s.MULTILINESTRING){const _e=X[p]-X[p-1];p++;const we=new Array(_e);if(ie&&ie.length!==0){for(let Ge=0;Ge<_e;Ge++){let Ye=0;re?(Ye=Q[l]-Q[l-1],l++):Ye=Y[n]-Y[n-1],n++;const St=i.vertexBufferType===co.VEC_2?Tf(ae,ie,D,Ye,!1):um(ae,ie,D,Ye,!1,B);we[Ge]=St,D+=Ye}e[_++]=b.createMultiLineString(we)}else{for(let Ge=0;Ge<_e;Ge++){let Ye=0;re?(Ye=Q[l]-Q[l-1],l++):Ye=Y[n]-Y[n-1],n++,we[Ge]=cm(ae,A,Ye,!1),A+=2*Ye}e[_++]=b.createMultiLineString(we)}}else{if(Fe!==$s.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const _e=X[p]-X[p-1];p++;const we=new Array(_e);let Ge=0;if(ie&&ie.length!==0){for(let Ye=0;Ye<_e;Ye++){const St=Y[n]-Y[n-1];n++;const Wt=new Array(St-1);Ge=Q[l]-Q[l-1],l++;const Vt=i.vertexBufferType===co.VEC_2?Xp(ae,ie,D,Ge):Sf(ae,ie,D,Ge,0,B);D+=Ge;for(let en=0;en<Wt.length;en++)Ge=Q[l]-Q[l-1],l++,Wt[en]=i.vertexBufferType===co.VEC_2?Xp(ae,ie,D,Ge):Sf(ae,ie,D,Ge,0,B),D+=Ge;we[Ye]=b.createPolygon(Vt,Wt)}e[_++]=b.createMultiPolygon(we)}else{for(let Ye=0;Ye<_e;Ye++){const St=Y[n]-Y[n-1];n++;const Wt=new Array(St-1);Ge=Q[l]-Q[l-1],l++;const Vt=Ef(ae,A,Ge);A+=2*Ge;for(let en=0;en<Wt.length;en++){const Sn=Q[l]-Q[l-1];l++,Wt[en]=Ef(ae,A,Sn),A+=2*Sn}we[Ye]=b.createPolygon(Vt,Wt)}e[_++]=b.createMultiPolygon(we)}}}}return e}function Ef(i,e,n){return cm(i,e,n,!0)}function Xp(i,e,n,l){return Tf(i,e,n,l,!0)}function Sf(i,e,n,l,p,_){return um(i,e,n,l,!0,_)}function cm(i,e,n,l){const p=new Array(l?n+1:n);for(let _=0;_<2*n;_+=2)p[_/2]=new V(i[e+_],i[e+_+1]);return l&&(p[p.length-1]=p[0]),p}function Tf(i,e,n,l,p){const _=new Array(p?l+1:l);for(let b=0;b<2*l;b+=2){const A=2*e[n+b/2];_[b/2]=new V(i[A],i[A+1])}return p&&(_[_.length-1]=_[0]),_}function um(i,e,n,l,p,_){const b=new Array(p?l+1:l);for(let A=0;A<l;A++){const D=wf(i[e[n+A]],_.numBits,_.coordinateShift);b[A]=new V(D.x,D.y)}return p&&(b[b.length-1]=b[0]),b}class Af{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,l,p,_){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=l,this._vertexBuffer=p,this._mortonSettings=_}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=lm(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=wf(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return lm(this)}get mortonSettings(){return this._mortonSettings}}class Cf extends Af{_numGeometries;_geometryType;constructor(e,n,l,p,_,b,A){super(l,p,_,b,A),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===$s.POLYGON||this._geometryType===$s.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class If extends Af{_geometryTypes;constructor(e,n,l,p,_,b){super(e,l,p,_,b),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===$s.POLYGON||this.geometryType(e)===$s.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class bg{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,l,p){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=l,this._topologyVector=p}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,l=n.partOffsets,p=n.ringOffsets,_=n.geometryOffsets;let b=0,A=1,D=1,B=1;for(let G=0;G<this.numGeometries;G++)switch(this.geometryType(G)){case $s.POLYGON:{const X=l[A]-l[A-1];A++;const Y=[];for(let Q=0;Q<X;Q++){const ie=p[D]-p[D-1];D++;const re=[];for(let ae=0;ae<ie;ae++){const me=this._vertexBuffer[b++],Fe=this._vertexBuffer[b++];re.push(new V(me,Fe))}re.length>0&&re.push(re[0]),Y.push(re)}e[G]=Y,_&&B++}break;case $s.MULTIPOLYGON:{const X=_[B]-_[B-1];B++;const Y=[];for(let Q=0;Q<X;Q++){const ie=l[A]-l[A-1];A++;for(let re=0;re<ie;re++){const ae=p[D]-p[D-1];D++;const me=[];for(let Fe=0;Fe<ae;Fe++){const _e=this._vertexBuffer[b++],we=this._vertexBuffer[b++];me.push(new V(_e,we))}me.length>0&&me.push(me[0]),Y.push(me)}}e[G]=Y}}return e}[Symbol.iterator](){return null}}function Ed(i,e,n,l,p,_){return new C1(i,e,n,l,p,_)}class C1 extends bg{_numGeometries;_geometryType;constructor(e,n,l,p,_,b){super(l,p,_,b),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function hm(i,e,n,l,p){return new vg(i,e,n,l,p)}class vg extends bg{_geometryTypes;constructor(e,n,l,p,_){super(n,l,p,_),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function wg(i,e,n,l,p){const _=Va(i,n);let b=null,A=null,D=null,B=null,G=null,X=null,Y=null,Q=null;if(tu(_,l,i,n)===Is.CONST){const re=im(i,n,_,!1);for(let ae=0;ae<e-1;ae++){const me=Va(i,n);switch(me.physicalStreamType){case _a.LENGTH:switch(me.logicalStreamType.lengthType){case Ua.GEOMETRIES:b=zu(i,n,me);break;case Ua.PARTS:A=zu(i,n,me);break;case Ua.RINGS:D=zu(i,n,me);break;case Ua.TRIANGLES:Y=zu(i,n,me)}break;case _a.OFFSET:switch(me.logicalStreamType.offsetType){case Pu.VERTEX:B=Ga(i,n,me,!1);break;case Pu.INDEX:Q=Ga(i,n,me,!1)}break;case _a.DATA:ec.VERTEX===me.logicalStreamType.dictionaryType?G=Ga(i,n,me,!0):(X={numBits:me.numBits,coordinateShift:me.coordinateShift},G=Ga(i,n,me,!1))}}return Q!==null?b!=null||A!=null?Ed(l,re,Y,Q,G,new nu(b,A,D)):Ed(l,re,Y,Q,G):X===null?(function(ae,me,Fe,_e,we){return new Cf(ae,me,co.VEC_2,Fe,_e,we)})(l,re,new nu(b,A,D),B,G):(function(ae,me,Fe,_e,we,Ge){return new Cf(ae,me,co.MORTON,Fe,_e,we,Ge)})(l,re,new nu(b,A,D),B,G,X)}const ie=Ga(i,n,_,!1);for(let re=0;re<e-1;re++){const ae=Va(i,n);switch(ae.physicalStreamType){case _a.LENGTH:switch(ae.logicalStreamType.lengthType){case Ua.GEOMETRIES:b=Ga(i,n,ae,!1);break;case Ua.PARTS:A=Ga(i,n,ae,!1);break;case Ua.RINGS:D=Ga(i,n,ae,!1);break;case Ua.TRIANGLES:Y=zu(i,n,ae)}break;case _a.OFFSET:switch(ae.logicalStreamType.offsetType){case Pu.VERTEX:B=Ga(i,n,ae,!1);break;case Pu.INDEX:Q=Ga(i,n,ae,!1)}break;case _a.DATA:ec.VERTEX===ae.logicalStreamType.dictionaryType?G=Ga(i,n,ae,!0):(X={numBits:ae.numBits,coordinateShift:ae.coordinateShift},G=Ga(i,n,ae,!1))}}return Q!==null&&A===null?hm(ie,Y,Q,G):(b!==null?(b=Wp(ie,b,2),A!==null&&D!==null?(A=Yp(ie,b,A,!1),D=(function(re,ae,me,Fe){const _e=new Int32Array(me[me.length-1]+1);let we=0;_e[0]=we;let Ge=1,Ye=1,St=0;for(let Wt=0;Wt<re.length;Wt++){const Vt=re[Wt],en=ae[Wt+1]-ae[Wt];if(Vt!==0&&Vt!==3)for(let Sn=0;Sn<en;Sn++){const sn=me[Ge]-me[Ge-1];Ge++;for(let Ht=0;Ht<sn;Ht++)we=_e[Ye++]=we+Fe[St++]}else for(let Sn=0;Sn<en;Sn++)_e[Ye++]=++we,Ge++}return _e})(ie,b,A,D)):A!==null&&(A=(function(re,ae,me){const Fe=new Int32Array(ae[ae.length-1]+1);let _e=0;Fe[0]=_e;let we=1,Ge=0;for(let Ye=0;Ye<re.length;Ye++){const St=re[Ye],Wt=ae[Ye+1]-ae[Ye];if(St===4||St===1)for(let Vt=0;Vt<Wt;Vt++)_e=Fe[we++]=_e+me[Ge++];else for(let Vt=0;Vt<Wt;Vt++)Fe[we++]=++_e}return Fe})(ie,b,A))):A!==null&&D!==null?(A=Wp(ie,A,1),D=Yp(ie,A,D,!0)):A!==null&&(A=Wp(ie,A,0)),Q!==null?hm(ie,Y,Q,G,new nu(b,A,D)):X===null?(function(re,ae,me,Fe){return new If(co.VEC_2,re,ae,me,Fe)})(ie,new nu(b,A,D),B,G):(function(re,ae,me,Fe,_e){return new If(co.MORTON,re,ae,me,Fe,_e)})(ie,new nu(b,A,D),B,G,X))}function Wp(i,e,n){const l=new Int32Array(i.length+1);let p=0;l[0]=p;let _=0;for(let b=0;b<i.length;b++)p=l[b+1]=p+(i[b]>n?e[_++]:1);return l}function Yp(i,e,n,l){const p=new Int32Array(e[e.length-1]+1);let _=0;p[0]=_;let b=1,A=0;for(let D=0;D<i.length;D++){const B=i[D],G=e[D+1]-e[D];if(B===5||B===2||l&&(B===4||B===1))for(let X=0;X<G;X++)_=p[b++]=_+n[A++];else for(let X=0;X<G;X++)p[b++]=++_}return p}class Eg extends Nu{dataVector;constructor(e,n,l){super(e,n.getBuffer(),l),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class Sg extends Up{getValueFromBuffer(e){return this.dataBuffer[e]}}class Mf extends Nu{constructor(e,n,l){super(e,BigInt64Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Rf(i,e,n){return Tg(i,Math.ceil(e/8),n)}function Tg(i,e,n){const l=new Uint8Array(e);let p=0;for(;p<e;){const _=i[n.increment()];if(_<=127){const b=_+3,A=i[n.increment()],D=p+b;l.fill(A,p,D),p=D}else{const b=256-_;for(let A=0;A<b;A++)l[p++]=i[n.increment()]}}return l}const dm=new TextDecoder;function Df(i,e,n){return n-e>=12?dm.decode(i.subarray(e,n)):(function(l,p,_){let b="",A=p;for(;A<_;){const D=l[A];let B,G,X,Y=null,Q=D>239?4:D>223?3:D>191?2:1;if(A+Q>_)break;Q===1?D<128&&(Y=D):Q===2?(B=l[A+1],(192&B)==128&&(Y=(31&D)<<6|63&B,Y<=127&&(Y=null))):Q===3?(B=l[A+1],G=l[A+2],(192&B)==128&&(192&G)==128&&(Y=(15&D)<<12|(63&B)<<6|63&G,(Y<=2047||Y>=55296&&Y<=57343)&&(Y=null))):Q===4&&(B=l[A+1],G=l[A+2],X=l[A+3],(192&B)==128&&(192&G)==128&&(192&X)==128&&(Y=(15&D)<<18|(63&B)<<12|(63&G)<<6|63&X,(Y<=65535||Y>=1114112)&&(Y=null))),Y===null?(Y=65533,Q=1):Y>65535&&(Y-=65536,b+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),b+=String.fromCharCode(Y),A+=Q}return b})(i,e,n)}class Sd extends Nu{offsetBuffer;constructor(e,n,l,p){super(e,l,p),this.offsetBuffer=n}}class $p extends Sd{textEncoder;constructor(e,n,l,p){super(e,n,l,p??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Df(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Th extends Sd{indexBuffer;textEncoder;constructor(e,n,l,p,_){super(e,l,p,_??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Df(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class Kp extends Sd{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,l,p,_,b,A){super(e,l,p,A),this.indexBuffer=n,this.symbolOffsetBuffer=_,this.symbolTableBuffer=b,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(l,p,_){const b=[],A=new Array(p.length).fill(0);for(let D=1;D<p.length;D++)A[D]=A[D-1]+p[D-1];for(let D=0;D<_.length;D++)if(_[D]===255)b.push(_[++D]);else{const B=p[_[D]],G=A[_[D]];for(let X=0;X<B;X++)b.push(l[G+X])}return new Uint8Array(b)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Df(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let l=e[0];for(let p=1;p<e.length;p++){const _=e[p];n[p-1]=_-l,l=_}return n}}function Lu(i,e,n,l,p,_){return n.type==="scalarType"?(function(b,A,D,B,G,X){let Y=null,Q=0;if(b===0)return null;if(X.nullable){const re=Va(A,D);Q=re.numValues;const ae=D.get(),me=Rf(A,Q,D);D.set(ae+re.byteLength),Y=new tc(me,re.numValues)}const ie=Y??B;switch(G.physicalType){case 4:case 3:return(function(re,ae,me,Fe,_e){const we=Va(re,ae),Ge=tu(we,_e,re,ae),Ye=Fe.physicalType===3;if(Ge===Is.FLAT){const St=Al(_e)?am(re,ae,we,Ye,_e):Ga(re,ae,we,Ye);return new Vp(me.name,St,_e)}if(Ge===Is.SEQUENCE){const St=rm(re,ae,we);return new J0(me.name,St[0],St[1],we.numRleValues)}{const St=im(re,ae,we,Ye);return new em(me.name,St,_e)}})(A,D,X,G,ie);case 9:return(function(re,ae,me,Fe,_e){let we=null,Ge=null,Ye=null,St=null,Wt=null,Vt=null,en=null,Sn=null;for(let sn=0;sn<Fe;sn++){const Ht=Va(ae,me);if(Ht.byteLength!==0)switch(Ht.physicalStreamType){case _a.PRESENT:{const kt=Rf(ae,Ht.numValues,me);Vt=new tc(kt,Ht.numValues);break}case _a.OFFSET:Ge=_e!=null||Vt!=null?am(ae,me,Ht,!1,_e??Vt):Ga(ae,me,Ht,!1);break;case _a.LENGTH:{const kt=zu(ae,me,Ht);Ua.DICTIONARY===Ht.logicalStreamType.lengthType?we=kt:Ua.SYMBOL===Ht.logicalStreamType.lengthType?St=kt:en=kt;break}case _a.DATA:{const kt=ae.subarray(me.get(),me.get()+Ht.byteLength);me.add(Ht.byteLength);const Nn=Ht.logicalStreamType.dictionaryType;ec.FSST===Nn?Wt=kt:ec.SINGLE===Nn||ec.SHARED===Nn?Ye=kt:ec.NONE===Nn&&(Sn=kt);break}}}return(function(sn,Ht,kt,Nn,In,On,An){return Ht?new Kp(sn,kt,Nn,In,On,Ht,An):null})(re,Wt,Ge,we,Ye,St,_e??Vt)??(function(sn,Ht,kt,Nn,In){return Ht?In?new Th(sn,kt,Nn,Ht,In):new Th(sn,kt,Nn,Ht):null})(re,Ye,Ge,we,_e??Vt)??(function(sn,Ht,kt,Nn,In){if(!Ht||!kt)return null;if(Nn)return In?new Th(sn,Nn,Ht,kt,In):new Th(sn,Nn,Ht,kt);if(In&&In.size()!==Ht.length-1){const On=new Int32Array(In.size());let An=0;for(let Vn=0;Vn<In.size();Vn++)On[Vn]=In.get(Vn)?An++:0;return new Th(sn,On,Ht,kt,In)}return In?new $p(sn,Ht,kt,In):new $p(sn,Ht,kt)})(re,en,Sn,Ge,_e??Vt)})(X.name,A,D,X.nullable?b-1:b,Y);case 0:return(function(re,ae,me,Fe,_e){const we=Va(re,ae),Ge=we.numValues,Ye=ae.get(),St=Al(_e)?(function(Vt,en,Sn,sn){const Ht=Tg(Vt,Math.ceil(en/8),Sn),kt=new tc(Ht,en),Nn=sn.size(),In=new tc(new Uint8Array(Nn),Nn);let On=0;for(let An=0;An<sn.size();An++){const Vn=!!sn.get(An)&&kt.get(On++);In.set(An,Vn)}return In.getBuffer()})(re,Ge,ae,_e):Rf(re,Ge,ae);ae.set(Ye+we.byteLength);const Wt=new tc(St,Ge);return new Eg(me.name,Wt,_e)})(A,D,X,0,ie);case 6:case 5:return(function(re,ae,me,Fe,_e){const we=Va(re,ae),Ge=tu(we,Fe,re,ae),Ye=_e.physicalType===5;if(Ge===Is.FLAT){const St=Al(Fe)?(function(Wt,Vt,en,Sn,sn){return(function(Ht,kt,Nn,In){switch(kt.logicalLevelTechnique1){case Ri.DELTA:return kt.logicalLevelTechnique2===Ri.RLE&&(Ht=xg(Ht,kt.runs,kt.numRleValues)),(function(On,An){const Vn=new BigInt64Array(On.size());let Qi=0;On.get(0)?(Vn[0]=On.get(0)?An[0]>>1n^-(1n&An[0]):0n,Qi=1):Vn[0]=0n;let zi=1;for(;zi!=Vn.length;++zi)Vn[zi]=On.get(zi)?Vn[zi-1]+(An[Qi]>>1n^-(1n&An[Qi++])):Vn[zi-1];return Vn})(In,Ht);case Ri.RLE:return(function(On,An,Vn,Qi){const zi=An;return Vn?(function(is,Ha,Qs){const rs=new BigInt64Array(is.size());let $r=0;for(let gr=0;gr<Qs;gr++){const ys=Number(Ha[gr]);let Ms=Ha[gr+Qs];Ms=Ms>>1n^-(1n&Ms);for(let Zr=$r;Zr<$r+ys;Zr++)is.get(Zr)?rs[Zr]=Ms:(rs[Zr]=0n,$r++);$r+=ys}return rs})(Qi,On,zi.runs):(function(is,Ha,Qs){const rs=new BigInt64Array(is.size());let $r=0;for(let gr=0;gr<Qs;gr++){const ys=Number(Ha[gr]),Ms=Ha[gr+Qs];for(let Zr=$r;Zr<$r+ys;Zr++)is.get(Zr)?rs[Zr]=Ms:(rs[Zr]=0n,$r++);$r+=ys}return rs})(Qi,On,zi.runs)})(Ht,kt,Nn,In);case Ri.NONE:return Ht=Nn?(function(On,An){const Vn=new BigInt64Array(On.size());let Qi=0,zi=0;for(;zi!=Vn.length;++zi)if(On.get(zi)){const is=An[Qi++];Vn[zi]=is>>1n^-(1n&is)}else Vn[zi]=0n;return Vn})(In,Ht):(function(On,An){const Vn=new BigInt64Array(On.size());let Qi=0,zi=0;for(;zi!=Vn.length;++zi)Vn[zi]=On.get(zi)?An[Qi++]:0n;return Vn})(In,Ht),Ht;default:throw new Error("The specified Logical level technique is not supported")}})(vf(Wt,Vt,en.numValues),en,Sn,sn)})(re,ae,we,Ye,Fe):vd(re,ae,we,Ye);return new wd(me.name,St,Fe)}if(Ge===Is.SEQUENCE){const St=Sh(re,ae,we);return new om(me.name,St[0],St[1],we.numRleValues)}{const St=sm(re,ae,we,Ye);return new Mf(me.name,St,Fe)}})(A,D,X,ie,G);case 7:return(function(re,ae,me,Fe){const _e=Va(re,ae),we=Al(Fe)?(function(Ge,Ye,St,Wt){const Vt=Ye.get(),en=Vt+Wt*Float32Array.BYTES_PER_ELEMENT,Sn=new Uint8Array(Ge.subarray(Vt,en)).buffer,sn=new Float32Array(Sn);Ye.set(en);const Ht=St.size(),kt=new Float32Array(Ht);let Nn=0;for(let In=0;In<Ht;In++)kt[In]=St.get(In)?sn[Nn++]:0;return kt})(re,ae,Fe,_e.numValues):(function(Ge,Ye,St){const Wt=Ye.get(),Vt=Wt+St*Float32Array.BYTES_PER_ELEMENT,en=new Uint8Array(Ge.subarray(Wt,Vt)).buffer,Sn=new Float32Array(en);return Ye.set(Vt),Sn})(re,ae,_e.numValues);return new Sg(me.name,we,Fe)})(A,D,X,ie);case 8:return(function(re,ae,me,Fe){const _e=Va(re,ae),we=Al(Fe)?(function(Ge,Ye,St,Wt){const Vt=Ye.get(),en=Vt+Wt*Float64Array.BYTES_PER_ELEMENT,Sn=new Uint8Array(Ge.subarray(Vt,en)).buffer,sn=new Float64Array(Sn);Ye.set(en);const Ht=St.size(),kt=new Float64Array(Ht);let Nn=0;for(let In=0;In<Ht;In++)kt[In]=St.get(In)?sn[Nn++]:0;return kt})(re,ae,Fe,_e.numValues):(function(Ge,Ye,St){const Wt=Ye.get(),Vt=Wt+St*Float64Array.BYTES_PER_ELEMENT,en=new Uint8Array(Ge.subarray(Wt,Vt)).buffer,Sn=new Float64Array(en);return Ye.set(Vt),Sn})(re,ae,_e.numValues);return new K0(me.name,we,Fe)})(A,D,X,ie);default:throw new Error(`The specified data type for the field is currently not supported: ${G}`)}})(l,i,e,p,n.scalarType,n):l!=1?null:(function(b,A,D,B){let G=null,X=null,Y=null,Q=null,ie=!1;for(;!ie;){const Fe=Va(b,A);switch(Fe.physicalStreamType){case _a.LENGTH:Ua.DICTIONARY===Fe.logicalStreamType.lengthType?G=zu(b,A,Fe):Y=zu(b,A,Fe);break;case _a.DATA:ec.SINGLE===Fe.logicalStreamType.dictionaryType||ec.SHARED===Fe.logicalStreamType.dictionaryType?(X=b.subarray(A.get(),A.get()+Fe.byteLength),ie=!0):Q=b.subarray(A.get(),A.get()+Fe.byteLength),A.add(Fe.byteLength)}}const re=D.complexType.children,ae=[];let me=0;for(const Fe of re){const _e=Ks(b,A,1)[0];if(_e==0)continue;const we=`${D.name}${Fe.name==="default"?"":":"+Fe.name}`;if(_e!==2||Fe.type!=="scalarField"||Fe.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Ge=Va(b,A),Ye=Rf(b,Ge.numValues,A),St=Va(b,A),Wt=St.decompressedCount!==B?am(b,A,St,!1,new tc(Ye,Ge.numValues)):Ga(b,A,St,!1);ae[me++]=Q?new Kp(we,Wt,G,X,Y,Q,new tc(Ye,Ge.numValues)):new Th(we,Wt,G,X,new tc(Ye,Ge.numValues))}return ae})(i,e,n,p)}function Al(i){return i instanceof tc}function Bu(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Nf=new TextDecoder;function Td(i,e){const n=Ks(i,e,1)[0];if(n===0)return"";const l=e.get(),p=i.subarray(l,l+n);return e.add(n),Nf.decode(p)}function iu(i,e){const n=Ks(i,e,1)[0]>>>0,l=!!(4&n),p=!!(2&n),_=Ks(i,e,1)[0]>>>0,b={};if(1&n&&(b.nullable=!0),p){const A={};if(l?(A.type="logicalType",A.logicalType=_):(A.type="physicalType",A.physicalType=_),8&n){const D=Ks(i,e,1)[0]>>>0;A.children=new Array(D);for(let B=0;B<D;B++)A.children[B]=iu(i,e)}b.type="complexField",b.complexField=A}else{const A={};l?(A.type="logicalType",A.logicalType=_):(A.type="physicalType",A.physicalType=_),b.type="scalarField",b.scalarField=A}return b}function I1(i,e){const n=Ks(i,e,1)[0]>>>0,l=(function(p){switch(p){case 0:case 1:case 2:case 3:{const _={};_.nullable=!!(1&p),_.columnScope=0;const b={};return b.physicalType=p>1?6:4,b.type="physicalType",_.scalarType=b,_.type="scalarType",_}case 4:{const _={nullable:!1,columnScope:0},b={type:"physicalType",physicalType:0};return _.type="complexType",_.complexType=b,_}case 30:{const _={nullable:!1,columnScope:0},b={type:"physicalType",physicalType:1};return _.type="complexType",_.complexType=b,_}default:return(function(_){let b=null;switch(_){case 10:case 11:b=0;break;case 12:case 13:b=1;break;case 14:case 15:b=2;break;case 16:case 17:b=3;break;case 18:case 19:b=4;break;case 20:case 21:b=5;break;case 22:case 23:b=6;break;case 24:case 25:b=7;break;case 26:case 27:b=8;break;case 28:case 29:b=9;break;default:return null}const A={};A.nullable=!!(1&_),A.columnScope=0;const D={type:"physicalType"};return D.physicalType=b,A.type="scalarType",A.scalarType=D,A})(p)}})(n);if(!l)throw new Error(`Unsupported column type code: ${n}`);if((function(p){return p>=10})(n)?l.name=Td(i,e):n>=0&&n<=3?l.name="id":n===4&&(l.name="geometry"),(function(p){return p===30})(n)){const p=Ks(i,e,1)[0]>>>0,_=l.complexType;_.children=new Array(p);for(let b=0;b<p;b++)_.children[b]=iu(i,e)}return l}function Ag(i,e){const n={featureTables:[]},l={};l.name=Td(i,e);const p=Ks(i,e,1)[0]>>>0,_=Ks(i,e,1)[0]>>>0;l.columns=new Array(_);for(let b=0;b<_;b++)l.columns[b]=I1(i,e);return n.featureTables.push(l),[n,p]}function kf(i,e,n,l,p,_,b=!1){const A=e.scalarType.physicalType,D=tu(p,_,i,n);if(A===4)switch(D){case Is.FLAT:{const B=Ga(i,n,p,!1);return new Vp(l,B,_)}case Is.SEQUENCE:{const B=rm(i,n,p);return new J0(l,B[0],B[1],p.numRleValues)}case Is.CONST:{const B=im(i,n,p,!1);return new em(l,B,_)}}else switch(D){case Is.FLAT:{if(b){const G=(function(X,Y,Q,ie){const re=(function(ae,me,Fe){const _e=new Float64Array(me);for(let we=0;we<me;we++)_e[we]=yg(ae,Fe);return _e})(X,Q.numValues,Y);return(function(ae,me,Fe){switch(me.logicalLevelTechnique1){case Ri.DELTA:return me.logicalLevelTechnique2===Ri.RLE&&(ae=_g(ae,me.runs,me.numRleValues)),(function(_e){_e[0]=_e[0]%2==1?(_e[0]+1)/-2:_e[0]/2;const we=_e.length/4*4;let Ge=1;if(we>=4)for(;Ge<we-4;Ge+=4){const Ye=_e[Ge],St=_e[Ge+1],Wt=_e[Ge+2],Vt=_e[Ge+3];_e[Ge]=(Ye%2==1?(Ye+1)/-2:Ye/2)+_e[Ge-1],_e[Ge+1]=(St%2==1?(St+1)/-2:St/2)+_e[Ge],_e[Ge+2]=(Wt%2==1?(Wt+1)/-2:Wt/2)+_e[Ge+1],_e[Ge+3]=(Vt%2==1?(Vt+1)/-2:Vt/2)+_e[Ge+2]}for(;Ge!=_e.length;++Ge)_e[Ge]=(_e[Ge]%2==1?(_e[Ge]+1)/-2:_e[Ge]/2)+_e[Ge-1]})(ae),ae;case Ri.RLE:return(function(_e,we,Ge){return _g(_e,we.runs,we.numRleValues)})(ae,me);case Ri.NONE:return ae;default:throw new Error(`The specified Logical level technique is not supported: ${me.logicalLevelTechnique1}`)}})(re,Q)})(i,n,p);return new K0(l,G,_)}const B=vd(i,n,p,!1);return new wd(l,B,_)}case Is.SEQUENCE:{const B=Sh(i,n,p);return new om(l,B[0],B[1],p.numRleValues)}case Is.CONST:{const B=sm(i,n,p,!1);return new Mf(l,B,_)}}throw new Error("Vector type not supported for id column.")}class M1{constructor(e,n){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case $s.POINT:case $s.MULTIPOINT:this.type=1;break;case $s.LINESTRING:case $s.MULTILINESTRING:this.type=2;break;case $s.POLYGON:case $s.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const l=[];for(const p of n)l.push(new V(p.x,p.y));e.push(l)}return e}}class Cg{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new M1(this.features[e],this.extent)}}class Pf{constructor(e){this.layers={};const n=(function(l,p,_=!0){const b=new gg(0),A=[];for(;b.get()<l.length;){const D=Ks(l,b,1)[0]>>>0,B=b.get()+D;if(B>l.length)throw new Error(`Block overruns tile: ${B} > ${l.length}`);if(Ks(l,b,1)[0]>>>0!=1){b.set(B);continue}const G=Ag(l,b),X=G[1],Y=G[0].featureTables[0];let Q=null,ie=null;const re=[];let ae=0;for(const Fe of Y.columns){const _e=Fe.name;if(_e==="id"){let we=null;if(Fe.nullable){const Ye=Va(l,b),St=b.get(),Wt=Rf(l,Ye.numValues,b);b.set(St+Ye.byteLength),we=new tc(Wt,Ye.numValues)}const Ge=Va(l,b);ae=Ge.decompressedCount,Q=kf(l,Fe,b,_e,Ge,we??ae,_)}else if(_e==="geometry"){const we=Ks(l,b,1)[0];if(ae===0){const Ge=b.get();ae=Va(l,b).decompressedCount,b.set(Ge)}ie=wg(l,we,b,ae)}else{const we=Bu(Fe)?Ks(l,b,1)[0]:1;if(we===0&&Fe.type==="scalarType")continue;const Ge=Lu(l,b,Fe,we,ae);if(Ge)if(Array.isArray(Ge))for(const Ye of Ge)re.push(Ye);else re.push(Ge)}}const me=new ku(Y.name,ie,Q,re,X);A.push(me),b.set(B)}return A})(new Uint8Array(e));this.layers=n.reduce(((l,p)=>Object.assign(Object.assign({},l),{[p.name]:new Cg(p)})),{})}}class Ig{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of n){const p=[];for(const _ of l)p.push(new V(_[0],_[1]));e.push(p)}return e}}const Of="_geojsonTileLayer";function Qp(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let _=0;_<i.length;_++)n.feature=i.feature(_),e.writeMessage(2,Jp,n);const l=n.keys;for(const _ of l)e.writeStringField(3,_);const p=n.values;for(const _ of p)e.writeMessage(4,e0,_)}function Jp(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,Mg,i),e.writeVarintField(3,n.type),e.writeMessage(4,pm,n)}function Mg(i,e){for(const n in i.feature?.properties){let l=i.feature.properties[n],p=i.keycache[n];if(l==null)continue;p===void 0&&(i.keys.push(n),p=i.keys.length-1,i.keycache[n]=p),e.writeVarint(p),typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"&&(l=JSON.stringify(l));const _=typeof l+":"+l;let b=i.valuecache[_];b===void 0&&(i.values.push(l),b=i.values.length-1,i.valuecache[_]=b),e.writeVarint(b)}}function Fu(i,e){return(e<<3)+(7&i)}function fm(i){return i<<1^i>>31}function pm(i,e){const n=i.loadGeometry(),l=i.type;let p=0,_=0;for(const b of n){let A=1;l===1&&(A=b.length),e.writeVarint(Fu(1,A));const D=l===3?b.length-1:b.length;for(let B=0;B<D;B++){B===1&&l!==1&&e.writeVarint(Fu(2,D-1));const G=b[B].x-p,X=b[B].y-_;e.writeVarint(fm(G)),e.writeVarint(fm(X)),p+=G,_+=X}i.type===3&&e.writeVarint(Fu(7,1))}}function e0(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class mm{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new pc(mt,16,0),this.grid3D=new pc(mt,16,0),this.featureIndexArray=new pe,this.promoteId=n}insert(e,n,l,p,_,b){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,_);const D=b?this.grid3D:this.grid;for(let B=0;B<n.length;B++){const G=n[B],X=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<G.length;Y++){const Q=G[Y];X[0]=Math.min(X[0],Q.x),X[1]=Math.min(X[1],Q.y),X[2]=Math.max(X[2],Q.x),X[3]=Math.max(X[3],Q.y)}X[0]<mt&&X[1]<mt&&X[2]>=0&&X[3]>=0&&D.insert(A,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Xi(new Ap(this.rawTileData)).layers:new Pf(this.rawTileData).layers,this.sourceLayerCoder=new $0(this.vtLayers?Object.keys(this.vtLayers).sort():[Of])),this.vtLayers}query(e,n,l,p){this.loadVTLayers();const _=e.params,b=mt/e.tileSize/e.scale,A=Pa(_.filter,_.globalState),D=e.queryGeometry,B=e.queryPadding*b,G=Du.fromPoints(D),X=this.grid.query(G.minX-B,G.minY-B,G.maxX+B,G.maxY+B),Y=Du.fromPoints(e.cameraQueryGeometry).expandBy(B),Q=this.grid3D.query(Y.minX,Y.minY,Y.maxX,Y.maxY,((ae,me,Fe,_e)=>(function(we,Ge,Ye,St,Wt){for(const en of we)if(Ge<=en.x&&Ye<=en.y&&St>=en.x&&Wt>=en.y)return!0;const Vt=[new V(Ge,Ye),new V(Ge,Wt),new V(St,Wt),new V(St,Ye)];if(we.length>2){for(const en of Vt)if(_c(we,en))return!0}for(let en=0;en<we.length-1;en++)if(Pm(we[en],we[en+1],Vt))return!0;return!1})(e.cameraQueryGeometry,ae-B,me-B,Fe+B,_e+B)));for(const ae of Q)X.push(ae);X.sort(t0);const ie={};let re;for(let ae=0;ae<X.length;ae++){const me=X[ae];if(me===re)continue;re=me;const Fe=this.featureIndexArray.get(me);let _e=null;this.loadMatchingFeature(ie,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,A,_.layers,_.availableImages,n,l,p,((we,Ge,Ye)=>(_e||(_e=Yl(we)),Ge.queryIntersectsFeature({queryGeometry:D,feature:we,featureState:Ye,geometry:_e,zoom:this.z,transform:e.transform,pixelsToTileUnits:b,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return ie}loadMatchingFeature(e,n,l,p,_,b,A,D,B,G,X){const Y=this.bucketLayerIDs[n];if(b&&!Y.some((ae=>b.has(ae))))return;const Q=this.sourceLayerCoder.decode(l),ie=this.vtLayers[Q].feature(p);if(_.needGeometry){const ae=Vo(ie,!0);if(!_.filter(new cr(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!_.filter(new cr(this.tileID.overscaledZ),ie))return;const re=this.getId(ie,Q);for(let ae=0;ae<Y.length;ae++){const me=Y[ae];if(b&&!b.has(me))continue;const Fe=D[me];if(!Fe)continue;let _e={};re&&G&&(_e=G.getState(Fe.sourceLayer||Of,re));const we=Tn({},B[me]);we.paint=Rg(we.paint,Fe.paint,ie,_e,A),we.layout=Rg(we.layout,Fe.layout,ie,_e,A);const Ge=!X||X(ie,Fe,_e);if(!Ge)continue;const Ye=new jp(ie,this.z,this.x,this.y,re);Ye.layer=we;let St=e[me];St===void 0&&(St=e[me]=[]),St.push({featureIndex:p,feature:Ye,intersectionZ:Ge})}}lookupSymbolFeatures(e,n,l,p,_,b,A,D){const B={};this.loadVTLayers();const G=Pa(_.filterSpec,_.globalState);for(const X of e)this.loadMatchingFeature(B,l,p,X,G,b,A,D,n);return B}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){var l;let p=e.id;return this.promoteId&&(p=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(p=Number(e.properties.cluster_id))),p}}function Rg(i,e,n,l,p){return ri(i,((_,b)=>{const A=e instanceof Fc?e.get(b):null;return A&&A.evaluate?A.evaluate(n,l,p):A}))}function t0(i,e){return e-i}function r(i,e,n,l,p){const _=[];for(let b=0;b<i.length;b++){const A=i[b];let D;for(let B=0;B<A.length-1;B++){let G=A[B],X=A[B+1];G.x<e&&X.x<e||(G.x<e?G=new V(e,G.y+(e-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x<e&&(X=new V(e,G.y+(e-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y<n&&X.y<n||(G.y<n?G=new V(G.x+(n-G.y)/(X.y-G.y)*(X.x-G.x),n)._round():X.y<n&&(X=new V(G.x+(n-G.y)/(X.y-G.y)*(X.x-G.x),n)._round()),G.x>=l&&X.x>=l||(G.x>=l?G=new V(l,G.y+(l-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x>=l&&(X=new V(l,G.y+(l-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y>=p&&X.y>=p||(G.y>=p?G=new V(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round():X.y>=p&&(X=new V(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round()),D&&G.equals(D[D.length-1])||(D=[G],_.push(D)),D.push(X)))))}}return _}function o(i,e,n,l,p){switch(e){case 1:return(function(_,b,A,D){const B=[];for(const G of _)for(const X of G){const Y=D===0?X.x:X.y;Y>=b&&Y<=A&&B.push([X])}return B})(i,n,l,p);case 2:return S(i,n,l,p,!1);case 3:return S(i,n,l,p,!0)}return[]}function g(i,e,n,l,p){const _=l===0?L:U;let b=[];const A=[];for(let G=0;G<i.length-1;G++){const X=i[G],Y=i[G+1],Q=l===0?X.x:X.y,ie=l===0?Y.x:Y.y;let re=!1;Q<e?ie>e&&b.push(_(X,Y,e)):Q>n?ie<n&&b.push(_(X,Y,n)):b.push(X),ie<e&&Q>=e&&(b.push(_(X,Y,e)),re=!0),ie>n&&Q<=n&&(b.push(_(X,Y,n)),re=!0),!p&&re&&(A.push(b),b=[])}const D=i.length-1,B=l===0?i[D].x:i[D].y;return B>=e&&B<=n&&b.push(i[D]),p&&b.length>0&&!b[0].equals(b[b.length-1])&&b.push(new V(b[0].x,b[0].y)),b.length>0&&A.push(b),A}function S(i,e,n,l,p){const _=[];for(const b of i){const A=g(b,e,n,l,p);A.length>0&&_.push(...A)}return _}function L(i,e,n){return new V(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function U(i,e,n){return new V(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}Cn("FeatureIndex",mm,{omit:["rawTileData","sourceLayerCoder"]});class ne extends V{constructor(e,n,l,p){super(e,n),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new ne(this.x,this.y,this.angle,this.segment)}}function ve(i,e,n,l,p){if(e.segment===void 0||n===0)return!0;let _=e,b=e.segment+1,A=0;for(;A>-n/2;){if(b--,b<0)return!1;A-=i[b].dist(_),_=i[b]}A+=i[b].dist(i[b+1]),b++;const D=[];let B=0;for(;A<n/2;){const G=i[b],X=i[b+1];if(!X)return!1;let Y=i[b-1].angleTo(G)-G.angleTo(X);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:A,angleDelta:Y}),B+=Y;A-D[0].distance>l;)B-=D.shift().angleDelta;if(B>p)return!1;b++,A+=G.dist(X)}return!0}function rt(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function Pt(i,e,n){return i?.6*e*n:0}function Kt(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function ln(i,e,n,l,p,_){const b=Pt(n,p,_),A=Kt(n,l)*_;let D=0;const B=rt(i)/2;for(let G=0;G<i.length-1;G++){const X=i[G],Y=i[G+1],Q=X.dist(Y);if(D+Q>B){const ie=(B-D)/Q,re=xr.number(X.x,Y.x,ie),ae=xr.number(X.y,Y.y,ie),me=new ne(re,ae,Y.angleTo(X),G);return me._round(),!b||ve(i,me,A,b,e)?me:void 0}D+=Q}}function Lt(i,e,n,l,p,_,b,A,D){const B=Pt(l,_,b),G=Kt(l,p),X=G*b,Y=i[0].x===0||i[0].x===D||i[0].y===0||i[0].y===D;return e-X<e/4&&(e=X+e/4),Gt(i,Y?e/2*A%e:(G/2+2*_)*b*A%e,e,B,n,X,Y,!1,D)}function Gt(i,e,n,l,p,_,b,A,D){const B=_/2,G=rt(i);let X=0,Y=e-n,Q=[];for(let ie=0;ie<i.length-1;ie++){const re=i[ie],ae=i[ie+1],me=re.dist(ae),Fe=ae.angleTo(re);for(;Y+n<X+me;){Y+=n;const _e=(Y-X)/me,we=xr.number(re.x,ae.x,_e),Ge=xr.number(re.y,ae.y,_e);if(we>=0&&we<D&&Ge>=0&&Ge<D&&Y-B>=0&&Y+B<=G){const Ye=new ne(we,Ge,Fe,ie);Ye._round(),l&&!ve(i,Ye,_,l,p)||Q.push(Ye)}}X+=me}return A||Q.length||b||(Q=Gt(i,X/2,n,l,p,_,b,!0,D)),Q}function jn(i,e,n,l){const p=[],_=i.image,b=_.pixelRatio,A=_.paddedRect.w-2,D=_.paddedRect.h-2;let B={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const G=_.stretchX||[[0,A]],X=_.stretchY||[[0,D]],Y=(kt,Nn)=>kt+Nn[1]-Nn[0],Q=G.reduce(Y,0),ie=X.reduce(Y,0),re=A-Q,ae=D-ie;let me=0,Fe=Q,_e=0,we=ie,Ge=0,Ye=re,St=0,Wt=ae;if(_.content&&l){const kt=_.content,Nn=kt[2]-kt[0],In=kt[3]-kt[1];(_.textFitWidth||_.textFitHeight)&&(B=eu(i)),me=hi(G,0,kt[0]),_e=hi(X,0,kt[1]),Fe=hi(G,kt[0],kt[2]),we=hi(X,kt[1],kt[3]),Ge=kt[0]-me,St=kt[1]-_e,Ye=Nn-Fe,Wt=In-we}const Vt=B.x1,en=B.y1,Sn=B.x2-Vt,sn=B.y2-en,Ht=(kt,Nn,In,On)=>{const An=_t(kt.stretch-me,Fe,Sn,Vt),Vn=ht(kt.fixed-Ge,Ye,kt.stretch,Q),Qi=_t(Nn.stretch-_e,we,sn,en),zi=ht(Nn.fixed-St,Wt,Nn.stretch,ie),is=_t(In.stretch-me,Fe,Sn,Vt),Ha=ht(In.fixed-Ge,Ye,In.stretch,Q),Qs=_t(On.stretch-_e,we,sn,en),rs=ht(On.fixed-St,Wt,On.stretch,ie),$r=new V(An,Qi),gr=new V(is,Qi),ys=new V(is,Qs),Ms=new V(An,Qs),Zr=new V(Vn/b,zi/b),Zo=new V(Ha/b,rs/b),qa=e*Math.PI/180;if(qa){const va=Math.sin(qa),cs=Math.cos(qa),Js=[cs,-va,va,cs];$r._matMult(Js),gr._matMult(Js),Ms._matMult(Js),ys._matMult(Js)}const Xo=kt.stretch+kt.fixed,Tc=Nn.stretch+Nn.fixed;return{tl:$r,tr:gr,bl:Ms,br:ys,tex:{x:_.paddedRect.x+1+Xo,y:_.paddedRect.y+1+Tc,w:In.stretch+In.fixed-Xo,h:On.stretch+On.fixed-Tc},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:Zo,minFontScaleX:Ye/b/Sn,minFontScaleY:Wt/b/sn,isSDF:n}};if(l&&(_.stretchX||_.stretchY)){const kt=Or(G,re,Q),Nn=Or(X,ae,ie);for(let In=0;In<kt.length-1;In++){const On=kt[In],An=kt[In+1];for(let Vn=0;Vn<Nn.length-1;Vn++)p.push(Ht(On,Nn[Vn],An,Nn[Vn+1]))}}else p.push(Ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:D+1}));return p}function hi(i,e,n){let l=0;for(const p of i)l+=Math.max(e,Math.min(n,p[1]))-Math.max(e,Math.min(n,p[0]));return l}function Or(i,e,n){const l=[{fixed:-1,stretch:0}];for(const[p,_]of i){const b=l[l.length-1];l.push({fixed:p-b.stretch,stretch:b.stretch}),l.push({fixed:p-b.stretch,stretch:b.stretch+(_-p)})}return l.push({fixed:e+1,stretch:n}),l}function _t(i,e,n,l){return i/e*n+l}function ht(i,e,n,l){return i-e*n/l}Cn("Anchor",ne);class Dt{constructor(e,n,l,p,_,b,A,D,B,G){var X;if(this.boxStartIndex=e.length,B){let Y=b.top,Q=b.bottom;const ie=b.collisionPadding;ie&&(Y-=ie[1],Q+=ie[3]);let re=Q-Y;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{const Y=!((X=b.image)===null||X===void 0)&&X.content&&(b.image.textFitWidth||b.image.textFitHeight)?eu(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};Y.y1=Y.y1*A-D[0],Y.y2=Y.y2*A+D[2],Y.x1=Y.x1*A-D[3],Y.x2=Y.x2*A+D[1];const Q=b.collisionPadding;if(Q&&(Y.x1-=Q[0]*A,Y.y1-=Q[1]*A,Y.x2+=Q[2]*A,Y.y2+=Q[3]*A),G){const ie=new V(Y.x1,Y.y1),re=new V(Y.x2,Y.y1),ae=new V(Y.x1,Y.y2),me=new V(Y.x2,Y.y2),Fe=G*Math.PI/180;ie._rotate(Fe),re._rotate(Fe),ae._rotate(Fe),me._rotate(Fe),Y.x1=Math.min(ie.x,re.x,ae.x,me.x),Y.x2=Math.max(ie.x,re.x,ae.x,me.x),Y.y1=Math.min(ie.y,re.y,ae.y,me.y),Y.y2=Math.max(ie.y,re.y,ae.y,me.y)}e.emplaceBack(n.x,n.y,Y.x1,Y.y1,Y.x2,Y.y2,l,p,_)}this.boxEndIndex=e.length}}class rn{constructor(e=[],n=(l,p)=>l<p?-1:l>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,p=n[e];for(;e>0;){const _=e-1>>1,b=n[_];if(l(p,b)>=0)break;n[e]=b,e=_}n[e]=p}_down(e){const{data:n,compare:l}=this,p=this.length>>1,_=n[e];for(;e<p;){let b=1+(e<<1);const A=b+1;if(A<this.length&&l(n[A],n[b])<0&&(b=A),l(n[b],_)>=0)break;n[e]=n[b],e=b}n[e]=_}}function li(i,e=1,n=!1){const l=Du.fromPoints(i[0]),p=Math.min(l.width(),l.height());let _=p/2;const b=new rn([],mr),{minX:A,minY:D,maxX:B,maxY:G}=l;if(p===0)return new V(A,D);for(let Q=A;Q<B;Q+=p)for(let ie=D;ie<G;ie+=p)b.push(new Un(Q+_,ie+_,_,i));let X=(function(Q){let ie=0,re=0,ae=0;const me=Q[0];for(let Fe=0,_e=me.length,we=_e-1;Fe<_e;we=Fe++){const Ge=me[Fe],Ye=me[we],St=Ge.x*Ye.y-Ye.x*Ge.y;re+=(Ge.x+Ye.x)*St,ae+=(Ge.y+Ye.y)*St,ie+=3*St}return new Un(re/ie,ae/ie,0,Q)})(i),Y=b.length;for(;b.length;){const Q=b.pop();(Q.d>X.d||!X.d)&&(X=Q,n&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,Y)),Q.max-X.d<=e||(_=Q.h/2,b.push(new Un(Q.p.x-_,Q.p.y-_,_,i)),b.push(new Un(Q.p.x+_,Q.p.y-_,_,i)),b.push(new Un(Q.p.x-_,Q.p.y+_,_,i)),b.push(new Un(Q.p.x+_,Q.p.y+_,_,i)),Y+=4)}return n&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${X.d}`)),X.p}function mr(i,e){return e.max-i.max}function Un(i,e,n,l){this.p=new V(i,e),this.h=n,this.d=(function(p,_){let b=!1,A=1/0;for(let D=0;D<_.length;D++){const B=_[D];for(let G=0,X=B.length,Y=X-1;G<X;Y=G++){const Q=B[G],ie=B[Y];Q.y>p.y!=ie.y>p.y&&p.x<(ie.x-Q.x)*(p.y-Q.y)/(ie.y-Q.y)+Q.x&&(b=!b),A=Math.min(A,x0(p,Q,ie))}}return(b?1:-1)*Math.sqrt(A)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var ei;R.aP=void 0,(ei=R.aP||(R.aP={}))[ei.center=1]="center",ei[ei.left=2]="left",ei[ei.right=3]="right",ei[ei.top=4]="top",ei[ei.bottom=5]="bottom",ei[ei["top-left"]=6]="top-left",ei[ei["top-right"]=7]="top-right",ei[ei["bottom-left"]=8]="bottom-left",ei[ei["bottom-right"]=9]="bottom-right";const qi=Number.POSITIVE_INFINITY;function hr(i,e){return e[1]!==qi?(function(n,l,p){let _=0,b=0;switch(l=Math.abs(l),p=Math.abs(p),n){case"top-right":case"top-left":case"top":b=p-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-p}switch(n){case"top-right":case"bottom-right":case"right":_=-l;break;case"top-left":case"bottom-left":case"left":_=l}return[_,b]})(i,e[0],e[1]):(function(n,l){let p=0,_=0;l<0&&(l=0);const b=l/Math.SQRT2;switch(n){case"top-right":case"top-left":_=b-7;break;case"bottom-right":case"bottom-left":_=7-b;break;case"bottom":_=7-l;break;case"top":_=l-7}switch(n){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=l;break;case"right":p=-l}return[p,_]})(i,e[0])}function ru(i,e,n){var l;const p=i.layout,_=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},n);if(_){const A=_.values,D=[];for(let B=0;B<A.length;B+=2){const G=D[B]=A[B],X=A[B+1].map((Y=>Y*Ls));G.startsWith("top")?X[1]-=7:G.startsWith("bottom")&&(X[1]+=7),D[B+1]=X}return new Mi(D)}const b=p.get("text-variable-anchor");if(b){let A;A=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(e,{},n)*Ls,qi]:p.get("text-offset").evaluate(e,{},n).map((B=>B*Ls));const D=[];for(const B of b)D.push(B,hr(B,A));return new Mi(D)}return null}function gm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function M2(i,e,n,l,p,_,b,A,D,B,G,X){let Y=_.textMaxSize.evaluate(e,{});Y===void 0&&(Y=b);const Q=i.layers[0].layout,ie=Q.get("icon-offset").evaluate(e,{},G),re=_x(n.horizontal),ae=b/24,me=i.tilePixelRatio*ae,Fe=i.tilePixelRatio*Y/24,_e=i.tilePixelRatio*A,we=i.tilePixelRatio*Q.get("symbol-spacing"),Ge=Q.get("text-padding")*i.tilePixelRatio,Ye=(function(In,On,An,Vn=1){const Qi=In.get("icon-padding").evaluate(On,{},An),zi=Qi&&Qi.values;return[zi[0]*Vn,zi[1]*Vn,zi[2]*Vn,zi[3]*Vn]})(Q,e,G,i.tilePixelRatio),St=Q.get("text-max-angle")/180*Math.PI,Wt=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point",Vt=Q.get("icon-rotation-alignment")==="map"&&Q.get("symbol-placement")!=="point",en=Q.get("symbol-placement"),Sn=we/2,sn=Q.get("icon-text-fit");let Ht;l&&sn!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Ht=Ql(l,n.vertical,sn,Q.get("icon-text-fit-padding"),ie,ae)),re&&(l=Ql(l,re,sn,Q.get("icon-text-fit-padding"),ie,ae)));const kt=G?X.line.getGranularityForZoomLevel(G.z):1,Nn=(In,On)=>{On.x<0||On.x>=mt||On.y<0||On.y>=mt||(function(An,Vn,Qi,zi,is,Ha,Qs,rs,$r,gr,ys,Ms,Zr,Zo,qa,Xo,Tc,va,cs,Js,xs,wa,Ah,su,_m){const Ad=An.addToLineVertexArray(Vn,Qi);let zf,n0,i0,r0,Ex=0,Sx=0,Tx=0,Ax=0,L1=-1,B1=-1;const Ch={};let Cx=ts("");if(An.allowVerticalPlacement&&zi.vertical){const uo=rs.layout.get("text-rotate").evaluate(xs,{},su)+90;i0=new Dt($r,Vn,gr,ys,Ms,zi.vertical,Zr,Zo,qa,uo),Qs&&(r0=new Dt($r,Vn,gr,ys,Ms,Qs,Tc,va,qa,uo))}if(is){const uo=rs.layout.get("icon-rotate").evaluate(xs,{}),nc=rs.layout.get("icon-text-fit")!=="none",Lf=jn(is,uo,Ah,nc),ou=Qs?jn(Qs,uo,Ah,nc):void 0;n0=new Dt($r,Vn,gr,ys,Ms,is,Tc,va,!1,uo),Ex=4*Lf.length;const Bf=An.iconSizeData;let ju=null;Bf.kind==="source"?(ju=[Ho*rs.layout.get("icon-size").evaluate(xs,{})],ju[0]>Mu&&Qn(`${An.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Bf.kind==="composite"&&(ju=[Ho*wa.compositeIconSizes[0].evaluate(xs,{},su),Ho*wa.compositeIconSizes[1].evaluate(xs,{},su)],(ju[0]>Mu||ju[1]>Mu)&&Qn(`${An.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),An.addSymbols(An.icon,Lf,ju,Js,cs,xs,R.az.none,Vn,Ad.lineStartIndex,Ad.lineLength,-1,su),L1=An.icon.placedSymbolArray.length-1,ou&&(Sx=4*ou.length,An.addSymbols(An.icon,ou,ju,Js,cs,xs,R.az.vertical,Vn,Ad.lineStartIndex,Ad.lineLength,-1,su),B1=An.icon.placedSymbolArray.length-1)}const Ix=Object.keys(zi.horizontal);for(const uo of Ix){const nc=zi.horizontal[uo];if(!zf){Cx=ts(nc.text);const ou=rs.layout.get("text-rotate").evaluate(xs,{},su);zf=new Dt($r,Vn,gr,ys,Ms,nc,Zr,Zo,qa,ou)}const Lf=nc.positionedLines.length===1;if(Tx+=xx(An,Vn,nc,Ha,rs,qa,xs,Xo,Ad,zi.vertical?R.az.horizontal:R.az.horizontalOnly,Lf?Ix:[uo],Ch,L1,wa,su),Lf)break}zi.vertical&&(Ax+=xx(An,Vn,zi.vertical,Ha,rs,qa,xs,Xo,Ad,R.az.vertical,["vertical"],Ch,B1,wa,su));const N2=zf?zf.boxStartIndex:An.collisionBoxArray.length,k2=zf?zf.boxEndIndex:An.collisionBoxArray.length,P2=i0?i0.boxStartIndex:An.collisionBoxArray.length,O2=i0?i0.boxEndIndex:An.collisionBoxArray.length,z2=n0?n0.boxStartIndex:An.collisionBoxArray.length,L2=n0?n0.boxEndIndex:An.collisionBoxArray.length,B2=r0?r0.boxStartIndex:An.collisionBoxArray.length,F2=r0?r0.boxEndIndex:An.collisionBoxArray.length;let au=-1;const Ng=(uo,nc)=>uo&&uo.circleDiameter?Math.max(uo.circleDiameter,nc):nc;au=Ng(zf,au),au=Ng(i0,au),au=Ng(n0,au),au=Ng(r0,au);const Mx=au>-1?1:0;Mx&&(au*=_m/Ls),An.glyphOffsetArray.length>=yd.MAX_GLYPHS&&Qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xs.sortKey!==void 0&&An.addToSortKeyRanges(An.symbolInstances.length,xs.sortKey);const j2=ru(rs,xs,su),[U2,V2]=(function(uo,nc){const Lf=uo.length,ou=nc?.values;if(ou?.length>0)for(let Bf=0;Bf<ou.length;Bf+=2){const ju=ou[Bf+1];uo.emplaceBack(R.aP[ou[Bf]],ju[0],ju[1])}return[Lf,uo.length]})(An.textAnchorOffsets,j2);An.symbolInstances.emplaceBack(Vn.x,Vn.y,Ch.right>=0?Ch.right:-1,Ch.center>=0?Ch.center:-1,Ch.left>=0?Ch.left:-1,Ch.vertical||-1,L1,B1,Cx,N2,k2,P2,O2,z2,L2,B2,F2,gr,Tx,Ax,Ex,Sx,Mx,0,Zr,au,U2,V2)})(i,On,In,n,l,p,Ht,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,me,[Ge,Ge,Ge,Ge],Wt,D,_e,Ye,Vt,ie,e,_,B,G,b)};if(en==="line")for(const In of r(e.geometry,0,0,mt,mt)){const On=Yc(In,kt),An=Lt(On,we,St,n.vertical||re,l,24,Fe,i.overscaling,mt);for(const Vn of An)re&&R2(i,re.text,Sn,Vn)||Nn(On,Vn)}else if(en==="line-center"){for(const In of e.geometry)if(In.length>1){const On=Yc(In,kt),An=ln(On,St,n.vertical||re,l,24,Fe);An&&Nn(On,An)}}else if(e.type==="Polygon")for(const In of al(e.geometry,0)){const On=li(In,16);Nn(Yc(In[0],kt,!0),new ne(On.x,On.y,0))}else if(e.type==="LineString")for(const In of e.geometry){const On=Yc(In,kt);Nn(On,new ne(On[0].x,On[0].y,0))}else if(e.type==="Point")for(const In of e.geometry)for(const On of In)Nn([On],new ne(On.x,On.y,0))}function xx(i,e,n,l,p,_,b,A,D,B,G,X,Y,Q,ie){const re=(function(Fe,_e,we,Ge,Ye,St,Wt,Vt){const en=Ge.layout.get("text-rotate").evaluate(St,{})*Math.PI/180,Sn=[];for(const sn of _e.positionedLines)for(const Ht of sn.positionedGlyphs){if(!Ht.rect)continue;const kt=Ht.rect||{};let Nn=4,In=!0,On=1,An=0;const Vn=(Ye||Vt)&&Ht.vertical,Qi=Ht.metrics.advance*Ht.scale/2;if(Vt&&_e.verticalizable&&(An=sn.lineOffset/2-(Ht.imageName?-(Ls-Ht.metrics.width*Ht.scale)/2:(Ht.scale-1)*Ls)),Ht.imageName){const va=Wt[Ht.imageName];In=va.sdf,On=va.pixelRatio,Nn=1/On}const zi=Ye?[Ht.x+Qi,Ht.y]:[0,0];let is=Ye?[0,0]:[Ht.x+Qi+we[0],Ht.y+we[1]-An],Ha=[0,0];Vn&&(Ha=is,is=[0,0]);const Qs=Ht.metrics.isDoubleResolution?2:1,rs=(Ht.metrics.left-Nn)*Ht.scale-Qi+is[0],$r=(-Ht.metrics.top-Nn)*Ht.scale+is[1],gr=rs+kt.w/Qs*Ht.scale/On,ys=$r+kt.h/Qs*Ht.scale/On,Ms=new V(rs,$r),Zr=new V(gr,$r),Zo=new V(rs,ys),qa=new V(gr,ys);if(Vn){const va=new V(-Qi,Qi- -17),cs=-Math.PI/2,Js=12-Qi,xs=new V(22-Js,-(Ht.imageName?Js:0)),wa=new V(...Ha);Ms._rotateAround(cs,va)._add(xs)._add(wa),Zr._rotateAround(cs,va)._add(xs)._add(wa),Zo._rotateAround(cs,va)._add(xs)._add(wa),qa._rotateAround(cs,va)._add(xs)._add(wa)}if(en){const va=Math.sin(en),cs=Math.cos(en),Js=[cs,-va,va,cs];Ms._matMult(Js),Zr._matMult(Js),Zo._matMult(Js),qa._matMult(Js)}const Xo=new V(0,0),Tc=new V(0,0);Sn.push({tl:Ms,tr:Zr,bl:Zo,br:qa,tex:kt,writingMode:_e.writingMode,glyphOffset:zi,sectionIndex:Ht.sectionIndex,isSDF:In,pixelOffsetTL:Xo,pixelOffsetBR:Tc,minFontScaleX:0,minFontScaleY:0})}return Sn})(0,n,A,p,_,b,l,i.allowVerticalPlacement),ae=i.textSizeData;let me=null;ae.kind==="source"?(me=[Ho*p.layout.get("text-size").evaluate(b,{})],me[0]>Mu&&Qn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(me=[Ho*Q.compositeTextSizes[0].evaluate(b,{},ie),Ho*Q.compositeTextSizes[1].evaluate(b,{},ie)],(me[0]>Mu||me[1]>Mu)&&Qn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,re,me,A,_,b,B,e,D.lineStartIndex,D.lineLength,Y,ie);for(const Fe of G)X[Fe]=i.text.placedSymbolArray.length-1;return 4*re.length}function _x(i){for(const e in i)return i[e];return null}function R2(i,e,n,l){const p=i.compareText;if(e in p){const _=p[e];for(let b=_.length-1;b>=0;b--)if(l.dist(_[b])<n)return!0}else p[e]=[];return p[e].push(l),!1}const bx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class R1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=bx[15&l];if(!_)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(e,2,1),[A]=new Uint32Array(e,4,1);return new R1(A,b,_,e)}constructor(e,n=64,l=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=bx.indexOf(this.ArrayType),b=2*e*this.ArrayType.BYTES_PER_ELEMENT,A=e*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-A%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+A+D,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+b+A+D),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+A+D,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return D1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:A}=this,D=[0,_.length-1,0],B=[];for(;D.length;){const G=D.pop()||0,X=D.pop()||0,Y=D.pop()||0;if(X-Y<=A){for(let ae=Y;ae<=X;ae++){const me=b[2*ae],Fe=b[2*ae+1];me>=e&&me<=l&&Fe>=n&&Fe<=p&&B.push(_[ae])}continue}const Q=Y+X>>1,ie=b[2*Q],re=b[2*Q+1];ie>=e&&ie<=l&&re>=n&&re<=p&&B.push(_[Q]),(G===0?e<=ie:n<=re)&&(D.push(Y),D.push(Q-1),D.push(1-G)),(G===0?l>=ie:p>=re)&&(D.push(Q+1),D.push(X),D.push(1-G))}return B}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:b}=this,A=[0,p.length-1,0],D=[],B=l*l;for(;A.length;){const G=A.pop()||0,X=A.pop()||0,Y=A.pop()||0;if(X-Y<=b){for(let ae=Y;ae<=X;ae++)wx(_[2*ae],_[2*ae+1],e,n)<=B&&D.push(p[ae]);continue}const Q=Y+X>>1,ie=_[2*Q],re=_[2*Q+1];wx(ie,re,e,n)<=B&&D.push(p[Q]),(G===0?e-l<=ie:n-l<=re)&&(A.push(Y),A.push(Q-1),A.push(1-G)),(G===0?e+l>=ie:n+l>=re)&&(A.push(Q+1),A.push(X),A.push(1-G))}return D}}function D1(i,e,n,l,p,_){if(p-l<=n)return;const b=l+p>>1;vx(i,e,b,l,p,_),D1(i,e,n,l,b-1,1-_),D1(i,e,n,b+1,p,1-_)}function vx(i,e,n,l,p,_){for(;p>l;){if(p-l>600){const B=p-l+1,G=n-l+1,X=Math.log(B),Y=.5*Math.exp(2*X/3),Q=.5*Math.sqrt(X*Y*(B-Y)/B)*(G-B/2<0?-1:1);vx(i,e,n,Math.max(l,Math.floor(n-G*Y/B+Q)),Math.min(p,Math.floor(n+(B-G)*Y/B+Q)),_)}const b=e[2*n+_];let A=l,D=p;for(ym(i,e,l,n),e[2*p+_]>b&&ym(i,e,l,p);A<D;){for(ym(i,e,A,D),A++,D--;e[2*A+_]<b;)A++;for(;e[2*D+_]>b;)D--}e[2*l+_]===b?ym(i,e,l,D):(D++,ym(i,e,D,p)),D<=n&&(l=D+1),n<=D&&(p=D-1)}}function ym(i,e,n,l){N1(i,n,l),N1(e,2*n,2*l),N1(e,2*n+1,2*l+1)}function N1(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function wx(i,e,n,l){const p=i-n,_=e-l;return p*p+_*_}var k1;R.cH=void 0,(k1=R.cH||(R.cH={})).create="create",k1.load="load",k1.fullLoad="fullLoad";let Dg=null,xm=[];const P1=1e3/60,O1="loadTime",z1="fullLoadTime",D2={mark(i){performance.mark(i)},frame(i){const e=i;Dg!=null&&xm.push(e-Dg),Dg=e},clearMetrics(){Dg=null,xm=[],performance.clearMeasures(O1),performance.clearMeasures(z1);for(const i in R.cH)performance.clearMarks(R.cH[i])},getPerformanceMetrics(){performance.measure(O1,R.cH.create,R.cH.load),performance.measure(z1,R.cH.create,R.cH.fullLoad);const i=performance.getEntriesByName(O1)[0].duration,e=performance.getEntriesByName(z1)[0].duration,n=xm.length,l=1/(xm.reduce(((_,b)=>_+b),0)/n/1e3),p=xm.filter((_=>_>P1)).reduce(((_,b)=>_+(b-P1)/P1),0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:p/(n+p)*100,totalFrames:n}}};R.$=he,R.A=Qe,R.B=Oo,R.C=zs,R.D=Dn,R.E=cn,R.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},R.G=xr,R.H=cr,R.I=Er,R.J=Yh,R.K=function(i){if(si==null){const e=i.navigator?i.navigator.userAgent:null;si=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return si},R.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Lp((()=>this.process())),this.subscription=Yi(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Bi(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,l)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=e?Yi(e.signal,"abort",(()=>{_?.unsubscribe(),delete this.resolveRejects[p];const D={id:p,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(D)}),Z0):null;this.resolveRejects[p]={resolve:D=>{_?.unsubscribe(),n(D)},reject:D=>{_?.unsubscribe(),l(D)}};const b=[],A=Object.assign(Object.assign({},i),{id:p,sourceMapId:this.mapId,origin:location.origin,data:zo(i.data,b)});this.target.postMessage(A,{transfer:b})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(Bi(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return h(this,void 0,void 0,(function*(){if(e.type==="<response>"){const p=this.resolveRejects[i];return delete this.resolveRejects[i],p?void(e.error?p.reject(_u(e.error)):p.resolve(_u(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=_u(e.data),l=new AbortController;this.abortControllers[i]=l;try{const p=yield this.messageHandlers[e.type](e.sourceMapId,n,l);this.completeTask(i,null,p)}catch(p){this.completeTask(i,p)}}))}completeTask(i,e,n){const l=[];delete this.abortControllers[i];const p={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?zo(e):null,data:zo(n,l)};this.target.postMessage(p,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},R.M=at,R.N=function(){var i=new Qe(16);return Qe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},R.O=function(i,e,n){var l,p,_,b,A,D,B,G,X,Y,Q,ie,re=n[0],ae=n[1],me=n[2];return e===i?(i[12]=e[0]*re+e[4]*ae+e[8]*me+e[12],i[13]=e[1]*re+e[5]*ae+e[9]*me+e[13],i[14]=e[2]*re+e[6]*ae+e[10]*me+e[14],i[15]=e[3]*re+e[7]*ae+e[11]*me+e[15]):(p=e[1],_=e[2],b=e[3],A=e[4],D=e[5],B=e[6],G=e[7],X=e[8],Y=e[9],Q=e[10],ie=e[11],i[0]=l=e[0],i[1]=p,i[2]=_,i[3]=b,i[4]=A,i[5]=D,i[6]=B,i[7]=G,i[8]=X,i[9]=Y,i[10]=Q,i[11]=ie,i[12]=l*re+A*ae+X*me+e[12],i[13]=p*re+D*ae+Y*me+e[13],i[14]=_*re+B*ae+Q*me+e[14],i[15]=b*re+G*ae+ie*me+e[15]),i},R.P=V,R.Q=function(i,e,n){var l=n[0],p=n[1],_=n[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*_,i[9]=e[9]*_,i[10]=e[10]*_,i[11]=e[11]*_,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},R.R=ja,R.S=function(i,e,n){var l=e[0],p=e[1],_=e[2],b=e[3],A=e[4],D=e[5],B=e[6],G=e[7],X=e[8],Y=e[9],Q=e[10],ie=e[11],re=e[12],ae=e[13],me=e[14],Fe=e[15],_e=n[0],we=n[1],Ge=n[2],Ye=n[3];return i[0]=_e*l+we*A+Ge*X+Ye*re,i[1]=_e*p+we*D+Ge*Y+Ye*ae,i[2]=_e*_+we*B+Ge*Q+Ye*me,i[3]=_e*b+we*G+Ge*ie+Ye*Fe,i[4]=(_e=n[4])*l+(we=n[5])*A+(Ge=n[6])*X+(Ye=n[7])*re,i[5]=_e*p+we*D+Ge*Y+Ye*ae,i[6]=_e*_+we*B+Ge*Q+Ye*me,i[7]=_e*b+we*G+Ge*ie+Ye*Fe,i[8]=(_e=n[8])*l+(we=n[9])*A+(Ge=n[10])*X+(Ye=n[11])*re,i[9]=_e*p+we*D+Ge*Y+Ye*ae,i[10]=_e*_+we*B+Ge*Q+Ye*me,i[11]=_e*b+we*G+Ge*ie+Ye*Fe,i[12]=(_e=n[12])*l+(we=n[13])*A+(Ge=n[14])*X+(Ye=n[15])*re,i[13]=_e*p+we*D+Ge*Y+Ye*ae,i[14]=_e*_+we*B+Ge*Q+Ye*me,i[15]=_e*b+we*G+Ge*ie+Ye*Fe,i},R.T=pp,R.U=function(i,e){const n={};for(let l=0;l<e.length;l++){const p=e[l];p in i&&(n[p]=i[p])}return n},R.V=Ec,R.W=Mn,R.X=X0,R.Y=dg,R.Z=qe,R._=h,R.a=ge,R.a$=pt,R.a0=ke,R.a1=di,R.a2=Mo,R.a3=pg,R.a4=xf,R.a5=mt,R.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const l=bf(i),p=bf(e);(function(b,A){A.removeAll&&(b.add.clear(),b.update.clear(),b.remove.clear(),A.remove.clear());for(const D of A.remove)b.add.delete(D),b.update.delete(D);for(const[D,B]of A.update){const G=b.update.get(D);G&&(A.update.set(D,Y0(G,B)),b.update.delete(D))}})(l,p);const _={};if((l.removeAll||p.removeAll)&&(_.removeAll=!0),_.remove=new Set([...l.remove,...p.remove]),_.add=new Map([...l.add,...p.add]),_.update=new Map([...l.update,...p.update]),_.remove.size&&_.add.size)for(const b of _.add.keys())_.remove.delete(b);return(function(b){const A={};return b.removeAll&&(A.removeAll=b.removeAll),b.remove&&(A.remove=Array.from(b.remove)),b.add&&(A.add=Array.from(b.add.values())),b.update&&(A.update=Array.from(b.update.values())),A})(_)},R.a7=function(i,e){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const l=_f(i,e);return l==null?void 0:(n.set(l,i),n)}if(i.type==="FeatureCollection"){const l=new Set;for(const p of i.features){const _=_f(p,e);if(_==null||l.has(_))return;l.add(_),n.set(_,p)}return n}},R.a8=function(i,e,n){var l,p;const _=[];if(e.removeAll)i.clear();else if(e.remove)for(const b of e.remove){const A=i.get(b);A&&(_.push(A.geometry),i.delete(b))}if(e.add)for(const b of e.add){const A=_f(b,n);if(A==null)continue;const D=i.get(A);D&&_.push(D.geometry),_.push(b.geometry),i.set(A,b)}if(e.update)for(const b of e.update){const A=i.get(b.id);if(!A)continue;const D=!!b.newGeometry,B=b.removeAllProperties||((l=b.removeProperties)===null||l===void 0?void 0:l.length)>0||((p=b.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0;if(!D&&!B)continue;_.push(A.geometry);const G=Object.assign({},A);if(i.set(b.id,G),D&&(_.push(b.newGeometry),G.geometry=b.newGeometry),B){if(G.properties=b.removeAllProperties?{}:Object.assign({},G.properties||{}),b.removeProperties)for(const X of b.removeProperties)delete G.properties[X];if(b.addOrUpdateProperties)for(const{key:X,value:Y}of b.addOrUpdateProperties)G.properties[X]=Y}}return _},R.a9=pr,R.aA=function(i,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/Ho:i.kind==="composite"?xr.number(l/Ho,p/Ho,n):e},R.aB=function(i,e){var n=e[0],l=e[1],p=e[2],_=e[3],b=e[4],A=e[5],D=e[6],B=e[7],G=e[8],X=e[9],Y=e[10],Q=e[11],ie=e[12],re=e[13],ae=e[14],me=e[15],Fe=n*A-l*b,_e=n*D-p*b,we=n*B-_*b,Ge=l*D-p*A,Ye=l*B-_*A,St=p*B-_*D,Wt=G*re-X*ie,Vt=G*ae-Y*ie,en=G*me-Q*ie,Sn=X*ae-Y*re,sn=X*me-Q*re,Ht=Y*me-Q*ae,kt=Fe*Ht-_e*sn+we*Sn+Ge*en-Ye*Vt+St*Wt;return kt?(i[0]=(A*Ht-D*sn+B*Sn)*(kt=1/kt),i[1]=(p*sn-l*Ht-_*Sn)*kt,i[2]=(re*St-ae*Ye+me*Ge)*kt,i[3]=(Y*Ye-X*St-Q*Ge)*kt,i[4]=(D*en-b*Ht-B*Vt)*kt,i[5]=(n*Ht-p*en+_*Vt)*kt,i[6]=(ae*we-ie*St-me*_e)*kt,i[7]=(G*St-Y*we+Q*_e)*kt,i[8]=(b*sn-A*en+B*Wt)*kt,i[9]=(l*en-n*sn-_*Wt)*kt,i[10]=(ie*Ye-re*we+me*Fe)*kt,i[11]=(X*we-G*Ye-Q*Fe)*kt,i[12]=(A*Vt-b*Sn-D*Wt)*kt,i[13]=(n*Sn-l*Vt+p*Wt)*kt,i[14]=(re*_e-ie*Ge-ae*Fe)*kt,i[15]=(G*Ge-X*_e+Y*Fe)*kt,i):null},R.aC=je,R.aD=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},R.aE=function(i){return i[0]=0,i[1]=0,i},R.aF=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},R.aG=V0,R.aH=Rt,R.aI=function(i,e,n,l){const p=e.y-i.y,_=e.x-i.x,b=l.y-n.y,A=l.x-n.x,D=b*_-A*p;if(D===0)return null;const B=(A*(i.y-n.y)-b*(i.x-n.x))/D;return new V(i.x+B*_,i.y+B*p)},R.aJ=r,R.aK=gh,R.aL=function(i){let e=1/0,n=1/0,l=-1/0,p=-1/0;for(const _ of i)e=Math.min(e,_.x),n=Math.min(n,_.y),l=Math.max(l,_.x),p=Math.max(p,_.y);return[e,n,l,p]},R.aM=Ls,R.aN=Xt,R.aO=function(i,e,n,l,p=!1){if(!n[0]&&!n[1])return[0,0];const _=p?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(_){const b=Math.sin(_),A=Math.cos(_);n=[n[0]*A-n[1]*b,n[0]*b+n[1]*A]}return[p?n[0]:Xt(e,n[0],i.zoom),p?n[1]:Xt(e,n[1],i.zoom)]},R.aQ=Np,R.aR=gm,R.aS=B0,R.aT=R1,R.aU=Gr,R.aV=lf,R.aW=Ae,R.aX=En,R.aY=Ct,R.aZ=ci,R.a_=W0,R.aa=Du,R.ab=25,R.ac=ua,R.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const l of i){const p=window.document.createElement("source");Ue(l)||(e.crossOrigin="Anonymous"),p.src=l,e.appendChild(p)}}))},R.ae=Zt,R.af=function(){return Rn++},R.ag=x,R.ah=yd,R.ai=Of,R.aj=Pa,R.ak=Vo,R.al=jp,R.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,p,_)=>{const b=p||_;return e[l]=!b||b.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},R.an=Bt,R.ao=85.051129,R.ap=fi,R.aq=function(i){return Math.pow(2,i)},R.ar=Ut,R.as=fg,R.at=function(i){return Math.log(i)/Math.LN2},R.au=function(i){var e=i[0],n=i[1];return e*e+n*n},R.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((D=>D.canonical.z)));let n=1/0,l=-1/0,p=1/0,_=-1/0;const b=[];for(const D of i){const{x:B,y:G,z:X}=D.canonical,Y=Math.pow(2,e-X),Q=B*Y,ie=G*Y;b.push({id:D,x:Q,y:ie}),Q<n&&(n=Q),Q>l&&(l=Q),ie<p&&(p=ie),ie>_&&(_=ie)}const A=new Set;for(const D of b)D.x!==n&&D.x!==l&&D.y!==p&&D.y!==_||A.add(D.id);return A},R.aw=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},R.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const p={value:e,timeout:void 0};if(n!==void 0&&(p.timeout=setTimeout((()=>{this.remove(i,p)}),n)),this.data[l].push(p),this.order.push(l),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,l=e===void 0?0:this.data[n].indexOf(e),p=this.data[n][l];return this.data[n].splice(l,1),p.timeout&&clearTimeout(p.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(p.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const l of this.data[n])i(l.value)||e.push(l);for(const n of e)this.remove(n.value.tileID,n)}},R.ay=function(i,e){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:b}=i,A=p?Bt(sa.interpolationFactor(p,e,_,b),0,1):0;i.kind==="camera"?l=xr.number(i.minSize,i.maxSize,A):n=A}return{uSizeT:n,uSize:l}},R.b=Yt,R.b$=Uo,R.b0=He,R.b1=function(i){var e=new Qe(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},R.b2=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},R.b3=function(i,e){var n=e[0],l=e[1],p=e[2],_=n*n+l*l+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=e[0]*_,i[1]=e[1]*_,i[2]=e[2]*_,i},R.b4=Pe,R.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},R.b6=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},R.b7=tt,R.b8=function(i,e,n){const l=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return l===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/l},R.b9=gt,R.bA=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i},R.bB=Se,R.bC=function(i,e,n){var l=n[0],p=n[1],_=n[2],b=n[3],A=e[0],D=e[1],B=e[2],G=p*B-_*D,X=_*A-l*B,Y=l*D-p*A;return i[0]=A+b*(G+=G)+p*(Y+=Y)-_*(X+=X),i[1]=D+b*X+_*G-l*Y,i[2]=B+b*Y+l*X-p*G,i},R.bD=function(i,e,n){const l=(function(D){var B=D[3],G=D[4],X=D[5],Y=D[6],Q=D[7],ie=D[8];return D[0]*(ie*G-X*Q)+D[1]*(-ie*B+X*Y)+D[2]*(Q*B-G*Y)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(l===0)return null;const p=Pe([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),_=Pe([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),b=Pe([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),A=pt([],p,-i[3]);return He(A,A,pt([],_,-e[3])),He(A,A,pt([],b,-n[3])),pt(A,A,1/l),A},R.bE=Bp,R.bF=function(){return new Float64Array(4)},R.bG=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[0]*Math.cos(l)-p[1]*Math.sin(l),_[1]=p[0]*Math.sin(l)+p[1]*Math.cos(l),_[2]=p[2],i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},R.bH=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[0],_[1]=p[1]*Math.cos(l)-p[2]*Math.sin(l),_[2]=p[1]*Math.sin(l)+p[2]*Math.cos(l),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},R.bI=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[2]*Math.sin(l)+p[0]*Math.cos(l),_[1]=p[1],_[2]=p[2]*Math.cos(l)-p[0]*Math.sin(l),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},R.bJ=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[0],b=e[1],A=e[2],D=e[3],B=e[8],G=e[9],X=e[10],Y=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*p-B*l,i[1]=b*p-G*l,i[2]=A*p-X*l,i[3]=D*p-Y*l,i[8]=_*l+B*p,i[9]=b*l+G*p,i[10]=A*l+X*p,i[11]=D*l+Y*p,i},R.bK=function(i,e){const n=Oe(i,360),l=Oe(e,360),p=l-n,_=l>n?p-360:p+360;return Math.abs(p)<Math.abs(_)?p:_},R.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},R.bM=function(i,e,n,l){const p=Math.sqrt(i*i+e*e),_=Math.sqrt(n*n+l*l);i/=p,e/=p,n/=_,l/=_;const b=Math.acos(i*n+e*l);return-e*n+i*l>0?b:-b},R.bN=function(i,e){const n=Oe(i,2*Math.PI),l=Oe(e,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},R.bO=function(){const i={},e=Ke.$version;for(const n in Ke.$root){const l=Ke.$root[n];if(l.required){let p=null;p=n==="version"?e:l.type==="array"?[]:{},p!=null&&(i[n]=p)}}return i},R.bP=de,R.bQ=Qh,R.bR=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],n[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const l in e)if(!i(e[l],n[l]))return!1;return!0}return e===n},R.bS=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Fn(i[n],e[i[n].ref]));return i},R.bT=function(i,e){if(i.type==="custom")return new q0(i,e);switch(i.type){case"background":return new Wi(i,e);case"circle":return new hp(i,e);case"color-relief":return new jm(i,e);case"fill":return new qm(i,e);case"fill-extrusion":return new D0(i,e);case"heatmap":return new Bm(i,e);case"hillshade":return new ns(i,e);case"line":return new k0(i,e);case"raster":return new ql(i,e);case"symbol":return new Ru(i,e)}},R.bU=i=>i.type==="raster",R.bV=$n,R.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!wn(i.version,e.version))return[{command:"setStyle",args:[e]}];wn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),wn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),wn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),wn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),wn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),wn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),wn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),wn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),wn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),wn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),wn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),wn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),wn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),wn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const l={},p=[];(function(b,A,D,B){let G;for(G in A=A||{},b=b||{})Object.prototype.hasOwnProperty.call(b,G)&&(Object.prototype.hasOwnProperty.call(A,G)||Yn(G,D,B));for(G in A)Object.prototype.hasOwnProperty.call(A,G)&&(Object.prototype.hasOwnProperty.call(b,G)?wn(b[G],A[G])||(b[G].type==="geojson"&&A[G].type==="geojson"&&Jt(b,A,G)?_n(D,{command:"setGeoJSONSourceData",args:[G,A[G].data]}):nn(G,A,D,B)):gi(G,A,D))})(i.sources,e.sources,p,l);const _=[];i.layers&&i.layers.forEach((b=>{"source"in b&&l[b.source]?n.push({command:"removeLayer",args:[b.id]}):_.push(b)})),n=n.concat(p),(function(b,A,D){A=A||[];const B=(b=b||[]).map(Di),G=A.map(Di),X=b.reduce(Fi,{}),Y=A.reduce(Fi,{}),Q=B.slice(),ie=Object.create(null);let re,ae,me,Fe,_e;for(let we=0,Ge=0;we<B.length;we++)re=B[we],Object.prototype.hasOwnProperty.call(Y,re)?Ge++:(_n(D,{command:"removeLayer",args:[re]}),Q.splice(Q.indexOf(re,Ge),1));for(let we=0,Ge=0;we<G.length;we++)re=G[G.length-1-we],Q[Q.length-1-we]!==re&&(Object.prototype.hasOwnProperty.call(X,re)?(_n(D,{command:"removeLayer",args:[re]}),Q.splice(Q.lastIndexOf(re,Q.length-Ge),1)):Ge++,Fe=Q[Q.length-we],_n(D,{command:"addLayer",args:[Y[re],Fe]}),Q.splice(Q.length-we,0,re),ie[re]=!0);for(let we=0;we<G.length;we++)if(re=G[we],ae=X[re],me=Y[re],!ie[re]&&!wn(ae,me))if(wn(ae.source,me.source)&&wn(ae["source-layer"],me["source-layer"])&&wn(ae.type,me.type)){for(_e in Bn(ae.layout,me.layout,D,re,null,"setLayoutProperty"),Bn(ae.paint,me.paint,D,re,null,"setPaintProperty"),wn(ae.filter,me.filter)||_n(D,{command:"setFilter",args:[re,me.filter]}),wn(ae.minzoom,me.minzoom)&&wn(ae.maxzoom,me.maxzoom)||_n(D,{command:"setLayerZoomRange",args:[re,me.minzoom,me.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?Bn(ae[_e],me[_e],D,re,_e.slice(6),"setPaintProperty"):wn(ae[_e],me[_e])||_n(D,{command:"setLayerProperty",args:[re,_e,me[_e]]}));for(_e in me)Object.prototype.hasOwnProperty.call(me,_e)&&!Object.prototype.hasOwnProperty.call(ae,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?Bn(ae[_e],me[_e],D,re,_e.slice(6),"setPaintProperty"):wn(ae[_e],me[_e])||_n(D,{command:"setLayerProperty",args:[re,_e,me[_e]]}))}else _n(D,{command:"removeLayer",args:[re]}),Fe=Q[Q.lastIndexOf(re)+1],_n(D,{command:"addLayer",args:[me,Fe]})})(_,e.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[e]}]}return n},R.bX=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},R.bY=ri,R.bZ=_i,R.b_=class extends Ba{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},R.ba=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},R.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},R.bc=mg,R.bd=_d,R.be=function(i,e,n,l,p){var _=1/Math.tan(e/2);if(i[0]=_/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0){var b=1/(l-p);i[10]=(p+l)*b,i[14]=2*p*l*b}else i[10]=-1,i[14]=-2*l;return i},R.bf=function(i){var e=new Qe(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},R.bg=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[0],b=e[1],A=e[2],D=e[3],B=e[4],G=e[5],X=e[6],Y=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*p+B*l,i[1]=b*p+G*l,i[2]=A*p+X*l,i[3]=D*p+Y*l,i[4]=B*p-_*l,i[5]=G*p-b*l,i[6]=X*p-A*l,i[7]=Y*p-D*l,i},R.bh=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[4],b=e[5],A=e[6],D=e[7],B=e[8],G=e[9],X=e[10],Y=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=_*p+B*l,i[5]=b*p+G*l,i[6]=A*p+X*l,i[7]=D*p+Y*l,i[8]=B*p-_*l,i[9]=G*p-b*l,i[10]=X*p-A*l,i[11]=Y*p-D*l,i},R.bi=function(){const i=new Float32Array(16);return Ut(i),i},R.bj=function(){const i=new Float64Array(16);return Ut(i),i},R.bk=function(){return new Float64Array(16)},R.bl=function(i,e,n){const l=new Float64Array(4);return Se(l,i,e-90,n),l},R.bm=function(i,e,n,l){var p,_,b,A,D,B=e[0],G=e[1],X=e[2],Y=e[3],Q=n[0],ie=n[1],re=n[2],ae=n[3];return(_=B*Q+G*ie+X*re+Y*ae)<0&&(_=-_,Q=-Q,ie=-ie,re=-re,ae=-ae),1-_>nt?(p=Math.acos(_),b=Math.sin(p),A=Math.sin((1-l)*p)/b,D=Math.sin(l*p)/b):(A=1-l,D=l),i[0]=A*B+D*Q,i[1]=A*G+D*ie,i[2]=A*X+D*re,i[3]=A*Y+D*ae,i},R.bn=function(i){const e=new Float64Array(9);(function(_,b){var A=b[0],D=b[1],B=b[2],G=b[3],X=A+A,Y=D+D,Q=B+B,ie=A*X,re=D*X,ae=D*Y,me=B*X,Fe=B*Y,_e=B*Q,we=G*X,Ge=G*Y,Ye=G*Q;_[0]=1-ae-_e,_[3]=re-Ye,_[6]=me+Ge,_[1]=re+Ye,_[4]=1-ie-_e,_[7]=Fe-we,_[2]=me-Ge,_[5]=Fe+we,_[8]=1-ie-ae})(e,i);const n=ci(-Math.asin(Bt(e[2],-1,1)));let l,p;return Math.hypot(e[5],e[8])<.001?(l=0,p=-ci(Math.atan2(e[3],e[4]))):(l=ci(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),p=ci(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:l,pitch:n+90,bearing:p}},R.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},R.bp=ui,R.bq=Hc,R.br=To,R.bs=$l,R.bt=ca,R.bu=Xe,R.bv=It,R.bw=Kr,R.bx=function(i,e,n,l,p){return Xe(l,p,Bt((i-e)/(n-e),0,1))},R.by=Oe,R.bz=function(){return new Float64Array(3)},R.c=$e,R.c$=function(i,e,n,l,p){return h(this,void 0,void 0,(function*(){if(ke())try{return yield di(i,e,n,l,p)}catch{}return(function(_,b,A,D,B){const G=_.width,X=_.height;gn&&Zn||(gn=new OffscreenCanvas(G,X),Zn=gn.getContext("2d",{willReadFrequently:!0})),gn.width=G,gn.height=X,Zn.drawImage(_,0,0,G,X);const Y=Zn.getImageData(b,A,D,B);return Zn.clearRect(0,0,G,X),Y.data})(i,e,n,l,p)}))},R.c0=class extends Ba{constructor(i,e){super(i,e),this.current=Fa}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},R.c1=Su,R.c2=class extends Ba{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},R.c3=class extends Ba{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},R.c4=dt,R.c5=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=0,i[3]=-n,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},R.c6=function(i,e,n){var l=e[0],p=e[1],_=e[2];return i[0]=l*n[0]+p*n[3]+_*n[6],i[1]=l*n[1]+p*n[4]+_*n[7],i[2]=l*n[2]+p*n[5]+_*n[8],i},R.c7=function(i,e,n,l,p,_,b){var A=1/(e-n),D=1/(l-p),B=1/(_-b);return i[0]=-2*A,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*D,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*B,i[11]=0,i[12]=(e+n)*A,i[13]=(p+l)*D,i[14]=(b+_)*B,i[15]=1,i},R.c8=class extends Ba{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},R.c9=class extends Ba{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},R.cA=function(i,e){return ct[e]&&"touches"in i},R.cB=function(i){return ct[i]||oe[i]},R.cC=function(i,e,n){var l=e[0],p=e[1];return i[0]=n[0]*l+n[4]*p+n[12],i[1]=n[1]*l+n[5]*p+n[13],i},R.cD=function(i,e){const{x:n,y:l}=pr.fromLngLat(e);return!(i<0||i>25||l<0||l>=1||n<0||n>=1)},R.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},R.cF=class extends jc{},R.cG=D2,R.cI=fe,R.cJ=function(i,e){$e.REGISTERED_PROTOCOLS[i]=e},R.cK=function(i){delete $e.REGISTERED_PROTOCOLS[i]},R.cL=function(i,e){const n={};for(let p=0;p<i.length;p++){const _=e&&e[i[p].id]||Bl(i[p]);e&&(e[i[p].id]=_);let b=n[_];b||(b=n[_]=[]),b.push(i[p])}const l=[];for(const p in n)l.push(n[p]);return l},R.cM=Cn,R.cN=$0,R.cO=mm,R.cP=Mp,R.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=mt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,l=e._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new cr(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new cr(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new cr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:G}=i.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new cr(B),i.canonical),l["text-size"].possiblyEvaluate(new cr(G),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:G}=i.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new cr(B),i.canonical),l["icon-size"].possiblyEvaluate(new cr(G),i.canonical)]}const _=n.get("text-line-height")*Ls,b=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",A=n.get("text-keep-upright"),D=n.get("text-size");for(const B of i.bucket.features){const G=n.get("text-font").evaluate(B,{},i.canonical).join(","),X=D.evaluate(B,{},i.canonical),Y=p.layoutTextSize.evaluate(B,{},i.canonical),Q=p.layoutIconSize.evaluate(B,{},i.canonical),ie={horizontal:{},vertical:void 0},re=B.text;let ae,me=[0,0];if(re){const we=re.toString(),Ge=n.get("text-letter-spacing").evaluate(B,{},i.canonical)*Ls,Ye=Jh(we)?Ge:0,St=n.get("text-anchor").evaluate(B,{},i.canonical),Wt=ru(e,B,i.canonical);if(!Wt){const sn=n.get("text-radial-offset").evaluate(B,{},i.canonical);me=sn?hr(St,[sn*Ls,qi]):n.get("text-offset").evaluate(B,{},i.canonical).map((Ht=>Ht*Ls))}let Vt=b?"center":n.get("text-justify").evaluate(B,{},i.canonical);const en=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(B,{},i.canonical)*Ls:1/0,Sn=()=>{i.bucket.allowVerticalPlacement&&yl(we)&&(ie.vertical=mf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,en,_,St,"left",Ye,me,R.az.vertical,!0,Y,X))};if(!b&&Wt){const sn=new Set;if(Vt==="auto")for(let kt=0;kt<Wt.values.length;kt+=2)sn.add(gm(Wt.values[kt]));else sn.add(Vt);let Ht=!1;for(const kt of sn)if(!ie.horizontal[kt])if(Ht)ie.horizontal[kt]=ie.horizontal[0];else{const Nn=mf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,en,_,"center",kt,Ye,me,R.az.horizontal,!1,Y,X);Nn&&(ie.horizontal[kt]=Nn,Ht=Nn.positionedLines.length===1)}Sn()}else{Vt==="auto"&&(Vt=gm(St));const sn=mf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,en,_,St,Vt,Ye,me,R.az.horizontal,!1,Y,X);sn&&(ie.horizontal[Vt]=sn),Sn(),yl(we)&&b&&A&&(ie.vertical=mf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,en,_,St,Vt,Ye,me,R.az.vertical,!1,Y,X))}}let Fe=!1;if(B.icon&&B.icon.name){const we=i.imageMap[B.icon.name];we&&(ae=j0(i.imagePositions[B.icon.name],n.get("icon-offset").evaluate(B,{},i.canonical),n.get("icon-anchor").evaluate(B,{},i.canonical)),Fe=!!we.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Fe:i.bucket.sdfIcons!==Fe&&Qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const _e=_x(ie.horizontal)||ie.vertical;i.bucket.iconsInText=!!_e&&_e.iconsInText,(_e||ae)&&M2(i.bucket,B,ie,ae,i.imageMap,p,Y,Q,me,Fe,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},R.cR=xh,R.cS=Au,R.cT=ud,R.cU=function(i){const e=new Ap;return(function(n,l){for(const p in n.layers)l.writeMessage(3,Qp,n.layers[p])})(i,e),e.finish()},R.cV=function(i,e,n,l,p,_){let b=o(i,e,n,p,0);return b=o(b,e,l,_,1),b},R.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},R.cX=Xi,R.cY=Ap,R.cZ=Pf,R.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},R.ca=class extends Xl{},R.cb=$m,R.cc=class extends Hr{},R.cd=Jd,R.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},R.cf=vc,R.cg=function(i,e,n){var l=e[0],p=e[1],_=e[2],b=n[3]*l+n[7]*p+n[11]*_+n[15];return i[0]=(n[0]*l+n[4]*p+n[8]*_+n[12])/(b=b||1),i[1]=(n[1]*l+n[5]*p+n[9]*_+n[13])/b,i[2]=(n[2]*l+n[6]*p+n[10]*_+n[14])/b,i},R.ch=class extends Uc{},R.ci=class extends t{},R.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},R.ck=function(i,e){var n=i[0],l=i[1],p=i[2],_=i[3],b=i[4],A=i[5],D=i[6],B=i[7],G=i[8],X=i[9],Y=i[10],Q=i[11],ie=i[12],re=i[13],ae=i[14],me=i[15],Fe=e[0],_e=e[1],we=e[2],Ge=e[3],Ye=e[4],St=e[5],Wt=e[6],Vt=e[7],en=e[8],Sn=e[9],sn=e[10],Ht=e[11],kt=e[12],Nn=e[13],In=e[14],On=e[15];return Math.abs(n-Fe)<=nt*Math.max(1,Math.abs(n),Math.abs(Fe))&&Math.abs(l-_e)<=nt*Math.max(1,Math.abs(l),Math.abs(_e))&&Math.abs(p-we)<=nt*Math.max(1,Math.abs(p),Math.abs(we))&&Math.abs(_-Ge)<=nt*Math.max(1,Math.abs(_),Math.abs(Ge))&&Math.abs(b-Ye)<=nt*Math.max(1,Math.abs(b),Math.abs(Ye))&&Math.abs(A-St)<=nt*Math.max(1,Math.abs(A),Math.abs(St))&&Math.abs(D-Wt)<=nt*Math.max(1,Math.abs(D),Math.abs(Wt))&&Math.abs(B-Vt)<=nt*Math.max(1,Math.abs(B),Math.abs(Vt))&&Math.abs(G-en)<=nt*Math.max(1,Math.abs(G),Math.abs(en))&&Math.abs(X-Sn)<=nt*Math.max(1,Math.abs(X),Math.abs(Sn))&&Math.abs(Y-sn)<=nt*Math.max(1,Math.abs(Y),Math.abs(sn))&&Math.abs(Q-Ht)<=nt*Math.max(1,Math.abs(Q),Math.abs(Ht))&&Math.abs(ie-kt)<=nt*Math.max(1,Math.abs(ie),Math.abs(kt))&&Math.abs(re-Nn)<=nt*Math.max(1,Math.abs(re),Math.abs(Nn))&&Math.abs(ae-In)<=nt*Math.max(1,Math.abs(ae),Math.abs(In))&&Math.abs(me-On)<=nt*Math.max(1,Math.abs(me),Math.abs(On))},R.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},R.cm=i=>i.type==="symbol",R.cn=i=>i.type==="circle",R.co=i=>i.type==="heatmap",R.cp=i=>i.type==="line",R.cq=i=>i.type==="fill",R.cr=i=>i.type==="fill-extrusion",R.cs=i=>i.type==="hillshade",R.ct=i=>i.type==="color-relief",R.cu=i=>i.type==="background",R.cv=i=>i.type==="custom",R.cw=Nt,R.cx=function(i,e,n){const l=st(e.x-n.x,e.y-n.y),p=st(i.x-n.x,i.y-n.y),_=Math.atan2(l[0]*p[1]-l[1]*p[0],(function(b,A){return b[0]*A[0]+b[1]*A[1]})(l,p));return ci(_)},R.cy=$t,R.cz=function(i,e){return oe[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},R.d=Ue,R.d0=ad,R.d1=H,R.d2=class{constructor(i,e){this.layers={[Of]:this},this.name=Of,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new Ig(this.features[i],this.extent)}},R.d3=pu,R.d4=_o,R.e=Tn,R.f=i=>h(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),R.g=bt,R.h=i=>new Promise(((e,n)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=fn}))},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(p):fn})),R.i=Bi,R.j=(i,e)=>Me(Tn(i,{type:"json"}),e),R.k=Ot,R.l=qt,R.m=Me,R.n=(i,e)=>Me(Tn(i,{type:"arrayBuffer"}),e),R.o=function(i){return new Ap(i).readFields(sg,[])},R.p=L0,R.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},R.r=Qd,R.s=Yi,R.t=os,R.u=Ke,R.v=nh,R.w=Qn,R.x=td,R.y=Po,R.z=Hl})),N("worker",["./shared"],(function(R){class h{constructor(oe,ue){this.keyCache={},oe&&this.replace(oe,ue)}replace(oe,ue){this._layerConfigs={},this._layers={},this.update(oe,[],ue)}update(oe,ue,ge){for(const $e of oe){this._layerConfigs[$e.id]=$e;const bt=this._layers[$e.id]=R.bT($e,ge);bt._featureFilter=R.aj(bt.filter,ge),this.keyCache[$e.id]&&delete this.keyCache[$e.id]}for(const $e of ue)delete this.keyCache[$e],delete this._layerConfigs[$e],delete this._layers[$e];this.familiesBySource={};const qe=R.cL(Object.values(this._layerConfigs),this.keyCache);for(const $e of qe){const bt=$e.map((xt=>this._layers[xt.id])),at=bt[0];if(at.isHidden())continue;const fe=at.source||"";let de=this.familiesBySource[fe];de||(de=this.familiesBySource[fe]={});const Me=at.sourceLayer||R.ai;let Ue=de[Me];Ue||(Ue=de[Me]=[]),Ue.push(bt)}}}class V{constructor(oe){const ue={},ge=[];for(const at in oe){const fe=oe[at],de=ue[at]={};for(const Me in fe){const Ue=fe[+Me];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const xt={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};ge.push(xt),de[Me]={rect:xt,metrics:Ue.metrics}}}const{w:qe,h:$e}=R.p(ge),bt=new R.r({width:qe||1,height:$e||1});for(const at in oe){const fe=oe[at];for(const de in fe){const Me=fe[+de];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const Ue=ue[at][de].rect;R.r.copy(Me.bitmap,bt,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},Me.bitmap)}}this.image=bt,this.positions=ue}}R.cM("GlyphAtlas",V);class H{constructor(oe){this.tileID=new R.a2(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.uid=oe.uid,this.zoom=oe.zoom,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.collectResourceTiming,this.returnDependencies=!!oe.returnDependencies,this.promoteId=oe.promoteId,this.inFlightDependencies=[]}parse(oe,ue,ge,qe,$e){return R._(this,void 0,void 0,(function*(){this.status="parsing",this.data=oe,this.collisionBoxArray=new R.ag;const bt=new R.cN(Object.keys(oe.layers).sort()),at=new R.cO(this.tileID,this.promoteId);at.bucketLayerIDs=[];const fe={},de={featureIndex:at,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ge,subdivisionGranularity:$e},Me=ue.familiesBySource[this.source];for(const Jt in Me){const Bn=oe.layers[Jt];if(!Bn)continue;Bn.version===1&&R.w(`Vector tile source "${this.source}" layer "${Jt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Di=bt.encode(Jt),Fi=[];for(let Zt=0;Zt<Bn.length;Zt++){const xi=Bn.feature(Zt),bn=at.getId(xi,Jt);Fi.push({feature:xi,id:bn,index:Zt,sourceLayerIndex:Di})}for(const Zt of Me[Jt]){const xi=Zt[0];xi.source!==this.source&&R.w(`layer.source = ${xi.source} does not equal this.source = ${this.source}`),xi.isHidden(this.zoom,!0)||($(Zt,this.zoom,ge),(fe[xi.id]=xi.createBucket({index:at.bucketLayerIDs.length,layers:Zt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Di,sourceID:this.source})).populate(Fi,de,this.tileID.canonical),at.bucketLayerIDs.push(Zt.map((bn=>bn.id))))}}const Ue=R.bY(de.glyphDependencies,(Jt=>Object.keys(Jt).map(Number)));this.inFlightDependencies.forEach((Jt=>Jt?.abort())),this.inFlightDependencies=[];let xt=Promise.resolve({});if(Object.keys(Ue).length){const Jt=new AbortController;this.inFlightDependencies.push(Jt),xt=qe.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},Jt)}const yt=Object.keys(de.iconDependencies);let qt=Promise.resolve({});if(yt.length){const Jt=new AbortController;this.inFlightDependencies.push(Jt),qt=qe.sendAsync({type:"GI",data:{icons:yt,source:this.source,tileID:this.tileID,type:"icons"}},Jt)}const Ot=Object.keys(de.patternDependencies);let cn=Promise.resolve({});if(Ot.length){const Jt=new AbortController;this.inFlightDependencies.push(Jt),cn=qe.sendAsync({type:"GI",data:{icons:Ot,source:this.source,tileID:this.tileID,type:"patterns"}},Jt)}const Ke=de.dashDependencies;let kn=Promise.resolve({});if(Object.keys(Ke).length){const Jt=new AbortController;this.inFlightDependencies.push(Jt),kn=qe.sendAsync({type:"GDA",data:{dashes:Ke}},Jt)}const[Fn,wn,_n,gi]=yield Promise.all([xt,qt,cn,kn]),Yn=new V(Fn),nn=new R.cP(wn,_n);for(const Jt in fe){const Bn=fe[Jt];Bn instanceof R.ah?($(Bn.layers,this.zoom,ge),R.cQ({bucket:Bn,glyphMap:Fn,glyphPositions:Yn.positions,imageMap:wn,imagePositions:nn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:de.subdivisionGranularity})):Bn.hasDependencies&&(Bn instanceof R.cR||Bn instanceof R.cS||Bn instanceof R.cT)&&($(Bn.layers,this.zoom,ge),Bn.addFeatures(de,this.tileID.canonical,nn.patternPositions,gi))}return this.status="done",{buckets:Object.values(fe).filter((Jt=>!Jt.isEmpty())),featureIndex:at,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yn.image,imageAtlas:nn,dashPositions:gi,glyphMap:this.returnDependencies?Fn:null,iconMap:this.returnDependencies?wn:null,glyphPositions:this.returnDependencies?Yn.positions:null}}))}}function $(ct,oe,ue){const ge=new R.H(oe);for(const qe of ct)qe.recalculate(ge,ue)}class K{constructor(oe,ue,ge,qe,$e){this.type=oe,this.properties=ge||{},this.extent=$e,this.pointsArray=ue,this.id=qe}loadGeometry(){return this.pointsArray.map((oe=>oe.map((ue=>new R.P(ue.x,ue.y)))))}}class be{constructor(oe,ue,ge){this.version=2,this._myFeatures=oe,this.name=ue,this.length=oe.length,this.extent=ge}feature(oe){return this._myFeatures[oe]}}class Ce{constructor(){this.layers={}}addLayer(oe){this.layers[oe.name]=oe}}function Ee(ct){let oe=R.cU(ct);return oe.byteOffset===0&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),{vectorTile:ct,rawData:oe.buffer}}function ye(ct,oe,ue){const{extent:ge}=ct,qe=Math.pow(2,ue.z-oe.z),$e=(ue.x-oe.x*qe)*ge,bt=(ue.y-oe.y*qe)*ge,at=[];for(let fe=0;fe<ct.length;fe++){const de=ct.feature(fe);let Me=de.loadGeometry();for(const xt of Me)for(const yt of xt)yt.x=yt.x*qe-$e,yt.y=yt.y*qe-bt;const Ue=128;Me=R.cV(Me,de.type,-Ue,-Ue,ge+Ue,ge+Ue),Me.length!==0&&at.push(new K(de.type,Me,de.properties,de.id,ge))}return new be(at,ct.name,ge)}class he{constructor(oe,ue,ge){this.actor=oe,this.layerIndex=ue,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new R.cW(1e3)}loadVectorTile(oe,ue){return R._(this,void 0,void 0,(function*(){const ge=yield R.n(oe.request,ue);try{return{vectorTile:oe.encoding!=="mlt"?new R.cX(new R.cY(ge.data)):new R.cZ(ge.data),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(qe){const $e=new Uint8Array(ge.data);let bt=`Unable to parse the tile at ${oe.request.url}, `;throw bt+=$e[0]===31&&$e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${qe.message}`,new Error(bt)}}))}loadTile(oe){return R._(this,void 0,void 0,(function*(){const{uid:ue,overzoomParameters:ge}=oe;ge&&(oe.request=ge.overzoomRequest);const qe=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new R.c_(oe.request),$e=new H(oe);this.loading[ue]=$e;const bt=new AbortController;$e.abort=bt;try{const at=yield this.loadVectorTile(oe,bt);if(delete this.loading[ue],!at)return null;if(ge){const xt=this._getOverzoomTile(oe,at.vectorTile);at.rawData=xt.rawData,at.vectorTile=xt.vectorTile}const fe=at.rawData,de={};at.expires&&(de.expires=at.expires),at.cacheControl&&(de.cacheControl=at.cacheControl);const Me={};if(qe){const xt=qe.finish();xt&&(Me.resourceTiming=JSON.parse(JSON.stringify(xt)))}$e.vectorTile=at.vectorTile;const Ue=$e.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);this.loaded[ue]=$e,this.fetching[ue]={rawTileData:fe,cacheControl:de,resourceTiming:Me};try{const xt=yield Ue;return R.e({rawTileData:fe.slice(0),encoding:oe.encoding},xt,de,Me)}finally{delete this.fetching[ue]}}catch(at){throw delete this.loading[ue],$e.status="done",this.loaded[ue]=$e,at}}))}_getOverzoomTile(oe,ue){const{tileID:ge,source:qe,overzoomParameters:$e}=oe,{maxZoomTileID:bt}=$e,at=`${bt.key}_${ge.key}`,fe=this.overzoomedTileResultCache.get(at);if(fe)return fe;const de=new Ce,Me=this.layerIndex.familiesBySource[qe];for(const xt in Me){const yt=ue.layers[xt];if(!yt)continue;const qt=ye(yt,bt,ge.canonical);qt.length>0&&de.addLayer(qt)}const Ue=Ee(de);return this.overzoomedTileResultCache.set(at,Ue),Ue}reloadTile(oe){return R._(this,void 0,void 0,(function*(){const ue=oe.uid;if(!this.loaded||!this.loaded[ue])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[ue];if(ge.showCollisionBoxes=oe.showCollisionBoxes,ge.status==="parsing"){const qe=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);let $e;if(this.fetching[ue]){const{rawTileData:bt,cacheControl:at,resourceTiming:fe}=this.fetching[ue];delete this.fetching[ue],$e=R.e({rawTileData:bt.slice(0),encoding:oe.encoding},qe,at,fe)}else $e=qe;return $e}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity)}))}abortTile(oe){return R._(this,void 0,void 0,(function*(){const ue=this.loading,ge=oe.uid;ue&&ue[ge]&&ue[ge].abort&&(ue[ge].abort.abort(),delete ue[ge])}))}removeTile(oe){return R._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[oe.uid]&&delete this.loaded[oe.uid]}))}}class ke{constructor(){this.loaded={}}loadTile(oe){return R._(this,void 0,void 0,(function*(){const{uid:ue,encoding:ge,rawImageData:qe,redFactor:$e,greenFactor:bt,blueFactor:at,baseShift:fe}=oe,de=qe.width+2,Me=qe.height+2,Ue=R.b(qe)?new R.R({width:de,height:Me},yield R.c$(qe,-1,-1,de,Me)):qe,xt=new R.d0(ue,Ue,ge,$e,bt,at,fe);return this.loaded=this.loaded||{},this.loaded[ue]=xt,xt}))}removeTile(oe){const ue=this.loaded,ge=oe.uid;ue&&ue[ge]&&delete ue[ge]}}var nt,Qe,dt=(function(){if(Qe)return nt;function ct(ue,ge){if(ue.length!==0){oe(ue[0],ge);for(var qe=1;qe<ue.length;qe++)oe(ue[qe],!ge)}}function oe(ue,ge){for(var qe=0,$e=0,bt=0,at=ue.length,fe=at-1;bt<at;fe=bt++){var de=(ue[bt][0]-ue[fe][0])*(ue[fe][1]+ue[bt][1]),Me=qe+de;$e+=Math.abs(qe)>=Math.abs(de)?qe-Me+de:de-Me+qe,qe=Me}qe+$e>=0!=!!ge&&ue.reverse()}return Qe=1,nt=function ue(ge,qe){var $e,bt=ge&&ge.type;if(bt==="FeatureCollection")for($e=0;$e<ge.features.length;$e++)ue(ge.features[$e],qe);else if(bt==="GeometryCollection")for($e=0;$e<ge.geometries.length;$e++)ue(ge.geometries[$e],qe);else if(bt==="Feature")ue(ge.geometry,qe);else if(bt==="Polygon")ct(ge.coordinates,qe);else if(bt==="MultiPolygon")for($e=0;$e<ge.coordinates.length;$e++)ct(ge.coordinates[$e],qe);return ge}})(),Ut=R.d1(dt);const wt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ct=>ct},tt=Math.fround||(Je=new Float32Array(1),ct=>(Je[0]=+ct,Je[0]));var Je;class He{constructor(oe){this.options=Object.assign(Object.create(wt),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:ue,minZoom:ge,maxZoom:qe}=this.options;ue&&console.time("total time");const $e=`prepare ${oe.length} points`;ue&&console.time($e),this.points=oe;const bt=[];for(let fe=0;fe<oe.length;fe++){const de=oe[fe];if(!de.geometry)continue;const[Me,Ue]=de.geometry.coordinates,xt=tt(ot(Me)),yt=tt(gt(Ue));bt.push(xt,yt,1/0,fe,-1,1),this.options.reduce&&bt.push(0)}let at=this.trees[qe+1]=this._createTree(bt);ue&&console.timeEnd($e);for(let fe=qe;fe>=ge;fe--){const de=+Date.now();at=this.trees[fe]=this._createTree(this._cluster(at,fe)),ue&&console.log("z%d: %d clusters in %dms",fe,at.numItems,+Date.now()-de)}return ue&&console.timeEnd("total time"),this}getClusters(oe,ue){let ge=((oe[0]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,oe[1]));let $e=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)ge=-180,$e=180;else if(ge>$e){const Ue=this.getClusters([ge,qe,180,bt],ue),xt=this.getClusters([-180,qe,$e,bt],ue);return Ue.concat(xt)}const at=this.trees[this._limitZoom(ue)],fe=at.range(ot(ge),gt(bt),ot($e),gt(qe)),de=at.data,Me=[];for(const Ue of fe){const xt=this.stride*Ue;Me.push(de[xt+5]>1?pt(de,xt,this.clusterProps):this.points[de[xt+3]])}return Me}getChildren(oe){const ue=this._getOriginId(oe),ge=this._getOriginZoom(oe),qe="No cluster with the specified id.",$e=this.trees[ge];if(!$e)throw new Error(qe);const bt=$e.data;if(ue*this.stride>=bt.length)throw new Error(qe);const at=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),fe=$e.within(bt[ue*this.stride],bt[ue*this.stride+1],at),de=[];for(const Me of fe){const Ue=Me*this.stride;bt[Ue+4]===oe&&de.push(bt[Ue+5]>1?pt(bt,Ue,this.clusterProps):this.points[bt[Ue+3]])}if(de.length===0)throw new Error(qe);return de}getLeaves(oe,ue,ge){const qe=[];return this._appendLeaves(qe,oe,ue=ue||10,ge=ge||0,0),qe}getTile(oe,ue,ge){const qe=this.trees[this._limitZoom(oe)],$e=Math.pow(2,oe),{extent:bt,radius:at}=this.options,fe=at/bt,de=(ge-fe)/$e,Me=(ge+1+fe)/$e,Ue={features:[]};return this._addTileFeatures(qe.range((ue-fe)/$e,de,(ue+1+fe)/$e,Me),qe.data,ue,ge,$e,Ue),ue===0&&this._addTileFeatures(qe.range(1-fe/$e,de,1,Me),qe.data,$e,ge,$e,Ue),ue===$e-1&&this._addTileFeatures(qe.range(0,de,fe/$e,Me),qe.data,-1,ge,$e,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(oe){let ue=this._getOriginZoom(oe)-1;for(;ue<=this.options.maxZoom;){const ge=this.getChildren(oe);if(ue++,ge.length!==1)break;oe=ge[0].properties.cluster_id}return ue}_appendLeaves(oe,ue,ge,qe,$e){const bt=this.getChildren(ue);for(const at of bt){const fe=at.properties;if(fe&&fe.cluster?$e+fe.point_count<=qe?$e+=fe.point_count:$e=this._appendLeaves(oe,fe.cluster_id,ge,qe,$e):$e<qe?$e++:oe.push(at),oe.length===ge)break}return $e}_createTree(oe){const ue=new R.aT(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<oe.length;ge+=this.stride)ue.add(oe[ge],oe[ge+1]);return ue.finish(),ue.data=oe,ue}_addTileFeatures(oe,ue,ge,qe,$e,bt){for(const at of oe){const fe=at*this.stride,de=ue[fe+5]>1;let Me,Ue,xt;if(de)Me=Pe(ue,fe,this.clusterProps),Ue=ue[fe],xt=ue[fe+1];else{const Ot=this.points[ue[fe+3]];Me=Ot.properties;const[cn,Ke]=Ot.geometry.coordinates;Ue=ot(cn),xt=gt(Ke)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Ue*$e-ge)),Math.round(this.options.extent*(xt*$e-qe))]],tags:Me};let qt;qt=de||this.options.generateId?ue[fe+3]:this.points[ue[fe+3]].id,qt!==void 0&&(yt.id=qt),bt.features.push(yt)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,ue){const{radius:ge,extent:qe,reduce:$e,minPoints:bt}=this.options,at=ge/(qe*Math.pow(2,ue)),fe=oe.data,de=[],Me=this.stride;for(let Ue=0;Ue<fe.length;Ue+=Me){if(fe[Ue+2]<=ue)continue;fe[Ue+2]=ue;const xt=fe[Ue],yt=fe[Ue+1],qt=oe.within(fe[Ue],fe[Ue+1],at),Ot=fe[Ue+5];let cn=Ot;for(const Ke of qt){const kn=Ke*Me;fe[kn+2]>ue&&(cn+=fe[kn+5])}if(cn>Ot&&cn>=bt){let Ke,kn=xt*Ot,Fn=yt*Ot,wn=-1;const _n=(Ue/Me<<5)+(ue+1)+this.points.length;for(const gi of qt){const Yn=gi*Me;if(fe[Yn+2]<=ue)continue;fe[Yn+2]=ue;const nn=fe[Yn+5];kn+=fe[Yn]*nn,Fn+=fe[Yn+1]*nn,fe[Yn+4]=_n,$e&&(Ke||(Ke=this._map(fe,Ue,!0),wn=this.clusterProps.length,this.clusterProps.push(Ke)),$e(Ke,this._map(fe,Yn)))}fe[Ue+4]=_n,de.push(kn/cn,Fn/cn,1/0,_n,-1,cn),$e&&de.push(wn)}else{for(let Ke=0;Ke<Me;Ke++)de.push(fe[Ue+Ke]);if(cn>1)for(const Ke of qt){const kn=Ke*Me;if(!(fe[kn+2]<=ue)){fe[kn+2]=ue;for(let Fn=0;Fn<Me;Fn++)de.push(fe[kn+Fn])}}}}return de}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,ue,ge){if(oe[ue+5]>1){const bt=this.clusterProps[oe[ue+6]];return ge?Object.assign({},bt):bt}const qe=this.points[oe[ue+3]].properties,$e=this.options.map(qe);return ge&&$e===qe?Object.assign({},$e):$e}}function pt(ct,oe,ue){return{type:"Feature",id:ct[oe+3],properties:Pe(ct,oe,ue),geometry:{type:"Point",coordinates:[(ge=ct[oe],360*(ge-.5)),Rt(ct[oe+1])]}};var ge}function Pe(ct,oe,ue){const ge=ct[oe+5],qe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,$e=ct[oe+6],bt=$e===-1?{}:Object.assign({},ue[$e]);return Object.assign(bt,{cluster:!0,cluster_id:ct[oe+3],point_count:ge,point_count_abbreviated:qe})}function ot(ct){return ct/360+.5}function gt(ct){const oe=Math.sin(ct*Math.PI/180),ue=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ue<0?0:ue>1?1:ue}function Rt(ct){const oe=(180-360*ct)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Ie(ct,oe,ue,ge){let qe=ge;const $e=oe+(ue-oe>>1);let bt,at=ue-oe;const fe=ct[oe],de=ct[oe+1],Me=ct[ue],Ue=ct[ue+1];for(let xt=oe+3;xt<ue;xt+=3){const yt=Se(ct[xt],ct[xt+1],fe,de,Me,Ue);if(yt>qe)bt=xt,qe=yt;else if(yt===qe){const qt=Math.abs(xt-$e);qt<at&&(bt=xt,at=qt)}}qe>ge&&(bt-oe>3&&Ie(ct,oe,bt,ge),ct[bt+2]=qe,ue-bt>3&&Ie(ct,bt,ue,ge))}function Se(ct,oe,ue,ge,qe,$e){let bt=qe-ue,at=$e-ge;if(bt!==0||at!==0){const fe=((ct-ue)*bt+(oe-ge)*at)/(bt*bt+at*at);fe>1?(ue=qe,ge=$e):fe>0&&(ue+=bt*fe,ge+=at*fe)}return bt=ct-ue,at=oe-ge,bt*bt+at*at}function je(ct,oe,ue,ge){const qe={id:ct??null,type:oe,geometry:ue,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")st(qe,ue);else if(oe==="Polygon")st(qe,ue[0]);else if(oe==="MultiLineString")for(const $e of ue)st(qe,$e);else if(oe==="MultiPolygon")for(const $e of ue)st(qe,$e[0]);return qe}function st(ct,oe){for(let ue=0;ue<oe.length;ue+=3)ct.minX=Math.min(ct.minX,oe[ue]),ct.minY=Math.min(ct.minY,oe[ue+1]),ct.maxX=Math.max(ct.maxX,oe[ue]),ct.maxY=Math.max(ct.maxY,oe[ue+1])}function mt(ct,oe,ue,ge){if(!oe.geometry)return;const qe=oe.geometry.coordinates;if(qe&&qe.length===0)return;const $e=oe.geometry.type,bt=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let at=[],fe=oe.id;if(ue.promoteId?fe=oe.properties[ue.promoteId]:ue.generateId&&(fe=ge||0),$e==="Point")Xt(qe,at);else if($e==="MultiPoint")for(const de of qe)Xt(de,at);else if($e==="LineString")Oe(qe,at,bt,!1);else if($e==="MultiLineString"){if(ue.lineMetrics){for(const de of qe)at=[],Oe(de,at,bt,!1),ct.push(je(fe,"LineString",at,oe.properties));return}Xe(qe,at,bt,!1)}else if($e==="Polygon")Xe(qe,at,bt,!0);else{if($e!=="MultiPolygon"){if($e==="GeometryCollection"){for(const de of oe.geometry.geometries)mt(ct,{id:fe,geometry:de,properties:oe.properties},ue,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const de of qe){const Me=[];Xe(de,Me,bt,!0),at.push(Me)}}ct.push(je(fe,$e,at,oe.properties))}function Xt(ct,oe){oe.push(It(ct[0]),Nt(ct[1]),0)}function Oe(ct,oe,ue,ge){let qe,$e,bt=0;for(let fe=0;fe<ct.length;fe++){const de=It(ct[fe][0]),Me=Nt(ct[fe][1]);oe.push(de,Me,0),fe>0&&(bt+=ge?(qe*Me-de*$e)/2:Math.sqrt(Math.pow(de-qe,2)+Math.pow(Me-$e,2))),qe=de,$e=Me}const at=oe.length-3;oe[2]=1,Ie(oe,0,at,ue),oe[at+2]=1,oe.size=Math.abs(bt),oe.start=0,oe.end=oe.size}function Xe(ct,oe,ue,ge){for(let qe=0;qe<ct.length;qe++){const $e=[];Oe(ct[qe],$e,ue,ge),oe.push($e)}}function It(ct){return ct/360+.5}function Nt(ct){const oe=Math.sin(ct*Math.PI/180),ue=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ue<0?0:ue>1?1:ue}function $t(ct,oe,ue,ge,qe,$e,bt,at){if(ge/=oe,$e>=(ue/=oe)&&bt<ge)return ct;if(bt<ue||$e>=ge)return null;const fe=[];for(const de of ct){const Me=de.geometry;let Ue=de.type;const xt=qe===0?de.minX:de.minY,yt=qe===0?de.maxX:de.maxY;if(xt>=ue&&yt<ge){fe.push(de);continue}if(yt<ue||xt>=ge)continue;let qt=[];if(Ue==="Point"||Ue==="MultiPoint")Bt(Me,qt,ue,ge,qe);else if(Ue==="LineString")Mn(Me,qt,ue,ge,qe,!1,at.lineMetrics);else if(Ue==="MultiLineString")Rn(Me,qt,ue,ge,qe,!1);else if(Ue==="Polygon")Rn(Me,qt,ue,ge,qe,!0);else if(Ue==="MultiPolygon")for(const Ot of Me){const cn=[];Rn(Ot,cn,ue,ge,qe,!0),cn.length&&qt.push(cn)}if(qt.length){if(at.lineMetrics&&Ue==="LineString"){for(const Ot of qt)fe.push(je(de.id,Ue,Ot,de.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(qt.length===1?(Ue="LineString",qt=qt[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=qt.length===3?"Point":"MultiPoint"),fe.push(je(de.id,Ue,qt,de.tags))}}return fe.length?fe:null}function Bt(ct,oe,ue,ge,qe){for(let $e=0;$e<ct.length;$e+=3){const bt=ct[$e+qe];bt>=ue&&bt<=ge&&ri(oe,ct[$e],ct[$e+1],ct[$e+2])}}function Mn(ct,oe,ue,ge,qe,$e,bt){let at=Tn(ct);const fe=qe===0?_i:$n;let de,Me,Ue=ct.start;for(let cn=0;cn<ct.length-3;cn+=3){const Ke=ct[cn],kn=ct[cn+1],Fn=ct[cn+2],wn=ct[cn+3],_n=ct[cn+4],gi=qe===0?Ke:kn,Yn=qe===0?wn:_n;let nn=!1;bt&&(de=Math.sqrt(Math.pow(Ke-wn,2)+Math.pow(kn-_n,2))),gi<ue?Yn>ue&&(Me=fe(at,Ke,kn,wn,_n,ue),bt&&(at.start=Ue+de*Me)):gi>ge?Yn<ge&&(Me=fe(at,Ke,kn,wn,_n,ge),bt&&(at.start=Ue+de*Me)):ri(at,Ke,kn,Fn),Yn<ue&&gi>=ue&&(Me=fe(at,Ke,kn,wn,_n,ue),nn=!0),Yn>ge&&gi<=ge&&(Me=fe(at,Ke,kn,wn,_n,ge),nn=!0),!$e&&nn&&(bt&&(at.end=Ue+de*Me),oe.push(at),at=Tn(ct)),bt&&(Ue+=de)}let xt=ct.length-3;const yt=ct[xt],qt=ct[xt+1],Ot=qe===0?yt:qt;Ot>=ue&&Ot<=ge&&ri(at,yt,qt,ct[xt+2]),xt=at.length-3,$e&&xt>=3&&(at[xt]!==at[0]||at[xt+1]!==at[1])&&ri(at,at[0],at[1],at[2]),at.length&&oe.push(at)}function Tn(ct){const oe=[];return oe.size=ct.size,oe.start=ct.start,oe.end=ct.end,oe}function Rn(ct,oe,ue,ge,qe,$e){for(const bt of ct)Mn(bt,oe,ue,ge,qe,$e,!1)}function ri(ct,oe,ue,ge){ct.push(oe,ue,ge)}function _i(ct,oe,ue,ge,qe,$e){const bt=($e-oe)/(ge-oe);return ri(ct,$e,ue+(qe-ue)*bt,1),bt}function $n(ct,oe,ue,ge,qe,$e){const bt=($e-ue)/(qe-ue);return ri(ct,oe+(ge-oe)*bt,$e,1),bt}function Kn(ct,oe){const ue=[];for(let ge=0;ge<ct.length;ge++){const qe=ct[ge],$e=qe.type;let bt;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")bt=Qn(qe.geometry,oe);else if($e==="MultiLineString"||$e==="Polygon"){bt=[];for(const at of qe.geometry)bt.push(Qn(at,oe))}else if($e==="MultiPolygon"){bt=[];for(const at of qe.geometry){const fe=[];for(const de of at)fe.push(Qn(de,oe));bt.push(fe)}}ue.push(je(qe.id,$e,bt,qe.tags))}return ue}function Qn(ct,oe){const ue=[];ue.size=ct.size,ct.start!==void 0&&(ue.start=ct.start,ue.end=ct.end);for(let ge=0;ge<ct.length;ge+=3)ue.push(ct[ge]+oe,ct[ge+1],ct[ge+2]);return ue}function ti(ct,oe){if(ct.transformed)return ct;const ue=1<<ct.z,ge=ct.x,qe=ct.y;for(const $e of ct.features){const bt=$e.geometry,at=$e.type;if($e.geometry=[],at===1)for(let fe=0;fe<bt.length;fe+=2)$e.geometry.push(Bi(bt[fe],bt[fe+1],oe,ue,ge,qe));else for(let fe=0;fe<bt.length;fe++){const de=[];for(let Me=0;Me<bt[fe].length;Me+=2)de.push(Bi(bt[fe][Me],bt[fe][Me+1],oe,ue,ge,qe));$e.geometry.push(de)}}return ct.transformed=!0,ct}function Bi(ct,oe,ue,ge,qe,$e){return[Math.round(ue*(ct*ge-qe)),Math.round(ue*(oe*ge-$e))]}function si(ct,oe,ue,ge,qe){const $e=oe===qe.maxZoom?0:qe.tolerance/((1<<oe)*qe.extent),bt={features:[],numPoints:0,numSimplified:0,numFeatures:ct.length,source:null,x:ue,y:ge,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const at of ct)Yt(bt,at,$e,qe);return bt}function Yt(ct,oe,ue,ge){const qe=oe.geometry,$e=oe.type,bt=[];if(ct.minX=Math.min(ct.minX,oe.minX),ct.minY=Math.min(ct.minY,oe.minY),ct.maxX=Math.max(ct.maxX,oe.maxX),ct.maxY=Math.max(ct.maxY,oe.maxY),$e==="Point"||$e==="MultiPoint")for(let at=0;at<qe.length;at+=3)bt.push(qe[at],qe[at+1]),ct.numPoints++,ct.numSimplified++;else if($e==="LineString")fn(bt,qe,ct,ue,!1,!1);else if($e==="MultiLineString"||$e==="Polygon")for(let at=0;at<qe.length;at++)fn(bt,qe[at],ct,ue,$e==="Polygon",at===0);else if($e==="MultiPolygon")for(let at=0;at<qe.length;at++){const fe=qe[at];for(let de=0;de<fe.length;de++)fn(bt,fe[de],ct,ue,!0,de===0)}if(bt.length){let at=oe.tags||null;if($e==="LineString"&&ge.lineMetrics){at={};for(const de in oe.tags)at[de]=oe.tags[de];at.mapbox_clip_start=qe.start/qe.size,at.mapbox_clip_end=qe.end/qe.size}const fe={geometry:bt,type:$e==="Polygon"||$e==="MultiPolygon"?3:$e==="LineString"||$e==="MultiLineString"?2:1,tags:at};oe.id!==null&&(fe.id=oe.id),ct.features.push(fe)}}function fn(ct,oe,ue,ge,qe,$e){const bt=ge*ge;if(ge>0&&oe.size<(qe?bt:ge))return void(ue.numPoints+=oe.length/3);const at=[];for(let fe=0;fe<oe.length;fe+=3)(ge===0||oe[fe+2]>bt)&&(ue.numSimplified++,at.push(oe[fe],oe[fe+1])),ue.numPoints++;qe&&(function(fe,de){let Me=0;for(let Ue=0,xt=fe.length,yt=xt-2;Ue<xt;yt=Ue,Ue+=2)Me+=(fe[Ue]-fe[yt])*(fe[Ue+1]+fe[yt+1]);if(Me>0===de)for(let Ue=0,xt=fe.length;Ue<xt/2;Ue+=2){const yt=fe[Ue],qt=fe[Ue+1];fe[Ue]=fe[xt-2-Ue],fe[Ue+1]=fe[xt-1-Ue],fe[xt-2-Ue]=yt,fe[xt-1-Ue]=qt}})(at,$e),ct.push(at)}const di={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gn{constructor(oe,ue){const ge=(ue=this.options=(function($e,bt){for(const at in bt)$e[at]=bt[at];return $e})(Object.create(di),ue)).debug;if(ge&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let qe=(function($e,bt){const at=[];if($e.type==="FeatureCollection")for(let fe=0;fe<$e.features.length;fe++)mt(at,$e.features[fe],bt,fe);else mt(at,$e.type==="Feature"?$e:{geometry:$e},bt);return at})(oe,ue);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),qe=(function($e,bt){const at=bt.buffer/bt.extent;let fe=$e;const de=$t($e,1,-1-at,at,0,-1,2,bt),Me=$t($e,1,1-at,2+at,0,-1,2,bt);return(de||Me)&&(fe=$t($e,1,-at,1+at,0,-1,2,bt)||[],de&&(fe=Kn(de,1).concat(fe)),Me&&(fe=fe.concat(Kn(Me,-1)))),fe})(qe,ue),qe.length&&this.splitTile(qe,0,0,0),ge&&(qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,ue,ge,qe,$e,bt,at){const fe=[oe,ue,ge,qe],de=this.options,Me=de.debug;for(;fe.length;){qe=fe.pop(),ge=fe.pop(),ue=fe.pop(),oe=fe.pop();const Ue=1<<ue,xt=Zn(ue,ge,qe);let yt=this.tiles[xt];if(!yt&&(Me>1&&console.time("creation"),yt=this.tiles[xt]=si(oe,ue,ge,qe,de),this.tileCoords.push({z:ue,x:ge,y:qe}),Me)){Me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,ge,qe,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));const nn=`z${ue}`;this.stats[nn]=(this.stats[nn]||0)+1,this.total++}if(yt.source=oe,$e==null){if(ue===de.indexMaxZoom||yt.numPoints<=de.indexMaxPoints)continue}else{if(ue===de.maxZoom||ue===$e)continue;if($e!=null){const nn=$e-ue;if(ge!==bt>>nn||qe!==at>>nn)continue}}if(yt.source=null,oe.length===0)continue;Me>1&&console.time("clipping");const qt=.5*de.buffer/de.extent,Ot=.5-qt,cn=.5+qt,Ke=1+qt;let kn=null,Fn=null,wn=null,_n=null,gi=$t(oe,Ue,ge-qt,ge+cn,0,yt.minX,yt.maxX,de),Yn=$t(oe,Ue,ge+Ot,ge+Ke,0,yt.minX,yt.maxX,de);oe=null,gi&&(kn=$t(gi,Ue,qe-qt,qe+cn,1,yt.minY,yt.maxY,de),Fn=$t(gi,Ue,qe+Ot,qe+Ke,1,yt.minY,yt.maxY,de),gi=null),Yn&&(wn=$t(Yn,Ue,qe-qt,qe+cn,1,yt.minY,yt.maxY,de),_n=$t(Yn,Ue,qe+Ot,qe+Ke,1,yt.minY,yt.maxY,de),Yn=null),Me>1&&console.timeEnd("clipping"),fe.push(kn||[],ue+1,2*ge,2*qe),fe.push(Fn||[],ue+1,2*ge,2*qe+1),fe.push(wn||[],ue+1,2*ge+1,2*qe),fe.push(_n||[],ue+1,2*ge+1,2*qe+1)}}getTile(oe,ue,ge){oe=+oe,ue=+ue,ge=+ge;const qe=this.options,{extent:$e,debug:bt}=qe;if(oe<0||oe>24)return null;const at=1<<oe,fe=Zn(oe,ue=ue+at&at-1,ge);if(this.tiles[fe])return ti(this.tiles[fe],$e);bt>1&&console.log("drilling down to z%d-%d-%d",oe,ue,ge);let de,Me=oe,Ue=ue,xt=ge;for(;!de&&Me>0;)Me--,Ue>>=1,xt>>=1,de=this.tiles[Zn(Me,Ue,xt)];return de&&de.source?(bt>1&&(console.log("found parent tile z%d-%d-%d",Me,Ue,xt),console.time("drilling down")),this.splitTile(de.source,Me,Ue,xt,oe,ue,ge),bt>1&&console.timeEnd("drilling down"),this.tiles[fe]?ti(this.tiles[fe],$e):null):null}}function Zn(ct,oe,ue){return 32*((1<<ct)*ue+oe)+ct}class Yi extends he{constructor(oe,ue,ge,qe=fi){super(oe,ue,ge),this._dataUpdateable=new Map,this._createGeoJSONIndex=qe}loadVectorTile(oe,ue){return R._(this,void 0,void 0,(function*(){const ge=oe.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const qe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);return qe?Ee(new R.d2(qe.features,{version:2,extent:R.a5})):null}))}loadData(oe){return R._(this,void 0,void 0,(function*(){var ue;(ue=this._pendingRequest)===null||ue===void 0||ue.abort();const ge=this._startPerformance(oe);this._pendingRequest=new AbortController;try{(!this._pendingData||oe.request||oe.data||oe.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(oe,this._pendingRequest));const qe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(qe,oe),this.loaded={};const $e={};return oe.request&&($e.data=qe),this._finishPerformance(ge,oe,$e),$e}catch(qe){if(delete this._pendingRequest,R.Z(qe))return{abandoned:!0};throw qe}}))}_startPerformance(oe){var ue;if(!((ue=oe?.request)===null||ue===void 0)&&ue.collectResourceTiming)return new R.c_(oe.request)}_finishPerformance(oe,ue,ge){if(!oe)return;const qe=oe.finish();qe&&(ge.resourceTiming={},ge.resourceTiming[ue.source]=JSON.parse(JSON.stringify(qe)))}getData(){return R._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(oe){const ue=this.loaded;return ue&&ue[oe.uid]?super.reloadTile(oe):this.loadTile(oe)}loadAndProcessGeoJSON(oe,ue){return R._(this,void 0,void 0,(function*(){let ge;if(oe.request?ge=yield this.loadGeoJSONFromUrl(oe.request,oe.promoteId,ue):oe.data?ge=this._loadGeoJSONFromObject(oe.data,oe.promoteId):oe.dataDiff&&(ge=this._loadGeoJSONFromDiff(oe.dataDiff,oe.promoteId,oe.source)),delete this._pendingRequest,typeof ge!="object")throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`);return Ut(ge,!0),oe.filter&&(ge=this._filterGeoJSON(ge,oe.filter)),ge}))}loadGeoJSONFromUrl(oe,ue,ge){return R._(this,void 0,void 0,(function*(){const qe=yield R.j(oe,ge);return this._dataUpdateable=R.a7(qe.data,ue),qe.data}))}_loadGeoJSONFromObject(oe,ue){return this._dataUpdateable=R.a7(oe,ue),oe}_loadGeoJSONFromDiff(oe,ue,ge){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ge}`);R.a8(this._dataUpdateable,oe,ue);const qe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(qe)}_filterGeoJSON(oe,ue){const ge=R.d3(ue,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(($e=>`${$e.key}: ${$e.message}`)).join(", "));const qe=oe.features.filter(($e=>ge.value.evaluate({zoom:0},$e)));return this._toFeatureCollection(qe)}_toFeatureCollection(oe){return{type:"FeatureCollection",features:oe}}removeSource(oe){return R._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(oe){return this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId)}getClusterChildren(oe){return this._geoJSONIndex.getChildren(oe.clusterId)}getClusterLeaves(oe){return this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset)}}function fi(ct,oe){return oe.cluster?new He((function({superclusterOptions:ue,clusterProperties:ge}){if(!ge||!ue)return ue;const qe={},$e={},bt={accumulated:null,zoom:0},at={properties:null},fe=Object.keys(ge);for(const de of fe){const[Me,Ue]=ge[de],xt=R.d3(Ue),yt=R.d3(typeof Me=="string"?[Me,["accumulated"],["get",de]]:Me);qe[de]=xt.value,$e[de]=yt.value}return ue.map=de=>{at.properties=de;const Me={};for(const Ue of fe)Me[Ue]=qe[Ue].evaluate(bt,at);return Me},ue.reduce=(de,Me)=>{at.properties=Me;for(const Ue of fe)bt.accumulated=de[Ue],de[Ue]=$e[Ue].evaluate(bt,at)},ue})(oe)).load(ct.features):(function(ue,ge){return new gn(ue,ge)})(ct,oe.geojsonVtOptions)}class ci{constructor(oe){this.self=oe,this.actor=new R.L(oe),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ue,ge)=>{if(this.externalWorkerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.externalWorkerSourceTypes[ue]=ge},this.self.addProtocol=R.cJ,this.self.removeProtocol=R.cK,this.self.registerRTLTextPlugin=ue=>{R.d4.setMethods(ue)},this.actor.registerMessageHandler("LDT",((ue,ge)=>this._getDEMWorkerSource(ue,ge.source).loadTile(ge))),this.actor.registerMessageHandler("RDT",((ue,ge)=>R._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ue,ge.source).removeTile(ge)})))),this.actor.registerMessageHandler("GCEZ",((ue,ge)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(ue,ge.type,ge.source).getClusterExpansionZoom(ge)})))),this.actor.registerMessageHandler("GCC",((ue,ge)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(ue,ge.type,ge.source).getClusterChildren(ge)})))),this.actor.registerMessageHandler("GCL",((ue,ge)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(ue,ge.type,ge.source).getClusterLeaves(ge)})))),this.actor.registerMessageHandler("LD",((ue,ge)=>this._getWorkerSource(ue,ge.type,ge.source).loadData(ge))),this.actor.registerMessageHandler("GD",((ue,ge)=>this._getWorkerSource(ue,ge.type,ge.source).getData())),this.actor.registerMessageHandler("LT",((ue,ge)=>this._getWorkerSource(ue,ge.type,ge.source).loadTile(ge))),this.actor.registerMessageHandler("RT",((ue,ge)=>this._getWorkerSource(ue,ge.type,ge.source).reloadTile(ge))),this.actor.registerMessageHandler("AT",((ue,ge)=>this._getWorkerSource(ue,ge.type,ge.source).abortTile(ge))),this.actor.registerMessageHandler("RMT",((ue,ge)=>this._getWorkerSource(ue,ge.type,ge.source).removeTile(ge))),this.actor.registerMessageHandler("RS",((ue,ge)=>R._(this,void 0,void 0,(function*(){if(!this.workerSources[ue]||!this.workerSources[ue][ge.type]||!this.workerSources[ue][ge.type][ge.source])return;const qe=this.workerSources[ue][ge.type][ge.source];delete this.workerSources[ue][ge.type][ge.source],qe.removeSource!==void 0&&qe.removeSource(ge)})))),this.actor.registerMessageHandler("RM",(ue=>R._(this,void 0,void 0,(function*(){delete this.layerIndexes[ue],delete this.availableImages[ue],delete this.workerSources[ue],delete this.demWorkerSources[ue],this.globalStates.delete(ue)})))),this.actor.registerMessageHandler("SR",((ue,ge)=>R._(this,void 0,void 0,(function*(){this.referrer=ge})))),this.actor.registerMessageHandler("SRPS",((ue,ge)=>this._syncRTLPluginState(ue,ge))),this.actor.registerMessageHandler("IS",((ue,ge)=>R._(this,void 0,void 0,(function*(){this.self.importScripts(ge)})))),this.actor.registerMessageHandler("SI",((ue,ge)=>this._setImages(ue,ge))),this.actor.registerMessageHandler("UL",((ue,ge)=>R._(this,void 0,void 0,(function*(){this._getLayerIndex(ue).update(ge.layers,ge.removedIds,this._getGlobalState(ue))})))),this.actor.registerMessageHandler("UGS",((ue,ge)=>R._(this,void 0,void 0,(function*(){const qe=this._getGlobalState(ue);for(const $e in ge)qe[$e]=ge[$e]})))),this.actor.registerMessageHandler("SL",((ue,ge)=>R._(this,void 0,void 0,(function*(){this._getLayerIndex(ue).replace(ge,this._getGlobalState(ue))}))))}_getGlobalState(oe){let ue=this.globalStates.get(oe);return ue||(ue={},this.globalStates.set(oe,ue)),ue}_setImages(oe,ue){return R._(this,void 0,void 0,(function*(){this.availableImages[oe]=ue;for(const ge in this.workerSources[oe]){const qe=this.workerSources[oe][ge];for(const $e in qe)qe[$e].availableImages=ue}}))}_syncRTLPluginState(oe,ue){return R._(this,void 0,void 0,(function*(){return yield R.d4.syncState(ue,this.self.importScripts)}))}_getAvailableImages(oe){let ue=this.availableImages[oe];return ue||(ue=[]),ue}_getLayerIndex(oe){let ue=this.layerIndexes[oe];return ue||(ue=this.layerIndexes[oe]=new h),ue}_getWorkerSource(oe,ue,ge){if(this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][ue]||(this.workerSources[oe][ue]={}),!this.workerSources[oe][ue][ge]){const qe={sendAsync:($e,bt)=>($e.targetMapId=oe,this.actor.sendAsync($e,bt))};switch(ue){case"vector":this.workerSources[oe][ue][ge]=new he(qe,this._getLayerIndex(oe),this._getAvailableImages(oe));break;case"geojson":this.workerSources[oe][ue][ge]=new Yi(qe,this._getLayerIndex(oe),this._getAvailableImages(oe));break;default:this.workerSources[oe][ue][ge]=new this.externalWorkerSourceTypes[ue](qe,this._getLayerIndex(oe),this._getAvailableImages(oe))}}return this.workerSources[oe][ue][ge]}_getDEMWorkerSource(oe,ue){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][ue]||(this.demWorkerSources[oe][ue]=new ke),this.demWorkerSources[oe][ue]}}return R.i(self)&&(self.worker=new ci(self)),ci})),N("index",["exports","./shared"],(function(R,h){var V="5.15.0";function H(){var E=new h.A(4);return h.A!=Float32Array&&(E[1]=0,E[2]=0),E[0]=1,E[3]=1,E}let $,K,be;const Ce={frame(E,t,s){const d=requestAnimationFrame((T=>{x(),t(T)})),{unsubscribe:x}=h.s(E.signal,"abort",(()=>{x(),cancelAnimationFrame(d),s(new h.a(E.signal.reason))}),!1)},frameAsync(E){return new Promise(((t,s)=>{this.frame(E,t,s)}))},getImageData(E,t=0){return this.getImageCanvasContext(E).getImageData(-t,-t,E.width+2*t,E.height+2*t)},getImageCanvasContext(E){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=E.width,t.height=E.height,s.drawImage(E,0,0,E.width,E.height),s},resolveURL:E=>($||($=document.createElement("a")),$.href=E,$.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return be!==void 0?be:!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)},set prefersReducedMotion(E){be=E}},Ee=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(E){this._frozenAt=E}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function ye(){return Ee.getCurrentTime()}class he{static testProp(t){if(!he.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in he.docStyle)return t[s];return t[0]}static create(t,s,d){const x=window.document.createElement(t);return s!==void 0&&(x.className=s),d&&d.appendChild(x),x}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){he.docStyle&&he.selectProp&&(he.userSelect=he.docStyle[he.selectProp],he.docStyle[he.selectProp]="none")}static enableDrag(){he.docStyle&&he.selectProp&&(he.docStyle[he.selectProp]=he.userSelect)}static setTransform(t,s){t.style[he.transformProp]=s}static addEventListener(t,s,d,x={}){t.addEventListener(s,d,"passive"in x?x:x.capture)}static removeEventListener(t,s,d,x={}){t.removeEventListener(s,d,"passive"in x?x:x.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",he.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",he.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",he.suppressClickInternal,!0)}),0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,d){const x=s.boundingClientRect;return new h.P((d.clientX-x.left)/s.x-t.clientLeft,(d.clientY-x.top)/s.y-t.clientTop)}static mousePos(t,s){const d=he.getScale(t);return he.getPoint(t,d,s)}static touchPos(t,s){const d=[],x=he.getScale(t);for(let T=0;T<s.length;T++)d.push(he.getPoint(t,x,s[T]));return d}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const s=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),d=s.querySelectorAll("script");for(const x of d)x.remove();return he.clean(s),s.innerHTML}static isPossiblyDangerous(t,s){const d=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!d.includes("javascript:")&&!d.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const s=t.children;for(const d of s)he.removeAttributes(d),he.clean(d)}static removeAttributes(t){for(const{name:s,value:d}of t.attributes)he.isPossiblyDangerous(s,d)&&t.removeAttribute(s)}}he.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,he.selectProp=he.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),he.transformProp=he.testProp(["transform","WebkitTransform"]);const ke={supported:!1,testSupport:function(E){!dt&&Qe&&(Ut?wt(E):nt=E)}};let nt,Qe,dt=!1,Ut=!1;function wt(E){const t=E.createTexture();E.bindTexture(E.TEXTURE_2D,t);try{if(E.texImage2D(E.TEXTURE_2D,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,Qe),E.isContextLost())return;ke.supported=!0}catch{}E.deleteTexture(t),dt=!0}var tt;typeof document<"u"&&(Qe=document.createElement("img"),Qe.onload=()=>{nt&&wt(nt),nt=null,Ut=!0},Qe.onerror=()=>{dt=!0,nt=null},Qe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(E){let t,s,d,x;E.resetRequestQueue=()=>{t=[],s=0,d=0,x={}},E.addThrottleControl=j=>{const Z=d++;return x[Z]=j,Z},E.removeThrottleControl=j=>{delete x[j],M()},E.getImage=(j,Z,W=!0)=>new Promise(((ee,J)=>{ke.supported&&(j.headers||(j.headers={}),j.headers.accept="image/webp,*/*"),h.e(j,{type:"image"}),t.push({abortController:Z,requestParameters:j,supportImageRefresh:W,state:"queued",onError:se=>{J(se)},onSuccess:se=>{ee(se)}}),M()}));const T=j=>h._(this,void 0,void 0,(function*(){j.state="running";const{requestParameters:Z,supportImageRefresh:W,onError:ee,onSuccess:J,abortController:se}=j,pe=W===!1&&!h.i(self)&&!h.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce(((Re,Be)=>Re&&Be==="accept"),!0));s++;const Ae=pe?z(Z,se):h.m(Z,se);try{const Re=yield Ae;delete j.abortController,j.state="completed",Re.data instanceof HTMLImageElement||h.b(Re.data)?J(Re):Re.data&&J({data:yield(Ne=Re.data,typeof createImageBitmap=="function"?h.f(Ne):h.h(Ne)),cacheControl:Re.cacheControl,expires:Re.expires})}catch(Re){delete j.abortController,ee(Re)}finally{s--,M()}var Ne})),M=()=>{const j=(()=>{for(const Z of Object.keys(x))if(x[Z]())return!0;return!1})()?h.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=s;Z<j&&t.length>0;Z++){const W=t.shift();W.abortController.signal.aborted?Z--:T(W)}},z=(j,Z)=>new Promise(((W,ee)=>{const J=new Image,se=j.url,pe=j.credentials;pe&&pe==="include"?J.crossOrigin="use-credentials":(pe&&pe==="same-origin"||!h.d(se))&&(J.crossOrigin="anonymous"),Z.signal.addEventListener("abort",(()=>{J.src="",ee(new h.a(Z.signal.reason))})),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,W({data:J})},J.onerror=()=>{J.onerror=J.onload=null,Z.signal.aborted||ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=se}))})(tt||(tt={})),tt.resetRequestQueue();class Je{constructor(t){this._transformRequestFn=t??null}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function He(E){const t=[];if(typeof E=="string")t.push({id:"default",url:E});else if(E&&E.length>0){const s=[];for(const{id:d,url:x}of E){const T=`${d}${x}`;s.indexOf(T)===-1&&(s.push(T),t.push({id:d,url:x}))}}return t}function pt(E,t,s){try{const d=new URL(E);return d.pathname+=`${t}${s}`,d.toString()}catch{throw new Error(`Invalid sprite URL "${E}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Pe(E){const{userImage:t}=E;return!!(t&&t.render&&t.render())&&(E.data.replace(new Uint8Array(t.data.buffer)),!0)}class ot extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:d}of this.requestors)d(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const d=s.spriteData;s.data=new h.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let d=!0;const x=s.data||s.spriteData;return this._validateStretch(s.stretchX,x&&x.width)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(s.stretchY,x&&x.height)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(s.content,s)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,s){if(!t)return!0;let d=0;for(const x of t){if(x[0]<d||x[1]<x[0]||s<x[1])return!1;d=x[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const d=s.spriteData,x=d&&d.width||s.data.width,T=d&&d.height||s.data.height;return!(t[0]<0||x<t[0]||t[1]<0||T<t[1]||t[2]<0||x<t[2]||t[3]<0||T<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,d=!0){const x=this.getImage(t);if(d&&(x.data.width!==s.data.width||x.data.height!==s.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=x.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((s,d)=>{let x=!0;if(!this.isLoaded())for(const T of t)this.images[T]||(x=!1);this.isLoaded()||x?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})}))}_getImagesForIds(t){const s={};for(const d of t){let x=this.getImage(d);x||(this.fire(new h.l("styleimagemissing",{id:d})),x=this.getImage(d)),x?s[d]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:h.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],d=this.getImage(t);if(!d)return null;if(s&&s.position.version===d.version)return s.position;if(s)s.position.version=d.version;else{const x={w:d.data.width+2,h:d.data.height+2,x:0,y:0},T=new h.I(x,d);this.patterns[t]={bin:x,position:T}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const T in this.patterns)t.push(this.patterns[T].bin);const{w:s,h:d}=h.p(t),x=this.atlasImage;x.resize({width:s||1,height:d||1});for(const T in this.patterns){const{bin:M}=this.patterns[T],z=M.x+1,j=M.y+1,Z=this.getImage(T).data,W=Z.width,ee=Z.height;h.R.copy(Z,x,{x:0,y:0},{x:z,y:j},{width:W,height:ee}),h.R.copy(Z,x,{x:0,y:ee-1},{x:z,y:j-1},{width:W,height:1}),h.R.copy(Z,x,{x:0,y:0},{x:z,y:j+ee},{width:W,height:1}),h.R.copy(Z,x,{x:W-1,y:0},{x:z-1,y:j},{width:1,height:ee}),h.R.copy(Z,x,{x:0,y:0},{x:z+W,y:j},{width:1,height:ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const d=this.getImage(s);d||h.w(`Image with ID: "${s}" was not found`),Pe(d)&&this.updateImage(s,d)}}cloneImages(){const t={};for(const s in this.images){const d=this.images[s];t[s]=Object.assign(Object.assign({},d),{data:d.data?d.data.clone():null})}return t}}const gt=1e20;function Rt(E,t,s,d,x,T,M,z,j){for(let Z=t;Z<t+d;Z++)Ie(E,s*T+Z,T,x,M,z,j);for(let Z=s;Z<s+x;Z++)Ie(E,Z*T+t,1,d,M,z,j)}function Ie(E,t,s,d,x,T,M){T[0]=0,M[0]=-gt,M[1]=gt,x[0]=E[t];for(let z=1,j=0,Z=0;z<d;z++){x[z]=E[t+z*s];const W=z*z;do{const ee=T[j];Z=(x[z]-x[ee]+W-ee*ee)/(z-ee)/2}while(Z<=M[j]&&--j>-1);j++,T[j]=z,M[j]=Z,M[j+1]=gt}for(let z=0,j=0;z<d;z++){for(;M[j+1]<z;)j++;const Z=T[j],W=z-Z;E[t+z*s]=x[Z]+W*W}}const Se=h.v.layout_symbol["text-font"].default.join(",");class je{constructor(t,s,d){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={},this.lang=d}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,(function*(){const s=[];for(const T in t)for(const M of t[T])s.push(this._getAndCacheGlyphsPromise(T,M));const d=yield Promise.all(s),x={};for(const{stack:T,id:M,glyph:z}of d)x[T]||(x[T]={}),x[T][M]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return x}))}_getAndCacheGlyphsPromise(t,s){return h._(this,void 0,void 0,(function*(){let d=this.entries[t];d||(d=this.entries[t]={glyphs:{},requests:{},ranges:{}});let x=d.glyphs[s];return x!==void 0?{stack:t,id:s,glyph:x}:!this.url||this._charUsesLocalIdeographFontFamily(s)?(x=d.glyphs[s]=this._drawGlyph(d,t,s),{stack:t,id:s,glyph:x}):yield this._downloadAndCacheRangePromise(t,s)}))}_downloadAndCacheRangePromise(t,s){return h._(this,void 0,void 0,(function*(){const d=this.entries[t],x=Math.floor(s/256);if(d.ranges[x])return{stack:t,id:s,glyph:null};if(!d.requests[x]){const T=je.loadGlyphRange(t,x,this.url,this.requestManager);d.requests[x]=T}try{const T=yield d.requests[x];for(const M in T)d.glyphs[+M]=T[+M];return d.ranges[x]=!0,{stack:t,id:s,glyph:T[s]||null}}catch(T){const M=d.glyphs[s]=this._drawGlyph(d,t,s);return this._warnOnMissingGlyphRange(M,x,s,T),{stack:t,id:s,glyph:M}}}))}_warnOnMissingGlyphRange(t,s,d,x){const T=256*s,M=T+255,z=d.toString(16).padStart(4,"0").toUpperCase();h.w(`Unable to load glyph range ${s}, ${T}-${M}. Rendering codepoint U+${z} locally instead. ${x}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&h.q(t)}_drawGlyph(t,s,d){const x=s===Se&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(d),T=x?"ideographTinySDF":"tinySDF";t[T]||(t[T]=this._createTinySDF(x?this.localIdeographFontFamily:s));const M=t[T].draw(String.fromCodePoint(d));return{id:d,bitmap:new h.r({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const s=t?t.split(","):[];s.push("sans-serif");const d=s.map((x=>/[-\w]+/.test(x)?x:`'${CSS.escape(x)}'`)).join(",");return new je.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:this._fontWeight(s[0]),fontStyle:this._fontStyle(s[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const s={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let d;for(const[x,T]of Object.entries(s))new RegExp(`\\b${x}\\b`,"i").test(t)&&(d=`${T}`);return d}destroy(){for(const t in this.entries){const s=this.entries[t];s.tinySDF&&(s.tinySDF=null),s.ideographTinySDF&&(s.ideographTinySDF=null),s.glyphs={},s.requests={},s.ranges={}}this.entries={}}}je.loadGlyphRange=function(E,t,s,d){return h._(this,void 0,void 0,(function*(){const x=256*t,T=x+255,M=d.transformRequest(s.replace("{fontstack}",E).replace("{range}",`${x}-${T}`),"Glyphs"),z=yield h.n(M,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${t}, ${x}-${T}`);const j={};for(const Z of h.o(z.data))j[Z.id]=Z;return j}))},je.TinySDF=class{constructor({fontSize:E=24,buffer:t=3,radius:s=8,cutoff:d=.25,fontFamily:x="sans-serif",fontWeight:T="normal",fontStyle:M="normal",lang:z=null}={}){this.buffer=t,this.cutoff=d,this.radius=s,this.lang=z;const j=this.size=E+4*t,Z=this._createCanvas(j),W=this.ctx=Z.getContext("2d",{willReadFrequently:!0});W.font=`${M} ${T} ${E}px ${x}`,W.textBaseline="alphabetic",W.textAlign="left",W.fillStyle="black",this.gridOuter=new Float64Array(j*j),this.gridInner=new Float64Array(j*j),this.f=new Float64Array(j),this.z=new Float64Array(j+1),this.v=new Uint16Array(j)}_createCanvas(E){const t=document.createElement("canvas");return t.width=t.height=E,t}draw(E){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:d,actualBoundingBoxLeft:x,actualBoundingBoxRight:T}=this.ctx.measureText(E),M=Math.ceil(s),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-x))),j=Math.min(this.size-this.buffer,M+Math.ceil(d)),Z=z+2*this.buffer,W=j+2*this.buffer,ee=Math.max(Z*W,0),J=new Uint8ClampedArray(ee),se={data:J,width:Z,height:W,glyphWidth:z,glyphHeight:j,glyphTop:M,glyphLeft:0,glyphAdvance:t};if(z===0||j===0)return se;const{ctx:pe,buffer:Ae,gridInner:Ne,gridOuter:Re}=this;this.lang&&(pe.lang=this.lang),pe.clearRect(Ae,Ae,z,j),pe.fillText(E,Ae,Ae+M);const Be=pe.getImageData(Ae,Ae,z,j);Re.fill(gt,0,ee),Ne.fill(0,0,ee);for(let We=0;We<j;We++)for(let Le=0;Le<z;Le++){const Ze=Be.data[4*(We*z+Le)+3]/255;if(Ze===0)continue;const et=(We+Ae)*Z+Le+Ae;if(Ze===1)Re[et]=0,Ne[et]=gt;else{const Ve=.5-Ze;Re[et]=Ve>0?Ve*Ve:0,Ne[et]=Ve<0?Ve*Ve:0}}Rt(Re,0,0,Z,W,Z,this.f,this.v,this.z),Rt(Ne,Ae,Ae,z,j,Z,this.f,this.v,this.z);for(let We=0;We<ee;We++){const Le=Math.sqrt(Re[We])-Math.sqrt(Ne[We]);J[We]=Math.round(255-255*(Le/this.radius+this.cutoff))}return se}};class st{constructor(){this.specification=h.u.light.position}possiblyEvaluate(t,s){return h.F(t.expression.evaluate(s))}interpolate(t,s,d){return{x:h.G.number(t.x,s.x,d),y:h.G.number(t.y,s.y,d),z:h.G.number(t.z,s.z,d)}}}let mt;class Xt extends h.E{constructor(t){super(),mt=mt||new h.t({anchor:new h.D(h.u.light.anchor),position:new st,color:new h.D(h.u.light.color),intensity:new h.D(h.u.light.intensity)}),this._transitionable=new h.x(mt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(h.y,t,s))for(const d in t){const x=t[d];d.endsWith(h.z)?this._transitionable.setTransition(d.slice(0,-h.z.length),x):this._transitionable.setValue(d,x)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&h.B(this,t.call(h.C,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.u}))}}const Oe=new h.t({"sky-color":new h.D(h.u.sky["sky-color"]),"horizon-color":new h.D(h.u.sky["horizon-color"]),"fog-color":new h.D(h.u.sky["fog-color"]),"fog-ground-blend":new h.D(h.u.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.u.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.u.sky["atmosphere-blend"])});class Xe extends h.E{constructor(t){super(),this._transitionable=new h.x(Oe,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0))}setSky(t,s={}){if(!this._validate(h.J,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const d in t){const x=t[d];d.endsWith(h.z)?this._transitionable.setTransition(d.slice(0,-h.z.length),x):this._transitionable.setValue(d,x)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d={}){return d?.validate!==!1&&h.B(this,t.call(h.C,h.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class It{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const d=t.join(",")+String(s);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(t,s)),this.dashEntry[d]}getDashRanges(t,s,d){const x=[];let T=t.length%2==1?-t[t.length-1]*d:0,M=t[0]*d,z=!0;x.push({left:T,right:M,isDash:z,zeroLength:t[0]===0});let j=t[0];for(let Z=1;Z<t.length;Z++){z=!z;const W=t[Z];T=j*d,j+=W,M=j*d,x.push({left:T,right:M,isDash:z,zeroLength:W===0})}return x}addRoundDash(t,s,d){const x=s/2;for(let T=-d;T<=d;T++){const M=this.width*(this.nextRow+d+T);let z=0,j=t[z];for(let Z=0;Z<this.width;Z++){Z/j.right>1&&(j=t[++z]);const W=Math.abs(Z-j.left),ee=Math.abs(Z-j.right),J=Math.min(W,ee);let se;const pe=T/d*(x+1);if(j.isDash){const Ae=x-Math.abs(pe);se=Math.sqrt(J*J+Ae*Ae)}else se=x-Math.sqrt(J*J+pe*pe);this.data[M+Z]=Math.max(0,Math.min(255,se+128))}}}addRegularDash(t){for(let z=t.length-1;z>=0;--z){const j=t[z],Z=t[z+1];j.zeroLength?t.splice(z,1):Z&&Z.isDash===j.isDash&&(Z.left=j.left,t.splice(z,1))}const s=t[0],d=t[t.length-1];s.isDash===d.isDash&&(s.left=d.left-this.width,d.right=s.right+this.width);const x=this.width*this.nextRow;let T=0,M=t[T];for(let z=0;z<this.width;z++){z/M.right>1&&(M=t[++T]);const j=Math.abs(z-M.left),Z=Math.abs(z-M.right),W=Math.min(j,Z);this.data[x+z]=Math.max(0,Math.min(255,(M.isDash?W:-W)+128))}}addDash(t,s){const d=s?7:0,x=2*d+1;if(this.nextRow+x>this.height)return h.w("LineAtlas out of space"),null;let T=0;for(let z=0;z<t.length;z++)T+=t[z];if(T!==0){const z=this.width/T,j=this.getDashRanges(t,this.width,z);s?this.addRoundDash(j,z,d):this.addRegularDash(j)}const M={y:this.nextRow+d,height:2*d,width:T};return this.nextRow+=x,this.dirty=!0,M}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Nt="maplibre_preloaded_worker_pool";class $t{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<$t.workerCount;)this.workers.push(new Worker(h.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Nt]}numActive(){return Object.keys(this.active).length}}const Bt=Math.floor(Ce.hardwareConcurrency/2);let Mn,Tn;function Rn(){return Mn||(Mn=new $t),Mn}$t.workerCount=h.K(globalThis)?Math.max(Math.min(Bt,3),1):1;class ri{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const d=this.workerPool.acquire(s);for(let x=0;x<d.length;x++){const T=new h.L(d[x],s);T.name=`Worker ${x}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const d=[];for(const x of this.actors)d.push(x.sendAsync({type:t,data:s}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const d of this.actors)d.registerMessageHandler(t,s)}unregisterMessageHandler(t){for(const s of this.actors)s.unregisterMessageHandler(t)}}function _i(){return Tn||(Tn=new ri(Rn(),h.M),Tn.registerMessageHandler("GR",((E,t,s)=>h.m(t,s)))),Tn}function $n(E,t){const s=h.N();return h.O(s,s,[1,1,0]),h.Q(s,s,[.5*E.width,.5*E.height,1]),E.calculatePosMatrix?h.S(s,s,E.calculatePosMatrix(t.toUnwrapped())):s}function Kn(E,t,s,d,x,T,M){var z;const j=(function(J,se,pe){if(J)for(const Ae of J){const Ne=se[Ae];if(Ne&&Ne.source===pe&&Ne.type==="fill-extrusion")return!0}else for(const Ae in se){const Ne=se[Ae];if(Ne.source===pe&&Ne.type==="fill-extrusion")return!0}return!1})((z=x?.layers)!==null&&z!==void 0?z:null,t,E.id),Z=T.maxPitchScaleFactor(),W=E.tilesIn(d,Z,j);W.sort(Qn);const ee=[];for(const J of W)ee.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(t,s,E.getState(),J.queryGeometry,J.cameraQueryGeometry,J.scale,x,T,Z,$n(T,J.tileID),M?(se,pe)=>M(J.tileID,se,pe):void 0)});return(function(J,se){for(const pe in J)for(const Ae of J[pe])ti(Ae,se);return J})((function(J){const se={},pe={};for(const Ae of J){const Ne=Ae.queryResults,Re=Ae.wrappedTileID,Be=pe[Re]=pe[Re]||{};for(const We in Ne){const Le=Ne[We],Ze=Be[We]=Be[We]||{},et=se[We]=se[We]||[];for(const Ve of Le)Ze[Ve.featureIndex]||(Ze[Ve.featureIndex]=!0,et.push(Ve))}}return se})(ee),E)}function Qn(E,t){const s=E.tileID,d=t.tileID;return s.overscaledZ-d.overscaledZ||s.canonical.y-d.canonical.y||s.wrap-d.wrap||s.canonical.x-d.canonical.x}function ti(E,t){const s=E.feature,d=t.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=d}function Bi(E,t,s){return h._(this,void 0,void 0,(function*(){let d=E;if(E.url?d=(yield h.j(t.transformRequest(E.url,"Source"),s)).data:yield Ce.frameAsync(s),!d)return null;const x=h.U(h.e(d,E),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(x.vectorLayerIds=d.vector_layers.map((T=>T.id))),x}))}class si{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}extend(t){const s=this._sw,d=this._ne;let x,T;if(t instanceof h.V)x=t,T=t;else{if(!(t instanceof si))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(si.convert(t)):this.extend(h.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.V.convert(t)):this;if(x=t._sw,T=t._ne,!x||!T)return this}return s||d?(s.lng=Math.min(x.lng,s.lng),s.lat=Math.min(x.lat,s.lat),d.lng=Math.max(T.lng,d.lng),d.lat=Math.max(T.lat,d.lat)):(this._sw=new h.V(x.lng,x.lat),this._ne=new h.V(T.lng,T.lat)),this}getCenter(){return new h.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.V(this.getWest(),this.getNorth())}getSouthEast(){return new h.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:d}=h.V.convert(t);let x=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&x}intersects(t){if(!((t=si.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const s=Math.abs(this.getEast()-this.getWest()),d=Math.abs(t.getEast()-t.getWest());if(s>=360||d>=360)return!0;const x=h.W(this.getWest(),-180,180),T=h.W(this.getEast(),-180,180),M=h.W(t.getWest(),-180,180),z=h.W(t.getEast(),-180,180),j=x>=T,Z=M>=z;return!(!j||!Z)||(j?z>=x||M<=T:Z?T>=M||x<=z:M<=T&&z>=x)}static convert(t){return t instanceof si?t:t&&new si(t)}static fromLngLat(t,s=0){const d=360*s/40075017,x=d/Math.cos(Math.PI/180*t.lat);return new si(new h.V(t.lng-x,t.lat-d),new h.V(t.lng+x,t.lat+d))}adjustAntiMeridian(){const t=new h.V(this._sw.lng,this._sw.lat),s=new h.V(this._ne.lng,this._ne.lat);return new si(t,t.lng>s.lng?new h.V(s.lng+360,s.lat):s)}}class Yt{constructor(t,s,d){this.bounds=si.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),d=Math.floor(h.Y(this.bounds.getWest())*s),x=Math.floor(h.X(this.bounds.getNorth())*s),T=Math.ceil(h.Y(this.bounds.getEast())*s),M=Math.ceil(h.X(this.bounds.getSouth())*s);return t.x>=d&&t.x<T&&t.y>=x&&t.y<M}}class fn extends h.E{constructor(t,s,d,x){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.U(s,["url","scheme","tileSize","promoteId","encoding"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Bi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new Yt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,h.Z(t)||this.fire(new h.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};d.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((T,M)=>{t.reloadPromise={resolve:T,reject:M}}))}else t.actor=this.dispatcher.getActor(),x="LT";t.abortController=new AbortController;try{const T=yield t.actor.sendAsync({type:x,data:d},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,T)}catch(T){if(delete t.abortController,t.aborted)return;if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const s=t.tileID.scaledTo(this.maxzoom).canonical,d=s.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:s,overzoomRequest:this.map._requestManager.transformRequest(d,"Tile")}}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const d=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(d.resolve).catch(d.reject)}}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class di extends h.E{constructor(t,s,d,x){super(),this.id=t,this.dispatcher=d,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.U(s,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Bi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(h.e(this,s),s.bounds&&(this.tileBounds=new Yt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,h.Z(s)||this.fire(new h.k(s))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const d=yield tt.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&t.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const x=this.map.painter.context,T=x.gl,M=d.data;t.texture=this.map.painter.getTileTexture(M.width),t.texture?t.texture.update(M,{useMipmap:!0}):(t.texture=new h.T(x,M,T.RGBA,{useMipmap:!0}),t.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(d){if(delete t.abortController,t.aborted)t.state="unloaded";else if(d)throw t.state="errored",d}}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class gn extends di{constructor(t,s,d,x){super(t,s,d,x),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const x=yield tt.getImage(d,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(x&&x.data){const T=x.data;this.map._refreshExpiredTiles&&(x.cacheControl||x.expires)&&t.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const M=h.b(T)&&h.$()?T:yield this.readImageNow(T),z={type:this.type,uid:t.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const j=yield t.actor.sendAsync({type:"LDT",data:z});t.dem=j,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(x){if(delete t.abortController,t.aborted)t.state="unloaded";else if(x)throw t.state="errored",x}}))}readImageNow(t){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.a0()){const s=t.width+2,d=t.height+2;try{return new h.R({width:s,height:d},yield h.a1(t,-1,-1,s,d))}catch{}}return Ce.getImageData(t,1)}))}_getNeighboringTiles(t){const s=t.canonical,d=Math.pow(2,s.z),x=(s.x-1+d)%d,T=s.x===0?t.wrap-1:t.wrap,M=(s.x+1+d)%d,z=s.x+1===d?t.wrap+1:t.wrap,j={};return j[new h.a2(t.overscaledZ,T,s.z,x,s.y).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,M,s.y).key]={backfilled:!1},s.y>0&&(j[new h.a2(t.overscaledZ,T,s.z,x,s.y-1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,M,s.y-1).key]={backfilled:!1}),s.y+1<d&&(j[new h.a2(t.overscaledZ,T,s.z,x,s.y+1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,M,s.y+1).key]={backfilled:!1}),j}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Zn(E){return E.type==="GeometryCollection"?E.geometries.map((t=>t.coordinates)).flat(1/0):E.coordinates.flat(1/0)}function Yi(E){const t=new si;let s;switch(E.type){case"FeatureCollection":s=E.features.map((d=>Zn(d.geometry))).flat(1/0);break;case"Feature":s=Zn(E.geometry);break;default:s=Zn(E)}if(s.length==0)return t;for(let d=0;d<s.length-1;d+=2)t.extend([s[d],s[d+1]]);return t}class fi extends h.E{constructor(t,s,d,x){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=d.getActor(),this.setEventedParent(x),this._data=typeof s.data=="string"?{url:s.data}:{geojson:s.data},this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:h.a5,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.a5,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(h.a5/this.tileSize)}_getClusterMaxZoom(t){const s=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${s}"`),s}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,s){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const d=this._updateWorkerData();return s?d:this}updateData(t,s){this._pendingWorkerUpdate.diff=h.a6(this._pendingWorkerUpdate.diff,t);const d=this._updateWorkerData();return s?d:this}getData(){return h._(this,void 0,void 0,(function*(){const t=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return h._(this,void 0,void 0,(function*(){return Yi(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:d}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void h.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:s}=this._pendingWorkerUpdate,d=h.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(d.request=this.map._requestManager.transformRequest(Ce.resolveURL(t),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=t,this._pendingWorkerUpdate.data=void 0):s&&(d.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const x=yield this.actor.sendAsync({type:"LD",data:d});if(this._isUpdatingWorker=!1,this._removed||x.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));x.data&&(this._data={geojson:x.data});const T=this._applyDiffToSource(s),M=this._getShouldReloadTileOptions(T);let z=null;x.resourceTiming&&x.resourceTiming[this.id]&&(z=x.resourceTiming[this.id].slice(0));const j={dataType:"source"};this._collectResourceTiming&&z&&z.length>0&&h.e(j,{resourceTiming:z}),this.fire(new h.l("data",Object.assign(Object.assign({},j),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},j),{sourceDataType:"content",shouldReloadTileOptions:M})))}catch(x){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(x))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const s=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const x=h.a7(this._data.geojson,s);if(!x)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:x}}if(!this._data.updateable)return;const d=h.a8(this._data.updateable,t,s);return t.removeAll||this._options.cluster?void 0:d}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((s=>Yi(s)))}}shouldReloadTile(t,{affectedBounds:s}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:d,extent:x}=this.workerOptions.geojsonVtOptions,T=(function({x:M,y:z,z:j},Z=0){const W=h.a3((M-Z)/Math.pow(2,j)),ee=h.a4((z+1+Z)/Math.pow(2,j)),J=h.a3((M+1+Z)/Math.pow(2,j)),se=h.a4((z-Z)/Math.pow(2,j));return new si([W,ee],[J,se])})(t.tileID.canonical,d/x);for(const M of s)if(T.intersects(M))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const d={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const x=yield this.actor.sendAsync({type:s,data:d},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(x,this.map.painter,s==="RT")}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class ci extends h.E{constructor(t,s,d,x){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=d,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=s}load(t){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield tt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,h.Z(s)||this.fire(new h.k(s))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(h.a9.fromLngLat);var d;return this.tileID=(function(x){const T=h.aa.fromPoints(x),M=T.width(),z=T.height(),j=Math.max(M,z),Z=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),W=Math.pow(2,Z);return new h.ac(Z,Math.floor((T.minX+T.maxX)/2*W),Math.floor((T.minY+T.maxY)/2*W))})(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map((x=>this.tileID.getTilePoint(x)._round())),this.flippedWindingOrder=((d=this.tileCoords)[1].x-d[0].x)*(d[2].y-d[0].y)-(d[1].y-d[0].y)*(d[2].x-d[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture||(this.texture=new h.T(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let d=!1;for(const x in this.tiles){const T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,d=!0)}d&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:s,minY:d,maxX:x,maxY:T}=h.aa.fromPoints(t),M={};for(let z=0;z<=h.ab;z++){const j=Math.pow(2,z),Z=Math.floor(s*j),W=Math.floor(d*j),ee=Math.floor(x*j),J=Math.floor(T*j);M[z]={minTileX:Z,minTileY:W,maxTileX:ee,maxTileY:J}}return M}}class ct extends ci{constructor(t,s,d,x){super(t,s,d,x),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.ad(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.k(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new h.k(new h.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let d=!1;for(const x in this.tiles){const T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,d=!0)}d&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class oe extends ci{constructor(t,s,d,x){super(t,s,d,x),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((T=>!Array.isArray(T)||T.length!==2||T.some((M=>typeof M!="number"))))||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.k(new h.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,d=s.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new h.T(s,this.canvas,d.RGBA,{premultiply:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let x=!1;for(const T in this.tiles){const M=this.tiles[T];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,x=!0)}x&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const ue={},ge=E=>{switch(E){case"geojson":return fi;case"image":return ci;case"raster":return di;case"raster-dem":return gn;case"vector":return fn;case"video":return ct;case"canvas":return oe}return ue[E]},qe="RTLPluginLoaded";class $e extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_i()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,(function*(s,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ce.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(qe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let bt=null;function at(){return bt||(bt=new $e),bt}var fe,de;(function(E){E[E.Base=0]="Base",E[E.Parent=1]="Parent"})(fe||(fe={})),(function(E){E[E.Departing=0]="Departing",E[E.Incoming=1]="Incoming"})(de||(de={}));class Me{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=h.af(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:s,fadingParentID:d,fadeEndTime:x}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=s,this.fadingParentID=d,this.fadeEndTime=x}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=ye(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(x,T){const M={};if(!T)return M;for(const z of x){const j=z.layerIds.map((Z=>T.getLayer(Z))).filter(Boolean);if(j.length!==0){z.layers=j,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map((Z=>j.filter((W=>W.id===Z))[0])));for(const Z of j)M[Z.id]=z}}return M})(t.buckets,s?.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const T=this.buckets[x];if(T instanceof h.ah){if(this.hasSymbolBuckets=!0,!d)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const T=this.buckets[x];if(T instanceof h.ah&&T.hasRTLText){this.hasRTLText=!0,at().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const T=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(x).queryRadius(T))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new h.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const d in this.buckets){const x=this.buckets[d];x.uploadPending()&&x.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,d,x,T,M,z,j,Z,W,ee){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:T,scale:M,tileSize:this.tileSize,pixelPosMatrix:W,transform:j,params:z,queryPadding:this.queryPadding*Z,getElevation:ee},t,s,d):{}}querySourceFeatures(t,s){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const x=d.loadVTLayers(),T=s&&s.sourceLayer?s.sourceLayer:"",M=x[h.ai]||x[T];if(!M)return;const z=h.aj(s?.filter,s?.globalState),{z:j,x:Z,y:W}=this.tileID.canonical,ee={z:j,x:Z,y:W};for(let J=0;J<M.length;J++){const se=M.feature(J);if(z.needGeometry){const Ne=h.ak(se,!0);if(!z.filter(new h.H(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!z.filter(new h.H(this.tileID.overscaledZ),se))continue;const pe=d.getId(se,T),Ae=new h.al(se,j,Z,W,pe);Ae.tile=ee,t.push(Ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const d=h.am(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let x=!1;if(this.expirationTime>d)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{const T=this.expirationTime-s;T?this.expirationTime=d+Math.max(T,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!s.style.hasLayer(x))continue;const T=this.buckets[x],M=T.layers[0].sourceLayer||h.ai,z=d[M],j=t[M];if(!z||!j||Object.keys(j).length===0)continue;T.update(j,z,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const Z=s&&s.style&&s.style.getLayer(x);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(T)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ye()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=ye()+t}setDependencies(t,s){const d={};for(const x of s)d[x]=!0;this.dependencies[t]=d}hasDependency(t,s){for(const d of t){const x=this.dependencies[d];if(x){for(const T of s)if(x[T])return!0}}return!1}}class Ue{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,d){const x=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][x]=this.stateChanges[t][x]||{},h.e(this.stateChanges[t][x],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const T in this.state[t])T!==x&&(this.deletedStates[t][T]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][x]===null){this.deletedStates[t][x]={};for(const T in this.state[t][x])d[T]||(this.deletedStates[t][x][T]=null)}else for(const T in d)this.deletedStates[t]&&this.deletedStates[t][x]&&this.deletedStates[t][x][T]===null&&delete this.deletedStates[t][x][T]}removeFeatureState(t,s,d){if(this.deletedStates[t]===null)return;const x=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&s!==void 0)this.deletedStates[t][x]!==null&&(this.deletedStates[t][x]=this.deletedStates[t][x]||{},this.deletedStates[t][x][d]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][x])for(d in this.deletedStates[t][x]={},this.stateChanges[t][x])this.deletedStates[t][x][d]=null;else this.deletedStates[t][x]=null;else this.deletedStates[t]=null}getState(t,s){const d=String(s),x=h.e({},(this.state[t]||{})[d],(this.stateChanges[t]||{})[d]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const T=this.deletedStates[t][s];if(T===null)return{};for(const M in T)delete x[M]}return x}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const d={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const T={};for(const M in this.stateChanges[x])this.state[x][M]||(this.state[x][M]={}),h.e(this.state[x][M],this.stateChanges[x][M]),T[M]=this.state[x][M];d[x]=T}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const T={};if(this.deletedStates[x]===null)for(const M in this.state[x])T[M]={},this.state[x][M]={};else for(const M in this.deletedStates[x]){if(this.deletedStates[x][M]===null)this.state[x][M]={};else for(const z of Object.keys(this.deletedStates[x][M]))delete this.state[x][M][z];T[M]=this.state[x][M]}d[x]=d[x]||{},h.e(d[x],T)}this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0&&t.setFeatureState(d,s)}}const xt=89.25;function yt(E,t){const s=h.an(t.lat,-h.ao,h.ao);return new h.P(h.Y(t.lng)*E,h.X(s)*E)}function qt(E,t){return new h.a9(t.x/E,t.y/E).toLngLat()}function Ot(E){return E.cameraToCenterDistance*Math.min(.85*Math.tan(h.ap(90-E.pitch)),Math.tan(h.ap(xt-E.pitch)))}function cn(E,t){const s=E.canonical,d=t/h.aq(s.z),x=s.x+Math.pow(2,s.z)*E.wrap,T=h.ar(new Float64Array(16));return h.O(T,T,[x*d,s.y*d,0]),h.Q(T,T,[d/h.a5,d/h.a5,1]),T}function Ke(E,t,s,d,x){const T=h.a9.fromLngLat(E,t),M=x*h.as(1,E.lat),{x:z,y:j,z:Z}=kn(s,d);return new h.a9(T.x+M*-z,T.y+M*-j,T.z+M*-Z)}function kn(E,t){const s=h.ap(E),d=h.ap(t),x=Math.cos(-s),T=Math.sin(s);return{x:T*Math.sin(d),y:-T*Math.cos(d),z:x}}function Fn(E,t,s){const d=t.intersectsFrustum(E);if(!s||d===0)return d;const x=t.intersectsPlane(s);return x===0?0:d===2&&x===2?2:1}function wn(E,t,s){let d=0;const x=(s-t)/10;for(let T=0;T<10;T++)d+=x*Math.pow(Math.cos(t+(T+.5)/10*(s-t)),E);return d}function _n(E,t){return function(s,d,x,T,M){const z=2*((E-1)/h.at(Math.cos(h.ap(xt-M))/Math.cos(h.ap(xt)))-1),j=Math.acos(x/T),Z=2*wn(z-1,0,h.ap(M/2)),W=Math.min(h.ap(xt),j+h.ap(M/2)),ee=wn(z-1,Math.min(W,j-h.ap(M/2)),W),J=Math.atan(d/x),se=Math.hypot(d,x);let pe=s;return pe+=h.at(T/se/Math.max(.5,Math.cos(h.ap(M/2)))),pe+=z*h.at(Math.cos(J))/2,pe-=h.at(Math.max(1,ee/Z/t))/2,pe}}const gi=_n(9.314,3);function Yn(E,t){const s=(t.roundZoom?Math.round:Math.floor)(E.zoom+h.at(E.tileSize/t.tileSize));return Math.max(0,s)}function nn(E,t){const s=E.getCameraFrustum(),d=E.getClippingPlane(),x=E.screenPointToMercatorCoordinate(E.getCameraPoint()),T=h.a9.fromLngLat(E.center,E.elevation);x.z=T.z+Math.cos(E.pitchInRadians)*E.cameraToCenterDistance/E.worldSize;const M=E.getCoveringTilesDetailsProvider(),z=M.allowVariableZoom(E,t),j=Yn(E,t),Z=t.minzoom||0,W=t.maxzoom!==void 0?t.maxzoom:E.maxZoom,ee=Math.min(Math.max(0,j),W),J=Math.pow(2,ee),se=[J*x.x,J*x.y,0],pe=[J*T.x,J*T.y,0],Ae=Math.hypot(T.x-x.x,T.y-x.y),Ne=Math.abs(T.z-x.z),Re=Math.hypot(Ae,Ne),Be=Ze=>({zoom:0,x:0,y:0,wrap:Ze,fullyVisible:!1}),We=[],Le=[];if(E.renderWorldCopies&&M.allowWorldCopies())for(let Ze=1;Ze<=3;Ze++)We.push(Be(-Ze)),We.push(Be(Ze));for(We.push(Be(0));We.length>0;){const Ze=We.pop(),et=Ze.x,Ve=Ze.y;let ut=Ze.fullyVisible;const Mt={x:et,y:Ve,z:Ze.zoom},Et=M.getTileBoundingVolume(Mt,Ze.wrap,E.elevation,t);if(!ut){const mn=Fn(s,Et,d);if(mn===0)continue;ut=mn===2}const At=M.distanceToTile2d(x.x,x.y,Mt,Et);let Ct=j;z&&(Ct=(t.calculateTileZoom||gi)(E.zoom+h.at(E.tileSize/t.tileSize),At,Ne,Re,E.fov)),Ct=(t.roundZoom?Math.round:Math.floor)(Ct),Ct=Math.max(0,Ct);const dn=Math.min(Ct,W);if(Ze.wrap=M.getWrap(T,Mt,Ze.wrap),Ze.zoom>=dn){if(Ze.zoom<Z)continue;const mn=ee-Ze.zoom,Qt=se[0]-.5-(et<<mn),En=se[1]-.5-(Ve<<mn),mi=t.reparseOverscaled?Math.max(Ze.zoom,Ct):Ze.zoom;Le.push({tileID:new h.a2(Ze.zoom===W?mi:Ze.zoom,Ze.wrap,Ze.zoom,et,Ve),distanceSq:h.au([pe[0]-.5-et,pe[1]-.5-Ve]),tileDistanceToCamera:Math.sqrt(Qt*Qt+En*En)})}else for(let mn=0;mn<4;mn++)We.push({zoom:Ze.zoom+1,x:(et<<1)+mn%2,y:(Ve<<1)+(mn>>1),wrap:Ze.wrap,fullyVisible:ut})}return Le.sort(((Ze,et)=>Ze.distanceSq-et.distanceSq)).map((Ze=>Ze.tileID))}const Jt=h.aa.fromPoints([new h.P(0,0),new h.P(h.a5,h.a5)]);function Bn(E){return E==="raster"||E==="image"||E==="video"}function Di(E,t,s,d,x,T,M){if(!t.hasData())return!1;const{tileID:z,fadingRole:j,fadingDirection:Z,fadingParentID:W}=t;if(j===fe.Base&&Z===de.Incoming&&W)return s[W.key]=W,!0;const ee=Math.max(z.overscaledZ-x,T);for(let J=z.overscaledZ-1;J>=ee;J--){const se=z.scaledTo(J),pe=E.getLoadedTile(se);if(pe)return t.setCrossFadeLogic({fadingRole:fe.Base,fadingDirection:de.Incoming,fadingParentID:pe.tileID,fadeEndTime:d+M}),pe.setCrossFadeLogic({fadingRole:fe.Parent,fadingDirection:de.Departing,fadeEndTime:d+M}),s[se.key]=se,!0}return!1}function Fi(E,t,s,d,x,T){if(!t.hasData())return!1;const M=t.tileID.children(x);let z=Zt(E,t,M,s,d,x,T);if(z)return!0;for(const j of M)Zt(E,t,j.children(x),s,d,x,T)&&(z=!0);return z}function Zt(E,t,s,d,x,T,M){if(s[0].overscaledZ>=T)return!1;let z=!1;for(const j of s){const Z=E.getLoadedTile(j);if(!Z)continue;const{fadingRole:W,fadingDirection:ee,fadingParentID:J}=Z;W===fe.Base&&ee===de.Departing&&J||(Z.setCrossFadeLogic({fadingRole:fe.Base,fadingDirection:de.Departing,fadingParentID:t.tileID,fadeEndTime:x+M}),t.setCrossFadeLogic({fadingRole:fe.Parent,fadingDirection:de.Incoming,fadeEndTime:x+M})),d[j.key]=j,z=!0}return z}function xi(E,t,s,d){const x=E.tileID;return!!E.selfFading||!E.hasData()&&!!t.has(x)&&(E.setSelfFadeLogic(s+d),!0)}function bn(E,t){var s;E.needsHillshadePrepare=!0,E.needsTerrainPrepare=!0;let d=t.tileID.canonical.x-E.tileID.canonical.x;const x=t.tileID.canonical.y-E.tileID.canonical.y,T=Math.pow(2,E.tileID.canonical.z),M=t.tileID.key;d===0&&x===0||Math.abs(x)>1||(Math.abs(d)>1&&(Math.abs(d+T)===1?d+=T:Math.abs(d-T)===1&&(d-=T)),t.dem&&E.dem&&(E.dem.backfillBorder(t.dem,d,x),!((s=E.neighboringTiles)===null||s===void 0)&&s[M]&&(E.neighboringTiles[M].backfilled=!0)))}class Rr{constructor(){this._tiles={}}handleWrapJump(t){const s={};for(const d in this._tiles){const x=this._tiles[d];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+t),s[x.tileID.key]=x}this._tiles=s}setFeatureState(t,s){for(const d in this._tiles)this._tiles[d].setFeatureState(t,s)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((s=>s.tileID)).sort(h.aw).map((s=>s.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,s){this._tiles[t]=s}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const s=this.getTileById(t.key);return s?.hasData()?s:null}isIdRenderable(t,s=!1){var d;return(d=this.getTileById(t))===null||d===void 0?void 0:d.isRenderable(s)}getRenderableIds(t=0,s){const d=[];for(const x of this.getAllIds())this.isIdRenderable(x,s)&&d.push(this.getTileById(x));return s?d.sort(((x,T)=>{const M=x.tileID,z=T.tileID,j=new h.P(M.canonical.x,M.canonical.y)._rotate(-t),Z=new h.P(z.canonical.x,z.canonical.y)._rotate(-t);return M.overscaledZ-z.overscaledZ||Z.y-j.y||Z.x-j.x})).map((x=>x.tileID.key)):d.map((x=>x.tileID)).sort(h.aw).map((x=>x.key))}}class vi extends h.E{constructor(t,s,d){super(),this.id=t,this.dispatcher=d,this.on("data",(x=>this._dataHandler(x))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((x,T,M,z)=>{const j=new(ge(T.type))(x,T,M,z);if(j.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${j.id}`);return j})(t,s,d,this),this._inViewTiles=new Rr,this._outOfViewCache=new h.ax(0,(x=>this._unloadTile(x))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Ue,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const s of this._inViewTiles.getAllTiles())s.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Rr}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,d){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,d)}catch(x){t.state="errored",x.status!==404?this._source.fire(new h.k(x,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const s of this._inViewTiles.getAllTiles())s.upload(t),s.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var s;return this._inViewTiles.getRenderableIds((s=this.transform)===null||s===void 0?void 0:s.bearingInRadians,t)}hasRenderableParent(t){const s=t.overscaledZ-1;if(s>=this._source.minzoom){const d=this.getLoadedTile(t.scaledTo(s));if(d)return this._inViewTiles.isIdRenderable(d.tileID.key)}return!1}reload(t,s=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const d of this._inViewTiles.getAllIds()){const x=this._inViewTiles.getTileById(d);s&&!this._source.shouldReloadTile(x,s)||(t?this._reloadTile(d,"expired"):x.state!=="errored"&&this._reloadTile(d,"reloading"))}}}_reloadTile(t,s){return h._(this,void 0,void 0,(function*(){const d=this._inViewTiles.getTileById(t);d&&(d.state!=="loading"&&(d.state=s),yield this._loadTile(d,t,s))}))}_tileLoaded(t,s,d){t.timeAdded=ye(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&(function(x,T){var M,z;const j=T.getRenderableIds();for(const Z of j){if(!x.neighboringTiles||!x.neighboringTiles[Z])continue;const W=T.getTileById(Z);x.neighboringTiles[Z].backfilled||bn(x,W),!((z=(M=W.neighboringTiles)===null||M===void 0?void 0:M[x.tileID.key])===null||z===void 0)&&z.backfilled||bn(W,x)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,s){const d=this._getLoadedDescendents(s),x=new Set;for(const T of s){const M=d[T.key];if(!M?.length){x.add(T);continue}const z=T.overscaledZ+vi.maxOverzooming,j=M.filter((ee=>ee.tileID.overscaledZ<=z));if(!j.length){x.add(T);continue}const Z=Math.min(...j.map((ee=>ee.tileID.overscaledZ))),W=j.filter((ee=>ee.tileID.overscaledZ===Z)).map((ee=>ee.tileID));for(const ee of W)t[ee.key]=ee;this._areDescendentsComplete(W,Z,T.overscaledZ)||x.add(T)}return x}_getLoadedDescendents(t){var s;const d={};for(const x of this._inViewTiles.getAllTiles().filter((T=>T.hasData())))for(const T of t)x.tileID.isChildOf(T)&&(d[s=T.key]||(d[s]=[])).push(x);return d}_areDescendentsComplete(t,s,d){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===s:Math.pow(4,s-d)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,d=Math.ceil(t.height/this._source.tileSize)+1,x=Math.floor(s*d*(this._maxTileCacheZoomLevels===null?h.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._outOfViewCache.setMaxSize(T)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,s&&(this._inViewTiles.handleWrapJump(s),this._resetTileReloadTimers())}update(t,s){if(!this._sourceLoaded||this._paused)return;let d;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?d=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((j=>new h.a2(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y))):(d=nn(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(d=d.filter((j=>this._source.hasTile(j))))):d=[],this.usedForTerrain&&(d=this._addTerrainIdealTiles(d));const x=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=Yn(t,this._source),M=this._updateRetainedTiles(d,T),z=Bn(this._source.type);z&&this._rasterFadeDuration>0&&!s&&(function(j,Z,W,ee,J,se,pe){const Ae=ye(),Ne=h.av(Z);for(const Re of Z){const Be=j.getTileById(Re.key);Be.fadingDirection!==de.Departing&&Be.fadeOpacity!==0||Be.resetFadeLogic(),Di(j,Be,W,Ae,ee,J,pe)||Fi(j,Be,W,Ae,se,pe)||xi(Be,Ne,Ae,pe)||Be.resetFadeLogic()}})(this._inViewTiles,d,M,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),z?this._cleanUpRasterTiles(M):this._cleanUpVectorTiles(M)}_cleanUpRasterTiles(t){for(const s of this._inViewTiles.getAllIds())t[s]||this._removeTile(s)}_cleanUpVectorTiles(t){for(const s of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(s);t[s]?d.clearSymbolFadeHold():d.hasSymbolBuckets?d.holdingForSymbolFade()?d.symbolFadeFinished()&&this._removeTile(s):d.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(s)}}_addTerrainIdealTiles(t){const s=[];for(const d of t)if(d.canonical.z>this._source.minzoom){const x=d.scaledTo(d.canonical.z-1);s.push(x);const T=d.scaledTo(Math.max(this._source.minzoom,Math.min(d.canonical.z,5)));s.push(T)}return t.concat(s)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var d;const x=new Set;for(const Z of t)this._addTile(Z).hasData()||x.add(Z);const T=t.reduce(((Z,W)=>(Z[W.key]=W,Z)),{}),M=this._retainLoadedChildren(T,x),z={},j=Math.max(s-vi.maxUnderzooming,this._source.minzoom);for(const Z of M){let W=this._inViewTiles.getTileById(Z.key),ee=W?.wasRequested();for(let J=Z.overscaledZ-1;J>=j;--J){const se=Z.scaledTo(J);if(z[se.key])break;if(z[se.key]=!0,W=this.getTile(se),!W&&ee&&(W=this._addTile(se)),W){const pe=W.hasData();if((pe||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||ee)&&(T[se.key]=se),ee=W.wasRequested(),pe)break}}}return T}_addTile(t){let s=this._inViewTiles.getTileById(t.key);if(s)return s;s=this._outOfViewCache.getAndRemove(t),s&&(s.resetFadeLogic(),this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null));const d=s;return s||(s=new Me(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._inViewTiles.setTile(t.key,s),d||this._source.fire(new h.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){this._clearTileReloadTimer(t);const d=s.getExpiryTimeout();d&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),d))}_clearTileReloadTimer(t){const s=this._timers[t];s&&(clearTimeout(s),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const s=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,s)}}refreshTiles(t){for(const s of this._inViewTiles.getAllIds()){const d=this._inViewTiles.getTileById(s);(this._inViewTiles.isIdRenderable(s)||d.state=="errored")&&t.some((x=>x.equals(d.tileID.canonical)))&&this._reloadTile(s,"expired")}}_removeTile(t){const s=this._inViewTiles.getTileById(t);s&&(s.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._outOfViewCache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,s,d){const x=[],T=this.transform;if(!T)return x;const M=T.getCoveringTilesDetailsProvider().allowWorldCopies(),z=d?T.getCameraQueryGeometry(t):t,j=se=>T.screenPointToMercatorCoordinate(se,this.terrain),Z=this.transformBbox(t,j,!M),W=this.transformBbox(z,j,!M),ee=this.getIds(),J=h.aa.fromPoints(W);for(let se=0;se<ee.length;se++){const pe=this._inViewTiles.getTileById(ee[se]);if(pe.holdingForSymbolFade())continue;const Ae=M?[pe.tileID]:[pe.tileID.unwrapTo(-1),pe.tileID.unwrapTo(0)],Ne=Math.pow(2,T.zoom-pe.tileID.overscaledZ),Re=s*pe.queryPadding*h.a5/pe.tileSize/Ne;for(const Be of Ae){const We=J.map((Le=>Be.getTilePoint(new h.a9(Le.x,Le.y))));if(We.expandBy(Re),We.intersects(Jt)){const Le=Z.map((et=>Be.getTilePoint(et))),Ze=W.map((et=>Be.getTilePoint(et)));x.push({tile:pe,tileID:M?Be:Be.unwrapTo(0),queryGeometry:Le,cameraQueryGeometry:Ze,scale:Ne})}}}return x}transformBbox(t,s,d){let x=t.map(s);if(d){const T=h.aa.fromPoints(t);T.shrinkBy(.001*Math.min(T.width(),T.height()));const M=T.map(s);h.aa.fromPoints(x).covers(M)||(x=x.map((z=>z.x>.5?new h.a9(z.x-1,z.y,z.z):z)))}return x}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map((d=>this._inViewTiles.getTileById(d).tileID));return this.transform&&this.transform.populateCache(s),s}hasTransition(){return!!this._source.hasTransition()||!(!Bn(this._source.type)||!(function(t,s){if(s<=0)return!1;const d=ye();for(const x of t.getAllTiles())if(x.fadeEndTime>=d)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,s,d){this._state.updateState(t=t||h.ai,s,d)}removeFeatureState(t,s,d){this._state.removeFeatureState(t=t||h.ai,s,d)}getFeatureState(t,s){return this._state.getState(t=t||h.ai,s)}setDependencies(t,s,d){const x=this._inViewTiles.getTileById(t);x&&x.setDependencies(s,d)}reloadTilesForDependencies(t,s){for(const d of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(d).hasDependency(t,s)&&this._reloadTile(d,"reloading");this._outOfViewCache.filter((d=>!d.hasDependency(t,s)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}vi.maxUnderzooming=10,vi.maxOverzooming=3;class jt{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.an(t,0,1);let s=1,d=this._distances[s];const x=t*this.paddedLength+this.padding;for(;d<x&&s<this._distances.length;)d=this._distances[++s];const T=s-1,M=this._distances[T],z=d-M,j=z>0?(x-M)/z:0;return this.points[T].mult(1-j).add(this.points[s].mult(j))}}function Gn(E,t){let s=!0;return E==="always"||E!=="never"&&t!=="never"||(s=!1),s}class ni{constructor(t,s,d){const x=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(s/d);for(let M=0;M<this.xCellCount*this.yCellCount;M++)x.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,d,x,T){this._forEachCell(s,d,x,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(x),this.bboxes.push(T)}insertCircle(t,s,d,x){this._forEachCell(s-x,d-x,s+x,d+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(d),this.circles.push(x)}_insertBoxCell(t,s,d,x,T,M){this.boxCells[T].push(M)}_insertCircleCell(t,s,d,x,T,M){this.circleCells[T].push(M)}_query(t,s,d,x,T,M,z){if(d<0||t>this.width||x<0||s>this.height)return[];const j=[];if(t<=0&&s<=0&&this.width<=d&&this.height<=x){if(T)return[{key:null,x1:t,y1:s,x2:d,y2:x}];for(let Z=0;Z<this.boxKeys.length;Z++)j.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const W=this.circles[3*Z],ee=this.circles[3*Z+1],J=this.circles[3*Z+2];j.push({key:this.circleKeys[Z],x1:W-J,y1:ee-J,x2:W+J,y2:ee+J})}}else this._forEachCell(t,s,d,x,this._queryCell,j,{hitTest:T,overlapMode:M,seenUids:{box:{},circle:{}}},z);return j}query(t,s,d,x){return this._query(t,s,d,x,!1,null)}hitTest(t,s,d,x,T,M){return this._query(t,s,d,x,!0,T,M).length>0}hitTestCircle(t,s,d,x,T){const M=t-d,z=t+d,j=s-d,Z=s+d;if(z<0||M>this.width||Z<0||j>this.height)return!1;const W=[];return this._forEachCell(M,j,z,Z,this._queryCellCircle,W,{hitTest:!0,overlapMode:x,circle:{x:t,y:s,radius:d},seenUids:{box:{},circle:{}}},T),W.length>0}_queryCell(t,s,d,x,T,M,z,j){const{seenUids:Z,hitTest:W,overlapMode:ee}=z,J=this.boxCells[T];if(J!==null){const pe=this.bboxes;for(const Ae of J)if(!Z.box[Ae]){Z.box[Ae]=!0;const Ne=4*Ae,Re=this.boxKeys[Ae];if(t<=pe[Ne+2]&&s<=pe[Ne+3]&&d>=pe[Ne+0]&&x>=pe[Ne+1]&&(!j||j(Re))&&(!W||!Gn(ee,Re.overlapMode))&&(M.push({key:Re,x1:pe[Ne],y1:pe[Ne+1],x2:pe[Ne+2],y2:pe[Ne+3]}),W))return!0}}const se=this.circleCells[T];if(se!==null){const pe=this.circles;for(const Ae of se)if(!Z.circle[Ae]){Z.circle[Ae]=!0;const Ne=3*Ae,Re=this.circleKeys[Ae];if(this._circleAndRectCollide(pe[Ne],pe[Ne+1],pe[Ne+2],t,s,d,x)&&(!j||j(Re))&&(!W||!Gn(ee,Re.overlapMode))){const Be=pe[Ne],We=pe[Ne+1],Le=pe[Ne+2];if(M.push({key:Re,x1:Be-Le,y1:We-Le,x2:Be+Le,y2:We+Le}),W)return!0}}}return!1}_queryCellCircle(t,s,d,x,T,M,z,j){const{circle:Z,seenUids:W,overlapMode:ee}=z,J=this.boxCells[T];if(J!==null){const pe=this.bboxes;for(const Ae of J)if(!W.box[Ae]){W.box[Ae]=!0;const Ne=4*Ae,Re=this.boxKeys[Ae];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,pe[Ne+0],pe[Ne+1],pe[Ne+2],pe[Ne+3])&&(!j||j(Re))&&!Gn(ee,Re.overlapMode))return M.push(!0),!0}}const se=this.circleCells[T];if(se!==null){const pe=this.circles;for(const Ae of se)if(!W.circle[Ae]){W.circle[Ae]=!0;const Ne=3*Ae,Re=this.circleKeys[Ae];if(this._circlesCollide(pe[Ne],pe[Ne+1],pe[Ne+2],Z.x,Z.y,Z.radius)&&(!j||j(Re))&&!Gn(ee,Re.overlapMode))return M.push(!0),!0}}}_forEachCell(t,s,d,x,T,M,z,j){const Z=this._convertToXCellCoord(t),W=this._convertToYCellCoord(s),ee=this._convertToXCellCoord(d),J=this._convertToYCellCoord(x);for(let se=Z;se<=ee;se++)for(let pe=W;pe<=J;pe++)if(T.call(this,t,s,d,x,this.xCellCount*pe+se,M,z,j))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,d,x,T,M){const z=x-t,j=T-s,Z=d+M;return Z*Z>z*z+j*j}_circleAndRectCollide(t,s,d,x,T,M,z){const j=(M-x)/2,Z=Math.abs(t-(x+j));if(Z>j+d)return!1;const W=(z-T)/2,ee=Math.abs(s-(T+W));if(ee>W+d)return!1;if(Z<=j||ee<=W)return!0;const J=Z-j,se=ee-W;return J*J+se*se<=d*d}}function vs(E,t,s){const d=h.N();if(!E){const{vecSouth:ee,vecEast:J}=ia(t),se=H();se[0]=J[0],se[1]=J[1],se[2]=ee[0],se[3]=ee[1],x=se,(W=(M=(T=se)[0])*(Z=T[3])-(j=T[2])*(z=T[1]))&&(x[0]=Z*(W=1/W),x[1]=-z*W,x[2]=-j*W,x[3]=M*W),d[0]=se[0],d[1]=se[1],d[4]=se[2],d[5]=se[3]}var x,T,M,z,j,Z,W;return h.Q(d,d,[1/s,1/s,1]),d}function ws(E,t,s,d){if(E){const x=h.N();if(!t){const{vecSouth:T,vecEast:M}=ia(s);x[0]=M[0],x[1]=M[1],x[4]=T[0],x[5]=T[1]}return h.Q(x,x,[d,d,1]),x}return s.pixelsToClipSpaceMatrix}function ia(E){const t=Math.cos(E.rollInRadians),s=Math.sin(E.rollInRadians),d=Math.cos(E.pitchInRadians),x=Math.cos(E.bearingInRadians),T=Math.sin(E.bearingInRadians),M=h.aC();M[0]=-x*d*s-T*t,M[1]=-T*d*s+x*t;const z=h.aD(M);z<1e-9?h.aE(M):h.aF(M,M,1/z);const j=h.aC();j[0]=x*d*t-T*s,j[1]=T*d*t+x*s;const Z=h.aD(j);return Z<1e-9?h.aE(j):h.aF(j,j,1/Z),{vecEast:j,vecSouth:M}}function ai(E,t,s,d){let x;d?(x=[E,t,d(E,t),1],h.aH(x,x,s)):(x=[E,t,0,1],Ds(x,x,s));const T=x[3];return{point:new h.P(x[0]/T,x[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}function Rs(E,t){return .5+E/t*.5}function Sr(E,t){return E.x>=-t[0]&&E.x<=t[0]&&E.y>=-t[1]&&E.y<=t[1]}function ji(E,t,s,d,x,T,M,z,j,Z,W,ee,J){const se=s?E.textSizeData:E.iconSizeData,pe=h.ay(se,t.transform.zoom),Ae=[256/t.width*2+1,256/t.height*2+1],Ne=s?E.text.dynamicLayoutVertexArray:E.icon.dynamicLayoutVertexArray;Ne.clear();const Re=E.lineVertexArray,Be=s?E.text.placedSymbolArray:E.icon.placedSymbolArray,We=t.transform.width/t.transform.height;let Le=!1;for(let Ze=0;Ze<Be.length;Ze++){const et=Be.get(Ze);if(et.hidden||et.writingMode===h.az.vertical&&!Le){fa(et.numGlyphs,Ne);continue}Le=!1;const Ve=new h.P(et.anchorX,et.anchorY),ut={getElevation:J,pitchedLabelPlaneMatrix:d,lineVertexArray:Re,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Ve,unwrappedTileID:j,width:Z,height:W,translation:ee},Mt=Yo(et.anchorX,et.anchorY,ut);if(!Sr(Mt.point,Ae)){fa(et.numGlyphs,Ne);continue}const Et=Rs(t.transform.cameraToCenterDistance,Mt.signedDistanceFromCamera),At=h.aA(se,pe,et),Ct=T?At*t.transform.getPitchedTextCorrection(et.anchorX,et.anchorY,j)/Et:At*Et,dn=dr({projectionContext:ut,pitchedLabelPlaneMatrixInverse:x,symbol:et,fontSize:Ct,flip:!1,keepUpright:M,glyphOffsetArray:E.glyphOffsetArray,dynamicLayoutVertexArray:Ne,aspectRatio:We,rotateToLine:z});Le=dn.useVertical,(dn.notEnoughRoom||Le||dn.needsFlipping&&dr({projectionContext:ut,pitchedLabelPlaneMatrixInverse:x,symbol:et,fontSize:Ct,flip:!0,keepUpright:M,glyphOffsetArray:E.glyphOffsetArray,dynamicLayoutVertexArray:Ne,aspectRatio:We,rotateToLine:z}).notEnoughRoom)&&fa(et.numGlyphs,Ne)}s?E.text.dynamicLayoutVertexBuffer.updateData(Ne):E.icon.dynamicLayoutVertexBuffer.updateData(Ne)}function da(E,t,s,d,x,T,M,z){const j=T.glyphStartIndex+T.numGlyphs,Z=T.lineStartIndex,W=T.lineStartIndex+T.lineLength,ee=t.getoffsetX(T.glyphStartIndex),J=t.getoffsetX(j-1),se=yi(E*ee,s,d,x,T.segment,Z,W,z,M);if(!se)return null;const pe=yi(E*J,s,d,x,T.segment,Z,W,z,M);return pe?z.projectionCache.anyProjectionOccluded?null:{first:se,last:pe}:null}function us(E,t,s,d){return E===h.az.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*d?{useVertical:!0}:(E===h.az.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function dr(E){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:s,symbol:d,fontSize:x,flip:T,keepUpright:M,glyphOffsetArray:z,dynamicLayoutVertexArray:j,aspectRatio:Z,rotateToLine:W}=E,ee=x/24,J=d.lineOffsetX*ee,se=d.lineOffsetY*ee;let pe;if(d.numGlyphs>1){const Ae=d.glyphStartIndex+d.numGlyphs,Ne=d.lineStartIndex,Re=d.lineStartIndex+d.lineLength,Be=da(ee,z,J,se,T,d,W,t);if(!Be)return{notEnoughRoom:!0};const We=hs(Be.first.point.x,Be.first.point.y,t,s),Le=hs(Be.last.point.x,Be.last.point.y,t,s);if(M&&!T){const Ze=us(d.writingMode,We,Le,Z);if(Ze)return Ze}pe=[Be.first];for(let Ze=d.glyphStartIndex+1;Ze<Ae-1;Ze++){const et=yi(ee*z.getoffsetX(Ze),J,se,T,d.segment,Ne,Re,t,W);if(!et)return{notEnoughRoom:!0};pe.push(et)}pe.push(Be.last)}else{if(M&&!T){const Ne=Hn(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Re=d.lineStartIndex+d.segment+1,Be=new h.P(t.lineVertexArray.getx(Re),t.lineVertexArray.gety(Re)),We=Hn(Be.x,Be.y,t),Le=We.signedDistanceFromCamera>0?We.point:an(t.tileAnchorPoint,Be,Ne,1,t),Ze=hs(Ne.x,Ne.y,t,s),et=hs(Le.x,Le.y,t,s),Ve=us(d.writingMode,Ze,et,Z);if(Ve)return Ve}const Ae=yi(ee*z.getoffsetX(d.glyphStartIndex),J,se,T,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,t,W);if(!Ae||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};pe=[Ae]}for(const Ae of pe)h.aG(j,Ae.point,Ae.angle);return{}}function an(E,t,s,d,x){const T=E.add(E.sub(t)._unit()),M=Hn(T.x,T.y,x).point,z=s.sub(M);return s.add(z._mult(d/z.mag()))}function Es(E,t,s){const d=t.projectionCache;if(d.projections[E])return d.projections[E];const x=new h.P(t.lineVertexArray.getx(E),t.lineVertexArray.gety(E)),T=Hn(x.x,x.y,t);if(T.signedDistanceFromCamera>0)return d.projections[E]=T.point,d.anyProjectionOccluded=d.anyProjectionOccluded||T.isOccluded,T.point;const M=E-s.direction;return an(s.distanceFromAnchor===0?t.tileAnchorPoint:new h.P(t.lineVertexArray.getx(M),t.lineVertexArray.gety(M)),x,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function Hn(E,t,s){const d=E+s.translation[0],x=t+s.translation[1];let T;return s.pitchWithMap?(T=ai(d,x,s.pitchedLabelPlaneMatrix,s.getElevation),T.isOccluded=!1):(T=s.transform.projectTileCoordinates(d,x,s.unwrappedTileID,s.getElevation),T.point.x=(.5*T.point.x+.5)*s.width,T.point.y=(.5*-T.point.y+.5)*s.height),T}function hs(E,t,s,d){if(s.pitchWithMap){const x=[E,t,0,1];return h.aH(x,x,d),s.transform.projectTileCoordinates(x[0]/x[3],x[1]/x[3],s.unwrappedTileID,s.getElevation).point}return{x:E/s.width*2-1,y:1-t/s.height*2}}function Yo(E,t,s){return s.transform.projectTileCoordinates(E,t,s.unwrappedTileID,s.getElevation)}function Pi(E,t,s){return E._unit()._perp()._mult(t*s)}function Ai(E,t,s,d,x,T,M,z,j){if(z.projectionCache.offsets[E])return z.projectionCache.offsets[E];const Z=s.add(t);if(E+j.direction<d||E+j.direction>=x)return z.projectionCache.offsets[E]=Z,Z;const W=Es(E+j.direction,z,j),ee=Pi(W.sub(s),M,j.direction),J=s.add(ee),se=W.add(ee);return z.projectionCache.offsets[E]=h.aI(T,Z,J,se)||Z,z.projectionCache.offsets[E]}function yi(E,t,s,d,x,T,M,z,j){const Z=d?E-t:E+t;let W=Z>0?1:-1,ee=0;d&&(W*=-1,ee=Math.PI),W<0&&(ee+=Math.PI);let J,se=W>0?T+x:T+x+1;z.projectionCache.cachedAnchorPoint?J=z.projectionCache.cachedAnchorPoint:(J=Hn(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=J);let pe,Ae,Ne=J,Re=J,Be=0,We=0;const Le=Math.abs(Z),Ze=[];let et;for(;Be+We<=Le;){if(se+=W,se<T||se>=M)return null;Be+=We,Re=Ne,Ae=pe;const Mt={absOffsetX:Le,direction:W,distanceFromAnchor:Be,previousVertex:Re};if(Ne=Es(se,z,Mt),s===0)Ze.push(Re),et=Ne.sub(Re);else{let Et;const At=Ne.sub(Re);Et=At.mag()===0?Pi(Es(se+W,z,Mt).sub(Ne),s,W):Pi(At,s,W),Ae||(Ae=Re.add(Et)),pe=Ai(se,Et,Ne,T,M,Ae,s,z,Mt),Ze.push(Ae),et=pe.sub(Ae)}We=et.mag()}const Ve=et._mult((Le-Be)/We)._add(Ae||Re),ut=ee+Math.atan2(Ne.y-Re.y,Ne.x-Re.x);return Ze.push(Ve),{point:Ve,angle:j?ut:0,path:Ze}}const fo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fa(E,t){for(let s=0;s<E;s++){const d=t.length;t.resize(d+4),t.float32.set(fo,3*d)}}function Ds(E,t,s){const d=t[0],x=t[1];return E[0]=s[0]*d+s[4]*x+s[12],E[1]=s[1]*d+s[5]*x+s[13],E[3]=s[3]*d+s[7]*x+s[15],E}const Jn=100;class Ra{constructor(t,s=new ni(t.width+200,t.height+200,25),d=new ni(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=d,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Jn,this.screenBottomBoundary=t.height+Jn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,d,x,T,M,z,j,Z,W,ee,J){const se=this.projectAndGetPerspectiveRatio(t.anchorPointX+j[0],t.anchorPointY+j[1],T,W,J),pe=d*se.perspectiveRatio;let Ae;if(M||z)Ae=this._projectCollisionBox(t,pe,x,T,M,z,j,se,W,ee,J);else{const et=se.x+(ee?ee.x*pe:0),Ve=se.y+(ee?ee.y*pe:0);Ae={allPointsOccluded:!1,box:[et+t.x1*pe,Ve+t.y1*pe,et+t.x2*pe,Ve+t.y2*pe]}}const[Ne,Re,Be,We]=Ae.box,Le=M?Ae.allPointsOccluded:se.isOccluded;let Ze=Le;return Ze||(Ze=se.perspectiveRatio<this.perspectiveRatioCutoff),Ze||(Ze=!this.isInsideGrid(Ne,Re,Be,We)),Ze||s!=="always"&&this.grid.hitTest(Ne,Re,Be,We,s,Z)?{box:[Ne,Re,Be,We],placeable:!1,offscreen:!1,occluded:Le}:{box:[Ne,Re,Be,We],placeable:!0,offscreen:this.isOffscreen(Ne,Re,Be,We),occluded:Le}}placeCollisionCircles(t,s,d,x,T,M,z,j,Z,W,ee,J,se,pe){const Ae=[],Ne=new h.P(s.anchorX,s.anchorY),Re=this.getPerspectiveRatio(Ne.x,Ne.y,M,pe),Be=(Z?T*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,M)/Re:T*Re)/h.aM,We={getElevation:pe,pitchedLabelPlaneMatrix:z,lineVertexArray:d,pitchWithMap:Z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Ne,unwrappedTileID:M,width:this.transform.width,height:this.transform.height,translation:se},Le=da(Be,x,s.lineOffsetX*Be,s.lineOffsetY*Be,!1,s,!1,We);let Ze=!1,et=!1,Ve=!0;if(Le){const ut=.5*ee*Re+J,Mt=new h.P(-100,-100),Et=new h.P(this.screenRightBoundary,this.screenBottomBoundary),At=new jt,Ct=Le.first,dn=Le.last;let mn=[];for(let mi=Ct.path.length-1;mi>=1;mi--)mn.push(Ct.path[mi]);for(let mi=1;mi<dn.path.length;mi++)mn.push(dn.path[mi]);const Qt=2.5*ut;if(Z){const mi=this.projectPathToScreenSpace(mn,We);mn=mi.some((ar=>ar.signedDistanceFromCamera<=0))?[]:mi.map((ar=>ar.point))}let En=[];if(mn.length>0){const mi=mn[0].clone(),ar=mn[0].clone();for(let Ir=1;Ir<mn.length;Ir++)mi.x=Math.min(mi.x,mn[Ir].x),mi.y=Math.min(mi.y,mn[Ir].y),ar.x=Math.max(ar.x,mn[Ir].x),ar.y=Math.max(ar.y,mn[Ir].y);En=mi.x>=Mt.x&&ar.x<=Et.x&&mi.y>=Mt.y&&ar.y<=Et.y?[mn]:ar.x<Mt.x||mi.x>Et.x||ar.y<Mt.y||mi.y>Et.y?[]:h.aJ([mn],Mt.x,Mt.y,Et.x,Et.y)}for(const mi of En){At.reset(mi,.25*ut);let ar=0;ar=At.length<=.5*ut?1:Math.ceil(At.paddedLength/Qt)+1;for(let Ir=0;Ir<ar;Ir++){const br=Ir/Math.max(ar-1,1),Fr=At.lerp(br),fr=Fr.x+Jn,Yr=Fr.y+Jn;Ae.push(fr,Yr,ut,0);const jr=fr-ut,Hs=Yr-ut,es=fr+ut,ts=Yr+ut;if(Ve=Ve&&this.isOffscreen(jr,Hs,es,ts),et=et||this.isInsideGrid(jr,Hs,es,ts),t!=="always"&&this.grid.hitTestCircle(fr,Yr,ut,t,W)&&(Ze=!0,!j))return{circles:[],offscreen:!1,collisionDetected:Ze}}}}return{circles:!j&&Ze||!et||Re<this.perspectiveRatioCutoff?[]:Ae,offscreen:Ve,collisionDetected:Ze}}projectPathToScreenSpace(t,s){const d=(function(x,T){const M=h.N();return h.aB(M,T.pitchedLabelPlaneMatrix),x.map((z=>{const j=ai(z.x,z.y,M,T.getElevation),Z=T.transform.projectTileCoordinates(j.point.x,j.point.y,T.unwrappedTileID,T.getElevation);return Z.point.x=(.5*Z.point.x+.5)*T.width,Z.point.y=(.5*-Z.point.y+.5)*T.height,Z}))})(t,s);return(function(x){let T=0,M=0,z=0,j=0;for(let Z=0;Z<x.length;Z++)x[Z].isOccluded?(z=Z+1,j=0):(j++,j>M&&(M=j,T=z));return x.slice(T,T+M)})(d)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],d=new h.aa;for(const ee of t){const J=new h.P(ee.x+Jn,ee.y+Jn);d.extend(J),s.push(J)}const{minX:x,minY:T,maxX:M,maxY:z}=d,j=this.grid.query(x,T,M,z).concat(this.ignoredGrid.query(x,T,M,z)),Z={},W={};for(const ee of j){const J=ee.key;if(Z[J.bucketInstanceId]===void 0&&(Z[J.bucketInstanceId]={}),Z[J.bucketInstanceId][J.featureIndex])continue;const se=[new h.P(ee.x1,ee.y1),new h.P(ee.x2,ee.y1),new h.P(ee.x2,ee.y2),new h.P(ee.x1,ee.y2)];h.aK(s,se)&&(Z[J.bucketInstanceId][J.featureIndex]=!0,W[J.bucketInstanceId]===void 0&&(W[J.bucketInstanceId]=[]),W[J.bucketInstanceId].push(J.featureIndex))}return W}insertCollisionBox(t,s,d,x,T,M){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:T,collisionGroupID:M,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,d,x,T,M){const z=d?this.ignoredGrid:this.grid,j={bucketInstanceId:x,featureIndex:T,collisionGroupID:M,overlapMode:s};for(let Z=0;Z<t.length;Z+=4)z.insertCircle(j,t[Z],t[Z+1],t[Z+2])}projectAndGetPerspectiveRatio(t,s,d,x,T){if(T){let M;x?(M=[t,s,x(t,s),1],h.aH(M,M,T)):(M=[t,s,0,1],Ds(M,M,T));const z=M[3];return{x:(M[0]/z+1)/2*this.transform.width+Jn,y:(-M[1]/z+1)/2*this.transform.height+Jn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/z*.5,isOccluded:!1,signedDistanceFromCamera:z}}{const M=this.transform.projectTileCoordinates(t,s,d,x);return{x:(M.point.x+1)/2*this.transform.width+Jn,y:(1-M.point.y)/2*this.transform.height+Jn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M.signedDistanceFromCamera*.5,isOccluded:M.isOccluded,signedDistanceFromCamera:M.signedDistanceFromCamera}}}getPerspectiveRatio(t,s,d,x){const T=this.transform.projectTileCoordinates(t,s,d,x);return .5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5}isOffscreen(t,s,d,x){return d<Jn||t>=this.screenRightBoundary||x<Jn||s>this.screenBottomBoundary}isInsideGrid(t,s,d,x){return d>=0&&t<this.gridRightBoundary&&x>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=h.ar([]);return h.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,d,x,T,M,z,j,Z,W,ee){let J=1,se=0,pe=0,Ae=1;const Ne=t.anchorPointX+z[0],Re=t.anchorPointY+z[1];if(M&&!T){const mn=this.projectAndGetPerspectiveRatio(Ne+1,Re,x,Z,ee),Qt=mn.x-j.x,En=Math.atan((mn.y-j.y)/Qt)+(Qt<0?Math.PI:0),mi=Math.sin(En),ar=Math.cos(En);J=ar,se=mi,pe=-mi,Ae=ar}else if(!M&&T){const mn=ia(this.transform);J=mn.vecEast[0],se=mn.vecEast[1],pe=mn.vecSouth[0],Ae=mn.vecSouth[1]}let Be=j.x,We=j.y,Le=s;T&&(Be=Ne,We=Re,Le=Math.pow(2,-(this.transform.zoom-d.overscaledZ)),Le*=this.transform.getPitchedTextCorrection(Ne,Re,x),W||(Le*=h.an(.5+j.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),W&&(Be+=J*W.x*Le+pe*W.y*Le,We+=se*W.x*Le+Ae*W.y*Le);const Ze=t.x1*Le,et=t.x2*Le,Ve=(Ze+et)/2,ut=t.y1*Le,Mt=t.y2*Le,Et=(ut+Mt)/2,At=[{offsetX:Ze,offsetY:ut},{offsetX:Ve,offsetY:ut},{offsetX:et,offsetY:ut},{offsetX:et,offsetY:Et},{offsetX:et,offsetY:Mt},{offsetX:Ve,offsetY:Mt},{offsetX:Ze,offsetY:Mt},{offsetX:Ze,offsetY:Et}];let Ct=[];for(const{offsetX:mn,offsetY:Qt}of At)Ct.push(new h.P(Be+J*mn+pe*Qt,We+se*mn+Ae*Qt));let dn=!1;if(T){const mn=Ct.map((Qt=>this.projectAndGetPerspectiveRatio(Qt.x,Qt.y,x,Z,ee)));dn=mn.some((Qt=>!Qt.isOccluded)),Ct=mn.map((Qt=>new h.P(Qt.x,Qt.y)))}else dn=!0;return{box:h.aL(Ct),allPointsOccluded:!dn}}}class uu{constructor(t,s,d,x){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):x&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class or{constructor(t,s,d,x,T){this.text=new uu(t?t.text:null,s,d,T),this.icon=new uu(t?t.icon:null,s,x,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vt{constructor(t,s,d){this.text=t,this.icon=s,this.skipFade=d}}class tn{constructor(t,s,d,x,T){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=d,this.bucketIndex=x,this.tileID=T}}class xn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:d=>d.collisionGroupID===s}}return this.collisionGroups[t]}}function on(E,t,s,d,x){const{horizontalAlign:T,verticalAlign:M}=h.aS(E);return new h.P(-(T-.5)*t+d[0]*x,-(M-.5)*s+d[1]*x)}class pn{constructor(t,s,d,x,T){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Ra(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new xn(x),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(d,x)=>s.getElevation(t,d,x):null}getBucketParts(t,s,d,x){const T=d.getBucket(s),M=d.latestFeatureIndex;if(!T||!M||s.id!==T.layerIds[0])return;const z=d.collisionBoxArray,j=T.layers[0].layout,Z=T.layers[0].paint,W=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),ee=d.tileSize/h.a5,J=d.tileID.toUnwrapped(),se=j.get("text-rotation-alignment")==="map",pe=h.aN(d,1,this.transform.zoom),Ae=h.aO(this.collisionIndex.transform,d,Z.get("text-translate"),Z.get("text-translate-anchor")),Ne=h.aO(this.collisionIndex.transform,d,Z.get("icon-translate"),Z.get("icon-translate-anchor")),Re=vs(se,this.transform,pe);this.retainedQueryData[T.bucketInstanceId]=new tn(T.bucketInstanceId,M,T.sourceLayerIndex,T.index,d.tileID);const Be={bucket:T,layout:j,translationText:Ae,translationIcon:Ne,unwrappedTileID:J,pitchedLabelPlaneMatrix:Re,scale:W,textPixelRatio:ee,holdingForFade:d.holdingForSymbolFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:h.ay(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(x)for(const We of T.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ze,symbolInstanceEnd:et}=We;t.push({sortKey:Le,symbolInstanceStart:Ze,symbolInstanceEnd:et,parameters:Be})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(t,s,d,x,T,M,z,j,Z,W,ee,J,se,pe,Ae,Ne,Re,Be,We,Le){const Ze=h.aP[t.textAnchor],et=[t.textOffset0,t.textOffset1],Ve=on(Ze,d,x,et,T),ut=this.collisionIndex.placeCollisionBox(s,J,j,Z,W,z,M,Ne,ee.predicate,We,Ve,Le);if((!Be||this.collisionIndex.placeCollisionBox(Be,J,j,Z,W,z,M,Re,ee.predicate,We,Ve,Le).placeable)&&ut.placeable){let Mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Mt=this.prevPlacement.variableOffsets[se.crossTileID].anchor),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[se.crossTileID]={textOffset:et,width:d,height:x,anchor:Ze,textBoxScale:T,prevAnchor:Mt},this.markUsedJustification(pe,Ze,se,Ae),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Ae,se),this.placedOrientations[se.crossTileID]=Ae),{shift:Ve,placedGlyphBoxes:ut}}}placeLayerBucketPart(t,s,d){const{bucket:x,layout:T,translationText:M,translationIcon:z,unwrappedTileID:j,pitchedLabelPlaneMatrix:Z,textPixelRatio:W,holdingForFade:ee,collisionBoxArray:J,partiallyEvaluatedTextSize:se,collisionGroup:pe}=t.parameters,Ae=T.get("text-optional"),Ne=T.get("icon-optional"),Re=h.aQ(T,"text-overlap","text-allow-overlap"),Be=Re==="always",We=h.aQ(T,"icon-overlap","icon-allow-overlap"),Le=We==="always",Ze=T.get("text-rotation-alignment")==="map",et=T.get("text-pitch-alignment")==="map",Ve=T.get("icon-text-fit")!=="none",ut=T.get("symbol-z-order")==="viewport-y",Mt=Be&&(Le||!x.hasIconData()||Ne),Et=Le&&(Be||!x.hasTextData()||Ae);!x.collisionArrays&&J&&x.deserializeCollisionBoxes(J);const At=this.retainedQueryData[x.bucketInstanceId].tileID,Ct=this._getTerrainElevationFunc(At),dn=this.transform.getFastPathSimpleProjectionMatrix(At),mn=(Qt,En,mi)=>{var ar,Ir;if(s[Qt.crossTileID])return;if(ee)return void(this.placements[Qt.crossTileID]=new vt(!1,!1,!1));let br=!1,Fr=!1,fr=!0,Yr=null,jr={box:null,placeable:!1,offscreen:null,occluded:!1},Hs={placeable:!1},es=null,ts=null,qs=null,wl=0,El=0,jo=0;En.textFeatureIndex?wl=En.textFeatureIndex:Qt.useRuntimeCollisionCircles&&(wl=Qt.featureIndex),En.verticalTextFeatureIndex&&(El=En.verticalTextFeatureIndex);const Ba=En.textBox;if(Ba){const Fa=ur=>{let vr=h.az.horizontal;if(x.allowVerticalPlacement&&!ur&&this.prevPlacement){const ms=this.prevPlacement.placedOrientations[Qt.crossTileID];ms&&(this.placedOrientations[Qt.crossTileID]=ms,vr=ms,this.markUsedOrientation(x,vr,Qt))}return vr},so=(ur,vr)=>{if(x.allowVerticalPlacement&&Qt.numVerticalGlyphVertices>0&&En.verticalTextBox){for(const ms of x.writingModes)if(ms===h.az.vertical?(jr=vr(),Hs=jr):jr=ur(),jr&&jr.placeable)break}else jr=ur()},wo=Qt.textAnchorOffsetStartIndex,Eo=Qt.textAnchorOffsetEndIndex;if(Eo===wo){const ur=(vr,ms)=>{const Cs=this.collisionIndex.placeCollisionBox(vr,Re,W,At,j,et,Ze,M,pe.predicate,Ct,void 0,dn);return Cs&&Cs.placeable&&(this.markUsedOrientation(x,ms,Qt),this.placedOrientations[Qt.crossTileID]=ms),Cs};so((()=>ur(Ba,h.az.horizontal)),(()=>{const vr=En.verticalTextBox;return x.allowVerticalPlacement&&Qt.numVerticalGlyphVertices>0&&vr?ur(vr,h.az.vertical):{box:null,offscreen:null}})),Fa(jr&&jr.placeable)}else{let ur=h.aP[(Ir=(ar=this.prevPlacement)===null||ar===void 0?void 0:ar.variableOffsets[Qt.crossTileID])===null||Ir===void 0?void 0:Ir.anchor];const vr=(Cs,nd,id)=>{const yc=Cs.x2-Cs.x1,ip=Cs.y2-Cs.y1,xc=Qt.textBoxScale,rd=Ve&&We==="never"?nd:null;let Wl=null,Yl=Re==="never"?1:2,Vo="never";ur&&Yl++;for(let sd=0;sd<Yl;sd++){for(let ph=wo;ph<Eo;ph++){const mh=x.textAnchorOffsets.get(ph);if(ur&&mh.textAnchor!==ur)continue;const gh=this.attemptAnchorPlacement(mh,Cs,yc,ip,xc,Ze,et,W,At,j,pe,Vo,Qt,x,id,M,z,rd,Ct);if(gh&&(Wl=gh.placedGlyphBoxes,Wl&&Wl.placeable))return br=!0,Yr=gh.shift,Wl}ur?ur=null:Vo=Re}return d&&!Wl&&(Wl={box:this.collisionIndex.placeCollisionBox(Ba,"always",W,At,j,et,Ze,M,pe.predicate,Ct,void 0,dn).box,offscreen:!1,placeable:!1,occluded:!1}),Wl};so((()=>vr(Ba,En.iconBox,h.az.horizontal)),(()=>{const Cs=En.verticalTextBox;return x.allowVerticalPlacement&&(!jr||!jr.placeable)&&Qt.numVerticalGlyphVertices>0&&Cs?vr(Cs,En.verticalIconBox,h.az.vertical):{box:null,occluded:!0,offscreen:null}})),jr&&(br=jr.placeable,fr=jr.offscreen);const ms=Fa(jr&&jr.placeable);if(!br&&this.prevPlacement){const Cs=this.prevPlacement.variableOffsets[Qt.crossTileID];Cs&&(this.variableOffsets[Qt.crossTileID]=Cs,this.markUsedJustification(x,Cs.anchor,Qt,ms))}}}if(es=jr,br=es&&es.placeable,fr=es&&es.offscreen,Qt.useRuntimeCollisionCircles&&Qt.centerJustifiedTextSymbolIndex>=0){const Fa=x.text.placedSymbolArray.get(Qt.centerJustifiedTextSymbolIndex),so=h.aA(x.textSizeData,se,Fa),wo=T.get("text-padding");ts=this.collisionIndex.placeCollisionCircles(Re,Fa,x.lineVertexArray,x.glyphOffsetArray,so,j,Z,d,et,pe.predicate,Qt.collisionCircleDiameter,wo,M,Ct),ts.circles.length&&ts.collisionDetected&&!d&&h.w("Collisions detected, but collision boxes are not shown"),br=Be||ts.circles.length>0&&!ts.collisionDetected,fr=fr&&ts.offscreen}if(En.iconFeatureIndex&&(jo=En.iconFeatureIndex),En.iconBox){const Fa=so=>this.collisionIndex.placeCollisionBox(so,We,W,At,j,et,Ze,z,pe.predicate,Ct,Ve&&Yr?Yr:void 0,dn);Hs&&Hs.placeable&&En.verticalIconBox?(qs=Fa(En.verticalIconBox),Fr=qs.placeable):(qs=Fa(En.iconBox),Fr=qs.placeable),fr=fr&&qs.offscreen}const Hc=Ae||Qt.numHorizontalGlyphVertices===0&&Qt.numVerticalGlyphVertices===0,Su=Ne||Qt.numIconVertices===0;Hc||Su?Su?Hc||(Fr=Fr&&br):br=Fr&&br:Fr=br=Fr&&br;const Uo=Fr&&qs.placeable;if(br&&es.placeable&&this.collisionIndex.insertCollisionBox(es.box,Re,T.get("text-ignore-placement"),x.bucketInstanceId,Hs&&Hs.placeable&&El?El:wl,pe.ID),Uo&&this.collisionIndex.insertCollisionBox(qs.box,We,T.get("icon-ignore-placement"),x.bucketInstanceId,jo,pe.ID),ts&&br&&this.collisionIndex.insertCollisionCircles(ts.circles,Re,T.get("text-ignore-placement"),x.bucketInstanceId,wl,pe.ID),d&&this.storeCollisionData(x.bucketInstanceId,mi,En,es,qs,ts),Qt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Qt.crossTileID]=new vt((br||Mt)&&!es?.occluded,(Fr||Et)&&!qs?.occluded,fr||x.justReloaded),s[Qt.crossTileID]=!0};if(ut){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Qt=x.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let En=Qt.length-1;En>=0;--En){const mi=Qt[En];mn(x.symbolInstances.get(mi),x.collisionArrays[mi],mi)}}else for(let Qt=t.symbolInstanceStart;Qt<t.symbolInstanceEnd;Qt++)mn(x.symbolInstances.get(Qt),x.collisionArrays[Qt],Qt);x.justReloaded=!1}storeCollisionData(t,s,d,x,T,M){if(d.textBox||d.iconBox){let z,j;this.collisionBoxArrays.has(t)?z=this.collisionBoxArrays.get(t):(z=new Map,this.collisionBoxArrays.set(t,z)),z.has(s)?j=z.get(s):(j={text:null,icon:null},z.set(s,j)),d.textBox&&(j.text=x.box),d.iconBox&&(j.icon=T.box)}if(M){let z=this.collisionCircleArrays[t];z===void 0&&(z=this.collisionCircleArrays[t]=[]);for(let j=0;j<M.circles.length;j+=4)z.push(M.circles[j+0]-Jn),z.push(M.circles[j+1]-Jn),z.push(M.circles[j+2]),z.push(M.collisionDetected?1:0)}}markUsedJustification(t,s,d,x){let T;T=x===h.az.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[h.aR(s)];const M=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const z of M)z>=0&&(t.text.placedSymbolArray.get(z).crossTileID=T>=0&&z!==T?0:d.crossTileID)}markUsedOrientation(t,s,d){const x=s===h.az.horizontal||s===h.az.horizontalOnly?s:0,T=s===h.az.vertical?s:0,M=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const z of M)t.text.placedSymbolArray.get(z).placedOrientation=x;d.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let d=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const x=s?s.symbolFadeChange(t):1,T=s?s.opacities:{},M=s?s.variableOffsets:{},z=s?s.placedOrientations:{};for(const j in this.placements){const Z=this.placements[j],W=T[j];W?(this.opacities[j]=new or(W,x,Z.text,Z.icon),d=d||Z.text!==W.text.placed||Z.icon!==W.icon.placed):(this.opacities[j]=new or(null,x,Z.text,Z.icon,Z.skipFade),d=d||Z.text||Z.icon)}for(const j in T){const Z=T[j];if(!this.opacities[j]){const W=new or(Z,x,!1,!1);W.isHidden()||(this.opacities[j]=W,d=d||Z.text.placed||Z.icon.placed)}}for(const j in M)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=M[j]);for(const j in z)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=z[j]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const d={};for(const x of s){const T=x.getBucket(t);T&&x.latestFeatureIndex&&t.id===T.layerIds[0]&&this.updateBucketOpacities(T,x.tileID,d,x.collisionBoxArray)}}updateBucketOpacities(t,s,d,x){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const T=t.layers[0],M=T.layout,z=new or(null,0,!1,!1,!0),j=M.get("text-allow-overlap"),Z=M.get("icon-allow-overlap"),W=T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ee=M.get("text-rotation-alignment")==="map",J=M.get("text-pitch-alignment")==="map",se=M.get("icon-text-fit")!=="none",pe=new or(null,0,j&&(Z||!t.hasIconData()||M.get("icon-optional")),Z&&(j||!t.hasTextData()||M.get("text-optional")),!0);!t.collisionArrays&&x&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(x);const Ae=(Re,Be,We)=>{for(let Le=0;Le<Be/4;Le++)Re.opacityVertexArray.emplaceBack(We);Re.hasVisibleVertices=Re.hasVisibleVertices||We!==Ui},Ne=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Re=0;Re<t.symbolInstances.length;Re++){const Be=t.symbolInstances.get(Re),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:Le,crossTileID:Ze}=Be;let et=this.opacities[Ze];d[Ze]?et=z:et||(et=pe,this.opacities[Ze]=et),d[Ze]=!0;const Ve=Be.numIconVertices>0,ut=this.placedOrientations[Be.crossTileID],Mt=ut===h.az.vertical,Et=ut===h.az.horizontal||ut===h.az.horizontalOnly;if(We>0||Le>0){const Ct=Xn(et.text);Ae(t.text,We,Mt?Ui:Ct),Ae(t.text,Le,Et?Ui:Ct);const dn=et.text.isHidden();[Be.rightJustifiedTextSymbolIndex,Be.centerJustifiedTextSymbolIndex,Be.leftJustifiedTextSymbolIndex].forEach((En=>{En>=0&&(t.text.placedSymbolArray.get(En).hidden=dn||Mt?1:0)})),Be.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Be.verticalPlacedTextSymbolIndex).hidden=dn||Et?1:0);const mn=this.variableOffsets[Be.crossTileID];mn&&this.markUsedJustification(t,mn.anchor,Be,ut);const Qt=this.placedOrientations[Be.crossTileID];Qt&&(this.markUsedJustification(t,"left",Be,Qt),this.markUsedOrientation(t,Qt,Be))}if(Ve){const Ct=Xn(et.icon),dn=!(se&&Be.verticalPlacedIconSymbolIndex&&Mt);Be.placedIconSymbolIndex>=0&&(Ae(t.icon,Be.numIconVertices,dn?Ct:Ui),t.icon.placedSymbolArray.get(Be.placedIconSymbolIndex).hidden=et.icon.isHidden()),Be.verticalPlacedIconSymbolIndex>=0&&(Ae(t.icon,Be.numVerticalIconVertices,dn?Ui:Ct),t.icon.placedSymbolArray.get(Be.verticalPlacedIconSymbolIndex).hidden=et.icon.isHidden())}const At=Ne&&Ne.has(Re)?Ne.get(Re):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ct=t.collisionArrays[Re];if(Ct){let dn=new h.P(0,0);if(Ct.textBox||Ct.verticalTextBox){let mn=!0;if(W){const Qt=this.variableOffsets[Ze];Qt?(dn=on(Qt.anchor,Qt.width,Qt.height,Qt.textOffset,Qt.textBoxScale),ee&&dn._rotate(J?-this.transform.bearingInRadians:this.transform.bearingInRadians)):mn=!1}if(Ct.textBox||Ct.verticalTextBox){let Qt;Ct.textBox&&(Qt=Mt),Ct.verticalTextBox&&(Qt=Et),ft(t.textCollisionBox.collisionVertexArray,et.text.placed,!mn||Qt,At.text,dn.x,dn.y)}}if(Ct.iconBox||Ct.verticalIconBox){const mn=!!(!Et&&Ct.verticalIconBox);let Qt;Ct.iconBox&&(Qt=mn),Ct.verticalIconBox&&(Qt=!mn),ft(t.iconCollisionBox.collisionVertexArray,et.icon.placed,Qt,At.icon,se?dn.x:0,se?dn.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const d=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function ft(E,t,s,d,x,T){d&&d.length!==0||(d=[0,0,0,0]);const M=d[0]-Jn,z=d[1]-Jn,j=d[2]-Jn,Z=d[3]-Jn;E.emplaceBack(t?1:0,s?1:0,x||0,T||0,M,z),E.emplaceBack(t?1:0,s?1:0,x||0,T||0,j,z),E.emplaceBack(t?1:0,s?1:0,x||0,T||0,j,Z),E.emplaceBack(t?1:0,s?1:0,x||0,T||0,M,Z)}const Te=Math.pow(2,25),zn=Math.pow(2,24),$i=Math.pow(2,17),Dr=Math.pow(2,16),Da=Math.pow(2,9),pa=Math.pow(2,8),Tr=Math.pow(2,1);function Xn(E){if(E.opacity===0&&!E.placed)return 0;if(E.opacity===1&&E.placed)return 4294967295;const t=E.placed?1:0,s=Math.floor(127*E.opacity);return s*Te+t*zn+s*$i+t*Dr+s*Da+t*pa+s*Tr+t}const Ui=0;class Bs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,d,x,T){const M=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(M,x,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(((z,j)=>z.sortKey-j.sortKey)));this._currentPartIndex<M.length;)if(s.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,T())return!0;return!1}}class ko{constructor(t,s,d,x,T,M,z,j){this.placement=new pn(t,s,M,z,j),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(t,s,d){const x=ye(),T=()=>!this._forceFullPlacement&&ye()-x>2;for(;this._currentPlacementIndex>=0;){const M=s[t[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=z)&&(!M.maxzoom||M.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Bs(M)),this._inProgressLayer.continuePlacement(d[M.source],this.placement,this._showCollisionBoxes,M,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ui=512/h.a5/2;class Fs{constructor(t,s,d){this.tileID=t,this.bucketInstanceId=d,this._symbolsByKey={};const x=new Map;for(let T=0;T<s.length;T++){const M=s.get(T),z=M.key,j=x.get(z);j?j.push(M):x.set(z,[M])}for(const[T,M]of x){const z={positions:M.map((j=>({x:Math.floor(j.anchorX*ui),y:Math.floor(j.anchorY*ui)}))),crossTileIDs:M.map((j=>j.crossTileID))};if(z.positions.length>128){const j=new h.aT(z.positions.length,16,Uint16Array);for(const{x:Z,y:W}of z.positions)j.add(Z,W);j.finish(),delete z.positions,z.index=j}this._symbolsByKey[T]=z}}getScaledCoordinates(t,s){const{x:d,y:x,z:T}=this.tileID.canonical,{x:M,y:z,z:j}=s.canonical,Z=ui/Math.pow(2,j-T),W=(z*h.a5+t.anchorY)*Z,ee=x*h.a5*ui;return{x:Math.floor((M*h.a5+t.anchorX)*Z-d*h.a5*ui),y:Math.floor(W-ee)}}findMatches(t,s,d){const x=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let T=0;T<t.length;T++){const M=t.get(T);if(M.crossTileID)continue;const z=this._symbolsByKey[M.key];if(!z)continue;const j=this.getScaledCoordinates(M,s);if(z.index){const Z=z.index.range(j.x-x,j.y-x,j.x+x,j.y+x).sort();for(const W of Z){const ee=z.crossTileIDs[W];if(!d[ee]){d[ee]=!0,M.crossTileID=ee;break}}}else if(z.positions)for(let Z=0;Z<z.positions.length;Z++){const W=z.positions[Z],ee=z.crossTileIDs[Z];if(Math.abs(W.x-j.x)<=x&&Math.abs(W.y-j.y)<=x&&!d[ee]){d[ee]=!0,M.crossTileID=ee;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class $o{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ko{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const d in this.indexes){const x=this.indexes[d],T={};for(const M in x){const z=x[M];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+s),T[z.tileID.key]=z}this.indexes[d]=T}this.lng=t}addBucket(t,s,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let T=0;T<s.symbolInstances.length;T++)s.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const x=this.usedCrossTileIDs[t.overscaledZ];for(const T in this.indexes){const M=this.indexes[T];if(Number(T)>t.overscaledZ)for(const z in M){const j=M[z];j.tileID.isChildOf(t)&&j.findMatches(s.symbolInstances,t,x)}else{const z=M[t.scaledTo(Number(T)).key];z&&z.findMatches(s.symbolInstances,t,x)}}for(let T=0;T<s.symbolInstances.length;T++){const M=s.symbolInstances.get(T);M.crossTileID||(M.crossTileID=d.generate(),x[M.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fs(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const d of s.getCrossTileIDsLists())for(const x of d)delete this.usedCrossTileIDs[t][x]}removeStaleBuckets(t){let s=!1;for(const d in this.indexes){const x=this.indexes[d];for(const T in x)t[x[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,x[T]),delete x[T],s=!0)}return s}}class wi{constructor(){this.layerIndexes={},this.crossTileIDs=new $o,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,d){let x=this.layerIndexes[t.id];x===void 0&&(x=this.layerIndexes[t.id]=new Ko);let T=!1;const M={};x.handleWrapJump(d);for(const z of s){const j=z.getBucket(t);j&&t.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(z.tileID,j,this.crossTileIDs)&&(T=!0),M[j.bucketInstanceId]=!0)}return x.removeStaleBuckets(M)&&(T=!0),T}pruneUnusedLayers(t){const s={};t.forEach((d=>{s[d]=!0}));for(const d in this.layerIndexes)s[d]||delete this.layerIndexes[d]}}var yr="void main() {fragColor=vec4(1.0);}";const Gi={prelude:hn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:hn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:hn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:hn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:hn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hn(yr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:hn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:hn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:hn(yr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:hn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:hn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:hn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:hn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:hn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:hn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:hn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:hn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:hn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:hn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:hn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function hn(E,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=t.match(/in ([\w]+) ([\w]+)/g),x=E.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=T?T.concat(x):x,z={};return{fragmentSource:E=E.replace(s,((j,Z,W,ee,J)=>(z[J]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
in ${W} ${ee} ${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = u_${J};
#endif
`))),vertexSource:t=t.replace(s,((j,Z,W,ee,J)=>{const se=ee==="float"?"vec2":"vec4",pe=J.match(/color/)?"color":se;return z[J]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${W} ${se} a_${J};
out ${W} ${ee} ${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${pe}(a_${J}, u_${J}_t);
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${W} ${se} a_${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = a_${J};
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = unpack_mix_${pe}(a_${J}, u_${J}_t);
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`})),staticAttributes:d,staticUniforms:M}}class lr{constructor(t,s,d){this.vertexBuffer=t,this.indexBuffer=s,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var oi=h.aU([{name:"a_pos",type:"Int16",components:2}]);const Mi="#define PROJECTION_MERCATOR",ra="mercator";class Kr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ra}get shaderDefine(){return Mi}get shaderPreludeCode(){return Gi.projectionMercator}get vertexShaderPreludeCode(){return Gi.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,s,d,x,T){if(this._cachedMesh)return this._cachedMesh;const M=new h.aW;M.emplaceBack(0,0),M.emplaceBack(h.a5,0),M.emplaceBack(0,h.a5),M.emplaceBack(h.a5,h.a5);const z=t.createVertexBuffer(M,oi.members),j=h.aX.simpleSegment(0,0,4,2),Z=new h.aY;Z.emplaceBack(1,0,2),Z.emplaceBack(1,2,3);const W=t.createIndexBuffer(Z);return this._cachedMesh=new lr(z,W,j),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ma{constructor(t=0,s=0,d=0,x=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(d)||d<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=d,this.right=x}interpolate(t,s,d){return s.top!=null&&t.top!=null&&(this.top=h.G.number(t.top,s.top,d)),s.bottom!=null&&t.bottom!=null&&(this.bottom=h.G.number(t.bottom,s.bottom,d)),s.left!=null&&t.left!=null&&(this.left=h.G.number(t.left,s.left,d)),s.right!=null&&t.right!=null&&(this.right=h.G.number(t.right,s.right,d)),this}getCenter(t,s){const d=h.an((this.left+t-this.right)/2,0,t),x=h.an((this.top+s-this.bottom)/2,0,s);return new h.P(d,x)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ma(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function js(E,t){if(!E.renderWorldCopies||E.lngRange)return;const s=t.lng-E.center.lng;t.lng+=s>180?-360:s<-180?360:0}function Nr(E){return Math.max(0,Math.floor(E))}class Na{constructor(t,s){var d;this.applyConstrain=(x,T)=>this._constrainOverride!==null?this._constrainOverride(x,T):this._callbacks.defaultConstrain(x,T),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=s?.renderWorldCopies===void 0||!!s?.renderWorldCopies,this._minZoom=s?.minZoom||0,this._maxZoom=s?.maxZoom||22,this._minPitch=s?.minPitch==null?0:s?.minPitch,this._maxPitch=s?.maxPitch==null?60:s?.maxPitch,this._constrainOverride=(d=s?.constrainOverride)!==null&&d!==void 0?d:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Nr(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ma,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,s,d){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Nr(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ma(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!d&&t.autoCalculateNearFarZ,s&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const s=h.W(t,-180,180)*Math.PI/180;var d,x,T,M,z,j,Z,W,ee;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=H(),d=this._rotationMatrix,T=-this._bearingInRadians,M=(x=this._rotationMatrix)[0],z=x[1],j=x[2],Z=x[3],W=Math.sin(T),ee=Math.cos(T),d[0]=M*ee+j*W,d[1]=z*ee+Z*W,d[2]=M*-W+j*ee,d[3]=z*-W+Z*ee)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const s=h.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const s=t/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aZ(this._fovInRadians)}setFov(t){t=h.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=h.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const s=this.applyConstrain(this._center,t).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=h.aq(s),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,s){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,d){this._unmodified=!1,this._edgeInsets.interpolate(t,s,d),this.constrainInternal(),this._calcMatrices()}resize(t,s,d=!0){this._width=t,this._height=s,d&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new si([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-h.ao,h.ao])}getCameraQueryGeometry(t,s){if(s.length===1)return[s[0],t];{const{minX:d,minY:x,maxX:T,maxY:M}=h.aa.fromPoints(s).extend(t);return[new h.P(d,x),new h.P(T,x),new h.P(T,M),new h.P(d,M),new h.P(d,x)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:d}=this.applyConstrain(this.center,this.zoom);this.setCenter(s),this.setZoom(d),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=h.ar(new Float64Array(16));h.Q(t,t,[this._width/2,-this._height/2,1]),h.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=h.ar(new Float64Array(16)),h.Q(t,t,[1,-1,1]),h.O(t,t,[-1,-1,0]),h.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,s,d,x){const T=d!==void 0?d:this.bearing,M=x=x!==void 0?x:this.pitch,{distanceToCenter:z,clampedElevation:j}=this._distanceToCenterFromAltElevationPitch(s,this.elevation,M),{x:Z,y:W}=kn(M,T),ee=h.a9.fromLngLat(t,s);let J,se,pe=h.a_(1,ee.y),Ae=0;do{if(Ae+=1,Ae>10)break;se=z/pe,J=new h.a9(ee.x+Z*se,ee.y+W*se),pe=1/J.meterInMercatorCoordinateUnits()}while(Math.abs(z-se*pe)>1e-12);return{center:J.toLngLat(),elevation:j,zoom:h.at(this.height/2/Math.tan(this.fovInRadians/2)/se/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const s=1/this.worldSize,d=h.as(1,this.center.lat)*this.worldSize,x=h.a9.fromLngLat(this.center,this.elevation),T=x.x/s,M=x.y/s,z=x.z/s,j=this.pitch,Z=this.bearing,{x:W,y:ee,z:J}=kn(j,Z),se=this.cameraToCenterDistance,pe=T+se*-W,Ae=M+se*-ee,Ne=z+se*J,{distanceToCenter:Re,clampedElevation:Be}=this._distanceToCenterFromAltElevationPitch(Ne/d,t,j),We=Re*d,Le=new h.a9((pe+W*We)*s,(Ae+ee*We)*s,0).toLngLat(),Ze=h.as(1,Le.lat),et=h.at(this.height/2/Math.tan(this.fovInRadians/2)/Re/Ze/this.tileSize);this._elevation=Be,this._center=Le,this.setZoom(et)}_distanceToCenterFromAltElevationPitch(t,s,d){const x=-Math.cos(h.ap(d)),T=t-s;let M,z=s;return x*T>=0||Math.abs(x)<.1?(M=1e4,z=t+M*x):M=-T/x,{distanceToCenter:M,clampedElevation:z}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const s=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/s,t.canonical.y/s,1/s/h.a5,1/s/h.a5]}}class Ns{constructor(t,s){this.min=t,this.max=s,this.center=h.a$([],h.b0([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],d=h.b1(this.min),x=h.b1(this.max);for(let T=0;T<s.length;T++)d[T]=s[T]?this.min[T]:this.center[T],x[T]=s[T]?this.center[T]:this.max[T];return x[2]=this.max[2],new Ns(d,x)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let s=!0;for(let d=0;d<t.planes.length;d++){const x=this.intersectsPlane(t.planes[d]);if(x===0)return 0;x===1&&(s=!1)}return s?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let s=t[3],d=t[3];for(let x=0;x<3;x++)t[x]>0?(s+=t[x]*this.min[x],d+=t[x]*this.max[x]):(d+=t[x]*this.min[x],s+=t[x]*this.max[x]);return s>=0?2:d<0?0:1}}class Xa{distanceToTile2d(t,s,d,x){const T=x.distanceX([t,s]),M=x.distanceY([t,s]);return Math.hypot(T,M)}getWrap(t,s,d){return d}getTileBoundingVolume(t,s,d,x){var T,M;let z=0,j=0;if(x?.terrain){const W=new h.a2(t.z,s,t.z,t.x,t.y),ee=x.terrain.getMinMaxElevation(W);z=(T=ee.minElevation)!==null&&T!==void 0?T:Math.min(0,d),j=(M=ee.maxElevation)!==null&&M!==void 0?M:Math.max(0,d)}const Z=1<<t.z;return new Ns([s+t.x/Z,t.y/Z,z],[s+(t.x+1)/Z,(t.y+1)/Z,j])}allowVariableZoom(t,s){const d=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,x=h.an(78.5-d/2,0,60);return!!s.terrain||t.pitch>x}allowWorldCopies(){return!0}prepareNextFrame(){}}class Us{constructor(t,s,d){this.points=t,this.planes=s,this.aabb=d}static fromInvProjectionMatrix(t,s=1,d=0,x,T){const M=T?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],z=Math.pow(2,d),j=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((J=>(function(se,pe,Ae,Ne){const Re=h.aH([],se,pe),Be=1/Re[3]/Ae*Ne;return h.b6(Re,Re,[Be,Be,1/Re[3],Be])})(J,t,s,z)));x&&(function(J,se,pe,Ae){const Ne=Ae?4:0,Re=Ae?0:4;let Be=0;const We=[],Le=[];for(let Ve=0;Ve<4;Ve++){const ut=h.b2([],J[Ve+Re],J[Ve+Ne]),Mt=h.b7(ut);h.a$(ut,ut,1/Mt),We.push(Mt),Le.push(ut)}for(let Ve=0;Ve<4;Ve++){const ut=h.b8(J[Ve+Ne],Le[Ve],pe);Be=ut!==null&&ut>=0?Math.max(Be,ut):Math.max(Be,We[Ve])}const Ze=(function(Ve,ut){const Mt=h.b2([],Ve[ut[0]],Ve[ut[1]]),Et=h.b2([],Ve[ut[2]],Ve[ut[1]]),At=[0,0,0,0];return h.b3(At,h.b4([],Mt,Et)),At[3]=-h.b5(At,Ve[ut[0]]),At})(J,se),et=(function(Ve,ut){const Mt=h.b9(Ve),Et=h.ba([],Ve,1/Mt),At=h.b2([],ut,h.a$([],Et,h.b5(ut,Et))),Ct=h.b9(At);if(Ct>0){const dn=Math.sqrt(1-Et[3]*Et[3]),mn=h.a$([],Et,-Et[3]),Qt=h.b0([],mn,h.a$([],At,dn/Ct));return h.bb(ut,Qt)}return null})(pe,Ze);if(et!==null){const Ve=et/h.b5(Le[0],Ze);Be=Math.min(Be,Ve)}for(let Ve=0;Ve<4;Ve++){const ut=Math.min(Be,We[Ve]);J[Ve+Re]=[J[Ve+Ne][0]+Le[Ve][0]*ut,J[Ve+Ne][1]+Le[Ve][1]*ut,J[Ve+Ne][2]+Le[Ve][2]*ut,1]}})(j,M[0],x,T);const Z=M.map((J=>{const se=h.b2([],j[J[0]],j[J[1]]),pe=h.b2([],j[J[2]],j[J[1]]),Ae=h.b3([],h.b4([],se,pe)),Ne=-h.b5(Ae,j[J[1]]);return Ae.concat(Ne)})),W=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],ee=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const J of j)for(let se=0;se<3;se++)W[se]=Math.min(W[se],J[se]),ee[se]=Math.max(ee[se],J[se]);return new Us(j,Z,new Ns(W,ee))}}class zr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,d){return this._helper.interpolatePadding(t,s,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,d=!0){this._helper.resize(t,s,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,s){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(s,d)=>{d=h.an(+d,this.minZoom,this.maxZoom);const x={center:new h.V(s.lng,s.lat),zoom:d};let T=this._helper._lngRange;if(!this._helper._renderWorldCopies&&T===null){const Le=179.9999999999;T=[-Le,Le]}const M=this.tileSize*h.aq(x.zoom);let z=0,j=M,Z=0,W=M,ee=0,J=0;const{x:se,y:pe}=this.size;if(this._helper._latRange){const Le=this._helper._latRange;z=h.X(Le[1])*M,j=h.X(Le[0])*M,j-z<pe&&(ee=pe/(j-z))}T&&(Z=h.W(h.Y(T[0])*M,0,M),W=h.W(h.Y(T[1])*M,0,M),W<Z&&(W+=M),W-Z<se&&(J=se/(W-Z)));const{x:Ae,y:Ne}=yt(M,s);let Re,Be;const We=Math.max(J||0,ee||0);if(We){const Le=new h.P(J?(W+Z)/2:Ae,ee?(j+z)/2:Ne);return x.center=qt(M,Le).wrap(),x.zoom+=h.at(We),x}if(this._helper._latRange){const Le=pe/2;Ne-Le<z&&(Be=z+Le),Ne+Le>j&&(Be=j-Le)}if(T){const Le=(Z+W)/2;let Ze=Ae;this._helper._renderWorldCopies&&(Ze=h.W(Ae,Le-M/2,Le+M/2));const et=se/2;Ze-et<Z&&(Re=Z+et),Ze+et>W&&(Re=W-et)}if(Re!==void 0||Be!==void 0){const Le=new h.P(Re??Ae,Be??Ne);x.center=qt(M,Le).wrap()}return x},this.applyConstrain=(s,d)=>this._helper.applyConstrain(s,d),this._helper=new Na({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,d)=>this.defaultConstrain(s,d)},t),this._coveringTilesDetailsProvider=new Xa}clone(){const t=new zr;return t.apply(this),t}apply(t,s,d){this._helper.apply(t,s,d)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const s=[new h.bc(0,t)];if(this._helper._renderWorldCopies){const d=this.screenPointToMercatorCoordinate(new h.P(0,0)),x=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),T=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),M=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),z=Math.floor(Math.min(d.x,x.x,T.x,M.x)),j=Math.floor(Math.max(d.x,x.x,T.x,M.x)),Z=1;for(let W=z-Z;W<=j+Z;W++)W!==0&&s.push(new h.bc(W,t))}return s}getCameraFrustum(){return Us.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const s=this.screenPointToLocation(this.centerPoint,t),d=t?t.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(d)}setLocationAtPoint(t,s){const d=h.as(this.elevation,this.center.lat),x=this.screenPointToMercatorCoordinateAtZ(s,d),T=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,d),M=h.a9.fromLngLat(t),z=new h.a9(M.x-(x.x-T.x),M.y-(x.y-T.y));this.setCenter(z?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,s){return s?this.coordinatePoint(h.a9.fromLngLat(t),s.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(h.a9.fromLngLat(t))}screenPointToLocation(t,s){var d;return(d=this.screenPointToMercatorCoordinate(t,s))===null||d===void 0?void 0:d.toLngLat()}screenPointToMercatorCoordinate(t,s){if(s){const d=s.pointCoordinate(t);if(d!=null)return d}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,s){const d=s||0,x=[t.x,t.y,0,1],T=[t.x,t.y,1,1];h.aH(x,x,this._pixelMatrixInverse),h.aH(T,T,this._pixelMatrixInverse);const M=x[3],z=T[3],j=x[1]/M,Z=T[1]/z,W=x[2]/M,ee=T[2]/z,J=W===ee?0:(d-W)/(ee-W);return new h.a9(h.G.number(x[0]/M,T[0]/z,J)/this.worldSize,h.G.number(j,Z,J)/this.worldSize,d)}coordinatePoint(t,s=0,d=this._pixelMatrix){const x=[t.x*this.worldSize,t.y*this.worldSize,s,1];return h.aH(x,x,d),new h.P(x[0]/x[3],x[1]/x[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Ot(this));return new si().extend(this.screenPointToLocation(new h.P(0,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(t,s){return s?s.pointCoordinate(t)!=null:t.y>this.height/2-Ot(this)}calculatePosMatrix(t,s=!1,d){var x;const T=(x=t.key)!==null&&x!==void 0?x:h.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),M=s?this._alignedPosMatrixCache:this._posMatrixCache;if(M.has(T)){const Z=M.get(T);return d?Z.f32:Z.f64}const z=cn(t,this.worldSize);h.S(z,s?this._alignedProjMatrix:this._viewProjMatrix,z);const j={f64:z,f32:new Float32Array(z)};return M.set(T,j),d?j.f32:j.f64}calculateFogMatrix(t){const s=t.key,d=this._fogMatrixCacheF32;if(d.has(s))return d.get(s);const x=cn(t,this.worldSize);return h.S(x,this._fogMatrix,x),d.set(s,new Float32Array(x)),d.get(s)}calculateCenterFromCameraLngLatAlt(t,s,d,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,d,x)}_calculateNearFarZIfNeeded(t,s,d){if(!this._helper.autoCalculateNearFarZ)return;const x=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),T=t-x*this._helper._pixelPerMeter/Math.cos(s),M=x<0?T:t,z=Math.PI/2+this.pitchInRadians,j=h.ap(this.fov)*(Math.abs(Math.cos(h.ap(this.roll)))*this.height+Math.abs(Math.sin(h.ap(this.roll)))*this.width)/this.height*(.5+d.y/this.height),Z=Math.sin(j)*M/Math.sin(h.an(Math.PI-z-j,.01,Math.PI-.01)),W=Ot(this),ee=Math.atan(W/this._helper.cameraToCenterDistance),J=h.ap(.75),se=ee>J?2*ee*(.5+d.y/(2*W)):J,pe=Math.sin(se)*M/Math.sin(h.an(Math.PI-z-se,.01,Math.PI-.01)),Ae=Math.min(Z,pe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*Ae+M),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,s=yt(this.worldSize,this.center),d=s.x,x=s.y;this._helper._pixelPerMeter=h.as(1,this.center.lat)*this.worldSize;const T=h.ap(Math.min(this.pitch,xt)),M=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(T));let z;this._calculateNearFarZIfNeeded(M,T,t),z=new Float64Array(16),h.be(z,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aB(this._invProjMatrix,z),z[8]=2*-t.x/this._helper._width,z[9]=2*t.y/this._helper._height,this._projectionMatrix=h.bf(z),h.Q(z,z,[1,-1,1]),h.O(z,z,[0,0,-this._helper.cameraToCenterDistance]),h.bg(z,z,-this.rollInRadians),h.bh(z,z,this.pitchInRadians),h.bg(z,z,-this.bearingInRadians),h.O(z,z,[-d,-x,0]),this._mercatorMatrix=h.Q([],z,[this.worldSize,this.worldSize,this.worldSize]),h.Q(z,z,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z),h.O(z,z,[0,0,-this.elevation]),this._viewProjMatrix=z,this._invViewProjMatrix=h.aB([],z);const j=[0,0,-1,1];h.aH(j,j,this._invViewProjMatrix),this._cameraPosition=[j[0]/j[3],j[1]/j[3],j[2]/j[3]],this._fogMatrix=new Float64Array(16),h.be(this._fogMatrix,this.fovInRadians,this.width/this.height,M,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,h.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.O(this._fogMatrix,this._fogMatrix,[-d,-x,0]),h.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z);const Z=this._helper._width%2/2,W=this._helper._height%2/2,ee=Math.cos(this.bearingInRadians),J=Math.sin(-this.bearingInRadians),se=d-Math.round(d)+ee*Z+J*W,pe=x-Math.round(x)+ee*W+J*Z,Ae=new Float64Array(z);if(h.O(Ae,Ae,[se>.5?se-1:se,pe>.5?pe-1:pe,0]),this._alignedProjMatrix=Ae,z=h.aB(new Float64Array(16),this._pixelMatrix),!z)throw new Error("failed to invert matrix");this._pixelMatrixInverse=z,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new h.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.aH(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,s){const d=h.a9.fromLngLat(t),x=[d.x*this.worldSize,d.y*this.worldSize,s,1];return h.aH(x,x,this._viewProjMatrix),x[2]/x[3]}getProjectionData(t){const{overscaledTileID:s,aligned:d,applyTerrainMatrix:x}=t,T=this._helper.getMercatorTileCoordinates(s),M=s?this.calculatePosMatrix(s,d,!0):null;let z;return z=s&&s.terrainRttPosMatrix32f&&x?s.terrainRttPosMatrix32f:M||h.bi(),{mainMatrix:z,tileMercatorCoords:T,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:z}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,s,d){return 1}transformLightDirection(t){return h.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,s,d,x){const T=this.calculatePosMatrix(d);let M;x?(M=[t,s,x(t,s),1],h.aH(M,M,T)):(M=[t,s,0,1],Ds(M,M,T));const z=M[3];return{point:new h.P(M[0]/z,M[1]/z),signedDistanceFromCamera:z,isOccluded:!1}}populateCache(t){for(const s of t)this.calculatePosMatrix(s)}getMatrixForModel(t,s){const d=h.a9.fromLngLat(t,s),x=d.meterInMercatorCoordinateUnits(),T=h.bj();return h.O(T,T,[d.x,d.y,d.z]),h.bg(T,T,Math.PI),h.bh(T,T,Math.PI/2),h.Q(T,T,[-x,x,x]),T}getProjectionDataForCustomLayer(t=!0){const s=new h.a2(0,0,0,0,0),d=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:t}),x=cn(s,this.worldSize);h.S(x,this._viewProjMatrix,x),d.tileMercatorCoords=[0,0,1,1];const T=[h.a5,h.a5,this.worldSize/this._helper.pixelsPerMeter],M=h.bk();return h.Q(M,x,T),d.fallbackMatrix=M,d.mainMatrix=M,d}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ds(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ss(E){if(E.useSlerp)if(E.k<1){const t=h.bl(E.startEulerAngles.roll,E.startEulerAngles.pitch,E.startEulerAngles.bearing),s=h.bl(E.endEulerAngles.roll,E.endEulerAngles.pitch,E.endEulerAngles.bearing),d=new Float64Array(4);h.bm(d,t,s,E.k);const x=h.bn(d);E.tr.setRoll(x.roll),E.tr.setPitch(x.pitch),E.tr.setBearing(x.bearing)}else E.tr.setRoll(E.endEulerAngles.roll),E.tr.setPitch(E.endEulerAngles.pitch),E.tr.setBearing(E.endEulerAngles.bearing);else E.tr.setRoll(h.G.number(E.startEulerAngles.roll,E.endEulerAngles.roll,E.k)),E.tr.setPitch(h.G.number(E.startEulerAngles.pitch,E.endEulerAngles.pitch,E.k)),E.tr.setBearing(h.G.number(E.startEulerAngles.bearing,E.endEulerAngles.bearing,E.k))}function Qo(E,t,s,d,x){const T=x.padding,M=yt(x.worldSize,s.getNorthWest()),z=yt(x.worldSize,s.getNorthEast()),j=yt(x.worldSize,s.getSouthEast()),Z=yt(x.worldSize,s.getSouthWest()),W=h.ap(-d),ee=M.rotate(W),J=z.rotate(W),se=j.rotate(W),pe=Z.rotate(W),Ae=new h.P(Math.max(ee.x,J.x,pe.x,se.x),Math.max(ee.y,J.y,pe.y,se.y)),Ne=new h.P(Math.min(ee.x,J.x,pe.x,se.x),Math.min(ee.y,J.y,pe.y,se.y)),Re=Ae.sub(Ne),Be=(x.width-(T.left+T.right+t.left+t.right))/Re.x,We=(x.height-(T.top+T.bottom+t.top+t.bottom))/Re.y;if(We<0||Be<0)return void ds();const Le=Math.min(h.at(x.scale*Math.min(Be,We)),E.maxZoom),Ze=h.P.convert(E.offset),et=new h.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(h.ap(d)),Ve=Ze.add(et).mult(x.scale/h.aq(Le));return{center:qt(x.worldSize,M.add(j).div(2).sub(Ve)),zoom:Le,bearing:d}}class Jo{get useGlobeControls(){return!1}handlePanInertia(t,s){const d=t.mag(),x=Math.abs(Ot(s));return{easingOffset:t.mult(Math.min(.75*x/d,1)),easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(t,s){t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta),t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta)}handleMapControlsPan(t,s,d){t.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(d,t.around)}cameraForBoxAndBearing(t,s,d,x,T){return Qo(t,s,d,x,T)}handleJumpToCenterZoom(t,s){t.zoom!==(s.zoom!==void 0?+s.zoom:t.zoom)&&t.setZoom(+s.zoom),s.center!==void 0&&t.setCenter(h.V.convert(s.center))}handleEaseTo(t,s){const d=t.zoom,x=t.padding,T={roll:t.roll,pitch:t.pitch,bearing:t.bearing},M={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},z=s.zoom!==void 0,j=!t.isPaddingEqual(s.padding);let Z=!1;const W=z?+s.zoom:t.zoom;let ee=t.centerPoint.add(s.offsetAsPoint);const J=t.screenPointToLocation(ee),{center:se,zoom:pe}=t.applyConstrain(h.V.convert(s.center||J),W??d);js(t,se);const Ae=yt(t.worldSize,J),Ne=yt(t.worldSize,se).sub(Ae),Re=h.aq(pe-d);return Z=pe!==d,{easeFunc:Be=>{if(Z&&t.setZoom(h.G.number(d,pe,Be)),h.bo(T,M)||Ss({startEulerAngles:T,endEulerAngles:M,tr:t,k:Be,useSlerp:T.roll!=M.roll}),j&&(t.interpolatePadding(x,s.padding,Be),ee=t.centerPoint.add(s.offsetAsPoint)),s.around)t.setLocationAtPoint(s.around,s.aroundPoint);else{const We=h.aq(t.zoom-d),Le=pe>d?Math.min(2,Re):Math.max(.5,Re),Ze=Math.pow(Le,1-Be),et=qt(t.worldSize,Ae.add(Ne.mult(Be*Ze)).mult(We));t.setLocationAtPoint(t.renderWorldCopies?et.wrap():et,ee)}},isZooming:Z,elevationCenter:se}}handleFlyTo(t,s){const d=s.zoom!==void 0,x=t.zoom,T=t.applyConstrain(h.V.convert(s.center||s.locationAtOffset),d?+s.zoom:x),M=T.center,z=T.zoom;js(t,M);const j=yt(t.worldSize,s.locationAtOffset),Z=yt(t.worldSize,M).sub(j),W=Z.mag(),ee=h.aq(z-x);let J;if(s.minZoom!==void 0){const se=Math.min(+s.minZoom,x,z),pe=t.applyConstrain(M,se).zoom;J=h.aq(pe-x)}return{easeFunc:(se,pe,Ae,Ne)=>{t.setZoom(se===1?z:x+h.at(pe));const Re=se===1?M:qt(t.worldSize,j.add(Z.mult(Ae)).mult(pe));t.setLocationAtPoint(t.renderWorldCopies?Re.wrap():Re,Ne)},scaleOfZoom:ee,targetCenter:M,scaleOfMinZoom:J,pixelPathLength:W}}}class er{constructor(t,s,d){this.blendFunction=t,this.blendColor=s,this.mask=d}}er.Replace=[1,0],er.disabled=new er(er.Replace,h.bp.transparent,[!1,!1,!1,!1]),er.unblended=new er(er.Replace,h.bp.transparent,[!0,!0,!0,!0]),er.alphaBlended=new er([1,771],h.bp.transparent,[!0,!0,!0,!0]);const el=2305;class Si{constructor(t,s,d){this.enable=t,this.mode=s,this.frontFace=d}}Si.disabled=new Si(!1,1029,el),Si.backCCW=new Si(!0,1029,el),Si.frontCCW=new Si(!0,1028,el);class pi{constructor(t,s,d){this.func=t,this.mask=s,this.range=d}}pi.ReadOnly=!1,pi.ReadWrite=!0,pi.disabled=new pi(519,pi.ReadOnly,[0,1]);const Hi=7680;class Oi{constructor(t,s,d,x,T,M){this.test=t,this.ref=s,this.mask=d,this.fail=x,this.depthFail=T,this.pass=M}}Oi.disabled=new Oi({func:519,mask:0},0,0,Hi,Hi,Hi);const tl=new WeakMap;function fs(E){var t;if(tl.has(E))return tl.get(E);{const s=(t=E.getParameter(E.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return tl.set(E,s),s}}class nl{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const s=t.context,d=s.gl;this._texFormat=d.RGBA,this._texType=d.UNSIGNED_BYTE;const x=new h.aW;x.emplaceBack(-1,-1),x.emplaceBack(2,-1),x.emplaceBack(-1,2);const T=new h.aY;T.emplaceBack(0,1,2),this._fullscreenTriangle=new lr(s.createVertexBuffer(x,oi.members),s.createIndexBuffer(T),h.aX.simpleSegment(0,0,x.length,T.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(d.TEXTURE1);const M=d.createTexture();d.bindTexture(d.TEXTURE_2D,M),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(M),fs(d)&&(this._pbo=d.createBuffer(),d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.bufferData(d.PIXEL_PACK_BUFFER,4,d.STREAM_READ),d.bindBuffer(d.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,s){const d=this._updateCount;return this._readbackQueue?d>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():d>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,s=t.gl;t.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,s){const d=this._cachedRenderContext.context,x=d.gl;if(this._bindFramebuffer(),d.viewport.set([0,0,this._texWidth,this._texHeight]),d.clear({color:h.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(d,x.TRIANGLES,pi.disabled,Oi.disabled,er.unblended,Si.disabled,((T,M)=>({u_input:T,u_output_expected:M}))(t,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&fs(x)){x.bindBuffer(x.PIXEL_PACK_BUFFER,this._pbo),x.readBuffer(x.COLOR_ATTACHMENT0),x.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),x.bindBuffer(x.PIXEL_PACK_BUFFER,null);const T=x.fenceSync(x.SYNC_GPU_COMMANDS_COMPLETE,0);x.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:T}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&fs(t)){const s=t.clientWaitSync(this._readbackQueue.sync,0,0);if(s===t.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=nl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let s=0;return s+=t[0]/256,s+=t[1]/65536,s+=t[2]/16777216,t[3]<127&&(s=-s),s/128}}const zt=h.a5/128;function Ci(E,t){const s=E.granularity!==void 0?Math.max(E.granularity,1):1,d=s+(E.generateBorders?2:0),x=s+(E.extendToNorthPole||E.generateBorders?1:0)+(E.extendToSouthPole||E.generateBorders?1:0),T=d+1,M=x+1,z=E.generateBorders?-1:0,j=E.generateBorders||E.extendToNorthPole?-1:0,Z=s+(E.generateBorders?1:0),W=s+(E.generateBorders||E.extendToSouthPole?1:0),ee=T*M,J=d*x*6,se=T*M>65536;if(se&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const pe=se||t==="32bit",Ae=new Int16Array(2*ee);let Ne=0;for(let We=j;We<=W;We++)for(let Le=z;Le<=Z;Le++){let Ze=Le/s*h.a5;Le===-1&&(Ze=-zt),Le===s+1&&(Ze=h.a5+zt);let et=We/s*h.a5;We===-1&&(et=E.extendToNorthPole?h.br:-zt),We===s+1&&(et=E.extendToSouthPole?h.bs:h.a5+zt),Ae[Ne++]=Ze,Ae[Ne++]=et}const Re=pe?new Uint32Array(J):new Uint16Array(J);let Be=0;for(let We=0;We<x;We++)for(let Le=0;Le<d;Le++){const Ze=Le+1+We*T,et=Le+(We+1)*T,Ve=Le+1+(We+1)*T;Re[Be++]=Le+We*T,Re[Be++]=et,Re[Be++]=Ze,Re[Be++]=Ze,Re[Be++]=et,Re[Be++]=Ve}return{vertices:Ae.buffer.slice(0),indices:Re.buffer.slice(0),uses32bitIndices:pe}}const Qr=new h.aV({fill:new h.bt(128,2),line:new h.bt(512,0),tile:new h.bt(128,32),stencil:new h.bt(128,1),circle:3});class rc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Gi.projectionGlobe}get vertexShaderPreludeCode(){return Gi.projectionMercator.vertexSource}get subdivisionGranularity(){return Qr}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new nl(t));const s=h.X(this._errorQueryLatitudeDegrees),d=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,x=this._errorMeasurement.updateErrorLoop(s,d),T=ye();x!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=x,this._errorMeasurementLastChangeTime=T);const M=Math.min(Math.max((T-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bv(M))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,s,d,x,T){const M=(T==="stencil"?Qr.stencil:Qr.tile).getGranularityForZoomLevel(s.z);return this._getMesh(t,{granularity:M,generateBorders:d,extendToNorthPole:s.y===0&&x,extendToSouthPole:s.y===(1<<s.z)-1&&x})}_getMesh(t,s){const d=this._getMeshKey(s);if(d in this._tileMeshCache)return this._tileMeshCache[d];const x=(function(T,M){const z=Ci(M,"16bit"),j=h.aW.deserialize({arrayBuffer:z.vertices,length:z.vertices.byteLength/2/2}),Z=h.aY.deserialize({arrayBuffer:z.indices,length:z.indices.byteLength/2/3});return new lr(T.createVertexBuffer(j,oi.members),T.createIndexBuffer(Z),h.aX.simpleSegment(0,0,j.length,Z.length))})(t,s);return this._tileMeshCache[d]=x,x}recalculate(t){}hasTransition(){const t=ye();let s=!1;return s=s||(t-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const jh=new h.t({type:new h.D(h.u.projection.type)});class Yu extends h.E{constructor(t){super(),this._transitionable=new h.x(jh,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0)),this._mercatorProjection=new Kr,this._verticalPerspectiveProjection=new rc}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof h.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,s,d,x,T){return this.currentProjection.getMeshFromTileID(t,s,d,x,T)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function sa(E){const t=kr(E.worldSize,E.center.lat);return 2*Math.PI*t}function po(E,t,s,d,x){const T=1/(1<<x),M=t/h.a5*T+d*T,z=h.by((E/h.a5*T+s*T)*Math.PI*2+Math.PI,2*Math.PI),j=2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI,Z=Math.cos(j),W=new Float64Array(3);return W[0]=Math.sin(z)*Z,W[1]=Math.sin(j),W[2]=Math.cos(z)*Z,W}function xr(E){return(function(t,s){const d=Math.cos(s),x=new Float64Array(3);return x[0]=Math.sin(t)*d,x[1]=Math.sin(s),x[2]=Math.cos(t)*d,x})(E.lng*Math.PI/180,E.lat*Math.PI/180)}function kr(E,t){return E/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Rl(E){const t=Math.asin(E[1])/Math.PI*180,s=Math.sqrt(E[0]*E[0]+E[2]*E[2]);if(s>1e-6){const d=E[0]/s,x=Math.acos(E[2]/s),T=(d>0?x:-x)/Math.PI*180;return new h.V(h.W(T,-180,180),t)}return new h.V(0,t)}function Ar(E){return Math.cos(E*Math.PI/180)}function Cr(E,t){const s=Ar(E),d=Ar(t);return h.at(d/s)}function il(E,t){const s=E.rotate(t.bearingInRadians),d=t.zoom+Cr(t.center.lat,0),x=h.bu(1/Ar(t.center.lat),1/Ar(Math.min(Math.abs(t.center.lat),60)),h.bx(d,7,3,0,1)),T=360/sa({worldSize:t.worldSize,center:{lat:t.center.lat}});return new h.V(t.center.lng-s.x*T*x,h.an(t.center.lat+s.y*T,-h.ao,h.ao))}function nr(E){const t=.5*E,s=Math.sin(t),d=Math.cos(t);return Math.log(s+d)-Math.log(d-s)}function ii(E,t,s,d){const x=E.lat+s*d;if(Math.abs(s)>1){const T=(Math.sign(E.lat+s)!==Math.sign(E.lat)?-Math.abs(E.lat):Math.abs(E.lat))*Math.PI/180,M=Math.abs(E.lat+s)*Math.PI/180,z=nr(T+d*(M-T)),j=nr(T),Z=nr(M);return new h.V(E.lng+t*((z-j)/(Z-j)),x)}return new h.V(E.lng+t*d,x)}class Bd{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,s,d,x){const T=`${t.z}_${t.x}_${t.y}_${x?.terrain?"t":""}`,M=this._cache.get(T);if(M)return M;const z=this._cachePrevious.get(T);if(z)return this._cache.set(T,z),z;const j=this._boundingVolumeFactory(t,s,d,x);return this._cache.set(T,j),this._hadAnyChanges=!0,j}}class ir{constructor(t,s,d,x){this.min=d,this.max=x,this.points=t,this.planes=s}static fromAabb(t,s){const d=[];for(let x=0;x<8;x++)d.push([1&~x?t[0]:s[0],(x>>1&1)==1?s[1]:t[1],(x>>2&1)==1?s[2]:t[2]]);return new ir(d,[[-1,0,0,s[0]],[1,0,0,-t[0]],[0,-1,0,s[1]],[0,1,0,-t[1]],[0,0,-1,s[2]],[0,0,1,-t[2]]],t,s)}static fromCenterSizeAngles(t,s,d){const x=h.bB([],d[0],d[1],d[2]),T=h.bC([],[s[0],0,0],x),M=h.bC([],[0,s[1],0],x),z=h.bC([],[0,0,s[2]],x),j=[...t],Z=[...t];for(let ee=0;ee<8;ee++)for(let J=0;J<3;J++){const se=t[J]+T[J]*(1&~ee?-1:1)+M[J]*((ee>>1&1)==1?1:-1)+z[J]*((ee>>2&1)==1?1:-1);j[J]=Math.min(j[J],se),Z[J]=Math.max(Z[J],se)}const W=[];for(let ee=0;ee<8;ee++){const J=[...t];h.b0(J,J,h.a$([],T,1&~ee?-1:1)),h.b0(J,J,h.a$([],M,(ee>>1&1)==1?1:-1)),h.b0(J,J,h.a$([],z,(ee>>2&1)==1?1:-1)),W.push(J)}return new ir(W,[[...T,-h.b5(T,W[0])],[...M,-h.b5(M,W[0])],[...z,-h.b5(z,W[0])],[-T[0],-T[1],-T[2],-h.b5(T,W[7])],[-M[0],-M[1],-M[2],-h.b5(M,W[7])],[-z[0],-z[1],-z[2],-h.b5(z,W[7])]],j,Z)}intersectsFrustum(t){let s=!0;const d=this.points.length,x=this.planes.length,T=t.planes.length,M=t.points.length;for(let z=0;z<T;z++){const j=t.planes[z];let Z=0;for(let W=0;W<d;W++){const ee=this.points[W];j[0]*ee[0]+j[1]*ee[1]+j[2]*ee[2]+j[3]>=0&&Z++}if(Z===0)return 0;Z<d&&(s=!1)}if(s)return 2;for(let z=0;z<x;z++){const j=this.planes[z];let Z=0;for(let W=0;W<M;W++){const ee=t.points[W];j[0]*ee[0]+j[1]*ee[1]+j[2]*ee[2]+j[3]>=0&&Z++}if(Z===0)return 0}return 1}intersectsPlane(t){const s=this.points.length;let d=0;for(let x=0;x<s;x++){const T=this.points[x];t[0]*T[0]+t[1]*T[1]+t[2]*T[2]+t[3]>=0&&d++}return d===s?2:d===0?0:1}}function mo(E,t,s){const d=E-t;return d<0?-d:Math.max(0,d-s)}function Wa(E,t,s,d,x){const T=E-s;let M;return M=T<0?Math.min(-T,1+T-x):T>1?Math.min(Math.max(T-x,0),1-T):0,Math.max(M,mo(t,d,x))}class $u{constructor(){this._boundingVolumeCache=new Bd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,s,d,x){const T=1<<d.z,M=1/T,z=d.x/T,j=d.y/T;let Z=2;return Z=Math.min(Z,Wa(t,s,z,j,M)),Z=Math.min(Z,Wa(t,s,z+.5,-j-M,M)),Z=Math.min(Z,Wa(t,s,z+.5,2-j-M,M)),Z}getWrap(t,s,d){const x=1<<s.z,T=1/x,M=s.x/x,z=mo(t.x,M,T),j=mo(t.x,M-1,T),Z=mo(t.x,M+1,T),W=Math.min(z,j,Z);return W===Z?1:W===j?-1:0}allowVariableZoom(t,s){return Yn(t,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,s,d,x){return this._boundingVolumeCache.getTileBoundingVolume(t,s,d,x)}_computeTileBoundingVolume(t,s,d,x){var T,M;let z=0,j=0;if(x?.terrain){const Z=new h.a2(t.z,s,t.z,t.x,t.y),W=x.terrain.getMinMaxElevation(Z);z=(T=W.minElevation)!==null&&T!==void 0?T:Math.min(0,d),j=(M=W.maxElevation)!==null&&M!==void 0?M:Math.max(0,d)}if(z/=h.bE,j/=h.bE,z+=1,j+=1,t.z<=0)return ir.fromAabb([-j,-j,-j],[j,j,j]);if(t.z===1)return ir.fromAabb([t.x===0?-j:0,t.y===0?0:-j,-j],[t.x===0?0:j,t.y===0?j:0,j]);{const Z=[po(0,0,t.x,t.y,t.z),po(h.a5,0,t.x,t.y,t.z),po(h.a5,h.a5,t.x,t.y,t.z),po(0,h.a5,t.x,t.y,t.z)],W=[];for(const At of Z)W.push(h.a$([],At,j));if(j!==z)for(const At of Z)W.push(h.a$([],At,z));t.y===0&&W.push([0,1,0]),t.y===(1<<t.z)-1&&W.push([0,-1,0]);const ee=[1,1,1],J=[-1,-1,-1];for(const At of W)for(let Ct=0;Ct<3;Ct++)ee[Ct]=Math.min(ee[Ct],At[Ct]),J[Ct]=Math.max(J[Ct],At[Ct]);const se=po(h.a5/2,h.a5/2,t.x,t.y,t.z),pe=h.b4([],[0,1,0],se);h.b3(pe,pe);const Ae=h.b4([],se,pe);h.b3(Ae,Ae);const Ne=h.b4([],Z[2],Z[1]);h.b3(Ne,Ne);const Re=h.b4([],Z[0],Z[3]);h.b3(Re,Re),W.push(h.a$([],se,j)),t.y>=(1<<t.z)/2&&W.push(h.a$([],po(h.a5/2,0,t.x,t.y,t.z),j)),t.y<(1<<t.z)/2&&W.push(h.a$([],po(h.a5/2,h.a5,t.x,t.y,t.z),j));const Be=ga(se,W),We=ga(Ae,W),Le=[-se[0],-se[1],-se[2],Be.max],Ze=[se[0],se[1],se[2],-Be.min],et=[-Ae[0],-Ae[1],-Ae[2],We.max],Ve=[Ae[0],Ae[1],Ae[2],-We.min],ut=[...Ne,0],Mt=[...Re,0],Et=[];return t.y===0?Et.push(h.bD(Mt,ut,Le),h.bD(Mt,ut,Ze)):Et.push(h.bD(et,ut,Le),h.bD(et,ut,Ze),h.bD(et,Mt,Le),h.bD(et,Mt,Ze)),t.y===(1<<t.z)-1?Et.push(h.bD(Mt,ut,Le),h.bD(Mt,ut,Ze)):Et.push(h.bD(Ve,ut,Le),h.bD(Ve,ut,Ze),h.bD(Ve,Mt,Le),h.bD(Ve,Mt,Ze)),new ir(Et,[Le,Ze,et,Ve,ut,Mt],ee,J)}}}function ga(E,t){let s=1/0,d=-1/0;for(const x of t){const T=h.b5(E,x);s=Math.min(s,T),d=Math.max(d,T)}return{min:s,max:d}}class rl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,d){return this._helper.interpolatePadding(t,s,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s){this._helper.resize(t,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=h.bF(),this._projectionMatrix=h.bj(),this._globeViewProjMatrix32f=h.bi(),this._globeViewProjMatrixNoCorrection=h.bj(),this._globeViewProjMatrixNoCorrectionInverted=h.bj(),this._globeProjMatrixInverted=h.bj(),this._cameraPosition=h.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(s,d)=>{const x=h.an(s.lat,-h.ao,h.ao),T=h.an(+d,this.minZoom+Cr(0,x),this.maxZoom);return{center:new h.V(s.lng,x),zoom:T}},this.applyConstrain=(s,d)=>this._helper.applyConstrain(s,d),this._helper=new Na({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,d)=>this.defaultConstrain(s,d)},t),this._coveringTilesDetailsProvider=new $u}clone(){const t=new rl;return t.apply(this),t}apply(t,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=h.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:s,applyGlobeMatrix:d}=t,x=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:x,clippingPlane:this._cachedClippingPlane,projectionTransition:d?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const s=this.pitchInRadians,d=this.cameraToCenterDistance/t,x=Math.sin(s)*d,T=Math.cos(s)*d+1,M=1/Math.sqrt(x*x+T*T)*1;let z=-x,j=T;const Z=Math.sqrt(z*z+j*j);z/=Z,j/=Z;const W=[0,z,j];h.bG(W,W,[0,0,0],-this.bearingInRadians),h.bH(W,W,[0,0,0],-1*this.center.lat*Math.PI/180),h.bI(W,W,[0,0,0],this.center.lng*Math.PI/180);const ee=1/h.b7(W);return h.a$(W,W,ee),[...W,-M*ee]}isLocationOccluded(t){return!this.isSurfacePointVisible(xr(t))}transformLightDirection(t){const s=this._helper._center.lng*Math.PI/180,d=this._helper._center.lat*Math.PI/180,x=Math.cos(d),T=[Math.sin(s)*x,Math.sin(d),Math.cos(s)*x],M=[T[2],0,-T[0]],z=[0,0,0];h.b4(z,M,T),h.b3(M,M),h.b3(z,z);const j=[0,0,0];return h.b3(j,[M[0]*t[0]+z[0]*t[1]+T[0]*t[2],M[1]*t[0]+z[1]*t[1]+T[1]*t[2],M[2]*t[0]+z[2]*t[1]+T[2]*t[2]]),j}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,s,d){const x=(function(z,j,Z){const W=1/(1<<Z.z);return new h.a9(z/h.a5*W+Z.x*W,j/h.a5*W+Z.y*W)})(t,s,d.canonical),T=(M=x.y,[h.by(x.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI]);var M;return this.getCircleRadiusCorrection()/Math.cos(T[1])}projectTileCoordinates(t,s,d,x){const T=d.canonical,M=po(t,s,T.x,T.y,T.z),z=1+(x?x(t,s):0)/h.bE,j=[M[0]*z,M[1]*z,M[2]*z,1];h.aH(j,j,this._globeViewProjMatrixNoCorrection);const Z=this._cachedClippingPlane,W=Z[0]*M[0]+Z[1]*M[1]+Z[2]*M[2]+Z[3]<0;return{point:new h.P(j[0]/j[3],j[1]/j[3]),signedDistanceFromCamera:j[3],isOccluded:W}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=kr(this.worldSize,this.center.lat),s=h.bk(),d=h.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),h.be(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const x=this.centerOffset;s[8]=2*-x.x/this._helper._width,s[9]=2*x.y/this._helper._height,this._projectionMatrix=h.bf(s),this._globeProjMatrixInverted=h.bk(),h.aB(this._globeProjMatrixInverted,s),h.O(s,s,[0,0,-this.cameraToCenterDistance]),h.bg(s,s,this.rollInRadians),h.bh(s,s,-this.pitchInRadians),h.bg(s,s,this.bearingInRadians),h.O(s,s,[0,0,-t]);const T=h.bz();T[0]=t,T[1]=t,T[2]=t,h.bh(d,s,this.center.lat*Math.PI/180),h.bJ(d,d,-this.center.lng*Math.PI/180),h.Q(d,d,T),this._globeViewProjMatrixNoCorrection=d,h.bh(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bJ(s,s,-this.center.lng*Math.PI/180),h.Q(s,s,T),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=h.bk(),h.aB(this._globeViewProjMatrixNoCorrectionInverted,d);const M=h.bz();this._cameraPosition=h.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,h.bG(this._cameraPosition,this._cameraPosition,M,-this.rollInRadians),h.bH(this._cameraPosition,this._cameraPosition,M,this.pitchInRadians),h.bG(this._cameraPosition,this._cameraPosition,M,-this.bearingInRadians),h.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bH(this._cameraPosition,this._cameraPosition,M,-this.center.lat*Math.PI/180),h.bI(this._cameraPosition,this._cameraPosition,M,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const z=h.bf(this._globeViewProjMatrixNoCorrectionInverted);h.Q(z,z,[1,1,-1]),this._cachedFrustum=Us.fromInvProjectionMatrix(z,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){h.w("calculateFogMatrix is not supported on globe projection.");const s=h.bk();return h.ar(s),s}getVisibleUnwrappedCoordinates(t){return[new h.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const d=xr(t);h.a$(d,d,1+s/h.bE);const x=h.bF();return h.aH(x,[d[0],d[1],d[2],1],this._globeViewProjMatrixNoCorrection),x[2]/x[3]}populateCache(t){}getBounds(){const t=.5*this.width,s=.5*this.height,d=[new h.P(0,0),new h.P(t,0),new h.P(this.width,0),new h.P(this.width,s),new h.P(this.width,this.height),new h.P(t,this.height),new h.P(0,this.height),new h.P(0,s)],x=[];for(const ee of d)x.push(this.unprojectScreenPoint(ee));let T=0,M=0,z=0,j=0;const Z=this.center;for(const ee of x){const J=h.bK(Z.lng,ee.lng),se=h.bK(Z.lat,ee.lat);J<M&&(M=J),J>T&&(T=J),se<j&&(j=se),se>z&&(z=se)}const W=[Z.lng+M,Z.lat+j,Z.lng+T,Z.lat+z];return this.isSurfacePointOnScreen([0,1,0])&&(W[3]=90,W[0]=-180,W[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(W[1]=-90,W[0]=-180,W[2]=180),new si(W)}calculateCenterFromCameraLngLatAlt(t,s,d,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,d,x)}setLocationAtPoint(t,s){const d=xr(this.unprojectScreenPoint(s)),x=xr(t),T=h.bz();h.bL(T);const M=h.bz();h.bI(M,d,T,-this.center.lng*Math.PI/180),h.bH(M,M,T,this.center.lat*Math.PI/180);const z=x[0]*x[0]+x[2]*x[2],j=M[0]*M[0];if(z<j)return;const Z=Math.sqrt(z-j),W=-Z,ee=h.bM(x[0],x[2],M[0],Z),J=h.bM(x[0],x[2],M[0],W),se=h.bz();h.bI(se,x,T,-ee);const pe=h.bM(se[1],se[2],M[1],M[2]),Ae=h.bz();h.bI(Ae,x,T,-J);const Ne=h.bM(Ae[1],Ae[2],M[1],M[2]),Re=.5*Math.PI,Be=pe>=-Re&&pe<=Re,We=Ne>=-Re&&Ne<=Re;let Le,Ze;if(Be&&We){const Mt=this.center.lng*Math.PI/180,Et=this.center.lat*Math.PI/180;h.bN(ee,Mt)+h.bN(pe,Et)<h.bN(J,Mt)+h.bN(Ne,Et)?(Le=ee,Ze=pe):(Le=J,Ze=Ne)}else if(Be)Le=ee,Ze=pe;else{if(!We)return;Le=J,Ze=Ne}const et=Le/Math.PI*180,Ve=Ze/Math.PI*180,ut=this.center.lat;this.setCenter(new h.V(et,h.an(Ve,-90,90))),this.setZoom(this.zoom+Cr(ut,this.center.lat))}locationToScreenPoint(t,s){const d=xr(t);if(s){const x=s.getElevationForLngLatZoom(t,this._helper._tileZoom);h.a$(d,d,1+x/h.bE)}return this._projectSurfacePointToScreen(d)}_projectSurfacePointToScreen(t){const s=h.bF();return h.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new h.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,s){if(s){const d=s.pointCoordinate(t);if(d)return d}return h.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,s){var d;return(d=this.screenPointToMercatorCoordinate(t,s))===null||d===void 0?void 0:d.toLngLat()}isPointOnMapSurface(t,s){const d=this._cameraPosition,x=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(d,x)}getRayDirectionFromPixel(t){const s=h.bF();s[0]=t.x/this.width*2-1,s[1]=-1*(t.y/this.height*2-1),s[2]=1,s[3]=1,h.aH(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const d=h.bz();d[0]=s[0]-this._cameraPosition[0],d[1]=s[1]-this._cameraPosition[1],d[2]=s[2]-this._cameraPosition[2];const x=h.bz();return h.b3(x,d),x}isSurfacePointVisible(t){const s=this._cachedClippingPlane;return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const s=h.bF();return h.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(t,s){const d=h.b5(t,s),x=h.bz(),T=h.bz();h.a$(T,s,d),h.b2(x,t,T);const M=1-h.b5(x,x);if(M<0)return null;const z=h.b5(t,t)-1,j=-d+(d<0?1:-1)*Math.sqrt(M),Z=z/j,W=j;return{tMin:Math.min(Z,W),tMax:Math.max(Z,W)}}unprojectScreenPoint(t){const s=this._cameraPosition,d=this.getRayDirectionFromPixel(t),x=this.rayPlanetIntersection(s,d);if(x){const W=h.bz();h.b0(W,s,[d[0]*x.tMin,d[1]*x.tMin,d[2]*x.tMin]);const ee=h.bz();return h.b3(ee,W),Rl(ee)}const T=this._cachedClippingPlane,M=T[0]*d[0]+T[1]*d[1]+T[2]*d[2],z=-h.bb(T,s)/M,j=h.bz();if(z>0)h.b0(j,s,[d[0]*z,d[1]*z,d[2]*z]);else{const W=h.bz();h.b0(W,s,[2*d[0],2*d[1],2*d[2]]);const ee=h.bb(this._cachedClippingPlane,W);h.b2(j,W,[this._cachedClippingPlane[0]*ee,this._cachedClippingPlane[1]*ee,this._cachedClippingPlane[2]*ee])}const Z=(function(W){const ee=h.bz();return ee[0]=W[0]*-W[3],ee[1]=W[1]*-W[3],ee[2]=W[2]*-W[3],{center:ee,radius:Math.sqrt(1-W[3]*W[3])}})(T);return Rl((function(W,ee,J){const se=h.bz();h.b2(se,J,W);const pe=h.bz();return h.bA(pe,W,se,ee/h.b9(se)),pe})(Z.center,Z.radius,j))}getMatrixForModel(t,s){const d=h.V.convert(t),x=1/h.bE,T=h.bj();return h.bJ(T,T,d.lng/180*Math.PI),h.bh(T,T,-d.lat/180*Math.PI),h.O(T,T,[0,0,1+s/h.bE]),h.bh(T,T,.5*Math.PI),h.Q(T,T,[x,x,x]),T}getProjectionDataForCustomLayer(t=!0){const s=this.getProjectionData({overscaledTileID:new h.a2(0,0,0,0,0),applyGlobeMatrix:t});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(t){}}class Dl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,d){return this._helper.interpolatePadding(t,s,d)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,d=!0){this._helper.resize(t,s,d)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,s){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(s,d)=>this.currentTransform.defaultConstrain(s,d),this.applyConstrain=(s,d)=>this._helper.applyConstrain(s,d),this._helper=new Na({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,d)=>this.defaultConstrain(s,d)},t),this._globeness=1,this._mercatorTransform=new zr,this._verticalPerspectiveTransform=new rl}clone(){const t=new Dl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const s=this._mercatorTransform.getProjectionData(t),d=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?d.mainMatrix:s.mainMatrix,clippingPlane:d.clippingPlane,tileMercatorCoords:d.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return h.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,s,d){const x=this._mercatorTransform.getPitchedTextCorrection(t,s,d),T=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,s,d);return h.bu(x,T,this._globeness)}projectTileCoordinates(t,s,d,x){return this.currentTransform.projectTileCoordinates(t,s,d,x)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){return this.currentTransform.lngLatToCameraDepth(t,s)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,s,d,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,d,x)}setLocationAtPoint(t,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,s){return this.currentTransform.locationToScreenPoint(t,s)}screenPointToMercatorCoordinate(t,s){return this.currentTransform.screenPointToMercatorCoordinate(t,s)}screenPointToLocation(t,s){return this.currentTransform.screenPointToLocation(t,s)}isPointOnMapSurface(t,s){return this.currentTransform.isPointOnMapSurface(t,s)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,s){return this.currentTransform.getMatrixForModel(t,s)}getProjectionDataForCustomLayer(t=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return s;const d=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return d.fallbackMatrix=s.mainMatrix,d}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Lr{get useGlobeControls(){return!0}handlePanInertia(t,s){const d=il(t,s);return Math.abs(d.lng-s.center.lng)>180&&(d.lng=s.center.lng+179.5*Math.sign(d.lng-s.center.lng)),{easingCenter:d,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,s){const d=t.around,x=s.screenPointToLocation(d);t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta);const T=s.zoom;t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta);const M=s.zoom-T;if(M===0)return;const z=h.bK(s.center.lng,x.lng),j=z/(Math.abs(z/180)+1),Z=h.bK(s.center.lat,x.lat),W=s.getRayDirectionFromPixel(d),ee=s.cameraPosition,J=-1*h.b5(ee,W),se=h.bz();h.b0(se,ee,[W[0]*J,W[1]*J,W[2]*J]);const pe=h.b7(se)-1,Ae=Math.exp(.5*-Math.max(pe-.3,0)),Ne=kr(s.worldSize,s.center.lat)/Math.min(s.width,s.height),Re=h.bx(Ne,.9,.5,1,.25),Be=(1-h.aq(-M))*Math.min(Ae,Re),We=s.center.lat,Le=s.zoom,Ze=new h.V(s.center.lng+j*Be,h.an(s.center.lat+Z*Be,-h.ao,h.ao));s.setLocationAtPoint(x,d);const et=s.center,Ve=h.bx(Math.abs(z),45,85,0,1),ut=h.bx(Ne,.75,.35,0,1),Mt=Math.pow(Math.max(Ve,ut),.25),Et=h.bK(et.lng,Ze.lng),At=h.bK(et.lat,Ze.lat);s.setCenter(new h.V(et.lng+Et*Mt,et.lat+At*Mt).wrap()),s.setZoom(Le+Cr(We,s.center.lat))}handleMapControlsPan(t,s,d){if(!t.panDelta)return;const x=s.center.lat,T=s.zoom;s.setCenter(il(t.panDelta,s).wrap()),s.setZoom(T+Cr(x,s.center.lat))}cameraForBoxAndBearing(t,s,d,x,T){const M=Qo(t,s,d,x,T),z=s.left/T.width*2-1,j=(T.width-s.right)/T.width*2-1,Z=s.top/T.height*-2+1,W=(T.height-s.bottom)/T.height*-2+1,ee=h.bK(d.getWest(),d.getEast())<0,J=ee?d.getEast():d.getWest(),se=ee?d.getWest():d.getEast(),pe=Math.max(d.getNorth(),d.getSouth()),Ae=Math.min(d.getNorth(),d.getSouth()),Ne=J+.5*h.bK(J,se),Re=pe+.5*h.bK(pe,Ae),Be=T.clone();Be.setCenter(M.center),Be.setBearing(M.bearing),Be.setPitch(0),Be.setRoll(0),Be.setZoom(M.zoom);const We=Be.modelViewProjectionMatrix,Le=[xr(d.getNorthWest()),xr(d.getNorthEast()),xr(d.getSouthWest()),xr(d.getSouthEast()),xr(new h.V(se,Re)),xr(new h.V(J,Re)),xr(new h.V(Ne,pe)),xr(new h.V(Ne,Ae))],Ze=xr(M.center);let et=Number.POSITIVE_INFINITY;for(const Ve of Le)z<0&&(et=Lr.getLesserNonNegativeNonNull(et,Lr.solveVectorScale(Ve,Ze,We,"x",z))),j>0&&(et=Lr.getLesserNonNegativeNonNull(et,Lr.solveVectorScale(Ve,Ze,We,"x",j))),Z>0&&(et=Lr.getLesserNonNegativeNonNull(et,Lr.solveVectorScale(Ve,Ze,We,"y",Z))),W<0&&(et=Lr.getLesserNonNegativeNonNull(et,Lr.solveVectorScale(Ve,Ze,We,"y",W)));if(Number.isFinite(et)&&et!==0)return M.zoom=Be.zoom+h.at(et),M;ds()}handleJumpToCenterZoom(t,s){const d=t.center.lat,x=t.applyConstrain(s.center?h.V.convert(s.center):t.center,t.zoom).center;t.setCenter(x.wrap());const T=s.zoom!==void 0?+s.zoom:t.zoom+Cr(d,x.lat);t.zoom!==T&&t.setZoom(T)}handleEaseTo(t,s){const d=t.zoom,x=t.center,T=t.padding,M={roll:t.roll,pitch:t.pitch,bearing:t.bearing},z={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},j=s.zoom!==void 0,Z=!t.isPaddingEqual(s.padding);let W=!1;const ee=s.center?h.V.convert(s.center):x,J=t.applyConstrain(ee,d).center;js(t,J);const se=t.clone();se.setCenter(J),se.setZoom(j?+s.zoom:d+Cr(x.lat,ee.lat)),se.setBearing(s.bearing);const pe=new h.P(h.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));se.setLocationAtPoint(J,pe);const Ae=(s.offset&&s.offsetAsPoint.mag())>0?se.center:J,Ne=j?+s.zoom:d+Cr(x.lat,Ae.lat),Re=d+Cr(x.lat,0),Be=Ne+Cr(Ae.lat,0),We=h.bK(x.lng,Ae.lng),Le=h.bK(x.lat,Ae.lat),Ze=h.aq(Be-Re);return W=Ne!==d,{easeFunc:et=>{if(h.bo(M,z)||Ss({startEulerAngles:M,endEulerAngles:z,tr:t,k:et,useSlerp:M.roll!=z.roll}),Z&&t.interpolatePadding(T,s.padding,et),s.around)h.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(s.around,s.aroundPoint);else{const Ve=Be>Re?Math.min(2,Ze):Math.max(.5,Ze),ut=Math.pow(Ve,1-et),Mt=ii(x,We,Le,et*ut);t.setCenter(Mt.wrap())}if(W){const Ve=h.G.number(Re,Be,et)+Cr(0,t.center.lat);t.setZoom(Ve)}},isZooming:W,elevationCenter:Ae}}handleFlyTo(t,s){const d=s.zoom!==void 0,x=t.center,T=t.zoom,M=t.padding,z=!t.isPaddingEqual(s.padding),j=t.applyConstrain(h.V.convert(s.center||s.locationAtOffset),T).center,Z=d?+s.zoom:t.zoom+Cr(t.center.lat,j.lat),W=t.clone();W.setCenter(j),W.setZoom(Z),W.setBearing(s.bearing);const ee=new h.P(h.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));W.setLocationAtPoint(j,ee);const J=W.center;js(t,J);const se=(function(Le,Ze,et){const Ve=xr(Ze),ut=xr(et),Mt=h.b5(Ve,ut),Et=Math.acos(Mt),At=sa(Le);return Et/(2*Math.PI)*At})(t,x,J),pe=T+Cr(x.lat,0),Ae=Z+Cr(J.lat,0),Ne=h.aq(Ae-pe);let Re;if(typeof s.minZoom=="number"){const Le=+s.minZoom+Cr(J.lat,0),Ze=Math.min(Le,pe,Ae)+Cr(0,J.lat),et=t.applyConstrain(J,Ze).zoom+Cr(J.lat,0);Re=h.aq(et-pe)}const Be=h.bK(x.lng,J.lng),We=h.bK(x.lat,J.lat);return{easeFunc:(Le,Ze,et,Ve)=>{const ut=ii(x,Be,We,et);z&&t.interpolatePadding(M,s.padding,Le);const Mt=Le===1?J:ut;t.setCenter(Mt.wrap());const Et=pe+h.at(Ze);t.setZoom(Le===1?Z:Et+Cr(0,Mt.lat))},scaleOfZoom:Ne,targetCenter:J,scaleOfMinZoom:Re,pixelPathLength:se}}static solveVectorScale(t,s,d,x,T){const M=x==="x"?[d[0],d[4],d[8],d[12]]:[d[1],d[5],d[9],d[13]],z=[d[3],d[7],d[11],d[15]],j=t[0]*M[0]+t[1]*M[1]+t[2]*M[2],Z=t[0]*z[0]+t[1]*z[1]+t[2]*z[2],W=s[0]*M[0]+s[1]*M[1]+s[2]*M[2],ee=s[0]*z[0]+s[1]*z[1]+s[2]*z[2];return W+T*Z===j+T*ee||z[3]*(j-W)+M[3]*(ee-Z)+j*ee==W*Z?null:(W+M[3]-T*ee-T*z[3])/(W-j-T*ee+T*Z)}static getLesserNonNegativeNonNull(t,s){return s!==null&&s>=0&&s<t?s:t}}class Nl{constructor(t){this._globe=t,this._mercatorCameraHelper=new Jo,this._verticalPerspectiveCameraHelper=new Lr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,s){return this.currentHelper.handlePanInertia(t,s)}handleMapControlsRollPitchBearingZoom(t,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,s)}handleMapControlsPan(t,s,d){this.currentHelper.handleMapControlsPan(t,s,d)}cameraForBoxAndBearing(t,s,d,x,T){return this.currentHelper.cameraForBoxAndBearing(t,s,d,x,T)}handleJumpToCenterZoom(t,s){this.currentHelper.handleJumpToCenterZoom(t,s)}handleEaseTo(t,s){return this.currentHelper.handleEaseTo(t,s)}handleFlyTo(t,s){return this.currentHelper.handleFlyTo(t,s)}}const kl=(E,t)=>h.B(E,t&&t.filter((s=>s.identifier!=="source.canvas"))),sc=h.bO();class Ea extends h.E{constructor(t,s={}){var d,x;super(),this._rtlPluginLoaded=()=>{for(const M in this.tileManagers){const z=this.tileManagers[M].getSource().type;z!=="vector"&&z!=="geojson"||this.tileManagers[M].reload()}},this.map=t,this.dispatcher=new ri(Rn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((M,z)=>this.getGlyphs(M,z))),this.dispatcher.registerMessageHandler("GI",((M,z)=>this.getImages(M,z))),this.dispatcher.registerMessageHandler("GDA",((M,z)=>this.getDashes(M,z))),this.imageManager=new ot,this.imageManager.setEventedParent(this);const T=((d=t._container)===null||d===void 0?void 0:d.lang)||typeof document<"u"&&((x=document.documentElement)===null||x===void 0?void 0:x.lang)||void 0;this.glyphManager=new je(t._requestManager,s.localIdeographFontFamily,T),this.lineAtlas=new It(256,512),this.crossTileSymbolIndex=new wi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",h.bP()),at().on(qe,this._rtlPluginLoaded),this.on("data",(M=>{if(M.dataType!=="source"||M.sourceDataType!=="metadata")return;const z=this.tileManagers[M.sourceId];if(!z)return;const j=z.getSource();if(j&&j.vectorLayerIds)for(const Z in this._layers){const W=this._layers[Z];W.source===j.id&&this._validateLayer(W)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new h.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,s){var d,x,T;this._checkLoaded();const M=s===null?(T=(x=(d=this.stylesheet.state)===null||d===void 0?void 0:d[t])===null||x===void 0?void 0:x.default)!==null&&T!==void 0?T:null:s;if(h.bR(M,this._globalState[t]))return this;this._globalState[t]=M,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const s=[];for(const d in t)!h.bR(this._globalState[d],t[d].default)&&(s.push(d),this._globalState[d]=t[d].default);this._applyGlobalStateChanges(s)}_applyGlobalStateChanges(t){if(t.length===0)return;const s=new Set,d={};for(const x of t){d[x]=this._globalState[x];for(const T in this._layers){const M=this._layers[T],z=M.getLayoutAffectingGlobalStateRefs(),j=M.getPaintAffectingGlobalStateRefs(),Z=M.getVisibilityAffectingGlobalStateRefs();if(z.has(x)&&s.add(M.source),j.has(x))for(const{name:W,value:ee}of j.get(x))this._updatePaintProperty(M,W,ee);Z?.has(x)&&(M.recalculateVisibility(),this._updateLayer(M))}}this.dispatcher.broadcast("UGS",d);for(const x in this.tileManagers)s.has(x)&&(this._reloadSource(x),this._changed=!0)}loadURL(t,s={},d){this.fire(new h.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const x=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const T=this._loadStyleRequest;h.j(x,this._loadStyleRequest).then((M=>{this._loadStyleRequest=null,this._load(M.data,s,d)})).catch((M=>{this._loadStyleRequest=null,M&&!T.signal.aborted&&this.fire(new h.k(M))}))}loadJSON(t,s={},d){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ce.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,d)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(sc,{validate:!1})}_load(t,s,d){var x,T;let M=s.transformStyle?s.transformStyle(d,t):t;if(!s.validate||!kl(this,h.C(M))){M=Object.assign({},M),this._loaded=!0,this.stylesheet=M;for(const z in M.sources)this.addSource(z,M.sources[z],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new Xt(this.stylesheet.light),this._setProjectionInternal(((x=this.stylesheet.projection)===null||x===void 0?void 0:x.type)||"mercator"),this.sky=new Xe(this.stylesheet.sky),this.map.setTerrain((T=this.stylesheet.terrain)!==null&&T!==void 0?T:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var t,s,d;const x=h.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",x),this._order=x.map((T=>T.id)),this._layers={},this._serializedLayers=null;for(const T of x){const M=h.bT(T,this._globalState);if(M.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=M,h.bU(M)&&this.tileManagers[M.source]){const z=(d=(s=T.paint)===null||s===void 0?void 0:s["raster-fade-duration"])!==null&&d!==void 0?d:M.paint.get("raster-fade-duration");this.tileManagers[M.source].setRasterFadeDuration(z)}}}_loadSprite(t,s=!1,d=void 0){this.imageManager.setLoaded(!1);const x=new AbortController;let T;this._spriteRequest=x,(function(M,z,j,Z){return h._(this,void 0,void 0,(function*(){const W=He(M),ee=j>1?"@2x":"",J={},se={};for(const{id:pe,url:Ae}of W){const Ne=z.transformRequest(pt(Ae,ee,".json"),"SpriteJSON");J[pe]=h.j(Ne,Z);const Re=z.transformRequest(pt(Ae,ee,".png"),"SpriteImage");se[pe]=tt.getImage(Re,Z)}return yield Promise.all([...Object.values(J),...Object.values(se)]),(function(pe,Ae){return h._(this,void 0,void 0,(function*(){const Ne={};for(const Re in pe){Ne[Re]={};const Be=Ce.getImageCanvasContext((yield Ae[Re]).data),We=(yield pe[Re]).data;for(const Le in We){const{width:Ze,height:et,x:Ve,y:ut,sdf:Mt,pixelRatio:Et,stretchX:At,stretchY:Ct,content:dn,textFitWidth:mn,textFitHeight:Qt}=We[Le];Ne[Re][Le]={data:null,pixelRatio:Et,sdf:Mt,stretchX:At,stretchY:Ct,content:dn,textFitWidth:mn,textFitHeight:Qt,spriteData:{width:Ze,height:et,x:Ve,y:ut,context:Be}}}}return Ne}))})(J,se)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((M=>{if(this._spriteRequest=null,M)for(const z in M){this._spritesImagesIds[z]=[];const j=this._spritesImagesIds[z]?this._spritesImagesIds[z].filter((Z=>!(Z in M))):[];for(const Z of j)this.imageManager.removeImage(Z),this._changedImages[Z]=!0;for(const Z in M[z]){const W=z==="default"?Z:`${z}:${Z}`;this._spritesImagesIds[z].push(W),W in this.imageManager.images?this.imageManager.updateImage(W,M[z][Z],!1):this.imageManager.addImage(W,M[z][Z]),s&&(this._changedImages[W]=!0)}}})).catch((M=>{this._spriteRequest=null,T=M,x.signal.aborted||this.fire(new h.k(T))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),d&&d(T)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(t){const s=this.tileManagers[t.source];if(!s)return;const d=t.sourceLayer;if(!d)return;const x=s.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(d)===-1)&&this.fire(new h.k(new Error(`Source layer "${d}" does not exist on source "${x.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const d=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?h.bV(d):d);const x=[];for(const T of t)if(d[T]){const M=s?h.bV(d[T]):d[T];x.push(M)}return x}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const d of s){const x=this._layers[d];x.type!=="custom"&&(t[d]=x.serialize())}return t}hasTransitions(){var t,s,d;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((d=this.projection)===null||d===void 0)&&d.hasTransition())return!0;for(const x in this.tileManagers)if(this.tileManagers[x].hasTransition())return!0;for(const x in this._layers)if(this._layers[x].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const x=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(x.length||T.length)&&this._updateWorkerLayers(x,T);for(const M in this._updatedSources){const z=this._updatedSources[M];if(z==="reload")this._reloadSource(M);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const d={};for(const x in this.tileManagers){const T=this.tileManagers[x];d[x]=T.used,T.used=!1}for(const x of this._order){const T=this._layers[x];T.recalculate(t,this._availableImages),!T.isHidden(t.zoom)&&T.source&&(this.tileManagers[T.source].used=!0)}for(const x in d){const T=this.tileManagers[x];!!d[x]!=!!T.used&&T.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,s&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var d;this._checkLoaded();const x=this.serialize();if(t=s.transformStyle?s.transformStyle(x,t):t,((d=s.validate)===null||d===void 0||d)&&kl(this,h.C(t)))return!1;(t=h.bV(t)).layers=h.bS(t.layers);const T=h.bW(x,t),M=this._getOperationsToPerform(T);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const z of M.operations)z();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],d=[];for(const x of t)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,x.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,x.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,x.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,x.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,x.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,x.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,x.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,x.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,x.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,x.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,x.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,x.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,x.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,x.args)));break;case"setProjection":this.setProjection.apply(this,x.args);break;case"setGlobalState":s.push((()=>this.setGlobalState.apply(this,x.args)));break;case"setTransition":s.push((()=>{}));break;default:d.push(x.command)}return{operations:s,unimplemented:d}}addImage(t,s){if(this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,d={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.C.source,`sources.${t}`,s,null,d))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const x=this.tileManagers[t]=new vi(t,s,this.dispatcher);x.style=this,x.setEventedParent(this,(()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:t}))),x.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===t)return this.fire(new h.k(new Error(`Source "${t}" cannot be removed while layer "${d}" is using it.`)));const s=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],s.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const d=this.tileManagers[t].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(s),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,s,d={}){this._checkLoaded();const x=t.id;if(this.getLayer(x))return void this.fire(new h.k(new Error(`Layer "${x}" already exists on this map.`)));let T;if(t.type==="custom"){if(kl(this,h.bX(t)))return;T=h.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(x,t.source),t=h.bV(t),t=h.e(t,{source:x})),this._validate(h.C.layer,`layers.${x}`,t,{arrayIndex:-1},d))return;T=h.bT(t,this._globalState),this._validateLayer(T),T.setEventedParent(this,{layer:{id:x}})}const M=s?this._order.indexOf(s):this._order.length;if(s&&M===-1)this.fire(new h.k(new Error(`Cannot add layer "${x}" before non-existing layer "${s}".`)));else{if(this._order.splice(M,0,x),this._layerOrderChanged=!0,this._layers[x]=T,this._removedLayers[x]&&T.source&&T.type!=="custom"){const z=this._removedLayers[x];delete this._removedLayers[x],z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.tileManagers[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const d=this._order.indexOf(t);this._order.splice(d,1);const x=s?this._order.indexOf(s):this._order.length;s&&x===-1?this.fire(new h.k(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(x,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,d){this._checkLoaded();const x=this.getLayer(t);x?x.minzoom===s&&x.maxzoom===d||(s!=null&&(x.minzoom=s),d!=null&&(x.maxzoom=d),this._updateLayer(x)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,d={}){this._checkLoaded();const x=this.getLayer(t);if(x){if(!h.bR(x.filter,s))return s==null?(x.setFilter(void 0),void this._updateLayer(x)):void(this._validate(h.C.filter,`layers.${x.id}.filter`,s,null,d)||(x.setFilter(h.bV(s)),this._updateLayer(x)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.bV(this.getLayer(t).filter)}setLayoutProperty(t,s,d,x={}){this._checkLoaded();const T=this.getLayer(t);T?h.bR(T.getLayoutProperty(s),d)||(T.setLayoutProperty(s,d,x),this._updateLayer(T)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const d=this.getLayer(t);if(d)return d.getLayoutProperty(s);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,d,x={}){this._checkLoaded();const T=this.getLayer(t);T?h.bR(T.getPaintProperty(s),d)||this._updatePaintProperty(T,s,d,x):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,s,d,x={}){t.setPaintProperty(s,d,x)&&this._updateLayer(t),h.bU(t)&&s==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(d),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const d=t.source,x=t.sourceLayer,T=this.tileManagers[d];if(T===void 0)return void this.fire(new h.k(new Error(`The source '${d}' does not exist in the map's style.`)));const M=T.getSource().type;M==="geojson"&&x?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||x?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),T.setFeatureState(x,t.id,s)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const d=t.source,x=this.tileManagers[d];if(x===void 0)return void this.fire(new h.k(new Error(`The source '${d}' does not exist in the map's style.`)));const T=x.getSource().type,M=T==="vector"?t.sourceLayer:void 0;T!=="vector"||M?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(M,t.id,s):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,d=t.sourceLayer,x=this.tileManagers[s];if(x!==void 0)return x.getSource().type!=="vector"||d?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),x.getFeatureState(d,t.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.bY(this.tileManagers,(T=>T.serialize())),s=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,x=this.stylesheet;return h.bZ({version:x.version,name:x.name,metadata:x.metadata,light:x.light,sky:x.sky,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,projection:x.projection,sources:t,layers:s,terrain:d},(T=>T!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=M=>this._layers[M].type==="fill-extrusion",d={},x=[];for(let M=this._order.length-1;M>=0;M--){const z=this._order[M];if(s(z)){d[z]=M;for(const j of t){const Z=j[z];if(Z)for(const W of Z)x.push(W)}}}x.sort(((M,z)=>z.intersectionZ-M.intersectionZ));const T=[];for(let M=this._order.length-1;M>=0;M--){const z=this._order[M];if(s(z))for(let j=x.length-1;j>=0;j--){const Z=x[j].feature;if(d[Z.layer.id]<M)break;T.push(Z),x.pop()}else for(const j of t){const Z=j[z];if(Z)for(const W of Z)T.push(W.feature)}}return T}queryRenderedFeatures(t,s,d){s&&s.filter&&this._validate(h.C.filter,"queryRenderedFeatures.filter",s.filter,null,s);const x={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const Z of s.layers){const W=this._layers[Z];if(!W)return this.fire(new h.k(new Error(`The layer '${Z}' does not exist in the map's style and cannot be queried for features.`))),[];x[W.source]=!0}}const T=[];s.availableImages=this._availableImages;const M=this._serializedAllLayers(),z=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,j=Object.assign(Object.assign({},s),{layers:z,globalState:this._globalState});for(const Z in this.tileManagers)s.layers&&!x[Z]||T.push(Kn(this.tileManagers[Z],this._layers,M,t,j,d,this.map.terrain?(W,ee,J)=>this.map.terrain.getElevation(W,ee,J):void 0));return this.placement&&T.push((function(Z,W,ee,J,se,pe,Ae){const Ne={},Re=pe.queryRenderedSymbols(J),Be=[];for(const We of Object.keys(Re).map(Number))Be.push(Ae[We]);Be.sort(Qn);for(const We of Be){const Le=We.featureIndex.lookupSymbolFeatures(Re[We.bucketInstanceId],W,We.bucketIndex,We.sourceLayerIndex,{filterSpec:se.filter,globalState:se.globalState},se.layers,se.availableImages,Z);for(const Ze in Le){const et=Ne[Ze]=Ne[Ze]||[],Ve=Le[Ze];Ve.sort(((ut,Mt)=>{const Et=We.featureSortOrder;if(Et){const At=Et.indexOf(ut.featureIndex);return Et.indexOf(Mt.featureIndex)-At}return Mt.featureIndex-ut.featureIndex}));for(const ut of Ve)et.push(ut)}}return(function(We,Le,Ze){for(const et in We)for(const Ve of We[et])ti(Ve,Ze[Le[et].source]);return We})(Ne,Z,ee)})(this._layers,M,this.tileManagers,t,j,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(t,s){s?.filter&&this._validate(h.C.filter,"querySourceFeatures.filter",s.filter,null,s);const d=this.tileManagers[t];return d?(function(x,T){const M=x.getRenderableIds().map((Z=>x.getTileByID(Z))),z=[],j={};for(let Z=0;Z<M.length;Z++){const W=M[Z],ee=W.tileID.canonical.key;j[ee]||(j[ee]=!0,W.querySourceFeatures(z,T))}return z})(d,s?Object.assign(Object.assign({},s),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const d=this.light.getLight();let x=!1;for(const M in t)if(!h.bR(t[M],d[M])){x=!0;break}if(!x)return;const T={now:ye(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(T)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){this._checkLoaded();const d=this.getSky();let x=!1;if(!t&&!d)return;if(t&&!d)x=!0;else if(!t&&d)x=!0;else for(const M in t)if(!h.bR(t[M],d[M])){x=!0;break}if(!x)return;const T={now:ye(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(T)}_setProjectionInternal(t){const s=(function(d,x){const T={constrainOverride:x};if(Array.isArray(d)){const M=new Yu({type:d});return{projection:M,transform:new Dl(T),cameraHelper:new Nl(M)}}switch(d){case"mercator":return{projection:new Kr,transform:new zr(T),cameraHelper:new Jo};case"globe":{const M=new Yu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:M,transform:new Dl(T),cameraHelper:new Nl(M)}}case"vertical-perspective":return{projection:new rc,transform:new rl(T),cameraHelper:new Lr};default:return h.w(`Unknown projection name: ${d}. Falling back to mercator projection.`),{projection:new Kr,transform:new zr(T),cameraHelper:new Jo}}})(t,this.map.transformConstrain);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const d in this.tileManagers)this.tileManagers[d].reload()}_validate(t,s,d,x,T={}){return(!T||T.validate!==!1)&&kl(this,t.call(h.C,h.e({key:s,style:this.serialize(),value:d,styleSpec:h.u},x)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),at().off(qe,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.tileManagers){const d=this.tileManagers[s];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const s in this.tileManagers)this.tileManagers[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,s,d,x,T=!1){let M=!1,z=!1;const j={};for(const Z of this._order){const W=this._layers[Z];if(W.type!=="symbol")continue;if(!j[W.source]){const J=this.tileManagers[W.source];j[W.source]=J.getRenderableIds(!0).map((se=>J.getTileByID(se))).sort(((se,pe)=>pe.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(pe.tileID)?-1:1)))}const ee=this.crossTileSymbolIndex.addLayer(W,j[W.source],t.center.lng);M=M||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ye(),t.zoom))&&(this.pauseablePlacement=new ko(t,this.map.terrain,this._order,T,s,d,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ye()),z=!0),M&&this.pauseablePlacement.placement.setStale()),z||M)for(const Z of this._order){const W=this._layers[Z];W.type==="symbol"&&this.placement.updateLayerOpacities(W,j[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ye())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,s){return h._(this,void 0,void 0,(function*(){const d=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const x=this.tileManagers[s.source];return x&&x.setDependencies(s.tileID.key,s.type,s.icons),d}))}getGlyphs(t,s){return h._(this,void 0,void 0,(function*(){const d=yield this.glyphManager.getGlyphs(s.stacks),x=this.tileManagers[s.source];return x&&x.setDependencies(s.tileID.key,s.type,[""]),d}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(h.C.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,s){return h._(this,void 0,void 0,(function*(){const d={};for(const[x,T]of Object.entries(s.dashes))d[x]=this.lineAtlas.getDash(T.dasharray,T.round);return d}))}addSprite(t,s,d={},x){this._checkLoaded();const T=[{id:t,url:s}],M=[...He(this.stylesheet.sprite),...T];this._validate(h.C.sprite,"sprite",M,null,d)||(this.stylesheet.sprite=M,this._loadSprite(T,!0,x))}removeSprite(t){this._checkLoaded();const s=He(this.stylesheet.sprite);if(s.find((d=>d.id===t))){if(this._spritesImagesIds[t])for(const d of this._spritesImagesIds[t])this.imageManager.removeImage(d),this._changedImages[d]=!0;s.splice(s.findIndex((d=>d.id===t)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return He(this.stylesheet.sprite)}setSprite(t,s={},d){this._checkLoaded(),t&&this._validate(h.C.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,d):(this._unloadSprite(),d&&d(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const s=this.tileManagers[t];s.setEventedParent(null),s.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const s=this._layers[t];s.setEventedParent(null),s.onRemove&&s.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var hu=h.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,d,x,T,M,z,j,Z){this.context=t;let W=this.boundPaintVertexBuffers.length!==x.length;for(let ee=0;!W&&ee<x.length;ee++)this.boundPaintVertexBuffers[ee]!==x[ee]&&(W=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==d||W||this.boundIndexBuffer!==T||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==j||this.boundDynamicVertexBuffer3!==Z?this.freshBind(s,d,x,T,M,z,j,Z):(t.bindVertexArray.set(this.vao),z&&z.bind(),T&&T.dynamicDraw&&T.bind(),j&&j.bind(),Z&&Z.bind())}freshBind(t,s,d,x,T,M,z,j){const Z=t.numAttributes,W=this.context,ee=W.gl;this.vao&&this.destroy(),this.vao=W.createVertexArray(),W.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=x,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=j,s.enableAttributes(ee,t);for(const J of d)J.enableAttributes(ee,t);M&&M.enableAttributes(ee,t),z&&z.enableAttributes(ee,t),j&&j.enableAttributes(ee,t),s.bind(),s.setVertexAttribPointers(ee,t,T);for(const J of d)J.bind(),J.setVertexAttribPointers(ee,t,T);M&&(M.bind(),M.setVertexAttribPointers(ee,t,T)),x&&x.bind(),z&&(z.bind(),z.setVertexAttribPointers(ee,t,T)),j&&(j.bind(),j.setVertexAttribPointers(ee,t,T)),W.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ac=(E,t,s,d,x)=>({u_texture:0,u_ele_delta:E,u_fog_matrix:t,u_fog_color:s?s.properties.get("fog-color"):h.bp.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:x?0:s?s.calculateFogBlendOpacity(d):0,u_horizon_color:s?s.properties.get("horizon-color"):h.bp.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:x?1:0}),Ya={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function $a(E){const t=[];for(let s=0;s<E.length;s++){if(E[s]===null)continue;const d=E[s].split(" ");t.push(d.pop())}return t}class Rc{constructor(t,s,d,x,T,M,z,j,Z=[]){const W=t.gl;this.program=W.createProgram();const ee=$a(s.staticAttributes),J=d?d.getBinderAttributes():[],se=ee.concat(J),pe=Gi.prelude.staticUniforms?$a(Gi.prelude.staticUniforms):[],Ae=z.staticUniforms?$a(z.staticUniforms):[],Ne=s.staticUniforms?$a(s.staticUniforms):[],Re=d?d.getBinderUniforms():[],Be=pe.concat(Ae).concat(Ne).concat(Re),We=[];for(const Et of Be)We.indexOf(Et)<0&&We.push(Et);const Le=d?d.defines():[];fs(W)&&Le.unshift("#version 300 es"),T&&Le.push("#define OVERDRAW_INSPECTOR;"),M&&Le.push("#define TERRAIN3D;"),j&&Le.push(j),Z&&Le.push(...Z);let Ze=Le.concat(Gi.prelude.fragmentSource,z.fragmentSource,s.fragmentSource).join(`
`),et=Le.concat(Gi.prelude.vertexSource,z.vertexSource,s.vertexSource).join(`
`);fs(W)||(Ze=(function(Et){return Et.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ze),et=(function(Et){return Et.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(et));const Ve=W.createShader(W.FRAGMENT_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(Ve,Ze),W.compileShader(Ve),!W.getShaderParameter(Ve,W.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${W.getShaderInfoLog(Ve)}`);W.attachShader(this.program,Ve);const ut=W.createShader(W.VERTEX_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(ut,et),W.compileShader(ut),!W.getShaderParameter(ut,W.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${W.getShaderInfoLog(ut)}`);W.attachShader(this.program,ut),this.attributes={};const Mt={};this.numAttributes=se.length;for(let Et=0;Et<this.numAttributes;Et++)se[Et]&&(W.bindAttribLocation(this.program,Et,se[Et]),this.attributes[se[Et]]=Et);if(W.linkProgram(this.program),!W.getProgramParameter(this.program,W.LINK_STATUS))throw new Error(`Program failed to link: ${W.getProgramInfoLog(this.program)}`);W.deleteShader(ut),W.deleteShader(Ve);for(let Et=0;Et<We.length;Et++){const At=We[Et];if(At&&!Mt[At]){const Ct=W.getUniformLocation(this.program,At);Ct&&(Mt[At]=Ct)}}this.fixedUniforms=x(t,Mt),this.terrainUniforms=((Et,At)=>({u_depth:new h.b_(Et,At.u_depth),u_terrain:new h.b_(Et,At.u_terrain),u_terrain_dim:new h.bq(Et,At.u_terrain_dim),u_terrain_matrix:new h.c0(Et,At.u_terrain_matrix),u_terrain_unpack:new h.c1(Et,At.u_terrain_unpack),u_terrain_exaggeration:new h.bq(Et,At.u_terrain_exaggeration)}))(t,Mt),this.projectionUniforms=((Et,At)=>({u_projection_matrix:new h.c0(Et,At.u_projection_matrix),u_projection_tile_mercator_coords:new h.c1(Et,At.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.c1(Et,At.u_projection_clipping_plane),u_projection_transition:new h.bq(Et,At.u_projection_transition),u_projection_fallback_matrix:new h.c0(Et,At.u_projection_fallback_matrix)}))(t,Mt),this.binderUniforms=d?d.getUniforms(t,Mt):[]}draw(t,s,d,x,T,M,z,j,Z,W,ee,J,se,pe,Ae,Ne,Re,Be,We){const Le=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(d),t.setStencilMode(x),t.setColorMode(T),t.setCullFace(M),j){t.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,j.depthTexture),t.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,j.texture);for(const et in this.terrainUniforms)this.terrainUniforms[et].set(j[et])}if(Z)for(const et in Z)this.projectionUniforms[Ya[et]].set(Z[et]);if(z)for(const et in this.fixedUniforms)this.fixedUniforms[et].set(z[et]);Ne&&Ne.setUniforms(t,this.binderUniforms,pe,{zoom:Ae});let Ze=0;switch(s){case Le.LINES:Ze=2;break;case Le.TRIANGLES:Ze=3;break;case Le.LINE_STRIP:Ze=1}for(const et of se.get()){const Ve=et.vaos||(et.vaos={});(Ve[W]||(Ve[W]=new Mc)).bind(t,this,ee,Ne?Ne.getPaintVertexBuffers():[],J,et.vertexOffset,Re,Be,We),Le.drawElements(s,et.primitiveLength*Ze,Le.UNSIGNED_SHORT,et.primitiveOffset*Ze*2)}}}function Sa(E,t,s){const d=1/h.aN(s,1,t.transform.tileZoom),x=Math.pow(2,s.tileID.overscaledZ),T=s.tileSize*Math.pow(2,t.transform.tileZoom)/x,M=T*(s.tileID.canonical.x+s.tileID.wrap*x),z=T*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[d,E.fromScale,E.toScale],u_fade:E.t,u_pixel_coord_upper:[M>>16,z>>16],u_pixel_coord_lower:[65535&M,65535&z]}}const Dc=(E,t,s,d)=>{const x=E.style.light,T=x.properties.get("position"),M=[T.x,T.y,T.z],z=h.c4();x.properties.get("anchor")==="viewport"&&h.c5(z,E.transform.bearingInRadians),h.c6(M,M,z);const j=E.transform.transformLightDirection(M),Z=x.properties.get("color");return{u_lightpos:M,u_lightpos_globe:j,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+t,u_opacity:s,u_fill_translate:d}},Ta=(E,t,s,d,x,T,M)=>h.e(Dc(E,t,s,d),Sa(T,E,M),{u_height_factor:-Math.pow(2,x.overscaledZ)/M.tileSize/8}),Pl=(E,t,s,d)=>h.e(Sa(t,E,s),{u_fill_translate:d}),sl=(E,t)=>({u_world:E,u_fill_translate:t}),Uh=(E,t,s,d,x)=>h.e(Pl(E,t,s,x),{u_world:d}),oc=(E,t,s,d,x)=>{const T=E.transform;let M,z,j=0;if(s.paint.get("circle-pitch-alignment")==="map"){const Z=h.aN(t,1,T.zoom);M=!0,z=[Z,Z],j=Z/(h.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*x}else M=!1,z=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+M,u_device_pixel_ratio:E.pixelRatio,u_extrude_scale:z,u_globe_extrude_scale:j,u_translate:d}},ks=E=>({u_pixel_extrude_scale:[1/E.width,1/E.height]}),Ku=E=>({u_viewport_size:[E.width,E.height]}),Ol=(E,t=1)=>({u_color:E,u_overlay:0,u_overlay_scale:t}),ka=(E,t,s,d)=>{const x=h.aN(E,1,t)/(h.a5*Math.pow(2,E.tileID.overscaledZ))*2*Math.PI*d;return{u_extrude_scale:h.aN(E,1,t),u_intensity:s,u_globe_extrude_scale:x}},Vi=(E,t,s,d)=>{const x=h.N();h.c7(x,0,E.width,E.height,0,0,1);const T=E.context.gl;return{u_matrix:x,u_world:[T.drawingBufferWidth,T.drawingBufferHeight],u_image:s,u_color_ramp:d,u_opacity:t.paint.get("heatmap-opacity")}},al=(E,t,s)=>{const d=s.paint.get("hillshade-accent-color");let x;switch(s.paint.get("hillshade-method")){case"basic":x=4;break;case"combined":x=1;break;case"igor":x=2;break;case"multidirectional":x=3;break;default:x=0}const T=s.getIlluminationProperties();for(let M=0;M<T.directionRadians.length;M++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(T.directionRadians[M]+=E.transform.bearingInRadians);return{u_image:0,u_latrange:a(0,t.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:T.altitudeRadians,u_azimuths:T.directionRadians,u_accent:d,u_method:x,u_highlights:T.highlightColor,u_shadows:T.shadowColor}},le=(E,t)=>{const s=t.stride,d=h.N();return h.c7(d,0,h.a5,-h.a5,0,0,1),h.O(d,d,[0,-h.a5,0]),{u_matrix:d,u_image:1,u_dimension:[s,s],u_zoom:E.overscaledZ,u_unpack:t.getUnpackVector()}};function a(E,t){const s=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new h.a9(0,d/s).toLngLat().lat,new h.a9(0,(d+1)/s).toLngLat().lat]}const u=(E,t,s=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:E.paint.get("color-relief-opacity")}),m=(E,t,s,d)=>{const x=E.transform;return{u_translation:q(E,t,s),u_ratio:d/h.aN(t,1,x.zoom),u_device_pixel_ratio:E.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},v=(E,t,s,d,x)=>h.e(m(E,t,s,d),{u_image:0,u_image_height:x}),w=(E,t,s,d,x)=>{const T=E.transform,M=F(t,T);return{u_translation:q(E,t,s),u_texsize:t.imageAtlasTexture.size,u_ratio:d/h.aN(t,1,T.zoom),u_device_pixel_ratio:E.pixelRatio,u_image:0,u_scale:[M,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},I=(E,t,s,d,x)=>{const T=F(t,E.transform);return h.e(m(E,t,s,d),{u_tileratio:T,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image:0,u_mix:x.t,u_lineatlas_width:E.lineAtlas.width,u_lineatlas_height:E.lineAtlas.height})},P=(E,t,s,d,x,T)=>{const M=F(t,E.transform);return h.e(m(E,t,s,d),{u_image:0,u_image_height:T,u_tileratio:M,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image_dash:1,u_mix:x.t,u_lineatlas_width:E.lineAtlas.width,u_lineatlas_height:E.lineAtlas.height})};function F(E,t){return 1/h.aN(E,1,t.tileZoom)}function q(E,t,s){return h.aO(E.transform,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const te=(E,t,s,d,x)=>{return{u_tl_parent:E,u_scale_parent:t,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(M=d.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(T=d.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:ce(d.paint.get("raster-hue-rotate")),u_coords_top:[x[0].x,x[0].y,x[1].x,x[1].y],u_coords_bottom:[x[3].x,x[3].y,x[2].x,x[2].y]};var T,M};function ce(E){E*=Math.PI/180;const t=Math.sin(E),s=Math.cos(E);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const xe=(E,t,s,d,x,T,M,z,j,Z,W,ee,J)=>{const se=M.transform;return{u_is_size_zoom_constant:+(E==="constant"||E==="source"),u_is_size_feature_constant:+(E==="constant"||E==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_pitch:se.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:se.width/se.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_label_plane_matrix:z,u_coord_matrix:j,u_is_text:+W,u_pitch_with_map:+d,u_is_along_line:x,u_is_variable_anchor:T,u_texsize:ee,u_texture:0,u_translation:Z,u_pitched_scale:J}},ze=(E,t,s,d,x,T,M,z,j,Z,W,ee,J,se)=>{const pe=M.transform;return h.e(xe(E,t,s,d,x,T,M,z,j,Z,W,ee,se),{u_gamma_scale:d?Math.cos(pe.pitch*Math.PI/180)*pe.cameraToCenterDistance:1,u_device_pixel_ratio:M.pixelRatio,u_is_halo:1})},it=(E,t,s,d,x,T,M,z,j,Z,W,ee,J)=>h.e(ze(E,t,s,d,x,T,M,z,j,Z,!0,W,0,J),{u_texsize_icon:ee,u_texture_icon:1}),lt=(E,t)=>({u_opacity:E,u_color:t}),Tt=(E,t,s,d,x)=>h.e((function(T,M,z,j){const Z=z.imageManager.getPattern(T.from.toString()),W=z.imageManager.getPattern(T.to.toString()),{width:ee,height:J}=z.imageManager.getPixelSize(),se=Math.pow(2,j.tileID.overscaledZ),pe=j.tileSize*Math.pow(2,z.transform.tileZoom)/se,Ae=pe*(j.tileID.canonical.x+j.tileID.wrap*se),Ne=pe*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:W.tl,u_pattern_br_b:W.br,u_texsize:[ee,J],u_mix:M.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:W.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/h.aN(j,1,z.transform.tileZoom),u_pixel_coord_upper:[Ae>>16,Ne>>16],u_pixel_coord_lower:[65535&Ae,65535&Ne]}})(s,x,t,d),{u_opacity:E}),Ft=(E,t)=>{},vn={fillExtrusion:(E,t)=>({u_lightpos:new h.c2(E,t.u_lightpos),u_lightpos_globe:new h.c2(E,t.u_lightpos_globe),u_lightintensity:new h.bq(E,t.u_lightintensity),u_lightcolor:new h.c2(E,t.u_lightcolor),u_vertical_gradient:new h.bq(E,t.u_vertical_gradient),u_opacity:new h.bq(E,t.u_opacity),u_fill_translate:new h.c3(E,t.u_fill_translate)}),fillExtrusionPattern:(E,t)=>({u_lightpos:new h.c2(E,t.u_lightpos),u_lightpos_globe:new h.c2(E,t.u_lightpos_globe),u_lightintensity:new h.bq(E,t.u_lightintensity),u_lightcolor:new h.c2(E,t.u_lightcolor),u_vertical_gradient:new h.bq(E,t.u_vertical_gradient),u_height_factor:new h.bq(E,t.u_height_factor),u_opacity:new h.bq(E,t.u_opacity),u_fill_translate:new h.c3(E,t.u_fill_translate),u_image:new h.b_(E,t.u_image),u_texsize:new h.c3(E,t.u_texsize),u_pixel_coord_upper:new h.c3(E,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(E,t.u_pixel_coord_lower),u_scale:new h.c2(E,t.u_scale),u_fade:new h.bq(E,t.u_fade)}),fill:(E,t)=>({u_fill_translate:new h.c3(E,t.u_fill_translate)}),fillPattern:(E,t)=>({u_image:new h.b_(E,t.u_image),u_texsize:new h.c3(E,t.u_texsize),u_pixel_coord_upper:new h.c3(E,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(E,t.u_pixel_coord_lower),u_scale:new h.c2(E,t.u_scale),u_fade:new h.bq(E,t.u_fade),u_fill_translate:new h.c3(E,t.u_fill_translate)}),fillOutline:(E,t)=>({u_world:new h.c3(E,t.u_world),u_fill_translate:new h.c3(E,t.u_fill_translate)}),fillOutlinePattern:(E,t)=>({u_world:new h.c3(E,t.u_world),u_image:new h.b_(E,t.u_image),u_texsize:new h.c3(E,t.u_texsize),u_pixel_coord_upper:new h.c3(E,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(E,t.u_pixel_coord_lower),u_scale:new h.c2(E,t.u_scale),u_fade:new h.bq(E,t.u_fade),u_fill_translate:new h.c3(E,t.u_fill_translate)}),circle:(E,t)=>({u_camera_to_center_distance:new h.bq(E,t.u_camera_to_center_distance),u_scale_with_map:new h.b_(E,t.u_scale_with_map),u_pitch_with_map:new h.b_(E,t.u_pitch_with_map),u_extrude_scale:new h.c3(E,t.u_extrude_scale),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_globe_extrude_scale:new h.bq(E,t.u_globe_extrude_scale),u_translate:new h.c3(E,t.u_translate)}),collisionBox:(E,t)=>({u_pixel_extrude_scale:new h.c3(E,t.u_pixel_extrude_scale)}),collisionCircle:(E,t)=>({u_viewport_size:new h.c3(E,t.u_viewport_size)}),debug:(E,t)=>({u_color:new h.b$(E,t.u_color),u_overlay:new h.b_(E,t.u_overlay),u_overlay_scale:new h.bq(E,t.u_overlay_scale)}),depth:Ft,clippingMask:Ft,heatmap:(E,t)=>({u_extrude_scale:new h.bq(E,t.u_extrude_scale),u_intensity:new h.bq(E,t.u_intensity),u_globe_extrude_scale:new h.bq(E,t.u_globe_extrude_scale)}),heatmapTexture:(E,t)=>({u_matrix:new h.c0(E,t.u_matrix),u_world:new h.c3(E,t.u_world),u_image:new h.b_(E,t.u_image),u_color_ramp:new h.b_(E,t.u_color_ramp),u_opacity:new h.bq(E,t.u_opacity)}),hillshade:(E,t)=>({u_image:new h.b_(E,t.u_image),u_latrange:new h.c3(E,t.u_latrange),u_exaggeration:new h.bq(E,t.u_exaggeration),u_altitudes:new h.c9(E,t.u_altitudes),u_azimuths:new h.c9(E,t.u_azimuths),u_accent:new h.b$(E,t.u_accent),u_method:new h.b_(E,t.u_method),u_shadows:new h.c8(E,t.u_shadows),u_highlights:new h.c8(E,t.u_highlights)}),hillshadePrepare:(E,t)=>({u_matrix:new h.c0(E,t.u_matrix),u_image:new h.b_(E,t.u_image),u_dimension:new h.c3(E,t.u_dimension),u_zoom:new h.bq(E,t.u_zoom),u_unpack:new h.c1(E,t.u_unpack)}),colorRelief:(E,t)=>({u_image:new h.b_(E,t.u_image),u_unpack:new h.c1(E,t.u_unpack),u_dimension:new h.c3(E,t.u_dimension),u_elevation_stops:new h.b_(E,t.u_elevation_stops),u_color_stops:new h.b_(E,t.u_color_stops),u_color_ramp_size:new h.b_(E,t.u_color_ramp_size),u_opacity:new h.bq(E,t.u_opacity)}),line:(E,t)=>({u_translation:new h.c3(E,t.u_translation),u_ratio:new h.bq(E,t.u_ratio),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(E,t.u_units_to_pixels)}),lineGradient:(E,t)=>({u_translation:new h.c3(E,t.u_translation),u_ratio:new h.bq(E,t.u_ratio),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(E,t.u_units_to_pixels),u_image:new h.b_(E,t.u_image),u_image_height:new h.bq(E,t.u_image_height)}),linePattern:(E,t)=>({u_translation:new h.c3(E,t.u_translation),u_texsize:new h.c3(E,t.u_texsize),u_ratio:new h.bq(E,t.u_ratio),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_image:new h.b_(E,t.u_image),u_units_to_pixels:new h.c3(E,t.u_units_to_pixels),u_scale:new h.c2(E,t.u_scale),u_fade:new h.bq(E,t.u_fade)}),lineSDF:(E,t)=>({u_translation:new h.c3(E,t.u_translation),u_ratio:new h.bq(E,t.u_ratio),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(E,t.u_units_to_pixels),u_image:new h.b_(E,t.u_image),u_mix:new h.bq(E,t.u_mix),u_tileratio:new h.bq(E,t.u_tileratio),u_crossfade_from:new h.bq(E,t.u_crossfade_from),u_crossfade_to:new h.bq(E,t.u_crossfade_to),u_lineatlas_width:new h.bq(E,t.u_lineatlas_width),u_lineatlas_height:new h.bq(E,t.u_lineatlas_height)}),lineGradientSDF:(E,t)=>({u_translation:new h.c3(E,t.u_translation),u_ratio:new h.bq(E,t.u_ratio),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(E,t.u_units_to_pixels),u_image:new h.b_(E,t.u_image),u_image_height:new h.bq(E,t.u_image_height),u_tileratio:new h.bq(E,t.u_tileratio),u_crossfade_from:new h.bq(E,t.u_crossfade_from),u_crossfade_to:new h.bq(E,t.u_crossfade_to),u_image_dash:new h.b_(E,t.u_image_dash),u_mix:new h.bq(E,t.u_mix),u_lineatlas_width:new h.bq(E,t.u_lineatlas_width),u_lineatlas_height:new h.bq(E,t.u_lineatlas_height)}),raster:(E,t)=>({u_tl_parent:new h.c3(E,t.u_tl_parent),u_scale_parent:new h.bq(E,t.u_scale_parent),u_buffer_scale:new h.bq(E,t.u_buffer_scale),u_fade_t:new h.bq(E,t.u_fade_t),u_opacity:new h.bq(E,t.u_opacity),u_image0:new h.b_(E,t.u_image0),u_image1:new h.b_(E,t.u_image1),u_brightness_low:new h.bq(E,t.u_brightness_low),u_brightness_high:new h.bq(E,t.u_brightness_high),u_saturation_factor:new h.bq(E,t.u_saturation_factor),u_contrast_factor:new h.bq(E,t.u_contrast_factor),u_spin_weights:new h.c2(E,t.u_spin_weights),u_coords_top:new h.c1(E,t.u_coords_top),u_coords_bottom:new h.c1(E,t.u_coords_bottom)}),symbolIcon:(E,t)=>({u_is_size_zoom_constant:new h.b_(E,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(E,t.u_is_size_feature_constant),u_size_t:new h.bq(E,t.u_size_t),u_size:new h.bq(E,t.u_size),u_camera_to_center_distance:new h.bq(E,t.u_camera_to_center_distance),u_pitch:new h.bq(E,t.u_pitch),u_rotate_symbol:new h.b_(E,t.u_rotate_symbol),u_aspect_ratio:new h.bq(E,t.u_aspect_ratio),u_fade_change:new h.bq(E,t.u_fade_change),u_label_plane_matrix:new h.c0(E,t.u_label_plane_matrix),u_coord_matrix:new h.c0(E,t.u_coord_matrix),u_is_text:new h.b_(E,t.u_is_text),u_pitch_with_map:new h.b_(E,t.u_pitch_with_map),u_is_along_line:new h.b_(E,t.u_is_along_line),u_is_variable_anchor:new h.b_(E,t.u_is_variable_anchor),u_texsize:new h.c3(E,t.u_texsize),u_texture:new h.b_(E,t.u_texture),u_translation:new h.c3(E,t.u_translation),u_pitched_scale:new h.bq(E,t.u_pitched_scale)}),symbolSDF:(E,t)=>({u_is_size_zoom_constant:new h.b_(E,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(E,t.u_is_size_feature_constant),u_size_t:new h.bq(E,t.u_size_t),u_size:new h.bq(E,t.u_size),u_camera_to_center_distance:new h.bq(E,t.u_camera_to_center_distance),u_pitch:new h.bq(E,t.u_pitch),u_rotate_symbol:new h.b_(E,t.u_rotate_symbol),u_aspect_ratio:new h.bq(E,t.u_aspect_ratio),u_fade_change:new h.bq(E,t.u_fade_change),u_label_plane_matrix:new h.c0(E,t.u_label_plane_matrix),u_coord_matrix:new h.c0(E,t.u_coord_matrix),u_is_text:new h.b_(E,t.u_is_text),u_pitch_with_map:new h.b_(E,t.u_pitch_with_map),u_is_along_line:new h.b_(E,t.u_is_along_line),u_is_variable_anchor:new h.b_(E,t.u_is_variable_anchor),u_texsize:new h.c3(E,t.u_texsize),u_texture:new h.b_(E,t.u_texture),u_gamma_scale:new h.bq(E,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_is_halo:new h.b_(E,t.u_is_halo),u_translation:new h.c3(E,t.u_translation),u_pitched_scale:new h.bq(E,t.u_pitched_scale)}),symbolTextAndIcon:(E,t)=>({u_is_size_zoom_constant:new h.b_(E,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(E,t.u_is_size_feature_constant),u_size_t:new h.bq(E,t.u_size_t),u_size:new h.bq(E,t.u_size),u_camera_to_center_distance:new h.bq(E,t.u_camera_to_center_distance),u_pitch:new h.bq(E,t.u_pitch),u_rotate_symbol:new h.b_(E,t.u_rotate_symbol),u_aspect_ratio:new h.bq(E,t.u_aspect_ratio),u_fade_change:new h.bq(E,t.u_fade_change),u_label_plane_matrix:new h.c0(E,t.u_label_plane_matrix),u_coord_matrix:new h.c0(E,t.u_coord_matrix),u_is_text:new h.b_(E,t.u_is_text),u_pitch_with_map:new h.b_(E,t.u_pitch_with_map),u_is_along_line:new h.b_(E,t.u_is_along_line),u_is_variable_anchor:new h.b_(E,t.u_is_variable_anchor),u_texsize:new h.c3(E,t.u_texsize),u_texsize_icon:new h.c3(E,t.u_texsize_icon),u_texture:new h.b_(E,t.u_texture),u_texture_icon:new h.b_(E,t.u_texture_icon),u_gamma_scale:new h.bq(E,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(E,t.u_device_pixel_ratio),u_is_halo:new h.b_(E,t.u_is_halo),u_translation:new h.c3(E,t.u_translation),u_pitched_scale:new h.bq(E,t.u_pitched_scale)}),background:(E,t)=>({u_opacity:new h.bq(E,t.u_opacity),u_color:new h.b$(E,t.u_color)}),backgroundPattern:(E,t)=>({u_opacity:new h.bq(E,t.u_opacity),u_image:new h.b_(E,t.u_image),u_pattern_tl_a:new h.c3(E,t.u_pattern_tl_a),u_pattern_br_a:new h.c3(E,t.u_pattern_br_a),u_pattern_tl_b:new h.c3(E,t.u_pattern_tl_b),u_pattern_br_b:new h.c3(E,t.u_pattern_br_b),u_texsize:new h.c3(E,t.u_texsize),u_mix:new h.bq(E,t.u_mix),u_pattern_size_a:new h.c3(E,t.u_pattern_size_a),u_pattern_size_b:new h.c3(E,t.u_pattern_size_b),u_scale_a:new h.bq(E,t.u_scale_a),u_scale_b:new h.bq(E,t.u_scale_b),u_pixel_coord_upper:new h.c3(E,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(E,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bq(E,t.u_tile_units_to_pixels)}),terrain:(E,t)=>({u_texture:new h.b_(E,t.u_texture),u_ele_delta:new h.bq(E,t.u_ele_delta),u_fog_matrix:new h.c0(E,t.u_fog_matrix),u_fog_color:new h.b$(E,t.u_fog_color),u_fog_ground_blend:new h.bq(E,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bq(E,t.u_fog_ground_blend_opacity),u_horizon_color:new h.b$(E,t.u_horizon_color),u_horizon_fog_blend:new h.bq(E,t.u_horizon_fog_blend),u_is_globe_mode:new h.bq(E,t.u_is_globe_mode)}),terrainDepth:(E,t)=>({u_ele_delta:new h.bq(E,t.u_ele_delta)}),terrainCoords:(E,t)=>({u_texture:new h.b_(E,t.u_texture),u_terrain_coords_id:new h.bq(E,t.u_terrain_coords_id),u_ele_delta:new h.bq(E,t.u_ele_delta)}),projectionErrorMeasurement:(E,t)=>({u_input:new h.bq(E,t.u_input),u_output_expected:new h.bq(E,t.u_output_expected)}),atmosphere:(E,t)=>({u_sun_pos:new h.c2(E,t.u_sun_pos),u_atmosphere_blend:new h.bq(E,t.u_atmosphere_blend),u_globe_position:new h.c2(E,t.u_globe_position),u_globe_radius:new h.bq(E,t.u_globe_radius),u_inv_proj_matrix:new h.c0(E,t.u_inv_proj_matrix)}),sky:(E,t)=>({u_sky_color:new h.b$(E,t.u_sky_color),u_horizon_color:new h.b$(E,t.u_horizon_color),u_horizon:new h.c3(E,t.u_horizon),u_horizon_normal:new h.c3(E,t.u_horizon_normal),u_sky_horizon_blend:new h.bq(E,t.u_sky_horizon_blend),u_sky_blend:new h.bq(E,t.u_sky_blend)})};class yn{constructor(t,s,d){this.context=t;const x=t.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const un={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ni{constructor(t,s,d,x){this.length=s.length,this.attributes=d,this.itemSize=s.bytesPerElement,this.dynamicDraw=x,this.context=t;const T=t.gl;this.buffer=T.createBuffer(),t.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let d=0;d<this.attributes.length;d++){const x=s.attributes[this.attributes[d].name];x!==void 0&&t.enableVertexAttribArray(x)}}setVertexAttribPointers(t,s,d){for(let x=0;x<this.attributes.length;x++){const T=this.attributes[x],M=s.attributes[T.name];M!==void 0&&t.vertexAttribPointer(M,T.components,t[un[T.type]],!1,this.itemSize,T.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ur extends Pn{getDefault(){return h.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class aa extends Pn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ts extends Pn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class rr extends Pn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vr extends Pn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ps extends Pn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ka extends Pn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class As extends Pn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Qu extends Pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class du extends Pn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Qa extends Pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class ol extends Pn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Aa extends Pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class zl extends Pn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Nc extends Pn{getDefault(){return h.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class kc extends Pn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ju extends Pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class lc extends Pn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class go extends Pn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Fd extends Pn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class fu extends Pn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class bi extends Pn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vh extends Pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ja extends Pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Gh extends Pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class eo extends Pn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ep extends Pn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Hh extends Pn{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const d=this.gl;fs(d)?d.bindVertexArray(t):(s=d.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class cc extends Pn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class jd extends Pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class qh extends Pn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class uc extends Pn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class pu extends uc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ca extends uc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class hc extends uc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const dc="Framebuffer is not complete";class Pc{constructor(t,s,d,x,T){this.context=t,this.width=s,this.height=d;const M=t.gl,z=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new pu(t,z),x)this.depthAttachment=T?new hc(t,z):new Ca(t,z);else if(T)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error(dc)}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const d=this.depthAttachment.get();d&&t.deleteRenderbuffer(d)}t.deleteFramebuffer(this.framebuffer)}}class fc{constructor(t){var s,d;if(this.gl=t,this.clearColor=new Ur(this),this.clearDepth=new aa(this),this.clearStencil=new Ts(this),this.colorMask=new rr(this),this.depthMask=new Vr(this),this.stencilMask=new Ps(this),this.stencilFunc=new Ka(this),this.stencilOp=new As(this),this.stencilTest=new Qu(this),this.depthRange=new du(this),this.depthTest=new Qa(this),this.depthFunc=new ol(this),this.blend=new Aa(this),this.blendFunc=new zl(this),this.blendColor=new Nc(this),this.blendEquation=new kc(this),this.cullFace=new Ju(this),this.cullFaceSide=new lc(this),this.frontFace=new go(this),this.program=new Fd(this),this.activeTexture=new fu(this),this.viewport=new bi(this),this.bindFramebuffer=new Vh(this),this.bindRenderbuffer=new Ja(this),this.bindTexture=new Gh(this),this.bindVertexBuffer=new eo(this),this.bindElementBuffer=new ep(this),this.bindVertexArray=new Hh(this),this.pixelStoreUnpack=new cc(this),this.pixelStoreUnpackPremultiplyAlpha=new jd(this),this.pixelStoreUnpackFlipY=new qh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),fs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const x=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:x?.RGBA16F_EXT,this.RGB16F=(d=t.RGB16F)!==null&&d!==void 0?d:x?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const x=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=x?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new yn(this,t,s)}createVertexBuffer(t,s,d){return new Ni(this,t,s,d)}createRenderbuffer(t,s,d){const x=this.gl,T=x.createRenderbuffer();return this.bindRenderbuffer.set(T),x.renderbufferStorage(x.RENDERBUFFER,t,s,d),this.bindRenderbuffer.set(null),T}createFramebuffer(t,s,d,x){return new Pc(this,t,s,d,x)}clear({color:t,depth:s,stencil:d}){const x=this.gl;let T=0;t&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),d!==void 0&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),x.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.bR(t.blendFunction,er.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return fs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return fs(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Os;function Vs(E,t,s,d,x){const T=E.context,M=E.transform,z=T.gl,j=E.useProgram("collisionBox"),Z=[];let W=0,ee=0;for(let Re=0;Re<d.length;Re++){const Be=d[Re],We=t.getTile(Be).getBucket(s);if(!We)continue;const Le=x?We.textCollisionBox:We.iconCollisionBox,Ze=We.collisionCircleArray;Ze.length>0&&(Z.push({circleArray:Ze,circleOffset:ee,coord:Be}),W+=Ze.length/4,ee=W),Le&&j.draw(T,z.LINES,pi.disabled,Oi.disabled,E.colorModeForRenderPass(),Si.disabled,ks(E.transform),E.style.map.terrain&&E.style.map.terrain.getTerrainData(Be),M.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,E.transform.zoom,null,null,Le.collisionVertexBuffer)}if(!x||!Z.length)return;const J=E.useProgram("collisionCircle"),se=new h.ca;se.resize(4*W),se._trim();let pe=0;for(const Re of Z)for(let Be=0;Be<Re.circleArray.length/4;Be++){const We=4*Be,Le=Re.circleArray[We+0],Ze=Re.circleArray[We+1],et=Re.circleArray[We+2],Ve=Re.circleArray[We+3];se.emplace(pe++,Le,Ze,et,Ve,0),se.emplace(pe++,Le,Ze,et,Ve,1),se.emplace(pe++,Le,Ze,et,Ve,2),se.emplace(pe++,Le,Ze,et,Ve,3)}(!Os||Os.length<2*W)&&(Os=(function(Re){const Be=2*Re,We=new h.cc;We.resize(Be),We._trim();for(let Le=0;Le<Be;Le++){const Ze=6*Le;We.uint16[Ze+0]=4*Le+0,We.uint16[Ze+1]=4*Le+1,We.uint16[Ze+2]=4*Le+2,We.uint16[Ze+3]=4*Le+2,We.uint16[Ze+4]=4*Le+3,We.uint16[Ze+5]=4*Le+0}return We})(W));const Ae=T.createIndexBuffer(Os,!0),Ne=T.createVertexBuffer(se,h.cb.members,!0);for(const Re of Z){const Be=Ku(E.transform);J.draw(T,z.TRIANGLES,pi.disabled,Oi.disabled,E.colorModeForRenderPass(),Si.disabled,Be,E.style.map.terrain&&E.style.map.terrain.getTerrainData(Re.coord),null,s.id,Ne,Ae,h.aX.simpleSegment(0,2*Re.circleOffset,Re.circleArray.length,Re.circleArray.length/2),null,E.transform.zoom,null,null,null)}Ne.destroy(),Ae.destroy()}const ll=h.ar(new Float32Array(16));function cl(E,t,s,d,x,T){const{horizontalAlign:M,verticalAlign:z}=h.aS(E);return new h.P((-(M-.5)*t/x+d[0])*T,(-(z-.5)*s/x+d[1])*T)}function Pa(E,t,s,d,x,T){const M=t.tileAnchorPoint.add(new h.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let z=d.mult(T);s||(z=z.rotate(-x));const j=M.add(z);return ai(j.x,j.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(s){const z=Hn(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(E),j=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return E.add(d.rotate(j))}return E.add(d)}function Ll(E,t,s,d,x,T,M,z,j,Z,W,ee){const J=E.text.placedSymbolArray,se=E.text.dynamicLayoutVertexArray,pe=E.icon.dynamicLayoutVertexArray,Ae={};se.clear();for(let Ne=0;Ne<J.length;Ne++){const Re=J.get(Ne),Be=Re.hidden||!Re.crossTileID||E.allowVerticalPlacement&&!Re.placedOrientation?null:d[Re.crossTileID];if(Be){const We=new h.P(Re.anchorX,Re.anchorY),Le={getElevation:ee,width:x.width,height:x.height,pitchedLabelPlaneMatrix:T,pitchWithMap:s,transform:x,tileAnchorPoint:We,translation:Z,unwrappedTileID:W},Ze=s?Yo(We.x,We.y,Le):Hn(We.x,We.y,Le),et=Rs(x.cameraToCenterDistance,Ze.signedDistanceFromCamera);let Ve=h.aA(E.textSizeData,z,Re)*et/h.aM;s&&(Ve*=E.tilePixelRatio/M);const{width:ut,height:Mt,anchor:Et,textOffset:At,textBoxScale:Ct}=Be,dn=cl(Et,ut,Mt,At,Ct,Ve),mn=x.getPitchedTextCorrection(We.x+Z[0],We.y+Z[1],W),Qt=Pa(Ze.point,Le,t,dn,-x.bearingInRadians,mn),En=E.allowVerticalPlacement&&Re.placedOrientation===h.az.vertical?Math.PI/2:0;for(let mi=0;mi<Re.numGlyphs;mi++)h.aG(se,Qt,En);j&&Re.associatedIconIndex>=0&&(Ae[Re.associatedIconIndex]={shiftedAnchor:Qt,angle:En})}else fa(Re.numGlyphs,se)}if(j){pe.clear();const Ne=E.icon.placedSymbolArray;for(let Re=0;Re<Ne.length;Re++){const Be=Ne.get(Re);if(Be.hidden)fa(Be.numGlyphs,pe);else{const We=Ae[Re];if(We)for(let Le=0;Le<Be.numGlyphs;Le++)h.aG(pe,We.shiftedAnchor,We.angle);else fa(Be.numGlyphs,pe)}}E.icon.dynamicLayoutVertexBuffer.updateData(pe)}E.text.dynamicLayoutVertexBuffer.updateData(se)}function Ud(E,t,s){return s.iconsInText&&t?"symbolTextAndIcon":E?"symbolSDF":"symbolIcon"}function Oc(E,t,s,d,x,T,M,z,j,Z,W,ee,J){const se=E.context,pe=se.gl,Ae=E.transform,Ne=z==="map",Re=j==="map",Be=z!=="viewport"&&s.layout.get("symbol-placement")!=="point",We=Ne&&!Re&&!Be,Le=!s.layout.get("symbol-sort-key").isConstant();let Ze=!1;const et=E.getDepthModeForSublayer(0,pi.ReadOnly),Ve=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ut=[],Mt=Ae.getCircleRadiusCorrection();for(const Et of d){const At=t.getTile(Et),Ct=At.getBucket(s);if(!Ct)continue;const dn=x?Ct.text:Ct.icon;if(!dn||!dn.segments.get().length||!dn.hasVisibleVertices)continue;const mn=dn.programConfigurations.get(s.id),Qt=x||Ct.sdfIcons,En=x?Ct.textSizeData:Ct.iconSizeData,mi=Re||Ae.pitch!==0,ar=E.useProgram(Ud(Qt,x,Ct),mn),Ir=h.ay(En,Ae.zoom),br=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Et);let Fr,fr,Yr,jr,Hs=[0,0],es=null;if(x)fr=At.glyphAtlasTexture,Yr=pe.LINEAR,Fr=At.glyphAtlasTexture.size,Ct.iconsInText&&(Hs=At.imageAtlasTexture.size,es=At.imageAtlasTexture,jr=mi||E.options.rotating||E.options.zooming||En.kind==="composite"||En.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const ur=s.layout.get("icon-size").constantOr(0)!==1||Ct.iconsNeedLinear;fr=At.imageAtlasTexture,Yr=Qt||E.options.rotating||E.options.zooming||ur||mi?pe.LINEAR:pe.NEAREST,Fr=At.imageAtlasTexture.size}const ts=h.aN(At,1,E.transform.zoom),qs=vs(Ne,E.transform,ts),wl=h.N();h.aB(wl,qs);const El=ws(Re,Ne,E.transform,ts),jo=h.aO(Ae,At,T,M),Ba=Ae.getProjectionData({overscaledTileID:Et,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),Hc=Ve&&Ct.hasTextData(),Su=s.layout.get("icon-text-fit")!=="none"&&Hc&&Ct.hasIconData();if(Be){const ur=E.style.map.terrain?(ms,Cs)=>E.style.map.terrain.getElevation(Et,ms,Cs):null,vr=s.layout.get("text-rotation-alignment")==="map";ji(Ct,E,x,qs,wl,Re,Z,vr,Et.toUnwrapped(),Ae.width,Ae.height,jo,ur)}const Uo=x&&Ve||Su,Fa=Be||Uo?ll:Re?qs:E.transform.clipSpaceToPixelsMatrix,so=Qt&&s.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let wo;wo=Qt?Ct.iconsInText?it(En.kind,Ir,We,Re,Be,Uo,E,Fa,El,jo,Fr,Hs,Mt):ze(En.kind,Ir,We,Re,Be,Uo,E,Fa,El,jo,x,Fr,0,Mt):xe(En.kind,Ir,We,Re,Be,Uo,E,Fa,El,jo,x,Fr,Mt);const Eo={program:ar,buffers:dn,uniformValues:wo,projectionData:Ba,atlasTexture:fr,atlasTextureIcon:es,atlasInterpolation:Yr,atlasInterpolationIcon:jr,isSDF:Qt,hasHalo:so};if(Le&&Ct.canOverlap){Ze=!0;const ur=dn.segments.get();for(const vr of ur)ut.push({segments:new h.aX([vr]),sortKey:vr.sortKey,state:Eo,terrainData:br})}else ut.push({segments:dn.segments,sortKey:0,state:Eo,terrainData:br})}Ze&&ut.sort(((Et,At)=>Et.sortKey-At.sortKey));for(const Et of ut){const At=Et.state;if(se.activeTexture.set(pe.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,pe.CLAMP_TO_EDGE),At.atlasTextureIcon&&(se.activeTexture.set(pe.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),At.isSDF){const Ct=At.uniformValues;At.hasHalo&&(Ct.u_is_halo=1,mu(At.buffers,Et.segments,s,E,At.program,et,W,ee,Ct,At.projectionData,Et.terrainData)),Ct.u_is_halo=0}mu(At.buffers,Et.segments,s,E,At.program,et,W,ee,At.uniformValues,At.projectionData,Et.terrainData)}}function mu(E,t,s,d,x,T,M,z,j,Z,W){const ee=d.context;x.draw(ee,ee.gl.TRIANGLES,T,M,z,Si.backCCW,j,W,Z,s.id,E.layoutVertexBuffer,E.indexBuffer,t,s.paint,d.transform.zoom,E.programConfigurations.get(s.id),E.dynamicLayoutVertexBuffer,E.opacityVertexBuffer)}function Vd(E,t,s,d,x){const T=E.context,M=T.gl,z=Oi.disabled,j=new er([M.ONE,M.ONE],h.bp.transparent,[!0,!0,!0,!0]),Z=t.getBucket(s);if(!Z)return;const W=d.key;let ee=s.heatmapFbos.get(W);ee||(ee=_r(T,t.tileSize,t.tileSize),s.heatmapFbos.set(W,ee)),T.bindFramebuffer.set(ee.framebuffer),T.viewport.set([0,0,t.tileSize,t.tileSize]),T.clear({color:h.bp.transparent});const J=Z.programConfigurations.get(s.id),se=E.useProgram("heatmap",J,!x),pe=E.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ae=E.style.map.terrain.getTerrainData(d);se.draw(T,M.TRIANGLES,pi.disabled,z,j,Si.disabled,ka(t,E.transform.zoom,s.paint.get("heatmap-intensity"),1),Ae,pe,s.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,s.paint,E.transform.zoom,J)}function Gs(E,t,s,d,x){const T=E.context,M=T.gl,z=E.transform;T.setColorMode(E.colorModeForRenderPass());const j=Li(T,t),Z=s.key,W=t.heatmapFbos.get(Z);if(!W)return;T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,W.colorAttachment.get()),T.activeTexture.set(M.TEXTURE1),j.bind(M.LINEAR,M.CLAMP_TO_EDGE);const ee=z.getProjectionData({overscaledTileID:s,applyTerrainMatrix:x,applyGlobeMatrix:!d});E.useProgram("heatmapTexture").draw(T,M.TRIANGLES,pi.disabled,Oi.disabled,E.colorModeForRenderPass(),Si.disabled,Vi(E,t,0,1),null,ee,t.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments,t.paint,z.zoom),W.destroy(),t.heatmapFbos.delete(Z)}function _r(E,t,s){var d,x;const T=E.gl,M=T.createTexture();T.bindTexture(T.TEXTURE_2D,M),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR);const z=(d=E.HALF_FLOAT)!==null&&d!==void 0?d:T.UNSIGNED_BYTE,j=(x=E.RGBA16F)!==null&&x!==void 0?x:T.RGBA;T.texImage2D(T.TEXTURE_2D,0,j,t,s,0,T.RGBA,z,null);const Z=E.createFramebuffer(t,s,!1,!1);return Z.colorAttachment.set(M),Z}function Li(E,t){return t.colorRampTexture||(t.colorRampTexture=new h.T(E,t.colorRamp,E.gl.RGBA)),t.colorRampTexture}function Bl(E,t,s,d,x,T,M,z){let j=256;if(x.stepInterpolant){const Z=t.getSource().maxzoom,W=M.canonical.z===Z?Math.ceil(1<<E.transform.maxZoom-M.canonical.z):1;j=h.an(h.ce(T.maxLineLength/h.a5*1024*W),256,s.maxTextureSize)}return z.gradient=h.cf({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:j,image:z.gradient||void 0,clips:T.lineClipsArray}),z.texture?z.texture.update(z.gradient):z.texture=new h.T(s,z.gradient,d.RGBA),z.version=x.gradientVersion,z.texture}function to(E,t,s,d,x){E.activeTexture.set(t.TEXTURE0),s.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),d.updatePaintBuffers(x)}function Xr(E,t,s,d,x,T){(x||E.lineAtlas.dirty)&&(t.activeTexture.set(s.TEXTURE0),E.lineAtlas.bind(t)),d.updatePaintBuffers(T)}function Oa(E,t,s,d,x,T,M){const z=T.gradients[x.id];let j=z.texture;x.gradientVersion!==z.version&&(j=Bl(E,t,s,d,x,T,M,z)),s.activeTexture.set(d.TEXTURE0),j.bind(x.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE)}function za(E,t,s,d,x,T,M,z,j){const Z=T.gradients[x.id];let W=Z.texture;x.gradientVersion!==Z.version&&(W=Bl(E,t,s,d,x,T,M,Z)),s.activeTexture.set(d.TEXTURE0),W.bind(x.stepInterpolant?d.NEAREST:d.LINEAR,d.CLAMP_TO_EDGE),s.activeTexture.set(d.TEXTURE1),E.lineAtlas.bind(s),z.updatePaintBuffers(j)}function eh(E,t,s,d,x){if(!s||!d||!d.imageAtlas)return;const T=d.imageAtlas.patternPositions;let M=T[s.to.toString()],z=T[s.from.toString()];if(!M&&z&&(M=z),!z&&M&&(z=M),!M||!z){const j=x.getPaintProperty(t);M=T[j],z=T[j]}M&&z&&E.setConstantPatternPositions(M,z)}function ul(E,t,s,d,x,T,M,z){const j=E.context.gl,Z="fill-pattern",W=s.paint.get(Z),ee=W&&W.constantOr(1),J=s.getCrossfadeParameters();let se,pe,Ae,Ne,Re;const Be=E.transform,We=s.paint.get("fill-translate"),Le=s.paint.get("fill-translate-anchor");M?(pe=ee&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",se=j.LINES):(pe=ee?"fillPattern":"fill",se=j.TRIANGLES);const Ze=W.constantOr(null);for(const et of d){const Ve=t.getTile(et);if(ee&&!Ve.patternsLoaded())continue;const ut=Ve.getBucket(s);if(!ut)continue;const Mt=ut.programConfigurations.get(s.id),Et=E.useProgram(pe,Mt),At=E.style.map.terrain&&E.style.map.terrain.getTerrainData(et);ee&&(E.context.activeTexture.set(j.TEXTURE0),Ve.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Mt.updatePaintBuffers(J)),eh(Mt,Z,Ze,Ve,s);const Ct=Be.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),dn=h.aO(Be,Ve,We,Le);if(M){Ne=ut.indexBuffer2,Re=ut.segments2;const Qt=[j.drawingBufferWidth,j.drawingBufferHeight];Ae=pe==="fillOutlinePattern"&&ee?Uh(E,J,Ve,Qt,dn):sl(Qt,dn)}else Ne=ut.indexBuffer,Re=ut.segments,Ae=ee?Pl(E,J,Ve,dn):{u_fill_translate:dn};const mn=E.stencilModeForClipping(et);Et.draw(E.context,se,x,mn,T,Si.backCCW,Ae,At,Ct,s.id,ut.layoutVertexBuffer,Ne,Re,s.paint,E.transform.zoom,Mt)}}function hl(E,t,s,d,x,T,M,z){const j=E.context,Z=j.gl,W="fill-extrusion-pattern",ee=s.paint.get(W),J=ee.constantOr(1),se=s.getCrossfadeParameters(),pe=s.paint.get("fill-extrusion-opacity"),Ae=ee.constantOr(null),Ne=E.transform;for(const Re of d){const Be=t.getTile(Re),We=Be.getBucket(s);if(!We)continue;const Le=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Re),Ze=We.programConfigurations.get(s.id),et=E.useProgram(J?"fillExtrusionPattern":"fillExtrusion",Ze);J&&(E.context.activeTexture.set(Z.TEXTURE0),Be.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Ze.updatePaintBuffers(se));const Ve=Ne.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!z,applyTerrainMatrix:!0});eh(Ze,W,Ae,Be,s);const ut=h.aO(Ne,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Mt=s.paint.get("fill-extrusion-vertical-gradient"),Et=J?Ta(E,Mt,pe,ut,Re,se,Be):Dc(E,Mt,pe,ut);et.draw(j,j.gl.TRIANGLES,x,T,M,Si.backCCW,Et,Le,Ve,s.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,s.paint,E.transform.zoom,Ze,E.style.map.terrain&&We.centroidVertexBuffer)}}function dl(E,t,s,d,x,T,M,z,j){var Z;const W=E.style.projection,ee=E.context,J=E.transform,se=ee.gl,pe=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],Ae=E.useProgram("hillshade",null,!1,pe),Ne=!E.options.moving;for(const Re of d){const Be=t.getTile(Re),We=Be.fbo;if(!We)continue;const Le=W.getMeshFromTileID(ee,Re.canonical,z,!0,"raster"),Ze=(Z=E.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(Re);ee.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,We.colorAttachment.get());const et=J.getProjectionData({overscaledTileID:Re,aligned:Ne,applyGlobeMatrix:!j,applyTerrainMatrix:!0});Ae.draw(ee,se.TRIANGLES,T,x[Re.overscaledZ],M,Si.backCCW,al(E,Be,s),Ze,et,s.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}}function Fl(E,t,s,d,x,T,M,z,j){var Z;const W=E.style.projection,ee=E.context,J=E.transform,se=ee.gl,pe=E.useProgram("colorRelief"),Ae=!E.options.moving;let Ne=!0,Re=0;for(const Be of d){const We=t.getTile(Be),Le=We.dem;if(Ne){const Et=se.getParameter(se.MAX_TEXTURE_SIZE),{elevationTexture:At,colorTexture:Ct}=s.getColorRampTextures(ee,Et,Le.getUnpackVector());ee.activeTexture.set(se.TEXTURE1),At.bind(se.NEAREST,se.CLAMP_TO_EDGE),ee.activeTexture.set(se.TEXTURE4),Ct.bind(se.LINEAR,se.CLAMP_TO_EDGE),Ne=!1,Re=At.size[0]}if(!Le||!Le.data)continue;const Ze=Le.stride,et=Le.getPixels();if(ee.activeTexture.set(se.TEXTURE0),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),We.demTexture=We.demTexture||E.getTileTexture(Ze),We.demTexture){const Et=We.demTexture;Et.update(et,{premultiply:!1}),Et.bind(se.LINEAR,se.CLAMP_TO_EDGE)}else We.demTexture=new h.T(ee,et,se.RGBA,{premultiply:!1}),We.demTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Ve=W.getMeshFromTileID(ee,Be.canonical,z,!0,"raster"),ut=(Z=E.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(Be),Mt=J.getProjectionData({overscaledTileID:Be,aligned:Ae,applyGlobeMatrix:!j,applyTerrainMatrix:!0});pe.draw(ee,se.TRIANGLES,T,x[Be.overscaledZ],M,Si.backCCW,u(s,We.dem,Re),ut,Mt,s.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}const jl=[new h.P(0,0),new h.P(h.a5,0),new h.P(h.a5,h.a5),new h.P(0,h.a5)];function yo(E,t,s,d,x,T,M,z,j=!1,Z=!1){const W=d[d.length-1].overscaledZ,ee=E.context,J=ee.gl,se=E.useProgram("raster"),pe=E.transform,Ae=E.style.projection,Ne=E.colorModeForRenderPass(),Re=!E.options.moving,Be=s.paint.get("raster-opacity"),We=s.paint.get("raster-resampling"),Le=s.paint.get("raster-fade-duration"),Ze=!!E.style.map.terrain;for(const et of d){const Ve=E.getDepthModeForSublayer(et.overscaledZ-W,Be===1?pi.ReadWrite:pi.ReadOnly,J.LESS),ut=t.getTile(et),Mt=We==="nearest"?J.NEAREST:J.LINEAR;ee.activeTexture.set(J.TEXTURE0),ut.texture.bind(Mt,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),ee.activeTexture.set(J.TEXTURE1);const{parentTile:Et,parentScaleBy:At,parentTopLeft:Ct,fadeValues:dn}=fl(ut,t,Le,Ze);ut.fadeOpacity=dn.tileOpacity,Et?(Et.fadeOpacity=dn.parentTileOpacity,Et.texture.bind(Mt,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST)):ut.texture.bind(Mt,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),ut.texture.useMipmap&&ee.extTextureFilterAnisotropic&&E.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const mn=E.style.map.terrain&&E.style.map.terrain.getTerrainData(et),Qt=pe.getProjectionData({overscaledTileID:et,aligned:Re,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),En=te(Ct,At,dn.fadeMix,s,z),mi=Ae.getMeshFromTileID(ee,et.canonical,T,M,"raster");se.draw(ee,J.TRIANGLES,Ve,x?x[et.overscaledZ]:Oi.disabled,Ne,j?Si.frontCCW:Si.backCCW,En,mn,Qt,s.id,mi.vertexBuffer,mi.indexBuffer,mi.segments)}}function fl(E,t,s,d){const x={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(s===0||d)return x;if(E.fadingParentID){const T=t.getLoadedTile(E.fadingParentID);if(!T)return x;const M=Math.pow(2,T.tileID.overscaledZ-E.tileID.overscaledZ),z=[E.tileID.canonical.x*M%1,E.tileID.canonical.y*M%1],j=(function(Z,W,ee){const J=ye(),se=(J-W.timeAdded)/ee,pe=Z.fadingDirection===de.Incoming,Ae=h.an((J-Z.timeAdded)/ee,0,1),Ne=h.an(1-se,0,1),Re=pe?Ae:Ne;return{tileOpacity:Re,parentTileOpacity:pe?Ne:Ae,fadeMix:{opacity:1,mix:1-Re}}})(E,T,s);return{parentTile:T,parentScaleBy:M,parentTopLeft:z,fadeValues:j}}if(E.selfFading){const T=(function(M,z){const j=(ye()-M.timeAdded)/z,Z=h.an(j,0,1);return{tileOpacity:Z,fadeMix:{opacity:Z,mix:0}}})(E,s);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:T}}return x}const Ul=new h.bp(1,0,0,1),pl=new h.bp(0,1,0,1),Zh=new h.bp(0,0,1,1),Xh=new h.bp(1,0,1,1),no=new h.bp(0,1,1,1);function gu(E,t,s,d){ps(E,0,t+s/2,E.transform.width,s,d)}function Vl(E,t,s,d){ps(E,t-s/2,0,s,E.transform.height,d)}function ps(E,t,s,d,x,T){const M=E.context,z=M.gl;z.enable(z.SCISSOR_TEST),z.scissor(t*E.pixelRatio,s*E.pixelRatio,d*E.pixelRatio,x*E.pixelRatio),M.clear({color:T}),z.disable(z.SCISSOR_TEST)}function th(E,t,s){const d=E.context,x=d.gl,T=E.useProgram("debug"),M=pi.disabled,z=Oi.disabled,j=E.colorModeForRenderPass(),Z="$debug",W=E.style.map.terrain&&E.style.map.terrain.getTerrainData(s);d.activeTexture.set(x.TEXTURE0);const ee=t.getTileByID(s.key).latestRawTileData,J=Math.floor((ee&&ee.byteLength||0)/1024),se=t.getTile(s).tileSize,pe=512/Math.min(se,512)*(s.overscaledZ/E.transform.zoom)*.5;let Ae=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Ae+=` => ${s.overscaledZ}`),(function(Re,Be){Re.initDebugOverlayCanvas();const We=Re.debugOverlayCanvas,Le=Re.context.gl,Ze=Re.debugOverlayCanvas.getContext("2d");Ze.clearRect(0,0,We.width,We.height),Ze.shadowColor="white",Ze.shadowBlur=2,Ze.lineWidth=1.5,Ze.strokeStyle="white",Ze.textBaseline="top",Ze.font="bold 36px Open Sans, sans-serif",Ze.fillText(Be,5,5),Ze.strokeText(Be,5,5),Re.debugOverlayTexture.update(We),Re.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)})(E,`${Ae} ${J}kB`);const Ne=E.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(d,x.TRIANGLES,M,z,er.alphaBlended,Si.disabled,Ol(h.bp.transparent,pe),null,Ne,Z,E.debugBuffer,E.quadTriangleIndexBuffer,E.debugSegments),T.draw(d,x.LINE_STRIP,M,z,j,Si.disabled,Ol(h.bp.red),W,Ne,Z,E.debugBuffer,E.tileBorderIndexBuffer,E.debugSegments)}function Wh(E,t,s,d){const{isRenderingGlobe:x}=d,T=E.context,M=T.gl,z=E.transform,j=E.colorModeForRenderPass(),Z=E.getDepthModeFor3D(),W=E.useProgram("terrain");T.bindFramebuffer.set(null),T.viewport.set([0,0,E.width,E.height]);for(const ee of s){const J=t.getTerrainMesh(ee.tileID),se=E.renderToTexture.getTexture(ee),pe=t.getTerrainData(ee.tileID);T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,se.texture);const Ae=t.getMeshFrameDelta(z.zoom),Ne=z.calculateFogMatrix(ee.tileID.toUnwrapped()),Re=ac(Ae,Ne,E.style.sky,z.pitch,x),Be=z.getProjectionData({overscaledTileID:ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(T,M.TRIANGLES,Z,Oi.disabled,j,Si.backCCW,Re,pe,Be,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}}function Gd(E,t){if(!t.mesh){const s=new h.aW;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const d=new h.aY;d.emplaceBack(0,1,2),d.emplaceBack(0,2,3),t.mesh=new lr(E.createVertexBuffer(s,oi.members),E.createIndexBuffer(d),h.aX.simpleSegment(0,0,s.length,d.length))}return t.mesh}class tp{constructor(t,s){this.context=new fc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=vi.maxOverzooming+vi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wi}resize(t,s,d){if(this.width=Math.floor(t*d),this.height=Math.floor(s*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const t=this.context,s=new h.aW;s.emplaceBack(0,0),s.emplaceBack(h.a5,0),s.emplaceBack(0,h.a5),s.emplaceBack(h.a5,h.a5),this.tileExtentBuffer=t.createVertexBuffer(s,oi.members),this.tileExtentSegments=h.aX.simpleSegment(0,0,4,2);const d=new h.aW;d.emplaceBack(0,0),d.emplaceBack(h.a5,0),d.emplaceBack(0,h.a5),d.emplaceBack(h.a5,h.a5),this.debugBuffer=t.createVertexBuffer(d,oi.members),this.debugSegments=h.aX.simpleSegment(0,0,4,5);const x=new h.ch;x.emplaceBack(0,0,0,0),x.emplaceBack(h.a5,0,h.a5,0),x.emplaceBack(0,h.a5,0,h.a5),x.emplaceBack(h.a5,h.a5,h.a5,h.a5),this.rasterBoundsBuffer=t.createVertexBuffer(x,hu.members),this.rasterBoundsSegments=h.aX.simpleSegment(0,0,4,2);const T=new h.aW;T.emplaceBack(0,0),T.emplaceBack(h.a5,0),T.emplaceBack(0,h.a5),T.emplaceBack(h.a5,h.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(T,oi.members),this.rasterBoundsSegmentsPosOnly=h.aX.simpleSegment(0,0,4,5);const M=new h.aW;M.emplaceBack(0,0),M.emplaceBack(1,0),M.emplaceBack(0,1),M.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(M,oi.members),this.viewportSegments=h.aX.simpleSegment(0,0,4,2);const z=new h.ci;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(z);const j=new h.aY;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(j);const Z=this.context.gl;this.stencilClearMode=new Oi({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO),this.tileExtentMesh=new lr(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=h.N();h.c7(d,0,this.width,this.height,0,0,1),h.Q(d,d,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const x={mainMatrix:d,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:d};this.useProgram("clippingMask",null,!0).draw(t,s.TRIANGLES,pi.disabled,this.stencilClearMode,er.disabled,Si.disabled,null,null,x,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,d){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source,this.nextStencilID+s.length>256&&this.clearStencil();const x=this.context;x.setColorMode(er.disabled),x.setDepthMode(pi.disabled);const T={};for(const M of s)T[M.key]=this.nextStencilID++;this._renderTileMasks(T,s,d,!0),this._renderTileMasks(T,s,d,!1),this._tileClippingMaskIDs=T}_renderTileMasks(t,s,d,x){const T=this.context,M=T.gl,z=this.style.projection,j=this.transform,Z=this.useProgram("clippingMask");for(const W of s){const ee=t[W.key],J=this.style.map.terrain&&this.style.map.terrain.getTerrainData(W),se=z.getMeshFromTileID(this.context,W.canonical,x,!0,"stencil"),pe=j.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!d,applyTerrainMatrix:!0});Z.draw(T,M.TRIANGLES,pi.disabled,new Oi({func:M.ALWAYS,mask:0},ee,255,M.KEEP,M.KEEP,M.REPLACE),er.disabled,d?Si.disabled:Si.backCCW,null,J,pe,"$clipping",se.vertexBuffer,se.indexBuffer,se.segments)}}_renderTilesDepthBuffer(){const t=this.context,s=t.gl,d=this.style.projection,x=this.transform,T=this.useProgram("depth"),M=this.getDepthModeFor3D(),z=nn(x,{tileSize:x.tileSize});for(const j of z){const Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j),W=d.getMeshFromTileID(this.context,j.canonical,!0,!0,"raster"),ee=x.getProjectionData({overscaledTileID:j,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(t,s.TRIANGLES,M,Oi.disabled,er.disabled,Si.backCCW,null,Z,ee,"$clipping",W.vertexBuffer,W.indexBuffer,W.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Oi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Oi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const s=this.context.gl,d=t.sort(((M,z)=>z.overscaledZ-M.overscaledZ)),x=d[d.length-1].overscaledZ,T=d[0].overscaledZ-x+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const M={};for(let z=0;z<T;z++)M[z+x]=new Oi({func:s.GEQUAL,mask:255},z+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=T,[M,d]}return[{[x]:Oi.disabled},d]}stencilConfigForOverlapTwoPass(t){const s=this.context.gl,d=t.sort(((M,z)=>z.overscaledZ-M.overscaledZ)),x=d[d.length-1].overscaledZ,T=d[0].overscaledZ-x+1;if(this.clearStencil(),T>1){const M={},z={};for(let j=0;j<T;j++)M[j+x]=new Oi({func:s.GREATER,mask:255},T+1+j,255,s.KEEP,s.KEEP,s.REPLACE),z[j+x]=new Oi({func:s.GREATER,mask:255},1+j,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*T+1,[M,z,d]}return this.nextStencilID=3,[{[x]:new Oi({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[x]:new Oi({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new er([t.CONSTANT_COLOR,t.ONE],new h.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?er.unblended:er.alphaBlended}getDepthModeForSublayer(t,s,d){if(!this.opaquePassEnabledForLayer())return pi.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new pi(d||this.context.gl.LEQUAL,s,[x,x])}getDepthModeFor3D(){return new pi(this.context.gl.LEQUAL,pi.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){var d,x;this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ye()),this.imageManager.beginFrame();const T=this.style._order,M=this.style.tileManagers,z={},j={},Z={},W={isRenderingToTexture:!1,isRenderingGlobe:((d=t.projection)===null||d===void 0?void 0:d.transitionState)>0};for(const J in M){const se=M[J];se.used&&se.prepare(this.context),z[J]=se.getVisibleCoordinates(!1),j[J]=z[J].slice().reverse(),Z[J]=se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let J=0;J<T.length;J++)if(this.style._layers[T[J]].is3D()){this.opaquePassCutoff=J;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const J of T){const se=this.style._layers[J];if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;const pe=j[se.source];(se.type==="custom"||pe.length)&&this.renderLayer(this,M[se.source],se,pe,W)}if((x=this.style.projection)===null||x===void 0||x.updateGPUdependent({context:this.context,useProgram:J=>this.useProgram(J)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.bp.black:h.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(J,se){const pe=J.context,Ae=pe.gl,Ne=((et,Ve,ut)=>{const Mt=Math.cos(Ve.rollInRadians),Et=Math.sin(Ve.rollInRadians),At=Ot(Ve),Ct=Ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:et.properties.get("sky-color"),u_horizon_color:et.properties.get("horizon-color"),u_horizon:[(Ve.width/2-At*Et)*ut,(Ve.height/2+At*Mt)*ut],u_horizon_normal:[-Et,Mt],u_sky_horizon_blend:et.properties.get("sky-horizon-blend")*Ve.height/2*ut,u_sky_blend:Ct}})(se,J.style.map.transform,J.pixelRatio),Re=new pi(Ae.LEQUAL,pi.ReadWrite,[0,1]),Be=Oi.disabled,We=J.colorModeForRenderPass(),Le=J.useProgram("sky"),Ze=Gd(pe,se);Le.draw(pe,Ae.TRIANGLES,Re,Be,We,Si.disabled,Ne,null,void 0,"sky",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const J=this.style._layers[T[this.currentLayer]],se=M[J.source],pe=z[J.source];this._renderTileClippingMasks(J,pe,!1),this.renderLayer(this,se,J,pe,W)}this.renderPass="translucent";let ee=!1;for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const J=this.style._layers[T[this.currentLayer]],se=M[J.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(J,W))continue;this.opaquePassEnabledForLayer()||ee||(ee=!0,W.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const pe=(J.type==="symbol"?Z:j)[J.source];this._renderTileClippingMasks(J,z[J.source],!!this.renderToTexture),this.renderLayer(this,se,J,pe,W)}if(W.isRenderingGlobe&&(function(J,se,pe){const Ae=J.context,Ne=Ae.gl,Re=J.useProgram("atmosphere"),Be=new pi(Ne.LEQUAL,pi.ReadOnly,[0,1]),We=J.transform,Le=(function(Ct,dn){const mn=Ct.properties.get("position"),Qt=[-mn.x,-mn.y,-mn.z],En=h.ar(new Float64Array(16));return Ct.properties.get("anchor")==="map"&&(h.bg(En,En,dn.rollInRadians),h.bh(En,En,-dn.pitchInRadians),h.bg(En,En,dn.bearingInRadians),h.bh(En,En,dn.center.lat*Math.PI/180),h.bJ(En,En,-dn.center.lng*Math.PI/180)),h.cg(Qt,Qt,En),Qt})(pe,J.transform),Ze=We.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),et=se.properties.get("atmosphere-blend")*Ze.projectionTransition;if(et===0)return;const Ve=kr(We.worldSize,We.center.lat),ut=We.inverseProjectionMatrix,Mt=new Float64Array(4);Mt[3]=1,h.aH(Mt,Mt,We.modelViewProjectionMatrix),Mt[0]/=Mt[3],Mt[1]/=Mt[3],Mt[2]/=Mt[3],Mt[3]=1,h.aH(Mt,Mt,ut),Mt[0]/=Mt[3],Mt[1]/=Mt[3],Mt[2]/=Mt[3],Mt[3]=1;const Et=((Ct,dn,mn,Qt,En)=>({u_sun_pos:Ct,u_atmosphere_blend:dn,u_globe_position:mn,u_globe_radius:Qt,u_inv_proj_matrix:En}))(Le,et,[Mt[0],Mt[1],Mt[2]],Ve,ut),At=Gd(Ae,se);Re.draw(Ae,Ne.TRIANGLES,Be,Oi.disabled,er.alphaBlended,Si.disabled,Et,null,null,"atmosphere",At.vertexBuffer,At.indexBuffer,At.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const J=(function(se,pe){let Ae=null;const Ne=Object.values(se._layers).flatMap((Le=>Le.source&&!Le.isHidden(pe)?[se.tileManagers[Le.source]]:[])),Re=Ne.filter((Le=>Le.getSource().type==="vector")),Be=Ne.filter((Le=>Le.getSource().type!=="vector")),We=Le=>{(!Ae||Ae.getSource().maxzoom<Le.getSource().maxzoom)&&(Ae=Le)};return Re.forEach((Le=>We(Le))),Ae||Be.forEach((Le=>We(Le))),Ae})(this.style,this.transform.zoom);J&&(function(se,pe,Ae){for(let Ne=0;Ne<Ae.length;Ne++)th(se,pe,Ae[Ne])})(this,J,J.getVisibleCoordinates())}this.options.showPadding&&(function(J){const se=J.transform.padding;gu(J,J.transform.height-(se.top||0),3,Ul),gu(J,se.bottom||0,3,pl),Vl(J,se.left||0,3,Zh),Vl(J,J.transform.width-(se.right||0),3,Xh);const pe=J.transform.centerPoint;(function(Ae,Ne,Re,Be){ps(Ae,Ne-1,Re-10,2,20,Be),ps(Ae,Ne-10,Re-1,20,2,Be)})(J,pe.x,J.transform.height-pe.y,no)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=t?!h.cj(s,d):!h.ck(s,d)),x||(x=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),x&&(h.cl(s,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(T,M){const z=T.context,j=z.gl,Z=T.transform,W=er.unblended,ee=new pi(j.LEQUAL,pi.ReadWrite,[0,1]),J=M.tileManager.getRenderableTiles(),se=T.useProgram("terrainDepth");z.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),z.clear({color:h.bp.transparent,depth:1});for(const pe of J){const Ae=M.getTerrainMesh(pe.tileID),Ne=M.getTerrainData(pe.tileID),Re=Z.getProjectionData({overscaledTileID:pe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Be={u_ele_delta:M.getMeshFrameDelta(Z.zoom)};se.draw(z,j.TRIANGLES,ee,Oi.disabled,W,Si.backCCW,Be,Ne,Re,"terrain",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,T.width,T.height])})(this,this.style.map.terrain),(function(T,M){const z=T.context,j=z.gl,Z=T.transform,W=er.unblended,ee=new pi(j.LEQUAL,pi.ReadWrite,[0,1]),J=M.getCoordsTexture(),se=M.tileManager.getRenderableTiles(),pe=T.useProgram("terrainCoords");z.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),z.clear({color:h.bp.transparent,depth:1}),M.coordsIndex=[];for(const Ae of se){const Ne=M.getTerrainMesh(Ae.tileID),Re=M.getTerrainData(Ae.tileID);z.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,J.texture);const Be={u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(Z.zoom)},We=Z.getProjectionData({overscaledTileID:Ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});pe.draw(z,j.TRIANGLES,ee,Oi.disabled,W,Si.backCCW,Be,Re,We,"terrain",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments),M.coordsIndex.push(Ae.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,T.width,T.height])})(this,this.style.map.terrain))}renderLayer(t,s,d,x,T){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||(x||[]).length)&&(this.id=d.id,h.cm(d)?(function(M,z,j,Z,W,ee){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:J}=ee,se=Oi.disabled,pe=M.colorModeForRenderPass();(j._unevaluatedLayout.hasValue("text-variable-anchor")||j._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Ae,Ne,Re,Be,We,Le,Ze,et,Ve){const ut=Ne.transform,Mt=Ne.style.map.terrain,Et=We==="map",At=Le==="map";for(const Ct of Ae){const dn=Be.getTile(Ct),mn=dn.getBucket(Re);if(!mn||!mn.text||!mn.text.segments.get().length)continue;const Qt=h.ay(mn.textSizeData,ut.zoom),En=h.aN(dn,1,Ne.transform.zoom),mi=vs(Et,Ne.transform,En),ar=Re.layout.get("icon-text-fit")!=="none"&&mn.hasIconData();if(Qt){const Ir=Math.pow(2,ut.zoom-dn.tileID.overscaledZ),br=Mt?(Fr,fr)=>Mt.getElevation(Ct,Fr,fr):null;Ll(mn,Et,At,Ve,ut,mi,Ir,Qt,ar,h.aO(ut,dn,Ze,et),Ct.toUnwrapped(),br)}}})(Z,M,j,z,j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),W),j.paint.get("icon-opacity").constantOr(1)!==0&&Oc(M,z,j,Z,!1,j.paint.get("icon-translate"),j.paint.get("icon-translate-anchor"),j.layout.get("icon-rotation-alignment"),j.layout.get("icon-pitch-alignment"),j.layout.get("icon-keep-upright"),se,pe,J),j.paint.get("text-opacity").constantOr(1)!==0&&Oc(M,z,j,Z,!0,j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.layout.get("text-keep-upright"),se,pe,J),z.map.showCollisionBoxes&&(Vs(M,z,j,Z,!0),Vs(M,z,j,Z,!1))})(t,s,d,x,this.style.placement.variableOffsets,T):h.cn(d)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=j.paint.get("circle-opacity"),se=j.paint.get("circle-stroke-width"),pe=j.paint.get("circle-stroke-opacity"),Ae=!j.layout.get("circle-sort-key").isConstant();if(J.constantOr(1)===0&&(se.constantOr(1)===0||pe.constantOr(1)===0))return;const Ne=M.context,Re=Ne.gl,Be=M.transform,We=M.getDepthModeForSublayer(0,pi.ReadOnly),Le=Oi.disabled,Ze=M.colorModeForRenderPass(),et=[],Ve=Be.getCircleRadiusCorrection();for(let ut=0;ut<Z.length;ut++){const Mt=Z[ut],Et=z.getTile(Mt),At=Et.getBucket(j);if(!At)continue;const Ct=j.paint.get("circle-translate"),dn=j.paint.get("circle-translate-anchor"),mn=h.aO(Be,Et,Ct,dn),Qt=At.programConfigurations.get(j.id),En=M.useProgram("circle",Qt),mi=At.layoutVertexBuffer,ar=At.indexBuffer,Ir=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Mt),br={programConfiguration:Qt,program:En,layoutVertexBuffer:mi,indexBuffer:ar,uniformValues:oc(M,Et,j,mn,Ve),terrainData:Ir,projectionData:Be.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!ee,applyTerrainMatrix:!0})};if(Ae){const Fr=At.segments.get();for(const fr of Fr)et.push({segments:new h.aX([fr]),sortKey:fr.sortKey,state:br})}else et.push({segments:At.segments,sortKey:0,state:br})}Ae&&et.sort(((ut,Mt)=>ut.sortKey-Mt.sortKey));for(const ut of et){const{programConfiguration:Mt,program:Et,layoutVertexBuffer:At,indexBuffer:Ct,uniformValues:dn,terrainData:mn,projectionData:Qt}=ut.state;Et.draw(Ne,Re.TRIANGLES,We,Le,Ze,Si.backCCW,dn,mn,Qt,j.id,At,Ct,ut.segments,j.paint,M.transform.zoom,Mt)}})(t,s,d,x,T):h.co(d)?(function(M,z,j,Z,W){if(j.paint.get("heatmap-opacity")===0)return;const ee=M.context,{isRenderingToTexture:J,isRenderingGlobe:se}=W;if(M.style.map.terrain){for(const pe of Z){const Ae=z.getTile(pe);z.hasRenderableParent(pe)||(M.renderPass==="offscreen"?Vd(M,Ae,j,pe,se):M.renderPass==="translucent"&&Gs(M,j,pe,J,se))}ee.viewport.set([0,0,M.width,M.height])}else M.renderPass==="offscreen"?(function(pe,Ae,Ne,Re){const Be=pe.context,We=Be.gl,Le=pe.transform,Ze=Oi.disabled,et=new er([We.ONE,We.ONE],h.bp.transparent,[!0,!0,!0,!0]);(function(Ve,ut,Mt){const Et=Ve.gl;Ve.activeTexture.set(Et.TEXTURE1),Ve.viewport.set([0,0,ut.width/4,ut.height/4]);let At=Mt.heatmapFbos.get(h.cd);At?(Et.bindTexture(Et.TEXTURE_2D,At.colorAttachment.get()),Ve.bindFramebuffer.set(At.framebuffer)):(At=_r(Ve,ut.width/4,ut.height/4),Mt.heatmapFbos.set(h.cd,At))})(Be,pe,Ne),Be.clear({color:h.bp.transparent});for(let Ve=0;Ve<Re.length;Ve++){const ut=Re[Ve];if(Ae.hasRenderableParent(ut))continue;const Mt=Ae.getTile(ut),Et=Mt.getBucket(Ne);if(!Et)continue;const At=Et.programConfigurations.get(Ne.id),Ct=pe.useProgram("heatmap",At),dn=Le.getProjectionData({overscaledTileID:ut,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),mn=Le.getCircleRadiusCorrection();Ct.draw(Be,We.TRIANGLES,pi.disabled,Ze,et,Si.backCCW,ka(Mt,Le.zoom,Ne.paint.get("heatmap-intensity"),mn),null,dn,Ne.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,Ne.paint,Le.zoom,At)}Be.viewport.set([0,0,pe.width,pe.height])})(M,z,j,Z):M.renderPass==="translucent"&&(function(pe,Ae){const Ne=pe.context,Re=Ne.gl;Ne.setColorMode(pe.colorModeForRenderPass());const Be=Ae.heatmapFbos.get(h.cd);Be&&(Ne.activeTexture.set(Re.TEXTURE0),Re.bindTexture(Re.TEXTURE_2D,Be.colorAttachment.get()),Ne.activeTexture.set(Re.TEXTURE1),Li(Ne,Ae).bind(Re.LINEAR,Re.CLAMP_TO_EDGE),pe.useProgram("heatmapTexture").draw(Ne,Re.TRIANGLES,pi.disabled,Oi.disabled,pe.colorModeForRenderPass(),Si.disabled,Vi(pe,Ae,0,1),null,null,Ae.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments,Ae.paint,pe.transform.zoom))})(M,j)})(t,s,d,x,T):h.cp(d)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=j.paint.get("line-opacity"),se=j.paint.get("line-width");if(J.constantOr(1)===0||se.constantOr(1)===0)return;const pe=M.getDepthModeForSublayer(0,pi.ReadOnly),Ae=M.colorModeForRenderPass(),Ne=j.paint.get("line-dasharray"),Re=Ne.constantOr(1),Be=j.paint.get("line-pattern"),We=Be.constantOr(1),Le=j.paint.get("line-gradient"),Ze=j.getCrossfadeParameters();let et;et=We?"linePattern":Re&&Le?"lineGradientSDF":Re?"lineSDF":Le?"lineGradient":"line";const Ve=M.context,ut=Ve.gl,Mt=M.transform;let Et=!0;for(const At of Z){const Ct=z.getTile(At);if(We&&!Ct.patternsLoaded())continue;const dn=Ct.getBucket(j);if(!dn)continue;const mn=dn.programConfigurations.get(j.id),Qt=M.context.program.get(),En=M.useProgram(et,mn),mi=Et||En.program!==Qt,ar=M.style.map.terrain&&M.style.map.terrain.getTerrainData(At),Ir=Be.constantOr(null),br=Ne&&Ne.constantOr(null);if(Ir&&Ct.imageAtlas){const Hs=Ct.imageAtlas,es=Hs.patternPositions[Ir.to.toString()],ts=Hs.patternPositions[Ir.from.toString()];es&&ts&&mn.setConstantPatternPositions(es,ts)}else if(br){const Hs=j.layout.get("line-cap")==="round",es=M.lineAtlas.getDash(br.to,Hs),ts=M.lineAtlas.getDash(br.from,Hs);mn.setConstantDashPositions(es,ts)}const Fr=Mt.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!ee,applyTerrainMatrix:!0}),fr=Mt.getPixelScale();let Yr;We?(Yr=w(M,Ct,j,fr,Ze),to(Ve,ut,Ct,mn,Ze)):Re&&Le?(Yr=P(M,Ct,j,fr,Ze,dn.lineClipsArray.length),za(M,z,Ve,ut,j,dn,At,mn,Ze)):Re?(Yr=I(M,Ct,j,fr,Ze),Xr(M,Ve,ut,mn,mi,Ze)):Le?(Yr=v(M,Ct,j,fr,dn.lineClipsArray.length),Oa(M,z,Ve,ut,j,dn,At)):Yr=m(M,Ct,j,fr);const jr=M.stencilModeForClipping(At);En.draw(Ve,ut.TRIANGLES,pe,jr,Ae,Si.disabled,Yr,ar,Fr,j.id,dn.layoutVertexBuffer,dn.indexBuffer,dn.segments,j.paint,M.transform.zoom,mn,dn.layoutVertexBuffer2),Et=!1}})(t,s,d,x,T):h.cq(d)?(function(M,z,j,Z,W){const ee=j.paint.get("fill-color"),J=j.paint.get("fill-opacity");if(J.constantOr(1)===0)return;const{isRenderingToTexture:se}=W,pe=M.colorModeForRenderPass(),Ae=j.paint.get("fill-pattern"),Ne=M.opaquePassEnabledForLayer()&&!Ae.constantOr(1)&&ee.constantOr(h.bp.transparent).a===1&&J.constantOr(0)===1?"opaque":"translucent";if(M.renderPass===Ne){const Re=M.getDepthModeForSublayer(1,M.renderPass==="opaque"?pi.ReadWrite:pi.ReadOnly);ul(M,z,j,Z,Re,pe,!1,se)}if(M.renderPass==="translucent"&&j.paint.get("fill-antialias")){const Re=M.getDepthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,pi.ReadOnly);ul(M,z,j,Z,Re,pe,!0,se)}})(t,s,d,x,T):h.cr(d)?(function(M,z,j,Z,W){const ee=j.paint.get("fill-extrusion-opacity");if(ee===0)return;const{isRenderingToTexture:J}=W;if(M.renderPass==="translucent"){const se=new pi(M.context.gl.LEQUAL,pi.ReadWrite,M.depthRangeFor3D);if(ee!==1||j.paint.get("fill-extrusion-pattern").constantOr(1))hl(M,z,j,Z,se,Oi.disabled,er.disabled,J),hl(M,z,j,Z,se,M.stencilModeFor3D(),M.colorModeForRenderPass(),J);else{const pe=M.colorModeForRenderPass();hl(M,z,j,Z,se,Oi.disabled,pe,J)}}})(t,s,d,x,T):h.cs(d)?(function(M,z,j,Z,W){if(M.renderPass!=="offscreen"&&M.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=M.context,se=M.style.projection.useSubdivision,pe=M.getDepthModeForSublayer(0,pi.ReadOnly),Ae=M.colorModeForRenderPass();if(M.renderPass==="offscreen")(function(Ne,Re,Be,We,Le,Ze,et){const Ve=Ne.context,ut=Ve.gl;for(const Mt of Be){const Et=Re.getTile(Mt),At=Et.dem;if(!At||!At.data||!Et.needsHillshadePrepare)continue;const Ct=At.dim,dn=At.stride,mn=At.getPixels();if(Ve.activeTexture.set(ut.TEXTURE1),Ve.pixelStoreUnpackPremultiplyAlpha.set(!1),Et.demTexture=Et.demTexture||Ne.getTileTexture(dn),Et.demTexture){const En=Et.demTexture;En.update(mn,{premultiply:!1}),En.bind(ut.NEAREST,ut.CLAMP_TO_EDGE)}else Et.demTexture=new h.T(Ve,mn,ut.RGBA,{premultiply:!1}),Et.demTexture.bind(ut.NEAREST,ut.CLAMP_TO_EDGE);Ve.activeTexture.set(ut.TEXTURE0);let Qt=Et.fbo;if(!Qt){const En=new h.T(Ve,{width:Ct,height:Ct,data:null},ut.RGBA);En.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),Qt=Et.fbo=Ve.createFramebuffer(Ct,Ct,!0,!1),Qt.colorAttachment.set(En.texture)}Ve.bindFramebuffer.set(Qt.framebuffer),Ve.viewport.set([0,0,Ct,Ct]),Ne.useProgram("hillshadePrepare").draw(Ve,ut.TRIANGLES,Le,Ze,et,Si.disabled,le(Et.tileID,At),null,null,We.id,Ne.rasterBoundsBuffer,Ne.quadTriangleIndexBuffer,Ne.rasterBoundsSegments),Et.needsHillshadePrepare=!1}})(M,z,Z,j,pe,Oi.disabled,Ae),J.viewport.set([0,0,M.width,M.height]);else if(M.renderPass==="translucent")if(se){const[Ne,Re,Be]=M.stencilConfigForOverlapTwoPass(Z);dl(M,z,j,Be,Ne,pe,Ae,!1,ee),dl(M,z,j,Be,Re,pe,Ae,!0,ee)}else{const[Ne,Re]=M.getStencilConfigForOverlapAndUpdateStencilID(Z);dl(M,z,j,Re,Ne,pe,Ae,!1,ee)}})(t,s,d,x,T):h.ct(d)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent"||!Z.length)return;const{isRenderingToTexture:ee}=W,J=M.style.projection.useSubdivision,se=M.getDepthModeForSublayer(0,pi.ReadOnly),pe=M.colorModeForRenderPass();if(J){const[Ae,Ne,Re]=M.stencilConfigForOverlapTwoPass(Z);Fl(M,z,j,Re,Ae,se,pe,!1,ee),Fl(M,z,j,Re,Ne,se,pe,!0,ee)}else{const[Ae,Ne]=M.getStencilConfigForOverlapAndUpdateStencilID(Z);Fl(M,z,j,Ne,Ae,se,pe,!1,ee)}})(t,s,d,x,T):h.bU(d)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent"||j.paint.get("raster-opacity")===0||!Z.length)return;const{isRenderingToTexture:ee}=W,J=z.getSource(),se=M.style.projection.useSubdivision;if(J instanceof ci)yo(M,z,j,Z,null,!1,!1,J.tileCoords,J.flippedWindingOrder,ee);else if(se){const[pe,Ae,Ne]=M.stencilConfigForOverlapTwoPass(Z);yo(M,z,j,Ne,pe,!1,!0,jl,!1,ee),yo(M,z,j,Ne,Ae,!0,!0,jl,!1,ee)}else{const[pe,Ae]=M.getStencilConfigForOverlapAndUpdateStencilID(Z);yo(M,z,j,Ae,pe,!1,!0,jl,!1,ee)}})(t,s,d,x,T):h.cu(d)?(function(M,z,j,Z,W){const ee=j.paint.get("background-color"),J=j.paint.get("background-opacity");if(J===0)return;const{isRenderingToTexture:se}=W,pe=M.context,Ae=pe.gl,Ne=M.style.projection,Re=M.transform,Be=Re.tileSize,We=j.paint.get("background-pattern");if(M.isPatternMissing(We))return;const Le=!We&&ee.a===1&&J===1&&M.opaquePassEnabledForLayer()?"opaque":"translucent";if(M.renderPass!==Le)return;const Ze=Oi.disabled,et=M.getDepthModeForSublayer(0,Le==="opaque"?pi.ReadWrite:pi.ReadOnly),Ve=M.colorModeForRenderPass(),ut=M.useProgram(We?"backgroundPattern":"background"),Mt=Z||nn(Re,{tileSize:Be,terrain:M.style.map.terrain});We&&(pe.activeTexture.set(Ae.TEXTURE0),M.imageManager.bind(M.context));const Et=j.getCrossfadeParameters();for(const At of Mt){const Ct=Re.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!se,applyTerrainMatrix:!0}),dn=We?Tt(J,M,We,{tileID:At,tileSize:Be},Et):lt(J,ee),mn=M.style.map.terrain&&M.style.map.terrain.getTerrainData(At),Qt=Ne.getMeshFromTileID(pe,At.canonical,!1,!0,"raster");ut.draw(pe,Ae.TRIANGLES,et,Ze,Ve,Si.backCCW,dn,mn,Ct,j.id,Qt.vertexBuffer,Qt.indexBuffer,Qt.segments)}})(t,0,d,x,T):h.cv(d)&&(function(M,z,j,Z){const{isRenderingGlobe:W}=Z,ee=M.context,J=j.implementation,se=M.style.projection,pe=M.transform,Ae=pe.getProjectionDataForCustomLayer(W),Ne={farZ:pe.farZ,nearZ:pe.nearZ,fov:pe.fov*Math.PI/180,modelViewProjectionMatrix:pe.modelViewProjectionMatrix,projectionMatrix:pe.projectionMatrix,shaderData:{variantName:se.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${se.shaderPreludeCode.vertexSource}`,define:se.shaderDefine},defaultProjectionData:Ae},Re=J.renderingMode?J.renderingMode:"2d";if(M.renderPass==="offscreen"){const Be=J.prerender;Be&&(M.setCustomLayerDefaults(),ee.setColorMode(M.colorModeForRenderPass()),Be.call(J,ee.gl,Ne),ee.setDirty(),M.setBaseState())}else if(M.renderPass==="translucent"){M.setCustomLayerDefaults(),ee.setColorMode(M.colorModeForRenderPass()),ee.setStencilMode(Oi.disabled);const Be=Re==="3d"?M.getDepthModeFor3D():M.getDepthModeForSublayer(0,pi.ReadOnly);ee.setDepthMode(Be),J.render(ee.gl,Ne),ee.setDirty(),M.setBaseState(),ee.bindFramebuffer.set(null)}})(t,0,d,T))}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),d=this.imageManager.getPattern(t.to.toString());return!s||!d}useProgram(t,s,d=!1,x=[]){this.cache=this.cache||{};const T=!!this.style.map.terrain,M=this.style.projection,z=d?Gi.projectionMercator:M.shaderPreludeCode,j=d?Mi:M.shaderDefine,Z=t+(s?s.cacheKey:"")+`/${d?ra:M.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(T?"/terrain":"")+(x?`/${x.join("/")}`:"");return this.cache[Z]||(this.cache[Z]=new Rc(this.context,Gi[t],s,vn[t],this._showOverdrawInspector,T,z,j,x)),this.cache[Z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,s;if(this._tileTextures){for(const d in this._tileTextures){const x=this._tileTextures[d];if(x)for(const T of x)T.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((s=this.tileExtentMesh.indexBuffer)===null||s===void 0||s.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const d in this.cache){const x=this.cache[d];x&&x.program&&this.context.gl.deleteProgram(x.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}function Hd(E,t){let s,d=!1,x=null,T=null;const M=()=>{x=null,d&&(E.apply(T,s),x=setTimeout(M,t),d=!1)};return(...z)=>(d=!0,T=this,s=z,x||M(),x)}class as{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let d;return s.split("&").map((x=>x.split("="))).forEach((x=>{x[0]===this._hashName&&(d=x)})),(d&&d[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:d,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const d=s.join("/");let x=d;x.split("&").length>0&&(x=x.split("&")[0]),this._hashName&&(x=`${this._hashName}=${d}`);let T=window.location.hash.replace(x,"");T.startsWith("#&")?T=T.slice(0,1)+T.slice(2):T==="#"&&(T="");let M=window.location.href.replace(/(#.+)?$/,T);M=M.replace("&&","&"),window.history.replaceState(window.history.state,null,M)},this._updateHash=Hd(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,x=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,x),M=Math.round(s.lng*T)/T,z=Math.round(s.lat*T)/T,j=this._map.getBearing(),Z=this._map.getPitch();let W="";if(W+=t?`/${M}/${z}/${d}`:`${d}/${z}/${M}`,(j||Z)&&(W+="/"+Math.round(10*j)/10),Z&&(W+=`/${Math.round(Z)}`),this._hashName){const ee=this._hashName;let J=!1;const se=window.location.hash.slice(1).split("&").map((pe=>{const Ae=pe.split("=")[0];return Ae===ee?(J=!0,`${Ae}=${W}`):pe})).filter((pe=>pe));return J||se.push(`${ee}=${W}`),`#${se.join("&")}`}return`#${W}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new h.V(+t[2],+t[1])}catch{return!1}const s=+t[0],d=+(t[3]||0),x=+(t[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&d>=-180&&d<=180&&x>=this._map.getMinPitch()&&x<=this._map.getMaxPitch()}}const ml={linearity:.3,easing:h.cw(0,0,.3,1)},yu=h.e({deceleration:2500,maxSpeed:1400},ml),ya=h.e({deceleration:20,maxSpeed:1400},ml),io=h.e({deceleration:1e3,maxSpeed:360},ml),zc=h.e({deceleration:1e3,maxSpeed:90},ml),xa=h.e({deceleration:1e3,maxSpeed:360},ml);class y0{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ye(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=ye();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)s.zoom+=T.zoomDelta||0,s.bearing+=T.bearingDelta||0,s.pitch+=T.pitchDelta||0,s.roll+=T.rollDelta||0,T.panDelta&&s.pan._add(T.panDelta),T.around&&(s.around=T.around),T.pinchAround&&(s.pinchAround=T.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(s.pan.mag()){const T=nh(s.pan.mag(),d,h.e({},yu,t||{})),M=s.pan.mult(T.amount/s.pan.mag()),z=this._map.cameraHelper.handlePanInertia(M,this._map.transform);x.center=z.easingCenter,x.offset=z.easingOffset,xu(x,T)}if(s.zoom){const T=nh(s.zoom,d,ya);x.zoom=this._map.transform.zoom+T.amount,xu(x,T)}if(s.bearing){const T=nh(s.bearing,d,io);x.bearing=this._map.transform.bearing+h.an(T.amount,-179,179),xu(x,T)}if(s.pitch){const T=nh(s.pitch,d,zc);x.pitch=this._map.transform.pitch+T.amount,xu(x,T)}if(s.roll){const T=nh(s.roll,d,xa);x.roll=this._map.transform.roll+h.an(T.amount,-179,179),xu(x,T)}if(x.zoom||x.bearing){const T=s.pinchAround===void 0?s.around:s.pinchAround;x.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),h.e(x,{noMoveStart:!0})}}function xu(E,t){(!E.duration||E.duration<t.duration)&&(E.duration=t.duration,E.easing=t.easing)}function nh(E,t,s){const{maxSpeed:d,linearity:x,deceleration:T}=s,M=h.an(E*x/(t/1e3),-d,d),z=Math.abs(M)/(T*x);return{easing:s.easing,duration:1e3*z,amount:M*(z/2)}}class zs extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d,x={}){d=d instanceof MouseEvent?d:new MouseEvent(t,d);const T=he.mousePos(s.getCanvas(),d),M=s.unproject(T);super(t,h.e({point:T,lngLat:M,originalEvent:d},x)),this._defaultPrevented=!1,this.target=s}}class Po extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d){const x=t==="touchend"?d.changedTouches:d.touches,T=he.touchPos(s.getCanvasContainer(),x),M=T.map((j=>s.unproject(j))),z=T.reduce(((j,Z,W,ee)=>j.add(Z.div(ee.length))),new h.P(0,0));super(t,{points:T,point:z,lngLats:M,lngLat:s.unproject(z),originalEvent:d}),this._defaultPrevented=!1}}class Yh extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d){super(t,{originalEvent:d}),this._defaultPrevented=!1}}class $h{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Yh(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new zs(t.type,this._map,t))}mouseup(t){this._map.fire(new zs(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new zs(t.type,this._map,t))}dblclick(t){return this._firePreventable(new zs(t.type,this._map,t))}mouseover(t){this._map.fire(new zs(t.type,this._map,t))}mouseout(t){this._map.fire(new zs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Po(t.type,this._map,t))}touchmove(t){this._map.fire(new Po(t.type,this._map,t))}touchend(t){this._map.fire(new Po(t.type,this._map,t))}touchcancel(t){this._map.fire(new Po(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class np{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new zs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new zs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oo{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(h.P.convert(t),this._map.terrain)}}class pc{constructor(t,s){this._map=t,this._tr=new Oo(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(he.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const d=s;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=d,this._box||(this._box=he.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(x.x,d.x),M=Math.max(x.x,d.x),z=Math.min(x.y,d.y),j=Math.max(x.y,d.y);he.setTransform(this._box,`translate(${T}px,${z}px)`),this._box.style.width=M-T+"px",this._box.style.height=j-z+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const d=this._startPos,x=s;if(this.reset(),he.suppressClick(),d.x!==x.x||d.y!==x.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:t})),{cameraAnimation:T=>T.fitScreenCoordinates(d,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new h.l(t,{originalEvent:s}))}}function La(E,t){if(E.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${E.length}, points ${t.length}`);const s={};for(let d=0;d<E.length;d++)s[E[d].identifier]=t[d];return s}class Cn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=(function(x){const T=new h.P(0,0);for(const M of x)T._add(M);return T.div(x.length)})(s),this.touches=La(d,s)))}touchmove(t,s,d){if(this.aborted||!this.centroid)return;const x=La(d,s);for(const T in this.touches){const M=x[T];(!M||M.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(t,s,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class ih{constructor(t){this.singleTap=new Cn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,d){this.singleTap.touchstart(t,s,d)}touchmove(t,s,d){this.singleTap.touchmove(t,s,d)}touchend(t,s,d){const x=this.singleTap.touchend(t,s,d);if(x){const T=t.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(x)<30;if(T&&M||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Kh{constructor(t){this._tr=new Oo(t),this._zoomIn=new ih({numTouches:1,numTaps:2}),this._zoomOut=new ih({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,d){this._zoomIn.touchstart(t,s,d),this._zoomOut.touchstart(t,s,d)}touchmove(t,s,d){this._zoomIn.touchmove(t,s,d),this._zoomOut.touchmove(t,s,d)}touchend(t,s,d){const x=this._zoomIn.touchend(t,s,d),T=this._zoomOut.touchend(t,s,d),M=this._tr;return x?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(x)},{originalEvent:t})}):T?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(T)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xo{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const x=Array.isArray(s)?s[0]:s;return!this._moved&&x.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(d,x))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&he.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zo=0,_u=2,Qh={[zo]:1,[_u]:2};class gl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=he.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(s,d){const x=Qh[d];return s.buttons===void 0||(s.buttons&x)!==x})(t,this._eventButton)}isValidEndEvent(t){return he.mouseButton(t)===this._eventButton}}class Lc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class rh{constructor(t=new gl({checkCorrectEvent:()=>!0}),s=new Lc){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(t,s,d){return t instanceof MouseEvent?s(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?d(t):void 0}startMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.startMove(s)),(s=>this.oneFingerTouchMoveStateManager.startMove(s)))}endMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.endMove(s)),(s=>this.oneFingerTouchMoveStateManager.endMove(s)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidStartEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidMoveEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidEndEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s)))}}const yl=E=>{E.mousedown=E.dragStart,E.mousemoveWindow=E.dragMove,E.mouseup=E.dragEnd,E.contextmenu=t=>{t.preventDefault()}};class Jh{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,d){return this._calculateTransform(t,s,d)}touchmove(t,s,d){if(this._active){if(!this._shouldBePrevented(d.length))return t.preventDefault(),this._calculateTransform(t,s,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,d){this._calculateTransform(t,s,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,d){d.length>0&&(this._active=!0);const x=La(d,s),T=new h.P(0,0),M=new h.P(0,0);let z=0;for(const Z in x){const W=x[Z],ee=this._touches[Z];ee&&(T._add(W),M._add(W.sub(ee)),z++,x[Z]=W)}if(this._touches=x,this._shouldBePrevented(z)||!M.mag())return;const j=M.div(z);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(z),panDelta:j}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,d){if(!this._firstTwoTouches)return;t.preventDefault();const[x,T]=this._firstTwoTouches,M=xl(d,s,x),z=xl(d,s,T);if(!M||!z)return;const j=this._aroundCenter?null:M.add(z).div(2);return this._move([M,z],j,t)}touchend(t,s,d){if(!this._firstTwoTouches)return;const[x,T]=this._firstTwoTouches,M=xl(d,s,x),z=xl(d,s,T);M&&z||(this._active&&he.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function xl(E,t,s){for(let d=0;d<E.length;d++)if(E[d].identifier===s)return t[d]}function qd(E,t){return Math.log(E/t)/Math.LN2}class _l extends sh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(qd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qd(this._distance,d),pinchAround:s}}}function ed(E,t){return 180*E.angleWith(t)/Math.PI}class ah extends sh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,d){const x=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ed(this._vector,x),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,d=ed(t,this._startVector);return Math.abs(d)<s}}function bl(E){return Math.abs(E.y)>Math.abs(E.x)}class Gl extends sh{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,d){super.touchstart(t,s,d),this._currentTouchCount=d.length}_start(t){this._lastPoints=t,bl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=t[0].sub(this._lastPoints[0]),T=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,T,d.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,d){if(this._valid!==void 0)return this._valid;const x=t.mag()>=2,T=s.mag()>=2;if(!x&&!T)return;if(!x||!T)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const M=t.y>0==s.y>0;return bl(t)&&bl(s)&&M}}const _o={panStep:100,bearingStep:15,pitchStep:10};class cr{constructor(t){this._tr=new Oo(t);const s=_o;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,d=0,x=0,T=0,M=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),T=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),T=1);break;case 38:t.shiftKey?x=1:(t.preventDefault(),M=-1);break;case 40:t.shiftKey?x=-1:(t.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,x=0),{cameraAnimation:z=>{const j=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:Zd,zoom:s?Math.round(j.zoom)+s*(t.shiftKey?2:1):j.zoom,bearing:j.bearing+d*this._bearingStep,pitch:j.pitch+x*this._pitchStep,offset:[-T*this._panStep,-M*this._panStep],center:j.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zd(E){return E*(2-E)}const Hl=4.000244140625,mc=1/450;class oh{constructor(t,s){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=t,this._tr=new Oo(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=mc}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=ye(),x=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,s!==0&&s%Hl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(x*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=he.mousePos(this._map.getCanvas(),t),d=this._tr;this._aroundPoint=this._aroundCenter?d.transform.locationToScreenPoint(h.V.convert(d.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const z=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=z),typeof this._targetZoom=="number"&&(this._targetZoom+=z)}if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Hl?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&j!==0&&(j=1/j);const Z=typeof this._targetZoom!="number"?t.scale:h.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),h.at(Z*j)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,d=this._startZoom,x=this._easing;let T,M=!1;if(this._type==="wheel"&&d&&x){const z=ye()-this._lastWheelEventTime,j=Math.min((z+5)/200,1),Z=x(j);T=h.G.number(d,s,Z),j<1?this._frameId||(this._frameId=!0):M=!0}else T=s,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=T,{noInertia:!0,needsRenderFrame:!M,zoomDelta:T-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=h.cy;if(this._prevEase){const d=this._prevEase,x=(ye()-d.start)/d.duration,T=d.easing(x+.01)-d.easing(x),M=.27/Math.sqrt(T*T+1e-4)*.01,z=Math.sqrt(.0729-M*M);s=h.cw(M,z,.25,1)}return this._prevEase={start:ye(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class td{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bc{constructor(t){this._tr=new Oo(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lh{constructor(){this._tap=new ih({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,d){if(!this._swipePoint)if(this._tapTime){const x=s[0],T=t.timeStamp-this._tapTime<500,M=this._tapPoint.dist(x)<30;T&&M?d.length>0&&(this._swipePoint=x,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(t,s,d)}touchmove(t,s,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const x=s[0],T=x.y-this._swipePoint.y;return this._swipePoint=x,t.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(t,s,d)}touchend(t,s,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const x=this._tap.touchend(t,s,d);x&&(this._tapTime=t.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xd{constructor(t,s,d){this._el=t,this._mousePan=s,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ro{constructor(t,s,d,x){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=s,this._mousePitch=d,this._mouseRoll=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Fc{constructor(t,s,d,x){this._el=t,this._touchZoom=s,this._touchRotate=d,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Dn{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=he.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=s,this._container.appendChild(x);const T=document.createElement("div");T.className="maplibregl-mobile-message",T.textContent=d,this._container.appendChild(T),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(he.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Ln=E=>E.zoom||E.drag||E.roll||E.pitch||E.rotate;class bo extends h.l{}function bu(E){return E.panDelta&&E.panDelta.mag()||E.zoomDelta||E.bearingDelta||E.pitchDelta||E.rollDelta}class ch{constructor(t,s){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,T)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=x.type==="renderFrame"?void 0:x,z={needsRenderFrame:!1},j={},Z={};for(const{handlerName:J,handler:se,allowed:pe}of this._handlers){if(!se.isEnabled())continue;let Ae;if(this._blockedByActive(Z,pe,J))se.reset();else if(se[T||x.type]){if(h.cz(x,T||x.type)){const Ne=he.mousePos(this._map.getCanvas(),x);Ae=se[T||x.type](x,Ne)}else if(h.cA(x,T||x.type)){const Ne=this._getMapTouches(x.touches),Re=he.touchPos(this._map.getCanvas(),Ne);Ae=se[T||x.type](x,Re,Ne)}else h.cB(T||x.type)||(Ae=se[T||x.type](x));this.mergeHandlerResult(z,j,Ae,J,M),Ae&&Ae.needsRenderFrame&&this._triggerRenderFrame()}(Ae||se.isActive())&&(Z[J]=se)}const W={};for(const J in this._previousActiveHandlers)Z[J]||(W[J]=M);this._previousActiveHandlers=Z,(Object.keys(W).length||bu(z))&&(this._changes.push([z,j,W]),this._triggerRenderFrame()),(Object.keys(Z).length||bu(z))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=z;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new y0(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,T,M]of this._listeners)he.addEventListener(x,T,x===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[t,s,d]of this._listeners)he.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(t){const s=this._map,d=s.getCanvasContainer();this._add("mapEvent",new $h(s,t));const x=s.boxZoom=new pc(s,t);this._add("boxZoom",x),t.interactive&&t.boxZoom&&x.enable();const T=s.cooperativeGestures=new Dn(s,t.cooperativeGestures);this._add("cooperativeGestures",T),t.cooperativeGestures&&T.enable();const M=new Kh(s),z=new Bc(s);s.doubleClickZoom=new td(z,M),this._add("tapZoom",M),this._add("clickZoom",z),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const j=new lh;this._add("tapDragZoom",j);const Z=s.touchPitch=new Gl(s);this._add("touchPitch",Z),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const W=()=>s.project(s.getCenter()),ee=(function({enable:Le,clickTolerance:Ze,aroundCenter:et=!0,minPixelCenterThreshold:Ve=100,rotateDegreesPerPixelMoved:ut=.8},Mt){const Et=new gl({checkCorrectEvent:At=>he.mouseButton(At)===0&&At.ctrlKey||he.mouseButton(At)===2&&!At.ctrlKey});return new xo({clickTolerance:Ze,move:(At,Ct)=>{const dn=Mt();if(et&&Math.abs(dn.y-At.y)>Ve)return{bearingDelta:h.cx(new h.P(At.x,Ct.y),Ct,dn)};let mn=(Ct.x-At.x)*ut;return et&&Ct.y<dn.y&&(mn=-mn),{bearingDelta:mn}},moveStateManager:Et,enable:Le,assignEvents:yl})})(t,W),J=(function({enable:Le,clickTolerance:Ze,pitchDegreesPerPixelMoved:et=-.5}){const Ve=new gl({checkCorrectEvent:ut=>he.mouseButton(ut)===0&&ut.ctrlKey||he.mouseButton(ut)===2});return new xo({clickTolerance:Ze,move:(ut,Mt)=>({pitchDelta:(Mt.y-ut.y)*et}),moveStateManager:Ve,enable:Le,assignEvents:yl})})(t),se=(function({enable:Le,clickTolerance:Ze,rollDegreesPerPixelMoved:et=.3},Ve){const ut=new gl({checkCorrectEvent:Mt=>he.mouseButton(Mt)===2&&Mt.ctrlKey});return new xo({clickTolerance:Ze,move:(Mt,Et)=>{const At=Ve();let Ct=(Et.x-Mt.x)*et;return Et.y<At.y&&(Ct=-Ct),{rollDelta:Ct}},moveStateManager:ut,enable:Le,assignEvents:yl})})(t,W);s.dragRotate=new ro(t,ee,J,se),this._add("mouseRotate",ee,["mousePitch"]),this._add("mousePitch",J,["mouseRotate","mouseRoll"]),this._add("mouseRoll",se,["mousePitch"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const pe=(function({enable:Le,clickTolerance:Ze}){const et=new gl({checkCorrectEvent:Ve=>he.mouseButton(Ve)===0&&!Ve.ctrlKey});return new xo({clickTolerance:Ze,move:(Ve,ut)=>({around:ut,panDelta:ut.sub(Ve)}),activateOnStart:!0,moveStateManager:et,enable:Le,assignEvents:yl})})(t),Ae=new Jh(t,s);s.dragPan=new Xd(d,pe,Ae),this._add("mousePan",pe),this._add("touchPan",Ae,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const Ne=new ah,Re=new _l;s.touchZoomRotate=new Fc(d,Re,Ne,j),this._add("touchRotate",Ne,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new np(s));const Be=s.scrollZoom=new oh(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Be,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const We=s.keyboard=new cr(s);this._add("keyboard",We),t.interactive&&t.keyboard&&s.keyboard.enable()}_add(t,s,d){this._handlers.push({handlerName:t,handler:s,allowed:d}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ln(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,d){for(const x in t)if(x!==d&&(!s||s.indexOf(x)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const d of t)this._el.contains(d.target)&&s.push(d);return s}mergeHandlerResult(t,s,d,x,T){if(!d)return;h.e(t,d);const M={handlerName:x,originalEvent:d.originalEvent||T};d.zoomDelta!==void 0&&(s.zoom=M),d.panDelta!==void 0&&(s.drag=M),d.rollDelta!==void 0&&(s.roll=M),d.pitchDelta!==void 0&&(s.pitch=M),d.bearingDelta!==void 0&&(s.rotate=M)}_applyChanges(){const t={},s={},d={};for(const[x,T,M]of this._changes)x.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(x.panDelta)),x.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+x.pitchDelta),x.rollDelta&&(t.rollDelta=(t.rollDelta||0)+x.rollDelta),x.around!==void 0&&(t.around=x.around),x.pinchAround!==void 0&&(t.pinchAround=x.pinchAround),x.noInertia&&(t.noInertia=x.noInertia),h.e(s,T),h.e(d,M);this._updateMapTransform(t,s,d),this._changes=[]}_updateMapTransform(t,s,d){const x=this._map,T=x._getTransformForUpdate(),M=x.terrain;if(!(bu(t)||M&&this._terrainMovement))return this._fireEvents(s,d,!0);x._stop(!0);let{panDelta:z,zoomDelta:j,bearingDelta:Z,pitchDelta:W,rollDelta:ee,around:J,pinchAround:se}=t;se!==void 0&&(J=se),J=J||x.transform.centerPoint,M&&!T.isPointOnMapSurface(J)&&(J=T.centerPoint);const pe={panDelta:z,zoomDelta:j,rollDelta:ee,pitchDelta:W,bearingDelta:Z,around:J};this._map.cameraHelper.useGlobeControls&&!T.isPointOnMapSurface(J)&&(J=T.centerPoint);const Ae=J.distSqr(T.centerPoint)<.01?T.center:T.screenPointToLocation(z?J.sub(z):J);this._handleMapControls({terrain:M,tr:T,deltasForHelper:pe,preZoomAroundLoc:Ae,combinedEventsInProgress:s,panDelta:z}),x._applyUpdatedTransform(T),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,d,!0)}_handleMapControls({terrain:t,tr:s,deltasForHelper:d,preZoomAroundLoc:x,combinedEventsInProgress:T,panDelta:M}){const z=this._map.cameraHelper;if(z.handleMapControlsRollPitchBearingZoom(d,s),t)return z.useGlobeControls?(this._terrainMovement||!T.drag&&!T.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void z.handleMapControlsPan(d,s,x)):this._terrainMovement||!T.drag&&!T.zoom?void(T.drag&&this._terrainMovement&&M?s.setCenter(s.screenPointToLocation(s.centerPoint.sub(M))):z.handleMapControlsPan(d,s,x)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void z.handleMapControlsPan(d,s,x));z.handleMapControlsPan(d,s,x)}_fireEvents(t,s,d){const x=Ln(this._eventsInProgress),T=Ln(t),M={};for(const ee in t){const{originalEvent:J}=t[ee];this._eventsInProgress[ee]||(M[`${ee}start`]=J),this._eventsInProgress[ee]=t[ee]}!x&&T&&this._fireEvent("movestart",T.originalEvent);for(const ee in M)this._fireEvent(ee,M[ee]);T&&this._fireEvent("move",T.originalEvent);for(const ee in t){const{originalEvent:J}=t[ee];this._fireEvent(ee,J)}const z={};let j;for(const ee in this._eventsInProgress){const{handlerName:J,originalEvent:se}=this._eventsInProgress[ee];this._handlersById[J].isActive()||(delete this._eventsInProgress[ee],j=s[J]||se,z[`${ee}end`]=j)}for(const ee in z)this._fireEvent(ee,z[ee]);const Z=Ln(this._eventsInProgress),W=(x||T)&&!Z;if(W&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const ee=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ee.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ee)}if(d&&W){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;!ee||!ee.essential&&Ce.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:j})),J(this._map.getBearing())&&this._map.resetNorth()):(J(ee.bearing||this._map.getBearing())&&(ee.bearing=0),ee.freezeElevation=!0,this._map.easeTo(ee,{originalEvent:j})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new h.l(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new bo("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class os extends h.E{constructor(t,s,d){super(),this._renderFrameCallback=()=>{const x=Math.min((ye()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=d.bearingSnap,this.cameraHelper=s,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,s){t.apply(this.transform),this.transform=t,this.cameraHelper=s}getCenter(){return new h.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,s){return this.jumpTo({elevation:t},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,s,d){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},s),d)}panTo(t,s,d){return this.easeTo(h.e({center:t},s),d)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,d){return this.easeTo(h.e({zoom:t},s),d)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,s){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new h.l("movestart",s)).fire(new h.l("move",s)).fire(new h.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,d){return this.easeTo(h.e({bearing:t},s),d)}resetNorth(t,s){return this.rotateTo(0,h.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}getRoll(){return this.transform.roll}setRoll(t,s){return this.jumpTo({roll:t},s),this}cameraForBounds(t,s){t=si.convert(t).adjustAntiMeridian();const d=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),d,s)}_cameraForBoxAndBearing(t,s,d,x){const T={top:0,bottom:0,right:0,left:0};if(typeof(x=h.e({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const Z=x.padding;x.padding={top:Z,bottom:Z,right:Z,left:Z}}const M=h.e(T,x.padding);x.padding=M;const z=this.transform,j=new si(t,s);return this.cameraHelper.cameraForBoxAndBearing(x,M,j,d,z)}fitBounds(t,s,d){return this._fitInternal(this.cameraForBounds(t,s),s,d)}fitScreenCoordinates(t,s,d,x,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(t)),this.transform.screenPointToLocation(h.P.convert(s)),d,x),x,T)}_fitInternal(t,s,d){return t?(delete(s=h.e(t,s)).padding,s.linear?this.easeTo(s,d):this.flyTo(s,d)):this}jumpTo(t,s){this.stop();const d=this._getTransformForUpdate();let x=!1,T=!1,M=!1;const z=d.zoom;this.cameraHelper.handleJumpToCenterZoom(d,t);const j=d.zoom!==z;return"elevation"in t&&d.elevation!==+t.elevation&&d.setElevation(+t.elevation),"bearing"in t&&d.bearing!==+t.bearing&&(x=!0,d.setBearing(+t.bearing)),"pitch"in t&&d.pitch!==+t.pitch&&(T=!0,d.setPitch(+t.pitch)),"roll"in t&&d.roll!==+t.roll&&(M=!0,d.setRoll(+t.roll)),t.padding==null||d.isPaddingEqual(t.padding)||d.setPadding(t.padding),this._applyUpdatedTransform(d),this.fire(new h.l("movestart",s)).fire(new h.l("move",s)),j&&this.fire(new h.l("zoomstart",s)).fire(new h.l("zoom",s)).fire(new h.l("zoomend",s)),x&&this.fire(new h.l("rotatestart",s)).fire(new h.l("rotate",s)).fire(new h.l("rotateend",s)),T&&this.fire(new h.l("pitchstart",s)).fire(new h.l("pitch",s)).fire(new h.l("pitchend",s)),M&&this.fire(new h.l("rollstart",s)).fire(new h.l("roll",s)).fire(new h.l("rollend",s)),this.fire(new h.l("moveend",s))}calculateCameraOptionsFromTo(t,s,d,x=0){const T=h.a9.fromLngLat(t,s),M=h.a9.fromLngLat(d,x),z=M.x-T.x,j=M.y-T.y,Z=M.z-T.z,W=Math.hypot(z,j,Z);if(W===0)throw new Error("Can't calculate camera options with same From and To");const ee=Math.hypot(z,j),J=h.at(this.transform.cameraToCenterDistance/W/this.transform.tileSize),se=180*Math.atan2(z,-j)/Math.PI;let pe=180*Math.acos(ee/W)/Math.PI;return pe=Z<0?90-pe:90+pe,{center:M.toLngLat(),elevation:x,zoom:J,pitch:pe,bearing:se}}calculateCameraOptionsFromCameraLngLatAltRotation(t,s,d,x,T){const M=this.transform.calculateCenterFromCameraLngLatAlt(t,s,d,x);return{center:M.center,elevation:M.elevation,zoom:M.zoom,bearing:d,pitch:x,roll:T}}easeTo(t,s){this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.cy},t)).animate===!1||!t.essential&&Ce.prefersReducedMotion)&&(t.duration=0);const d=this._getTransformForUpdate(),x=this.getBearing(),T=d.pitch,M=d.roll,z="bearing"in t?this._normalizeBearing(t.bearing,x):x,j="pitch"in t?+t.pitch:T,Z="roll"in t?this._normalizeBearing(t.roll,M):M,W="padding"in t?t.padding:d.padding,ee=h.P.convert(t.offset);let J,se;t.around&&(J=h.V.convert(t.around),se=d.locationToScreenPoint(J));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Ae=this.cameraHelper.handleEaseTo(d,{bearing:z,pitch:j,roll:Z,padding:W,around:J,aroundPoint:se,offsetAsPoint:ee,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||x!==z,this._pitching=this._pitching||j!==T,this._rolling=this._rolling||Z!==M,this._padding=!d.isPaddingEqual(W),this._zooming=this._zooming||Ae.isZooming,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,pe),this.terrain&&this._prepareElevation(Ae.elevationCenter),this._ease((Ne=>{Ae.easeFunc(Ne),this.terrain&&!t.freezeElevation&&this._updateElevation(Ne),this._applyUpdatedTransform(d),this._fireMoveEvents(s)}),(Ne=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Ne)}),t),this}_prepareEase(t,s,d={}){this._moving=!0,s||d.moving||this.fire(new h.l("movestart",t)),this._zooming&&!d.zooming&&this.fire(new h.l("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new h.l("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new h.l("pitchstart",t)),this._rolling&&!d.rolling&&this.fire(new h.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(d-(s-(d*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.setElevation(h.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const s=t.getCameraLngLat(),d=t.getCameraAltitude(),x=this.terrain?this.terrain.getElevationForLngLatZoom(s,t.zoom):0;if(d<x){const T=this.calculateCameraOptionsFromTo(s,x,t.center,t.elevation);return{pitch:T.pitch,zoom:T.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(s.push((x=>this._elevateCameraIfInsideTerrain(x))),this.transformCameraUpdate&&s.push((x=>this.transformCameraUpdate(x))),!s.length)return;const d=t.clone();for(const x of s){const T=d.clone(),{center:M,zoom:z,roll:j,pitch:Z,bearing:W,elevation:ee}=x(T);M&&T.setCenter(M),ee!==void 0&&T.setElevation(ee),z!==void 0&&T.setZoom(z),j!==void 0&&T.setRoll(j),Z!==void 0&&T.setPitch(Z),W!==void 0&&T.setBearing(W),d.apply(T)}this.transform.apply(d)}_fireMoveEvents(t){this.fire(new h.l("move",t)),this._zooming&&this.fire(new h.l("zoom",t)),this._rotating&&this.fire(new h.l("rotate",t)),this._pitching&&this.fire(new h.l("pitch",t)),this._rolling&&this.fire(new h.l("roll",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const d=this._zooming,x=this._rotating,T=this._pitching,M=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,d&&this.fire(new h.l("zoomend",t)),x&&this.fire(new h.l("rotateend",t)),T&&this.fire(new h.l("pitchend",t)),M&&this.fire(new h.l("rollend",t)),this.fire(new h.l("moveend",t))}flyTo(t,s){if(!t.essential&&Ce.prefersReducedMotion){const Ct=h.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ct,s)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.cy},t);const d=this._getTransformForUpdate(),x=d.bearing,T=d.pitch,M=d.roll,z=d.padding,j="bearing"in t?this._normalizeBearing(t.bearing,x):x,Z="pitch"in t?+t.pitch:T,W="roll"in t?this._normalizeBearing(t.roll,M):M,ee="padding"in t?t.padding:d.padding,J=h.P.convert(t.offset);let se=d.centerPoint.add(J);const pe=d.screenPointToLocation(se),Ae=this.cameraHelper.handleFlyTo(d,{bearing:j,pitch:Z,roll:W,padding:ee,locationAtOffset:pe,offsetAsPoint:J,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Ne=t.curve;const Re=Math.max(d.width,d.height),Be=Re/Ae.scaleOfZoom,We=Ae.pixelPathLength;typeof Ae.scaleOfMinZoom=="number"&&(Ne=Math.sqrt(Re/Ae.scaleOfMinZoom/We*2));const Le=Ne*Ne;function Ze(Ct){const dn=(Be*Be-Re*Re+(Ct?-1:1)*Le*Le*We*We)/(2*(Ct?Be:Re)*Le*We);return Math.log(Math.sqrt(dn*dn+1)-dn)}function et(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Ve(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const ut=Ze(!1);let Mt=function(Ct){return Ve(ut)/Ve(ut+Ne*Ct)},Et=function(Ct){return Re*((Ve(ut)*(et(dn=ut+Ne*Ct)/Ve(dn))-et(ut))/Le)/We;var dn},At=(Ze(!0)-ut)/Ne;if(Math.abs(We)<2e-6||!isFinite(At)){if(Math.abs(Re-Be)<1e-6)return this.easeTo(t,s);const Ct=Be<Re?-1:1;At=Math.abs(Math.log(Be/Re))/Ne,Et=()=>0,Mt=dn=>Math.exp(Ct*Ne*dn)}return t.duration="duration"in t?+t.duration:1e3*At/("screenSpeed"in t?+t.screenSpeed/Ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=x!==j,this._pitching=Z!==T,this._rolling=W!==M,this._padding=!d.isPaddingEqual(ee),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Ae.targetCenter),this._ease((Ct=>{const dn=Ct*At,mn=1/Mt(dn),Qt=Et(dn);this._rotating&&d.setBearing(h.G.number(x,j,Ct)),this._pitching&&d.setPitch(h.G.number(T,Z,Ct)),this._rolling&&d.setRoll(h.G.number(M,W,Ct)),this._padding&&(d.interpolatePadding(z,ee,Ct),se=d.centerPoint.add(J)),Ae.easeFunc(Ct,mn,Qt,se),this.terrain&&!t.freezeElevation&&this._updateElevation(Ct),this._applyUpdatedTransform(d),this._fireMoveEvents(s)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,s)}return t||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(t,s,d){d.animate===!1||d.duration===0?(t(1),s()):(this._easeStart=ye(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=h.W(t,-180,180);const d=Math.abs(t-s);return Math.abs(t-360-s)<d&&(t-=360),Math.abs(t+360-s)<d&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(h.V.convert(t),this.transform):null}}const Wr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Jr{constructor(t=Wr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=he.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=he.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const d=this._map._getUIString(`AttributionControl.${s}`);t.title=d,t.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((x=>typeof x!="string"?"":x))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const s=this._map.style.tileManagers;for(const x in s){const T=s[x];if(T.used||T.usedForTerrain){const M=T.getSource();M.attribution&&t.indexOf(M.attribution)<0&&t.push(M.attribution)}}t=t.filter((x=>String(x).trim())),t.sort(((x,T)=>x.length-T.length)),t=t.filter(((x,T)=>{for(let M=T+1;M<t.length;M++)if(t[M].indexOf(x)>=0)return!1;return!0}));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=he.sanitize(d),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class uh{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const d=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=he.create("div","maplibregl-ctrl");const s=he.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){he.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ql{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,d=s?this._queue.concat(s):this._queue;for(const x of d)if(x.id===t)return void(x.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const d of s)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ii=h.aU([{name:"a_pos3d",type:"Int16",components:3}]);class sr extends h.E{constructor(t){super(),this._lastTilesetChange=ye(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,s){this.tileManager.update(t,s),this._renderableTilesKeys=[];const d={};for(const x of nn(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.tileManager._source.calculateTileZoom}))d[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.terrainRttPosMatrix32f=new Float64Array(16),h.c7(x.terrainRttPosMatrix32f,0,h.a5,h.a5,0,0,1),this._tiles[x.key]=new Me(x,this.tileSize),this._lastTilesetChange=ye());for(const x in this._tiles)d[x]||delete this._tiles[x]}freeRtt(t){for(const s in this._tiles){const d=this._tiles[s];(!t||d.tileID.equals(t)||d.tileID.isChildOf(t)||t.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,s){return s?this._getTerrainCoordsForTileRanges(t,s):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const s={};for(const d of this._renderableTilesKeys){const x=this._tiles[d].tileID,T=t.clone(),M=h.bk();if(x.canonical.equals(t.canonical))h.c7(M,0,h.a5,h.a5,0,0,1);else if(x.canonical.isChildOf(t.canonical)){const z=x.canonical.z-t.canonical.z,j=x.canonical.x-(x.canonical.x>>z<<z),Z=x.canonical.y-(x.canonical.y>>z<<z),W=h.a5>>z;h.c7(M,0,W,W,0,0,1),h.O(M,M,[-j*W,-Z*W,0])}else{if(!t.canonical.isChildOf(x.canonical))continue;{const z=t.canonical.z-x.canonical.z,j=t.canonical.x-(t.canonical.x>>z<<z),Z=t.canonical.y-(t.canonical.y>>z<<z),W=h.a5>>z;h.c7(M,0,h.a5,h.a5,0,0,1),h.O(M,M,[j*W,Z*W,0]),h.Q(M,M,[1/2**z,1/2**z,0])}}T.terrainRttPosMatrix32f=new Float32Array(M),s[d]=T}return s}_getTerrainCoordsForTileRanges(t,s){const d={};for(const x of this._renderableTilesKeys){const T=this._tiles[x].tileID;if(!this._isWithinTileRanges(T,s))continue;const M=t.clone(),z=h.bk();if(T.canonical.z===t.canonical.z){const j=t.canonical.x-T.canonical.x,Z=t.canonical.y-T.canonical.y;h.c7(z,0,h.a5,h.a5,0,0,1),h.O(z,z,[j*h.a5,Z*h.a5,0])}else if(T.canonical.z>t.canonical.z){const j=T.canonical.z-t.canonical.z,Z=T.canonical.x-(T.canonical.x>>j<<j),W=T.canonical.y-(T.canonical.y>>j<<j),ee=t.canonical.x-(T.canonical.x>>j),J=t.canonical.y-(T.canonical.y>>j),se=h.a5>>j;h.c7(z,0,se,se,0,0,1),h.O(z,z,[-Z*se+ee*h.a5,-W*se+J*h.a5,0])}else{const j=t.canonical.z-T.canonical.z,Z=t.canonical.x-(t.canonical.x>>j<<j),W=t.canonical.y-(t.canonical.y>>j<<j),ee=(t.canonical.x>>j)-T.canonical.x,J=(t.canonical.y>>j)-T.canonical.y,se=h.a5<<j;h.c7(z,0,se,se,0,0,1),h.O(z,z,[Z*h.a5+ee*se,W*h.a5+J*se,0])}M.terrainRttPosMatrix32f=new Float32Array(z),d[x]=M}return d}getSourceTile(t,s){const d=this.tileManager._source;let x=t.overscaledZ-this.deltaZoom;if(x>d.maxzoom&&(x=d.maxzoom),x<d.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(x).key);let T=this.findTileInCaches(this._sourceTileCache[t.key]);if(!T?.dem&&s)for(;x>=d.minzoom&&!T?.dem;)T=this.findTileInCaches(t.scaledTo(x--).key);return T}findTileInCaches(t){let s=this.tileManager.getTileByID(t);return s||(s=this.tileManager._outOfViewCache.getByKey(t),s)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,s){return s[t.canonical.z]&&t.canonical.x>=s[t.canonical.z].minTileX&&t.canonical.x<=s[t.canonical.z].maxTileX&&t.canonical.y>=s[t.canonical.z].minTileY&&t.canonical.y<=s[t.canonical.z].maxTileY}}class Ti{constructor(t,s,d){this._meshCache={},this.painter=t,this.tileManager=new sr(s),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,d,x=h.a5){var T;if(!(s>=0&&s<x&&d>=0&&d<x))return 0;const M=this.getTerrainData(t),z=(T=M.tile)===null||T===void 0?void 0:T.dem;if(!z)return 0;const j=h.cC([],[s/x*h.a5,d/x*h.a5],M.u_terrain_matrix),Z=[j[0]*z.dim,j[1]*z.dim],W=Math.floor(Z[0]),ee=Math.floor(Z[1]),J=Z[0]-W,se=Z[1]-ee;return z.get(W,ee)*(1-J)*(1-se)+z.get(W+1,ee)*J*(1-se)+z.get(W,ee+1)*(1-J)*se+z.get(W+1,ee+1)*J*se}getElevationForLngLatZoom(t,s){if(!h.cD(s,t.wrap()))return 0;const{tileID:d,mercatorX:x,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(d,x%h.a5,T%h.a5,h.a5)}getElevationForLngLat(t,s){const d=nn(s,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let x=0;for(const T of d)T.canonical.z>x&&(x=Math.min(T.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,x)}getElevation(t,s,d,x=h.a5){return this.getDEMElevation(t,s,d,x)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const x=this.painter.context,T=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(x,T,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(x,new h.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ar([])}const s=this.tileManager.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const x=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new h.T(x,s.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),s.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const d=s&&s.toString()+s.tileID.key+t.key;if(d&&!this._demMatrixCache[d]){const x=this.tileManager.getSource().maxzoom;let T=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=x?T=t.canonical.z-x:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=t.canonical.x-(t.canonical.x>>T<<T),z=t.canonical.y-(t.canonical.y>>T<<T),j=h.cE(new Float64Array(16),[1/(h.a5<<T),1/(h.a5<<T),0]);h.O(j,j,[M*h.a5,z*h.a5,0]),this._demMatrixCache[t.key]={matrix:j,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,d=s.width/devicePixelRatio,x=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(s.context,{width:d,height:x,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(s.context,{width:d,height:x,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(d,x,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,d,x))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let T=0,M=0;T<this._coordsTextureSize;T++)for(let z=0;z<this._coordsTextureSize;z++,M+=4)s[M+0]=255&z,s[M+1]=255&T,s[M+2]=z>>8<<4|T>>8,s[M+3]=0;const d=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),x=new h.T(t,d,t.gl.RGBA,{premultiply:!1});return x.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),d=this.painter.context,x=d.gl,T=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(T,z-M-1,1,1,x.RGBA,x.UNSIGNED_BYTE,s),d.bindFramebuffer.set(null);const j=s[0]+(s[2]>>4<<8),Z=s[1]+((15&s[2])<<8),W=this.coordsIndex[255-s[3]],ee=W&&this.tileManager.getTileByID(W);if(!ee)return null;const J=this._coordsTextureSize,se=(1<<ee.tileID.canonical.z)*J;return new h.a9((ee.tileID.canonical.x*J+j)/se+ee.tileID.wrap,(ee.tileID.canonical.y*J+Z)/se,this.getElevation(ee.tileID,j,Z,J))}depthAtPoint(t){const s=new Uint8Array(4),d=this.painter.context,x=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,s),d.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(t){var s;const d=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,x=d&&t.canonical.y===0,T=d&&t.canonical.y===(1<<t.canonical.z)-1,M=`m_${x?"n":""}_${T?"s":""}`;if(this._meshCache[M])return this._meshCache[M];const z=this.painter.context,j=new h.cF,Z=new h.aY,W=this.meshSize,ee=h.a5/W,J=W*W;for(let Ve=0;Ve<=W;Ve++)for(let ut=0;ut<=W;ut++)j.emplaceBack(ut*ee,Ve*ee,0);for(let Ve=0;Ve<J;Ve+=W+1)for(let ut=0;ut<W;ut++)Z.emplaceBack(ut+Ve,W+ut+Ve+1,W+ut+Ve+2),Z.emplaceBack(ut+Ve,W+ut+Ve+2,ut+Ve+1);const se=j.length,pe=se+(W+1),Ae=(W+1)*W,Ne=x?h.br:0,Re=x?0:1,Be=T?h.bs:h.a5,We=T?0:1;for(let Ve=0;Ve<=W;Ve++)j.emplaceBack(Ve*ee,Ne,Re);for(let Ve=0;Ve<=W;Ve++)j.emplaceBack(Ve*ee,Be,We);for(let Ve=0;Ve<W;Ve++)Z.emplaceBack(Ae+Ve,pe+Ve,pe+Ve+1),Z.emplaceBack(Ae+Ve,pe+Ve+1,Ae+Ve+1),Z.emplaceBack(0+Ve,se+Ve+1,se+Ve),Z.emplaceBack(0+Ve,0+Ve+1,se+Ve+1);const Le=j.length,Ze=Le+2*(W+1);for(const Ve of[0,1])for(let ut=0;ut<=W;ut++)for(const Mt of[0,1])j.emplaceBack(Ve*h.a5,ut*ee,Mt);for(let Ve=0;Ve<2*W;Ve+=2)Z.emplaceBack(Le+Ve,Le+Ve+1,Le+Ve+3),Z.emplaceBack(Le+Ve,Le+Ve+3,Le+Ve+2),Z.emplaceBack(Ze+Ve,Ze+Ve+3,Ze+Ve+1),Z.emplaceBack(Ze+Ve,Ze+Ve+2,Ze+Ve+3);const et=new lr(z.createVertexBuffer(j,Ii.members),z.createIndexBuffer(Z),h.aX.simpleSegment(0,0,j.length,Z.length));return this._meshCache[M]=et,et}getMeshFrameDelta(t){return 2*Math.PI*h.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,s){var d;if(!h.cD(s,t.wrap()))return 0;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(d=this.getMinMaxElevation(x).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,d={minElevation:null,maxElevation:null};return s&&s.dem&&(d.minElevation=s.dem.min*this.exaggeration,d.maxElevation=s.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(t,s){const d=h.a9.fromLngLat(t.wrap()),x=(1<<s)*h.a5,T=d.x*x,M=d.y*x,z=Math.floor(T/h.a5),j=Math.floor(M/h.a5);return{tileID:new h.a2(s,0,s,z,j),mercatorX:T,mercatorY:M}}}class Gr{constructor(t,s,d){this._context=t,this._size=s,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(d.texture),{id:t,fbo:s,texture:d,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>t.id!==s)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const vo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Lo{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new Gr(t.context,30,s.tileManager.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((d=>!t._layers[d].isHidden(s))),this._coordsAscending={};for(const d in t.tileManagers){this._coordsAscending[d]={};const x=t.tileManagers[d].getVisibleCoordinates(),T=t.tileManagers[d].getSource(),M=T instanceof ci?T.terrainTileRanges:null;for(const z of x){const j=this.terrain.tileManager.getTerrainCoords(z,M);for(const Z in j)this._coordsAscending[d][Z]||(this._coordsAscending[d][Z]=[]),this._coordsAscending[d][Z].push(j[Z])}}this._coordsAscendingStr={};for(const d of t._order){const x=t._layers[d],T=x.source;if(vo[x.type]&&!this._coordsAscendingStr[T]){this._coordsAscendingStr[T]={};for(const M in this._coordsAscending[T])this._coordsAscendingStr[T][M]=this._coordsAscending[T][M].map((z=>z.key)).sort().join()}}for(const d of this._renderableTiles)for(const x in this._coordsAscendingStr){const T=this._coordsAscendingStr[x][d.tileID.key];T&&T!==d.rttCoords[x]&&(d.rtt=[])}}renderLayer(t,s){if(t.isHidden(this.painter.transform.zoom))return!1;const d=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),x=t.type,T=this.painter,M=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(vo[x]&&(this._prevType&&vo[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(t.id),!M))return!0;if(vo[this._prevType]||vo[x]&&M){this._prevType=x;const z=this._stacks.length-1,j=this._stacks[z]||[];for(const Z of this._renderableTiles){if(this.pool.isFull()&&(Wh(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Z),Z.rtt[z]){const ee=this.pool.getObjectForId(Z.rtt[z].id);if(ee.stamp===Z.rtt[z].stamp){this.pool.useObject(ee);continue}}const W=this.pool.getOrCreateFreeObject();this.pool.useObject(W),this.pool.stampObject(W),Z.rtt[z]={id:W.id,stamp:W.stamp},T.context.bindFramebuffer.set(W.fbo.framebuffer),T.context.clear({color:h.bp.transparent,stencil:0}),T.currentStencilSource=void 0;for(let ee=0;ee<j.length;ee++){const J=T.style._layers[j[ee]],se=J.source?this._coordsAscending[J.source][Z.tileID.key]:[Z.tileID];T.context.viewport.set([0,0,W.fbo.width,W.fbo.height]),T._renderTileClippingMasks(J,se,!0),T.renderLayer(T,T.style.tileManagers[J.source],J,se,d),J.source&&(Z.rttCoords[J.source]=this._coordsAscendingStr[J.source][Z.tileID.key])}}return Wh(this.painter,this.terrain,this._rttTiles,d),this._rttTiles=[],this.pool.freeAllObjects(),vo[x]}return!1}}const jc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Uc=V,Zl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Wr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Wd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Br{constructor(t,s,d=!1){this.mousedown=T=>{this.startMove(T,he.mousePos(this.element,T)),he.addEventListener(window,"mousemove",this.mousemove),he.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.move(T,he.mousePos(this.element,T))},this.mouseup=T=>{this._rotatePitchHandler.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,T.targetTouches)[0],this.startMove(T,this._startPos),he.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,T.targetTouches)[0],this.move(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const x=new rh;this._rotatePitchHandler=new xo({clickTolerance:3,move:(T,M)=>{const z=s.getBoundingClientRect(),j=new h.P((z.bottom-z.top)/2,(z.right-z.left)/2);return{bearingDelta:h.cx(new h.P(T.x,M.y),M,j),pitchDelta:d?-.5*(M.y-T.y):void 0}},moveStateManager:x,enable:!0,assignEvents:()=>{}}),this.map=t,he.addEventListener(s,"mousedown",this.mousedown),he.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(s,"touchcancel",this.reset)}startMove(t,s){this._rotatePitchHandler.dragStart(t,s),he.disableDrag()}move(t,s){const d=this.map,{bearingDelta:x,pitchDelta:T}=this._rotatePitchHandler.dragMove(t,s)||{};x&&d.setBearing(d.getBearing()+x),T&&d.setPitch(d.getPitch()+T)}off(){const t=this.element;he.removeEventListener(t,"mousedown",this.mousedown),he.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend),he.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){he.enableDrag(),he.removeEventListener(window,"mousemove",this.mousemove),he.removeEventListener(window,"mouseup",this.mouseup),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend)}}let Bo;function vu(E,t,s,d=!1){if(d||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return E?.wrap();const x=new h.V(E.lng,E.lat);if(E=new h.V(E.lng,E.lat),t){const T=new h.V(E.lng-360,E.lat),M=new h.V(E.lng+360,E.lat),z=s.locationToScreenPoint(E).distSqr(t);s.locationToScreenPoint(T).distSqr(t)<z?E=T:s.locationToScreenPoint(M).distSqr(t)<z&&(E=M)}for(;Math.abs(E.lng-s.center.lng)>180;){const T=s.locationToScreenPoint(E);if(T.x>=0&&T.y>=0&&T.x<=s.width&&T.y<=s.height)break;E.lng>s.center.lng?E.lng-=360:E.lng+=360}return E.lng!==x.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(E))?E:x}const wu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hh(E,t,s){const d=E.classList;for(const x in wu)d.remove(`maplibregl-${s}-anchor-${x}`);d.add(`maplibregl-${s}-anchor-${t}`)}class dh extends h.E{constructor(t){if(super(),this._onKeyPress=s=>{const d=s.code,x=s.charCode||s.keyCode;d!=="Space"&&d!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=s=>{const d=s.originalEvent.target,x=this._element;this._popup&&(d===x||x.contains(d))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=vu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,`${wu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${x}`),Ce.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div");const s=he.createNS("http://www.w3.org/2000/svg","svg"),d=41,x=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${d}px`),s.setAttributeNS(null,"width",`${x}px`),s.setAttributeNS(null,"viewBox",`0 0 ${x} ${d}`);const T=he.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const M=he.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const z=he.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of j){const Be=he.createNS("http://www.w3.org/2000/svg","ellipse");Be.setAttributeNS(null,"opacity","0.04"),Be.setAttributeNS(null,"cx","10.5"),Be.setAttributeNS(null,"cy","5.80029008"),Be.setAttributeNS(null,"rx",Re.rx),Be.setAttributeNS(null,"ry",Re.ry),z.appendChild(Be)}const Z=he.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const W=he.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(W);const ee=he.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"fill","#000000");const J=he.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ee.appendChild(J);const se=he.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const pe=he.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ae=he.createNS("http://www.w3.org/2000/svg","circle");Ae.setAttributeNS(null,"fill","#000000"),Ae.setAttributeNS(null,"opacity","0.25"),Ae.setAttributeNS(null,"cx","5.5"),Ae.setAttributeNS(null,"cy","5.5"),Ae.setAttributeNS(null,"r","5.4999962");const Ne=he.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),pe.appendChild(Ae),pe.appendChild(Ne),M.appendChild(z),M.appendChild(Z),M.appendChild(ee),M.appendChild(se),M.appendChild(pe),s.appendChild(M),s.setAttributeNS(null,"height",d*this._scale+"px"),s.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),hh(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const x=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,d;const x=(s=this._map)===null||s===void 0?void 0:s.terrain,T=this._map.transform.isLocationOccluded(this._lngLat);if(!x||T){const se=T?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==se&&(this._element.style.opacity=se))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const M=this._map,z=M.terrain.depthAtPoint(this._pos),j=M.terrain.getElevationForLngLat(this._lngLat,M.transform);if(M.transform.lngLatToCameraDepth(this._lngLat,j)-z<.006)return void(this._element.style.opacity=this._opacity);const Z=-this._offset.y/M.transform.pixelsPerMeter,W=Math.sin(M.getPitch()*Math.PI/180)*Z,ee=M.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),J=M.transform.lngLatToCameraDepth(this._lngLat,j+W)-ee>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&J&&this._popup.remove(),this._element.style.opacity=J?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return(this._opacity===void 0||t===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const fh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let gc=0,Xl=!1;const oa={maxWidth:100,unit:"metric"};function Hr(E,t,s){const d=s&&s.maxWidth||100,x=E._container.clientHeight/2,T=E._container.clientWidth/2,M=E.unproject([T-d/2,x]),z=E.unproject([T+d/2,x]),j=Math.round(E.project(z).x-E.project(M).x),Z=Math.min(d,j,E._container.clientWidth),W=M.distanceTo(z);if(s&&s.unit==="imperial"){const ee=3.2808*W;ee>5280?vl(t,Z,ee/5280,E._getUIString("ScaleControl.Miles")):vl(t,Z,ee,E._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?vl(t,Z,W/1852,E._getUIString("ScaleControl.NauticalMiles")):W>=1e3?vl(t,Z,W/1e3,E._getUIString("ScaleControl.Kilometers")):vl(t,Z,W,E._getUIString("ScaleControl.Meters"))}function vl(E,t,s,d){const x=(function(T){const M=Math.pow(10,`${Math.floor(T)}`.length-1);let z=T/M;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:(function(j){const Z=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*Z)/Z})(z),M*z})(s);E.style.width=t*(x/s)+"px",E.innerHTML=`${x}&nbsp;${d}`}const Vc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Gc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Eu(E){if(E){if(typeof E=="number"){const t=Math.round(Math.abs(E)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,E),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-E),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(E,0),right:new h.P(-E,0)}}if(E instanceof h.P||Array.isArray(E)){const t=h.P.convert(E);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(E.center||[0,0]),top:h.P.convert(E.top||[0,0]),"top-left":h.P.convert(E["top-left"]||[0,0]),"top-right":h.P.convert(E["top-right"]||[0,0]),bottom:h.P.convert(E.bottom||[0,0]),"bottom-left":h.P.convert(E["bottom-left"]||[0,0]),"bottom-right":h.P.convert(E["bottom-right"]||[0,0]),left:h.P.convert(E.left||[0,0]),right:h.P.convert(E.right||[0,0])}}return Eu(new h.P(0,0))}const Fo=V;R.AJAXError=h.cI,R.Event=h.l,R.Evented=h.E,R.LngLat=h.V,R.MercatorCoordinate=h.a9,R.Point=h.P,R.addProtocol=h.cJ,R.config=h.c,R.removeProtocol=h.cK,R.AttributionControl=Jr,R.BoxZoomHandler=pc,R.CanvasSource=oe,R.CooperativeGesturesHandler=Dn,R.DoubleClickZoomHandler=td,R.DragPanHandler=Xd,R.DragRotateHandler=ro,R.EdgeInsets=ma,R.FullscreenControl=class extends h.E{constructor(E={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,E&&E.container&&(E.container instanceof HTMLElement?this._container=E.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(E){return this._map=E,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){he.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const E=this._fullscreenButton=he.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);he.create("span","maplibregl-ctrl-icon",E).setAttribute("aria-hidden","true"),E.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const E=this._getTitle();this._fullscreenButton.setAttribute("aria-label",E),this._fullscreenButton.title=E}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},R.GeoJSONSource=fi,R.GeolocateControl=class extends h.E{constructor(E){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new h.V(t.coords.longitude,t.coords.latitude),d=t.coords.accuracy,x=this._map.getBearing(),T=h.e({bearing:x},this.options.fitBoundsOptions),M=si.fromLngLat(s,d);this._map.fitBounds(M,T,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new h.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Xl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=he.create("button","maplibregl-ctrl-geolocate",this._container),he.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new dh({element:this._dotElement}),this._circleElement=he.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{const d=s?.[0]instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},fh,E)}onAdd(E){return this._map=E,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(t=!1){if(Bo!==void 0&&!t)return Bo;if(window.navigator.permissions===void 0)return Bo=!!window.navigator.geolocation,Bo;try{Bo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Bo=!!window.navigator.geolocation}return Bo}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,gc=0,Xl=!1}_isOutOfMapMaxBounds(E){const t=this._map.getMaxBounds(),s=E.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const E=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&E))return;const t=this._map.project(E),s=this._map.unproject([t.x+100,t.y]),d=E.distanceTo(s)/100,x=2*this._accuracy/d;this._circleElement.style.width=`${x.toFixed(2)}px`,this._circleElement.style.height=`${x.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gc--,Xl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let E;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),gc++,gc>1?(E={maximumAge:6e5,timeout:0},Xl=!0):(E=this.options.positionOptions,Xl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,E)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},R.GlobeControl=class{constructor(){this._toggleProjection=()=>{var E;const t=(E=this._map.getProjection())===null||E===void 0?void 0:E.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var E;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((E=this._map.getProjection())===null||E===void 0?void 0:E.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(E){return this._map=E,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=he.create("button","maplibregl-ctrl-globe",this._container),he.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},R.Hash=as,R.ImageSource=ci,R.KeyboardHandler=cr,R.LngLatBounds=si,R.LogoControl=uh,R.Map=class extends os{constructor(E){var t,s;h.cG.mark(h.cH.create);const d=Object.assign(Object.assign(Object.assign({},Zl),E),{canvasContextAttributes:Object.assign(Object.assign({},Zl.canvasContextAttributes),E.canvasContextAttributes)});if(d.minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const x=new zr,T=new Jo;if(d.minZoom!==void 0&&x.setMinZoom(d.minZoom),d.maxZoom!==void 0&&x.setMaxZoom(d.maxZoom),d.minPitch!==void 0&&x.setMinPitch(d.minPitch),d.maxPitch!==void 0&&x.setMaxPitch(d.maxPitch),d.renderWorldCopies!==void 0&&x.setRenderWorldCopies(d.renderWorldCopies),d.transformConstrain!==null&&x.setConstrainOverride(d.transformConstrain),super(x,T,{bearingSnap:d.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ql,this._controls=[],this._mapId=h.af(),this._lostContextStyle={style:null,images:null},this._contextLost=z=>{z.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const j of Object.values(this.style._layers))if(j.type==="custom"&&console.warn(`Custom layer with id '${j.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),j._listeners)for(const[Z]of Object.entries(j._listeners))console.warn(`Custom layer with id '${j.id}' had event listeners for event '${Z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new h.l("webglcontextlost",{originalEvent:z}))},this._contextRestored=z=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:z}))},this._onMapScroll=z=>{if(z.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},d.canvasContextAttributes),this._trackResize=d.trackResize===!0,this._bearingSnap=d.bearingSnap,this._centerClampedToGround=d.centerClampedToGround,this._refreshExpiredTiles=d.refreshExpiredTiles===!0,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions===!0,this._collectResourceTiming=d.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},jc),d.locale),this._clickTolerance=d.clickTolerance,this._overridePixelRatio=d.pixelRatio,this._maxCanvasSize=d.maxCanvasSize,this._zoomLevelsToOverscale=d.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=d.transformCameraUpdate,this.transformConstrain=d.transformConstrain,this.cancelPendingTileRequestsWhileZooming=d.cancelPendingTileRequestsWhileZooming===!0,d.reduceMotion!==void 0&&(Ce.prefersReducedMotion=d.reduceMotion),this._imageQueueHandle=tt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Je(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let z=!1;const j=Hd((Z=>{this._trackResize&&!this._removed&&(this.resize(Z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((Z=>{z?j(Z):z=!0})),this._resizeObserver.observe(this._container)}this.handlers=new ch(this,d),this._hash=d.hash&&new as(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,elevation:d.elevation,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,roll:d.roll}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,h.e({},d.fitBoundsOptions,{duration:0}))));const M=typeof d.style=="string"||((s=(t=d.style)===null||t===void 0?void 0:t.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,M),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Jr(typeof d.attributionControl=="boolean"?void 0:d.attributionControl)),d.maplibreLogo&&this.addControl(new uh,d.logoPosition),this.on("style.load",(()=>{if(M||this._resizeTransform(),this.transform.unmodified){const z=h.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(z)}})),this.on("data",(z=>{this._update(z.dataType==="style"),this.fire(new h.l(`${z.dataType}data`,z))})),this.on("dataloading",(z=>{this.fire(new h.l(`${z.dataType}dataloading`,z))})),this.on("dataabort",(z=>{this.fire(new h.l("sourcedataabort",z))}))}_getMapId(){return this._mapId}setGlobalStateProperty(E,t){return this.style.setGlobalStateProperty(E,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(E,t){if(t===void 0&&(t=E.getDefaultPosition?E.getDefaultPosition():"top-right"),!E||!E.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=E.onAdd(this);this._controls.push(E);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(s,d.firstChild):d.appendChild(s),this}removeControl(E){if(!E||!E.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(E);return t>-1&&this._controls.splice(t,1),E.onRemove(this),this}hasControl(E){return this._controls.indexOf(E)>-1}coveringTiles(E){return nn(this.transform,E)}calculateCameraOptionsFromTo(E,t,s,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLat(s,this.transform)),super.calculateCameraOptionsFromTo(E,t,s,d)}resize(E,t=!0){const[s,d]=this._containerDimensions(),x=this._getClampedPixelRatio(s,d);if(this._resizeCanvas(s,d,x),this.painter.resize(s,d,x),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const z=this._getClampedPixelRatio(s,d);this._resizeCanvas(s,d,z),this.painter.resize(s,d,z)}this._resizeTransform(t);const T=!this._moving;return T&&(this.stop(),this.fire(new h.l("movestart",E)).fire(new h.l("move",E))),this.fire(new h.l("resize",E)),T&&this.fire(new h.l("moveend",E)),this}_resizeTransform(E=!0){var t;const[s,d]=this._containerDimensions();this.transform.resize(s,d,E),(t=this._requestedCameraState)===null||t===void 0||t.resize(s,d,E)}_getClampedPixelRatio(E,t){const{0:s,1:d}=this._maxCanvasSize,x=this.getPixelRatio(),T=E*x,M=t*x;return Math.min(T>s?s/T:1,M>d?d/M:1)*x}getPixelRatio(){var E;return(E=this._overridePixelRatio)!==null&&E!==void 0?E:devicePixelRatio}setPixelRatio(E){this._overridePixelRatio=E,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(E){return this.transform.setMaxBounds(si.convert(E)),this._update()}setMinZoom(E){if((E=E??-2)>=-2&&E<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(E),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(E){if((E=E??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(E),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(E){if((E=E??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(E>=0&&E<=this.transform.maxPitch)return this.transform.setMinPitch(E),this._update(),this.getPitch()<E&&this.setPitch(E),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(E){if((E=E??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(E>=this.transform.minPitch)return this.transform.setMaxPitch(E),this._update(),this.getPitch()>E&&this.setPitch(E),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(E){return this.transform.setRenderWorldCopies(E),this._update()}setTransformConstrain(E){return this.transform.setConstrainOverride(E),this._update()}project(E){return this.transform.locationToScreenPoint(h.V.convert(E),this.style&&this.terrain)}unproject(E){return this.transform.screenPointToLocation(h.P.convert(E),this.terrain)}isMoving(){var E;return this._moving||((E=this.handlers)===null||E===void 0?void 0:E.isMoving())}isZooming(){var E;return this._zooming||((E=this.handlers)===null||E===void 0?void 0:E.isZooming())}isRotating(){var E;return this._rotating||((E=this.handlers)===null||E===void 0?void 0:E.isRotating())}_createDelegatedListener(E,t,s){if(E==="mouseenter"||E==="mouseover"){let d=!1;return{layers:t,listener:s,delegates:{mousemove:T=>{const M=t.filter((j=>this.getLayer(j))),z=M.length!==0?this.queryRenderedFeatures(T.point,{layers:M}):[];z.length?d||(d=!0,s.call(this,new zs(E,this,T.originalEvent,{features:z}))):d=!1},mouseout:()=>{d=!1}}}}if(E==="mouseleave"||E==="mouseout"){let d=!1;return{layers:t,listener:s,delegates:{mousemove:M=>{const z=t.filter((j=>this.getLayer(j)));(z.length!==0?this.queryRenderedFeatures(M.point,{layers:z}):[]).length?d=!0:d&&(d=!1,s.call(this,new zs(E,this,M.originalEvent)))},mouseout:M=>{d&&(d=!1,s.call(this,new zs(E,this,M.originalEvent)))}}}}{const d=x=>{const T=t.filter((z=>this.getLayer(z))),M=T.length!==0?this.queryRenderedFeatures(x.point,{layers:T}):[];M.length&&(x.features=M,s.call(this,x),delete x.features)};return{layers:t,listener:s,delegates:{[E]:d}}}}_saveDelegatedListener(E,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[E]=this._delegatedListeners[E]||[],this._delegatedListeners[E].push(t)}_removeDelegatedListener(E,t,s){if(!this._delegatedListeners||!this._delegatedListeners[E])return;const d=this._delegatedListeners[E];for(let x=0;x<d.length;x++){const T=d[x];if(T.listener===s&&T.layers.length===t.length&&T.layers.every((M=>t.includes(M)))){for(const M in T.delegates)this.off(M,T.delegates[M]);return void d.splice(x,1)}}}on(E,t,s){if(s===void 0)return super.on(E,t);const d=typeof t=="string"?[t]:t,x=this._createDelegatedListener(E,d,s);this._saveDelegatedListener(E,x);for(const T in x.delegates)this.on(T,x.delegates[T]);return{unsubscribe:()=>{this._removeDelegatedListener(E,d,s)}}}once(E,t,s){if(s===void 0)return super.once(E,t);const d=typeof t=="string"?[t]:t,x=this._createDelegatedListener(E,d,s);for(const T in x.delegates){const M=x.delegates[T];x.delegates[T]=(...z)=>{this._removeDelegatedListener(E,d,s),M(...z)}}this._saveDelegatedListener(E,x);for(const T in x.delegates)this.once(T,x.delegates[T]);return this}off(E,t,s){return s===void 0?super.off(E,t):(this._removeDelegatedListener(E,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(E,t){if(!this.style)return[];let s;const d=E instanceof h.P||Array.isArray(E),x=d?E:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(d?{}:E)||{},x instanceof h.P||typeof x[0]=="number")s=[h.P.convert(x)];else{const T=h.P.convert(x[0]),M=h.P.convert(x[1]);s=[T,new h.P(M.x,T.y),M,new h.P(T.x,M.y),T]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(E,t){return this.style.querySourceFeatures(E,t)}setStyle(E,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&E?(this._diffStyle(E,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(E,t))}setTransformRequest(E){return this._requestManager.setTransformRequest(E),this}_getUIString(E){const t=this._locale[E];if(t==null)throw new Error(`Missing UI string '${E}'`);return t}_updateStyle(E,t){var s,d;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(E,t)));const x=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!E)),E?(this.style=new Ea(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof E=="string"?this.style.loadURL(E,t,x):this.style.loadJSON(E,t,x),this):((d=(s=this.style)===null||s===void 0?void 0:s.projection)===null||d===void 0||d.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ea(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(E,t){if(typeof E=="string"){const s=this._requestManager.transformRequest(E,"Style");h.j(s,new AbortController).then((d=>{this._updateDiff(d.data,t)})).catch((d=>{d&&this.fire(new h.k(d))}))}else typeof E=="object"&&this._updateDiff(E,t)}_updateDiff(E,t){try{this.style.setState(E,t)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(E,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(E,t){return this._lazyInitEmptyStyle(),this.style.addSource(E,t),this._update(!0)}isSourceLoaded(E){const t=this.style&&this.style.tileManagers[E];if(t!==void 0)return t.loaded();this.fire(new h.k(new Error(`There is no tile manager with ID '${E}'`)))}setTerrain(E){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),E){const t=this.style.tileManagers[E.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${E.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const d=this.style._layers[s];d.type==="hillshade"&&d.source===E.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),d.type==="color-relief"&&d.source===E.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ti(this.painter,t,E),this.painter.renderToTexture=new Lo(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var d;s.dataType==="style"?this.terrain.tileManager.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==E.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((d=s.source)===null||d===void 0?void 0:d.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:E})),this}getTerrain(){var E,t;return(t=(E=this.terrain)===null||E===void 0?void 0:E.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const E=this.style&&this.style.tileManagers;for(const t of Object.values(E))if(!t.areTilesLoaded())return!1;return!0}removeSource(E){return this.style.removeSource(E),this._update(!0)}getSource(E){return this.style.getSource(E)}setSourceTileLodParams(E,t,s){if(s){const d=this.getSource(s);if(!d)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);d.calculateTileZoom=_n(Math.max(1,E),Math.max(1,t))}else for(const d in this.style.tileManagers)this.style.tileManagers[d].getSource().calculateTileZoom=_n(Math.max(1,E),Math.max(1,t));return this._update(!0),this}refreshTiles(E,t){const s=this.style.tileManagers[E];if(!s)throw new Error(`There is no tile manager with ID "${E}", cannot refresh tile`);t===void 0?s.reload(!0):s.refreshTiles(t.map((d=>new h.ac(d.z,d.x,d.y))))}addImage(E,t,s={}){const{pixelRatio:d=1,sdf:x=!1,stretchX:T,stretchY:M,content:z,textFitWidth:j,textFitHeight:Z}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:W,height:ee,data:J}=t,se=t;return this.style.addImage(E,{data:new h.R({width:W,height:ee},new Uint8Array(J)),pixelRatio:d,stretchX:T,stretchY:M,content:z,textFitWidth:j,textFitHeight:Z,sdf:x,version:0,userImage:se}),se.onAdd&&se.onAdd(this,E),this}}{const{width:W,height:ee,data:J}=Ce.getImageData(t);this.style.addImage(E,{data:new h.R({width:W,height:ee},J),pixelRatio:d,stretchX:T,stretchY:M,content:z,textFitWidth:j,textFitHeight:Z,sdf:x,version:0})}}updateImage(E,t){const s=this.style.getImage(E);if(!s)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||h.b(t)?Ce.getImageData(t):t,{width:x,height:T,data:M}=d;if(x===void 0||T===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==s.data.width||T!==s.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const z=!(t instanceof HTMLImageElement||h.b(t));return s.data.replace(M,z),this.style.updateImage(E,s),this}getImage(E){return this.style.getImage(E)}hasImage(E){return E?!!this.style.getImage(E):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(E){this.style.removeImage(E)}loadImage(E){return tt.getImage(this._requestManager.transformRequest(E,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(E,t){return this._lazyInitEmptyStyle(),this.style.addLayer(E,t),this._update(!0)}moveLayer(E,t){return this.style.moveLayer(E,t),this._update(!0)}removeLayer(E){return this.style.removeLayer(E),this._update(!0)}getLayer(E){return this.style.getLayer(E)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(E,t,s){return this.style.setLayerZoomRange(E,t,s),this._update(!0)}setFilter(E,t,s={}){return this.style.setFilter(E,t,s),this._update(!0)}getFilter(E){return this.style.getFilter(E)}setPaintProperty(E,t,s,d={}){return this.style.setPaintProperty(E,t,s,d),this._update(!0)}getPaintProperty(E,t){return this.style.getPaintProperty(E,t)}setLayoutProperty(E,t,s,d={}){return this.style.setLayoutProperty(E,t,s,d),this._update(!0)}getLayoutProperty(E,t){return this.style.getLayoutProperty(E,t)}setGlyphs(E,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(E,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(E,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(E,t,s,(d=>{d||this._update(!0)})),this}removeSprite(E){return this._lazyInitEmptyStyle(),this.style.removeSprite(E),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(E,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(E,t,(s=>{s||this._update(!0)})),this}setLight(E,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(E,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(E,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(E,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(E,t){return this.style.setFeatureState(E,t),this._update()}removeFeatureState(E,t){return this.style.removeFeatureState(E,t),this._update()}getFeatureState(E){return this.style.getFeatureState(E)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let E=0,t=0;return this._container&&(E=this._container.clientWidth||400,t=this._container.clientHeight||300),[E,t]}_setupContainer(){const E=this._container;E.classList.add("maplibregl-map");const t=this._canvasContainer=he.create("div","maplibregl-canvas-container",E);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=he.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),d=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],d);const x=this._controlContainer=he.create("div","maplibregl-control-container",E),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((M=>{T[M]=he.create("div",`maplibregl-ctrl-${M} `,x)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(E,t,s){this._canvas.width=Math.floor(s*E),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${E}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const E=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(d=>{t={requestedAttributes:E},d&&(t.statusMessage=d.statusMessage,t.type=d.type)}),{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,E):this._canvas.getContext("webgl2",E)||this._canvas.getContext("webgl",E),!s){const d="Failed to initialize WebGL";throw t?(t.message=d,new Error(JSON.stringify(t))):new Error(d)}this.painter=new tp(s,this.transform),ke.testSupport(s)}migrateProjection(E,t){super.migrateProjection(E,t),this.painter.transform=E,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(E){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||E,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(E){return this._update(),this._renderTaskQueue.add(E)}_cancelRenderFrame(E){this._renderTaskQueue.remove(E)}_render(E){var t,s,d,x,T;const M=this._idleTriggered?this._fadeDuration:0,z=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(E),this._removed)return;let j=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const ee=this.transform.zoom,J=ye();this.style.zoomHistory.update(ee,J);const se=new h.H(ee,{now:J,fadeDuration:M,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=se.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(j=!0,this._crossFadingFactor=pe),this.style.update(se)}const Z=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==z;(d=this.style.projection)===null||d===void 0||d.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((x=this.style.projection)===null||x===void 0?void 0:x.transitionState,(T=this.style.projection)===null||T===void 0?void 0:T.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||Z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,Z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cG.mark(h.cH.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||j)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const W=this._sourcesDirty||this._styleDirty||this._placementDirty;return W||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||W||(this._fullyLoaded=!0,h.cG.mark(h.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var E;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),tt.removeThrottleControl(this._imageQueueHandle),(E=this._resizeObserver)===null||E===void 0||E.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),he.remove(this._canvasContainer),he.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cG.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ce.frame(this._frameRequest,(E=>{h.cG.frame(E),this._frameRequest=null;try{this._render(E)}catch(t){if(!h.Z(t)&&!(function(s){return s.message===dc})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(E){this._showTileBoundaries!==E&&(this._showTileBoundaries=E,this._update())}get showPadding(){return!!this._showPadding}set showPadding(E){this._showPadding!==E&&(this._showPadding=E,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(E){this._showCollisionBoxes!==E&&(this._showCollisionBoxes=E,E?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(E){this._showOverdrawInspector!==E&&(this._showOverdrawInspector=E,this._update())}get repaint(){return!!this._repaint}set repaint(E){this._repaint!==E&&(this._repaint=E,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(E){this._vertices=E,this._update()}get version(){return Uc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(E){return this._lazyInitEmptyStyle(),this.style.setProjection(E),this._update(!0)}},R.MapMouseEvent=zs,R.MapTouchEvent=Po,R.MapWheelEvent=Yh,R.Marker=dh,R.NavigationControl=class{constructor(E){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),d=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,s)=>{const d=this._map._getUIString(`NavigationControl.${s}`);t.title=d,t.setAttribute("aria-label",d)},this.options=h.e({},Wd,E),this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),he.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),he.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=he.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(E){return this._map=E,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Br(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(E,t){const s=he.create("button",E,this._container);return s.type="button",s.addEventListener("click",t),s}},R.Popup=class extends h.E{constructor(E){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=he.create("div","maplibregl-popup",this._map.getContainer()),this._tip=he.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=vu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const s=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let d=this.options.anchor;const x=Eu(this.options.offset);if(!d){const M=this._container.offsetWidth,z=this._container.offsetHeight;let j;j=s.y+x.bottom.y<z?["top"]:s.y>this._map.transform.height-z?["bottom"]:[],s.x<M/2?j.push("left"):s.x>this._map.transform.width-M/2&&j.push("right"),d=j.length===0?"bottom":j.join("-")}let T=s.add(x[d]);this.options.subpixelPositioning||(T=T.round()),he.setTransform(this._container,`${wu[d]} translate(${T.x}px,${T.y}px)`),hh(this._container,d,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Vc),E)}addTo(E){return this._map&&this.remove(),this._map=E,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(E){return this._lngLat=h.V.convert(E),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(E){return this.setDOMContent(document.createTextNode(E))}setHTML(E){const t=document.createDocumentFragment(),s=document.createElement("body");let d;for(s.innerHTML=E;d=s.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){var E;return(E=this._container)===null||E===void 0?void 0:E.style.maxWidth}setMaxWidth(E){return this.options.maxWidth=E,this._update(),this}setDOMContent(E){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(E),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(E){return this._container&&this._container.classList.add(E),this}removeClassName(E){return this._container&&this._container.classList.remove(E),this}setOffset(E){return this.options.offset=E,this._update(),this}toggleClassName(E){if(this._container)return this._container.classList.toggle(E)}setSubpixelPositioning(E){this.options.subpixelPositioning=E}_createCloseButton(){this.options.closeButton&&(this._closeButton=he.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const E=this._container.querySelector(Gc);E&&E.focus()}},R.RasterDEMTileSource=gn,R.RasterTileSource=di,R.ScaleControl=class{constructor(E){this._onMove=()=>{Hr(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Hr(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},oa),E)}getDefaultPosition(){return"bottom-left"}onAdd(E){return this._map=E,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-scale",E.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},R.ScrollZoomHandler=oh,R.Style=Ea,R.TerrainControl=class{constructor(E){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=E}onAdd(E){return this._map=E,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=he.create("button","maplibregl-ctrl-terrain",this._container),he.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){he.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},R.TwoFingersTouchPitchHandler=Gl,R.TwoFingersTouchRotateHandler=ah,R.TwoFingersTouchZoomHandler=_l,R.TwoFingersTouchZoomRotateHandler=Fc,R.VectorTileSource=fn,R.VideoSource=ct,R.addSourceType=(E,t)=>h._(void 0,void 0,void 0,(function*(){if(ge(E))throw new Error(`A source type called "${E}" already exists.`);((s,d)=>{ue[s]=d})(E,t)})),R.clearPrewarmedResources=function(){const E=Mn;E&&(E.isPreloaded()&&E.numActive()===1?(E.release(Nt),Mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},R.createTileMesh=Ci,R.getMaxParallelImageRequests=function(){return h.c.MAX_PARALLEL_IMAGE_REQUESTS},R.getRTLTextPluginStatus=function(){return at().getRTLTextPluginStatus()},R.getVersion=function(){return Fo},R.getWorkerCount=function(){return $t.workerCount},R.getWorkerUrl=function(){return h.c.WORKER_URL},R.importScriptInWorkers=function(E){return _i().broadcast("IS",E)},R.isTimeFrozen=function(){return Ee.isFrozen()},R.now=ye,R.prewarm=function(){Rn().acquire(Nt)},R.restoreNow=function(){Ee.restoreNow()},R.setMaxParallelImageRequests=function(E){h.c.MAX_PARALLEL_IMAGE_REQUESTS=E},R.setNow=function(E){Ee.setNow(E)},R.setRTLTextPlugin=function(E,t){return at().setRTLTextPlugin(E,t)},R.setWorkerCount=function(E){$t.workerCount=E},R.setWorkerUrl=function(E){h.c.WORKER_URL=E}}));var k=y;return k}))})(Ug)),Ug.exports}var Kv=zC();const Qv=f0(Kv),LC=J_({__proto__:null,default:Qv},[Kv]),Wn={PARKING_LOG:31417,OPEN_SPOT_BROADCAST:31714,ROUTE_LOG:34171,RELAY_LIST:10002,LISTED_PARKING_METADATA:31147,PARKING_SPOT_LISTING:37141,LISTED_SPOT_LOG:1714,LISTING_STATUS_LOG:1147,PRIVATE_LOG_NOTE:1417},Ei=["wss://relay.primal.net","wss://nos.lol","wss://relay.snort.social"];var ry={},E_;function BC(){if(E_)return ry;E_=1;var c=function(){},f="+",y=8,C="0",N="23456789CFGHJMPQRVWX",k=N.length,R=90,h=180,V=10,H=[20,1,.05,.0025,125e-6],$=4,K=5,be=125e-6,Ce=6;c.prototype.isValid=function(Je){if(!Je||Je.indexOf(f)==-1||Je.indexOf(f)!=Je.lastIndexOf(f)||Je.length==1||Je.indexOf(f)>y||Je.indexOf(f)%2==1)return!1;if(Je.indexOf(C)>-1){if(Je.indexOf(C)==0)return!1;var He=Je.match(new RegExp("("+C+"+)","g"));if(He.length>1||He[0].length%2==1||He[0].length>y-2||Je.charAt(Je.length-1)!=f)return!1}if(Je.length-Je.indexOf(f)-1==1)return!1;Je=Je.replace(new RegExp("\\"+f+"+"),"").replace(new RegExp(C+"+"),"");for(var pt=0,Pe=Je.length;pt<Pe;pt++){var ot=Je.charAt(pt).toUpperCase();if(ot!=f&&N.indexOf(ot)==-1)return!1}return!0},c.prototype.isShort=function(Je){return this.isValid(Je)?Je.indexOf(f)>=0&&Je.indexOf(f)<y:!1},c.prototype.isFull=function(Je){if(!this.isValid(Je)||this.isShort(Je))return!1;var He=N.indexOf(Je.charAt(0).toUpperCase())*k;if(He>=R*2)return!1;if(Je.length>1){var pt=N.indexOf(Je.charAt(1).toUpperCase())*k;if(pt>=h*2)return!1}return!0},c.prototype.encode=function(Je,He,pt){if(typeof pt>"u"&&(pt=V),pt<2||pt<y&&pt%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";Je=Ee(Je),He=he(He),Je==90&&(Je=Je-ye(pt));var Pe=ke(Je,He,Math.min(pt,V));return pt>V&&(Pe+=nt(Je,He,pt-V)),Pe},c.prototype.decode=function(Je){if(!this.isFull(Je))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+Je;Je=Je.replace(f,""),Je=Je.replace(new RegExp(C+"+"),""),Je=Je.toUpperCase();var He=Qe(Je.substring(0,V));if(Je.length<=V)return He;var pt=Ut(Je.substring(V));return wt(He.latitudeLo+pt.latitudeLo,He.longitudeLo+pt.longitudeLo,He.latitudeLo+pt.latitudeHi,He.longitudeLo+pt.longitudeHi,He.codeLength+pt.codeLength)},c.prototype.recoverNearest=function(Je,He,pt){if(!this.isShort(Je)){if(this.isFull(Je))return Je;throw"ValueError: Passed short code is not valid: "+Je}He=Ee(He),pt=he(pt),Je=Je.toUpperCase();var Pe=y-Je.indexOf(f),ot=Math.pow(20,2-Pe/2),gt=ot/2,Rt=Math.floor(He/ot)*ot,Ie=Math.floor(pt/ot)*ot,Se=this.decode(this.encode(Rt,Ie).substr(0,Pe)+Je),je=Se.latitudeCenter-He;return je>gt?Se.latitudeCenter-=ot:je<-gt&&(Se.latitudeCenter+=ot),je=Se.longitudeCenter-pt,je>gt?Se.longitudeCenter-=ot:je<-gt&&(Se.longitudeCenter+=ot),this.encode(Se.latitudeCenter,Se.longitudeCenter,Se.codeLength)},c.prototype.shorten=function(Pe,He,pt){if(!this.isFull(Pe))throw"ValueError: Passed code is not valid and full: "+Pe;if(Pe.indexOf(C)!=-1)throw"ValueError: Cannot shorten padded codes: "+Pe;var Pe=Pe.toUpperCase(),ot=this.decode(Pe);if(ot.codeLength<Ce)throw"ValueError: Code length must be at least "+Ce;He=Ee(He),pt=he(pt);for(var gt=Math.max(Math.abs(ot.latitudeCenter-He),Math.abs(ot.longitudeCenter-pt)),Rt=H.length-2;Rt>=1;Rt--)if(gt<H[Rt]*.3)return Pe.substring((Rt+1)*2);return Pe};var Ee=function(Je){return Math.min(90,Math.max(-90,Je))},ye=function(Je){return Je<=10?Math.pow(20,Math.floor(Je/-2+2)):Math.pow(20,-3)/Math.pow(K,Je-10)},he=function(Je){for(;Je<-180;)Je=Je+360;for(;Je>=180;)Je=Je-360;return Je},ke=function(Je,He,pt){for(var Pe="",ot=Je+R,gt=He+h,Rt=0;Rt<pt;){var Ie=H[Math.floor(Rt/2)],Se=Math.floor(ot/Ie);ot-=Se*Ie,Pe+=N.charAt(Se),Rt+=1,Se=Math.floor(gt/Ie),gt-=Se*Ie,Pe+=N.charAt(Se),Rt+=1,Rt==y&&Rt<pt&&(Pe+=f)}return Pe.length<y&&(Pe=Pe+Array(y-Pe.length+1).join(C)),Pe.length==y&&(Pe=Pe+f),Pe},nt=function(Je,He,pt){for(var Pe="",ot=be,gt=be,Rt=(Je+R)%ot,Ie=(He+h)%gt,Se=0;Se<pt;Se++){var je=Math.floor(Rt/(ot/K)),st=Math.floor(Ie/(gt/$));ot/=K,gt/=$,Rt-=je*ot,Ie-=st*gt,Pe+=N.charAt(je*$+st)}return Pe},Qe=function(Je){var He=dt(Je,0),pt=dt(Je,1);return new wt(He[0]-R,pt[0]-h,He[1]-R,pt[1]-h,Je.length)},dt=function(Je,He){for(var pt=0,Pe=0;pt*2+He<Je.length;)Pe+=N.indexOf(Je.charAt(pt*2+He))*H[pt],pt+=1;return[Pe,Pe+H[pt-1]]},Ut=function(Je){for(var He=0,pt=0,Pe=be,ot=be,gt=0;gt<Je.length;){var Rt=N.indexOf(Je.charAt(gt)),Ie=Math.floor(Rt/$),Se=Rt%$;Pe/=K,ot/=$,He+=Ie*Pe,pt+=Se*ot,gt+=1}return wt(He,pt,He+Pe,pt+ot,Je.length)},wt=c.prototype.CodeArea=function(Je,He,pt,Pe,ot){return new tt.init(Je,He,pt,Pe,ot)},tt={init:function(Je,He,pt,Pe,ot){this.latitudeLo=Je,this.longitudeLo=He,this.latitudeHi=pt,this.longitudeHi=Pe,this.codeLength=ot,this.latitudeCenter=Math.min(Je+(pt-Je)/2,R),this.longitudeCenter=Math.min(He+(Pe-He)/2,h)}};return ry.OpenLocationCode=c,ry}var FC=BC();const jC=f0(FC);function Im(c,f,y=10){const C=[16,8,4,2,1],N="0123456789bcdefghjkmnpqrstuvwxyz";let k=!0,R=-90,h=90,V=-180,H=180,$="",K=0,be=0;for(;$.length<y;){if(k){const Ce=(V+H)/2;f>Ce?(be|=C[K],V=Ce):H=Ce}else{const Ce=(R+h)/2;c>Ce?(be|=C[K],R=Ce):h=Ce}k=!k,K<4?K++:($+=N[be],K=0,be=0)}return $}function UC(c,f){return`${c.toFixed(6)}, ${f.toFixed(6)}`}function VC(c,f,y=5){const C=Im(c,f,y),N=y===5?.02:y===6?.005:.001,k=y===5?.04:y===6?.01:.002,R=new Set;R.add(C);const h=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[V,H]of h){const $=c+V*N,K=f+H*k;R.add(Im($,K,y))}return Array.from(R)}const sy=jC,GC=sy.OpenLocationCode||sy.default?.OpenLocationCode||sy,Ma=new GC;function HC(c,f,y){try{if(Ma&&Ma.recoverNearest){console.log("[Parlens] Attempting Plus Code recovery:",c,"near",f,y);const C=Ma.recoverNearest(c,f,y);console.log("[Parlens] Recovered full code:",C);const N=Ma.decode(C);return console.log("[Parlens] Decoded coordinates:",N.latitudeCenter,N.longitudeCenter),{lat:N.latitudeCenter,lon:N.longitudeCenter,type:"plus_code"}}}catch(C){console.error("[Parlens] Plus Code recovery failed:",C)}return null}function S_(c){const f=c.trim();if(f.replace(//g,"").replace(/,/g," ").split(/\s+/).filter(N=>N.length>0).length>=2){let N=null,k=null;const R=f.match(/^(-?\d+(\.\d+)?)[,\s]+(-?\d+(\.\d+)?)$/);if(R)N=parseFloat(R[1]),k=parseFloat(R[3]);else{const h=f.matchAll(/([0-9.-]+)\s*?\s*([NSEWnsew])?/g),V=Array.from(h);if(V.length===2){const H=parseFloat(V[0][1]),$=V[0][2]?.toUpperCase(),K=parseFloat(V[1][1]),be=V[1][2]?.toUpperCase(),Ce=(he,ke)=>{let nt=he;return(ke==="S"||ke==="W")&&(nt=-he),ke==="N"||ke==="S"?{type:"lat",val:nt}:ke==="E"||ke==="W"?{type:"lon",val:nt}:{type:"unknown",val:nt}},Ee=Ce(H,$),ye=Ce(K,be);Ee.type==="lat"&&ye.type==="lon"?(N=Ee.val,k=ye.val):Ee.type==="lon"&&ye.type==="lat"?(k=Ee.val,N=ye.val):Ee.type==="unknown"&&ye.type==="unknown"&&(N=Ee.val,k=ye.val)}}if(N!==null&&k!==null&&!isNaN(N)&&!isNaN(k)&&N>=-90&&N<=90&&k>=-180&&k<=180)return{lat:N,lon:k,type:"coordinate"}}try{const k=f.split(/[\s,]+/)[0];if(Ma&&Ma.isValid&&Ma.isValid(f)&&Ma.isFull(f)){const R=Ma.decode(f);return{lat:R.latitudeCenter,lon:R.longitudeCenter,type:"plus_code"}}if(k.length>=6&&k.includes("+")&&Ma&&Ma.isValid&&Ma.isValid(k)&&Ma.isFull(k)){const R=Ma.decode(k);return{lat:R.latitudeCenter,lon:R.longitudeCenter,type:"plus_code"}}if(!f.includes("+")){const R=f.toUpperCase().replace(/\s+/g,"+");if(Ma&&Ma.isValid&&Ma.isValid(R)&&Ma.isFull(R)){const h=Ma.decode(R);return{lat:h.latitudeCenter,lon:h.longitudeCenter,type:"plus_code"}}}}catch{}return null}function T_(c,f,y,C){const k=(y-c)*Math.PI/180,R=(C-f)*Math.PI/180,h=Math.sin(k/2)*Math.sin(k/2)+Math.cos(c*Math.PI/180)*Math.cos(y*Math.PI/180)*Math.sin(R/2)*Math.sin(R/2);return 6371*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}async function fx(c,f,y){const C=JSON.stringify(c);if(y){const N=Cm.getConversationKey(y,f);return Cm.encrypt(C,N)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(f,C);throw new Error("No encryption method available")}async function Jv(c,f,y){let C;if(y){const N=Cm.getConversationKey(y,f);C=Cm.decrypt(c,N)}else if(window.nostr?.nip44?.decrypt)C=await window.nostr.nip44.decrypt(f,c);else throw new Error("No decryption method available");return JSON.parse(C)}const Qg={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function e2(c,f){try{const y=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${c}&lon=${f}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!y.ok)throw new Error("Geocoding failed");const N=(await y.json()).address?.country_code?.toUpperCase();return N&&Qg[N]?Qg[N]:"USD"}catch(y){return console.warn("Currency detection failed, using locale fallback:",y),t2()}}function t2(){try{const f=window.navigator.language.split("-")[1]?.toUpperCase();return f&&Qg[f]?Qg[f]:"USD"}catch{return"USD"}}function Mm(c){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:c,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[c]||"$"}}const qC={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function ZC(c){return(qC[c]||"US").toUpperCase().replace(/./g,y=>String.fromCodePoint(y.charCodeAt(0)+127397))}var Vf=Symbol("verified"),XC=c=>c instanceof Object;function n2(c){if(!XC(c)||typeof c.kind!="number"||typeof c.content!="string"||typeof c.created_at!="number"||typeof c.pubkey!="string"||!c.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(c.tags))return!1;for(let f=0;f<c.tags.length;f++){let y=c.tags[f];if(!Array.isArray(y))return!1;for(let C=0;C<y.length;C++)if(typeof y[C]!="string")return!1}return!0}new TextDecoder("utf-8");var WC=new TextEncoder,YC=class{generateSecretKey(){return Gu.utils.randomPrivateKey()}getPublicKey(c){return ss(Gu.getPublicKey(c))}finalizeEvent(c,f){const y=c;return y.pubkey=ss(Gu.getPublicKey(f)),y.id=Vg(y),y.sig=ss(Gu.sign(Vg(y),f)),y[Vf]=!0,y}verifyEvent(c){if(typeof c[Vf]=="boolean")return c[Vf];const f=Vg(c);if(f!==c.id)return c[Vf]=!1,!1;try{const y=Gu.verify(c.sig,f,c.pubkey);return c[Vf]=y,y}catch{return c[Vf]=!1,!1}}};function i2(c){if(!n2(c))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content])}function Vg(c){let f=zd(WC.encode(i2(c)));return ss(f)}var _1=new YC,r2=_1.generateSecretKey,$C=_1.getPublicKey,s2=_1.finalizeEvent;_1.verifyEvent;const wy=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:s2,generateSecretKey:r2,getEventHash:Vg,getPublicKey:$C,serializeEvent:i2,validateEvent:n2,verifiedSymbol:Vf},Symbol.toStringTag,{value:"Module"})),KC=({status:c,setStatus:f,searchLocation:y,vehicleType:C,setOpenSpots:N,parkLocation:k,setParkLocation:R,sessionStart:h,setSessionStart:V,listedParkingSession:H,onQRScan:$})=>{const{pubkey:K,pool:be,signEvent:Ce}=Wu(),[Ee,ye]=De.useState(!1),[he,ke]=De.useState("0"),[nt,Qe]=De.useState("USD"),[dt,Ut]=De.useState("$"),[wt,tt]=De.useState("00:00:00"),[Je,He]=De.useState(new Set),pt=De.useRef(new Map);De.useEffect(()=>{if(c==="parked"&&h){const Rt=()=>{const je=Math.floor(Date.now()/1e3)-h,st=Math.floor(je/3600),mt=Math.floor(je%3600/60),Xt=je%60;tt(`${st.toString().padStart(2,"0")}:${mt.toString().padStart(2,"0")}:${Xt.toString().padStart(2,"0")}`)},Ie=setInterval(Rt,1e3);return Rt(),()=>clearInterval(Ie)}},[c,h]),De.useEffect(()=>{if(c==="search"&&y){const Rt=VC(y[0],y[1],5);He(Ie=>{const Se=new Set(Ie);return Rt.forEach(je=>Se.add(je)),Se.size!==Ie.size?Se:Ie})}else c==="idle"&&(He(new Set),pt.current.clear(),N([]))},[c,y,N]),De.useEffect(()=>{if(be&&(pt.current.clear(),N([]),c==="search"&&Je.size>0)){console.log("[Parlens] Subscribing to spots in geohashes:",Array.from(Je));const Rt=Math.floor(Date.now()/1e3),Ie=st=>{try{const mt=Math.floor(Date.now()/1e3);if(st.kind===Wn.OPEN_SPOT_BROADCAST){const Tn=st.tags.find(Rn=>Rn[0]==="expiration");if(Tn&&parseInt(Tn[1])<mt)return}const Xt=st.tags.find(Tn=>Tn[0]==="location");let Oe=0,Xe=0;if(Xt)[Oe,Xe]=Xt[1].split(",").map(Number);else if(st.kind!==Wn.LISTING_STATUS_LOG)return;let It="car",Nt=0,$t="USD",Bt=1;if(st.kind===Wn.OPEN_SPOT_BROADCAST){const Tn=st.tags.find(_i=>_i[0]==="hourly_rate"),Rn=st.tags.find(_i=>_i[0]==="currency"),ri=st.tags.find(_i=>_i[0]==="type");Nt=Tn?parseFloat(Tn[1]):0,$t=Rn?Rn[1]:"USD",It=ri?ri[1]:"car"}else if(st.kind===Wn.LISTED_SPOT_LOG){if(st.tags.find($n=>$n[0]==="status")?.[1]!=="open"||!Xt)return;const Rn=st.tags.find($n=>$n[0]==="type"),ri=st.tags.find($n=>$n[0]==="hourly_rate"),_i=st.tags.find($n=>$n[0]==="currency");if(It=Rn?.[1]||"car",Nt=ri?parseFloat(ri[1]):0,$t=_i?.[1]||"USD",It!==C)return}const Mn={id:st.id,lat:Oe,lon:Xe,price:Nt,currency:$t,type:It,count:Bt};pt.current.has(st.id)||pt.current.set(st.id,Mn)}catch(mt){console.warn("[Parlens] Error parsing spot event:",mt)}};(async()=>{try{const st=await be.querySync(Ei,{kinds:[Wn.OPEN_SPOT_BROADCAST],"#g":Array.from(Je),since:Rt-600}),mt=await be.querySync(Ei,{kinds:[Wn.LISTED_SPOT_LOG],"#g":Array.from(Je)});for(const Oe of st)Ie(Oe);const Xt=new Map;for(const Oe of mt){const Xe=Oe.tags.find(Nt=>Nt[0]==="a")?.[1];if(!Xe)continue;const It=Xt.get(Xe);(!It||It.created_at<Oe.created_at)&&Xt.set(Xe,Oe)}for(const Oe of Xt.values())Ie(Oe);pt.current.size>0&&N(Array.from(pt.current.values()))}catch(st){console.error("[Parlens] Initial spot fetch failed:",st)}})();const je=be.subscribeMany(Ei,[{kinds:[Wn.OPEN_SPOT_BROADCAST,Wn.LISTED_SPOT_LOG],"#g":Array.from(Je),since:Rt}],{onevent(st){Ie(st),pt.current.has(st.id)||(pt.current.set(st.id,st),N(Array.from(pt.current.values())))},oneose(){}});return()=>{console.log("[Parlens] Unsubscribing from spots"),je.close()}}},[c,Je,be,N]);const Pe=De.useRef(!1);De.useEffect(()=>{(async()=>{if(Pe.current)return;const Ie=t2();if(Qe(Ie),Ut(Mm(Ie)),y){Pe.current=!0;try{const Se=await e2(y[0],y[1]);Qe(Se),Ut(Mm(Se))}catch{console.warn("GPS currency detection failed")}}})()},[y]);const ot=async()=>{c==="idle"?f("search"):c==="search"?(V(Math.floor(Date.now()/1e3)),R(y?[y[0],y[1]]:null),f("parked")):c==="parked"&&(H?$?.():(ke("0"),ye(!0)))},gt=async()=>{f("idle"),ye(!1);const Rt=k?k[0]:y?y[0]:0,Ie=k?k[1]:y?y[1]:0,Se=Im(Rt,Ie,5),je=Math.floor(Date.now()/1e3),st=h||je;try{const mt={status:"vacated",lat:Rt,lon:Ie,geohash:Se,fee:he,currency:nt,type:C,started_at:st,finished_at:je},Xt=localStorage.getItem("parlens_privkey"),Oe=Xt?new Uint8Array(Xt.match(/.{1,2}/g).map(ti=>parseInt(ti,16))):void 0,Xe=await fx(mt,K,Oe),It={kind:Wn.PARKING_LOG,content:Xe,tags:[["d",`session_${st}`],["client","parlens"]],created_at:je,pubkey:K},Nt=await Ce(It);console.log("Publishing log:",Nt.id,"to",Ei);const $t=await Promise.allSettled(be.publish(Ei,Nt)),Bt=$t.filter(ti=>ti.status==="fulfilled").length,Mn=$t.filter(ti=>ti.status==="rejected").length;console.log(`[Parlens] Publish results: ${Bt}/${$t.length} succeeded, ${Mn} failed`),$t.forEach((ti,Bi)=>{ti.status==="rejected"&&console.warn(`[Parlens] Relay ${Ei[Bi]} failed:`,ti.reason)}),Bt===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(ti=>setTimeout(ti,300)),window.dispatchEvent(new Event("parking-log-updated"));const Tn=r2(),Rn=je-st,ri=Math.max(Math.ceil(Rn/3600),1),_i=String(Math.round(parseFloat(he)/ri)),$n=je+300,Kn={kind:Wn.OPEN_SPOT_BROADCAST,content:"",tags:[["d",`spot_${Se}_${je}`],["g",Se],["location",`${Rt},${Ie}`],["hourly_rate",_i],["currency",nt],["type",C],["expiration",String($n)],["client","parlens"]],created_at:je},Qn=s2(Kn,Tn);console.log("[Parlens] *** BROADCASTING OPEN SPOT ***"),console.log("[Parlens] Geohash:",Se),console.log("[Parlens] Location:",`${Rt},${Ie}`),console.log("[Parlens] Event ID:",Qn.id),console.log("[Parlens] Pubkey:",Qn.pubkey.substring(0,20)+"..."),be.publish(Ei,Qn),V(null),R(null)}catch(mt){console.error("Persistence error:",mt),alert("Could not save to Nostr. Check relay connections.")}};return O.jsxs("div",{className:"relative flex flex-col items-end gap-4",children:[O.jsxs("div",{className:"flex items-center gap-4",children:[c==="search"&&O.jsx("button",{onClick:()=>f("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8",children:"CANCEL"}),c==="parked"&&O.jsx("div",{className:"h-14 px-6 rounded-full bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-2xl flex items-center justify-center animate-in slide-in-from-left-8 pointer-events-none",children:O.jsx("span",{className:"font-mono text-xl font-bold tabular-nums text-zinc-900 dark:text-white",children:wt})}),O.jsxs("button",{onClick:ot,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 ${c==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":c==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[c==="idle"&&O.jsx(Zv,{size:32,strokeWidth:2.5}),c==="search"&&O.jsx(Oh,{size:32,strokeWidth:2.5,className:"animate-pulse"}),c==="parked"&&(C==="bicycle"?O.jsx("span",{className:"text-3xl",children:""}):C==="motorcycle"?O.jsx("span",{className:"text-3xl",children:""}):O.jsx("span",{className:"text-3xl",children:""}))]})]}),Ee&&O.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:O.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[O.jsxs("div",{className:"text-center space-y-1",children:[O.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),O.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),O.jsxs("div",{className:"flex items-center gap-4",children:[O.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[O.jsx("span",{className:"text-2xl font-bold text-blue-500",children:dt}),O.jsx("input",{type:"number",value:he,onChange:Rt=>ke(Rt.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),O.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:nt})]}),O.jsxs("div",{className:"flex flex-col gap-1.5",children:[O.jsx("button",{onClick:()=>ke(String(Math.max(0,parseFloat(he||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:O.jsx(x1,{size:22,className:"text-zinc-600 dark:text-white/70"})}),O.jsx("button",{onClick:()=>ke(String(Math.max(0,parseFloat(he||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:O.jsx(kd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),O.jsxs("div",{className:"w-full space-y-3",children:[O.jsxs("button",{onClick:gt,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",O.jsx(Gv,{size:20})]}),O.jsx("button",{onClick:()=>ye(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};function QC(){const{pool:c,pubkey:f}=Wu(),[y,C]=De.useState([]),[N,k]=De.useState(!0),R=De.useRef(new Set),h=De.useCallback(async()=>{if(!(!f||!c)){k(!0),console.log("[useParkingLogs] Fetching logs for",f);try{const H=await c.querySync(Ei,{kinds:[Wn.PARKING_LOG,5],authors:[f],limit:100});console.log("[useParkingLogs] Fetched",H.length,"events");const $=new Set,K=H.filter(ye=>ye.kind===5);for(const ye of K)for(const he of ye.tags)he[0]==="a"&&$.add(he[1]);const Ce=H.filter(ye=>ye.kind===Wn.PARKING_LOG).filter(ye=>{const he=ye.tags?.find(nt=>nt[0]==="d")?.[1];if(!he)return!0;if(R.current.has(he))return!1;const ke=`${ye.kind}:${ye.pubkey}:${he}`;return!$.has(ke)});console.log("[useParkingLogs] Valid logs after filtering:",Ce.length);const Ee=Ce.sort((ye,he)=>he.created_at-ye.created_at);C(Ee)}catch(H){console.error("[useParkingLogs] Fetch error:",H)}finally{k(!1)}}},[c,f]),V=De.useCallback(H=>{console.log("[useParkingLogs] Marking deleted:",H),R.current.add(H)},[]);return De.useEffect(()=>{f&&h()},[f,h]),De.useEffect(()=>{const H=()=>{console.log("[useParkingLogs] Received update event, refetching..."),h()};return window.addEventListener("parking-log-updated",H),window.addEventListener("visibility-refresh",H),()=>{window.removeEventListener("parking-log-updated",H),window.removeEventListener("visibility-refresh",H)}},[h]),{logs:y,loading:N,refetch:h,markDeleted:V}}const JC=({setHistorySpots:c,onOpenChange:f,onHelpClick:y})=>{const{pubkey:C,logout:N,pool:k,signEvent:R}=Wu(),{logs:h,refetch:V,markDeleted:H}=QC(),[$,K]=De.useState(!1),[be,Ce]=De.useState(!1),[Ee,ye]=De.useState([]),[he,ke]=De.useState(!1),[nt,Qe]=De.useState(!1),[dt,Ut]=De.useState(""),[wt,tt]=De.useState(!1),[Je,He]=De.useState(null),[pt,Pe]=De.useState([]),[ot,gt]=De.useState(!1);De.useEffect(()=>{if($)try{const Yt=localStorage.getItem("parlens-hidden-items");Yt&&Pe(JSON.parse(Yt))}catch{}},[$]);const Rt=Yt=>{const fn=pt.filter(di=>di.id!==Yt);Pe(fn),localStorage.setItem("parlens-hidden-items",JSON.stringify(fn))};De.useEffect(()=>{f?.($)},[$,f]);const[Ie,Se]=De.useState(null),[je,st]=De.useState([]),[mt,Xt]=De.useState(!1),[Oe,Xe]=De.useState("all"),[It,Nt]=De.useState(null),[$t,Bt]=De.useState(""),[Mn,Tn]=De.useState(!1),Rn=async Yt=>{if(!(!C||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){Ce(!0);try{const fn=Yt.tags?.find(Zn=>Zn[0]==="d")?.[1];if(!fn)throw new Error("Missing d tag on event");const di={kind:5,content:"Deleted by user",tags:[["a",`${Wn.PARKING_LOG}:${C}:${fn}`],["k",String(Wn.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:C},gn=await R(di);await Promise.allSettled(k.publish(Ei,gn)),H(fn),st(Zn=>Zn.filter(Yi=>Yi.id!==Yt.id))}catch(fn){console.error("Failed to delete parking log:",fn),alert("Failed to delete. Please try again.")}finally{Ce(!1)}}};De.useEffect(()=>{C&&(async()=>{const fn=await k.get(Ei,{kinds:[0],authors:[C]});if(fn)try{const di=JSON.parse(fn.content);Se({name:di.name||di.display_name||"Nostr User",npub:Zf.npubEncode(C),picture:di.picture})}catch(di){console.error("Error parsing profile:",di)}else Se({name:"Nostr User",npub:Zf.npubEncode(C),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${C}`})})()},[C,k]),De.useEffect(()=>{(async()=>{if(!C||!h.length)return;const fn=localStorage.getItem("parlens_privkey"),di=fn?new Uint8Array(fn.match(/.{1,2}/g).map(Zn=>parseInt(Zn,16))):void 0,gn=await Promise.all(h.map(async Zn=>{try{const Yi=await Jv(Zn.content,C,di);return{...Zn,decryptedContent:Yi}}catch{return{...Zn,decryptedContent:null}}}));st(gn.filter(Zn=>Zn.decryptedContent))})()},[h,C]),De.useEffect(()=>{c&&c(mt?je:[])},[mt,je,c]);const ri=()=>{const Yt=localStorage.getItem("parlens_privkey");if(Yt){const fn=Zf.nsecEncode(new Uint8Array(Yt.match(/.{1,2}/g).map(di=>parseInt(di,16))));navigator.clipboard.writeText(fn),alert("Copied to clipboard")}},_i=(Yt,fn)=>{if(!Yt)return"Unknown";const di=fn.getTime()-Yt.getTime(),gn=Math.floor(di/(1e3*60));if(gn<60)return`${gn}m`;const Zn=Math.floor(gn/60),Yi=gn%60;return Yi>0?`${Zn}h ${Yi}m`:`${Zn}h`},$n=async(Yt,fn)=>{if(!(!C||!R)){Tn(!0);try{const di=Yt.tags?.find(oe=>oe[0]==="d")?.[1];if(!di)throw new Error("Missing d tag");const gn=localStorage.getItem("parlens_privkey"),Zn=gn?new Uint8Array(gn.match(/.{1,2}/g).map(oe=>parseInt(oe,16))):void 0,Yi={...Yt.decryptedContent,note:fn},fi=await fx(Yi,C,Zn),ci={kind:Wn.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",di],["client","parlens"]],content:fi},ct=await R(ci);await Promise.allSettled(k.publish(Ei,ct)),st(oe=>oe.map(ue=>ue.id===Yt.id?{...ue,decryptedContent:Yi}:ue)),Nt(null),Bt("")}catch(di){console.error("Failed to update note:",di),alert("Failed to save note")}finally{Tn(!1)}}},Kn=De.useMemo(()=>je.filter(Yt=>{const di=Yt.decryptedContent.type||"car";return!(Oe!=="all"&&di!==Oe)}),[je,Oe]),Qn=De.useCallback(async()=>{if(!(!k||!C)){tt(!0);try{const Yt=await k.get(Ei,{kinds:[Wn.RELAY_LIST],authors:[C]});if(Yt){const fn=Yt.tags.filter(di=>di[0]==="r").map(di=>di[1]);ye(fn)}else ye([...Ei])}catch(Yt){console.error("Error fetching preferred relays:",Yt),ye([...Ei])}finally{tt(!1)}}},[k,C]),ti=async Yt=>{if(!k||!C||!R)return;const fn={kind:Wn.RELAY_LIST,created_at:Math.floor(Date.now()/1e3),tags:Yt.map(gn=>["r",gn]),content:""},di=await R(fn);await Promise.allSettled(k.publish(Ei,di)),ye(Yt)},Bi=async()=>{const Yt=dt.trim();if(He(null),!Yt.startsWith("wss://")){He("Relay URL must start with wss://");return}if(Ee.includes(Yt)){He("This relay is already in your list");return}tt(!0);try{await ti([...Ee,Yt]),Ut(""),Qe(!1)}catch(fn){console.error("Error adding relay:",fn),He("Failed to add relay")}finally{tt(!1)}},si=async Yt=>{if(confirm(`Are you sure you want to remove this relay?

${Yt}

This action cannot be undone.`)){tt(!0);try{await ti(Ee.filter(fn=>fn!==Yt))}catch(fn){console.error("Error removing relay:",fn),alert("Failed to remove relay")}finally{tt(!1)}}};return De.useEffect(()=>{$&&C&&Qn()},[$,C,Qn]),O.jsxs(O.Fragment,{children:[O.jsx("button",{onClick:()=>{V(),K(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:O.jsx(sC,{size:20})}),$&&O.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[O.jsx("button",{onClick:()=>K(!1),className:"absolute inset-0 z-0 cursor-default"}),be&&O.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:O.jsxs("div",{className:"flex flex-col items-center gap-3",children:[O.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),O.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),O.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent",children:Ie?.name||"Nostr User"}),O.jsxs("div",{className:"flex gap-4 items-center",children:[O.jsx("button",{onClick:()=>y?.(),className:"w-10 h-10 flex items-center justify-center rounded-full bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 active:scale-95 transition-all",children:O.jsx("span",{className:"text-xl font-bold",children:"?"})}),O.jsx("button",{onClick:()=>K(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform",children:O.jsx(Il,{size:20})})]})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Keys"}),O.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[O.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText(Ie?.npub),alert("Copied to clipboard")},children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:O.jsx(vy,{size:20})}),O.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),O.jsx(Yf,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),O.jsxs("div",{onClick:ri,className:"flex items-center justify-between p-4 cursor-pointer transition-colors active:bg-black/10 dark:active:bg-white/10",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:O.jsx(Xv,{size:20})}),O.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),O.jsx(Yf,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),O.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost. Use these keys to login to any Nostr client."})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Preferred Relays"}),O.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[O.jsxs("button",{onClick:()=>ke(!he),className:"w-full p-5 flex items-center justify-between transition-colors",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:"p-2.5 rounded-xl bg-green-500/10 dark:bg-green-500/20 text-green-500 dark:text-green-400",children:O.jsx(c_,{size:20})}),O.jsxs("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:["Manage Relays (",Ee.length,")"]})]}),O.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:he?"Hide":"Show"})]}),he&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),O.jsx("div",{className:"p-4 space-y-2",children:wt&&Ee.length===0?O.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):O.jsxs(O.Fragment,{children:[Ee.map(Yt=>O.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10",children:[O.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[O.jsx(c_,{size:16,className:"text-green-500 shrink-0"}),O.jsx("span",{className:"text-sm text-zinc-700 dark:text-white truncate",children:Yt.replace("wss://","")})]}),O.jsx("button",{onClick:()=>si(Yt),disabled:Ee.length<=1,className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform disabled:opacity-30 disabled:cursor-not-allowed",title:Ee.length<=1?"At least one relay is required":"Remove relay",children:O.jsx(Kf,{size:16})})]},Yt)),O.jsxs("button",{onClick:()=>{Qe(!0),He(null),Ut("")},className:"w-full p-3 flex items-center justify-center gap-2 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors active:scale-[0.98]",children:[O.jsx($g,{size:16,className:"text-blue-500"}),O.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Relay"})]})]})})]})]}),O.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Relay address(es) listed in this section tell Parlens where to look for and store data. Parlens requires a connection to at least one relay to work."}),nt&&O.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",onClick:()=>Qe(!1),children:O.jsxs("div",{className:"w-[90%] max-w-sm bg-white dark:bg-[#2c2c2e] rounded-2xl p-5 space-y-4 animate-in zoom-in-95 duration-200",onClick:Yt=>Yt.stopPropagation(),children:[O.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Add Relay"}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("input",{type:"text",value:dt,onChange:Yt=>{Ut(Yt.target.value),He(null)},placeholder:"wss://relay.example.com",className:"w-full h-12 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onKeyDown:Yt=>{Yt.key==="Enter"&&Bi(),Yt.key==="Escape"&&Qe(!1)}}),Je&&O.jsx("p",{className:"text-xs text-red-500 ml-1",children:Je})]}),O.jsxs("div",{className:"flex gap-3",children:[O.jsx("button",{onClick:()=>Qe(!1),className:"flex-1 h-11 rounded-xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-medium transition-all active:scale-95",children:"Cancel"}),O.jsx("button",{onClick:Bi,disabled:wt||!dt.trim(),className:"flex-1 h-11 rounded-xl bg-[#007AFF] text-white font-medium disabled:opacity-50 transition-all active:scale-95",children:wt?"...":"Add"})]})]})}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Hide List"}),O.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[O.jsxs("button",{onClick:()=>gt(!ot),className:"w-full p-5 flex items-center justify-between transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:"p-2.5 rounded-xl bg-amber-500/10 dark:bg-amber-500/20 text-amber-500",children:O.jsx(dx,{size:20})}),O.jsxs("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:["Manage List (",pt.length,")"]})]}),O.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:ot?"Hide":"Show"})]}),ot&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),O.jsx("div",{className:"p-4 space-y-2",children:pt.length===0?O.jsx("p",{className:"text-sm text-zinc-400 dark:text-white/40 text-center py-2",children:"No hidden items"}):pt.map(Yt=>O.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10",children:[O.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[O.jsx("span",{className:"shrink-0",children:Yt.type==="listing"?"":""}),O.jsx("span",{className:"text-sm text-zinc-600 dark:text-white/70 truncate",children:Yt.name}),O.jsx("span",{className:"shrink-0 text-[10px] uppercase px-1.5 py-0.5 rounded-full bg-zinc-100 dark:bg-white/10 text-zinc-400",children:Yt.type})]}),O.jsx("button",{onClick:()=>Rt(Yt.id),className:"p-2 text-zinc-400 hover:text-green-500 transition-colors shrink-0",style:{WebkitTapHighlightColor:"transparent"},children:O.jsx(Xf,{size:16})})]},Yt.id))})]})]}),O.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 text-left ml-2",children:" Items you hide in the listed parking page can be managed here."})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),c&&O.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:"p-2.5 rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:O.jsx(Oh,{size:20})}),O.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),O.jsx("button",{onClick:()=>Xt(!mt),className:`w-12 h-7 rounded-full transition-colors relative ${mt?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:O.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${mt?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),O.jsx("div",{className:"space-y-3",children:O.jsx("div",{className:"flex justify-between items-center gap-2 p-1 bg-zinc-100 dark:bg-white/5 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:["all","bicycle","motorcycle","car"].map(Yt=>O.jsx("button",{onClick:()=>Xe(Yt),className:`flex-1 flex items-center justify-center py-2.5 rounded-[1.2rem] text-sm transition-all active:scale-95 ${Oe===Yt?"bg-white dark:bg-white/10 text-zinc-900 dark:text-white font-bold shadow-sm":"text-zinc-400 dark:text-white/40 hover:text-zinc-600 dark:hover:text-white/60"}`,children:Yt==="all"?"All":O.jsx("span",{className:"text-xl",children:Yt==="bicycle"?"":Yt==="motorcycle"?"":""})},Yt))})}),Kn.length>0?Kn.map(Yt=>{const fn=Yt.decryptedContent,di=Mm(fn.currency||"USD"),gn=fn.started_at?new Date(fn.started_at*1e3):null,Zn=fn.finished_at?new Date(fn.finished_at*1e3):new Date(Yt.created_at*1e3),Yi=fn.lat&&fn.lon?`${fn.lat.toFixed(5)}, ${fn.lon.toFixed(5)}`:null,fi=_i(gn,Zn),ci=gn?gn.toLocaleDateString(void 0,{month:"short",day:"numeric"}):Zn.toLocaleDateString(void 0,{month:"short",day:"numeric"}),ct=fn.type||"car",oe=ct==="bicycle"?"":ct==="motorcycle"?"":"",ue=It===Yt.id;return O.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("span",{className:"text-2xl",children:oe}),O.jsx("p",{className:"font-bold text-xl",children:`${di}${fn.fee||"0"}`})]}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx("span",{className:"text-2xl",children:ZC(fn.currency||"USD")}),O.jsx("button",{onClick:()=>Rn(Yt),className:"p-1.5 text-zinc-400 dark:text-white/30 transition-colors",title:"Delete entry",children:O.jsx(Kf,{size:16})})]})]}),O.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[O.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 dark:text-white/50",children:[O.jsx(Hv,{size:12,className:"text-green-500 dark:text-green-400"}),O.jsx("span",{className:"font-semibold",children:fi})]}),O.jsx("span",{className:"text-zinc-400 dark:text-white/30",children:ci})]}),Yi&&O.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[O.jsx(Oh,{size:12,className:"text-[#007AFF]"}),O.jsx("span",{className:"font-mono",children:Yi})]}),O.jsx("div",{className:"flex items-center gap-2 text-xs text-zinc-500 dark:text-white/50 bg-zinc-100 dark:bg-white/5 rounded-lg px-3 py-2",children:ue?O.jsxs(O.Fragment,{children:[O.jsx("input",{type:"text",value:$t,onChange:ge=>Bt(ge.target.value),placeholder:"Add note",className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-[#007AFF]",autoFocus:!0,onFocus:ge=>ge.currentTarget.select(),onKeyDown:ge=>{ge.key==="Enter"&&$n(Yt,$t),ge.key==="Escape"&&Nt(null)}}),O.jsx("button",{onClick:()=>$n(Yt,$t),disabled:Mn,className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors disabled:opacity-50",children:O.jsx(Xf,{size:16})}),O.jsx("button",{onClick:()=>Nt(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:O.jsx(Il,{size:16})})]}):O.jsxs(O.Fragment,{children:[O.jsx("span",{className:`flex-1 text-left cursor-pointer ${fn.note?"":"text-zinc-400 dark:text-white/30"}`,onClick:()=>{Nt(Yt.id),Bt(fn.note||"")},children:fn.note||"Add note"}),O.jsx("button",{onClick:()=>{Nt(Yt.id),Bt(fn.note||"")},className:"p-1 text-zinc-400 dark:text-white/30 shrink-0",children:O.jsx($f,{size:12})})]})})]},Yt.id)}):O.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:O.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:je.length>0?"No entries match filters":"No recent activity"})})]})]}),O.jsx("button",{onClick:()=>{N(),K(!1)},className:"w-full py-5 rounded-[2rem] bg-zinc-100 dark:bg-zinc-800 text-red-500 font-bold tracking-wide border border-black/5 dark:border-white/5 transition-all active:scale-95 text-center mt-4",children:"Logout"})]})]})]})},e4=({query:c,onSelect:f,countryCode:y,currentLocation:C})=>{const[N,k]=De.useState(null),[R,h]=De.useState(!1);return De.useEffect(()=>{const H=setTimeout(async()=>{if(!c||c.length<4)return;h(!0);const $=async()=>{try{const Ee=c.indexOf(" ");if(Ee>3&&c.includes("+")){const ye=c.substring(0,Ee).trim(),he=c.substring(Ee+1).trim();if(ye.includes("+")&&he.length>0){console.log("[Parlens] Plus Code search:",ye,"in",he);const nt=await(await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(he)}&format=json&limit=1`)).json();if(nt&&nt.length>0){const Qe=parseFloat(nt[0].lat),dt=parseFloat(nt[0].lon),Ut=HC(ye,Qe,dt);if(Ut)return{place_id:-1,lat:Ut.lat.toString(),lon:Ut.lon.toString(),display_name:`Plus Code: ${ye.toUpperCase()}, ${nt[0].display_name}`,type:"plus_code"}}}}}catch(Ee){console.error("[Parlens] Plus Code search error:",Ee)}return null},K=async()=>{try{let Ee=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(c)}&format=json&limit=1`;if(y&&(Ee+=`&countrycodes=${y}`),C){const[ke,nt]=C,Qe=`${nt-1},${ke+1},${nt+1},${ke-1}`;Ee+=`&viewbox=${Qe}`}console.log("[Parlens] Nominatim search:",Ee);const he=await(await fetch(Ee)).json();return console.log("[Parlens] Nominatim result:",he),he&&he.length>0?he[0]:null}catch(Ee){return console.error("[Parlens] Nominatim search error:",Ee),null}},[be,Ce]=await Promise.all([$(),K()]);k(be||Ce||null),h(!1)},500);return()=>clearTimeout(H)},[c,y]),R?O.jsxs("div",{className:"mb-2 p-3 text-xs text-zinc-400 dark:text-white/40 italic flex items-center gap-2",children:[O.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-zinc-300 border-t-zinc-600 animate-spin"}),"Searching..."]}):N?O.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-purple-50 dark:bg-purple-500/10 border border-purple-500/20",children:[O.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium text-purple-700 dark:text-purple-400 bg-purple-100/50 dark:bg-purple-500/5",children:[" ",N.type==="plus_code"?"Plus Code Location":"Global Search Result"]}),O.jsxs("button",{onClick:()=>f(N),className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[O.jsx(Oh,{size:16,className:"text-purple-600 dark:text-purple-400 shrink-0"}),O.jsxs("div",{className:"flex-1 truncate",children:[O.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white truncate",children:N.display_name.split(",")[0]}),O.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:N.display_name})]})]})]}):null},t4=({vehicleType:c,onRouteChange:f,currentLocation:y,onDropPinModeChange:C,pendingWaypoints:N,onDropPinConsumed:k,onOpenChange:R,onWaypointsChange:h,onRequestOrientationPermission:V,isOpen:H,onClose:$,hideTrigger:K,onRouteCreated:be})=>{const{pool:Ce,pubkey:Ee,signEvent:ye}=Wu(),[he,ke]=De.useState(!1),nt=H!==void 0?H:he,Qe=fe=>{ke(fe),!fe&&$&&$()};De.useEffect(()=>{R?.(nt)},[nt,R]);const[dt,Ut]=De.useState([]);De.useEffect(()=>{h?.(dt)},[dt,h]);const[wt,tt]=De.useState(""),[Je,He]=De.useState(!1),[pt,Pe]=De.useState(null),[ot,gt]=De.useState(null),[Rt,Ie]=De.useState(!1),Se=De.useRef(null),[je,st]=De.useState([]),[mt,Xt]=De.useState(""),[Oe,Xe]=De.useState(!1),[It,Nt]=De.useState(!1),[$t,Bt]=De.useState(!1),[Mn,Tn]=De.useState(!1),[Rn,ri]=De.useState(null),[_i,$n]=De.useState(""),[Kn,Qn]=De.useState(!1),[ti,Bi]=De.useState(null),[si,Yt]=De.useState({}),fn=De.useRef(new Set);De.useEffect(()=>{(async()=>{if(!(!y||ti))try{const Me=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${y[0]}&lon=${y[1]}&format=json`)).json();Me&&Me.address&&Me.address.country_code&&(console.log("[Parlens] Detected Country:",Me.address.country_code),Bi(Me.address.country_code))}catch(de){console.error("[Parlens] Failed to detect country:",de)}})()},[y,ti]);const di=na.useMemo(()=>{if(!wt||wt.length<2)return[];const fe=wt.toLowerCase(),de=[];for(const Me of je)for(const Ue of Me.decryptedContent.waypoints)Ue.name.toLowerCase().includes(fe)&&(de.find(xt=>xt.name.toLowerCase()===Ue.name.toLowerCase())||de.push({name:Ue.name,lat:Ue.lat,lon:Ue.lon}));return de.slice(0,5)},[wt,je]),gn=fe=>{const de=dt.filter(Me=>Me.id!==fe);Ut(de),Pe(null),gt(null),He(!1),f(null,null,de,!1)},Zn=()=>{Ut([]),Pe(null),gt(null),He(!1),f(null,null,[],!1)},Yi=(fe,de)=>{if(fe+de<0||fe+de>=dt.length)return;const Me=[...dt];[Me[fe],Me[fe+de]]=[Me[fe+de],Me[fe]],Ut(Me),Pe(null),gt(null),He(!1),f(null,null,Me,!1)},fi=()=>{const fe=[...dt].reverse();Ut(fe),Pe(null),gt(null),He(!1),f(null,null,fe,!1)},ci=async()=>{if(dt.length<2){alert("Add at least 2 waypoints to create a route");return}Ie(!0);try{const de={bicycle:"bike",motorcycle:"driving",car:"driving"}[c],Me=[],Ue=[],xt={};for(let cn=0;cn<dt.length-1;cn++){const Ke=dt[cn],kn=dt[cn+1],Fn=`${Ke.lon},${Ke.lat};${kn.lon},${kn.lat}`;console.log(`[Parlens] Fetching segment ${cn+1}: ${Ke.name}  ${kn.name}`);const wn=await fetch(`https://router.project-osrm.org/route/v1/${de}/${Fn}?overview=full&geometries=geojson&alternatives=true`);if(!wn.ok)throw new Error(`OSRM error: ${wn.status}`);const _n=await wn.json();if(_n.code==="Ok"&&_n.routes&&_n.routes[0]){if(_n.waypoints&&_n.waypoints.length>=2){const Yn=_n.waypoints[0].location,nn=_n.waypoints[1].location;xt[cn]||(xt[cn]={lat:Yn[1],lon:Yn[0]}),xt[cn+1]={lat:nn[1],lon:nn[0]}}const gi=_n.routes[0].geometry.coordinates.map(Yn=>[Yn[1],Yn[0]]);if(Me.push(gi),_n.routes.length>1){const Yn=_n.routes[1].geometry.coordinates.map(nn=>[nn[1],nn[0]]);Ue.push(Yn),console.log(`[Parlens] Segment ${cn+1} has alternate route`)}else Ue.push(gi),console.log(`[Parlens] Segment ${cn+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${cn+1}`)}const yt=[],qt=[];for(let cn=0;cn<Me.length;cn++){const Ke=cn===0?0:1;yt.push(...Me[cn].slice(Ke)),qt.push(...Ue[cn].slice(Ke))}console.log("[Parlens] Combined primary route:",yt.length,"points"),console.log("[Parlens] Combined alternate route:",qt.length,"points"),Pe(yt),gt(qt),Yt(xt),He(!0);const Ot=Object.keys(xt).length===dt.length?dt.map((cn,Ke)=>({...cn,...xt[Ke]})):dt;f(yt,qt,Ot.map(cn=>({lat:cn.lat,lon:cn.lon})),!0),V&&V(),Qe(!1),be?.()}catch(fe){console.error("Route creation error:",fe);const de=dt.map(Me=>[Me.lat,Me.lon]);Pe(de),gt(null),Yt({}),He(!0),f(de,null,dt.map(Me=>({lat:Me.lat,lon:Me.lon})),!0),Qe(!1),be?.()}finally{Ie(!1)}},ct=()=>{const fe=!Je;He(fe);const de=Object.keys(si).length===dt.length?dt.map((Me,Ue)=>({...Me,...si[Ue]})):dt;f(pt,ot,de.map(Me=>({lat:Me.lat,lon:Me.lon})),fe)},oe=De.useCallback(async()=>{if(!(!Ce||!Ee)){Nt(!0);try{const fe=await Ce.querySync(Ei,{kinds:[Wn.ROUTE_LOG],authors:[Ee]});console.log("[Parlens] Fetched route events:",fe.length);const de=localStorage.getItem("parlens_privkey"),Me=de?new Uint8Array(de.match(/.{1,2}/g).map(xt=>parseInt(xt,16))):void 0,Ue=[];for(const xt of fe){if(xt.tags.find(qt=>qt[0]==="deleted"))continue;const yt=xt.tags.find(qt=>qt[0]==="d")?.[1]||"";if(!(yt&&fn.current.has(yt))&&xt.content)try{const qt=await Jv(xt.content,Ee,Me);if(qt){const Ot=xt.tags.find(cn=>cn[0]==="d")?.[1]||"";Ue.push({id:xt.id,dTag:Ot,decryptedContent:qt,created_at:xt.created_at})}}catch(qt){console.warn("[Parlens] Failed to decrypt route:",qt)}}st(xt=>{const yt=new Map;xt.forEach(Ot=>yt.set(Ot.id,Ot)),Ue.forEach(Ot=>yt.set(Ot.id,Ot));const qt=Array.from(yt.values()).sort((Ot,cn)=>cn.created_at-Ot.created_at);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(qt))}catch(Ot){console.warn("[Parlens] Failed to cache routes:",Ot)}return qt})}catch(fe){console.error("Error fetching saved routes:",fe)}finally{Nt(!1)}}},[Ce,Ee]);De.useEffect(()=>{if(nt&&Ee){try{const fe=localStorage.getItem("parlens_route_cache_v1");if(fe){const de=JSON.parse(fe);st(de)}}catch(fe){console.warn("[Parlens] Failed to load cached routes:",fe)}oe()}},[nt,Ee,oe]);const ue=()=>{const fe=!Mn;Tn(fe),C?.(fe),fe&&(Qe(!1),h?.(dt))};De.useEffect(()=>{if(N){if(N.length>0){const fe=N.map((de,Me)=>({id:crypto.randomUUID(),name:de.name||`Pin ${dt.length+Me+1}`,lat:de.lat,lon:de.lon}));Ut(de=>[...de,...fe]),Pe(null),gt(null),He(!1),f(null,null,[...dt,...fe],!1),Yt({})}k?.(),Qe(!0),C?.(!1)}},[N,k,C,f]);const ge=async()=>{if(!Ce||!Ee||!ye||!pt||dt.length<2){alert("Please create a route first");return}const fe=mt.trim()||`Route ${new Date().toLocaleDateString()}`;Xe(!0);try{const de=Object.keys(si).length===dt.length?dt.map((wn,_n)=>({name:wn.name,lat:si[_n].lat,lon:si[_n].lon})):dt.map(wn=>({name:wn.name,lat:wn.lat,lon:wn.lon})),Me={name:fe,waypoints:de,routeCoords:pt,alternateRouteCoords:ot||void 0,vehicleType:c,created_at:Math.floor(Date.now()/1e3)},Ue=localStorage.getItem("parlens_privkey"),xt=Ue?new Uint8Array(Ue.match(/.{1,2}/g).map(wn=>parseInt(wn,16))):void 0,yt=await fx(Me,Ee,xt),qt=`route_${Date.now()}`,Ot={kind:Wn.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",qt],["client","parlens"]],content:yt},cn=await ye(Ot);console.log("[Parlens] Signed route event:",cn);const Ke=await Promise.allSettled(Ce.publish(Ei,cn)),kn=Ke.filter(wn=>wn.status==="fulfilled").length;console.log("[Parlens] Route published:",kn,"of",Ke.length,"relays"),kn===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)");const Fn={id:cn.id,dTag:qt,decryptedContent:Me,created_at:cn.created_at};st(wn=>{const _n=[Fn,...wn];try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(_n))}catch(gi){console.warn("Cache update failed",gi)}return _n}),Xt("")}catch(de){console.error("[Parlens] Error saving route:",de),alert("Failed to save route, try again later")}finally{Xe(!1)}},qe=(fe,de)=>{Ut(Me=>Me.map(Ue=>Ue.id===fe?{...Ue,name:de}:Ue)),ri(null),$n("")},$e=fe=>{ri(fe.id),$n(fe.name)},bt=async fe=>{const de=fe.decryptedContent,Me=de.waypoints.map(Ue=>({id:crypto.randomUUID(),name:Ue.name,lat:Ue.lat,lon:Ue.lon}));Ut(Me),Pe(de.routeCoords),gt(de.alternateRouteCoords||null),Yt({}),He(!0),Bt(!1),f(de.routeCoords,de.alternateRouteCoords||null,de.waypoints.map(Ue=>({lat:Ue.lat,lon:Ue.lon})),!0),Qe(!1)},at=async fe=>{if(!(!Ce||!Ee||!ye)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){Qn(!0);try{const de={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",fe.id],["a",`${Wn.ROUTE_LOG}:${Ee}:${fe.dTag}`]],content:"Deleted by user"},Me=await ye(de);await Promise.allSettled(Ce.publish(Ei,Me));const Ue={kind:Wn.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",fe.dTag],["deleted","true"]],content:""},xt=await ye(Ue);await Promise.allSettled(Ce.publish(Ei,xt)),fn.current.add(fe.dTag),st(yt=>{const qt=yt.filter(Ot=>Ot.id!==fe.id);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(qt))}catch(Ot){console.warn("Cache update failed",Ot)}return qt})}catch(de){console.error("Error deleting route:",de),alert("Failed to delete route")}finally{Qn(!1)}}};return O.jsxs(O.Fragment,{children:[!K&&O.jsx("button",{onClick:()=>Qe(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:O.jsx(qv,{size:20})}),nt&&O.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[O.jsx("button",{onClick:()=>Qe(!1),className:"absolute inset-0 z-0 cursor-default"}),Kn&&O.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:O.jsxs("div",{className:"flex flex-col items-center gap-3",children:[O.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),O.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),Oe&&O.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:O.jsxs("div",{className:"flex flex-col items-center gap-3",children:[O.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),O.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),O.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),O.jsx("button",{onClick:()=>Qe(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:O.jsx(Il,{size:20,className:"text-black/60 dark:text-white/60"})})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Add Waypoint"}),O.jsxs("div",{className:"relative",children:[O.jsx("input",{ref:Se,type:"text",placeholder:"Search waypoint",value:wt,onChange:fe=>tt(fe.target.value),className:"w-full h-14 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 pr-12 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500"}),wt&&O.jsx("button",{onClick:()=>tt(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 text-zinc-400 dark:text-white/40 active:opacity-50 transition-opacity",children:O.jsx(Il,{size:16})})]}),(()=>{const fe=S_(wt);return fe?O.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-blue-50 dark:bg-blue-500/10 border border-blue-500/20",children:[O.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium text-blue-700 dark:text-blue-400 bg-blue-100/50 dark:bg-blue-500/5",children:[" ",fe.type==="plus_code"?"Plus Code Location":"Coordinate"]}),O.jsxs("button",{onClick:()=>{const de={id:crypto.randomUUID(),name:fe.type==="plus_code"?`Plus Code: ${wt}`:`Loc: ${UC(fe.lat,fe.lon)}`,lat:fe.lat,lon:fe.lon};Ut(Me=>[...Me,de]),tt(""),Pe(null),gt(null),He(!1),f(null,null,null,!1),Yt({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[O.jsx(Oh,{size:16,className:"text-blue-600 dark:text-blue-400 shrink-0"}),O.jsxs("div",{className:"flex-1 truncate",children:[O.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Add Location"}),O.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/60",children:[fe.lat.toFixed(6),", ",fe.lon.toFixed(6)]})]})]})]}):null})(),wt.length>3&&!S_(wt)&&O.jsx(e4,{query:wt,countryCode:ti,currentLocation:y,onSelect:fe=>{const de={id:crypto.randomUUID(),name:fe.display_name.split(",")[0],lat:parseFloat(fe.lat),lon:parseFloat(fe.lon)};Ut(Me=>[...Me,de]),tt(""),Pe(null),gt(null),He(!1),f(null,null,null,!1),Yt({})}}),di.length>0&&O.jsxs("div",{className:"rounded-2xl overflow-hidden bg-green-50 dark:bg-green-500/10 border border-green-500/20",children:[O.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-500/5",children:" From your saved routes"}),di.map((fe,de)=>O.jsxs("button",{onClick:()=>{const Me={id:crypto.randomUUID(),name:fe.name,lat:fe.lat,lon:fe.lon};Ut(Ue=>[...Ue,Me]),tt(""),Pe(null),gt(null),He(!1),f(null,null,null,!1),Yt({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left border-b border-green-500/10 last:border-0",children:[O.jsx(Oh,{size:16,className:"text-green-600 dark:text-green-400 shrink-0"}),O.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white/80 truncate",children:fe.name})]},`saved-${de}`))]}),y&&O.jsxs("button",{onClick:()=>{const fe={id:crypto.randomUUID(),name:"Current Location",lat:y[0],lon:y[1]};Ut(de=>[...de,fe]),Pe(null),gt(null),He(!1),f(null,null,null,!1),Yt({})},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors",children:[O.jsx(BA,{size:16,className:"text-blue-500"}),O.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),O.jsxs("button",{onClick:ue,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 transition-colors",children:[O.jsx(zA,{size:16,className:"text-orange-500"}),O.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),O.jsxs("div",{className:"space-y-2 flex-1",children:[O.jsxs("div",{className:"flex items-center justify-between ml-2 mr-2",children:[O.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Waypoints (",dt.length,")"]}),dt.length>1&&O.jsx("button",{onClick:fi,className:"p-1 rounded-md transition-colors",title:"Reverse Order",children:O.jsx(dA,{size:14,className:"text-zinc-400 dark:text-white/30"})})]}),dt.length===0?O.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):O.jsx("div",{className:"space-y-2",children:dt.map((fe,de)=>O.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[O.jsxs("div",{className:"flex flex-col gap-0.5 -ml-1 mr-1",children:[O.jsx("button",{onClick:()=>Yi(de,-1),disabled:de===0,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:O.jsx(x1,{size:12})}),O.jsx("button",{onClick:()=>Yi(de,1),disabled:de===dt.length-1,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:O.jsx(kd,{size:12})})]}),O.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] text-white text-xs font-bold flex items-center justify-center shrink-0",children:de+1}),Rn===fe.id?O.jsxs(O.Fragment,{children:[O.jsx("input",{type:"text",value:_i,onChange:Me=>$n(Me.target.value),className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onFocus:Me=>Me.currentTarget.select(),onKeyDown:Me=>{Me.key==="Enter"&&qe(fe.id,_i),Me.key==="Escape"&&ri(null)}}),O.jsx("button",{onClick:()=>qe(fe.id,_i),className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors",children:O.jsx(Xf,{size:16})}),O.jsx("button",{onClick:()=>ri(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:O.jsx(Il,{size:16})})]}):O.jsxs(O.Fragment,{children:[O.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:fe.name}),O.jsx("button",{onClick:()=>$e(fe),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:O.jsx($f,{size:14})}),O.jsx("button",{onClick:()=>gn(fe.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:O.jsx(Kf,{size:16})})]})]},fe.id))})]}),pt&&O.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[Je?O.jsx(CA,{size:20,className:"text-blue-500"}):O.jsx(dx,{size:20,className:"text-zinc-400"}),O.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),O.jsx("button",{onClick:ct,className:`w-14 h-8 rounded-full transition-colors ${Je?"bg-[#007AFF]":"bg-zinc-300 dark:bg-white/20"}`,children:O.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${Je?"translate-x-7":"translate-x-1"}`})})]}),pt&&Ee&&O.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[O.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[O.jsx(WA,{size:14}),"Save Route"]}),O.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[O.jsx("input",{type:"text",value:mt,onChange:fe=>Xt(fe.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),O.jsx("button",{onClick:ge,disabled:Oe,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:Oe?"...":"Save"})]})]}),O.jsxs("div",{className:"flex gap-3",children:[O.jsx("button",{onClick:Zn,disabled:dt.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),O.jsx("button",{onClick:ci,disabled:dt.length<2||Rt,className:"flex-1 h-14 rounded-2xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:Rt?"Creating...":"Create Route"})]}),!pt&&dt.length>=2&&Ee&&O.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),Ee&&O.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[O.jsxs("button",{onClick:()=>Bt(!$t),className:"w-full flex items-center justify-between",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx(MA,{size:18,className:"text-zinc-500 dark:text-white/50"}),O.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Saved Routes (",je.length,")"]})]}),O.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:$t?"Hide":"Show"})]}),$t&&O.jsx("div",{className:"space-y-2",children:It?O.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):je.length===0?O.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):je.map(fe=>O.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[O.jsxs("button",{onClick:()=>bt(fe),className:"flex-1 text-left",children:[O.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:fe.decryptedContent.name}),O.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[O.jsxs("span",{children:[fe.decryptedContent.waypoints.length," stops"]}),O.jsx("span",{children:""}),O.jsx(Hv,{size:12}),O.jsx("span",{children:new Date(fe.created_at*1e3).toLocaleDateString()})]})]}),O.jsx("button",{onClick:()=>at(fe),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:O.jsx(Kf,{size:16})})]},fe.id))})]}),O.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:O.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[O.jsx("strong",{children:"Tip:"})," If place name does not return results, use coordinate or Google Maps plus code in waypoint search. Edit waypoint names to label locations. When you save routes, waypoint names become searchable  building your personal offline map over time! "]})})]})]})]})};function n4(c){return c>=17?8:c>=15?7:c>=13?6:c>=11?5:c>=9?4:3}function A_(c,f,y=!0){if((!y||c.length<2)&&!c.some(h=>(h.count||1)>1)&&c.length<2)return c;const C=n4(f),N=new Map;for(const R of c){const h=f>=15?`${R.lat.toFixed(4)},${R.lon.toFixed(4)}`:Im(R.lat,R.lon,C),V=R.count||1;if(N.has(h)){const H=N.get(h);H.spots.push(R),H.count+=V,H.minPrice=Math.min(H.minPrice,R.price),H.maxPrice=Math.max(H.maxPrice,R.price);const $=H.spots.length;H.lat=H.spots.reduce((K,be)=>K+be.lat,0)/$,H.lon=H.spots.reduce((K,be)=>K+be.lon,0)/$}else N.set(h,{id:`cluster-${h}`,lat:R.lat,lon:R.lon,spots:[R],minPrice:R.price,maxPrice:R.price,currency:R.currency,count:V})}const k=[];for(const R of N.values())R.count===1?k.push(R.spots[0]):k.push(R);return k}function C_(c){return typeof c.count=="number"&&c.count>1}var ay,I_;function i4(){if(I_)return ay;I_=1;for(var c="0123456789bcdefghjkmnpqrstuvwxyz",f={},y=0;y<c.length;y++)f[c.charAt(y)]=y;var C="auto",N=-90,k=90,R=-180,h=180,V=[0,5,7,8,11,12,13,15,16,17,18],H=function(He,pt,Pe){if(Pe===C){if(typeof He=="number"||typeof pt=="number")throw new Error("string notation required for auto precision.");var ot=He.split(".")[1].length,gt=pt.split(".")[1].length,Rt=Math.max(ot,gt);Pe=V[Rt]}else Pe===void 0&&(Pe=9);for(var Ie=[],Se=0,je=0,st=0,mt=k,Xt=N,Oe=h,Xe=R,It;Ie.length<Pe;)if(je%2===0?(It=(Oe+Xe)/2,pt>It?(st=(st<<1)+1,Xe=It):(st=(st<<1)+0,Oe=It)):(It=(mt+Xt)/2,He>It?(st=(st<<1)+1,Xt=It):(st=(st<<1)+0,mt=It)),Se++,je++,Se===5){var Nt=c[st];Ie.push(Nt),Se=0,st=0}return Ie.join("")},$=function(He,pt,Pe){Pe=Pe||52;for(var ot=0,gt=k,Rt=N,Ie=h,Se=R,je,st=0;ot<Pe;)st*=2,ot%2===0?(je=(Ie+Se)/2,pt>je?(st+=1,Se=je):Ie=je):(je=(gt+Rt)/2,He>je?(st+=1,Rt=je):gt=je),ot++;return st},K=function(He){for(var pt=!0,Pe=k,ot=N,gt=h,Rt=R,Ie,Se=0,je=0,st=He.length;je<st;je++){var mt=He[je].toLowerCase();Se=f[mt];for(var Xt=4;Xt>=0;Xt--){var Oe=Se>>Xt&1;pt?(Ie=(gt+Rt)/2,Oe===1?Rt=Ie:gt=Ie):(Ie=(Pe+ot)/2,Oe===1?ot=Ie:Pe=Ie),pt=!pt}}return[ot,Rt,Pe,gt]},be=function(He,pt){pt=pt||52;for(var Pe=k,ot=N,gt=h,Rt=R,Ie=0,Se=0,je=pt/2,st=0;st<je;st++)Se=Ce(He,(je-st)*2-1),Ie=Ce(He,(je-st)*2-2),Ie===0?Pe=(Pe+ot)/2:ot=(Pe+ot)/2,Se===0?gt=(gt+Rt)/2:Rt=(gt+Rt)/2;return[ot,Rt,Pe,gt]};function Ce(He,pt){return He/Math.pow(2,pt)&1}var Ee=function(He){var pt=K(He),Pe=(pt[0]+pt[2])/2,ot=(pt[1]+pt[3])/2,gt=pt[2]-Pe,Rt=pt[3]-ot;return{latitude:Pe,longitude:ot,error:{latitude:gt,longitude:Rt}}},ye=function(He,pt){var Pe=be(He,pt),ot=(Pe[0]+Pe[2])/2,gt=(Pe[1]+Pe[3])/2,Rt=Pe[2]-ot,Ie=Pe[3]-gt;return{latitude:ot,longitude:gt,error:{latitude:Rt,longitude:Ie}}},he=function(He,pt){var Pe=Ee(He),ot=Pe.latitude+pt[0]*Pe.error.latitude*2,gt=Pe.longitude+pt[1]*Pe.error.longitude*2;return gt=wt(gt),ot=tt(ot),H(ot,gt,He.length)},ke=function(He,pt,Pe){Pe=Pe||52;var ot=ye(He,Pe),gt=ot.latitude+pt[0]*ot.error.latitude*2,Rt=ot.longitude+pt[1]*ot.error.longitude*2;return Rt=wt(Rt),gt=tt(gt),$(gt,Rt,Pe)},nt=function(He){var pt=He.length,Pe=Ee(He),ot=Pe.latitude,gt=Pe.longitude,Rt=Pe.error.latitude*2,Ie=Pe.error.longitude*2,Se,je,st=[mt(1,0),mt(1,1),mt(0,1),mt(-1,1),mt(-1,0),mt(-1,-1),mt(0,-1),mt(1,-1)];function mt(Xt,Oe){return Se=ot+Xt*Rt,je=gt+Oe*Ie,je=wt(je),Se=tt(Se),H(Se,je,pt)}return st},Qe=function(He,pt){pt=pt||52;var Pe=ye(He,pt),ot=Pe.latitude,gt=Pe.longitude,Rt=Pe.error.latitude*2,Ie=Pe.error.longitude*2,Se,je,st=[mt(1,0),mt(1,1),mt(0,1),mt(-1,1),mt(-1,0),mt(-1,-1),mt(0,-1),mt(1,-1)];function mt(Xt,Oe){return Se=ot+Xt*Rt,je=gt+Oe*Ie,je=wt(je),Se=tt(Se),$(Se,je,pt)}return st},dt=function(He,pt,Pe,ot,gt){gt=gt||9;for(var Rt=H(He,pt,gt),Ie=H(Pe,ot,gt),Se=Ee(Rt),je=Se.error.latitude*2,st=Se.error.longitude*2,mt=K(Rt),Xt=K(Ie),Oe=Math.round((Xt[0]-mt[0])/je),Xe=Math.round((Xt[1]-mt[1])/st),It=[],Nt=0;Nt<=Oe;Nt++)for(var $t=0;$t<=Xe;$t++)It.push(he(Rt,[Nt,$t]));return It},Ut=function(He,pt,Pe,ot,gt){gt=gt||52;for(var Rt=$(He,pt,gt),Ie=$(Pe,ot,gt),Se=ye(Rt,gt),je=Se.error.latitude*2,st=Se.error.longitude*2,mt=be(Rt,gt),Xt=be(Ie,gt),Oe=Math.round((Xt[0]-mt[0])/je),Xe=Math.round((Xt[1]-mt[1])/st),It=[],Nt=0;Nt<=Oe;Nt++)for(var $t=0;$t<=Xe;$t++)It.push(ke(Rt,[Nt,$t],gt));return It};function wt(He){return He>h?R+He%h:He<R?h+He%h:He}function tt(He){return He>k?k:He<N?N:He}var Je={ENCODE_AUTO:C,encode:H,encode_uint64:$,encode_int:$,decode:Ee,decode_int:ye,decode_uint64:ye,decode_bbox:K,decode_bbox_uint64:be,decode_bbox_int:be,neighbor:he,neighbor_int:ke,neighbors:nt,neighbors_int:Qe,bboxes:dt,bboxes_int:Ut};return ay=Je,ay}var r4=i4();const M_=f0(r4);class oy{q;r;x;p;k;initialized=!1;constructor(f=1e-5,y=.001){this.q=f,this.r=y,this.x=0,this.p=1,this.k=0}filter(f){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(f-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=f,this.initialized=!0,f)}reset(){this.initialized=!1,this.x=0,this.p=1}}class s4{latFilter;lonFilter;bearingFilter;hasLastBearing=!1;constructor(){this.latFilter=new oy(1e-5,.002),this.lonFilter=new oy(1e-5,.002),this.bearingFilter=new oy(.005,.8)}cumulativeBearing=0;lastInputBearing=0;smoothLocation(f,y){return[this.latFilter.filter(f),this.lonFilter.filter(y)]}smoothBearing(f,y,C=!1){if(!C&&y<2)return null;const N=(f%360+360)%360;if(!this.hasLastBearing)return this.lastInputBearing=N,this.cumulativeBearing=N,this.hasLastBearing=!0,this.bearingFilter.reset(),this.bearingFilter.filter(N),N;let k=N-this.lastInputBearing;return k>180?k-=360:k<-180&&(k+=360),this.cumulativeBearing+=k,this.lastInputBearing=N,(this.bearingFilter.filter(this.cumulativeBearing)%360+360)%360}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.cumulativeBearing=0,this.lastInputBearing=0,this.hasLastBearing=!1}}class a4{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(f){const y=(f%360+360)%360;if(!this.initialized)return this.currentRotation=y,this.lastRawBearing=y,this.initialized=!0,this.currentRotation;let C=y-this.lastRawBearing;return C>180?C-=360:C<-180&&(C+=360),this.currentRotation+=C,this.lastRawBearing=y,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(f=0){this.currentRotation=f,this.lastRawBearing=(f%360+360)%360,this.initialized=!0}}class o4{startLat=0;startLon=0;targetLat=0;targetLon=0;currentLat=0;currentLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(f){this.onUpdate=f}animateTo(f,y,C=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=f,this.targetLon=y,this.currentLat=f,this.currentLon=y,this.onUpdate&&this.onUpdate(f,y);return}this.startLat=this.currentLat||this.targetLat,this.startLon=this.currentLon||this.targetLon,this.targetLat=f,this.targetLon=y,this.startTime=performance.now(),this.duration=C,this.animate()}animate=()=>{const y=performance.now()-this.startTime,C=Math.min(y/this.duration,1),N=1-Math.pow(1-C,3),k=this.startLat+(this.targetLat-this.startLat)*N,R=this.startLon+(this.targetLon-this.startLon)*N;this.currentLat=k,this.currentLon=R,this.onUpdate&&this.onUpdate(k,R),C<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class l4{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:15,walking:8,vehicle:5,fast_vehicle:3};pollIntervals={stationary:15e3,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1200,walking:800,vehicle:400,fast_vehicle:200};haversineDistance(f,y,C,N){const R=(C-f)*Math.PI/180,h=(N-y)*Math.PI/180,V=Math.sin(R/2)*Math.sin(R/2)+Math.cos(f*Math.PI/180)*Math.cos(C*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2);return 6371e3*(2*Math.atan2(Math.sqrt(V),Math.sqrt(1-V)))}calculateBearing(f,y,C,N){const k=(N-y)*Math.PI/180,R=Math.sin(k)*Math.cos(C*Math.PI/180),h=Math.cos(f*Math.PI/180)*Math.sin(C*Math.PI/180)-Math.sin(f*Math.PI/180)*Math.cos(C*Math.PI/180)*Math.cos(k);return(Math.atan2(R,h)*180/Math.PI+360)%360}updateLocation(f,y){const C=Date.now();if(!this.initialized)return this.anchorLat=f,this.anchorLon=y,this.displayLat=f,this.displayLon=y,this.lastRawLat=f,this.lastRawLon=y,this.lastUpdateTime=C,this.initialized=!0,{displayLat:f,displayLon:y,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0,bearing:null};const N=this.haversineDistance(this.anchorLat,this.anchorLon,f,y),k=(C-this.lastUpdateTime)/1e3,R=this.haversineDistance(this.lastRawLat,this.lastRawLon,f,y),h=k>0?R/k:0;this.speedHistory.push(h),this.speedHistory.length>5&&this.speedHistory.shift();const V=this.speedHistory.reduce((Ee,ye)=>Ee+ye,0)/this.speedHistory.length;let H;V<.5?H="stationary":V<2?H="walking":V<10?H="vehicle":H="fast_vehicle",this.currentSpeedClass=H;const $=this.bufferZones[H];if(R>1){const Ee=this.calculateBearing(this.lastRawLat,this.lastRawLon,f,y);this.directionChangeBuffer.push(Ee),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((ye,he)=>ye+he,0)/this.directionChangeBuffer.length}this.lastRawLat=f,this.lastRawLon=y,this.lastUpdateTime=C;let K=!1,be=this.displayLat,Ce=this.displayLon;return N>$?(this.anchorLat=f,this.anchorLon=y,be=f,Ce=y,K=!0):(be=this.anchorLat,Ce=this.anchorLon,K=!1),K&&(this.displayLat=be,this.displayLon=Ce),{displayLat:this.displayLat,displayLon:this.displayLon,speed:V,speedClass:H,shouldUpdate:K,animationDuration:this.animationDurations[H],bearing:this.predictedBearing}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}lastAccuracy=10;updateLocationWithAccuracy(f,y,C){this.lastAccuracy=C;const N=this.updateLocation(f,y);if(N.speedClass==="stationary"){const k=Math.max(this.bufferZones.stationary,C*1.5);if(this.haversineDistance(this.anchorLat,this.anchorLon,f,y)<=k)return{...N,displayLat:this.displayLat,displayLon:this.displayLon,shouldUpdate:!1,accuracy:C}}return{...N,accuracy:C}}getLastAccuracy(){return this.lastAccuracy}getSpeedHistoryAverage(){return this.speedHistory.length===0?0:this.speedHistory.reduce((f,y)=>f+y,0)/this.speedHistory.length}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}const c4=()=>{const c=De.useRef(null),[f,y]=De.useState(!1),C=De.useCallback(async()=>{if("wakeLock"in navigator)try{const k=await navigator.wakeLock.request("screen");c.current=k,y(!0),k.addEventListener("release",()=>{y(!1),c.current=null}),console.log("[Parlens] Screen Wake Lock acquired")}catch(k){console.warn("[Parlens] Failed to acquire Wake Lock:",k),y(!1)}else console.warn("[Parlens] Wake Lock API not supported")},[]),N=De.useCallback(async()=>{if(c.current)try{await c.current.release(),c.current=null,y(!1),console.log("[Parlens] Screen Wake Lock released")}catch(k){console.warn("[Parlens] Failed to release Wake Lock:",k)}},[]);return De.useEffect(()=>{const k=async()=>{document.visibilityState==="visible"&&f&&await C()};return document.addEventListener("visibilitychange",k),()=>{document.removeEventListener("visibilitychange",k)}},[f,C]),{requestLock:C,releaseLock:N,isLocked:f}};var Lg=new TextDecoder("utf-8");new TextEncoder;var a2=5e3;function u4(c){let{prefix:f,words:y}=Xu.decode(c,a2),C=new Uint8Array(Xu.fromWords(y));switch(f){case"nprofile":{let N=ly(C);if(!N[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(N[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ss(N[0][0]),relays:N[1]?N[1].map(k=>Lg.decode(k)):[]}}}case"nevent":{let N=ly(C);if(!N[0]?.[0])throw new Error("missing TLV 0 for nevent");if(N[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(N[2]&&N[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(N[3]&&N[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ss(N[0][0]),relays:N[1]?N[1].map(k=>Lg.decode(k)):[],author:N[2]?.[0]?ss(N[2][0]):void 0,kind:N[3]?.[0]?parseInt(ss(N[3][0]),16):void 0}}}case"naddr":{let N=ly(C);if(!N[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!N[2]?.[0])throw new Error("missing TLV 2 for naddr");if(N[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!N[3]?.[0])throw new Error("missing TLV 3 for naddr");if(N[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Lg.decode(N[0][0]),pubkey:ss(N[2][0]),kind:parseInt(ss(N[3][0]),16),relays:N[1]?N[1].map(k=>Lg.decode(k)):[]}}}case"nsec":return{type:f,data:C};case"npub":case"note":return{type:f,data:ss(C)};default:throw new Error(`unknown prefix ${f}`)}}function ly(c){let f={},y=c;for(;y.length>0;){let C=y[0],N=y[1],k=y.slice(2,2+N);if(y=y.slice(2+N),k.length<N)throw new Error(`not enough data to read on TLV ${C}`);f[C]=f[C]||[],f[C].push(k)}return f}function R_(c){return d4("npub",Od(c))}function h4(c,f){let y=Xu.toWords(f);return Xu.encode(c,y,a2)}function d4(c,f){return h4(c,f)}var f4=Object.defineProperty,Jg=Object.getOwnPropertySymbols,o2=Object.prototype.hasOwnProperty,l2=Object.prototype.propertyIsEnumerable,D_=(c,f,y)=>f in c?f4(c,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):c[f]=y,Ey=(c,f)=>{for(var y in f||(f={}))o2.call(f,y)&&D_(c,y,f[y]);if(Jg)for(var y of Jg(f))l2.call(f,y)&&D_(c,y,f[y]);return c},Sy=(c,f)=>{var y={};for(var C in c)o2.call(c,C)&&f.indexOf(C)<0&&(y[C]=c[C]);if(c!=null&&Jg)for(var C of Jg(c))f.indexOf(C)<0&&l2.call(c,C)&&(y[C]=c[C]);return y};var Qf;(c=>{const f=class tr{constructor(V,H,$,K){if(this.version=V,this.errorCorrectionLevel=H,this.modules=[],this.isFunction=[],V<tr.MIN_VERSION||V>tr.MAX_VERSION)throw new RangeError("Version value out of range");if(K<-1||K>7)throw new RangeError("Mask value out of range");this.size=V*4+17;let be=[];for(let Ee=0;Ee<this.size;Ee++)be.push(!1);for(let Ee=0;Ee<this.size;Ee++)this.modules.push(be.slice()),this.isFunction.push(be.slice());this.drawFunctionPatterns();const Ce=this.addEccAndInterleave($);if(this.drawCodewords(Ce),K==-1){let Ee=1e9;for(let ye=0;ye<8;ye++){this.applyMask(ye),this.drawFormatBits(ye);const he=this.getPenaltyScore();he<Ee&&(K=ye,Ee=he),this.applyMask(ye)}}N(0<=K&&K<=7),this.mask=K,this.applyMask(K),this.drawFormatBits(K),this.isFunction=[]}static encodeText(V,H){const $=c.QrSegment.makeSegments(V);return tr.encodeSegments($,H)}static encodeBinary(V,H){const $=c.QrSegment.makeBytes(V);return tr.encodeSegments([$],H)}static encodeSegments(V,H,$=1,K=40,be=-1,Ce=!0){if(!(tr.MIN_VERSION<=$&&$<=K&&K<=tr.MAX_VERSION)||be<-1||be>7)throw new RangeError("Invalid value");let Ee,ye;for(Ee=$;;Ee++){const Qe=tr.getNumDataCodewords(Ee,H)*8,dt=R.getTotalBits(V,Ee);if(dt<=Qe){ye=dt;break}if(Ee>=K)throw new RangeError("Data too long")}for(const Qe of[tr.Ecc.MEDIUM,tr.Ecc.QUARTILE,tr.Ecc.HIGH])Ce&&ye<=tr.getNumDataCodewords(Ee,Qe)*8&&(H=Qe);let he=[];for(const Qe of V){y(Qe.mode.modeBits,4,he),y(Qe.numChars,Qe.mode.numCharCountBits(Ee),he);for(const dt of Qe.getData())he.push(dt)}N(he.length==ye);const ke=tr.getNumDataCodewords(Ee,H)*8;N(he.length<=ke),y(0,Math.min(4,ke-he.length),he),y(0,(8-he.length%8)%8,he),N(he.length%8==0);for(let Qe=236;he.length<ke;Qe^=253)y(Qe,8,he);let nt=[];for(;nt.length*8<he.length;)nt.push(0);return he.forEach((Qe,dt)=>nt[dt>>>3]|=Qe<<7-(dt&7)),new tr(Ee,H,nt,be)}getModule(V,H){return 0<=V&&V<this.size&&0<=H&&H<this.size&&this.modules[H][V]}getModules(){return this.modules}drawFunctionPatterns(){for(let $=0;$<this.size;$++)this.setFunctionModule(6,$,$%2==0),this.setFunctionModule($,6,$%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const V=this.getAlignmentPatternPositions(),H=V.length;for(let $=0;$<H;$++)for(let K=0;K<H;K++)$==0&&K==0||$==0&&K==H-1||$==H-1&&K==0||this.drawAlignmentPattern(V[$],V[K]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(V){const H=this.errorCorrectionLevel.formatBits<<3|V;let $=H;for(let be=0;be<10;be++)$=$<<1^($>>>9)*1335;const K=(H<<10|$)^21522;N(K>>>15==0);for(let be=0;be<=5;be++)this.setFunctionModule(8,be,C(K,be));this.setFunctionModule(8,7,C(K,6)),this.setFunctionModule(8,8,C(K,7)),this.setFunctionModule(7,8,C(K,8));for(let be=9;be<15;be++)this.setFunctionModule(14-be,8,C(K,be));for(let be=0;be<8;be++)this.setFunctionModule(this.size-1-be,8,C(K,be));for(let be=8;be<15;be++)this.setFunctionModule(8,this.size-15+be,C(K,be));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let V=this.version;for(let $=0;$<12;$++)V=V<<1^(V>>>11)*7973;const H=this.version<<12|V;N(H>>>18==0);for(let $=0;$<18;$++){const K=C(H,$),be=this.size-11+$%3,Ce=Math.floor($/3);this.setFunctionModule(be,Ce,K),this.setFunctionModule(Ce,be,K)}}drawFinderPattern(V,H){for(let $=-4;$<=4;$++)for(let K=-4;K<=4;K++){const be=Math.max(Math.abs(K),Math.abs($)),Ce=V+K,Ee=H+$;0<=Ce&&Ce<this.size&&0<=Ee&&Ee<this.size&&this.setFunctionModule(Ce,Ee,be!=2&&be!=4)}}drawAlignmentPattern(V,H){for(let $=-2;$<=2;$++)for(let K=-2;K<=2;K++)this.setFunctionModule(V+K,H+$,Math.max(Math.abs(K),Math.abs($))!=1)}setFunctionModule(V,H,$){this.modules[H][V]=$,this.isFunction[H][V]=!0}addEccAndInterleave(V){const H=this.version,$=this.errorCorrectionLevel;if(V.length!=tr.getNumDataCodewords(H,$))throw new RangeError("Invalid argument");const K=tr.NUM_ERROR_CORRECTION_BLOCKS[$.ordinal][H],be=tr.ECC_CODEWORDS_PER_BLOCK[$.ordinal][H],Ce=Math.floor(tr.getNumRawDataModules(H)/8),Ee=K-Ce%K,ye=Math.floor(Ce/K);let he=[];const ke=tr.reedSolomonComputeDivisor(be);for(let Qe=0,dt=0;Qe<K;Qe++){let Ut=V.slice(dt,dt+ye-be+(Qe<Ee?0:1));dt+=Ut.length;const wt=tr.reedSolomonComputeRemainder(Ut,ke);Qe<Ee&&Ut.push(0),he.push(Ut.concat(wt))}let nt=[];for(let Qe=0;Qe<he[0].length;Qe++)he.forEach((dt,Ut)=>{(Qe!=ye-be||Ut>=Ee)&&nt.push(dt[Qe])});return N(nt.length==Ce),nt}drawCodewords(V){if(V.length!=Math.floor(tr.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let H=0;for(let $=this.size-1;$>=1;$-=2){$==6&&($=5);for(let K=0;K<this.size;K++)for(let be=0;be<2;be++){const Ce=$-be,ye=($+1&2)==0?this.size-1-K:K;!this.isFunction[ye][Ce]&&H<V.length*8&&(this.modules[ye][Ce]=C(V[H>>>3],7-(H&7)),H++)}}N(H==V.length*8)}applyMask(V){if(V<0||V>7)throw new RangeError("Mask value out of range");for(let H=0;H<this.size;H++)for(let $=0;$<this.size;$++){let K;switch(V){case 0:K=($+H)%2==0;break;case 1:K=H%2==0;break;case 2:K=$%3==0;break;case 3:K=($+H)%3==0;break;case 4:K=(Math.floor($/3)+Math.floor(H/2))%2==0;break;case 5:K=$*H%2+$*H%3==0;break;case 6:K=($*H%2+$*H%3)%2==0;break;case 7:K=(($+H)%2+$*H%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[H][$]&&K&&(this.modules[H][$]=!this.modules[H][$])}}getPenaltyScore(){let V=0;for(let be=0;be<this.size;be++){let Ce=!1,Ee=0,ye=[0,0,0,0,0,0,0];for(let he=0;he<this.size;he++)this.modules[be][he]==Ce?(Ee++,Ee==5?V+=tr.PENALTY_N1:Ee>5&&V++):(this.finderPenaltyAddHistory(Ee,ye),Ce||(V+=this.finderPenaltyCountPatterns(ye)*tr.PENALTY_N3),Ce=this.modules[be][he],Ee=1);V+=this.finderPenaltyTerminateAndCount(Ce,Ee,ye)*tr.PENALTY_N3}for(let be=0;be<this.size;be++){let Ce=!1,Ee=0,ye=[0,0,0,0,0,0,0];for(let he=0;he<this.size;he++)this.modules[he][be]==Ce?(Ee++,Ee==5?V+=tr.PENALTY_N1:Ee>5&&V++):(this.finderPenaltyAddHistory(Ee,ye),Ce||(V+=this.finderPenaltyCountPatterns(ye)*tr.PENALTY_N3),Ce=this.modules[he][be],Ee=1);V+=this.finderPenaltyTerminateAndCount(Ce,Ee,ye)*tr.PENALTY_N3}for(let be=0;be<this.size-1;be++)for(let Ce=0;Ce<this.size-1;Ce++){const Ee=this.modules[be][Ce];Ee==this.modules[be][Ce+1]&&Ee==this.modules[be+1][Ce]&&Ee==this.modules[be+1][Ce+1]&&(V+=tr.PENALTY_N2)}let H=0;for(const be of this.modules)H=be.reduce((Ce,Ee)=>Ce+(Ee?1:0),H);const $=this.size*this.size,K=Math.ceil(Math.abs(H*20-$*10)/$)-1;return N(0<=K&&K<=9),V+=K*tr.PENALTY_N4,N(0<=V&&V<=2568888),V}getAlignmentPatternPositions(){if(this.version==1)return[];{const V=Math.floor(this.version/7)+2,H=this.version==32?26:Math.ceil((this.version*4+4)/(V*2-2))*2;let $=[6];for(let K=this.size-7;$.length<V;K-=H)$.splice(1,0,K);return $}}static getNumRawDataModules(V){if(V<tr.MIN_VERSION||V>tr.MAX_VERSION)throw new RangeError("Version number out of range");let H=(16*V+128)*V+64;if(V>=2){const $=Math.floor(V/7)+2;H-=(25*$-10)*$-55,V>=7&&(H-=36)}return N(208<=H&&H<=29648),H}static getNumDataCodewords(V,H){return Math.floor(tr.getNumRawDataModules(V)/8)-tr.ECC_CODEWORDS_PER_BLOCK[H.ordinal][V]*tr.NUM_ERROR_CORRECTION_BLOCKS[H.ordinal][V]}static reedSolomonComputeDivisor(V){if(V<1||V>255)throw new RangeError("Degree out of range");let H=[];for(let K=0;K<V-1;K++)H.push(0);H.push(1);let $=1;for(let K=0;K<V;K++){for(let be=0;be<H.length;be++)H[be]=tr.reedSolomonMultiply(H[be],$),be+1<H.length&&(H[be]^=H[be+1]);$=tr.reedSolomonMultiply($,2)}return H}static reedSolomonComputeRemainder(V,H){let $=H.map(K=>0);for(const K of V){const be=K^$.shift();$.push(0),H.forEach((Ce,Ee)=>$[Ee]^=tr.reedSolomonMultiply(Ce,be))}return $}static reedSolomonMultiply(V,H){if(V>>>8||H>>>8)throw new RangeError("Byte out of range");let $=0;for(let K=7;K>=0;K--)$=$<<1^($>>>7)*285,$^=(H>>>K&1)*V;return N($>>>8==0),$}finderPenaltyCountPatterns(V){const H=V[1];N(H<=this.size*3);const $=H>0&&V[2]==H&&V[3]==H*3&&V[4]==H&&V[5]==H;return($&&V[0]>=H*4&&V[6]>=H?1:0)+($&&V[6]>=H*4&&V[0]>=H?1:0)}finderPenaltyTerminateAndCount(V,H,$){return V&&(this.finderPenaltyAddHistory(H,$),H=0),H+=this.size,this.finderPenaltyAddHistory(H,$),this.finderPenaltyCountPatterns($)}finderPenaltyAddHistory(V,H){H[0]==0&&(V+=this.size),H.pop(),H.unshift(V)}};f.MIN_VERSION=1,f.MAX_VERSION=40,f.PENALTY_N1=3,f.PENALTY_N2=3,f.PENALTY_N3=40,f.PENALTY_N4=10,f.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],f.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],c.QrCode=f;function y(h,V,H){if(V<0||V>31||h>>>V)throw new RangeError("Value out of range");for(let $=V-1;$>=0;$--)H.push(h>>>$&1)}function C(h,V){return(h>>>V&1)!=0}function N(h){if(!h)throw new Error("Assertion error")}const k=class ea{constructor(V,H,$){if(this.mode=V,this.numChars=H,this.bitData=$,H<0)throw new RangeError("Invalid argument");this.bitData=$.slice()}static makeBytes(V){let H=[];for(const $ of V)y($,8,H);return new ea(ea.Mode.BYTE,V.length,H)}static makeNumeric(V){if(!ea.isNumeric(V))throw new RangeError("String contains non-numeric characters");let H=[];for(let $=0;$<V.length;){const K=Math.min(V.length-$,3);y(parseInt(V.substring($,$+K),10),K*3+1,H),$+=K}return new ea(ea.Mode.NUMERIC,V.length,H)}static makeAlphanumeric(V){if(!ea.isAlphanumeric(V))throw new RangeError("String contains unencodable characters in alphanumeric mode");let H=[],$;for($=0;$+2<=V.length;$+=2){let K=ea.ALPHANUMERIC_CHARSET.indexOf(V.charAt($))*45;K+=ea.ALPHANUMERIC_CHARSET.indexOf(V.charAt($+1)),y(K,11,H)}return $<V.length&&y(ea.ALPHANUMERIC_CHARSET.indexOf(V.charAt($)),6,H),new ea(ea.Mode.ALPHANUMERIC,V.length,H)}static makeSegments(V){return V==""?[]:ea.isNumeric(V)?[ea.makeNumeric(V)]:ea.isAlphanumeric(V)?[ea.makeAlphanumeric(V)]:[ea.makeBytes(ea.toUtf8ByteArray(V))]}static makeEci(V){let H=[];if(V<0)throw new RangeError("ECI assignment value out of range");if(V<128)y(V,8,H);else if(V<16384)y(2,2,H),y(V,14,H);else if(V<1e6)y(6,3,H),y(V,21,H);else throw new RangeError("ECI assignment value out of range");return new ea(ea.Mode.ECI,0,H)}static isNumeric(V){return ea.NUMERIC_REGEX.test(V)}static isAlphanumeric(V){return ea.ALPHANUMERIC_REGEX.test(V)}getData(){return this.bitData.slice()}static getTotalBits(V,H){let $=0;for(const K of V){const be=K.mode.numCharCountBits(H);if(K.numChars>=1<<be)return 1/0;$+=4+be+K.bitData.length}return $}static toUtf8ByteArray(V){V=encodeURI(V);let H=[];for(let $=0;$<V.length;$++)V.charAt($)!="%"?H.push(V.charCodeAt($)):(H.push(parseInt(V.substring($+1,$+3),16)),$+=2);return H}};k.NUMERIC_REGEX=/^[0-9]*$/,k.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,k.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let R=k;c.QrSegment=k})(Qf||(Qf={}));(c=>{(f=>{const y=class{constructor(N,k){this.ordinal=N,this.formatBits=k}};y.LOW=new y(0,1),y.MEDIUM=new y(1,0),y.QUARTILE=new y(2,3),y.HIGH=new y(3,2),f.Ecc=y})(c.QrCode||(c.QrCode={}))})(Qf||(Qf={}));(c=>{(f=>{const y=class{constructor(N,k){this.modeBits=N,this.numBitsCharCount=k}numCharCountBits(N){return this.numBitsCharCount[Math.floor((N+7)/17)]}};y.NUMERIC=new y(1,[10,12,14]),y.ALPHANUMERIC=new y(2,[9,11,13]),y.BYTE=new y(4,[8,16,16]),y.KANJI=new y(8,[8,10,12]),y.ECI=new y(7,[0,0,0]),f.Mode=y})(c.QrSegment||(c.QrSegment={}))})(Qf||(Qf={}));var o0=Qf;var p4={L:o0.QrCode.Ecc.LOW,M:o0.QrCode.Ecc.MEDIUM,Q:o0.QrCode.Ecc.QUARTILE,H:o0.QrCode.Ecc.HIGH},c2=128,u2="L",h2="#FFFFFF",d2="#000000",f2=!1,p2=1,m4=4,g4=0,y4=.1;function m2(c,f=0){const y=[];return c.forEach(function(C,N){let k=null;C.forEach(function(R,h){if(!R&&k!==null){y.push(`M${k+f} ${N+f}h${h-k}v1H${k+f}z`),k=null;return}if(h===C.length-1){if(!R)return;k===null?y.push(`M${h+f},${N+f} h1v1H${h+f}z`):y.push(`M${k+f},${N+f} h${h+1-k}v1H${k+f}z`);return}R&&k===null&&(k=h)})}),y.join("")}function g2(c,f){return c.slice().map((y,C)=>C<f.y||C>=f.y+f.h?y:y.map((N,k)=>k<f.x||k>=f.x+f.w?N:!1))}function x4(c,f,y,C){if(C==null)return null;const N=c.length+y*2,k=Math.floor(f*y4),R=N/f,h=(C.width||k)*R,V=(C.height||k)*R,H=C.x==null?c.length/2-h/2:C.x*R,$=C.y==null?c.length/2-V/2:C.y*R,K=C.opacity==null?1:C.opacity;let be=null;if(C.excavate){let Ee=Math.floor(H),ye=Math.floor($),he=Math.ceil(h+H-Ee),ke=Math.ceil(V+$-ye);be={x:Ee,y:ye,w:he,h:ke}}const Ce=C.crossOrigin;return{x:H,y:$,h:V,w:h,excavation:be,opacity:K,crossOrigin:Ce}}function _4(c,f){return f!=null?Math.max(Math.floor(f),0):c?m4:g4}function y2({value:c,level:f,minVersion:y,includeMargin:C,marginSize:N,imageSettings:k,size:R,boostLevel:h}){let V=na.useMemo(()=>{const Ee=(Array.isArray(c)?c:[c]).reduce((ye,he)=>(ye.push(...o0.QrSegment.makeSegments(he)),ye),[]);return o0.QrCode.encodeSegments(Ee,p4[f],y,void 0,void 0,h)},[c,f,y,h]);const{cells:H,margin:$,numCells:K,calculatedImageSettings:be}=na.useMemo(()=>{let Ce=V.getModules();const Ee=_4(C,N),ye=Ce.length+Ee*2,he=x4(Ce,R,Ee,k);return{cells:Ce,margin:Ee,numCells:ye,calculatedImageSettings:he}},[V,R,k,C,N]);return{qrcode:V,margin:$,cells:H,numCells:K,calculatedImageSettings:be}}var b4=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),v4=na.forwardRef(function(f,y){const C=f,{value:N,size:k=c2,level:R=u2,bgColor:h=h2,fgColor:V=d2,includeMargin:H=f2,minVersion:$=p2,boostLevel:K,marginSize:be,imageSettings:Ce}=C,ye=Sy(C,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:he}=ye,ke=Sy(ye,["style"]),nt=Ce?.src,Qe=na.useRef(null),dt=na.useRef(null),Ut=na.useCallback(Rt=>{Qe.current=Rt,typeof y=="function"?y(Rt):y&&(y.current=Rt)},[y]),[wt,tt]=na.useState(!1),{margin:Je,cells:He,numCells:pt,calculatedImageSettings:Pe}=y2({value:N,level:R,minVersion:$,boostLevel:K,includeMargin:H,marginSize:be,imageSettings:Ce,size:k});na.useEffect(()=>{if(Qe.current!=null){const Rt=Qe.current,Ie=Rt.getContext("2d");if(!Ie)return;let Se=He;const je=dt.current,st=Pe!=null&&je!==null&&je.complete&&je.naturalHeight!==0&&je.naturalWidth!==0;st&&Pe.excavation!=null&&(Se=g2(He,Pe.excavation));const mt=window.devicePixelRatio||1;Rt.height=Rt.width=k*mt;const Xt=k/pt*mt;Ie.scale(Xt,Xt),Ie.fillStyle=h,Ie.fillRect(0,0,pt,pt),Ie.fillStyle=V,b4?Ie.fill(new Path2D(m2(Se,Je))):He.forEach(function(Oe,Xe){Oe.forEach(function(It,Nt){It&&Ie.fillRect(Nt+Je,Xe+Je,1,1)})}),Pe&&(Ie.globalAlpha=Pe.opacity),st&&Ie.drawImage(je,Pe.x+Je,Pe.y+Je,Pe.w,Pe.h)}}),na.useEffect(()=>{tt(!1)},[nt]);const ot=Ey({height:k,width:k},he);let gt=null;return nt!=null&&(gt=na.createElement("img",{src:nt,key:nt,style:{display:"none"},onLoad:()=>{tt(!0)},ref:dt,crossOrigin:Pe?.crossOrigin})),na.createElement(na.Fragment,null,na.createElement("canvas",Ey({style:ot,height:k,width:k,ref:Ut,role:"img"},ke)),gt)});v4.displayName="QRCodeCanvas";var px=na.forwardRef(function(f,y){const C=f,{value:N,size:k=c2,level:R=u2,bgColor:h=h2,fgColor:V=d2,includeMargin:H=f2,minVersion:$=p2,boostLevel:K,title:be,marginSize:Ce,imageSettings:Ee}=C,ye=Sy(C,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:he,cells:ke,numCells:nt,calculatedImageSettings:Qe}=y2({value:N,level:R,minVersion:$,boostLevel:K,includeMargin:H,marginSize:Ce,imageSettings:Ee,size:k});let dt=ke,Ut=null;Ee!=null&&Qe!=null&&(Qe.excavation!=null&&(dt=g2(ke,Qe.excavation)),Ut=na.createElement("image",{href:Ee.src,height:Qe.h,width:Qe.w,x:Qe.x+he,y:Qe.y+he,preserveAspectRatio:"none",opacity:Qe.opacity,crossOrigin:Qe.crossOrigin}));const wt=m2(dt,he);return na.createElement("svg",Ey({height:k,width:k,viewBox:`0 0 ${nt} ${nt}`,ref:y,role:"img"},ye),!!be&&na.createElement("title",null,be),na.createElement("path",{fill:h,d:`M0,0 h${nt}v${nt}H0z`,shapeRendering:"crispEdges"}),na.createElement("path",{fill:V,d:wt,shapeRendering:"crispEdges"}),Ut)});px.displayName="QRCodeSVG";const w4=({onClose:c,currentLocation:f,countryCode:y,onPickLocation:C,pickedLocation:N})=>{const{pubkey:k,pool:R,signEvent:h}=Wu(),[V,H]=De.useState("public"),[$,K]=De.useState(null),[be,Ce]=De.useState(!1),[Ee,ye]=De.useState(!0),[he,ke]=De.useState(!0),[nt,Qe]=De.useState([]),[dt,Ut]=De.useState([]),[wt,tt]=De.useState(new Map),[Je,He]=De.useState(new Map),[pt,Pe]=De.useState(null),[ot,gt]=De.useState(null),[Rt,Ie]=De.useState(!1),[Se,je]=De.useState("all"),[st,mt]=De.useState(""),[Xt,Oe]=De.useState(""),[Xe,It]=De.useState(new Map),[Nt,$t]=De.useState(null),[Bt,Mn]=De.useState("all"),[Tn,Rn]=De.useState("all"),[ri,_i]=De.useState(!1),[$n,Kn]=De.useState(10),[Qn,ti]=De.useState(null),[Bi,si]=De.useState(()=>{try{const de=localStorage.getItem("parlens-saved-listings");return de?new Set(JSON.parse(de)):new Set}catch{return new Set}}),[Yt,fn]=De.useState(!1),di=de=>{si(Me=>{const Ue=new Set(Me);return Ue.has(de)?Ue.delete(de):Ue.add(de),localStorage.setItem("parlens-saved-listings",JSON.stringify(Array.from(Ue))),Ue})},[gn,Zn]=De.useState([]);De.useEffect(()=>{try{const de=localStorage.getItem("parlens-hidden-items");if(de)Zn(JSON.parse(de));else{const Me=JSON.parse(localStorage.getItem("parlens-hidden-listings")||"[]"),Ue=JSON.parse(localStorage.getItem("parlens-blocked-pubkeys")||"[]"),xt=[...Me.map(yt=>({id:yt,name:"Unknown Listing",type:"listing"})),...Ue.map(yt=>({id:yt,name:yt.slice(0,12)+"...",type:"owner"}))];xt.length>0&&(Zn(xt),localStorage.setItem("parlens-hidden-items",JSON.stringify(xt)),localStorage.removeItem("parlens-hidden-listings"),localStorage.removeItem("parlens-blocked-pubkeys"))}}catch{}},[]);const Yi=(de,Me)=>{if(gn.some(xt=>xt.id===de))return;const Ue=[...gn,{id:de,name:Me,type:"listing"}];Zn(Ue),localStorage.setItem("parlens-hidden-items",JSON.stringify(Ue)),ti(null)};De.useEffect(()=>{if(!Qn)return;const de=()=>ti(null);return window.addEventListener("click",de),()=>window.removeEventListener("click",de)},[Qn]);const fi=(de,Me)=>{if(gn.some(xt=>xt.id===de))return;const Ue=[...gn,{id:de,name:Me,type:"owner"}];Zn(Ue),localStorage.setItem("parlens-hidden-items",JSON.stringify(Ue)),ti(null)},ci=(de,Me)=>gn.some(Ue=>Ue.id===de||Me&&Ue.id===Me),ct=De.useCallback(async de=>{if(!R)return;typeof de=="boolean"&&de||(ye(!0),ke(!0));try{const Ue=await R.querySync(Ei,{kinds:[Wn.LISTED_PARKING_METADATA],limit:100}),xt=new Map;Ue.forEach(nn=>{const Jt=nn.tags.find(Di=>Di[0]==="d")?.[1];if(!Jt||nn.content==="Deleted")return;const Bn=`${nn.pubkey}:${Jt}`;(!xt.has(Bn)||xt.get(Bn).created_at<nn.created_at)&&xt.set(Bn,nn)});const yt=Array.from(xt.values()).map(nn=>{const Jt=jt=>nn.tags.find(Gn=>Gn[0]===jt)?.[1]||"",Bn=jt=>nn.tags.filter(Gn=>Gn[0]===jt).map(Gn=>Gn[1]),Di=nn.tags.filter(jt=>jt[0]==="p"&&jt[2]==="admin").map(jt=>jt[1]),Fi=nn.tags.filter(jt=>jt[0]==="p"&&jt[2]==="write").map(jt=>jt[1]),Zt=nn.tags.filter(jt=>jt[0]==="p"&&jt[2]==="read").map(jt=>jt[1]),xi=Bn("relay"),bn=Jt("floor_plan"),Rr=bn?JSON.parse(bn):void 0;let vi;try{const jt=Jt("rates");jt&&(vi=JSON.parse(jt))}catch{}return{id:nn.id,pubkey:nn.pubkey,d:Jt("d"),listing_name:Jt("listing_name")||"Unnamed",location:Jt("location"),g:Jt("g"),floors:Jt("floors"),floor_plan:Rr,total_spots:parseInt(Jt("total_spots")||"0"),rates:vi,listing_type:Jt("listing_type")||"public",qr_type:Jt("qr_type")||"static",status:Jt("status")||"open",owners:Di,managers:Fi,members:Zt,relays:xi,local_area:Jt("local_area"),city:Jt("city"),zipcode:Jt("zipcode"),website:Jt("r")||nn.content,created_at:nn.created_at,originalEvent:nn}}).filter(nn=>nn.listing_name!=="Unnamed"&&nn.listing_name.trim()!=="").sort((nn,Jt)=>Jt.created_at-nn.created_at);Qe(yt);const qt=[],Ot=[];if(yt.forEach(nn=>{if(nn.total_spots&&nn.total_spots>0)for(let Jt=1;Jt<=nn.total_spots;Jt++)qt.push(`${nn.d}-spot-${Jt}`);else Ot.push(`${Wn.LISTED_PARKING_METADATA}:${nn.pubkey}:${nn.d}`)}),qt.length===0&&Ot.length===0){ye(!1),ke(!1);return}const cn=10;let Ke=[];for(let nn=0;nn<qt.length;nn+=cn){const Jt=qt.slice(nn,nn+cn),Bn=await R.querySync(Ei,{kinds:[Wn.PARKING_SPOT_LISTING],"#d":Jt});Ke=[...Ke,...Bn]}for(let nn=0;nn<Ot.length;nn+=cn){const Jt=Ot.slice(nn,nn+cn),Bn=await R.querySync(Ei,{kinds:[Wn.PARKING_SPOT_LISTING],"#a":Jt});Ke=[...Ke,...Bn]}const kn=new Map;Ke.forEach(nn=>{const Jt=nn.tags.find(Bn=>Bn[0]==="d")?.[1];Jt&&(!kn.has(Jt)||kn.get(Jt).created_at<nn.created_at)&&kn.set(Jt,nn)}),Ke=Array.from(kn.values()),console.log(`[Parlens] Fetched ${Ke.length} spots for ${yt.length} listings. Batched.`);const Fn=Ke.map(nn=>`${Wn.PARKING_SPOT_LISTING}:${nn.pubkey}:${nn.tags.find(Jt=>Jt[0]==="d")?.[1]}`);let wn=[];if(Fn.length>0)for(let nn=0;nn<Fn.length;nn+=cn){const Jt=Fn.slice(nn,nn+cn),Bn=await R.querySync(Ei,{kinds:[Wn.LISTED_SPOT_LOG],"#a":Jt});wn=[...wn,...Bn]}const _n=new Map,gi=new Map,Yn=new Map;wn.forEach(nn=>{const Jt=nn.tags.find(Bn=>Bn[0]==="a")?.[1];(!Yn.has(Jt)||Yn.get(Jt).created_at<nn.created_at)&&Yn.set(Jt,nn)}),yt.forEach(nn=>{const Jt=`${Wn.LISTED_PARKING_METADATA}:${nn.pubkey}:${nn.d}`;let Bn=[];if(nn.total_spots&&nn.total_spots>0){const Fi=new Set;for(let Zt=1;Zt<=nn.total_spots;Zt++)Fi.add(`${nn.d}-spot-${Zt}`);Bn=Ke.filter(Zt=>{const xi=Zt.tags.find(bn=>bn[0]==="d")?.[1];return xi&&Fi.has(xi)})}else Bn=Ke.filter(Fi=>Fi.tags.find(xi=>xi[0]==="a")?.[1]===Jt);const Di={car:{open:0,occupied:0,closed:0,total:0,rate:nn.rates?.car?.hourly||0},motorcycle:{open:0,occupied:0,closed:0,total:0,rate:nn.rates?.motorcycle?.hourly||0},bicycle:{open:0,occupied:0,closed:0,total:0,rate:nn.rates?.bicycle?.hourly||0}};Bn.forEach(Fi=>{const Zt=Fi.tags.find(jt=>jt[0]==="d")?.[1],xi=Fi.tags.find(jt=>jt[0]==="type")?.[1]||"car",bn=`${Wn.PARKING_SPOT_LISTING}:${Fi.pubkey}:${Zt}`;Zt&&gi.set(Zt,{listingId:nn.d,type:xi});const vi=Yn.get(bn)?.tags.find(jt=>jt[0]==="status")?.[1]||"open";Di[xi]&&(Di[xi].total++,vi==="occupied"?Di[xi].occupied++:vi==="closed"?Di[xi].closed++:Di[xi].open++)}),_n.set(nn.d,Di)}),It(_n),He(gi)}catch(Ue){console.error("Error fetching listings:",Ue)}finally{ye(!1),ke(!1)}},[R]),oe=De.useCallback(async de=>{if(R){Ut([]),ke(!0);try{const Me=de.total_spots||0,Ue=10,xt=[];if(Me>0)for(let yt=1;yt<=Me;yt++)xt.push(`${de.d}-spot-${yt}`);else{const yt=`${Wn.LISTED_PARKING_METADATA}:${de.pubkey}:${de.d}`,qt=await R.querySync(Ei,{kinds:[Wn.PARKING_SPOT_LISTING],"#a":[yt]});console.warn("[Parlens] No total_spots found for batching. Falling back to single fetch.");const Ot=ue(qt,de);Ut(Ot),ge(Ot),ke(!1);return}for(let yt=0;yt<xt.length;yt+=Ue){const qt=xt.slice(yt,yt+Ue),Ot=await R.querySync(Ei,{kinds:[Wn.PARKING_SPOT_LISTING],"#d":qt});if(Ot.length>0){const cn=ue(Ot,de);Ut(Ke=>{const kn=[...Ke,...cn],Fn=new Map(kn.map(wn=>[wn.d,wn]));return Array.from(Fn.values()).sort((wn,_n)=>parseInt(wn.spot_number)-parseInt(_n.spot_number))}),await ge(cn)}}console.log(`[Parlens] All batches complete for ${de.listing_name}`)}catch(Me){console.error("Error fetching spots:",Me)}finally{ke(!1)}}},[R]),ue=(de,Me)=>de.map(Ue=>{const xt=yt=>Ue.tags.find(qt=>qt[0]===yt)?.[1]||"";return{id:Ue.id,pubkey:Ue.pubkey,d:xt("d"),a:xt("a"),spot_number:xt("spot_number"),floor:xt("floor"),short_name:xt("short_name"),type:xt("type")||"car",location:xt("location"),g:xt("g"),content:Ue.content,rates:Me.rates?.[xt("type")||"car"]}}),ge=async de=>{if(!R||de.length===0)return;const Me=de.flatMap(qt=>{const Ot=`${Wn.PARKING_SPOT_LISTING}:${qt.pubkey}:${qt.d}`;return[Ot,Ot+" "]}),Ue=await R.querySync(Ei,{kinds:[Wn.LISTED_SPOT_LOG],"#a":Me}),xt=new Map;Ue.forEach(qt=>{const Ot=qt.tags.find(cn=>cn[0]==="a")?.[1];(!xt.has(Ot)||xt.get(Ot).created_at<qt.created_at)&&xt.set(Ot,qt)});const yt=new Map;xt.forEach((qt,Ot)=>{const cn=de.find(Ke=>`${Wn.PARKING_SPOT_LISTING}:${Ke.pubkey}:${Ke.d}`===Ot);if(cn){const Ke=kn=>qt.tags.find(Fn=>Fn[0]===kn)?.[1]||"";yt.set(cn.d,{id:qt.id,pubkey:qt.pubkey,a:Ke("a"),status:Ke("status")||"open",updated_by:Ke("updated_by"),authorizer:Ke("authorizer"),created_at:qt.created_at})}}),tt(qt=>{const Ot=new Map(qt);return yt.forEach((cn,Ke)=>{const kn=Ot.get(Ke);(!kn||kn.created_at<cn.created_at)&&Ot.set(Ke,cn)}),Ot})};De.useEffect(()=>{ct()},[ct]),De.useEffect(()=>{if(!R)return;console.log("[Parlens] Setting up real-time listing subscription");const de=R.subscribeMany(Ei,[{kinds:[Wn.LISTED_PARKING_METADATA],since:Math.floor(Date.now()/1e3)}],{onevent(Me){const Ue=Me.tags.find(xt=>xt[0]==="d")?.[1];!Ue||Me.content==="Parlens Relay Check"||Ue.startsWith("test-relay-check-")||(console.log("[Parlens] New listing event received:",Ue),Qe(xt=>{const yt=`${Me.pubkey}:${Ue}`,qt=xt.findIndex(Jt=>`${Jt.pubkey}:${Jt.d}`===yt),Ot=Jt=>Me.tags.find(Bn=>Bn[0]===Jt)?.[1]||"",cn=Jt=>Me.tags.filter(Bn=>Bn[0]===Jt).map(Bn=>Bn[1]),Ke=Me.tags.filter(Jt=>Jt[0]==="p"&&Jt[2]==="admin").map(Jt=>Jt[1]),kn=Me.tags.filter(Jt=>Jt[0]==="p"&&Jt[2]==="write").map(Jt=>Jt[1]),Fn=Me.tags.filter(Jt=>Jt[0]==="p"&&Jt[2]==="read").map(Jt=>Jt[1]),wn=cn("relay"),_n=Ot("floor_plan"),gi=_n?JSON.parse(_n):void 0;let Yn;try{const Jt=Ot("rates");Jt&&(Yn=JSON.parse(Jt))}catch{}const nn={id:Me.id,pubkey:Me.pubkey,d:Ot("d"),listing_name:Ot("listing_name")||"Unnamed",location:Ot("location"),g:Ot("g"),floors:Ot("floors"),floor_plan:gi,rates:Yn,listing_type:Ot("listing_type")||"public",qr_type:Ot("qr_type")||"static",status:Ot("status")||"open",owners:Ke,managers:kn,members:Fn,relays:wn,local_area:Ot("local_area"),city:Ot("city"),zipcode:Ot("zipcode"),website:Ot("r")||Me.content,created_at:Me.created_at,originalEvent:Me};if(qt>=0&&xt[qt]){if((xt[qt]?.created_at??0)<Me.created_at){const Bn=[...xt];return Bn[qt]=nn,Bn}return xt}else return[nn,...xt]}))},oneose(){console.log("[Parlens] Listing subscription active")}});return()=>{console.log("[Parlens] Closing listing subscription"),de.close()}},[R]),De.useEffect(()=>{if(!R)return;console.log("[Parlens] Subscribing to global status log updates (1147)");const de=R.subscribeMany(Ei,[{kinds:[Wn.LISTING_STATUS_LOG],since:Math.floor(Date.now()/1e3)}],{onevent(Me){const Ue=Me.tags.find(yt=>yt[0]==="a")?.[1];if(!Ue)return;const xt=Ue.split(":").pop();if(xt)try{const yt=JSON.parse(Me.content);console.log("[Parlens] Received real-time status log for:",xt),It(qt=>{const Ot=new Map(qt);return Ot.set(xt,yt),Ot})}catch(yt){console.warn("Error parsing incoming status log:",yt)}},oneose(){console.log("[Parlens] Status log subscription active")}});return()=>{console.log("[Parlens] Closing status log subscription"),de.close()}},[R]),De.useEffect(()=>{if(!R)return;let de=[];if(dt.length>0)de=dt.map(yt=>`${Wn.PARKING_SPOT_LISTING}:${yt.pubkey}:${yt.d}`);else return;if(de.length===0)return;console.log("[Parlens] Subscribing to status updates for",de.length,"spots");const Me=new Map,Ue=R.subscribeMany(Ei,[{kinds:[Wn.LISTED_SPOT_LOG],"#a":de}],{onevent(yt){const qt=yt.tags.find(Ke=>Ke[0]==="a")?.[1],Ot=yt.tags.find(Ke=>Ke[0]==="status")?.[1];if(!qt||!Ot)return;const cn=Me.get(qt);cn&&cn.created_at>=yt.created_at||(Me.set(qt,{status:Ot,created_at:yt.created_at}),tt(Ke=>{const kn=qt.split(":").pop();if(!kn)return Ke;const Fn=new Map(Ke),wn=Fn.get(kn);if((!wn||wn.created_at<yt.created_at)&&(Fn.set(kn,{id:yt.id,pubkey:yt.pubkey,a:qt,status:Ot,updated_by:yt.tags.find(_n=>_n[0]==="updated_by")?.[1]||"",authorizer:yt.tags.find(_n=>_n[0]==="authorizer")?.[1]||"",created_at:yt.created_at}),kn)){const _n=Je.get(kn);_n&&It(gi=>{const Yn=gi.get(_n.listingId);if(!Yn)return gi;const nn=new Map(gi),Jt={...Yn[_n.type]},Bn=wn?.status||"open",Di=Ot;return Bn==="occupied"?Jt.occupied=Math.max(0,Jt.occupied-1):Bn==="closed"?Jt.closed=Math.max(0,Jt.closed-1):Jt.open=Math.max(0,Jt.open-1),Di==="occupied"?Jt.occupied++:Di==="closed"?Jt.closed++:Jt.open++,nn.set(_n.listingId,{...Yn,[_n.type]:Jt}),nn})}return Fn}))},oneose(){console.log("[Parlens] Real-time subscription active, status data received"),ke(!1)}}),xt=setTimeout(()=>{ke(!1)},3e3);return()=>{console.log("[Parlens] Closing real-time status subscription"),clearTimeout(xt),Ue.close()}},[R,dt,Je]),De.useEffect(()=>{$&&oe($)},[$,oe]),De.useEffect(()=>{if(!$||dt.length===0)return;const de={car:{open:0,occupied:0,closed:0,total:0,rate:$.rates?.car?.hourly||0},motorcycle:{open:0,occupied:0,closed:0,total:0,rate:$.rates?.motorcycle?.hourly||0},bicycle:{open:0,occupied:0,closed:0,total:0,rate:$.rates?.bicycle?.hourly||0}};for(const Me of dt){const Ue=Me.type||"car",xt=wt.get(Me.d)?.status||"open";de[Ue]&&(de[Ue].total++,xt==="occupied"?de[Ue].occupied++:xt==="closed"?de[Ue].closed++:de[Ue].open++)}It(Me=>{const Ue=new Map(Me);return Ue.set($.d,de),Ue})},[wt,$,dt]);const qe=async de=>{if(!(!R||!k||!h)&&confirm(`Delete "${de.listing_name}" ? This will delete all spots.`)){Ie(!0);try{const Me=`${Wn.LISTED_PARKING_METADATA}:${de.pubkey}:${de.d}`,Ue=await R.querySync(Ei,{kinds:[Wn.PARKING_SPOT_LISTING],"#a":[Me]});for(const yt of Ue){const qt=yt.tags.find(Ot=>Ot[0]==="d")?.[1];if(qt){const Ot={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",yt.id],["a",`${Wn.PARKING_SPOT_LISTING}:${k}:${qt}`]],content:"Deleted"};await Promise.allSettled(R.publish(Ei,await h(Ot)))}}const xt={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",de.id],["a",`${Wn.LISTED_PARKING_METADATA}:${k}:${de.d}`]],content:"Deleted"};await Promise.allSettled(R.publish(Ei,await h(xt))),Qe(yt=>yt.filter(qt=>qt.id!==de.id)),K(null)}catch(Me){console.error(Me)}finally{Ie(!1)}}},$e=De.useMemo(()=>{let de=nt.filter(Me=>{if(Yt&&!Bi.has(Me.id))return!1;let Ue=!1;if(V==="public"?Ue=Me.listing_type==="public":V==="private"?Ue=Me.listing_type==="private"&&(Me.members.includes(k)||Me.owners.includes(k)||Me.managers.includes(k)):V==="my"&&(Ue=Me.owners.includes(k)||Me.managers.includes(k)),!Ue||V!=="my"&&ci(Me.id,Me.pubkey))return!1;if(Xt){const xt=Xt.toLowerCase();if(!(Me.listing_name.toLowerCase().includes(xt)||Me.local_area?.toLowerCase().includes(xt)||Me.city?.toLowerCase().includes(xt)||Me.zipcode?.toLowerCase().includes(xt)))return!1}return!0});return de.sort((Me,Ue)=>{if(Xt){const Ke=Xt.toLowerCase(),kn=Me.listing_name.toLowerCase()===Ke,Fn=Ue.listing_name.toLowerCase()===Ke;if(kn&&!Fn)return-1;if(!kn&&Fn)return 1}if(f&&Me.location&&Ue.location){const[Ke,kn]=Me.location.split(",").map(_n=>parseFloat(_n.trim())),[Fn,wn]=Ue.location.split(",").map(_n=>parseFloat(_n.trim()));if(!isNaN(Ke)&&!isNaN(kn)&&!isNaN(Fn)&&!isNaN(wn)){const _n=T_(f[0],f[1],Ke,kn),gi=T_(f[0],f[1],Fn,wn);if(Math.abs(_n-gi)>.1)return _n-gi}}const xt=Xe.get(Me.d),yt=Xe.get(Ue.d),qt=Ke=>Ke?Se==="all"?Ke.car.open+Ke.motorcycle.open+Ke.bicycle.open:Ke[Se]?.open||0:0,Ot=qt(xt),cn=qt(yt);return Ot!==cn?cn-Ot:Me.listing_name.localeCompare(Ue.listing_name)}),de},[nt,V,k,st,Xe,Se,f,Bi,Yt]),bt=De.useMemo(()=>$e.slice(0,$n),[$e,$n]),at=De.useMemo(()=>{const de=new Set;return dt.forEach(Me=>{Me.floor&&de.add(Me.floor)}),Array.from(de).sort()},[dt]),fe=De.useMemo(()=>dt.filter(de=>!(Se!=="all"&&de.type!==Se||Bt!=="all"&&de.floor!==Bt||Tn!=="all"&&(wt.get(de.d)?.status||"open")!==Tn)),[dt,Se,Bt,Tn,wt]);return O.jsxs("div",{className:"fixed inset-0 z-[3000] bg-zinc-50 dark:bg-black flex flex-col transition-colors",children:[ri&&O.jsxs("div",{className:"fixed inset-0 z-[6000] flex items-center justify-center bg-black/60 backdrop-blur-sm flex-col animate-in fade-in duration-200",children:[O.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-white/20 border-t-white rounded-full"}),O.jsx("div",{className:"text-white font-bold mt-4 animate-pulse",children:"Updating Status..."})]}),Rt&&O.jsxs("div",{className:"fixed inset-0 z-[3100] flex items-center justify-center bg-black/50 backdrop-blur-sm flex-col",children:[O.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-white/20 border-t-white rounded-full"}),O.jsx("div",{className:"text-white font-bold mt-4",children:"Deleting..."})]}),O.jsx("div",{className:"bg-white dark:bg-[#1c1c1e] border-b border-black/5 dark:border-white/10",children:O.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("button",{onClick:$?()=>K(null):c,className:"p-2 rounded-full bg-black/5 dark:bg-white/10 active:scale-95 transition-transform",style:{WebkitTapHighlightColor:"transparent"},children:O.jsx(Yf,{size:20,className:"text-black/60 dark:text-white/60 rotate-180"})}),O.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 bg-clip-text text-transparent",children:$?$.listing_name:"Listed Parking"})]}),O.jsxs("div",{className:"flex items-center gap-2",children:[!$&&O.jsx("button",{onClick:()=>Ce(!0),className:"p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full shadow-lg shadow-blue-500/20 active:scale-95 transition-transform",style:{WebkitTapHighlightColor:"transparent"},children:O.jsx($g,{size:20})}),O.jsx("button",{onClick:async()=>{he||(console.log("[Parlens] Refreshing data and connections..."),ke(!0),setTimeout(async()=>{const de=[ct(!0)];$&&de.push(oe($)),await Promise.all(de)},50))},className:`p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full shadow-lg shadow-blue-500/20 active:scale-95 transition-transform ${he?"opacity-70 cursor-not-allowed":""}`,style:{WebkitTapHighlightColor:"transparent"},title:"Refresh",children:O.jsx(qA,{size:20,className:he?"animate-spin":""})})]})]})}),O.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:$?O.jsxs("div",{className:"flex-1 flex flex-col p-4 bg-zinc-50 dark:bg-black/50 min-h-0",children:[O.jsxs("div",{className:"flex gap-2 mb-4 shrink-0",children:[O.jsxs("select",{value:Se,onChange:de=>je(de.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[O.jsx("option",{value:"all",children:"All Types"}),O.jsx("option",{value:"car",children:" Car"}),O.jsx("option",{value:"motorcycle",children:" Motorcycle"}),O.jsx("option",{value:"bicycle",children:" Bicycle"})]}),O.jsxs("select",{value:Bt,onChange:de=>Mn(de.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[O.jsx("option",{value:"all",children:"All Floors"}),at.map(de=>O.jsx("option",{value:de,children:de},de))]}),O.jsxs("select",{value:Tn,onChange:de=>Rn(de.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[O.jsx("option",{value:"all",children:"All Status"}),O.jsx("option",{value:"open",children:" Open"}),O.jsx("option",{value:"occupied",children:" Occupied"}),O.jsx("option",{value:"closed",children:" Closed"})]})]}),O.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:O.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:[fe.map(de=>{const Me=wt.get(de.d),Ue=Me?.status==="occupied"?"bg-red-500/10 border-red-500/20 text-red-600 dark:text-red-400":Me?.status==="closed"?"bg-zinc-500/10 border-zinc-500/20 text-zinc-600 dark:text-zinc-400":"bg-green-500/10 border-green-500/20 text-green-600 dark:text-green-400";return O.jsxs("button",{onClick:()=>Pe(de),className:`p-3 rounded-2xl border ${Ue} text-center active:scale-[0.98] transition-transform relative`,children:[O.jsx("div",{className:"text-3xl mb-1",children:de.type==="car"?"":de.type==="motorcycle"?"":""}),O.jsx("p",{className:"font-bold text-sm text-zinc-900 dark:text-white",children:de.short_name||`#${de.spot_number}`}),de.floor&&O.jsx("p",{className:"text-xs opacity-60",children:de.floor}),O.jsx("p",{className:"mt-1 text-[10px] font-bold uppercase tracking-wider opacity-80",children:Me?.status||"Open"})]},de.id)}),he&&O.jsx("div",{className:"flex items-center justify-center p-6 bg-zinc-50 dark:bg-white/5 rounded-2xl border-2 border-dashed border-zinc-200 dark:border-white/10 min-h-[100px]",children:O.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500/20 border-t-blue-500 rounded-full"})})]})})]}):O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"flex border-b border-black/5 dark:border-white/10 bg-white dark:bg-[#1c1c1e]",children:["public","private","my"].map(de=>O.jsx("button",{onClick:()=>H(de),className:`flex-1 py-3 text-sm font-bold transition-colors ${V===de?"text-[#007AFF] border-b-2 border-[#007AFF]":"text-zinc-400"}`,children:de==="public"?"Public Listings":de==="private"?"Private Listings":"My Listings"},de))}),O.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-white dark:bg-[#1c1c1e] border-b border-black/5 dark:border-white/10",children:[O.jsx("div",{className:"relative flex-1",children:O.jsx("input",{value:st,onChange:de=>mt(de.target.value),onKeyDown:de=>{de.key==="Enter"&&Oe(st)},placeholder:"Search listing name or location",className:"w-full px-4 py-2.5 bg-zinc-100 dark:bg-white/10 rounded-xl text-sm font-medium text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all placeholder:text-zinc-400 dark:placeholder:text-white/40"})}),O.jsx("button",{onClick:()=>{ye(!0),setTimeout(()=>{Oe(st),ye(!1)},500)},className:"p-2.5 bg-zinc-100 dark:bg-white/10 rounded-xl border border-black/5 dark:border-white/10 text-zinc-400 active:scale-95 transition-transform",style:{WebkitTapHighlightColor:"transparent"},title:"Search",children:O.jsx(Zv,{size:22})})]}),O.jsxs("div",{className:"flex items-center justify-between text-[10px] font-bold uppercase tracking-wider text-zinc-500 px-4 py-2 overflow-x-auto",children:[O.jsxs("div",{className:"flex items-center gap-4",children:[O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"Open"]}),O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),"Occupied"]}),O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("div",{className:"w-2 h-2 rounded-full bg-zinc-400"}),"Closed"]})]}),O.jsxs("button",{onClick:()=>fn(!Yt),className:`flex items-center gap-1 px-2 py-1 rounded-full border transition-colors ${Yt?"bg-yellow-500/10 border-yellow-500/20 text-yellow-600 dark:text-yellow-400":"bg-transparent border-transparent hover:bg-black/5 dark:hover:bg-white/5"}`,children:[O.jsx(u_,{size:12,className:Yt?"fill-yellow-500 stroke-yellow-500":""}),Yt?"Saved":"All"]})]}),O.jsx("div",{className:"flex-1 overflow-y-auto pt-2 px-4 pb-4 space-y-3",children:Ee?O.jsx("div",{className:"flex justify-center p-8",children:O.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"})}):$e.length===0?O.jsx("div",{className:"text-center py-10 text-zinc-400",children:"No listings found"}):O.jsxs(O.Fragment,{children:[bt.map(de=>{const Me=Xe.get(de.d);let Ue=de.status==="closed";if(Me){const yt=(Me.car?.open||0)+(Me.motorcycle?.open||0)+(Me.bicycle?.open||0),qt=(Me.car?.occupied||0)+(Me.motorcycle?.occupied||0)+(Me.bicycle?.occupied||0);(Me.car?.total||0)+(Me.motorcycle?.total||0)+(Me.bicycle?.total||0)>0&&(Ue=yt+qt===0)}const xt=Me;return O.jsxs("div",{className:`group relative bg-white dark:bg-[#1c1c1e] rounded-2xl p-2.5 border border-black/5 dark:border-white/10 shadow-sm transition-all hover:shadow-md active:scale-[0.99] cursor-pointer ${Qn===de.id?"z-50":""}`,onClick:()=>K(de),children:[O.jsxs("div",{className:"flex flex-col items-start gap-1 mb-2",children:[O.jsxs("div",{className:"flex items-center justify-between w-full gap-1.5",children:[O.jsx("div",{className:"min-w-0 flex items-center h-full",children:O.jsx("h3",{className:"font-bold text-zinc-900 dark:text-white text-sm leading-tight truncate",children:de.listing_name})}),O.jsxs("div",{className:"flex items-center gap-1 h-full",children:[O.jsx("button",{onClick:yt=>{yt.stopPropagation(),di(de.id)},className:"p-2 rounded-full active:scale-95 transition-transform flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent"},children:O.jsx(u_,{size:14,className:`dark:text-white/60 ${Bi.has(de.id)?"fill-yellow-500 stroke-yellow-500 text-yellow-500 dark:text-yellow-500":"text-black/60"}`})}),O.jsx("button",{onClick:yt=>{yt.stopPropagation(),$t(de)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:O.jsx(oC,{size:14})}),V==="my"&&(de.owners.includes(k)||de.managers.includes(k))?O.jsxs(O.Fragment,{children:[O.jsx("button",{onClick:yt=>{yt.stopPropagation(),gt(de),Ce(!0)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:O.jsx($f,{size:14})}),O.jsx("button",{onClick:yt=>{yt.stopPropagation(),qe(de)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:O.jsx(Kf,{size:14})})]}):O.jsxs("div",{className:"relative flex items-center",children:[O.jsx("button",{onClick:yt=>{yt.stopPropagation(),ti(Qn===de.id?null:de.id)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:O.jsx(SA,{size:14})}),Qn===de.id&&O.jsxs(O.Fragment,{children:[O.jsx("style",{children:`
                                                                            @keyframes menuFadeIn {
                                                                                from { opacity: 0; transform: scale(0.95); }
                                                                                to { opacity: 1; transform: scale(1); }
                                                                            }
                                                                        `}),O.jsxs("div",{className:"absolute right-0 top-8 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl shadow-xl z-50 overflow-hidden min-w-[200px]",style:{animation:"menuFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards",transformOrigin:"top right"},onClick:yt=>yt.stopPropagation(),children:[de.website&&O.jsxs("a",{href:de.website.startsWith("http")?de.website:`https://${de.website}`,target:"_blank",rel:"noopener noreferrer",onClick:yt=>{yt.stopPropagation(),ti(null)},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 border-b border-black/5 dark:border-white/10",children:[O.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:""})," Visit Website"]}),O.jsxs("button",{onClick:yt=>{yt.stopPropagation(),Yi(de.id,de.listing_name)},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2",children:[O.jsx(dx,{size:16})," Hide this listing"]}),de.pubkey&&O.jsxs("button",{onClick:yt=>{yt.stopPropagation(),fi(de.pubkey,de.listing_name+" (owner)")},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 border-t border-black/5 dark:border-white/10",children:[O.jsx(gA,{size:16})," Hide all from owner"]})]})]})]})]})]}),O.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[O.jsx("span",{className:`shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider ${de.listing_type==="public"?"bg-green-500/10 text-green-600":"bg-purple-500/10 text-purple-600"}`,children:de.listing_type}),Ue&&O.jsx("span",{className:"shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider bg-zinc-500/10 text-zinc-500 dark:text-zinc-400",children:"CLOSED"}),(de.local_area||de.city)&&O.jsx("span",{className:"shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider bg-blue-500/10 text-blue-500",children:de.local_area||de.city})]})]}),O.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{type:"car",icon:"",data:xt?.car,rate:de.rates?.car},{type:"motorcycle",icon:"",data:xt?.motorcycle,rate:de.rates?.motorcycle},{type:"bicycle",icon:"",data:xt?.bicycle,rate:de.rates?.bicycle}].map(yt=>{const qt=(yt.data?.total||0)>0,Ot=yt.rate||{hourly:0,currency:"INR"},cn=!!yt.rate||qt&&de.listing_type==="public";return O.jsxs("div",{className:`bg-zinc-50 dark:bg-white/10 rounded-xl p-2 text-center flex flex-col items-center justify-center min-h-[80px] ${Ue?"opacity-50":""}`,children:[O.jsx("div",{className:"text-3xl mb-1",children:yt.icon}),he?O.jsx("div",{className:"text-xl font-bold text-zinc-300 dark:text-white/20",children:"..."}):qt?O.jsxs("div",{className:"flex flex-col items-center w-full",children:[O.jsxs("div",{className:"font-bold text-sm flex items-center gap-1.5 mb-1.5",children:[O.jsx("span",{className:"text-green-500",children:yt.data?.open||0}),O.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),O.jsx("span",{className:"text-red-500",children:yt.data?.occupied||0}),O.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),O.jsx("span",{className:"text-zinc-400",children:yt.data?.closed||0})]}),cn&&O.jsx("div",{className:"w-full bg-black/5 dark:bg-white/5 rounded-lg py-0.5 px-2",children:O.jsxs("div",{className:"text-zinc-900 dark:text-white font-bold text-sm",children:[Ot.currency==="USD"?"$":Ot.currency==="EUR"?"":Ot.currency==="GBP"?"":"",Ot.hourly,O.jsx("span",{className:"text-[10px] font-normal opacity-60",children:"/hr"})]})})]}):O.jsx("div",{className:"text-xs text-zinc-400 dark:text-white/30 font-medium",children:"Not Available"})]},yt.type)})}),V==="my"&&(de.owners.includes(k)||de.managers.includes(k))&&O.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5 dark:border-white/5 flex items-center justify-between relative",onClick:yt=>yt.stopPropagation(),children:[O.jsx("span",{className:`text-sm font-semibold ${Ue?"text-zinc-500 dark:text-white/50":"text-green-600 dark:text-green-400"}`,children:Ue?"Listing Closed":"Listing Open"}),O.jsx("button",{onClick:async()=>{const yt=Ue?"open":"closed";if(confirm(yt==="closed"?"This will mark ALL spots as CLOSED. Continue?":"This will mark ALL spots as OPEN. Continue?")){_i(!0);try{const Ot=`${Wn.LISTED_PARKING_METADATA}:${de.pubkey}:${de.d}`,cn=await R.querySync(Ei,{kinds:[Wn.PARKING_SPOT_LISTING],"#a":[Ot]}),Ke={car:{open:0,occupied:0,total:0,closed:0,rate:0},motorcycle:{open:0,occupied:0,total:0,closed:0,rate:0},bicycle:{open:0,occupied:0,total:0,closed:0,rate:0}},kn=Xe.get(de.d),Fn=cn.map(async Jt=>{const Bn=Jt.tags.find(vi=>vi[0]==="d")?.[1];let Di=Jt.tags.find(vi=>vi[0]==="type")?.[1]?.toLowerCase()||"car";["car","motorcycle","bicycle"].includes(Di)||(Di="car");const Fi=`${Wn.PARKING_SPOT_LISTING}:${Jt.pubkey}:${Bn}`;Ke[Di]&&(Ke[Di].total++,yt==="closed"?Ke[Di].closed++:Ke[Di].open++,kn&&kn[Di]&&(Ke[Di].rate=kn[Di].rate));const Zt=de.rates?.[Di]?.hourly||kn?.[Di]?.rate||0,xi=de.rates?.[Di]?.currency||"USD",bn={kind:Wn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["a",Fi],["status",yt],["updated_by",k],["g",de.g],["location",de.location],["type",Di],["hourly_rate",String(Zt)],["currency",xi],["client","parlens"]],content:JSON.stringify({hourly_rate:Zt,currency:xi})},Rr=await h(bn);return R.publish(Ei,Rr)});await Promise.allSettled(Fn);const wn=`${Wn.LISTED_PARKING_METADATA}:${de.pubkey}:${de.d}`,_n={kind:Wn.LISTING_STATUS_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["a",wn],["g",de.g],["client","parlens"]],content:JSON.stringify(Ke)};await Promise.allSettled(R.publish(Ei,await h(_n)));const gi=de.originalEvent.tags.filter(Jt=>Jt[0]!=="status");gi.push(["status",yt]);const Yn={...de.originalEvent,created_at:Math.floor(Date.now()/1e3),tags:gi},nn=await h(Yn);await Promise.allSettled(R.publish(Ei,nn)),await new Promise(Jt=>setTimeout(Jt,1500)),await ct(!0)}catch(Ot){console.error("Failed to update status:",Ot),alert("Failed to update status")}finally{_i(!1)}}},className:`relative h-7 w-12 rounded-full transition-colors ${Ue?"bg-zinc-200 dark:bg-white/10":"bg-green-500"}`,children:O.jsx("span",{className:`block h-5 w-5 rounded-full bg-white shadow-sm transition-transform ${Ue?"translate-x-[4px]":"translate-x-[26px]"}`})})]})]},de.id)}),$n<$e.length&&O.jsxs("button",{onClick:()=>Kn(de=>de+10),className:"w-full py-4 bg-blue-500/10 text-[#007AFF] font-bold rounded-2xl border border-blue-500/20 active:scale-[0.98] transition-transform",children:["Load More (",$e.length-$n," remaining)"]})]})})]})}),be&&O.jsx(E4,{editing:ot,currentLocation:f,countryCode:y,onPickLocation:C,pickedLocation:N,onClose:()=>{Ce(!1),gt(null)},onCreated:()=>{Ce(!1),gt(null),ct()}}),pt&&$&&O.jsx(S4,{spot:pt,listing:nt.find(de=>de.d===pt.a.split(":")[2]),status:wt.get(pt.d),isManager:nt.find(de=>de.d===pt.a.split(":")[2]).owners.includes(k||"")||nt.find(de=>de.d===pt.a.split(":")[2]).managers.includes(k||""),listingStats:Xe,setListingStats:It,setSpotStatuses:tt,onSpotUpdate:()=>ct(!0),onClose:()=>Pe(null)}),Nt&&O.jsx(T4,{listing:Nt,onClose:()=>$t(null)})]})},E4=({editing:c,onClose:f,onCreated:y,currentLocation:C,countryCode:N,onPickLocation:k,pickedLocation:R})=>{const{pubkey:h,signEvent:V,pool:H}=Wu(),[$,K]=De.useState(1),[be,Ce]=De.useState(!1),[Ee,ye]=De.useState(!1),he=De.useMemo(()=>c?.floor_plan?c.floor_plan:[],[c]),[ke,nt]=De.useState({listing_name:c?.listing_name||"",website:c?.website||"",location:c?.location||"",local_area:c?.local_area||"",city:c?.city||"",zipcode:c?.zipcode||"",country:c?.country||"",listing_type:c?.listing_type||"public",qr_type:c?.qr_type||"static",owners:c?.owners?.join(", ")||"",managers:c?.managers?.join(", ")||"",members:c?.members?.join(", ")||"",relays:c?.relays?.join(", ")||"",currency:"USD"}),[Qe,dt]=De.useState(he),[Ut,wt]=De.useState({name:"",counts:{car:0,motorcycle:0,bicycle:0},rates:{car:0,motorcycle:0,bicycle:0}});De.useEffect(()=>{if(!c&&N){const Pe={US:"USD",GB:"GBP",EU:"EUR",IN:"INR"};nt(ot=>({...ot,currency:Pe[N]||"USD"}))}else c?.rates?.car?.currency&&nt(Pe=>({...Pe,currency:c.rates.car.currency}))},[N,c]),De.useEffect(()=>{R&&(nt(Pe=>({...Pe,location:`${R.lat.toFixed(6)}, ${R.lon.toFixed(6)} `})),e2(R.lat,R.lon).then(Pe=>{Pe&&Pe!==ke.currency&&nt(ot=>({...ot,currency:Pe}))}))},[R]),De.useEffect(()=>{const Pe=document.getElementById("create-listing-content");Pe&&Pe.scrollTo({top:0,behavior:"smooth"})},[$]);const tt=Pe=>{if(!Pe)return null;const ot=Pe.split(",").map(gt=>gt.trim()).filter(Boolean);return ot.length===0?null:O.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ot.map((gt,Rt)=>O.jsx("span",{className:"px-2 py-1 bg-zinc-200 dark:bg-white/10 rounded-lg text-[10px] font-mono text-zinc-600 dark:text-zinc-400 flex items-center gap-1 max-w-full",children:O.jsx("span",{className:"truncate max-w-[150px]",children:gt})},Rt))})},Je=()=>{Ut.name&&(dt([...Qe,{...Ut,id:crypto.randomUUID()}]),wt(Pe=>({...Pe,name:"",counts:{car:0,motorcycle:0,bicycle:0}})))},He=Pe=>{dt(Qe.filter((ot,gt)=>gt!==Pe))},pt=async()=>{if(!ke.listing_name)return;let Pe=[...Qe];if(Ut.name&&(Ut.counts.car>0||Ut.counts.motorcycle>0||Ut.counts.bicycle>0)&&Ee&&(console.log("[Parlens] Auto-adding pending floor from open form:",Ut.name),Pe.push({...Ut,id:crypto.randomUUID()})),Pe.length===0){alert("Please add at least one floor with parking spots.");return}let ot="";if(ke.location){const[st,mt]=ke.location.split(",").map(Xt=>parseFloat(Xt.trim()));!isNaN(st)&&!isNaN(mt)&&(ot=Im(st,mt,10))}const gt=(c?.d||crypto.randomUUID()).trim();console.log("[Parlens] Submitting Listing ID:",gt);const Rt=st=>st.split(",").map(mt=>mt.trim()).filter(Boolean).map(mt=>{if(mt.startsWith("npub"))try{const{data:Xt}=u4(mt);return Xt}catch{return console.error("Invalid npub:",mt),mt}return mt});let Ie=0;const Se={};Pe.forEach(st=>{Ie+=(st.counts.car||0)+(st.counts.motorcycle||0)+(st.counts.bicycle||0),!Se.car&&st.rates.car&&(Se.car={hourly:st.rates.car,currency:ke.currency}),!Se.motorcycle&&st.rates.motorcycle&&(Se.motorcycle={hourly:st.rates.motorcycle,currency:ke.currency}),!Se.bicycle&&st.rates.bicycle&&(Se.bicycle={hourly:st.rates.bicycle,currency:ke.currency})});const je={kind:Wn.LISTED_PARKING_METADATA,created_at:Math.floor(Date.now()/1e3),tags:[["d",gt],["listing_name",ke.listing_name.slice(0,25)],["location",ke.location],["g",ot],["local_area",ke.local_area||""],["city",ke.city||""],["zipcode",ke.zipcode||""],["country",ke.country||""],["floors",Pe.map(st=>st.name).join(", ")],["floor_plan",JSON.stringify(Pe)],["total_spots",String(Ie+(c&&!c.floor_plan&&c.total_spots||0))],["rates",JSON.stringify(Se)],["listing_type",ke.listing_type],["qr_type",ke.qr_type],["client","parlens"],...ke.website?[["r",ke.website]]:[],...Rt(ke.owners).map(st=>["p",st,"admin"]),...Rt(ke.managers).map(st=>["p",st,"write"]),...Rt(ke.members).map(st=>["p",st,"read"]),...Rt(ke.relays).map(st=>["relay",st])],content:""};je.tags.find(st=>st[0]==="p"&&st[1]===h&&st[2]==="admin")||je.tags.push(["p",h,"admin"]),Ce(!0);try{if(await Promise.allSettled(H.publish(Ei,await V(je))),!c){console.log("[Parlens] Creating spots for floors:",Pe.length);let st=1;for(const mt of Pe)for(const[Xt,Oe]of Object.entries(mt.counts)){console.log(`[Parlens] Floor ${mt.name} Type ${Xt} Count ${Oe}`);for(let Xe=0;Xe<Oe;Xe++){const It=`${gt}-spot-${st}`,Nt=`${Wn.LISTED_PARKING_METADATA}:${h}:${gt}`,$t={kind:Wn.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:[["d",It],["a",Nt],["spot_number",String(st)],["floor",mt.name],["type",Xt],["location",ke.location],["g",ot],["client","parlens"]],content:`${ke.listing_name} #${st}`};await Promise.allSettled(H.publish(Ei,await V($t))),st++}}}y()}catch(st){console.error("Failed to save listing:",st),alert("Failed to save listing. Please try again.")}finally{Ce(!1)}};return O.jsx("div",{className:"fixed inset-0 z-[4000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:O.jsxs("div",{id:"create-listing-content",className:"w-full max-w-lg bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 shadow-2xl overflow-y-auto max-h-[90vh]",children:[be&&O.jsxs("div",{className:"absolute inset-0 z-50 bg-white/50 dark:bg-black/50 backdrop-blur-[2px] flex flex-col items-center justify-center rounded-3xl",children:[O.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),O.jsx("div",{className:"text-zinc-900 dark:text-white font-bold animate-pulse",children:"Saving Listing..."})]}),O.jsxs("div",{className:"flex justify-between items-center mb-6",children:[O.jsx("h2",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:c?"Edit Listing":"Create Listing"}),O.jsx("button",{onClick:f,children:O.jsx(Il,{className:"text-zinc-500 dark:text-white"})})]}),$===1?O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Listing Name (25 chars max)"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",value:ke.listing_name,maxLength:25,onChange:Pe=>nt({...ke,listing_name:Pe.target.value})})]}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Business Website"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"https://example.com",value:ke.website,onChange:Pe=>nt({...ke,website:Pe.target.value})})]}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Location"}),O.jsxs("div",{className:"flex gap-2",children:[O.jsx("input",{className:"flex-1 min-w-0 p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"lat, lon",value:ke.location,onChange:Pe=>nt({...ke,location:Pe.target.value})}),O.jsx("button",{onClick:C?()=>nt({...ke,location:`${C[0].toFixed(6)}, ${C[1].toFixed(6)}`}):void 0,className:"shrink-0 p-3 bg-blue-500/10 text-blue-500 rounded-xl",children:O.jsx(NA,{size:20})}),k&&O.jsx("button",{onClick:k,className:"shrink-0 p-3 bg-orange-500/10 text-orange-600 dark:text-orange-400 border border-orange-500/20 rounded-xl",children:O.jsx(Oh,{size:20})})]})]}),O.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Local Area"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. Indiranagar",value:ke.local_area,onChange:Pe=>nt({...ke,local_area:Pe.target.value})})]}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"City"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. Bangalore",value:ke.city,onChange:Pe=>nt({...ke,city:Pe.target.value})})]})]}),O.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Zipcode"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. 560038",value:ke.zipcode,onChange:Pe=>nt({...ke,zipcode:Pe.target.value})})]}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Country"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. India",value:ke.country,onChange:Pe=>nt({...ke,country:Pe.target.value})})]})]}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Access Type"}),O.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[O.jsx("button",{onClick:()=>nt({...ke,listing_type:"public"}),className:`p-3 rounded-xl font-bold transition-colors ${ke.listing_type==="public"?"bg-green-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white"}`,children:"Public"}),O.jsx("button",{onClick:()=>nt({...ke,listing_type:"private"}),className:`p-3 rounded-xl font-bold transition-colors ${ke.listing_type==="private"?"bg-purple-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white"}`,children:"Private"})]})]}),O.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl space-y-2",children:[O.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400",children:"QR Code Type"}),O.jsxs("div",{className:"flex gap-4",children:[O.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[O.jsx("input",{type:"radio",checked:ke.qr_type==="static",onChange:()=>nt({...ke,qr_type:"static"})})," Static (Standard)"]}),O.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[O.jsx("input",{type:"radio",checked:ke.qr_type==="dynamic",onChange:()=>nt({...ke,qr_type:"dynamic"})})," Dynamic (Rotating)"]})]})]}),ke.listing_type==="private"&&O.jsxs(O.Fragment,{children:[O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Members"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys (comma separated)",value:ke.members,onChange:Pe=>nt({...ke,members:Pe.target.value})}),tt(ke.members)]}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Relays"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"URLs (comma separated)",value:ke.relays,onChange:Pe=>nt({...ke,relays:Pe.target.value})})]})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Owners"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Additional Pubkeys",value:ke.owners,onChange:Pe=>nt({...ke,owners:Pe.target.value})}),tt(ke.owners)]}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Managers"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys",value:ke.managers,onChange:Pe=>nt({...ke,managers:Pe.target.value})}),tt(ke.managers)]})]}),O.jsxs("button",{onClick:()=>K(2),className:"w-full py-3 bg-[#007AFF] text-white rounded-xl font-bold flex items-center justify-center gap-2",children:["Next ",O.jsx(Yf,{size:16})]})]}):O.jsxs("div",{className:"space-y-6",children:[O.jsxs("div",{className:"flex justify-between items-center",children:[O.jsx("h3",{className:"font-bold dark:text-white",children:"Floors & Spots"}),O.jsxs("select",{className:"pl-3 pr-8 py-2 bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 rounded-xl text-zinc-900 dark:text-white text-sm font-medium appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.75rem_center]",value:ke.currency,onChange:Pe=>nt({...ke,currency:Pe.target.value}),children:[O.jsx("option",{value:"USD",children:"USD ($)"}),O.jsx("option",{value:"EUR",children:"EUR ()"}),O.jsx("option",{value:"GBP",children:"GBP ()"}),O.jsx("option",{value:"INR",children:"INR ()"})]})]}),O.jsx("div",{className:"space-y-3",children:Qe.map((Pe,ot)=>O.jsxs("div",{className:"p-3 bg-zinc-50 dark:bg-white/5 rounded-xl flex justify-between items-center group touch-none",children:[O.jsxs("div",{className:"flex-1 min-w-0 mr-2",onClick:()=>{if(Ee){alert("Please save or cancel current floor edit first");return}He(ot),wt(Pe),ye(!0)},children:[O.jsx("div",{className:"font-bold dark:text-white truncate",children:Pe.name}),O.jsxs("div",{className:"text-xs text-zinc-500 truncate",children:[Pe.counts.car>0&&` ${Pe.counts.car} `,Pe.counts.motorcycle>0&&` ${Pe.counts.motorcycle} `,Pe.counts.bicycle>0&&` ${Pe.counts.bicycle} `]})]}),O.jsxs("div",{className:"flex items-center gap-1",children:[O.jsx("button",{onClick:()=>{if(Ee){alert("Finish current floor first");return}He(ot),wt(Pe),ye(!0)},className:"p-2 text-zinc-400 hover:text-blue-500 transition-colors",children:O.jsx($f,{size:18})}),O.jsx("button",{onClick:()=>He(ot),style:{WebkitTapHighlightColor:"transparent"},className:"p-2 text-zinc-400",children:O.jsx(Kf,{size:18})})]})]},ot))}),Ee?O.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl space-y-4",children:[O.jsx("h4",{className:"font-bold text-sm dark:text-white",children:"New Floor Details"}),O.jsxs("div",{className:"space-y-1",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Floor Name"}),O.jsx("input",{className:"w-full p-2 bg-white dark:bg-white/5 rounded-lg text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"e.g. B1, Ground",value:Ut.name,onChange:Pe=>wt({...Ut,name:Pe.target.value})})]}),["car","motorcycle","bicycle"].map(Pe=>O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("span",{className:"text-2xl w-8",children:Pe==="car"?"":Pe==="motorcycle"?"":""}),O.jsxs("div",{className:"flex-1",children:[O.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Spots"}),O.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Ut.counts[Pe]||"",onChange:ot=>wt(gt=>({...gt,counts:{...gt.counts,[Pe]:parseInt(ot.target.value)||0}}))})]}),O.jsxs("div",{className:"flex-1",children:[O.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Rate"}),O.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Ut.rates[Pe]||"",onChange:ot=>wt(gt=>({...gt,rates:{...gt.rates,[Pe]:parseFloat(ot.target.value)||0}}))})]})]},Pe)),O.jsxs("div",{className:"flex gap-2",children:[O.jsx("button",{onClick:()=>ye(!1),className:"flex-1 py-2 bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 rounded-xl font-bold text-sm",children:"Cancel"}),O.jsx("button",{onClick:()=>{Je(),ye(!1)},className:"flex-1 py-2 bg-blue-500 text-white rounded-xl font-bold text-sm",children:"Save Floor"})]})]}):O.jsx("button",{onClick:()=>ye(!0),className:"w-full py-4 border-2 border-dashed border-zinc-200 dark:border-white/10 rounded-2xl text-zinc-400 font-bold hover:bg-zinc-50 dark:hover:bg-white/5 transition-colors",children:"+ Add Floor"}),O.jsxs("div",{className:"flex gap-2 pt-2",children:[O.jsx("button",{onClick:()=>K(1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Back"}),O.jsx("button",{onClick:pt,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save Listing"})]})]})]})})},S4=({spot:c,listing:f,status:y,onClose:C,isManager:N,listingStats:k,setListingStats:R,setSpotStatuses:h,onSpotUpdate:V,...H})=>{const{pubkey:$,signEvent:K,pool:be}=Wu(),Ce=`${Wn.PARKING_SPOT_LISTING}:${c.pubkey}:${c.d}`,Ee=f.location?f.location.split(",").map(Xe=>parseFloat(Xe.trim())):void 0,ye=JSON.stringify({a:Ce,authorizer:f.owners?.[0]||$,auth:`static - ${c.d}`,listingName:f.listing_name,spotNumber:c.spot_number,shortName:c.short_name,listingLocation:Ee,spotType:c.type||"car",hourlyRate:c.rates?.hourly||f.rates?.[c.type]?.hourly||0,currency:c.rates?.currency||f.rates?.[c.type]?.currency||"USD"}),[he,ke]=De.useState(!1),[nt,Qe]=De.useState(!1),[dt,Ut]=De.useState({short_name:c.short_name||"",type:c.type,rate:c.rates?.hourly||0}),[wt,tt]=De.useState([]),[Je,He]=De.useState(new Map),[pt,Pe]=De.useState(!0),[ot,gt]=De.useState(""),[Rt,Ie]=De.useState(!1),[Se,je]=De.useState(!1),st=De.useCallback(async()=>{if(be){Pe(!0);try{const Xe=await be.querySync(Ei,{kinds:[Wn.LISTED_SPOT_LOG,Wn.PRIVATE_LOG_NOTE],"#a":[Ce],limit:50}),It=Xe.filter(Bt=>Bt.kind===Wn.LISTED_SPOT_LOG).sort((Bt,Mn)=>Mn.created_at-Bt.created_at),Nt=Xe.filter(Bt=>Bt.kind===Wn.PRIVATE_LOG_NOTE),$t=new Map;Nt.forEach(Bt=>{const Mn=Bt.tags.find(Tn=>Tn[0]==="e")?.[1];if(Mn){const Tn=$t.get(Mn)||[];Tn.push(Bt),$t.set(Mn,Tn)}}),tt(It),He($t)}catch(Xe){console.error("Failed to fetch spot history:",Xe)}finally{Pe(!1)}}},[be,Ce]);De.useEffect(()=>{N&&st()},[st,N]);const mt=async Xe=>{je(!0);try{const It=JSON.stringify({status:Xe,hourly_rate:c.rates?.hourly||0,currency:c.rates?.currency||"USD",type:c.type||"car",updated_at:Math.floor(Date.now()/1e3)}),Nt=[["a",Ce],["status",Xe],["updated_by",$],["client","parlens"]];f.location&&Nt.push(["location",f.location]),f.g&&Nt.push(["g",f.g]),c.type&&Nt.push(["type",c.type]),Nt.push(["hourly_rate",String(c.rates?.hourly||0)]),Nt.push(["currency",c.rates?.currency||"USD"]),Ei.forEach(Mn=>Nt.push(["r",Mn]));const $t={kind:Wn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:Nt,content:It},Bt=await K($t);await Promise.allSettled(be.publish(Ei,Bt)),await new Promise(Mn=>setTimeout(Mn,1500)),await st(),H.onSpotUpdate&&H.onSpotUpdate()}catch(It){console.error("Failed to update spot:",It),alert("Failed to update status")}finally{je(!1)}},Xt=async(Xe,It)=>{const Nt=It||ot;if(!Nt.trim())return;const $t=Xe||wt[0]?.id;if(!$t){alert("No activity log found to attach note to.");return}const Bt={kind:Wn.PRIVATE_LOG_NOTE,created_at:Math.floor(Date.now()/1e3),tags:[["e",$t],["a",Ce],["p",$],["client","parlens"]],content:Nt};try{const Mn=await K(Bt);await Promise.allSettled(be.publish(Ei,Mn)),It||gt(""),He(Tn=>{const Rn=new Map(Tn),ri=Rn.get($t)||[];return Rn.set($t,[...ri,Mn]),Rn})}catch{alert("Failed to add note")}},Oe=async()=>{const Xe=[["d",c.d],["a",c.a],["spot_number",c.spot_number],["floor",c.floor||""],["type",dt.type],["short_name",dt.short_name],["location",c.location],["g",c.g],["client","parlens"]];dt.rate;const It={kind:Wn.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:Xe,content:dt.short_name||`${f.listing_name} #${c.spot_number} `};await Promise.allSettled(be.publish(Ei,await K(It))),Qe(!1)};return nt?O.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:C,children:O.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative",onClick:Xe=>Xe.stopPropagation(),children:[O.jsx("button",{onClick:()=>Qe(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:O.jsx(Il,{size:20})}),O.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Edit Spot"}),O.jsxs("div",{className:"space-y-2 text-left",children:[O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Name / Short Code"}),O.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white",value:dt.short_name,onChange:Xe=>Ut({...dt,short_name:Xe.target.value}),placeholder:`#${c.spot_number} `}),O.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Type"}),O.jsxs("select",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white",value:dt.type,onChange:Xe=>Ut({...dt,type:Xe.target.value}),children:[O.jsx("option",{value:"car",children:" Car"}),O.jsx("option",{value:"motorcycle",children:" Motorcycle"}),O.jsx("option",{value:"bicycle",children:" Bicycle"})]})]}),O.jsxs("div",{className:"flex gap-2",children:[O.jsx("button",{onClick:()=>Qe(!1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Cancel"}),O.jsx("button",{onClick:Oe,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save"})]})]})}):O.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:C,children:O.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative max-h-[85vh] overflow-y-auto min-h-[400px]",onClick:Xe=>Xe.stopPropagation(),children:[Se&&O.jsxs("div",{className:"fixed inset-0 z-[6000] flex items-center justify-center bg-black/60 backdrop-blur-sm flex-col animate-in fade-in duration-200",children:[O.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-white/20 border-t-white rounded-full"}),O.jsx("div",{className:"text-white font-bold mt-4 animate-pulse",children:"Updating Status..."})]}),Rt?O.jsxs("div",{className:"flex flex-col h-full space-y-4 animate-in fade-in slide-in-from-right-4",children:[O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsx("button",{onClick:()=>Ie(!1),className:"p-2 -ml-2 rounded-full text-zinc-600 dark:text-white hover:bg-black/5 dark:hover:bg-white/10",children:O.jsx(Vv,{size:24})}),O.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Status Log"}),O.jsx("div",{className:"w-10"})," "]}),O.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 min-h-[300px]",children:pt?O.jsx("div",{className:"text-center text-zinc-400 py-8",children:"Loading logs..."}):wt.length===0?O.jsxs("div",{className:"text-center text-zinc-400 py-8 flex flex-col items-center gap-2",children:[O.jsx("div",{className:"text-4xl opacity-20",children:""}),O.jsx("p",{children:"No activity yet"})]}):wt.map((Xe,It)=>{const Nt=Xe.tags?.find(Rn=>Rn[0]==="status")?.[1],$t=Xe.tags?.find(Rn=>Rn[0]==="updated_by")?.[1],Bt=Xe.tags?.find(Rn=>Rn[0]==="authorizer")?.[1],Mn=new Date(Xe.created_at*1e3),Tn=Je.get(Xe.id)||[];return O.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left border border-black/5 dark:border-white/5",children:[O.jsxs("div",{className:"flex items-center justify-between mb-2",children:[O.jsxs("div",{className:`font - bold capitalize flex items - center gap - 2 ${Nt==="open"?"text-green-500":Nt==="occupied"?"text-red-500":"text-zinc-500"} `,children:[O.jsx("div",{className:`w - 2 h - 2 rounded - full ${Nt==="open"?"bg-green-500":Nt==="occupied"?"bg-red-500":"bg-zinc-500"} `}),Nt||"unknown"]}),O.jsxs("div",{className:"text-xs text-zinc-400 font-medium tabular-nums",children:[Mn.toLocaleDateString(void 0,{month:"short",day:"numeric"}),"  ",Mn.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})]})]}),O.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/40 flex flex-col gap-1",children:[O.jsxs("div",{children:["By: ",$t?$t===$?"You":`${$t.slice(0,8)}...`:"Unknown"]}),Bt&&O.jsxs("div",{children:["Auth: ",Bt.slice(0,8),"..."]})]}),O.jsxs("div",{className:"mt-2 flex gap-2",children:[O.jsx("input",{id:`note-input-${Xe.id}`,placeholder:"Add a note",className:"flex-1 p-2.5 bg-white dark:bg-white/10 rounded-xl text-sm text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-zinc-400",onKeyDown:Rn=>{Rn.key==="Enter"&&Rn.target.value.trim()&&(Xt(Xe.id,Rn.target.value),Rn.target.value="")}}),O.jsx("button",{onClick:()=>{const Rn=document.getElementById(`note-input-${Xe.id}`);Rn&&Rn.value.trim()&&(Xt(Xe.id,Rn.value),Rn.value="")},className:"p-2.5 bg-[#007AFF] text-white rounded-xl",children:O.jsx($g,{size:20})})]}),Tn.length>0&&O.jsx("div",{className:"mt-3 space-y-2 pt-3 border-t border-black/5 dark:border-white/5",children:Tn.map(Rn=>O.jsx("div",{className:"text-xs bg-yellow-50 dark:bg-yellow-900/10 p-2 rounded-lg text-zinc-700 dark:text-yellow-100/80",children:Rn.content},Rn.id))})]},Xe.id||It)})})]}):O.jsxs(O.Fragment,{children:[O.jsx("button",{onClick:C,className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:O.jsx(Il,{size:20})}),O.jsx("h2",{className:"text-xl font-bold dark:text-white pr-8 text-left",children:c.short_name||c.content}),N&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"p-4 rounded-3xl flex justify-center",children:O.jsx(px,{value:ye,size:180,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-black dark:text-white"})}),O.jsxs("div",{onClick:()=>{navigator.clipboard.writeText(ye),ke(!0),setTimeout(()=>ke(!1),2e3)},className:"flex justify-center items-center gap-2 text-[#007AFF] font-bold cursor-pointer py-2 hover:opacity-80 transition-opacity",children:[he?O.jsx(Xf,{size:18}):O.jsx(hx,{size:18})," ",he?"Copied":"Copy Auth Code"]})]}),O.jsxs("div",{className:"grid grid-cols-2 gap-3 text-left",children:[O.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[O.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Rate"}),O.jsxs("div",{className:"text-lg font-bold dark:text-white tabular-nums",children:[c.rates?.currency||f.rates?.car?.currency||"$",c.rates?.hourly||f.rates?.[c.type]?.hourly,"/hr"]})]}),O.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[O.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Status"}),(()=>{const Xe=wt.length>0?wt[0]:null,It=Xe?.tags.find(Bt=>Bt[0]==="status")?.[1];let Nt;if(Xe&&y?Nt=Xe.created_at>=y.created_at?It:y.status:Nt=It||y?.status,!Nt&&pt)return O.jsx("div",{className:"text-lg font-bold text-zinc-400 animate-pulse",children:"..."});const $t=Nt||"open";return O.jsx("div",{className:`text-lg font-bold capitalize ${$t==="occupied"?"text-red-500":$t==="closed"?"text-zinc-500":"text-green-500"}`,children:$t})})()]})]}),N&&O.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left space-y-2",children:[O.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Latest Note"}),(()=>{let Xe=null,It=0;return Je.forEach(Nt=>{Nt.forEach($t=>{$t.created_at>It&&(Xe=$t,It=$t.created_at)})}),Xe?O.jsxs("div",{className:"text-sm dark:text-white italic",children:['"',Xe.content,'" ',O.jsxs("span",{className:"text-xs text-zinc-400 not-italic",children:["- ",new Date(Xe.created_at*1e3).toLocaleDateString()]})]}):O.jsx("div",{className:"text-sm text-zinc-400 italic",children:"No notes added yet"})})(),O.jsxs("div",{className:"flex gap-2 pt-2",children:[O.jsx("input",{value:ot,onChange:Xe=>gt(Xe.target.value),placeholder:"Add a note",className:"flex-1 p-2.5 bg-white dark:bg-white/10 rounded-xl text-sm text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-zinc-400",onKeyDown:Xe=>{Xe.key==="Enter"&&Xt()}}),O.jsx("button",{onClick:()=>Xt(),disabled:!ot.trim(),className:"p-2.5 bg-[#007AFF] text-white rounded-xl disabled:opacity-50",children:O.jsx($g,{size:20})})]})]}),N&&O.jsxs("div",{className:"space-y-4 pt-2",children:[O.jsxs("div",{className:"flex gap-2",children:[O.jsx("button",{onClick:()=>mt("open"),className:"flex-1 py-3 bg-green-500/10 border border-green-500/20 text-green-600 dark:text-green-400 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Open"}),O.jsx("button",{onClick:()=>mt("occupied"),className:"flex-1 py-3 bg-red-500/10 border border-red-500/20 text-red-500 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Occupied"}),O.jsx("button",{onClick:()=>mt("closed"),className:"flex-1 py-3 bg-zinc-500/10 border border-zinc-500/20 text-zinc-500 dark:text-zinc-400 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Closed"})]}),O.jsxs("button",{onClick:()=>Ie(!0),className:"w-full py-4 bg-blue-500/10 border border-blue-500/20 text-[#007AFF] font-bold rounded-2xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform",children:["View Status Log ",O.jsx(Yf,{size:18})]}),O.jsxs("div",{className:"flex gap-3 pt-2 border-t border-black/5 dark:border-white/5",children:[O.jsxs("button",{onClick:()=>Qe(!0),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 py-3 bg-zinc-100 dark:bg-white/10 border border-zinc-200 dark:border-white/10 text-zinc-600 dark:text-zinc-300 font-bold text-sm flex items-center justify-center gap-2 rounded-xl transition-transform active:scale-95",children:[O.jsx($f,{size:16})," Edit"]}),O.jsxs("button",{onClick:async()=>{if(!confirm("Delete this spot?"))return;const Xe={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",c.id],["a",`${Wn.PARKING_SPOT_LISTING}:${$}:${c.d}`]],content:"Deleted"};if(await Promise.allSettled(be.publish(Ei,await K(Xe))),f.originalEvent&&f.total_spots){const It=Math.max(0,(f.total_spots||1)-1),Nt=f.originalEvent.tags.filter(Bt=>Bt[0]!=="total_spots").concat([["total_spots",String(It)]]),$t={kind:Wn.LISTED_PARKING_METADATA,created_at:Math.floor(Date.now()/1e3),tags:Nt,content:f.originalEvent.content};await Promise.allSettled(be.publish(Ei,await K($t))),console.log(`[Parlens] Updated total_spots to ${It} after spot deletion`)}C()},style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 py-3 bg-zinc-100 dark:bg-white/10 border border-zinc-200 dark:border-white/10 text-red-500 font-bold text-sm flex items-center justify-center gap-2 rounded-xl transition-transform active:scale-95",children:[O.jsx(Kf,{size:16})," Delete"]})]})]})]})]})})},T4=({listing:c,onClose:f})=>{const y=(C,N)=>!N||N.length===0?null:O.jsxs("div",{className:"space-y-2",children:[O.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:C}),O.jsx("div",{className:"space-y-1",children:N.map(k=>O.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-50 dark:bg-white/5 rounded-xl",children:[O.jsx("div",{className:"flex flex-col overflow-hidden",children:k.startsWith("npub")?O.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:k}):O.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:(()=>{try{return R_(k)}catch{return k}})()})}),O.jsx("button",{onClick:()=>{const R=k.startsWith("npub")?k:(()=>{try{return R_(k)}catch{return k}})();navigator.clipboard.writeText(R),alert("Copied")},className:"p-2 text-blue-500 bg-blue-500/10 rounded-full hover:bg-blue-500/20 active:scale-95 transition-all",children:O.jsx(hx,{size:16})})]},k))})]});return O.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",onClick:f,children:O.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-6 relative border border-black/5 dark:border-white/10 shadow-2xl",onClick:C=>C.stopPropagation(),children:[O.jsxs("div",{className:"flex justify-between items-center",children:[O.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Access List"}),O.jsx("button",{onClick:f,children:O.jsx(Il,{className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-white"})})]}),O.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:[y("Owners",c.owners),y("Managers",c.managers),y("Members",c.members),y("Relays",c.relays||[]),!c.owners?.length&&!c.managers?.length&&!c.members?.length&&O.jsx("div",{className:"text-center text-zinc-400 py-8",children:"No access details found"})]})]})})},N_={light:"https://tiles.openfreemap.org/styles/positron",dark:"https://tiles.openfreemap.org/styles/dark"},k_=De.memo(({price:c,emoji:f,currency:y,isHistory:C=!1})=>{const N=Mm(y);return O.jsxs("div",{className:"flex flex-col items-center justify-center transition-transform active:scale-95 pointer-events-none group",children:[O.jsx("div",{className:"text-[32px] leading-none drop-shadow-md z-10 filter pointer-events-auto cursor-pointer",children:f}),O.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap pointer-events-auto
                    ${C?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[N,Math.round(c),"/hr"]})]})}),Ty=De.memo(({bearing:c,mapBearing:f,isNavigationMode:y})=>{const C=c-f,N=De.useRef(0),k=De.useRef(0),R=C-k.current;Math.abs(R)>180&&(R>0?N.current-=360:N.current+=360),k.current=C;const h=C+N.current;return O.jsx("div",{style:{transform:`rotate(${h}deg) scale(1)`,transition:"transform 0.2s ease-out",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:O.jsx("div",{style:{width:28,height:28,background:"#007AFF",border:"3px solid white",borderRadius:"50%",boxShadow:`0 0 0 ${y?3:2}px rgba(0,122,255,${y?.5:.4}), 0 4px 12px rgba(0,0,0,0.4)`,display:"flex",alignItems:"center",justifyContent:"center"},children:O.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"translateY(-1px)"},children:O.jsx("path",{d:"M7 0L14 14L7 12L0 14L7 0Z",fill:"white"})})})})});Ty.displayName="UserLocationMarker";const Ay=De.memo(({count:c,minPrice:f,maxPrice:y,currency:C,type:N})=>{const k=N==="open"?"":"",R=N==="history",h=Mm(C),V=f===y?`${h}${f}`:`${h}${f}-${y}`;return O.jsxs("div",{className:"flex flex-col items-center justify-center transition-transform active:scale-95 pointer-events-none group",children:[O.jsxs("div",{className:"relative text-[32px] leading-none drop-shadow-md z-10 filter pointer-events-auto cursor-pointer",children:[k,O.jsx("div",{className:`
                    absolute -top-1 -right-1 flex items-center justify-center min-w-[18px] h-[18px] px-1
                    text-[10px] font-bold text-white rounded-full border-2 border-white shadow-sm
                    ${R?"bg-zinc-500":"bg-[#34C759]"}
                `,children:c})]}),O.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${R?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[V,"/hr"]})]})});Ay.displayName="ClusterMarkerContent";const x2=De.memo(({vehicleType:c})=>{const f=c==="bicycle"?"":c==="motorcycle"?"":"";return O.jsx("div",{style:{fontSize:36,filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.4))",pointerEvents:"none"},children:f})});x2.displayName="ActiveSessionMarkerContent";const _2=De.memo(({vehicleType:c,onVehicleChange:f,disabled:y})=>{const[C,N]=De.useState(!1),k=["bicycle","motorcycle","car"],R={bicycle:"",motorcycle:"",car:""};return O.jsx("div",{className:"flex flex-col rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg overflow-hidden transition-all duration-300",children:C?O.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[k.map(h=>O.jsx("button",{onClick:()=>{y?y&&alert("Please end your current session before changing vehicle type."):(f(h),N(!1))},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${c===h?"bg-blue-500/20 shadow-inner":"transition-colors"}`,children:O.jsx("span",{className:`text-lg ${c===h?"":"opacity-50"}`,children:R[h]})},h)),O.jsx("button",{onClick:()=>N(!1),className:"w-10 h-6 flex items-center justify-center text-zinc-400 dark:text-white/40 transition-colors",children:O.jsx(x1,{size:16})})]}):O.jsxs("button",{onClick:()=>N(!0),className:"flex flex-col items-center p-1 transition-all",children:[O.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-500/20",children:O.jsx("span",{className:"text-lg",children:R[c]})}),O.jsx(kd,{size:14,className:"text-zinc-400 dark:text-white/40 mt-0.5"})]})})});_2.displayName="VehicleToggle";const A4=({onRequestScan:c,initialScannedCode:f,onScannedCodeConsumed:y})=>{const{pubkey:C,signEvent:N,pool:k}=Wu(),R=De.useRef(null),[h,V]=De.useState(null),H=De.useRef(new s4),$=De.useRef(new a4),K=De.useRef(new o4),[be,Ce]=De.useState(null),[Ee,ye]=De.useState("idle"),[he,ke]=De.useState("fixed"),[nt,Qe]=De.useState(!1),[dt,Ut]=De.useState(!1),[wt,tt]=De.useState(!1),[Je,He]=De.useState(()=>{const vt=localStorage.getItem("parlens_vehicle_type");return vt==="bicycle"||vt==="motorcycle"||vt==="car"?vt:"car"}),[pt,Pe]=De.useState([]),[ot,gt]=De.useState([]),[Rt,Ie]=De.useState(null),[Se,je]=De.useState(()=>{const vt=localStorage.getItem("parlens_listed_parking_session");return vt?JSON.parse(vt):null}),[st,mt]=De.useState(!1);De.useEffect(()=>{f&&(console.log("[LandingPage] Processing scanned code from QRScanPage:",f),Nt(f),y?.())},[f,y]);const[Xt,Oe]=De.useState(!1),[Xe,It]=De.useState(!1),Nt=De.useCallback(async vt=>{console.log("[Parlens] Processing scanned code:",vt);try{const{generateSecretKey:tn,finalizeEvent:xn,getPublicKey:on}=await Gg(async()=>{const{generateSecretKey:wi,finalizeEvent:yr,getPublicKey:Gi}=await Promise.resolve().then(()=>wy);return{generateSecretKey:wi,finalizeEvent:yr,getPublicKey:Gi}},void 0);let pn;try{pn=JSON.parse(vt)}catch{pn={a:vt,authorizer:"",auth:""}}if(!pn.a){alert("Invalid QR code format");return}if(C&&pn.authorizer&&pn.authorizer===C){alert("Owners and managers cannot use QR authentication to park at their own listing. Please use the spot card to update status directly.");return}const ft="parlens_listed_parking_session",Te=localStorage.getItem(ft);let zn=!1;Te&&JSON.parse(Te).spotATag===pn.a&&(zn=!0);const $i=tn(),Dr=on($i);if(zn){const wi=JSON.parse(Te);_n({authData:pn,session:wi,tempPrivkey:$i,tempPubkey:Dr}),Ke(!0);return}const pa=[["a",pn.a],["status","occupied"],["updated_by",Dr],["authorizer",pn.authorizer||C||""],...pn.auth?[["auth",pn.auth]]:[],["client","parlens"]],Tr=pn.listingLocation||null;if(Tr){pa.push(["location",`${Tr[0]},${Tr[1]}`]);try{const wi=M_.encode(Tr[0],Tr[1],9);pa.push(["g",wi])}catch{}}pn.spotType&&pa.push(["type",pn.spotType]),pn.hourlyRate!==void 0&&(pa.push(["hourly_rate",String(pn.hourlyRate)]),pa.push(["currency",pn.currency||"USD"]));const Xn={kind:Wn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:pa,content:JSON.stringify({hourly_rate:pn.hourlyRate||0,currency:pn.currency||"USD",type:pn.spotType||"car"})},Ui=xn(Xn,$i);await Promise.allSettled(k.publish(Ei,Ui)),console.log("[Parlens] Status update published:",Ui.id);const Bs=`parking-${Date.now()}`,ko=pn.listingLocation||h,ui=JSON.stringify({spotATag:pn.a,listingATag:pn.a.replace(/37141:/,"31147:").split(":").slice(0,2).join(":"),statusLogEventId:Ui.id,listingName:pn.listingName||"",spotNumber:pn.spotNumber||"",shortName:pn.shortName||"",tempPubkey:Dr,started_at:Date.now()}),Fs={kind:Wn.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Bs],["a",pn.a],["status","parked"],["client","parlens"]],content:ui},$o=await N(Fs);await Promise.allSettled(k.publish(Ei,$o));const Ko={spotATag:pn.a,dTag:Bs,startTime:Date.now(),authorizer:pn.authorizer,tempPubkey:Dr,listingName:pn.listingName||"",spotNumber:pn.spotNumber||"",shortName:pn.shortName||"",listingLocation:ko||void 0,spotType:pn.spotType||"car",hourlyRate:pn.hourlyRate||0,currency:pn.currency||"USD"};localStorage.setItem(ft,JSON.stringify(Ko)),je(Ko),ye("parked"),Ie(ko||null),fn(Math.floor(Date.now()/1e3)),console.log("[Parlens] Listed parking started:",$o.id)}catch(tn){console.error("Failed to process QR code:",tn),alert("Failed to process parking. Please try again.")}},[C,N,k,h,ye]),$t=async()=>{if(!wn)return;const{authData:vt,session:tn,tempPrivkey:xn,tempPubkey:on}=wn;try{const{finalizeEvent:pn}=await Gg(async()=>{const{finalizeEvent:Bs}=await Promise.resolve().then(()=>wy);return{finalizeEvent:Bs}},void 0),ft=[["a",vt.a],["status","open"],["updated_by",on],["authorizer",vt.authorizer||C||""],...vt.auth?[["auth",vt.auth]]:[],["client","parlens"]],Te=vt.listingLocation||tn.listingLocation;if(Te){ft.push(["location",`${Te[0]},${Te[1]}`]);try{const Bs=M_.encode(Te[0],Te[1],9);ft.push(["g",Bs])}catch{}}const zn=vt.spotType||tn.spotType||"car",$i=vt.hourlyRate??tn.hourlyRate??0,Dr=vt.currency||tn.currency||"USD";ft.push(["type",zn]),ft.push(["hourly_rate",String($i)]),ft.push(["currency",Dr]);const Da={kind:Wn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:ft,content:JSON.stringify({hourly_rate:$i,currency:Dr,type:zn})},pa=pn(Da,xn);await Promise.allSettled(k.publish(Ei,pa));const Tr=JSON.stringify({spotATag:vt.a,statusLogEventId:pa.id,listingName:tn.listingName||"",spotNumber:tn.spotNumber||"",shortName:tn.shortName||"",ended_at:Date.now(),fee:kn,currency:"USD"}),Xn={kind:Wn.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",tn.dTag||`parking-${Date.now()}`],["a",vt.a],["status","idle"],["client","parlens"]],content:Tr},Ui=await N(Xn);await Promise.allSettled(k.publish(Ei,Ui)),localStorage.removeItem("parlens_listed_parking_session"),je(null),ye("idle"),Ie(null),fn(null),Ke(!1),_n(null),Fn("0"),console.log("[Parlens] Listed parking ended")}catch(pn){console.error("Failed to end listed session:",pn),alert("Failed to end session. Please try again.")}},[Bt,Mn]=De.useState(!1),[Tn,Rn]=De.useState(17),[ri,_i]=De.useState(null),[$n,Kn]=De.useState(null),[Qn,ti]=De.useState(null),[Bi,si]=De.useState(!1),[Yt,fn]=De.useState(null),[di,gn]=De.useState(!1),[Zn,Yi]=De.useState({longitude:77.5946,latitude:12.9716,zoom:17,bearing:0,pitch:0}),fi=De.useRef(!1),ci=De.useRef(!1),ct=window.matchMedia("(prefers-color-scheme: dark)").matches,[oe,ue]=De.useState(!1),[ge,qe]=De.useState([]),[$e,bt]=De.useState(null),[at,fe]=De.useState(null),[de,Me]=De.useState(null),[Ue,xt]=De.useState(""),[,yt]=De.useState(!1),[qt,Ot]=De.useState([]),[cn,Ke]=De.useState(!1),[kn,Fn]=De.useState("0"),[wn,_n]=De.useState(null),[gi,Yn]=De.useState(!1),[nn,Jt]=De.useState(null),[Bn,Di]=De.useState(null);De.useEffect(()=>{const tn=setTimeout(async()=>{if(!(!h||Bn))try{const on=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${h[0]}&lon=${h[1]}&format=json`)).json();on&&on.address&&on.address.country_code&&(console.log("[Parlens] Detected Country:",on.address.country_code),Di(on.address.country_code.toUpperCase()))}catch(xn){console.error("[Parlens] Failed to detect country:",xn)}},2e3);return()=>clearTimeout(tn)},[h,Bn]);const Fi=De.useCallback(()=>{const vt=Zn,tn=qt.length+ge.length+1,xn={id:crypto.randomUUID(),lat:vt.latitude,lon:vt.longitude,name:`Waypoint ${tn}`};qe(on=>[...on,xn])},[Zn,qt.length,ge.length]),Zt=(vt,tn)=>{qe(xn=>xn.map(on=>on.id===vt?{...on,name:tn}:on))},xi=vt=>{qe(tn=>tn.filter(on=>on.id!==vt).map((on,pn)=>on.name.startsWith("Waypoint ")?{...on,name:`Waypoint ${pn+1}`}:on)),at===vt&&fe(null)},bn=De.useCallback(()=>{const vt=ge.map(tn=>({lat:tn.lat,lon:tn.lon,name:tn.name}));bt(vt),qe([]),ue(!1)},[ge]),[Rr,vi]=De.useState(!1),[jt,Gn]=De.useState(0),[ni,vs]=De.useState(0),{requestLock:ws,releaseLock:ia}=c4(),ai=De.useRef(new l4),[Rs,Sr]=De.useState(0),ji=De.useRef(!1),da=De.useRef(0),us=De.useRef(0);De.useEffect(()=>{if(Ee==="parked"){ke("fixed");const vt=R.current?.getBearing()||0,tn=Math.round(vt/360)*360;R.current?.rotateTo(tn,{duration:800})}},[Ee]),De.useEffect(()=>(ws(),()=>{ia()}),[ws,ia]),De.useEffect(()=>{if(!navigator.geolocation){Ce("Geolocation is not supported by your browser");return}const vt=navigator.geolocation.watchPosition(tn=>{const{latitude:xn,longitude:on,accuracy:pn}=tn.coords,ft=ai.current.updateLocationWithAccuracy(xn,on,pn);Sr(ft.speed),da.current=ft.speed,ft.speedClass==="stationary"?ft.shouldUpdate&&K.current.animateTo(ft.displayLat,ft.displayLon,ft.animationDuration):K.current.animateTo(xn,on,300),ji.current||(ji.current=!0,V([ft.displayLat,ft.displayLon]),Yi(Te=>({...Te,latitude:ft.displayLat,longitude:ft.displayLon})))},tn=>{let xn="Unable to get your location";tn.code===1?xn="Location access denied. Please enable location services.":tn.code===2?xn="Location unavailable. Check your GPS settings.":tn.code===3&&(xn="Location request timed out."),Ce(xn)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return K.current.setUpdateCallback((tn,xn)=>{V([tn,xn]),ke(on=>{if((on==="auto"||on==="recentre")&&!fi.current){if(da.current<.3&&on!=="recentre")return on;Yi(pn=>{const ft=R.current?.getZoom()??pn.zoom,Te=.1,zn=pn.latitude+(tn-pn.latitude)*Te,$i=pn.longitude+(xn-pn.longitude)*Te;return{...pn,latitude:zn,longitude:$i,zoom:ft}})}return on})}),()=>{navigator.geolocation.clearWatch(vt),K.current.stop()}},[]),De.useEffect(()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&vi(!0);const vt=tn=>{if(fi.current)return;let xn=null;if(tn.webkitCompassHeading?xn=tn.webkitCompassHeading:tn.alpha!==null&&(xn=360-tn.alpha),xn!==null){const on=window.screen.orientation?.angle??window.orientation??0;xn=(xn+on)%360}if(xn!==null){us.current=xn,vs(pn=>{let Te=xn-pn;return Te>180&&(Te-=360),Te<-180&&(Te+=360),Math.abs(Te)<2?pn:pn+Te*.1});const on=H.current.smoothBearing(xn,0,!0);if(on!==null){const pn=$.current.setBearing(on);Gn(pn)}}};return window.addEventListener("deviceorientation",vt,!0),()=>{window.removeEventListener("deviceorientation",vt,!0)}},[]);const dr=async()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission()==="granted"&&vi(!1)};De.useEffect(()=>{!fi.current&&!ci.current&&h&&(he==="auto"||he==="recentre")&&Yi(vt=>{const tn=R.current?.getZoom()??vt.zoom,xn={...vt,longitude:h[1],latitude:h[0],zoom:tn,pitch:0};if(oe)return vt;if(he==="auto"){xn.bearing=jt;const on=tn>=17?300:tn>=15?200:150;xn.transitionDuration=on}else if(he==="recentre"){const on=tn>=17?400:tn>=15?300:200;xn.transitionDuration=on}return xn})},[h,jt,he,Bi,oe]),De.useEffect(()=>(ws(),()=>{ia()}),[ws,ia]),De.useEffect(()=>{const vt=localStorage.getItem("parlens_session");if(vt)try{const tn=JSON.parse(vt);tn.status==="parked"&&tn.parkLocation&&tn.sessionStart?(console.log("[Parlens] Restoring parked session:",tn),fn(tn.sessionStart),Ie(tn.parkLocation),ye("parked")):tn.status==="search"&&(console.log("[Parlens] Restoring search session"),ye("search"))}catch(tn){console.warn("[Parlens] Failed to restore session:",tn),localStorage.removeItem("parlens_session")}},[]),De.useEffect(()=>{Ee==="parked"&&Yt&&Rt?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Yt,parkLocation:Rt})):Ee==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):Ee==="idle"&&(localStorage.removeItem("parlens_session"),fn(null))},[Ee,Yt,Rt]),De.useEffect(()=>{if(!h){Mn(!1);return}const[vt,tn]=h,xn=Math.sqrt(Math.pow(Zn.latitude-vt,2)+Math.pow(Zn.longitude-tn,2));Mn(xn>5e-4)},[h,Zn.latitude,Zn.longitude]);const an=De.useCallback(vt=>{Yi(vt.viewState);let tn=!1;if(R.current&&(hs.current&&(tn=!0),R.current.isZooming()&&(tn=!0),vt&&vt.originalEvent&&vt.originalEvent.touches&&vt.originalEvent.touches.length>1&&(tn=!0)),fi.current&&(he==="auto"||he==="recentre")&&!tn){let xn=1;h&&(xn=Math.sqrt(Math.pow(vt.viewState.longitude-h[1],2)+Math.pow(vt.viewState.latitude-h[0],2))),xn>1e-4&&ke("fixed")}},[h,he,Bt]),Es=De.useCallback(vt=>{vt.originalEvent&&(fi.current=!0,K.current.stop(),ci.current&&(R.current?.stop(),ci.current=!1))},[]),Hn=De.useCallback(()=>{setTimeout(()=>{fi.current=!1},1e3),Rn(Zn.zoom)},[Zn.zoom]),hs=De.useRef(!1),Yo=De.useCallback(()=>{hs.current=!0,fi.current=!0,K.current.stop(),ci.current&&(R.current?.stop(),ci.current=!1)},[]),Pi=De.useCallback(()=>{hs.current=!1,setTimeout(()=>{hs.current||(fi.current=!1)},1e3)},[]),Ai=vt=>{if(Ee!=="idle"){alert("Please end your current session before changing vehicle type.");return}He(vt),localStorage.setItem("parlens_vehicle_type",vt)},yi=De.useCallback((vt,tn,xn,on)=>{if(_i(vt),Kn(tn),ti(xn),si(on),vt&&vt.length>1&&R.current&&on){const pn=[...vt];tn&&tn.length>0&&pn.push(...tn);const ft=pn.map($i=>$i[1]),Te=pn.map($i=>$i[0]),zn=new Qv.LngLatBounds([Math.min(...ft),Math.min(...Te)],[Math.max(...ft),Math.max(...Te)]);ci.current=!0,R.current.fitBounds(zn,{padding:50,duration:1e3}),ke("fixed"),setTimeout(()=>{ci.current=!1,typeof DeviceOrientationEvent.requestPermission=="function"&&vi(!0)},1200)}},[]),fo=De.useMemo(()=>ot.filter(tn=>(tn.decryptedContent?.type||"car")===Je).map(tn=>{const xn=tn.decryptedContent;return xn&&xn.lat&&xn.lon?{id:tn.id,lat:xn.lat,lon:xn.lon,price:parseFloat(xn.fee)||0,currency:xn.currency||"USD",original:tn}:null}).filter(Boolean),[ot,Je]),fa=De.useMemo(()=>A_(fo,Tn),[fo,Tn]),Ds=De.useMemo(()=>Ee!=="search"?[]:pt.filter(vt=>(vt.type||"car")===Je).map(vt=>({id:vt.id,lat:vt.lat,lon:vt.lon,price:vt.price,currency:vt.currency,count:vt.count,original:vt})),[pt,Je,Ee]),Jn=De.useMemo(()=>A_(Ds,Tn),[Ds,Tn]),Ra=ct?N_.dark:N_.light,uu={id:"route",type:"line",paint:{"line-color":"#007AFF","line-width":5,"line-opacity":.9}},or={id:"alternate-route",type:"line",paint:{"line-color":"#007AFF","line-width":3,"line-opacity":.4,"line-dasharray":[2,2]}};return De.useEffect(()=>{(ri||$n)&&It(!0)},[ri,$n]),O.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[(!h&&!be||!di)&&O.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:O.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:be?O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:O.jsx("span",{className:"text-2xl",children:""})}),O.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:be}),O.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-[#007AFF] text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),O.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})}),he==="auto"&&h&&O.jsx("div",{className:"absolute top-1/2 left-1/2 z-[900] pointer-events-none flex items-center justify-center",style:{transform:"translate(-50%, -50%)",width:"40px",height:"40px"},children:O.jsx(Ty,{bearing:ni,mapBearing:Zn.bearing,isNavigationMode:!0})}),O.jsxs("div",{className:"absolute inset-0",onPointerDownCapture:()=>{fi.current=!0,K.current.stop(),ci.current&&(R.current?.stop(),ci.current=!1)},onTouchStartCapture:()=>{fi.current=!0,K.current.stop(),ci.current&&(R.current?.stop(),ci.current=!1)},onWheelCapture:()=>{fi.current=!0,ci.current&&(R.current?.stop(),ci.current=!1),window.wheelDebounce&&clearTimeout(window.wheelDebounce),window.wheelDebounce=setTimeout(()=>{fi.current=!1},1e3)},style:{touchAction:"none"},children:[O.jsxs(bC,{ref:R,...Zn,onStyleData:vt=>{const tn=vt.target;tn&&(tn.getStyle().layers?.forEach(pn=>{(pn.id.includes("oneway")||pn.id.includes("arrow")||pn.id.includes("direction"))&&tn.getLayoutProperty(pn.id,"visibility")!=="none"&&tn.setLayoutProperty(pn.id,"visibility","none")}),Object.entries({"icon-bus":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M4 6C4 4.89543 4.89543 4 6 4H18C19.1046 4 20 4.89543 20 6V17C20 18.1046 19.1046 19 18 19H16.5L17.5 21H15.5L14.5 19H9.5L8.5 21H6.5L7.5 19H6C4.89543 19 4 18.1046 4 17V6ZM6 6V10H18V6H6ZM6 12V16H18V12H6ZM8 14C8.55228 14 9 13.5523 9 13C9 12.4477 8.55228 12 8 12C7.44772 12 7 12.4477 7 13C7 13.5523 7.44772 14 8 14ZM16 14C16.5523 14 17 13.5523 17 13C17 12.4477 16.5523 12 16 12C15.4477 12 15 12.4477 15 13C15 13.5523 15.4477 14 16 14Z"/></svg>',"icon-train":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8 2 4 2.5 4 6V15.5C4 17.433 5.567 19 7.5 19L6 20.5V21H18V20.5L16.5 19C18.433 19 20 17.433 20 15.5V6C20 2.5 16 2 12 2ZM12 4C14.5 4 18 4.5 18 6V10H6V6C6 4.5 9.5 4 12 4ZM12 17C10.8954 17 10 16.1046 10 15C10 13.8954 10.8954 13 12 13C13.1046 13 14 13.8954 14 15C14 16.1046 13.1046 17 12 17ZM7.5 17C6.67157 17 6 16.3284 6 15.5V12H9.05C9.02 12.3 9 12.64 9 13C9 14.6569 10.3431 16 12 16C13.6569 16 15 14.6569 15 13C15 12.64 14.98 12.3 14.95 12H18V15.5C18 16.3284 17.3284 17 16.5 17H7.5Z"/></svg>',"icon-subway":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M17.8 2.8C16 2.09 13.86 2 12 2C10.14 2 8 2.09 6.2 2.8C4.30002 3.55 3.00002 4.97 3.00002 6.5V15.5C3.00002 17.4 4.40002 19.34 6.6 19.89L5.00002 21.5V22H19V21.5L17.4 19.89C19.6 19.34 21 17.4 21 15.5V6.5C21 4.97 19.7 3.55 17.8 2.8ZM16.5 16C15.12 16 14 14.88 14 13.5C14 12.12 15.12 11 16.5 11C17.88 11 19 12.12 19 13.5C19 14.88 17.88 16 16.5 16ZM12 9C7.58 9 6 6.5 6 6.5C6 6.5 8 5.5 12 5.5C16 5.5 18 6.5 18 6.5C18 6.5 16.42 9 12 9ZM7.5 16C6.12 16 5.00002 14.88 5.00002 13.5C5.00002 12.12 6.12 11 7.5 11C8.88 11 10 12.12 10 13.5C10 14.88 8.88 16 7.5 16Z"/></svg>',"icon-tram":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M13 5.5V2H11V5.5L7 8H17L13 5.5ZM5 9V17.5C5 18.7 5.7 19.7 6.8 20.2L6 21H8L9 20H15L16 21H18L17.2 20.2C18.3 19.7 19 18.7 19 17.5V9H5ZM16 16.5C16 17.05 15.55 17.5 15 17.5H9C8.45 17.5 8 17.05 8 16.5V14H16V16.5ZM16 12.5H8V10.5H16V12.5Z"/></svg>',"icon-stop":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="6" stroke="white" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="white"/></svg>'}).forEach(([pn,ft])=>{if(!tn.hasImage(pn)){const Te=new Image(24,24);Te.onload=()=>tn.addImage(pn,Te,{sdf:!0}),Te.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(ft)}}),tn.getLayer("transit-stops")||tn.addLayer({id:"transit-stops",type:"symbol",source:"openmaptiles","source-layer":"poi",minzoom:12,filter:["match",["get","class"],["bus_station","railway","bus_stop","tram_stop","subway","rail","train_station"],!0,!1],layout:{"icon-image":["match",["get","class"],"bus_station","icon-bus","bus_stop","icon-stop","railway","icon-train","rail","icon-train","train_station","icon-train","tram_stop","icon-tram","subway","icon-subway","icon-stop"],"icon-size":["interpolate",["linear"],["zoom"],12,.5,14,.6,18,1],"icon-allow-overlap":!1,"icon-padding":2,"text-field":["upcase",["coalesce",["get","name_en"],["get","name"]]],"text-size":11,"text-offset":[0,1.2],"text-anchor":"top","text-font":["Noto Sans Regular"],"text-optional":!0},paint:{"icon-color":ct?"#999999":"#555555","icon-halo-color":ct?"rgba(0,0,0,0.5)":"#ffffff","icon-halo-width":1,"text-color":ct?"#aaaaaa":"#666666","text-halo-color":ct?"rgba(0,0,0,0.8)":"#ffffff","text-halo-width":1,"text-opacity":["interpolate",["linear"],["zoom"],13.5,0,14,1]}}))},onLoad:vt=>{gn(!0);const tn=vt.target;tn&&tn.getStyle().layers?.forEach(on=>{(on.id.includes("oneway")||on.id.includes("arrow")||on.id.includes("direction"))&&tn.setLayoutProperty(on.id,"visibility","none")})},onMove:an,onMoveStart:Es,onMoveEnd:Hn,onZoomStart:Yo,onZoomEnd:Pi,onRotateStart:()=>{fi.current=!0,K.current.stop()},onRotateEnd:Hn,onPitchStart:()=>{fi.current=!0,K.current.stop()},onPitchEnd:Hn,style:{width:"100%",height:"100%"},mapStyle:Ra,attributionControl:!1,dragPan:!ci.current,minZoom:3,maxZoom:20,renderWorldCopies:!0,maxTileCacheSize:500,children:[Bi&&$n&&$n.length>1&&O.jsx(b_,{id:"alternate-route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:$n.map(vt=>[vt[1],vt[0]])}},children:O.jsx(v_,{...or})}),Bi&&ri&&ri.length>1&&O.jsx(b_,{id:"route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:ri.map(vt=>[vt[1],vt[0]])}},children:O.jsx(v_,{...uu})}),Ee==="search"&&Jn.map(vt=>{const tn=C_(vt);return O.jsx(jf,{longitude:vt.lon,latitude:vt.lat,anchor:"center",style:{willChange:"transform"},onClick:xn=>{xn.originalEvent.stopPropagation(),tn&&R.current?.flyTo({center:[vt.lon,vt.lat],zoom:Zn.zoom+2})},children:tn?O.jsx(Ay,{count:vt.count,minPrice:vt.minPrice,maxPrice:vt.maxPrice,currency:vt.currency,type:"open"}):O.jsx(k_,{price:vt.price,currency:vt.currency,emoji:""})},`open-${vt.id}`)}),(Bi||oe)&&(Qn||qt.length>0)&&O.jsx(O.Fragment,{children:(oe?qt.length>0?qt:Qn||[]:Qn||[]).map((vt,tn)=>O.jsx(jf,{longitude:vt.lon,latitude:vt.lat,anchor:"center",onClick:xn=>{xn.originalEvent?.preventDefault(),xn.originalEvent?.stopPropagation();const on=vt.id;fe(at===on?null:on),xt(vt.name||`Stop ${tn+1}`)},className:"cursor-pointer",style:{zIndex:at===vt.id?200:100},children:O.jsxs("div",{className:"relative flex flex-col items-center",children:[oe&&O.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[200]",onClick:xn=>xn.stopPropagation(),children:de===vt.id?O.jsxs(O.Fragment,{children:[O.jsx("input",{type:"text",value:Ue,onChange:xn=>xt(xn.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:xn=>xn.currentTarget.select(),onKeyDown:xn=>{if(xn.key==="Enter"){const on=vt.id;on&&Ot(pn=>pn.map(ft=>ft.id===on?{...ft,name:Ue}:ft)),Me(null)}}}),O.jsx("button",{onClick:()=>{const xn=vt.id;xn&&Ot(on=>on.map(pn=>pn.id===xn?{...pn,name:Ue}:pn)),Me(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:O.jsx(Xf,{size:12,strokeWidth:3})}),O.jsx("button",{onClick:()=>Me(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:O.jsx(Il,{size:12})})]}):O.jsxs(O.Fragment,{children:[O.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:vt.name||`Stop ${tn+1}`}),O.jsx("button",{onClick:()=>{xt(vt.name||`Stop ${tn+1}`),Me(vt.id)},className:"p-1 rounded-lg transition-colors",children:O.jsx($f,{size:12})}),O.jsx("button",{onClick:()=>{const xn=vt.id;xn&&Ot(on=>on.filter(pn=>pn.id!==xn))},className:"p-1 rounded-lg transition-colors",children:O.jsx(h_,{size:12})})]})}),O.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",style:{zIndex:10},children:tn+1})]})},`wp-${vt.id||tn}`))}),oe&&ge.map((vt,tn)=>{const xn=qt.length+tn+1;return O.jsx(jf,{longitude:vt.lon,latitude:vt.lat,anchor:"center",onClick:on=>{on.originalEvent?.preventDefault(),on.originalEvent?.stopPropagation(),fe(at===vt.id?null:vt.id),xt(vt.name)},className:"cursor-pointer",style:{zIndex:at===vt.id?2e3:1e3},children:O.jsxs("div",{className:"relative flex flex-col items-center",children:[O.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[2000]",onClick:on=>on.stopPropagation(),children:de===vt.id?O.jsxs(O.Fragment,{children:[O.jsx("input",{type:"text",value:Ue,onChange:on=>xt(on.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:on=>on.currentTarget.select(),onKeyDown:on=>{on.key==="Enter"&&(Zt(vt.id,Ue),Me(null))}}),O.jsx("button",{onClick:()=>{Zt(vt.id,Ue),Me(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:O.jsx(Xf,{size:12,strokeWidth:3})}),O.jsx("button",{onClick:()=>Me(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:O.jsx(Il,{size:12})})]}):O.jsxs(O.Fragment,{children:[O.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:vt.name}),O.jsx("button",{onClick:()=>{xt(vt.name),Me(vt.id)},className:"p-1 rounded-lg transition-colors",children:O.jsx($f,{size:12})}),O.jsx("button",{onClick:()=>xi(vt.id),className:"p-1 rounded-lg transition-colors",children:O.jsx(h_,{size:12})})]})}),O.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",children:xn})]})},vt.id)}),"     ",fa.map(vt=>{const tn=C_(vt);return O.jsx(jf,{longitude:vt.lon,latitude:vt.lat,anchor:"center",style:{willChange:"transform"},onClick:xn=>{xn.originalEvent.stopPropagation(),tn&&R.current?.flyTo({center:[vt.lon,vt.lat],zoom:Zn.zoom+2})},children:tn?O.jsx(Ay,{count:vt.count,minPrice:vt.minPrice,maxPrice:vt.maxPrice,currency:vt.currency,type:"history"}):O.jsx(k_,{price:vt.price,currency:vt.currency,emoji:"",isHistory:!0})},`history-${vt.id}`)}),Ee==="parked"&&Rt&&O.jsx(jf,{longitude:Rt[1],latitude:Rt[0],anchor:"center",children:O.jsx(x2,{vehicleType:Je})}),Se&&(Se.listingLocation||Rt)&&O.jsx(jf,{longitude:(Se.listingLocation||Rt)[1],latitude:(Se.listingLocation||Rt)[0],anchor:"bottom",onClick:vt=>{vt.originalEvent.stopPropagation(),mt(!0)},style:{zIndex:20},children:O.jsxs("div",{className:"flex flex-col items-center -translate-y-8",children:[O.jsx("div",{className:"bg-white dark:bg-zinc-800 p-3 rounded-full shadow-xl border-2 border-[#007AFF] cursor-pointer hover:scale-110 transition-transform",children:O.jsx(VA,{size:20,className:"text-[#007AFF]"})}),O.jsx("div",{className:"w-0.5 h-3 bg-[#007AFF]/50"})]})}),st&&Se&&O.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in",onClick:()=>mt(!1),children:O.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] w-full max-w-sm rounded-[2rem] shadow-2xl p-6 space-y-6 relative border border-black/5 dark:border-white/10",onClick:vt=>vt.stopPropagation(),children:[O.jsx("button",{onClick:()=>mt(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:O.jsx(Il,{size:24})}),O.jsxs("div",{className:"text-center space-y-1",children:[O.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:"Active Session"}),O.jsx("h2",{className:"text-2xl font-bold dark:text-white leading-tight",children:Se.listingName||"Parking Spot"}),O.jsx("div",{className:"text-lg text-blue-500 font-bold",children:Se.shortName||`#${Se.spotNumber}`})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("div",{className:"p-6 bg-zinc-50 dark:bg-white/5 rounded-3xl flex justify-center border border-black/5 dark:border-white/5",children:O.jsx(px,{value:JSON.stringify({a:Se.spotATag,authorizer:Se.authorizer}),size:180,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-black dark:text-white"})}),O.jsxs("div",{onClick:()=>{navigator.clipboard.writeText(Se.dTag||""),alert("Copied parking ID")},className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl cursor-pointer hover:bg-zinc-100 dark:hover:bg-white/10 transition-colors",children:[O.jsxs("div",{className:"overflow-hidden",children:[O.jsx("div",{className:"text-xs font-bold text-zinc-400 uppercase mb-1",children:"Parking ID"}),O.jsx("div",{className:"text-sm font-mono text-zinc-600 dark:text-white/70 truncate",children:Se.dTag||"N/A"})]}),O.jsx("div",{className:"p-2 bg-blue-500/10 rounded-full text-blue-500",children:O.jsx(hx,{size:20})})]})]}),O.jsx("button",{onClick:()=>mt(!1),className:"w-full py-4 bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white font-bold rounded-2xl",children:"Close"})]})}),h&&he!=="auto"&&O.jsx(jf,{longitude:h[1],latitude:h[0],anchor:"center",style:{zIndex:1e3},children:O.jsx(Ty,{bearing:ni,mapBearing:Zn.bearing,isNavigationMode:!1})})]}),O.jsxs("div",{className:`absolute top-4 left-1/2 -translate-x-1/2 z-[1000] flex items-center gap-2 transition-all duration-300 pointer-events-none ${Ee!=="idle"?"opacity-100":""}`,children:[Ee==="search"&&O.jsxs("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:[O.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500/30 border-t-blue-500 rounded-full"}),O.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white whitespace-nowrap",children:"Searching for spots..."})]}),Ee==="parked"&&O.jsxs("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:[O.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 shadow-md"}),O.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"Session Active"})]}),Ee==="idle"&&!Xe&&!oe&&O.jsxs("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:[O.jsxs("button",{onClick:()=>Oe(!0),className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[O.jsx("div",{className:"w-4 h-4 rounded-full bg-gradient-to-tr from-blue-500 to-cyan-500 shadow-sm"}),O.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white whitespace-nowrap",children:"Create Route"})]}),O.jsx("div",{className:"w-px h-4 bg-zinc-200 dark:bg-white/10"}),O.jsx("button",{onClick:()=>It(!0),className:"text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/80 transition-colors active:scale-95",children:O.jsx(Il,{size:14})})]})]}),Ee==="idle"&&Xe&&!oe&&O.jsx("div",{className:"absolute top-4 right-4 z-[1000] animate-in fade-in zoom-in slide-in-from-left-4 duration-300 pointer-events-auto",children:O.jsx("button",{onClick:()=>Oe(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:O.jsx(qv,{size:20})})}),oe&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1600]",children:O.jsxs("div",{className:"relative flex items-center justify-center",children:[O.jsx("div",{className:"absolute w-8 h-8 rounded-full bg-blue-500/10 dark:bg-blue-400/10 animate-pulse"}),O.jsx("div",{className:"w-1.5 h-1.5 bg-[#007AFF] rounded-full shadow-sm z-10"}),O.jsx("div",{className:"absolute w-6 h-[1.5px] bg-[#007AFF]/60 rounded-full"}),O.jsx("div",{className:"absolute h-6 w-[1.5px] bg-[#007AFF]/60 rounded-full"})]})}),O.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-12 z-[1500]",children:O.jsxs("button",{onClick:Fi,className:"bg-white dark:bg-zinc-800 text-[#007AFF] px-6 py-2.5 rounded-full font-bold text-sm shadow-xl backdrop-blur-md active:scale-95 transition-all flex items-center gap-2 border border-black/5 dark:border-white/10",children:[O.jsx(Oh,{size:16,className:"fill-current"}),"Drop Pin Here"]})}),O.jsx("div",{className:"absolute top-4 right-4 z-[2000] animate-in slide-in-from-top-4 fade-in",children:O.jsxs("button",{onClick:bn,className:"bg-[#007AFF] text-white px-6 py-2.5 rounded-full font-bold shadow-lg flex items-center gap-2 transition-transform active:scale-95 active:bg-[#007AFF]",children:[O.jsx(Xf,{size:18,strokeWidth:3}),"Done"]})})]})]}),O.jsxs("div",{className:`absolute z-[1000] flex flex-col items-start gap-3 animate-in slide-in-from-left-6 transition-opacity duration-300 ${oe?"opacity-0 pointer-events-none":"opacity-100"}`,style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[O.jsx(_2,{vehicleType:Je,onVehicleChange:Ai,disabled:Ee!=="idle"}),O.jsx("button",{onClick:()=>c?.(),onContextMenu:vt=>{vt.preventDefault();const tn=prompt("Enter Parking Code manually:");tn&&Nt(tn)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95",title:"Scan QR Code (Long press for manual)",children:O.jsx("div",{className:"relative",children:O.jsx($A,{size:20})})}),O.jsx("button",{onClick:()=>tt(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95",title:"Listed Parking",children:O.jsx("span",{className:"text-3xl font-light leading-none pb-1",children:""})})]}),O.jsxs("div",{className:"absolute z-[1000] flex flex-col items-end gap-3 animate-in slide-in-from-right-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[Math.abs(Zn.bearing)>5&&he!=="auto"&&O.jsx("button",{onClick:()=>{const vt=R.current?.getBearing()||0,tn=Math.round(vt/360)*360;R.current?.rotateTo(tn,{duration:400}),Yi(xn=>({...xn,pitch:0}))},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10",title:"Reset to true north",children:O.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-Zn.bearing}deg)`},children:[O.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid rgb(239 68 68)"}}),O.jsx("span",{className:"text-sm font-bold text-zinc-600 dark:text-white/70",style:{marginTop:"-2px"},children:"N"})]})}),O.jsx("button",{onClick:async()=>{if(Rr){await dr();return}if(oe){h&&R.current?.flyTo({center:[h[1],h[0]],zoom:17,duration:800,essential:!0});return}R.current?.stop(),ci.current=!1;const vt=Zn.zoom,tn=17;if(Bt){if(h){const xn=vt<tn?tn:vt;ci.current=!0,R.current?.flyTo({center:[h[1],h[0]],zoom:xn,duration:800,essential:!0}),R.current?.once("moveend",()=>{ci.current=!1})}ke("recentre"),Mn(!1);return}if((he==="fixed"||he==="recentre")&&h&&(ci.current=!0,R.current?.flyTo({center:[h[1],h[0]],zoom:vt<tn?tn:vt,bearing:Math.round((R.current?.getBearing()||0)/360)*360,duration:800,essential:!0}),R.current?.once("moveend",()=>{ci.current=!1,he==="fixed"&&ke("recentre")})),he==="recentre"){if(Ee==="parked"){ci.current=!0,R.current?.flyTo({bearing:Math.round((R.current?.getBearing()||0)/360)*360,pitch:0,zoom:16.5,duration:800,essential:!0}),R.current?.once("moveend",()=>{ci.current=!1}),ke("fixed");return}const xn=ni||0;ci.current=!0,Qe(!0),R.current?.rotateTo(xn,{duration:800}),R.current?.once("moveend",()=>{ci.current=!1,Qe(!1),$.current.reset(xn),ke("auto")});return}ke(xn=>{if(xn==="auto"){const on=R.current?.getBearing()||0,pn=Math.round(on/360)*360;return ci.current=!0,R.current?.flyTo({bearing:pn,pitch:0,zoom:16.5,duration:800,essential:!0}),R.current?.once("moveend",()=>{ci.current=!1}),Qe(!1),"fixed"}return"recentre"})},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg ${Rr?"bg-orange-500/20 border-orange-500/50 text-orange-500 animate-pulse":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:Rr?O.jsx(zg,{size:20,className:"text-orange-500 animate-pulse"}):oe?O.jsx(zg,{size:20,className:"text-zinc-600 dark:text-white/70"}):he==="auto"||nt?O.jsx(pA,{size:20,className:"text-blue-500"}):he==="recentre"?O.jsx(zg,{size:20,fill:"currentColor",className:"text-green-500"}):O.jsx(zg,{size:20,className:`text-zinc-600 dark:text-white/70 ${Bt?"opacity-50":""}`})}),!oe&&O.jsx("div",{className:"relative z-[1010]",children:O.jsx(JC,{setHistorySpots:gt,onHelpClick:()=>Ut(!0)})}),!oe&&O.jsx(KC,{status:Ee,setStatus:ye,searchLocation:h,vehicleType:Je,setOpenSpots:Pe,parkLocation:Rt,setParkLocation:Ie,sessionStart:Yt,setSessionStart:fn,listedParkingSession:Se,onQRScan:()=>c?.()})]}),O.jsx("div",{className:oe?"hidden":"block",children:O.jsx(t4,{vehicleType:Je,onRouteChange:yi,currentLocation:h,onDropPinModeChange:ue,pendingWaypoints:$e,onDropPinConsumed:()=>bt(null),onOpenChange:yt,onWaypointsChange:Ot,onRequestOrientationPermission:dr,isOpen:Xt,onClose:()=>Oe(!1),hideTrigger:!0,onRouteCreated:()=>It(!0)})}),dt&&O.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[O.jsx("button",{onClick:()=>Ut(!1),className:"absolute inset-0 z-0 cursor-default"}),O.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",style:{overscrollBehaviorY:"contain"},children:[O.jsx("button",{onClick:()=>Ut(!1),className:"absolute top-6 left-6 p-2 rounded-full transition-colors text-black/60 dark:text-white/60 hover:bg-black/10 dark:hover:bg-white/20",children:O.jsx(Vv,{size:20})}),O.jsxs("div",{className:"text-center space-y-2 pt-4",children:[O.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:O.jsx("span",{className:"text-3xl font-bold",children:"?"})}),O.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"}),O.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Decentralized Route & Parking Management"})]}),O.jsxs("div",{className:"space-y-3",children:[O.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),O.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[O.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[O.jsx("span",{children:"Using Browser Menu (Android)"}),O.jsx(kd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),O.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[O.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),O.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[O.jsx("li",{children:"Tap menu button (three dots)"}),O.jsxs("li",{children:["Tap ",O.jsx("strong",{children:"Add to Home screen"})]}),O.jsxs("li",{children:["Tap ",O.jsx("strong",{children:"Add"})," to confirm"]})]}),O.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),O.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[O.jsx("li",{children:"Tap menu button (three dots)"}),O.jsxs("li",{children:["Tap ",O.jsx("strong",{children:"Install"})]})]})]})]}),O.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[O.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[O.jsx("span",{children:"Using Share Button (iOS)"}),O.jsx(kd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),O.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:O.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[O.jsxs("li",{children:["Tap the ",O.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),O.jsxs("li",{children:["Scroll down and tap ",O.jsx("strong",{children:"Add to Home Screen"}),"."]}),O.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),O.jsxs("div",{className:"space-y-6 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. If the system generated route(s) between your start and end points are not to your liking, add additional waypoints in locations you would prefer travelling through. Click the location button to re-centre and turn on follow-me or navigation mode for route tracking."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking"}),"Click the main button once to see open spots in listed parking spaces and open spots reported by others live or within the last 5 minutes. For standard parking: Click again to mark your location. When leaving, click once more to end the session, log the fee and report the spot. For listed parking: Click the QR code scanner button below the vehicle type selector. Scan the QR code at the parking location to start the session. When leaving, scan it again to end the session and log the fee. Use the profile button to see your parking history."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Create and manage a listed parking (optional)"}),"Users who oversee one or more parking spots can create a listed parking to simplify spot and lot management. Click the parking services button () at the bottom left-hand corner of the screen, and click the '+' button to create a listing. Provide the relevant details requested in the form to create an online listing that matches your real-world space. Listed parkings can be public (open to all users) or private (open to select users and only publish to select relays). Once created you can see your listings as viewed by other users in the public or private listing page. You should use the my listing page to manage your listing(s). Larger listings may take longer to create. You may manually refresh the page using the button provided next to the search bar if automatic updates are not returned fast enough."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Create your own mirror (optional)"}),O.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 dark:text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"6. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys, only accessible by you and stored on relays of your preference. Open spot broadcasts and listed parking log updates use temporary identifiers to prevent your permanent public key from being shared."]}),O.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20 mt-6",children:O.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[O.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent personal IP address(es) from being associated with your data."]})})]})]})]}),O.jsx("div",{style:{display:wt&&!gi?"block":"none"},children:wt&&O.jsx(w4,{onClose:()=>tt(!1),currentLocation:h,countryCode:Bn,onPickLocation:()=>Yn(!0),pickedLocation:nn})}),gi&&O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1500]",children:O.jsxs("div",{className:"relative",children:[O.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-4 bg-black/50"}),O.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-1 bg-black/50"}),O.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 rounded-full flex items-center justify-center bg-white/20 backdrop-blur-sm shadow-xl animate-in zoom-in spin-in-180 duration-500",children:O.jsx(Oh,{size:16,className:"text-purple-600 fill-current"})})]})}),O.jsxs("div",{className:"absolute bottom-10 left-0 right-0 z-[2000] flex justify-center gap-4 px-4 pb-safe animate-in slide-in-from-bottom",children:[O.jsx("button",{onClick:()=>Yn(!1),className:"px-6 py-3 rounded-full bg-white text-zinc-900 font-bold shadow-lg",children:"Cancel"}),O.jsx("button",{onClick:()=>{Jt({lat:Zn.latitude,lon:Zn.longitude}),Yn(!1)},className:"px-6 py-3 rounded-full bg-purple-600 text-white font-bold shadow-lg shadow-purple-500/30",children:"Confirm Location"})]})]}),cn&&O.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:O.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[O.jsxs("div",{className:"text-center space-y-1",children:[O.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),O.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee"})]}),O.jsxs("div",{className:"flex items-center gap-4",children:[O.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[O.jsx("span",{className:"text-2xl font-bold text-blue-500",children:"$"}),O.jsx("input",{type:"number",value:kn,onChange:vt=>Fn(vt.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),O.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:"USD"})]}),O.jsxs("div",{className:"flex flex-col gap-1.5",children:[O.jsx("button",{onClick:()=>Fn(String(Math.max(0,parseFloat(kn||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:O.jsx(x1,{size:22,className:"text-zinc-600 dark:text-white/70"})}),O.jsx("button",{onClick:()=>Fn(String(Math.max(0,parseFloat(kn||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:O.jsx(kd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),O.jsxs("div",{className:"w-full space-y-3",children:[O.jsxs("button",{onClick:$t,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",O.jsx(Gv,{size:20})]}),O.jsx("button",{onClick:()=>{Ke(!1),_n(null),Fn("0")},className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};var qn;(function(c){c[c.QR_CODE=0]="QR_CODE",c[c.AZTEC=1]="AZTEC",c[c.CODABAR=2]="CODABAR",c[c.CODE_39=3]="CODE_39",c[c.CODE_93=4]="CODE_93",c[c.CODE_128=5]="CODE_128",c[c.DATA_MATRIX=6]="DATA_MATRIX",c[c.MAXICODE=7]="MAXICODE",c[c.ITF=8]="ITF",c[c.EAN_13=9]="EAN_13",c[c.EAN_8=10]="EAN_8",c[c.PDF_417=11]="PDF_417",c[c.RSS_14=12]="RSS_14",c[c.RSS_EXPANDED=13]="RSS_EXPANDED",c[c.UPC_A=14]="UPC_A",c[c.UPC_E=15]="UPC_E",c[c.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(qn||(qn={}));var P_=new Map([[qn.QR_CODE,"QR_CODE"],[qn.AZTEC,"AZTEC"],[qn.CODABAR,"CODABAR"],[qn.CODE_39,"CODE_39"],[qn.CODE_93,"CODE_93"],[qn.CODE_128,"CODE_128"],[qn.DATA_MATRIX,"DATA_MATRIX"],[qn.MAXICODE,"MAXICODE"],[qn.ITF,"ITF"],[qn.EAN_13,"EAN_13"],[qn.EAN_8,"EAN_8"],[qn.PDF_417,"PDF_417"],[qn.RSS_14,"RSS_14"],[qn.RSS_EXPANDED,"RSS_EXPANDED"],[qn.UPC_A,"UPC_A"],[qn.UPC_E,"UPC_E"],[qn.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),O_;(function(c){c[c.UNKNOWN=0]="UNKNOWN",c[c.URL=1]="URL"})(O_||(O_={}));function C4(c){return Object.values(qn).includes(c)}var e1;(function(c){c[c.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",c[c.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(e1||(e1={}));var I4=(function(){function c(){}return c.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",c.SCAN_DEFAULT_FPS=2,c.DEFAULT_DISABLE_FLIP=!1,c.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,c.DEFAULT_SUPPORTED_SCAN_TYPE=[e1.SCAN_TYPE_CAMERA,e1.SCAN_TYPE_FILE],c})(),b2=(function(){function c(f,y){this.format=f,this.formatName=y}return c.prototype.toString=function(){return this.formatName},c.create=function(f){if(!P_.has(f))throw"".concat(f," not in html5QrcodeSupportedFormatsTextMap");return new c(f,P_.get(f))},c})(),z_=(function(){function c(){}return c.createFromText=function(f){var y={text:f};return{decodedText:f,result:y}},c.createFromQrcodeResult=function(f){return{decodedText:f.text,result:f}},c})(),Cy;(function(c){c[c.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",c[c.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",c[c.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Cy||(Cy={}));var M4=(function(){function c(){}return c.createFrom=function(f){return{errorMessage:f,type:Cy.UNKWOWN_ERROR}},c})(),R4=(function(){function c(f){this.verbose=f}return c.prototype.log=function(f){this.verbose&&console.log(f)},c.prototype.warn=function(f){this.verbose&&console.warn(f)},c.prototype.logError=function(f,y){(this.verbose||y===!0)&&console.error(f)},c.prototype.logErrors=function(f){if(f.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(f)},c})();function Rh(c){return typeof c>"u"||c===null}var l0=(function(){function c(){}return c.codeParseError=function(f){return"QR code parse error, error = ".concat(f)},c.errorGettingUserMedia=function(f){return"Error getting userMedia, error = ".concat(f)},c.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},c.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},c.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},c.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},c.scannerPaused=function(){return"Scanner paused"},c})(),v2=(function(){function c(){}return c.isMediaStreamConstraintsValid=function(f,y){if(typeof f!="object"){var C=typeof f;return y.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(C,"."),!0),!1}for(var N=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],k=new Set(N),R=Object.keys(f),h=0,V=R;h<V.length;h++){var H=V[h];if(k.has(H))return y.logError("".concat(H," is not supported videoConstaints."),!0),!1}return!0},c})(),Em={exports:{}},D4=Em.exports,L_;function N4(){return L_||(L_=1,(function(c,f){(function(y,C){C(f)})(D4,(function(y){function C(le){return le==null}var N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(le,a){le.__proto__=a}||function(le,a){for(var u in a)a.hasOwnProperty(u)&&(le[u]=a[u])};function k(le,a){N(le,a);function u(){this.constructor=le}le.prototype=a===null?Object.create(a):(u.prototype=a.prototype,new u)}function R(le,a){var u=Object.setPrototypeOf;u?u(le,a):le.__proto__=a}function h(le,a){a===void 0&&(a=le.constructor);var u=Error.captureStackTrace;u&&u(le,a)}var V=(function(le){k(a,le);function a(u){var m=this.constructor,v=le.call(this,u)||this;return Object.defineProperty(v,"name",{value:m.name,enumerable:!1}),R(v,m.prototype),h(v),v}return a})(Error);class H extends V{constructor(a=void 0){super(a),this.message=a}getKind(){return this.constructor.kind}}H.kind="Exception";class $ extends H{}$.kind="ArgumentException";class K extends H{}K.kind="IllegalArgumentException";class be{constructor(a){if(this.binarizer=a,a===null)throw new K("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(a,u){return this.binarizer.getBlackRow(a,u)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(a,u,m,v){const w=this.binarizer.getLuminanceSource().crop(a,u,m,v);return new be(this.binarizer.createBinarizer(w))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const a=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new be(this.binarizer.createBinarizer(a))}rotateCounterClockwise45(){const a=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new be(this.binarizer.createBinarizer(a))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class Ce extends H{static getChecksumInstance(){return new Ce}}Ce.kind="ChecksumException";class Ee{constructor(a){this.source=a}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class ye{static arraycopy(a,u,m,v,w){for(;w--;)m[v++]=a[u++]}static currentTimeMillis(){return Date.now()}}class he extends H{}he.kind="IndexOutOfBoundsException";class ke extends he{constructor(a=void 0,u=void 0){super(u),this.index=a,this.message=u}}ke.kind="ArrayIndexOutOfBoundsException";class nt{static fill(a,u){for(let m=0,v=a.length;m<v;m++)a[m]=u}static fillWithin(a,u,m,v){nt.rangeCheck(a.length,u,m);for(let w=u;w<m;w++)a[w]=v}static rangeCheck(a,u,m){if(u>m)throw new K("fromIndex("+u+") > toIndex("+m+")");if(u<0)throw new ke(u);if(m>a)throw new ke(m)}static asList(...a){return a}static create(a,u,m){return Array.from({length:a}).map(w=>Array.from({length:u}).fill(m))}static createInt32Array(a,u,m){return Array.from({length:a}).map(w=>Int32Array.from({length:u}).fill(m))}static equals(a,u){if(!a||!u||!a.length||!u.length||a.length!==u.length)return!1;for(let m=0,v=a.length;m<v;m++)if(a[m]!==u[m])return!1;return!0}static hashCode(a){if(a===null)return 0;let u=1;for(const m of a)u=31*u+m;return u}static fillUint8Array(a,u){for(let m=0;m!==a.length;m++)a[m]=u}static copyOf(a,u){return a.slice(0,u)}static copyOfUint8Array(a,u){if(a.length<=u){const m=new Uint8Array(u);return m.set(a),m}return a.slice(0,u)}static copyOfRange(a,u,m){const v=m-u,w=new Int32Array(v);return ye.arraycopy(a,u,w,0,v),w}static binarySearch(a,u,m){m===void 0&&(m=nt.numberComparator);let v=0,w=a.length-1;for(;v<=w;){const I=w+v>>1,P=m(u,a[I]);if(P>0)v=I+1;else if(P<0)w=I-1;else return I}return-v-1}static numberComparator(a,u){return a-u}}class Qe{static numberOfTrailingZeros(a){let u;if(a===0)return 32;let m=31;return u=a<<16,u!==0&&(m-=16,a=u),u=a<<8,u!==0&&(m-=8,a=u),u=a<<4,u!==0&&(m-=4,a=u),u=a<<2,u!==0&&(m-=2,a=u),m-(a<<1>>>31)}static numberOfLeadingZeros(a){if(a===0)return 32;let u=1;return a>>>16||(u+=16,a<<=16),a>>>24||(u+=8,a<<=8),a>>>28||(u+=4,a<<=4),a>>>30||(u+=2,a<<=2),u-=a>>>31,u}static toHexString(a){return a.toString(16)}static toBinaryString(a){return String(parseInt(String(a),2))}static bitCount(a){return a=a-(a>>>1&1431655765),a=(a&858993459)+(a>>>2&858993459),a=a+(a>>>4)&252645135,a=a+(a>>>8),a=a+(a>>>16),a&63}static truncDivision(a,u){return Math.trunc(a/u)}static parseInt(a,u=void 0){return parseInt(a,u)}}Qe.MIN_VALUE_32_BITS=-2147483648,Qe.MAX_VALUE=Number.MAX_SAFE_INTEGER;class dt{constructor(a,u){a===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=a,u==null?this.bits=dt.makeArray(a):this.bits=u)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(a){if(a>this.bits.length*32){const u=dt.makeArray(a);ye.arraycopy(this.bits,0,u,0,this.bits.length),this.bits=u}}get(a){return(this.bits[Math.floor(a/32)]&1<<(a&31))!==0}set(a){this.bits[Math.floor(a/32)]|=1<<(a&31)}flip(a){this.bits[Math.floor(a/32)]^=1<<(a&31)}getNextSet(a){const u=this.size;if(a>=u)return u;const m=this.bits;let v=Math.floor(a/32),w=m[v];w&=~((1<<(a&31))-1);const I=m.length;for(;w===0;){if(++v===I)return u;w=m[v]}const P=v*32+Qe.numberOfTrailingZeros(w);return P>u?u:P}getNextUnset(a){const u=this.size;if(a>=u)return u;const m=this.bits;let v=Math.floor(a/32),w=~m[v];w&=~((1<<(a&31))-1);const I=m.length;for(;w===0;){if(++v===I)return u;w=~m[v]}const P=v*32+Qe.numberOfTrailingZeros(w);return P>u?u:P}setBulk(a,u){this.bits[Math.floor(a/32)]=u}setRange(a,u){if(u<a||a<0||u>this.size)throw new K;if(u===a)return;u--;const m=Math.floor(a/32),v=Math.floor(u/32),w=this.bits;for(let I=m;I<=v;I++){const P=I>m?0:a&31,q=(2<<(I<v?31:u&31))-(1<<P);w[I]|=q}}clear(){const a=this.bits.length,u=this.bits;for(let m=0;m<a;m++)u[m]=0}isRange(a,u,m){if(u<a||a<0||u>this.size)throw new K;if(u===a)return!0;u--;const v=Math.floor(a/32),w=Math.floor(u/32),I=this.bits;for(let P=v;P<=w;P++){const F=P>v?0:a&31,te=(2<<(P<w?31:u&31))-(1<<F)&4294967295;if((I[P]&te)!==(m?te:0))return!1}return!0}appendBit(a){this.ensureCapacity(this.size+1),a&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(a,u){if(u<0||u>32)throw new K("Num bits must be between 0 and 32");this.ensureCapacity(this.size+u);for(let m=u;m>0;m--)this.appendBit((a>>m-1&1)===1)}appendBitArray(a){const u=a.size;this.ensureCapacity(this.size+u);for(let m=0;m<u;m++)this.appendBit(a.get(m))}xor(a){if(this.size!==a.size)throw new K("Sizes don't match");const u=this.bits;for(let m=0,v=u.length;m<v;m++)u[m]^=a.bits[m]}toBytes(a,u,m,v){for(let w=0;w<v;w++){let I=0;for(let P=0;P<8;P++)this.get(a)&&(I|=1<<7-P),a++;u[m+w]=I}}getBitArray(){return this.bits}reverse(){const a=new Int32Array(this.bits.length),u=Math.floor((this.size-1)/32),m=u+1,v=this.bits;for(let w=0;w<m;w++){let I=v[w];I=I>>1&1431655765|(I&1431655765)<<1,I=I>>2&858993459|(I&858993459)<<2,I=I>>4&252645135|(I&252645135)<<4,I=I>>8&16711935|(I&16711935)<<8,I=I>>16&65535|(I&65535)<<16,a[u-w]=I}if(this.size!==m*32){const w=m*32-this.size;let I=a[0]>>>w;for(let P=1;P<m;P++){const F=a[P];I|=F<<32-w,a[P-1]=I,I=F>>>w}a[m-1]=I}this.bits=a}static makeArray(a){return new Int32Array(Math.floor((a+31)/32))}equals(a){if(!(a instanceof dt))return!1;const u=a;return this.size===u.size&&nt.equals(this.bits,u.bits)}hashCode(){return 31*this.size+nt.hashCode(this.bits)}toString(){let a="";for(let u=0,m=this.size;u<m;u++)(u&7)===0&&(a+=" "),a+=this.get(u)?"X":".";return a}clone(){return new dt(this.size,this.bits.slice())}}var Ut;(function(le){le[le.OTHER=0]="OTHER",le[le.PURE_BARCODE=1]="PURE_BARCODE",le[le.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",le[le.TRY_HARDER=3]="TRY_HARDER",le[le.CHARACTER_SET=4]="CHARACTER_SET",le[le.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",le[le.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",le[le.ASSUME_GS1=7]="ASSUME_GS1",le[le.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",le[le.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",le[le.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(Ut||(Ut={}));var wt=Ut;class tt extends H{static getFormatInstance(){return new tt}}tt.kind="FormatException";var Je;(function(le){le[le.Cp437=0]="Cp437",le[le.ISO8859_1=1]="ISO8859_1",le[le.ISO8859_2=2]="ISO8859_2",le[le.ISO8859_3=3]="ISO8859_3",le[le.ISO8859_4=4]="ISO8859_4",le[le.ISO8859_5=5]="ISO8859_5",le[le.ISO8859_6=6]="ISO8859_6",le[le.ISO8859_7=7]="ISO8859_7",le[le.ISO8859_8=8]="ISO8859_8",le[le.ISO8859_9=9]="ISO8859_9",le[le.ISO8859_10=10]="ISO8859_10",le[le.ISO8859_11=11]="ISO8859_11",le[le.ISO8859_13=12]="ISO8859_13",le[le.ISO8859_14=13]="ISO8859_14",le[le.ISO8859_15=14]="ISO8859_15",le[le.ISO8859_16=15]="ISO8859_16",le[le.SJIS=16]="SJIS",le[le.Cp1250=17]="Cp1250",le[le.Cp1251=18]="Cp1251",le[le.Cp1252=19]="Cp1252",le[le.Cp1256=20]="Cp1256",le[le.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",le[le.UTF8=22]="UTF8",le[le.ASCII=23]="ASCII",le[le.Big5=24]="Big5",le[le.GB18030=25]="GB18030",le[le.EUC_KR=26]="EUC_KR"})(Je||(Je={}));class He{constructor(a,u,m,...v){this.valueIdentifier=a,this.name=m,typeof u=="number"?this.values=Int32Array.from([u]):this.values=u,this.otherEncodingNames=v,He.VALUE_IDENTIFIER_TO_ECI.set(a,this),He.NAME_TO_ECI.set(m,this);const w=this.values;for(let I=0,P=w.length;I!==P;I++){const F=w[I];He.VALUES_TO_ECI.set(F,this)}for(const I of v)He.NAME_TO_ECI.set(I,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(a){if(a<0||a>=900)throw new tt("incorect value");const u=He.VALUES_TO_ECI.get(a);if(u===void 0)throw new tt("incorect value");return u}static getCharacterSetECIByName(a){const u=He.NAME_TO_ECI.get(a);if(u===void 0)throw new tt("incorect value");return u}equals(a){if(!(a instanceof He))return!1;const u=a;return this.getName()===u.getName()}}He.VALUE_IDENTIFIER_TO_ECI=new Map,He.VALUES_TO_ECI=new Map,He.NAME_TO_ECI=new Map,He.Cp437=new He(Je.Cp437,Int32Array.from([0,2]),"Cp437"),He.ISO8859_1=new He(Je.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),He.ISO8859_2=new He(Je.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),He.ISO8859_3=new He(Je.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),He.ISO8859_4=new He(Je.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),He.ISO8859_5=new He(Je.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),He.ISO8859_6=new He(Je.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),He.ISO8859_7=new He(Je.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),He.ISO8859_8=new He(Je.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),He.ISO8859_9=new He(Je.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),He.ISO8859_10=new He(Je.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),He.ISO8859_11=new He(Je.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),He.ISO8859_13=new He(Je.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),He.ISO8859_14=new He(Je.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),He.ISO8859_15=new He(Je.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),He.ISO8859_16=new He(Je.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),He.SJIS=new He(Je.SJIS,20,"SJIS","Shift_JIS"),He.Cp1250=new He(Je.Cp1250,21,"Cp1250","windows-1250"),He.Cp1251=new He(Je.Cp1251,22,"Cp1251","windows-1251"),He.Cp1252=new He(Je.Cp1252,23,"Cp1252","windows-1252"),He.Cp1256=new He(Je.Cp1256,24,"Cp1256","windows-1256"),He.UnicodeBigUnmarked=new He(Je.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),He.UTF8=new He(Je.UTF8,26,"UTF8","UTF-8"),He.ASCII=new He(Je.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),He.Big5=new He(Je.Big5,28,"Big5"),He.GB18030=new He(Je.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),He.EUC_KR=new He(Je.EUC_KR,30,"EUC_KR","EUC-KR");class pt extends H{}pt.kind="UnsupportedOperationException";class Pe{static decode(a,u){const m=this.encodingName(u);return this.customDecoder?this.customDecoder(a,m):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(m)?this.decodeFallback(a,m):new TextDecoder(m).decode(a)}static shouldDecodeOnFallback(a){return!Pe.isBrowser()&&a==="ISO-8859-1"}static encode(a,u){const m=this.encodingName(u);return this.customEncoder?this.customEncoder(a,m):typeof TextEncoder>"u"?this.encodeFallback(a):new TextEncoder().encode(a)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(a){return typeof a=="string"?a:a.getName()}static encodingCharacterSet(a){return a instanceof He?a:He.getCharacterSetECIByName(a)}static decodeFallback(a,u){const m=this.encodingCharacterSet(u);if(Pe.isDecodeFallbackSupported(m)){let v="";for(let w=0,I=a.length;w<I;w++){let P=a[w].toString(16);P.length<2&&(P="0"+P),v+="%"+P}return decodeURIComponent(v)}if(m.equals(He.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(a.buffer));throw new pt(`Encoding ${this.encodingName(u)} not supported by fallback.`)}static isDecodeFallbackSupported(a){return a.equals(He.UTF8)||a.equals(He.ISO8859_1)||a.equals(He.ASCII)}static encodeFallback(a){const m=btoa(unescape(encodeURIComponent(a))).split(""),v=[];for(let w=0;w<m.length;w++)v.push(m[w].charCodeAt(0));return new Uint8Array(v)}}class ot{static castAsNonUtf8Char(a,u=null){const m=u?u.getName():this.ISO88591;return Pe.decode(new Uint8Array([a]),m)}static guessEncoding(a,u){if(u!=null&&u.get(wt.CHARACTER_SET)!==void 0)return u.get(wt.CHARACTER_SET).toString();const m=a.length;let v=!0,w=!0,I=!0,P=0,F=0,q=0,te=0,ce=0,xe=0,ze=0,it=0,lt=0,Tt=0,Ft=0;const vn=a.length>3&&a[0]===239&&a[1]===187&&a[2]===191;for(let yn=0;yn<m&&(v||w||I);yn++){const un=a[yn]&255;I&&(P>0?(un&128)===0?I=!1:P--:(un&128)!==0&&((un&64)===0?I=!1:(P++,(un&32)===0?F++:(P++,(un&16)===0?q++:(P++,(un&8)===0?te++:I=!1))))),v&&(un>127&&un<160?v=!1:un>159&&(un<192||un===215||un===247)&&Ft++),w&&(ce>0?un<64||un===127||un>252?w=!1:ce--:un===128||un===160||un>239?w=!1:un>160&&un<224?(xe++,it=0,ze++,ze>lt&&(lt=ze)):un>127?(ce++,ze=0,it++,it>Tt&&(Tt=it)):(ze=0,it=0))}return I&&P>0&&(I=!1),w&&ce>0&&(w=!1),I&&(vn||F+q+te>0)?ot.UTF8:w&&(ot.ASSUME_SHIFT_JIS||lt>=3||Tt>=3)?ot.SHIFT_JIS:v&&w?lt===2&&xe===2||Ft*10>=m?ot.SHIFT_JIS:ot.ISO88591:v?ot.ISO88591:w?ot.SHIFT_JIS:I?ot.UTF8:ot.PLATFORM_DEFAULT_ENCODING}static format(a,...u){let m=-1;function v(I,P,F,q,te,ce){if(I==="%%")return"%";if(u[++m]===void 0)return;I=q?parseInt(q.substr(1)):void 0;let xe=te?parseInt(te.substr(1)):void 0,ze;switch(ce){case"s":ze=u[m];break;case"c":ze=u[m][0];break;case"f":ze=parseFloat(u[m]).toFixed(I);break;case"p":ze=parseFloat(u[m]).toPrecision(I);break;case"e":ze=parseFloat(u[m]).toExponential(I);break;case"x":ze=parseInt(u[m]).toString(xe||16);break;case"d":ze=parseFloat(parseInt(u[m],xe||10).toPrecision(I)).toFixed(0);break}ze=typeof ze=="object"?JSON.stringify(ze):(+ze).toString(xe);let it=parseInt(F),lt=F&&F[0]+""=="0"?"0":" ";for(;ze.length<it;)ze=P!==void 0?ze+lt:lt+ze;return ze}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return a.replace(w,v)}static getBytes(a,u){return Pe.encode(a,u)}static getCharCode(a,u=0){return a.charCodeAt(u)}static getCharAt(a){return String.fromCharCode(a)}}ot.SHIFT_JIS=He.SJIS.getName(),ot.GB2312="GB2312",ot.ISO88591=He.ISO8859_1.getName(),ot.EUC_JP="EUC_JP",ot.UTF8=He.UTF8.getName(),ot.PLATFORM_DEFAULT_ENCODING=ot.UTF8,ot.ASSUME_SHIFT_JIS=!1;class gt{constructor(a=""){this.value=a}enableDecoding(a){return this.encoding=a,this}append(a){return typeof a=="string"?this.value+=a.toString():this.encoding?this.value+=ot.castAsNonUtf8Char(a,this.encoding):this.value+=String.fromCharCode(a),this}appendChars(a,u,m){for(let v=u;u<u+m;v++)this.append(a[v]);return this}length(){return this.value.length}charAt(a){return this.value.charAt(a)}deleteCharAt(a){this.value=this.value.substr(0,a)+this.value.substring(a+1)}setCharAt(a,u){this.value=this.value.substr(0,a)+u+this.value.substr(a+1)}substring(a,u){return this.value.substring(a,u)}setLengthToZero(){this.value=""}toString(){return this.value}insert(a,u){this.value=this.value.substr(0,a)+u+this.value.substr(a+u.length)}}class Rt{constructor(a,u,m,v){if(this.width=a,this.height=u,this.rowSize=m,this.bits=v,u==null&&(u=a),this.height=u,a<1||u<1)throw new K("Both dimensions must be greater than 0");m==null&&(m=Math.floor((a+31)/32)),this.rowSize=m,v==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(a){const u=a.length,m=a[0].length,v=new Rt(m,u);for(let w=0;w<u;w++){const I=a[w];for(let P=0;P<m;P++)I[P]&&v.set(P,w)}return v}static parseFromString(a,u,m){if(a===null)throw new K("stringRepresentation cannot be null");const v=new Array(a.length);let w=0,I=0,P=-1,F=0,q=0;for(;q<a.length;)if(a.charAt(q)===`
`||a.charAt(q)==="\r"){if(w>I){if(P===-1)P=w-I;else if(w-I!==P)throw new K("row lengths do not match");I=w,F++}q++}else if(a.substring(q,q+u.length)===u)q+=u.length,v[w]=!0,w++;else if(a.substring(q,q+m.length)===m)q+=m.length,v[w]=!1,w++;else throw new K("illegal character encountered: "+a.substring(q));if(w>I){if(P===-1)P=w-I;else if(w-I!==P)throw new K("row lengths do not match");F++}const te=new Rt(P,F);for(let ce=0;ce<w;ce++)v[ce]&&te.set(Math.floor(ce%P),Math.floor(ce/P));return te}get(a,u){const m=u*this.rowSize+Math.floor(a/32);return(this.bits[m]>>>(a&31)&1)!==0}set(a,u){const m=u*this.rowSize+Math.floor(a/32);this.bits[m]|=1<<(a&31)&4294967295}unset(a,u){const m=u*this.rowSize+Math.floor(a/32);this.bits[m]&=~(1<<(a&31)&4294967295)}flip(a,u){const m=u*this.rowSize+Math.floor(a/32);this.bits[m]^=1<<(a&31)&4294967295}xor(a){if(this.width!==a.getWidth()||this.height!==a.getHeight()||this.rowSize!==a.getRowSize())throw new K("input matrix dimensions do not match");const u=new dt(Math.floor(this.width/32)+1),m=this.rowSize,v=this.bits;for(let w=0,I=this.height;w<I;w++){const P=w*m,F=a.getRow(w,u).getBitArray();for(let q=0;q<m;q++)v[P+q]^=F[q]}}clear(){const a=this.bits,u=a.length;for(let m=0;m<u;m++)a[m]=0}setRegion(a,u,m,v){if(u<0||a<0)throw new K("Left and top must be nonnegative");if(v<1||m<1)throw new K("Height and width must be at least 1");const w=a+m,I=u+v;if(I>this.height||w>this.width)throw new K("The region must fit inside the matrix");const P=this.rowSize,F=this.bits;for(let q=u;q<I;q++){const te=q*P;for(let ce=a;ce<w;ce++)F[te+Math.floor(ce/32)]|=1<<(ce&31)&4294967295}}getRow(a,u){u==null||u.getSize()<this.width?u=new dt(this.width):u.clear();const m=this.rowSize,v=this.bits,w=a*m;for(let I=0;I<m;I++)u.setBulk(I*32,v[w+I]);return u}setRow(a,u){ye.arraycopy(u.getBitArray(),0,this.bits,a*this.rowSize,this.rowSize)}rotate180(){const a=this.getWidth(),u=this.getHeight();let m=new dt(a),v=new dt(a);for(let w=0,I=Math.floor((u+1)/2);w<I;w++)m=this.getRow(w,m),v=this.getRow(u-1-w,v),m.reverse(),v.reverse(),this.setRow(w,v),this.setRow(u-1-w,m)}getEnclosingRectangle(){const a=this.width,u=this.height,m=this.rowSize,v=this.bits;let w=a,I=u,P=-1,F=-1;for(let q=0;q<u;q++)for(let te=0;te<m;te++){const ce=v[q*m+te];if(ce!==0){if(q<I&&(I=q),q>F&&(F=q),te*32<w){let xe=0;for(;(ce<<31-xe&4294967295)===0;)xe++;te*32+xe<w&&(w=te*32+xe)}if(te*32+31>P){let xe=31;for(;!(ce>>>xe);)xe--;te*32+xe>P&&(P=te*32+xe)}}}return P<w||F<I?null:Int32Array.from([w,I,P-w+1,F-I+1])}getTopLeftOnBit(){const a=this.rowSize,u=this.bits;let m=0;for(;m<u.length&&u[m]===0;)m++;if(m===u.length)return null;const v=m/a;let w=m%a*32;const I=u[m];let P=0;for(;(I<<31-P&4294967295)===0;)P++;return w+=P,Int32Array.from([w,v])}getBottomRightOnBit(){const a=this.rowSize,u=this.bits;let m=u.length-1;for(;m>=0&&u[m]===0;)m--;if(m<0)return null;const v=Math.floor(m/a);let w=Math.floor(m%a)*32;const I=u[m];let P=31;for(;!(I>>>P);)P--;return w+=P,Int32Array.from([w,v])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(a){if(!(a instanceof Rt))return!1;const u=a;return this.width===u.width&&this.height===u.height&&this.rowSize===u.rowSize&&nt.equals(this.bits,u.bits)}hashCode(){let a=this.width;return a=31*a+this.width,a=31*a+this.height,a=31*a+this.rowSize,a=31*a+nt.hashCode(this.bits),a}toString(a="X ",u="  ",m=`
`){return this.buildToString(a,u,m)}buildToString(a,u,m){let v=new gt;for(let w=0,I=this.height;w<I;w++){for(let P=0,F=this.width;P<F;P++)v.append(this.get(P,w)?a:u);v.append(m)}return v.toString()}clone(){return new Rt(this.width,this.height,this.rowSize,this.bits.slice())}}class Ie extends H{static getNotFoundInstance(){return new Ie}}Ie.kind="NotFoundException";class Se extends Ee{constructor(a){super(a),this.luminances=Se.EMPTY,this.buckets=new Int32Array(Se.LUMINANCE_BUCKETS)}getBlackRow(a,u){const m=this.getLuminanceSource(),v=m.getWidth();u==null||u.getSize()<v?u=new dt(v):u.clear(),this.initArrays(v);const w=m.getRow(a,this.luminances),I=this.buckets;for(let F=0;F<v;F++)I[(w[F]&255)>>Se.LUMINANCE_SHIFT]++;const P=Se.estimateBlackPoint(I);if(v<3)for(let F=0;F<v;F++)(w[F]&255)<P&&u.set(F);else{let F=w[0]&255,q=w[1]&255;for(let te=1;te<v-1;te++){const ce=w[te+1]&255;(q*4-F-ce)/2<P&&u.set(te),F=q,q=ce}}return u}getBlackMatrix(){const a=this.getLuminanceSource(),u=a.getWidth(),m=a.getHeight(),v=new Rt(u,m);this.initArrays(u);const w=this.buckets;for(let F=1;F<5;F++){const q=Math.floor(m*F/5),te=a.getRow(q,this.luminances),ce=Math.floor(u*4/5);for(let xe=Math.floor(u/5);xe<ce;xe++){const ze=te[xe]&255;w[ze>>Se.LUMINANCE_SHIFT]++}}const I=Se.estimateBlackPoint(w),P=a.getMatrix();for(let F=0;F<m;F++){const q=F*u;for(let te=0;te<u;te++)(P[q+te]&255)<I&&v.set(te,F)}return v}createBinarizer(a){return new Se(a)}initArrays(a){this.luminances.length<a&&(this.luminances=new Uint8ClampedArray(a));const u=this.buckets;for(let m=0;m<Se.LUMINANCE_BUCKETS;m++)u[m]=0}static estimateBlackPoint(a){const u=a.length;let m=0,v=0,w=0;for(let te=0;te<u;te++)a[te]>w&&(v=te,w=a[te]),a[te]>m&&(m=a[te]);let I=0,P=0;for(let te=0;te<u;te++){const ce=te-v,xe=a[te]*ce*ce;xe>P&&(I=te,P=xe)}if(v>I){const te=v;v=I,I=te}if(I-v<=u/16)throw new Ie;let F=I-1,q=-1;for(let te=I-1;te>v;te--){const ce=te-v,xe=ce*ce*(I-te)*(m-a[te]);xe>q&&(F=te,q=xe)}return F<<Se.LUMINANCE_SHIFT}}Se.LUMINANCE_BITS=5,Se.LUMINANCE_SHIFT=8-Se.LUMINANCE_BITS,Se.LUMINANCE_BUCKETS=1<<Se.LUMINANCE_BITS,Se.EMPTY=Uint8ClampedArray.from([0]);class je extends Se{constructor(a){super(a),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const a=this.getLuminanceSource(),u=a.getWidth(),m=a.getHeight();if(u>=je.MINIMUM_DIMENSION&&m>=je.MINIMUM_DIMENSION){const v=a.getMatrix();let w=u>>je.BLOCK_SIZE_POWER;(u&je.BLOCK_SIZE_MASK)!==0&&w++;let I=m>>je.BLOCK_SIZE_POWER;(m&je.BLOCK_SIZE_MASK)!==0&&I++;const P=je.calculateBlackPoints(v,w,I,u,m),F=new Rt(u,m);je.calculateThresholdForBlock(v,w,I,u,m,P,F),this.matrix=F}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(a){return new je(a)}static calculateThresholdForBlock(a,u,m,v,w,I,P){const F=w-je.BLOCK_SIZE,q=v-je.BLOCK_SIZE;for(let te=0;te<m;te++){let ce=te<<je.BLOCK_SIZE_POWER;ce>F&&(ce=F);const xe=je.cap(te,2,m-3);for(let ze=0;ze<u;ze++){let it=ze<<je.BLOCK_SIZE_POWER;it>q&&(it=q);const lt=je.cap(ze,2,u-3);let Tt=0;for(let vn=-2;vn<=2;vn++){const yn=I[xe+vn];Tt+=yn[lt-2]+yn[lt-1]+yn[lt]+yn[lt+1]+yn[lt+2]}const Ft=Tt/25;je.thresholdBlock(a,it,ce,Ft,v,P)}}}static cap(a,u,m){return a<u?u:a>m?m:a}static thresholdBlock(a,u,m,v,w,I){for(let P=0,F=m*w+u;P<je.BLOCK_SIZE;P++,F+=w)for(let q=0;q<je.BLOCK_SIZE;q++)(a[F+q]&255)<=v&&I.set(u+q,m+P)}static calculateBlackPoints(a,u,m,v,w){const I=w-je.BLOCK_SIZE,P=v-je.BLOCK_SIZE,F=new Array(m);for(let q=0;q<m;q++){F[q]=new Int32Array(u);let te=q<<je.BLOCK_SIZE_POWER;te>I&&(te=I);for(let ce=0;ce<u;ce++){let xe=ce<<je.BLOCK_SIZE_POWER;xe>P&&(xe=P);let ze=0,it=255,lt=0;for(let Ft=0,vn=te*v+xe;Ft<je.BLOCK_SIZE;Ft++,vn+=v){for(let yn=0;yn<je.BLOCK_SIZE;yn++){const un=a[vn+yn]&255;ze+=un,un<it&&(it=un),un>lt&&(lt=un)}if(lt-it>je.MIN_DYNAMIC_RANGE)for(Ft++,vn+=v;Ft<je.BLOCK_SIZE;Ft++,vn+=v)for(let yn=0;yn<je.BLOCK_SIZE;yn++)ze+=a[vn+yn]&255}let Tt=ze>>je.BLOCK_SIZE_POWER*2;if(lt-it<=je.MIN_DYNAMIC_RANGE&&(Tt=it/2,q>0&&ce>0)){const Ft=(F[q-1][ce]+2*F[q][ce-1]+F[q-1][ce-1])/4;it<Ft&&(Tt=Ft)}F[q][ce]=Tt}}return F}}je.BLOCK_SIZE_POWER=3,je.BLOCK_SIZE=1<<je.BLOCK_SIZE_POWER,je.BLOCK_SIZE_MASK=je.BLOCK_SIZE-1,je.MINIMUM_DIMENSION=je.BLOCK_SIZE*5,je.MIN_DYNAMIC_RANGE=24;class st{constructor(a,u){this.width=a,this.height=u}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(a,u,m,v){throw new pt("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new pt("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new pt("This luminance source does not support rotation by 45 degrees.")}toString(){const a=new Uint8ClampedArray(this.width);let u=new gt;for(let m=0;m<this.height;m++){const v=this.getRow(m,a);for(let w=0;w<this.width;w++){const I=v[w]&255;let P;I<64?P="#":I<128?P="+":I<192?P=".":P=" ",u.append(P)}u.append(`
`)}return u.toString()}}class mt extends st{constructor(a){super(a.getWidth(),a.getHeight()),this.delegate=a}getRow(a,u){const m=this.delegate.getRow(a,u),v=this.getWidth();for(let w=0;w<v;w++)m[w]=255-(m[w]&255);return m}getMatrix(){const a=this.delegate.getMatrix(),u=this.getWidth()*this.getHeight(),m=new Uint8ClampedArray(u);for(let v=0;v<u;v++)m[v]=255-(a[v]&255);return m}isCropSupported(){return this.delegate.isCropSupported()}crop(a,u,m,v){return new mt(this.delegate.crop(a,u,m,v))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new mt(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new mt(this.delegate.rotateCounterClockwise45())}}class Xt extends st{constructor(a){super(a.width,a.height),this.canvas=a,this.tempCanvasElement=null,this.buffer=Xt.makeBufferFromCanvasImageData(a)}static makeBufferFromCanvasImageData(a){const u=a.getContext("2d").getImageData(0,0,a.width,a.height);return Xt.toGrayscaleBuffer(u.data,a.width,a.height)}static toGrayscaleBuffer(a,u,m){const v=new Uint8ClampedArray(u*m);for(let w=0,I=0,P=a.length;w<P;w+=4,I++){let F;if(a[w+3]===0)F=255;else{const te=a[w],ce=a[w+1],xe=a[w+2];F=306*te+601*ce+117*xe+512>>10}v[I]=F}return v}getRow(a,u){if(a<0||a>=this.getHeight())throw new K("Requested row is outside the image: "+a);const m=this.getWidth(),v=a*m;return u===null?u=this.buffer.slice(v,v+m):(u.length<m&&(u=new Uint8ClampedArray(m)),u.set(this.buffer.slice(v,v+m))),u}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(a,u,m,v){return super.crop(a,u,m,v),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const a=this.canvas.ownerDocument.createElement("canvas");a.width=this.canvas.width,a.height=this.canvas.height,this.tempCanvasElement=a}return this.tempCanvasElement}rotate(a){const u=this.getTempCanvasElement(),m=u.getContext("2d"),v=a*Xt.DEGREE_TO_RADIANS,w=this.canvas.width,I=this.canvas.height,P=Math.ceil(Math.abs(Math.cos(v))*w+Math.abs(Math.sin(v))*I),F=Math.ceil(Math.abs(Math.sin(v))*w+Math.abs(Math.cos(v))*I);return u.width=P,u.height=F,m.translate(P/2,F/2),m.rotate(v),m.drawImage(this.canvas,w/-2,I/-2),this.buffer=Xt.makeBufferFromCanvasImageData(u),this}invert(){return new mt(this)}}Xt.DEGREE_TO_RADIANS=Math.PI/180;class Oe{constructor(a,u,m){this.deviceId=a,this.label=u,this.kind="videoinput",this.groupId=m||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Xe=(globalThis||kg||self||window||void 0)&&(globalThis||kg||self||window||void 0).__awaiter||function(le,a,u,m){function v(w){return w instanceof u?w:new u(function(I){I(w)})}return new(u||(u=Promise))(function(w,I){function P(te){try{q(m.next(te))}catch(ce){I(ce)}}function F(te){try{q(m.throw(te))}catch(ce){I(ce)}}function q(te){te.done?w(te.value):v(te.value).then(P,F)}q((m=m.apply(le,a||[])).next())})};class It{constructor(a,u=500,m){this.reader=a,this.timeBetweenScansMillis=u,this._hints=m,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(a){this._timeBetweenDecodingAttempts=a<0?0:a}set hints(a){this._hints=a||null}get hints(){return this._hints}listVideoInputDevices(){return Xe(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const a=yield navigator.mediaDevices.enumerateDevices(),u=[];for(const m of a){const v=m.kind==="video"?"videoinput":m.kind;if(v!=="videoinput")continue;const w=m.deviceId||m.id,I=m.label||`Video device ${u.length+1}`,P=m.groupId,F={deviceId:w,label:I,kind:v,groupId:P};u.push(F)}return u})}getVideoInputDevices(){return Xe(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(u=>new Oe(u.deviceId,u.label))})}findDeviceById(a){return Xe(this,void 0,void 0,function*(){const u=yield this.listVideoInputDevices();return u?u.find(m=>m.deviceId===a):null})}decodeFromInputVideoDevice(a,u){return Xe(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(a,u)})}decodeOnceFromVideoDevice(a,u){return Xe(this,void 0,void 0,function*(){this.reset();let m;a?m={deviceId:{exact:a}}:m={facingMode:"environment"};const v={video:m};return yield this.decodeOnceFromConstraints(v,u)})}decodeOnceFromConstraints(a,u){return Xe(this,void 0,void 0,function*(){const m=yield navigator.mediaDevices.getUserMedia(a);return yield this.decodeOnceFromStream(m,u)})}decodeOnceFromStream(a,u){return Xe(this,void 0,void 0,function*(){this.reset();const m=yield this.attachStreamToVideo(a,u);return yield this.decodeOnce(m)})}decodeFromInputVideoDeviceContinuously(a,u,m){return Xe(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(a,u,m)})}decodeFromVideoDevice(a,u,m){return Xe(this,void 0,void 0,function*(){let v;a?v={deviceId:{exact:a}}:v={facingMode:"environment"};const w={video:v};return yield this.decodeFromConstraints(w,u,m)})}decodeFromConstraints(a,u,m){return Xe(this,void 0,void 0,function*(){const v=yield navigator.mediaDevices.getUserMedia(a);return yield this.decodeFromStream(v,u,m)})}decodeFromStream(a,u,m){return Xe(this,void 0,void 0,function*(){this.reset();const v=yield this.attachStreamToVideo(a,u);return yield this.decodeContinuously(v,m)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(a,u){return Xe(this,void 0,void 0,function*(){const m=this.prepareVideoElement(u);return this.addVideoSource(m,a),this.videoElement=m,this.stream=a,yield this.playVideoOnLoadAsync(m),m})}playVideoOnLoadAsync(a){return new Promise((u,m)=>this.playVideoOnLoad(a,()=>u()))}playVideoOnLoad(a,u){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(a),a.addEventListener("ended",this.videoEndedListener),a.addEventListener("canplay",this.videoCanPlayListener),a.addEventListener("playing",u),this.tryPlayVideo(a)}isVideoPlaying(a){return a.currentTime>0&&!a.paused&&!a.ended&&a.readyState>2}tryPlayVideo(a){return Xe(this,void 0,void 0,function*(){if(this.isVideoPlaying(a)){console.warn("Trying to play video that is already playing.");return}try{yield a.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(a,u){const m=document.getElementById(a);if(!m)throw new $(`element with id '${a}' not found`);if(m.nodeName.toLowerCase()!==u.toLowerCase())throw new $(`element with id '${a}' must be an ${u} element`);return m}decodeFromImage(a,u){if(!a&&!u)throw new $("either imageElement with a src set or an url must be provided");return u&&!a?this.decodeFromImageUrl(u):this.decodeFromImageElement(a)}decodeFromVideo(a,u){if(!a&&!u)throw new $("Either an element with a src set or an URL must be provided");return u&&!a?this.decodeFromVideoUrl(u):this.decodeFromVideoElement(a)}decodeFromVideoContinuously(a,u,m){if(a===void 0&&u===void 0)throw new $("Either an element with a src set or an URL must be provided");return u&&!a?this.decodeFromVideoUrlContinuously(u,m):this.decodeFromVideoElementContinuously(a,m)}decodeFromImageElement(a){if(!a)throw new $("An image element must be provided.");this.reset();const u=this.prepareImageElement(a);this.imageElement=u;let m;return this.isImageLoaded(u)?m=this.decodeOnce(u,!1,!0):m=this._decodeOnLoadImage(u),m}decodeFromVideoElement(a){const u=this._decodeFromVideoElementSetup(a);return this._decodeOnLoadVideo(u)}decodeFromVideoElementContinuously(a,u){const m=this._decodeFromVideoElementSetup(a);return this._decodeOnLoadVideoContinuously(m,u)}_decodeFromVideoElementSetup(a){if(!a)throw new $("A video element must be provided.");this.reset();const u=this.prepareVideoElement(a);return this.videoElement=u,u}decodeFromImageUrl(a){if(!a)throw new $("An URL must be provided.");this.reset();const u=this.prepareImageElement();this.imageElement=u;const m=this._decodeOnLoadImage(u);return u.src=a,m}decodeFromVideoUrl(a){if(!a)throw new $("An URL must be provided.");this.reset();const u=this.prepareVideoElement(),m=this.decodeFromVideoElement(u);return u.src=a,m}decodeFromVideoUrlContinuously(a,u){if(!a)throw new $("An URL must be provided.");this.reset();const m=this.prepareVideoElement(),v=this.decodeFromVideoElementContinuously(m,u);return m.src=a,v}_decodeOnLoadImage(a){return new Promise((u,m)=>{this.imageLoadedListener=()=>this.decodeOnce(a,!1,!0).then(u,m),a.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(a){return Xe(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(a),yield this.decodeOnce(a)})}_decodeOnLoadVideoContinuously(a,u){return Xe(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(a),this.decodeContinuously(a,u)})}isImageLoaded(a){return!(!a.complete||a.naturalWidth===0)}prepareImageElement(a){let u;return typeof a>"u"&&(u=document.createElement("img"),u.width=200,u.height=200),typeof a=="string"&&(u=this.getMediaElement(a,"img")),a instanceof HTMLImageElement&&(u=a),u}prepareVideoElement(a){let u;return!a&&typeof document<"u"&&(u=document.createElement("video"),u.width=200,u.height=200),typeof a=="string"&&(u=this.getMediaElement(a,"video")),a instanceof HTMLVideoElement&&(u=a),u.setAttribute("autoplay","true"),u.setAttribute("muted","true"),u.setAttribute("playsinline","true"),u}decodeOnce(a,u=!0,m=!0){this._stopAsyncDecode=!1;const v=(w,I)=>{if(this._stopAsyncDecode){I(new Ie("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const P=this.decode(a);w(P)}catch(P){const F=u&&P instanceof Ie,te=(P instanceof Ce||P instanceof tt)&&m;if(F||te)return setTimeout(v,this._timeBetweenDecodingAttempts,w,I);I(P)}};return new Promise((w,I)=>v(w,I))}decodeContinuously(a,u){this._stopContinuousDecode=!1;const m=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const v=this.decode(a);u(v,null),setTimeout(m,this.timeBetweenScansMillis)}catch(v){u(null,v);const w=v instanceof Ce||v instanceof tt,I=v instanceof Ie;(w||I)&&setTimeout(m,this._timeBetweenDecodingAttempts)}};m()}decode(a){const u=this.createBinaryBitmap(a);return this.decodeBitmap(u)}_isHTMLVideoElement(a){return a.videoWidth!==0}drawFrameOnCanvas(a,u,m){u||(u={sx:0,sy:0,sWidth:a.videoWidth,sHeight:a.videoHeight,dx:0,dy:0,dWidth:a.videoWidth,dHeight:a.videoHeight}),m||(m=this.captureCanvasContext),m.drawImage(a,u.sx,u.sy,u.sWidth,u.sHeight,u.dx,u.dy,u.dWidth,u.dHeight)}drawImageOnCanvas(a,u,m=this.captureCanvasContext){u||(u={sx:0,sy:0,sWidth:a.naturalWidth,sHeight:a.naturalHeight,dx:0,dy:0,dWidth:a.naturalWidth,dHeight:a.naturalHeight}),m||(m=this.captureCanvasContext),m.drawImage(a,u.sx,u.sy,u.sWidth,u.sHeight,u.dx,u.dy,u.dWidth,u.dHeight)}createBinaryBitmap(a){this.getCaptureCanvasContext(a),this._isHTMLVideoElement(a)?this.drawFrameOnCanvas(a):this.drawImageOnCanvas(a);const u=this.getCaptureCanvas(a),m=new Xt(u),v=new je(m);return new be(v)}getCaptureCanvasContext(a){if(!this.captureCanvasContext){const m=this.getCaptureCanvas(a).getContext("2d");this.captureCanvasContext=m}return this.captureCanvasContext}getCaptureCanvas(a){if(!this.captureCanvas){const u=this.createCaptureCanvas(a);this.captureCanvas=u}return this.captureCanvas}decodeBitmap(a){return this.reader.decode(a,this._hints)}createCaptureCanvas(a){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const u=document.createElement("canvas");let m,v;return typeof a<"u"&&(a instanceof HTMLVideoElement?(m=a.videoWidth,v=a.videoHeight):a instanceof HTMLImageElement&&(m=a.naturalWidth||a.width,v=a.naturalHeight||a.height)),u.style.width=m+"px",u.style.height=v+"px",u.width=m,u.height=v,u}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(a=>a.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(a,u){try{a.srcObject=u}catch{a.src=URL.createObjectURL(u)}}cleanVideoSource(a){try{a.srcObject=null}catch{a.src=""}this.videoElement.removeAttribute("src")}}class Nt{constructor(a,u,m=u==null?0:8*u.length,v,w,I=ye.currentTimeMillis()){this.text=a,this.rawBytes=u,this.numBits=m,this.resultPoints=v,this.format=w,this.timestamp=I,this.text=a,this.rawBytes=u,m==null?this.numBits=u==null?0:8*u.length:this.numBits=m,this.resultPoints=v,this.format=w,this.resultMetadata=null,I==null?this.timestamp=ye.currentTimeMillis():this.timestamp=I}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(a,u){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(a,u)}putAllMetadata(a){a!==null&&(this.resultMetadata===null?this.resultMetadata=a:this.resultMetadata=new Map(a))}addResultPoints(a){const u=this.resultPoints;if(u===null)this.resultPoints=a;else if(a!==null&&a.length>0){const m=new Array(u.length+a.length);ye.arraycopy(u,0,m,0,u.length),ye.arraycopy(a,0,m,u.length,a.length),this.resultPoints=m}}getTimestamp(){return this.timestamp}toString(){return this.text}}var $t;(function(le){le[le.AZTEC=0]="AZTEC",le[le.CODABAR=1]="CODABAR",le[le.CODE_39=2]="CODE_39",le[le.CODE_93=3]="CODE_93",le[le.CODE_128=4]="CODE_128",le[le.DATA_MATRIX=5]="DATA_MATRIX",le[le.EAN_8=6]="EAN_8",le[le.EAN_13=7]="EAN_13",le[le.ITF=8]="ITF",le[le.MAXICODE=9]="MAXICODE",le[le.PDF_417=10]="PDF_417",le[le.QR_CODE=11]="QR_CODE",le[le.RSS_14=12]="RSS_14",le[le.RSS_EXPANDED=13]="RSS_EXPANDED",le[le.UPC_A=14]="UPC_A",le[le.UPC_E=15]="UPC_E",le[le.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})($t||($t={}));var Bt=$t,Mn;(function(le){le[le.OTHER=0]="OTHER",le[le.ORIENTATION=1]="ORIENTATION",le[le.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",le[le.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",le[le.ISSUE_NUMBER=4]="ISSUE_NUMBER",le[le.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",le[le.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",le[le.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",le[le.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",le[le.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",le[le.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Mn||(Mn={}));var Tn=Mn;class Rn{constructor(a,u,m,v,w=-1,I=-1){this.rawBytes=a,this.text=u,this.byteSegments=m,this.ecLevel=v,this.structuredAppendSequenceNumber=w,this.structuredAppendParity=I,this.numBits=a==null?0:8*a.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(a){this.numBits=a}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(a){this.errorsCorrected=a}getErasures(){return this.erasures}setErasures(a){this.erasures=a}getOther(){return this.other}setOther(a){this.other=a}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class ri{exp(a){return this.expTable[a]}log(a){if(a===0)throw new K;return this.logTable[a]}static addOrSubtract(a,u){return a^u}}class _i{constructor(a,u){if(u.length===0)throw new K;this.field=a;const m=u.length;if(m>1&&u[0]===0){let v=1;for(;v<m&&u[v]===0;)v++;v===m?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(m-v),ye.arraycopy(u,v,this.coefficients,0,this.coefficients.length))}else this.coefficients=u}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(a){return this.coefficients[this.coefficients.length-1-a]}evaluateAt(a){if(a===0)return this.getCoefficient(0);const u=this.coefficients;let m;if(a===1){m=0;for(let I=0,P=u.length;I!==P;I++){const F=u[I];m=ri.addOrSubtract(m,F)}return m}m=u[0];const v=u.length,w=this.field;for(let I=1;I<v;I++)m=ri.addOrSubtract(w.multiply(a,m),u[I]);return m}addOrSubtract(a){if(!this.field.equals(a.field))throw new K("GenericGFPolys do not have same GenericGF field");if(this.isZero())return a;if(a.isZero())return this;let u=this.coefficients,m=a.coefficients;if(u.length>m.length){const I=u;u=m,m=I}let v=new Int32Array(m.length);const w=m.length-u.length;ye.arraycopy(m,0,v,0,w);for(let I=w;I<m.length;I++)v[I]=ri.addOrSubtract(u[I-w],m[I]);return new _i(this.field,v)}multiply(a){if(!this.field.equals(a.field))throw new K("GenericGFPolys do not have same GenericGF field");if(this.isZero()||a.isZero())return this.field.getZero();const u=this.coefficients,m=u.length,v=a.coefficients,w=v.length,I=new Int32Array(m+w-1),P=this.field;for(let F=0;F<m;F++){const q=u[F];for(let te=0;te<w;te++)I[F+te]=ri.addOrSubtract(I[F+te],P.multiply(q,v[te]))}return new _i(P,I)}multiplyScalar(a){if(a===0)return this.field.getZero();if(a===1)return this;const u=this.coefficients.length,m=this.field,v=new Int32Array(u),w=this.coefficients;for(let I=0;I<u;I++)v[I]=m.multiply(w[I],a);return new _i(m,v)}multiplyByMonomial(a,u){if(a<0)throw new K;if(u===0)return this.field.getZero();const m=this.coefficients,v=m.length,w=new Int32Array(v+a),I=this.field;for(let P=0;P<v;P++)w[P]=I.multiply(m[P],u);return new _i(I,w)}divide(a){if(!this.field.equals(a.field))throw new K("GenericGFPolys do not have same GenericGF field");if(a.isZero())throw new K("Divide by 0");const u=this.field;let m=u.getZero(),v=this;const w=a.getCoefficient(a.getDegree()),I=u.inverse(w);for(;v.getDegree()>=a.getDegree()&&!v.isZero();){const P=v.getDegree()-a.getDegree(),F=u.multiply(v.getCoefficient(v.getDegree()),I),q=a.multiplyByMonomial(P,F),te=u.buildMonomial(P,F);m=m.addOrSubtract(te),v=v.addOrSubtract(q)}return[m,v]}toString(){let a="";for(let u=this.getDegree();u>=0;u--){let m=this.getCoefficient(u);if(m!==0){if(m<0?(a+=" - ",m=-m):a.length>0&&(a+=" + "),u===0||m!==1){const v=this.field.log(m);v===0?a+="1":v===1?a+="a":(a+="a^",a+=v)}u!==0&&(u===1?a+="x":(a+="x^",a+=u))}}return a}}class $n extends H{}$n.kind="ArithmeticException";class Kn extends ri{constructor(a,u,m){super(),this.primitive=a,this.size=u,this.generatorBase=m;const v=new Int32Array(u);let w=1;for(let P=0;P<u;P++)v[P]=w,w*=2,w>=u&&(w^=a,w&=u-1);this.expTable=v;const I=new Int32Array(u);for(let P=0;P<u-1;P++)I[v[P]]=P;this.logTable=I,this.zero=new _i(this,Int32Array.from([0])),this.one=new _i(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(a,u){if(a<0)throw new K;if(u===0)return this.zero;const m=new Int32Array(a+1);return m[0]=u,new _i(this,m)}inverse(a){if(a===0)throw new $n;return this.expTable[this.size-this.logTable[a]-1]}multiply(a,u){return a===0||u===0?0:this.expTable[(this.logTable[a]+this.logTable[u])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Qe.toHexString(this.primitive)+","+this.size+")"}equals(a){return a===this}}Kn.AZTEC_DATA_12=new Kn(4201,4096,1),Kn.AZTEC_DATA_10=new Kn(1033,1024,1),Kn.AZTEC_DATA_6=new Kn(67,64,1),Kn.AZTEC_PARAM=new Kn(19,16,1),Kn.QR_CODE_FIELD_256=new Kn(285,256,0),Kn.DATA_MATRIX_FIELD_256=new Kn(301,256,1),Kn.AZTEC_DATA_8=Kn.DATA_MATRIX_FIELD_256,Kn.MAXICODE_FIELD_64=Kn.AZTEC_DATA_6;class Qn extends H{}Qn.kind="ReedSolomonException";class ti extends H{}ti.kind="IllegalStateException";class Bi{constructor(a){this.field=a}decode(a,u){const m=this.field,v=new _i(m,a),w=new Int32Array(u);let I=!0;for(let ze=0;ze<u;ze++){const it=v.evaluateAt(m.exp(ze+m.getGeneratorBase()));w[w.length-1-ze]=it,it!==0&&(I=!1)}if(I)return;const P=new _i(m,w),F=this.runEuclideanAlgorithm(m.buildMonomial(u,1),P,u),q=F[0],te=F[1],ce=this.findErrorLocations(q),xe=this.findErrorMagnitudes(te,ce);for(let ze=0;ze<ce.length;ze++){const it=a.length-1-m.log(ce[ze]);if(it<0)throw new Qn("Bad error location");a[it]=Kn.addOrSubtract(a[it],xe[ze])}}runEuclideanAlgorithm(a,u,m){if(a.getDegree()<u.getDegree()){const ze=a;a=u,u=ze}const v=this.field;let w=a,I=u,P=v.getZero(),F=v.getOne();for(;I.getDegree()>=(m/2|0);){let ze=w,it=P;if(w=I,P=F,w.isZero())throw new Qn("r_{i-1} was zero");I=ze;let lt=v.getZero();const Tt=w.getCoefficient(w.getDegree()),Ft=v.inverse(Tt);for(;I.getDegree()>=w.getDegree()&&!I.isZero();){const vn=I.getDegree()-w.getDegree(),yn=v.multiply(I.getCoefficient(I.getDegree()),Ft);lt=lt.addOrSubtract(v.buildMonomial(vn,yn)),I=I.addOrSubtract(w.multiplyByMonomial(vn,yn))}if(F=lt.multiply(P).addOrSubtract(it),I.getDegree()>=w.getDegree())throw new ti("Division algorithm failed to reduce polynomial?")}const q=F.getCoefficient(0);if(q===0)throw new Qn("sigmaTilde(0) was zero");const te=v.inverse(q),ce=F.multiplyScalar(te),xe=I.multiplyScalar(te);return[ce,xe]}findErrorLocations(a){const u=a.getDegree();if(u===1)return Int32Array.from([a.getCoefficient(1)]);const m=new Int32Array(u);let v=0;const w=this.field;for(let I=1;I<w.getSize()&&v<u;I++)a.evaluateAt(I)===0&&(m[v]=w.inverse(I),v++);if(v!==u)throw new Qn("Error locator degree does not match number of roots");return m}findErrorMagnitudes(a,u){const m=u.length,v=new Int32Array(m),w=this.field;for(let I=0;I<m;I++){const P=w.inverse(u[I]);let F=1;for(let q=0;q<m;q++)if(I!==q){const te=w.multiply(u[q],P),ce=(te&1)===0?te|1:te&-2;F=w.multiply(F,ce)}v[I]=w.multiply(a.evaluateAt(P),w.inverse(F)),w.getGeneratorBase()!==0&&(v[I]=w.multiply(v[I],P))}return v}}var si;(function(le){le[le.UPPER=0]="UPPER",le[le.LOWER=1]="LOWER",le[le.MIXED=2]="MIXED",le[le.DIGIT=3]="DIGIT",le[le.PUNCT=4]="PUNCT",le[le.BINARY=5]="BINARY"})(si||(si={}));class Yt{decode(a){this.ddata=a;let u=a.getBits(),m=this.extractBits(u),v=this.correctBits(m),w=Yt.convertBoolArrayToByteArray(v),I=Yt.getEncodedData(v),P=new Rn(w,I,null,null);return P.setNumBits(v.length),P}static highLevelDecode(a){return this.getEncodedData(a)}static getEncodedData(a){let u=a.length,m=si.UPPER,v=si.UPPER,w="",I=0;for(;I<u;)if(v===si.BINARY){if(u-I<5)break;let P=Yt.readCode(a,I,5);if(I+=5,P===0){if(u-I<11)break;P=Yt.readCode(a,I,11)+31,I+=11}for(let F=0;F<P;F++){if(u-I<8){I=u;break}const q=Yt.readCode(a,I,8);w+=ot.castAsNonUtf8Char(q),I+=8}v=m}else{let P=v===si.DIGIT?4:5;if(u-I<P)break;let F=Yt.readCode(a,I,P);I+=P;let q=Yt.getCharacter(v,F);q.startsWith("CTRL_")?(m=v,v=Yt.getTable(q.charAt(5)),q.charAt(6)==="L"&&(m=v)):(w+=q,v=m)}return w}static getTable(a){switch(a){case"L":return si.LOWER;case"P":return si.PUNCT;case"M":return si.MIXED;case"D":return si.DIGIT;case"B":return si.BINARY;default:return si.UPPER}}static getCharacter(a,u){switch(a){case si.UPPER:return Yt.UPPER_TABLE[u];case si.LOWER:return Yt.LOWER_TABLE[u];case si.MIXED:return Yt.MIXED_TABLE[u];case si.PUNCT:return Yt.PUNCT_TABLE[u];case si.DIGIT:return Yt.DIGIT_TABLE[u];default:throw new ti("Bad table")}}correctBits(a){let u,m;this.ddata.getNbLayers()<=2?(m=6,u=Kn.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(m=8,u=Kn.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(m=10,u=Kn.AZTEC_DATA_10):(m=12,u=Kn.AZTEC_DATA_12);let v=this.ddata.getNbDatablocks(),w=a.length/m;if(w<v)throw new tt;let I=a.length%m,P=new Int32Array(w);for(let xe=0;xe<w;xe++,I+=m)P[xe]=Yt.readCode(a,I,m);try{new Bi(u).decode(P,w-v)}catch(xe){throw new tt(xe)}let F=(1<<m)-1,q=0;for(let xe=0;xe<v;xe++){let ze=P[xe];if(ze===0||ze===F)throw new tt;(ze===1||ze===F-1)&&q++}let te=new Array(v*m-q),ce=0;for(let xe=0;xe<v;xe++){let ze=P[xe];if(ze===1||ze===F-1)te.fill(ze>1,ce,ce+m-1),ce+=m-1;else for(let it=m-1;it>=0;--it)te[ce++]=(ze&1<<it)!==0}return te}extractBits(a){let u=this.ddata.isCompact(),m=this.ddata.getNbLayers(),v=(u?11:14)+m*4,w=new Int32Array(v),I=new Array(this.totalBitsInLayer(m,u));if(u)for(let P=0;P<w.length;P++)w[P]=P;else{let P=v+1+2*Qe.truncDivision(Qe.truncDivision(v,2)-1,15),F=v/2,q=Qe.truncDivision(P,2);for(let te=0;te<F;te++){let ce=te+Qe.truncDivision(te,15);w[F-te-1]=q-ce-1,w[F+te]=q+ce+1}}for(let P=0,F=0;P<m;P++){let q=(m-P)*4+(u?9:12),te=P*2,ce=v-1-te;for(let xe=0;xe<q;xe++){let ze=xe*2;for(let it=0;it<2;it++)I[F+ze+it]=a.get(w[te+it],w[te+xe]),I[F+2*q+ze+it]=a.get(w[te+xe],w[ce-it]),I[F+4*q+ze+it]=a.get(w[ce-it],w[ce-xe]),I[F+6*q+ze+it]=a.get(w[ce-xe],w[te+it])}F+=q*8}return I}static readCode(a,u,m){let v=0;for(let w=u;w<u+m;w++)v<<=1,a[w]&&(v|=1);return v}static readByte(a,u){let m=a.length-u;return m>=8?Yt.readCode(a,u,8):Yt.readCode(a,u,m)<<8-m}static convertBoolArrayToByteArray(a){let u=new Uint8Array((a.length+7)/8);for(let m=0;m<u.length;m++)u[m]=Yt.readByte(a,8*m);return u}totalBitsInLayer(a,u){return((u?88:112)+16*a)*a}}Yt.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Yt.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Yt.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Yt.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Yt.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class fn{constructor(){}static round(a){return a===NaN?0:a<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:a>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:a+(a<0?-.5:.5)|0}static distance(a,u,m,v){const w=a-m,I=u-v;return Math.sqrt(w*w+I*I)}static sum(a){let u=0;for(let m=0,v=a.length;m!==v;m++){const w=a[m];u+=w}return u}}class di{static floatToIntBits(a){return a}}di.MAX_VALUE=Number.MAX_SAFE_INTEGER;class gn{constructor(a,u){this.x=a,this.y=u}getX(){return this.x}getY(){return this.y}equals(a){if(a instanceof gn){const u=a;return this.x===u.x&&this.y===u.y}return!1}hashCode(){return 31*di.floatToIntBits(this.x)+di.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(a){const u=this.distance(a[0],a[1]),m=this.distance(a[1],a[2]),v=this.distance(a[0],a[2]);let w,I,P;if(m>=u&&m>=v?(I=a[0],w=a[1],P=a[2]):v>=m&&v>=u?(I=a[1],w=a[0],P=a[2]):(I=a[2],w=a[0],P=a[1]),this.crossProductZ(w,I,P)<0){const F=w;w=P,P=F}a[0]=w,a[1]=I,a[2]=P}static distance(a,u){return fn.distance(a.x,a.y,u.x,u.y)}static crossProductZ(a,u,m){const v=u.x,w=u.y;return(m.x-v)*(a.y-w)-(m.y-w)*(a.x-v)}}class Zn{constructor(a,u){this.bits=a,this.points=u}getBits(){return this.bits}getPoints(){return this.points}}class Yi extends Zn{constructor(a,u,m,v,w){super(a,u),this.compact=m,this.nbDatablocks=v,this.nbLayers=w}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class fi{constructor(a,u,m,v){this.image=a,this.height=a.getHeight(),this.width=a.getWidth(),u==null&&(u=fi.INIT_SIZE),m==null&&(m=a.getWidth()/2|0),v==null&&(v=a.getHeight()/2|0);const w=u/2|0;if(this.leftInit=m-w,this.rightInit=m+w,this.upInit=v-w,this.downInit=v+w,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Ie}detect(){let a=this.leftInit,u=this.rightInit,m=this.upInit,v=this.downInit,w=!1,I=!0,P=!1,F=!1,q=!1,te=!1,ce=!1;const xe=this.width,ze=this.height;for(;I;){I=!1;let it=!0;for(;(it||!F)&&u<xe;)it=this.containsBlackPoint(m,v,u,!1),it?(u++,I=!0,F=!0):F||u++;if(u>=xe){w=!0;break}let lt=!0;for(;(lt||!q)&&v<ze;)lt=this.containsBlackPoint(a,u,v,!0),lt?(v++,I=!0,q=!0):q||v++;if(v>=ze){w=!0;break}let Tt=!0;for(;(Tt||!te)&&a>=0;)Tt=this.containsBlackPoint(m,v,a,!1),Tt?(a--,I=!0,te=!0):te||a--;if(a<0){w=!0;break}let Ft=!0;for(;(Ft||!ce)&&m>=0;)Ft=this.containsBlackPoint(a,u,m,!0),Ft?(m--,I=!0,ce=!0):ce||m--;if(m<0){w=!0;break}I&&(P=!0)}if(!w&&P){const it=u-a;let lt=null;for(let yn=1;lt===null&&yn<it;yn++)lt=this.getBlackPointOnSegment(a,v-yn,a+yn,v);if(lt==null)throw new Ie;let Tt=null;for(let yn=1;Tt===null&&yn<it;yn++)Tt=this.getBlackPointOnSegment(a,m+yn,a+yn,m);if(Tt==null)throw new Ie;let Ft=null;for(let yn=1;Ft===null&&yn<it;yn++)Ft=this.getBlackPointOnSegment(u,m+yn,u-yn,m);if(Ft==null)throw new Ie;let vn=null;for(let yn=1;vn===null&&yn<it;yn++)vn=this.getBlackPointOnSegment(u,v-yn,u-yn,v);if(vn==null)throw new Ie;return this.centerEdges(vn,lt,Ft,Tt)}else throw new Ie}getBlackPointOnSegment(a,u,m,v){const w=fn.round(fn.distance(a,u,m,v)),I=(m-a)/w,P=(v-u)/w,F=this.image;for(let q=0;q<w;q++){const te=fn.round(a+q*I),ce=fn.round(u+q*P);if(F.get(te,ce))return new gn(te,ce)}return null}centerEdges(a,u,m,v){const w=a.getX(),I=a.getY(),P=u.getX(),F=u.getY(),q=m.getX(),te=m.getY(),ce=v.getX(),xe=v.getY(),ze=fi.CORR;return w<this.width/2?[new gn(ce-ze,xe+ze),new gn(P+ze,F+ze),new gn(q-ze,te-ze),new gn(w+ze,I-ze)]:[new gn(ce+ze,xe+ze),new gn(P+ze,F-ze),new gn(q-ze,te+ze),new gn(w-ze,I-ze)]}containsBlackPoint(a,u,m,v){const w=this.image;if(v){for(let I=a;I<=u;I++)if(w.get(I,m))return!0}else for(let I=a;I<=u;I++)if(w.get(m,I))return!0;return!1}}fi.INIT_SIZE=10,fi.CORR=1;class ci{static checkAndNudgePoints(a,u){const m=a.getWidth(),v=a.getHeight();let w=!0;for(let I=0;I<u.length&&w;I+=2){const P=Math.floor(u[I]),F=Math.floor(u[I+1]);if(P<-1||P>m||F<-1||F>v)throw new Ie;w=!1,P===-1?(u[I]=0,w=!0):P===m&&(u[I]=m-1,w=!0),F===-1?(u[I+1]=0,w=!0):F===v&&(u[I+1]=v-1,w=!0)}w=!0;for(let I=u.length-2;I>=0&&w;I-=2){const P=Math.floor(u[I]),F=Math.floor(u[I+1]);if(P<-1||P>m||F<-1||F>v)throw new Ie;w=!1,P===-1?(u[I]=0,w=!0):P===m&&(u[I]=m-1,w=!0),F===-1?(u[I+1]=0,w=!0):F===v&&(u[I+1]=v-1,w=!0)}}}class ct{constructor(a,u,m,v,w,I,P,F,q){this.a11=a,this.a21=u,this.a31=m,this.a12=v,this.a22=w,this.a32=I,this.a13=P,this.a23=F,this.a33=q}static quadrilateralToQuadrilateral(a,u,m,v,w,I,P,F,q,te,ce,xe,ze,it,lt,Tt){const Ft=ct.quadrilateralToSquare(a,u,m,v,w,I,P,F);return ct.squareToQuadrilateral(q,te,ce,xe,ze,it,lt,Tt).times(Ft)}transformPoints(a){const u=a.length,m=this.a11,v=this.a12,w=this.a13,I=this.a21,P=this.a22,F=this.a23,q=this.a31,te=this.a32,ce=this.a33;for(let xe=0;xe<u;xe+=2){const ze=a[xe],it=a[xe+1],lt=w*ze+F*it+ce;a[xe]=(m*ze+I*it+q)/lt,a[xe+1]=(v*ze+P*it+te)/lt}}transformPointsWithValues(a,u){const m=this.a11,v=this.a12,w=this.a13,I=this.a21,P=this.a22,F=this.a23,q=this.a31,te=this.a32,ce=this.a33,xe=a.length;for(let ze=0;ze<xe;ze++){const it=a[ze],lt=u[ze],Tt=w*it+F*lt+ce;a[ze]=(m*it+I*lt+q)/Tt,u[ze]=(v*it+P*lt+te)/Tt}}static squareToQuadrilateral(a,u,m,v,w,I,P,F){const q=a-m+w-P,te=u-v+I-F;if(q===0&&te===0)return new ct(m-a,w-m,a,v-u,I-v,u,0,0,1);{const ce=m-w,xe=P-w,ze=v-I,it=F-I,lt=ce*it-xe*ze,Tt=(q*it-xe*te)/lt,Ft=(ce*te-q*ze)/lt;return new ct(m-a+Tt*m,P-a+Ft*P,a,v-u+Tt*v,F-u+Ft*F,u,Tt,Ft,1)}}static quadrilateralToSquare(a,u,m,v,w,I,P,F){return ct.squareToQuadrilateral(a,u,m,v,w,I,P,F).buildAdjoint()}buildAdjoint(){return new ct(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(a){return new ct(this.a11*a.a11+this.a21*a.a12+this.a31*a.a13,this.a11*a.a21+this.a21*a.a22+this.a31*a.a23,this.a11*a.a31+this.a21*a.a32+this.a31*a.a33,this.a12*a.a11+this.a22*a.a12+this.a32*a.a13,this.a12*a.a21+this.a22*a.a22+this.a32*a.a23,this.a12*a.a31+this.a22*a.a32+this.a32*a.a33,this.a13*a.a11+this.a23*a.a12+this.a33*a.a13,this.a13*a.a21+this.a23*a.a22+this.a33*a.a23,this.a13*a.a31+this.a23*a.a32+this.a33*a.a33)}}class oe extends ci{sampleGrid(a,u,m,v,w,I,P,F,q,te,ce,xe,ze,it,lt,Tt,Ft,vn,yn){const un=ct.quadrilateralToQuadrilateral(v,w,I,P,F,q,te,ce,xe,ze,it,lt,Tt,Ft,vn,yn);return this.sampleGridWithTransform(a,u,m,un)}sampleGridWithTransform(a,u,m,v){if(u<=0||m<=0)throw new Ie;const w=new Rt(u,m),I=new Float32Array(2*u);for(let P=0;P<m;P++){const F=I.length,q=P+.5;for(let te=0;te<F;te+=2)I[te]=te/2+.5,I[te+1]=q;v.transformPoints(I),ci.checkAndNudgePoints(a,I);try{for(let te=0;te<F;te+=2)a.get(Math.floor(I[te]),Math.floor(I[te+1]))&&w.set(te/2,P)}catch{throw new Ie}}return w}}class ue{static setGridSampler(a){ue.gridSampler=a}static getInstance(){return ue.gridSampler}}ue.gridSampler=new oe;class ge{constructor(a,u){this.x=a,this.y=u}toResultPoint(){return new gn(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class qe{constructor(a){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=a}detect(){return this.detectMirror(!1)}detectMirror(a){let u=this.getMatrixCenter(),m=this.getBullsEyeCorners(u);if(a){let I=m[0];m[0]=m[2],m[2]=I}this.extractParameters(m);let v=this.sampleGrid(this.image,m[this.shift%4],m[(this.shift+1)%4],m[(this.shift+2)%4],m[(this.shift+3)%4]),w=this.getMatrixCornerPoints(m);return new Yi(v,w,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(a){if(!this.isValidPoint(a[0])||!this.isValidPoint(a[1])||!this.isValidPoint(a[2])||!this.isValidPoint(a[3]))throw new Ie;let u=2*this.nbCenterLayers,m=new Int32Array([this.sampleLine(a[0],a[1],u),this.sampleLine(a[1],a[2],u),this.sampleLine(a[2],a[3],u),this.sampleLine(a[3],a[0],u)]);this.shift=this.getRotation(m,u);let v=0;for(let I=0;I<4;I++){let P=m[(this.shift+I)%4];this.compact?(v<<=7,v+=P>>1&127):(v<<=10,v+=(P>>2&992)+(P>>1&31))}let w=this.getCorrectedParameterData(v,this.compact);this.compact?(this.nbLayers=(w>>6)+1,this.nbDataBlocks=(w&63)+1):(this.nbLayers=(w>>11)+1,this.nbDataBlocks=(w&2047)+1)}getRotation(a,u){let m=0;a.forEach((v,w,I)=>{let P=(v>>u-2<<1)+(v&1);m=(m<<3)+P}),m=((m&1)<<11)+(m>>1);for(let v=0;v<4;v++)if(Qe.bitCount(m^this.EXPECTED_CORNER_BITS[v])<=2)return v;throw new Ie}getCorrectedParameterData(a,u){let m,v;u?(m=7,v=2):(m=10,v=4);let w=m-v,I=new Int32Array(m);for(let F=m-1;F>=0;--F)I[F]=a&15,a>>=4;try{new Bi(Kn.AZTEC_PARAM).decode(I,w)}catch{throw new Ie}let P=0;for(let F=0;F<v;F++)P=(P<<4)+I[F];return P}getBullsEyeCorners(a){let u=a,m=a,v=a,w=a,I=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let ce=this.getFirstDifferent(u,I,1,-1),xe=this.getFirstDifferent(m,I,1,1),ze=this.getFirstDifferent(v,I,-1,1),it=this.getFirstDifferent(w,I,-1,-1);if(this.nbCenterLayers>2){let lt=this.distancePoint(it,ce)*this.nbCenterLayers/(this.distancePoint(w,u)*(this.nbCenterLayers+2));if(lt<.75||lt>1.25||!this.isWhiteOrBlackRectangle(ce,xe,ze,it))break}u=ce,m=xe,v=ze,w=it,I=!I}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new Ie;this.compact=this.nbCenterLayers===5;let P=new gn(u.getX()+.5,u.getY()-.5),F=new gn(m.getX()+.5,m.getY()+.5),q=new gn(v.getX()-.5,v.getY()+.5),te=new gn(w.getX()-.5,w.getY()-.5);return this.expandSquare([P,F,q,te],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let a,u,m,v;try{let P=new fi(this.image).detect();a=P[0],u=P[1],m=P[2],v=P[3]}catch{let F=this.image.getWidth()/2,q=this.image.getHeight()/2;a=this.getFirstDifferent(new ge(F+7,q-7),!1,1,-1).toResultPoint(),u=this.getFirstDifferent(new ge(F+7,q+7),!1,1,1).toResultPoint(),m=this.getFirstDifferent(new ge(F-7,q+7),!1,-1,1).toResultPoint(),v=this.getFirstDifferent(new ge(F-7,q-7),!1,-1,-1).toResultPoint()}let w=fn.round((a.getX()+v.getX()+u.getX()+m.getX())/4),I=fn.round((a.getY()+v.getY()+u.getY()+m.getY())/4);try{let P=new fi(this.image,15,w,I).detect();a=P[0],u=P[1],m=P[2],v=P[3]}catch{a=this.getFirstDifferent(new ge(w+7,I-7),!1,1,-1).toResultPoint(),u=this.getFirstDifferent(new ge(w+7,I+7),!1,1,1).toResultPoint(),m=this.getFirstDifferent(new ge(w-7,I+7),!1,-1,1).toResultPoint(),v=this.getFirstDifferent(new ge(w-7,I-7),!1,-1,-1).toResultPoint()}return w=fn.round((a.getX()+v.getX()+u.getX()+m.getX())/4),I=fn.round((a.getY()+v.getY()+u.getY()+m.getY())/4),new ge(w,I)}getMatrixCornerPoints(a){return this.expandSquare(a,2*this.nbCenterLayers,this.getDimension())}sampleGrid(a,u,m,v,w){let I=ue.getInstance(),P=this.getDimension(),F=P/2-this.nbCenterLayers,q=P/2+this.nbCenterLayers;return I.sampleGrid(a,P,P,F,F,q,F,q,q,F,q,u.getX(),u.getY(),m.getX(),m.getY(),v.getX(),v.getY(),w.getX(),w.getY())}sampleLine(a,u,m){let v=0,w=this.distanceResultPoint(a,u),I=w/m,P=a.getX(),F=a.getY(),q=I*(u.getX()-a.getX())/w,te=I*(u.getY()-a.getY())/w;for(let ce=0;ce<m;ce++)this.image.get(fn.round(P+ce*q),fn.round(F+ce*te))&&(v|=1<<m-ce-1);return v}isWhiteOrBlackRectangle(a,u,m,v){let w=3;a=new ge(a.getX()-w,a.getY()+w),u=new ge(u.getX()-w,u.getY()-w),m=new ge(m.getX()+w,m.getY()-w),v=new ge(v.getX()+w,v.getY()+w);let I=this.getColor(v,a);if(I===0)return!1;let P=this.getColor(a,u);return P!==I||(P=this.getColor(u,m),P!==I)?!1:(P=this.getColor(m,v),P===I)}getColor(a,u){let m=this.distancePoint(a,u),v=(u.getX()-a.getX())/m,w=(u.getY()-a.getY())/m,I=0,P=a.getX(),F=a.getY(),q=this.image.get(a.getX(),a.getY()),te=Math.ceil(m);for(let xe=0;xe<te;xe++)P+=v,F+=w,this.image.get(fn.round(P),fn.round(F))!==q&&I++;let ce=I/m;return ce>.1&&ce<.9?0:ce<=.1===q?1:-1}getFirstDifferent(a,u,m,v){let w=a.getX()+m,I=a.getY()+v;for(;this.isValid(w,I)&&this.image.get(w,I)===u;)w+=m,I+=v;for(w-=m,I-=v;this.isValid(w,I)&&this.image.get(w,I)===u;)w+=m;for(w-=m;this.isValid(w,I)&&this.image.get(w,I)===u;)I+=v;return I-=v,new ge(w,I)}expandSquare(a,u,m){let v=m/(2*u),w=a[0].getX()-a[2].getX(),I=a[0].getY()-a[2].getY(),P=(a[0].getX()+a[2].getX())/2,F=(a[0].getY()+a[2].getY())/2,q=new gn(P+v*w,F+v*I),te=new gn(P-v*w,F-v*I);w=a[1].getX()-a[3].getX(),I=a[1].getY()-a[3].getY(),P=(a[1].getX()+a[3].getX())/2,F=(a[1].getY()+a[3].getY())/2;let ce=new gn(P+v*w,F+v*I),xe=new gn(P-v*w,F-v*I);return[q,ce,te,xe]}isValid(a,u){return a>=0&&a<this.image.getWidth()&&u>0&&u<this.image.getHeight()}isValidPoint(a){let u=fn.round(a.getX()),m=fn.round(a.getY());return this.isValid(u,m)}distancePoint(a,u){return fn.distance(a.getX(),a.getY(),u.getX(),u.getY())}distanceResultPoint(a,u){return fn.distance(a.getX(),a.getY(),u.getX(),u.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Qe.truncDivision(this.nbLayers-4,8)+1)+15}}class $e{decode(a,u=null){let m=null,v=new qe(a.getBlackMatrix()),w=null,I=null;try{let te=v.detectMirror(!1);w=te.getPoints(),this.reportFoundResultPoints(u,w),I=new Yt().decode(te)}catch(te){m=te}if(I==null)try{let te=v.detectMirror(!0);w=te.getPoints(),this.reportFoundResultPoints(u,w),I=new Yt().decode(te)}catch(te){throw m??te}let P=new Nt(I.getText(),I.getRawBytes(),I.getNumBits(),w,Bt.AZTEC,ye.currentTimeMillis()),F=I.getByteSegments();F!=null&&P.putMetadata(Tn.BYTE_SEGMENTS,F);let q=I.getECLevel();return q!=null&&P.putMetadata(Tn.ERROR_CORRECTION_LEVEL,q),P}reportFoundResultPoints(a,u){if(a!=null){let m=a.get(wt.NEED_RESULT_POINT_CALLBACK);m!=null&&u.forEach((v,w,I)=>{m.foundPossibleResultPoint(v)})}}reset(){}}class bt extends It{constructor(a=500){super(new $e,a)}}class at{decode(a,u){try{return this.doDecode(a,u)}catch{if(u&&u.get(wt.TRY_HARDER)===!0&&a.isRotateSupported()){const w=a.rotateCounterClockwise(),I=this.doDecode(w,u),P=I.getResultMetadata();let F=270;P!==null&&P.get(Tn.ORIENTATION)===!0&&(F=F+P.get(Tn.ORIENTATION)%360),I.putMetadata(Tn.ORIENTATION,F);const q=I.getResultPoints();if(q!==null){const te=w.getHeight();for(let ce=0;ce<q.length;ce++)q[ce]=new gn(te-q[ce].getY()-1,q[ce].getX())}return I}else throw new Ie}}reset(){}doDecode(a,u){const m=a.getWidth(),v=a.getHeight();let w=new dt(m);const I=u&&u.get(wt.TRY_HARDER)===!0,P=Math.max(1,v>>(I?8:5));let F;I?F=v:F=15;const q=Math.trunc(v/2);for(let te=0;te<F;te++){const ce=Math.trunc((te+1)/2),xe=(te&1)===0,ze=q+P*(xe?ce:-ce);if(ze<0||ze>=v)break;try{w=a.getBlackRow(ze,w)}catch{continue}for(let it=0;it<2;it++){if(it===1&&(w.reverse(),u&&u.get(wt.NEED_RESULT_POINT_CALLBACK)===!0)){const lt=new Map;u.forEach((Tt,Ft)=>lt.set(Ft,Tt)),lt.delete(wt.NEED_RESULT_POINT_CALLBACK),u=lt}try{const lt=this.decodeRow(ze,w,u);if(it===1){lt.putMetadata(Tn.ORIENTATION,180);const Tt=lt.getResultPoints();Tt!==null&&(Tt[0]=new gn(m-Tt[0].getX()-1,Tt[0].getY()),Tt[1]=new gn(m-Tt[1].getX()-1,Tt[1].getY()))}return lt}catch{}}}throw new Ie}static recordPattern(a,u,m){const v=m.length;for(let q=0;q<v;q++)m[q]=0;const w=a.getSize();if(u>=w)throw new Ie;let I=!a.get(u),P=0,F=u;for(;F<w;){if(a.get(F)!==I)m[P]++;else{if(++P===v)break;m[P]=1,I=!I}F++}if(!(P===v||P===v-1&&F===w))throw new Ie}static recordPatternInReverse(a,u,m){let v=m.length,w=a.get(u);for(;u>0&&v>=0;)a.get(--u)!==w&&(v--,w=!w);if(v>=0)throw new Ie;at.recordPattern(a,u+1,m)}static patternMatchVariance(a,u,m){const v=a.length;let w=0,I=0;for(let q=0;q<v;q++)w+=a[q],I+=u[q];if(w<I)return Number.POSITIVE_INFINITY;const P=w/I;m*=P;let F=0;for(let q=0;q<v;q++){const te=a[q],ce=u[q]*P,xe=te>ce?te-ce:ce-te;if(xe>m)return Number.POSITIVE_INFINITY;F+=xe}return F/w}}class fe extends at{static findStartPattern(a){const u=a.getSize(),m=a.getNextSet(0);let v=0,w=Int32Array.from([0,0,0,0,0,0]),I=m,P=!1;const F=6;for(let q=m;q<u;q++)if(a.get(q)!==P)w[v]++;else{if(v===F-1){let te=fe.MAX_AVG_VARIANCE,ce=-1;for(let xe=fe.CODE_START_A;xe<=fe.CODE_START_C;xe++){const ze=at.patternMatchVariance(w,fe.CODE_PATTERNS[xe],fe.MAX_INDIVIDUAL_VARIANCE);ze<te&&(te=ze,ce=xe)}if(ce>=0&&a.isRange(Math.max(0,I-(q-I)/2),I,!1))return Int32Array.from([I,q,ce]);I+=w[0]+w[1],w=w.slice(2,w.length-1),w[v-1]=0,w[v]=0,v--}else v++;w[v]=1,P=!P}throw new Ie}static decodeCode(a,u,m){at.recordPattern(a,m,u);let v=fe.MAX_AVG_VARIANCE,w=-1;for(let I=0;I<fe.CODE_PATTERNS.length;I++){const P=fe.CODE_PATTERNS[I],F=this.patternMatchVariance(u,P,fe.MAX_INDIVIDUAL_VARIANCE);F<v&&(v=F,w=I)}if(w>=0)return w;throw new Ie}decodeRow(a,u,m){const v=m&&m.get(wt.ASSUME_GS1)===!0,w=fe.findStartPattern(u),I=w[2];let P=0;const F=new Uint8Array(20);F[P++]=I;let q;switch(I){case fe.CODE_START_A:q=fe.CODE_CODE_A;break;case fe.CODE_START_B:q=fe.CODE_CODE_B;break;case fe.CODE_START_C:q=fe.CODE_CODE_C;break;default:throw new tt}let te=!1,ce=!1,xe="",ze=w[0],it=w[1];const lt=Int32Array.from([0,0,0,0,0,0]);let Tt=0,Ft=0,vn=I,yn=0,un=!0,Ni=!1,Pn=!1;for(;!te;){const As=ce;switch(ce=!1,Tt=Ft,Ft=fe.decodeCode(u,lt,it),F[P++]=Ft,Ft!==fe.CODE_STOP&&(un=!0),Ft!==fe.CODE_STOP&&(yn++,vn+=yn*Ft),ze=it,it+=lt.reduce((Qu,du)=>Qu+du,0),Ft){case fe.CODE_START_A:case fe.CODE_START_B:case fe.CODE_START_C:throw new tt}switch(q){case fe.CODE_CODE_A:if(Ft<64)Pn===Ni?xe+=String.fromCharCode(32+Ft):xe+=String.fromCharCode(32+Ft+128),Pn=!1;else if(Ft<96)Pn===Ni?xe+=String.fromCharCode(Ft-64):xe+=String.fromCharCode(Ft+64),Pn=!1;else switch(Ft!==fe.CODE_STOP&&(un=!1),Ft){case fe.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case fe.CODE_FNC_2:case fe.CODE_FNC_3:break;case fe.CODE_FNC_4_A:!Ni&&Pn?(Ni=!0,Pn=!1):Ni&&Pn?(Ni=!1,Pn=!1):Pn=!0;break;case fe.CODE_SHIFT:ce=!0,q=fe.CODE_CODE_B;break;case fe.CODE_CODE_B:q=fe.CODE_CODE_B;break;case fe.CODE_CODE_C:q=fe.CODE_CODE_C;break;case fe.CODE_STOP:te=!0;break}break;case fe.CODE_CODE_B:if(Ft<96)Pn===Ni?xe+=String.fromCharCode(32+Ft):xe+=String.fromCharCode(32+Ft+128),Pn=!1;else switch(Ft!==fe.CODE_STOP&&(un=!1),Ft){case fe.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case fe.CODE_FNC_2:case fe.CODE_FNC_3:break;case fe.CODE_FNC_4_B:!Ni&&Pn?(Ni=!0,Pn=!1):Ni&&Pn?(Ni=!1,Pn=!1):Pn=!0;break;case fe.CODE_SHIFT:ce=!0,q=fe.CODE_CODE_A;break;case fe.CODE_CODE_A:q=fe.CODE_CODE_A;break;case fe.CODE_CODE_C:q=fe.CODE_CODE_C;break;case fe.CODE_STOP:te=!0;break}break;case fe.CODE_CODE_C:if(Ft<100)Ft<10&&(xe+="0"),xe+=Ft;else switch(Ft!==fe.CODE_STOP&&(un=!1),Ft){case fe.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case fe.CODE_CODE_A:q=fe.CODE_CODE_A;break;case fe.CODE_CODE_B:q=fe.CODE_CODE_B;break;case fe.CODE_STOP:te=!0;break}break}As&&(q=q===fe.CODE_CODE_A?fe.CODE_CODE_B:fe.CODE_CODE_A)}const Ur=it-ze;if(it=u.getNextUnset(it),!u.isRange(it,Math.min(u.getSize(),it+(it-ze)/2),!1))throw new Ie;if(vn-=yn*Tt,vn%103!==Tt)throw new Ce;const aa=xe.length;if(aa===0)throw new Ie;aa>0&&un&&(q===fe.CODE_CODE_C?xe=xe.substring(0,aa-2):xe=xe.substring(0,aa-1));const Ts=(w[1]+w[0])/2,rr=ze+Ur/2,Vr=F.length,Ps=new Uint8Array(Vr);for(let As=0;As<Vr;As++)Ps[As]=F[As];const Ka=[new gn(Ts,a),new gn(rr,a)];return new Nt(xe,Ps,0,Ka,Bt.CODE_128,new Date().getTime())}}fe.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],fe.MAX_AVG_VARIANCE=.25,fe.MAX_INDIVIDUAL_VARIANCE=.7,fe.CODE_SHIFT=98,fe.CODE_CODE_C=99,fe.CODE_CODE_B=100,fe.CODE_CODE_A=101,fe.CODE_FNC_1=102,fe.CODE_FNC_2=97,fe.CODE_FNC_3=96,fe.CODE_FNC_4_A=101,fe.CODE_FNC_4_B=100,fe.CODE_START_A=103,fe.CODE_START_B=104,fe.CODE_START_C=105,fe.CODE_STOP=106;class de extends at{constructor(a=!1,u=!1){super(),this.usingCheckDigit=a,this.extendedMode=u,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(a,u,m){let v=this.counters;v.fill(0),this.decodeRowResult="";let w=de.findAsteriskPattern(u,v),I=u.getNextSet(w[1]),P=u.getSize(),F,q;do{de.recordPattern(u,I,v);let lt=de.toNarrowWidePattern(v);if(lt<0)throw new Ie;F=de.patternToChar(lt),this.decodeRowResult+=F,q=I;for(let Tt of v)I+=Tt;I=u.getNextSet(I)}while(F!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let te=0;for(let lt of v)te+=lt;let ce=I-q-te;if(I!==P&&ce*2<te)throw new Ie;if(this.usingCheckDigit){let lt=this.decodeRowResult.length-1,Tt=0;for(let Ft=0;Ft<lt;Ft++)Tt+=de.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Ft));if(this.decodeRowResult.charAt(lt)!==de.ALPHABET_STRING.charAt(Tt%43))throw new Ce;this.decodeRowResult=this.decodeRowResult.substring(0,lt)}if(this.decodeRowResult.length===0)throw new Ie;let xe;this.extendedMode?xe=de.decodeExtended(this.decodeRowResult):xe=this.decodeRowResult;let ze=(w[1]+w[0])/2,it=q+te/2;return new Nt(xe,null,0,[new gn(ze,a),new gn(it,a)],Bt.CODE_39,new Date().getTime())}static findAsteriskPattern(a,u){let m=a.getSize(),v=a.getNextSet(0),w=0,I=v,P=!1,F=u.length;for(let q=v;q<m;q++)if(a.get(q)!==P)u[w]++;else{if(w===F-1){if(this.toNarrowWidePattern(u)===de.ASTERISK_ENCODING&&a.isRange(Math.max(0,I-Math.floor((q-I)/2)),I,!1))return[I,q];I+=u[0]+u[1],u.copyWithin(0,2,2+w-1),u[w-1]=0,u[w]=0,w--}else w++;u[w]=1,P=!P}throw new Ie}static toNarrowWidePattern(a){let u=a.length,m=0,v;do{let w=2147483647;for(let F of a)F<w&&F>m&&(w=F);m=w,v=0;let I=0,P=0;for(let F=0;F<u;F++){let q=a[F];q>m&&(P|=1<<u-1-F,v++,I+=q)}if(v===3){for(let F=0;F<u&&v>0;F++){let q=a[F];if(q>m&&(v--,q*2>=I))return-1}return P}}while(v>3);return-1}static patternToChar(a){for(let u=0;u<de.CHARACTER_ENCODINGS.length;u++)if(de.CHARACTER_ENCODINGS[u]===a)return de.ALPHABET_STRING.charAt(u);if(a===de.ASTERISK_ENCODING)return"*";throw new Ie}static decodeExtended(a){let u=a.length,m="";for(let v=0;v<u;v++){let w=a.charAt(v);if(w==="+"||w==="$"||w==="%"||w==="/"){let I=a.charAt(v+1),P="\0";switch(w){case"+":if(I>="A"&&I<="Z")P=String.fromCharCode(I.charCodeAt(0)+32);else throw new tt;break;case"$":if(I>="A"&&I<="Z")P=String.fromCharCode(I.charCodeAt(0)-64);else throw new tt;break;case"%":if(I>="A"&&I<="E")P=String.fromCharCode(I.charCodeAt(0)-38);else if(I>="F"&&I<="J")P=String.fromCharCode(I.charCodeAt(0)-11);else if(I>="K"&&I<="O")P=String.fromCharCode(I.charCodeAt(0)+16);else if(I>="P"&&I<="T")P=String.fromCharCode(I.charCodeAt(0)+43);else if(I==="U")P="\0";else if(I==="V")P="@";else if(I==="W")P="`";else if(I==="X"||I==="Y"||I==="Z")P="";else throw new tt;break;case"/":if(I>="A"&&I<="O")P=String.fromCharCode(I.charCodeAt(0)-32);else if(I==="Z")P=":";else throw new tt;break}m+=P,v++}else m+=w}return m}}de.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",de.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],de.ASTERISK_ENCODING=148;class Me extends at{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(a,u,m){let v=this.decodeStart(u),w=this.decodeEnd(u),I=new gt;Me.decodeMiddle(u,v[1],w[0],I);let P=I.toString(),F=null;m!=null&&(F=m.get(wt.ALLOWED_LENGTHS)),F==null&&(F=Me.DEFAULT_ALLOWED_LENGTHS);let q=P.length,te=!1,ce=0;for(let it of F){if(q===it){te=!0;break}it>ce&&(ce=it)}if(!te&&q>ce&&(te=!0),!te)throw new tt;const xe=[new gn(v[1],a),new gn(w[0],a)];return new Nt(P,null,0,xe,Bt.ITF,new Date().getTime())}static decodeMiddle(a,u,m,v){let w=new Int32Array(10),I=new Int32Array(5),P=new Int32Array(5);for(w.fill(0),I.fill(0),P.fill(0);u<m;){at.recordPattern(a,u,w);for(let q=0;q<5;q++){let te=2*q;I[q]=w[te],P[q]=w[te+1]}let F=Me.decodeDigit(I);v.append(F.toString()),F=this.decodeDigit(P),v.append(F.toString()),w.forEach(function(q){u+=q})}}decodeStart(a){let u=Me.skipWhiteSpace(a),m=Me.findGuardPattern(a,u,Me.START_PATTERN);return this.narrowLineWidth=(m[1]-m[0])/4,this.validateQuietZone(a,m[0]),m}validateQuietZone(a,u){let m=this.narrowLineWidth*10;m=m<u?m:u;for(let v=u-1;m>0&&v>=0&&!a.get(v);v--)m--;if(m!==0)throw new Ie}static skipWhiteSpace(a){const u=a.getSize(),m=a.getNextSet(0);if(m===u)throw new Ie;return m}decodeEnd(a){a.reverse();try{let u=Me.skipWhiteSpace(a),m;try{m=Me.findGuardPattern(a,u,Me.END_PATTERN_REVERSED[0])}catch(w){w instanceof Ie&&(m=Me.findGuardPattern(a,u,Me.END_PATTERN_REVERSED[1]))}this.validateQuietZone(a,m[0]);let v=m[0];return m[0]=a.getSize()-m[1],m[1]=a.getSize()-v,m}finally{a.reverse()}}static findGuardPattern(a,u,m){let v=m.length,w=new Int32Array(v),I=a.getSize(),P=!1,F=0,q=u;w.fill(0);for(let te=u;te<I;te++)if(a.get(te)!==P)w[F]++;else{if(F===v-1){if(at.patternMatchVariance(w,m,Me.MAX_INDIVIDUAL_VARIANCE)<Me.MAX_AVG_VARIANCE)return[q,te];q+=w[0]+w[1],ye.arraycopy(w,2,w,0,F-1),w[F-1]=0,w[F]=0,F--}else F++;w[F]=1,P=!P}throw new Ie}static decodeDigit(a){let u=Me.MAX_AVG_VARIANCE,m=-1,v=Me.PATTERNS.length;for(let w=0;w<v;w++){let I=Me.PATTERNS[w],P=at.patternMatchVariance(a,I,Me.MAX_INDIVIDUAL_VARIANCE);P<u?(u=P,m=w):P===u&&(m=-1)}if(m>=0)return m%10;throw new Ie}}Me.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],Me.MAX_AVG_VARIANCE=.38,Me.MAX_INDIVIDUAL_VARIANCE=.5,Me.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],Me.START_PATTERN=Int32Array.from([1,1,1,1]),Me.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Ue extends at{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(a){let u=!1,m,v=0,w=Int32Array.from([0,0,0]);for(;!u;){w=Int32Array.from([0,0,0]),m=Ue.findGuardPattern(a,v,!1,this.START_END_PATTERN,w);let I=m[0];v=m[1];let P=I-(v-I);P>=0&&(u=a.isRange(P,I,!1))}return m}static checkChecksum(a){return Ue.checkStandardUPCEANChecksum(a)}static checkStandardUPCEANChecksum(a){let u=a.length;if(u===0)return!1;let m=parseInt(a.charAt(u-1),10);return Ue.getStandardUPCEANChecksum(a.substring(0,u-1))===m}static getStandardUPCEANChecksum(a){let u=a.length,m=0;for(let v=u-1;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new tt;m+=w}m*=3;for(let v=u-2;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new tt;m+=w}return(1e3-m)%10}static decodeEnd(a,u){return Ue.findGuardPattern(a,u,!1,Ue.START_END_PATTERN,new Int32Array(Ue.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(a,u,m,v){return this.findGuardPattern(a,u,m,v,new Int32Array(v.length))}static findGuardPattern(a,u,m,v,w){let I=a.getSize();u=m?a.getNextUnset(u):a.getNextSet(u);let P=0,F=u,q=v.length,te=m;for(let ce=u;ce<I;ce++)if(a.get(ce)!==te)w[P]++;else{if(P===q-1){if(at.patternMatchVariance(w,v,Ue.MAX_INDIVIDUAL_VARIANCE)<Ue.MAX_AVG_VARIANCE)return Int32Array.from([F,ce]);F+=w[0]+w[1];let xe=w.slice(2,w.length-1);for(let ze=0;ze<P-1;ze++)w[ze]=xe[ze];w[P-1]=0,w[P]=0,P--}else P++;w[P]=1,te=!te}throw new Ie}static decodeDigit(a,u,m,v){this.recordPattern(a,m,u);let w=this.MAX_AVG_VARIANCE,I=-1,P=v.length;for(let F=0;F<P;F++){let q=v[F],te=at.patternMatchVariance(u,q,Ue.MAX_INDIVIDUAL_VARIANCE);te<w&&(w=te,I=F)}if(I>=0)return I;throw new Ie}}Ue.MAX_AVG_VARIANCE=.48,Ue.MAX_INDIVIDUAL_VARIANCE=.7,Ue.START_END_PATTERN=Int32Array.from([1,1,1]),Ue.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Ue.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Ue.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class xt{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(a,u,m){let v=this.decodeRowStringBuffer,w=this.decodeMiddle(u,m,v),I=v.toString(),P=xt.parseExtensionString(I),F=[new gn((m[0]+m[1])/2,a),new gn(w,a)],q=new Nt(I,null,0,F,Bt.UPC_EAN_EXTENSION,new Date().getTime());return P!=null&&q.putAllMetadata(P),q}decodeMiddle(a,u,m){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],P=0;for(let q=0;q<5&&I<w;q++){let te=Ue.decodeDigit(a,v,I,Ue.L_AND_G_PATTERNS);m+=String.fromCharCode(48+te%10);for(let ce of v)I+=ce;te>=10&&(P|=1<<4-q),q!==4&&(I=a.getNextSet(I),I=a.getNextUnset(I))}if(m.length!==5)throw new Ie;let F=this.determineCheckDigit(P);if(xt.extensionChecksum(m.toString())!==F)throw new Ie;return I}static extensionChecksum(a){let u=a.length,m=0;for(let v=u-2;v>=0;v-=2)m+=a.charAt(v).charCodeAt(0)-48;m*=3;for(let v=u-1;v>=0;v-=2)m+=a.charAt(v).charCodeAt(0)-48;return m*=3,m%10}determineCheckDigit(a){for(let u=0;u<10;u++)if(a===this.CHECK_DIGIT_ENCODINGS[u])return u;throw new Ie}static parseExtensionString(a){if(a.length!==5)return null;let u=xt.parseExtension5String(a);return u==null?null:new Map([[Tn.SUGGESTED_PRICE,u]])}static parseExtension5String(a){let u;switch(a.charAt(0)){case"0":u="";break;case"5":u="$";break;case"9":switch(a){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}u="";break;default:u="";break}let m=parseInt(a.substring(1)),v=(m/100).toString(),w=m%100,I=w<10?"0"+w:w.toString();return u+v+"."+I}}class yt{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(a,u,m){let v=this.decodeRowStringBuffer,w=this.decodeMiddle(u,m,v),I=v.toString(),P=yt.parseExtensionString(I),F=[new gn((m[0]+m[1])/2,a),new gn(w,a)],q=new Nt(I,null,0,F,Bt.UPC_EAN_EXTENSION,new Date().getTime());return P!=null&&q.putAllMetadata(P),q}decodeMiddle(a,u,m){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],P=0;for(let F=0;F<2&&I<w;F++){let q=Ue.decodeDigit(a,v,I,Ue.L_AND_G_PATTERNS);m+=String.fromCharCode(48+q%10);for(let te of v)I+=te;q>=10&&(P|=1<<1-F),F!==1&&(I=a.getNextSet(I),I=a.getNextUnset(I))}if(m.length!==2)throw new Ie;if(parseInt(m.toString())%4!==P)throw new Ie;return I}static parseExtensionString(a){return a.length!==2?null:new Map([[Tn.ISSUE_NUMBER,parseInt(a)]])}}class qt{static decodeRow(a,u,m){let v=Ue.findGuardPattern(u,m,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new xt().decodeRow(a,u,v)}catch{return new yt().decodeRow(a,u,v)}}}qt.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Ot extends Ue{constructor(){super(),this.decodeRowStringBuffer="",Ot.L_AND_G_PATTERNS=Ot.L_PATTERNS.map(a=>Int32Array.from(a));for(let a=10;a<20;a++){let u=Ot.L_PATTERNS[a-10],m=new Int32Array(u.length);for(let v=0;v<u.length;v++)m[v]=u[u.length-v-1];Ot.L_AND_G_PATTERNS[a]=m}}decodeRow(a,u,m){let v=Ot.findStartGuardPattern(u),w=m==null?null:m.get(wt.NEED_RESULT_POINT_CALLBACK);if(w!=null){const un=new gn((v[0]+v[1])/2,a);w.foundPossibleResultPoint(un)}let I=this.decodeMiddle(u,v,this.decodeRowStringBuffer),P=I.rowOffset,F=I.resultString;if(w!=null){const un=new gn(P,a);w.foundPossibleResultPoint(un)}let q=this.decodeEnd(u,P);if(w!=null){const un=new gn((q[0]+q[1])/2,a);w.foundPossibleResultPoint(un)}let te=q[1],ce=te+(te-q[0]);if(ce>=u.getSize()||!u.isRange(te,ce,!1))throw new Ie;let xe=F.toString();if(xe.length<8)throw new tt;if(!Ot.checkChecksum(xe))throw new Ce;let ze=(v[1]+v[0])/2,it=(q[1]+q[0])/2,lt=this.getBarcodeFormat(),Tt=[new gn(ze,a),new gn(it,a)],Ft=new Nt(xe,null,0,Tt,lt,new Date().getTime()),vn=0;try{let un=qt.decodeRow(a,u,q[1]);Ft.putMetadata(Tn.UPC_EAN_EXTENSION,un.getText()),Ft.putAllMetadata(un.getResultMetadata()),Ft.addResultPoints(un.getResultPoints()),vn=un.getText().length}catch{}let yn=m==null?null:m.get(wt.ALLOWED_EAN_EXTENSIONS);if(yn!=null){let un=!1;for(let Ni in yn)if(vn.toString()===Ni){un=!0;break}if(!un)throw new Ie}return Ft}decodeEnd(a,u){return Ot.findGuardPattern(a,u,!1,Ot.START_END_PATTERN,new Int32Array(Ot.START_END_PATTERN.length).fill(0))}static checkChecksum(a){return Ot.checkStandardUPCEANChecksum(a)}static checkStandardUPCEANChecksum(a){let u=a.length;if(u===0)return!1;let m=parseInt(a.charAt(u-1),10);return Ot.getStandardUPCEANChecksum(a.substring(0,u-1))===m}static getStandardUPCEANChecksum(a){let u=a.length,m=0;for(let v=u-1;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new tt;m+=w}m*=3;for(let v=u-2;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new tt;m+=w}return(1e3-m)%10}}class cn extends Ot{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(a,u,m){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],P=0;for(let q=0;q<6&&I<w;q++){let te=Ot.decodeDigit(a,v,I,Ot.L_AND_G_PATTERNS);m+=String.fromCharCode(48+te%10);for(let ce of v)I+=ce;te>=10&&(P|=1<<5-q)}m=cn.determineFirstDigit(m,P),I=Ot.findGuardPattern(a,I,!0,Ot.MIDDLE_PATTERN,new Int32Array(Ot.MIDDLE_PATTERN.length).fill(0))[1];for(let q=0;q<6&&I<w;q++){let te=Ot.decodeDigit(a,v,I,Ot.L_PATTERNS);m+=String.fromCharCode(48+te);for(let ce of v)I+=ce}return{rowOffset:I,resultString:m}}getBarcodeFormat(){return Bt.EAN_13}static determineFirstDigit(a,u){for(let m=0;m<10;m++)if(u===this.FIRST_DIGIT_ENCODINGS[m])return a=String.fromCharCode(48+m)+a,a;throw new Ie}}cn.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Ke extends Ot{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(a,u,m){const v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1];for(let F=0;F<4&&I<w;F++){let q=Ot.decodeDigit(a,v,I,Ot.L_PATTERNS);m+=String.fromCharCode(48+q);for(let te of v)I+=te}I=Ot.findGuardPattern(a,I,!0,Ot.MIDDLE_PATTERN,new Int32Array(Ot.MIDDLE_PATTERN.length).fill(0))[1];for(let F=0;F<4&&I<w;F++){let q=Ot.decodeDigit(a,v,I,Ot.L_PATTERNS);m+=String.fromCharCode(48+q);for(let te of v)I+=te}return{rowOffset:I,resultString:m}}getBarcodeFormat(){return Bt.EAN_8}}class kn extends Ot{constructor(){super(...arguments),this.ean13Reader=new cn}getBarcodeFormat(){return Bt.UPC_A}decode(a,u){return this.maybeReturnResult(this.ean13Reader.decode(a))}decodeRow(a,u,m){return this.maybeReturnResult(this.ean13Reader.decodeRow(a,u,m))}decodeMiddle(a,u,m){return this.ean13Reader.decodeMiddle(a,u,m)}maybeReturnResult(a){let u=a.getText();if(u.charAt(0)==="0"){let m=new Nt(u.substring(1),null,null,a.getResultPoints(),Bt.UPC_A);return a.getResultMetadata()!=null&&m.putAllMetadata(a.getResultMetadata()),m}else throw new Ie}reset(){this.ean13Reader.reset()}}class Fn extends Ot{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(a,u,m){const v=this.decodeMiddleCounters.map(q=>q);v[0]=0,v[1]=0,v[2]=0,v[3]=0;const w=a.getSize();let I=u[1],P=0;for(let q=0;q<6&&I<w;q++){const te=Fn.decodeDigit(a,v,I,Fn.L_AND_G_PATTERNS);m+=String.fromCharCode(48+te%10);for(let ce of v)I+=ce;te>=10&&(P|=1<<5-q)}let F=Fn.determineNumSysAndCheckDigit(m,P);return{rowOffset:I,resultString:F}}decodeEnd(a,u){return Fn.findGuardPatternWithoutCounters(a,u,!0,Fn.MIDDLE_END_PATTERN)}checkChecksum(a){return Ot.checkChecksum(Fn.convertUPCEtoUPCA(a))}static determineNumSysAndCheckDigit(a,u){for(let m=0;m<=1;m++)for(let v=0;v<10;v++)if(u===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[m][v]){let w=String.fromCharCode(48+m),I=String.fromCharCode(48+v);return w+a+I}throw Ie.getNotFoundInstance()}getBarcodeFormat(){return Bt.UPC_E}static convertUPCEtoUPCA(a){const u=a.slice(1,7).split("").map(w=>w.charCodeAt(0)),m=new gt;m.append(a.charAt(0));let v=u[5];switch(v){case 0:case 1:case 2:m.appendChars(u,0,2),m.append(v),m.append("0000"),m.appendChars(u,2,3);break;case 3:m.appendChars(u,0,3),m.append("00000"),m.appendChars(u,3,2);break;case 4:m.appendChars(u,0,4),m.append("00000"),m.append(u[4]);break;default:m.appendChars(u,0,5),m.append("0000"),m.append(v);break}return a.length>=8&&m.append(a.charAt(7)),m.toString()}}Fn.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Fn.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class wn extends at{constructor(a){super();let u=a==null?null:a.get(wt.POSSIBLE_FORMATS),m=[];C(u)?(m.push(new cn),m.push(new kn),m.push(new Ke),m.push(new Fn)):(u.indexOf(Bt.EAN_13)>-1&&m.push(new cn),u.indexOf(Bt.UPC_A)>-1&&m.push(new kn),u.indexOf(Bt.EAN_8)>-1&&m.push(new Ke),u.indexOf(Bt.UPC_E)>-1&&m.push(new Fn)),this.readers=m}decodeRow(a,u,m){for(let v of this.readers)try{const w=v.decodeRow(a,u,m),I=w.getBarcodeFormat()===Bt.EAN_13&&w.getText().charAt(0)==="0",P=m==null?null:m.get(wt.POSSIBLE_FORMATS),F=P==null||P.includes(Bt.UPC_A);if(I&&F){const q=w.getRawBytes(),te=new Nt(w.getText().substring(1),q,q?q.length:null,w.getResultPoints(),Bt.UPC_A);return te.putAllMetadata(w.getResultMetadata()),te}return w}catch{}throw new Ie}reset(){for(let a of this.readers)a.reset()}}class _n extends at{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(a,u){for(let m=0;m<u.length;m++)if(at.patternMatchVariance(a,u[m],_n.MAX_INDIVIDUAL_VARIANCE)<_n.MAX_AVG_VARIANCE)return m;throw new Ie}static count(a){return fn.sum(new Int32Array(a))}static increment(a,u){let m=0,v=u[0];for(let w=1;w<a.length;w++)u[w]>v&&(v=u[w],m=w);a[m]++}static decrement(a,u){let m=0,v=u[0];for(let w=1;w<a.length;w++)u[w]<v&&(v=u[w],m=w);a[m]--}static isFinderPattern(a){let u=a[0]+a[1],m=u+a[2]+a[3],v=u/m;if(v>=_n.MIN_FINDER_PATTERN_RATIO&&v<=_n.MAX_FINDER_PATTERN_RATIO){let w=Number.MAX_SAFE_INTEGER,I=Number.MIN_SAFE_INTEGER;for(let P of a)P>I&&(I=P),P<w&&(w=P);return I<10*w}return!1}}_n.MAX_AVG_VARIANCE=.2,_n.MAX_INDIVIDUAL_VARIANCE=.45,_n.MIN_FINDER_PATTERN_RATIO=9.5/12,_n.MAX_FINDER_PATTERN_RATIO=12.5/14;class gi{constructor(a,u){this.value=a,this.checksumPortion=u}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(a){if(!(a instanceof gi))return!1;const u=a;return this.value===u.value&&this.checksumPortion===u.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Yn{constructor(a,u,m,v,w){this.value=a,this.startEnd=u,this.value=a,this.startEnd=u,this.resultPoints=new Array,this.resultPoints.push(new gn(m,w)),this.resultPoints.push(new gn(v,w))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(a){if(!(a instanceof Yn))return!1;const u=a;return this.value===u.value}hashCode(){return this.value}}class nn{constructor(){}static getRSSvalue(a,u,m){let v=0;for(let F of a)v+=F;let w=0,I=0,P=a.length;for(let F=0;F<P-1;F++){let q;for(q=1,I|=1<<F;q<a[F];q++,I&=~(1<<F)){let te=nn.combins(v-q-1,P-F-2);if(m&&I===0&&v-q-(P-F-1)>=P-F-1&&(te-=nn.combins(v-q-(P-F),P-F-2)),P-F-1>1){let ce=0;for(let xe=v-q-(P-F-2);xe>u;xe--)ce+=nn.combins(v-q-xe-1,P-F-3);te-=ce*(P-1-F)}else v-q>u&&te--;w+=te}v-=q}return w}static combins(a,u){let m,v;a-u>u?(v=u,m=a-u):(v=a-u,m=u);let w=1,I=1;for(let P=a;P>m;P--)w*=P,I<=v&&(w/=I,I++);for(;I<=v;)w/=I,I++;return w}}class Jt{static buildBitArray(a){let u=a.length*2-1;a[a.length-1].getRightChar()==null&&(u-=1);let m=12*u,v=new dt(m),w=0,P=a[0].getRightChar().getValue();for(let F=11;F>=0;--F)(P&1<<F)!=0&&v.set(w),w++;for(let F=1;F<a.length;++F){let q=a[F],te=q.getLeftChar().getValue();for(let ce=11;ce>=0;--ce)(te&1<<ce)!=0&&v.set(w),w++;if(q.getRightChar()!=null){let ce=q.getRightChar().getValue();for(let xe=11;xe>=0;--xe)(ce&1<<xe)!=0&&v.set(w),w++}}return v}}class Bn{constructor(a,u){u?this.decodedInformation=null:(this.finished=a,this.decodedInformation=u)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Di{constructor(a){this.newPosition=a}getNewPosition(){return this.newPosition}}class Fi extends Di{constructor(a,u){super(a),this.value=u}getValue(){return this.value}isFNC1(){return this.value===Fi.FNC1}}Fi.FNC1="$";class Zt extends Di{constructor(a,u,m){super(a),m?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=u}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class xi extends Di{constructor(a,u,m){if(super(a),u<0||u>10||m<0||m>10)throw new tt;this.firstDigit=u,this.secondDigit=m}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===xi.FNC1}isSecondDigitFNC1(){return this.secondDigit===xi.FNC1}isAnyFNC1(){return this.firstDigit===xi.FNC1||this.secondDigit===xi.FNC1}}xi.FNC1=10;class bn{constructor(){}static parseFieldsInGeneralPurpose(a){if(!a)return null;if(a.length<2)throw new Ie;let u=a.substring(0,2);for(let w of bn.TWO_DIGIT_DATA_LENGTH)if(w[0]===u)return w[1]===bn.VARIABLE_LENGTH?bn.processVariableAI(2,w[2],a):bn.processFixedAI(2,w[1],a);if(a.length<3)throw new Ie;let m=a.substring(0,3);for(let w of bn.THREE_DIGIT_DATA_LENGTH)if(w[0]===m)return w[1]===bn.VARIABLE_LENGTH?bn.processVariableAI(3,w[2],a):bn.processFixedAI(3,w[1],a);for(let w of bn.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(w[0]===m)return w[1]===bn.VARIABLE_LENGTH?bn.processVariableAI(4,w[2],a):bn.processFixedAI(4,w[1],a);if(a.length<4)throw new Ie;let v=a.substring(0,4);for(let w of bn.FOUR_DIGIT_DATA_LENGTH)if(w[0]===v)return w[1]===bn.VARIABLE_LENGTH?bn.processVariableAI(4,w[2],a):bn.processFixedAI(4,w[1],a);throw new Ie}static processFixedAI(a,u,m){if(m.length<a)throw new Ie;let v=m.substring(0,a);if(m.length<a+u)throw new Ie;let w=m.substring(a,a+u),I=m.substring(a+u),P="("+v+")"+w,F=bn.parseFieldsInGeneralPurpose(I);return F==null?P:P+F}static processVariableAI(a,u,m){let v=m.substring(0,a),w;m.length<a+u?w=m.length:w=a+u;let I=m.substring(a,w),P=m.substring(w),F="("+v+")"+I,q=bn.parseFieldsInGeneralPurpose(P);return q==null?F:F+q}}bn.VARIABLE_LENGTH=[],bn.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",bn.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",bn.VARIABLE_LENGTH,20],["22",bn.VARIABLE_LENGTH,29],["30",bn.VARIABLE_LENGTH,8],["37",bn.VARIABLE_LENGTH,8],["90",bn.VARIABLE_LENGTH,30],["91",bn.VARIABLE_LENGTH,30],["92",bn.VARIABLE_LENGTH,30],["93",bn.VARIABLE_LENGTH,30],["94",bn.VARIABLE_LENGTH,30],["95",bn.VARIABLE_LENGTH,30],["96",bn.VARIABLE_LENGTH,30],["97",bn.VARIABLE_LENGTH,3],["98",bn.VARIABLE_LENGTH,30],["99",bn.VARIABLE_LENGTH,30]],bn.THREE_DIGIT_DATA_LENGTH=[["240",bn.VARIABLE_LENGTH,30],["241",bn.VARIABLE_LENGTH,30],["242",bn.VARIABLE_LENGTH,6],["250",bn.VARIABLE_LENGTH,30],["251",bn.VARIABLE_LENGTH,30],["253",bn.VARIABLE_LENGTH,17],["254",bn.VARIABLE_LENGTH,20],["400",bn.VARIABLE_LENGTH,30],["401",bn.VARIABLE_LENGTH,30],["402",17],["403",bn.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",bn.VARIABLE_LENGTH,20],["421",bn.VARIABLE_LENGTH,15],["422",3],["423",bn.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],bn.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",bn.VARIABLE_LENGTH,15],["391",bn.VARIABLE_LENGTH,18],["392",bn.VARIABLE_LENGTH,15],["393",bn.VARIABLE_LENGTH,18],["703",bn.VARIABLE_LENGTH,30]],bn.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",bn.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",bn.VARIABLE_LENGTH,20],["8003",bn.VARIABLE_LENGTH,30],["8004",bn.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",bn.VARIABLE_LENGTH,30],["8008",bn.VARIABLE_LENGTH,12],["8018",18],["8020",bn.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",bn.VARIABLE_LENGTH,70],["8200",bn.VARIABLE_LENGTH,70]];class Rr{constructor(a){this.buffer=new gt,this.information=a}decodeAllCodes(a,u){let m=u,v=null;do{let w=this.decodeGeneralPurposeField(m,v),I=bn.parseFieldsInGeneralPurpose(w.getNewString());if(I!=null&&a.append(I),w.isRemaining()?v=""+w.getRemainingValue():v=null,m===w.getNewPosition())break;m=w.getNewPosition()}while(!0);return a.toString()}isStillNumeric(a){if(a+7>this.information.getSize())return a+4<=this.information.getSize();for(let u=a;u<a+3;++u)if(this.information.get(u))return!0;return this.information.get(a+3)}decodeNumeric(a){if(a+7>this.information.getSize()){let w=this.extractNumericValueFromBitArray(a,4);return w===0?new xi(this.information.getSize(),xi.FNC1,xi.FNC1):new xi(this.information.getSize(),w-1,xi.FNC1)}let u=this.extractNumericValueFromBitArray(a,7),m=(u-8)/11,v=(u-8)%11;return new xi(a+7,m,v)}extractNumericValueFromBitArray(a,u){return Rr.extractNumericValueFromBitArray(this.information,a,u)}static extractNumericValueFromBitArray(a,u,m){let v=0;for(let w=0;w<m;++w)a.get(u+w)&&(v|=1<<m-w-1);return v}decodeGeneralPurposeField(a,u){this.buffer.setLengthToZero(),u!=null&&this.buffer.append(u),this.current.setPosition(a);let m=this.parseBlocks();return m!=null&&m.isRemaining()?new Zt(this.current.getPosition(),this.buffer.toString(),m.getRemainingValue()):new Zt(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let a,u;do{let m=this.current.getPosition();if(this.current.isAlpha()?(u=this.parseAlphaBlock(),a=u.isFinished()):this.current.isIsoIec646()?(u=this.parseIsoIec646Block(),a=u.isFinished()):(u=this.parseNumericBlock(),a=u.isFinished()),!(m!==this.current.getPosition())&&!a)break}while(!a);return u.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let a=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFirstDigitFNC1()){let u;return a.isSecondDigitFNC1()?u=new Zt(this.current.getPosition(),this.buffer.toString()):u=new Zt(this.current.getPosition(),this.buffer.toString(),a.getSecondDigit()),new Bn(!0,u)}if(this.buffer.append(a.getFirstDigit()),a.isSecondDigitFNC1()){let u=new Zt(this.current.getPosition(),this.buffer.toString());return new Bn(!0,u)}this.buffer.append(a.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Bn(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let a=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFNC1()){let u=new Zt(this.current.getPosition(),this.buffer.toString());return new Bn(!0,u)}this.buffer.append(a.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Bn(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let a=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFNC1()){let u=new Zt(this.current.getPosition(),this.buffer.toString());return new Bn(!0,u)}this.buffer.append(a.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Bn(!1)}isStillIsoIec646(a){if(a+5>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(a,5);if(u>=5&&u<16)return!0;if(a+7>this.information.getSize())return!1;let m=this.extractNumericValueFromBitArray(a,7);if(m>=64&&m<116)return!0;if(a+8>this.information.getSize())return!1;let v=this.extractNumericValueFromBitArray(a,8);return v>=232&&v<253}decodeIsoIec646(a){let u=this.extractNumericValueFromBitArray(a,5);if(u===15)return new Fi(a+5,Fi.FNC1);if(u>=5&&u<15)return new Fi(a+5,"0"+(u-5));let m=this.extractNumericValueFromBitArray(a,7);if(m>=64&&m<90)return new Fi(a+7,""+(m+1));if(m>=90&&m<116)return new Fi(a+7,""+(m+7));let v=this.extractNumericValueFromBitArray(a,8),w;switch(v){case 232:w="!";break;case 233:w='"';break;case 234:w="%";break;case 235:w="&";break;case 236:w="'";break;case 237:w="(";break;case 238:w=")";break;case 239:w="*";break;case 240:w="+";break;case 241:w=",";break;case 242:w="-";break;case 243:w=".";break;case 244:w="/";break;case 245:w=":";break;case 246:w=";";break;case 247:w="<";break;case 248:w="=";break;case 249:w=">";break;case 250:w="?";break;case 251:w="_";break;case 252:w=" ";break;default:throw new tt}return new Fi(a+8,w)}isStillAlpha(a){if(a+5>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(a,5);if(u>=5&&u<16)return!0;if(a+6>this.information.getSize())return!1;let m=this.extractNumericValueFromBitArray(a,6);return m>=16&&m<63}decodeAlphanumeric(a){let u=this.extractNumericValueFromBitArray(a,5);if(u===15)return new Fi(a+5,Fi.FNC1);if(u>=5&&u<15)return new Fi(a+5,"0"+(u-5));let m=this.extractNumericValueFromBitArray(a,6);if(m>=32&&m<58)return new Fi(a+6,""+(m+33));let v;switch(m){case 58:v="*";break;case 59:v=",";break;case 60:v="-";break;case 61:v=".";break;case 62:v="/";break;default:throw new ti("Decoding invalid alphanumeric value: "+m)}return new Fi(a+6,v)}isAlphaTo646ToAlphaLatch(a){if(a+1>this.information.getSize())return!1;for(let u=0;u<5&&u+a<this.information.getSize();++u)if(u===2){if(!this.information.get(a+2))return!1}else if(this.information.get(a+u))return!1;return!0}isAlphaOr646ToNumericLatch(a){if(a+3>this.information.getSize())return!1;for(let u=a;u<a+3;++u)if(this.information.get(u))return!1;return!0}isNumericToAlphaNumericLatch(a){if(a+1>this.information.getSize())return!1;for(let u=0;u<4&&u+a<this.information.getSize();++u)if(this.information.get(a+u))return!1;return!0}}class vi{constructor(a){this.information=a,this.generalDecoder=new Rr(a)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class jt extends vi{constructor(a){super(a)}encodeCompressedGtin(a,u){a.append("(01)");let m=a.length();a.append("9"),this.encodeCompressedGtinWithoutAI(a,u,m)}encodeCompressedGtinWithoutAI(a,u,m){for(let v=0;v<4;++v){let w=this.getGeneralDecoder().extractNumericValueFromBitArray(u+10*v,10);w/100===0&&a.append("0"),w/10===0&&a.append("0"),a.append(w)}jt.appendCheckDigit(a,m)}static appendCheckDigit(a,u){let m=0;for(let v=0;v<13;v++){let w=a.charAt(v+u).charCodeAt(0)-48;m+=(v&1)===0?3*w:w}m=10-m%10,m===10&&(m=0),a.append(m)}}jt.GTIN_SIZE=40;class Gn extends jt{constructor(a){super(a)}parseInformation(){let a=new gt;a.append("(01)");let u=a.length(),m=this.getGeneralDecoder().extractNumericValueFromBitArray(Gn.HEADER_SIZE,4);return a.append(m),this.encodeCompressedGtinWithoutAI(a,Gn.HEADER_SIZE+4,u),this.getGeneralDecoder().decodeAllCodes(a,Gn.HEADER_SIZE+44)}}Gn.HEADER_SIZE=4;class ni extends vi{constructor(a){super(a)}parseInformation(){let a=new gt;return this.getGeneralDecoder().decodeAllCodes(a,ni.HEADER_SIZE)}}ni.HEADER_SIZE=5;class vs extends jt{constructor(a){super(a)}encodeCompressedWeight(a,u,m){let v=this.getGeneralDecoder().extractNumericValueFromBitArray(u,m);this.addWeightCode(a,v);let w=this.checkWeight(v),I=1e5;for(let P=0;P<5;++P)w/I===0&&a.append("0"),I/=10;a.append(w)}}class ws extends vs{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()!=ws.HEADER_SIZE+vs.GTIN_SIZE+ws.WEIGHT_SIZE)throw new Ie;let a=new gt;return this.encodeCompressedGtin(a,ws.HEADER_SIZE),this.encodeCompressedWeight(a,ws.HEADER_SIZE+vs.GTIN_SIZE,ws.WEIGHT_SIZE),a.toString()}}ws.HEADER_SIZE=5,ws.WEIGHT_SIZE=15;class ia extends ws{constructor(a){super(a)}addWeightCode(a,u){a.append("(3103)")}checkWeight(a){return a}}class ai extends ws{constructor(a){super(a)}addWeightCode(a,u){u<1e4?a.append("(3202)"):a.append("(3203)")}checkWeight(a){return a<1e4?a:a-1e4}}class Rs extends jt{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()<Rs.HEADER_SIZE+jt.GTIN_SIZE)throw new Ie;let a=new gt;this.encodeCompressedGtin(a,Rs.HEADER_SIZE);let u=this.getGeneralDecoder().extractNumericValueFromBitArray(Rs.HEADER_SIZE+jt.GTIN_SIZE,Rs.LAST_DIGIT_SIZE);a.append("(392"),a.append(u),a.append(")");let m=this.getGeneralDecoder().decodeGeneralPurposeField(Rs.HEADER_SIZE+jt.GTIN_SIZE+Rs.LAST_DIGIT_SIZE,null);return a.append(m.getNewString()),a.toString()}}Rs.HEADER_SIZE=8,Rs.LAST_DIGIT_SIZE=2;class Sr extends jt{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()<Sr.HEADER_SIZE+jt.GTIN_SIZE)throw new Ie;let a=new gt;this.encodeCompressedGtin(a,Sr.HEADER_SIZE);let u=this.getGeneralDecoder().extractNumericValueFromBitArray(Sr.HEADER_SIZE+jt.GTIN_SIZE,Sr.LAST_DIGIT_SIZE);a.append("(393"),a.append(u),a.append(")");let m=this.getGeneralDecoder().extractNumericValueFromBitArray(Sr.HEADER_SIZE+jt.GTIN_SIZE+Sr.LAST_DIGIT_SIZE,Sr.FIRST_THREE_DIGITS_SIZE);m/100==0&&a.append("0"),m/10==0&&a.append("0"),a.append(m);let v=this.getGeneralDecoder().decodeGeneralPurposeField(Sr.HEADER_SIZE+jt.GTIN_SIZE+Sr.LAST_DIGIT_SIZE+Sr.FIRST_THREE_DIGITS_SIZE,null);return a.append(v.getNewString()),a.toString()}}Sr.HEADER_SIZE=8,Sr.LAST_DIGIT_SIZE=2,Sr.FIRST_THREE_DIGITS_SIZE=10;class ji extends vs{constructor(a,u,m){super(a),this.dateCode=m,this.firstAIdigits=u}parseInformation(){if(this.getInformation().getSize()!=ji.HEADER_SIZE+ji.GTIN_SIZE+ji.WEIGHT_SIZE+ji.DATE_SIZE)throw new Ie;let a=new gt;return this.encodeCompressedGtin(a,ji.HEADER_SIZE),this.encodeCompressedWeight(a,ji.HEADER_SIZE+ji.GTIN_SIZE,ji.WEIGHT_SIZE),this.encodeCompressedDate(a,ji.HEADER_SIZE+ji.GTIN_SIZE+ji.WEIGHT_SIZE),a.toString()}encodeCompressedDate(a,u){let m=this.getGeneralDecoder().extractNumericValueFromBitArray(u,ji.DATE_SIZE);if(m==38400)return;a.append("("),a.append(this.dateCode),a.append(")");let v=m%32;m/=32;let w=m%12+1;m/=12;let I=m;I/10==0&&a.append("0"),a.append(I),w/10==0&&a.append("0"),a.append(w),v/10==0&&a.append("0"),a.append(v)}addWeightCode(a,u){a.append("("),a.append(this.firstAIdigits),a.append(u/1e5),a.append(")")}checkWeight(a){return a%1e5}}ji.HEADER_SIZE=8,ji.WEIGHT_SIZE=20,ji.DATE_SIZE=16;function da(le){try{if(le.get(1))return new Gn(le);if(!le.get(2))return new ni(le);switch(Rr.extractNumericValueFromBitArray(le,1,4)){case 4:return new ia(le);case 5:return new ai(le)}switch(Rr.extractNumericValueFromBitArray(le,1,5)){case 12:return new Rs(le);case 13:return new Sr(le)}switch(Rr.extractNumericValueFromBitArray(le,1,7)){case 56:return new ji(le,"310","11");case 57:return new ji(le,"320","11");case 58:return new ji(le,"310","13");case 59:return new ji(le,"320","13");case 60:return new ji(le,"310","15");case 61:return new ji(le,"320","15");case 62:return new ji(le,"310","17");case 63:return new ji(le,"320","17")}}catch(a){throw console.log(a),new ti("unknown decoder: "+le)}}class us{constructor(a,u,m,v){this.leftchar=a,this.rightchar=u,this.finderpattern=m,this.maybeLast=v}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(a,u){return a instanceof us?us.equalsOrNull(a.leftchar,u.leftchar)&&us.equalsOrNull(a.rightchar,u.rightchar)&&us.equalsOrNull(a.finderpattern,u.finderpattern):!1}static equalsOrNull(a,u){return a===null?u===null:us.equals(a,u)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class dr{constructor(a,u,m){this.pairs=a,this.rowNumber=u,this.wasReversed=m}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(a){return this.checkEqualitity(this,a)}toString(){return"{ "+this.pairs+" }"}equals(a,u){return a instanceof dr?this.checkEqualitity(a,u)&&a.wasReversed===u.wasReversed:!1}checkEqualitity(a,u){if(!a||!u)return;let m;return a.forEach((v,w)=>{u.forEach(I=>{v.getLeftChar().getValue()===I.getLeftChar().getValue()&&v.getRightChar().getValue()===I.getRightChar().getValue()&&v.getFinderPatter().getValue()===I.getFinderPatter().getValue()&&(m=!0)})}),m}}class an extends _n{constructor(a){super(...arguments),this.pairs=new Array(an.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=a===!0}decodeRow(a,u,m){this.pairs.length=0,this.startFromEven=!1;try{return an.constructResult(this.decodeRow2pairs(a,u))}catch(v){this.verbose&&console.log(v)}return this.pairs.length=0,this.startFromEven=!0,an.constructResult(this.decodeRow2pairs(a,u))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(a,u){let m=!1;for(;!m;)try{this.pairs.push(this.retrieveNextPair(u,this.pairs,a))}catch(w){if(w instanceof Ie){if(!this.pairs.length)throw new Ie;m=!0}}if(this.checkChecksum())return this.pairs;let v;if(this.rows.length?v=!0:v=!1,this.storeRow(a,!1),v){let w=this.checkRowsBoolean(!1);if(w!=null||(w=this.checkRowsBoolean(!0),w!=null))return w}throw new Ie}checkRowsBoolean(a){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,a&&(this.rows=this.rows.reverse());let u=null;try{u=this.checkRows(new Array,0)}catch(m){this.verbose&&console.log(m)}return a&&(this.rows=this.rows.reverse()),u}checkRows(a,u){for(let m=u;m<this.rows.length;m++){let v=this.rows[m];this.pairs.length=0;for(let I of a)this.pairs.push(I.getPairs());if(this.pairs.push(v.getPairs()),!an.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let w=new Array(a);w.push(v);try{return this.checkRows(w,m+1)}catch(I){this.verbose&&console.log(I)}}throw new Ie}static isValidSequence(a){for(let u of an.FINDER_PATTERN_SEQUENCES){if(a.length>u.length)continue;let m=!0;for(let v=0;v<a.length;v++)if(a[v].getFinderPattern().getValue()!=u[v]){m=!1;break}if(m)return!0}return!1}storeRow(a,u){let m=0,v=!1,w=!1;for(;m<this.rows.length;){let I=this.rows[m];if(I.getRowNumber()>a){w=I.isEquivalent(this.pairs);break}v=I.isEquivalent(this.pairs),m++}w||v||an.isPartialRow(this.pairs,this.rows)||(this.rows.push(m,new dr(this.pairs,a,u)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(a,u){for(let m of u)if(m.getPairs().length!==a.length){for(let v of m.getPairs())for(let w of a)if(us.equals(v,w))break}}static isPartialRow(a,u){for(let m of u){let v=!0;for(let w of a){let I=!1;for(let P of m.getPairs())if(w.equals(P)){I=!0;break}if(!I){v=!1;break}}if(v)return!0}return!1}getRows(){return this.rows}static constructResult(a){let u=Jt.buildBitArray(a),v=da(u).parseInformation(),w=a[0].getFinderPattern().getResultPoints(),I=a[a.length-1].getFinderPattern().getResultPoints(),P=[w[0],w[1],I[0],I[1]];return new Nt(v,null,null,P,Bt.RSS_EXPANDED,null)}checkChecksum(){let a=this.pairs.get(0),u=a.getLeftChar(),m=a.getRightChar();if(m==null)return!1;let v=m.getChecksumPortion(),w=2;for(let P=1;P<this.pairs.size();++P){let F=this.pairs.get(P);v+=F.getLeftChar().getChecksumPortion(),w++;let q=F.getRightChar();q!=null&&(v+=q.getChecksumPortion(),w++)}return v%=211,211*(w-4)+v==u.getValue()}static getNextSecondBar(a,u){let m;return a.get(u)?(m=a.getNextUnset(u),m=a.getNextSet(m)):(m=a.getNextSet(u),m=a.getNextUnset(m)),m}retrieveNextPair(a,u,m){let v=u.length%2==0;this.startFromEven&&(v=!v);let w,I=!0,P=-1;do this.findNextPair(a,u,P),w=this.parseFoundFinderPattern(a,m,v),w==null?P=an.getNextSecondBar(a,this.startEnd[0]):I=!1;while(I);let F=this.decodeDataCharacter(a,w,v,!0);if(!this.isEmptyPair(u)&&u[u.length-1].mustBeLast())throw new Ie;let q;try{q=this.decodeDataCharacter(a,w,v,!1)}catch(te){q=null,this.verbose&&console.log(te)}return new us(F,q,w,!0)}isEmptyPair(a){return a.length===0}findNextPair(a,u,m){let v=this.getDecodeFinderCounters();v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I;m>=0?I=m:this.isEmptyPair(u)?I=0:I=u[u.length-1].getFinderPattern().getStartEnd()[1];let P=u.length%2!=0;this.startFromEven&&(P=!P);let F=!1;for(;I<w&&(F=!a.get(I),!!F);)I++;let q=0,te=I;for(let ce=I;ce<w;ce++)if(a.get(ce)!=F)v[q]++;else{if(q==3){if(P&&an.reverseCounters(v),an.isFinderPattern(v)){this.startEnd[0]=te,this.startEnd[1]=ce;return}P&&an.reverseCounters(v),te+=v[0]+v[1],v[0]=v[2],v[1]=v[3],v[2]=0,v[3]=0,q--}else q++;v[q]=1,F=!F}throw new Ie}static reverseCounters(a){let u=a.length;for(let m=0;m<u/2;++m){let v=a[m];a[m]=a[u-m-1],a[u-m-1]=v}}parseFoundFinderPattern(a,u,m){let v,w,I;if(m){let q=this.startEnd[0]-1;for(;q>=0&&!a.get(q);)q--;q++,v=this.startEnd[0]-q,w=q,I=this.startEnd[1]}else w=this.startEnd[0],I=a.getNextUnset(this.startEnd[1]+1),v=I-this.startEnd[1];let P=this.getDecodeFinderCounters();ye.arraycopy(P,0,P,1,P.length-1),P[0]=v;let F;try{F=this.parseFinderValue(P,an.FINDER_PATTERNS)}catch{return null}return new Yn(F,[w,I],w,I,u)}decodeDataCharacter(a,u,m,v){let w=this.getDataCharacterCounters();for(let rr=0;rr<w.length;rr++)w[rr]=0;if(v)an.recordPatternInReverse(a,u.getStartEnd()[0],w);else{an.recordPattern(a,u.getStartEnd()[1],w);for(let rr=0,Vr=w.length-1;rr<Vr;rr++,Vr--){let Ps=w[rr];w[rr]=w[Vr],w[Vr]=Ps}}let I=17,P=fn.sum(new Int32Array(w))/I,F=(u.getStartEnd()[1]-u.getStartEnd()[0])/15;if(Math.abs(P-F)/F>.3)throw new Ie;let q=this.getOddCounts(),te=this.getEvenCounts(),ce=this.getOddRoundingErrors(),xe=this.getEvenRoundingErrors();for(let rr=0;rr<w.length;rr++){let Vr=1*w[rr]/P,Ps=Vr+.5;if(Ps<1){if(Vr<.3)throw new Ie;Ps=1}else if(Ps>8){if(Vr>8.7)throw new Ie;Ps=8}let Ka=rr/2;(rr&1)==0?(q[Ka]=Ps,ce[Ka]=Vr-Ps):(te[Ka]=Ps,xe[Ka]=Vr-Ps)}this.adjustOddEvenCounts(I);let ze=4*u.getValue()+(m?0:2)+(v?0:1)-1,it=0,lt=0;for(let rr=q.length-1;rr>=0;rr--){if(an.isNotA1left(u,m,v)){let Vr=an.WEIGHTS[ze][2*rr];lt+=q[rr]*Vr}it+=q[rr]}let Tt=0;for(let rr=te.length-1;rr>=0;rr--)if(an.isNotA1left(u,m,v)){let Vr=an.WEIGHTS[ze][2*rr+1];Tt+=te[rr]*Vr}let Ft=lt+Tt;if((it&1)!=0||it>13||it<4)throw new Ie;let vn=(13-it)/2,yn=an.SYMBOL_WIDEST[vn],un=9-yn,Ni=nn.getRSSvalue(q,yn,!0),Pn=nn.getRSSvalue(te,un,!1),Ur=an.EVEN_TOTAL_SUBSET[vn],aa=an.GSUM[vn],Ts=Ni*Ur+Pn+aa;return new gi(Ts,Ft)}static isNotA1left(a,u,m){return!(a.getValue()==0&&u&&m)}adjustOddEvenCounts(a){let u=fn.sum(new Int32Array(this.getOddCounts())),m=fn.sum(new Int32Array(this.getEvenCounts())),v=!1,w=!1;u>13?w=!0:u<4&&(v=!0);let I=!1,P=!1;m>13?P=!0:m<4&&(I=!0);let F=u+m-a,q=(u&1)==1,te=(m&1)==0;if(F==1)if(q){if(te)throw new Ie;w=!0}else{if(!te)throw new Ie;P=!0}else if(F==-1)if(q){if(te)throw new Ie;v=!0}else{if(!te)throw new Ie;I=!0}else if(F==0){if(q){if(!te)throw new Ie;u<m?(v=!0,P=!0):(w=!0,I=!0)}else if(te)throw new Ie}else throw new Ie;if(v){if(w)throw new Ie;an.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(w&&an.decrement(this.getOddCounts(),this.getOddRoundingErrors()),I){if(P)throw new Ie;an.increment(this.getEvenCounts(),this.getOddRoundingErrors())}P&&an.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}an.SYMBOL_WIDEST=[7,5,4,3,1],an.EVEN_TOTAL_SUBSET=[4,20,52,104,204],an.GSUM=[0,348,1388,2948,3988],an.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],an.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],an.FINDER_PAT_A=0,an.FINDER_PAT_B=1,an.FINDER_PAT_C=2,an.FINDER_PAT_D=3,an.FINDER_PAT_E=4,an.FINDER_PAT_F=5,an.FINDER_PATTERN_SEQUENCES=[[an.FINDER_PAT_A,an.FINDER_PAT_A],[an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B],[an.FINDER_PAT_A,an.FINDER_PAT_C,an.FINDER_PAT_B,an.FINDER_PAT_D],[an.FINDER_PAT_A,an.FINDER_PAT_E,an.FINDER_PAT_B,an.FINDER_PAT_D,an.FINDER_PAT_C],[an.FINDER_PAT_A,an.FINDER_PAT_E,an.FINDER_PAT_B,an.FINDER_PAT_D,an.FINDER_PAT_D,an.FINDER_PAT_F],[an.FINDER_PAT_A,an.FINDER_PAT_E,an.FINDER_PAT_B,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_F,an.FINDER_PAT_F],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_D],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_E],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_F,an.FINDER_PAT_F],[an.FINDER_PAT_A,an.FINDER_PAT_A,an.FINDER_PAT_B,an.FINDER_PAT_B,an.FINDER_PAT_C,an.FINDER_PAT_D,an.FINDER_PAT_D,an.FINDER_PAT_E,an.FINDER_PAT_E,an.FINDER_PAT_F,an.FINDER_PAT_F]],an.MAX_PAIRS=11;class Es extends gi{constructor(a,u,m){super(a,u),this.count=0,this.finderPattern=m}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Hn extends _n{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(a,u,m){const v=this.decodePair(u,!1,a,m);Hn.addOrTally(this.possibleLeftPairs,v),u.reverse();let w=this.decodePair(u,!0,a,m);Hn.addOrTally(this.possibleRightPairs,w),u.reverse();for(let I of this.possibleLeftPairs)if(I.getCount()>1){for(let P of this.possibleRightPairs)if(P.getCount()>1&&Hn.checkChecksum(I,P))return Hn.constructResult(I,P)}throw new Ie}static addOrTally(a,u){if(u==null)return;let m=!1;for(let v of a)if(v.getValue()===u.getValue()){v.incrementCount(),m=!0;break}m||a.push(u)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(a,u){let m=4537077*a.getValue()+u.getValue(),v=new String(m).toString(),w=new gt;for(let q=13-v.length;q>0;q--)w.append("0");w.append(v);let I=0;for(let q=0;q<13;q++){let te=w.charAt(q).charCodeAt(0)-48;I+=(q&1)===0?3*te:te}I=10-I%10,I===10&&(I=0),w.append(I.toString());let P=a.getFinderPattern().getResultPoints(),F=u.getFinderPattern().getResultPoints();return new Nt(w.toString(),null,0,[P[0],P[1],F[0],F[1]],Bt.RSS_14,new Date().getTime())}static checkChecksum(a,u){let m=(a.getChecksumPortion()+16*u.getChecksumPortion())%79,v=9*a.getFinderPattern().getValue()+u.getFinderPattern().getValue();return v>72&&v--,v>8&&v--,m===v}decodePair(a,u,m,v){try{let w=this.findFinderPattern(a,u),I=this.parseFoundFinderPattern(a,m,u,w),P=v==null?null:v.get(wt.NEED_RESULT_POINT_CALLBACK);if(P!=null){let te=(w[0]+w[1])/2;u&&(te=a.getSize()-1-te),P.foundPossibleResultPoint(new gn(te,m))}let F=this.decodeDataCharacter(a,I,!0),q=this.decodeDataCharacter(a,I,!1);return new Es(1597*F.getValue()+q.getValue(),F.getChecksumPortion()+4*q.getChecksumPortion(),I)}catch{return null}}decodeDataCharacter(a,u,m){let v=this.getDataCharacterCounters();for(let Tt=0;Tt<v.length;Tt++)v[Tt]=0;if(m)at.recordPatternInReverse(a,u.getStartEnd()[0],v);else{at.recordPattern(a,u.getStartEnd()[1]+1,v);for(let Tt=0,Ft=v.length-1;Tt<Ft;Tt++,Ft--){let vn=v[Tt];v[Tt]=v[Ft],v[Ft]=vn}}let w=m?16:15,I=fn.sum(new Int32Array(v))/w,P=this.getOddCounts(),F=this.getEvenCounts(),q=this.getOddRoundingErrors(),te=this.getEvenRoundingErrors();for(let Tt=0;Tt<v.length;Tt++){let Ft=v[Tt]/I,vn=Math.floor(Ft+.5);vn<1?vn=1:vn>8&&(vn=8);let yn=Math.floor(Tt/2);(Tt&1)===0?(P[yn]=vn,q[yn]=Ft-vn):(F[yn]=vn,te[yn]=Ft-vn)}this.adjustOddEvenCounts(m,w);let ce=0,xe=0;for(let Tt=P.length-1;Tt>=0;Tt--)xe*=9,xe+=P[Tt],ce+=P[Tt];let ze=0,it=0;for(let Tt=F.length-1;Tt>=0;Tt--)ze*=9,ze+=F[Tt],it+=F[Tt];let lt=xe+3*ze;if(m){if((ce&1)!==0||ce>12||ce<4)throw new Ie;let Tt=(12-ce)/2,Ft=Hn.OUTSIDE_ODD_WIDEST[Tt],vn=9-Ft,yn=nn.getRSSvalue(P,Ft,!1),un=nn.getRSSvalue(F,vn,!0),Ni=Hn.OUTSIDE_EVEN_TOTAL_SUBSET[Tt],Pn=Hn.OUTSIDE_GSUM[Tt];return new gi(yn*Ni+un+Pn,lt)}else{if((it&1)!==0||it>10||it<4)throw new Ie;let Tt=(10-it)/2,Ft=Hn.INSIDE_ODD_WIDEST[Tt],vn=9-Ft,yn=nn.getRSSvalue(P,Ft,!0),un=nn.getRSSvalue(F,vn,!1),Ni=Hn.INSIDE_ODD_TOTAL_SUBSET[Tt],Pn=Hn.INSIDE_GSUM[Tt];return new gi(un*Ni+yn+Pn,lt)}}findFinderPattern(a,u){let m=this.getDecodeFinderCounters();m[0]=0,m[1]=0,m[2]=0,m[3]=0;let v=a.getSize(),w=!1,I=0;for(;I<v&&(w=!a.get(I),u!==w);)I++;let P=0,F=I;for(let q=I;q<v;q++)if(a.get(q)!==w)m[P]++;else{if(P===3){if(_n.isFinderPattern(m))return[F,q];F+=m[0]+m[1],m[0]=m[2],m[1]=m[3],m[2]=0,m[3]=0,P--}else P++;m[P]=1,w=!w}throw new Ie}parseFoundFinderPattern(a,u,m,v){let w=a.get(v[0]),I=v[0]-1;for(;I>=0&&w!==a.get(I);)I--;I++;const P=v[0]-I,F=this.getDecodeFinderCounters(),q=new Int32Array(F.length);ye.arraycopy(F,0,q,1,F.length-1),q[0]=P;const te=this.parseFinderValue(q,Hn.FINDER_PATTERNS);let ce=I,xe=v[1];return m&&(ce=a.getSize()-1-ce,xe=a.getSize()-1-xe),new Yn(te,[I,v[1]],ce,xe,u)}adjustOddEvenCounts(a,u){let m=fn.sum(new Int32Array(this.getOddCounts())),v=fn.sum(new Int32Array(this.getEvenCounts())),w=!1,I=!1,P=!1,F=!1;a?(m>12?I=!0:m<4&&(w=!0),v>12?F=!0:v<4&&(P=!0)):(m>11?I=!0:m<5&&(w=!0),v>10?F=!0:v<4&&(P=!0));let q=m+v-u,te=(m&1)===(a?1:0),ce=(v&1)===1;if(q===1)if(te){if(ce)throw new Ie;I=!0}else{if(!ce)throw new Ie;F=!0}else if(q===-1)if(te){if(ce)throw new Ie;w=!0}else{if(!ce)throw new Ie;P=!0}else if(q===0){if(te){if(!ce)throw new Ie;m<v?(w=!0,F=!0):(I=!0,P=!0)}else if(ce)throw new Ie}else throw new Ie;if(w){if(I)throw new Ie;_n.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(I&&_n.decrement(this.getOddCounts(),this.getOddRoundingErrors()),P){if(F)throw new Ie;_n.increment(this.getEvenCounts(),this.getOddRoundingErrors())}F&&_n.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Hn.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Hn.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Hn.OUTSIDE_GSUM=[0,161,961,2015,2715],Hn.INSIDE_GSUM=[0,336,1036,1516],Hn.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Hn.INSIDE_ODD_WIDEST=[2,4,6,8],Hn.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class hs extends at{constructor(a,u){super(),this.readers=[],this.verbose=u===!0;const m=a?a.get(wt.POSSIBLE_FORMATS):null,v=a&&a.get(wt.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;m?((m.includes(Bt.EAN_13)||m.includes(Bt.UPC_A)||m.includes(Bt.EAN_8)||m.includes(Bt.UPC_E))&&this.readers.push(new wn(a)),m.includes(Bt.CODE_39)&&this.readers.push(new de(v)),m.includes(Bt.CODE_128)&&this.readers.push(new fe),m.includes(Bt.ITF)&&this.readers.push(new Me),m.includes(Bt.RSS_14)&&this.readers.push(new Hn),m.includes(Bt.RSS_EXPANDED)&&this.readers.push(new an(this.verbose))):(this.readers.push(new wn(a)),this.readers.push(new de),this.readers.push(new wn(a)),this.readers.push(new fe),this.readers.push(new Me),this.readers.push(new Hn),this.readers.push(new an(this.verbose)))}decodeRow(a,u,m){for(let v=0;v<this.readers.length;v++)try{return this.readers[v].decodeRow(a,u,m)}catch{}throw new Ie}reset(){this.readers.forEach(a=>a.reset())}}class Yo extends It{constructor(a=500,u){super(new hs(u),a,u)}}class Pi{constructor(a,u,m){this.ecCodewords=a,this.ecBlocks=[u],m&&this.ecBlocks.push(m)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class Ai{constructor(a,u){this.count=a,this.dataCodewords=u}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class yi{constructor(a,u,m,v,w,I){this.versionNumber=a,this.symbolSizeRows=u,this.symbolSizeColumns=m,this.dataRegionSizeRows=v,this.dataRegionSizeColumns=w,this.ecBlocks=I;let P=0;const F=I.getECCodewords(),q=I.getECBlocks();for(let te of q)P+=te.getCount()*(te.getDataCodewords()+F);this.totalCodewords=P}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(a,u){if((a&1)!==0||(u&1)!==0)throw new tt;for(let m of yi.VERSIONS)if(m.symbolSizeRows===a&&m.symbolSizeColumns===u)return m;throw new tt}toString(){return""+this.versionNumber}static buildVersions(){return[new yi(1,10,10,8,8,new Pi(5,new Ai(1,3))),new yi(2,12,12,10,10,new Pi(7,new Ai(1,5))),new yi(3,14,14,12,12,new Pi(10,new Ai(1,8))),new yi(4,16,16,14,14,new Pi(12,new Ai(1,12))),new yi(5,18,18,16,16,new Pi(14,new Ai(1,18))),new yi(6,20,20,18,18,new Pi(18,new Ai(1,22))),new yi(7,22,22,20,20,new Pi(20,new Ai(1,30))),new yi(8,24,24,22,22,new Pi(24,new Ai(1,36))),new yi(9,26,26,24,24,new Pi(28,new Ai(1,44))),new yi(10,32,32,14,14,new Pi(36,new Ai(1,62))),new yi(11,36,36,16,16,new Pi(42,new Ai(1,86))),new yi(12,40,40,18,18,new Pi(48,new Ai(1,114))),new yi(13,44,44,20,20,new Pi(56,new Ai(1,144))),new yi(14,48,48,22,22,new Pi(68,new Ai(1,174))),new yi(15,52,52,24,24,new Pi(42,new Ai(2,102))),new yi(16,64,64,14,14,new Pi(56,new Ai(2,140))),new yi(17,72,72,16,16,new Pi(36,new Ai(4,92))),new yi(18,80,80,18,18,new Pi(48,new Ai(4,114))),new yi(19,88,88,20,20,new Pi(56,new Ai(4,144))),new yi(20,96,96,22,22,new Pi(68,new Ai(4,174))),new yi(21,104,104,24,24,new Pi(56,new Ai(6,136))),new yi(22,120,120,18,18,new Pi(68,new Ai(6,175))),new yi(23,132,132,20,20,new Pi(62,new Ai(8,163))),new yi(24,144,144,22,22,new Pi(62,new Ai(8,156),new Ai(2,155))),new yi(25,8,18,6,16,new Pi(7,new Ai(1,5))),new yi(26,8,32,6,14,new Pi(11,new Ai(1,10))),new yi(27,12,26,10,24,new Pi(14,new Ai(1,16))),new yi(28,12,36,10,16,new Pi(18,new Ai(1,22))),new yi(29,16,36,14,16,new Pi(24,new Ai(1,32))),new yi(30,16,48,14,22,new Pi(28,new Ai(1,49)))]}}yi.VERSIONS=yi.buildVersions();class fo{constructor(a){const u=a.getHeight();if(u<8||u>144||(u&1)!==0)throw new tt;this.version=fo.readVersion(a),this.mappingBitMatrix=this.extractDataRegion(a),this.readMappingMatrix=new Rt(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(a){const u=a.getHeight(),m=a.getWidth();return yi.getVersionForDimensions(u,m)}readCodewords(){const a=new Int8Array(this.version.getTotalCodewords());let u=0,m=4,v=0;const w=this.mappingBitMatrix.getHeight(),I=this.mappingBitMatrix.getWidth();let P=!1,F=!1,q=!1,te=!1;do if(m===w&&v===0&&!P)a[u++]=this.readCorner1(w,I)&255,m-=2,v+=2,P=!0;else if(m===w-2&&v===0&&(I&3)!==0&&!F)a[u++]=this.readCorner2(w,I)&255,m-=2,v+=2,F=!0;else if(m===w+4&&v===2&&(I&7)===0&&!q)a[u++]=this.readCorner3(w,I)&255,m-=2,v+=2,q=!0;else if(m===w-2&&v===0&&(I&7)===4&&!te)a[u++]=this.readCorner4(w,I)&255,m-=2,v+=2,te=!0;else{do m<w&&v>=0&&!this.readMappingMatrix.get(v,m)&&(a[u++]=this.readUtah(m,v,w,I)&255),m-=2,v+=2;while(m>=0&&v<I);m+=1,v+=3;do m>=0&&v<I&&!this.readMappingMatrix.get(v,m)&&(a[u++]=this.readUtah(m,v,w,I)&255),m+=2,v-=2;while(m<w&&v>=0);m+=3,v+=1}while(m<w||v<I);if(u!==this.version.getTotalCodewords())throw new tt;return a}readModule(a,u,m,v){return a<0&&(a+=m,u+=4-(m+4&7)),u<0&&(u+=v,a+=4-(v+4&7)),this.readMappingMatrix.set(u,a),this.mappingBitMatrix.get(u,a)}readUtah(a,u,m,v){let w=0;return this.readModule(a-2,u-2,m,v)&&(w|=1),w<<=1,this.readModule(a-2,u-1,m,v)&&(w|=1),w<<=1,this.readModule(a-1,u-2,m,v)&&(w|=1),w<<=1,this.readModule(a-1,u-1,m,v)&&(w|=1),w<<=1,this.readModule(a-1,u,m,v)&&(w|=1),w<<=1,this.readModule(a,u-2,m,v)&&(w|=1),w<<=1,this.readModule(a,u-1,m,v)&&(w|=1),w<<=1,this.readModule(a,u,m,v)&&(w|=1),w}readCorner1(a,u){let m=0;return this.readModule(a-1,0,a,u)&&(m|=1),m<<=1,this.readModule(a-1,1,a,u)&&(m|=1),m<<=1,this.readModule(a-1,2,a,u)&&(m|=1),m<<=1,this.readModule(0,u-2,a,u)&&(m|=1),m<<=1,this.readModule(0,u-1,a,u)&&(m|=1),m<<=1,this.readModule(1,u-1,a,u)&&(m|=1),m<<=1,this.readModule(2,u-1,a,u)&&(m|=1),m<<=1,this.readModule(3,u-1,a,u)&&(m|=1),m}readCorner2(a,u){let m=0;return this.readModule(a-3,0,a,u)&&(m|=1),m<<=1,this.readModule(a-2,0,a,u)&&(m|=1),m<<=1,this.readModule(a-1,0,a,u)&&(m|=1),m<<=1,this.readModule(0,u-4,a,u)&&(m|=1),m<<=1,this.readModule(0,u-3,a,u)&&(m|=1),m<<=1,this.readModule(0,u-2,a,u)&&(m|=1),m<<=1,this.readModule(0,u-1,a,u)&&(m|=1),m<<=1,this.readModule(1,u-1,a,u)&&(m|=1),m}readCorner3(a,u){let m=0;return this.readModule(a-1,0,a,u)&&(m|=1),m<<=1,this.readModule(a-1,u-1,a,u)&&(m|=1),m<<=1,this.readModule(0,u-3,a,u)&&(m|=1),m<<=1,this.readModule(0,u-2,a,u)&&(m|=1),m<<=1,this.readModule(0,u-1,a,u)&&(m|=1),m<<=1,this.readModule(1,u-3,a,u)&&(m|=1),m<<=1,this.readModule(1,u-2,a,u)&&(m|=1),m<<=1,this.readModule(1,u-1,a,u)&&(m|=1),m}readCorner4(a,u){let m=0;return this.readModule(a-3,0,a,u)&&(m|=1),m<<=1,this.readModule(a-2,0,a,u)&&(m|=1),m<<=1,this.readModule(a-1,0,a,u)&&(m|=1),m<<=1,this.readModule(0,u-2,a,u)&&(m|=1),m<<=1,this.readModule(0,u-1,a,u)&&(m|=1),m<<=1,this.readModule(1,u-1,a,u)&&(m|=1),m<<=1,this.readModule(2,u-1,a,u)&&(m|=1),m<<=1,this.readModule(3,u-1,a,u)&&(m|=1),m}extractDataRegion(a){const u=this.version.getSymbolSizeRows(),m=this.version.getSymbolSizeColumns();if(a.getHeight()!==u)throw new K("Dimension of bitMatrix must match the version size");const v=this.version.getDataRegionSizeRows(),w=this.version.getDataRegionSizeColumns(),I=u/v|0,P=m/w|0,F=I*v,q=P*w,te=new Rt(q,F);for(let ce=0;ce<I;++ce){const xe=ce*v;for(let ze=0;ze<P;++ze){const it=ze*w;for(let lt=0;lt<v;++lt){const Tt=ce*(v+2)+1+lt,Ft=xe+lt;for(let vn=0;vn<w;++vn){const yn=ze*(w+2)+1+vn;if(a.get(yn,Tt)){const un=it+vn;te.set(un,Ft)}}}}}return te}}class fa{constructor(a,u){this.numDataCodewords=a,this.codewords=u}static getDataBlocks(a,u){const m=u.getECBlocks();let v=0;const w=m.getECBlocks();for(let lt of w)v+=lt.getCount();const I=new Array(v);let P=0;for(let lt of w)for(let Tt=0;Tt<lt.getCount();Tt++){const Ft=lt.getDataCodewords(),vn=m.getECCodewords()+Ft;I[P++]=new fa(Ft,new Uint8Array(vn))}const q=I[0].codewords.length-m.getECCodewords(),te=q-1;let ce=0;for(let lt=0;lt<te;lt++)for(let Tt=0;Tt<P;Tt++)I[Tt].codewords[lt]=a[ce++];const xe=u.getVersionNumber()===24,ze=xe?8:P;for(let lt=0;lt<ze;lt++)I[lt].codewords[q-1]=a[ce++];const it=I[0].codewords.length;for(let lt=q;lt<it;lt++)for(let Tt=0;Tt<P;Tt++){const Ft=xe?(Tt+8)%P:Tt,vn=xe&&Ft>7?lt-1:lt;I[Ft].codewords[vn]=a[ce++]}if(ce!==a.length)throw new K;return I}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Ds{constructor(a){this.bytes=a,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(a){if(a<1||a>32||a>this.available())throw new K(""+a);let u=0,m=this.bitOffset,v=this.byteOffset;const w=this.bytes;if(m>0){const I=8-m,P=a<I?a:I,F=I-P,q=255>>8-P<<F;u=(w[v]&q)>>F,a-=P,m+=P,m===8&&(m=0,v++)}if(a>0){for(;a>=8;)u=u<<8|w[v]&255,v++,a-=8;if(a>0){const I=8-a,P=255>>I<<I;u=u<<a|(w[v]&P)>>I,m+=a}}return this.bitOffset=m,this.byteOffset=v,u}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Jn;(function(le){le[le.PAD_ENCODE=0]="PAD_ENCODE",le[le.ASCII_ENCODE=1]="ASCII_ENCODE",le[le.C40_ENCODE=2]="C40_ENCODE",le[le.TEXT_ENCODE=3]="TEXT_ENCODE",le[le.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",le[le.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",le[le.BASE256_ENCODE=6]="BASE256_ENCODE"})(Jn||(Jn={}));class Ra{static decode(a){const u=new Ds(a),m=new gt,v=new gt,w=new Array;let I=Jn.ASCII_ENCODE;do if(I===Jn.ASCII_ENCODE)I=this.decodeAsciiSegment(u,m,v);else{switch(I){case Jn.C40_ENCODE:this.decodeC40Segment(u,m);break;case Jn.TEXT_ENCODE:this.decodeTextSegment(u,m);break;case Jn.ANSIX12_ENCODE:this.decodeAnsiX12Segment(u,m);break;case Jn.EDIFACT_ENCODE:this.decodeEdifactSegment(u,m);break;case Jn.BASE256_ENCODE:this.decodeBase256Segment(u,m,w);break;default:throw new tt}I=Jn.ASCII_ENCODE}while(I!==Jn.PAD_ENCODE&&u.available()>0);return v.length()>0&&m.append(v.toString()),new Rn(a,m.toString(),w.length===0?null:w,null)}static decodeAsciiSegment(a,u,m){let v=!1;do{let w=a.readBits(8);if(w===0)throw new tt;if(w<=128)return v&&(w+=128),u.append(String.fromCharCode(w-1)),Jn.ASCII_ENCODE;if(w===129)return Jn.PAD_ENCODE;if(w<=229){const I=w-130;I<10&&u.append("0"),u.append(""+I)}else switch(w){case 230:return Jn.C40_ENCODE;case 231:return Jn.BASE256_ENCODE;case 232:u.append("");break;case 233:case 234:break;case 235:v=!0;break;case 236:u.append("[)>05"),m.insert(0,"");break;case 237:u.append("[)>06"),m.insert(0,"");break;case 238:return Jn.ANSIX12_ENCODE;case 239:return Jn.TEXT_ENCODE;case 240:return Jn.EDIFACT_ENCODE;case 241:break;default:if(w!==254||a.available()!==0)throw new tt;break}}while(a.available()>0);return Jn.ASCII_ENCODE}static decodeC40Segment(a,u){let m=!1;const v=[];let w=0;do{if(a.available()===8)return;const I=a.readBits(8);if(I===254)return;this.parseTwoBytes(I,a.readBits(8),v);for(let P=0;P<3;P++){const F=v[P];switch(w){case 0:if(F<3)w=F+1;else if(F<this.C40_BASIC_SET_CHARS.length){const q=this.C40_BASIC_SET_CHARS[F];m?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),m=!1):u.append(q)}else throw new tt;break;case 1:m?(u.append(String.fromCharCode(F+128)),m=!1):u.append(String.fromCharCode(F)),w=0;break;case 2:if(F<this.C40_SHIFT2_SET_CHARS.length){const q=this.C40_SHIFT2_SET_CHARS[F];m?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),m=!1):u.append(q)}else switch(F){case 27:u.append("");break;case 30:m=!0;break;default:throw new tt}w=0;break;case 3:m?(u.append(String.fromCharCode(F+224)),m=!1):u.append(String.fromCharCode(F+96)),w=0;break;default:throw new tt}}}while(a.available()>0)}static decodeTextSegment(a,u){let m=!1,v=[],w=0;do{if(a.available()===8)return;const I=a.readBits(8);if(I===254)return;this.parseTwoBytes(I,a.readBits(8),v);for(let P=0;P<3;P++){const F=v[P];switch(w){case 0:if(F<3)w=F+1;else if(F<this.TEXT_BASIC_SET_CHARS.length){const q=this.TEXT_BASIC_SET_CHARS[F];m?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),m=!1):u.append(q)}else throw new tt;break;case 1:m?(u.append(String.fromCharCode(F+128)),m=!1):u.append(String.fromCharCode(F)),w=0;break;case 2:if(F<this.TEXT_SHIFT2_SET_CHARS.length){const q=this.TEXT_SHIFT2_SET_CHARS[F];m?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),m=!1):u.append(q)}else switch(F){case 27:u.append("");break;case 30:m=!0;break;default:throw new tt}w=0;break;case 3:if(F<this.TEXT_SHIFT3_SET_CHARS.length){const q=this.TEXT_SHIFT3_SET_CHARS[F];m?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),m=!1):u.append(q),w=0}else throw new tt;break;default:throw new tt}}}while(a.available()>0)}static decodeAnsiX12Segment(a,u){const m=[];do{if(a.available()===8)return;const v=a.readBits(8);if(v===254)return;this.parseTwoBytes(v,a.readBits(8),m);for(let w=0;w<3;w++){const I=m[w];switch(I){case 0:u.append("\r");break;case 1:u.append("*");break;case 2:u.append(">");break;case 3:u.append(" ");break;default:if(I<14)u.append(String.fromCharCode(I+44));else if(I<40)u.append(String.fromCharCode(I+51));else throw new tt;break}}}while(a.available()>0)}static parseTwoBytes(a,u,m){let v=(a<<8)+u-1,w=Math.floor(v/1600);m[0]=w,v-=w*1600,w=Math.floor(v/40),m[1]=w,m[2]=v-w*40}static decodeEdifactSegment(a,u){do{if(a.available()<=16)return;for(let m=0;m<4;m++){let v=a.readBits(6);if(v===31){const w=8-a.getBitOffset();w!==8&&a.readBits(w);return}(v&32)===0&&(v|=64),u.append(String.fromCharCode(v))}}while(a.available()>0)}static decodeBase256Segment(a,u,m){let v=1+a.getByteOffset();const w=this.unrandomize255State(a.readBits(8),v++);let I;if(w===0?I=a.available()/8|0:w<250?I=w:I=250*(w-249)+this.unrandomize255State(a.readBits(8),v++),I<0)throw new tt;const P=new Uint8Array(I);for(let F=0;F<I;F++){if(a.available()<8)throw new tt;P[F]=this.unrandomize255State(a.readBits(8),v++)}m.push(P);try{u.append(Pe.decode(P,ot.ISO88591))}catch(F){throw new ti("Platform does not support required encoding: "+F.message)}}static unrandomize255State(a,u){const m=149*u%255+1,v=a-m;return v>=0?v:v+256}}Ra.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],Ra.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Ra.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Ra.TEXT_SHIFT2_SET_CHARS=Ra.C40_SHIFT2_SET_CHARS,Ra.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class uu{constructor(){this.rsDecoder=new Bi(Kn.DATA_MATRIX_FIELD_256)}decode(a){const u=new fo(a),m=u.getVersion(),v=u.readCodewords(),w=fa.getDataBlocks(v,m);let I=0;for(let q of w)I+=q.getNumDataCodewords();const P=new Uint8Array(I),F=w.length;for(let q=0;q<F;q++){const te=w[q],ce=te.getCodewords(),xe=te.getNumDataCodewords();this.correctErrors(ce,xe);for(let ze=0;ze<xe;ze++)P[ze*F+q]=ce[ze]}return Ra.decode(P)}correctErrors(a,u){const m=new Int32Array(a);try{this.rsDecoder.decode(m,a.length-u)}catch{throw new Ce}for(let v=0;v<u;v++)a[v]=m[v]}}class or{constructor(a){this.image=a,this.rectangleDetector=new fi(this.image)}detect(){const a=this.rectangleDetector.detect();let u=this.detectSolid1(a);if(u=this.detectSolid2(u),u[3]=this.correctTopRight(u),!u[3])throw new Ie;u=this.shiftToModuleCenter(u);const m=u[0],v=u[1],w=u[2],I=u[3];let P=this.transitionsBetween(m,I)+1,F=this.transitionsBetween(w,I)+1;(P&1)===1&&(P+=1),(F&1)===1&&(F+=1),4*P<7*F&&4*F<7*P&&(P=F=Math.max(P,F));let q=or.sampleGrid(this.image,m,v,w,I,P,F);return new Zn(q,[m,v,w,I])}static shiftPoint(a,u,m){let v=(u.getX()-a.getX())/(m+1),w=(u.getY()-a.getY())/(m+1);return new gn(a.getX()+v,a.getY()+w)}static moveAway(a,u,m){let v=a.getX(),w=a.getY();return v<u?v-=1:v+=1,w<m?w-=1:w+=1,new gn(v,w)}detectSolid1(a){let u=a[0],m=a[1],v=a[3],w=a[2],I=this.transitionsBetween(u,m),P=this.transitionsBetween(m,v),F=this.transitionsBetween(v,w),q=this.transitionsBetween(w,u),te=I,ce=[w,u,m,v];return te>P&&(te=P,ce[0]=u,ce[1]=m,ce[2]=v,ce[3]=w),te>F&&(te=F,ce[0]=m,ce[1]=v,ce[2]=w,ce[3]=u),te>q&&(ce[0]=v,ce[1]=w,ce[2]=u,ce[3]=m),ce}detectSolid2(a){let u=a[0],m=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w),P=or.shiftPoint(m,v,(I+1)*4),F=or.shiftPoint(v,m,(I+1)*4),q=this.transitionsBetween(P,u),te=this.transitionsBetween(F,w);return q<te?(a[0]=u,a[1]=m,a[2]=v,a[3]=w):(a[0]=m,a[1]=v,a[2]=w,a[3]=u),a}correctTopRight(a){let u=a[0],m=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w),P=this.transitionsBetween(m,w),F=or.shiftPoint(u,m,(P+1)*4),q=or.shiftPoint(v,m,(I+1)*4);I=this.transitionsBetween(F,w),P=this.transitionsBetween(q,w);let te=new gn(w.getX()+(v.getX()-m.getX())/(I+1),w.getY()+(v.getY()-m.getY())/(I+1)),ce=new gn(w.getX()+(u.getX()-m.getX())/(P+1),w.getY()+(u.getY()-m.getY())/(P+1));if(!this.isValid(te))return this.isValid(ce)?ce:null;if(!this.isValid(ce))return te;let xe=this.transitionsBetween(F,te)+this.transitionsBetween(q,te),ze=this.transitionsBetween(F,ce)+this.transitionsBetween(q,ce);return xe>ze?te:ce}shiftToModuleCenter(a){let u=a[0],m=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w)+1,P=this.transitionsBetween(v,w)+1,F=or.shiftPoint(u,m,P*4),q=or.shiftPoint(v,m,I*4);I=this.transitionsBetween(F,w)+1,P=this.transitionsBetween(q,w)+1,(I&1)===1&&(I+=1),(P&1)===1&&(P+=1);let te=(u.getX()+m.getX()+v.getX()+w.getX())/4,ce=(u.getY()+m.getY()+v.getY()+w.getY())/4;u=or.moveAway(u,te,ce),m=or.moveAway(m,te,ce),v=or.moveAway(v,te,ce),w=or.moveAway(w,te,ce);let xe,ze;return F=or.shiftPoint(u,m,P*4),F=or.shiftPoint(F,w,I*4),xe=or.shiftPoint(m,u,P*4),xe=or.shiftPoint(xe,v,I*4),q=or.shiftPoint(v,w,P*4),q=or.shiftPoint(q,m,I*4),ze=or.shiftPoint(w,v,P*4),ze=or.shiftPoint(ze,u,I*4),[F,xe,q,ze]}isValid(a){return a.getX()>=0&&a.getX()<this.image.getWidth()&&a.getY()>0&&a.getY()<this.image.getHeight()}static sampleGrid(a,u,m,v,w,I,P){return ue.getInstance().sampleGrid(a,I,P,.5,.5,I-.5,.5,I-.5,P-.5,.5,P-.5,u.getX(),u.getY(),w.getX(),w.getY(),v.getX(),v.getY(),m.getX(),m.getY())}transitionsBetween(a,u){let m=Math.trunc(a.getX()),v=Math.trunc(a.getY()),w=Math.trunc(u.getX()),I=Math.trunc(u.getY()),P=Math.abs(I-v)>Math.abs(w-m);if(P){let lt=m;m=v,v=lt,lt=w,w=I,I=lt}let F=Math.abs(w-m),q=Math.abs(I-v),te=-F/2,ce=v<I?1:-1,xe=m<w?1:-1,ze=0,it=this.image.get(P?v:m,P?m:v);for(let lt=m,Tt=v;lt!==w;lt+=xe){let Ft=this.image.get(P?Tt:lt,P?lt:Tt);if(Ft!==it&&(ze++,it=Ft),te+=q,te>0){if(Tt===I)break;Tt+=ce,te-=F}}return ze}}class vt{constructor(){this.decoder=new uu}decode(a,u=null){let m,v;if(u!=null&&u.has(wt.PURE_BARCODE)){const q=vt.extractPureBits(a.getBlackMatrix());m=this.decoder.decode(q),v=vt.NO_POINTS}else{const q=new or(a.getBlackMatrix()).detect();m=this.decoder.decode(q.getBits()),v=q.getPoints()}const w=m.getRawBytes(),I=new Nt(m.getText(),w,8*w.length,v,Bt.DATA_MATRIX,ye.currentTimeMillis()),P=m.getByteSegments();P!=null&&I.putMetadata(Tn.BYTE_SEGMENTS,P);const F=m.getECLevel();return F!=null&&I.putMetadata(Tn.ERROR_CORRECTION_LEVEL,F),I}reset(){}static extractPureBits(a){const u=a.getTopLeftOnBit(),m=a.getBottomRightOnBit();if(u==null||m==null)throw new Ie;const v=this.moduleSize(u,a);let w=u[1];const I=m[1];let P=u[0];const q=(m[0]-P+1)/v,te=(I-w+1)/v;if(q<=0||te<=0)throw new Ie;const ce=v/2;w+=ce,P+=ce;const xe=new Rt(q,te);for(let ze=0;ze<te;ze++){const it=w+ze*v;for(let lt=0;lt<q;lt++)a.get(P+lt*v,it)&&xe.set(lt,ze)}return xe}static moduleSize(a,u){const m=u.getWidth();let v=a[0];const w=a[1];for(;v<m&&u.get(v,w);)v++;if(v===m)throw new Ie;const I=v-a[0];if(I===0)throw new Ie;return I}}vt.NO_POINTS=[];class tn extends It{constructor(a=500){super(new vt,a)}}var xn;(function(le){le[le.L=0]="L",le[le.M=1]="M",le[le.Q=2]="Q",le[le.H=3]="H"})(xn||(xn={}));class on{constructor(a,u,m){this.value=a,this.stringValue=u,this.bits=m,on.FOR_BITS.set(m,this),on.FOR_VALUE.set(a,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(a){switch(a){case"L":return on.L;case"M":return on.M;case"Q":return on.Q;case"H":return on.H;default:throw new $(a+"not available")}}toString(){return this.stringValue}equals(a){if(!(a instanceof on))return!1;const u=a;return this.value===u.value}static forBits(a){if(a<0||a>=on.FOR_BITS.size)throw new K;return on.FOR_BITS.get(a)}}on.FOR_BITS=new Map,on.FOR_VALUE=new Map,on.L=new on(xn.L,"L",1),on.M=new on(xn.M,"M",0),on.Q=new on(xn.Q,"Q",3),on.H=new on(xn.H,"H",2);class pn{constructor(a){this.errorCorrectionLevel=on.forBits(a>>3&3),this.dataMask=a&7}static numBitsDiffering(a,u){return Qe.bitCount(a^u)}static decodeFormatInformation(a,u){const m=pn.doDecodeFormatInformation(a,u);return m!==null?m:pn.doDecodeFormatInformation(a^pn.FORMAT_INFO_MASK_QR,u^pn.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(a,u){let m=Number.MAX_SAFE_INTEGER,v=0;for(const w of pn.FORMAT_INFO_DECODE_LOOKUP){const I=w[0];if(I===a||I===u)return new pn(w[1]);let P=pn.numBitsDiffering(a,I);P<m&&(v=w[1],m=P),a!==u&&(P=pn.numBitsDiffering(u,I),P<m&&(v=w[1],m=P))}return m<=3?new pn(v):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(a){if(!(a instanceof pn))return!1;const u=a;return this.errorCorrectionLevel===u.errorCorrectionLevel&&this.dataMask===u.dataMask}}pn.FORMAT_INFO_MASK_QR=21522,pn.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class ft{constructor(a,...u){this.ecCodewordsPerBlock=a,this.ecBlocks=u}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let a=0;const u=this.ecBlocks;for(const m of u)a+=m.getCount();return a}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class Te{constructor(a,u){this.count=a,this.dataCodewords=u}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class zn{constructor(a,u,...m){this.versionNumber=a,this.alignmentPatternCenters=u,this.ecBlocks=m;let v=0;const w=m[0].getECCodewordsPerBlock(),I=m[0].getECBlocks();for(const P of I)v+=P.getCount()*(P.getDataCodewords()+w);this.totalCodewords=v}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(a){return this.ecBlocks[a.getValue()]}static getProvisionalVersionForDimension(a){if(a%4!==1)throw new tt;try{return this.getVersionForNumber((a-17)/4)}catch{throw new tt}}static getVersionForNumber(a){if(a<1||a>40)throw new K;return zn.VERSIONS[a-1]}static decodeVersionInformation(a){let u=Number.MAX_SAFE_INTEGER,m=0;for(let v=0;v<zn.VERSION_DECODE_INFO.length;v++){const w=zn.VERSION_DECODE_INFO[v];if(w===a)return zn.getVersionForNumber(v+7);const I=pn.numBitsDiffering(a,w);I<u&&(m=v+7,u=I)}return u<=3?zn.getVersionForNumber(m):null}buildFunctionPattern(){const a=this.getDimensionForVersion(),u=new Rt(a);u.setRegion(0,0,9,9),u.setRegion(a-8,0,8,9),u.setRegion(0,a-8,9,8);const m=this.alignmentPatternCenters.length;for(let v=0;v<m;v++){const w=this.alignmentPatternCenters[v]-2;for(let I=0;I<m;I++)v===0&&(I===0||I===m-1)||v===m-1&&I===0||u.setRegion(this.alignmentPatternCenters[I]-2,w,5,5)}return u.setRegion(6,9,1,a-17),u.setRegion(9,6,a-17,1),this.versionNumber>6&&(u.setRegion(a-11,0,3,6),u.setRegion(0,a-11,6,3)),u}toString(){return""+this.versionNumber}}zn.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),zn.VERSIONS=[new zn(1,new Int32Array(0),new ft(7,new Te(1,19)),new ft(10,new Te(1,16)),new ft(13,new Te(1,13)),new ft(17,new Te(1,9))),new zn(2,Int32Array.from([6,18]),new ft(10,new Te(1,34)),new ft(16,new Te(1,28)),new ft(22,new Te(1,22)),new ft(28,new Te(1,16))),new zn(3,Int32Array.from([6,22]),new ft(15,new Te(1,55)),new ft(26,new Te(1,44)),new ft(18,new Te(2,17)),new ft(22,new Te(2,13))),new zn(4,Int32Array.from([6,26]),new ft(20,new Te(1,80)),new ft(18,new Te(2,32)),new ft(26,new Te(2,24)),new ft(16,new Te(4,9))),new zn(5,Int32Array.from([6,30]),new ft(26,new Te(1,108)),new ft(24,new Te(2,43)),new ft(18,new Te(2,15),new Te(2,16)),new ft(22,new Te(2,11),new Te(2,12))),new zn(6,Int32Array.from([6,34]),new ft(18,new Te(2,68)),new ft(16,new Te(4,27)),new ft(24,new Te(4,19)),new ft(28,new Te(4,15))),new zn(7,Int32Array.from([6,22,38]),new ft(20,new Te(2,78)),new ft(18,new Te(4,31)),new ft(18,new Te(2,14),new Te(4,15)),new ft(26,new Te(4,13),new Te(1,14))),new zn(8,Int32Array.from([6,24,42]),new ft(24,new Te(2,97)),new ft(22,new Te(2,38),new Te(2,39)),new ft(22,new Te(4,18),new Te(2,19)),new ft(26,new Te(4,14),new Te(2,15))),new zn(9,Int32Array.from([6,26,46]),new ft(30,new Te(2,116)),new ft(22,new Te(3,36),new Te(2,37)),new ft(20,new Te(4,16),new Te(4,17)),new ft(24,new Te(4,12),new Te(4,13))),new zn(10,Int32Array.from([6,28,50]),new ft(18,new Te(2,68),new Te(2,69)),new ft(26,new Te(4,43),new Te(1,44)),new ft(24,new Te(6,19),new Te(2,20)),new ft(28,new Te(6,15),new Te(2,16))),new zn(11,Int32Array.from([6,30,54]),new ft(20,new Te(4,81)),new ft(30,new Te(1,50),new Te(4,51)),new ft(28,new Te(4,22),new Te(4,23)),new ft(24,new Te(3,12),new Te(8,13))),new zn(12,Int32Array.from([6,32,58]),new ft(24,new Te(2,92),new Te(2,93)),new ft(22,new Te(6,36),new Te(2,37)),new ft(26,new Te(4,20),new Te(6,21)),new ft(28,new Te(7,14),new Te(4,15))),new zn(13,Int32Array.from([6,34,62]),new ft(26,new Te(4,107)),new ft(22,new Te(8,37),new Te(1,38)),new ft(24,new Te(8,20),new Te(4,21)),new ft(22,new Te(12,11),new Te(4,12))),new zn(14,Int32Array.from([6,26,46,66]),new ft(30,new Te(3,115),new Te(1,116)),new ft(24,new Te(4,40),new Te(5,41)),new ft(20,new Te(11,16),new Te(5,17)),new ft(24,new Te(11,12),new Te(5,13))),new zn(15,Int32Array.from([6,26,48,70]),new ft(22,new Te(5,87),new Te(1,88)),new ft(24,new Te(5,41),new Te(5,42)),new ft(30,new Te(5,24),new Te(7,25)),new ft(24,new Te(11,12),new Te(7,13))),new zn(16,Int32Array.from([6,26,50,74]),new ft(24,new Te(5,98),new Te(1,99)),new ft(28,new Te(7,45),new Te(3,46)),new ft(24,new Te(15,19),new Te(2,20)),new ft(30,new Te(3,15),new Te(13,16))),new zn(17,Int32Array.from([6,30,54,78]),new ft(28,new Te(1,107),new Te(5,108)),new ft(28,new Te(10,46),new Te(1,47)),new ft(28,new Te(1,22),new Te(15,23)),new ft(28,new Te(2,14),new Te(17,15))),new zn(18,Int32Array.from([6,30,56,82]),new ft(30,new Te(5,120),new Te(1,121)),new ft(26,new Te(9,43),new Te(4,44)),new ft(28,new Te(17,22),new Te(1,23)),new ft(28,new Te(2,14),new Te(19,15))),new zn(19,Int32Array.from([6,30,58,86]),new ft(28,new Te(3,113),new Te(4,114)),new ft(26,new Te(3,44),new Te(11,45)),new ft(26,new Te(17,21),new Te(4,22)),new ft(26,new Te(9,13),new Te(16,14))),new zn(20,Int32Array.from([6,34,62,90]),new ft(28,new Te(3,107),new Te(5,108)),new ft(26,new Te(3,41),new Te(13,42)),new ft(30,new Te(15,24),new Te(5,25)),new ft(28,new Te(15,15),new Te(10,16))),new zn(21,Int32Array.from([6,28,50,72,94]),new ft(28,new Te(4,116),new Te(4,117)),new ft(26,new Te(17,42)),new ft(28,new Te(17,22),new Te(6,23)),new ft(30,new Te(19,16),new Te(6,17))),new zn(22,Int32Array.from([6,26,50,74,98]),new ft(28,new Te(2,111),new Te(7,112)),new ft(28,new Te(17,46)),new ft(30,new Te(7,24),new Te(16,25)),new ft(24,new Te(34,13))),new zn(23,Int32Array.from([6,30,54,78,102]),new ft(30,new Te(4,121),new Te(5,122)),new ft(28,new Te(4,47),new Te(14,48)),new ft(30,new Te(11,24),new Te(14,25)),new ft(30,new Te(16,15),new Te(14,16))),new zn(24,Int32Array.from([6,28,54,80,106]),new ft(30,new Te(6,117),new Te(4,118)),new ft(28,new Te(6,45),new Te(14,46)),new ft(30,new Te(11,24),new Te(16,25)),new ft(30,new Te(30,16),new Te(2,17))),new zn(25,Int32Array.from([6,32,58,84,110]),new ft(26,new Te(8,106),new Te(4,107)),new ft(28,new Te(8,47),new Te(13,48)),new ft(30,new Te(7,24),new Te(22,25)),new ft(30,new Te(22,15),new Te(13,16))),new zn(26,Int32Array.from([6,30,58,86,114]),new ft(28,new Te(10,114),new Te(2,115)),new ft(28,new Te(19,46),new Te(4,47)),new ft(28,new Te(28,22),new Te(6,23)),new ft(30,new Te(33,16),new Te(4,17))),new zn(27,Int32Array.from([6,34,62,90,118]),new ft(30,new Te(8,122),new Te(4,123)),new ft(28,new Te(22,45),new Te(3,46)),new ft(30,new Te(8,23),new Te(26,24)),new ft(30,new Te(12,15),new Te(28,16))),new zn(28,Int32Array.from([6,26,50,74,98,122]),new ft(30,new Te(3,117),new Te(10,118)),new ft(28,new Te(3,45),new Te(23,46)),new ft(30,new Te(4,24),new Te(31,25)),new ft(30,new Te(11,15),new Te(31,16))),new zn(29,Int32Array.from([6,30,54,78,102,126]),new ft(30,new Te(7,116),new Te(7,117)),new ft(28,new Te(21,45),new Te(7,46)),new ft(30,new Te(1,23),new Te(37,24)),new ft(30,new Te(19,15),new Te(26,16))),new zn(30,Int32Array.from([6,26,52,78,104,130]),new ft(30,new Te(5,115),new Te(10,116)),new ft(28,new Te(19,47),new Te(10,48)),new ft(30,new Te(15,24),new Te(25,25)),new ft(30,new Te(23,15),new Te(25,16))),new zn(31,Int32Array.from([6,30,56,82,108,134]),new ft(30,new Te(13,115),new Te(3,116)),new ft(28,new Te(2,46),new Te(29,47)),new ft(30,new Te(42,24),new Te(1,25)),new ft(30,new Te(23,15),new Te(28,16))),new zn(32,Int32Array.from([6,34,60,86,112,138]),new ft(30,new Te(17,115)),new ft(28,new Te(10,46),new Te(23,47)),new ft(30,new Te(10,24),new Te(35,25)),new ft(30,new Te(19,15),new Te(35,16))),new zn(33,Int32Array.from([6,30,58,86,114,142]),new ft(30,new Te(17,115),new Te(1,116)),new ft(28,new Te(14,46),new Te(21,47)),new ft(30,new Te(29,24),new Te(19,25)),new ft(30,new Te(11,15),new Te(46,16))),new zn(34,Int32Array.from([6,34,62,90,118,146]),new ft(30,new Te(13,115),new Te(6,116)),new ft(28,new Te(14,46),new Te(23,47)),new ft(30,new Te(44,24),new Te(7,25)),new ft(30,new Te(59,16),new Te(1,17))),new zn(35,Int32Array.from([6,30,54,78,102,126,150]),new ft(30,new Te(12,121),new Te(7,122)),new ft(28,new Te(12,47),new Te(26,48)),new ft(30,new Te(39,24),new Te(14,25)),new ft(30,new Te(22,15),new Te(41,16))),new zn(36,Int32Array.from([6,24,50,76,102,128,154]),new ft(30,new Te(6,121),new Te(14,122)),new ft(28,new Te(6,47),new Te(34,48)),new ft(30,new Te(46,24),new Te(10,25)),new ft(30,new Te(2,15),new Te(64,16))),new zn(37,Int32Array.from([6,28,54,80,106,132,158]),new ft(30,new Te(17,122),new Te(4,123)),new ft(28,new Te(29,46),new Te(14,47)),new ft(30,new Te(49,24),new Te(10,25)),new ft(30,new Te(24,15),new Te(46,16))),new zn(38,Int32Array.from([6,32,58,84,110,136,162]),new ft(30,new Te(4,122),new Te(18,123)),new ft(28,new Te(13,46),new Te(32,47)),new ft(30,new Te(48,24),new Te(14,25)),new ft(30,new Te(42,15),new Te(32,16))),new zn(39,Int32Array.from([6,26,54,82,110,138,166]),new ft(30,new Te(20,117),new Te(4,118)),new ft(28,new Te(40,47),new Te(7,48)),new ft(30,new Te(43,24),new Te(22,25)),new ft(30,new Te(10,15),new Te(67,16))),new zn(40,Int32Array.from([6,30,58,86,114,142,170]),new ft(30,new Te(19,118),new Te(6,119)),new ft(28,new Te(18,47),new Te(31,48)),new ft(30,new Te(34,24),new Te(34,25)),new ft(30,new Te(20,15),new Te(61,16)))];var $i;(function(le){le[le.DATA_MASK_000=0]="DATA_MASK_000",le[le.DATA_MASK_001=1]="DATA_MASK_001",le[le.DATA_MASK_010=2]="DATA_MASK_010",le[le.DATA_MASK_011=3]="DATA_MASK_011",le[le.DATA_MASK_100=4]="DATA_MASK_100",le[le.DATA_MASK_101=5]="DATA_MASK_101",le[le.DATA_MASK_110=6]="DATA_MASK_110",le[le.DATA_MASK_111=7]="DATA_MASK_111"})($i||($i={}));class Dr{constructor(a,u){this.value=a,this.isMasked=u}unmaskBitMatrix(a,u){for(let m=0;m<u;m++)for(let v=0;v<u;v++)this.isMasked(m,v)&&a.flip(v,m)}}Dr.values=new Map([[$i.DATA_MASK_000,new Dr($i.DATA_MASK_000,(le,a)=>(le+a&1)===0)],[$i.DATA_MASK_001,new Dr($i.DATA_MASK_001,(le,a)=>(le&1)===0)],[$i.DATA_MASK_010,new Dr($i.DATA_MASK_010,(le,a)=>a%3===0)],[$i.DATA_MASK_011,new Dr($i.DATA_MASK_011,(le,a)=>(le+a)%3===0)],[$i.DATA_MASK_100,new Dr($i.DATA_MASK_100,(le,a)=>(Math.floor(le/2)+Math.floor(a/3)&1)===0)],[$i.DATA_MASK_101,new Dr($i.DATA_MASK_101,(le,a)=>le*a%6===0)],[$i.DATA_MASK_110,new Dr($i.DATA_MASK_110,(le,a)=>le*a%6<3)],[$i.DATA_MASK_111,new Dr($i.DATA_MASK_111,(le,a)=>(le+a+le*a%3&1)===0)]]);class Da{constructor(a){const u=a.getHeight();if(u<21||(u&3)!==1)throw new tt;this.bitMatrix=a}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let a=0;for(let w=0;w<6;w++)a=this.copyBit(w,8,a);a=this.copyBit(7,8,a),a=this.copyBit(8,8,a),a=this.copyBit(8,7,a);for(let w=5;w>=0;w--)a=this.copyBit(8,w,a);const u=this.bitMatrix.getHeight();let m=0;const v=u-7;for(let w=u-1;w>=v;w--)m=this.copyBit(8,w,m);for(let w=u-8;w<u;w++)m=this.copyBit(w,8,m);if(this.parsedFormatInfo=pn.decodeFormatInformation(a,m),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new tt}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const a=this.bitMatrix.getHeight(),u=Math.floor((a-17)/4);if(u<=6)return zn.getVersionForNumber(u);let m=0;const v=a-11;for(let I=5;I>=0;I--)for(let P=a-9;P>=v;P--)m=this.copyBit(P,I,m);let w=zn.decodeVersionInformation(m);if(w!==null&&w.getDimensionForVersion()===a)return this.parsedVersion=w,w;m=0;for(let I=5;I>=0;I--)for(let P=a-9;P>=v;P--)m=this.copyBit(I,P,m);if(w=zn.decodeVersionInformation(m),w!==null&&w.getDimensionForVersion()===a)return this.parsedVersion=w,w;throw new tt}copyBit(a,u,m){return(this.isMirror?this.bitMatrix.get(u,a):this.bitMatrix.get(a,u))?m<<1|1:m<<1}readCodewords(){const a=this.readFormatInformation(),u=this.readVersion(),m=Dr.values.get(a.getDataMask()),v=this.bitMatrix.getHeight();m.unmaskBitMatrix(this.bitMatrix,v);const w=u.buildFunctionPattern();let I=!0;const P=new Uint8Array(u.getTotalCodewords());let F=0,q=0,te=0;for(let ce=v-1;ce>0;ce-=2){ce===6&&ce--;for(let xe=0;xe<v;xe++){const ze=I?v-1-xe:xe;for(let it=0;it<2;it++)w.get(ce-it,ze)||(te++,q<<=1,this.bitMatrix.get(ce-it,ze)&&(q|=1),te===8&&(P[F++]=q,te=0,q=0))}I=!I}if(F!==u.getTotalCodewords())throw new tt;return P}remask(){if(this.parsedFormatInfo===null)return;const a=Dr.values[this.parsedFormatInfo.getDataMask()],u=this.bitMatrix.getHeight();a.unmaskBitMatrix(this.bitMatrix,u)}setMirror(a){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=a}mirror(){const a=this.bitMatrix;for(let u=0,m=a.getWidth();u<m;u++)for(let v=u+1,w=a.getHeight();v<w;v++)a.get(u,v)!==a.get(v,u)&&(a.flip(v,u),a.flip(u,v))}}class pa{constructor(a,u){this.numDataCodewords=a,this.codewords=u}static getDataBlocks(a,u,m){if(a.length!==u.getTotalCodewords())throw new K;const v=u.getECBlocksForLevel(m);let w=0;const I=v.getECBlocks();for(const it of I)w+=it.getCount();const P=new Array(w);let F=0;for(const it of I)for(let lt=0;lt<it.getCount();lt++){const Tt=it.getDataCodewords(),Ft=v.getECCodewordsPerBlock()+Tt;P[F++]=new pa(Tt,new Uint8Array(Ft))}const q=P[0].codewords.length;let te=P.length-1;for(;te>=0&&P[te].codewords.length!==q;)te--;te++;const ce=q-v.getECCodewordsPerBlock();let xe=0;for(let it=0;it<ce;it++)for(let lt=0;lt<F;lt++)P[lt].codewords[it]=a[xe++];for(let it=te;it<F;it++)P[it].codewords[ce]=a[xe++];const ze=P[0].codewords.length;for(let it=ce;it<ze;it++)for(let lt=0;lt<F;lt++){const Tt=lt<te?it:it+1;P[lt].codewords[Tt]=a[xe++]}return P}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Tr;(function(le){le[le.TERMINATOR=0]="TERMINATOR",le[le.NUMERIC=1]="NUMERIC",le[le.ALPHANUMERIC=2]="ALPHANUMERIC",le[le.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",le[le.BYTE=4]="BYTE",le[le.ECI=5]="ECI",le[le.KANJI=6]="KANJI",le[le.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",le[le.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",le[le.HANZI=9]="HANZI"})(Tr||(Tr={}));class Xn{constructor(a,u,m,v){this.value=a,this.stringValue=u,this.characterCountBitsForVersions=m,this.bits=v,Xn.FOR_BITS.set(v,this),Xn.FOR_VALUE.set(a,this)}static forBits(a){const u=Xn.FOR_BITS.get(a);if(u===void 0)throw new K;return u}getCharacterCountBits(a){const u=a.getVersionNumber();let m;return u<=9?m=0:u<=26?m=1:m=2,this.characterCountBitsForVersions[m]}getValue(){return this.value}getBits(){return this.bits}equals(a){if(!(a instanceof Xn))return!1;const u=a;return this.value===u.value}toString(){return this.stringValue}}Xn.FOR_BITS=new Map,Xn.FOR_VALUE=new Map,Xn.TERMINATOR=new Xn(Tr.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Xn.NUMERIC=new Xn(Tr.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Xn.ALPHANUMERIC=new Xn(Tr.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Xn.STRUCTURED_APPEND=new Xn(Tr.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Xn.BYTE=new Xn(Tr.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Xn.ECI=new Xn(Tr.ECI,"ECI",Int32Array.from([0,0,0]),7),Xn.KANJI=new Xn(Tr.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Xn.FNC1_FIRST_POSITION=new Xn(Tr.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Xn.FNC1_SECOND_POSITION=new Xn(Tr.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Xn.HANZI=new Xn(Tr.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Ui{static decode(a,u,m,v){const w=new Ds(a);let I=new gt;const P=new Array;let F=-1,q=-1;try{let te=null,ce=!1,xe;do{if(w.available()<4)xe=Xn.TERMINATOR;else{const ze=w.readBits(4);xe=Xn.forBits(ze)}switch(xe){case Xn.TERMINATOR:break;case Xn.FNC1_FIRST_POSITION:case Xn.FNC1_SECOND_POSITION:ce=!0;break;case Xn.STRUCTURED_APPEND:if(w.available()<16)throw new tt;F=w.readBits(8),q=w.readBits(8);break;case Xn.ECI:const ze=Ui.parseECIValue(w);if(te=He.getCharacterSetECIByValue(ze),te===null)throw new tt;break;case Xn.HANZI:const it=w.readBits(4),lt=w.readBits(xe.getCharacterCountBits(u));it===Ui.GB2312_SUBSET&&Ui.decodeHanziSegment(w,I,lt);break;default:const Tt=w.readBits(xe.getCharacterCountBits(u));switch(xe){case Xn.NUMERIC:Ui.decodeNumericSegment(w,I,Tt);break;case Xn.ALPHANUMERIC:Ui.decodeAlphanumericSegment(w,I,Tt,ce);break;case Xn.BYTE:Ui.decodeByteSegment(w,I,Tt,te,P,v);break;case Xn.KANJI:Ui.decodeKanjiSegment(w,I,Tt);break;default:throw new tt}break}}while(xe!==Xn.TERMINATOR)}catch{throw new tt}return new Rn(a,I.toString(),P.length===0?null:P,m===null?null:m.toString(),F,q)}static decodeHanziSegment(a,u,m){if(m*13>a.available())throw new tt;const v=new Uint8Array(2*m);let w=0;for(;m>0;){const I=a.readBits(13);let P=I/96<<8&4294967295|I%96;P<959?P+=41377:P+=42657,v[w]=P>>8&255,v[w+1]=P&255,w+=2,m--}try{u.append(Pe.decode(v,ot.GB2312))}catch(I){throw new tt(I)}}static decodeKanjiSegment(a,u,m){if(m*13>a.available())throw new tt;const v=new Uint8Array(2*m);let w=0;for(;m>0;){const I=a.readBits(13);let P=I/192<<8&4294967295|I%192;P<7936?P+=33088:P+=49472,v[w]=P>>8,v[w+1]=P,w+=2,m--}try{u.append(Pe.decode(v,ot.SHIFT_JIS))}catch(I){throw new tt(I)}}static decodeByteSegment(a,u,m,v,w,I){if(8*m>a.available())throw new tt;const P=new Uint8Array(m);for(let q=0;q<m;q++)P[q]=a.readBits(8);let F;v===null?F=ot.guessEncoding(P,I):F=v.getName();try{u.append(Pe.decode(P,F))}catch(q){throw new tt(q)}w.push(P)}static toAlphaNumericChar(a){if(a>=Ui.ALPHANUMERIC_CHARS.length)throw new tt;return Ui.ALPHANUMERIC_CHARS[a]}static decodeAlphanumericSegment(a,u,m,v){const w=u.length();for(;m>1;){if(a.available()<11)throw new tt;const I=a.readBits(11);u.append(Ui.toAlphaNumericChar(Math.floor(I/45))),u.append(Ui.toAlphaNumericChar(I%45)),m-=2}if(m===1){if(a.available()<6)throw new tt;u.append(Ui.toAlphaNumericChar(a.readBits(6)))}if(v)for(let I=w;I<u.length();I++)u.charAt(I)==="%"&&(I<u.length()-1&&u.charAt(I+1)==="%"?u.deleteCharAt(I+1):u.setCharAt(I,""))}static decodeNumericSegment(a,u,m){for(;m>=3;){if(a.available()<10)throw new tt;const v=a.readBits(10);if(v>=1e3)throw new tt;u.append(Ui.toAlphaNumericChar(Math.floor(v/100))),u.append(Ui.toAlphaNumericChar(Math.floor(v/10)%10)),u.append(Ui.toAlphaNumericChar(v%10)),m-=3}if(m===2){if(a.available()<7)throw new tt;const v=a.readBits(7);if(v>=100)throw new tt;u.append(Ui.toAlphaNumericChar(Math.floor(v/10))),u.append(Ui.toAlphaNumericChar(v%10))}else if(m===1){if(a.available()<4)throw new tt;const v=a.readBits(4);if(v>=10)throw new tt;u.append(Ui.toAlphaNumericChar(v))}}static parseECIValue(a){const u=a.readBits(8);if((u&128)===0)return u&127;if((u&192)===128){const m=a.readBits(8);return(u&63)<<8&4294967295|m}if((u&224)===192){const m=a.readBits(16);return(u&31)<<16&4294967295|m}throw new tt}}Ui.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Ui.GB2312_SUBSET=1;class Bs{constructor(a){this.mirrored=a}isMirrored(){return this.mirrored}applyMirroredCorrection(a){if(!this.mirrored||a===null||a.length<3)return;const u=a[0];a[0]=a[2],a[2]=u}}class ko{constructor(){this.rsDecoder=new Bi(Kn.QR_CODE_FIELD_256)}decodeBooleanArray(a,u){return this.decodeBitMatrix(Rt.parseFromBooleanArray(a),u)}decodeBitMatrix(a,u){const m=new Da(a);let v=null;try{return this.decodeBitMatrixParser(m,u)}catch(w){v=w}try{m.remask(),m.setMirror(!0),m.readVersion(),m.readFormatInformation(),m.mirror();const w=this.decodeBitMatrixParser(m,u);return w.setOther(new Bs(!0)),w}catch(w){throw v!==null?v:w}}decodeBitMatrixParser(a,u){const m=a.readVersion(),v=a.readFormatInformation().getErrorCorrectionLevel(),w=a.readCodewords(),I=pa.getDataBlocks(w,m,v);let P=0;for(const te of I)P+=te.getNumDataCodewords();const F=new Uint8Array(P);let q=0;for(const te of I){const ce=te.getCodewords(),xe=te.getNumDataCodewords();this.correctErrors(ce,xe);for(let ze=0;ze<xe;ze++)F[q++]=ce[ze]}return Ui.decode(F,m,v,u)}correctErrors(a,u){const m=new Int32Array(a);try{this.rsDecoder.decode(m,a.length-u)}catch{throw new Ce}for(let v=0;v<u;v++)a[v]=m[v]}}class ui extends gn{constructor(a,u,m){super(a,u),this.estimatedModuleSize=m}aboutEquals(a,u,m){if(Math.abs(u-this.getY())<=a&&Math.abs(m-this.getX())<=a){const v=Math.abs(a-this.estimatedModuleSize);return v<=1||v<=this.estimatedModuleSize}return!1}combineEstimate(a,u,m){const v=(this.getX()+u)/2,w=(this.getY()+a)/2,I=(this.estimatedModuleSize+m)/2;return new ui(v,w,I)}}class Fs{constructor(a,u,m,v,w,I,P){this.image=a,this.startX=u,this.startY=m,this.width=v,this.height=w,this.moduleSize=I,this.resultPointCallback=P,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const a=this.startX,u=this.height,m=this.width,v=a+m,w=this.startY+u/2,I=new Int32Array(3),P=this.image;for(let F=0;F<u;F++){const q=w+((F&1)===0?Math.floor((F+1)/2):-Math.floor((F+1)/2));I[0]=0,I[1]=0,I[2]=0;let te=a;for(;te<v&&!P.get(te,q);)te++;let ce=0;for(;te<v;){if(P.get(te,q))if(ce===1)I[1]++;else if(ce===2){if(this.foundPatternCross(I)){const xe=this.handlePossibleCenter(I,q,te);if(xe!==null)return xe}I[0]=I[2],I[1]=1,I[2]=0,ce=1}else I[++ce]++;else ce===1&&ce++,I[ce]++;te++}if(this.foundPatternCross(I)){const xe=this.handlePossibleCenter(I,q,v);if(xe!==null)return xe}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new Ie}static centerFromEnd(a,u){return u-a[2]-a[1]/2}foundPatternCross(a){const u=this.moduleSize,m=u/2;for(let v=0;v<3;v++)if(Math.abs(u-a[v])>=m)return!1;return!0}crossCheckVertical(a,u,m,v){const w=this.image,I=w.getHeight(),P=this.crossCheckStateCount;P[0]=0,P[1]=0,P[2]=0;let F=a;for(;F>=0&&w.get(u,F)&&P[1]<=m;)P[1]++,F--;if(F<0||P[1]>m)return NaN;for(;F>=0&&!w.get(u,F)&&P[0]<=m;)P[0]++,F--;if(P[0]>m)return NaN;for(F=a+1;F<I&&w.get(u,F)&&P[1]<=m;)P[1]++,F++;if(F===I||P[1]>m)return NaN;for(;F<I&&!w.get(u,F)&&P[2]<=m;)P[2]++,F++;if(P[2]>m)return NaN;const q=P[0]+P[1]+P[2];return 5*Math.abs(q-v)>=2*v?NaN:this.foundPatternCross(P)?Fs.centerFromEnd(P,F):NaN}handlePossibleCenter(a,u,m){const v=a[0]+a[1]+a[2],w=Fs.centerFromEnd(a,m),I=this.crossCheckVertical(u,w,2*a[1],v);if(!isNaN(I)){const P=(a[0]+a[1]+a[2])/3;for(const q of this.possibleCenters)if(q.aboutEquals(P,I,w))return q.combineEstimate(I,w,P);const F=new ui(w,I,P);this.possibleCenters.push(F),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(F)}return null}}class $o extends gn{constructor(a,u,m,v){super(a,u),this.estimatedModuleSize=m,this.count=v,v===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(a,u,m){if(Math.abs(u-this.getY())<=a&&Math.abs(m-this.getX())<=a){const v=Math.abs(a-this.estimatedModuleSize);return v<=1||v<=this.estimatedModuleSize}return!1}combineEstimate(a,u,m){const v=this.count+1,w=(this.count*this.getX()+u)/v,I=(this.count*this.getY()+a)/v,P=(this.count*this.estimatedModuleSize+m)/v;return new $o(w,I,P,v)}}class Ko{constructor(a){this.bottomLeft=a[0],this.topLeft=a[1],this.topRight=a[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class wi{constructor(a,u){this.image=a,this.resultPointCallback=u,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=u}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(a){const u=a!=null&&a.get(wt.TRY_HARDER)!==void 0,m=a!=null&&a.get(wt.PURE_BARCODE)!==void 0,v=this.image,w=v.getHeight(),I=v.getWidth();let P=Math.floor(3*w/(4*wi.MAX_MODULES));(P<wi.MIN_SKIP||u)&&(P=wi.MIN_SKIP);let F=!1;const q=new Int32Array(5);for(let ce=P-1;ce<w&&!F;ce+=P){q[0]=0,q[1]=0,q[2]=0,q[3]=0,q[4]=0;let xe=0;for(let ze=0;ze<I;ze++)if(v.get(ze,ce))(xe&1)===1&&xe++,q[xe]++;else if((xe&1)===0)if(xe===4)if(wi.foundPatternCross(q)){if(this.handlePossibleCenter(q,ce,ze,m)===!0)if(P=2,this.hasSkipped===!0)F=this.haveMultiplyConfirmedCenters();else{const lt=this.findRowSkip();lt>q[2]&&(ce+=lt-q[2]-P,ze=I-1)}else{q[0]=q[2],q[1]=q[3],q[2]=q[4],q[3]=1,q[4]=0,xe=3;continue}xe=0,q[0]=0,q[1]=0,q[2]=0,q[3]=0,q[4]=0}else q[0]=q[2],q[1]=q[3],q[2]=q[4],q[3]=1,q[4]=0,xe=3;else q[++xe]++;else q[xe]++;wi.foundPatternCross(q)&&this.handlePossibleCenter(q,ce,I,m)===!0&&(P=q[0],this.hasSkipped&&(F=this.haveMultiplyConfirmedCenters()))}const te=this.selectBestPatterns();return gn.orderBestPatterns(te),new Ko(te)}static centerFromEnd(a,u){return u-a[4]-a[3]-a[2]/2}static foundPatternCross(a){let u=0;for(let w=0;w<5;w++){const I=a[w];if(I===0)return!1;u+=I}if(u<7)return!1;const m=u/7,v=m/2;return Math.abs(m-a[0])<v&&Math.abs(m-a[1])<v&&Math.abs(3*m-a[2])<3*v&&Math.abs(m-a[3])<v&&Math.abs(m-a[4])<v}getCrossCheckStateCount(){const a=this.crossCheckStateCount;return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a}crossCheckDiagonal(a,u,m,v){const w=this.getCrossCheckStateCount();let I=0;const P=this.image;for(;a>=I&&u>=I&&P.get(u-I,a-I);)w[2]++,I++;if(a<I||u<I)return!1;for(;a>=I&&u>=I&&!P.get(u-I,a-I)&&w[1]<=m;)w[1]++,I++;if(a<I||u<I||w[1]>m)return!1;for(;a>=I&&u>=I&&P.get(u-I,a-I)&&w[0]<=m;)w[0]++,I++;if(w[0]>m)return!1;const F=P.getHeight(),q=P.getWidth();for(I=1;a+I<F&&u+I<q&&P.get(u+I,a+I);)w[2]++,I++;if(a+I>=F||u+I>=q)return!1;for(;a+I<F&&u+I<q&&!P.get(u+I,a+I)&&w[3]<m;)w[3]++,I++;if(a+I>=F||u+I>=q||w[3]>=m)return!1;for(;a+I<F&&u+I<q&&P.get(u+I,a+I)&&w[4]<m;)w[4]++,I++;if(w[4]>=m)return!1;const te=w[0]+w[1]+w[2]+w[3]+w[4];return Math.abs(te-v)<2*v&&wi.foundPatternCross(w)}crossCheckVertical(a,u,m,v){const w=this.image,I=w.getHeight(),P=this.getCrossCheckStateCount();let F=a;for(;F>=0&&w.get(u,F);)P[2]++,F--;if(F<0)return NaN;for(;F>=0&&!w.get(u,F)&&P[1]<=m;)P[1]++,F--;if(F<0||P[1]>m)return NaN;for(;F>=0&&w.get(u,F)&&P[0]<=m;)P[0]++,F--;if(P[0]>m)return NaN;for(F=a+1;F<I&&w.get(u,F);)P[2]++,F++;if(F===I)return NaN;for(;F<I&&!w.get(u,F)&&P[3]<m;)P[3]++,F++;if(F===I||P[3]>=m)return NaN;for(;F<I&&w.get(u,F)&&P[4]<m;)P[4]++,F++;if(P[4]>=m)return NaN;const q=P[0]+P[1]+P[2]+P[3]+P[4];return 5*Math.abs(q-v)>=2*v?NaN:wi.foundPatternCross(P)?wi.centerFromEnd(P,F):NaN}crossCheckHorizontal(a,u,m,v){const w=this.image,I=w.getWidth(),P=this.getCrossCheckStateCount();let F=a;for(;F>=0&&w.get(F,u);)P[2]++,F--;if(F<0)return NaN;for(;F>=0&&!w.get(F,u)&&P[1]<=m;)P[1]++,F--;if(F<0||P[1]>m)return NaN;for(;F>=0&&w.get(F,u)&&P[0]<=m;)P[0]++,F--;if(P[0]>m)return NaN;for(F=a+1;F<I&&w.get(F,u);)P[2]++,F++;if(F===I)return NaN;for(;F<I&&!w.get(F,u)&&P[3]<m;)P[3]++,F++;if(F===I||P[3]>=m)return NaN;for(;F<I&&w.get(F,u)&&P[4]<m;)P[4]++,F++;if(P[4]>=m)return NaN;const q=P[0]+P[1]+P[2]+P[3]+P[4];return 5*Math.abs(q-v)>=v?NaN:wi.foundPatternCross(P)?wi.centerFromEnd(P,F):NaN}handlePossibleCenter(a,u,m,v){const w=a[0]+a[1]+a[2]+a[3]+a[4];let I=wi.centerFromEnd(a,m),P=this.crossCheckVertical(u,Math.floor(I),a[2],w);if(!isNaN(P)&&(I=this.crossCheckHorizontal(Math.floor(I),Math.floor(P),a[2],w),!isNaN(I)&&(!v||this.crossCheckDiagonal(Math.floor(P),Math.floor(I),a[2],w)))){const F=w/7;let q=!1;const te=this.possibleCenters;for(let ce=0,xe=te.length;ce<xe;ce++){const ze=te[ce];if(ze.aboutEquals(F,P,I)){te[ce]=ze.combineEstimate(P,I,F),q=!0;break}}if(!q){const ce=new $o(I,P,F);te.push(ce),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(ce)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let u=null;for(const m of this.possibleCenters)if(m.getCount()>=wi.CENTER_QUORUM)if(u==null)u=m;else return this.hasSkipped=!0,Math.floor((Math.abs(u.getX()-m.getX())-Math.abs(u.getY()-m.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let a=0,u=0;const m=this.possibleCenters.length;for(const I of this.possibleCenters)I.getCount()>=wi.CENTER_QUORUM&&(a++,u+=I.getEstimatedModuleSize());if(a<3)return!1;const v=u/m;let w=0;for(const I of this.possibleCenters)w+=Math.abs(I.getEstimatedModuleSize()-v);return w<=.05*u}selectBestPatterns(){const a=this.possibleCenters.length;if(a<3)throw new Ie;const u=this.possibleCenters;let m;if(a>3){let v=0,w=0;for(const F of this.possibleCenters){const q=F.getEstimatedModuleSize();v+=q,w+=q*q}m=v/a;let I=Math.sqrt(w/a-m*m);u.sort((F,q)=>{const te=Math.abs(q.getEstimatedModuleSize()-m),ce=Math.abs(F.getEstimatedModuleSize()-m);return te<ce?-1:te>ce?1:0});const P=Math.max(.2*m,I);for(let F=0;F<u.length&&u.length>3;F++){const q=u[F];Math.abs(q.getEstimatedModuleSize()-m)>P&&(u.splice(F,1),F--)}}if(u.length>3){let v=0;for(const w of u)v+=w.getEstimatedModuleSize();m=v/u.length,u.sort((w,I)=>{if(I.getCount()===w.getCount()){const P=Math.abs(I.getEstimatedModuleSize()-m),F=Math.abs(w.getEstimatedModuleSize()-m);return P<F?1:P>F?-1:0}else return I.getCount()-w.getCount()}),u.splice(3)}return[u[0],u[1],u[2]]}}wi.CENTER_QUORUM=2,wi.MIN_SKIP=3,wi.MAX_MODULES=57;class yr{constructor(a){this.image=a}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(a){this.resultPointCallback=a==null?null:a.get(wt.NEED_RESULT_POINT_CALLBACK);const m=new wi(this.image,this.resultPointCallback).find(a);return this.processFinderPatternInfo(m)}processFinderPatternInfo(a){const u=a.getTopLeft(),m=a.getTopRight(),v=a.getBottomLeft(),w=this.calculateModuleSize(u,m,v);if(w<1)throw new Ie("No pattern found in proccess finder.");const I=yr.computeDimension(u,m,v,w),P=zn.getProvisionalVersionForDimension(I),F=P.getDimensionForVersion()-7;let q=null;if(P.getAlignmentPatternCenters().length>0){const ze=m.getX()-u.getX()+v.getX(),it=m.getY()-u.getY()+v.getY(),lt=1-3/F,Tt=Math.floor(u.getX()+lt*(ze-u.getX())),Ft=Math.floor(u.getY()+lt*(it-u.getY()));for(let vn=4;vn<=16;vn<<=1)try{q=this.findAlignmentInRegion(w,Tt,Ft,vn);break}catch(yn){if(!(yn instanceof Ie))throw yn}}const te=yr.createTransform(u,m,v,q,I),ce=yr.sampleGrid(this.image,te,I);let xe;return q===null?xe=[v,u,m]:xe=[v,u,m,q],new Zn(ce,xe)}static createTransform(a,u,m,v,w){const I=w-3.5;let P,F,q,te;return v!==null?(P=v.getX(),F=v.getY(),q=I-3,te=q):(P=u.getX()-a.getX()+m.getX(),F=u.getY()-a.getY()+m.getY(),q=I,te=I),ct.quadrilateralToQuadrilateral(3.5,3.5,I,3.5,q,te,3.5,I,a.getX(),a.getY(),u.getX(),u.getY(),P,F,m.getX(),m.getY())}static sampleGrid(a,u,m){return ue.getInstance().sampleGridWithTransform(a,m,m,u)}static computeDimension(a,u,m,v){const w=fn.round(gn.distance(a,u)/v),I=fn.round(gn.distance(a,m)/v);let P=Math.floor((w+I)/2)+7;switch(P&3){case 0:P++;break;case 2:P--;break;case 3:throw new Ie("Dimensions could be not found.")}return P}calculateModuleSize(a,u,m){return(this.calculateModuleSizeOneWay(a,u)+this.calculateModuleSizeOneWay(a,m))/2}calculateModuleSizeOneWay(a,u){const m=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(a.getX()),Math.floor(a.getY()),Math.floor(u.getX()),Math.floor(u.getY())),v=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(u.getX()),Math.floor(u.getY()),Math.floor(a.getX()),Math.floor(a.getY()));return isNaN(m)?v/7:isNaN(v)?m/7:(m+v)/14}sizeOfBlackWhiteBlackRunBothWays(a,u,m,v){let w=this.sizeOfBlackWhiteBlackRun(a,u,m,v),I=1,P=a-(m-a);P<0?(I=a/(a-P),P=0):P>=this.image.getWidth()&&(I=(this.image.getWidth()-1-a)/(P-a),P=this.image.getWidth()-1);let F=Math.floor(u-(v-u)*I);return I=1,F<0?(I=u/(u-F),F=0):F>=this.image.getHeight()&&(I=(this.image.getHeight()-1-u)/(F-u),F=this.image.getHeight()-1),P=Math.floor(a+(P-a)*I),w+=this.sizeOfBlackWhiteBlackRun(a,u,P,F),w-1}sizeOfBlackWhiteBlackRun(a,u,m,v){const w=Math.abs(v-u)>Math.abs(m-a);if(w){let ze=a;a=u,u=ze,ze=m,m=v,v=ze}const I=Math.abs(m-a),P=Math.abs(v-u);let F=-I/2;const q=a<m?1:-1,te=u<v?1:-1;let ce=0;const xe=m+q;for(let ze=a,it=u;ze!==xe;ze+=q){const lt=w?it:ze,Tt=w?ze:it;if(ce===1===this.image.get(lt,Tt)){if(ce===2)return fn.distance(ze,it,a,u);ce++}if(F+=P,F>0){if(it===v)break;it+=te,F-=I}}return ce===2?fn.distance(m+q,v,a,u):NaN}findAlignmentInRegion(a,u,m,v){const w=Math.floor(v*a),I=Math.max(0,u-w),P=Math.min(this.image.getWidth()-1,u+w);if(P-I<a*3)throw new Ie("Alignment top exceeds estimated module size.");const F=Math.max(0,m-w),q=Math.min(this.image.getHeight()-1,m+w);if(q-F<a*3)throw new Ie("Alignment bottom exceeds estimated module size.");return new Fs(this.image,I,F,P-I,q-F,a,this.resultPointCallback).find()}}class Gi{constructor(){this.decoder=new ko}getDecoder(){return this.decoder}decode(a,u){let m,v;if(u!=null&&u.get(wt.PURE_BARCODE)!==void 0){const F=Gi.extractPureBits(a.getBlackMatrix());m=this.decoder.decodeBitMatrix(F,u),v=Gi.NO_POINTS}else{const F=new yr(a.getBlackMatrix()).detect(u);m=this.decoder.decodeBitMatrix(F.getBits(),u),v=F.getPoints()}m.getOther()instanceof Bs&&m.getOther().applyMirroredCorrection(v);const w=new Nt(m.getText(),m.getRawBytes(),void 0,v,Bt.QR_CODE,void 0),I=m.getByteSegments();I!==null&&w.putMetadata(Tn.BYTE_SEGMENTS,I);const P=m.getECLevel();return P!==null&&w.putMetadata(Tn.ERROR_CORRECTION_LEVEL,P),m.hasStructuredAppend()&&(w.putMetadata(Tn.STRUCTURED_APPEND_SEQUENCE,m.getStructuredAppendSequenceNumber()),w.putMetadata(Tn.STRUCTURED_APPEND_PARITY,m.getStructuredAppendParity())),w}reset(){}static extractPureBits(a){const u=a.getTopLeftOnBit(),m=a.getBottomRightOnBit();if(u===null||m===null)throw new Ie;const v=this.moduleSize(u,a);let w=u[1],I=m[1],P=u[0],F=m[0];if(P>=F||w>=I)throw new Ie;if(I-w!==F-P&&(F=P+(I-w),F>=a.getWidth()))throw new Ie;const q=Math.round((F-P+1)/v),te=Math.round((I-w+1)/v);if(q<=0||te<=0)throw new Ie;if(te!==q)throw new Ie;const ce=Math.floor(v/2);w+=ce,P+=ce;const xe=P+Math.floor((q-1)*v)-F;if(xe>0){if(xe>ce)throw new Ie;P-=xe}const ze=w+Math.floor((te-1)*v)-I;if(ze>0){if(ze>ce)throw new Ie;w-=ze}const it=new Rt(q,te);for(let lt=0;lt<te;lt++){const Tt=w+Math.floor(lt*v);for(let Ft=0;Ft<q;Ft++)a.get(P+Math.floor(Ft*v),Tt)&&it.set(Ft,lt)}return it}static moduleSize(a,u){const m=u.getHeight(),v=u.getWidth();let w=a[0],I=a[1],P=!0,F=0;for(;w<v&&I<m;){if(P!==u.get(w,I)){if(++F===5)break;P=!P}w++,I++}if(w===v||I===m)throw new Ie;return(w-a[0])/7}}Gi.NO_POINTS=new Array;class hn{PDF417Common(){}static getBitCountSum(a){return fn.sum(a)}static toIntArray(a){if(a==null||!a.length)return hn.EMPTY_INT_ARRAY;const u=new Int32Array(a.length);let m=0;for(const v of a)u[m++]=v;return u}static getCodeword(a){const u=nt.binarySearch(hn.SYMBOL_TABLE,a&262143);return u<0?-1:(hn.CODEWORD_TABLE[u]-1)%hn.NUMBER_OF_CODEWORDS}}hn.NUMBER_OF_CODEWORDS=929,hn.MAX_CODEWORDS_IN_BARCODE=hn.NUMBER_OF_CODEWORDS-1,hn.MIN_ROWS_IN_BARCODE=3,hn.MAX_ROWS_IN_BARCODE=90,hn.MODULES_IN_CODEWORD=17,hn.MODULES_IN_STOP_PATTERN=18,hn.BARS_IN_MODULE=8,hn.EMPTY_INT_ARRAY=new Int32Array([]),hn.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),hn.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class lr{constructor(a,u){this.bits=a,this.points=u}getBits(){return this.bits}getPoints(){return this.points}}class oi{static detectMultiple(a,u,m){let v=a.getBlackMatrix(),w=oi.detect(m,v);return w.length||(v=v.clone(),v.rotate180(),w=oi.detect(m,v)),new lr(v,w)}static detect(a,u){const m=new Array;let v=0,w=0,I=!1;for(;v<u.getHeight();){const P=oi.findVertices(u,v,w);if(P[0]==null&&P[3]==null){if(!I)break;I=!1,w=0;for(const F of m)F[1]!=null&&(v=Math.trunc(Math.max(v,F[1].getY()))),F[3]!=null&&(v=Math.max(v,Math.trunc(F[3].getY())));v+=oi.ROW_STEP;continue}if(I=!0,m.push(P),!a)break;P[2]!=null?(w=Math.trunc(P[2].getX()),v=Math.trunc(P[2].getY())):(w=Math.trunc(P[4].getX()),v=Math.trunc(P[4].getY()))}return m}static findVertices(a,u,m){const v=a.getHeight(),w=a.getWidth(),I=new Array(8);return oi.copyToResult(I,oi.findRowsWithPattern(a,v,w,u,m,oi.START_PATTERN),oi.INDEXES_START_PATTERN),I[4]!=null&&(m=Math.trunc(I[4].getX()),u=Math.trunc(I[4].getY())),oi.copyToResult(I,oi.findRowsWithPattern(a,v,w,u,m,oi.STOP_PATTERN),oi.INDEXES_STOP_PATTERN),I}static copyToResult(a,u,m){for(let v=0;v<m.length;v++)a[m[v]]=u[v]}static findRowsWithPattern(a,u,m,v,w,I){const P=new Array(4);let F=!1;const q=new Int32Array(I.length);for(;v<u;v+=oi.ROW_STEP){let ce=oi.findGuardPattern(a,w,v,m,!1,I,q);if(ce!=null){for(;v>0;){const xe=oi.findGuardPattern(a,w,--v,m,!1,I,q);if(xe!=null)ce=xe;else{v++;break}}P[0]=new gn(ce[0],v),P[1]=new gn(ce[1],v),F=!0;break}}let te=v+1;if(F){let ce=0,xe=Int32Array.from([Math.trunc(P[0].getX()),Math.trunc(P[1].getX())]);for(;te<u;te++){const ze=oi.findGuardPattern(a,xe[0],te,m,!1,I,q);if(ze!=null&&Math.abs(xe[0]-ze[0])<oi.MAX_PATTERN_DRIFT&&Math.abs(xe[1]-ze[1])<oi.MAX_PATTERN_DRIFT)xe=ze,ce=0;else{if(ce>oi.SKIPPED_ROW_COUNT_MAX)break;ce++}}te-=ce+1,P[2]=new gn(xe[0],te),P[3]=new gn(xe[1],te)}return te-v<oi.BARCODE_MIN_HEIGHT&&nt.fill(P,null),P}static findGuardPattern(a,u,m,v,w,I,P){nt.fillWithin(P,0,P.length,0);let F=u,q=0;for(;a.get(F,m)&&F>0&&q++<oi.MAX_PIXEL_DRIFT;)F--;let te=F,ce=0,xe=I.length;for(let ze=w;te<v;te++)if(a.get(te,m)!==ze)P[ce]++;else{if(ce===xe-1){if(oi.patternMatchVariance(P,I,oi.MAX_INDIVIDUAL_VARIANCE)<oi.MAX_AVG_VARIANCE)return new Int32Array([F,te]);F+=P[0]+P[1],ye.arraycopy(P,2,P,0,ce-1),P[ce-1]=0,P[ce]=0,ce--}else ce++;P[ce]=1,ze=!ze}return ce===xe-1&&oi.patternMatchVariance(P,I,oi.MAX_INDIVIDUAL_VARIANCE)<oi.MAX_AVG_VARIANCE?new Int32Array([F,te-1]):null}static patternMatchVariance(a,u,m){let v=a.length,w=0,I=0;for(let q=0;q<v;q++)w+=a[q],I+=u[q];if(w<I)return 1/0;let P=w/I;m*=P;let F=0;for(let q=0;q<v;q++){let te=a[q],ce=u[q]*P,xe=te>ce?te-ce:ce-te;if(xe>m)return 1/0;F+=xe}return F/w}}oi.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),oi.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),oi.MAX_AVG_VARIANCE=.42,oi.MAX_INDIVIDUAL_VARIANCE=.8,oi.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),oi.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),oi.MAX_PIXEL_DRIFT=3,oi.MAX_PATTERN_DRIFT=5,oi.SKIPPED_ROW_COUNT_MAX=25,oi.ROW_STEP=5,oi.BARCODE_MIN_HEIGHT=10;class Mi{constructor(a,u){if(u.length===0)throw new K;this.field=a;let m=u.length;if(m>1&&u[0]===0){let v=1;for(;v<m&&u[v]===0;)v++;v===m?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(m-v),ye.arraycopy(u,v,this.coefficients,0,this.coefficients.length))}else this.coefficients=u}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(a){return this.coefficients[this.coefficients.length-1-a]}evaluateAt(a){if(a===0)return this.getCoefficient(0);if(a===1){let v=0;for(let w of this.coefficients)v=this.field.add(v,w);return v}let u=this.coefficients[0],m=this.coefficients.length;for(let v=1;v<m;v++)u=this.field.add(this.field.multiply(a,u),this.coefficients[v]);return u}add(a){if(!this.field.equals(a.field))throw new K("ModulusPolys do not have same ModulusGF field");if(this.isZero())return a;if(a.isZero())return this;let u=this.coefficients,m=a.coefficients;if(u.length>m.length){let I=u;u=m,m=I}let v=new Int32Array(m.length),w=m.length-u.length;ye.arraycopy(m,0,v,0,w);for(let I=w;I<m.length;I++)v[I]=this.field.add(u[I-w],m[I]);return new Mi(this.field,v)}subtract(a){if(!this.field.equals(a.field))throw new K("ModulusPolys do not have same ModulusGF field");return a.isZero()?this:this.add(a.negative())}multiply(a){return a instanceof Mi?this.multiplyOther(a):this.multiplyScalar(a)}multiplyOther(a){if(!this.field.equals(a.field))throw new K("ModulusPolys do not have same ModulusGF field");if(this.isZero()||a.isZero())return new Mi(this.field,new Int32Array([0]));let u=this.coefficients,m=u.length,v=a.coefficients,w=v.length,I=new Int32Array(m+w-1);for(let P=0;P<m;P++){let F=u[P];for(let q=0;q<w;q++)I[P+q]=this.field.add(I[P+q],this.field.multiply(F,v[q]))}return new Mi(this.field,I)}negative(){let a=this.coefficients.length,u=new Int32Array(a);for(let m=0;m<a;m++)u[m]=this.field.subtract(0,this.coefficients[m]);return new Mi(this.field,u)}multiplyScalar(a){if(a===0)return new Mi(this.field,new Int32Array([0]));if(a===1)return this;let u=this.coefficients.length,m=new Int32Array(u);for(let v=0;v<u;v++)m[v]=this.field.multiply(this.coefficients[v],a);return new Mi(this.field,m)}multiplyByMonomial(a,u){if(a<0)throw new K;if(u===0)return new Mi(this.field,new Int32Array([0]));let m=this.coefficients.length,v=new Int32Array(m+a);for(let w=0;w<m;w++)v[w]=this.field.multiply(this.coefficients[w],u);return new Mi(this.field,v)}toString(){let a=new gt;for(let u=this.getDegree();u>=0;u--){let m=this.getCoefficient(u);m!==0&&(m<0?(a.append(" - "),m=-m):a.length()>0&&a.append(" + "),(u===0||m!==1)&&a.append(m),u!==0&&(u===1?a.append("x"):(a.append("x^"),a.append(u))))}return a.toString()}}class ra{add(a,u){return(a+u)%this.modulus}subtract(a,u){return(this.modulus+a-u)%this.modulus}exp(a){return this.expTable[a]}log(a){if(a===0)throw new K;return this.logTable[a]}inverse(a){if(a===0)throw new $n;return this.expTable[this.modulus-this.logTable[a]-1]}multiply(a,u){return a===0||u===0?0:this.expTable[(this.logTable[a]+this.logTable[u])%(this.modulus-1)]}getSize(){return this.modulus}equals(a){return a===this}}class Kr extends ra{constructor(a,u){super(),this.modulus=a,this.expTable=new Int32Array(a),this.logTable=new Int32Array(a);let m=1;for(let v=0;v<a;v++)this.expTable[v]=m,m=m*u%a;for(let v=0;v<a-1;v++)this.logTable[this.expTable[v]]=v;this.zero=new Mi(this,new Int32Array([0])),this.one=new Mi(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(a,u){if(a<0)throw new K;if(u===0)return this.zero;let m=new Int32Array(a+1);return m[0]=u,new Mi(this,m)}}Kr.PDF417_GF=new Kr(hn.NUMBER_OF_CODEWORDS,3);class ma{constructor(){this.field=Kr.PDF417_GF}decode(a,u,m){let v=new Mi(this.field,a),w=new Int32Array(u),I=!1;for(let it=u;it>0;it--){let lt=v.evaluateAt(this.field.exp(it));w[u-it]=lt,lt!==0&&(I=!0)}if(!I)return 0;let P=this.field.getOne();if(m!=null)for(const it of m){let lt=this.field.exp(a.length-1-it),Tt=new Mi(this.field,new Int32Array([this.field.subtract(0,lt),1]));P=P.multiply(Tt)}let F=new Mi(this.field,w),q=this.runEuclideanAlgorithm(this.field.buildMonomial(u,1),F,u),te=q[0],ce=q[1],xe=this.findErrorLocations(te),ze=this.findErrorMagnitudes(ce,te,xe);for(let it=0;it<xe.length;it++){let lt=a.length-1-this.field.log(xe[it]);if(lt<0)throw Ce.getChecksumInstance();a[lt]=this.field.subtract(a[lt],ze[it])}return xe.length}runEuclideanAlgorithm(a,u,m){if(a.getDegree()<u.getDegree()){let xe=a;a=u,u=xe}let v=a,w=u,I=this.field.getZero(),P=this.field.getOne();for(;w.getDegree()>=Math.round(m/2);){let xe=v,ze=I;if(v=w,I=P,v.isZero())throw Ce.getChecksumInstance();w=xe;let it=this.field.getZero(),lt=v.getCoefficient(v.getDegree()),Tt=this.field.inverse(lt);for(;w.getDegree()>=v.getDegree()&&!w.isZero();){let Ft=w.getDegree()-v.getDegree(),vn=this.field.multiply(w.getCoefficient(w.getDegree()),Tt);it=it.add(this.field.buildMonomial(Ft,vn)),w=w.subtract(v.multiplyByMonomial(Ft,vn))}P=it.multiply(I).subtract(ze).negative()}let F=P.getCoefficient(0);if(F===0)throw Ce.getChecksumInstance();let q=this.field.inverse(F),te=P.multiply(q),ce=w.multiply(q);return[te,ce]}findErrorLocations(a){let u=a.getDegree(),m=new Int32Array(u),v=0;for(let w=1;w<this.field.getSize()&&v<u;w++)a.evaluateAt(w)===0&&(m[v]=this.field.inverse(w),v++);if(v!==u)throw Ce.getChecksumInstance();return m}findErrorMagnitudes(a,u,m){let v=u.getDegree(),w=new Int32Array(v);for(let q=1;q<=v;q++)w[v-q]=this.field.multiply(q,u.getCoefficient(q));let I=new Mi(this.field,w),P=m.length,F=new Int32Array(P);for(let q=0;q<P;q++){let te=this.field.inverse(m[q]),ce=this.field.subtract(0,a.evaluateAt(te)),xe=this.field.inverse(I.evaluateAt(te));F[q]=this.field.multiply(ce,xe)}return F}}class js{constructor(a,u,m,v,w){a instanceof js?this.constructor_2(a):this.constructor_1(a,u,m,v,w)}constructor_1(a,u,m,v,w){const I=u==null||m==null,P=v==null||w==null;if(I&&P)throw new Ie;I?(u=new gn(0,v.getY()),m=new gn(0,w.getY())):P&&(v=new gn(a.getWidth()-1,u.getY()),w=new gn(a.getWidth()-1,m.getY())),this.image=a,this.topLeft=u,this.bottomLeft=m,this.topRight=v,this.bottomRight=w,this.minX=Math.trunc(Math.min(u.getX(),m.getX())),this.maxX=Math.trunc(Math.max(v.getX(),w.getX())),this.minY=Math.trunc(Math.min(u.getY(),v.getY())),this.maxY=Math.trunc(Math.max(m.getY(),w.getY()))}constructor_2(a){this.image=a.image,this.topLeft=a.getTopLeft(),this.bottomLeft=a.getBottomLeft(),this.topRight=a.getTopRight(),this.bottomRight=a.getBottomRight(),this.minX=a.getMinX(),this.maxX=a.getMaxX(),this.minY=a.getMinY(),this.maxY=a.getMaxY()}static merge(a,u){return a==null?u:u==null?a:new js(a.image,a.topLeft,a.bottomLeft,u.topRight,u.bottomRight)}addMissingRows(a,u,m){let v=this.topLeft,w=this.bottomLeft,I=this.topRight,P=this.bottomRight;if(a>0){let F=m?this.topLeft:this.topRight,q=Math.trunc(F.getY()-a);q<0&&(q=0);let te=new gn(F.getX(),q);m?v=te:I=te}if(u>0){let F=m?this.bottomLeft:this.bottomRight,q=Math.trunc(F.getY()+u);q>=this.image.getHeight()&&(q=this.image.getHeight()-1);let te=new gn(F.getX(),q);m?w=te:P=te}return new js(this.image,v,w,I,P)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Nr{constructor(a,u,m,v){this.columnCount=a,this.errorCorrectionLevel=v,this.rowCountUpperPart=u,this.rowCountLowerPart=m,this.rowCount=u+m}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Na{constructor(){this.buffer=""}static form(a,u){let m=-1;function v(I,P,F,q,te,ce){if(I==="%%")return"%";if(u[++m]===void 0)return;I=q?parseInt(q.substr(1)):void 0;let xe=te?parseInt(te.substr(1)):void 0,ze;switch(ce){case"s":ze=u[m];break;case"c":ze=u[m][0];break;case"f":ze=parseFloat(u[m]).toFixed(I);break;case"p":ze=parseFloat(u[m]).toPrecision(I);break;case"e":ze=parseFloat(u[m]).toExponential(I);break;case"x":ze=parseInt(u[m]).toString(xe||16);break;case"d":ze=parseFloat(parseInt(u[m],xe||10).toPrecision(I)).toFixed(0);break}ze=typeof ze=="object"?JSON.stringify(ze):(+ze).toString(xe);let it=parseInt(F),lt=F&&F[0]+""=="0"?"0":" ";for(;ze.length<it;)ze=P!==void 0?ze+lt:lt+ze;return ze}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return a.replace(w,v)}format(a,...u){this.buffer+=Na.form(a,u)}toString(){return this.buffer}}class Ns{constructor(a){this.boundingBox=new js(a),this.codewords=new Array(a.getMaxY()-a.getMinY()+1)}getCodewordNearby(a){let u=this.getCodeword(a);if(u!=null)return u;for(let m=1;m<Ns.MAX_NEARBY_DISTANCE;m++){let v=this.imageRowToCodewordIndex(a)-m;if(v>=0&&(u=this.codewords[v],u!=null)||(v=this.imageRowToCodewordIndex(a)+m,v<this.codewords.length&&(u=this.codewords[v],u!=null)))return u}return null}imageRowToCodewordIndex(a){return a-this.boundingBox.getMinY()}setCodeword(a,u){this.codewords[this.imageRowToCodewordIndex(a)]=u}getCodeword(a){return this.codewords[this.imageRowToCodewordIndex(a)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const a=new Na;let u=0;for(const m of this.codewords){if(m==null){a.format("%3d:    |   %n",u++);continue}a.format("%3d: %3d|%3d%n",u++,m.getRowNumber(),m.getValue())}return a.toString()}}Ns.MAX_NEARBY_DISTANCE=5;class Xa{constructor(){this.values=new Map}setValue(a){a=Math.trunc(a);let u=this.values.get(a);u==null&&(u=0),u++,this.values.set(a,u)}getValue(){let a=-1,u=new Array;for(const[m,v]of this.values.entries()){const w={getKey:()=>m,getValue:()=>v};w.getValue()>a?(a=w.getValue(),u=[],u.push(w.getKey())):w.getValue()===a&&u.push(w.getKey())}return hn.toIntArray(u)}getConfidence(a){return this.values.get(a)}}class Us extends Ns{constructor(a,u){super(a),this._isLeft=u}setRowNumbers(){for(let a of this.getCodewords())a?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(a){let u=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(u,a);let m=this.getBoundingBox(),v=this._isLeft?m.getTopLeft():m.getTopRight(),w=this._isLeft?m.getBottomLeft():m.getBottomRight(),I=this.imageRowToCodewordIndex(Math.trunc(v.getY())),P=this.imageRowToCodewordIndex(Math.trunc(w.getY())),F=-1,q=1,te=0;for(let ce=I;ce<P;ce++){if(u[ce]==null)continue;let xe=u[ce],ze=xe.getRowNumber()-F;if(ze===0)te++;else if(ze===1)q=Math.max(q,te),te=1,F=xe.getRowNumber();else if(ze<0||xe.getRowNumber()>=a.getRowCount()||ze>ce)u[ce]=null;else{let it;q>2?it=(q-2)*ze:it=ze;let lt=it>=ce;for(let Tt=1;Tt<=it&&!lt;Tt++)lt=u[ce-Tt]!=null;lt?u[ce]=null:(F=xe.getRowNumber(),te=1)}}}getRowHeights(){let a=this.getBarcodeMetadata();if(a==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(a);let u=new Int32Array(a.getRowCount());for(let m of this.getCodewords())if(m!=null){let v=m.getRowNumber();if(v>=u.length)continue;u[v]++}return u}adjustIncompleteIndicatorColumnRowNumbers(a){let u=this.getBoundingBox(),m=this._isLeft?u.getTopLeft():u.getTopRight(),v=this._isLeft?u.getBottomLeft():u.getBottomRight(),w=this.imageRowToCodewordIndex(Math.trunc(m.getY())),I=this.imageRowToCodewordIndex(Math.trunc(v.getY())),P=this.getCodewords(),F=-1;for(let q=w;q<I;q++){if(P[q]==null)continue;let te=P[q];te.setRowNumberAsRowIndicatorColumn();let ce=te.getRowNumber()-F;ce===0||(ce===1?F=te.getRowNumber():te.getRowNumber()>=a.getRowCount()?P[q]=null:F=te.getRowNumber())}}getBarcodeMetadata(){let a=this.getCodewords(),u=new Xa,m=new Xa,v=new Xa,w=new Xa;for(let P of a){if(P==null)continue;P.setRowNumberAsRowIndicatorColumn();let F=P.getValue()%30,q=P.getRowNumber();switch(this._isLeft||(q+=2),q%3){case 0:m.setValue(F*3+1);break;case 1:w.setValue(F/3),v.setValue(F%3);break;case 2:u.setValue(F+1);break}}if(u.getValue().length===0||m.getValue().length===0||v.getValue().length===0||w.getValue().length===0||u.getValue()[0]<1||m.getValue()[0]+v.getValue()[0]<hn.MIN_ROWS_IN_BARCODE||m.getValue()[0]+v.getValue()[0]>hn.MAX_ROWS_IN_BARCODE)return null;let I=new Nr(u.getValue()[0],m.getValue()[0],v.getValue()[0],w.getValue()[0]);return this.removeIncorrectCodewords(a,I),I}removeIncorrectCodewords(a,u){for(let m=0;m<a.length;m++){let v=a[m];if(a[m]==null)continue;let w=v.getValue()%30,I=v.getRowNumber();if(I>u.getRowCount()){a[m]=null;continue}switch(this._isLeft||(I+=2),I%3){case 0:w*3+1!==u.getRowCountUpperPart()&&(a[m]=null);break;case 1:(Math.trunc(w/3)!==u.getErrorCorrectionLevel()||w%3!==u.getRowCountLowerPart())&&(a[m]=null);break;case 2:w+1!==u.getColumnCount()&&(a[m]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class zr{constructor(a,u){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=a,this.barcodeColumnCount=a.getColumnCount(),this.boundingBox=u,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let a=hn.MAX_CODEWORDS_IN_BARCODE,u;do u=a,a=this.adjustRowNumbersAndGetCount();while(a>0&&a<u);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(a){a?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let a=this.adjustRowNumbersByRow();if(a===0)return 0;for(let u=1;u<this.barcodeColumnCount+1;u++){let m=this.detectionResultColumns[u].getCodewords();for(let v=0;v<m.length;v++)m[v]!=null&&(m[v].hasValidRowNumber()||this.adjustRowNumbers(u,v,m))}return a}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let a=this.detectionResultColumns[0].getCodewords(),u=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let m=0;m<a.length;m++)if(a[m]!=null&&u[m]!=null&&a[m].getRowNumber()===u[m].getRowNumber())for(let v=1;v<=this.barcodeColumnCount;v++){let w=this.detectionResultColumns[v].getCodewords()[m];w!=null&&(w.setRowNumber(a[m].getRowNumber()),w.hasValidRowNumber()||(this.detectionResultColumns[v].getCodewords()[m]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let a=0,u=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let m=0;m<u.length;m++){if(u[m]==null)continue;let v=u[m].getRowNumber(),w=0;for(let I=this.barcodeColumnCount+1;I>0&&w<this.ADJUST_ROW_NUMBER_SKIP;I--){let P=this.detectionResultColumns[I].getCodewords()[m];P!=null&&(w=zr.adjustRowNumberIfValid(v,w,P),P.hasValidRowNumber()||a++)}}return a}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let a=0,u=this.detectionResultColumns[0].getCodewords();for(let m=0;m<u.length;m++){if(u[m]==null)continue;let v=u[m].getRowNumber(),w=0;for(let I=1;I<this.barcodeColumnCount+1&&w<this.ADJUST_ROW_NUMBER_SKIP;I++){let P=this.detectionResultColumns[I].getCodewords()[m];P!=null&&(w=zr.adjustRowNumberIfValid(v,w,P),P.hasValidRowNumber()||a++)}}return a}static adjustRowNumberIfValid(a,u,m){return m==null||m.hasValidRowNumber()||(m.isValidRowNumber(a)?(m.setRowNumber(a),u=0):++u),u}adjustRowNumbers(a,u,m){if(!this.detectionResultColumns[a-1])return;let v=m[u],w=this.detectionResultColumns[a-1].getCodewords(),I=w;this.detectionResultColumns[a+1]!=null&&(I=this.detectionResultColumns[a+1].getCodewords());let P=new Array(14);P[2]=w[u],P[3]=I[u],u>0&&(P[0]=m[u-1],P[4]=w[u-1],P[5]=I[u-1]),u>1&&(P[8]=m[u-2],P[10]=w[u-2],P[11]=I[u-2]),u<m.length-1&&(P[1]=m[u+1],P[6]=w[u+1],P[7]=I[u+1]),u<m.length-2&&(P[9]=m[u+2],P[12]=w[u+2],P[13]=I[u+2]);for(let F of P)if(zr.adjustRowNumber(v,F))return}static adjustRowNumber(a,u){return u==null?!1:u.hasValidRowNumber()&&u.getBucket()===a.getBucket()?(a.setRowNumber(u.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(a){this.boundingBox=a}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(a,u){this.detectionResultColumns[a]=u}getDetectionResultColumn(a){return this.detectionResultColumns[a]}toString(){let a=this.detectionResultColumns[0];a==null&&(a=this.detectionResultColumns[this.barcodeColumnCount+1]);let u=new Na;for(let m=0;m<a.getCodewords().length;m++){u.format("CW %3d:",m);for(let v=0;v<this.barcodeColumnCount+2;v++){if(this.detectionResultColumns[v]==null){u.format("    |   ");continue}let w=this.detectionResultColumns[v].getCodewords()[m];if(w==null){u.format("    |   ");continue}u.format(" %3d|%3d",w.getRowNumber(),w.getValue())}u.format("%n")}return u.toString()}}class ds{constructor(a,u,m,v){this.rowNumber=ds.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(a),this.endX=Math.trunc(u),this.bucket=Math.trunc(m),this.value=Math.trunc(v)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(a){return a!==ds.BARCODE_ROW_UNKNOWN&&this.bucket===a%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(a){this.rowNumber=a}toString(){return this.rowNumber+"|"+this.value}}ds.BARCODE_ROW_UNKNOWN=-1;class Ss{static initialize(){for(let a=0;a<hn.SYMBOL_TABLE.length;a++){let u=hn.SYMBOL_TABLE[a],m=u&1;for(let v=0;v<hn.BARS_IN_MODULE;v++){let w=0;for(;(u&1)===m;)w+=1,u>>=1;m=u&1,Ss.RATIOS_TABLE[a]||(Ss.RATIOS_TABLE[a]=new Array(hn.BARS_IN_MODULE)),Ss.RATIOS_TABLE[a][hn.BARS_IN_MODULE-v-1]=Math.fround(w/hn.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(a){let u=Ss.getDecodedCodewordValue(Ss.sampleBitCounts(a));return u!==-1?u:Ss.getClosestDecodedValue(a)}static sampleBitCounts(a){let u=fn.sum(a),m=new Int32Array(hn.BARS_IN_MODULE),v=0,w=0;for(let I=0;I<hn.MODULES_IN_CODEWORD;I++){let P=u/(2*hn.MODULES_IN_CODEWORD)+I*u/hn.MODULES_IN_CODEWORD;w+a[v]<=P&&(w+=a[v],v++),m[v]++}return m}static getDecodedCodewordValue(a){let u=Ss.getBitValue(a);return hn.getCodeword(u)===-1?-1:u}static getBitValue(a){let u=0;for(let m=0;m<a.length;m++)for(let v=0;v<a[m];v++)u=u<<1|(m%2===0?1:0);return Math.trunc(u)}static getClosestDecodedValue(a){let u=fn.sum(a),m=new Array(hn.BARS_IN_MODULE);if(u>1)for(let I=0;I<m.length;I++)m[I]=Math.fround(a[I]/u);let v=di.MAX_VALUE,w=-1;this.bSymbolTableReady||Ss.initialize();for(let I=0;I<Ss.RATIOS_TABLE.length;I++){let P=0,F=Ss.RATIOS_TABLE[I];for(let q=0;q<hn.BARS_IN_MODULE;q++){let te=Math.fround(F[q]-m[q]);if(P+=Math.fround(te*te),P>=v)break}P<v&&(v=P,w=hn.SYMBOL_TABLE[I])}return w}}Ss.bSymbolTableReady=!1,Ss.RATIOS_TABLE=new Array(hn.SYMBOL_TABLE.length).map(le=>new Array(hn.BARS_IN_MODULE));class Qo{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(a){this.segmentIndex=a}getFileId(){return this.fileId}setFileId(a){this.fileId=a}getOptionalData(){return this.optionalData}setOptionalData(a){this.optionalData=a}isLastSegment(){return this.lastSegment}setLastSegment(a){this.lastSegment=a}getSegmentCount(){return this.segmentCount}setSegmentCount(a){this.segmentCount=a}getSender(){return this.sender||null}setSender(a){this.sender=a}getAddressee(){return this.addressee||null}setAddressee(a){this.addressee=a}getFileName(){return this.fileName}setFileName(a){this.fileName=a}getFileSize(){return this.fileSize}setFileSize(a){this.fileSize=a}getChecksum(){return this.checksum}setChecksum(a){this.checksum=a}getTimestamp(){return this.timestamp}setTimestamp(a){this.timestamp=a}}class Jo{static parseLong(a,u=void 0){return parseInt(a,u)}}class er extends H{}er.kind="NullPointerException";class el{writeBytes(a){this.writeBytesOffset(a,0,a.length)}writeBytesOffset(a,u,m){if(a==null)throw new er;if(u<0||u>a.length||m<0||u+m>a.length||u+m<0)throw new he;if(m===0)return;for(let v=0;v<m;v++)this.write(a[u+v])}flush(){}close(){}}class Si extends H{}class pi extends el{constructor(a=32){if(super(),this.count=0,a<0)throw new K("Negative initial size: "+a);this.buf=new Uint8Array(a)}ensureCapacity(a){a-this.buf.length>0&&this.grow(a)}grow(a){let m=this.buf.length<<1;if(m-a<0&&(m=a),m<0){if(a<0)throw new Si;m=Qe.MAX_VALUE}this.buf=nt.copyOfUint8Array(this.buf,m)}write(a){this.ensureCapacity(this.count+1),this.buf[this.count]=a,this.count+=1}writeBytesOffset(a,u,m){if(u<0||u>a.length||m<0||u+m-a.length>0)throw new he;this.ensureCapacity(this.count+m),ye.arraycopy(a,u,this.buf,this.count,m),this.count+=m}writeTo(a){a.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return nt.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(a){return a?typeof a=="string"?this.toString_string(a):this.toString_number(a):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(a){return new String(this.buf).toString()}toString_number(a){return new String(this.buf).toString()}close(){}}var Hi;(function(le){le[le.ALPHA=0]="ALPHA",le[le.LOWER=1]="LOWER",le[le.MIXED=2]="MIXED",le[le.PUNCT=3]="PUNCT",le[le.ALPHA_SHIFT=4]="ALPHA_SHIFT",le[le.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Hi||(Hi={}));function Oi(){if(typeof window<"u")return window.BigInt||null;if(typeof kg<"u")return kg.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let tl;function fs(le){if(typeof tl>"u"&&(tl=Oi()),tl===null)throw new Error("BigInt is not supported!");return tl(le)}function nl(){let le=[];le[0]=fs(1);let a=fs(900);le[1]=a;for(let u=2;u<16;u++)le[u]=le[u-1]*a;return le}class zt{static decode(a,u){let m=new gt(""),v=He.ISO8859_1;m.enableDecoding(v);let w=1,I=a[w++],P=new Qo;for(;w<a[0];){switch(I){case zt.TEXT_COMPACTION_MODE_LATCH:w=zt.textCompaction(a,w,m);break;case zt.BYTE_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH_6:w=zt.byteCompaction(I,a,v,w,m);break;case zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:m.append(a[w++]);break;case zt.NUMERIC_COMPACTION_MODE_LATCH:w=zt.numericCompaction(a,w,m);break;case zt.ECI_CHARSET:He.getCharacterSetECIByValue(a[w++]);break;case zt.ECI_GENERAL_PURPOSE:w+=2;break;case zt.ECI_USER_DEFINED:w++;break;case zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:w=zt.decodeMacroBlock(a,w,P);break;case zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case zt.MACRO_PDF417_TERMINATOR:throw new tt;default:w--,w=zt.textCompaction(a,w,m);break}if(w<a.length)I=a[w++];else throw tt.getFormatInstance()}if(m.length()===0)throw tt.getFormatInstance();let F=new Rn(null,m.toString(),null,u);return F.setOther(P),F}static decodeMacroBlock(a,u,m){if(u+zt.NUMBER_OF_SEQUENCE_CODEWORDS>a[0])throw tt.getFormatInstance();let v=new Int32Array(zt.NUMBER_OF_SEQUENCE_CODEWORDS);for(let P=0;P<zt.NUMBER_OF_SEQUENCE_CODEWORDS;P++,u++)v[P]=a[u];m.setSegmentIndex(Qe.parseInt(zt.decodeBase900toBase10(v,zt.NUMBER_OF_SEQUENCE_CODEWORDS)));let w=new gt;u=zt.textCompaction(a,u,w),m.setFileId(w.toString());let I=-1;for(a[u]===zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(I=u+1);u<a[0];)switch(a[u]){case zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(u++,a[u]){case zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let P=new gt;u=zt.textCompaction(a,u+1,P),m.setFileName(P.toString());break;case zt.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let F=new gt;u=zt.textCompaction(a,u+1,F),m.setSender(F.toString());break;case zt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let q=new gt;u=zt.textCompaction(a,u+1,q),m.setAddressee(q.toString());break;case zt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let te=new gt;u=zt.numericCompaction(a,u+1,te),m.setSegmentCount(Qe.parseInt(te.toString()));break;case zt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let ce=new gt;u=zt.numericCompaction(a,u+1,ce),m.setTimestamp(Jo.parseLong(ce.toString()));break;case zt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let xe=new gt;u=zt.numericCompaction(a,u+1,xe),m.setChecksum(Qe.parseInt(xe.toString()));break;case zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let ze=new gt;u=zt.numericCompaction(a,u+1,ze),m.setFileSize(Jo.parseLong(ze.toString()));break;default:throw tt.getFormatInstance()}break;case zt.MACRO_PDF417_TERMINATOR:u++,m.setLastSegment(!0);break;default:throw tt.getFormatInstance()}if(I!==-1){let P=u-I;m.isLastSegment()&&P--,m.setOptionalData(nt.copyOfRange(a,I,I+P))}return u}static textCompaction(a,u,m){let v=new Int32Array((a[0]-u)*2),w=new Int32Array((a[0]-u)*2),I=0,P=!1;for(;u<a[0]&&!P;){let F=a[u++];if(F<zt.TEXT_COMPACTION_MODE_LATCH)v[I]=F/30,v[I+1]=F%30,I+=2;else switch(F){case zt.TEXT_COMPACTION_MODE_LATCH:v[I++]=zt.TEXT_COMPACTION_MODE_LATCH;break;case zt.BYTE_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH_6:case zt.NUMERIC_COMPACTION_MODE_LATCH:case zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case zt.MACRO_PDF417_TERMINATOR:u--,P=!0;break;case zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v[I]=zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,F=a[u++],w[I]=F,I++;break}}return zt.decodeTextCompaction(v,w,I,m),u}static decodeTextCompaction(a,u,m,v){let w=Hi.ALPHA,I=Hi.ALPHA,P=0;for(;P<m;){let F=a[P],q="";switch(w){case Hi.ALPHA:if(F<26)q=String.fromCharCode(65+F);else switch(F){case 26:q=" ";break;case zt.LL:w=Hi.LOWER;break;case zt.ML:w=Hi.MIXED;break;case zt.PS:I=w,w=Hi.PUNCT_SHIFT;break;case zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[P]);break;case zt.TEXT_COMPACTION_MODE_LATCH:w=Hi.ALPHA;break}break;case Hi.LOWER:if(F<26)q=String.fromCharCode(97+F);else switch(F){case 26:q=" ";break;case zt.AS:I=w,w=Hi.ALPHA_SHIFT;break;case zt.ML:w=Hi.MIXED;break;case zt.PS:I=w,w=Hi.PUNCT_SHIFT;break;case zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[P]);break;case zt.TEXT_COMPACTION_MODE_LATCH:w=Hi.ALPHA;break}break;case Hi.MIXED:if(F<zt.PL)q=zt.MIXED_CHARS[F];else switch(F){case zt.PL:w=Hi.PUNCT;break;case 26:q=" ";break;case zt.LL:w=Hi.LOWER;break;case zt.AL:w=Hi.ALPHA;break;case zt.PS:I=w,w=Hi.PUNCT_SHIFT;break;case zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[P]);break;case zt.TEXT_COMPACTION_MODE_LATCH:w=Hi.ALPHA;break}break;case Hi.PUNCT:if(F<zt.PAL)q=zt.PUNCT_CHARS[F];else switch(F){case zt.PAL:w=Hi.ALPHA;break;case zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[P]);break;case zt.TEXT_COMPACTION_MODE_LATCH:w=Hi.ALPHA;break}break;case Hi.ALPHA_SHIFT:if(w=I,F<26)q=String.fromCharCode(65+F);else switch(F){case 26:q=" ";break;case zt.TEXT_COMPACTION_MODE_LATCH:w=Hi.ALPHA;break}break;case Hi.PUNCT_SHIFT:if(w=I,F<zt.PAL)q=zt.PUNCT_CHARS[F];else switch(F){case zt.PAL:w=Hi.ALPHA;break;case zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[P]);break;case zt.TEXT_COMPACTION_MODE_LATCH:w=Hi.ALPHA;break}break}q!==""&&v.append(q),P++}}static byteCompaction(a,u,m,v,w){let I=new pi,P=0,F=0,q=!1;switch(a){case zt.BYTE_COMPACTION_MODE_LATCH:let te=new Int32Array(6),ce=u[v++];for(;v<u[0]&&!q;)switch(te[P++]=ce,F=900*F+ce,ce=u[v++],ce){case zt.TEXT_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH:case zt.NUMERIC_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH_6:case zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case zt.MACRO_PDF417_TERMINATOR:v--,q=!0;break;default:if(P%5===0&&P>0){for(let xe=0;xe<6;++xe)I.write(Number(fs(F)>>fs(8*(5-xe))));F=0,P=0}break}v===u[0]&&ce<zt.TEXT_COMPACTION_MODE_LATCH&&(te[P++]=ce);for(let xe=0;xe<P;xe++)I.write(te[xe]);break;case zt.BYTE_COMPACTION_MODE_LATCH_6:for(;v<u[0]&&!q;){let xe=u[v++];if(xe<zt.TEXT_COMPACTION_MODE_LATCH)P++,F=900*F+xe;else switch(xe){case zt.TEXT_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH:case zt.NUMERIC_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH_6:case zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case zt.MACRO_PDF417_TERMINATOR:v--,q=!0;break}if(P%5===0&&P>0){for(let ze=0;ze<6;++ze)I.write(Number(fs(F)>>fs(8*(5-ze))));F=0,P=0}}break}return w.append(Pe.decode(I.toByteArray(),m)),v}static numericCompaction(a,u,m){let v=0,w=!1,I=new Int32Array(zt.MAX_NUMERIC_CODEWORDS);for(;u<a[0]&&!w;){let P=a[u++];if(u===a[0]&&(w=!0),P<zt.TEXT_COMPACTION_MODE_LATCH)I[v]=P,v++;else switch(P){case zt.TEXT_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH:case zt.BYTE_COMPACTION_MODE_LATCH_6:case zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case zt.MACRO_PDF417_TERMINATOR:u--,w=!0;break}(v%zt.MAX_NUMERIC_CODEWORDS===0||P===zt.NUMERIC_COMPACTION_MODE_LATCH||w)&&v>0&&(m.append(zt.decodeBase900toBase10(I,v)),v=0)}return u}static decodeBase900toBase10(a,u){let m=fs(0);for(let w=0;w<u;w++)m+=zt.EXP900[u-w-1]*fs(a[w]);let v=m.toString();if(v.charAt(0)!=="1")throw new tt;return v.substring(1)}}zt.TEXT_COMPACTION_MODE_LATCH=900,zt.BYTE_COMPACTION_MODE_LATCH=901,zt.NUMERIC_COMPACTION_MODE_LATCH=902,zt.BYTE_COMPACTION_MODE_LATCH_6=924,zt.ECI_USER_DEFINED=925,zt.ECI_GENERAL_PURPOSE=926,zt.ECI_CHARSET=927,zt.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,zt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,zt.MACRO_PDF417_TERMINATOR=922,zt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,zt.MAX_NUMERIC_CODEWORDS=15,zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,zt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,zt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,zt.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,zt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,zt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,zt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,zt.PL=25,zt.LL=27,zt.AS=27,zt.ML=28,zt.AL=28,zt.PS=29,zt.PAL=29,zt.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,zt.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",zt.EXP900=Oi()?nl():[],zt.NUMBER_OF_SEQUENCE_CODEWORDS=2;class Ci{constructor(){}static decode(a,u,m,v,w,I,P){let F=new js(a,u,m,v,w),q=null,te=null,ce;for(let it=!0;;it=!1){if(u!=null&&(q=Ci.getRowIndicatorColumn(a,F,u,!0,I,P)),v!=null&&(te=Ci.getRowIndicatorColumn(a,F,v,!1,I,P)),ce=Ci.merge(q,te),ce==null)throw Ie.getNotFoundInstance();let lt=ce.getBoundingBox();if(it&&lt!=null&&(lt.getMinY()<F.getMinY()||lt.getMaxY()>F.getMaxY()))F=lt;else break}ce.setBoundingBox(F);let xe=ce.getBarcodeColumnCount()+1;ce.setDetectionResultColumn(0,q),ce.setDetectionResultColumn(xe,te);let ze=q!=null;for(let it=1;it<=xe;it++){let lt=ze?it:xe-it;if(ce.getDetectionResultColumn(lt)!==void 0)continue;let Tt;lt===0||lt===xe?Tt=new Us(F,lt===0):Tt=new Ns(F),ce.setDetectionResultColumn(lt,Tt);let Ft=-1,vn=Ft;for(let yn=F.getMinY();yn<=F.getMaxY();yn++){if(Ft=Ci.getStartColumn(ce,lt,yn,ze),Ft<0||Ft>F.getMaxX()){if(vn===-1)continue;Ft=vn}let un=Ci.detectCodeword(a,F.getMinX(),F.getMaxX(),ze,Ft,yn,I,P);un!=null&&(Tt.setCodeword(yn,un),vn=Ft,I=Math.min(I,un.getWidth()),P=Math.max(P,un.getWidth()))}}return Ci.createDecoderResult(ce)}static merge(a,u){if(a==null&&u==null)return null;let m=Ci.getBarcodeMetadata(a,u);if(m==null)return null;let v=js.merge(Ci.adjustBoundingBox(a),Ci.adjustBoundingBox(u));return new zr(m,v)}static adjustBoundingBox(a){if(a==null)return null;let u=a.getRowHeights();if(u==null)return null;let m=Ci.getMax(u),v=0;for(let P of u)if(v+=m-P,P>0)break;let w=a.getCodewords();for(let P=0;v>0&&w[P]==null;P++)v--;let I=0;for(let P=u.length-1;P>=0&&(I+=m-u[P],!(u[P]>0));P--);for(let P=w.length-1;I>0&&w[P]==null;P--)I--;return a.getBoundingBox().addMissingRows(v,I,a.isLeft())}static getMax(a){let u=-1;for(let m of a)u=Math.max(u,m);return u}static getBarcodeMetadata(a,u){let m;if(a==null||(m=a.getBarcodeMetadata())==null)return u==null?null:u.getBarcodeMetadata();let v;return u==null||(v=u.getBarcodeMetadata())==null?m:m.getColumnCount()!==v.getColumnCount()&&m.getErrorCorrectionLevel()!==v.getErrorCorrectionLevel()&&m.getRowCount()!==v.getRowCount()?null:m}static getRowIndicatorColumn(a,u,m,v,w,I){let P=new Us(u,v);for(let F=0;F<2;F++){let q=F===0?1:-1,te=Math.trunc(Math.trunc(m.getX()));for(let ce=Math.trunc(Math.trunc(m.getY()));ce<=u.getMaxY()&&ce>=u.getMinY();ce+=q){let xe=Ci.detectCodeword(a,0,a.getWidth(),v,te,ce,w,I);xe!=null&&(P.setCodeword(ce,xe),v?te=xe.getStartX():te=xe.getEndX())}}return P}static adjustCodewordCount(a,u){let m=u[0][1],v=m.getValue(),w=a.getBarcodeColumnCount()*a.getBarcodeRowCount()-Ci.getNumberOfECCodeWords(a.getBarcodeECLevel());if(v.length===0){if(w<1||w>hn.MAX_CODEWORDS_IN_BARCODE)throw Ie.getNotFoundInstance();m.setValue(w)}else v[0]!==w&&m.setValue(w)}static createDecoderResult(a){let u=Ci.createBarcodeMatrix(a);Ci.adjustCodewordCount(a,u);let m=new Array,v=new Int32Array(a.getBarcodeRowCount()*a.getBarcodeColumnCount()),w=[],I=new Array;for(let F=0;F<a.getBarcodeRowCount();F++)for(let q=0;q<a.getBarcodeColumnCount();q++){let te=u[F][q+1].getValue(),ce=F*a.getBarcodeColumnCount()+q;te.length===0?m.push(ce):te.length===1?v[ce]=te[0]:(I.push(ce),w.push(te))}let P=new Array(w.length);for(let F=0;F<P.length;F++)P[F]=w[F];return Ci.createDecoderResultFromAmbiguousValues(a.getBarcodeECLevel(),v,hn.toIntArray(m),hn.toIntArray(I),P)}static createDecoderResultFromAmbiguousValues(a,u,m,v,w){let I=new Int32Array(v.length),P=100;for(;P-- >0;){for(let F=0;F<I.length;F++)u[v[F]]=w[F][I[F]];try{return Ci.decodeCodewords(u,a,m)}catch(F){if(!(F instanceof Ce))throw F}if(I.length===0)throw Ce.getChecksumInstance();for(let F=0;F<I.length;F++)if(I[F]<w[F].length-1){I[F]++;break}else if(I[F]=0,F===I.length-1)throw Ce.getChecksumInstance()}throw Ce.getChecksumInstance()}static createBarcodeMatrix(a){let u=Array.from({length:a.getBarcodeRowCount()},()=>new Array(a.getBarcodeColumnCount()+2));for(let v=0;v<u.length;v++)for(let w=0;w<u[v].length;w++)u[v][w]=new Xa;let m=0;for(let v of a.getDetectionResultColumns()){if(v!=null){for(let w of v.getCodewords())if(w!=null){let I=w.getRowNumber();if(I>=0){if(I>=u.length)continue;u[I][m].setValue(w.getValue())}}}m++}return u}static isValidBarcodeColumn(a,u){return u>=0&&u<=a.getBarcodeColumnCount()+1}static getStartColumn(a,u,m,v){let w=v?1:-1,I=null;if(Ci.isValidBarcodeColumn(a,u-w)&&(I=a.getDetectionResultColumn(u-w).getCodeword(m)),I!=null)return v?I.getEndX():I.getStartX();if(I=a.getDetectionResultColumn(u).getCodewordNearby(m),I!=null)return v?I.getStartX():I.getEndX();if(Ci.isValidBarcodeColumn(a,u-w)&&(I=a.getDetectionResultColumn(u-w).getCodewordNearby(m)),I!=null)return v?I.getEndX():I.getStartX();let P=0;for(;Ci.isValidBarcodeColumn(a,u-w);){u-=w;for(let F of a.getDetectionResultColumn(u).getCodewords())if(F!=null)return(v?F.getEndX():F.getStartX())+w*P*(F.getEndX()-F.getStartX());P++}return v?a.getBoundingBox().getMinX():a.getBoundingBox().getMaxX()}static detectCodeword(a,u,m,v,w,I,P,F){w=Ci.adjustCodewordStartColumn(a,u,m,v,w,I);let q=Ci.getModuleBitCount(a,u,m,v,w,I);if(q==null)return null;let te,ce=fn.sum(q);if(v)te=w+ce;else{for(let it=0;it<q.length/2;it++){let lt=q[it];q[it]=q[q.length-1-it],q[q.length-1-it]=lt}te=w,w=te-ce}if(!Ci.checkCodewordSkew(ce,P,F))return null;let xe=Ss.getDecodedValue(q),ze=hn.getCodeword(xe);return ze===-1?null:new ds(w,te,Ci.getCodewordBucketNumber(xe),ze)}static getModuleBitCount(a,u,m,v,w,I){let P=w,F=new Int32Array(8),q=0,te=v?1:-1,ce=v;for(;(v?P<m:P>=u)&&q<F.length;)a.get(P,I)===ce?(F[q]++,P+=te):(q++,ce=!ce);return q===F.length||P===(v?m:u)&&q===F.length-1?F:null}static getNumberOfECCodeWords(a){return 2<<a}static adjustCodewordStartColumn(a,u,m,v,w,I){let P=w,F=v?-1:1;for(let q=0;q<2;q++){for(;(v?P>=u:P<m)&&v===a.get(P,I);){if(Math.abs(w-P)>Ci.CODEWORD_SKEW_SIZE)return w;P+=F}F=-F,v=!v}return P}static checkCodewordSkew(a,u,m){return u-Ci.CODEWORD_SKEW_SIZE<=a&&a<=m+Ci.CODEWORD_SKEW_SIZE}static decodeCodewords(a,u,m){if(a.length===0)throw tt.getFormatInstance();let v=1<<u+1,w=Ci.correctErrors(a,m,v);Ci.verifyCodewordCount(a,v);let I=zt.decode(a,""+u);return I.setErrorsCorrected(w),I.setErasures(m.length),I}static correctErrors(a,u,m){if(u!=null&&u.length>m/2+Ci.MAX_ERRORS||m<0||m>Ci.MAX_EC_CODEWORDS)throw Ce.getChecksumInstance();return Ci.errorCorrection.decode(a,m,u)}static verifyCodewordCount(a,u){if(a.length<4)throw tt.getFormatInstance();let m=a[0];if(m>a.length)throw tt.getFormatInstance();if(m===0)if(u<a.length)a[0]=a.length-u;else throw tt.getFormatInstance()}static getBitCountForCodeword(a){let u=new Int32Array(8),m=0,v=u.length-1;for(;!((a&1)!==m&&(m=a&1,v--,v<0));)u[v]++,a>>=1;return u}static getCodewordBucketNumber(a){return a instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(a):this.getCodewordBucketNumber_number(a)}static getCodewordBucketNumber_number(a){return Ci.getCodewordBucketNumber(Ci.getBitCountForCodeword(a))}static getCodewordBucketNumber_Int32Array(a){return(a[0]-a[2]+a[4]-a[6]+9)%9}static toString(a){let u=new Na;for(let m=0;m<a.length;m++){u.format("Row %2d: ",m);for(let v=0;v<a[m].length;v++){let w=a[m][v];w.getValue().length===0?u.format("        ",null):u.format("%4d(%2d)",w.getValue()[0],w.getConfidence(w.getValue()[0]))}u.format("%n")}return u.toString()}}Ci.CODEWORD_SKEW_SIZE=2,Ci.MAX_ERRORS=3,Ci.MAX_EC_CODEWORDS=512,Ci.errorCorrection=new ma;class Qr{decode(a,u=null){let m=Qr.decode(a,u,!1);if(m==null||m.length===0||m[0]==null)throw Ie.getNotFoundInstance();return m[0]}decodeMultiple(a,u=null){try{return Qr.decode(a,u,!0)}catch(m){throw m instanceof tt||m instanceof Ce?Ie.getNotFoundInstance():m}}static decode(a,u,m){const v=new Array,w=oi.detectMultiple(a,u,m);for(const I of w.getPoints()){const P=Ci.decode(w.getBits(),I[4],I[5],I[6],I[7],Qr.getMinCodewordWidth(I),Qr.getMaxCodewordWidth(I)),F=new Nt(P.getText(),P.getRawBytes(),void 0,I,Bt.PDF_417);F.putMetadata(Tn.ERROR_CORRECTION_LEVEL,P.getECLevel());const q=P.getOther();q!=null&&F.putMetadata(Tn.PDF417_EXTRA_METADATA,q),v.push(F)}return v.map(I=>I)}static getMaxWidth(a,u){return a==null||u==null?0:Math.trunc(Math.abs(a.getX()-u.getX()))}static getMinWidth(a,u){return a==null||u==null?Qe.MAX_VALUE:Math.trunc(Math.abs(a.getX()-u.getX()))}static getMaxCodewordWidth(a){return Math.floor(Math.max(Math.max(Qr.getMaxWidth(a[0],a[4]),Qr.getMaxWidth(a[6],a[2])*hn.MODULES_IN_CODEWORD/hn.MODULES_IN_STOP_PATTERN),Math.max(Qr.getMaxWidth(a[1],a[5]),Qr.getMaxWidth(a[7],a[3])*hn.MODULES_IN_CODEWORD/hn.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(a){return Math.floor(Math.min(Math.min(Qr.getMinWidth(a[0],a[4]),Qr.getMinWidth(a[6],a[2])*hn.MODULES_IN_CODEWORD/hn.MODULES_IN_STOP_PATTERN),Math.min(Qr.getMinWidth(a[1],a[5]),Qr.getMinWidth(a[7],a[3])*hn.MODULES_IN_CODEWORD/hn.MODULES_IN_STOP_PATTERN)))}reset(){}}class rc extends H{}rc.kind="ReaderException";class jh{constructor(a,u){this.verbose=a===!0,u&&this.setHints(u)}decode(a,u){return u&&this.setHints(u),this.decodeInternal(a)}decodeWithState(a){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(a)}setHints(a){this.hints=a;const u=!C(a)&&a.get(wt.TRY_HARDER)===!0,m=C(a)?null:a.get(wt.POSSIBLE_FORMATS),v=new Array;if(!C(m)){const w=m.some(I=>I===Bt.UPC_A||I===Bt.UPC_E||I===Bt.EAN_13||I===Bt.EAN_8||I===Bt.CODABAR||I===Bt.CODE_39||I===Bt.CODE_93||I===Bt.CODE_128||I===Bt.ITF||I===Bt.RSS_14||I===Bt.RSS_EXPANDED);w&&!u&&v.push(new hs(a,this.verbose)),m.includes(Bt.QR_CODE)&&v.push(new Gi),m.includes(Bt.DATA_MATRIX)&&v.push(new vt),m.includes(Bt.AZTEC)&&v.push(new $e),m.includes(Bt.PDF_417)&&v.push(new Qr),w&&u&&v.push(new hs(a,this.verbose))}v.length===0&&(u||v.push(new hs(a,this.verbose)),v.push(new Gi),v.push(new vt),v.push(new $e),v.push(new Qr),u&&v.push(new hs(a,this.verbose))),this.readers=v}reset(){if(this.readers!==null)for(const a of this.readers)a.reset()}decodeInternal(a){if(this.readers===null)throw new rc("No readers where selected, nothing can be read.");for(const u of this.readers)try{return u.decode(a,this.hints)}catch(m){if(m instanceof rc)continue}throw new Ie("No MultiFormat Readers were able to detect the code.")}}class Yu extends It{constructor(a=null,u=500){const m=new jh;m.setHints(a),super(m,u)}decodeBitmap(a){return this.reader.decodeWithState(a)}}class sa extends It{constructor(a=500){super(new Qr,a)}}class po extends It{constructor(a=500){super(new Gi,a)}}var xr;(function(le){le[le.ERROR_CORRECTION=0]="ERROR_CORRECTION",le[le.CHARACTER_SET=1]="CHARACTER_SET",le[le.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",le[le.MIN_SIZE=3]="MIN_SIZE",le[le.MAX_SIZE=4]="MAX_SIZE",le[le.MARGIN=5]="MARGIN",le[le.PDF417_COMPACT=6]="PDF417_COMPACT",le[le.PDF417_COMPACTION=7]="PDF417_COMPACTION",le[le.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",le[le.AZTEC_LAYERS=9]="AZTEC_LAYERS",le[le.QR_VERSION=10]="QR_VERSION"})(xr||(xr={}));var kr=xr;class Rl{constructor(a){this.field=a,this.cachedGenerators=[],this.cachedGenerators.push(new _i(a,Int32Array.from([1])))}buildGenerator(a){const u=this.cachedGenerators;if(a>=u.length){let m=u[u.length-1];const v=this.field;for(let w=u.length;w<=a;w++){const I=m.multiply(new _i(v,Int32Array.from([1,v.exp(w-1+v.getGeneratorBase())])));u.push(I),m=I}}return u[a]}encode(a,u){if(u===0)throw new K("No error correction bytes");const m=a.length-u;if(m<=0)throw new K("No data bytes provided");const v=this.buildGenerator(u),w=new Int32Array(m);ye.arraycopy(a,0,w,0,m);let I=new _i(this.field,w);I=I.multiplyByMonomial(u,1);const F=I.divide(v)[1].getCoefficients(),q=u-F.length;for(let te=0;te<q;te++)a[m+te]=0;ye.arraycopy(F,0,a,m+q,F.length)}}class Ar{constructor(){}static applyMaskPenaltyRule1(a){return Ar.applyMaskPenaltyRule1Internal(a,!0)+Ar.applyMaskPenaltyRule1Internal(a,!1)}static applyMaskPenaltyRule2(a){let u=0;const m=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let I=0;I<w-1;I++){const P=m[I];for(let F=0;F<v-1;F++){const q=P[F];q===P[F+1]&&q===m[I+1][F]&&q===m[I+1][F+1]&&u++}}return Ar.N2*u}static applyMaskPenaltyRule3(a){let u=0;const m=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let I=0;I<w;I++)for(let P=0;P<v;P++){const F=m[I];P+6<v&&F[P]===1&&F[P+1]===0&&F[P+2]===1&&F[P+3]===1&&F[P+4]===1&&F[P+5]===0&&F[P+6]===1&&(Ar.isWhiteHorizontal(F,P-4,P)||Ar.isWhiteHorizontal(F,P+7,P+11))&&u++,I+6<w&&m[I][P]===1&&m[I+1][P]===0&&m[I+2][P]===1&&m[I+3][P]===1&&m[I+4][P]===1&&m[I+5][P]===0&&m[I+6][P]===1&&(Ar.isWhiteVertical(m,P,I-4,I)||Ar.isWhiteVertical(m,P,I+7,I+11))&&u++}return u*Ar.N3}static isWhiteHorizontal(a,u,m){u=Math.max(u,0),m=Math.min(m,a.length);for(let v=u;v<m;v++)if(a[v]===1)return!1;return!0}static isWhiteVertical(a,u,m,v){m=Math.max(m,0),v=Math.min(v,a.length);for(let w=m;w<v;w++)if(a[w][u]===1)return!1;return!0}static applyMaskPenaltyRule4(a){let u=0;const m=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let F=0;F<w;F++){const q=m[F];for(let te=0;te<v;te++)q[te]===1&&u++}const I=a.getHeight()*a.getWidth();return Math.floor(Math.abs(u*2-I)*10/I)*Ar.N4}static getDataMaskBit(a,u,m){let v,w;switch(a){case 0:v=m+u&1;break;case 1:v=m&1;break;case 2:v=u%3;break;case 3:v=(m+u)%3;break;case 4:v=Math.floor(m/2)+Math.floor(u/3)&1;break;case 5:w=m*u,v=(w&1)+w%3;break;case 6:w=m*u,v=(w&1)+w%3&1;break;case 7:w=m*u,v=w%3+(m+u&1)&1;break;default:throw new K("Invalid mask pattern: "+a)}return v===0}static applyMaskPenaltyRule1Internal(a,u){let m=0;const v=u?a.getHeight():a.getWidth(),w=u?a.getWidth():a.getHeight(),I=a.getArray();for(let P=0;P<v;P++){let F=0,q=-1;for(let te=0;te<w;te++){const ce=u?I[P][te]:I[te][P];ce===q?F++:(F>=5&&(m+=Ar.N1+(F-5)),F=1,q=ce)}F>=5&&(m+=Ar.N1+(F-5))}return m}}Ar.N1=3,Ar.N2=3,Ar.N3=40,Ar.N4=10;class Cr{constructor(a,u){this.width=a,this.height=u;const m=new Array(u);for(let v=0;v!==u;v++)m[v]=new Uint8Array(a);this.bytes=m}getHeight(){return this.height}getWidth(){return this.width}get(a,u){return this.bytes[u][a]}getArray(){return this.bytes}setNumber(a,u,m){this.bytes[u][a]=m}setBoolean(a,u,m){this.bytes[u][a]=m?1:0}clear(a){for(const u of this.bytes)nt.fill(u,a)}equals(a){if(!(a instanceof Cr))return!1;const u=a;if(this.width!==u.width||this.height!==u.height)return!1;for(let m=0,v=this.height;m<v;++m){const w=this.bytes[m],I=u.bytes[m];for(let P=0,F=this.width;P<F;++P)if(w[P]!==I[P])return!1}return!0}toString(){const a=new gt;for(let u=0,m=this.height;u<m;++u){const v=this.bytes[u];for(let w=0,I=this.width;w<I;++w)switch(v[w]){case 0:a.append(" 0");break;case 1:a.append(" 1");break;default:a.append("  ");break}a.append(`
`)}return a.toString()}}class il{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const a=new gt;return a.append(`<<
`),a.append(" mode: "),a.append(this.mode?this.mode.toString():"null"),a.append(`
 ecLevel: `),a.append(this.ecLevel?this.ecLevel.toString():"null"),a.append(`
 version: `),a.append(this.version?this.version.toString():"null"),a.append(`
 maskPattern: `),a.append(this.maskPattern.toString()),this.matrix?(a.append(`
 matrix:
`),a.append(this.matrix.toString())):a.append(`
 matrix: null
`),a.append(`>>
`),a.toString()}setMode(a){this.mode=a}setECLevel(a){this.ecLevel=a}setVersion(a){this.version=a}setMaskPattern(a){this.maskPattern=a}setMatrix(a){this.matrix=a}static isValidMaskPattern(a){return a>=0&&a<il.NUM_MASK_PATTERNS}}il.NUM_MASK_PATTERNS=8;class nr extends H{}nr.kind="WriterException";class ii{constructor(){}static clearMatrix(a){a.clear(255)}static buildMatrix(a,u,m,v,w){ii.clearMatrix(w),ii.embedBasicPatterns(m,w),ii.embedTypeInfo(u,v,w),ii.maybeEmbedVersionInfo(m,w),ii.embedDataBits(a,v,w)}static embedBasicPatterns(a,u){ii.embedPositionDetectionPatternsAndSeparators(u),ii.embedDarkDotAtLeftBottomCorner(u),ii.maybeEmbedPositionAdjustmentPatterns(a,u),ii.embedTimingPatterns(u)}static embedTypeInfo(a,u,m){const v=new dt;ii.makeTypeInfoBits(a,u,v);for(let w=0,I=v.getSize();w<I;++w){const P=v.get(v.getSize()-1-w),F=ii.TYPE_INFO_COORDINATES[w],q=F[0],te=F[1];if(m.setBoolean(q,te,P),w<8){const ce=m.getWidth()-w-1;m.setBoolean(ce,8,P)}else{const xe=m.getHeight()-7+(w-8);m.setBoolean(8,xe,P)}}}static maybeEmbedVersionInfo(a,u){if(a.getVersionNumber()<7)return;const m=new dt;ii.makeVersionInfoBits(a,m);let v=17;for(let w=0;w<6;++w)for(let I=0;I<3;++I){const P=m.get(v);v--,u.setBoolean(w,u.getHeight()-11+I,P),u.setBoolean(u.getHeight()-11+I,w,P)}}static embedDataBits(a,u,m){let v=0,w=-1,I=m.getWidth()-1,P=m.getHeight()-1;for(;I>0;){for(I===6&&(I-=1);P>=0&&P<m.getHeight();){for(let F=0;F<2;++F){const q=I-F;if(!ii.isEmpty(m.get(q,P)))continue;let te;v<a.getSize()?(te=a.get(v),++v):te=!1,u!==255&&Ar.getDataMaskBit(u,q,P)&&(te=!te),m.setBoolean(q,P,te)}P+=w}w=-w,P+=w,I-=2}if(v!==a.getSize())throw new nr("Not all bits consumed: "+v+"/"+a.getSize())}static findMSBSet(a){return 32-Qe.numberOfLeadingZeros(a)}static calculateBCHCode(a,u){if(u===0)throw new K("0 polynomial");const m=ii.findMSBSet(u);for(a<<=m-1;ii.findMSBSet(a)>=m;)a^=u<<ii.findMSBSet(a)-m;return a}static makeTypeInfoBits(a,u,m){if(!il.isValidMaskPattern(u))throw new nr("Invalid mask pattern");const v=a.getBits()<<3|u;m.appendBits(v,5);const w=ii.calculateBCHCode(v,ii.TYPE_INFO_POLY);m.appendBits(w,10);const I=new dt;if(I.appendBits(ii.TYPE_INFO_MASK_PATTERN,15),m.xor(I),m.getSize()!==15)throw new nr("should not happen but we got: "+m.getSize())}static makeVersionInfoBits(a,u){u.appendBits(a.getVersionNumber(),6);const m=ii.calculateBCHCode(a.getVersionNumber(),ii.VERSION_INFO_POLY);if(u.appendBits(m,12),u.getSize()!==18)throw new nr("should not happen but we got: "+u.getSize())}static isEmpty(a){return a===255}static embedTimingPatterns(a){for(let u=8;u<a.getWidth()-8;++u){const m=(u+1)%2;ii.isEmpty(a.get(u,6))&&a.setNumber(u,6,m),ii.isEmpty(a.get(6,u))&&a.setNumber(6,u,m)}}static embedDarkDotAtLeftBottomCorner(a){if(a.get(8,a.getHeight()-8)===0)throw new nr;a.setNumber(8,a.getHeight()-8,1)}static embedHorizontalSeparationPattern(a,u,m){for(let v=0;v<8;++v){if(!ii.isEmpty(m.get(a+v,u)))throw new nr;m.setNumber(a+v,u,0)}}static embedVerticalSeparationPattern(a,u,m){for(let v=0;v<7;++v){if(!ii.isEmpty(m.get(a,u+v)))throw new nr;m.setNumber(a,u+v,0)}}static embedPositionAdjustmentPattern(a,u,m){for(let v=0;v<5;++v){const w=ii.POSITION_ADJUSTMENT_PATTERN[v];for(let I=0;I<5;++I)m.setNumber(a+I,u+v,w[I])}}static embedPositionDetectionPattern(a,u,m){for(let v=0;v<7;++v){const w=ii.POSITION_DETECTION_PATTERN[v];for(let I=0;I<7;++I)m.setNumber(a+I,u+v,w[I])}}static embedPositionDetectionPatternsAndSeparators(a){const u=ii.POSITION_DETECTION_PATTERN[0].length;ii.embedPositionDetectionPattern(0,0,a),ii.embedPositionDetectionPattern(a.getWidth()-u,0,a),ii.embedPositionDetectionPattern(0,a.getWidth()-u,a);const m=8;ii.embedHorizontalSeparationPattern(0,m-1,a),ii.embedHorizontalSeparationPattern(a.getWidth()-m,m-1,a),ii.embedHorizontalSeparationPattern(0,a.getWidth()-m,a);const v=7;ii.embedVerticalSeparationPattern(v,0,a),ii.embedVerticalSeparationPattern(a.getHeight()-v-1,0,a),ii.embedVerticalSeparationPattern(v,a.getHeight()-v,a)}static maybeEmbedPositionAdjustmentPatterns(a,u){if(a.getVersionNumber()<2)return;const m=a.getVersionNumber()-1,v=ii.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[m];for(let w=0,I=v.length;w!==I;w++){const P=v[w];if(P>=0)for(let F=0;F!==I;F++){const q=v[F];q>=0&&ii.isEmpty(u.get(q,P))&&ii.embedPositionAdjustmentPattern(q-2,P-2,u)}}}}ii.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),ii.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),ii.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),ii.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),ii.VERSION_INFO_POLY=7973,ii.TYPE_INFO_POLY=1335,ii.TYPE_INFO_MASK_PATTERN=21522;class Bd{constructor(a,u){this.dataBytes=a,this.errorCorrectionBytes=u}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class ir{constructor(){}static calculateMaskPenalty(a){return Ar.applyMaskPenaltyRule1(a)+Ar.applyMaskPenaltyRule2(a)+Ar.applyMaskPenaltyRule3(a)+Ar.applyMaskPenaltyRule4(a)}static encode(a,u,m=null){let v=ir.DEFAULT_BYTE_MODE_ENCODING;const w=m!==null&&m.get(kr.CHARACTER_SET)!==void 0;w&&(v=m.get(kr.CHARACTER_SET).toString());const I=this.chooseMode(a,v),P=new dt;if(I===Xn.BYTE&&(w||ir.DEFAULT_BYTE_MODE_ENCODING!==v)){const yn=He.getCharacterSetECIByName(v);yn!==void 0&&this.appendECI(yn,P)}this.appendModeInfo(I,P);const F=new dt;this.appendBytes(a,I,F,v);let q;if(m!==null&&m.get(kr.QR_VERSION)!==void 0){const yn=Number.parseInt(m.get(kr.QR_VERSION).toString(),10);q=zn.getVersionForNumber(yn);const un=this.calculateBitsNeeded(I,P,F,q);if(!this.willFit(un,q,u))throw new nr("Data too big for requested version")}else q=this.recommendVersion(u,I,P,F);const te=new dt;te.appendBitArray(P);const ce=I===Xn.BYTE?F.getSizeInBytes():a.length;this.appendLengthInfo(ce,q,I,te),te.appendBitArray(F);const xe=q.getECBlocksForLevel(u),ze=q.getTotalCodewords()-xe.getTotalECCodewords();this.terminateBits(ze,te);const it=this.interleaveWithECBytes(te,q.getTotalCodewords(),ze,xe.getNumBlocks()),lt=new il;lt.setECLevel(u),lt.setMode(I),lt.setVersion(q);const Tt=q.getDimensionForVersion(),Ft=new Cr(Tt,Tt),vn=this.chooseMaskPattern(it,u,q,Ft);return lt.setMaskPattern(vn),ii.buildMatrix(it,u,q,vn,Ft),lt.setMatrix(Ft),lt}static recommendVersion(a,u,m,v){const w=this.calculateBitsNeeded(u,m,v,zn.getVersionForNumber(1)),I=this.chooseVersion(w,a),P=this.calculateBitsNeeded(u,m,v,I);return this.chooseVersion(P,a)}static calculateBitsNeeded(a,u,m,v){return u.getSize()+a.getCharacterCountBits(v)+m.getSize()}static getAlphanumericCode(a){return a<ir.ALPHANUMERIC_TABLE.length?ir.ALPHANUMERIC_TABLE[a]:-1}static chooseMode(a,u=null){if(He.SJIS.getName()===u&&this.isOnlyDoubleByteKanji(a))return Xn.KANJI;let m=!1,v=!1;for(let w=0,I=a.length;w<I;++w){const P=a.charAt(w);if(ir.isDigit(P))m=!0;else if(this.getAlphanumericCode(P.charCodeAt(0))!==-1)v=!0;else return Xn.BYTE}return v?Xn.ALPHANUMERIC:m?Xn.NUMERIC:Xn.BYTE}static isOnlyDoubleByteKanji(a){let u;try{u=Pe.encode(a,He.SJIS)}catch{return!1}const m=u.length;if(m%2!==0)return!1;for(let v=0;v<m;v+=2){const w=u[v]&255;if((w<129||w>159)&&(w<224||w>235))return!1}return!0}static chooseMaskPattern(a,u,m,v){let w=Number.MAX_SAFE_INTEGER,I=-1;for(let P=0;P<il.NUM_MASK_PATTERNS;P++){ii.buildMatrix(a,u,m,P,v);let F=this.calculateMaskPenalty(v);F<w&&(w=F,I=P)}return I}static chooseVersion(a,u){for(let m=1;m<=40;m++){const v=zn.getVersionForNumber(m);if(ir.willFit(a,v,u))return v}throw new nr("Data too big")}static willFit(a,u,m){const v=u.getTotalCodewords(),I=u.getECBlocksForLevel(m).getTotalECCodewords(),P=v-I,F=(a+7)/8;return P>=F}static terminateBits(a,u){const m=a*8;if(u.getSize()>m)throw new nr("data bits cannot fit in the QR Code"+u.getSize()+" > "+m);for(let I=0;I<4&&u.getSize()<m;++I)u.appendBit(!1);const v=u.getSize()&7;if(v>0)for(let I=v;I<8;I++)u.appendBit(!1);const w=a-u.getSizeInBytes();for(let I=0;I<w;++I)u.appendBits((I&1)===0?236:17,8);if(u.getSize()!==m)throw new nr("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(a,u,m,v,w,I){if(v>=m)throw new nr("Block ID too large");const P=a%m,F=m-P,q=Math.floor(a/m),te=q+1,ce=Math.floor(u/m),xe=ce+1,ze=q-ce,it=te-xe;if(ze!==it)throw new nr("EC bytes mismatch");if(m!==F+P)throw new nr("RS blocks mismatch");if(a!==(ce+ze)*F+(xe+it)*P)throw new nr("Total bytes mismatch");v<F?(w[0]=ce,I[0]=ze):(w[0]=xe,I[0]=it)}static interleaveWithECBytes(a,u,m,v){if(a.getSizeInBytes()!==m)throw new nr("Number of bits and data bytes does not match");let w=0,I=0,P=0;const F=new Array;for(let te=0;te<v;++te){const ce=new Int32Array(1),xe=new Int32Array(1);ir.getNumDataBytesAndNumECBytesForBlockID(u,m,v,te,ce,xe);const ze=ce[0],it=new Uint8Array(ze);a.toBytes(8*w,it,0,ze);const lt=ir.generateECBytes(it,xe[0]);F.push(new Bd(it,lt)),I=Math.max(I,ze),P=Math.max(P,lt.length),w+=ce[0]}if(m!==w)throw new nr("Data bytes does not match offset");const q=new dt;for(let te=0;te<I;++te)for(const ce of F){const xe=ce.getDataBytes();te<xe.length&&q.appendBits(xe[te],8)}for(let te=0;te<P;++te)for(const ce of F){const xe=ce.getErrorCorrectionBytes();te<xe.length&&q.appendBits(xe[te],8)}if(u!==q.getSizeInBytes())throw new nr("Interleaving error: "+u+" and "+q.getSizeInBytes()+" differ.");return q}static generateECBytes(a,u){const m=a.length,v=new Int32Array(m+u);for(let I=0;I<m;I++)v[I]=a[I]&255;new Rl(Kn.QR_CODE_FIELD_256).encode(v,u);const w=new Uint8Array(u);for(let I=0;I<u;I++)w[I]=v[m+I];return w}static appendModeInfo(a,u){u.appendBits(a.getBits(),4)}static appendLengthInfo(a,u,m,v){const w=m.getCharacterCountBits(u);if(a>=1<<w)throw new nr(a+" is bigger than "+((1<<w)-1));v.appendBits(a,w)}static appendBytes(a,u,m,v){switch(u){case Xn.NUMERIC:ir.appendNumericBytes(a,m);break;case Xn.ALPHANUMERIC:ir.appendAlphanumericBytes(a,m);break;case Xn.BYTE:ir.append8BitBytes(a,m,v);break;case Xn.KANJI:ir.appendKanjiBytes(a,m);break;default:throw new nr("Invalid mode: "+u)}}static getDigit(a){return a.charCodeAt(0)-48}static isDigit(a){const u=ir.getDigit(a);return u>=0&&u<=9}static appendNumericBytes(a,u){const m=a.length;let v=0;for(;v<m;){const w=ir.getDigit(a.charAt(v));if(v+2<m){const I=ir.getDigit(a.charAt(v+1)),P=ir.getDigit(a.charAt(v+2));u.appendBits(w*100+I*10+P,10),v+=3}else if(v+1<m){const I=ir.getDigit(a.charAt(v+1));u.appendBits(w*10+I,7),v+=2}else u.appendBits(w,4),v++}}static appendAlphanumericBytes(a,u){const m=a.length;let v=0;for(;v<m;){const w=ir.getAlphanumericCode(a.charCodeAt(v));if(w===-1)throw new nr;if(v+1<m){const I=ir.getAlphanumericCode(a.charCodeAt(v+1));if(I===-1)throw new nr;u.appendBits(w*45+I,11),v+=2}else u.appendBits(w,6),v++}}static append8BitBytes(a,u,m){let v;try{v=Pe.encode(a,m)}catch(w){throw new nr(w)}for(let w=0,I=v.length;w!==I;w++){const P=v[w];u.appendBits(P,8)}}static appendKanjiBytes(a,u){let m;try{m=Pe.encode(a,He.SJIS)}catch(w){throw new nr(w)}const v=m.length;for(let w=0;w<v;w+=2){const I=m[w]&255,P=m[w+1]&255,F=I<<8&4294967295|P;let q=-1;if(F>=33088&&F<=40956?q=F-33088:F>=57408&&F<=60351&&(q=F-49472),q===-1)throw new nr("Invalid byte sequence");const te=(q>>8)*192+(q&255);u.appendBits(te,13)}}static appendECI(a,u){u.appendBits(Xn.ECI.getBits(),4),u.appendBits(a.getValue(),8)}}ir.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),ir.DEFAULT_BYTE_MODE_ENCODING=He.UTF8.getName();class mo{write(a,u,m,v=null){if(a.length===0)throw new K("Found empty contents");if(u<0||m<0)throw new K("Requested dimensions are too small: "+u+"x"+m);let w=on.L,I=mo.QUIET_ZONE_SIZE;v!==null&&(v.get(kr.ERROR_CORRECTION)!==void 0&&(w=on.fromString(v.get(kr.ERROR_CORRECTION).toString())),v.get(kr.MARGIN)!==void 0&&(I=Number.parseInt(v.get(kr.MARGIN).toString(),10)));const P=ir.encode(a,w,v);return this.renderResult(P,u,m,I)}writeToDom(a,u,m,v,w=null){typeof a=="string"&&(a=document.querySelector(a));const I=this.write(u,m,v,w);a&&a.appendChild(I)}renderResult(a,u,m,v){const w=a.getMatrix();if(w===null)throw new ti;const I=w.getWidth(),P=w.getHeight(),F=I+v*2,q=P+v*2,te=Math.max(u,F),ce=Math.max(m,q),xe=Math.min(Math.floor(te/F),Math.floor(ce/q)),ze=Math.floor((te-I*xe)/2),it=Math.floor((ce-P*xe)/2),lt=this.createSVGElement(te,ce);for(let Tt=0,Ft=it;Tt<P;Tt++,Ft+=xe)for(let vn=0,yn=ze;vn<I;vn++,yn+=xe)if(w.get(vn,Tt)===1){const un=this.createSvgRectElement(yn,Ft,xe,xe);lt.appendChild(un)}return lt}createSVGElement(a,u){const m=document.createElementNS(mo.SVG_NS,"svg");return m.setAttributeNS(null,"height",a.toString()),m.setAttributeNS(null,"width",u.toString()),m}createSvgRectElement(a,u,m,v){const w=document.createElementNS(mo.SVG_NS,"rect");return w.setAttributeNS(null,"x",a.toString()),w.setAttributeNS(null,"y",u.toString()),w.setAttributeNS(null,"height",m.toString()),w.setAttributeNS(null,"width",v.toString()),w.setAttributeNS(null,"fill","#000000"),w}}mo.QUIET_ZONE_SIZE=4,mo.SVG_NS="http://www.w3.org/2000/svg";class Wa{encode(a,u,m,v,w){if(a.length===0)throw new K("Found empty contents");if(u!==Bt.QR_CODE)throw new K("Can only encode QR_CODE, but got "+u);if(m<0||v<0)throw new K(`Requested dimensions are too small: ${m}x${v}`);let I=on.L,P=Wa.QUIET_ZONE_SIZE;w!==null&&(w.get(kr.ERROR_CORRECTION)!==void 0&&(I=on.fromString(w.get(kr.ERROR_CORRECTION).toString())),w.get(kr.MARGIN)!==void 0&&(P=Number.parseInt(w.get(kr.MARGIN).toString(),10)));const F=ir.encode(a,I,w);return Wa.renderResult(F,m,v,P)}static renderResult(a,u,m,v){const w=a.getMatrix();if(w===null)throw new ti;const I=w.getWidth(),P=w.getHeight(),F=I+v*2,q=P+v*2,te=Math.max(u,F),ce=Math.max(m,q),xe=Math.min(Math.floor(te/F),Math.floor(ce/q)),ze=Math.floor((te-I*xe)/2),it=Math.floor((ce-P*xe)/2),lt=new Rt(te,ce);for(let Tt=0,Ft=it;Tt<P;Tt++,Ft+=xe)for(let vn=0,yn=ze;vn<I;vn++,yn+=xe)w.get(vn,Tt)===1&&lt.setRegion(yn,Ft,xe,xe);return lt}}Wa.QUIET_ZONE_SIZE=4;class $u{encode(a,u,m,v,w){let I;if(u===Bt.QR_CODE)I=new Wa;else throw new K("No encoder available for format "+u);return I.encode(a,u,m,v,w)}}class ga extends st{constructor(a,u,m,v,w,I,P,F){if(super(I,P),this.yuvData=a,this.dataWidth=u,this.dataHeight=m,this.left=v,this.top=w,v+I>u||w+P>m)throw new K("Crop rectangle does not fit within image data.");F&&this.reverseHorizontal(I,P)}getRow(a,u){if(a<0||a>=this.getHeight())throw new K("Requested row is outside the image: "+a);const m=this.getWidth();(u==null||u.length<m)&&(u=new Uint8ClampedArray(m));const v=(a+this.top)*this.dataWidth+this.left;return ye.arraycopy(this.yuvData,v,u,0,m),u}getMatrix(){const a=this.getWidth(),u=this.getHeight();if(a===this.dataWidth&&u===this.dataHeight)return this.yuvData;const m=a*u,v=new Uint8ClampedArray(m);let w=this.top*this.dataWidth+this.left;if(a===this.dataWidth)return ye.arraycopy(this.yuvData,w,v,0,m),v;for(let I=0;I<u;I++){const P=I*a;ye.arraycopy(this.yuvData,w,v,P,a),w+=this.dataWidth}return v}isCropSupported(){return!0}crop(a,u,m,v){return new ga(this.yuvData,this.dataWidth,this.dataHeight,this.left+a,this.top+u,m,v,!1)}renderThumbnail(){const a=this.getWidth()/ga.THUMBNAIL_SCALE_FACTOR,u=this.getHeight()/ga.THUMBNAIL_SCALE_FACTOR,m=new Int32Array(a*u),v=this.yuvData;let w=this.top*this.dataWidth+this.left;for(let I=0;I<u;I++){const P=I*a;for(let F=0;F<a;F++){const q=v[w+F*ga.THUMBNAIL_SCALE_FACTOR]&255;m[P+F]=4278190080|q*65793}w+=this.dataWidth*ga.THUMBNAIL_SCALE_FACTOR}return m}getThumbnailWidth(){return this.getWidth()/ga.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/ga.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(a,u){const m=this.yuvData;for(let v=0,w=this.top*this.dataWidth+this.left;v<u;v++,w+=this.dataWidth){const I=w+a/2;for(let P=w,F=w+a-1;P<I;P++,F--){const q=m[P];m[P]=m[F],m[F]=q}}}invert(){return new mt(this)}}ga.THUMBNAIL_SCALE_FACTOR=2;class rl extends st{constructor(a,u,m,v,w,I,P){if(super(u,m),this.dataWidth=v,this.dataHeight=w,this.left=I,this.top=P,a.BYTES_PER_ELEMENT===4){const F=u*m,q=new Uint8ClampedArray(F);for(let te=0;te<F;te++){const ce=a[te],xe=ce>>16&255,ze=ce>>7&510,it=ce&255;q[te]=(xe+ze+it)/4&255}this.luminances=q}else this.luminances=a;if(v===void 0&&(this.dataWidth=u),w===void 0&&(this.dataHeight=m),I===void 0&&(this.left=0),P===void 0&&(this.top=0),this.left+u>this.dataWidth||this.top+m>this.dataHeight)throw new K("Crop rectangle does not fit within image data.")}getRow(a,u){if(a<0||a>=this.getHeight())throw new K("Requested row is outside the image: "+a);const m=this.getWidth();(u==null||u.length<m)&&(u=new Uint8ClampedArray(m));const v=(a+this.top)*this.dataWidth+this.left;return ye.arraycopy(this.luminances,v,u,0,m),u}getMatrix(){const a=this.getWidth(),u=this.getHeight();if(a===this.dataWidth&&u===this.dataHeight)return this.luminances;const m=a*u,v=new Uint8ClampedArray(m);let w=this.top*this.dataWidth+this.left;if(a===this.dataWidth)return ye.arraycopy(this.luminances,w,v,0,m),v;for(let I=0;I<u;I++){const P=I*a;ye.arraycopy(this.luminances,w,v,P,a),w+=this.dataWidth}return v}isCropSupported(){return!0}crop(a,u,m,v){return new rl(this.luminances,m,v,this.dataWidth,this.dataHeight,this.left+a,this.top+u)}invert(){return new mt(this)}}class Dl extends He{static forName(a){return this.getCharacterSetECIByName(a)}}class Lr{}Lr.ISO_8859_1=He.ISO8859_1;class Nl{isCompact(){return this.compact}setCompact(a){this.compact=a}getSize(){return this.size}setSize(a){this.size=a}getLayers(){return this.layers}setLayers(a){this.layers=a}getCodeWords(){return this.codeWords}setCodeWords(a){this.codeWords=a}getMatrix(){return this.matrix}setMatrix(a){this.matrix=a}}class kl{static singletonList(a){return[a]}static min(a,u){return a.sort(u)[0]}}class sc{constructor(a){this.previous=a}getPrevious(){return this.previous}}class Ea extends sc{constructor(a,u,m){super(a),this.value=u,this.bitCount=m}appendTo(a,u){a.appendBits(this.value,this.bitCount)}add(a,u){return new Ea(this,a,u)}addBinaryShift(a,u){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Ea(this,a,u)}toString(){let a=this.value&(1<<this.bitCount)-1;return a|=1<<this.bitCount,"<"+Qe.toBinaryString(a|1<<this.bitCount).substring(1)+">"}}class hu extends Ea{constructor(a,u,m){super(a,0,0),this.binaryShiftStart=u,this.binaryShiftByteCount=m}appendTo(a,u){for(let m=0;m<this.binaryShiftByteCount;m++)(m===0||m===31&&this.binaryShiftByteCount<=62)&&(a.appendBits(31,5),this.binaryShiftByteCount>62?a.appendBits(this.binaryShiftByteCount-31,16):m===0?a.appendBits(Math.min(this.binaryShiftByteCount,31),5):a.appendBits(this.binaryShiftByteCount-31,5)),a.appendBits(u[this.binaryShiftStart+m],8)}addBinaryShift(a,u){return new hu(this,a,u)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Mc(le,a,u){return new hu(le,a,u)}function ac(le,a,u){return new Ea(le,a,u)}const Ya=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],$a=0,Rc=1,Sa=2,Dc=3,Ta=4,Pl=new Ea(null,0,0),sl=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function Uh(le){for(let a of le)nt.fill(a,-1);return le[$a][Ta]=0,le[Rc][Ta]=0,le[Rc][$a]=28,le[Dc][Ta]=0,le[Sa][Ta]=0,le[Sa][$a]=15,le}const oc=Uh(nt.createInt32Array(6,6));class ks{constructor(a,u,m,v){this.token=a,this.mode=u,this.binaryShiftByteCount=m,this.bitCount=v}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(a,u){let m=this.bitCount,v=this.token;if(a!==this.mode){let I=sl[this.mode][a];v=ac(v,I&65535,I>>16),m+=I>>16}let w=a===Sa?4:5;return v=ac(v,u,w),new ks(v,a,0,m+w)}shiftAndAppend(a,u){let m=this.token,v=this.mode===Sa?4:5;return m=ac(m,oc[this.mode][a],v),m=ac(m,u,5),new ks(m,this.mode,0,this.bitCount+v+5)}addBinaryShiftChar(a){let u=this.token,m=this.mode,v=this.bitCount;if(this.mode===Ta||this.mode===Sa){let P=sl[m][$a];u=ac(u,P&65535,P>>16),v+=P>>16,m=$a}let w=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,I=new ks(u,m,this.binaryShiftByteCount+1,v+w);return I.binaryShiftByteCount===2078&&(I=I.endBinaryShift(a+1)),I}endBinaryShift(a){if(this.binaryShiftByteCount===0)return this;let u=this.token;return u=Mc(u,a-this.binaryShiftByteCount,this.binaryShiftByteCount),new ks(u,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(a){let u=this.bitCount+(sl[this.mode][a.mode]>>16);return this.binaryShiftByteCount<a.binaryShiftByteCount?u+=ks.calculateBinaryShiftCost(a)-ks.calculateBinaryShiftCost(this):this.binaryShiftByteCount>a.binaryShiftByteCount&&a.binaryShiftByteCount>0&&(u+=10),u<=a.bitCount}toBitArray(a){let u=[];for(let v=this.endBinaryShift(a.length).token;v!==null;v=v.getPrevious())u.unshift(v);let m=new dt;for(const v of u)v.appendTo(m,a);return m}toString(){return ot.format("%s bits=%d bytes=%d",Ya[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(a){return a.binaryShiftByteCount>62?21:a.binaryShiftByteCount>31?20:a.binaryShiftByteCount>0?10:0}}ks.INITIAL_STATE=new ks(Pl,$a,0,0);function Ku(le){const a=ot.getCharCode(" "),u=ot.getCharCode("."),m=ot.getCharCode(",");le[$a][a]=1;const v=ot.getCharCode("Z"),w=ot.getCharCode("A");for(let xe=w;xe<=v;xe++)le[$a][xe]=xe-w+2;le[Rc][a]=1;const I=ot.getCharCode("z"),P=ot.getCharCode("a");for(let xe=P;xe<=I;xe++)le[Rc][xe]=xe-P+2;le[Sa][a]=1;const F=ot.getCharCode("9"),q=ot.getCharCode("0");for(let xe=q;xe<=F;xe++)le[Sa][xe]=xe-q+2;le[Sa][m]=12,le[Sa][u]=13;const te=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let xe=0;xe<te.length;xe++)le[Dc][ot.getCharCode(te[xe])]=xe;const ce=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let xe=0;xe<ce.length;xe++)ot.getCharCode(ce[xe])>0&&(le[Ta][ot.getCharCode(ce[xe])]=xe);return le}const Ol=Ku(nt.createInt32Array(5,256));class ka{constructor(a){this.text=a}encode(){const a=ot.getCharCode(" "),u=ot.getCharCode(`
`);let m=kl.singletonList(ks.INITIAL_STATE);for(let w=0;w<this.text.length;w++){let I,P=w+1<this.text.length?this.text[w+1]:0;switch(this.text[w]){case ot.getCharCode("\r"):I=P===u?2:0;break;case ot.getCharCode("."):I=P===a?3:0;break;case ot.getCharCode(","):I=P===a?4:0;break;case ot.getCharCode(":"):I=P===a?5:0;break;default:I=0}I>0?(m=ka.updateStateListForPair(m,w,I),w++):m=this.updateStateListForChar(m,w)}return kl.min(m,(w,I)=>w.getBitCount()-I.getBitCount()).toBitArray(this.text)}updateStateListForChar(a,u){const m=[];for(let v of a)this.updateStateForChar(v,u,m);return ka.simplifyStates(m)}updateStateForChar(a,u,m){let v=this.text[u]&255,w=Ol[a.getMode()][v]>0,I=null;for(let P=0;P<=Ta;P++){let F=Ol[P][v];if(F>0){if(I==null&&(I=a.endBinaryShift(u)),!w||P===a.getMode()||P===Sa){const q=I.latchAndAppend(P,F);m.push(q)}if(!w&&oc[a.getMode()][P]>=0){const q=I.shiftAndAppend(P,F);m.push(q)}}}if(a.getBinaryShiftByteCount()>0||Ol[a.getMode()][v]===0){let P=a.addBinaryShiftChar(u);m.push(P)}}static updateStateListForPair(a,u,m){const v=[];for(let w of a)this.updateStateForPair(w,u,m,v);return this.simplifyStates(v)}static updateStateForPair(a,u,m,v){let w=a.endBinaryShift(u);if(v.push(w.latchAndAppend(Ta,m)),a.getMode()!==Ta&&v.push(w.shiftAndAppend(Ta,m)),m===3||m===4){let I=w.latchAndAppend(Sa,16-m).latchAndAppend(Sa,1);v.push(I)}if(a.getBinaryShiftByteCount()>0){let I=a.addBinaryShiftChar(u).addBinaryShiftChar(u+1);v.push(I)}}static simplifyStates(a){let u=[];for(const m of a){let v=!0;for(const w of u){if(w.isBetterThanOrEqualTo(m)){v=!1;break}m.isBetterThanOrEqualTo(w)&&(u=u.filter(I=>I!==w))}v&&u.push(m)}return u}}class Vi{constructor(){}static encodeBytes(a){return Vi.encode(a,Vi.DEFAULT_EC_PERCENT,Vi.DEFAULT_AZTEC_LAYERS)}static encode(a,u,m){let v=new ka(a).encode(),w=Qe.truncDivision(v.getSize()*u,100)+11,I=v.getSize()+w,P,F,q,te,ce;if(m!==Vi.DEFAULT_AZTEC_LAYERS){if(P=m<0,F=Math.abs(m),F>(P?Vi.MAX_NB_BITS_COMPACT:Vi.MAX_NB_BITS))throw new K(ot.format("Illegal value %s for layers",m));q=Vi.totalBitsInLayer(F,P),te=Vi.WORD_SIZE[F];let un=q-q%te;if(ce=Vi.stuffBits(v,te),ce.getSize()+w>un)throw new K("Data to large for user specified layer");if(P&&ce.getSize()>te*64)throw new K("Data to large for user specified layer")}else{te=0,ce=null;for(let un=0;;un++){if(un>Vi.MAX_NB_BITS)throw new K("Data too large for an Aztec code");if(P=un<=3,F=P?un+1:un,q=Vi.totalBitsInLayer(F,P),I>q)continue;(ce==null||te!==Vi.WORD_SIZE[F])&&(te=Vi.WORD_SIZE[F],ce=Vi.stuffBits(v,te));let Ni=q-q%te;if(!(P&&ce.getSize()>te*64)&&ce.getSize()+w<=Ni)break}}let xe=Vi.generateCheckWords(ce,q,te),ze=ce.getSize()/te,it=Vi.generateModeMessage(P,F,ze),lt=(P?11:14)+F*4,Tt=new Int32Array(lt),Ft;if(P){Ft=lt;for(let un=0;un<Tt.length;un++)Tt[un]=un}else{Ft=lt+1+2*Qe.truncDivision(Qe.truncDivision(lt,2)-1,15);let un=Qe.truncDivision(lt,2),Ni=Qe.truncDivision(Ft,2);for(let Pn=0;Pn<un;Pn++){let Ur=Pn+Qe.truncDivision(Pn,15);Tt[un-Pn-1]=Ni-Ur-1,Tt[un+Pn]=Ni+Ur+1}}let vn=new Rt(Ft);for(let un=0,Ni=0;un<F;un++){let Pn=(F-un)*4+(P?9:12);for(let Ur=0;Ur<Pn;Ur++){let aa=Ur*2;for(let Ts=0;Ts<2;Ts++)xe.get(Ni+aa+Ts)&&vn.set(Tt[un*2+Ts],Tt[un*2+Ur]),xe.get(Ni+Pn*2+aa+Ts)&&vn.set(Tt[un*2+Ur],Tt[lt-1-un*2-Ts]),xe.get(Ni+Pn*4+aa+Ts)&&vn.set(Tt[lt-1-un*2-Ts],Tt[lt-1-un*2-Ur]),xe.get(Ni+Pn*6+aa+Ts)&&vn.set(Tt[lt-1-un*2-Ur],Tt[un*2+Ts])}Ni+=Pn*8}if(Vi.drawModeMessage(vn,P,Ft,it),P)Vi.drawBullsEye(vn,Qe.truncDivision(Ft,2),5);else{Vi.drawBullsEye(vn,Qe.truncDivision(Ft,2),7);for(let un=0,Ni=0;un<Qe.truncDivision(lt,2)-1;un+=15,Ni+=16)for(let Pn=Qe.truncDivision(Ft,2)&1;Pn<Ft;Pn+=2)vn.set(Qe.truncDivision(Ft,2)-Ni,Pn),vn.set(Qe.truncDivision(Ft,2)+Ni,Pn),vn.set(Pn,Qe.truncDivision(Ft,2)-Ni),vn.set(Pn,Qe.truncDivision(Ft,2)+Ni)}let yn=new Nl;return yn.setCompact(P),yn.setSize(Ft),yn.setLayers(F),yn.setCodeWords(ze),yn.setMatrix(vn),yn}static drawBullsEye(a,u,m){for(let v=0;v<m;v+=2)for(let w=u-v;w<=u+v;w++)a.set(w,u-v),a.set(w,u+v),a.set(u-v,w),a.set(u+v,w);a.set(u-m,u-m),a.set(u-m+1,u-m),a.set(u-m,u-m+1),a.set(u+m,u-m),a.set(u+m,u-m+1),a.set(u+m,u+m-1)}static generateModeMessage(a,u,m){let v=new dt;return a?(v.appendBits(u-1,2),v.appendBits(m-1,6),v=Vi.generateCheckWords(v,28,4)):(v.appendBits(u-1,5),v.appendBits(m-1,11),v=Vi.generateCheckWords(v,40,4)),v}static drawModeMessage(a,u,m,v){let w=Qe.truncDivision(m,2);if(u)for(let I=0;I<7;I++){let P=w-3+I;v.get(I)&&a.set(P,w-5),v.get(I+7)&&a.set(w+5,P),v.get(20-I)&&a.set(P,w+5),v.get(27-I)&&a.set(w-5,P)}else for(let I=0;I<10;I++){let P=w-5+I+Qe.truncDivision(I,5);v.get(I)&&a.set(P,w-7),v.get(I+10)&&a.set(w+7,P),v.get(29-I)&&a.set(P,w+7),v.get(39-I)&&a.set(w-7,P)}}static generateCheckWords(a,u,m){let v=a.getSize()/m,w=new Rl(Vi.getGF(m)),I=Qe.truncDivision(u,m),P=Vi.bitsToWords(a,m,I);w.encode(P,I-v);let F=u%m,q=new dt;q.appendBits(0,F);for(const te of Array.from(P))q.appendBits(te,m);return q}static bitsToWords(a,u,m){let v=new Int32Array(m),w,I;for(w=0,I=a.getSize()/u;w<I;w++){let P=0;for(let F=0;F<u;F++)P|=a.get(w*u+F)?1<<u-F-1:0;v[w]=P}return v}static getGF(a){switch(a){case 4:return Kn.AZTEC_PARAM;case 6:return Kn.AZTEC_DATA_6;case 8:return Kn.AZTEC_DATA_8;case 10:return Kn.AZTEC_DATA_10;case 12:return Kn.AZTEC_DATA_12;default:throw new K("Unsupported word size "+a)}}static stuffBits(a,u){let m=new dt,v=a.getSize(),w=(1<<u)-2;for(let I=0;I<v;I+=u){let P=0;for(let F=0;F<u;F++)(I+F>=v||a.get(I+F))&&(P|=1<<u-1-F);(P&w)===w?(m.appendBits(P&w,u),I--):(P&w)===0?(m.appendBits(P|1,u),I--):m.appendBits(P,u)}return m}static totalBitsInLayer(a,u){return((u?88:112)+16*a)*a}}Vi.DEFAULT_EC_PERCENT=33,Vi.DEFAULT_AZTEC_LAYERS=0,Vi.MAX_NB_BITS=32,Vi.MAX_NB_BITS_COMPACT=4,Vi.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class al{encode(a,u,m,v){return this.encodeWithHints(a,u,m,v,null)}encodeWithHints(a,u,m,v,w){let I=Lr.ISO_8859_1,P=Vi.DEFAULT_EC_PERCENT,F=Vi.DEFAULT_AZTEC_LAYERS;return w!=null&&(w.has(kr.CHARACTER_SET)&&(I=Dl.forName(w.get(kr.CHARACTER_SET).toString())),w.has(kr.ERROR_CORRECTION)&&(P=Qe.parseInt(w.get(kr.ERROR_CORRECTION).toString())),w.has(kr.AZTEC_LAYERS)&&(F=Qe.parseInt(w.get(kr.AZTEC_LAYERS).toString()))),al.encodeLayers(a,u,m,v,I,P,F)}static encodeLayers(a,u,m,v,w,I,P){if(u!==Bt.AZTEC)throw new K("Can only encode AZTEC, but got "+u);let F=Vi.encode(ot.getBytes(a,w),I,P);return al.renderResult(F,m,v)}static renderResult(a,u,m){let v=a.getMatrix();if(v==null)throw new ti;let w=v.getWidth(),I=v.getHeight(),P=Math.max(u,w),F=Math.max(m,I),q=Math.min(P/w,F/I),te=(P-w*q)/2,ce=(F-I*q)/2,xe=new Rt(P,F);for(let ze=0,it=ce;ze<I;ze++,it+=q)for(let lt=0,Tt=te;lt<w;lt++,Tt+=q)v.get(lt,ze)&&xe.setRegion(Tt,it,q,q);return xe}}y.AbstractExpandedDecoder=vi,y.ArgumentException=$,y.ArithmeticException=$n,y.AztecCode=Nl,y.AztecCodeReader=$e,y.AztecCodeWriter=al,y.AztecDecoder=Yt,y.AztecDetector=qe,y.AztecDetectorResult=Yi,y.AztecEncoder=Vi,y.AztecHighLevelEncoder=ka,y.AztecPoint=ge,y.BarcodeFormat=Bt,y.Binarizer=Ee,y.BinaryBitmap=be,y.BitArray=dt,y.BitMatrix=Rt,y.BitSource=Ds,y.BrowserAztecCodeReader=bt,y.BrowserBarcodeReader=Yo,y.BrowserCodeReader=It,y.BrowserDatamatrixCodeReader=tn,y.BrowserMultiFormatReader=Yu,y.BrowserPDF417Reader=sa,y.BrowserQRCodeReader=po,y.BrowserQRCodeSvgWriter=mo,y.CharacterSetECI=He,y.ChecksumException=Ce,y.Code128Reader=fe,y.Code39Reader=de,y.DataMatrixDecodedBitStreamParser=Ra,y.DataMatrixReader=vt,y.DecodeHintType=wt,y.DecoderResult=Rn,y.DefaultGridSampler=oe,y.DetectorResult=Zn,y.EAN13Reader=cn,y.EncodeHintType=kr,y.Exception=H,y.FormatException=tt,y.GenericGF=Kn,y.GenericGFPoly=_i,y.GlobalHistogramBinarizer=Se,y.GridSampler=ci,y.GridSamplerInstance=ue,y.HTMLCanvasElementLuminanceSource=Xt,y.HybridBinarizer=je,y.ITFReader=Me,y.IllegalArgumentException=K,y.IllegalStateException=ti,y.InvertedLuminanceSource=mt,y.LuminanceSource=st,y.MathUtils=fn,y.MultiFormatOneDReader=hs,y.MultiFormatReader=jh,y.MultiFormatWriter=$u,y.NotFoundException=Ie,y.OneDReader=at,y.PDF417DecodedBitStreamParser=zt,y.PDF417DecoderErrorCorrection=ma,y.PDF417Reader=Qr,y.PDF417ResultMetadata=Qo,y.PerspectiveTransform=ct,y.PlanarYUVLuminanceSource=ga,y.QRCodeByteMatrix=Cr,y.QRCodeDataMask=Dr,y.QRCodeDecodedBitStreamParser=Ui,y.QRCodeDecoderErrorCorrectionLevel=on,y.QRCodeDecoderFormatInformation=pn,y.QRCodeEncoder=ir,y.QRCodeEncoderQRCode=il,y.QRCodeMaskUtil=Ar,y.QRCodeMatrixUtil=ii,y.QRCodeMode=Xn,y.QRCodeReader=Gi,y.QRCodeVersion=zn,y.QRCodeWriter=Wa,y.RGBLuminanceSource=rl,y.RSS14Reader=Hn,y.RSSExpandedReader=an,y.ReaderException=rc,y.ReedSolomonDecoder=Bi,y.ReedSolomonEncoder=Rl,y.ReedSolomonException=Qn,y.Result=Nt,y.ResultMetadataType=Tn,y.ResultPoint=gn,y.StringUtils=ot,y.UnsupportedOperationException=pt,y.VideoInputDevice=Oe,y.WhiteRectangleDetector=fi,y.WriterException=nr,y.ZXingArrays=nt,y.ZXingCharset=Dl,y.ZXingInteger=Qe,y.ZXingStandardCharsets=Lr,y.ZXingStringBuilder=gt,y.ZXingStringEncoding=Pe,y.ZXingSystem=ye,y.createAbstractExpandedDecoder=da,Object.defineProperty(y,"__esModule",{value:!0})}))})(Em,Em.exports)),Em.exports}var _s=N4();const k4=f0(_s),P4=J_({__proto__:null,default:k4},[_s]);var B_=(function(){function c(f,y,C){if(this.formatMap=new Map([[qn.QR_CODE,_s.BarcodeFormat.QR_CODE],[qn.AZTEC,_s.BarcodeFormat.AZTEC],[qn.CODABAR,_s.BarcodeFormat.CODABAR],[qn.CODE_39,_s.BarcodeFormat.CODE_39],[qn.CODE_93,_s.BarcodeFormat.CODE_93],[qn.CODE_128,_s.BarcodeFormat.CODE_128],[qn.DATA_MATRIX,_s.BarcodeFormat.DATA_MATRIX],[qn.MAXICODE,_s.BarcodeFormat.MAXICODE],[qn.ITF,_s.BarcodeFormat.ITF],[qn.EAN_13,_s.BarcodeFormat.EAN_13],[qn.EAN_8,_s.BarcodeFormat.EAN_8],[qn.PDF_417,_s.BarcodeFormat.PDF_417],[qn.RSS_14,_s.BarcodeFormat.RSS_14],[qn.RSS_EXPANDED,_s.BarcodeFormat.RSS_EXPANDED],[qn.UPC_A,_s.BarcodeFormat.UPC_A],[qn.UPC_E,_s.BarcodeFormat.UPC_E],[qn.UPC_EAN_EXTENSION,_s.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!P4)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=y,this.logger=C;var N=this.createZXingFormats(f),k=new Map;k.set(_s.DecodeHintType.POSSIBLE_FORMATS,N),k.set(_s.DecodeHintType.TRY_HARDER,!1),this.hints=k}return c.prototype.decodeAsync=function(f){var y=this;return new Promise(function(C,N){try{C(y.decode(f))}catch(k){N(k)}})},c.prototype.decode=function(f){var y=new _s.MultiFormatReader(this.verbose,this.hints),C=new _s.HTMLCanvasElementLuminanceSource(f),N=new _s.BinaryBitmap(new _s.HybridBinarizer(C)),k=y.decode(N);return{text:k.text,format:b2.create(this.toHtml5QrcodeSupportedFormats(k.format)),debugData:this.createDebugData()}},c.prototype.createReverseFormatMap=function(){var f=new Map;return this.formatMap.forEach(function(y,C,N){f.set(y,C)}),f},c.prototype.toHtml5QrcodeSupportedFormats=function(f){if(!this.reverseFormatMap.has(f))throw"reverseFormatMap doesn't have ".concat(f);return this.reverseFormatMap.get(f)},c.prototype.createZXingFormats=function(f){for(var y=[],C=0,N=f;C<N.length;C++){var k=N[C];this.formatMap.has(k)?y.push(this.formatMap.get(k)):this.logger.logError("".concat(k," is not supported by")+"ZXingHtml5QrcodeShim")}return y},c.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},c})(),O4=function(c,f,y,C){function N(k){return k instanceof y?k:new y(function(R){R(k)})}return new(y||(y=Promise))(function(k,R){function h($){try{H(C.next($))}catch(K){R(K)}}function V($){try{H(C.throw($))}catch(K){R(K)}}function H($){$.done?k($.value):N($.value).then(h,V)}H((C=C.apply(c,f||[])).next())})},z4=function(c,f){var y={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},C,N,k,R;return R={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function h(H){return function($){return V([H,$])}}function V(H){if(C)throw new TypeError("Generator is already executing.");for(;R&&(R=0,H[0]&&(y=0)),y;)try{if(C=1,N&&(k=H[0]&2?N.return:H[0]?N.throw||((k=N.return)&&k.call(N),0):N.next)&&!(k=k.call(N,H[1])).done)return k;switch(N=0,k&&(H=[H[0]&2,k.value]),H[0]){case 0:case 1:k=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,N=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(k=y.trys,!(k=k.length>0&&k[k.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!k||H[1]>k[0]&&H[1]<k[3])){y.label=H[1];break}if(H[0]===6&&y.label<k[1]){y.label=k[1],k=H;break}if(k&&y.label<k[2]){y.label=k[2],y.ops.push(H);break}k[2]&&y.ops.pop(),y.trys.pop();continue}H=f.call(c,y)}catch($){H=[6,$],N=0}finally{C=k=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},F_=(function(){function c(f,y,C){if(this.formatMap=new Map([[qn.QR_CODE,"qr_code"],[qn.AZTEC,"aztec"],[qn.CODABAR,"codabar"],[qn.CODE_39,"code_39"],[qn.CODE_93,"code_93"],[qn.CODE_128,"code_128"],[qn.DATA_MATRIX,"data_matrix"],[qn.ITF,"itf"],[qn.EAN_13,"ean_13"],[qn.EAN_8,"ean_8"],[qn.PDF_417,"pdf417"],[qn.UPC_A,"upc_a"],[qn.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!c.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=y,this.logger=C;var N=this.createBarcodeDetectorFormats(f);if(this.detector=new BarcodeDetector(N),!this.detector)throw"BarcodeDetector detector not supported"}return c.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var f=new BarcodeDetector({formats:["qr_code"]});return typeof f<"u"},c.prototype.decodeAsync=function(f){return O4(this,void 0,void 0,function(){var y,C;return z4(this,function(N){switch(N.label){case 0:return[4,this.detector.detect(f)];case 1:if(y=N.sent(),!y||y.length===0)throw"No barcode or QR code detected.";return C=this.selectLargestBarcode(y),[2,{text:C.rawValue,format:b2.create(this.toHtml5QrcodeSupportedFormats(C.format)),debugData:this.createDebugData()}]}})})},c.prototype.selectLargestBarcode=function(f){for(var y=null,C=0,N=0,k=f;N<k.length;N++){var R=k[N],h=R.boundingBox.width*R.boundingBox.height;h>C&&(C=h,y=R)}if(!y)throw"No largest barcode found";return y},c.prototype.createBarcodeDetectorFormats=function(f){for(var y=[],C=0,N=f;C<N.length;C++){var k=N[C];this.formatMap.has(k)?y.push(this.formatMap.get(k)):this.logger.warn("".concat(k," is not supported by")+"BarcodeDetectorDelegate")}return{formats:y}},c.prototype.toHtml5QrcodeSupportedFormats=function(f){if(!this.reverseFormatMap.has(f))throw"reverseFormatMap doesn't have ".concat(f);return this.reverseFormatMap.get(f)},c.prototype.createReverseFormatMap=function(){var f=new Map;return this.formatMap.forEach(function(y,C,N){f.set(y,C)}),f},c.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},c})(),j_=function(c,f,y,C){function N(k){return k instanceof y?k:new y(function(R){R(k)})}return new(y||(y=Promise))(function(k,R){function h($){try{H(C.next($))}catch(K){R(K)}}function V($){try{H(C.throw($))}catch(K){R(K)}}function H($){$.done?k($.value):N($.value).then(h,V)}H((C=C.apply(c,f||[])).next())})},U_=function(c,f){var y={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},C,N,k,R;return R={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function h(H){return function($){return V([H,$])}}function V(H){if(C)throw new TypeError("Generator is already executing.");for(;R&&(R=0,H[0]&&(y=0)),y;)try{if(C=1,N&&(k=H[0]&2?N.return:H[0]?N.throw||((k=N.return)&&k.call(N),0):N.next)&&!(k=k.call(N,H[1])).done)return k;switch(N=0,k&&(H=[H[0]&2,k.value]),H[0]){case 0:case 1:k=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,N=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(k=y.trys,!(k=k.length>0&&k[k.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!k||H[1]>k[0]&&H[1]<k[3])){y.label=H[1];break}if(H[0]===6&&y.label<k[1]){y.label=k[1],k=H;break}if(k&&y.label<k[2]){y.label=k[2],y.ops.push(H);break}k[2]&&y.ops.pop(),y.trys.pop();continue}H=f.call(c,y)}catch($){H=[6,$],N=0}finally{C=k=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},L4=(function(){function c(f,y,C,N){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=C,y&&F_.isSupported()?(this.primaryDecoder=new F_(f,C,N),this.secondaryDecoder=new B_(f,C,N)):this.primaryDecoder=new B_(f,C,N)}return c.prototype.decodeAsync=function(f){return j_(this,void 0,void 0,function(){var y;return U_(this,function(C){switch(C.label){case 0:y=performance.now(),C.label=1;case 1:return C.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(f)];case 2:return[2,C.sent()];case 3:return this.possiblyLogPerformance(y),[7];case 4:return[2]}})})},c.prototype.decodeRobustlyAsync=function(f){return j_(this,void 0,void 0,function(){var y,C;return U_(this,function(N){switch(N.label){case 0:y=performance.now(),N.label=1;case 1:return N.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(f)];case 2:return[2,N.sent()];case 3:if(C=N.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(f)];throw C;case 4:return this.possiblyLogPerformance(y),[7];case 5:return[2]}})})},c.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},c.prototype.possiblyLogPerformance=function(f){if(this.verbose){var y=performance.now()-f;this.executionResults.push(y),this.executions++,this.possiblyFlushPerformanceReport()}},c.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var f=0,y=0,C=this.executionResults;y<C.length;y++){var N=C[y];f+=N}var k=f/this.executionResults.length;console.log("".concat(k," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},c})(),mx=(function(){var c=function(f,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,N){C.__proto__=N}||function(C,N){for(var k in N)Object.prototype.hasOwnProperty.call(N,k)&&(C[k]=N[k])},c(f,y)};return function(f,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(f,y);function C(){this.constructor=f}f.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)}})(),t1=function(c,f,y,C){function N(k){return k instanceof y?k:new y(function(R){R(k)})}return new(y||(y=Promise))(function(k,R){function h($){try{H(C.next($))}catch(K){R(K)}}function V($){try{H(C.throw($))}catch(K){R(K)}}function H($){$.done?k($.value):N($.value).then(h,V)}H((C=C.apply(c,f||[])).next())})},n1=function(c,f){var y={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},C,N,k,R;return R={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function h(H){return function($){return V([H,$])}}function V(H){if(C)throw new TypeError("Generator is already executing.");for(;R&&(R=0,H[0]&&(y=0)),y;)try{if(C=1,N&&(k=H[0]&2?N.return:H[0]?N.throw||((k=N.return)&&k.call(N),0):N.next)&&!(k=k.call(N,H[1])).done)return k;switch(N=0,k&&(H=[H[0]&2,k.value]),H[0]){case 0:case 1:k=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,N=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(k=y.trys,!(k=k.length>0&&k[k.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!k||H[1]>k[0]&&H[1]<k[3])){y.label=H[1];break}if(H[0]===6&&y.label<k[1]){y.label=k[1],k=H;break}if(k&&y.label<k[2]){y.label=k[2],y.ops.push(H);break}k[2]&&y.ops.pop(),y.trys.pop();continue}H=f.call(c,y)}catch($){H=[6,$],N=0}finally{C=k=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},w2=(function(){function c(f,y){this.name=f,this.track=y}return c.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},c.prototype.apply=function(f){var y={};y[this.name]=f;var C={advanced:[y]};return this.track.applyConstraints(C)},c.prototype.value=function(){var f=this.track.getSettings();if(this.name in f){var y=f[this.name];return y}return null},c})(),B4=(function(c){mx(f,c);function f(y,C){return c.call(this,y,C)||this}return f.prototype.min=function(){return this.getCapabilities().min},f.prototype.max=function(){return this.getCapabilities().max},f.prototype.step=function(){return this.getCapabilities().step},f.prototype.apply=function(y){var C={};C[this.name]=y;var N={advanced:[C]};return this.track.applyConstraints(N)},f.prototype.getCapabilities=function(){this.failIfNotSupported();var y=this.track.getCapabilities(),C=y[this.name];return{min:C.min,max:C.max,step:C.step}},f.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},f})(w2),F4=(function(c){mx(f,c);function f(y){return c.call(this,"zoom",y)||this}return f})(B4),j4=(function(c){mx(f,c);function f(y){return c.call(this,"torch",y)||this}return f})(w2),U4=(function(){function c(f){this.track=f}return c.prototype.zoomFeature=function(){return new F4(this.track)},c.prototype.torchFeature=function(){return new j4(this.track)},c})(),V4=(function(){function c(f,y,C){this.isClosed=!1,this.parentElement=f,this.mediaStream=y,this.callbacks=C,this.surface=this.createVideoElement(this.parentElement.clientWidth),f.append(this.surface)}return c.prototype.createVideoElement=function(f){var y=document.createElement("video");return y.style.width="".concat(f,"px"),y.style.display="block",y.muted=!0,y.setAttribute("muted","true"),y.playsInline=!0,y},c.prototype.setupSurface=function(){var f=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var y=function(){var C=f.surface.clientWidth,N=f.surface.clientHeight;f.callbacks.onRenderSurfaceReady(C,N),f.surface.removeEventListener("playing",y)};this.surface.addEventListener("playing",y),this.surface.srcObject=this.mediaStream,this.surface.play()},c.create=function(f,y,C,N){return t1(this,void 0,void 0,function(){var k,R;return n1(this,function(h){switch(h.label){case 0:return k=new c(f,y,N),C.aspectRatio?(R={aspectRatio:C.aspectRatio},[4,k.getFirstTrackOrFail().applyConstraints(R)]):[3,2];case 1:h.sent(),h.label=2;case 2:return k.setupSurface(),[2,k]}})})},c.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},c.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},c.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},c.prototype.resume=function(f){this.failIfClosed();var y=this,C=function(){setTimeout(f,200),y.surface.removeEventListener("playing",C)};this.surface.addEventListener("playing",C),this.surface.play()},c.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},c.prototype.getSurface=function(){return this.failIfClosed(),this.surface},c.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},c.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},c.prototype.applyVideoConstraints=function(f){return t1(this,void 0,void 0,function(){return n1(this,function(y){if("aspectRatio"in f)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(f)]})})},c.prototype.close=function(){if(this.isClosed)return Promise.resolve();var f=this;return new Promise(function(y,C){var N=f.mediaStream.getVideoTracks(),k=N.length,R=0;f.mediaStream.getVideoTracks().forEach(function(h){f.mediaStream.removeTrack(h),h.stop(),++R,R>=k&&(f.isClosed=!0,f.parentElement.removeChild(f.surface),y())})})},c.prototype.getCapabilities=function(){return new U4(this.getFirstTrackOrFail())},c})(),G4=(function(){function c(f){this.mediaStream=f}return c.prototype.render=function(f,y,C){return t1(this,void 0,void 0,function(){return n1(this,function(N){return[2,V4.create(f,this.mediaStream,y,C)]})})},c.create=function(f){return t1(this,void 0,void 0,function(){var y,C;return n1(this,function(N){switch(N.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return y={audio:!1,video:f},[4,navigator.mediaDevices.getUserMedia(y)];case 1:return C=N.sent(),[2,new c(C)]}})})},c})(),V_=function(c,f,y,C){function N(k){return k instanceof y?k:new y(function(R){R(k)})}return new(y||(y=Promise))(function(k,R){function h($){try{H(C.next($))}catch(K){R(K)}}function V($){try{H(C.throw($))}catch(K){R(K)}}function H($){$.done?k($.value):N($.value).then(h,V)}H((C=C.apply(c,f||[])).next())})},G_=function(c,f){var y={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},C,N,k,R;return R={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function h(H){return function($){return V([H,$])}}function V(H){if(C)throw new TypeError("Generator is already executing.");for(;R&&(R=0,H[0]&&(y=0)),y;)try{if(C=1,N&&(k=H[0]&2?N.return:H[0]?N.throw||((k=N.return)&&k.call(N),0):N.next)&&!(k=k.call(N,H[1])).done)return k;switch(N=0,k&&(H=[H[0]&2,k.value]),H[0]){case 0:case 1:k=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,N=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(k=y.trys,!(k=k.length>0&&k[k.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!k||H[1]>k[0]&&H[1]<k[3])){y.label=H[1];break}if(H[0]===6&&y.label<k[1]){y.label=k[1],k=H;break}if(k&&y.label<k[2]){y.label=k[2],y.ops.push(H);break}k[2]&&y.ops.pop(),y.trys.pop();continue}H=f.call(c,y)}catch($){H=[6,$],N=0}finally{C=k=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},H4=(function(){function c(){}return c.failIfNotSupported=function(){return V_(this,void 0,void 0,function(){return G_(this,function(f){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new c]})})},c.prototype.create=function(f){return V_(this,void 0,void 0,function(){return G_(this,function(y){return[2,G4.create(f)]})})},c})(),q4=function(c,f,y,C){function N(k){return k instanceof y?k:new y(function(R){R(k)})}return new(y||(y=Promise))(function(k,R){function h($){try{H(C.next($))}catch(K){R(K)}}function V($){try{H(C.throw($))}catch(K){R(K)}}function H($){$.done?k($.value):N($.value).then(h,V)}H((C=C.apply(c,f||[])).next())})},Z4=function(c,f){var y={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},C,N,k,R;return R={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function h(H){return function($){return V([H,$])}}function V(H){if(C)throw new TypeError("Generator is already executing.");for(;R&&(R=0,H[0]&&(y=0)),y;)try{if(C=1,N&&(k=H[0]&2?N.return:H[0]?N.throw||((k=N.return)&&k.call(N),0):N.next)&&!(k=k.call(N,H[1])).done)return k;switch(N=0,k&&(H=[H[0]&2,k.value]),H[0]){case 0:case 1:k=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,N=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(k=y.trys,!(k=k.length>0&&k[k.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!k||H[1]>k[0]&&H[1]<k[3])){y.label=H[1];break}if(H[0]===6&&y.label<k[1]){y.label=k[1],k=H;break}if(k&&y.label<k[2]){y.label=k[2],y.ops.push(H);break}k[2]&&y.ops.pop(),y.trys.pop();continue}H=f.call(c,y)}catch($){H=[6,$],N=0}finally{C=k=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},X4=(function(){function c(){}return c.retrieve=function(){if(navigator.mediaDevices)return c.getCamerasFromMediaDevices();var f=MediaStreamTrack;return MediaStreamTrack&&f.getSources?c.getCamerasFromMediaStreamTrack():c.rejectWithError()},c.rejectWithError=function(){var f=l0.unableToQuerySupportedDevices();return c.isHttpsOrLocalhost()||(f=l0.insecureContextCameraQueryError()),Promise.reject(f)},c.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var f=location.host.split(":")[0];return f==="127.0.0.1"||f==="localhost"},c.getCamerasFromMediaDevices=function(){return q4(this,void 0,void 0,function(){var f,y,C,N,k,R,h;return Z4(this,function(V){switch(V.label){case 0:return f=function(H){for(var $=H.getVideoTracks(),K=0,be=$;K<be.length;K++){var Ce=be[K];Ce.enabled=!1,Ce.stop(),H.removeTrack(Ce)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return y=V.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(C=V.sent(),N=[],k=0,R=C;k<R.length;k++)h=R[k],h.kind==="videoinput"&&N.push({id:h.deviceId,label:h.label});return f(y),[2,N]}})})},c.getCamerasFromMediaStreamTrack=function(){return new Promise(function(f,y){var C=function(k){for(var R=[],h=0,V=k;h<V.length;h++){var H=V[h];H.kind==="video"&&R.push({id:H.id,label:H.label})}f(R)},N=MediaStreamTrack;N.getSources(C)})},c})(),ta;(function(c){c[c.UNKNOWN=0]="UNKNOWN",c[c.NOT_STARTED=1]="NOT_STARTED",c[c.SCANNING=2]="SCANNING",c[c.PAUSED=3]="PAUSED"})(ta||(ta={}));var W4=(function(){function c(){this.state=ta.NOT_STARTED,this.onGoingTransactionNewState=ta.UNKNOWN}return c.prototype.directTransition=function(f){this.failIfTransitionOngoing(),this.validateTransition(f),this.state=f},c.prototype.startTransition=function(f){return this.failIfTransitionOngoing(),this.validateTransition(f),this.onGoingTransactionNewState=f,this},c.prototype.execute=function(){if(this.onGoingTransactionNewState===ta.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var f=this.onGoingTransactionNewState;this.onGoingTransactionNewState=ta.UNKNOWN,this.directTransition(f)},c.prototype.cancel=function(){if(this.onGoingTransactionNewState===ta.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=ta.UNKNOWN},c.prototype.getState=function(){return this.state},c.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==ta.UNKNOWN)throw"Cannot transition to a new state, already under transition"},c.prototype.validateTransition=function(f){switch(this.state){case ta.UNKNOWN:throw"Transition from unknown is not allowed";case ta.NOT_STARTED:this.failIfNewStateIs(f,[ta.PAUSED]);break;case ta.SCANNING:break;case ta.PAUSED:break}},c.prototype.failIfNewStateIs=function(f,y){for(var C=0,N=y;C<N.length;C++){var k=N[C];if(f===k)throw"Cannot transition from ".concat(this.state," to ").concat(f)}},c})(),Y4=(function(){function c(f){this.stateManager=f}return c.prototype.startTransition=function(f){return this.stateManager.startTransition(f)},c.prototype.directTransition=function(f){this.stateManager.directTransition(f)},c.prototype.getState=function(){return this.stateManager.getState()},c.prototype.canScanFile=function(){return this.stateManager.getState()===ta.NOT_STARTED},c.prototype.isScanning=function(){return this.stateManager.getState()!==ta.NOT_STARTED},c.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===ta.SCANNING},c.prototype.isPaused=function(){return this.stateManager.getState()===ta.PAUSED},c})(),$4=(function(){function c(){}return c.create=function(){return new Y4(new W4)},c})(),K4=(function(){var c=function(f,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,N){C.__proto__=N}||function(C,N){for(var k in N)Object.prototype.hasOwnProperty.call(N,k)&&(C[k]=N[k])},c(f,y)};return function(f,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(f,y);function C(){this.constructor=f}f.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)}})(),ic=(function(c){K4(f,c);function f(){return c!==null&&c.apply(this,arguments)||this}return f.DEFAULT_WIDTH=300,f.DEFAULT_WIDTH_OFFSET=2,f.FILE_SCAN_MIN_HEIGHT=300,f.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,f.MIN_QR_BOX_SIZE=50,f.SHADED_LEFT=1,f.SHADED_RIGHT=2,f.SHADED_TOP=3,f.SHADED_BOTTOM=4,f.SHADED_REGION_ELEMENT_ID="qr-shaded-region",f.VERBOSE=!1,f.BORDER_SHADER_DEFAULT_COLOR="#ffffff",f.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",f})(I4),Q4=(function(){function c(f,y){this.logger=y,this.fps=ic.SCAN_DEFAULT_FPS,f?(f.fps&&(this.fps=f.fps),this.disableFlip=f.disableFlip===!0,this.qrbox=f.qrbox,this.aspectRatio=f.aspectRatio,this.videoConstraints=f.videoConstraints):this.disableFlip=ic.DEFAULT_DISABLE_FLIP}return c.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?v2.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},c.prototype.isShadedBoxEnabled=function(){return!Rh(this.qrbox)},c.create=function(f,y){return new c(f,y)},c})(),J4=(function(){function c(f,y){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(f))throw"HTML Element with id=".concat(f," not found");this.elementId=f,this.verbose=!1;var C;typeof y=="boolean"?this.verbose=y===!0:y&&(C=y,this.verbose=C.verbose===!0,C.experimentalFeatures),this.logger=new R4(this.verbose),this.qrcode=new L4(this.getSupportedFormats(y),this.getUseBarCodeDetectorIfSupported(C),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=$4.create()}return c.prototype.start=function(f,y,C,N){var k=this;if(!f)throw"cameraIdOrConfig is required";if(!C||typeof C!="function")throw"qrCodeSuccessCallback is required and should be a function.";var R;N?R=N:R=this.verbose?this.logger.log:function(){};var h=Q4.create(y,this.logger);this.clearElement();var V=!1;h.videoConstraints&&(h.isMediaStreamConstraintsValid()?V=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var H=V,$=document.getElementById(this.elementId);$.clientWidth?$.clientWidth:ic.DEFAULT_WIDTH,$.style.position="relative",this.shouldScan=!0,this.element=$;var K=this,be=this.stateManagerProxy.startTransition(ta.SCANNING);return new Promise(function(Ce,Ee){var ye=H?h.videoConstraints:K.createVideoConstraints(f);if(!ye){be.cancel(),Ee("videoConstraints should be defined");return}var he={};(!H||h.aspectRatio)&&(he.aspectRatio=h.aspectRatio);var ke={onRenderSurfaceReady:function(nt,Qe){K.setupUi(nt,Qe,h),K.isScanning=!0,K.foreverScan(h,C,R)}};H4.failIfNotSupported().then(function(nt){nt.create(ye).then(function(Qe){return Qe.render(k.element,he,ke).then(function(dt){K.renderedCamera=dt,be.execute(),Ce(null)}).catch(function(dt){be.cancel(),Ee(dt)})}).catch(function(Qe){be.cancel(),Ee(l0.errorGettingUserMedia(Qe))})}).catch(function(nt){be.cancel(),Ee(l0.cameraStreamingNotSupported())})})},c.prototype.pause=function(f){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(ta.PAUSED),this.showPausedState(),(Rh(f)||f!==!0)&&(f=!1),f&&this.renderedCamera&&this.renderedCamera.pause()},c.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var f=this,y=function(){f.stateManagerProxy.directTransition(ta.SCANNING),f.hidePausedState()};if(!this.renderedCamera.isPaused()){y();return}this.renderedCamera.resume(function(){y()})},c.prototype.getState=function(){return this.stateManagerProxy.getState()},c.prototype.stop=function(){var f=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var y=this.stateManagerProxy.startTransition(ta.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var C=function(){if(f.element){var k=document.getElementById(ic.SHADED_REGION_ELEMENT_ID);k&&f.element.removeChild(k)}},N=this;return this.renderedCamera.close().then(function(){return N.renderedCamera=null,N.element&&(N.element.removeChild(N.canvasElement),N.canvasElement=null),C(),N.qrRegion&&(N.qrRegion=null),N.context&&(N.context=null),y.execute(),N.hidePausedState(),N.isScanning=!1,Promise.resolve()})},c.prototype.scanFile=function(f,y){return this.scanFileV2(f,y).then(function(C){return C.decodedText})},c.prototype.scanFileV2=function(f,y){var C=this;if(!f||!(f instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Rh(y)&&(y=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(N,k){C.possiblyCloseLastScanImageFile(),C.clearElement(),C.lastScanImageFile=URL.createObjectURL(f);var R=new Image;R.onload=function(){var h=R.width,V=R.height,H=document.getElementById(C.elementId),$=H.clientWidth?H.clientWidth:ic.DEFAULT_WIDTH,K=Math.max(H.clientHeight?H.clientHeight:V,ic.FILE_SCAN_MIN_HEIGHT),be=C.computeCanvasDrawConfig(h,V,$,K);if(y){var Ce=C.createCanvasElement($,K,"qr-canvas-visible");Ce.style.display="inline-block",H.appendChild(Ce);var Ee=Ce.getContext("2d");if(!Ee)throw"Unable to get 2d context from canvas";Ee.canvas.width=$,Ee.canvas.height=K,Ee.drawImage(R,0,0,h,V,be.x,be.y,be.width,be.height)}var ye=ic.FILE_SCAN_HIDDEN_CANVAS_PADDING,he=Math.max(R.width,be.width),ke=Math.max(R.height,be.height),nt=he+2*ye,Qe=ke+2*ye,dt=C.createCanvasElement(nt,Qe);H.appendChild(dt);var Ut=dt.getContext("2d");if(!Ut)throw"Unable to get 2d context from canvas";Ut.canvas.width=nt,Ut.canvas.height=Qe,Ut.drawImage(R,0,0,h,V,ye,ye,he,ke);try{C.qrcode.decodeRobustlyAsync(dt).then(function(wt){N(z_.createFromQrcodeResult(wt))}).catch(k)}catch(wt){k("QR code parse error, error = ".concat(wt))}},R.onerror=k,R.onabort=k,R.onstalled=k,R.onsuspend=k,R.src=URL.createObjectURL(f)})},c.prototype.clear=function(){this.clearElement()},c.getCameras=function(){return X4.retrieve()},c.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},c.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},c.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},c.prototype.applyVideoConstraints=function(f){if(f){if(!v2.isMediaStreamConstraintsValid(f,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(f)},c.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},c.prototype.getSupportedFormats=function(f){var y=[qn.QR_CODE,qn.AZTEC,qn.CODABAR,qn.CODE_39,qn.CODE_93,qn.CODE_128,qn.DATA_MATRIX,qn.MAXICODE,qn.ITF,qn.EAN_13,qn.EAN_8,qn.PDF_417,qn.RSS_14,qn.RSS_EXPANDED,qn.UPC_A,qn.UPC_E,qn.UPC_EAN_EXTENSION];if(!f||typeof f=="boolean"||!f.formatsToSupport)return y;if(!Array.isArray(f.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(f.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var C=[],N=0,k=f.formatsToSupport;N<k.length;N++){var R=k[N];C4(R)?C.push(R):this.logger.warn("Invalid format: ".concat(R," passed in config, ignoring."))}if(C.length===0)throw"None of formatsToSupport match supported values.";return C},c.prototype.getUseBarCodeDetectorIfSupported=function(f){if(Rh(f))return!0;if(!Rh(f.useBarCodeDetectorIfSupported))return f.useBarCodeDetectorIfSupported!==!1;if(Rh(f.experimentalFeatures))return!0;var y=f.experimentalFeatures;return Rh(y.useBarCodeDetectorIfSupported)?!0:y.useBarCodeDetectorIfSupported!==!1},c.prototype.validateQrboxSize=function(f,y,C){var N=this,k=C.qrbox;this.validateQrboxConfig(k);var R=this.toQrdimensions(f,y,k),h=function(H){if(H<ic.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(ic.MIN_QR_BOX_SIZE,"px.")},V=function(H){return H>f&&(N.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),H=f),H};h(R.width),h(R.height),R.width=V(R.width)},c.prototype.validateQrboxConfig=function(f){if(typeof f!="number"&&typeof f!="function"&&(f.width===void 0||f.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},c.prototype.toQrdimensions=function(f,y,C){if(typeof C=="number")return{width:C,height:C};if(typeof C=="function")try{return C(f,y)}catch(N){throw new Error("qrbox config was passed as a function but it failed with unknown error"+N)}return C},c.prototype.setupUi=function(f,y,C){C.isShadedBoxEnabled()&&this.validateQrboxSize(f,y,C);var N=Rh(C.qrbox)?{width:f,height:y}:C.qrbox;this.validateQrboxConfig(N);var k=this.toQrdimensions(f,y,N);k.height>y&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var R=C.isShadedBoxEnabled()&&k.height<=y,h={x:0,y:0,width:f,height:y},V=R?this.getShadedRegionBounds(f,y,k):h,H=this.createCanvasElement(V.width,V.height),$={willReadFrequently:!0},K=H.getContext("2d",$);K.canvas.width=V.width,K.canvas.height=V.height,this.element.append(H),R&&this.possiblyInsertShadingElement(this.element,f,y,k),this.createScannerPausedUiElement(this.element),this.qrRegion=V,this.context=K,this.canvasElement=H},c.prototype.createScannerPausedUiElement=function(f){var y=document.createElement("div");y.innerText=l0.scannerPaused(),y.style.display="none",y.style.position="absolute",y.style.top="0px",y.style.zIndex="1",y.style.background="rgba(9, 9, 9, 0.46)",y.style.color="#FFECEC",y.style.textAlign="center",y.style.width="100%",f.appendChild(y),this.scannerPausedUiElement=y},c.prototype.scanContext=function(f,y){var C=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(N){return f(N.text,z_.createFromQrcodeResult(N)),C.possiblyUpdateShaders(!0),!0}).catch(function(N){C.possiblyUpdateShaders(!1);var k=l0.codeParseError(N);return y(k,M4.createFrom(k)),!1})},c.prototype.foreverScan=function(f,y,C){var N=this;if(this.shouldScan&&this.renderedCamera){var k=this.renderedCamera.getSurface(),R=k.videoWidth/k.clientWidth,h=k.videoHeight/k.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var V=this.qrRegion.width*R,H=this.qrRegion.height*h,$=this.qrRegion.x*R,K=this.qrRegion.y*h;this.context.drawImage(k,$,K,V,H,0,0,this.qrRegion.width,this.qrRegion.height);var be=function(){N.foreverScanTimeout=setTimeout(function(){N.foreverScan(f,y,C)},N.getTimeoutFps(f.fps))};this.scanContext(y,C).then(function(Ce){!Ce&&f.disableFlip!==!0?(N.context.translate(N.context.canvas.width,0),N.context.scale(-1,1),N.scanContext(y,C).finally(function(){be()})):be()}).catch(function(Ce){N.logger.logError("Error happend while scanning context",Ce),be()})}},c.prototype.createVideoConstraints=function(f){if(typeof f=="string")return{deviceId:{exact:f}};if(typeof f=="object"){var y="facingMode",C="deviceId",N={user:!0,environment:!0},k="exact",R=function(Ee){if(Ee in N)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(Ee,"'")},h=Object.keys(f);if(h.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(h.length," keys");var V=Object.keys(f)[0];if(V!==y&&V!==C)throw"Only '".concat(y,"' and '").concat(C,"' ")+" are supported for 'cameraIdOrConfig'";if(V===y){var H=f.facingMode;if(typeof H=="string"){if(R(H))return{facingMode:H}}else if(typeof H=="object")if(k in H){if(R(H["".concat(k)]))return{facingMode:{exact:H["".concat(k)]}}}else throw"'facingMode' should be string or object with"+" ".concat(k," as key.");else{var $=typeof H;throw"Invalid type of 'facingMode' = ".concat($)}}else{var K=f.deviceId;if(typeof K=="string")return{deviceId:K};if(typeof K=="object"){if(k in K)return{deviceId:{exact:K["".concat(k)]}};throw"'deviceId' should be string or object with"+" ".concat(k," as key.")}else{var be=typeof K;throw"Invalid type of 'deviceId' = ".concat(be)}}}var Ce=typeof f;throw"Invalid type of 'cameraIdOrConfig' = ".concat(Ce)},c.prototype.computeCanvasDrawConfig=function(f,y,C,N){if(f<=C&&y<=N){var k=(C-f)/2,R=(N-y)/2;return{x:k,y:R,width:f,height:y}}else{var h=f,V=y;return f>C&&(y=C/f*y,f=C),y>N&&(f=N/y*f,y=N),this.logger.log("Image downsampled from "+"".concat(h,"X").concat(V)+" to ".concat(f,"X").concat(y,".")),this.computeCanvasDrawConfig(f,y,C,N)}},c.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var f=document.getElementById(this.elementId);f&&(f.innerHTML="")},c.prototype.possiblyUpdateShaders=function(f){this.qrMatch!==f&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(y){y.style.backgroundColor=f?ic.BORDER_SHADER_MATCH_COLOR:ic.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=f)},c.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},c.prototype.createCanvasElement=function(f,y,C){var N=f,k=y,R=document.createElement("canvas");return R.style.width="".concat(N,"px"),R.style.height="".concat(k,"px"),R.style.display="none",R.id=Rh(C)?"qr-canvas":C,R},c.prototype.getShadedRegionBounds=function(f,y,C){if(C.width>f||C.height>y)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(f-C.width)/2,y:(y-C.height)/2,width:C.width,height:C.height}},c.prototype.possiblyInsertShadingElement=function(f,y,C,N){if(!(y-N.width<1||C-N.height<1)){var k=document.createElement("div");k.style.position="absolute";var R=(y-N.width)/2,h=(C-N.height)/2;if(k.style.borderLeft="".concat(R,"px solid rgba(0, 0, 0, 0.48)"),k.style.borderRight="".concat(R,"px solid rgba(0, 0, 0, 0.48)"),k.style.borderTop="".concat(h,"px solid rgba(0, 0, 0, 0.48)"),k.style.borderBottom="".concat(h,"px solid rgba(0, 0, 0, 0.48)"),k.style.boxSizing="border-box",k.style.top="0px",k.style.bottom="0px",k.style.left="0px",k.style.right="0px",k.id="".concat(ic.SHADED_REGION_ELEMENT_ID),y-N.width<11||C-N.height<11)this.hasBorderShaders=!1;else{var V=5,H=40;this.insertShaderBorders(k,H,V,-V,null,0,!0),this.insertShaderBorders(k,H,V,-V,null,0,!1),this.insertShaderBorders(k,H,V,null,-V,0,!0),this.insertShaderBorders(k,H,V,null,-V,0,!1),this.insertShaderBorders(k,V,H+V,-V,null,-V,!0),this.insertShaderBorders(k,V,H+V,null,-V,-V,!0),this.insertShaderBorders(k,V,H+V,-V,null,-V,!1),this.insertShaderBorders(k,V,H+V,null,-V,-V,!1),this.hasBorderShaders=!0}f.append(k)}},c.prototype.insertShaderBorders=function(f,y,C,N,k,R,h){var V=document.createElement("div");V.style.position="absolute",V.style.backgroundColor=ic.BORDER_SHADER_DEFAULT_COLOR,V.style.width="".concat(y,"px"),V.style.height="".concat(C,"px"),N!==null&&(V.style.top="".concat(N,"px")),k!==null&&(V.style.bottom="".concat(k,"px")),h?V.style.left="".concat(R,"px"):V.style.right="".concat(R,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(V),f.appendChild(V)},c.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},c.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},c.prototype.getTimeoutFps=function(f){return 1e3/f},c})(),H_;(function(c){c[c.STATUS_DEFAULT=0]="STATUS_DEFAULT",c[c.STATUS_SUCCESS=1]="STATUS_SUCCESS",c[c.STATUS_WARNING=2]="STATUS_WARNING",c[c.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(H_||(H_={}));const eI=({onCancel:c,onScan:f})=>{const y=De.useRef(null),[C,N]=De.useState(null),[k,R]=De.useState(!0),h=De.useRef(!1);De.useEffect(()=>{let H=!0;const K=setTimeout(async()=>{try{const be=new J4("qr-reader-element",{verbose:!1});y.current=be,await be.start({facingMode:"environment"},{fps:10,qrbox:(Ce,Ee)=>{const ye=Math.min(Ce,Ee),he=Math.floor(ye*.75);return{width:he,height:he}},aspectRatio:1},Ce=>{h.current||(h.current=!0,be.stop().finally(()=>{f(Ce)}))},()=>{}),H&&R(!1)}catch(be){console.error("[QRScanPage] Camera error:",be),H&&(N(be.message||"Failed to access camera"),R(!1))}},150);return()=>{H=!1,clearTimeout(K),y.current&&(y.current.stop().catch(()=>{}),y.current=null)}},[f]);const V=async()=>{if(y.current){try{await y.current.stop()}catch{}y.current=null}c()};return O.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black flex flex-col",children:[O.jsx("button",{onClick:V,className:"absolute top-6 right-6 p-3 rounded-full bg-white/10 text-white z-20",children:O.jsx(Il,{size:24})}),O.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[k&&O.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:O.jsx("div",{className:"text-white/60 text-sm animate-pulse",children:"Starting camera..."})}),C?O.jsxs("div",{className:"p-6 bg-red-500/10 border border-red-500/30 rounded-2xl text-center",children:[O.jsx("div",{className:"text-red-400 font-bold mb-2",children:"Camera Error"}),O.jsx("div",{className:"text-red-300/80 text-sm mb-4",children:C}),O.jsx("button",{onClick:V,className:"px-4 py-2 bg-red-500 text-white rounded-lg font-bold",children:"Go Back"})]}):O.jsxs(O.Fragment,{children:[O.jsx("div",{id:"qr-reader-element",className:"w-full h-full"}),O.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[O.jsx("div",{className:"absolute top-0 left-0 right-0 h-[20%] bg-black/60"}),O.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[20%] bg-black/60"}),O.jsx("div",{className:"absolute top-[20%] left-0 w-[12.5%] h-[60%] bg-black/60"}),O.jsx("div",{className:"absolute top-[20%] right-0 w-[12.5%] h-[60%] bg-black/60"}),O.jsx("div",{className:"absolute top-[20%] left-[12.5%] right-[12.5%] h-[60%] border-2 border-white/50 rounded-2xl"})]})]})]}),O.jsxs("div",{className:"p-6 text-center shrink-0",children:[O.jsx("p",{className:"text-white/60 text-sm",children:"Point camera at a Parlens QR code"}),O.jsx("button",{onClick:()=>{const H=prompt("Enter QR code manually:");H&&(h.current=!0,V().then(()=>f(H)))},className:"mt-4 text-blue-400 text-sm font-bold",children:"Enter code manually"})]})]})},tI=()=>{const{login:c}=Wu(),[f,y]=De.useState(""),[C,N]=De.useState(""),[k,R]=De.useState(!1),[h,V]=De.useState("landing"),[H,$]=De.useState(""),[K,be]=De.useState(null),Ce=async ke=>{R(!0),N("");try{await c(ke,ke==="nsec"?f:void 0)}catch(nt){N(nt.message)}finally{R(!1)}},Ee=()=>{V("setup")},ye=async()=>{if(!H.trim()){N("Please enter a username");return}R(!0);try{const{generateSecretKey:ke,getPublicKey:nt}=await Gg(async()=>{const{generateSecretKey:Je,getPublicKey:He}=await Promise.resolve().then(()=>wy);return{generateSecretKey:Je,getPublicKey:He}},void 0),Qe=Je=>Array.from(Je).map(He=>He.toString(16).padStart(2,"0")).join(""),dt=ke(),Ut=nt(dt);localStorage.setItem("parlens_privkey",Qe(dt)),localStorage.setItem("parlens_pubkey",Ut),localStorage.setItem("parlens_pending_username",H);const wt=Zf.npubEncode(Ut),tt=Zf.nsecEncode(dt);be({npub:wt,nsec:tt}),V("backup")}catch(ke){N(ke.message)}finally{R(!1)}},he=async()=>{R(!0);try{const ke=localStorage.getItem("parlens_pending_username");await c("create",void 0,ke||H),localStorage.removeItem("parlens_pending_username")}catch(ke){N(ke.message)}finally{R(!1)}};return O.jsx("div",{className:"min-h-screen bg-zinc-50 dark:bg-black p-6 text-zinc-900 dark:text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center transition-colors duration-300",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:O.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[O.jsxs("div",{className:"space-y-4",children:[O.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),O.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter text-zinc-900 dark:text-white",children:"Parlens"}),O.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-white/40 tracking-tight",children:"Decentralized Route & Parking Management"})]}),O.jsxs("div",{className:"space-y-4",children:[h==="landing"?O.jsxs(O.Fragment,{children:[O.jsx("button",{onClick:Ee,disabled:k,className:"w-full h-16 rounded-3xl bg-white dark:bg-white text-black font-bold text-lg shadow-xl shadow-black/5 dark:shadow-none active:scale-95 transition-all flex items-center justify-center gap-3 border border-black/5 dark:border-transparent",children:k?"Creating...":O.jsxs(O.Fragment,{children:[O.jsx(iC,{size:20,strokeWidth:3}),"Create a New Account"]})}),O.jsxs("button",{onClick:()=>V("nsec"),disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[O.jsx(vy,{size:18}),"Login with Nostr Account"]})]}):h==="setup"?O.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[O.jsxs("div",{className:"text-center pb-2",children:[O.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Pick a Username"}),O.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),O.jsx("input",{type:"text",placeholder:"Username",value:H,onChange:ke=>$(ke.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),O.jsxs("div",{className:"flex gap-3",children:[O.jsx("button",{onClick:()=>V("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),O.jsx("button",{onClick:ye,disabled:k||!H,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Creating...":"Continue"})]})]}):h==="backup"?O.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[O.jsxs("div",{className:"text-center pb-2",children:[O.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:" Account Created!"}),O.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm mt-1",children:"Backup your keys before continuing"})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30 ml-2",children:"Keys"}),O.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white dark:bg-white/[0.03] border border-black/5 dark:border-white/10 shadow-sm dark:shadow-none",children:[O.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{K&&(navigator.clipboard.writeText(K.npub),alert("Copied to clipboard"))},children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400",children:O.jsx(vy,{size:20})}),O.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),O.jsx(Yf,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),O.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),O.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{K&&(navigator.clipboard.writeText(K.nsec),alert("Copied to clipboard"))},children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-500",children:O.jsx(Xv,{size:20})}),O.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),O.jsx(Yf,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]}),O.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed text-center",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost."})]}),O.jsxs("div",{className:"space-y-6 pt-6 border-t border-black/5 dark:border-white/10",children:[O.jsxs("div",{className:"space-y-2",children:[O.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Getting Started"}),O.jsx("p",{className:"text-sm text-zinc-500 dark:text-white/60",children:"Follow these steps to get the most out of Parlens."})]}),O.jsxs("div",{className:"space-y-4 text-sm text-zinc-600 dark:text-white/60 leading-relaxed",children:[O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. If the system generated route(s) between your start and end points are not to your liking, add additional waypoints in locations you would prefer travelling through. Click the location button to re-centre and turn on follow-me or navigation mode for route tracking."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking"}),"Click the main button once to see open spots in listed parking spaces and open spots reported by others live or within the last 5 minutes. For standard parking: Click again to mark your location. When leaving, click once more to end the session, log the fee and report the spot. For listed parking: Click the QR code scanner button below the vehicle type selector. Scan the QR code at the parking location to start the session. When leaving, scan it again to end the session and log the fee. Use the profile button to see your parking history."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Create and manage a listed parking (optional)"}),"Users who oversee one or more parking spots can create a listed parking to simplify spot and lot management. Click the parking services button () at the bottom left-hand corner of the screen, and click the '+' button to create a listing. Provide the relevant details requested in the form to create an online listing that matches your real-world space. Listed parkings can be public (open to all users) or private (open to select users and only publish to select relays). Once created you can see your listings as viewed by other users in the public or private listing page. You should use the my listing page to manage your listing(s). Larger listings may take longer to create. You may manually refresh the page using the button provided next to the search bar if automatic updates are not returned fast enough."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Create your own mirror (optional)"}),O.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),O.jsxs("p",{children:[O.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"6. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys, only accessible by you and stored on relays of your preference. Open spot broadcasts and listed parking log updates use temporary identifiers to prevent your permanent public key from being shared."]}),O.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 border border-amber-500/20 mt-4",children:O.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-500/90 leading-relaxed",children:[O.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent personal IP address(es) from being associated with your data."]})})]})]}),O.jsx("button",{onClick:he,disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:k?"Starting...":"Start Using Parlens"})]}):O.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[O.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:f,onChange:ke=>y(ke.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),O.jsxs("div",{className:"flex gap-3",children:[O.jsx("button",{onClick:()=>V("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),O.jsx("button",{onClick:()=>Ce("nsec"),disabled:k||!f,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Decrypting...":"Login with Key"})]})]}),C&&O.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:C}),O.jsxs("div",{className:"space-y-3 pt-6 border-t border-black/5 dark:border-white/10",children:[O.jsx("h3",{className:"text-center font-bold text-zinc-500 dark:text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),O.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[O.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[O.jsx("span",{children:"Using Browser Menu (Android)"}),O.jsx(kd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),O.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:[O.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80",children:"Chrome & Brave:"}),O.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[O.jsx("li",{children:"Tap menu button (three dots)"}),O.jsxs("li",{children:["Tap ",O.jsx("strong",{children:"Add to Home screen"})]}),O.jsxs("li",{children:["Tap ",O.jsx("strong",{children:"Add"})," to confirm"]})]}),O.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80 mt-3",children:"Firefox:"}),O.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[O.jsx("li",{children:"Tap menu button (three dots)"}),O.jsxs("li",{children:["Tap ",O.jsx("strong",{children:"Install"})]})]})]})]}),O.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[O.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[O.jsx("span",{children:"Using Share Button (iOS)"}),O.jsx(kd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),O.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:O.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[O.jsxs("li",{children:["Tap the ",O.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Share"})," button in Safari menu bar."]}),O.jsxs("li",{children:["Scroll down and tap ",O.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Add to Home Screen"}),"."]}),O.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},nI=()=>{const{pubkey:c}=Wu(),[f,y]=De.useState("home"),[C,N]=De.useState(null);return na.useEffect(()=>{let k=0;const R=()=>{if(document.visibilityState==="hidden")k=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&k>0){const V=Date.now()-k;console.log("[App] Foregrounded after",V,"ms"),V>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},h=V=>{V.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",R),window.addEventListener("pageshow",h),()=>{document.removeEventListener("visibilitychange",R),window.removeEventListener("pageshow",h)}},[]),c?f==="scan"?O.jsx(eI,{onCancel:()=>y("home"),onScan:k=>{N(k),y("home")}}):O.jsx(A4,{onRequestScan:()=>y("scan"),initialScannedCode:C,onScannedCodeConsumed:()=>N(null)}):O.jsx(tI,{})};var b1=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(c){return this.listeners.add(c),this.onSubscribe(),()=>{this.listeners.delete(c),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},iI={setTimeout:(c,f)=>setTimeout(c,f),clearTimeout:c=>clearTimeout(c),setInterval:(c,f)=>setInterval(c,f),clearInterval:c=>clearInterval(c)},rI=class{#e=iI;#t=!1;setTimeoutProvider(c){this.#e=c}setTimeout(c,f){return this.#e.setTimeout(c,f)}clearTimeout(c){this.#e.clearTimeout(c)}setInterval(c,f){return this.#e.setInterval(c,f)}clearInterval(c){this.#e.clearInterval(c)}},Iy=new rI;function sI(c){setTimeout(c,0)}var v1=typeof window>"u"||"Deno"in globalThis;function lu(){}function aI(c,f){return typeof c=="function"?c(f):c}function oI(c){return typeof c=="number"&&c>=0&&c!==1/0}function lI(c,f){return Math.max(c+(f||0)-Date.now(),0)}function My(c,f){return typeof c=="function"?c(f):c}function cI(c,f){return typeof c=="function"?c(f):c}function q_(c,f){const{type:y="all",exact:C,fetchStatus:N,predicate:k,queryKey:R,stale:h}=c;if(R){if(C){if(f.queryHash!==gx(R,f.options))return!1}else if(!Dm(f.queryKey,R))return!1}if(y!=="all"){const V=f.isActive();if(y==="active"&&!V||y==="inactive"&&V)return!1}return!(typeof h=="boolean"&&f.isStale()!==h||N&&N!==f.state.fetchStatus||k&&!k(f))}function Z_(c,f){const{exact:y,status:C,predicate:N,mutationKey:k}=c;if(k){if(!f.options.mutationKey)return!1;if(y){if(Rm(f.options.mutationKey)!==Rm(k))return!1}else if(!Dm(f.options.mutationKey,k))return!1}return!(C&&f.state.status!==C||N&&!N(f))}function gx(c,f){return(f?.queryKeyHashFn||Rm)(c)}function Rm(c){return JSON.stringify(c,(f,y)=>Ry(y)?Object.keys(y).sort().reduce((C,N)=>(C[N]=y[N],C),{}):y)}function Dm(c,f){return c===f?!0:typeof c!=typeof f?!1:c&&f&&typeof c=="object"&&typeof f=="object"?Object.keys(f).every(y=>Dm(c[y],f[y])):!1}var uI=Object.prototype.hasOwnProperty;function E2(c,f){if(c===f)return c;const y=X_(c)&&X_(f);if(!y&&!(Ry(c)&&Ry(f)))return f;const N=(y?c:Object.keys(c)).length,k=y?f:Object.keys(f),R=k.length,h=y?new Array(R):{};let V=0;for(let H=0;H<R;H++){const $=y?H:k[H],K=c[$],be=f[$];if(K===be){h[$]=K,(y?H<N:uI.call(c,$))&&V++;continue}if(K===null||be===null||typeof K!="object"||typeof be!="object"){h[$]=be;continue}const Ce=E2(K,be);h[$]=Ce,Ce===K&&V++}return N===R&&V===N?c:h}function X_(c){return Array.isArray(c)&&c.length===Object.keys(c).length}function Ry(c){if(!W_(c))return!1;const f=c.constructor;if(f===void 0)return!0;const y=f.prototype;return!(!W_(y)||!y.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(c)!==Object.prototype)}function W_(c){return Object.prototype.toString.call(c)==="[object Object]"}function hI(c){return new Promise(f=>{Iy.setTimeout(f,c)})}function dI(c,f,y){return typeof y.structuralSharing=="function"?y.structuralSharing(c,f):y.structuralSharing!==!1?E2(c,f):f}function fI(c,f,y=0){const C=[...c,f];return y&&C.length>y?C.slice(1):C}function pI(c,f,y=0){const C=[f,...c];return y&&C.length>y?C.slice(0,-1):C}var yx=Symbol();function S2(c,f){return!c.queryFn&&f?.initialPromise?()=>f.initialPromise:!c.queryFn||c.queryFn===yx?()=>Promise.reject(new Error(`Missing queryFn: '${c.queryHash}'`)):c.queryFn}var mI=class extends b1{#e;#t;#n;constructor(){super(),this.#n=c=>{if(!v1&&window.addEventListener){const f=()=>c();return window.addEventListener("visibilitychange",f,!1),()=>{window.removeEventListener("visibilitychange",f)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(c){this.#n=c,this.#t?.(),this.#t=c(f=>{typeof f=="boolean"?this.setFocused(f):this.onFocus()})}setFocused(c){this.#e!==c&&(this.#e=c,this.onFocus())}onFocus(){const c=this.isFocused();this.listeners.forEach(f=>{f(c)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},T2=new mI;function gI(){let c,f;const y=new Promise((N,k)=>{c=N,f=k});y.status="pending",y.catch(()=>{});function C(N){Object.assign(y,N),delete y.resolve,delete y.reject}return y.resolve=N=>{C({status:"fulfilled",value:N}),c(N)},y.reject=N=>{C({status:"rejected",reason:N}),f(N)},y}var yI=sI;function xI(){let c=[],f=0,y=h=>{h()},C=h=>{h()},N=yI;const k=h=>{f?c.push(h):N(()=>{y(h)})},R=()=>{const h=c;c=[],h.length&&N(()=>{C(()=>{h.forEach(V=>{y(V)})})})};return{batch:h=>{let V;f++;try{V=h()}finally{f--,f||R()}return V},batchCalls:h=>(...V)=>{k(()=>{h(...V)})},schedule:k,setNotifyFunction:h=>{y=h},setBatchNotifyFunction:h=>{C=h},setScheduler:h=>{N=h}}}var Wo=xI(),_I=class extends b1{#e=!0;#t;#n;constructor(){super(),this.#n=c=>{if(!v1&&window.addEventListener){const f=()=>c(!0),y=()=>c(!1);return window.addEventListener("online",f,!1),window.addEventListener("offline",y,!1),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",y)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(c){this.#n=c,this.#t?.(),this.#t=c(this.setOnline.bind(this))}setOnline(c){this.#e!==c&&(this.#e=c,this.listeners.forEach(y=>{y(c)}))}isOnline(){return this.#e}},i1=new _I;function bI(c){return Math.min(1e3*2**c,3e4)}function A2(c){return(c??"online")==="online"?i1.isOnline():!0}var Dy=class extends Error{constructor(c){super("CancelledError"),this.revert=c?.revert,this.silent=c?.silent}};function C2(c){let f=!1,y=0,C;const N=gI(),k=()=>N.status!=="pending",R=ye=>{if(!k()){const he=new Dy(ye);be(he),c.onCancel?.(he)}},h=()=>{f=!0},V=()=>{f=!1},H=()=>T2.isFocused()&&(c.networkMode==="always"||i1.isOnline())&&c.canRun(),$=()=>A2(c.networkMode)&&c.canRun(),K=ye=>{k()||(C?.(),N.resolve(ye))},be=ye=>{k()||(C?.(),N.reject(ye))},Ce=()=>new Promise(ye=>{C=he=>{(k()||H())&&ye(he)},c.onPause?.()}).then(()=>{C=void 0,k()||c.onContinue?.()}),Ee=()=>{if(k())return;let ye;const he=y===0?c.initialPromise:void 0;try{ye=he??c.fn()}catch(ke){ye=Promise.reject(ke)}Promise.resolve(ye).then(K).catch(ke=>{if(k())return;const nt=c.retry??(v1?0:3),Qe=c.retryDelay??bI,dt=typeof Qe=="function"?Qe(y,ke):Qe,Ut=nt===!0||typeof nt=="number"&&y<nt||typeof nt=="function"&&nt(y,ke);if(f||!Ut){be(ke);return}y++,c.onFail?.(y,ke),hI(dt).then(()=>H()?void 0:Ce()).then(()=>{f?be(ke):Ee()})})};return{promise:N,status:()=>N.status,cancel:R,continue:()=>(C?.(),N),cancelRetry:h,continueRetry:V,canStart:$,start:()=>($()?Ee():Ce().then(Ee),N)}}var I2=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),oI(this.gcTime)&&(this.#e=Iy.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(c){this.gcTime=Math.max(this.gcTime||0,c??(v1?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Iy.clearTimeout(this.#e),this.#e=void 0)}},vI=class extends I2{#e;#t;#n;#r;#i;#a;#o;constructor(c){super(),this.#o=!1,this.#a=c.defaultOptions,this.setOptions(c.options),this.observers=[],this.#r=c.client,this.#n=this.#r.getQueryCache(),this.queryKey=c.queryKey,this.queryHash=c.queryHash,this.#e=$_(this.options),this.state=c.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(c){if(this.options={...this.#a,...c},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const f=$_(this.options);f.data!==void 0&&(this.setState(Y_(f.data,f.dataUpdatedAt)),this.#e=f)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(c,f){const y=dI(this.state.data,c,this.options);return this.#s({data:y,type:"success",dataUpdatedAt:f?.updatedAt,manual:f?.manual}),y}setState(c,f){this.#s({type:"setState",state:c,setStateOptions:f})}cancel(c){const f=this.#i?.promise;return this.#i?.cancel(c),f?f.then(lu).catch(lu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(c=>cI(c.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===yx||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(c=>My(c.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(c=>c.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(c=0){return this.state.data===void 0?!0:c==="static"?!1:this.state.isInvalidated?!0:!lI(this.state.dataUpdatedAt,c)}onFocus(){this.observers.find(f=>f.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(f=>f.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(c){this.observers.includes(c)||(this.observers.push(c),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:c}))}removeObserver(c){this.observers.includes(c)&&(this.observers=this.observers.filter(f=>f!==c),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:c}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(c,f){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&f?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(c&&this.setOptions(c),!this.options.queryFn){const h=this.observers.find(V=>V.options.queryFn);h&&this.setOptions(h.options)}const y=new AbortController,C=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,y.signal)})},N=()=>{const h=S2(this.options,f),H=(()=>{const $={client:this.#r,queryKey:this.queryKey,meta:this.meta};return C($),$})();return this.#o=!1,this.options.persister?this.options.persister(h,H,this):h(H)},R=(()=>{const h={fetchOptions:f,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:N};return C(h),h})();this.options.behavior?.onFetch(R,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==R.fetchOptions?.meta)&&this.#s({type:"fetch",meta:R.fetchOptions?.meta}),this.#i=C2({initialPromise:f?.initialPromise,fn:R.fetchFn,onCancel:h=>{h instanceof Dy&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),y.abort()},onFail:(h,V)=>{this.#s({type:"failed",failureCount:h,error:V})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:R.options.retry,retryDelay:R.options.retryDelay,networkMode:R.options.networkMode,canRun:()=>!0});try{const h=await this.#i.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof Dy){if(h.silent)return this.#i.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#s({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#s(c){const f=y=>{switch(c.type){case"failed":return{...y,fetchFailureCount:c.failureCount,fetchFailureReason:c.error};case"pause":return{...y,fetchStatus:"paused"};case"continue":return{...y,fetchStatus:"fetching"};case"fetch":return{...y,...wI(y.data,this.options),fetchMeta:c.meta??null};case"success":const C={...y,...Y_(c.data,c.dataUpdatedAt),dataUpdateCount:y.dataUpdateCount+1,...!c.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=c.manual?C:void 0,C;case"error":const N=c.error;return{...y,error:N,errorUpdateCount:y.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:y.fetchFailureCount+1,fetchFailureReason:N,fetchStatus:"idle",status:"error"};case"invalidate":return{...y,isInvalidated:!0};case"setState":return{...y,...c.state}}};this.state=f(this.state),Wo.batch(()=>{this.observers.forEach(y=>{y.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:c})})}};function wI(c,f){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:A2(f.networkMode)?"fetching":"paused",...c===void 0&&{error:null,status:"pending"}}}function Y_(c,f){return{data:c,dataUpdatedAt:f??Date.now(),error:null,isInvalidated:!1,status:"success"}}function $_(c){const f=typeof c.initialData=="function"?c.initialData():c.initialData,y=f!==void 0,C=y?typeof c.initialDataUpdatedAt=="function"?c.initialDataUpdatedAt():c.initialDataUpdatedAt:0;return{data:f,dataUpdateCount:0,dataUpdatedAt:y?C??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:y?"success":"pending",fetchStatus:"idle"}}function K_(c){return{onFetch:(f,y)=>{const C=f.options,N=f.fetchOptions?.meta?.fetchMore?.direction,k=f.state.data?.pages||[],R=f.state.data?.pageParams||[];let h={pages:[],pageParams:[]},V=0;const H=async()=>{let $=!1;const K=Ee=>{Object.defineProperty(Ee,"signal",{enumerable:!0,get:()=>(f.signal.aborted?$=!0:f.signal.addEventListener("abort",()=>{$=!0}),f.signal)})},be=S2(f.options,f.fetchOptions),Ce=async(Ee,ye,he)=>{if($)return Promise.reject();if(ye==null&&Ee.pages.length)return Promise.resolve(Ee);const nt=(()=>{const wt={client:f.client,queryKey:f.queryKey,pageParam:ye,direction:he?"backward":"forward",meta:f.options.meta};return K(wt),wt})(),Qe=await be(nt),{maxPages:dt}=f.options,Ut=he?pI:fI;return{pages:Ut(Ee.pages,Qe,dt),pageParams:Ut(Ee.pageParams,ye,dt)}};if(N&&k.length){const Ee=N==="backward",ye=Ee?EI:Q_,he={pages:k,pageParams:R},ke=ye(C,he);h=await Ce(he,ke,Ee)}else{const Ee=c??k.length;do{const ye=V===0?R[0]??C.initialPageParam:Q_(C,h);if(V>0&&ye==null)break;h=await Ce(h,ye),V++}while(V<Ee)}return h};f.options.persister?f.fetchFn=()=>f.options.persister?.(H,{client:f.client,queryKey:f.queryKey,meta:f.options.meta,signal:f.signal},y):f.fetchFn=H}}}function Q_(c,{pages:f,pageParams:y}){const C=f.length-1;return f.length>0?c.getNextPageParam(f[C],f,y[C],y):void 0}function EI(c,{pages:f,pageParams:y}){return f.length>0?c.getPreviousPageParam?.(f[0],f,y[0],y):void 0}var SI=class extends I2{#e;#t;#n;#r;constructor(c){super(),this.#e=c.client,this.mutationId=c.mutationId,this.#n=c.mutationCache,this.#t=[],this.state=c.state||TI(),this.setOptions(c.options),this.scheduleGc()}setOptions(c){this.options=c,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(c){this.#t.includes(c)||(this.#t.push(c),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:c}))}removeObserver(c){this.#t=this.#t.filter(f=>f!==c),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:c})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(c){const f=()=>{this.#i({type:"continue"})},y={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=C2({fn:()=>this.options.mutationFn?this.options.mutationFn(c,y):Promise.reject(new Error("No mutationFn found")),onFail:(k,R)=>{this.#i({type:"failed",failureCount:k,error:R})},onPause:()=>{this.#i({type:"pause"})},onContinue:f,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const C=this.state.status==="pending",N=!this.#r.canStart();try{if(C)f();else{this.#i({type:"pending",variables:c,isPaused:N}),await this.#n.config.onMutate?.(c,this,y);const R=await this.options.onMutate?.(c,y);R!==this.state.context&&this.#i({type:"pending",context:R,variables:c,isPaused:N})}const k=await this.#r.start();return await this.#n.config.onSuccess?.(k,c,this.state.context,this,y),await this.options.onSuccess?.(k,c,this.state.context,y),await this.#n.config.onSettled?.(k,null,this.state.variables,this.state.context,this,y),await this.options.onSettled?.(k,null,c,this.state.context,y),this.#i({type:"success",data:k}),k}catch(k){try{throw await this.#n.config.onError?.(k,c,this.state.context,this,y),await this.options.onError?.(k,c,this.state.context,y),await this.#n.config.onSettled?.(void 0,k,this.state.variables,this.state.context,this,y),await this.options.onSettled?.(void 0,k,c,this.state.context,y),k}finally{this.#i({type:"error",error:k})}}finally{this.#n.runNext(this)}}#i(c){const f=y=>{switch(c.type){case"failed":return{...y,failureCount:c.failureCount,failureReason:c.error};case"pause":return{...y,isPaused:!0};case"continue":return{...y,isPaused:!1};case"pending":return{...y,context:c.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:c.isPaused,status:"pending",variables:c.variables,submittedAt:Date.now()};case"success":return{...y,data:c.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...y,data:void 0,error:c.error,failureCount:y.failureCount+1,failureReason:c.error,isPaused:!1,status:"error"}}};this.state=f(this.state),Wo.batch(()=>{this.#t.forEach(y=>{y.onMutationUpdate(c)}),this.#n.notify({mutation:this,type:"updated",action:c})})}};function TI(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var AI=class extends b1{constructor(c={}){super(),this.config=c,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(c,f,y){const C=new SI({client:c,mutationCache:this,mutationId:++this.#n,options:c.defaultMutationOptions(f),state:y});return this.add(C),C}add(c){this.#e.add(c);const f=Bg(c);if(typeof f=="string"){const y=this.#t.get(f);y?y.push(c):this.#t.set(f,[c])}this.notify({type:"added",mutation:c})}remove(c){if(this.#e.delete(c)){const f=Bg(c);if(typeof f=="string"){const y=this.#t.get(f);if(y)if(y.length>1){const C=y.indexOf(c);C!==-1&&y.splice(C,1)}else y[0]===c&&this.#t.delete(f)}}this.notify({type:"removed",mutation:c})}canRun(c){const f=Bg(c);if(typeof f=="string"){const C=this.#t.get(f)?.find(N=>N.state.status==="pending");return!C||C===c}else return!0}runNext(c){const f=Bg(c);return typeof f=="string"?this.#t.get(f)?.find(C=>C!==c&&C.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Wo.batch(()=>{this.#e.forEach(c=>{this.notify({type:"removed",mutation:c})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(c){const f={exact:!0,...c};return this.getAll().find(y=>Z_(f,y))}findAll(c={}){return this.getAll().filter(f=>Z_(c,f))}notify(c){Wo.batch(()=>{this.listeners.forEach(f=>{f(c)})})}resumePausedMutations(){const c=this.getAll().filter(f=>f.state.isPaused);return Wo.batch(()=>Promise.all(c.map(f=>f.continue().catch(lu))))}};function Bg(c){return c.options.scope?.id}var CI=class extends b1{constructor(c={}){super(),this.config=c,this.#e=new Map}#e;build(c,f,y){const C=f.queryKey,N=f.queryHash??gx(C,f);let k=this.get(N);return k||(k=new vI({client:c,queryKey:C,queryHash:N,options:c.defaultQueryOptions(f),state:y,defaultOptions:c.getQueryDefaults(C)}),this.add(k)),k}add(c){this.#e.has(c.queryHash)||(this.#e.set(c.queryHash,c),this.notify({type:"added",query:c}))}remove(c){const f=this.#e.get(c.queryHash);f&&(c.destroy(),f===c&&this.#e.delete(c.queryHash),this.notify({type:"removed",query:c}))}clear(){Wo.batch(()=>{this.getAll().forEach(c=>{this.remove(c)})})}get(c){return this.#e.get(c)}getAll(){return[...this.#e.values()]}find(c){const f={exact:!0,...c};return this.getAll().find(y=>q_(f,y))}findAll(c={}){const f=this.getAll();return Object.keys(c).length>0?f.filter(y=>q_(c,y)):f}notify(c){Wo.batch(()=>{this.listeners.forEach(f=>{f(c)})})}onFocus(){Wo.batch(()=>{this.getAll().forEach(c=>{c.onFocus()})})}onOnline(){Wo.batch(()=>{this.getAll().forEach(c=>{c.onOnline()})})}},II=class{#e;#t;#n;#r;#i;#a;#o;#s;constructor(c={}){this.#e=c.queryCache||new CI,this.#t=c.mutationCache||new AI,this.#n=c.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=T2.subscribe(async c=>{c&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=i1.subscribe(async c=>{c&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#s?.(),this.#s=void 0)}isFetching(c){return this.#e.findAll({...c,fetchStatus:"fetching"}).length}isMutating(c){return this.#t.findAll({...c,status:"pending"}).length}getQueryData(c){const f=this.defaultQueryOptions({queryKey:c});return this.#e.get(f.queryHash)?.state.data}ensureQueryData(c){const f=this.defaultQueryOptions(c),y=this.#e.build(this,f),C=y.state.data;return C===void 0?this.fetchQuery(c):(c.revalidateIfStale&&y.isStaleByTime(My(f.staleTime,y))&&this.prefetchQuery(f),Promise.resolve(C))}getQueriesData(c){return this.#e.findAll(c).map(({queryKey:f,state:y})=>{const C=y.data;return[f,C]})}setQueryData(c,f,y){const C=this.defaultQueryOptions({queryKey:c}),k=this.#e.get(C.queryHash)?.state.data,R=aI(f,k);if(R!==void 0)return this.#e.build(this,C).setData(R,{...y,manual:!0})}setQueriesData(c,f,y){return Wo.batch(()=>this.#e.findAll(c).map(({queryKey:C})=>[C,this.setQueryData(C,f,y)]))}getQueryState(c){const f=this.defaultQueryOptions({queryKey:c});return this.#e.get(f.queryHash)?.state}removeQueries(c){const f=this.#e;Wo.batch(()=>{f.findAll(c).forEach(y=>{f.remove(y)})})}resetQueries(c,f){const y=this.#e;return Wo.batch(()=>(y.findAll(c).forEach(C=>{C.reset()}),this.refetchQueries({type:"active",...c},f)))}cancelQueries(c,f={}){const y={revert:!0,...f},C=Wo.batch(()=>this.#e.findAll(c).map(N=>N.cancel(y)));return Promise.all(C).then(lu).catch(lu)}invalidateQueries(c,f={}){return Wo.batch(()=>(this.#e.findAll(c).forEach(y=>{y.invalidate()}),c?.refetchType==="none"?Promise.resolve():this.refetchQueries({...c,type:c?.refetchType??c?.type??"active"},f)))}refetchQueries(c,f={}){const y={...f,cancelRefetch:f.cancelRefetch??!0},C=Wo.batch(()=>this.#e.findAll(c).filter(N=>!N.isDisabled()&&!N.isStatic()).map(N=>{let k=N.fetch(void 0,y);return y.throwOnError||(k=k.catch(lu)),N.state.fetchStatus==="paused"?Promise.resolve():k}));return Promise.all(C).then(lu)}fetchQuery(c){const f=this.defaultQueryOptions(c);f.retry===void 0&&(f.retry=!1);const y=this.#e.build(this,f);return y.isStaleByTime(My(f.staleTime,y))?y.fetch(f):Promise.resolve(y.state.data)}prefetchQuery(c){return this.fetchQuery(c).then(lu).catch(lu)}fetchInfiniteQuery(c){return c.behavior=K_(c.pages),this.fetchQuery(c)}prefetchInfiniteQuery(c){return this.fetchInfiniteQuery(c).then(lu).catch(lu)}ensureInfiniteQueryData(c){return c.behavior=K_(c.pages),this.ensureQueryData(c)}resumePausedMutations(){return i1.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(c){this.#n=c}setQueryDefaults(c,f){this.#r.set(Rm(c),{queryKey:c,defaultOptions:f})}getQueryDefaults(c){const f=[...this.#r.values()],y={};return f.forEach(C=>{Dm(c,C.queryKey)&&Object.assign(y,C.defaultOptions)}),y}setMutationDefaults(c,f){this.#i.set(Rm(c),{mutationKey:c,defaultOptions:f})}getMutationDefaults(c){const f=[...this.#i.values()],y={};return f.forEach(C=>{Dm(c,C.mutationKey)&&Object.assign(y,C.defaultOptions)}),y}defaultQueryOptions(c){if(c._defaulted)return c;const f={...this.#n.queries,...this.getQueryDefaults(c.queryKey),...c,_defaulted:!0};return f.queryHash||(f.queryHash=gx(f.queryKey,f)),f.refetchOnReconnect===void 0&&(f.refetchOnReconnect=f.networkMode!=="always"),f.throwOnError===void 0&&(f.throwOnError=!!f.suspense),!f.networkMode&&f.persister&&(f.networkMode="offlineFirst"),f.queryFn===yx&&(f.enabled=!1),f}defaultMutationOptions(c){return c?._defaulted?c:{...this.#n.mutations,...c?.mutationKey&&this.getMutationDefaults(c.mutationKey),...c,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},MI=De.createContext(void 0),RI=({client:c,children:f})=>(De.useEffect(()=>(c.mount(),()=>{c.unmount()}),[c]),O.jsx(MI.Provider,{value:c,children:f}));const DI=new II;Q2.createRoot(document.getElementById("root")).render(O.jsx(na.StrictMode,{children:O.jsx(RI,{client:DI,children:O.jsx(iA,{children:O.jsx(nI,{})})})}));
