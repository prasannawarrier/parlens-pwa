function Z1(u,m){for(var v=0;v<m.length;v++){const S=m[v];if(typeof S!="string"&&!Array.isArray(S)){for(const M in S)if(M!=="default"&&!(M in u)){const R=Object.getOwnPropertyDescriptor(S,M);R&&Object.defineProperty(u,M,R.get?R:{enumerable:!0,get:()=>S[M]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const M of document.querySelectorAll('link[rel="modulepreload"]'))S(M);new MutationObserver(M=>{for(const R of M)if(R.type==="childList")for(const E of R.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&S(E)}).observe(document,{childList:!0,subtree:!0});function v(M){const R={};return M.integrity&&(R.integrity=M.integrity),M.referrerPolicy&&(R.referrerPolicy=M.referrerPolicy),M.crossOrigin==="use-credentials"?R.credentials="include":M.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function S(M){if(M.ep)return;M.ep=!0;const R=v(M);fetch(M.href,R)}})();function vg(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var S_={exports:{}},lg={};var cx;function X1(){if(cx)return lg;cx=1;var u=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function v(S,M,R){var E=null;if(R!==void 0&&(E=""+R),M.key!==void 0&&(E=""+M.key),"key"in M){R={};for(var l in M)l!=="key"&&(R[l]=M[l])}else R=M;return M=R.ref,{$$typeof:u,type:S,key:E,ref:M!==void 0?M:null,props:R}}return lg.Fragment=m,lg.jsx=v,lg.jsxs=v,lg}var ux;function Y1(){return ux||(ux=1,S_.exports=X1()),S_.exports}var k=Y1(),T_={exports:{}},Nn={};var hx;function K1(){if(hx)return Nn;hx=1;var u=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),E=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),Y=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),ze=Symbol.iterator;function Ce(de){return de===null||typeof de!="object"?null:(de=ze&&de[ze]||de["@@iterator"],typeof de=="function"?de:null)}var be={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},he=Object.assign,te={};function ve(de,He,_t){this.props=de,this.context=He,this.refs=te,this.updater=_t||be}ve.prototype.isReactComponent={},ve.prototype.setState=function(de,He){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,He,"setState")},ve.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function qe(){}qe.prototype=ve.prototype;function lt(de,He,_t){this.props=de,this.context=He,this.refs=te,this.updater=_t||be}var Pt=lt.prototype=new qe;Pt.constructor=lt,he(Pt,ve.prototype),Pt.isPureReactComponent=!0;var Et=Array.isArray;function St(){}var nt={H:null,A:null,T:null,S:null},Be=Object.prototype.hasOwnProperty;function it(de,He,_t){var It=_t.ref;return{$$typeof:u,type:de,key:He,ref:It!==void 0?It:null,props:_t}}function $e(de,He){return it(de.type,He,de.props)}function we(de){return typeof de=="object"&&de!==null&&de.$$typeof===u}function Qe(de){var He={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(_t){return He[_t]})}var ut=/\/+/g;function Ye(de,He){return typeof de=="object"&&de!==null&&de.key!=null?Qe(""+de.key):He.toString(36)}function Ie(de){switch(de.status){case"fulfilled":return de.value;case"rejected":throw de.reason;default:switch(typeof de.status=="string"?de.then(St,St):(de.status="pending",de.then(function(He){de.status==="pending"&&(de.status="fulfilled",de.value=He)},function(He){de.status==="pending"&&(de.status="rejected",de.reason=He)})),de.status){case"fulfilled":return de.value;case"rejected":throw de.reason}}throw de}function le(de,He,_t,It,Ze){var Dt=typeof de;(Dt==="undefined"||Dt==="boolean")&&(de=null);var jt=!1;if(de===null)jt=!0;else switch(Dt){case"bigint":case"string":case"number":jt=!0;break;case"object":switch(de.$$typeof){case u:case m:jt=!0;break;case ie:return jt=de._init,le(jt(de._payload),He,_t,It,Ze)}}if(jt)return Ze=Ze(de),jt=It===""?"."+Ye(de,0):It,Et(Ze)?(_t="",jt!=null&&(_t=jt.replace(ut,"$&/")+"/"),le(Ze,He,_t,"",function(ln){return ln})):Ze!=null&&(we(Ze)&&(Ze=$e(Ze,_t+(Ze.key==null||de&&de.key===Ze.key?"":(""+Ze.key).replace(ut,"$&/")+"/")+jt)),He.push(Ze)),1;jt=0;var $t=It===""?".":It+":";if(Et(de))for(var Ot=0;Ot<de.length;Ot++)It=de[Ot],Dt=$t+Ye(It,Ot),jt+=le(It,He,_t,Dt,Ze);else if(Ot=Ce(de),typeof Ot=="function")for(de=Ot.call(de),Ot=0;!(It=de.next()).done;)It=It.value,Dt=$t+Ye(It,Ot++),jt+=le(It,He,_t,Dt,Ze);else if(Dt==="object"){if(typeof de.then=="function")return le(Ie(de),He,_t,It,Ze);throw He=String(de),Error("Objects are not valid as a React child (found: "+(He==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":He)+"). If you meant to render a collection of children, use an array instead.")}return jt}function ke(de,He,_t){if(de==null)return de;var It=[],Ze=0;return le(de,It,"","",function(Dt){return He.call(_t,Dt,Ze++)}),It}function De(de){if(de._status===-1){var He=de._result;He=He(),He.then(function(_t){(de._status===0||de._status===-1)&&(de._status=1,de._result=_t)},function(_t){(de._status===0||de._status===-1)&&(de._status=2,de._result=_t)}),de._status===-1&&(de._status=0,de._result=He)}if(de._status===1)return de._result.default;throw de._result}var Fe=typeof reportError=="function"?reportError:function(de){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var He=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof de=="object"&&de!==null&&typeof de.message=="string"?String(de.message):String(de),error:de});if(!window.dispatchEvent(He))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",de);return}console.error(de)},bt={map:ke,forEach:function(de,He,_t){ke(de,function(){He.apply(this,arguments)},_t)},count:function(de){var He=0;return ke(de,function(){He++}),He},toArray:function(de){return ke(de,function(He){return He})||[]},only:function(de){if(!we(de))throw Error("React.Children.only expected to receive a single React element child.");return de}};return Nn.Activity=ne,Nn.Children=bt,Nn.Component=ve,Nn.Fragment=v,Nn.Profiler=M,Nn.PureComponent=lt,Nn.StrictMode=S,Nn.Suspense=O,Nn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=nt,Nn.__COMPILER_RUNTIME={__proto__:null,c:function(de){return nt.H.useMemoCache(de)}},Nn.cache=function(de){return function(){return de.apply(null,arguments)}},Nn.cacheSignal=function(){return null},Nn.cloneElement=function(de,He,_t){if(de==null)throw Error("The argument must be a React element, but you passed "+de+".");var It=he({},de.props),Ze=de.key;if(He!=null)for(Dt in He.key!==void 0&&(Ze=""+He.key),He)!Be.call(He,Dt)||Dt==="key"||Dt==="__self"||Dt==="__source"||Dt==="ref"&&He.ref===void 0||(It[Dt]=He[Dt]);var Dt=arguments.length-2;if(Dt===1)It.children=_t;else if(1<Dt){for(var jt=Array(Dt),$t=0;$t<Dt;$t++)jt[$t]=arguments[$t+2];It.children=jt}return it(de.type,Ze,It)},Nn.createContext=function(de){return de={$$typeof:E,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null},de.Provider=de,de.Consumer={$$typeof:R,_context:de},de},Nn.createElement=function(de,He,_t){var It,Ze={},Dt=null;if(He!=null)for(It in He.key!==void 0&&(Dt=""+He.key),He)Be.call(He,It)&&It!=="key"&&It!=="__self"&&It!=="__source"&&(Ze[It]=He[It]);var jt=arguments.length-2;if(jt===1)Ze.children=_t;else if(1<jt){for(var $t=Array(jt),Ot=0;Ot<jt;Ot++)$t[Ot]=arguments[Ot+2];Ze.children=$t}if(de&&de.defaultProps)for(It in jt=de.defaultProps,jt)Ze[It]===void 0&&(Ze[It]=jt[It]);return it(de,Dt,Ze)},Nn.createRef=function(){return{current:null}},Nn.forwardRef=function(de){return{$$typeof:l,render:de}},Nn.isValidElement=we,Nn.lazy=function(de){return{$$typeof:ie,_payload:{_status:-1,_result:de},_init:De}},Nn.memo=function(de,He){return{$$typeof:Y,type:de,compare:He===void 0?null:He}},Nn.startTransition=function(de){var He=nt.T,_t={};nt.T=_t;try{var It=de(),Ze=nt.S;Ze!==null&&Ze(_t,It),typeof It=="object"&&It!==null&&typeof It.then=="function"&&It.then(St,Fe)}catch(Dt){Fe(Dt)}finally{He!==null&&_t.types!==null&&(He.types=_t.types),nt.T=He}},Nn.unstable_useCacheRefresh=function(){return nt.H.useCacheRefresh()},Nn.use=function(de){return nt.H.use(de)},Nn.useActionState=function(de,He,_t){return nt.H.useActionState(de,He,_t)},Nn.useCallback=function(de,He){return nt.H.useCallback(de,He)},Nn.useContext=function(de){return nt.H.useContext(de)},Nn.useDebugValue=function(){},Nn.useDeferredValue=function(de,He){return nt.H.useDeferredValue(de,He)},Nn.useEffect=function(de,He){return nt.H.useEffect(de,He)},Nn.useEffectEvent=function(de){return nt.H.useEffectEvent(de)},Nn.useId=function(){return nt.H.useId()},Nn.useImperativeHandle=function(de,He,_t){return nt.H.useImperativeHandle(de,He,_t)},Nn.useInsertionEffect=function(de,He){return nt.H.useInsertionEffect(de,He)},Nn.useLayoutEffect=function(de,He){return nt.H.useLayoutEffect(de,He)},Nn.useMemo=function(de,He){return nt.H.useMemo(de,He)},Nn.useOptimistic=function(de,He){return nt.H.useOptimistic(de,He)},Nn.useReducer=function(de,He,_t){return nt.H.useReducer(de,He,_t)},Nn.useRef=function(de){return nt.H.useRef(de)},Nn.useState=function(de){return nt.H.useState(de)},Nn.useSyncExternalStore=function(de,He,_t){return nt.H.useSyncExternalStore(de,He,_t)},Nn.useTransition=function(){return nt.H.useTransition()},Nn.version="19.2.3",Nn}var dx;function f0(){return dx||(dx=1,T_.exports=K1()),T_.exports}var me=f0();const p0=vg(me);var E_={exports:{}},cg={},M_={exports:{}},C_={};var fx;function W1(){return fx||(fx=1,(function(u){function m(le,ke){var De=le.length;le.push(ke);e:for(;0<De;){var Fe=De-1>>>1,bt=le[Fe];if(0<M(bt,ke))le[Fe]=ke,le[De]=bt,De=Fe;else break e}}function v(le){return le.length===0?null:le[0]}function S(le){if(le.length===0)return null;var ke=le[0],De=le.pop();if(De!==ke){le[0]=De;e:for(var Fe=0,bt=le.length,de=bt>>>1;Fe<de;){var He=2*(Fe+1)-1,_t=le[He],It=He+1,Ze=le[It];if(0>M(_t,De))It<bt&&0>M(Ze,_t)?(le[Fe]=Ze,le[It]=De,Fe=It):(le[Fe]=_t,le[He]=De,Fe=He);else if(It<bt&&0>M(Ze,De))le[Fe]=Ze,le[It]=De,Fe=It;else break e}}return ke}function M(le,ke){var De=le.sortIndex-ke.sortIndex;return De!==0?De:le.id-ke.id}if(u.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var R=performance;u.unstable_now=function(){return R.now()}}else{var E=Date,l=E.now();u.unstable_now=function(){return E.now()-l}}var O=[],Y=[],ie=1,ne=null,ze=3,Ce=!1,be=!1,he=!1,te=!1,ve=typeof setTimeout=="function"?setTimeout:null,qe=typeof clearTimeout=="function"?clearTimeout:null,lt=typeof setImmediate<"u"?setImmediate:null;function Pt(le){for(var ke=v(Y);ke!==null;){if(ke.callback===null)S(Y);else if(ke.startTime<=le)S(Y),ke.sortIndex=ke.expirationTime,m(O,ke);else break;ke=v(Y)}}function Et(le){if(he=!1,Pt(le),!be)if(v(O)!==null)be=!0,St||(St=!0,Qe());else{var ke=v(Y);ke!==null&&Ie(Et,ke.startTime-le)}}var St=!1,nt=-1,Be=5,it=-1;function $e(){return te?!0:!(u.unstable_now()-it<Be)}function we(){if(te=!1,St){var le=u.unstable_now();it=le;var ke=!0;try{e:{be=!1,he&&(he=!1,qe(nt),nt=-1),Ce=!0;var De=ze;try{t:{for(Pt(le),ne=v(O);ne!==null&&!(ne.expirationTime>le&&$e());){var Fe=ne.callback;if(typeof Fe=="function"){ne.callback=null,ze=ne.priorityLevel;var bt=Fe(ne.expirationTime<=le);if(le=u.unstable_now(),typeof bt=="function"){ne.callback=bt,Pt(le),ke=!0;break t}ne===v(O)&&S(O),Pt(le)}else S(O);ne=v(O)}if(ne!==null)ke=!0;else{var de=v(Y);de!==null&&Ie(Et,de.startTime-le),ke=!1}}break e}finally{ne=null,ze=De,Ce=!1}ke=void 0}}finally{ke?Qe():St=!1}}}var Qe;if(typeof lt=="function")Qe=function(){lt(we)};else if(typeof MessageChannel<"u"){var ut=new MessageChannel,Ye=ut.port2;ut.port1.onmessage=we,Qe=function(){Ye.postMessage(null)}}else Qe=function(){ve(we,0)};function Ie(le,ke){nt=ve(function(){le(u.unstable_now())},ke)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(le){le.callback=null},u.unstable_forceFrameRate=function(le){0>le||125<le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Be=0<le?Math.floor(1e3/le):5},u.unstable_getCurrentPriorityLevel=function(){return ze},u.unstable_next=function(le){switch(ze){case 1:case 2:case 3:var ke=3;break;default:ke=ze}var De=ze;ze=ke;try{return le()}finally{ze=De}},u.unstable_requestPaint=function(){te=!0},u.unstable_runWithPriority=function(le,ke){switch(le){case 1:case 2:case 3:case 4:case 5:break;default:le=3}var De=ze;ze=le;try{return ke()}finally{ze=De}},u.unstable_scheduleCallback=function(le,ke,De){var Fe=u.unstable_now();switch(typeof De=="object"&&De!==null?(De=De.delay,De=typeof De=="number"&&0<De?Fe+De:Fe):De=Fe,le){case 1:var bt=-1;break;case 2:bt=250;break;case 5:bt=1073741823;break;case 4:bt=1e4;break;default:bt=5e3}return bt=De+bt,le={id:ie++,callback:ke,priorityLevel:le,startTime:De,expirationTime:bt,sortIndex:-1},De>Fe?(le.sortIndex=De,m(Y,le),v(O)===null&&le===v(Y)&&(he?(qe(nt),nt=-1):he=!0,Ie(Et,De-Fe))):(le.sortIndex=bt,m(O,le),be||Ce||(be=!0,St||(St=!0,Qe()))),le},u.unstable_shouldYield=$e,u.unstable_wrapCallback=function(le){var ke=ze;return function(){var De=ze;ze=ke;try{return le.apply(this,arguments)}finally{ze=De}}}})(C_)),C_}var px;function Q1(){return px||(px=1,M_.exports=W1()),M_.exports}var A_={exports:{}},cs={};var mx;function J1(){if(mx)return cs;mx=1;var u=f0();function m(O){var Y="https://react.dev/errors/"+O;if(1<arguments.length){Y+="?args[]="+encodeURIComponent(arguments[1]);for(var ie=2;ie<arguments.length;ie++)Y+="&args[]="+encodeURIComponent(arguments[ie])}return"Minified React error #"+O+"; visit "+Y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function v(){}var S={d:{f:v,r:function(){throw Error(m(522))},D:v,C:v,L:v,m:v,X:v,S:v,M:v},p:0,findDOMNode:null},M=Symbol.for("react.portal");function R(O,Y,ie){var ne=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:M,key:ne==null?null:""+ne,children:O,containerInfo:Y,implementation:ie}}var E=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(O,Y){if(O==="font")return"";if(typeof Y=="string")return Y==="use-credentials"?Y:""}return cs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,cs.createPortal=function(O,Y){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Y||Y.nodeType!==1&&Y.nodeType!==9&&Y.nodeType!==11)throw Error(m(299));return R(O,Y,null,ie)},cs.flushSync=function(O){var Y=E.T,ie=S.p;try{if(E.T=null,S.p=2,O)return O()}finally{E.T=Y,S.p=ie,S.d.f()}},cs.preconnect=function(O,Y){typeof O=="string"&&(Y?(Y=Y.crossOrigin,Y=typeof Y=="string"?Y==="use-credentials"?Y:"":void 0):Y=null,S.d.C(O,Y))},cs.prefetchDNS=function(O){typeof O=="string"&&S.d.D(O)},cs.preinit=function(O,Y){if(typeof O=="string"&&Y&&typeof Y.as=="string"){var ie=Y.as,ne=l(ie,Y.crossOrigin),ze=typeof Y.integrity=="string"?Y.integrity:void 0,Ce=typeof Y.fetchPriority=="string"?Y.fetchPriority:void 0;ie==="style"?S.d.S(O,typeof Y.precedence=="string"?Y.precedence:void 0,{crossOrigin:ne,integrity:ze,fetchPriority:Ce}):ie==="script"&&S.d.X(O,{crossOrigin:ne,integrity:ze,fetchPriority:Ce,nonce:typeof Y.nonce=="string"?Y.nonce:void 0})}},cs.preinitModule=function(O,Y){if(typeof O=="string")if(typeof Y=="object"&&Y!==null){if(Y.as==null||Y.as==="script"){var ie=l(Y.as,Y.crossOrigin);S.d.M(O,{crossOrigin:ie,integrity:typeof Y.integrity=="string"?Y.integrity:void 0,nonce:typeof Y.nonce=="string"?Y.nonce:void 0})}}else Y==null&&S.d.M(O)},cs.preload=function(O,Y){if(typeof O=="string"&&typeof Y=="object"&&Y!==null&&typeof Y.as=="string"){var ie=Y.as,ne=l(ie,Y.crossOrigin);S.d.L(O,ie,{crossOrigin:ne,integrity:typeof Y.integrity=="string"?Y.integrity:void 0,nonce:typeof Y.nonce=="string"?Y.nonce:void 0,type:typeof Y.type=="string"?Y.type:void 0,fetchPriority:typeof Y.fetchPriority=="string"?Y.fetchPriority:void 0,referrerPolicy:typeof Y.referrerPolicy=="string"?Y.referrerPolicy:void 0,imageSrcSet:typeof Y.imageSrcSet=="string"?Y.imageSrcSet:void 0,imageSizes:typeof Y.imageSizes=="string"?Y.imageSizes:void 0,media:typeof Y.media=="string"?Y.media:void 0})}},cs.preloadModule=function(O,Y){if(typeof O=="string")if(Y){var ie=l(Y.as,Y.crossOrigin);S.d.m(O,{as:typeof Y.as=="string"&&Y.as!=="script"?Y.as:void 0,crossOrigin:ie,integrity:typeof Y.integrity=="string"?Y.integrity:void 0})}else S.d.m(O)},cs.requestFormReset=function(O){S.d.r(O)},cs.unstable_batchedUpdates=function(O,Y){return O(Y)},cs.useFormState=function(O,Y,ie){return E.H.useFormState(O,Y,ie)},cs.useFormStatus=function(){return E.H.useHostTransitionStatus()},cs.version="19.2.3",cs}var gx;function xv(){if(gx)return A_.exports;gx=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(m){console.error(m)}}return u(),A_.exports=J1(),A_.exports}var yx;function ew(){if(yx)return cg;yx=1;var u=Q1(),m=f0(),v=xv();function S(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function M(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function R(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function E(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function l(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function O(r){if(R(r)!==r)throw Error(S(188))}function Y(r){var s=r.alternate;if(!s){if(s=R(r),s===null)throw Error(S(188));return s!==r?null:r}for(var d=r,_=s;;){var A=d.return;if(A===null)break;var D=A.alternate;if(D===null){if(_=A.return,_!==null){d=_;continue}break}if(A.child===D.child){for(D=A.child;D;){if(D===d)return O(A),r;if(D===_)return O(A),s;D=D.sibling}throw Error(S(188))}if(d.return!==_.return)d=A,_=D;else{for(var q=!1,re=A.child;re;){if(re===d){q=!0,d=A,_=D;break}if(re===_){q=!0,_=A,d=D;break}re=re.sibling}if(!q){for(re=D.child;re;){if(re===d){q=!0,d=D,_=A;break}if(re===_){q=!0,_=D,d=A;break}re=re.sibling}if(!q)throw Error(S(189))}}if(d.alternate!==_)throw Error(S(190))}if(d.tag!==3)throw Error(S(188));return d.stateNode.current===d?r:s}function ie(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=ie(r),s!==null)return s;r=r.sibling}return null}var ne=Object.assign,ze=Symbol.for("react.element"),Ce=Symbol.for("react.transitional.element"),be=Symbol.for("react.portal"),he=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),ve=Symbol.for("react.profiler"),qe=Symbol.for("react.consumer"),lt=Symbol.for("react.context"),Pt=Symbol.for("react.forward_ref"),Et=Symbol.for("react.suspense"),St=Symbol.for("react.suspense_list"),nt=Symbol.for("react.memo"),Be=Symbol.for("react.lazy"),it=Symbol.for("react.activity"),$e=Symbol.for("react.memo_cache_sentinel"),we=Symbol.iterator;function Qe(r){return r===null||typeof r!="object"?null:(r=we&&r[we]||r["@@iterator"],typeof r=="function"?r:null)}var ut=Symbol.for("react.client.reference");function Ye(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===ut?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case he:return"Fragment";case ve:return"Profiler";case te:return"StrictMode";case Et:return"Suspense";case St:return"SuspenseList";case it:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case be:return"Portal";case lt:return r.displayName||"Context";case qe:return(r._context.displayName||"Context")+".Consumer";case Pt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case nt:return s=r.displayName||null,s!==null?s:Ye(r.type)||"Memo";case Be:s=r._payload,r=r._init;try{return Ye(r(s))}catch{}}return null}var Ie=Array.isArray,le=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ke=v.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,De={pending:!1,data:null,method:null,action:null},Fe=[],bt=-1;function de(r){return{current:r}}function He(r){0>bt||(r.current=Fe[bt],Fe[bt]=null,bt--)}function _t(r,s){bt++,Fe[bt]=r.current,r.current=s}var It=de(null),Ze=de(null),Dt=de(null),jt=de(null);function $t(r,s){switch(_t(Dt,s),_t(Ze,r),_t(It,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?zc(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=zc(s),r=Om(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}He(It),_t(It,r)}function Ot(){He(It),He(Ze),He(Dt)}function ln(r){r.memoizedState!==null&&_t(jt,r);var s=It.current,d=Om(s,r.type);s!==d&&(_t(Ze,r),_t(It,d))}function dn(r){Ze.current===r&&(He(It),He(Ze)),jt.current===r&&(He(jt),Hh._currentValue=De)}var rn,gt;function xt(r){if(rn===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);rn=s&&s[1]||"",gt=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+rn+r+gt}var zt=!1;function qt(r,s){if(!r||zt)return"";zt=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(s){var At=function(){throw Error()};if(Object.defineProperty(At.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(At,[])}catch(pt){var ct=pt}Reflect.construct(r,[],At)}else{try{At.call()}catch(pt){ct=pt}r.call(At.prototype)}}else{try{throw Error()}catch(pt){ct=pt}(At=r())&&typeof At.catch=="function"&&At.catch(function(){})}}catch(pt){if(pt&&ct&&typeof pt.stack=="string")return[pt.stack,ct.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=_.DetermineComponentFrameRoot(),q=D[0],re=D[1];if(q&&re){var Pe=q.split(`
`),ot=re.split(`
`);for(A=_=0;_<Pe.length&&!Pe[_].includes("DetermineComponentFrameRoot");)_++;for(;A<ot.length&&!ot[A].includes("DetermineComponentFrameRoot");)A++;if(_===Pe.length||A===ot.length)for(_=Pe.length-1,A=ot.length-1;1<=_&&0<=A&&Pe[_]!==ot[A];)A--;for(;1<=_&&0<=A;_--,A--)if(Pe[_]!==ot[A]){if(_!==1||A!==1)do if(_--,A--,0>A||Pe[_]!==ot[A]){var vt=`
`+Pe[_].replace(" at new "," at ");return r.displayName&&vt.includes("<anonymous>")&&(vt=vt.replace("<anonymous>",r.displayName)),vt}while(1<=_&&0<=A);break}}}finally{zt=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?xt(d):""}function Gt(r,s){switch(r.tag){case 26:case 27:case 5:return xt(r.type);case 16:return xt("Lazy");case 13:return r.child!==s&&s!==null?xt("Suspense Fallback"):xt("Suspense");case 19:return xt("SuspenseList");case 0:case 15:return qt(r.type,!1);case 11:return qt(r.type.render,!1);case 1:return qt(r.type,!0);case 31:return xt("Activity");default:return""}}function gn(r){try{var s="",d=null;do s+=Gt(r,d),d=r,r=r.return;while(r);return s}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var Rn=Object.prototype.hasOwnProperty,bn=u.unstable_scheduleCallback,Zn=u.unstable_cancelCallback,Ln=u.unstable_shouldYield,Wi=u.unstable_requestPaint,kn=u.unstable_now,Cn=u.unstable_getCurrentPriorityLevel,Ue=u.unstable_ImmediatePriority,W=u.unstable_UserBlockingPriority,$=u.unstable_NormalPriority,K=u.unstable_LowPriority,ue=u.unstable_IdlePriority,ye=u.log,je=u.unstable_setDisableYieldValue,Le=null,Me=null;function Oe(r){if(typeof ye=="function"&&je(r),Me&&typeof Me.setStrictMode=="function")try{Me.setStrictMode(Le,r)}catch{}}var Je=Math.clz32?Math.clz32:Wt,ft=Math.log,Bt=Math.LN2;function Wt(r){return r>>>=0,r===0?32:31-(ft(r)/Bt|0)|0}var Jt=256,pn=262144,Mn=4194304;function Ve(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Pn(r,s,d){var _=r.pendingLanes;if(_===0)return 0;var A=0,D=r.suspendedLanes,q=r.pingedLanes;r=r.warmLanes;var re=_&134217727;return re!==0?(_=re&~D,_!==0?A=Ve(_):(q&=re,q!==0?A=Ve(q):d||(d=re&~r,d!==0&&(A=Ve(d))))):(re=_&~D,re!==0?A=Ve(re):q!==0?A=Ve(q):d||(d=_&~r,d!==0&&(A=Ve(d)))),A===0?0:s!==0&&s!==A&&(s&D)===0&&(D=A&-A,d=s&-s,D>=d||D===32&&(d&4194048)!==0)?s:A}function Fi(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function yn(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qn(){var r=Mn;return Mn<<=1,(Mn&62914560)===0&&(Mn=4194304),r}function ir(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function ei(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Ti(r,s,d,_,A,D){var q=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var re=r.entanglements,Pe=r.expirationTimes,ot=r.hiddenUpdates;for(d=q&~d;0<d;){var vt=31-Je(d),At=1<<vt;re[vt]=0,Pe[vt]=-1;var ct=ot[vt];if(ct!==null)for(ot[vt]=null,vt=0;vt<ct.length;vt++){var pt=ct[vt];pt!==null&&(pt.lane&=-536870913)}d&=~At}_!==0&&ii(r,_,0),D!==0&&A===0&&r.tag!==0&&(r.suspendedLanes|=D&~(q&~s))}function ii(r,s,d){r.pendingLanes|=s,r.suspendedLanes&=~s;var _=31-Je(s);r.entangledLanes|=s,r.entanglements[_]=r.entanglements[_]|1073741824|d&261930}function Ui(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var _=31-Je(d),A=1<<_;A&s|r[_]&s&&(r[_]|=s),d&=~A}}function Is(r,s){var d=s&-s;return d=(d&42)!==0?1:ds(d),(d&(r.suspendedLanes|s))!==0?0:d}function ds(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function kt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function br(){var r=ke.p;return r!==0?r:(r=window.event,r===void 0?32:Fu(r.type))}function hr(r,s){var d=ke.p;try{return ke.p=r,s()}finally{ke.p=d}}var _a=Math.random().toString(36).slice(2),Jn="__reactFiber$"+_a,Rt="__reactProps$"+_a,xn="__reactContainer$"+_a,En="__reactEvents$"+_a,Zr="__reactListeners$"+_a,hl="__reactHandles$"+_a,xa="__reactResources$"+_a,_n="__reactMarker$"+_a;function Rs(r){delete r[Jn],delete r[Rt],delete r[En],delete r[Zr],delete r[hl]}function Fa(r){var s=r[Jn];if(s)return s;for(var d=r.parentNode;d;){if(s=d[xn]||d[Jn]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=Wd(r);r!==null;){if(d=r[Jn])return d;r=Wd(r)}return s}r=d,d=r.parentNode}return null}function fs(r){if(r=r[Jn]||r[xn]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function ia(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(S(33))}function Xr(r){var s=r[xa];return s||(s=r[xa]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Ai(r){r[_n]=!0}var Ro=new Set,wr={};function On(r,s){Ua(r,s),Ua(r+"Capture",s)}function Ua(r,s){for(wr[r]=s,r=0;r<s.length;r++)Ro.add(s[r])}var Lo=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),co={},Ls={};function va(r){return Rn.call(Ls,r)?!0:Rn.call(co,r)?!1:Lo.test(r)?Ls[r]=!0:(co[r]=!0,!1)}function dl(r,s,d){if(va(s))if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var _=s.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+d)}}function Va(r,s,d){if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+d)}}function Xe(r,s,d,_){if(_===null)r.removeAttribute(d);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(s,d,""+_)}}function dt(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Vt(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function en(r,s,d){var _=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var A=_.get,D=_.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return A.call(this)},set:function(q){d=""+q,D.call(this,q)}}),Object.defineProperty(r,s,{enumerable:_.enumerable}),{getValue:function(){return d},setValue:function(q){d=""+q},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function tn(r){if(!r._valueTracker){var s=Vt(r)?"checked":"value";r._valueTracker=en(r,s,""+r[s])}}function Xn(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),_="";return r&&(_=Vt(r)?r.checked?"true":"false":r.value),r=_,r!==d?(s.setValue(r),!0):!1}function Yn(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var ps=/[\n"\\]/g;function xi(r){return r.replace(ps,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function qa(r,s,d,_,A,D,q,re){r.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?r.type=q:r.removeAttribute("type"),s!=null?q==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+dt(s)):r.value!==""+dt(s)&&(r.value=""+dt(s)):q!=="submit"&&q!=="reset"||r.removeAttribute("value"),s!=null?ms(r,q,dt(s)):d!=null?ms(r,q,dt(d)):_!=null&&r.removeAttribute("value"),A==null&&D!=null&&(r.defaultChecked=!!D),A!=null&&(r.checked=A&&typeof A!="function"&&typeof A!="symbol"),re!=null&&typeof re!="function"&&typeof re!="symbol"&&typeof re!="boolean"?r.name=""+dt(re):r.removeAttribute("name")}function fl(r,s,d,_,A,D,q,re){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(r.type=D),s!=null||d!=null){if(!(D!=="submit"&&D!=="reset"||s!=null)){tn(r);return}d=d!=null?""+dt(d):"",s=s!=null?""+dt(s):d,re||s===r.value||(r.value=s),r.defaultValue=s}_=_??A,_=typeof _!="function"&&typeof _!="symbol"&&!!_,r.checked=re?r.checked:!!_,r.defaultChecked=!!_,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(r.name=q),tn(r)}function ms(r,s,d){s==="number"&&Yn(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function Sr(r,s,d,_){if(r=r.options,s){s={};for(var A=0;A<d.length;A++)s["$"+d[A]]=!0;for(d=0;d<r.length;d++)A=s.hasOwnProperty("$"+r[d].value),r[d].selected!==A&&(r[d].selected=A),A&&_&&(r[d].defaultSelected=!0)}else{for(d=""+dt(d),s=null,A=0;A<r.length;A++){if(r[A].value===d){r[A].selected=!0,_&&(r[A].defaultSelected=!0);return}s!==null||r[A].disabled||(s=r[A])}s!==null&&(s.selected=!0)}}function Ju(r,s,d){if(s!=null&&(s=""+dt(s),s!==r.value&&(r.value=s),d==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=d!=null?""+dt(d):""}function Ns(r,s,d,_){if(s==null){if(_!=null){if(d!=null)throw Error(S(92));if(Ie(_)){if(1<_.length)throw Error(S(93));_=_[0]}d=_}d==null&&(d=""),s=d}d=dt(s),r.defaultValue=d,_=r.textContent,_===d&&_!==""&&_!==null&&(r.value=_),tn(r)}function Ga(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var Xc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function uo(r,s,d){var _=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?_?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":_?r.setProperty(s,d):typeof d!="number"||d===0||Xc.has(s)?s==="float"?r.cssFloat=d:r[s]=(""+d).trim():r[s]=d+"px"}function tc(r,s,d){if(s!=null&&typeof s!="object")throw Error(S(62));if(r=r.style,d!=null){for(var _ in d)!d.hasOwnProperty(_)||s!=null&&s.hasOwnProperty(_)||(_.indexOf("--")===0?r.setProperty(_,""):_==="float"?r.cssFloat="":r[_]="");for(var A in s)_=s[A],s.hasOwnProperty(A)&&d[A]!==_&&uo(r,A,_)}else for(var D in s)s.hasOwnProperty(D)&&uo(r,D,s[D])}function js(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ba=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function wn(r){return ba.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function wa(){}var od=null;function Yc(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var gr=null,rr=null;function zi(r){var s=fs(r);if(s&&(r=s.stateNode)){var d=r[Rt]||null;e:switch(r=s.stateNode,s.type){case"input":if(qa(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+xi(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var _=d[s];if(_!==r&&_.form===r.form){var A=_[Rt]||null;if(!A)throw Error(S(90));qa(_,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(s=0;s<d.length;s++)_=d[s],_.form===r.form&&Xn(_)}break e;case"textarea":Ju(r,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&Sr(r,!!d.multiple,s,!1)}}}var un=!1;function fi(r,s,d){if(un)return r(s,d);un=!0;try{var _=r(s);return _}finally{if(un=!1,(gr!==null||rr!==null)&&(qd(),gr&&(s=gr,r=rr,rr=gr=null,zi(s),r)))for(s=0;s<r.length;s++)zi(r[s])}}function $a(r,s){var d=r.stateNode;if(d===null)return null;var _=d[Rt]||null;if(_===null)return null;d=_[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(r=r.type,_=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!_;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(S(231,s,typeof d));return d}var Vi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yr=!1;if(Vi)try{var yr={};Object.defineProperty(yr,"passive",{get:function(){Yr=!0}}),window.addEventListener("test",yr,yr),window.removeEventListener("test",yr,yr)}catch{Yr=!1}var Sa=null,Os=null,ki=null;function No(){if(ki)return ki;var r,s=Os,d=s.length,_,A="value"in Sa?Sa.value:Sa.textContent,D=A.length;for(r=0;r<d&&s[r]===A[r];r++);var q=d-r;for(_=1;_<=q&&s[d-_]===A[D-_];_++);return ki=A.slice(r,1<_?1-_:void 0)}function Ta(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function pl(){return!0}function Kr(){return!1}function dr(r){function s(d,_,A,D,q){this._reactName=d,this._targetInst=A,this.type=_,this.nativeEvent=D,this.target=q,this.currentTarget=null;for(var re in r)r.hasOwnProperty(re)&&(d=r[re],this[re]=d?d(D):D[re]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?pl:Kr,this.isPropagationStopped=Kr,this}return ne(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=pl)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=pl)},persist:function(){},isPersistent:pl}),s}var Wr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kc=dr(Wr),ml=ne({},Wr,{view:0,detail:0}),gl=dr(ml),li,jo,Dn,Sn=ne({},ml,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jc,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Dn&&(Dn&&r.type==="mousemove"?(li=r.screenX-Dn.screenX,jo=r.screenY-Dn.screenY):jo=li=0,Dn=r),li)},movementY:function(r){return"movementY"in r?r.movementY:jo}}),yl=dr(Sn),Un=ne({},Sn,{dataTransfer:0}),Wc=dr(Un),Ha=ne({},ml,{relatedTarget:0}),Oo=dr(Ha),Bo=ne({},Wr,{animationName:0,elapsedTime:0,pseudoElement:0}),Af=dr(Bo),Qc=ne({},Wr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),ld=dr(Qc),nm=ne({},Wr,{data:0}),cd=dr(nm),Qr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _l(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=Pi[r])?!!s[r]:!1}function Jc(){return _l}var eu=ne({},ml,{key:function(r){if(r.key){var s=Qr[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=Ta(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Bs[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jc,charCode:function(r){return r.type==="keypress"?Ta(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ta(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),qi=dr(eu),zf=ne({},Sn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),eh=dr(zf),kf=ne({},ml,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jc}),im=dr(kf),nc=ne({},Wr,{propertyName:0,elapsedTime:0,pseudoElement:0}),th=dr(nc),ic=ne({},Sn,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ud=dr(ic),tu=ne({},Wr,{newState:0,oldState:0}),rc=dr(tu),ac=[9,13,27,32],Qi=Vi&&"CompositionEvent"in window,sc=null;Vi&&"documentMode"in document&&(sc=document.documentMode);var oc=Vi&&"TextEvent"in window&&!sc,lc=Vi&&(!Qi||sc&&8<sc&&11>=sc),Fo=" ",Pf=!1;function nu(r,s){switch(r){case"keyup":return ac.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Df(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ys=!1;function nh(r,s){switch(r){case"compositionend":return Df(s);case"keypress":return s.which!==32?null:(Pf=!0,Fo);case"textInput":return r=s.data,r===Fo&&Pf?null:r;default:return null}}function If(r,s){if(ys)return r==="compositionend"||!Qi&&nu(r,s)?(r=No(),ki=Os=Sa=null,ys=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return lc&&s.locale!=="ko"?null:s.data;default:return null}}var Rf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ih(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Rf[r.type]:s==="textarea"}function rh(r,s,d,_){gr?rr?rr.push(_):rr=[_]:gr=_,s=Zd(s,"onChange"),0<s.length&&(d=new Kc("onChange","change",null,d,_),r.push({event:d,listeners:s}))}var xl=null,cc=null;function Lf(r){ey(r,0)}function iu(r){var s=ia(r);if(Xn(s))return r}function Uo(r,s){if(r==="change")return s}var hd=!1;if(Vi){var ru;if(Vi){var Vo="oninput"in document;if(!Vo){var dd=document.createElement("div");dd.setAttribute("oninput","return;"),Vo=typeof dd.oninput=="function"}ru=Vo}else ru=!1;hd=ru&&(!document.documentMode||9<document.documentMode)}function au(){xl&&(xl.detachEvent("onpropertychange",Nf),cc=xl=null)}function Nf(r){if(r.propertyName==="value"&&iu(cc)){var s=[];rh(s,cc,r,Yc(r)),fi(Lf,s)}}function rm(r,s,d){r==="focusin"?(au(),xl=s,cc=d,xl.attachEvent("onpropertychange",Nf)):r==="focusout"&&au()}function jf(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return iu(cc)}function su(r,s){if(r==="click")return iu(s)}function Of(r,s){if(r==="input"||r==="change")return iu(s)}function fd(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var ra=typeof Object.is=="function"?Object.is:fd;function qo(r,s){if(ra(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),_=Object.keys(s);if(d.length!==_.length)return!1;for(_=0;_<d.length;_++){var A=d[_];if(!Rn.call(s,A)||!ra(r[A],s[A]))return!1}return!0}function Za(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function ou(r,s){var d=Za(r);r=0;for(var _;d;){if(d.nodeType===3){if(_=r+d.textContent.length,r<=s&&_>=s)return{node:d,offset:s-r};r=_}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Za(d)}}function ah(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?ah(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function sh(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Yn(r.document);s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=Yn(r.document)}return s}function lu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var oh=Vi&&"documentMode"in document&&11>=document.documentMode,Xa=null,cu=null,uu=null,lh=!1;function Bf(r,s,d){var _=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;lh||Xa==null||Xa!==Yn(_)||(_=Xa,"selectionStart"in _&&lu(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),uu&&qo(uu,_)||(uu=_,_=Zd(cu,"onSelect"),0<_.length&&(s=new Kc("onSelect","select",null,s,d),r.push({event:s,listeners:_}),s.target=Xa)))}function vl(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var bl={animationend:vl("Animation","AnimationEnd"),animationiteration:vl("Animation","AnimationIteration"),animationstart:vl("Animation","AnimationStart"),transitionrun:vl("Transition","TransitionRun"),transitionstart:vl("Transition","TransitionStart"),transitioncancel:vl("Transition","TransitionCancel"),transitionend:vl("Transition","TransitionEnd")},pd={},Kn={};Vi&&(Kn=document.createElement("div").style,"AnimationEvent"in window||(delete bl.animationend.animation,delete bl.animationiteration.animation,delete bl.animationstart.animation),"TransitionEvent"in window||delete bl.transitionend.transition);function Fs(r){if(pd[r])return pd[r];if(!bl[r])return r;var s=bl[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in Kn)return pd[r]=s[d];return r}var hu=Fs("animationend"),du=Fs("animationiteration"),ch=Fs("animationstart"),wl=Fs("transitionrun"),fu=Fs("transitionstart"),uc=Fs("transitioncancel"),Ea=Fs("transitionend"),md=new Map,uh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");uh.push("scrollEnd");function Ma(r,s){md.set(r,s),On(s,[r])}var Us=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Jr=[],ho=0,Sl=0;function Tl(){for(var r=ho,s=Sl=ho=0;s<r;){var d=Jr[s];Jr[s++]=null;var _=Jr[s];Jr[s++]=null;var A=Jr[s];Jr[s++]=null;var D=Jr[s];if(Jr[s++]=null,_!==null&&A!==null){var q=_.pending;q===null?A.next=A:(A.next=q.next,q.next=A),_.pending=A}D!==0&&gd(d,A,D)}}function pu(r,s,d,_){Jr[ho++]=r,Jr[ho++]=s,Jr[ho++]=d,Jr[ho++]=_,Sl|=_,r.lanes|=_,r=r.alternate,r!==null&&(r.lanes|=_)}function Go(r,s,d,_){return pu(r,s,d,_),hc(r)}function Ya(r,s){return pu(r,null,null,s),hc(r)}function gd(r,s,d){r.lanes|=d;var _=r.alternate;_!==null&&(_.lanes|=d);for(var A=!1,D=r.return;D!==null;)D.childLanes|=d,_=D.alternate,_!==null&&(_.childLanes|=d),D.tag===22&&(r=D.stateNode,r===null||r._visibility&1||(A=!0)),r=D,D=D.return;return r.tag===3?(D=r.stateNode,A&&s!==null&&(A=31-Je(d),r=D.hiddenUpdates,_=r[A],_===null?r[A]=[s]:_.push(s),s.lane=d|536870912),D):null}function hc(r){if(50<Vd)throw Vd=0,wm=null,Error(S(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Tn={};function hh(r,s,d,_){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ca(r,s,d,_){return new hh(r,s,d,_)}function dh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Aa(r,s){var d=r.alternate;return d===null?(d=Ca(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function Ff(r,s){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,s=d.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function fh(r,s,d,_,A,D){var q=0;if(_=r,typeof r=="function")dh(r)&&(q=1);else if(typeof r=="string")q=Ip(r,d,It.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case it:return r=Ca(31,d,s,A),r.elementType=it,r.lanes=D,r;case he:return $o(d.children,A,D,s);case te:q=8,A|=24;break;case ve:return r=Ca(12,d,s,A|2),r.elementType=ve,r.lanes=D,r;case Et:return r=Ca(13,d,s,A),r.elementType=Et,r.lanes=D,r;case St:return r=Ca(19,d,s,A),r.elementType=St,r.lanes=D,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case lt:q=10;break e;case qe:q=9;break e;case Pt:q=11;break e;case nt:q=14;break e;case Be:q=16,_=null;break e}q=29,d=Error(S(130,r===null?"null":typeof r,"")),_=null}return s=Ca(q,d,s,A),s.elementType=r,s.type=_,s.lanes=D,s}function $o(r,s,d,_){return r=Ca(7,r,_,s),r.lanes=d,r}function yd(r,s,d){return r=Ca(6,r,null,s),r.lanes=d,r}function ph(r){var s=Ca(18,null,null,0);return s.stateNode=r,s}function Ho(r,s,d){return s=Ca(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var dc=new WeakMap;function ea(r,s){if(typeof r=="object"&&r!==null){var d=dc.get(r);return d!==void 0?d:(s={value:r,source:s,stack:gn(s)},dc.set(r,s),s)}return{value:r,source:s,stack:gn(s)}}var Zo=[],Xo=0,El=null,Yo=0,_r=[],Tr=0,Vs=null,qs=1,aa="";function fo(r,s){Zo[Xo++]=Yo,Zo[Xo++]=El,El=r,Yo=s}function _d(r,s,d){_r[Tr++]=qs,_r[Tr++]=aa,_r[Tr++]=Vs,Vs=r;var _=qs;r=aa;var A=32-Je(_)-1;_&=~(1<<A),d+=1;var D=32-Je(s)+A;if(30<D){var q=A-A%5;D=(_&(1<<q)-1).toString(32),_>>=q,A-=q,qs=1<<32-Je(s)+A|d<<A|_,aa=D+r}else qs=1<<D|d<<A|_,aa=r}function Ml(r){r.return!==null&&(fo(r,1),_d(r,1,0))}function fc(r){for(;r===El;)El=Zo[--Xo],Zo[Xo]=null,Yo=Zo[--Xo],Zo[Xo]=null;for(;r===Vs;)Vs=_r[--Tr],_r[Tr]=null,aa=_r[--Tr],_r[Tr]=null,qs=_r[--Tr],_r[Tr]=null}function xd(r,s){_r[Tr++]=qs,_r[Tr++]=aa,_r[Tr++]=Vs,qs=s.id,aa=s.overflow,Vs=r}var Er=null,pi=null,Bn=!1,po=null,za=!1,Ni=Error(S(519));function sa(r){var s=Error(S(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw mo(ea(s,r)),Ni}function oa(r){var s=r.stateNode,d=r.type,_=r.memoizedProps;switch(s[Jn]=r,s[Rt]=_,d){case"dialog":Hn("cancel",s),Hn("close",s);break;case"iframe":case"object":case"embed":Hn("load",s);break;case"video":case"audio":for(d=0;d<Ac.length;d++)Hn(Ac[d],s);break;case"source":Hn("error",s);break;case"img":case"image":case"link":Hn("error",s),Hn("load",s);break;case"details":Hn("toggle",s);break;case"input":Hn("invalid",s),fl(s,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":Hn("invalid",s);break;case"textarea":Hn("invalid",s),Ns(s,_.value,_.defaultValue,_.children)}d=_.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||_.suppressHydrationWarning===!0||Nm(s.textContent,d)?(_.popover!=null&&(Hn("beforetoggle",s),Hn("toggle",s)),_.onScroll!=null&&Hn("scroll",s),_.onScrollEnd!=null&&Hn("scrollend",s),_.onClick!=null&&(s.onclick=wa),s=!0):s=!1,s||sa(r,!0)}function mu(r){for(Er=r.return;Er;)switch(Er.tag){case 5:case 31:case 13:za=!1;return;case 27:case 3:za=!0;return;default:Er=Er.return}}function Gs(r){if(r!==Er)return!1;if(!Bn)return mu(r),Bn=!0,!1;var s=r.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||Mp(r.type,r.memoizedProps)),d=!d),d&&pi&&sa(r),mu(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));pi=Ir(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));pi=Ir(r)}else s===27?(s=pi,Pc(r.type)?(r=ja,ja=null,pi=r):pi=s):pi=Er?zs(r.stateNode.nextSibling):null;return!0}function $s(){pi=Er=null,Bn=!1}function Hs(){var r=po;return r!==null&&(as===null?as=r:as.push.apply(as,r),po=null),r}function mo(r){po===null?po=[r]:po.push(r)}var go=de(null),Ka=null,Zs=null;function yo(r,s,d){_t(go,s._currentValue),s._currentValue=d}function Xs(r){r._currentValue=go.current,He(go)}function mh(r,s,d){for(;r!==null;){var _=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,_!==null&&(_.childLanes|=s)):_!==null&&(_.childLanes&s)!==s&&(_.childLanes|=s),r===d)break;r=r.return}}function gh(r,s,d,_){var A=r.child;for(A!==null&&(A.return=r);A!==null;){var D=A.dependencies;if(D!==null){var q=A.child;D=D.firstContext;e:for(;D!==null;){var re=D;D=A;for(var Pe=0;Pe<s.length;Pe++)if(re.context===s[Pe]){D.lanes|=d,re=D.alternate,re!==null&&(re.lanes|=d),mh(D.return,d,r),_||(q=null);break e}D=re.next}}else if(A.tag===18){if(q=A.return,q===null)throw Error(S(341));q.lanes|=d,D=q.alternate,D!==null&&(D.lanes|=d),mh(q,d,r),q=null}else q=A.child;if(q!==null)q.return=A;else for(q=A;q!==null;){if(q===r){q=null;break}if(A=q.sibling,A!==null){A.return=q.return,q=A;break}q=q.return}A=q}}function ka(r,s,d,_){r=null;for(var A=s,D=!1;A!==null;){if(!D){if((A.flags&524288)!==0)D=!0;else if((A.flags&262144)!==0)break}if(A.tag===10){var q=A.alternate;if(q===null)throw Error(S(387));if(q=q.memoizedProps,q!==null){var re=A.type;ra(A.pendingProps.value,q.value)||(r!==null?r.push(re):r=[re])}}else if(A===jt.current){if(q=A.alternate,q===null)throw Error(S(387));q.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(r!==null?r.push(Hh):r=[Hh])}A=A.return}r!==null&&gh(s,r,d,_),s.flags|=262144}function pc(r){for(r=r.firstContext;r!==null;){if(!ra(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function _o(r){Ka=r,Zs=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function ar(r){return yh(Ka,r)}function gu(r,s){return Ka===null&&_o(r),yh(r,s)}function yh(r,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},Zs===null){if(r===null)throw Error(S(308));Zs=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Zs=Zs.next=s;return d}var vd=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(d,_){r.push(_)}};this.abort=function(){s.aborted=!0,r.forEach(function(d){return d()})}},Uf=u.unstable_scheduleCallback,bd=u.unstable_NormalPriority,Ji={$$typeof:lt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ys(){return{controller:new vd,data:new Map,refCount:0}}function mc(r){r.refCount--,r.refCount===0&&Uf(bd,function(){r.controller.abort()})}var Ur=null,Pa=0,Cl=0,Vr=null;function am(r,s){if(Ur===null){var d=Ur=[];Pa=0,Cl=Pm(),Vr={status:"pending",value:void 0,then:function(_){d.push(_)}}}return Pa++,s.then(gc,gc),s}function gc(){if(--Pa===0&&Ur!==null){Vr!==null&&(Vr.status="fulfilled");var r=Ur;Ur=null,Cl=0,Vr=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function yu(r,s){var d=[],_={status:"pending",value:null,reason:null,then:function(A){d.push(A)}};return r.then(function(){_.status="fulfilled",_.value=s;for(var A=0;A<d.length;A++)(0,d[A])(s)},function(A){for(_.status="rejected",_.reason=A,A=0;A<d.length;A++)(0,d[A])(void 0)}),_}var xr=le.S;le.S=function(r,s){jg=kn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&am(r,s),xr!==null&&xr(r,s)};var _s=de(null);function _h(){var r=_s.current;return r!==null?r:Ri.pooledCache}function xh(r,s){s===null?_t(_s,_s.current):_t(_s,s.pool)}function Vf(){var r=_h();return r===null?null:{parent:Ji._currentValue,pool:r}}var xs=Error(S(460)),Ko=Error(S(474)),la=Error(S(542)),Zt={then:function(){}};function _u(r){return r=r.status,r==="fulfilled"||r==="rejected"}function vh(r,s,d){switch(d=r[d],d===void 0?r.push(s):d!==s&&(s.then(wa,wa),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,bh(r),r;default:if(typeof s.status=="string")s.then(wa,wa);else{if(r=Ri,r!==null&&100<r.shellSuspendCounter)throw Error(S(482));r=s,r.status="pending",r.then(function(_){if(s.status==="pending"){var A=s;A.status="fulfilled",A.value=_}},function(_){if(s.status==="pending"){var A=s;A.status="rejected",A.reason=_}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,bh(r),r}throw vs=s,xs}}function Wa(r){try{var s=r._init;return s(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(vs=d,xs):d}}var vs=null;function yc(){if(vs===null)throw Error(S(459));var r=vs;return vs=null,r}function bh(r){if(r===xs||r===la)throw Error(S(483))}var Ks=null,Al=0;function xu(r){var s=Al;return Al+=1,Ks===null&&(Ks=[]),vh(Ks,r,s)}function Ws(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function wh(r,s){throw s.$$typeof===ze?Error(S(525)):(r=Object.prototype.toString.call(s),Error(S(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function vu(r){function s(Ge,Ne){if(r){var at=Ge.deletions;at===null?(Ge.deletions=[Ne],Ge.flags|=16):at.push(Ne)}}function d(Ge,Ne){if(!r)return null;for(;Ne!==null;)s(Ge,Ne),Ne=Ne.sibling;return null}function _(Ge){for(var Ne=new Map;Ge!==null;)Ge.key!==null?Ne.set(Ge.key,Ge):Ne.set(Ge.index,Ge),Ge=Ge.sibling;return Ne}function A(Ge,Ne){return Ge=Aa(Ge,Ne),Ge.index=0,Ge.sibling=null,Ge}function D(Ge,Ne,at){return Ge.index=at,r?(at=Ge.alternate,at!==null?(at=at.index,at<Ne?(Ge.flags|=67108866,Ne):at):(Ge.flags|=67108866,Ne)):(Ge.flags|=1048576,Ne)}function q(Ge){return r&&Ge.alternate===null&&(Ge.flags|=67108866),Ge}function re(Ge,Ne,at,Mt){return Ne===null||Ne.tag!==6?(Ne=yd(at,Ge.mode,Mt),Ne.return=Ge,Ne):(Ne=A(Ne,at),Ne.return=Ge,Ne)}function Pe(Ge,Ne,at,Mt){var fn=at.type;return fn===he?vt(Ge,Ne,at.props.children,Mt,at.key):Ne!==null&&(Ne.elementType===fn||typeof fn=="object"&&fn!==null&&fn.$$typeof===Be&&Wa(fn)===Ne.type)?(Ne=A(Ne,at.props),Ws(Ne,at),Ne.return=Ge,Ne):(Ne=fh(at.type,at.key,at.props,null,Ge.mode,Mt),Ws(Ne,at),Ne.return=Ge,Ne)}function ot(Ge,Ne,at,Mt){return Ne===null||Ne.tag!==4||Ne.stateNode.containerInfo!==at.containerInfo||Ne.stateNode.implementation!==at.implementation?(Ne=Ho(at,Ge.mode,Mt),Ne.return=Ge,Ne):(Ne=A(Ne,at.children||[]),Ne.return=Ge,Ne)}function vt(Ge,Ne,at,Mt,fn){return Ne===null||Ne.tag!==7?(Ne=$o(at,Ge.mode,Mt,fn),Ne.return=Ge,Ne):(Ne=A(Ne,at),Ne.return=Ge,Ne)}function At(Ge,Ne,at){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return Ne=yd(""+Ne,Ge.mode,at),Ne.return=Ge,Ne;if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case Ce:return at=fh(Ne.type,Ne.key,Ne.props,null,Ge.mode,at),Ws(at,Ne),at.return=Ge,at;case be:return Ne=Ho(Ne,Ge.mode,at),Ne.return=Ge,Ne;case Be:return Ne=Wa(Ne),At(Ge,Ne,at)}if(Ie(Ne)||Qe(Ne))return Ne=$o(Ne,Ge.mode,at,null),Ne.return=Ge,Ne;if(typeof Ne.then=="function")return At(Ge,xu(Ne),at);if(Ne.$$typeof===lt)return At(Ge,gu(Ge,Ne),at);wh(Ge,Ne)}return null}function ct(Ge,Ne,at,Mt){var fn=Ne!==null?Ne.key:null;if(typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint")return fn!==null?null:re(Ge,Ne,""+at,Mt);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case Ce:return at.key===fn?Pe(Ge,Ne,at,Mt):null;case be:return at.key===fn?ot(Ge,Ne,at,Mt):null;case Be:return at=Wa(at),ct(Ge,Ne,at,Mt)}if(Ie(at)||Qe(at))return fn!==null?null:vt(Ge,Ne,at,Mt,null);if(typeof at.then=="function")return ct(Ge,Ne,xu(at),Mt);if(at.$$typeof===lt)return ct(Ge,Ne,gu(Ge,at),Mt);wh(Ge,at)}return null}function pt(Ge,Ne,at,Mt,fn){if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint")return Ge=Ge.get(at)||null,re(Ne,Ge,""+Mt,fn);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case Ce:return Ge=Ge.get(Mt.key===null?at:Mt.key)||null,Pe(Ne,Ge,Mt,fn);case be:return Ge=Ge.get(Mt.key===null?at:Mt.key)||null,ot(Ne,Ge,Mt,fn);case Be:return Mt=Wa(Mt),pt(Ge,Ne,at,Mt,fn)}if(Ie(Mt)||Qe(Mt))return Ge=Ge.get(at)||null,vt(Ne,Ge,Mt,fn,null);if(typeof Mt.then=="function")return pt(Ge,Ne,at,xu(Mt),fn);if(Mt.$$typeof===lt)return pt(Ge,Ne,at,gu(Ne,Mt),fn);wh(Ne,Mt)}return null}function an(Ge,Ne,at,Mt){for(var fn=null,hi=null,sn=Ne,cn=Ne=0,Vn=null;sn!==null&&cn<at.length;cn++){sn.index>cn?(Vn=sn,sn=null):Vn=sn.sibling;var si=ct(Ge,sn,at[cn],Mt);if(si===null){sn===null&&(sn=Vn);break}r&&sn&&si.alternate===null&&s(Ge,sn),Ne=D(si,Ne,cn),hi===null?fn=si:hi.sibling=si,hi=si,sn=Vn}if(cn===at.length)return d(Ge,sn),Bn&&fo(Ge,cn),fn;if(sn===null){for(;cn<at.length;cn++)sn=At(Ge,at[cn],Mt),sn!==null&&(Ne=D(sn,Ne,cn),hi===null?fn=sn:hi.sibling=sn,hi=sn);return Bn&&fo(Ge,cn),fn}for(sn=_(sn);cn<at.length;cn++)Vn=pt(sn,Ge,cn,at[cn],Mt),Vn!==null&&(r&&Vn.alternate!==null&&sn.delete(Vn.key===null?cn:Vn.key),Ne=D(Vn,Ne,cn),hi===null?fn=Vn:hi.sibling=Vn,hi=Vn);return r&&sn.forEach(function(Yl){return s(Ge,Yl)}),Bn&&fo(Ge,cn),fn}function mn(Ge,Ne,at,Mt){if(at==null)throw Error(S(151));for(var fn=null,hi=null,sn=Ne,cn=Ne=0,Vn=null,si=at.next();sn!==null&&!si.done;cn++,si=at.next()){sn.index>cn?(Vn=sn,sn=null):Vn=sn.sibling;var Yl=ct(Ge,sn,si.value,Mt);if(Yl===null){sn===null&&(sn=Vn);break}r&&sn&&Yl.alternate===null&&s(Ge,sn),Ne=D(Yl,Ne,cn),hi===null?fn=Yl:hi.sibling=Yl,hi=Yl,sn=Vn}if(si.done)return d(Ge,sn),Bn&&fo(Ge,cn),fn;if(sn===null){for(;!si.done;cn++,si=at.next())si=At(Ge,si.value,Mt),si!==null&&(Ne=D(si,Ne,cn),hi===null?fn=si:hi.sibling=si,hi=si);return Bn&&fo(Ge,cn),fn}for(sn=_(sn);!si.done;cn++,si=at.next())si=pt(sn,Ge,cn,si.value,Mt),si!==null&&(r&&si.alternate!==null&&sn.delete(si.key===null?cn:si.key),Ne=D(si,Ne,cn),hi===null?fn=si:hi.sibling=si,hi=si);return r&&sn.forEach(function(rg){return s(Ge,rg)}),Bn&&fo(Ge,cn),fn}function Si(Ge,Ne,at,Mt){if(typeof at=="object"&&at!==null&&at.type===he&&at.key===null&&(at=at.props.children),typeof at=="object"&&at!==null){switch(at.$$typeof){case Ce:e:{for(var fn=at.key;Ne!==null;){if(Ne.key===fn){if(fn=at.type,fn===he){if(Ne.tag===7){d(Ge,Ne.sibling),Mt=A(Ne,at.props.children),Mt.return=Ge,Ge=Mt;break e}}else if(Ne.elementType===fn||typeof fn=="object"&&fn!==null&&fn.$$typeof===Be&&Wa(fn)===Ne.type){d(Ge,Ne.sibling),Mt=A(Ne,at.props),Ws(Mt,at),Mt.return=Ge,Ge=Mt;break e}d(Ge,Ne);break}else s(Ge,Ne);Ne=Ne.sibling}at.type===he?(Mt=$o(at.props.children,Ge.mode,Mt,at.key),Mt.return=Ge,Ge=Mt):(Mt=fh(at.type,at.key,at.props,null,Ge.mode,Mt),Ws(Mt,at),Mt.return=Ge,Ge=Mt)}return q(Ge);case be:e:{for(fn=at.key;Ne!==null;){if(Ne.key===fn)if(Ne.tag===4&&Ne.stateNode.containerInfo===at.containerInfo&&Ne.stateNode.implementation===at.implementation){d(Ge,Ne.sibling),Mt=A(Ne,at.children||[]),Mt.return=Ge,Ge=Mt;break e}else{d(Ge,Ne);break}else s(Ge,Ne);Ne=Ne.sibling}Mt=Ho(at,Ge.mode,Mt),Mt.return=Ge,Ge=Mt}return q(Ge);case Be:return at=Wa(at),Si(Ge,Ne,at,Mt)}if(Ie(at))return an(Ge,Ne,at,Mt);if(Qe(at)){if(fn=Qe(at),typeof fn!="function")throw Error(S(150));return at=fn.call(at),mn(Ge,Ne,at,Mt)}if(typeof at.then=="function")return Si(Ge,Ne,xu(at),Mt);if(at.$$typeof===lt)return Si(Ge,Ne,gu(Ge,at),Mt);wh(Ge,at)}return typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint"?(at=""+at,Ne!==null&&Ne.tag===6?(d(Ge,Ne.sibling),Mt=A(Ne,at),Mt.return=Ge,Ge=Mt):(d(Ge,Ne),Mt=yd(at,Ge.mode,Mt),Mt.return=Ge,Ge=Mt),q(Ge)):d(Ge,Ne)}return function(Ge,Ne,at,Mt){try{Al=0;var fn=Si(Ge,Ne,at,Mt);return Ks=null,fn}catch(sn){if(sn===xs||sn===la)throw sn;var hi=Ca(29,sn,null,Ge.mode);return hi.lanes=Mt,hi.return=Ge,hi}}}var Qs=vu(!0),wd=vu(!1),Js=!1;function Sh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bu(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function eo(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function xo(r,s,d){var _=r.updateQueue;if(_===null)return null;if(_=_.shared,(yi&2)!==0){var A=_.pending;return A===null?s.next=s:(s.next=A.next,A.next=s),_.pending=s,s=hc(r),gd(r,null,d),s}return pu(r,_,s,d),hc(r)}function Qa(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,Ui(r,d)}}function ri(r,s){var d=r.updateQueue,_=r.alternate;if(_!==null&&(_=_.updateQueue,d===_)){var A=null,D=null;if(d=d.firstBaseUpdate,d!==null){do{var q={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};D===null?A=D=q:D=D.next=q,d=d.next}while(d!==null);D===null?A=D=s:D=D.next=s}else A=D=s;d={baseState:_.baseState,firstBaseUpdate:A,lastBaseUpdate:D,shared:_.shared,callbacks:_.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}var Sd=!1;function vo(){if(Sd){var r=Vr;if(r!==null)throw r}}function Wo(r,s,d,_){Sd=!1;var A=r.updateQueue;Js=!1;var D=A.firstBaseUpdate,q=A.lastBaseUpdate,re=A.shared.pending;if(re!==null){A.shared.pending=null;var Pe=re,ot=Pe.next;Pe.next=null,q===null?D=ot:q.next=ot,q=Pe;var vt=r.alternate;vt!==null&&(vt=vt.updateQueue,re=vt.lastBaseUpdate,re!==q&&(re===null?vt.firstBaseUpdate=ot:re.next=ot,vt.lastBaseUpdate=Pe))}if(D!==null){var At=A.baseState;q=0,vt=ot=Pe=null,re=D;do{var ct=re.lane&-536870913,pt=ct!==re.lane;if(pt?($n&ct)===ct:(_&ct)===ct){ct!==0&&ct===Cl&&(Sd=!0),vt!==null&&(vt=vt.next={lane:0,tag:re.tag,payload:re.payload,callback:null,next:null});e:{var an=r,mn=re;ct=s;var Si=d;switch(mn.tag){case 1:if(an=mn.payload,typeof an=="function"){At=an.call(Si,At,ct);break e}At=an;break e;case 3:an.flags=an.flags&-65537|128;case 0:if(an=mn.payload,ct=typeof an=="function"?an.call(Si,At,ct):an,ct==null)break e;At=ne({},At,ct);break e;case 2:Js=!0}}ct=re.callback,ct!==null&&(r.flags|=64,pt&&(r.flags|=8192),pt=A.callbacks,pt===null?A.callbacks=[ct]:pt.push(ct))}else pt={lane:ct,tag:re.tag,payload:re.payload,callback:re.callback,next:null},vt===null?(ot=vt=pt,Pe=At):vt=vt.next=pt,q|=ct;if(re=re.next,re===null){if(re=A.shared.pending,re===null)break;pt=re,re=pt.next,pt.next=null,A.lastBaseUpdate=pt,A.shared.pending=null}}while(!0);vt===null&&(Pe=At),A.baseState=Pe,A.firstBaseUpdate=ot,A.lastBaseUpdate=vt,D===null&&(A.shared.lanes=0),Vl|=q,r.lanes=q,r.memoizedState=At}}function wu(r,s){if(typeof r!="function")throw Error(S(191,r));r.call(s)}function Th(r,s){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)wu(d[r],s)}var zl=de(null),Su=de(0);function Td(r,s){r=Ul,_t(Su,r),_t(zl,s),Ul=r|s.baseLanes}function Da(){_t(Su,Ul),_t(zl,zl.current)}function kl(){Ul=Su.current,He(zl),He(Su)}var Yt=de(null),nn=null;function Ja(r){var s=r.alternate;_t(Gi,Gi.current&1),_t(Yt,r),nn===null&&(s===null||zl.current!==null||s.memoizedState!==null)&&(nn=r)}function _c(r){_t(Gi,Gi.current),_t(Yt,r),nn===null&&(nn=r)}function Tu(r){r.tag===22?(_t(Gi,Gi.current),_t(Yt,r),nn===null&&(nn=r)):er()}function er(){_t(Gi,Gi.current),_t(Yt,Yt.current)}function ji(r){He(Yt),nn===r&&(nn=null),He(Gi)}var Gi=de(0);function Eu(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||da(d)||pr(d)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var bo=0,zn=null,ti=null,An=null,Di=!1,es=!1,bs=!1,Pl=0,Dl=0,wo=null,Ed=0;function Ei(){throw Error(S(321))}function ws(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!ra(r[d],s[d]))return!1;return!0}function xc(r,s,d,_,A,D){return bo=D,zn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,le.H=r===null||r.memoizedState===null?gi:sr,bs=!1,D=d(_,A),bs=!1,es&&(D=Mu(s,d,_,A)),vc(r),D}function vc(r){le.H=ai;var s=ti!==null&&ti.next!==null;if(bo=0,An=ti=zn=null,Di=!1,Dl=0,wo=null,s)throw Error(S(300));r===null||Ar||(r=r.dependencies,r!==null&&pc(r)&&(Ar=!0))}function Mu(r,s,d,_){zn=r;var A=0;do{if(es&&(wo=null),Dl=0,es=!1,25<=A)throw Error(S(301));if(A+=1,An=ti=null,r.updateQueue!=null){var D=r.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}le.H=fr,D=s(d,_)}while(es);return D}function Cu(){var r=le.H,s=r.useState()[0];return s=typeof s.then=="function"?Il(s):s,r=r.useState()[0],(ti!==null?ti.memoizedState:null)!==r&&(zn.flags|=1024),s}function Au(){var r=Pl!==0;return Pl=0,r}function Qo(r,s,d){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~d}function So(r){if(Di){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Di=!1}bo=0,An=ti=zn=null,es=!1,Dl=Pl=0,wo=null}function Nr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return An===null?zn.memoizedState=An=r:An=An.next=r,An}function Ii(){if(ti===null){var r=zn.alternate;r=r!==null?r.memoizedState:null}else r=ti.next;var s=An===null?zn.memoizedState:An.next;if(s!==null)An=s,ti=r;else{if(r===null)throw zn.alternate===null?Error(S(467)):Error(S(310));ti=r,r={memoizedState:ti.memoizedState,baseState:ti.baseState,baseQueue:ti.baseQueue,queue:ti.queue,next:null},An===null?zn.memoizedState=An=r:An=An.next=r}return An}function to(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Il(r){var s=Dl;return Dl+=1,wo===null&&(wo=[]),r=vh(wo,r,s),s=zn,(An===null?s.memoizedState:An.next)===null&&(s=s.alternate,le.H=s===null||s.memoizedState===null?gi:sr),r}function Rl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Il(r);if(r.$$typeof===lt)return ar(r)}throw Error(S(438,String(r)))}function bc(r){var s=null,d=zn.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var _=zn.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(s={data:_.data.map(function(A){return A.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=to(),zn.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(r),_=0;_<r;_++)d[_]=$e;return s.index++,d}function Ss(r,s){return typeof s=="function"?s(r):s}function y(r){var s=Ii();return t(s,ti,r)}function t(r,s,d){var _=r.queue;if(_===null)throw Error(S(311));_.lastRenderedReducer=d;var A=r.baseQueue,D=_.pending;if(D!==null){if(A!==null){var q=A.next;A.next=D.next,D.next=q}s.baseQueue=A=D,_.pending=null}if(D=r.baseState,A===null)r.memoizedState=D;else{s=A.next;var re=q=null,Pe=null,ot=s,vt=!1;do{var At=ot.lane&-536870913;if(At!==ot.lane?($n&At)===At:(bo&At)===At){var ct=ot.revertLane;if(ct===0)Pe!==null&&(Pe=Pe.next={lane:0,revertLane:0,gesture:null,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),At===Cl&&(vt=!0);else if((bo&ct)===ct){ot=ot.next,ct===Cl&&(vt=!0);continue}else At={lane:0,revertLane:ot.revertLane,gesture:null,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},Pe===null?(re=Pe=At,q=D):Pe=Pe.next=At,zn.lanes|=ct,Vl|=ct;At=ot.action,bs&&d(D,At),D=ot.hasEagerState?ot.eagerState:d(D,At)}else ct={lane:At,revertLane:ot.revertLane,gesture:ot.gesture,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null},Pe===null?(re=Pe=ct,q=D):Pe=Pe.next=ct,zn.lanes|=At,Vl|=At;ot=ot.next}while(ot!==null&&ot!==s);if(Pe===null?q=D:Pe.next=re,!ra(D,r.memoizedState)&&(Ar=!0,vt&&(d=Vr,d!==null)))throw d;r.memoizedState=D,r.baseState=q,r.baseQueue=Pe,_.lastRenderedState=D}return A===null&&(_.lanes=0),[r.memoizedState,_.dispatch]}function a(r){var s=Ii(),d=s.queue;if(d===null)throw Error(S(311));d.lastRenderedReducer=r;var _=d.dispatch,A=d.pending,D=s.memoizedState;if(A!==null){d.pending=null;var q=A=A.next;do D=r(D,q.action),q=q.next;while(q!==A);ra(D,s.memoizedState)||(Ar=!0),s.memoizedState=D,s.baseQueue===null&&(s.baseState=D),d.lastRenderedState=D}return[D,_]}function c(r,s,d){var _=zn,A=Ii(),D=Bn;if(D){if(d===void 0)throw Error(S(407));d=d()}else d=s();var q=!ra((ti||A).memoizedState,d);if(q&&(A.memoizedState=d,Ar=!0),A=A.queue,tt(w.bind(null,_,A,r),[r]),A.getSnapshot!==s||q||An!==null&&An.memoizedState.tag&1){if(_.flags|=2048,_e(9,{destroy:void 0},x.bind(null,_,A,d,s),null),Ri===null)throw Error(S(349));D||(bo&127)!==0||f(_,s,d)}return d}function f(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=zn.updateQueue,s===null?(s=to(),zn.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function x(r,s,d,_){s.value=d,s.getSnapshot=_,C(s)&&P(r)}function w(r,s,d){return d(function(){C(s)&&P(r)})}function C(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!ra(r,d)}catch{return!0}}function P(r){var s=Ya(r,2);s!==null&&os(s,r,2)}function L(r){var s=Nr();if(typeof r=="function"){var d=r;if(r=d(),bs){Oe(!0);try{d()}finally{Oe(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:r},s}function j(r,s,d,_){return r.baseState=d,t(r,ti,typeof _=="function"?_:Ss)}function V(r,s,d,_,A){if(Ia(r))throw Error(S(485));if(r=s.action,r!==null){var D={payload:A,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){D.listeners.push(q)}};le.T!==null?d(!0):D.isTransition=!1,_(D),d=s.pending,d===null?(D.next=s.pending=D,U(s,D)):(D.next=d.next,s.pending=d.next=D)}}function U(r,s){var d=s.action,_=s.payload,A=r.state;if(s.isTransition){var D=le.T,q={};le.T=q;try{var re=d(A,_),Pe=le.S;Pe!==null&&Pe(q,re),Z(r,s,re)}catch(ot){se(r,s,ot)}finally{D!==null&&q.types!==null&&(D.types=q.types),le.T=D}}else try{D=d(A,_),Z(r,s,D)}catch(ot){se(r,s,ot)}}function Z(r,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(_){Q(r,s,_)},function(_){return se(r,s,_)}):Q(r,s,d)}function Q(r,s,d){s.status="fulfilled",s.value=d,ce(s),r.state=d,s=r.pending,s!==null&&(d=s.next,d===s?r.pending=null:(d=d.next,s.next=d,U(r,d)))}function se(r,s,d){var _=r.pending;if(r.pending=null,_!==null){_=_.next;do s.status="rejected",s.reason=d,ce(s),s=s.next;while(s!==_)}r.action=null}function ce(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function oe(r,s){return s}function pe(r,s){if(Bn){var d=Ri.formState;if(d!==null){e:{var _=zn;if(Bn){if(pi){t:{for(var A=pi,D=za;A.nodeType!==8;){if(!D){A=null;break t}if(A=zs(A.nextSibling),A===null){A=null;break t}}D=A.data,A=D==="F!"||D==="F"?A:null}if(A){pi=zs(A.nextSibling),_=A.data==="F!";break e}}sa(_)}_=!1}_&&(s=d[0])}}return d=Nr(),d.memoizedState=d.baseState=s,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oe,lastRenderedState:s},d.queue=_,d=wc.bind(null,zn,_),_.dispatch=d,_=L(!1),D=ua.bind(null,zn,!1,_.queue),_=Nr(),A={state:s,dispatch:null,action:r,pending:null},_.queue=A,d=V.bind(null,zn,A,D,d),A.dispatch=d,_.memoizedState=r,[s,d,!1]}function Te(r){var s=Ii();return fe(s,ti,r)}function fe(r,s,d){if(s=t(r,s,oe)[0],r=y(Ss)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var _=Il(s)}catch(q){throw q===xs?la:q}else _=s;s=Ii();var A=s.queue,D=A.dispatch;return d!==s.memoizedState&&(zn.flags|=2048,_e(9,{destroy:void 0},Se.bind(null,A,d),null)),[_,D,r]}function Se(r,s){r.action=s}function Ae(r){var s=Ii(),d=ti;if(d!==null)return fe(s,d,r);Ii(),s=s.memoizedState,d=Ii();var _=d.queue.dispatch;return d.memoizedState=r,[s,_,!1]}function _e(r,s,d,_){return r={tag:r,create:d,deps:_,inst:s,next:null},s=zn.updateQueue,s===null&&(s=to(),zn.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=r.next=r:(_=d.next,d.next=r,r.next=_,s.lastEffect=r),r}function Re(){return Ii().memoizedState}function rt(r,s,d,_){var A=Nr();zn.flags|=r,A.memoizedState=_e(1|s,{destroy:void 0},d,_===void 0?null:_)}function Ke(r,s,d,_){var A=Ii();_=_===void 0?null:_;var D=A.memoizedState.inst;ti!==null&&_!==null&&ws(_,ti.memoizedState.deps)?A.memoizedState=_e(s,D,d,_):(zn.flags|=r,A.memoizedState=_e(1|s,D,d,_))}function et(r,s){rt(8390656,8,r,s)}function tt(r,s){Ke(2048,8,r,s)}function Lt(r){zn.flags|=4;var s=zn.updateQueue;if(s===null)s=to(),zn.updateQueue=s,s.events=[r];else{var d=s.events;d===null?s.events=[r]:d.push(r)}}function Nt(r){var s=Ii().memoizedState;return Lt({ref:s,nextImpl:r}),function(){if((yi&2)!==0)throw Error(S(440));return s.impl.apply(void 0,arguments)}}function wt(r,s){return Ke(4,2,r,s)}function Ft(r,s){return Ke(4,4,r,s)}function vn(r,s){if(typeof s=="function"){r=r();var d=s(r);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function ni(r,s,d){d=d!=null?d.concat([r]):null,Ke(4,4,vn.bind(null,s,r),d)}function vi(){}function mi(r,s){var d=Ii();s=s===void 0?null:s;var _=d.memoizedState;return s!==null&&ws(s,_[1])?_[0]:(d.memoizedState=[r,s],r)}function Mi(r,s){var d=Ii();s=s===void 0?null:s;var _=d.memoizedState;if(s!==null&&ws(s,_[1]))return _[0];if(_=r(),bs){Oe(!0);try{r()}finally{Oe(!1)}}return d.memoizedState=[_,s],_}function ci(r,s,d){return d===void 0||(bo&1073741824)!==0&&($n&261930)===0?r.memoizedState=s:(r.memoizedState=d,r=Bg(),zn.lanes|=r,Vl|=r,d)}function Oi(r,s,d,_){return ra(d,s)?d:zl.current!==null?(r=ci(r,d,_),ra(r,s)||(Ar=!0),r):(bo&42)===0||(bo&1073741824)!==0&&($n&261930)===0?(Ar=!0,r.memoizedState=d):(r=Bg(),zn.lanes|=r,Vl|=r,s)}function Ci(r,s,d,_,A){var D=ke.p;ke.p=D!==0&&8>D?D:8;var q=le.T,re={};le.T=re,ua(r,!1,s,d);try{var Pe=A(),ot=le.S;if(ot!==null&&ot(re,Pe),Pe!==null&&typeof Pe=="object"&&typeof Pe.then=="function"){var vt=yu(Pe,_);Es(r,s,vt,ss(r))}else Es(r,s,_,ss(r))}catch(At){Es(r,s,{then:function(){},status:"rejected",reason:At},ss())}finally{ke.p=D,q!==null&&re.types!==null&&(q.types=re.types),le.T=q}}function Mr(){}function $i(r,s,d,_){if(r.tag!==5)throw Error(S(476));var A=Hi(r).queue;Ci(r,A,s,De,d===null?Mr:function(){return Cr(r),d(_)})}function Hi(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:De,baseState:De,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:De},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:d},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function Cr(r){var s=Hi(r);s.next===null&&(s=r.alternate.memoizedState),Es(r,s.next.queue,{},ss())}function no(){return ar(Hh)}function io(){return Ii().memoizedState}function Ts(){return Ii().memoizedState}function ca(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var d=ss();r=eo(d);var _=xo(s,r,d);_!==null&&(os(_,s,d),Qa(_,s,d)),s={cache:Ys()},r.payload=s;return}s=s.return}}function Ll(r,s,d){var _=ss();d={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Ia(r)?ts(s,d):(d=Go(r,s,d,_),d!==null&&(os(d,r,_),ns(d,s,_)))}function wc(r,s,d){var _=ss();Es(r,s,d,_)}function Es(r,s,d,_){var A={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(Ia(r))ts(s,A);else{var D=r.alternate;if(r.lanes===0&&(D===null||D.lanes===0)&&(D=s.lastRenderedReducer,D!==null))try{var q=s.lastRenderedState,re=D(q,d);if(A.hasEagerState=!0,A.eagerState=re,ra(re,q))return pu(r,s,A,0),Ri===null&&Tl(),!1}catch{}if(d=Go(r,s,A,_),d!==null)return os(d,r,_),ns(d,s,_),!0}return!1}function ua(r,s,d,_){if(_={lane:2,revertLane:Pm(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},Ia(r)){if(s)throw Error(S(479))}else s=Go(r,d,_,2),s!==null&&os(s,r,2)}function Ia(r){var s=r.alternate;return r===zn||s!==null&&s===zn}function ts(r,s){es=Di=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function ns(r,s,d){if((d&4194048)!==0){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,Ui(r,d)}}var ai={readContext:ar,use:Rl,useCallback:Ei,useContext:Ei,useEffect:Ei,useImperativeHandle:Ei,useLayoutEffect:Ei,useInsertionEffect:Ei,useMemo:Ei,useReducer:Ei,useRef:Ei,useState:Ei,useDebugValue:Ei,useDeferredValue:Ei,useTransition:Ei,useSyncExternalStore:Ei,useId:Ei,useHostTransitionStatus:Ei,useFormState:Ei,useActionState:Ei,useOptimistic:Ei,useMemoCache:Ei,useCacheRefresh:Ei};ai.useEffectEvent=Ei;var gi={readContext:ar,use:Rl,useCallback:function(r,s){return Nr().memoizedState=[r,s===void 0?null:s],r},useContext:ar,useEffect:et,useImperativeHandle:function(r,s,d){d=d!=null?d.concat([r]):null,rt(4194308,4,vn.bind(null,s,r),d)},useLayoutEffect:function(r,s){return rt(4194308,4,r,s)},useInsertionEffect:function(r,s){rt(4,2,r,s)},useMemo:function(r,s){var d=Nr();s=s===void 0?null:s;var _=r();if(bs){Oe(!0);try{r()}finally{Oe(!1)}}return d.memoizedState=[_,s],_},useReducer:function(r,s,d){var _=Nr();if(d!==void 0){var A=d(s);if(bs){Oe(!0);try{d(s)}finally{Oe(!1)}}}else A=s;return _.memoizedState=_.baseState=A,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:A},_.queue=r,r=r.dispatch=Ll.bind(null,zn,r),[_.memoizedState,r]},useRef:function(r){var s=Nr();return r={current:r},s.memoizedState=r},useState:function(r){r=L(r);var s=r.queue,d=wc.bind(null,zn,s);return s.dispatch=d,[r.memoizedState,d]},useDebugValue:vi,useDeferredValue:function(r,s){var d=Nr();return ci(d,r,s)},useTransition:function(){var r=L(!1);return r=Ci.bind(null,zn,r.queue,!0,!1),Nr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,d){var _=zn,A=Nr();if(Bn){if(d===void 0)throw Error(S(407));d=d()}else{if(d=s(),Ri===null)throw Error(S(349));($n&127)!==0||f(_,s,d)}A.memoizedState=d;var D={value:d,getSnapshot:s};return A.queue=D,et(w.bind(null,_,D,r),[r]),_.flags|=2048,_e(9,{destroy:void 0},x.bind(null,_,D,d,s),null),d},useId:function(){var r=Nr(),s=Ri.identifierPrefix;if(Bn){var d=aa,_=qs;d=(_&~(1<<32-Je(_)-1)).toString(32)+d,s="_"+s+"R_"+d,d=Pl++,0<d&&(s+="H"+d.toString(32)),s+="_"}else d=Ed++,s="_"+s+"r_"+d.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:no,useFormState:pe,useActionState:pe,useOptimistic:function(r){var s=Nr();s.memoizedState=s.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=ua.bind(null,zn,!0,d),d.dispatch=s,[r,s]},useMemoCache:bc,useCacheRefresh:function(){return Nr().memoizedState=ca.bind(null,zn)},useEffectEvent:function(r){var s=Nr(),d={impl:r};return s.memoizedState=d,function(){if((yi&2)!==0)throw Error(S(440));return d.impl.apply(void 0,arguments)}}},sr={readContext:ar,use:Rl,useCallback:mi,useContext:ar,useEffect:tt,useImperativeHandle:ni,useInsertionEffect:wt,useLayoutEffect:Ft,useMemo:Mi,useReducer:y,useRef:Re,useState:function(){return y(Ss)},useDebugValue:vi,useDeferredValue:function(r,s){var d=Ii();return Oi(d,ti.memoizedState,r,s)},useTransition:function(){var r=y(Ss)[0],s=Ii().memoizedState;return[typeof r=="boolean"?r:Il(r),s]},useSyncExternalStore:c,useId:io,useHostTransitionStatus:no,useFormState:Te,useActionState:Te,useOptimistic:function(r,s){var d=Ii();return j(d,ti,r,s)},useMemoCache:bc,useCacheRefresh:Ts};sr.useEffectEvent=Nt;var fr={readContext:ar,use:Rl,useCallback:mi,useContext:ar,useEffect:tt,useImperativeHandle:ni,useInsertionEffect:wt,useLayoutEffect:Ft,useMemo:Mi,useReducer:a,useRef:Re,useState:function(){return a(Ss)},useDebugValue:vi,useDeferredValue:function(r,s){var d=Ii();return ti===null?ci(d,r,s):Oi(d,ti.memoizedState,r,s)},useTransition:function(){var r=a(Ss)[0],s=Ii().memoizedState;return[typeof r=="boolean"?r:Il(r),s]},useSyncExternalStore:c,useId:io,useHostTransitionStatus:no,useFormState:Ae,useActionState:Ae,useOptimistic:function(r,s){var d=Ii();return ti!==null?j(d,ti,r,s):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:bc,useCacheRefresh:Ts};fr.useEffectEvent=Nt;function Eh(r,s,d,_){s=r.memoizedState,d=d(_,s),d=d==null?s:ne({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Mh={enqueueSetState:function(r,s,d){r=r._reactInternals;var _=ss(),A=eo(_);A.payload=s,d!=null&&(A.callback=d),s=xo(r,A,_),s!==null&&(os(s,r,_),Qa(s,r,_))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var _=ss(),A=eo(_);A.tag=1,A.payload=s,d!=null&&(A.callback=d),s=xo(r,A,_),s!==null&&(os(s,r,_),Qa(s,r,_))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=ss(),_=eo(d);_.tag=2,s!=null&&(_.callback=s),s=xo(r,_,d),s!==null&&(os(s,r,d),Qa(s,r,d))}};function Jo(r,s,d,_,A,D,q){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(_,D,q):s.prototype&&s.prototype.isPureReactComponent?!qo(d,_)||!qo(A,D):!0}function qf(r,s,d,_){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,_),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,_),s.state!==r&&Mh.enqueueReplaceState(s,s.state,null)}function el(r,s){var d=s;if("ref"in s){d={};for(var _ in s)_!=="ref"&&(d[_]=s[_])}if(r=r.defaultProps){d===s&&(d=ne({},d));for(var A in r)d[A]===void 0&&(d[A]=r[A])}return d}function Ch(r){Us(r)}function To(r){console.error(r)}function Eo(r){Us(r)}function Ms(r,s){try{var d=r.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(_){setTimeout(function(){throw _})}}function Ah(r,s,d){try{var _=r.onCaughtError;_(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function zu(r,s,d){return d=eo(d),d.tag=3,d.payload={element:null},d.callback=function(){Ms(r,s)},d}function ku(r){return r=eo(r),r.tag=3,r}function Pu(r,s,d,_){var A=d.type.getDerivedStateFromError;if(typeof A=="function"){var D=_.value;r.payload=function(){return A(D)},r.callback=function(){Ah(s,d,_)}}var q=d.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(r.callback=function(){Ah(s,d,_),typeof A!="function"&&(ql===null?ql=new Set([this]):ql.add(this));var re=_.stack;this.componentDidCatch(_.value,{componentStack:re!==null?re:""})})}function Gf(r,s,d,_,A){if(d.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(s=d.alternate,s!==null&&ka(s,d,A,!0),d=Yt.current,d!==null){switch(d.tag){case 31:case 13:return nn===null?Gd():d.alternate===null&&or===0&&(or=3),d.flags&=-257,d.flags|=65536,d.lanes=A,_===Zt?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([_]):s.add(_),mp(r,_,A)),!1;case 22:return d.flags|=65536,_===Zt?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([_])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([_]):d.add(_)),mp(r,_,A)),!1}throw Error(S(435,d.tag))}return mp(r,_,A),Gd(),!1}if(Bn)return s=Yt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=A,_!==Ni&&(r=Error(S(422),{cause:_}),mo(ea(r,d)))):(_!==Ni&&(s=Error(S(423),{cause:_}),mo(ea(s,d))),r=r.current.alternate,r.flags|=65536,A&=-A,r.lanes|=A,_=ea(_,d),A=zu(r.stateNode,_,A),ri(r,A),or!==4&&(or=2)),!1;var D=Error(S(520),{cause:_});if(D=ea(D,d),Fd===null?Fd=[D]:Fd.push(D),or!==4&&(or=2),s===null)return!0;_=ea(_,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,r=A&-A,d.lanes|=r,r=zu(d.stateNode,_,r),ri(d,r),!1;case 1:if(s=d.type,D=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(ql===null||!ql.has(D))))return d.flags|=65536,A&=-A,d.lanes|=A,A=ku(A),Pu(A,r,d,_),ri(d,A),!1}d=d.return}while(d!==null);return!1}var $f=Error(S(461)),Ar=!1;function jr(r,s,d,_){s.child=r===null?wd(s,null,d,_):Qs(s,r.child,d,_)}function wg(r,s,d,_,A){d=d.render;var D=s.ref;if("ref"in _){var q={};for(var re in _)re!=="ref"&&(q[re]=_[re])}else q=_;return _o(s),_=xc(r,s,d,q,D,A),re=Au(),r!==null&&!Ar?(Qo(r,s,A),nl(r,s,A)):(Bn&&re&&Ml(s),s.flags|=1,jr(r,s,_,A),s.child)}function Hf(r,s,d,_,A){if(r===null){var D=d.type;return typeof D=="function"&&!dh(D)&&D.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=D,sm(r,s,D,_,A)):(r=fh(d.type,null,_,s,s.mode,A),r.ref=s.ref,r.return=s,s.child=r)}if(D=r.child,!Ad(r,A)){var q=D.memoizedProps;if(d=d.compare,d=d!==null?d:qo,d(q,_)&&r.ref===s.ref)return nl(r,s,A)}return s.flags|=1,r=Aa(D,_),r.ref=s.ref,r.return=s,s.child=r}function sm(r,s,d,_,A){if(r!==null){var D=r.memoizedProps;if(qo(D,_)&&r.ref===s.ref)if(Ar=!1,s.pendingProps=_=D,Ad(r,A))(r.flags&131072)!==0&&(Ar=!0);else return s.lanes=r.lanes,nl(r,s,A)}return lm(r,s,d,_,A)}function om(r,s,d,_){var A=_.children,D=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((s.flags&128)!==0){if(D=D!==null?D.baseLanes|d:d,r!==null){for(_=s.child=r.child,A=0;_!==null;)A=A|_.lanes|_.childLanes,_=_.sibling;_=A&~D}else _=0,s.child=null;return Sg(r,s,D,d,_)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&xh(s,D!==null?D.cachePool:null),D!==null?Td(s,D):Da(),Tu(s);else return _=s.lanes=536870912,Sg(r,s,D!==null?D.baseLanes|d:d,d,_)}else D!==null?(xh(s,D.cachePool),Td(s,D),er(),s.memoizedState=null):(r!==null&&xh(s,null),Da(),er());return jr(r,s,A,d),s.child}function tl(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Sg(r,s,d,_,A){var D=_h();return D=D===null?null:{parent:Ji._currentValue,pool:D},s.memoizedState={baseLanes:d,cachePool:D},r!==null&&xh(s,null),Da(),Tu(s),r!==null&&ka(r,s,_,!0),s.childLanes=A,null}function Nl(r,s){return s=Wf({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function Md(r,s,d){return Qs(s,r.child,null,d),r=Nl(s,s.pendingProps),r.flags|=2,ji(s),s.memoizedState=null,r}function Zf(r,s,d){var _=s.pendingProps,A=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(Bn){if(_.mode==="hidden")return r=Nl(s,_),s.lanes=536870912,tl(null,r);if(_c(s),(r=pi)?(r=Dc(r,za),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:Vs!==null?{id:qs,overflow:aa}:null,retryLane:536870912,hydrationErrors:null},d=ph(r),d.return=s,s.child=d,Er=s,pi=null)):r=null,r===null)throw sa(s);return s.lanes=536870912,null}return Nl(s,_)}var D=r.memoizedState;if(D!==null){var q=D.dehydrated;if(_c(s),A)if(s.flags&256)s.flags&=-257,s=Md(r,s,d);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(S(558));else if(Ar||ka(r,s,d,!1),A=(d&r.childLanes)!==0,Ar||A){if(_=Ri,_!==null&&(q=Is(_,d),q!==0&&q!==D.retryLane))throw D.retryLane=q,Ya(r,q),os(_,r,q),$f;Gd(),s=Md(r,s,d)}else r=D.treeContext,pi=zs(q.nextSibling),Er=s,Bn=!0,po=null,za=!1,r!==null&&xd(s,r),s=Nl(s,_),s.flags|=4096;return s}return r=Aa(r.child,{mode:_.mode,children:_.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Xf(r,s){var d=s.ref;if(d===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(S(284));(r===null||r.ref!==d)&&(s.flags|=4194816)}}function lm(r,s,d,_,A){return _o(s),d=xc(r,s,d,_,void 0,A),_=Au(),r!==null&&!Ar?(Qo(r,s,A),nl(r,s,A)):(Bn&&_&&Ml(s),s.flags|=1,jr(r,s,d,A),s.child)}function Tg(r,s,d,_,A,D){return _o(s),s.updateQueue=null,d=Mu(s,_,d,A),vc(r),_=Au(),r!==null&&!Ar?(Qo(r,s,D),nl(r,s,D)):(Bn&&_&&Ml(s),s.flags|=1,jr(r,s,d,D),s.child)}function Eg(r,s,d,_,A){if(_o(s),s.stateNode===null){var D=Tn,q=d.contextType;typeof q=="object"&&q!==null&&(D=ar(q)),D=new d(_,D),s.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=Mh,s.stateNode=D,D._reactInternals=s,D=s.stateNode,D.props=_,D.state=s.memoizedState,D.refs={},Sh(s),q=d.contextType,D.context=typeof q=="object"&&q!==null?ar(q):Tn,D.state=s.memoizedState,q=d.getDerivedStateFromProps,typeof q=="function"&&(Eh(s,d,q,_),D.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(q=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),q!==D.state&&Mh.enqueueReplaceState(D,D.state,null),Wo(s,_,D,A),vo(),D.state=s.memoizedState),typeof D.componentDidMount=="function"&&(s.flags|=4194308),_=!0}else if(r===null){D=s.stateNode;var re=s.memoizedProps,Pe=el(d,re);D.props=Pe;var ot=D.context,vt=d.contextType;q=Tn,typeof vt=="object"&&vt!==null&&(q=ar(vt));var At=d.getDerivedStateFromProps;vt=typeof At=="function"||typeof D.getSnapshotBeforeUpdate=="function",re=s.pendingProps!==re,vt||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(re||ot!==q)&&qf(s,D,_,q),Js=!1;var ct=s.memoizedState;D.state=ct,Wo(s,_,D,A),vo(),ot=s.memoizedState,re||ct!==ot||Js?(typeof At=="function"&&(Eh(s,d,At,_),ot=s.memoizedState),(Pe=Js||Jo(s,d,Pe,_,ct,ot,q))?(vt||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(s.flags|=4194308)):(typeof D.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=_,s.memoizedState=ot),D.props=_,D.state=ot,D.context=q,_=Pe):(typeof D.componentDidMount=="function"&&(s.flags|=4194308),_=!1)}else{D=s.stateNode,bu(r,s),q=s.memoizedProps,vt=el(d,q),D.props=vt,At=s.pendingProps,ct=D.context,ot=d.contextType,Pe=Tn,typeof ot=="object"&&ot!==null&&(Pe=ar(ot)),re=d.getDerivedStateFromProps,(ot=typeof re=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(q!==At||ct!==Pe)&&qf(s,D,_,Pe),Js=!1,ct=s.memoizedState,D.state=ct,Wo(s,_,D,A),vo();var pt=s.memoizedState;q!==At||ct!==pt||Js||r!==null&&r.dependencies!==null&&pc(r.dependencies)?(typeof re=="function"&&(Eh(s,d,re,_),pt=s.memoizedState),(vt=Js||Jo(s,d,vt,_,ct,pt,Pe)||r!==null&&r.dependencies!==null&&pc(r.dependencies))?(ot||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(_,pt,Pe),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(_,pt,Pe)),typeof D.componentDidUpdate=="function"&&(s.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof D.componentDidUpdate!="function"||q===r.memoizedProps&&ct===r.memoizedState||(s.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===r.memoizedProps&&ct===r.memoizedState||(s.flags|=1024),s.memoizedProps=_,s.memoizedState=pt),D.props=_,D.state=pt,D.context=Pe,_=vt):(typeof D.componentDidUpdate!="function"||q===r.memoizedProps&&ct===r.memoizedState||(s.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||q===r.memoizedProps&&ct===r.memoizedState||(s.flags|=1024),_=!1)}return D=_,Xf(r,s),_=(s.flags&128)!==0,D||_?(D=s.stateNode,d=_&&typeof d.getDerivedStateFromError!="function"?null:D.render(),s.flags|=1,r!==null&&_?(s.child=Qs(s,r.child,null,A),s.child=Qs(s,null,d,A)):jr(r,s,d,A),s.memoizedState=D.state,r=s.child):r=nl(r,s,A),r}function Mg(r,s,d,_){return $s(),s.flags|=256,jr(r,s,d,_),s.child}var Yf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Cd(r){return{baseLanes:r,cachePool:Vf()}}function Kf(r,s,d){return r=r!==null?r.childLanes&~d:0,s&&(r|=ta),r}function cm(r,s,d){var _=s.pendingProps,A=!1,D=(s.flags&128)!==0,q;if((q=D)||(q=r!==null&&r.memoizedState===null?!1:(Gi.current&2)!==0),q&&(A=!0,s.flags&=-129),q=(s.flags&32)!==0,s.flags&=-33,r===null){if(Bn){if(A?Ja(s):er(),(r=pi)?(r=Dc(r,za),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:Vs!==null?{id:qs,overflow:aa}:null,retryLane:536870912,hydrationErrors:null},d=ph(r),d.return=s,s.child=d,Er=s,pi=null)):r=null,r===null)throw sa(s);return pr(r)?s.lanes=32:s.lanes=536870912,null}var re=_.children;return _=_.fallback,A?(er(),A=s.mode,re=Wf({mode:"hidden",children:re},A),_=$o(_,A,d,null),re.return=s,_.return=s,re.sibling=_,s.child=re,_=s.child,_.memoizedState=Cd(d),_.childLanes=Kf(r,q,d),s.memoizedState=Yf,tl(null,_)):(Ja(s),um(s,re))}var Pe=r.memoizedState;if(Pe!==null&&(re=Pe.dehydrated,re!==null)){if(D)s.flags&256?(Ja(s),s.flags&=-257,s=Qf(r,s,d)):s.memoizedState!==null?(er(),s.child=r.child,s.flags|=128,s=null):(er(),re=_.fallback,A=s.mode,_=Wf({mode:"visible",children:_.children},A),re=$o(re,A,d,null),re.flags|=2,_.return=s,re.return=s,_.sibling=re,s.child=_,Qs(s,r.child,null,d),_=s.child,_.memoizedState=Cd(d),_.childLanes=Kf(r,q,d),s.memoizedState=Yf,s=tl(null,_));else if(Ja(s),pr(re)){if(q=re.nextSibling&&re.nextSibling.dataset,q)var ot=q.dgst;q=ot,_=Error(S(419)),_.stack="",_.digest=q,mo({value:_,source:null,stack:null}),s=Qf(r,s,d)}else if(Ar||ka(r,s,d,!1),q=(d&r.childLanes)!==0,Ar||q){if(q=Ri,q!==null&&(_=Is(q,d),_!==0&&_!==Pe.retryLane))throw Pe.retryLane=_,Ya(r,_),os(q,r,_),$f;da(re)||Gd(),s=Qf(r,s,d)}else da(re)?(s.flags|=192,s.child=r.child,s=null):(r=Pe.treeContext,pi=zs(re.nextSibling),Er=s,Bn=!0,po=null,za=!1,r!==null&&xd(s,r),s=um(s,_.children),s.flags|=4096);return s}return A?(er(),re=_.fallback,A=s.mode,Pe=r.child,ot=Pe.sibling,_=Aa(Pe,{mode:"hidden",children:_.children}),_.subtreeFlags=Pe.subtreeFlags&65011712,ot!==null?re=Aa(ot,re):(re=$o(re,A,d,null),re.flags|=2),re.return=s,_.return=s,_.sibling=re,s.child=_,tl(null,_),_=s.child,re=r.child.memoizedState,re===null?re=Cd(d):(A=re.cachePool,A!==null?(Pe=Ji._currentValue,A=A.parent!==Pe?{parent:Pe,pool:Pe}:A):A=Vf(),re={baseLanes:re.baseLanes|d,cachePool:A}),_.memoizedState=re,_.childLanes=Kf(r,q,d),s.memoizedState=Yf,tl(r.child,_)):(Ja(s),d=r.child,r=d.sibling,d=Aa(d,{mode:"visible",children:_.children}),d.return=s,d.sibling=null,r!==null&&(q=s.deletions,q===null?(s.deletions=[r],s.flags|=16):q.push(r)),s.child=d,s.memoizedState=null,d)}function um(r,s){return s=Wf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Wf(r,s){return r=Ca(22,r,null,s),r.lanes=0,r}function Qf(r,s,d){return Qs(s,r.child,null,d),r=um(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function hm(r,s,d){r.lanes|=s;var _=r.alternate;_!==null&&(_.lanes|=s),mh(r.return,s,d)}function dm(r,s,d,_,A,D){var q=r.memoizedState;q===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:_,tail:d,tailMode:A,treeForkCount:D}:(q.isBackwards=s,q.rendering=null,q.renderingStartTime=0,q.last=_,q.tail=d,q.tailMode=A,q.treeForkCount=D)}function Jf(r,s,d){var _=s.pendingProps,A=_.revealOrder,D=_.tail;_=_.children;var q=Gi.current,re=(q&2)!==0;if(re?(q=q&1|2,s.flags|=128):q&=1,_t(Gi,q),jr(r,s,_,d),_=Bn?Yo:0,!re&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&hm(r,d,s);else if(r.tag===19)hm(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(A){case"forwards":for(d=s.child,A=null;d!==null;)r=d.alternate,r!==null&&Eu(r)===null&&(A=d),d=d.sibling;d=A,d===null?(A=s.child,s.child=null):(A=d.sibling,d.sibling=null),dm(s,!1,A,d,D,_);break;case"backwards":case"unstable_legacy-backwards":for(d=null,A=s.child,s.child=null;A!==null;){if(r=A.alternate,r!==null&&Eu(r)===null){s.child=A;break}r=A.sibling,A.sibling=d,d=A,A=r}dm(s,!0,d,null,D,_);break;case"together":dm(s,!1,null,null,void 0,_);break;default:s.memoizedState=null}return s.child}function nl(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),Vl|=s.lanes,(d&s.childLanes)===0)if(r!==null){if(ka(r,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(S(153));if(s.child!==null){for(r=s.child,d=Aa(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=Aa(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function Ad(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&pc(r)))}function zd(r,s,d){switch(s.tag){case 3:$t(s,s.stateNode.containerInfo),yo(s,Ji,r.memoizedState.cache),$s();break;case 27:case 5:ln(s);break;case 4:$t(s,s.stateNode.containerInfo);break;case 10:yo(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,_c(s),null;break;case 13:var _=s.memoizedState;if(_!==null)return _.dehydrated!==null?(Ja(s),s.flags|=128,null):(d&s.child.childLanes)!==0?cm(r,s,d):(Ja(s),r=nl(r,s,d),r!==null?r.sibling:null);Ja(s);break;case 19:var A=(r.flags&128)!==0;if(_=(d&s.childLanes)!==0,_||(ka(r,s,d,!1),_=(d&s.childLanes)!==0),A){if(_)return Jf(r,s,d);s.flags|=128}if(A=s.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),_t(Gi,Gi.current),_)break;return null;case 22:return s.lanes=0,om(r,s,d,s.pendingProps);case 24:yo(s,Ji,r.memoizedState.cache)}return nl(r,s,d)}function ha(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps)Ar=!0;else{if(!Ad(r,d)&&(s.flags&128)===0)return Ar=!1,zd(r,s,d);Ar=(r.flags&131072)!==0}else Ar=!1,Bn&&(s.flags&1048576)!==0&&_d(s,Yo,s.index);switch(s.lanes=0,s.tag){case 16:e:{var _=s.pendingProps;if(r=Wa(s.elementType),s.type=r,typeof r=="function")dh(r)?(_=el(r,_),s.tag=1,s=Eg(null,s,r,_,d)):(s.tag=0,s=lm(null,s,r,_,d));else{if(r!=null){var A=r.$$typeof;if(A===Pt){s.tag=11,s=wg(null,s,r,_,d);break e}else if(A===nt){s.tag=14,s=Hf(null,s,r,_,d);break e}}throw s=Ye(r)||r,Error(S(306,s,""))}}return s;case 0:return lm(r,s,s.type,s.pendingProps,d);case 1:return _=s.type,A=el(_,s.pendingProps),Eg(r,s,_,A,d);case 3:e:{if($t(s,s.stateNode.containerInfo),r===null)throw Error(S(387));_=s.pendingProps;var D=s.memoizedState;A=D.element,bu(r,s),Wo(s,_,null,d);var q=s.memoizedState;if(_=q.cache,yo(s,Ji,_),_!==D.cache&&gh(s,[Ji],d,!0),vo(),_=q.element,D.isDehydrated)if(D={element:_,isDehydrated:!1,cache:q.cache},s.updateQueue.baseState=D,s.memoizedState=D,s.flags&256){s=Mg(r,s,_,d);break e}else if(_!==A){A=ea(Error(S(424)),s),mo(A),s=Mg(r,s,_,d);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,pi=zs(r.firstChild),Er=s,Bn=!0,po=null,za=!0,d=wd(s,null,_,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if($s(),_===A){s=nl(r,s,d);break e}jr(r,s,_,d)}s=s.child}return s;case 26:return Xf(r,s),r===null?(d=Hm(s.type,null,s.pendingProps,null))?s.memoizedState=d:Bn||(d=s.type,r=s.pendingProps,_=Kd(Dt.current).createElement(d),_[Jn]=s,_[Rt]=r,Br(_,d,r),Ai(_),s.stateNode=_):s.memoizedState=Hm(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return ln(s),r===null&&Bn&&(_=s.stateNode=sy(s.type,s.pendingProps,Dt.current),Er=s,za=!0,A=pi,Pc(s.type)?(ja=A,pi=zs(_.firstChild)):pi=A),jr(r,s,s.pendingProps.children,d),Xf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&Bn&&((A=_=pi)&&(_=qr(_,s.type,s.pendingProps,za),_!==null?(s.stateNode=_,Er=s,pi=zs(_.firstChild),za=!1,A=!0):A=!1),A||sa(s)),ln(s),A=s.type,D=s.pendingProps,q=r!==null?r.memoizedProps:null,_=D.children,Mp(A,D)?_=null:q!==null&&Mp(A,q)&&(s.flags|=32),s.memoizedState!==null&&(A=xc(r,s,Cu,null,null,d),Hh._currentValue=A),Xf(r,s),jr(r,s,_,d),s.child;case 6:return r===null&&Bn&&((r=d=pi)&&(d=ko(d,s.pendingProps,za),d!==null?(s.stateNode=d,Er=s,pi=null,r=!0):r=!1),r||sa(s)),null;case 13:return cm(r,s,d);case 4:return $t(s,s.stateNode.containerInfo),_=s.pendingProps,r===null?s.child=Qs(s,null,_,d):jr(r,s,_,d),s.child;case 11:return wg(r,s,s.type,s.pendingProps,d);case 7:return jr(r,s,s.pendingProps,d),s.child;case 8:return jr(r,s,s.pendingProps.children,d),s.child;case 12:return jr(r,s,s.pendingProps.children,d),s.child;case 10:return _=s.pendingProps,yo(s,s.type,_.value),jr(r,s,_.children,d),s.child;case 9:return A=s.type._context,_=s.pendingProps.children,_o(s),A=ar(A),_=_(A),s.flags|=1,jr(r,s,_,d),s.child;case 14:return Hf(r,s,s.type,s.pendingProps,d);case 15:return sm(r,s,s.type,s.pendingProps,d);case 19:return Jf(r,s,d);case 31:return Zf(r,s,d);case 22:return om(r,s,d,s.pendingProps);case 24:return _o(s),_=ar(Ji),r===null?(A=_h(),A===null&&(A=Ri,D=Ys(),A.pooledCache=D,D.refCount++,D!==null&&(A.pooledCacheLanes|=d),A=D),s.memoizedState={parent:_,cache:A},Sh(s),yo(s,Ji,A)):((r.lanes&d)!==0&&(bu(r,s),Wo(s,null,null,d),vo()),A=r.memoizedState,D=s.memoizedState,A.parent!==_?(A={parent:_,cache:_},s.memoizedState=A,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=A),yo(s,Ji,_)):(_=D.cache,yo(s,Ji,_),_!==A.cache&&gh(s,[Ji],d,!0))),jr(r,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(S(156,s.tag))}function il(r){r.flags|=4}function kd(r,s,d,_,A){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(A&335544128)===A)if(r.stateNode.complete)r.flags|=8192;else if(Tm())r.flags|=8192;else throw vs=Zt,Ko}else r.flags&=-16777217}function Cg(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!ef(s))if(Tm())r.flags|=8192;else throw vs=Zt,Ko}function Pd(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?qn():536870912,r.lanes|=s,Nu|=s)}function Dd(r,s){if(!Bn)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:_.sibling=null}}function Zi(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,_=0;if(s)for(var A=r.child;A!==null;)d|=A.lanes|A.childLanes,_|=A.subtreeFlags&65011712,_|=A.flags&65011712,A.return=r,A=A.sibling;else for(A=r.child;A!==null;)d|=A.lanes|A.childLanes,_|=A.subtreeFlags,_|=A.flags,A.return=r,A=A.sibling;return r.subtreeFlags|=_,r.childLanes=d,s}function Ag(r,s,d){var _=s.pendingProps;switch(fc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zi(s),null;case 1:return Zi(s),null;case 3:return d=s.stateNode,_=null,r!==null&&(_=r.memoizedState.cache),s.memoizedState.cache!==_&&(s.flags|=2048),Xs(Ji),Ot(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(Gs(s)?il(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Hs())),Zi(s),null;case 26:var A=s.type,D=s.memoizedState;return r===null?(il(s),D!==null?(Zi(s),Cg(s,D)):(Zi(s),kd(s,A,null,_,d))):D?D!==r.memoizedState?(il(s),Zi(s),Cg(s,D)):(Zi(s),s.flags&=-16777217):(r=r.memoizedProps,r!==_&&il(s),Zi(s),kd(s,A,r,_,d)),null;case 27:if(dn(s),d=Dt.current,A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&il(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Zi(s),null}r=It.current,Gs(s)?oa(s):(r=sy(A,_,d),s.stateNode=r,il(s))}return Zi(s),null;case 5:if(dn(s),A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&il(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Zi(s),null}if(D=It.current,Gs(s))oa(s);else{var q=Kd(Dt.current);switch(D){case 1:D=q.createElementNS("http://www.w3.org/2000/svg",A);break;case 2:D=q.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;default:switch(A){case"svg":D=q.createElementNS("http://www.w3.org/2000/svg",A);break;case"math":D=q.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;case"script":D=q.createElement("div"),D.innerHTML="<script><\/script>",D=D.removeChild(D.firstChild);break;case"select":D=typeof _.is=="string"?q.createElement("select",{is:_.is}):q.createElement("select"),_.multiple?D.multiple=!0:_.size&&(D.size=_.size);break;default:D=typeof _.is=="string"?q.createElement(A,{is:_.is}):q.createElement(A)}}D[Jn]=s,D[Rt]=_;e:for(q=s.child;q!==null;){if(q.tag===5||q.tag===6)D.appendChild(q.stateNode);else if(q.tag!==4&&q.tag!==27&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===s)break e;for(;q.sibling===null;){if(q.return===null||q.return===s)break e;q=q.return}q.sibling.return=q.return,q=q.sibling}s.stateNode=D;e:switch(Br(D,A,_),A){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}_&&il(s)}}return Zi(s),kd(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,d),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==_&&il(s);else{if(typeof _!="string"&&s.stateNode===null)throw Error(S(166));if(r=Dt.current,Gs(s)){if(r=s.stateNode,d=s.memoizedProps,_=null,A=Er,A!==null)switch(A.tag){case 27:case 5:_=A.memoizedProps}r[Jn]=s,r=!!(r.nodeValue===d||_!==null&&_.suppressHydrationWarning===!0||Nm(r.nodeValue,d)),r||sa(s,!0)}else r=Kd(r).createTextNode(_),r[Jn]=s,s.stateNode=r}return Zi(s),null;case 31:if(d=s.memoizedState,r===null||r.memoizedState!==null){if(_=Gs(s),d!==null){if(r===null){if(!_)throw Error(S(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(557));r[Jn]=s}else $s(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Zi(s),r=!1}else d=Hs(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return s.flags&256?(ji(s),s):(ji(s),null);if((s.flags&128)!==0)throw Error(S(558))}return Zi(s),null;case 13:if(_=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(A=Gs(s),_!==null&&_.dehydrated!==null){if(r===null){if(!A)throw Error(S(318));if(A=s.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(S(317));A[Jn]=s}else $s(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Zi(s),A=!1}else A=Hs(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=A),A=!0;if(!A)return s.flags&256?(ji(s),s):(ji(s),null)}return ji(s),(s.flags&128)!==0?(s.lanes=d,s):(d=_!==null,r=r!==null&&r.memoizedState!==null,d&&(_=s.child,A=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(A=_.alternate.memoizedState.cachePool.pool),D=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(D=_.memoizedState.cachePool.pool),D!==A&&(_.flags|=2048)),d!==r&&d&&(s.child.flags|=8192),Pd(s,s.updateQueue),Zi(s),null);case 4:return Ot(),r===null&&Rm(s.stateNode.containerInfo),Zi(s),null;case 10:return Xs(s.type),Zi(s),null;case 19:if(He(Gi),_=s.memoizedState,_===null)return Zi(s),null;if(A=(s.flags&128)!==0,D=_.rendering,D===null)if(A)Dd(_,!1);else{if(or!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(D=Eu(r),D!==null){for(s.flags|=128,Dd(_,!1),r=D.updateQueue,s.updateQueue=r,Pd(s,r),s.subtreeFlags=0,r=d,d=s.child;d!==null;)Ff(d,r),d=d.sibling;return _t(Gi,Gi.current&1|2),Bn&&fo(s,_.treeForkCount),s.child}r=r.sibling}_.tail!==null&&kn()>Ud&&(s.flags|=128,A=!0,Dd(_,!1),s.lanes=4194304)}else{if(!A)if(r=Eu(D),r!==null){if(s.flags|=128,A=!0,r=r.updateQueue,s.updateQueue=r,Pd(s,r),Dd(_,!0),_.tail===null&&_.tailMode==="hidden"&&!D.alternate&&!Bn)return Zi(s),null}else 2*kn()-_.renderingStartTime>Ud&&d!==536870912&&(s.flags|=128,A=!0,Dd(_,!1),s.lanes=4194304);_.isBackwards?(D.sibling=s.child,s.child=D):(r=_.last,r!==null?r.sibling=D:s.child=D,_.last=D)}return _.tail!==null?(r=_.tail,_.rendering=r,_.tail=r.sibling,_.renderingStartTime=kn(),r.sibling=null,d=Gi.current,_t(Gi,A?d&1|2:d&1),Bn&&fo(s,_.treeForkCount),r):(Zi(s),null);case 22:case 23:return ji(s),kl(),_=s.memoizedState!==null,r!==null?r.memoizedState!==null!==_&&(s.flags|=8192):_&&(s.flags|=8192),_?(d&536870912)!==0&&(s.flags&128)===0&&(Zi(s),s.subtreeFlags&6&&(s.flags|=8192)):Zi(s),d=s.updateQueue,d!==null&&Pd(s,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),_=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),_!==d&&(s.flags|=2048),r!==null&&He(_s),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Xs(Ji),Zi(s),null;case 25:return null;case 30:return null}throw Error(S(156,s.tag))}function s_(r,s){switch(fc(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Xs(Ji),Ot(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return dn(s),null;case 31:if(s.memoizedState!==null){if(ji(s),s.alternate===null)throw Error(S(340));$s()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(ji(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(S(340));$s()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return He(Gi),null;case 4:return Ot(),null;case 10:return Xs(s.type),null;case 22:case 23:return ji(s),kl(),r!==null&&He(_s),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Xs(Ji),null;case 25:return null;default:return null}}function ep(r,s){switch(fc(s),s.tag){case 3:Xs(Ji),Ot();break;case 26:case 27:case 5:dn(s);break;case 4:Ot();break;case 31:s.memoizedState!==null&&ji(s);break;case 13:ji(s);break;case 19:He(Gi);break;case 10:Xs(s.type);break;case 22:case 23:ji(s),kl(),r!==null&&He(_s);break;case 24:Xs(Ji)}}function zh(r,s){try{var d=s.updateQueue,_=d!==null?d.lastEffect:null;if(_!==null){var A=_.next;d=A;do{if((d.tag&r)===r){_=void 0;var D=d.create,q=d.inst;_=D(),q.destroy=_}d=d.next}while(d!==A)}}catch(re){_i(s,s.return,re)}}function jl(r,s,d){try{var _=s.updateQueue,A=_!==null?_.lastEffect:null;if(A!==null){var D=A.next;_=D;do{if((_.tag&r)===r){var q=_.inst,re=q.destroy;if(re!==void 0){q.destroy=void 0,A=s;var Pe=d,ot=re;try{ot()}catch(vt){_i(A,Pe,vt)}}}_=_.next}while(_!==D)}}catch(vt){_i(s,s.return,vt)}}function zg(r){var s=r.updateQueue;if(s!==null){var d=r.stateNode;try{Th(s,d)}catch(_){_i(r,r.return,_)}}}function kg(r,s,d){d.props=el(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(_){_i(r,s,_)}}function Id(r,s){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var _=r.stateNode;break;case 30:_=r.stateNode;break;default:_=r.stateNode}typeof d=="function"?r.refCleanup=d(_):d.current=_}}catch(A){_i(r,s,A)}}function Cs(r,s){var d=r.ref,_=r.refCleanup;if(d!==null)if(typeof _=="function")try{_()}catch(A){_i(r,s,A)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(A){_i(r,s,A)}else d.current=null}function tp(r){var s=r.type,d=r.memoizedProps,_=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&_.focus();break e;case"img":d.src?_.src=d.src:d.srcSet&&(_.srcset=d.srcSet)}}catch(A){_i(r,r.return,A)}}function np(r,s,d){try{var _=r.stateNode;ry(_,r.type,d,s),_[Rt]=s}catch(A){_i(r,r.return,A)}}function Sc(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Pc(r.type)||r.tag===4}function Du(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Sc(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Pc(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function fm(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(r),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=wa));else if(_!==4&&(_===27&&Pc(r.type)&&(d=r.stateNode,s=null),r=r.child,r!==null))for(fm(r,s,d),r=r.sibling;r!==null;)fm(r,s,d),r=r.sibling}function ip(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(_!==4&&(_===27&&Pc(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(ip(r,s,d),r=r.sibling;r!==null;)ip(r,s,d),r=r.sibling}function Pg(r){var s=r.stateNode,d=r.memoizedProps;try{for(var _=r.type,A=s.attributes;A.length;)s.removeAttributeNode(A[0]);Br(s,_,d),s[Jn]=r,s[Rt]=d}catch(D){_i(r,r.return,D)}}var Ol=!1,zr=!1,pm=!1,Dg=typeof WeakSet=="function"?WeakSet:Set,kr=null;function o_(r,s){if(r=r.containerInfo,Yd=sf,r=sh(r),lu(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var _=d.getSelection&&d.getSelection();if(_&&_.rangeCount!==0){d=_.anchorNode;var A=_.anchorOffset,D=_.focusNode;_=_.focusOffset;try{d.nodeType,D.nodeType}catch{d=null;break e}var q=0,re=-1,Pe=-1,ot=0,vt=0,At=r,ct=null;t:for(;;){for(var pt;At!==d||A!==0&&At.nodeType!==3||(re=q+A),At!==D||_!==0&&At.nodeType!==3||(Pe=q+_),At.nodeType===3&&(q+=At.nodeValue.length),(pt=At.firstChild)!==null;)ct=At,At=pt;for(;;){if(At===r)break t;if(ct===d&&++ot===A&&(re=q),ct===D&&++vt===_&&(Pe=q),(pt=At.nextSibling)!==null)break;At=ct,ct=At.parentNode}At=pt}d=re===-1||Pe===-1?null:{start:re,end:Pe}}else d=null}d=d||{start:0,end:0}}else d=null;for(jm={focusedElem:r,selectionRange:d},sf=!1,kr=s;kr!==null;)if(s=kr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,kr=r;else for(;kr!==null;){switch(s=kr,D=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)A=r[d],A.ref.impl=A.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&D!==null){r=void 0,d=s,A=D.memoizedProps,D=D.memoizedState,_=d.stateNode;try{var an=el(d.type,A);r=_.getSnapshotBeforeUpdate(an,D),_.__reactInternalSnapshotBeforeUpdate=r}catch(mn){_i(d,d.return,mn)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,d=r.nodeType,d===9)zo(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":zo(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(S(163))}if(r=s.sibling,r!==null){r.return=s.return,kr=r;break}kr=s.return}}function mm(r,s,d){var _=d.flags;switch(d.tag){case 0:case 11:case 15:rs(r,d),_&4&&zh(5,d);break;case 1:if(rs(r,d),_&4)if(r=d.stateNode,s===null)try{r.componentDidMount()}catch(q){_i(d,d.return,q)}else{var A=el(d.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(A,s,r.__reactInternalSnapshotBeforeUpdate)}catch(q){_i(d,d.return,q)}}_&64&&zg(d),_&512&&Id(d,d.return);break;case 3:if(rs(r,d),_&64&&(r=d.updateQueue,r!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{Th(r,s)}catch(q){_i(d,d.return,q)}}break;case 27:s===null&&_&4&&Pg(d);case 26:case 5:rs(r,d),s===null&&_&4&&tp(d),_&512&&Id(d,d.return);break;case 12:rs(r,d);break;case 31:rs(r,d),_&4&&Rd(r,d);break;case 13:rs(r,d),_&4&&Ld(r,d),_&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=Mm.bind(null,d),Dr(r,d))));break;case 22:if(_=d.memoizedState!==null||Ol,!_){s=s!==null&&s.memoizedState!==null||zr,A=Ol;var D=zr;Ol=_,(zr=s)&&!D?Bl(r,d,(d.subtreeFlags&8772)!==0):rs(r,d),Ol=A,zr=D}break;case 30:break;default:rs(r,d)}}function kh(r){var s=r.alternate;s!==null&&(r.alternate=null,kh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Rs(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var tr=null,Wn=!1;function is(r,s,d){for(d=d.child;d!==null;)gm(r,s,d),d=d.sibling}function gm(r,s,d){if(Me&&typeof Me.onCommitFiberUnmount=="function")try{Me.onCommitFiberUnmount(Le,d)}catch{}switch(d.tag){case 26:zr||Cs(d,s),is(r,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:zr||Cs(d,s);var _=tr,A=Wn;Pc(d.type)&&(tr=d.stateNode,Wn=!1),is(r,s,d),qh(d.stateNode),tr=_,Wn=A;break;case 5:zr||Cs(d,s);case 6:if(_=tr,A=Wn,tr=null,is(r,s,d),tr=_,Wn=A,tr!==null)if(Wn)try{(tr.nodeType===9?tr.body:tr.nodeName==="HTML"?tr.ownerDocument.body:tr).removeChild(d.stateNode)}catch(D){_i(d,s,D)}else try{tr.removeChild(d.stateNode)}catch(D){_i(d,s,D)}break;case 18:tr!==null&&(Wn?(r=tr,ay(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),jc(r)):ay(tr,d.stateNode));break;case 4:_=tr,A=Wn,tr=d.stateNode.containerInfo,Wn=!0,is(r,s,d),tr=_,Wn=A;break;case 0:case 11:case 14:case 15:jl(2,d,s),zr||jl(4,d,s),is(r,s,d);break;case 1:zr||(Cs(d,s),_=d.stateNode,typeof _.componentWillUnmount=="function"&&kg(d,s,_)),is(r,s,d);break;case 21:is(r,s,d);break;case 22:zr=(_=zr)||d.memoizedState!==null,is(r,s,d),zr=_;break;default:is(r,s,d)}}function Rd(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{jc(r)}catch(d){_i(s,s.return,d)}}}function Ld(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{jc(r)}catch(d){_i(s,s.return,d)}}function Nd(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Dg),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Dg),s;default:throw Error(S(435,r.tag))}}function jd(r,s){var d=Nd(r);s.forEach(function(_){if(!d.has(_)){d.add(_);var A=u_.bind(null,r,_);_.then(A,A)}})}function Ra(r,s){var d=s.deletions;if(d!==null)for(var _=0;_<d.length;_++){var A=d[_],D=r,q=s,re=q;e:for(;re!==null;){switch(re.tag){case 27:if(Pc(re.type)){tr=re.stateNode,Wn=!1;break e}break;case 5:tr=re.stateNode,Wn=!1;break e;case 3:case 4:tr=re.stateNode.containerInfo,Wn=!0;break e}re=re.return}if(tr===null)throw Error(S(160));gm(D,q,A),tr=null,Wn=!1,D=A.alternate,D!==null&&(D.return=null),A.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)rp(s,r),s=s.sibling}var La=null;function rp(r,s){var d=r.alternate,_=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Ra(s,r),Or(r),_&4&&(jl(3,r,r.return),zh(3,r),jl(5,r,r.return));break;case 1:Ra(s,r),Or(r),_&512&&(zr||d===null||Cs(d,d.return)),_&64&&Ol&&(r=r.updateQueue,r!==null&&(_=r.callbacks,_!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?_:d.concat(_))));break;case 26:var A=La;if(Ra(s,r),Or(r),_&512&&(zr||d===null||Cs(d,d.return)),_&4){var D=d!==null?d.memoizedState:null;if(_=r.memoizedState,d===null)if(_===null)if(r.stateNode===null){e:{_=r.type,d=r.memoizedProps,A=A.ownerDocument||A;t:switch(_){case"title":D=A.getElementsByTagName("title")[0],(!D||D[_n]||D[Jn]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=A.createElement(_),A.head.insertBefore(D,A.querySelector("head > title"))),Br(D,_,d),D[Jn]=r,Ai(D),_=D;break e;case"link":var q=Km("link","href",A).get(_+(d.href||""));if(q){for(var re=0;re<q.length;re++)if(D=q[re],D.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&D.getAttribute("rel")===(d.rel==null?null:d.rel)&&D.getAttribute("title")===(d.title==null?null:d.title)&&D.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){q.splice(re,1);break t}}D=A.createElement(_),Br(D,_,d),A.head.appendChild(D);break;case"meta":if(q=Km("meta","content",A).get(_+(d.content||""))){for(re=0;re<q.length;re++)if(D=q[re],D.getAttribute("content")===(d.content==null?null:""+d.content)&&D.getAttribute("name")===(d.name==null?null:d.name)&&D.getAttribute("property")===(d.property==null?null:d.property)&&D.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&D.getAttribute("charset")===(d.charSet==null?null:d.charSet)){q.splice(re,1);break t}}D=A.createElement(_),Br(D,_,d),A.head.appendChild(D);break;default:throw Error(S(468,_))}D[Jn]=r,Ai(D),_=D}r.stateNode=_}else Jd(A,r.type,r.stateNode);else r.stateNode=Ym(A,_,r.memoizedProps);else D!==_?(D===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):D.count--,_===null?Jd(A,r.type,r.stateNode):Ym(A,_,r.memoizedProps)):_===null&&r.stateNode!==null&&np(r,r.memoizedProps,d.memoizedProps)}break;case 27:Ra(s,r),Or(r),_&512&&(zr||d===null||Cs(d,d.return)),d!==null&&_&4&&np(r,r.memoizedProps,d.memoizedProps);break;case 5:if(Ra(s,r),Or(r),_&512&&(zr||d===null||Cs(d,d.return)),r.flags&32){A=r.stateNode;try{Ga(A,"")}catch(an){_i(r,r.return,an)}}_&4&&r.stateNode!=null&&(A=r.memoizedProps,np(r,A,d!==null?d.memoizedProps:A)),_&1024&&(pm=!0);break;case 6:if(Ra(s,r),Or(r),_&4){if(r.stateNode===null)throw Error(S(162));_=r.memoizedProps,d=r.stateNode;try{d.nodeValue=_}catch(an){_i(r,r.return,an)}}break;case 3:if(Dp=null,A=La,La=zp(s.containerInfo),Ra(s,r),La=A,Or(r),_&4&&d!==null&&d.memoizedState.isDehydrated)try{jc(s.containerInfo)}catch(an){_i(r,r.return,an)}pm&&(pm=!1,Od(r));break;case 4:_=La,La=zp(r.stateNode.containerInfo),Ra(s,r),Or(r),La=_;break;case 12:Ra(s,r),Or(r);break;case 31:Ra(s,r),Or(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,jd(r,_)));break;case 13:Ra(s,r),Or(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(op=kn()),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,jd(r,_)));break;case 22:A=r.memoizedState!==null;var Pe=d!==null&&d.memoizedState!==null,ot=Ol,vt=zr;if(Ol=ot||A,zr=vt||Pe,Ra(s,r),zr=vt,Ol=ot,Or(r),_&8192)e:for(s=r.stateNode,s._visibility=A?s._visibility&-2:s._visibility|1,A&&(d===null||Pe||Ol||zr||Mo(r)),d=null,s=r;;){if(s.tag===5||s.tag===26){if(d===null){Pe=d=s;try{if(D=Pe.stateNode,A)q=D.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{re=Pe.stateNode;var At=Pe.memoizedProps.style,ct=At!=null&&At.hasOwnProperty("display")?At.display:null;re.style.display=ct==null||typeof ct=="boolean"?"":(""+ct).trim()}}catch(an){_i(Pe,Pe.return,an)}}}else if(s.tag===6){if(d===null){Pe=s;try{Pe.stateNode.nodeValue=A?"":Pe.memoizedProps}catch(an){_i(Pe,Pe.return,an)}}}else if(s.tag===18){if(d===null){Pe=s;try{var pt=Pe.stateNode;A?In(pt,!0):In(Pe.stateNode,!1)}catch(an){_i(Pe,Pe.return,an)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}_&4&&(_=r.updateQueue,_!==null&&(d=_.retryQueue,d!==null&&(_.retryQueue=null,jd(r,d))));break;case 19:Ra(s,r),Or(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,jd(r,_)));break;case 30:break;case 21:break;default:Ra(s,r),Or(r)}}function Or(r){var s=r.flags;if(s&2){try{for(var d,_=r.return;_!==null;){if(Sc(_)){d=_;break}_=_.return}if(d==null)throw Error(S(160));switch(d.tag){case 27:var A=d.stateNode,D=Du(r);ip(r,D,A);break;case 5:var q=d.stateNode;d.flags&32&&(Ga(q,""),d.flags&=-33);var re=Du(r);ip(r,re,q);break;case 3:case 4:var Pe=d.stateNode.containerInfo,ot=Du(r);fm(r,ot,Pe);break;default:throw Error(S(161))}}catch(vt){_i(r,r.return,vt)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function Od(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;Od(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function rs(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)mm(r,s.alternate,s),s=s.sibling}function Mo(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:jl(4,s,s.return),Mo(s);break;case 1:Cs(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&kg(s,s.return,d),Mo(s);break;case 27:qh(s.stateNode);case 26:case 5:Cs(s,s.return),Mo(s);break;case 22:s.memoizedState===null&&Mo(s);break;case 30:Mo(s);break;default:Mo(s)}r=r.sibling}}function Bl(r,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var _=s.alternate,A=r,D=s,q=D.flags;switch(D.tag){case 0:case 11:case 15:Bl(A,D,d),zh(4,D);break;case 1:if(Bl(A,D,d),_=D,A=_.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(ot){_i(_,_.return,ot)}if(_=D,A=_.updateQueue,A!==null){var re=_.stateNode;try{var Pe=A.shared.hiddenCallbacks;if(Pe!==null)for(A.shared.hiddenCallbacks=null,A=0;A<Pe.length;A++)wu(Pe[A],re)}catch(ot){_i(_,_.return,ot)}}d&&q&64&&zg(D),Id(D,D.return);break;case 27:Pg(D);case 26:case 5:Bl(A,D,d),d&&_===null&&q&4&&tp(D),Id(D,D.return);break;case 12:Bl(A,D,d);break;case 31:Bl(A,D,d),d&&q&4&&Rd(A,D);break;case 13:Bl(A,D,d),d&&q&4&&Ld(A,D);break;case 22:D.memoizedState===null&&Bl(A,D,d),Id(D,D.return);break;case 30:break;default:Bl(A,D,d)}s=s.sibling}}function ap(r,s){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&mc(d))}function Fl(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&mc(r))}function Co(r,s,d,_){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)ym(r,s,d,_),s=s.sibling}function ym(r,s,d,_){var A=s.flags;switch(s.tag){case 0:case 11:case 15:Co(r,s,d,_),A&2048&&zh(9,s);break;case 1:Co(r,s,d,_);break;case 3:Co(r,s,d,_),A&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&mc(r)));break;case 12:if(A&2048){Co(r,s,d,_),r=s.stateNode;try{var D=s.memoizedProps,q=D.id,re=D.onPostCommit;typeof re=="function"&&re(q,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Pe){_i(s,s.return,Pe)}}else Co(r,s,d,_);break;case 31:Co(r,s,d,_);break;case 13:Co(r,s,d,_);break;case 23:break;case 22:D=s.stateNode,q=s.alternate,s.memoizedState!==null?D._visibility&2?Co(r,s,d,_):Iu(r,s):D._visibility&2?Co(r,s,d,_):(D._visibility|=2,rl(r,s,d,_,(s.subtreeFlags&10256)!==0||!1)),A&2048&&ap(q,s);break;case 24:Co(r,s,d,_),A&2048&&Fl(s.alternate,s);break;default:Co(r,s,d,_)}}function rl(r,s,d,_,A){for(A=A&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var D=r,q=s,re=d,Pe=_,ot=q.flags;switch(q.tag){case 0:case 11:case 15:rl(D,q,re,Pe,A),zh(8,q);break;case 23:break;case 22:var vt=q.stateNode;q.memoizedState!==null?vt._visibility&2?rl(D,q,re,Pe,A):Iu(D,q):(vt._visibility|=2,rl(D,q,re,Pe,A)),A&&ot&2048&&ap(q.alternate,q);break;case 24:rl(D,q,re,Pe,A),A&&ot&2048&&Fl(q.alternate,q);break;default:rl(D,q,re,Pe,A)}s=s.sibling}}function Iu(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=r,_=s,A=_.flags;switch(_.tag){case 22:Iu(d,_),A&2048&&ap(_.alternate,_);break;case 24:Iu(d,_),A&2048&&Fl(_.alternate,_);break;default:Iu(d,_)}s=s.sibling}}var Ph=8192;function Ru(r,s,d){if(r.subtreeFlags&Ph)for(r=r.child;r!==null;)Ig(r,s,d),r=r.sibling}function Ig(r,s,d){switch(r.tag){case 26:Ru(r,s,d),r.flags&Ph&&r.memoizedState!==null&&Wm(d,La,r.memoizedState,r.memoizedProps);break;case 5:Ru(r,s,d);break;case 3:case 4:var _=La;La=zp(r.stateNode.containerInfo),Ru(r,s,d),La=_;break;case 22:r.memoizedState===null&&(_=r.alternate,_!==null&&_.memoizedState!==null?(_=Ph,Ph=16777216,Ru(r,s,d),Ph=_):Ru(r,s,d));break;default:Ru(r,s,d)}}function Rg(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Bd(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];kr=_,Dh(_,r)}Rg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Lg(r),r=r.sibling}function Lg(r){switch(r.tag){case 0:case 11:case 15:Bd(r),r.flags&2048&&jl(9,r,r.return);break;case 3:Bd(r);break;case 12:Bd(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,sp(r)):Bd(r);break;default:Bd(r)}}function sp(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];kr=_,Dh(_,r)}Rg(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:jl(8,s,s.return),sp(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,sp(s));break;default:sp(s)}r=r.sibling}}function Dh(r,s){for(;kr!==null;){var d=kr;switch(d.tag){case 0:case 11:case 15:jl(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var _=d.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:mc(d.memoizedState.cache)}if(_=d.child,_!==null)_.return=d,kr=_;else e:for(d=r;kr!==null;){_=kr;var A=_.sibling,D=_.return;if(kh(_),_===d){kr=null;break e}if(A!==null){A.return=D,kr=A;break e}kr=D}}}var l_={getCacheForType:function(r){var s=ar(Ji),d=s.data.get(r);return d===void 0&&(d=r(),s.data.set(r,d)),d},cacheSignal:function(){return ar(Ji).controller.signal}},Ng=typeof WeakMap=="function"?WeakMap:Map,yi=0,Ri=null,Gn=null,$n=0,wi=0,Na=null,ro=!1,Tc=!1,_m=!1,Ul=0,or=0,Vl=0,Lu=0,xm=0,ta=0,Nu=0,Fd=null,as=null,vm=!1,op=0,jg=0,Ud=1/0,Ih=null,ql=null,Pr=0,Gl=null,Rh=null,ao=0,bm=0,lp=null,Og=null,Vd=0,wm=null;function ss(){return(yi&2)!==0&&$n!==0?$n&-$n:le.T!==null?Pm():br()}function Bg(){if(ta===0)if(($n&536870912)===0||Bn){var r=pn;pn<<=1,(pn&3932160)===0&&(pn=262144),ta=r}else ta=536870912;return r=Yt.current,r!==null&&(r.flags|=32),ta}function os(r,s,d){(r===Ri&&(wi===2||wi===9)||r.cancelPendingCommit!==null)&&(Nh(r,0),Ec(r,$n,ta,!1)),ei(r,d),((yi&2)===0||r!==Ri)&&(r===Ri&&((yi&2)===0&&(Lu|=d),or===4&&Ec(r,$n,ta,!1)),Ao(r))}function vr(r,s,d){if((yi&6)!==0)throw Error(S(327));var _=!d&&(s&127)===0&&(s&r.expiredLanes)===0||Fi(r,s),A=_?jh(r,s):hp(r,s,!0),D=_;do{if(A===0){Tc&&!_&&Ec(r,s,0,!1);break}else{if(d=r.current.alternate,D&&!c_(d)){A=hp(r,s,!1),D=!1;continue}if(A===2){if(D=s,r.errorRecoveryDisabledLanes&D)var q=0;else q=r.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){s=q;e:{var re=r;A=Fd;var Pe=re.current.memoizedState.isDehydrated;if(Pe&&(Nh(re,q).flags|=256),q=hp(re,q,!1),q!==2){if(_m&&!Pe){re.errorRecoveryDisabledLanes|=D,Lu|=D,A=4;break e}D=as,as=A,D!==null&&(as===null?as=D:as.push.apply(as,D))}A=q}if(D=!1,A!==2)continue}}if(A===1){Nh(r,0),Ec(r,s,0,!0);break}e:{switch(_=r,D=A,D){case 0:case 1:throw Error(S(345));case 4:if((s&4194048)!==s)break;case 6:Ec(_,s,ta,!ro);break e;case 2:as=null;break;case 3:case 5:break;default:throw Error(S(329))}if((s&62914560)===s&&(A=op+300-kn(),10<A)){if(Ec(_,s,ta,!ro),Pn(_,0,!0)!==0)break e;ao=s,_.timeoutHandle=Ap(Lh.bind(null,_,d,as,Ih,vm,s,ta,Lu,Nu,ro,D,"Throttled",-0,0),A);break e}Lh(_,d,as,Ih,vm,s,ta,Lu,Nu,ro,D,null,-0,0)}}break}while(!0);Ao(r)}function Lh(r,s,d,_,A,D,q,re,Pe,ot,vt,At,ct,pt){if(r.timeoutHandle=-1,At=s.subtreeFlags,At&8192||(At&16785408)===16785408){At={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:wa},Ig(s,D,At);var an=(D&62914560)===D?op-kn():(D&4194048)===D?jg-kn():0;if(an=Qm(At,an),an!==null){ao=D,r.cancelPendingCommit=an(Gg.bind(null,r,s,D,d,_,A,q,re,Pe,vt,At,null,ct,pt)),Ec(r,D,q,!ot);return}}Gg(r,s,D,d,_,A,q,re,Pe)}function c_(r){for(var s=r;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var _=0;_<d.length;_++){var A=d[_],D=A.getSnapshot;A=A.value;try{if(!ra(D(),A))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ec(r,s,d,_){s&=~xm,s&=~Lu,r.suspendedLanes|=s,r.pingedLanes&=~s,_&&(r.warmLanes|=s),_=r.expirationTimes;for(var A=s;0<A;){var D=31-Je(A),q=1<<D;_[D]=-1,A&=~q}d!==0&&ii(r,d,s)}function qd(){return(yi&6)===0?(As(0),!1):!0}function cp(){if(Gn!==null){if(wi===0)var r=Gn.return;else r=Gn,Zs=Ka=null,So(r),Ks=null,Al=0,r=Gn;for(;r!==null;)ep(r.alternate,r),r=r.return;Gn=null}}function Nh(r,s){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,Bm(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),ao=0,cp(),Ri=r,Gn=d=Aa(r.current,null),$n=s,wi=0,Na=null,ro=!1,Tc=Fi(r,s),_m=!1,Nu=ta=xm=Lu=Vl=or=0,as=Fd=null,vm=!1,(s&8)!==0&&(s|=s&32);var _=r.entangledLanes;if(_!==0)for(r=r.entanglements,_&=s;0<_;){var A=31-Je(_),D=1<<A;s|=r[A],_&=~D}return Ul=s,Tl(),d}function Sm(r,s){zn=null,le.H=ai,s===xs||s===la?(s=yc(),wi=3):s===Ko?(s=yc(),wi=4):wi=s===$f?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Na=s,Gn===null&&(or=1,Ms(r,ea(s,r.current)))}function Tm(){var r=Yt.current;return r===null?!0:($n&4194048)===$n?nn===null:($n&62914560)===$n||($n&536870912)!==0?r===nn:!1}function ju(){var r=le.H;return le.H=ai,r===null?ai:r}function up(){var r=le.A;return le.A=l_,r}function Gd(){or=4,ro||($n&4194048)!==$n&&Yt.current!==null||(Tc=!0),(Vl&134217727)===0&&(Lu&134217727)===0||Ri===null||Ec(Ri,$n,ta,!1)}function hp(r,s,d){var _=yi;yi|=2;var A=ju(),D=up();(Ri!==r||$n!==s)&&(Ih=null,Nh(r,s)),s=!1;var q=or;e:do try{if(wi!==0&&Gn!==null){var re=Gn,Pe=Na;switch(wi){case 8:cp(),q=6;break e;case 3:case 2:case 9:case 6:Yt.current===null&&(s=!0);var ot=wi;if(wi=0,Na=null,Oh(r,re,Pe,ot),d&&Tc){q=0;break e}break;default:ot=wi,wi=0,Na=null,Oh(r,re,Pe,ot)}}dp(),q=or;break}catch(vt){Sm(r,vt)}while(!0);return s&&r.shellSuspendCounter++,Zs=Ka=null,yi=_,le.H=A,le.A=D,Gn===null&&(Ri=null,$n=0,Tl()),q}function dp(){for(;Gn!==null;)Ug(Gn)}function jh(r,s){var d=yi;yi|=2;var _=ju(),A=up();Ri!==r||$n!==s?(Ih=null,Ud=kn()+500,Nh(r,s)):Tc=Fi(r,s);e:do try{if(wi!==0&&Gn!==null){s=Gn;var D=Na;t:switch(wi){case 1:wi=0,Na=null,Oh(r,s,D,1);break;case 2:case 9:if(_u(D)){wi=0,Na=null,Vg(s);break}s=function(){wi!==2&&wi!==9||Ri!==r||(wi=7),Ao(r)},D.then(s,s);break e;case 3:wi=7;break e;case 4:wi=5;break e;case 7:_u(D)?(wi=0,Na=null,Vg(s)):(wi=0,Na=null,Oh(r,s,D,7));break;case 5:var q=null;switch(Gn.tag){case 26:q=Gn.memoizedState;case 5:case 27:var re=Gn;if(q?ef(q):re.stateNode.complete){wi=0,Na=null;var Pe=re.sibling;if(Pe!==null)Gn=Pe;else{var ot=re.return;ot!==null?(Gn=ot,fp(ot)):Gn=null}break t}}wi=0,Na=null,Oh(r,s,D,5);break;case 6:wi=0,Na=null,Oh(r,s,D,6);break;case 8:cp(),or=6;break e;default:throw Error(S(462))}}Fg();break}catch(vt){Sm(r,vt)}while(!0);return Zs=Ka=null,le.H=_,le.A=A,yi=d,Gn!==null?0:(Ri=null,$n=0,Tl(),or)}function Fg(){for(;Gn!==null&&!Ln();)Ug(Gn)}function Ug(r){var s=ha(r.alternate,r,Ul);r.memoizedProps=r.pendingProps,s===null?fp(r):Gn=s}function Vg(r){var s=r,d=s.alternate;switch(s.tag){case 15:case 0:s=Tg(d,s,s.pendingProps,s.type,void 0,$n);break;case 11:s=Tg(d,s,s.pendingProps,s.type.render,s.ref,$n);break;case 5:So(s);default:ep(d,s),s=Gn=Ff(s,Ul),s=ha(d,s,Ul)}r.memoizedProps=r.pendingProps,s===null?fp(r):Gn=s}function Oh(r,s,d,_){Zs=Ka=null,So(s),Ks=null,Al=0;var A=s.return;try{if(Gf(r,A,s,d,$n)){or=1,Ms(r,ea(d,r.current)),Gn=null;return}}catch(D){if(A!==null)throw Gn=A,D;or=1,Ms(r,ea(d,r.current)),Gn=null;return}s.flags&32768?(Bn||_===1?r=!0:Tc||($n&536870912)!==0?r=!1:(ro=r=!0,(_===2||_===9||_===3||_===6)&&(_=Yt.current,_!==null&&_.tag===13&&(_.flags|=16384))),qg(s,r)):fp(s)}function fp(r){var s=r;do{if((s.flags&32768)!==0){qg(s,ro);return}r=s.return;var d=Ag(s.alternate,s,Ul);if(d!==null){Gn=d;return}if(s=s.sibling,s!==null){Gn=s;return}Gn=s=r}while(s!==null);or===0&&(or=5)}function qg(r,s){do{var d=s_(r.alternate,r);if(d!==null){d.flags&=32767,Gn=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(r=r.sibling,r!==null)){Gn=r;return}Gn=r=d}while(r!==null);or=6,Gn=null}function Gg(r,s,d,_,A,D,q,re,Pe){r.cancelPendingCommit=null;do pp();while(Pr!==0);if((yi&6)!==0)throw Error(S(327));if(s!==null){if(s===r.current)throw Error(S(177));if(D=s.lanes|s.childLanes,D|=Sl,Ti(r,d,D,q,re,Pe),r===Ri&&(Gn=Ri=null,$n=0),Rh=s,Gl=r,ao=d,bm=D,lp=A,Og=_,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Kg($,function(){return Yg(),null})):(r.callbackNode=null,r.callbackPriority=0),_=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||_){_=le.T,le.T=null,A=ke.p,ke.p=2,q=yi,yi|=4;try{o_(r,s,d)}finally{yi=q,ke.p=A,le.T=_}}Pr=1,$g(),Hg(),Zg()}}function $g(){if(Pr===1){Pr=0;var r=Gl,s=Rh,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=le.T,le.T=null;var _=ke.p;ke.p=2;var A=yi;yi|=4;try{rp(s,r);var D=jm,q=sh(r.containerInfo),re=D.focusedElem,Pe=D.selectionRange;if(q!==re&&re&&re.ownerDocument&&ah(re.ownerDocument.documentElement,re)){if(Pe!==null&&lu(re)){var ot=Pe.start,vt=Pe.end;if(vt===void 0&&(vt=ot),"selectionStart"in re)re.selectionStart=ot,re.selectionEnd=Math.min(vt,re.value.length);else{var At=re.ownerDocument||document,ct=At&&At.defaultView||window;if(ct.getSelection){var pt=ct.getSelection(),an=re.textContent.length,mn=Math.min(Pe.start,an),Si=Pe.end===void 0?mn:Math.min(Pe.end,an);!pt.extend&&mn>Si&&(q=Si,Si=mn,mn=q);var Ge=ou(re,mn),Ne=ou(re,Si);if(Ge&&Ne&&(pt.rangeCount!==1||pt.anchorNode!==Ge.node||pt.anchorOffset!==Ge.offset||pt.focusNode!==Ne.node||pt.focusOffset!==Ne.offset)){var at=At.createRange();at.setStart(Ge.node,Ge.offset),pt.removeAllRanges(),mn>Si?(pt.addRange(at),pt.extend(Ne.node,Ne.offset)):(at.setEnd(Ne.node,Ne.offset),pt.addRange(at))}}}}for(At=[],pt=re;pt=pt.parentNode;)pt.nodeType===1&&At.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof re.focus=="function"&&re.focus(),re=0;re<At.length;re++){var Mt=At[re];Mt.element.scrollLeft=Mt.left,Mt.element.scrollTop=Mt.top}}sf=!!Yd,jm=Yd=null}finally{yi=A,ke.p=_,le.T=d}}r.current=s,Pr=2}}function Hg(){if(Pr===2){Pr=0;var r=Gl,s=Rh,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=le.T,le.T=null;var _=ke.p;ke.p=2;var A=yi;yi|=4;try{mm(r,s.alternate,s)}finally{yi=A,ke.p=_,le.T=d}}Pr=3}}function Zg(){if(Pr===4||Pr===3){Pr=0,Wi();var r=Gl,s=Rh,d=ao,_=Og;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Pr=5:(Pr=0,Rh=Gl=null,Xg(r,r.pendingLanes));var A=r.pendingLanes;if(A===0&&(ql=null),kt(d),s=s.stateNode,Me&&typeof Me.onCommitFiberRoot=="function")try{Me.onCommitFiberRoot(Le,s,void 0,(s.current.flags&128)===128)}catch{}if(_!==null){s=le.T,A=ke.p,ke.p=2,le.T=null;try{for(var D=r.onRecoverableError,q=0;q<_.length;q++){var re=_[q];D(re.value,{componentStack:re.stack})}}finally{le.T=s,ke.p=A}}(ao&3)!==0&&pp(),Ao(r),A=r.pendingLanes,(d&261930)!==0&&(A&42)!==0?r===wm?Vd++:(Vd=0,wm=r):Vd=0,As(0)}}function Xg(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,mc(s)))}function pp(){return $g(),Hg(),Zg(),Yg()}function Yg(){if(Pr!==5)return!1;var r=Gl,s=bm;bm=0;var d=kt(ao),_=le.T,A=ke.p;try{ke.p=32>d?32:d,le.T=null,d=lp,lp=null;var D=Gl,q=ao;if(Pr=0,Rh=Gl=null,ao=0,(yi&6)!==0)throw Error(S(331));var re=yi;if(yi|=4,Lg(D.current),ym(D,D.current,q,d),yi=re,As(0,!1),Me&&typeof Me.onPostCommitFiberRoot=="function")try{Me.onPostCommitFiberRoot(Le,D)}catch{}return!0}finally{ke.p=A,le.T=_,Xg(r,s)}}function Em(r,s,d){s=ea(d,s),s=zu(r.stateNode,s,2),r=xo(r,s,2),r!==null&&(ei(r,2),Ao(r))}function _i(r,s,d){if(r.tag===3)Em(r,r,d);else for(;s!==null;){if(s.tag===3){Em(s,r,d);break}else if(s.tag===1){var _=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(ql===null||!ql.has(_))){r=ea(d,r),d=ku(2),_=xo(s,d,2),_!==null&&(Pu(d,_,s,r),ei(_,2),Ao(_));break}}s=s.return}}function mp(r,s,d){var _=r.pingCache;if(_===null){_=r.pingCache=new Ng;var A=new Set;_.set(s,A)}else A=_.get(s),A===void 0&&(A=new Set,_.set(s,A));A.has(d)||(_m=!0,A.add(d),r=Mc.bind(null,r,s,d),s.then(r,r))}function Mc(r,s,d){var _=r.pingCache;_!==null&&_.delete(s),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,Ri===r&&($n&d)===d&&(or===4||or===3&&($n&62914560)===$n&&300>kn()-op?(yi&2)===0&&Nh(r,0):xm|=d,Nu===$n&&(Nu=0)),Ao(r)}function $d(r,s){s===0&&(s=qn()),r=Ya(r,s),r!==null&&(ei(r,s),Ao(r))}function Mm(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),$d(r,d)}function u_(r,s){var d=0;switch(r.tag){case 31:case 13:var _=r.stateNode,A=r.memoizedState;A!==null&&(d=A.retryLane);break;case 19:_=r.stateNode;break;case 22:_=r.stateNode._retryCache;break;default:throw Error(S(314))}_!==null&&_.delete(s),$d(r,d)}function Kg(r,s){return bn(r,s)}var gp=null,Bh=null,Cm=!1,yp=!1,Am=!1,$l=0;function Ao(r){r!==Bh&&r.next===null&&(Bh===null?gp=Bh=r:Bh=Bh.next=r),yp=!0,Cm||(Cm=!0,km())}function As(r,s){if(!Am&&yp){Am=!0;do for(var d=!1,_=gp;_!==null;){if(r!==0){var A=_.pendingLanes;if(A===0)var D=0;else{var q=_.suspendedLanes,re=_.pingedLanes;D=(1<<31-Je(42|r)+1)-1,D&=A&~(q&~re),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(d=!0,Hd(_,D))}else D=$n,D=Pn(_,_===Ri?D:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(D&3)===0||Fi(_,D)||(d=!0,Hd(_,D));_=_.next}while(d);Am=!1}}function Cc(){zm()}function zm(){yp=Cm=!1;var r=0;$l!==0&&Cp()&&(r=$l);for(var s=kn(),d=null,_=gp;_!==null;){var A=_.next,D=_p(_,s);D===0?(_.next=null,d===null?gp=A:d.next=A,A===null&&(Bh=d)):(d=_,(r!==0||(D&3)!==0)&&(yp=!0)),_=A}Pr!==0&&Pr!==5||As(r),$l!==0&&($l=0)}function _p(r,s){for(var d=r.suspendedLanes,_=r.pingedLanes,A=r.expirationTimes,D=r.pendingLanes&-62914561;0<D;){var q=31-Je(D),re=1<<q,Pe=A[q];Pe===-1?((re&d)===0||(re&_)!==0)&&(A[q]=yn(re,s)):Pe<=s&&(r.expiredLanes|=re),D&=~re}if(s=Ri,d=$n,d=Pn(r,r===s?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_=r.callbackNode,d===0||r===s&&(wi===2||wi===9)||r.cancelPendingCommit!==null)return _!==null&&_!==null&&Zn(_),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||Fi(r,d)){if(s=d&-d,s===r.callbackPriority)return s;switch(_!==null&&Zn(_),kt(d)){case 2:case 8:d=W;break;case 32:d=$;break;case 268435456:d=ue;break;default:d=$}return _=Wg.bind(null,r),d=bn(d,_),r.callbackPriority=s,r.callbackNode=d,s}return _!==null&&_!==null&&Zn(_),r.callbackPriority=2,r.callbackNode=null,2}function Wg(r,s){if(Pr!==0&&Pr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(pp()&&r.callbackNode!==d)return null;var _=$n;return _=Pn(r,r===Ri?_:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_===0?null:(vr(r,_,s),_p(r,kn()),r.callbackNode!=null&&r.callbackNode===d?Wg.bind(null,r):null)}function Hd(r,s){if(pp())return null;vr(r,s,!0)}function km(){Um(function(){(yi&6)!==0?bn(Ue,Cc):zm()})}function Pm(){if($l===0){var r=Cl;r===0&&(r=Jt,Jt<<=1,(Jt&261888)===0&&(Jt=256)),$l=r}return $l}function xp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:wn(""+r)}function vp(r,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,r.id&&d.setAttribute("form",r.id),s.parentNode.insertBefore(d,s),r=new FormData(r),d.parentNode.removeChild(d),r}function Fh(r,s,d,_,A){if(s==="submit"&&d&&d.stateNode===A){var D=xp((A[Rt]||null).action),q=_.submitter;q&&(s=(s=q[Rt]||null)?xp(s.formAction):q.getAttribute("formAction"),s!==null&&(D=s,q=null));var re=new Kc("action","action",null,_,A);r.push({event:re,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if($l!==0){var Pe=q?vp(A,q):new FormData(A);$i(d,{pending:!0,data:Pe,method:A.method,action:D},null,Pe)}}else typeof D=="function"&&(re.preventDefault(),Pe=q?vp(A,q):new FormData(A),$i(d,{pending:!0,data:Pe,method:A.method,action:D},D,Pe))},currentTarget:A}]})}}for(var bp=0;bp<uh.length;bp++){var wp=uh[bp],Dm=wp.toLowerCase(),Qg=wp[0].toUpperCase()+wp.slice(1);Ma(Dm,"on"+Qg)}Ma(hu,"onAnimationEnd"),Ma(du,"onAnimationIteration"),Ma(ch,"onAnimationStart"),Ma("dblclick","onDoubleClick"),Ma("focusin","onFocus"),Ma("focusout","onBlur"),Ma(wl,"onTransitionRun"),Ma(fu,"onTransitionStart"),Ma(uc,"onTransitionCancel"),Ma(Ea,"onTransitionEnd"),Ua("onMouseEnter",["mouseout","mouseover"]),Ua("onMouseLeave",["mouseout","mouseover"]),Ua("onPointerEnter",["pointerout","pointerover"]),Ua("onPointerLeave",["pointerout","pointerover"]),On("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),On("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),On("onBeforeInput",["compositionend","keypress","textInput","paste"]),On("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),On("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),On("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ac="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ac));function ey(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var _=r[d],A=_.event;_=_.listeners;e:{var D=void 0;if(s)for(var q=_.length-1;0<=q;q--){var re=_[q],Pe=re.instance,ot=re.currentTarget;if(re=re.listener,Pe!==D&&A.isPropagationStopped())break e;D=re,A.currentTarget=ot;try{D(A)}catch(vt){Us(vt)}A.currentTarget=null,D=Pe}else for(q=0;q<_.length;q++){if(re=_[q],Pe=re.instance,ot=re.currentTarget,re=re.listener,Pe!==D&&A.isPropagationStopped())break e;D=re,A.currentTarget=ot;try{D(A)}catch(vt){Us(vt)}A.currentTarget=null,D=Pe}}}}function Hn(r,s){var d=s[En];d===void 0&&(d=s[En]=new Set);var _=r+"__bubble";d.has(_)||(Tp(s,r,2,!1),d.add(_))}function Im(r,s,d){var _=0;s&&(_|=4),Tp(d,r,_,s)}var Sp="_reactListening"+Math.random().toString(36).slice(2);function Rm(r){if(!r[Sp]){r[Sp]=!0,Ro.forEach(function(d){d!=="selectionchange"&&(Jg.has(d)||Im(d,!1,r),Im(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Sp]||(s[Sp]=!0,Im("selectionchange",!1,s))}}function Tp(r,s,d,_){switch(Fu(s)){case 2:var A=of;break;case 8:A=py;break;default:A=eg}d=A.bind(null,s,d,r),A=void 0,!Yr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(A=!0),_?A!==void 0?r.addEventListener(s,d,{capture:!0,passive:A}):r.addEventListener(s,d,!0):A!==void 0?r.addEventListener(s,d,{passive:A}):r.addEventListener(s,d,!1)}function al(r,s,d,_,A){var D=_;if((s&1)===0&&(s&2)===0&&_!==null)e:for(;;){if(_===null)return;var q=_.tag;if(q===3||q===4){var re=_.stateNode.containerInfo;if(re===A)break;if(q===4)for(q=_.return;q!==null;){var Pe=q.tag;if((Pe===3||Pe===4)&&q.stateNode.containerInfo===A)return;q=q.return}for(;re!==null;){if(q=Fa(re),q===null)return;if(Pe=q.tag,Pe===5||Pe===6||Pe===26||Pe===27){_=D=q;continue e}re=re.parentNode}}_=_.return}fi(function(){var ot=D,vt=Yc(d),At=[];e:{var ct=md.get(r);if(ct!==void 0){var pt=Kc,an=r;switch(r){case"keypress":if(Ta(d)===0)break e;case"keydown":case"keyup":pt=qi;break;case"focusin":an="focus",pt=Oo;break;case"focusout":an="blur",pt=Oo;break;case"beforeblur":case"afterblur":pt=Oo;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=yl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=Wc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=im;break;case hu:case du:case ch:pt=Af;break;case Ea:pt=th;break;case"scroll":case"scrollend":pt=gl;break;case"wheel":pt=ud;break;case"copy":case"cut":case"paste":pt=ld;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=eh;break;case"toggle":case"beforetoggle":pt=rc}var mn=(s&4)!==0,Si=!mn&&(r==="scroll"||r==="scrollend"),Ge=mn?ct!==null?ct+"Capture":null:ct;mn=[];for(var Ne=ot,at;Ne!==null;){var Mt=Ne;if(at=Mt.stateNode,Mt=Mt.tag,Mt!==5&&Mt!==26&&Mt!==27||at===null||Ge===null||(Mt=$a(Ne,Ge),Mt!=null&&mn.push(Uh(Ne,Mt,at))),Si)break;Ne=Ne.return}0<mn.length&&(ct=new pt(ct,an,null,d,vt),At.push({event:ct,listeners:mn}))}}if((s&7)===0){e:{if(ct=r==="mouseover"||r==="pointerover",pt=r==="mouseout"||r==="pointerout",ct&&d!==od&&(an=d.relatedTarget||d.fromElement)&&(Fa(an)||an[xn]))break e;if((pt||ct)&&(ct=vt.window===vt?vt:(ct=vt.ownerDocument)?ct.defaultView||ct.parentWindow:window,pt?(an=d.relatedTarget||d.toElement,pt=ot,an=an?Fa(an):null,an!==null&&(Si=R(an),mn=an.tag,an!==Si||mn!==5&&mn!==27&&mn!==6)&&(an=null)):(pt=null,an=ot),pt!==an)){if(mn=yl,Mt="onMouseLeave",Ge="onMouseEnter",Ne="mouse",(r==="pointerout"||r==="pointerover")&&(mn=eh,Mt="onPointerLeave",Ge="onPointerEnter",Ne="pointer"),Si=pt==null?ct:ia(pt),at=an==null?ct:ia(an),ct=new mn(Mt,Ne+"leave",pt,d,vt),ct.target=Si,ct.relatedTarget=at,Mt=null,Fa(vt)===ot&&(mn=new mn(Ge,Ne+"enter",an,d,vt),mn.target=at,mn.relatedTarget=Si,Mt=mn),Si=Mt,pt&&an)t:{for(mn=ty,Ge=pt,Ne=an,at=0,Mt=Ge;Mt;Mt=mn(Mt))at++;Mt=0;for(var fn=Ne;fn;fn=mn(fn))Mt++;for(;0<at-Mt;)Ge=mn(Ge),at--;for(;0<Mt-at;)Ne=mn(Ne),Mt--;for(;at--;){if(Ge===Ne||Ne!==null&&Ge===Ne.alternate){mn=Ge;break t}Ge=mn(Ge),Ne=mn(Ne)}mn=null}else mn=null;pt!==null&&Lm(At,ct,pt,mn,!1),an!==null&&Si!==null&&Lm(At,Si,an,mn,!0)}}e:{if(ct=ot?ia(ot):window,pt=ct.nodeName&&ct.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ct.type==="file")var hi=Uo;else if(ih(ct))if(hd)hi=Of;else{hi=jf;var sn=rm}else pt=ct.nodeName,!pt||pt.toLowerCase()!=="input"||ct.type!=="checkbox"&&ct.type!=="radio"?ot&&js(ot.elementType)&&(hi=Uo):hi=su;if(hi&&(hi=hi(r,ot))){rh(At,hi,d,vt);break e}sn&&sn(r,ct,ot),r==="focusout"&&ot&&ct.type==="number"&&ot.memoizedProps.value!=null&&ms(ct,"number",ct.value)}switch(sn=ot?ia(ot):window,r){case"focusin":(ih(sn)||sn.contentEditable==="true")&&(Xa=sn,cu=ot,uu=null);break;case"focusout":uu=cu=Xa=null;break;case"mousedown":lh=!0;break;case"contextmenu":case"mouseup":case"dragend":lh=!1,Bf(At,d,vt);break;case"selectionchange":if(oh)break;case"keydown":case"keyup":Bf(At,d,vt)}var cn;if(Qi)e:{switch(r){case"compositionstart":var Vn="onCompositionStart";break e;case"compositionend":Vn="onCompositionEnd";break e;case"compositionupdate":Vn="onCompositionUpdate";break e}Vn=void 0}else ys?nu(r,d)&&(Vn="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Vn="onCompositionStart");Vn&&(lc&&d.locale!=="ko"&&(ys||Vn!=="onCompositionStart"?Vn==="onCompositionEnd"&&ys&&(cn=No()):(Sa=vt,Os="value"in Sa?Sa.value:Sa.textContent,ys=!0)),sn=Zd(ot,Vn),0<sn.length&&(Vn=new cd(Vn,r,null,d,vt),At.push({event:Vn,listeners:sn}),cn?Vn.data=cn:(cn=Df(d),cn!==null&&(Vn.data=cn)))),(cn=oc?nh(r,d):If(r,d))&&(Vn=Zd(ot,"onBeforeInput"),0<Vn.length&&(sn=new cd("onBeforeInput","beforeinput",null,d,vt),At.push({event:sn,listeners:Vn}),sn.data=cn)),Fh(At,r,ot,d,vt)}ey(At,s)})}function Uh(r,s,d){return{instance:r,listener:s,currentTarget:d}}function Zd(r,s){for(var d=s+"Capture",_=[];r!==null;){var A=r,D=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||D===null||(A=$a(r,d),A!=null&&_.unshift(Uh(r,A,D)),A=$a(r,s),A!=null&&_.push(Uh(r,A,D))),r.tag===3)return _;r=r.return}return[]}function ty(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Lm(r,s,d,_,A){for(var D=s._reactName,q=[];d!==null&&d!==_;){var re=d,Pe=re.alternate,ot=re.stateNode;if(re=re.tag,Pe!==null&&Pe===_)break;re!==5&&re!==26&&re!==27||ot===null||(Pe=ot,A?(ot=$a(d,D),ot!=null&&q.unshift(Uh(d,ot,Pe))):A||(ot=$a(d,D),ot!=null&&q.push(Uh(d,ot,Pe)))),d=d.return}q.length!==0&&r.push({event:s,listeners:q})}var ny=/\r\n?/g,iy=/\u0000|\uFFFD/g;function Xd(r){return(typeof r=="string"?r:""+r).replace(ny,`
`).replace(iy,"")}function Nm(r,s){return s=Xd(s),Xd(r)===s}function ui(r,s,d,_,A,D){switch(d){case"children":typeof _=="string"?s==="body"||s==="textarea"&&_===""||Ga(r,_):(typeof _=="number"||typeof _=="bigint")&&s!=="body"&&Ga(r,""+_);break;case"className":Va(r,"class",_);break;case"tabIndex":Va(r,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":Va(r,d,_);break;case"style":tc(r,_,D);break;case"data":if(s!=="object"){Va(r,"data",_);break}case"src":case"href":if(_===""&&(s!=="a"||d!=="href")){r.removeAttribute(d);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=wn(""+_),r.setAttribute(d,_);break;case"action":case"formAction":if(typeof _=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(d==="formAction"?(s!=="input"&&ui(r,s,"name",A.name,A,null),ui(r,s,"formEncType",A.formEncType,A,null),ui(r,s,"formMethod",A.formMethod,A,null),ui(r,s,"formTarget",A.formTarget,A,null)):(ui(r,s,"encType",A.encType,A,null),ui(r,s,"method",A.method,A,null),ui(r,s,"target",A.target,A,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=wn(""+_),r.setAttribute(d,_);break;case"onClick":_!=null&&(r.onclick=wa);break;case"onScroll":_!=null&&Hn("scroll",r);break;case"onScrollEnd":_!=null&&Hn("scrollend",r);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(A.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"multiple":r.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":r.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){r.removeAttribute("xlink:href");break}d=wn(""+_),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""+_):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":_===!0?r.setAttribute(d,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,_):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?r.setAttribute(d,_):r.removeAttribute(d);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?r.removeAttribute(d):r.setAttribute(d,_);break;case"popover":Hn("beforetoggle",r),Hn("toggle",r),dl(r,"popover",_);break;case"xlinkActuate":Xe(r,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":Xe(r,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":Xe(r,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":Xe(r,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":Xe(r,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":Xe(r,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":Xe(r,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":Xe(r,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":Xe(r,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":dl(r,"is",_);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=gs.get(d)||d,dl(r,d,_))}}function Ep(r,s,d,_,A,D){switch(d){case"style":tc(r,_,D);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(A.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"children":typeof _=="string"?Ga(r,_):(typeof _=="number"||typeof _=="bigint")&&Ga(r,""+_);break;case"onScroll":_!=null&&Hn("scroll",r);break;case"onScrollEnd":_!=null&&Hn("scrollend",r);break;case"onClick":_!=null&&(r.onclick=wa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wr.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(A=d.endsWith("Capture"),s=d.slice(2,A?d.length-7:void 0),D=r[Rt]||null,D=D!=null?D[d]:null,typeof D=="function"&&r.removeEventListener(s,D,A),typeof _=="function")){typeof D!="function"&&D!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(s,_,A);break e}d in r?r[d]=_:_===!0?r.setAttribute(d,""):dl(r,d,_)}}}function Br(r,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Hn("error",r),Hn("load",r);var _=!1,A=!1,D;for(D in d)if(d.hasOwnProperty(D)){var q=d[D];if(q!=null)switch(D){case"src":_=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:ui(r,s,D,q,d,null)}}A&&ui(r,s,"srcSet",d.srcSet,d,null),_&&ui(r,s,"src",d.src,d,null);return;case"input":Hn("invalid",r);var re=D=q=A=null,Pe=null,ot=null;for(_ in d)if(d.hasOwnProperty(_)){var vt=d[_];if(vt!=null)switch(_){case"name":A=vt;break;case"type":q=vt;break;case"checked":Pe=vt;break;case"defaultChecked":ot=vt;break;case"value":D=vt;break;case"defaultValue":re=vt;break;case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(S(137,s));break;default:ui(r,s,_,vt,d,null)}}fl(r,D,re,Pe,ot,q,A,!1);return;case"select":Hn("invalid",r),_=q=D=null;for(A in d)if(d.hasOwnProperty(A)&&(re=d[A],re!=null))switch(A){case"value":D=re;break;case"defaultValue":q=re;break;case"multiple":_=re;default:ui(r,s,A,re,d,null)}s=D,d=q,r.multiple=!!_,s!=null?Sr(r,!!_,s,!1):d!=null&&Sr(r,!!_,d,!0);return;case"textarea":Hn("invalid",r),D=A=_=null;for(q in d)if(d.hasOwnProperty(q)&&(re=d[q],re!=null))switch(q){case"value":_=re;break;case"defaultValue":A=re;break;case"children":D=re;break;case"dangerouslySetInnerHTML":if(re!=null)throw Error(S(91));break;default:ui(r,s,q,re,d,null)}Ns(r,_,A,D);return;case"option":for(Pe in d)d.hasOwnProperty(Pe)&&(_=d[Pe],_!=null)&&(Pe==="selected"?r.selected=_&&typeof _!="function"&&typeof _!="symbol":ui(r,s,Pe,_,d,null));return;case"dialog":Hn("beforetoggle",r),Hn("toggle",r),Hn("cancel",r),Hn("close",r);break;case"iframe":case"object":Hn("load",r);break;case"video":case"audio":for(_=0;_<Ac.length;_++)Hn(Ac[_],r);break;case"image":Hn("error",r),Hn("load",r);break;case"details":Hn("toggle",r);break;case"embed":case"source":case"link":Hn("error",r),Hn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ot in d)if(d.hasOwnProperty(ot)&&(_=d[ot],_!=null))switch(ot){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:ui(r,s,ot,_,d,null)}return;default:if(js(s)){for(vt in d)d.hasOwnProperty(vt)&&(_=d[vt],_!==void 0&&Ep(r,s,vt,_,d,void 0));return}}for(re in d)d.hasOwnProperty(re)&&(_=d[re],_!=null&&ui(r,s,re,_,d,null))}function ry(r,s,d,_){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,D=null,q=null,re=null,Pe=null,ot=null,vt=null;for(pt in d){var At=d[pt];if(d.hasOwnProperty(pt)&&At!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":Pe=At;default:_.hasOwnProperty(pt)||ui(r,s,pt,null,_,At)}}for(var ct in _){var pt=_[ct];if(At=d[ct],_.hasOwnProperty(ct)&&(pt!=null||At!=null))switch(ct){case"type":D=pt;break;case"name":A=pt;break;case"checked":ot=pt;break;case"defaultChecked":vt=pt;break;case"value":q=pt;break;case"defaultValue":re=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(S(137,s));break;default:pt!==At&&ui(r,s,ct,pt,_,At)}}qa(r,q,re,Pe,ot,vt,D,A);return;case"select":pt=q=re=ct=null;for(D in d)if(Pe=d[D],d.hasOwnProperty(D)&&Pe!=null)switch(D){case"value":break;case"multiple":pt=Pe;default:_.hasOwnProperty(D)||ui(r,s,D,null,_,Pe)}for(A in _)if(D=_[A],Pe=d[A],_.hasOwnProperty(A)&&(D!=null||Pe!=null))switch(A){case"value":ct=D;break;case"defaultValue":re=D;break;case"multiple":q=D;default:D!==Pe&&ui(r,s,A,D,_,Pe)}s=re,d=q,_=pt,ct!=null?Sr(r,!!d,ct,!1):!!_!=!!d&&(s!=null?Sr(r,!!d,s,!0):Sr(r,!!d,d?[]:"",!1));return;case"textarea":pt=ct=null;for(re in d)if(A=d[re],d.hasOwnProperty(re)&&A!=null&&!_.hasOwnProperty(re))switch(re){case"value":break;case"children":break;default:ui(r,s,re,null,_,A)}for(q in _)if(A=_[q],D=d[q],_.hasOwnProperty(q)&&(A!=null||D!=null))switch(q){case"value":ct=A;break;case"defaultValue":pt=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(S(91));break;default:A!==D&&ui(r,s,q,A,_,D)}Ju(r,ct,pt);return;case"option":for(var an in d)ct=d[an],d.hasOwnProperty(an)&&ct!=null&&!_.hasOwnProperty(an)&&(an==="selected"?r.selected=!1:ui(r,s,an,null,_,ct));for(Pe in _)ct=_[Pe],pt=d[Pe],_.hasOwnProperty(Pe)&&ct!==pt&&(ct!=null||pt!=null)&&(Pe==="selected"?r.selected=ct&&typeof ct!="function"&&typeof ct!="symbol":ui(r,s,Pe,ct,_,pt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var mn in d)ct=d[mn],d.hasOwnProperty(mn)&&ct!=null&&!_.hasOwnProperty(mn)&&ui(r,s,mn,null,_,ct);for(ot in _)if(ct=_[ot],pt=d[ot],_.hasOwnProperty(ot)&&ct!==pt&&(ct!=null||pt!=null))switch(ot){case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(S(137,s));break;default:ui(r,s,ot,ct,_,pt)}return;default:if(js(s)){for(var Si in d)ct=d[Si],d.hasOwnProperty(Si)&&ct!==void 0&&!_.hasOwnProperty(Si)&&Ep(r,s,Si,void 0,_,ct);for(vt in _)ct=_[vt],pt=d[vt],!_.hasOwnProperty(vt)||ct===pt||ct===void 0&&pt===void 0||Ep(r,s,vt,ct,_,pt);return}}for(var Ge in d)ct=d[Ge],d.hasOwnProperty(Ge)&&ct!=null&&!_.hasOwnProperty(Ge)&&ui(r,s,Ge,null,_,ct);for(At in _)ct=_[At],pt=d[At],!_.hasOwnProperty(At)||ct===pt||ct==null&&pt==null||ui(r,s,At,ct,_,pt)}function ls(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Vh(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,d=performance.getEntriesByType("resource"),_=0;_<d.length;_++){var A=d[_],D=A.transferSize,q=A.initiatorType,re=A.duration;if(D&&re&&ls(q)){for(q=0,re=A.responseEnd,_+=1;_<d.length;_++){var Pe=d[_],ot=Pe.startTime;if(ot>re)break;var vt=Pe.transferSize,At=Pe.initiatorType;vt&&ls(At)&&(Pe=Pe.responseEnd,q+=vt*(Pe<re?1:(re-ot)/(Pe-ot)))}if(--_,s+=8*(D+q)/(A.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Yd=null,jm=null;function Kd(r){return r.nodeType===9?r:r.ownerDocument}function zc(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Om(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function Mp(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var kc=null;function Cp(){var r=window.event;return r&&r.type==="popstate"?r===kc?!1:(kc=r,!0):(kc=null,!1)}var Ap=typeof setTimeout=="function"?setTimeout:void 0,Bm=typeof clearTimeout=="function"?clearTimeout:void 0,Fm=typeof Promise=="function"?Promise:void 0,Um=typeof queueMicrotask=="function"?queueMicrotask:typeof Fm<"u"?function(r){return Fm.resolve(null).then(r).catch(Vm)}:Ap;function Vm(r){setTimeout(function(){throw r})}function Pc(r){return r==="head"}function ay(r,s){var d=s,_=0;do{var A=d.nextSibling;if(r.removeChild(d),A&&A.nodeType===8)if(d=A.data,d==="/$"||d==="/&"){if(_===0){r.removeChild(A),jc(s);return}_--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")_++;else if(d==="html")qh(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,qh(d);for(var D=d.firstChild;D;){var q=D.nextSibling,re=D.nodeName;D[_n]||re==="SCRIPT"||re==="STYLE"||re==="LINK"&&D.rel.toLowerCase()==="stylesheet"||d.removeChild(D),D=q}}else d==="body"&&qh(r.ownerDocument.body);d=A}while(d);jc(s)}function In(r,s){var d=r;r=0;do{var _=d.nextSibling;if(d.nodeType===1?s?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(s?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=_}while(d)}function zo(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":zo(d),Rs(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function qr(r,s,d,_){for(;r.nodeType===1;){var A=d;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!_&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(_){if(!r[_n])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(D=r.getAttribute("rel"),D==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(D!==A.rel||r.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||r.getAttribute("title")!==(A.title==null?null:A.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(D=r.getAttribute("src"),(D!==(A.src==null?null:A.src)||r.getAttribute("type")!==(A.type==null?null:A.type)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&D&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var D=A.name==null?null:""+A.name;if(A.type==="hidden"&&r.getAttribute("name")===D)return r}else return r;if(r=zs(r.nextSibling),r===null)break}return null}function ko(r,s,d){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=zs(r.nextSibling),r===null))return null;return r}function Dc(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=zs(r.nextSibling),r===null))return null;return r}function da(r){return r.data==="$?"||r.data==="$~"}function pr(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function Dr(r,s){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||d.readyState!=="loading")s();else{var _=function(){s(),d.removeEventListener("DOMContentLoaded",_)};d.addEventListener("DOMContentLoaded",_),r._reactRetry=_}}function zs(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var ja=null;function Ir(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(s===0)return zs(r.nextSibling);s--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||s++}r=r.nextSibling}return null}function Wd(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(s===0)return r;s--}else d!=="/$"&&d!=="/&"||s++}r=r.previousSibling}return null}function sy(r,s,d){switch(s=Kd(d),r){case"html":if(r=s.documentElement,!r)throw Error(S(452));return r;case"head":if(r=s.head,!r)throw Error(S(453));return r;case"body":if(r=s.body,!r)throw Error(S(454));return r;default:throw Error(S(451))}}function qh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Rs(r)}var Gr=new Map,Ou=new Set;function zp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var sl=ke.d;ke.d={f:oy,r:ly,D:Gm,C:fa,L:Po,m:pa,X:kp,S:Rc,M:$m};function oy(){var r=sl.f(),s=qd();return r||s}function ly(r){var s=fs(r);s!==null&&s.tag===5&&s.type==="form"?Cr(s):sl.r(r)}var Ic=typeof document>"u"?null:document;function qm(r,s,d){var _=Ic;if(_&&typeof s=="string"&&s){var A=xi(s);A='link[rel="'+r+'"][href="'+A+'"]',typeof d=="string"&&(A+='[crossorigin="'+d+'"]'),Ou.has(A)||(Ou.add(A),r={rel:r,crossOrigin:d,href:s},_.querySelector(A)===null&&(s=_.createElement("link"),Br(s,"link",r),Ai(s),_.head.appendChild(s)))}}function Gm(r){sl.D(r),qm("dns-prefetch",r,null)}function fa(r,s){sl.C(r,s),qm("preconnect",r,s)}function Po(r,s,d){sl.L(r,s,d);var _=Ic;if(_&&r&&s){var A='link[rel="preload"][as="'+xi(s)+'"]';s==="image"&&d&&d.imageSrcSet?(A+='[imagesrcset="'+xi(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(A+='[imagesizes="'+xi(d.imageSizes)+'"]')):A+='[href="'+xi(r)+'"]';var D=A;switch(s){case"style":D=Bu(r);break;case"script":D=Hl(r)}Gr.has(D)||(r=ne({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:r,as:s},d),Gr.set(D,r),_.querySelector(A)!==null||s==="style"&&_.querySelector(Gh(D))||s==="script"&&_.querySelector($h(D))||(s=_.createElement("link"),Br(s,"link",r),Ai(s),_.head.appendChild(s)))}}function pa(r,s){sl.m(r,s);var d=Ic;if(d&&r){var _=s&&typeof s.as=="string"?s.as:"script",A='link[rel="modulepreload"][as="'+xi(_)+'"][href="'+xi(r)+'"]',D=A;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=Hl(r)}if(!Gr.has(D)&&(r=ne({rel:"modulepreload",href:r},s),Gr.set(D,r),d.querySelector(A)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector($h(D)))return}_=d.createElement("link"),Br(_,"link",r),Ai(_),d.head.appendChild(_)}}}function Rc(r,s,d){sl.S(r,s,d);var _=Ic;if(_&&r){var A=Xr(_).hoistableStyles,D=Bu(r);s=s||"default";var q=A.get(D);if(!q){var re={loading:0,preload:null};if(q=_.querySelector(Gh(D)))re.loading=5;else{r=ne({rel:"stylesheet",href:r,"data-precedence":s},d),(d=Gr.get(D))&&Qd(r,d);var Pe=q=_.createElement("link");Ai(Pe),Br(Pe,"link",r),Pe._p=new Promise(function(ot,vt){Pe.onload=ot,Pe.onerror=vt}),Pe.addEventListener("load",function(){re.loading|=1}),Pe.addEventListener("error",function(){re.loading|=2}),re.loading|=4,Zl(q,s,_)}q={type:"stylesheet",instance:q,count:1,state:re},A.set(D,q)}}}function kp(r,s){sl.X(r,s);var d=Ic;if(d&&r){var _=Xr(d).hoistableScripts,A=Hl(r),D=_.get(A);D||(D=d.querySelector($h(A)),D||(r=ne({src:r,async:!0},s),(s=Gr.get(A))&&Pp(r,s),D=d.createElement("script"),Ai(D),Br(D,"link",r),d.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},_.set(A,D))}}function $m(r,s){sl.M(r,s);var d=Ic;if(d&&r){var _=Xr(d).hoistableScripts,A=Hl(r),D=_.get(A);D||(D=d.querySelector($h(A)),D||(r=ne({src:r,async:!0,type:"module"},s),(s=Gr.get(A))&&Pp(r,s),D=d.createElement("script"),Ai(D),Br(D,"link",r),d.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},_.set(A,D))}}function Hm(r,s,d,_){var A=(A=Dt.current)?zp(A):null;if(!A)throw Error(S(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=Bu(d.href),d=Xr(A).hoistableStyles,_=d.get(s),_||(_={type:"style",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=Bu(d.href);var D=Xr(A).hoistableStyles,q=D.get(r);if(q||(A=A.ownerDocument||A,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(r,q),(D=A.querySelector(Gh(r)))&&!D._p&&(q.instance=D,q.state.loading=5),Gr.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Gr.set(r,d),D||Xm(A,r,d,q.state))),s&&_===null)throw Error(S(528,""));return q}if(s&&_!==null)throw Error(S(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Hl(d),d=Xr(A).hoistableScripts,_=d.get(s),_||(_={type:"script",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,r))}}function Bu(r){return'href="'+xi(r)+'"'}function Gh(r){return'link[rel="stylesheet"]['+r+"]"}function Zm(r){return ne({},r,{"data-precedence":r.precedence,precedence:null})}function Xm(r,s,d,_){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?_.loading=1:(s=r.createElement("link"),_.preload=s,s.addEventListener("load",function(){return _.loading|=1}),s.addEventListener("error",function(){return _.loading|=2}),Br(s,"link",d),Ai(s),r.head.appendChild(s))}function Hl(r){return'[src="'+xi(r)+'"]'}function $h(r){return"script[async]"+r}function Ym(r,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var _=r.querySelector('style[data-href~="'+xi(d.href)+'"]');if(_)return s.instance=_,Ai(_),_;var A=ne({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return _=(r.ownerDocument||r).createElement("style"),Ai(_),Br(_,"style",A),Zl(_,d.precedence,r),s.instance=_;case"stylesheet":A=Bu(d.href);var D=r.querySelector(Gh(A));if(D)return s.state.loading|=4,s.instance=D,Ai(D),D;_=Zm(d),(A=Gr.get(A))&&Qd(_,A),D=(r.ownerDocument||r).createElement("link"),Ai(D);var q=D;return q._p=new Promise(function(re,Pe){q.onload=re,q.onerror=Pe}),Br(D,"link",_),s.state.loading|=4,Zl(D,d.precedence,r),s.instance=D;case"script":return D=Hl(d.src),(A=r.querySelector($h(D)))?(s.instance=A,Ai(A),A):(_=d,(A=Gr.get(D))&&(_=ne({},d),Pp(_,A)),r=r.ownerDocument||r,A=r.createElement("script"),Ai(A),Br(A,"link",_),r.head.appendChild(A),s.instance=A);case"void":return null;default:throw Error(S(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(_=s.instance,s.state.loading|=4,Zl(_,d.precedence,r));return s.instance}function Zl(r,s,d){for(var _=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=_.length?_[_.length-1]:null,D=A,q=0;q<_.length;q++){var re=_[q];if(re.dataset.precedence===s)D=re;else if(D!==A)break}D?D.parentNode.insertBefore(r,D.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(r,s.firstChild))}function Qd(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Pp(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Dp=null;function Km(r,s,d){if(Dp===null){var _=new Map,A=Dp=new Map;A.set(d,_)}else A=Dp,_=A.get(d),_||(_=new Map,A.set(d,_));if(_.has(r))return _;for(_.set(r,null),d=d.getElementsByTagName(r),A=0;A<d.length;A++){var D=d[A];if(!(D[_n]||D[Jn]||r==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var q=D.getAttribute(s)||"";q=r+q;var re=_.get(q);re?re.push(D):_.set(q,[D])}}return _}function Jd(r,s,d){r=r.ownerDocument||r,r.head.insertBefore(d,s==="title"?r.querySelector("head > title"):null)}function Ip(r,s,d){if(d===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function ef(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Wm(r,s,d,_){if(d.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var A=Bu(_.href),D=s.querySelector(Gh(A));if(D){s=D._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=nf.bind(r),s.then(r,r)),d.state.loading|=4,d.instance=D,Ai(D);return}D=s.ownerDocument||s,_=Zm(_),(A=Gr.get(A))&&Qd(_,A),D=D.createElement("link"),Ai(D);var q=D;q._p=new Promise(function(re,Pe){q.onload=re,q.onerror=Pe}),Br(D,"link",_),d.instance=D}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=nf.bind(r),s.addEventListener("load",d),s.addEventListener("error",d))}}var tf=0;function Qm(r,s){return r.stylesheets&&r.count===0&&af(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var _=setTimeout(function(){if(r.stylesheets&&af(r,r.stylesheets),r.unsuspend){var D=r.unsuspend;r.unsuspend=null,D()}},6e4+s);0<r.imgBytes&&tf===0&&(tf=62500*Vh());var A=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&af(r,r.stylesheets),r.unsuspend)){var D=r.unsuspend;r.unsuspend=null,D()}},(r.imgBytes>tf?50:800)+s);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(_),clearTimeout(A)}}:null}function nf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)af(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var rf=null;function af(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,rf=new Map,s.forEach(cy,r),rf=null,nf.call(r))}function cy(r,s){if(!(s.state.loading&4)){var d=rf.get(r);if(d)var _=d.get(null);else{d=new Map,rf.set(r,d);for(var A=r.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<A.length;D++){var q=A[D];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(d.set(q.dataset.precedence,q),_=q)}_&&d.set(null,_)}A=s.instance,q=A.getAttribute("data-precedence"),D=d.get(q)||_,D===_&&d.set(null,A),d.set(q,A),this.count++,_=nf.bind(this),A.addEventListener("load",_),A.addEventListener("error",_),D?D.parentNode.insertBefore(A,D.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(A,r.firstChild)),s.state.loading|=4}}var Hh={$$typeof:lt,Provider:null,Consumer:null,_currentValue:De,_currentValue2:De,_threadCount:0};function h_(r,s,d,_,A,D,q,re,Pe){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ir(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ir(0),this.hiddenUpdates=ir(null),this.identifierPrefix=_,this.onUncaughtError=A,this.onCaughtError=D,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Pe,this.incompleteTransitions=new Map}function Jm(r,s,d,_,A,D,q,re,Pe,ot,vt,At){return r=new h_(r,s,d,q,Pe,ot,vt,At,re),s=1,D===!0&&(s|=24),D=Ca(3,null,null,s),r.current=D,D.stateNode=r,s=Ys(),s.refCount++,r.pooledCache=s,s.refCount++,D.memoizedState={element:_,isDehydrated:d,cache:s},Sh(D),r}function uy(r){return r?(r=Tn,r):Tn}function hy(r,s,d,_,A,D){A=uy(A),_.context===null?_.context=A:_.pendingContext=A,_=eo(s),_.payload={element:d},D=D===void 0?null:D,D!==null&&(_.callback=D),d=xo(r,_,s),d!==null&&(os(d,r,s),Qa(d,r,s))}function Rp(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function Lp(r,s){Rp(r,s),(r=r.alternate)&&Rp(r,s)}function dy(r){if(r.tag===13||r.tag===31){var s=Ya(r,67108864);s!==null&&os(s,r,67108864),Lp(r,67108864)}}function fy(r){if(r.tag===13||r.tag===31){var s=ss();s=ds(s);var d=Ya(r,s);d!==null&&os(d,r,s),Lp(r,s)}}var sf=!0;function of(r,s,d,_){var A=le.T;le.T=null;var D=ke.p;try{ke.p=2,eg(r,s,d,_)}finally{ke.p=D,le.T=A}}function py(r,s,d,_){var A=le.T;le.T=null;var D=ke.p;try{ke.p=8,eg(r,s,d,_)}finally{ke.p=D,le.T=A}}function eg(r,s,d,_){if(sf){var A=lf(_);if(A===null)al(r,s,_,Zh,d),my(r,_);else if(f_(A,r,s,d,_))_.stopPropagation();else if(my(r,_),s&4&&-1<d_.indexOf(r)){for(;A!==null;){var D=fs(A);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var q=Ve(D.pendingLanes);if(q!==0){var re=D;for(re.pendingLanes|=2,re.entangledLanes|=2;q;){var Pe=1<<31-Je(q);re.entanglements[1]|=Pe,q&=~Pe}Ao(D),(yi&6)===0&&(Ud=kn()+500,As(0))}}break;case 31:case 13:re=Ya(D,2),re!==null&&os(re,D,2),qd(),Lp(D,2)}if(D=lf(_),D===null&&al(r,s,_,Zh,d),D===A)break;A=D}A!==null&&_.stopPropagation()}else al(r,s,_,null,d)}}function lf(r){return r=Yc(r),Np(r)}var Zh=null;function Np(r){if(Zh=null,r=Fa(r),r!==null){var s=R(r);if(s===null)r=null;else{var d=s.tag;if(d===13){if(r=E(s),r!==null)return r;r=null}else if(d===31){if(r=l(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Zh=r,null}function Fu(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Cn()){case Ue:return 2;case W:return 8;case $:case K:return 32;case ue:return 268435456;default:return 32}default:return 32}}var jp=!1,Lc=null,so=null,Nc=null,cf=new Map,Xh=new Map,Xl=[],d_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function my(r,s){switch(r){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":so=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":cf.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xh.delete(s.pointerId)}}function uf(r,s,d,_,A,D){return r===null||r.nativeEvent!==D?(r={blockedOn:s,domEventName:d,eventSystemFlags:_,nativeEvent:D,targetContainers:[A]},s!==null&&(s=fs(s),s!==null&&dy(s)),r):(r.eventSystemFlags|=_,s=r.targetContainers,A!==null&&s.indexOf(A)===-1&&s.push(A),r)}function f_(r,s,d,_,A){switch(s){case"focusin":return Lc=uf(Lc,r,s,d,_,A),!0;case"dragenter":return so=uf(so,r,s,d,_,A),!0;case"mouseover":return Nc=uf(Nc,r,s,d,_,A),!0;case"pointerover":var D=A.pointerId;return cf.set(D,uf(cf.get(D)||null,r,s,d,_,A)),!0;case"gotpointercapture":return D=A.pointerId,Xh.set(D,uf(Xh.get(D)||null,r,s,d,_,A)),!0}return!1}function gy(r){var s=Fa(r.target);if(s!==null){var d=R(s);if(d!==null){if(s=d.tag,s===13){if(s=E(d),s!==null){r.blockedOn=s,hr(r.priority,function(){fy(d)});return}}else if(s===31){if(s=l(d),s!==null){r.blockedOn=s,hr(r.priority,function(){fy(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function hf(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=lf(r.nativeEvent);if(d===null){d=r.nativeEvent;var _=new d.constructor(d.type,d);od=_,d.target.dispatchEvent(_),od=null}else return s=fs(d),s!==null&&dy(s),r.blockedOn=d,!1;s.shift()}return!0}function yy(r,s,d){hf(r)&&d.delete(s)}function df(){jp=!1,Lc!==null&&hf(Lc)&&(Lc=null),so!==null&&hf(so)&&(so=null),Nc!==null&&hf(Nc)&&(Nc=null),cf.forEach(yy),Xh.forEach(yy)}function Op(r,s){r.blockedOn===s&&(r.blockedOn=null,jp||(jp=!0,u.unstable_scheduleCallback(u.unstable_NormalPriority,df)))}var Bp=null;function _y(r){Bp!==r&&(Bp=r,u.unstable_scheduleCallback(u.unstable_NormalPriority,function(){Bp===r&&(Bp=null);for(var s=0;s<r.length;s+=3){var d=r[s],_=r[s+1],A=r[s+2];if(typeof _!="function"){if(Np(_||d)===null)continue;break}var D=fs(d);D!==null&&(r.splice(s,3),s-=3,$i(D,{pending:!0,data:A,method:d.method,action:_},_,A))}}))}function jc(r){function s(Pe){return Op(Pe,r)}Lc!==null&&Op(Lc,r),so!==null&&Op(so,r),Nc!==null&&Op(Nc,r),cf.forEach(s),Xh.forEach(s);for(var d=0;d<Xl.length;d++){var _=Xl[d];_.blockedOn===r&&(_.blockedOn=null)}for(;0<Xl.length&&(d=Xl[0],d.blockedOn===null);)gy(d),d.blockedOn===null&&Xl.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(_=0;_<d.length;_+=3){var A=d[_],D=d[_+1],q=A[Rt]||null;if(typeof D=="function")q||_y(d);else if(q){var re=null;if(D&&D.hasAttribute("formAction")){if(A=D,q=D[Rt]||null)re=q.formAction;else if(Np(A)!==null)continue}else re=q.action;typeof re=="function"?d[_+1]=re:(d.splice(_,3),_-=3),_y(d)}}}function tg(){function r(D){D.canIntercept&&D.info==="react-transition"&&D.intercept({handler:function(){return new Promise(function(q){return A=q})},focusReset:"manual",scroll:"manual"})}function s(){A!==null&&(A(),A=null),_||setTimeout(d,20)}function d(){if(!_&&!navigation.transition){var D=navigation.currentEntry;D&&D.url!=null&&navigation.navigate(D.url,{state:D.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,A=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(d,100),function(){_=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),A!==null&&(A(),A=null)}}}function ng(r){this._internalRoot=r}Fp.prototype.render=ng.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(S(409));var d=s.current,_=ss();hy(d,_,r,s,null,null)},Fp.prototype.unmount=ng.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;hy(r.current,2,null,r,null,null),qd(),s[xn]=null}};function Fp(r){this._internalRoot=r}Fp.prototype.unstable_scheduleHydration=function(r){if(r){var s=br();r={blockedOn:null,target:r,priority:s};for(var d=0;d<Xl.length&&s!==0&&s<Xl[d].priority;d++);Xl.splice(d,0,r),d===0&&gy(r)}};var ig=m.version;if(ig!=="19.2.3")throw Error(S(527,ig,"19.2.3"));ke.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(S(188)):(r=Object.keys(r).join(","),Error(S(268,r)));return r=Y(s),r=r!==null?ie(r):null,r=r===null?null:r.stateNode,r};var xy={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:le,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Up=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Up.isDisabled&&Up.supportsFiber)try{Le=Up.inject(xy),Me=Up}catch{}}return cg.createRoot=function(r,s){if(!M(r))throw Error(S(299));var d=!1,_="",A=Ch,D=To,q=Eo;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(_=s.identifierPrefix),s.onUncaughtError!==void 0&&(A=s.onUncaughtError),s.onCaughtError!==void 0&&(D=s.onCaughtError),s.onRecoverableError!==void 0&&(q=s.onRecoverableError)),s=Jm(r,1,!1,null,null,d,_,null,A,D,q,tg),r[xn]=s.current,Rm(r),new ng(s)},cg.hydrateRoot=function(r,s,d){if(!M(r))throw Error(S(299));var _=!1,A="",D=Ch,q=To,re=Eo,Pe=null;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(A=d.identifierPrefix),d.onUncaughtError!==void 0&&(D=d.onUncaughtError),d.onCaughtError!==void 0&&(q=d.onCaughtError),d.onRecoverableError!==void 0&&(re=d.onRecoverableError),d.formState!==void 0&&(Pe=d.formState)),s=Jm(r,1,!0,s,d??null,_,A,Pe,D,q,re,tg),s.context=uy(null),d=s.current,_=ss(),_=ds(_),A=eo(_),A.callback=null,xo(d,A,_),d=_,s.current.lanes=d,ei(s,d),Ao(s),r[xn]=s.current,Rm(r),new Fp(s)},cg.version="19.2.3",cg}var _x;function tw(){if(_x)return E_.exports;_x=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(m){console.error(m)}}return u(),E_.exports=ew(),E_.exports}var nw=tw();const iw=vg(nw),rw="modulepreload",aw=function(u){return"/parlens-pwa/"+u},xx={},Dy=function(m,v,S){let M=Promise.resolve();if(v&&v.length>0){let Y=function(ie){return Promise.all(ie.map(ne=>Promise.resolve(ne).then(ze=>({status:"fulfilled",value:ze}),ze=>({status:"rejected",reason:ze}))))};var E=Y;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),O=l?.nonce||l?.getAttribute("nonce");M=Y(v.map(ie=>{if(ie=aw(ie),ie in xx)return;xx[ie]=!0;const ne=ie.endsWith(".css"),ze=ne?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${ie}"]${ze}`))return;const Ce=document.createElement("link");if(Ce.rel=ne?"stylesheet":rw,ne||(Ce.as="script"),Ce.crossOrigin="",Ce.href=ie,O&&Ce.setAttribute("nonce",O),document.head.appendChild(Ce),ne)return new Promise((be,he)=>{Ce.addEventListener("load",be),Ce.addEventListener("error",()=>he(new Error(`Unable to preload CSS for ${ie}`)))})}))}function R(l){const O=new Event("vite:preloadError",{cancelable:!0});if(O.payload=l,window.dispatchEvent(O),!O.defaultPrevented)throw l}return M.then(l=>{for(const O of l||[])O.status==="rejected"&&R(O.reason);return m().catch(R)})};function vx(u){if(!Number.isSafeInteger(u)||u<0)throw new Error(`Wrong positive integer: ${u}`)}function vv(u,...m){if(!(u instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(u.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${u.length}`)}function sw(u){if(typeof u!="function"||typeof u.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");vx(u.outputLen),vx(u.blockLen)}function Iy(u,m=!0){if(u.destroyed)throw new Error("Hash instance has been destroyed");if(m&&u.finished)throw new Error("Hash#digest() has already been called")}function ow(u,m){vv(u);const v=m.outputLen;if(u.length<v)throw new Error(`digestInto() expects output buffer of length at least ${v}`)}const z_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const bv=u=>u instanceof Uint8Array,k_=u=>new DataView(u.buffer,u.byteOffset,u.byteLength),Bc=(u,m)=>u<<32-m|u>>>m,lw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!lw)throw new Error("Non little-endian hardware is not supported");function cw(u){if(typeof u!="string")throw new Error(`utf8ToBytes expected string, got ${typeof u}`);return new Uint8Array(new TextEncoder().encode(u))}function m0(u){if(typeof u=="string"&&(u=cw(u)),!bv(u))throw new Error(`expected Uint8Array, got ${typeof u}`);return u}function uw(...u){const m=new Uint8Array(u.reduce((S,M)=>S+M.length,0));let v=0;return u.forEach(S=>{if(!bv(S))throw new Error("Uint8Array expected");m.set(S,v),v+=S.length}),m}let wv=class{clone(){return this._cloneInto()}};function hw(u){const m=S=>u().update(m0(S)).digest(),v=u();return m.outputLen=v.outputLen,m.blockLen=v.blockLen,m.create=()=>u(),m}function Sv(u=32){if(z_&&typeof z_.getRandomValues=="function")return z_.getRandomValues(new Uint8Array(u));throw new Error("crypto.getRandomValues must be defined")}function dw(u,m,v,S){if(typeof u.setBigUint64=="function")return u.setBigUint64(m,v,S);const M=BigInt(32),R=BigInt(4294967295),E=Number(v>>M&R),l=Number(v&R),O=S?4:0,Y=S?0:4;u.setUint32(m+O,E,S),u.setUint32(m+Y,l,S)}let fw=class extends wv{constructor(m,v,S,M){super(),this.blockLen=m,this.outputLen=v,this.padOffset=S,this.isLE=M,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=k_(this.buffer)}update(m){Iy(this);const{view:v,buffer:S,blockLen:M}=this;m=m0(m);const R=m.length;for(let E=0;E<R;){const l=Math.min(M-this.pos,R-E);if(l===M){const O=k_(m);for(;M<=R-E;E+=M)this.process(O,E);continue}S.set(m.subarray(E,E+l),this.pos),this.pos+=l,E+=l,this.pos===M&&(this.process(v,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){Iy(this),ow(m,this),this.finished=!0;const{buffer:v,view:S,blockLen:M,isLE:R}=this;let{pos:E}=this;v[E++]=128,this.buffer.subarray(E).fill(0),this.padOffset>M-E&&(this.process(S,0),E=0);for(let ne=E;ne<M;ne++)v[ne]=0;dw(S,M-8,BigInt(this.length*8),R),this.process(S,0);const l=k_(m),O=this.outputLen;if(O%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Y=O/4,ie=this.get();if(Y>ie.length)throw new Error("_sha2: outputLen bigger than state");for(let ne=0;ne<Y;ne++)l.setUint32(4*ne,ie[ne],R)}digest(){const{buffer:m,outputLen:v}=this;this.digestInto(m);const S=m.slice(0,v);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:v,buffer:S,length:M,finished:R,destroyed:E,pos:l}=this;return m.length=M,m.pos=l,m.finished=R,m.destroyed=E,M%v&&m.buffer.set(S),m}};const pw=(u,m,v)=>u&m^~u&v,mw=(u,m,v)=>u&m^u&v^m&v,gw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Kh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Wh=new Uint32Array(64);let yw=class extends fw{constructor(){super(64,32,8,!1),this.A=Kh[0]|0,this.B=Kh[1]|0,this.C=Kh[2]|0,this.D=Kh[3]|0,this.E=Kh[4]|0,this.F=Kh[5]|0,this.G=Kh[6]|0,this.H=Kh[7]|0}get(){const{A:m,B:v,C:S,D:M,E:R,F:E,G:l,H:O}=this;return[m,v,S,M,R,E,l,O]}set(m,v,S,M,R,E,l,O){this.A=m|0,this.B=v|0,this.C=S|0,this.D=M|0,this.E=R|0,this.F=E|0,this.G=l|0,this.H=O|0}process(m,v){for(let ne=0;ne<16;ne++,v+=4)Wh[ne]=m.getUint32(v,!1);for(let ne=16;ne<64;ne++){const ze=Wh[ne-15],Ce=Wh[ne-2],be=Bc(ze,7)^Bc(ze,18)^ze>>>3,he=Bc(Ce,17)^Bc(Ce,19)^Ce>>>10;Wh[ne]=he+Wh[ne-7]+be+Wh[ne-16]|0}let{A:S,B:M,C:R,D:E,E:l,F:O,G:Y,H:ie}=this;for(let ne=0;ne<64;ne++){const ze=Bc(l,6)^Bc(l,11)^Bc(l,25),Ce=ie+ze+pw(l,O,Y)+gw[ne]+Wh[ne]|0,he=(Bc(S,2)^Bc(S,13)^Bc(S,22))+mw(S,M,R)|0;ie=Y,Y=O,O=l,l=E+Ce|0,E=R,R=M,M=S,S=Ce+he|0}S=S+this.A|0,M=M+this.B|0,R=R+this.C|0,E=E+this.D|0,l=l+this.E|0,O=O+this.F|0,Y=Y+this.G|0,ie=ie+this.H|0,this.set(S,M,R,E,l,O,Y,ie)}roundClean(){Wh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Z_=hw(()=>new yw);const Tv=BigInt(0),Vy=BigInt(1),_w=BigInt(2),qy=u=>u instanceof Uint8Array,xw=Array.from({length:256},(u,m)=>m.toString(16).padStart(2,"0"));function Yp(u){if(!qy(u))throw new Error("Uint8Array expected");let m="";for(let v=0;v<u.length;v++)m+=xw[u[v]];return m}function Ev(u){const m=u.toString(16);return m.length&1?`0${m}`:m}function g0(u){if(typeof u!="string")throw new Error("hex string expected, got "+typeof u);return BigInt(u===""?"0":`0x${u}`)}function Kp(u){if(typeof u!="string")throw new Error("hex string expected, got "+typeof u);const m=u.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const v=new Uint8Array(m/2);for(let S=0;S<v.length;S++){const M=S*2,R=u.slice(M,M+2),E=Number.parseInt(R,16);if(Number.isNaN(E)||E<0)throw new Error("Invalid byte sequence");v[S]=E}return v}function lo(u){return g0(Yp(u))}function y0(u){if(!qy(u))throw new Error("Uint8Array expected");return g0(Yp(Uint8Array.from(u).reverse()))}function id(u,m){return Kp(u.toString(16).padStart(m*2,"0"))}function _0(u,m){return id(u,m).reverse()}function vw(u){return Kp(Ev(u))}function us(u,m,v){let S;if(typeof m=="string")try{S=Kp(m)}catch(R){throw new Error(`${u} must be valid hex string, got "${m}". Cause: ${R}`)}else if(qy(m))S=Uint8Array.from(m);else throw new Error(`${u} must be hex string or Uint8Array`);const M=S.length;if(typeof v=="number"&&M!==v)throw new Error(`${u} expected ${v} bytes, got ${M}`);return S}function Tf(...u){const m=new Uint8Array(u.reduce((S,M)=>S+M.length,0));let v=0;return u.forEach(S=>{if(!qy(S))throw new Error("Uint8Array expected");m.set(S,v),v+=S.length}),m}function bw(u,m){if(u.length!==m.length)return!1;for(let v=0;v<u.length;v++)if(u[v]!==m[v])return!1;return!0}function ww(u){if(typeof u!="string")throw new Error(`utf8ToBytes expected string, got ${typeof u}`);return new Uint8Array(new TextEncoder().encode(u))}function Sw(u){let m;for(m=0;u>Tv;u>>=Vy,m+=1);return m}function Tw(u,m){return u>>BigInt(m)&Vy}const Ew=(u,m,v)=>u|(v?Vy:Tv)<<BigInt(m),x0=u=>(_w<<BigInt(u-1))-Vy,P_=u=>new Uint8Array(u),bx=u=>Uint8Array.from(u);function Mv(u,m,v){if(typeof u!="number"||u<2)throw new Error("hashLen must be a number");if(typeof m!="number"||m<2)throw new Error("qByteLen must be a number");if(typeof v!="function")throw new Error("hmacFn must be a function");let S=P_(u),M=P_(u),R=0;const E=()=>{S.fill(1),M.fill(0),R=0},l=(...ne)=>v(M,S,...ne),O=(ne=P_())=>{M=l(bx([0]),ne),S=l(),ne.length!==0&&(M=l(bx([1]),ne),S=l())},Y=()=>{if(R++>=1e3)throw new Error("drbg: tried 1000 values");let ne=0;const ze=[];for(;ne<m;){S=l();const Ce=S.slice();ze.push(Ce),ne+=S.length}return Tf(...ze)};return(ne,ze)=>{E(),O(ne);let Ce;for(;!(Ce=ze(Y()));)O();return E(),Ce}}const Mw={bigint:u=>typeof u=="bigint",function:u=>typeof u=="function",boolean:u=>typeof u=="boolean",string:u=>typeof u=="string",stringOrUint8Array:u=>typeof u=="string"||u instanceof Uint8Array,isSafeInteger:u=>Number.isSafeInteger(u),array:u=>Array.isArray(u),field:(u,m)=>m.Fp.isValid(u),hash:u=>typeof u=="function"&&Number.isSafeInteger(u.outputLen)};function bg(u,m,v={}){const S=(M,R,E)=>{const l=Mw[R];if(typeof l!="function")throw new Error(`Invalid validator "${R}", expected function`);const O=u[M];if(!(E&&O===void 0)&&!l(O,u))throw new Error(`Invalid param ${String(M)}=${O} (${typeof O}), expected ${R}`)};for(const[M,R]of Object.entries(m))S(M,R,!1);for(const[M,R]of Object.entries(v))S(M,R,!0);return u}const Cw=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Tw,bitLen:Sw,bitMask:x0,bitSet:Ew,bytesToHex:Yp,bytesToNumberBE:lo,bytesToNumberLE:y0,concatBytes:Tf,createHmacDrbg:Mv,ensureBytes:us,equalBytes:bw,hexToBytes:Kp,hexToNumber:g0,numberToBytesBE:id,numberToBytesLE:_0,numberToHexUnpadded:Ev,numberToVarBytesBE:vw,utf8ToBytes:ww,validateObject:bg},Symbol.toStringTag,{value:"Module"}));const ya=BigInt(0),Fr=BigInt(1),vf=BigInt(2),Aw=BigInt(3),X_=BigInt(4),wx=BigInt(5),Sx=BigInt(8);BigInt(9);BigInt(16);function Ba(u,m){const v=u%m;return v>=ya?v:m+v}function zw(u,m,v){if(v<=ya||m<ya)throw new Error("Expected power/modulo > 0");if(v===Fr)return ya;let S=Fr;for(;m>ya;)m&Fr&&(S=S*u%v),u=u*u%v,m>>=Fr;return S}function ll(u,m,v){let S=u;for(;m-- >ya;)S*=S,S%=v;return S}function Y_(u,m){if(u===ya||m<=ya)throw new Error(`invert: expected positive integers, got n=${u} mod=${m}`);let v=Ba(u,m),S=m,M=ya,R=Fr;for(;v!==ya;){const l=S/v,O=S%v,Y=M-R*l;S=v,v=O,M=R,R=Y}if(S!==Fr)throw new Error("invert: does not exist");return Ba(M,m)}function kw(u){const m=(u-Fr)/vf;let v,S,M;for(v=u-Fr,S=0;v%vf===ya;v/=vf,S++);for(M=vf;M<u&&zw(M,m,u)!==u-Fr;M++);if(S===1){const E=(u+Fr)/X_;return function(O,Y){const ie=O.pow(Y,E);if(!O.eql(O.sqr(ie),Y))throw new Error("Cannot find square root");return ie}}const R=(v+Fr)/vf;return function(l,O){if(l.pow(O,m)===l.neg(l.ONE))throw new Error("Cannot find square root");let Y=S,ie=l.pow(l.mul(l.ONE,M),v),ne=l.pow(O,R),ze=l.pow(O,v);for(;!l.eql(ze,l.ONE);){if(l.eql(ze,l.ZERO))return l.ZERO;let Ce=1;for(let he=l.sqr(ze);Ce<Y&&!l.eql(he,l.ONE);Ce++)he=l.sqr(he);const be=l.pow(ie,Fr<<BigInt(Y-Ce-1));ie=l.sqr(be),ne=l.mul(ne,be),ze=l.mul(ze,ie),Y=Ce}return ne}}function Pw(u){if(u%X_===Aw){const m=(u+Fr)/X_;return function(S,M){const R=S.pow(M,m);if(!S.eql(S.sqr(R),M))throw new Error("Cannot find square root");return R}}if(u%Sx===wx){const m=(u-wx)/Sx;return function(S,M){const R=S.mul(M,vf),E=S.pow(R,m),l=S.mul(M,E),O=S.mul(S.mul(l,vf),E),Y=S.mul(l,S.sub(O,S.ONE));if(!S.eql(S.sqr(Y),M))throw new Error("Cannot find square root");return Y}}return kw(u)}const Dw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Iw(u){const m={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},v=Dw.reduce((S,M)=>(S[M]="function",S),m);return bg(u,v)}function Rw(u,m,v){if(v<ya)throw new Error("Expected power > 0");if(v===ya)return u.ONE;if(v===Fr)return m;let S=u.ONE,M=m;for(;v>ya;)v&Fr&&(S=u.mul(S,M)),M=u.sqr(M),v>>=Fr;return S}function Lw(u,m){const v=new Array(m.length),S=m.reduce((R,E,l)=>u.is0(E)?R:(v[l]=R,u.mul(R,E)),u.ONE),M=u.inv(S);return m.reduceRight((R,E,l)=>u.is0(E)?R:(v[l]=u.mul(R,v[l]),u.mul(R,E)),M),v}function Cv(u,m){const v=m!==void 0?m:u.toString(2).length,S=Math.ceil(v/8);return{nBitLength:v,nByteLength:S}}function Nw(u,m,v=!1,S={}){if(u<=ya)throw new Error(`Expected Field ORDER > 0, got ${u}`);const{nBitLength:M,nByteLength:R}=Cv(u,m);if(R>2048)throw new Error("Field lengths over 2048 bytes are not supported");const E=Pw(u),l=Object.freeze({ORDER:u,BITS:M,BYTES:R,MASK:x0(M),ZERO:ya,ONE:Fr,create:O=>Ba(O,u),isValid:O=>{if(typeof O!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof O}`);return ya<=O&&O<u},is0:O=>O===ya,isOdd:O=>(O&Fr)===Fr,neg:O=>Ba(-O,u),eql:(O,Y)=>O===Y,sqr:O=>Ba(O*O,u),add:(O,Y)=>Ba(O+Y,u),sub:(O,Y)=>Ba(O-Y,u),mul:(O,Y)=>Ba(O*Y,u),pow:(O,Y)=>Rw(l,O,Y),div:(O,Y)=>Ba(O*Y_(Y,u),u),sqrN:O=>O*O,addN:(O,Y)=>O+Y,subN:(O,Y)=>O-Y,mulN:(O,Y)=>O*Y,inv:O=>Y_(O,u),sqrt:S.sqrt||(O=>E(l,O)),invertBatch:O=>Lw(l,O),cmov:(O,Y,ie)=>ie?Y:O,toBytes:O=>v?_0(O,R):id(O,R),fromBytes:O=>{if(O.length!==R)throw new Error(`Fp.fromBytes: expected ${R}, got ${O.length}`);return v?y0(O):lo(O)}});return Object.freeze(l)}function Av(u){if(typeof u!="bigint")throw new Error("field order must be bigint");const m=u.toString(2).length;return Math.ceil(m/8)}function zv(u){const m=Av(u);return m+Math.ceil(m/2)}function jw(u,m,v=!1){const S=u.length,M=Av(m),R=zv(m);if(S<16||S<R||S>1024)throw new Error(`expected ${R}-1024 bytes of input, got ${S}`);const E=v?lo(u):y0(u),l=Ba(E,m-Fr)+Fr;return v?_0(l,M):id(l,M)}const Ow=BigInt(0),D_=BigInt(1);function Bw(u,m){const v=(M,R)=>{const E=R.negate();return M?E:R},S=M=>{const R=Math.ceil(m/M)+1,E=2**(M-1);return{windows:R,windowSize:E}};return{constTimeNegate:v,unsafeLadder(M,R){let E=u.ZERO,l=M;for(;R>Ow;)R&D_&&(E=E.add(l)),l=l.double(),R>>=D_;return E},precomputeWindow(M,R){const{windows:E,windowSize:l}=S(R),O=[];let Y=M,ie=Y;for(let ne=0;ne<E;ne++){ie=Y,O.push(ie);for(let ze=1;ze<l;ze++)ie=ie.add(Y),O.push(ie);Y=ie.double()}return O},wNAF(M,R,E){const{windows:l,windowSize:O}=S(M);let Y=u.ZERO,ie=u.BASE;const ne=BigInt(2**M-1),ze=2**M,Ce=BigInt(M);for(let be=0;be<l;be++){const he=be*O;let te=Number(E&ne);E>>=Ce,te>O&&(te-=ze,E+=D_);const ve=he,qe=he+Math.abs(te)-1,lt=be%2!==0,Pt=te<0;te===0?ie=ie.add(v(lt,R[ve])):Y=Y.add(v(Pt,R[qe]))}return{p:Y,f:ie}},wNAFCached(M,R,E,l){const O=M._WINDOW_SIZE||1;let Y=R.get(M);return Y||(Y=this.precomputeWindow(M,O),O!==1&&R.set(M,l(Y))),this.wNAF(O,Y,E)}}}function kv(u){return Iw(u.Fp),bg(u,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Cv(u.n,u.nBitLength),...u,p:u.Fp.ORDER})}function Fw(u){const m=kv(u);bg(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:v,Fp:S,a:M}=m;if(v){if(!S.eql(M,S.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof v!="object"||typeof v.beta!="bigint"||typeof v.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})}const{bytesToNumberBE:Uw,hexToBytes:Vw}=Cw,wf={Err:class extends Error{constructor(m=""){super(m)}},_parseInt(u){const{Err:m}=wf;if(u.length<2||u[0]!==2)throw new m("Invalid signature integer tag");const v=u[1],S=u.subarray(2,v+2);if(!v||S.length!==v)throw new m("Invalid signature integer: wrong length");if(S[0]&128)throw new m("Invalid signature integer: negative");if(S[0]===0&&!(S[1]&128))throw new m("Invalid signature integer: unnecessary leading zero");return{d:Uw(S),l:u.subarray(v+2)}},toSig(u){const{Err:m}=wf,v=typeof u=="string"?Vw(u):u;if(!(v instanceof Uint8Array))throw new Error("ui8a expected");let S=v.length;if(S<2||v[0]!=48)throw new m("Invalid signature tag");if(v[1]!==S-2)throw new m("Invalid signature: incorrect length");const{d:M,l:R}=wf._parseInt(v.subarray(2)),{d:E,l}=wf._parseInt(R);if(l.length)throw new m("Invalid signature: left bytes after parsing");return{r:M,s:E}},hexFromSig(u){const m=Y=>Number.parseInt(Y[0],16)&8?"00"+Y:Y,v=Y=>{const ie=Y.toString(16);return ie.length&1?`0${ie}`:ie},S=m(v(u.s)),M=m(v(u.r)),R=S.length/2,E=M.length/2,l=v(R),O=v(E);return`30${v(E+R+4)}02${O}${M}02${l}${S}`}},$u=BigInt(0),cl=BigInt(1);BigInt(2);const Tx=BigInt(3);BigInt(4);function qw(u){const m=Fw(u),{Fp:v}=m,S=m.toBytes||((be,he,te)=>{const ve=he.toAffine();return Tf(Uint8Array.from([4]),v.toBytes(ve.x),v.toBytes(ve.y))}),M=m.fromBytes||(be=>{const he=be.subarray(1),te=v.fromBytes(he.subarray(0,v.BYTES)),ve=v.fromBytes(he.subarray(v.BYTES,2*v.BYTES));return{x:te,y:ve}});function R(be){const{a:he,b:te}=m,ve=v.sqr(be),qe=v.mul(ve,be);return v.add(v.add(qe,v.mul(be,he)),te)}if(!v.eql(v.sqr(m.Gy),R(m.Gx)))throw new Error("bad generator point: equation left != right");function E(be){return typeof be=="bigint"&&$u<be&&be<m.n}function l(be){if(!E(be))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function O(be){const{allowedPrivateKeyLengths:he,nByteLength:te,wrapPrivateKey:ve,n:qe}=m;if(he&&typeof be!="bigint"){if(be instanceof Uint8Array&&(be=Yp(be)),typeof be!="string"||!he.includes(be.length))throw new Error("Invalid key");be=be.padStart(te*2,"0")}let lt;try{lt=typeof be=="bigint"?be:lo(us("private key",be,te))}catch{throw new Error(`private key must be ${te} bytes, hex or bigint, not ${typeof be}`)}return ve&&(lt=Ba(lt,qe)),l(lt),lt}const Y=new Map;function ie(be){if(!(be instanceof ne))throw new Error("ProjectivePoint expected")}class ne{constructor(he,te,ve){if(this.px=he,this.py=te,this.pz=ve,he==null||!v.isValid(he))throw new Error("x required");if(te==null||!v.isValid(te))throw new Error("y required");if(ve==null||!v.isValid(ve))throw new Error("z required")}static fromAffine(he){const{x:te,y:ve}=he||{};if(!he||!v.isValid(te)||!v.isValid(ve))throw new Error("invalid affine point");if(he instanceof ne)throw new Error("projective point not allowed");const qe=lt=>v.eql(lt,v.ZERO);return qe(te)&&qe(ve)?ne.ZERO:new ne(te,ve,v.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(he){const te=v.invertBatch(he.map(ve=>ve.pz));return he.map((ve,qe)=>ve.toAffine(te[qe])).map(ne.fromAffine)}static fromHex(he){const te=ne.fromAffine(M(us("pointHex",he)));return te.assertValidity(),te}static fromPrivateKey(he){return ne.BASE.multiply(O(he))}_setWindowSize(he){this._WINDOW_SIZE=he,Y.delete(this)}assertValidity(){if(this.is0()){if(m.allowInfinityPoint&&!v.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:he,y:te}=this.toAffine();if(!v.isValid(he)||!v.isValid(te))throw new Error("bad point: x or y not FE");const ve=v.sqr(te),qe=R(he);if(!v.eql(ve,qe))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:he}=this.toAffine();if(v.isOdd)return!v.isOdd(he);throw new Error("Field doesn't support isOdd")}equals(he){ie(he);const{px:te,py:ve,pz:qe}=this,{px:lt,py:Pt,pz:Et}=he,St=v.eql(v.mul(te,Et),v.mul(lt,qe)),nt=v.eql(v.mul(ve,Et),v.mul(Pt,qe));return St&&nt}negate(){return new ne(this.px,v.neg(this.py),this.pz)}double(){const{a:he,b:te}=m,ve=v.mul(te,Tx),{px:qe,py:lt,pz:Pt}=this;let Et=v.ZERO,St=v.ZERO,nt=v.ZERO,Be=v.mul(qe,qe),it=v.mul(lt,lt),$e=v.mul(Pt,Pt),we=v.mul(qe,lt);return we=v.add(we,we),nt=v.mul(qe,Pt),nt=v.add(nt,nt),Et=v.mul(he,nt),St=v.mul(ve,$e),St=v.add(Et,St),Et=v.sub(it,St),St=v.add(it,St),St=v.mul(Et,St),Et=v.mul(we,Et),nt=v.mul(ve,nt),$e=v.mul(he,$e),we=v.sub(Be,$e),we=v.mul(he,we),we=v.add(we,nt),nt=v.add(Be,Be),Be=v.add(nt,Be),Be=v.add(Be,$e),Be=v.mul(Be,we),St=v.add(St,Be),$e=v.mul(lt,Pt),$e=v.add($e,$e),Be=v.mul($e,we),Et=v.sub(Et,Be),nt=v.mul($e,it),nt=v.add(nt,nt),nt=v.add(nt,nt),new ne(Et,St,nt)}add(he){ie(he);const{px:te,py:ve,pz:qe}=this,{px:lt,py:Pt,pz:Et}=he;let St=v.ZERO,nt=v.ZERO,Be=v.ZERO;const it=m.a,$e=v.mul(m.b,Tx);let we=v.mul(te,lt),Qe=v.mul(ve,Pt),ut=v.mul(qe,Et),Ye=v.add(te,ve),Ie=v.add(lt,Pt);Ye=v.mul(Ye,Ie),Ie=v.add(we,Qe),Ye=v.sub(Ye,Ie),Ie=v.add(te,qe);let le=v.add(lt,Et);return Ie=v.mul(Ie,le),le=v.add(we,ut),Ie=v.sub(Ie,le),le=v.add(ve,qe),St=v.add(Pt,Et),le=v.mul(le,St),St=v.add(Qe,ut),le=v.sub(le,St),Be=v.mul(it,Ie),St=v.mul($e,ut),Be=v.add(St,Be),St=v.sub(Qe,Be),Be=v.add(Qe,Be),nt=v.mul(St,Be),Qe=v.add(we,we),Qe=v.add(Qe,we),ut=v.mul(it,ut),Ie=v.mul($e,Ie),Qe=v.add(Qe,ut),ut=v.sub(we,ut),ut=v.mul(it,ut),Ie=v.add(Ie,ut),we=v.mul(Qe,Ie),nt=v.add(nt,we),we=v.mul(le,Ie),St=v.mul(Ye,St),St=v.sub(St,we),we=v.mul(Ye,Qe),Be=v.mul(le,Be),Be=v.add(Be,we),new ne(St,nt,Be)}subtract(he){return this.add(he.negate())}is0(){return this.equals(ne.ZERO)}wNAF(he){return Ce.wNAFCached(this,Y,he,te=>{const ve=v.invertBatch(te.map(qe=>qe.pz));return te.map((qe,lt)=>qe.toAffine(ve[lt])).map(ne.fromAffine)})}multiplyUnsafe(he){const te=ne.ZERO;if(he===$u)return te;if(l(he),he===cl)return this;const{endo:ve}=m;if(!ve)return Ce.unsafeLadder(this,he);let{k1neg:qe,k1:lt,k2neg:Pt,k2:Et}=ve.splitScalar(he),St=te,nt=te,Be=this;for(;lt>$u||Et>$u;)lt&cl&&(St=St.add(Be)),Et&cl&&(nt=nt.add(Be)),Be=Be.double(),lt>>=cl,Et>>=cl;return qe&&(St=St.negate()),Pt&&(nt=nt.negate()),nt=new ne(v.mul(nt.px,ve.beta),nt.py,nt.pz),St.add(nt)}multiply(he){l(he);let te=he,ve,qe;const{endo:lt}=m;if(lt){const{k1neg:Pt,k1:Et,k2neg:St,k2:nt}=lt.splitScalar(te);let{p:Be,f:it}=this.wNAF(Et),{p:$e,f:we}=this.wNAF(nt);Be=Ce.constTimeNegate(Pt,Be),$e=Ce.constTimeNegate(St,$e),$e=new ne(v.mul($e.px,lt.beta),$e.py,$e.pz),ve=Be.add($e),qe=it.add(we)}else{const{p:Pt,f:Et}=this.wNAF(te);ve=Pt,qe=Et}return ne.normalizeZ([ve,qe])[0]}multiplyAndAddUnsafe(he,te,ve){const qe=ne.BASE,lt=(Et,St)=>St===$u||St===cl||!Et.equals(qe)?Et.multiplyUnsafe(St):Et.multiply(St),Pt=lt(this,te).add(lt(he,ve));return Pt.is0()?void 0:Pt}toAffine(he){const{px:te,py:ve,pz:qe}=this,lt=this.is0();he==null&&(he=lt?v.ONE:v.inv(qe));const Pt=v.mul(te,he),Et=v.mul(ve,he),St=v.mul(qe,he);if(lt)return{x:v.ZERO,y:v.ZERO};if(!v.eql(St,v.ONE))throw new Error("invZ was invalid");return{x:Pt,y:Et}}isTorsionFree(){const{h:he,isTorsionFree:te}=m;if(he===cl)return!0;if(te)return te(ne,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:he,clearCofactor:te}=m;return he===cl?this:te?te(ne,this):this.multiplyUnsafe(m.h)}toRawBytes(he=!0){return this.assertValidity(),S(ne,this,he)}toHex(he=!0){return Yp(this.toRawBytes(he))}}ne.BASE=new ne(m.Gx,m.Gy,v.ONE),ne.ZERO=new ne(v.ZERO,v.ONE,v.ZERO);const ze=m.nBitLength,Ce=Bw(ne,m.endo?Math.ceil(ze/2):ze);return{CURVE:m,ProjectivePoint:ne,normPrivateKeyToScalar:O,weierstrassEquation:R,isWithinCurveOrder:E}}function Gw(u){const m=kv(u);return bg(m,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...m})}function $w(u){const m=Gw(u),{Fp:v,n:S}=m,M=v.BYTES+1,R=2*v.BYTES+1;function E(Ie){return $u<Ie&&Ie<v.ORDER}function l(Ie){return Ba(Ie,S)}function O(Ie){return Y_(Ie,S)}const{ProjectivePoint:Y,normPrivateKeyToScalar:ie,weierstrassEquation:ne,isWithinCurveOrder:ze}=qw({...m,toBytes(Ie,le,ke){const De=le.toAffine(),Fe=v.toBytes(De.x),bt=Tf;return ke?bt(Uint8Array.from([le.hasEvenY()?2:3]),Fe):bt(Uint8Array.from([4]),Fe,v.toBytes(De.y))},fromBytes(Ie){const le=Ie.length,ke=Ie[0],De=Ie.subarray(1);if(le===M&&(ke===2||ke===3)){const Fe=lo(De);if(!E(Fe))throw new Error("Point is not on curve");const bt=ne(Fe);let de=v.sqrt(bt);const He=(de&cl)===cl;return(ke&1)===1!==He&&(de=v.neg(de)),{x:Fe,y:de}}else if(le===R&&ke===4){const Fe=v.fromBytes(De.subarray(0,v.BYTES)),bt=v.fromBytes(De.subarray(v.BYTES,2*v.BYTES));return{x:Fe,y:bt}}else throw new Error(`Point of length ${le} was invalid. Expected ${M} compressed bytes or ${R} uncompressed bytes`)}}),Ce=Ie=>Yp(id(Ie,m.nByteLength));function be(Ie){const le=S>>cl;return Ie>le}function he(Ie){return be(Ie)?l(-Ie):Ie}const te=(Ie,le,ke)=>lo(Ie.slice(le,ke));class ve{constructor(le,ke,De){this.r=le,this.s=ke,this.recovery=De,this.assertValidity()}static fromCompact(le){const ke=m.nByteLength;return le=us("compactSignature",le,ke*2),new ve(te(le,0,ke),te(le,ke,2*ke))}static fromDER(le){const{r:ke,s:De}=wf.toSig(us("DER",le));return new ve(ke,De)}assertValidity(){if(!ze(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!ze(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(le){return new ve(this.r,this.s,le)}recoverPublicKey(le){const{r:ke,s:De,recovery:Fe}=this,bt=nt(us("msgHash",le));if(Fe==null||![0,1,2,3].includes(Fe))throw new Error("recovery id invalid");const de=Fe===2||Fe===3?ke+m.n:ke;if(de>=v.ORDER)throw new Error("recovery id 2 or 3 invalid");const He=(Fe&1)===0?"02":"03",_t=Y.fromHex(He+Ce(de)),It=O(de),Ze=l(-bt*It),Dt=l(De*It),jt=Y.BASE.multiplyAndAddUnsafe(_t,Ze,Dt);if(!jt)throw new Error("point at infinify");return jt.assertValidity(),jt}hasHighS(){return be(this.s)}normalizeS(){return this.hasHighS()?new ve(this.r,l(-this.s),this.recovery):this}toDERRawBytes(){return Kp(this.toDERHex())}toDERHex(){return wf.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Kp(this.toCompactHex())}toCompactHex(){return Ce(this.r)+Ce(this.s)}}const qe={isValidPrivateKey(Ie){try{return ie(Ie),!0}catch{return!1}},normPrivateKeyToScalar:ie,randomPrivateKey:()=>{const Ie=zv(m.n);return jw(m.randomBytes(Ie),m.n)},precompute(Ie=8,le=Y.BASE){return le._setWindowSize(Ie),le.multiply(BigInt(3)),le}};function lt(Ie,le=!0){return Y.fromPrivateKey(Ie).toRawBytes(le)}function Pt(Ie){const le=Ie instanceof Uint8Array,ke=typeof Ie=="string",De=(le||ke)&&Ie.length;return le?De===M||De===R:ke?De===2*M||De===2*R:Ie instanceof Y}function Et(Ie,le,ke=!0){if(Pt(Ie))throw new Error("first arg must be private key");if(!Pt(le))throw new Error("second arg must be public key");return Y.fromHex(le).multiply(ie(Ie)).toRawBytes(ke)}const St=m.bits2int||function(Ie){const le=lo(Ie),ke=Ie.length*8-m.nBitLength;return ke>0?le>>BigInt(ke):le},nt=m.bits2int_modN||function(Ie){return l(St(Ie))},Be=x0(m.nBitLength);function it(Ie){if(typeof Ie!="bigint")throw new Error("bigint expected");if(!($u<=Ie&&Ie<Be))throw new Error(`bigint expected < 2^${m.nBitLength}`);return id(Ie,m.nByteLength)}function $e(Ie,le,ke=we){if(["recovered","canonical"].some(Ot=>Ot in ke))throw new Error("sign() legacy options not supported");const{hash:De,randomBytes:Fe}=m;let{lowS:bt,prehash:de,extraEntropy:He}=ke;bt==null&&(bt=!0),Ie=us("msgHash",Ie),de&&(Ie=us("prehashed msgHash",De(Ie)));const _t=nt(Ie),It=ie(le),Ze=[it(It),it(_t)];if(He!=null){const Ot=He===!0?Fe(v.BYTES):He;Ze.push(us("extraEntropy",Ot))}const Dt=Tf(...Ze),jt=_t;function $t(Ot){const ln=St(Ot);if(!ze(ln))return;const dn=O(ln),rn=Y.BASE.multiply(ln).toAffine(),gt=l(rn.x);if(gt===$u)return;const xt=l(dn*l(jt+gt*It));if(xt===$u)return;let zt=(rn.x===gt?0:2)|Number(rn.y&cl),qt=xt;return bt&&be(xt)&&(qt=he(xt),zt^=1),new ve(gt,qt,zt)}return{seed:Dt,k2sig:$t}}const we={lowS:m.lowS,prehash:!1},Qe={lowS:m.lowS,prehash:!1};function ut(Ie,le,ke=we){const{seed:De,k2sig:Fe}=$e(Ie,le,ke),bt=m;return Mv(bt.hash.outputLen,bt.nByteLength,bt.hmac)(De,Fe)}Y.BASE._setWindowSize(8);function Ye(Ie,le,ke,De=Qe){const Fe=Ie;if(le=us("msgHash",le),ke=us("publicKey",ke),"strict"in De)throw new Error("options.strict was renamed to lowS");const{lowS:bt,prehash:de}=De;let He,_t;try{if(typeof Fe=="string"||Fe instanceof Uint8Array)try{He=ve.fromDER(Fe)}catch(rn){if(!(rn instanceof wf.Err))throw rn;He=ve.fromCompact(Fe)}else if(typeof Fe=="object"&&typeof Fe.r=="bigint"&&typeof Fe.s=="bigint"){const{r:rn,s:gt}=Fe;He=new ve(rn,gt)}else throw new Error("PARSE");_t=Y.fromHex(ke)}catch(rn){if(rn.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(bt&&He.hasHighS())return!1;de&&(le=m.hash(le));const{r:It,s:Ze}=He,Dt=nt(le),jt=O(Ze),$t=l(Dt*jt),Ot=l(It*jt),ln=Y.BASE.multiplyAndAddUnsafe(_t,$t,Ot)?.toAffine();return ln?l(ln.x)===It:!1}return{CURVE:m,getPublicKey:lt,getSharedSecret:Et,sign:ut,verify:Ye,ProjectivePoint:Y,Signature:ve,utils:qe}}let Pv=class extends wv{constructor(m,v){super(),this.finished=!1,this.destroyed=!1,sw(m);const S=m0(v);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const M=this.blockLen,R=new Uint8Array(M);R.set(S.length>M?m.create().update(S).digest():S);for(let E=0;E<R.length;E++)R[E]^=54;this.iHash.update(R),this.oHash=m.create();for(let E=0;E<R.length;E++)R[E]^=106;this.oHash.update(R),R.fill(0)}update(m){return Iy(this),this.iHash.update(m),this}digestInto(m){Iy(this),vv(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:v,iHash:S,finished:M,destroyed:R,blockLen:E,outputLen:l}=this;return m=m,m.finished=M,m.destroyed=R,m.blockLen=E,m.outputLen=l,m.oHash=v._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Dv=(u,m,v)=>new Pv(u,m).update(v).digest();Dv.create=(u,m)=>new Pv(u,m);function Hw(u){return{hash:u,hmac:(m,...v)=>Dv(u,m,uw(...v)),randomBytes:Sv}}function Zw(u,m){const v=S=>$w({...u,...Hw(S)});return Object.freeze({...v(m),create:v})}const Gy=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ry=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Iv=BigInt(1),Ly=BigInt(2),Ex=(u,m)=>(u+m/Ly)/m;function Rv(u){const m=Gy,v=BigInt(3),S=BigInt(6),M=BigInt(11),R=BigInt(22),E=BigInt(23),l=BigInt(44),O=BigInt(88),Y=u*u*u%m,ie=Y*Y*u%m,ne=ll(ie,v,m)*ie%m,ze=ll(ne,v,m)*ie%m,Ce=ll(ze,Ly,m)*Y%m,be=ll(Ce,M,m)*Ce%m,he=ll(be,R,m)*be%m,te=ll(he,l,m)*he%m,ve=ll(te,O,m)*te%m,qe=ll(ve,l,m)*he%m,lt=ll(qe,v,m)*ie%m,Pt=ll(lt,E,m)*be%m,Et=ll(Pt,S,m)*Y%m,St=ll(Et,Ly,m);if(!K_.eql(K_.sqr(St),u))throw new Error("Cannot find square root");return St}const K_=Nw(Gy,void 0,void 0,{sqrt:Rv}),Jp=Zw({a:BigInt(0),b:BigInt(7),Fp:K_,n:Ry,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:u=>{const m=Ry,v=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),S=-Iv*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),M=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),R=v,E=BigInt("0x100000000000000000000000000000000"),l=Ex(R*u,m),O=Ex(-S*u,m);let Y=Ba(u-l*v-O*M,m),ie=Ba(-l*S-O*R,m);const ne=Y>E,ze=ie>E;if(ne&&(Y=m-Y),ze&&(ie=m-ie),Y>E||ie>E)throw new Error("splitScalar: Endomorphism failed, k="+u);return{k1neg:ne,k1:Y,k2neg:ze,k2:ie}}}},Z_),$y=BigInt(0),Lv=u=>typeof u=="bigint"&&$y<u&&u<Gy,Xw=u=>typeof u=="bigint"&&$y<u&&u<Ry,Mx={};function Ny(u,...m){let v=Mx[u];if(v===void 0){const S=Z_(Uint8Array.from(u,M=>M.charCodeAt(0)));v=Tf(S,S),Mx[u]=v}return Z_(Tf(v,...m))}const v0=u=>u.toRawBytes(!0).slice(1),W_=u=>id(u,32),I_=u=>Ba(u,Gy),hg=u=>Ba(u,Ry),b0=Jp.ProjectivePoint,Yw=(u,m,v)=>b0.BASE.multiplyAndAddUnsafe(u,m,v);function Q_(u){let m=Jp.utils.normPrivateKeyToScalar(u),v=b0.fromPrivateKey(m);return{scalar:v.hasEvenY()?m:hg(-m),bytes:v0(v)}}function Nv(u){if(!Lv(u))throw new Error("bad x: need 0 < x < p");const m=I_(u*u),v=I_(m*u+BigInt(7));let S=Rv(v);S%Ly!==$y&&(S=I_(-S));const M=new b0(u,S,Iv);return M.assertValidity(),M}function jv(...u){return hg(lo(Ny("BIP0340/challenge",...u)))}function Kw(u){return Q_(u).bytes}function Ww(u,m,v=Sv(32)){const S=us("message",u),{bytes:M,scalar:R}=Q_(m),E=us("auxRand",v,32),l=W_(R^lo(Ny("BIP0340/aux",E))),O=Ny("BIP0340/nonce",l,M,S),Y=hg(lo(O));if(Y===$y)throw new Error("sign failed: k is zero");const{bytes:ie,scalar:ne}=Q_(Y),ze=jv(ie,M,S),Ce=new Uint8Array(64);if(Ce.set(ie,0),Ce.set(W_(hg(ne+ze*R)),32),!Ov(Ce,S,M))throw new Error("sign: Invalid signature produced");return Ce}function Ov(u,m,v){const S=us("signature",u,64),M=us("message",m),R=us("publicKey",v,32);try{const E=Nv(lo(R)),l=lo(S.subarray(0,32));if(!Lv(l))return!1;const O=lo(S.subarray(32,64));if(!Xw(O))return!1;const Y=jv(W_(l),v0(E),M),ie=Yw(E,O,hg(-Y));return!(!ie||!ie.hasEvenY()||ie.toAffine().x!==l)}catch{return!1}}const Uc={getPublicKey:Kw,sign:Ww,verify:Ov,utils:{randomPrivateKey:Jp.utils.randomPrivateKey,lift_x:Nv,pointToBytes:v0,numberToBytesBE:id,bytesToNumberBE:lo,taggedHash:Ny,mod:Ba}},R_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const w0=u=>u instanceof Uint8Array,L_=u=>new DataView(u.buffer,u.byteOffset,u.byteLength),Fc=(u,m)=>u<<32-m|u>>>m,Qw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Qw)throw new Error("Non little-endian hardware is not supported");const Jw=Array.from({length:256},(u,m)=>m.toString(16).padStart(2,"0"));function Ki(u){if(!w0(u))throw new Error("Uint8Array expected");let m="";for(let v=0;v<u.length;v++)m+=Jw[u[v]];return m}function rd(u){if(typeof u!="string")throw new Error("hex string expected, got "+typeof u);const m=u.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const v=new Uint8Array(m/2);for(let S=0;S<v.length;S++){const M=S*2,R=u.slice(M,M+2),E=Number.parseInt(R,16);if(Number.isNaN(E)||E<0)throw new Error("Invalid byte sequence");v[S]=E}return v}function e2(u){if(typeof u!="string")throw new Error(`utf8ToBytes expected string, got ${typeof u}`);return new Uint8Array(new TextEncoder().encode(u))}function dg(u){if(typeof u=="string"&&(u=e2(u)),!w0(u))throw new Error(`expected Uint8Array, got ${typeof u}`);return u}function Hy(...u){const m=new Uint8Array(u.reduce((S,M)=>S+M.length,0));let v=0;return u.forEach(S=>{if(!w0(S))throw new Error("Uint8Array expected");m.set(S,v),v+=S.length}),m}class Bv{clone(){return this._cloneInto()}}function Fv(u){const m=S=>u().update(dg(S)).digest(),v=u();return m.outputLen=v.outputLen,m.blockLen=v.blockLen,m.create=()=>u(),m}function Uv(u=32){if(R_&&typeof R_.getRandomValues=="function")return R_.getRandomValues(new Uint8Array(u));throw new Error("crypto.getRandomValues must be defined")}function J_(u){if(!Number.isSafeInteger(u)||u<0)throw new Error(`Wrong positive integer: ${u}`)}function t2(u){if(typeof u!="boolean")throw new Error(`Expected boolean, not ${u}`)}function Vv(u,...m){if(!(u instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(u.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${u.length}`)}function n2(u){if(typeof u!="function"||typeof u.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");J_(u.outputLen),J_(u.blockLen)}function i2(u,m=!0){if(u.destroyed)throw new Error("Hash instance has been destroyed");if(m&&u.finished)throw new Error("Hash#digest() has already been called")}function r2(u,m){Vv(u);const v=m.outputLen;if(u.length<v)throw new Error(`digestInto() expects output buffer of length at least ${v}`)}const Vc={number:J_,bool:t2,bytes:Vv,hash:n2,exists:i2,output:r2};function a2(u,m,v,S){if(typeof u.setBigUint64=="function")return u.setBigUint64(m,v,S);const M=BigInt(32),R=BigInt(4294967295),E=Number(v>>M&R),l=Number(v&R),O=S?4:0,Y=S?0:4;u.setUint32(m+O,E,S),u.setUint32(m+Y,l,S)}class s2 extends Bv{constructor(m,v,S,M){super(),this.blockLen=m,this.outputLen=v,this.padOffset=S,this.isLE=M,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=L_(this.buffer)}update(m){Vc.exists(this);const{view:v,buffer:S,blockLen:M}=this;m=dg(m);const R=m.length;for(let E=0;E<R;){const l=Math.min(M-this.pos,R-E);if(l===M){const O=L_(m);for(;M<=R-E;E+=M)this.process(O,E);continue}S.set(m.subarray(E,E+l),this.pos),this.pos+=l,E+=l,this.pos===M&&(this.process(v,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){Vc.exists(this),Vc.output(m,this),this.finished=!0;const{buffer:v,view:S,blockLen:M,isLE:R}=this;let{pos:E}=this;v[E++]=128,this.buffer.subarray(E).fill(0),this.padOffset>M-E&&(this.process(S,0),E=0);for(let ne=E;ne<M;ne++)v[ne]=0;a2(S,M-8,BigInt(this.length*8),R),this.process(S,0);const l=L_(m),O=this.outputLen;if(O%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Y=O/4,ie=this.get();if(Y>ie.length)throw new Error("_sha2: outputLen bigger than state");for(let ne=0;ne<Y;ne++)l.setUint32(4*ne,ie[ne],R)}digest(){const{buffer:m,outputLen:v}=this;this.digestInto(m);const S=m.slice(0,v);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:v,buffer:S,length:M,finished:R,destroyed:E,pos:l}=this;return m.length=M,m.pos=l,m.finished=R,m.destroyed=E,M%v&&m.buffer.set(S),m}}const o2=(u,m,v)=>u&m^~u&v,l2=(u,m,v)=>u&m^u&v^m&v,c2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Qh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Jh=new Uint32Array(64);class qv extends s2{constructor(){super(64,32,8,!1),this.A=Qh[0]|0,this.B=Qh[1]|0,this.C=Qh[2]|0,this.D=Qh[3]|0,this.E=Qh[4]|0,this.F=Qh[5]|0,this.G=Qh[6]|0,this.H=Qh[7]|0}get(){const{A:m,B:v,C:S,D:M,E:R,F:E,G:l,H:O}=this;return[m,v,S,M,R,E,l,O]}set(m,v,S,M,R,E,l,O){this.A=m|0,this.B=v|0,this.C=S|0,this.D=M|0,this.E=R|0,this.F=E|0,this.G=l|0,this.H=O|0}process(m,v){for(let ne=0;ne<16;ne++,v+=4)Jh[ne]=m.getUint32(v,!1);for(let ne=16;ne<64;ne++){const ze=Jh[ne-15],Ce=Jh[ne-2],be=Fc(ze,7)^Fc(ze,18)^ze>>>3,he=Fc(Ce,17)^Fc(Ce,19)^Ce>>>10;Jh[ne]=he+Jh[ne-7]+be+Jh[ne-16]|0}let{A:S,B:M,C:R,D:E,E:l,F:O,G:Y,H:ie}=this;for(let ne=0;ne<64;ne++){const ze=Fc(l,6)^Fc(l,11)^Fc(l,25),Ce=ie+ze+o2(l,O,Y)+c2[ne]+Jh[ne]|0,he=(Fc(S,2)^Fc(S,13)^Fc(S,22))+l2(S,M,R)|0;ie=Y,Y=O,O=l,l=E+Ce|0,E=R,R=M,M=S,S=Ce+he|0}S=S+this.A|0,M=M+this.B|0,R=R+this.C|0,E=E+this.D|0,l=l+this.E|0,O=O+this.F|0,Y=Y+this.G|0,ie=ie+this.H|0,this.set(S,M,R,E,l,O,Y,ie)}roundClean(){Jh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class u2 extends qv{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ad=Fv(()=>new qv);Fv(()=>new u2);function em(u){if(!Number.isSafeInteger(u))throw new Error(`Wrong integer: ${u}`)}function Yu(...u){const m=(M,R)=>E=>M(R(E)),v=Array.from(u).reverse().reduce((M,R)=>M?m(M,R.encode):R.encode,void 0),S=u.reduce((M,R)=>M?m(M,R.decode):R.decode,void 0);return{encode:v,decode:S}}function Ku(u){return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return m.map(v=>{if(em(v),v<0||v>=u.length)throw new Error(`Digit index outside alphabet: ${v} (alphabet: ${u.length})`);return u[v]})},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("alphabet.decode input should be array of strings");return m.map(v=>{if(typeof v!="string")throw new Error(`alphabet.decode: not string element=${v}`);const S=u.indexOf(v);if(S===-1)throw new Error(`Unknown letter: "${v}". Allowed: ${u}`);return S})}}}function Wu(u=""){if(typeof u!="string")throw new Error("join separator should be string");return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("join.encode input should be array of strings");for(let v of m)if(typeof v!="string")throw new Error(`join.encode: non-string input=${v}`);return m.join(u)},decode:m=>{if(typeof m!="string")throw new Error("join.decode input should be string");return m.split(u)}}}function Zy(u,m="="){if(em(u),typeof m!="string")throw new Error("padding chr should be string");return{encode(v){if(!Array.isArray(v)||v.length&&typeof v[0]!="string")throw new Error("padding.encode input should be array of strings");for(let S of v)if(typeof S!="string")throw new Error(`padding.encode: non-string input=${S}`);for(;v.length*u%8;)v.push(m);return v},decode(v){if(!Array.isArray(v)||v.length&&typeof v[0]!="string")throw new Error("padding.encode input should be array of strings");for(let M of v)if(typeof M!="string")throw new Error(`padding.decode: non-string input=${M}`);let S=v.length;if(S*u%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;S>0&&v[S-1]===m;S--)if(!((S-1)*u%8))throw new Error("Invalid padding: string has too much padding");return v.slice(0,S)}}}function Gv(u){if(typeof u!="function")throw new Error("normalize fn should be function");return{encode:m=>m,decode:m=>u(m)}}function Cx(u,m,v){if(m<2)throw new Error(`convertRadix: wrong from=${m}, base cannot be less than 2`);if(v<2)throw new Error(`convertRadix: wrong to=${v}, base cannot be less than 2`);if(!Array.isArray(u))throw new Error("convertRadix: data should be array");if(!u.length)return[];let S=0;const M=[],R=Array.from(u);for(R.forEach(E=>{if(em(E),E<0||E>=m)throw new Error(`Wrong integer: ${E}`)});;){let E=0,l=!0;for(let O=S;O<R.length;O++){const Y=R[O],ie=m*E+Y;if(!Number.isSafeInteger(ie)||m*E/m!==E||ie-Y!==m*E)throw new Error("convertRadix: carry overflow");if(E=ie%v,R[O]=Math.floor(ie/v),!Number.isSafeInteger(R[O])||R[O]*v+E!==ie)throw new Error("convertRadix: carry overflow");if(l)R[O]?l=!1:S=O;else continue}if(M.push(E),l)break}for(let E=0;E<u.length-1&&u[E]===0;E++)M.push(0);return M.reverse()}const $v=(u,m)=>m?$v(m,u%m):u,jy=(u,m)=>u+(m-$v(u,m));function e0(u,m,v,S){if(!Array.isArray(u))throw new Error("convertRadix2: data should be array");if(m<=0||m>32)throw new Error(`convertRadix2: wrong from=${m}`);if(v<=0||v>32)throw new Error(`convertRadix2: wrong to=${v}`);if(jy(m,v)>32)throw new Error(`convertRadix2: carry overflow from=${m} to=${v} carryBits=${jy(m,v)}`);let M=0,R=0;const E=2**v-1,l=[];for(const O of u){if(em(O),O>=2**m)throw new Error(`convertRadix2: invalid data word=${O} from=${m}`);if(M=M<<m|O,R+m>32)throw new Error(`convertRadix2: carry overflow pos=${R} from=${m}`);for(R+=m;R>=v;R-=v)l.push((M>>R-v&E)>>>0);M&=2**R-1}if(M=M<<v-R&E,!S&&R>=m)throw new Error("Excess padding");if(!S&&M)throw new Error(`Non-zero padding: ${M}`);return S&&R>0&&l.push(M>>>0),l}function h2(u){return em(u),{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Cx(Array.from(m),2**8,u)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Cx(m,u,2**8))}}}function sd(u,m=!1){if(em(u),u<=0||u>32)throw new Error("radix2: bits should be in (0..32]");if(jy(8,u)>32||jy(u,8)>32)throw new Error("radix2: carry overflow");return{encode:v=>{if(!(v instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return e0(Array.from(v),8,u,!m)},decode:v=>{if(!Array.isArray(v)||v.length&&typeof v[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(e0(v,u,8,m))}}}function Ax(u){if(typeof u!="function")throw new Error("unsafeWrapper fn should be function");return function(...m){try{return u.apply(null,m)}catch{}}}const d2=Yu(sd(4),Ku("0123456789ABCDEF"),Wu("")),f2=Yu(sd(5),Ku("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Zy(5),Wu(""));Yu(sd(5),Ku("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Zy(5),Wu(""));Yu(sd(5),Ku("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Wu(""),Gv(u=>u.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Xu=Yu(sd(6),Ku("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Zy(6),Wu("")),p2=Yu(sd(6),Ku("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Zy(6),Wu("")),S0=u=>Yu(h2(58),Ku(u),Wu("")),t0=S0("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");S0("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");S0("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const zx=[0,2,3,5,6,7,9,10,11],m2={encode(u){let m="";for(let v=0;v<u.length;v+=8){const S=u.subarray(v,v+8);m+=t0.encode(S).padStart(zx[S.length],"1")}return m},decode(u){let m=[];for(let v=0;v<u.length;v+=11){const S=u.slice(v,v+11),M=zx.indexOf(S.length),R=t0.decode(S);for(let E=0;E<R.length-M;E++)if(R[E]!==0)throw new Error("base58xmr: wrong padding");m=m.concat(Array.from(R.slice(R.length-M)))}return Uint8Array.from(m)}},n0=Yu(Ku("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Wu("")),kx=[996825010,642813549,513874426,1027748829,705979059];function ug(u){const m=u>>25;let v=(u&33554431)<<5;for(let S=0;S<kx.length;S++)(m>>S&1)===1&&(v^=kx[S]);return v}function Px(u,m,v=1){const S=u.length;let M=1;for(let R=0;R<S;R++){const E=u.charCodeAt(R);if(E<33||E>126)throw new Error(`Invalid prefix (${u})`);M=ug(M)^E>>5}M=ug(M);for(let R=0;R<S;R++)M=ug(M)^u.charCodeAt(R)&31;for(let R of m)M=ug(M)^R;for(let R=0;R<6;R++)M=ug(M);return M^=v,n0.encode(e0([M%2**30],30,5,!1))}function Hv(u){const m=u==="bech32"?1:734539939,v=sd(5),S=v.decode,M=v.encode,R=Ax(S);function E(ie,ne,ze=90){if(typeof ie!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof ie}`);if(!Array.isArray(ne)||ne.length&&typeof ne[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ne}`);const Ce=ie.length+7+ne.length;if(ze!==!1&&Ce>ze)throw new TypeError(`Length ${Ce} exceeds limit ${ze}`);return ie=ie.toLowerCase(),`${ie}1${n0.encode(ne)}${Px(ie,ne,m)}`}function l(ie,ne=90){if(typeof ie!="string")throw new Error(`bech32.decode input should be string, not ${typeof ie}`);if(ie.length<8||ne!==!1&&ie.length>ne)throw new TypeError(`Wrong string length: ${ie.length} (${ie}). Expected (8..${ne})`);const ze=ie.toLowerCase();if(ie!==ze&&ie!==ie.toUpperCase())throw new Error("String must be lowercase or uppercase");ie=ze;const Ce=ie.lastIndexOf("1");if(Ce===0||Ce===-1)throw new Error('Letter "1" must be present between prefix and data only');const be=ie.slice(0,Ce),he=ie.slice(Ce+1);if(he.length<6)throw new Error("Data must be at least 6 characters long");const te=n0.decode(he).slice(0,-6),ve=Px(be,te,m);if(!he.endsWith(ve))throw new Error(`Invalid checksum in ${ie}: expected "${ve}"`);return{prefix:be,words:te}}const O=Ax(l);function Y(ie){const{prefix:ne,words:ze}=l(ie,!1);return{prefix:ne,words:ze,bytes:S(ze)}}return{encode:E,decode:l,decodeToBytes:Y,decodeUnsafe:O,fromWords:S,fromWordsUnsafe:R,toWords:M}}const $c=Hv("bech32");Hv("bech32m");const g2={encode:u=>new TextDecoder().decode(u),decode:u=>new TextEncoder().encode(u)},y2=Yu(sd(4),Ku("0123456789abcdef"),Wu(""),Gv(u=>{if(typeof u!="string"||u.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof u} with length ${u.length}`);return u.toLowerCase()})),_2={utf8:g2,hex:y2,base16:d2,base32:f2,base64:Xu,base64url:p2,base58:t0,base58xmr:m2};`${Object.keys(_2).join(", ")}`;function N_(u){if(!Number.isSafeInteger(u)||u<0)throw new Error(`positive integer expected, not ${u}`)}function Dx(u){if(typeof u!="boolean")throw new Error(`boolean expected, not ${u}`)}function x2(u){return u instanceof Uint8Array||u!=null&&typeof u=="object"&&u.constructor.name==="Uint8Array"}function qc(u,...m){if(!x2(u))throw new Error("Uint8Array expected");if(m.length>0&&!m.includes(u.length))throw new Error(`Uint8Array expected of length ${m}, not of length=${u.length}`)}const hs=u=>new Uint32Array(u.buffer,u.byteOffset,Math.floor(u.byteLength/4)),v2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!v2)throw new Error("Non little-endian hardware is not supported");const b2=Array.from({length:256},(u,m)=>m.toString(16).padStart(2,"0"));function $p(u){qc(u);let m="";for(let v=0;v<u.length;v++)m+=b2[u[v]];return m}const qu={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Ix(u){if(u>=qu._0&&u<=qu._9)return u-qu._0;if(u>=qu._A&&u<=qu._F)return u-(qu._A-10);if(u>=qu._a&&u<=qu._f)return u-(qu._a-10)}function Zv(u){if(typeof u!="string")throw new Error("hex string expected, got "+typeof u);const m=u.length,v=m/2;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const S=new Uint8Array(v);for(let M=0,R=0;M<v;M++,R+=2){const E=Ix(u.charCodeAt(R)),l=Ix(u.charCodeAt(R+1));if(E===void 0||l===void 0){const O=u[R]+u[R+1];throw new Error('hex string expected, got non-hex character "'+O+'" at index '+R)}S[M]=E*16+l}return S}function w2(u,m){if(m==null||typeof m!="object")throw new Error("options must be defined");return Object.assign(u,m)}function S2(u,m){if(u.length!==m.length)return!1;let v=0;for(let S=0;S<u.length;S++)v|=u[S]^m[S];return v===0}const T2=(u,m)=>(Object.assign(m,u),m),td=16,E2=283;function T0(u){return u<<1^E2&-(u>>7)}function Hp(u,m){let v=0;for(;m>0;m>>=1)v^=u&-(m&1),u=T0(u);return v}const i0=(()=>{let u=new Uint8Array(256);for(let v=0,S=1;v<256;v++,S^=T0(S))u[v]=S;const m=new Uint8Array(256);m[0]=99;for(let v=0;v<255;v++){let S=u[255-v];S|=S<<8,m[u[v]]=(S^S>>4^S>>5^S>>6^S>>7^99)&255}return m})(),M2=i0.map((u,m)=>i0.indexOf(m)),C2=u=>u<<24|u>>>8,j_=u=>u<<8|u>>>24;function Xv(u,m){if(u.length!==256)throw new Error("Wrong sbox length");const v=new Uint32Array(256).map((Y,ie)=>m(u[ie])),S=v.map(j_),M=S.map(j_),R=M.map(j_),E=new Uint32Array(256*256),l=new Uint32Array(256*256),O=new Uint16Array(256*256);for(let Y=0;Y<256;Y++)for(let ie=0;ie<256;ie++){const ne=Y*256+ie;E[ne]=v[Y]^S[ie],l[ne]=M[Y]^R[ie],O[ne]=u[Y]<<8|u[ie]}return{sbox:u,sbox2:O,T0:v,T1:S,T2:M,T3:R,T01:E,T23:l}}const E0=Xv(i0,u=>Hp(u,3)<<24|u<<16|u<<8|Hp(u,2)),Yv=Xv(M2,u=>Hp(u,11)<<24|Hp(u,13)<<16|Hp(u,9)<<8|Hp(u,14)),A2=(()=>{const u=new Uint8Array(16);for(let m=0,v=1;m<16;m++,v=T0(v))u[m]=v;return u})();function Kv(u){qc(u);const m=u.length;if(![16,24,32].includes(m))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${m}`);const{sbox2:v}=E0,S=hs(u),M=S.length,R=l=>Gc(v,l,l,l,l),E=new Uint32Array(m+28);E.set(S);for(let l=M;l<E.length;l++){let O=E[l-1];l%M===0?O=R(C2(O))^A2[l/M-1]:M>6&&l%M===4&&(O=R(O)),E[l]=E[l-M]^O}return E}function z2(u){const m=Kv(u),v=m.slice(),S=m.length,{sbox2:M}=E0,{T0:R,T1:E,T2:l,T3:O}=Yv;for(let Y=0;Y<S;Y+=4)for(let ie=0;ie<4;ie++)v[Y+ie]=m[S-Y-4+ie];m.fill(0);for(let Y=4;Y<S-4;Y++){const ie=v[Y],ne=Gc(M,ie,ie,ie,ie);v[Y]=R[ne&255]^E[ne>>>8&255]^l[ne>>>16&255]^O[ne>>>24]}return v}function ed(u,m,v,S,M,R){return u[v<<8&65280|S>>>8&255]^m[M>>>8&65280|R>>>24&255]}function Gc(u,m,v,S,M){return u[m&255|v&65280]|u[S>>>16&255|M>>>16&65280]<<16}function Rx(u,m,v,S,M){const{sbox2:R,T01:E,T23:l}=E0;let O=0;m^=u[O++],v^=u[O++],S^=u[O++],M^=u[O++];const Y=u.length/4-2;for(let be=0;be<Y;be++){const he=u[O++]^ed(E,l,m,v,S,M),te=u[O++]^ed(E,l,v,S,M,m),ve=u[O++]^ed(E,l,S,M,m,v),qe=u[O++]^ed(E,l,M,m,v,S);m=he,v=te,S=ve,M=qe}const ie=u[O++]^Gc(R,m,v,S,M),ne=u[O++]^Gc(R,v,S,M,m),ze=u[O++]^Gc(R,S,M,m,v),Ce=u[O++]^Gc(R,M,m,v,S);return{s0:ie,s1:ne,s2:ze,s3:Ce}}function k2(u,m,v,S,M){const{sbox2:R,T01:E,T23:l}=Yv;let O=0;m^=u[O++],v^=u[O++],S^=u[O++],M^=u[O++];const Y=u.length/4-2;for(let be=0;be<Y;be++){const he=u[O++]^ed(E,l,m,M,S,v),te=u[O++]^ed(E,l,v,m,M,S),ve=u[O++]^ed(E,l,S,v,m,M),qe=u[O++]^ed(E,l,M,S,v,m);m=he,v=te,S=ve,M=qe}const ie=u[O++]^Gc(R,m,M,S,v),ne=u[O++]^Gc(R,v,m,M,S),ze=u[O++]^Gc(R,S,v,m,M),Ce=u[O++]^Gc(R,M,S,v,m);return{s0:ie,s1:ne,s2:ze,s3:Ce}}function Wv(u,m){if(!m)return new Uint8Array(u);if(qc(m),m.length<u)throw new Error(`aes: wrong destination length, expected at least ${u}, got: ${m.length}`);return m}function P2(u){if(qc(u),u.length%td!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${td}`)}function D2(u,m,v){let S=u.length;const M=S%td;if(!m&&M!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const R=hs(u);if(m){let O=td-M;O||(O=td),S=S+O}const E=Wv(S,v),l=hs(E);return{b:R,o:l,out:E}}function I2(u,m){if(!m)return u;const v=u.length;if(!v)throw new Error("aes/pcks5: empty ciphertext not allowed");const S=u[v-1];if(S<=0||S>16)throw new Error(`aes/pcks5: wrong padding byte: ${S}`);const M=u.subarray(0,-S);for(let R=0;R<S;R++)if(u[v-R-1]!==S)throw new Error("aes/pcks5: wrong padding");return M}function R2(u){const m=new Uint8Array(16),v=hs(m);m.set(u);const S=td-u.length;for(let M=td-S;M<td;M++)m[M]=S;return v}const Qv=T2({blockSize:16,nonceLength:16},function(m,v,S={}){qc(m),qc(v,16);const M=!S.disablePadding;return{encrypt:(R,E)=>{const l=Kv(m),{b:O,o:Y,out:ie}=D2(R,M,E),ne=hs(v);let ze=ne[0],Ce=ne[1],be=ne[2],he=ne[3],te=0;for(;te+4<=O.length;)ze^=O[te+0],Ce^=O[te+1],be^=O[te+2],he^=O[te+3],{s0:ze,s1:Ce,s2:be,s3:he}=Rx(l,ze,Ce,be,he),Y[te++]=ze,Y[te++]=Ce,Y[te++]=be,Y[te++]=he;if(M){const ve=R2(R.subarray(te*4));ze^=ve[0],Ce^=ve[1],be^=ve[2],he^=ve[3],{s0:ze,s1:Ce,s2:be,s3:he}=Rx(l,ze,Ce,be,he),Y[te++]=ze,Y[te++]=Ce,Y[te++]=be,Y[te++]=he}return l.fill(0),ie},decrypt:(R,E)=>{P2(R);const l=z2(m),O=hs(v),Y=Wv(R.length,E),ie=hs(R),ne=hs(Y);let ze=O[0],Ce=O[1],be=O[2],he=O[3];for(let te=0;te+4<=ie.length;){const ve=ze,qe=Ce,lt=be,Pt=he;ze=ie[te+0],Ce=ie[te+1],be=ie[te+2],he=ie[te+3];const{s0:Et,s1:St,s2:nt,s3:Be}=k2(l,ze,Ce,be,he);ne[te++]=Et^ve,ne[te++]=St^qe,ne[te++]=nt^lt,ne[te++]=Be^Pt}return l.fill(0),I2(Y,M)}}}),Jv=u=>Uint8Array.from(u.split("").map(m=>m.charCodeAt(0))),L2=Jv("expand 16-byte k"),N2=Jv("expand 32-byte k"),j2=hs(L2),eb=hs(N2);eb.slice();function bi(u,m){return u<<m|u>>>32-m}function r0(u){return u.byteOffset%4===0}const wy=64,O2=16,tb=2**32-1,Lx=new Uint32Array;function B2(u,m,v,S,M,R,E,l){const O=M.length,Y=new Uint8Array(wy),ie=hs(Y),ne=r0(M)&&r0(R),ze=ne?hs(M):Lx,Ce=ne?hs(R):Lx;for(let be=0;be<O;E++){if(u(m,v,S,ie,E,l),E>=tb)throw new Error("arx: counter overflow");const he=Math.min(wy,O-be);if(ne&&he===wy){const te=be/4;if(be%4!==0)throw new Error("arx: invalid block position");for(let ve=0,qe;ve<O2;ve++)qe=te+ve,Ce[qe]=ze[qe]^ie[ve];be+=wy;continue}for(let te=0,ve;te<he;te++)ve=be+te,R[ve]=M[ve]^Y[te];be+=he}}function F2(u,m){const{allowShortKeys:v,extendNonceFn:S,counterLength:M,counterRight:R,rounds:E}=w2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},m);if(typeof u!="function")throw new Error("core must be a function");return N_(M),N_(E),Dx(R),Dx(v),(l,O,Y,ie,ne=0)=>{qc(l),qc(O),qc(Y);const ze=Y.length;if(ie||(ie=new Uint8Array(ze)),qc(ie),N_(ne),ne<0||ne>=tb)throw new Error("arx: counter overflow");if(ie.length<ze)throw new Error(`arx: output (${ie.length}) is shorter than data (${ze})`);const Ce=[];let be=l.length,he,te;if(be===32)he=l.slice(),Ce.push(he),te=eb;else if(be===16&&v)he=new Uint8Array(32),he.set(l),he.set(l,16),te=j2,Ce.push(he);else throw new Error(`arx: invalid 32-byte key, got length=${be}`);r0(O)||(O=O.slice(),Ce.push(O));const ve=hs(he);if(S){if(O.length!==24)throw new Error("arx: extended nonce must be 24 bytes");S(te,ve,hs(O.subarray(0,16)),ve),O=O.subarray(16)}const qe=16-M;if(qe!==O.length)throw new Error(`arx: nonce must be ${qe} or 16 bytes`);if(qe!==12){const Pt=new Uint8Array(12);Pt.set(O,R?0:12-O.length),O=Pt,Ce.push(O)}const lt=hs(O);for(B2(u,te,ve,lt,Y,ie,ne,E);Ce.length>0;)Ce.pop().fill(0);return ie}}function U2(u,m,v,S,M,R=20){let E=u[0],l=u[1],O=u[2],Y=u[3],ie=m[0],ne=m[1],ze=m[2],Ce=m[3],be=m[4],he=m[5],te=m[6],ve=m[7],qe=M,lt=v[0],Pt=v[1],Et=v[2],St=E,nt=l,Be=O,it=Y,$e=ie,we=ne,Qe=ze,ut=Ce,Ye=be,Ie=he,le=te,ke=ve,De=qe,Fe=lt,bt=Pt,de=Et;for(let _t=0;_t<R;_t+=2)St=St+$e|0,De=bi(De^St,16),Ye=Ye+De|0,$e=bi($e^Ye,12),St=St+$e|0,De=bi(De^St,8),Ye=Ye+De|0,$e=bi($e^Ye,7),nt=nt+we|0,Fe=bi(Fe^nt,16),Ie=Ie+Fe|0,we=bi(we^Ie,12),nt=nt+we|0,Fe=bi(Fe^nt,8),Ie=Ie+Fe|0,we=bi(we^Ie,7),Be=Be+Qe|0,bt=bi(bt^Be,16),le=le+bt|0,Qe=bi(Qe^le,12),Be=Be+Qe|0,bt=bi(bt^Be,8),le=le+bt|0,Qe=bi(Qe^le,7),it=it+ut|0,de=bi(de^it,16),ke=ke+de|0,ut=bi(ut^ke,12),it=it+ut|0,de=bi(de^it,8),ke=ke+de|0,ut=bi(ut^ke,7),St=St+we|0,de=bi(de^St,16),le=le+de|0,we=bi(we^le,12),St=St+we|0,de=bi(de^St,8),le=le+de|0,we=bi(we^le,7),nt=nt+Qe|0,De=bi(De^nt,16),ke=ke+De|0,Qe=bi(Qe^ke,12),nt=nt+Qe|0,De=bi(De^nt,8),ke=ke+De|0,Qe=bi(Qe^ke,7),Be=Be+ut|0,Fe=bi(Fe^Be,16),Ye=Ye+Fe|0,ut=bi(ut^Ye,12),Be=Be+ut|0,Fe=bi(Fe^Be,8),Ye=Ye+Fe|0,ut=bi(ut^Ye,7),it=it+$e|0,bt=bi(bt^it,16),Ie=Ie+bt|0,$e=bi($e^Ie,12),it=it+$e|0,bt=bi(bt^it,8),Ie=Ie+bt|0,$e=bi($e^Ie,7);let He=0;S[He++]=E+St|0,S[He++]=l+nt|0,S[He++]=O+Be|0,S[He++]=Y+it|0,S[He++]=ie+$e|0,S[He++]=ne+we|0,S[He++]=ze+Qe|0,S[He++]=Ce+ut|0,S[He++]=be+Ye|0,S[He++]=he+Ie|0,S[He++]=te+le|0,S[He++]=ve+ke|0,S[He++]=qe+De|0,S[He++]=lt+Fe|0,S[He++]=Pt+bt|0,S[He++]=Et+de|0}const nb=F2(U2,{counterRight:!1,counterLength:4,allowShortKeys:!1});class ib extends Bv{constructor(m,v){super(),this.finished=!1,this.destroyed=!1,Vc.hash(m);const S=dg(v);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const M=this.blockLen,R=new Uint8Array(M);R.set(S.length>M?m.create().update(S).digest():S);for(let E=0;E<R.length;E++)R[E]^=54;this.iHash.update(R),this.oHash=m.create();for(let E=0;E<R.length;E++)R[E]^=106;this.oHash.update(R),R.fill(0)}update(m){return Vc.exists(this),this.iHash.update(m),this}digestInto(m){Vc.exists(this),Vc.bytes(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:v,iHash:S,finished:M,destroyed:R,blockLen:E,outputLen:l}=this;return m=m,m.finished=M,m.destroyed=R,m.blockLen=E,m.outputLen=l,m.oHash=v._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Xy=(u,m,v)=>new ib(u,m).update(v).digest();Xy.create=(u,m)=>new ib(u,m);function V2(u,m,v){return Vc.hash(u),Xy(u,dg(v),dg(m))}const O_=new Uint8Array([0]),Nx=new Uint8Array;function q2(u,m,v,S=32){if(Vc.hash(u),Vc.number(S),S>255*u.outputLen)throw new Error("Length should be <= 255*HashLen");const M=Math.ceil(S/u.outputLen);v===void 0&&(v=Nx);const R=new Uint8Array(M*u.outputLen),E=Xy.create(u,m),l=E._cloneInto(),O=new Uint8Array(E.outputLen);for(let Y=0;Y<M;Y++)O_[0]=Y+1,l.update(Y===0?Nx:O).update(v).update(O_).digestInto(O),R.set(O,u.outputLen*Y),E._cloneInto(l);return E.destroy(),l.destroy(),O.fill(0),O_.fill(0),R.slice(0,S)}var G2=Object.defineProperty,ur=(u,m)=>{for(var v in m)G2(u,v,{get:m[v],enumerable:!0})},_f=Symbol("verified"),$2=u=>u instanceof Object;function M0(u){if(!$2(u)||typeof u.kind!="number"||typeof u.content!="string"||typeof u.created_at!="number"||typeof u.pubkey!="string"||!u.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(u.tags))return!1;for(let m=0;m<u.tags.length;m++){let v=u.tags[m];if(!Array.isArray(v))return!1;for(let S=0;S<v.length;S++)if(typeof v[S]!="string")return!1}return!0}var H2={};ur(H2,{Queue:()=>ab,QueueNode:()=>rb,binarySearch:()=>C0,bytesToHex:()=>Ki,hexToBytes:()=>rd,insertEventIntoAscendingList:()=>X2,insertEventIntoDescendingList:()=>Z2,normalizeURL:()=>bf,utf8Decoder:()=>Zu,utf8Encoder:()=>ec});var Zu=new TextDecoder("utf-8"),ec=new TextEncoder;function bf(u){try{u.indexOf("://")===-1&&(u="wss://"+u);let m=new URL(u);return m.protocol==="http:"?m.protocol="ws:":m.protocol==="https:"&&(m.protocol="wss:"),m.pathname=m.pathname.replace(/\/+/g,"/"),m.pathname.endsWith("/")&&(m.pathname=m.pathname.slice(0,-1)),(m.port==="80"&&m.protocol==="ws:"||m.port==="443"&&m.protocol==="wss:")&&(m.port=""),m.searchParams.sort(),m.hash="",m.toString()}catch{throw new Error(`Invalid URL: ${u}`)}}function Z2(u,m){const[v,S]=C0(u,M=>m.id===M.id?0:m.created_at===M.created_at?-1:M.created_at-m.created_at);return S||u.splice(v,0,m),u}function X2(u,m){const[v,S]=C0(u,M=>m.id===M.id?0:m.created_at===M.created_at?-1:m.created_at-M.created_at);return S||u.splice(v,0,m),u}function C0(u,m){let v=0,S=u.length-1;for(;v<=S;){const M=Math.floor((v+S)/2),R=m(u[M]);if(R===0)return[M,!0];R<0?S=M-1:v=M+1}return[v,!1]}var rb=class{value;next=null;prev=null;constructor(u){this.value=u}},ab=class{first;last;constructor(){this.first=null,this.last=null}enqueue(u){const m=new rb(u);return this.last?this.last===this.first?(this.last=m,this.last.prev=this.first,this.first.next=m):(m.prev=this.last,this.last.next=m,this.last=m):(this.first=m,this.last=m),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const m=this.first;return this.first=null,this.last=null,m.value}const u=this.first;return this.first=u.next,this.first&&(this.first.prev=null),u.value}},Y2=class{generateSecretKey(){return Uc.utils.randomPrivateKey()}getPublicKey(m){return Ki(Uc.getPublicKey(m))}finalizeEvent(m,v){const S=m;return S.pubkey=Ki(Uc.getPublicKey(v)),S.id=Cy(S),S.sig=Ki(Uc.sign(Cy(S),v)),S[_f]=!0,S}verifyEvent(m){if(typeof m[_f]=="boolean")return m[_f];const v=Cy(m);if(v!==m.id)return m[_f]=!1,!1;try{const S=Uc.verify(m.sig,v,m.pubkey);return m[_f]=S,S}catch{return m[_f]=!1,!1}}};function K2(u){if(!M0(u))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,u.pubkey,u.created_at,u.kind,u.tags,u.content])}function Cy(u){let m=ad(ec.encode(K2(u)));return Ki(m)}var Yy=new Y2,sb=Yy.generateSecretKey,fg=Yy.getPublicKey,ul=Yy.finalizeEvent,Ky=Yy.verifyEvent,W2={};ur(W2,{Application:()=>cT,BadgeAward:()=>aS,BadgeDefinition:()=>nT,BlockedRelaysList:()=>OS,BlossomServerList:()=>$S,BookmarkList:()=>LS,Bookmarksets:()=>JS,Calendar:()=>gT,CalendarEventRSVP:()=>yT,ChannelCreation:()=>db,ChannelHideMessage:()=>mb,ChannelMessage:()=>pb,ChannelMetadata:()=>fb,ChannelMuteUser:()=>gb,ChatMessage:()=>sS,ClassifiedListing:()=>dT,ClientAuth:()=>_b,Comment:()=>mS,CommunitiesList:()=>NS,CommunityDefinition:()=>bT,CommunityPostApproval:()=>SS,Contacts:()=>nS,CreateOrUpdateProduct:()=>aT,CreateOrUpdateStall:()=>rT,Curationsets:()=>eT,Date:()=>pT,DirectMessageRelaysList:()=>qS,DraftClassifiedListing:()=>fT,DraftLong:()=>oT,Emojisets:()=>lT,EncryptedDirectMessage:()=>iS,EventDeletion:()=>rS,FavoriteRelays:()=>FS,FileMessage:()=>lS,FileMetadata:()=>pS,FileServerPreference:()=>GS,Followsets:()=>KS,ForumThread:()=>oS,GenericRepost:()=>D0,Genericlists:()=>WS,GiftWrap:()=>yb,GroupMetadata:()=>wT,HTTPAuth:()=>I0,Handlerinformation:()=>vT,Handlerrecommendation:()=>xT,Highlights:()=>kS,InterestsList:()=>US,Interestsets:()=>iT,JobFeedback:()=>MS,JobRequest:()=>TS,JobResult:()=>ES,Label:()=>wS,LightningPubRPC:()=>ZS,LiveChatMessage:()=>gS,LiveEvent:()=>uT,LongFormArticle:()=>sT,Metadata:()=>eS,Mutelist:()=>DS,NWCWalletInfo:()=>HS,NWCWalletRequest:()=>xb,NWCWalletResponse:()=>XS,NormalVideo:()=>uS,NostrConnect:()=>YS,OpenTimestamps:()=>dS,Photo:()=>cS,Pinlist:()=>IS,Poll:()=>fS,PollResponse:()=>PS,PrivateDirectMessage:()=>hb,ProblemTracker:()=>xS,ProfileBadges:()=>tT,PublicChatsList:()=>jS,Reaction:()=>P0,RecommendRelay:()=>tS,RelayList:()=>RS,RelayReview:()=>_T,Relaysets:()=>QS,Report:()=>vS,Reporting:()=>bS,Repost:()=>k0,Seal:()=>ub,SearchRelaysList:()=>BS,ShortTextNote:()=>cb,ShortVideo:()=>hS,Time:()=>mT,UserEmojiList:()=>VS,UserStatuses:()=>hT,Voice:()=>yS,VoiceComment:()=>_S,Zap:()=>zS,ZapGoal:()=>CS,ZapRequest:()=>AS,classifyKind:()=>Q2,isAddressableKind:()=>z0,isEphemeralKind:()=>lb,isKind:()=>J2,isRegularKind:()=>ob,isReplaceableKind:()=>A0});function ob(u){return u<1e4&&u!==0&&u!==3}function A0(u){return u===0||u===3||1e4<=u&&u<2e4}function lb(u){return 2e4<=u&&u<3e4}function z0(u){return 3e4<=u&&u<4e4}function Q2(u){return ob(u)?"regular":A0(u)?"replaceable":lb(u)?"ephemeral":z0(u)?"parameterized":"unknown"}function J2(u,m){const v=m instanceof Array?m:[m];return M0(u)&&v.includes(u.kind)||!1}var eS=0,cb=1,tS=2,nS=3,iS=4,rS=5,k0=6,P0=7,aS=8,sS=9,oS=11,ub=13,hb=14,lS=15,D0=16,cS=20,uS=21,hS=22,db=40,fb=41,pb=42,mb=43,gb=44,dS=1040,yb=1059,fS=1068,pS=1063,mS=1111,gS=1311,yS=1222,_S=1244,xS=1971,vS=1984,bS=1984,wS=1985,SS=4550,TS=5999,ES=6999,MS=7e3,CS=9041,AS=9734,zS=9735,kS=9802,PS=1018,DS=1e4,IS=10001,RS=10002,LS=10003,NS=10004,jS=10005,OS=10006,BS=10007,FS=10012,US=10015,VS=10030,qS=10050,GS=10096,$S=10063,HS=13194,ZS=21e3,_b=22242,xb=23194,XS=23195,YS=24133,I0=27235,KS=3e4,WS=30001,QS=30002,JS=30003,eT=30004,tT=30008,nT=30009,iT=30015,rT=30017,aT=30018,sT=30023,oT=30024,lT=30030,cT=30078,uT=30311,hT=30315,dT=30402,fT=30403,pT=31922,mT=31923,gT=31924,yT=31925,_T=31987,xT=31989,vT=31990,bT=34550,wT=39e3;function ST(u,m){if(u.ids&&u.ids.indexOf(m.id)===-1||u.kinds&&u.kinds.indexOf(m.kind)===-1||u.authors&&u.authors.indexOf(m.pubkey)===-1)return!1;for(let v in u)if(v[0]==="#"){let S=v.slice(1),M=u[`#${S}`];if(M&&!m.tags.find(([R,E])=>R===v.slice(1)&&M.indexOf(E)!==-1))return!1}return!(u.since&&m.created_at<u.since||u.until&&m.created_at>u.until)}function TT(u,m){for(let v=0;v<u.length;v++)if(ST(u[v],m))return!0;return!1}var ET={};ur(ET,{getHex64:()=>Wy,getInt:()=>vb,getSubscriptionId:()=>bb,matchEventId:()=>MT,matchEventKind:()=>AT,matchEventPubkey:()=>CT});function Wy(u,m){let v=m.length+3,S=u.indexOf(`"${m}":`)+v,M=u.slice(S).indexOf('"')+S+1;return u.slice(M,M+64)}function vb(u,m){let v=m.length,S=u.indexOf(`"${m}":`)+v+3,M=u.slice(S),R=Math.min(M.indexOf(","),M.indexOf("}"));return parseInt(M.slice(0,R),10)}function bb(u){let m=u.slice(0,22).indexOf('"EVENT"');if(m===-1)return null;let v=u.slice(m+7+1).indexOf('"');if(v===-1)return null;let S=m+7+1+v,M=u.slice(S+1,80).indexOf('"');if(M===-1)return null;let R=S+1+M;return u.slice(S+1,R)}function MT(u,m){return m===Wy(u,"id")}function CT(u,m){return m===Wy(u,"pubkey")}function AT(u,m){return m===vb(u,"kind")}var zT={};ur(zT,{makeAuthEvent:()=>wb});function wb(u,m){return{kind:_b,created_at:Math.floor(Date.now()/1e3),tags:[["relay",u],["challenge",m]],content:""}}async function kT(){return new Promise((u,m)=>{try{if(typeof MessageChannel<"u"){const v=new MessageChannel,S=()=>{v.port1.removeEventListener("message",S),u()};v.port1.addEventListener("message",S),v.port2.postMessage(0),v.port1.start()}else typeof setImmediate<"u"?setImmediate(u):typeof setTimeout<"u"?setTimeout(u,0):u()}catch(v){console.error("during yield: ",v),m(v)}})}var PT=u=>(u[_f]=!0,!0),Sb=class extends Error{constructor(u,m){super(`Tried to send message '${u} on a closed connection to ${m}.`),this.name="SendingOnClosedConnection"}},Tb=class{url;_connected=!1;onclose=null;onnotice=u=>console.debug(`NOTICE from ${this.url}: ${u}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new ab;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(u,m){this.url=bf(u),this.verifyEvent=m.verifyEvent,this._WebSocket=m.websocketImplementation||WebSocket,this.enablePing=m.enablePing,this.enableReconnect=m.enableReconnect||!1}static async connect(u,m){const v=new Tb(u,m);return await v.connect(),v}closeAllSubscriptions(u){for(let[m,v]of this.openSubs)v.close(u);this.openSubs.clear();for(let[m,v]of this.openEventPublishes)v.reject(new Error(u));this.openEventPublishes.clear();for(let[m,v]of this.openCountRequests)v.reject(new Error(u));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const u=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},u)}handleHardClose(u){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const m=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!m?this.reconnect():this.closeAllSubscriptions(u)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((u,m)=>{this.connectionTimeoutHandle=setTimeout(()=>{m("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(v){clearTimeout(this.connectionTimeoutHandle),m(v);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const v=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const S of this.openSubs.values()){if(S.eosed=!1,v)for(let M=0;M<S.filters.length;M++)S.lastEmitted&&(S.filters[M].since=S.lastEmitted+1);S.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),u()},this.ws.onerror=v=>{clearTimeout(this.connectionTimeoutHandle),m(v.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=v=>{clearTimeout(this.connectionTimeoutHandle),m(v.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(u=>{this.ws.once("pong",()=>u(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((u,m)=>{if(!this.connectionPromise)return m(new Error(`no connection to ${this.url}, can't ping`));try{const v=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{u(!0),v.close()},onclose(){u(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(v){m(v)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(m=>setTimeout(()=>m(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await kT();this.queueRunning=!1}handleNext(){const u=this.incomingMessageQueue.dequeue();if(!u)return!1;const m=bb(u);if(m){const v=this.openSubs.get(m);if(!v)return;const S=Wy(u,"id"),M=v.alreadyHaveEvent?.(S);if(v.receivedEvent?.(this,S),M)return}try{let v=JSON.parse(u);switch(v[0]){case"EVENT":{const S=this.openSubs.get(v[1]),M=v[2];this.verifyEvent(M)&&TT(S.filters,M)&&S.onevent(M),(!S.lastEmitted||S.lastEmitted<M.created_at)&&(S.lastEmitted=M.created_at);return}case"COUNT":{const S=v[1],M=v[2],R=this.openCountRequests.get(S);R&&(R.resolve(M.count),this.openCountRequests.delete(S));return}case"EOSE":{const S=this.openSubs.get(v[1]);if(!S)return;S.receivedEose();return}case"OK":{const S=v[1],M=v[2],R=v[3],E=this.openEventPublishes.get(S);E&&(clearTimeout(E.timeout),M?E.resolve(R):E.reject(new Error(R)),this.openEventPublishes.delete(S));return}case"CLOSED":{const S=v[1],M=this.openSubs.get(S);if(!M)return;M.closed=!0,M.close(v[2]);return}case"NOTICE":{this.onnotice(v[1]);return}case"AUTH":{this.challenge=v[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(v[1])?.oncustom?.(v);return}}}catch{return}}async send(u){if(!this.connectionPromise)throw new Sb(u,this.url);this.connectionPromise.then(()=>{this.ws?.send(u)})}async auth(u){const m=this.challenge;if(!m)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(v,S)=>{try{let M=await u(wb(this.url,m)),R=setTimeout(()=>{let E=this.openEventPublishes.get(M.id);E&&(E.reject(new Error("auth timed out")),this.openEventPublishes.delete(M.id))},this.publishTimeout);this.openEventPublishes.set(M.id,{resolve:v,reject:S,timeout:R}),this.send('["AUTH",'+JSON.stringify(M)+"]")}catch(M){console.warn("subscribe auth function failed:",M)}}),this.authPromise)}async publish(u){const m=new Promise((v,S)=>{const M=setTimeout(()=>{const R=this.openEventPublishes.get(u.id);R&&(R.reject(new Error("publish timed out")),this.openEventPublishes.delete(u.id))},this.publishTimeout);this.openEventPublishes.set(u.id,{resolve:v,reject:S,timeout:M})});return this.send('["EVENT",'+JSON.stringify(u)+"]"),m}async count(u,m){this.serial++;const v=m?.id||"count:"+this.serial,S=new Promise((M,R)=>{this.openCountRequests.set(v,{resolve:M,reject:R})});return this.send('["COUNT","'+v+'",'+JSON.stringify(u).substring(1)),S}subscribe(u,m){const v=this.prepareSubscription(u,m);return v.fire(),v}prepareSubscription(u,m){this.serial++;const v=m.id||(m.label?m.label+":":"sub:")+this.serial,S=new DT(this,v,u,m);return this.openSubs.set(v,S),S}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(u){this.incomingMessageQueue.enqueue(u.data),this.queueRunning||this.runQueue()}},DT=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(u,m,v,S){if(v.length===0)throw new Error("subscription can't be created with zero filters");this.relay=u,this.filters=v,this.id=m,this.alreadyHaveEvent=S.alreadyHaveEvent,this.receivedEvent=S.receivedEvent,this.eoseTimeout=S.eoseTimeout||u.baseEoseTimeout,this.oneose=S.oneose,this.onclose=S.onclose,this.onevent=S.onevent||(M=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,M)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(u="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(m){if(!(m instanceof Sb))throw m}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(u)}},IT;try{IT=WebSocket}catch{}var RT=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(u){this.verifyEvent=u.verifyEvent,this._WebSocket=u.websocketImplementation,this.enablePing=u.enablePing,this.enableReconnect=u.enableReconnect||!1,this.automaticallyAuth=u.automaticallyAuth}async ensureRelay(u,m){u=bf(u);let v=this.relays.get(u);if(v||(v=new Tb(u,{verifyEvent:this.trustedRelayURLs.has(u)?PT:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),v.onclose=()=>{v&&!v.enableReconnect&&this.relays.delete(u)},m?.connectionTimeout&&(v.connectionTimeout=m.connectionTimeout),this.relays.set(u,v)),this.automaticallyAuth){const S=this.automaticallyAuth(u);S&&(v.onauth=S)}return await v.connect(),v}close(u){u.map(bf).forEach(m=>{this.relays.get(m)?.close(),this.relays.delete(m)})}subscribe(u,m,v){const S=[];for(let M=0;M<u.length;M++){const R=bf(u[M]);S.find(E=>E.url===R)||S.push({url:R,filter:m})}return this.subscribeMap(S,v)}subscribeMany(u,m,v){const S=[],M=[];for(let R=0;R<u.length;R++){const E=bf(u[R]);M.indexOf(E)===-1&&(M.push(E),S.push({url:E,filter:m}))}return this.subscribeMap(S,v)}subscribeMap(u,m){const v=new Map;for(const ze of u){const{url:Ce,filter:be}=ze;v.has(Ce)||v.set(Ce,[]),v.get(Ce).push(be)}const S=Array.from(v.entries()).map(([ze,Ce])=>({url:ze,filters:Ce}));this.trackRelays&&(m.receivedEvent=(ze,Ce)=>{let be=this.seenOn.get(Ce);be||(be=new Set,this.seenOn.set(Ce,be)),be.add(ze)});const M=new Set,R=[],E=[];let l=ze=>{E[ze]||(E[ze]=!0,E.filter(Ce=>Ce).length===S.length&&(m.oneose?.(),l=()=>{}))};const O=[];let Y=(ze,Ce)=>{O[ze]||(l(ze),O[ze]=Ce,O.filter(be=>be).length===S.length&&(m.onclose?.(O),Y=()=>{}))};const ie=ze=>{if(m.alreadyHaveEvent?.(ze))return!0;const Ce=M.has(ze);return M.add(ze),Ce},ne=Promise.all(S.map(async({url:ze,filters:Ce},be)=>{let he;try{he=await this.ensureRelay(ze,{connectionTimeout:m.maxWait?Math.max(m.maxWait*.8,m.maxWait-1e3):void 0})}catch(ve){Y(be,ve?.message||String(ve));return}let te=he.subscribe(Ce,{...m,oneose:()=>l(be),onclose:ve=>{ve.startsWith("auth-required: ")&&m.onauth?he.auth(m.onauth).then(()=>{he.subscribe(Ce,{...m,oneose:()=>l(be),onclose:qe=>{Y(be,qe)},alreadyHaveEvent:ie,eoseTimeout:m.maxWait})}).catch(qe=>{Y(be,`auth was required and attempted, but failed with: ${qe}`)}):Y(be,ve)},alreadyHaveEvent:ie,eoseTimeout:m.maxWait});R.push(te)}));return{async close(ze){await ne,R.forEach(Ce=>{Ce.close(ze)})}}}subscribeEose(u,m,v){const S=this.subscribe(u,m,{...v,oneose(){S.close("closed automatically on eose")}});return S}subscribeManyEose(u,m,v){const S=this.subscribeMany(u,m,{...v,oneose(){S.close("closed automatically on eose")}});return S}async querySync(u,m,v){return new Promise(async S=>{const M=[];this.subscribeEose(u,m,{...v,onevent(R){M.push(R)},onclose(R){S(M)}})})}async get(u,m,v){m.limit=1;const S=await this.querySync(u,m,v);return S.sort((M,R)=>R.created_at-M.created_at),S[0]||null}publish(u,m,v){return u.map(bf).map(async(S,M,R)=>{if(R.indexOf(S)!==M)return Promise.reject("duplicate url");let E=await this.ensureRelay(S);return E.publish(m).catch(async l=>{if(l instanceof Error&&l.message.startsWith("auth-required: ")&&v?.onauth)return await E.auth(v.onauth),E.publish(m);throw l}).then(l=>{if(this.trackRelays){let O=this.seenOn.get(m.id);O||(O=new Set,this.seenOn.set(m.id,O)),O.add(E)}return l})})}listConnectionStatus(){const u=new Map;return this.relays.forEach((m,v)=>u.set(v,m.connected)),u}destroy(){this.relays.forEach(u=>u.close()),this.relays=new Map}},Eb;try{Eb=WebSocket}catch{}var LT=class extends RT{constructor(u){super({verifyEvent:Ky,websocketImplementation:Eb,...u})}},Sf={};ur(Sf,{BECH32_REGEX:()=>Mb,Bech32MaxSize:()=>R0,NostrTypeGuard:()=>NT,decode:()=>Qy,decodeNostrURI:()=>OT,encodeBytes:()=>e_,naddrEncode:()=>GT,neventEncode:()=>qT,noteEncode:()=>UT,nprofileEncode:()=>VT,npubEncode:()=>FT,nsecEncode:()=>BT});var NT={isNProfile:u=>/^nprofile1[a-z\d]+$/.test(u||""),isNEvent:u=>/^nevent1[a-z\d]+$/.test(u||""),isNAddr:u=>/^naddr1[a-z\d]+$/.test(u||""),isNSec:u=>/^nsec1[a-z\d]{58}$/.test(u||""),isNPub:u=>/^npub1[a-z\d]{58}$/.test(u||""),isNote:u=>/^note1[a-z\d]+$/.test(u||""),isNcryptsec:u=>/^ncryptsec1[a-z\d]+$/.test(u||"")},R0=5e3,Mb=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function jT(u){const m=new Uint8Array(4);return m[0]=u>>24&255,m[1]=u>>16&255,m[2]=u>>8&255,m[3]=u&255,m}function OT(u){try{return u.startsWith("nostr:")&&(u=u.substring(6)),Qy(u)}catch{return{type:"invalid",data:null}}}function Qy(u){let{prefix:m,words:v}=$c.decode(u,R0),S=new Uint8Array($c.fromWords(v));switch(m){case"nprofile":{let M=B_(S);if(!M[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(M[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ki(M[0][0]),relays:M[1]?M[1].map(R=>Zu.decode(R)):[]}}}case"nevent":{let M=B_(S);if(!M[0]?.[0])throw new Error("missing TLV 0 for nevent");if(M[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(M[2]&&M[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(M[3]&&M[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ki(M[0][0]),relays:M[1]?M[1].map(R=>Zu.decode(R)):[],author:M[2]?.[0]?Ki(M[2][0]):void 0,kind:M[3]?.[0]?parseInt(Ki(M[3][0]),16):void 0}}}case"naddr":{let M=B_(S);if(!M[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!M[2]?.[0])throw new Error("missing TLV 2 for naddr");if(M[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!M[3]?.[0])throw new Error("missing TLV 3 for naddr");if(M[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Zu.decode(M[0][0]),pubkey:Ki(M[2][0]),kind:parseInt(Ki(M[3][0]),16),relays:M[1]?M[1].map(R=>Zu.decode(R)):[]}}}case"nsec":return{type:m,data:S};case"npub":case"note":return{type:m,data:Ki(S)};default:throw new Error(`unknown prefix ${m}`)}}function B_(u){let m={},v=u;for(;v.length>0;){let S=v[0],M=v[1],R=v.slice(2,2+M);if(v=v.slice(2+M),R.length<M)throw new Error(`not enough data to read on TLV ${S}`);m[S]=m[S]||[],m[S].push(R)}return m}function BT(u){return e_("nsec",u)}function FT(u){return e_("npub",rd(u))}function UT(u){return e_("note",rd(u))}function Jy(u,m){let v=$c.toWords(m);return $c.encode(u,v,R0)}function e_(u,m){return Jy(u,m)}function VT(u){let m=L0({0:[rd(u.pubkey)],1:(u.relays||[]).map(v=>ec.encode(v))});return Jy("nprofile",m)}function qT(u){let m;u.kind!==void 0&&(m=jT(u.kind));let v=L0({0:[rd(u.id)],1:(u.relays||[]).map(S=>ec.encode(S)),2:u.author?[rd(u.author)]:[],3:m?[new Uint8Array(m)]:[]});return Jy("nevent",v)}function GT(u){let m=new ArrayBuffer(4);new DataView(m).setUint32(0,u.kind,!1);let v=L0({0:[ec.encode(u.identifier)],1:(u.relays||[]).map(S=>ec.encode(S)),2:[rd(u.pubkey)],3:[new Uint8Array(m)]});return Jy("naddr",v)}function L0(u){let m=[];return Object.entries(u).reverse().forEach(([v,S])=>{S.forEach(M=>{let R=new Uint8Array(M.length+2);R.set([parseInt(v)],0),R.set([M.length],1),R.set(M,2),m.push(R)})}),Hy(...m)}var $T={};ur($T,{decrypt:()=>HT,encrypt:()=>Cb});function Cb(u,m,v){const S=u instanceof Uint8Array?Ki(u):u,M=Jp.getSharedSecret(S,"02"+m),R=Ab(M);let E=Uint8Array.from(Uv(16)),l=ec.encode(v),O=Qv(R,E).encrypt(l),Y=Xu.encode(new Uint8Array(O)),ie=Xu.encode(new Uint8Array(E.buffer));return`${Y}?iv=${ie}`}function HT(u,m,v){const S=u instanceof Uint8Array?Ki(u):u;let[M,R]=v.split("?iv="),E=Jp.getSharedSecret(S,"02"+m),l=Ab(E),O=Xu.decode(R),Y=Xu.decode(M),ie=Qv(l,O).decrypt(Y);return Zu.decode(ie)}function Ab(u){return u.slice(1,33)}var ZT={};ur(ZT,{NIP05_REGEX:()=>N0,isNip05:()=>XT,isValid:()=>WT,queryProfile:()=>zb,searchDomain:()=>KT,useFetchImplementation:()=>YT});var N0=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,XT=u=>N0.test(u||""),t_;try{t_=fetch}catch{}function YT(u){t_=u}async function KT(u,m=""){try{const v=`https://${u}/.well-known/nostr.json?name=${m}`,S=await t_(v,{redirect:"manual"});if(S.status!==200)throw Error("Wrong response code");return(await S.json()).names}catch{return{}}}async function zb(u){const m=u.match(N0);if(!m)return null;const[,v="_",S]=m;try{const M=`https://${S}/.well-known/nostr.json?name=${v}`,R=await t_(M,{redirect:"manual"});if(R.status!==200)throw Error("Wrong response code");const E=await R.json(),l=E.names[v];return l?{pubkey:l,relays:E.relays?.[l]}:null}catch{return null}}async function WT(u,m){const v=await zb(m);return v?v.pubkey===u:!1}var QT={};ur(QT,{parse:()=>JT});function JT(u){const m={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let v,S;for(let M=u.tags.length-1;M>=0;M--){const R=u.tags[M];if(R[0]==="e"&&R[1]){const[E,l,O,Y,ie]=R,ne={id:l,relays:O?[O]:[],author:ie};if(Y==="root"){m.root=ne;continue}if(Y==="reply"){m.reply=ne;continue}if(Y==="mention"){m.mentions.push(ne);continue}v?S=ne:v=ne,m.mentions.push(ne);continue}if(R[0]==="q"&&R[1]){const[E,l,O]=R;m.quotes.push({id:l,relays:O?[O]:[]})}if(R[0]==="p"&&R[1]){m.profiles.push({pubkey:R[1],relays:R[2]?[R[2]]:[]});continue}}return m.root||(m.root=S||v||m.reply),m.reply||(m.reply=v||m.root),[m.reply,m.root].forEach(M=>{if(!M)return;let R=m.mentions.indexOf(M);if(R!==-1&&m.mentions.splice(R,1),M.author){let E=m.profiles.find(l=>l.pubkey===M.author);E&&E.relays&&(M.relays||(M.relays=[]),E.relays.forEach(l=>{M.relays?.indexOf(l)===-1&&M.relays.push(l)}),E.relays=M.relays)}}),m.mentions.forEach(M=>{if(M.author){let R=m.profiles.find(E=>E.pubkey===M.author);R&&R.relays&&(M.relays||(M.relays=[]),R.relays.forEach(E=>{M.relays.indexOf(E)===-1&&M.relays.push(E)}),R.relays=M.relays)}}),m}var eE={};ur(eE,{fetchRelayInformation:()=>nE,useFetchImplementation:()=>tE});var kb;try{kb=fetch}catch{}function tE(u){kb=u}async function nE(u){return await(await fetch(u.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var iE={};ur(iE,{fastEventHash:()=>Db,getPow:()=>Pb,minePow:()=>rE});function Pb(u){let m=0;for(let v=0;v<64;v+=8){const S=parseInt(u.substring(v,v+8),16);if(S===0)m+=32;else{m+=Math.clz32(S);break}}return m}function rE(u,m){let v=0;const S=u,M=["nonce",v.toString(),m.toString()];for(S.tags.push(M);;){const R=Math.floor(new Date().getTime()/1e3);if(R!==S.created_at&&(v=0,S.created_at=R),M[1]=(++v).toString(),S.id=Db(S),Pb(S.id)>=m)break}return S}function Db(u){return Ki(ad(ec.encode(JSON.stringify([0,u.pubkey,u.created_at,u.kind,u.tags,u.content]))))}var aE={};ur(aE,{unwrapEvent:()=>gE,unwrapManyEvents:()=>yE,wrapEvent:()=>$b,wrapManyEvents:()=>mE});var sE={};ur(sE,{createRumor:()=>Ub,createSeal:()=>Vb,createWrap:()=>qb,unwrapEvent:()=>U0,unwrapManyEvents:()=>Gb,wrapEvent:()=>Oy,wrapManyEvents:()=>fE});var pg={};ur(pg,{decrypt:()=>F0,encrypt:()=>B0,getConversationKey:()=>j0,v2:()=>hE});var Ib=1,Rb=65535;function j0(u,m){const v=Jp.getSharedSecret(u,"02"+m).subarray(1,33);return V2(ad,v,"nip44-v2")}function Lb(u,m){const v=q2(ad,u,m,76);return{chacha_key:v.subarray(0,32),chacha_nonce:v.subarray(32,44),hmac_key:v.subarray(44,76)}}function O0(u){if(!Number.isSafeInteger(u)||u<1)throw new Error("expected positive integer");if(u<=32)return 32;const m=1<<Math.floor(Math.log2(u-1))+1,v=m<=256?32:m/8;return v*(Math.floor((u-1)/v)+1)}function oE(u){if(!Number.isSafeInteger(u)||u<Ib||u>Rb)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const m=new Uint8Array(2);return new DataView(m.buffer).setUint16(0,u,!1),m}function lE(u){const m=ec.encode(u),v=m.length,S=oE(v),M=new Uint8Array(O0(v)-v);return Hy(S,m,M)}function cE(u){const m=new DataView(u.buffer).getUint16(0),v=u.subarray(2,2+m);if(m<Ib||m>Rb||v.length!==m||u.length!==2+O0(m))throw new Error("invalid padding");return Zu.decode(v)}function Nb(u,m,v){if(v.length!==32)throw new Error("AAD associated data must be 32 bytes");const S=Hy(v,m);return Xy(ad,u,S)}function uE(u){if(typeof u!="string")throw new Error("payload must be a valid string");const m=u.length;if(m<132||m>87472)throw new Error("invalid payload length: "+m);if(u[0]==="#")throw new Error("unknown encryption version");let v;try{v=Xu.decode(u)}catch(R){throw new Error("invalid base64: "+R.message)}const S=v.length;if(S<99||S>65603)throw new Error("invalid data length: "+S);const M=v[0];if(M!==2)throw new Error("unknown encryption version "+M);return{nonce:v.subarray(1,33),ciphertext:v.subarray(33,-32),mac:v.subarray(-32)}}function B0(u,m,v=Uv(32)){const{chacha_key:S,chacha_nonce:M,hmac_key:R}=Lb(m,v),E=lE(u),l=nb(S,M,E),O=Nb(R,l,v);return Xu.encode(Hy(new Uint8Array([2]),v,l,O))}function F0(u,m){const{nonce:v,ciphertext:S,mac:M}=uE(u),{chacha_key:R,chacha_nonce:E,hmac_key:l}=Lb(m,v),O=Nb(l,S,v);if(!S2(O,M))throw new Error("invalid MAC");const Y=nb(R,E,S);return cE(Y)}var hE={utils:{getConversationKey:j0,calcPaddedLen:O0},encrypt:B0,decrypt:F0},dE=2880*60,jb=()=>Math.round(Date.now()/1e3),Ob=()=>Math.round(jb()-Math.random()*dE),Bb=(u,m)=>j0(u,m),Fb=(u,m,v)=>B0(JSON.stringify(u),Bb(m,v)),jx=(u,m)=>JSON.parse(F0(u.content,Bb(m,u.pubkey)));function Ub(u,m){const v={created_at:jb(),content:"",tags:[],...u,pubkey:fg(m)};return v.id=Cy(v),v}function Vb(u,m,v){return ul({kind:ub,content:Fb(u,m,v),created_at:Ob(),tags:[]},m)}function qb(u,m){const v=sb();return ul({kind:yb,content:Fb(u,v,m),created_at:Ob(),tags:[["p",m]]},v)}function Oy(u,m,v){const S=Ub(u,m),M=Vb(S,m,v);return qb(M,v)}function fE(u,m,v){if(!v||v.length===0)throw new Error("At least one recipient is required.");const S=fg(m),M=[Oy(u,m,S)];return v.forEach(R=>{M.push(Oy(u,m,R))}),M}function U0(u,m){const v=jx(u,m);return jx(v,m)}function Gb(u,m){let v=[];return u.forEach(S=>{v.push(U0(S,m))}),v.sort((S,M)=>S.created_at-M.created_at),v}function pE(u,m,v,S){const M={created_at:Math.ceil(Date.now()/1e3),kind:hb,tags:[],content:m};return(Array.isArray(u)?u:[u]).forEach(({publicKey:E,relayUrl:l})=>{M.tags.push(l?["p",E,l]:["p",E])}),S&&M.tags.push(["e",S.eventId,S.relayUrl||"","reply"]),v&&M.tags.push(["subject",v]),M}function $b(u,m,v,S,M){const R=pE(m,v,S,M);return Oy(R,u,m.publicKey)}function mE(u,m,v,S,M){if(!m||m.length===0)throw new Error("At least one recipient is required.");return[{publicKey:fg(u)},...m].map(E=>$b(u,E,v,S,M))}var gE=U0,yE=Gb,_E={};ur(_E,{finishRepostEvent:()=>xE,getRepostedEvent:()=>vE,getRepostedEventPointer:()=>Hb});function xE(u,m,v,S){let M;const R=[...u.tags??[],["e",m.id,v],["p",m.pubkey]];return m.kind===cb?M=k0:(M=D0,R.push(["k",String(m.kind)])),ul({kind:M,tags:R,content:u.content===""||m.tags?.find(E=>E[0]==="-")?"":JSON.stringify(m),created_at:u.created_at},S)}function Hb(u){if(![k0,D0].includes(u.kind))return;let m,v;for(let S=u.tags.length-1;S>=0&&(m===void 0||v===void 0);S--){const M=u.tags[S];M.length>=2&&(M[0]==="e"&&m===void 0?m=M:M[0]==="p"&&v===void 0&&(v=M))}if(m!==void 0)return{id:m[1],relays:[m[2],v?.[2]].filter(S=>typeof S=="string"),author:v?.[1]}}function vE(u,{skipVerification:m}={}){const v=Hb(u);if(v===void 0||u.content==="")return;let S;try{S=JSON.parse(u.content)}catch{return}if(S.id===v.id&&!(!m&&!Ky(S)))return S}var bE={};ur(bE,{NOSTR_URI_REGEX:()=>V0,parse:()=>SE,test:()=>wE});var V0=new RegExp(`nostr:(${Mb.source})`);function wE(u){return typeof u=="string"&&new RegExp(`^${V0.source}$`).test(u)}function SE(u){const m=u.match(new RegExp(`^${V0.source}$`));if(!m)throw new Error(`Invalid Nostr URI: ${u}`);return{uri:m[0],value:m[1],decoded:Qy(m[1])}}var TE={};ur(TE,{finishReactionEvent:()=>EE,getReactedEventPointer:()=>ME});function EE(u,m,v){const S=m.tags.filter(M=>M.length>=2&&(M[0]==="e"||M[0]==="p"));return ul({...u,kind:P0,tags:[...u.tags??[],...S,["e",m.id],["p",m.pubkey]],content:u.content??"+"},v)}function ME(u){if(u.kind!==P0)return;let m,v;for(let S=u.tags.length-1;S>=0&&(m===void 0||v===void 0);S--){const M=u.tags[S];M.length>=2&&(M[0]==="e"&&m===void 0?m=M:M[0]==="p"&&v===void 0&&(v=M))}if(!(m===void 0||v===void 0))return{id:m[1],relays:[m[2],v[2]].filter(S=>S!==void 0),author:v[1]}}var CE={};ur(CE,{parse:()=>zE});var Ox=/\W/m,Bx=/[^\w\/] |[^\w\/]$|$|,| /m,AE=42;function*zE(u){let m=[];if(typeof u!="string"){for(let R=0;R<u.tags.length;R++){const E=u.tags[R];E[0]==="emoji"&&E.length>=3&&m.push({type:"emoji",shortcode:E[1],url:E[2]})}u=u.content}const v=u.length;let S=0,M=0;e:for(;M<v;){const R=u.indexOf(":",M),E=u.indexOf("#",M);if(R===-1&&E===-1)break e;if(R===-1||E>=0&&E<R){if(E===0||u[E-1]===" "){const l=u.slice(E+1,E+AE).match(Ox),O=l?E+1+l.index:v;yield{type:"text",text:u.slice(S,E)},yield{type:"hashtag",value:u.slice(E+1,O)},M=O,S=M;continue e}M=E+1;continue e}if(u.slice(R-5,R)==="nostr"){const l=u.slice(R+60).match(Ox),O=l?R+60+l.index:v;try{let Y,{data:ie,type:ne}=Qy(u.slice(R+1,O));switch(ne){case"npub":Y={pubkey:ie};break;case"note":Y={id:ie};break;case"nsec":M=O+1;continue;default:Y=ie}S!==R-5&&(yield{type:"text",text:u.slice(S,R-5)}),yield{type:"reference",pointer:Y},M=O,S=M;continue e}catch{M=R+1;continue e}}else if(u.slice(R-5,R)==="https"||u.slice(R-4,R)==="http"){const l=u.slice(R+4).match(Bx),O=l?R+4+l.index:v,Y=u[R-1]==="s"?5:4;try{let ie=new URL(u.slice(R-Y,O));if(ie.hostname.indexOf(".")===-1)throw new Error("invalid url");if(S!==R-Y&&(yield{type:"text",text:u.slice(S,R-Y)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(ie.pathname)){yield{type:"image",url:ie.toString()},M=O,S=M;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(ie.pathname)){yield{type:"video",url:ie.toString()},M=O,S=M;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(ie.pathname)){yield{type:"audio",url:ie.toString()},M=O,S=M;continue e}yield{type:"url",url:ie.toString()},M=O,S=M;continue e}catch{M=O+1;continue e}}else if(u.slice(R-3,R)==="wss"||u.slice(R-2,R)==="ws"){const l=u.slice(R+4).match(Bx),O=l?R+4+l.index:v,Y=u[R-1]==="s"?3:2;try{let ie=new URL(u.slice(R-Y,O));if(ie.hostname.indexOf(".")===-1)throw new Error("invalid ws url");S!==R-Y&&(yield{type:"text",text:u.slice(S,R-Y)}),yield{type:"relay",url:ie.toString()},M=O,S=M;continue e}catch{M=O+1;continue e}}else{for(let l=0;l<m.length;l++){const O=m[l];if(u[R+O.shortcode.length+1]===":"&&u.slice(R+1,R+O.shortcode.length+1)===O.shortcode){S!==R&&(yield{type:"text",text:u.slice(S,R)}),yield O,M=R+O.shortcode.length+2,S=M;continue e}}M=R+1;continue e}}S!==v&&(yield{type:"text",text:u.slice(S)})}var kE={};ur(kE,{channelCreateEvent:()=>PE,channelHideMessageEvent:()=>RE,channelMessageEvent:()=>IE,channelMetadataEvent:()=>DE,channelMuteUserEvent:()=>LE});var PE=(u,m)=>{let v;if(typeof u.content=="object")v=JSON.stringify(u.content);else if(typeof u.content=="string")v=u.content;else return;return ul({kind:db,tags:[...u.tags??[]],content:v,created_at:u.created_at},m)},DE=(u,m)=>{let v;if(typeof u.content=="object")v=JSON.stringify(u.content);else if(typeof u.content=="string")v=u.content;else return;return ul({kind:fb,tags:[["e",u.channel_create_event_id],...u.tags??[]],content:v,created_at:u.created_at},m)},IE=(u,m)=>{const v=[["e",u.channel_create_event_id,u.relay_url,"root"]];return u.reply_to_channel_message_event_id&&v.push(["e",u.reply_to_channel_message_event_id,u.relay_url,"reply"]),ul({kind:pb,tags:[...v,...u.tags??[]],content:u.content,created_at:u.created_at},m)},RE=(u,m)=>{let v;if(typeof u.content=="object")v=JSON.stringify(u.content);else if(typeof u.content=="string")v=u.content;else return;return ul({kind:mb,tags:[["e",u.channel_message_event_id],...u.tags??[]],content:v,created_at:u.created_at},m)},LE=(u,m)=>{let v;if(typeof u.content=="object")v=JSON.stringify(u.content);else if(typeof u.content=="string")v=u.content;else return;return ul({kind:gb,tags:[["p",u.pubkey_to_mute],...u.tags??[]],content:v,created_at:u.created_at},m)},NE={};ur(NE,{EMOJI_SHORTCODE_REGEX:()=>Zb,matchAll:()=>jE,regex:()=>q0,replaceAll:()=>OE});var Zb=/:(\w+):/,q0=()=>new RegExp(`\\B${Zb.source}\\B`,"g");function*jE(u){const m=u.matchAll(q0());for(const v of m)try{const[S,M]=v;yield{shortcode:S,name:M,start:v.index,end:v.index+S.length}}catch{}}function OE(u,m){return u.replaceAll(q0(),(v,S)=>m({shortcode:v,name:S}))}var BE={};ur(BE,{useFetchImplementation:()=>FE,validateGithub:()=>UE});var G0;try{G0=fetch}catch{}function FE(u){G0=u}async function UE(u,m,v){try{return await(await G0(`https://gist.github.com/${m}/${v}/raw`)).text()===`Verifying that I control the following Nostr public key: ${u}`}catch{return!1}}var VE={};ur(VE,{makeNwcRequestEvent:()=>GE,parseConnectionString:()=>qE});function qE(u){const{host:m,pathname:v,searchParams:S}=new URL(u),M=v||m,R=S.get("relay"),E=S.get("secret");if(!M||!R||!E)throw new Error("invalid connection string");return{pubkey:M,relay:R,secret:E}}async function GE(u,m,v){const M=Cb(m,u,JSON.stringify({method:"pay_invoice",params:{invoice:v}})),R={kind:xb,created_at:Math.round(Date.now()/1e3),content:M,tags:[["p",u]]};return ul(R,m)}var $E={};ur($E,{normalizeIdentifier:()=>HE});function HE(u){return u=u.trim().toLowerCase(),u=u.normalize("NFKC"),Array.from(u).map(m=>new RegExp("\\p{Letter}","u").test(m)||new RegExp("\\p{Number}","u").test(m)?m:"-").join("")}var ZE={};ur(ZE,{getSatoshisAmountFromBolt11:()=>JE,getZapEndpoint:()=>YE,makeZapReceipt:()=>QE,makeZapRequest:()=>KE,useFetchImplementation:()=>XE,validateZapRequest:()=>WE});var $0;try{$0=fetch}catch{}function XE(u){$0=u}async function YE(u){try{let m="",{lud06:v,lud16:S}=JSON.parse(u.content);if(S){let[E,l]=S.split("@");m=new URL(`/.well-known/lnurlp/${E}`,`https://${l}`).toString()}else if(v){let{words:E}=$c.decode(v,1e3),l=$c.fromWords(E);m=Zu.decode(l)}else return null;let R=await(await $0(m)).json();if(R.allowsNostr&&R.nostrPubkey)return R.callback}catch{}return null}function KE(u){let m={kind:9734,created_at:Math.round(Date.now()/1e3),content:u.comment||"",tags:[["p","pubkey"in u?u.pubkey:u.event.pubkey],["amount",u.amount.toString()],["relays",...u.relays]]};if("event"in u){if(m.tags.push(["e",u.event.id]),A0(u.event.kind)){const v=["a",`${u.event.kind}:${u.event.pubkey}:`];m.tags.push(v)}else if(z0(u.event.kind)){let v=u.event.tags.find(([M,R])=>M==="d"&&R);if(!v)throw new Error("d tag not found or is empty");const S=["a",`${u.event.kind}:${u.event.pubkey}:${v[1]}`];m.tags.push(S)}m.tags.push(["k",u.event.kind.toString()])}return m}function WE(u){let m;try{m=JSON.parse(u)}catch{return"Invalid zap request JSON."}if(!M0(m))return"Zap request is not a valid Nostr event.";if(!Ky(m))return"Invalid signature on zap request.";let v=m.tags.find(([R,E])=>R==="p"&&E);if(!v)return"Zap request doesn't have a 'p' tag.";if(!v[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let S=m.tags.find(([R,E])=>R==="e"&&E);return S&&!S[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":m.tags.find(([R,E])=>R==="relays"&&E)?null:"Zap request doesn't have a 'relays' tag."}function QE({zapRequest:u,preimage:m,bolt11:v,paidAt:S}){let M=JSON.parse(u),R=M.tags.filter(([l])=>l==="e"||l==="p"||l==="a"),E={kind:9735,created_at:Math.round(S.getTime()/1e3),content:"",tags:[...R,["P",M.pubkey],["bolt11",v],["description",u]]};return m&&E.tags.push(["preimage",m]),E}function JE(u){if(u.length<50)return 0;u=u.substring(0,50);const m=u.lastIndexOf("1");if(m===-1)return 0;const v=u.substring(0,m);if(!v.startsWith("lnbc"))return 0;const S=v.substring(4);if(S.length<1)return 0;const M=S[S.length-1],R=M.charCodeAt(0)-48,E=R>=0&&R<=9;let l=S.length-1;if(E&&l++,l<1)return 0;const O=parseInt(S.substring(0,l));switch(M){case"m":return O*1e5;case"u":return O*100;case"n":return O/10;case"p":return O/1e4;default:return O*1e8}}var eM={};ur(eM,{Negentropy:()=>Yb,NegentropyStorageVector:()=>iM,NegentropySync:()=>rM});var F_=97,Zp=32,Xb=16,gf={Skip:0,Fingerprint:1,IdList:2},Hu=class{_raw;length;constructor(u){typeof u=="number"?(this._raw=new Uint8Array(u),this.length=0):u instanceof Uint8Array?(this._raw=new Uint8Array(u),this.length=u.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(u){if(u instanceof Hu&&(u=u.unwrap()),typeof u.length!="number")throw Error("bad length");const m=u.length+this.length;if(this.capacity<m){const v=this._raw,S=Math.max(this.capacity*2,m);this._raw=new Uint8Array(S),this._raw.set(v)}this._raw.set(u,this.length),this.length+=u.length}shift(){const u=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,u}shiftN(u=1){const m=this._raw.subarray(0,u);return this._raw=this._raw.subarray(u),this.length-=u,m}};function Sy(u){let m=0;for(;;){if(u.length===0)throw Error("parse ends prematurely");let v=u.shift();if(m=m<<7|v&127,(v&128)===0)break}return m}function Gu(u){if(u===0)return new Hu(new Uint8Array([0]));let m=[];for(;u!==0;)m.push(u&127),u>>>=7;m.reverse();for(let v=0;v<m.length-1;v++)m[v]|=128;return new Hu(new Uint8Array(m))}function tM(u){return Ay(u,1)[0]}function Ay(u,m){if(u.length<m)throw Error("parse ends prematurely");return u.shiftN(m)}var nM=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(Zp)}add(u){let m=0,v=0,S=new DataView(this.buf.buffer),M=new DataView(u.buffer);for(let R=0;R<8;R++){let E=R*4,l=S.getUint32(E,!0),O=M.getUint32(E,!0),Y=l;Y+=m,Y+=O,Y>4294967295&&(v=1),S.setUint32(E,Y&4294967295,!0),m=v,v=0}}negate(){let u=new DataView(this.buf.buffer);for(let v=0;v<8;v++){let S=v*4;u.setUint32(S,~u.getUint32(S,!0))}let m=new Uint8Array(Zp);m[0]=1,this.add(m)}getFingerprint(u){let m=new Hu;return m.extend(this.buf),m.extend(Gu(u)),ad(m.unwrap()).subarray(0,Xb)}},iM=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(u,m){if(this.sealed)throw Error("already sealed");const v=Zv(m);if(v.byteLength!==Zp)throw Error("bad id size for added item");this.items.push({timestamp:u,id:v})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(U_);for(let u=1;u<this.items.length;u++)if(U_(this.items[u-1],this.items[u])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(u){if(this._checkSealed(),u>=this.items.length)throw Error("out of range");return this.items[u]}iterate(u,m,v){this._checkSealed(),this._checkBounds(u,m);for(let S=u;S<m&&v(this.items[S],S);++S);}findLowerBound(u,m,v){return this._checkSealed(),this._checkBounds(u,m),this._binarySearch(this.items,u,m,S=>U_(S,v)<0)}fingerprint(u,m){let v=new nM;return v.setToZero(),this.iterate(u,m,S=>(v.add(S.id),!0)),v.getFingerprint(m-u)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(u,m){if(u>m||m>this.items.length)throw Error("bad range")}_binarySearch(u,m,v,S){let M=v-m;for(;M>0;){let R=m,E=Math.floor(M/2);R+=E,S(u[R])?(m=++R,M-=E+1):M=E}return m}},Yb=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(u,m=6e4){if(m<4096)throw Error("frameSizeLimit too small");this.storage=u,this.frameSizeLimit=m,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(u,m){return{timestamp:u,id:m||new Uint8Array(0)}}initiate(){let u=new Hu;return u.extend(new Uint8Array([F_])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),u),$p(u.unwrap())}reconcile(u,m,v){const S=new Hu(Zv(u));this.lastTimestampIn=this.lastTimestampOut=0;let M=new Hu;M.extend(new Uint8Array([F_]));let R=tM(S);if(R<96||R>111)throw Error("invalid negentropy protocol version byte");if(R!==F_)throw Error("unsupported negentropy protocol version requested: "+(R-96));let E=this.storage.size(),l=this._bound(0),O=0,Y=!1;for(;S.length!==0;){let ie=new Hu,ne=()=>{Y&&(Y=!1,ie.extend(this.encodeBound(l)),ie.extend(Gu(gf.Skip)))},ze=this.decodeBound(S),Ce=Sy(S),be=O,he=this.storage.findLowerBound(O,E,ze);if(Ce===gf.Skip)Y=!0;else if(Ce===gf.Fingerprint){let te=Ay(S,Xb),ve=this.storage.fingerprint(be,he);Kb(te,ve)!==0?(ne(),this.splitRange(be,he,ze,ie)):Y=!0}else if(Ce===gf.IdList){let te=Sy(S),ve={};for(let qe=0;qe<te;qe++){let lt=Ay(S,Zp);ve[$p(lt)]=lt}if(Y=!0,this.storage.iterate(be,he,qe=>{let lt=qe.id;const Pt=$p(lt);return ve[Pt]?delete ve[$p(lt)]:m?.(Pt),!0}),v)for(let qe of Object.values(ve))v($p(qe))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(M.length+ie.length)){let te=this.storage.fingerprint(he,E);M.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),M.extend(Gu(gf.Fingerprint)),M.extend(te);break}else M.extend(ie);O=he,l=ze}return M.length===1?null:$p(M.unwrap())}splitRange(u,m,v,S){let M=m-u,R=16;if(M<R*2)S.extend(this.encodeBound(v)),S.extend(Gu(gf.IdList)),S.extend(Gu(M)),this.storage.iterate(u,m,E=>(S.extend(E.id),!0));else{let E=Math.floor(M/R),l=M%R,O=u;for(let Y=0;Y<R;Y++){let ie=E+(Y<l?1:0),ne=this.storage.fingerprint(O,O+ie);O+=ie;let ze;if(O===m)ze=v;else{let Ce,be;this.storage.iterate(O-1,O+1,(he,te)=>(te===O-1?Ce=he:be=he,!0)),ze=this.getMinimalBound(Ce,be)}S.extend(this.encodeBound(ze)),S.extend(Gu(gf.Fingerprint)),S.extend(ne)}}}exceededFrameSizeLimit(u){return u>this.frameSizeLimit-200}decodeTimestampIn(u){let m=Sy(u);return m=m===0?Number.MAX_VALUE:m-1,this.lastTimestampIn===Number.MAX_VALUE||m===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(m+=this.lastTimestampIn,this.lastTimestampIn=m,m)}decodeBound(u){let m=this.decodeTimestampIn(u),v=Sy(u);if(v>Zp)throw Error("bound key too long");let S=Ay(u,v);return{timestamp:m,id:S}}encodeTimestampOut(u){if(u===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,Gu(0);let m=u;return u-=this.lastTimestampOut,this.lastTimestampOut=m,Gu(u+1)}encodeBound(u){let m=new Hu;return m.extend(this.encodeTimestampOut(u.timestamp)),m.extend(Gu(u.id.length)),m.extend(u.id),m}getMinimalBound(u,m){if(m.timestamp!==u.timestamp)return this._bound(m.timestamp);{let v=0,S=m.id,M=u.id;for(let R=0;R<Zp&&S[R]===M[R];R++)v++;return this._bound(m.timestamp,m.id.subarray(0,v+1))}}};function Kb(u,m){for(let v=0;v<u.byteLength;v++){if(u[v]<m[v])return-1;if(u[v]>m[v])return 1}return u.byteLength>m.byteLength?1:u.byteLength<m.byteLength?-1:0}function U_(u,m){return u.timestamp===m.timestamp?Kb(u.id,m.id):u.timestamp-m.timestamp}var rM=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(u,m,v,S={}){this.relay=u,this.storage=m,this.neg=new Yb(m),this.onhave=S.onhave,this.onneed=S.onneed,this.filter=v,this.subscription=this.relay.prepareSubscription([{}],{label:S.label||"negentropy"}),this.subscription.oncustom=M=>{switch(M[0]){case"NEG-MSG":{M.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${M}`);try{const R=this.neg.reconcile(M[2],this.onhave,this.onneed);R?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${R}"]`):(this.close(),S.onclose?.())}catch(R){console.error("negentropy reconcile error:",R),S?.onclose?.(`reconcile error: ${R}`)}break}case"NEG-CLOSE":{const R=M[2];console.warn("negentropy error:",R),S.onclose?.(R);break}case"NEG-ERR":S.onclose?.()}}}async start(){const u=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${u}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},aM={};ur(aM,{getToken:()=>sM,hashPayload:()=>H0,unpackEventFromToken:()=>Qb,validateEvent:()=>r1,validateEventKind:()=>e1,validateEventMethodTag:()=>n1,validateEventPayloadTag:()=>i1,validateEventTimestamp:()=>Jb,validateEventUrlTag:()=>t1,validateToken:()=>oM});var Wb="Nostr ";async function sM(u,m,v,S=!1,M){const R={kind:I0,tags:[["u",u],["method",m]],created_at:Math.round(new Date().getTime()/1e3),content:""};M&&R.tags.push(["payload",H0(M)]);const E=await v(R);return(S?Wb:"")+Xu.encode(ec.encode(JSON.stringify(E)))}async function oM(u,m,v){const S=await Qb(u).catch(R=>{throw R});return await r1(S,m,v).catch(R=>{throw R})}async function Qb(u){if(!u)throw new Error("Missing token");u=u.replace(Wb,"");const m=Zu.decode(Xu.decode(u));if(!m||m.length===0||!m.startsWith("{"))throw new Error("Invalid token");return JSON.parse(m)}function Jb(u){return u.created_at?Math.round(new Date().getTime()/1e3)-u.created_at<60:!1}function e1(u){return u.kind===I0}function t1(u,m){const v=u.tags.find(S=>S[0]==="u");return v?v.length>0&&v[1]===m:!1}function n1(u,m){const v=u.tags.find(S=>S[0]==="method");return v?v.length>0&&v[1].toLowerCase()===m.toLowerCase():!1}function H0(u){const m=ad(ec.encode(JSON.stringify(u)));return Ki(m)}function i1(u,m){const v=u.tags.find(M=>M[0]==="payload");if(!v)return!1;const S=H0(m);return v.length>0&&v[1]===S}async function r1(u,m,v,S){if(!Ky(u))throw new Error("Invalid nostr event, signature invalid");if(!e1(u))throw new Error("Invalid nostr event, kind invalid");if(!Jb(u))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!t1(u,m))throw new Error("Invalid nostr event, url tag invalid");if(!n1(u,v))throw new Error("Invalid nostr event, method tag invalid");if(S&&typeof S=="object"&&Object.keys(S).length>0&&!i1(u,S))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Fx=u=>Array.from(u).map(m=>m.toString(16).padStart(2,"0")).join(""),a1=me.createContext(null),lM=({children:u})=>{const[m,v]=me.useState(localStorage.getItem("parlens_pubkey")),[S]=me.useState(()=>new LT({enablePing:!0,enableReconnect:!0})),M=async(l,O,Y)=>{let ie="",ne=null;if(l==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");ie=await window.nostr.getPublicKey()}else if(l==="nsec"&&O)try{const ze=Sf.decode(O);if(ze.type!=="nsec")throw new Error("Not an nsec");ne=ze.data,ie=fg(ne),localStorage.setItem("parlens_privkey",Fx(ne))}catch{throw new Error("Invalid nsec format")}else l==="create"&&(ne=sb(),ie=fg(ne),localStorage.setItem("parlens_privkey",Fx(ne)));if(v(ie),localStorage.setItem("parlens_pubkey",ie),l==="create"&&Y&&ne)try{const ze=ul({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:Y,display_name:Y,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${ie}`})},ne);await Promise.any([S.publish(["wss://relay.damus.io","wss://nos.lol"],ze)])}catch(ze){console.warn("Failed to publish metadata:",ze)}},R=()=>{v(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},E=async l=>{const O=localStorage.getItem("parlens_privkey");if(O){const Y=new Uint8Array(O.match(/.{1,2}/g).map(ie=>parseInt(ie,16)));return ul(l,Y)}if(window.nostr)return await window.nostr.signEvent(l);throw new Error("No signing method available")};return k.jsx(a1.Provider,{value:{pubkey:m,login:M,logout:R,pool:S,signEvent:E},children:u})},Zc=()=>{const u=me.useContext(a1);if(!u)throw new Error("useAuth must be used within AuthProvider");return u};const cM=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),uM=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(m,v,S)=>S?S.toUpperCase():v.toLowerCase()),Ux=u=>{const m=uM(u);return m.charAt(0).toUpperCase()+m.slice(1)},s1=(...u)=>u.filter((m,v,S)=>!!m&&m.trim()!==""&&S.indexOf(m)===v).join(" ").trim(),hM=u=>{for(const m in u)if(m.startsWith("aria-")||m==="role"||m==="title")return!0};var dM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const fM=me.forwardRef(({color:u="currentColor",size:m=24,strokeWidth:v=2,absoluteStrokeWidth:S,className:M="",children:R,iconNode:E,...l},O)=>me.createElement("svg",{ref:O,...dM,width:m,height:m,stroke:u,strokeWidth:S?Number(v)*24/Number(m):v,className:s1("lucide",M),...!R&&!hM(l)&&{"aria-hidden":"true"},...l},[...E.map(([Y,ie])=>me.createElement(Y,ie)),...Array.isArray(R)?R:[R]]));const oi=(u,m)=>{const v=me.forwardRef(({className:S,...M},R)=>me.createElement(fM,{ref:R,iconNode:m,className:s1(`lucide-${cM(Ux(u))}`,`lucide-${u}`,S),...M}));return v.displayName=Ux(u),v};const pM=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],o1=oi("arrow-left",pM);const mM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],l1=oi("arrow-right",mM);const gM=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],yM=oi("arrow-up-down",gM);const _M=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],xM=oi("arrow-up",_M);const vM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Xp=oi("check",vM);const bM=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],nd=oi("chevron-down",bM);const wM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ef=oi("chevron-right",wM);const SM=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],n_=oi("chevron-up",SM);const TM=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],c1=oi("clock",TM);const EM=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Z0=oi("copy",EM);const MM=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],CM=oi("eye-off",MM);const AM=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],zM=oi("eye",AM);const kM=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],PM=oi("folder-open",kM);const DM=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],a0=oi("key",DM);const IM=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],RM=oi("locate-fixed",IM);const LM=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],Ty=oi("locate",LM);const NM=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Hc=oi("map-pin",NM);const jM=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],OM=oi("map-pinned",jM);const BM=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],FM=oi("navigation",BM);const UM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Wp=oi("pencil",UM);const VM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],mg=oi("plus",VM);const qM=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],zy=oi("qr-code",qM);const GM=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Vx=oi("radio",GM);const $M=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],HM=oi("rotate-ccw",$M);const ZM=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],XM=oi("route",ZM);const YM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],KM=oi("save",YM);const WM=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],QM=oi("scan-line",WM);const JM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],u1=oi("search",JM);const eC=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],h1=oi("shield",eC);const tC=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Mf=oi("trash-2",tC);const nC=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],qx=oi("trash",nC);const iC=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],rC=oi("user-plus",iC);const aC=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],sC=oi("user",aC);const oC=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],lC=oi("users",oC);const cC=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Io=oi("x",cC),uC=me.createContext(null);function hC(u,m){const v=Array.isArray(u)?u[0]:u?u.x:0,S=Array.isArray(u)?u[1]:u?u.y:0,M=Array.isArray(m)?m[0]:m?m.x:0,R=Array.isArray(m)?m[1]:m?m.y:0;return v===M&&S===R}function oo(u,m){if(u===m)return!0;if(!u||!m)return!1;if(Array.isArray(u)){if(!Array.isArray(m)||u.length!==m.length)return!1;for(let v=0;v<u.length;v++)if(!oo(u[v],m[v]))return!1;return!0}else if(Array.isArray(m))return!1;if(typeof u=="object"&&typeof m=="object"){const v=Object.keys(u),S=Object.keys(m);if(v.length!==S.length)return!1;for(const M of v)if(!m.hasOwnProperty(M)||!oo(u[M],m[M]))return!1;return!0}return!1}function Gx(u){return{longitude:u.center.lng,latitude:u.center.lat,zoom:u.zoom,pitch:u.pitch,bearing:u.bearing,padding:u.padding}}function $x(u,m){const v=m.viewState||m,S={};if("longitude"in v&&"latitude"in v&&(v.longitude!==u.center.lng||v.latitude!==u.center.lat)){const M=u.center.constructor;S.center=new M(v.longitude,v.latitude)}return"zoom"in v&&v.zoom!==u.zoom&&(S.zoom=v.zoom),"bearing"in v&&v.bearing!==u.bearing&&(S.bearing=v.bearing),"pitch"in v&&v.pitch!==u.pitch&&(S.pitch=v.pitch),v.padding&&u.padding&&!oo(v.padding,u.padding)&&(S.padding=v.padding),S}const dC=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Hx(u){if(!u)return null;if(typeof u=="string"||("toJS"in u&&(u=u.toJS()),!u.layers))return u;const m={};for(const S of u.layers)m[S.id]=S;const v=u.layers.map(S=>{let M=null;"interactive"in S&&(M=Object.assign({},S),delete M.interactive);const R=m[S.ref];if(R){M=M||Object.assign({},S),delete M.ref;for(const E of dC)E in R&&(M[E]=R[E])}return M||S});return{...u,layers:v}}const Zx={version:8,sources:{},layers:[]},Xx={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Yx={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Kx={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},fC=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],pC=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Qp{constructor(m,v,S){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=M=>{const R=this.props[Kx[M.type]];R?R(M):M.type==="error"&&console.error(M.error)},this._onCameraEvent=M=>{if(this._internalUpdate)return;M.viewState=this._propsedCameraUpdate||Gx(this._map.transform);const R=this.props[Yx[M.type]];R&&R(M)},this._onCameraUpdate=M=>this._internalUpdate?M:(this._propsedCameraUpdate=Gx(M),$x(M,this.props)),this._onPointerEvent=M=>{(M.type==="mousemove"||M.type==="mouseout")&&this._updateHover(M);const R=this.props[Xx[M.type]];R&&(this.props.interactiveLayerIds&&M.type!=="mouseover"&&M.type!=="mouseout"&&(M.features=this._hoveredFeatures||this._queryRenderedFeatures(M.point)),R(M),delete M.features)},this._MapClass=m,this.props=v,this._initialize(S)}get map(){return this._map}setProps(m){const v=this.props;this.props=m;const S=this._updateSettings(m,v),M=this._updateSize(m),R=this._updateViewState(m);this._updateStyle(m,v),this._updateStyleComponents(m),this._updateHandlers(m,v),(S||M||R&&!this._map.isMoving())&&this.redraw()}static reuse(m,v){const S=Qp.savedMaps.pop();if(!S)return null;const M=S.map,R=M.getContainer();for(v.className=R.className;R.childNodes.length>0;)v.appendChild(R.childNodes[0]);M._container=v;const E=M._resizeObserver;E&&(E.disconnect(),E.observe(v)),S.setProps({...m,styleDiffing:!1}),M.resize();const{initialViewState:l}=m;return l&&(l.bounds?M.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):S._updateViewState(l)),M.isStyleLoaded()?M.fire("load"):M.once("style.load",()=>M.fire("load")),M._update(),S}_initialize(m){const{props:v}=this,{mapStyle:S=Zx}=v,M={...v,...v.initialViewState,container:m,style:Hx(S)},R=M.initialViewState||M.viewState||M;if(Object.assign(M,{center:[R.longitude||0,R.latitude||0],zoom:R.zoom||0,pitch:R.pitch||0,bearing:R.bearing||0}),v.gl){const l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=l,v.gl)}const E=new this._MapClass(M);R.padding&&E.setPadding(R.padding),v.cursor&&(E.getCanvas().style.cursor=v.cursor),E.transformCameraUpdate=this._onCameraUpdate,E.on("style.load",()=>{this._styleComponents={light:E.getLight(),sky:E.getSky(),projection:E.getProjection?.(),terrain:E.getTerrain()},this._updateStyleComponents(this.props)}),E.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const l in Xx)E.on(l,this._onPointerEvent);for(const l in Yx)E.on(l,this._onCameraEvent);for(const l in Kx)E.on(l,this._onEvent);this._map=E}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Qp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const m=this._map;m.style&&(m._frame&&(m._frame.cancel(),m._frame=null),m._render())}_updateSize(m){const{viewState:v}=m;if(v){const S=this._map;if(v.width!==S.transform.width||v.height!==S.transform.height)return S.resize(),!0}return!1}_updateViewState(m){const v=this._map,S=v.transform;if(!v.isMoving()){const R=$x(S,m);if(Object.keys(R).length>0)return this._internalUpdate=!0,v.jumpTo(R),this._internalUpdate=!1,!0}return!1}_updateSettings(m,v){const S=this._map;let M=!1;for(const R of fC)R in m&&!oo(m[R],v[R])&&(M=!0,S[`set${R[0].toUpperCase()}${R.slice(1)}`]?.call(S,m[R]));return M}_updateStyle(m,v){if(m.cursor!==v.cursor&&(this._map.getCanvas().style.cursor=m.cursor||""),m.mapStyle!==v.mapStyle){const{mapStyle:S=Zx,styleDiffing:M=!0}=m,R={diff:M};"localIdeographFontFamily"in m&&(R.localIdeographFontFamily=m.localIdeographFontFamily),this._map.setStyle(Hx(S),R)}}_updateStyleComponents({light:m,projection:v,sky:S,terrain:M}){const R=this._map,E=this._styleComponents;R.style._loaded&&(m&&!oo(m,E.light)&&(E.light=m,R.setLight(m)),v&&!oo(v,E.projection)&&v!==E.projection?.type&&(E.projection=typeof v=="string"?{type:v}:v,R.setProjection?.(E.projection)),S&&!oo(S,E.sky)&&(E.sky=S,R.setSky(S)),M!==void 0&&!oo(M,E.terrain)&&(!M||R.getSource(M.source))&&(E.terrain=M,R.setTerrain(M)))}_updateHandlers(m,v){const S=this._map;for(const M of pC){const R=m[M]??!0,E=v[M]??!0;oo(R,E)||(R?S[M].enable(R):S[M].disable())}}_queryRenderedFeatures(m){const v=this._map,{interactiveLayerIds:S=[]}=this.props;try{return v.queryRenderedFeatures(m,{layers:S.filter(v.getLayer.bind(v))})}catch{return[]}}_updateHover(m){const{props:v}=this;if(v.interactiveLayerIds&&(v.onMouseMove||v.onMouseEnter||v.onMouseLeave)){const M=m.type,R=this._hoveredFeatures?.length>0,E=this._queryRenderedFeatures(m.point),l=E.length>0;!l&&R&&(m.type="mouseleave",this._onPointerEvent(m)),this._hoveredFeatures=E,l&&!R&&(m.type="mouseenter",this._onPointerEvent(m)),m.type=M}else this._hoveredFeatures=null}}Qp.savedMaps=[];const mC=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function gC(u){if(!u)return null;const m=u.map,v={getMap:()=>m};for(const S of yC(m))!(S in v)&&!mC.includes(S)&&(v[S]=m[S].bind(m));return v}function yC(u){const m=new Set;let v=u;for(;v;){for(const S of Object.getOwnPropertyNames(v))S[0]!=="_"&&typeof u[S]=="function"&&S!=="fire"&&S!=="setEventedParent"&&m.add(S);v=Object.getPrototypeOf(v)}return Array.from(m)}const _C=typeof document<"u"?me.useLayoutEffect:me.useEffect;function xC(u,m){const{RTLTextPlugin:v,maxParallelImageRequests:S,workerCount:M,workerUrl:R}=m;if(v&&u.getRTLTextPluginStatus&&u.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:E,lazy:l=!0}=typeof v=="string"?{pluginUrl:v}:v;u.setRTLTextPlugin(E,O=>{O&&console.error(O)},l)}S!==void 0&&u.setMaxParallelImageRequests(S),M!==void 0&&u.setWorkerCount(M),R!==void 0&&u.setWorkerUrl(R)}const tm=me.createContext(null);function vC(u,m){const v=me.useContext(uC),[S,M]=me.useState(null),R=me.useRef(),{current:E}=me.useRef({mapLib:null,map:null});me.useEffect(()=>{const Y=u.mapLib;let ie=!0,ne;return Promise.resolve(Y||Dy(()=>Promise.resolve().then(()=>OC),void 0)).then(ze=>{if(!ie)return;if(!ze)throw new Error("Invalid mapLib");const Ce="Map"in ze?ze:ze.default;if(!Ce.Map)throw new Error("Invalid mapLib");xC(Ce,u),u.reuseMaps&&(ne=Qp.reuse(u,R.current)),ne||(ne=new Qp(Ce.Map,u,R.current)),E.map=gC(ne),E.mapLib=Ce,M(ne),v?.onMapMount(E.map,u.id)}).catch(ze=>{const{onError:Ce}=u;Ce?Ce({type:"error",target:null,originalEvent:null,error:ze}):console.error(ze)}),()=>{ie=!1,ne&&(v?.onMapUnmount(u.id),u.reuseMaps?ne.recycle():ne.destroy())}},[]),_C(()=>{S&&S.setProps(u)}),me.useImperativeHandle(m,()=>E.map,[S]);const l=me.useMemo(()=>({position:"relative",width:"100%",height:"100%",...u.style}),[u.style]),O={height:"100%"};return me.createElement("div",{id:u.id,ref:R,style:l},S&&me.createElement(tm.Provider,{value:E},me.createElement("div",{"mapboxgl-children":"",style:O},u.children)))}const bC=me.forwardRef(vC);var d1=xv();const wC=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Qu(u,m){if(!u||!m)return;const v=u.style;for(const S in m){const M=m[S];Number.isFinite(M)&&!wC.test(S)?v[S]=`${M}px`:v[S]=M}}function f1(u,m){if(u===m)return null;const v=Wx(u),S=Wx(m),M=[];for(const R of S)v.has(R)||M.push(R);for(const R of v)S.has(R)||M.push(R);return M.length===0?null:M}function Wx(u){return new Set(u?u.trim().split(/\s+/):[])}const yf=me.memo(me.forwardRef((u,m)=>{const{map:v,mapLib:S}=me.useContext(tm),M=me.useRef({props:u}),R=me.useMemo(()=>{let ve=!1;me.Children.forEach(u.children,Pt=>{Pt&&(ve=!0)});const qe={...u,element:ve?document.createElement("div"):void 0},lt=new S.Marker(qe);return lt.setLngLat([u.longitude,u.latitude]),lt.getElement().addEventListener("click",Pt=>{M.current.props.onClick?.({type:"click",target:lt,originalEvent:Pt})}),lt.on("dragstart",Pt=>{const Et=Pt;Et.lngLat=R.getLngLat(),M.current.props.onDragStart?.(Et)}),lt.on("drag",Pt=>{const Et=Pt;Et.lngLat=R.getLngLat(),M.current.props.onDrag?.(Et)}),lt.on("dragend",Pt=>{const Et=Pt;Et.lngLat=R.getLngLat(),M.current.props.onDragEnd?.(Et)}),lt},[]);me.useEffect(()=>(R.addTo(v.getMap()),()=>{R.remove()}),[]);const{longitude:E,latitude:l,offset:O,style:Y,draggable:ie=!1,popup:ne=null,rotation:ze=0,rotationAlignment:Ce="auto",pitchAlignment:be="auto"}=u;me.useEffect(()=>{Qu(R.getElement(),Y)},[Y]),me.useImperativeHandle(m,()=>R,[]);const he=M.current.props;(R.getLngLat().lng!==E||R.getLngLat().lat!==l)&&R.setLngLat([E,l]),O&&!hC(R.getOffset(),O)&&R.setOffset(O),R.isDraggable()!==ie&&R.setDraggable(ie),R.getRotation()!==ze&&R.setRotation(ze),R.getRotationAlignment()!==Ce&&R.setRotationAlignment(Ce),R.getPitchAlignment()!==be&&R.setPitchAlignment(be),R.getPopup()!==ne&&R.setPopup(ne);const te=f1(he.className,u.className);if(te)for(const ve of te)R.toggleClassName(ve);return M.current.props=u,d1.createPortal(u.children,R.getElement())}));me.memo(me.forwardRef((u,m)=>{const{map:v,mapLib:S}=me.useContext(tm),M=me.useMemo(()=>document.createElement("div"),[]),R=me.useRef({props:u}),E=me.useMemo(()=>{const l={...u},O=new S.Popup(l);return O.setLngLat([u.longitude,u.latitude]),O.once("open",Y=>{R.current.props.onOpen?.(Y)}),O},[]);if(me.useEffect(()=>{const l=O=>{R.current.props.onClose?.(O)};return E.on("close",l),E.setDOMContent(M).addTo(v.getMap()),()=>{E.off("close",l),E.isOpen()&&E.remove()}},[]),me.useEffect(()=>{Qu(E.getElement(),u.style)},[u.style]),me.useImperativeHandle(m,()=>E,[]),E.isOpen()){const l=R.current.props;(E.getLngLat().lng!==u.longitude||E.getLngLat().lat!==u.latitude)&&E.setLngLat([u.longitude,u.latitude]),u.offset&&!oo(l.offset,u.offset)&&E.setOffset(u.offset),(l.anchor!==u.anchor||l.maxWidth!==u.maxWidth)&&(E.options.anchor=u.anchor,E.setMaxWidth(u.maxWidth));const O=f1(l.className,u.className);if(O)for(const Y of O)E.toggleClassName(Y);R.current.props=u}return d1.createPortal(u.children,M)}));function Cf(u,m,v,S){const M=me.useContext(tm),R=me.useMemo(()=>u(M),[]);return me.useEffect(()=>{const E=m,l=null,O=typeof m=="function"?m:null,{map:Y}=M;return Y.hasControl(R)||(Y.addControl(R,E?.position),l&&l(M)),()=>{O&&O(M),Y.hasControl(R)&&Y.removeControl(R)}},[]),R}function SC(u){const m=Cf(({mapLib:v})=>new v.AttributionControl(u),{position:u.position});return me.useEffect(()=>{Qu(m._container,u.style)},[u.style]),null}me.memo(SC);function TC(u){const m=Cf(({mapLib:v})=>new v.FullscreenControl({container:u.containerId&&document.getElementById(u.containerId)}),{position:u.position});return me.useEffect(()=>{Qu(m._controlContainer,u.style)},[u.style]),null}me.memo(TC);function EC(u,m){const v=me.useRef({props:u}),S=Cf(({mapLib:M})=>{const R=new M.GeolocateControl(u),E=R._setupUI;return R._setupUI=()=>{R._container.hasChildNodes()||E()},R.on("geolocate",l=>{v.current.props.onGeolocate?.(l)}),R.on("error",l=>{v.current.props.onError?.(l)}),R.on("outofmaxbounds",l=>{v.current.props.onOutOfMaxBounds?.(l)}),R.on("trackuserlocationstart",l=>{v.current.props.onTrackUserLocationStart?.(l)}),R.on("trackuserlocationend",l=>{v.current.props.onTrackUserLocationEnd?.(l)}),R},{position:u.position});return v.current.props=u,me.useImperativeHandle(m,()=>S,[]),me.useEffect(()=>{Qu(S._container,u.style)},[u.style]),null}me.memo(me.forwardRef(EC));function MC(u){const m=Cf(({mapLib:v})=>new v.NavigationControl(u),{position:u.position});return me.useEffect(()=>{Qu(m._container,u.style)},[u.style]),null}me.memo(MC);function CC(u){const m=Cf(({mapLib:R})=>new R.ScaleControl(u),{position:u.position}),v=me.useRef(u),S=v.current;v.current=u;const{style:M}=u;return u.maxWidth!==void 0&&u.maxWidth!==S.maxWidth&&(m.options.maxWidth=u.maxWidth),u.unit!==void 0&&u.unit!==S.unit&&m.setUnit(u.unit),me.useEffect(()=>{Qu(m._container,M)},[M]),null}me.memo(CC);function AC(u){const m=Cf(({mapLib:v})=>new v.TerrainControl(u),{position:u.position});return me.useEffect(()=>{Qu(m._container,u.style)},[u.style]),null}me.memo(AC);function zC(u){const m=Cf(({mapLib:v})=>new v.LogoControl(u),{position:u.position});return me.useEffect(()=>{Qu(m._container,u.style)},[u.style]),null}me.memo(zC);function By(u,m){if(!u)throw new Error(m)}let kC=0;function PC(u,m,v){if(u.style&&u.style._loaded){const S={...v};return delete S.id,delete S.children,u.addSource(m,S),u.getSource(m)}return null}function DC(u,m,v){By(m.id===v.id,"source id changed"),By(m.type===v.type,"source type changed");let S="",M=0;for(const E in m)E!=="children"&&E!=="id"&&!oo(v[E],m[E])&&(S=E,M++);if(!M)return;const R=m.type;if(R==="geojson")u.setData(m.data);else if(R==="image")u.updateImage({url:m.url,coordinates:m.coordinates});else switch(S){case"coordinates":u.setCoordinates?.(m.coordinates);break;case"url":u.setUrl?.(m.url);break;case"tiles":u.setTiles?.(m.tiles);break;default:console.warn(`Unable to update <Source> prop: ${S}`)}}function Qx(u){const m=me.useContext(tm).map.getMap(),v=me.useRef(u),[,S]=me.useState(0),M=me.useMemo(()=>u.id||`jsx-source-${kC++}`,[]);me.useEffect(()=>{if(m){const E=()=>setTimeout(()=>S(l=>l+1),0);return m.on("styledata",E),E(),()=>{if(m.off("styledata",E),m.style&&m.style._loaded&&m.getSource(M)){const l=m.getStyle()?.layers;if(l)for(const O of l)O.source===M&&m.removeLayer(O.id);m.removeSource(M)}}}},[m]);let R=m&&m.style&&m.getSource(M);return R?DC(R,u,v.current):R=PC(m,M,u),v.current=u,R&&me.Children.map(u.children,E=>E&&me.cloneElement(E,{source:M}))||null}function IC(u,m,v,S){if(By(v.id===S.id,"layer id changed"),By(v.type===S.type,"layer type changed"),v.type==="custom"||S.type==="custom")return;const{layout:M={},paint:R={},filter:E,minzoom:l,maxzoom:O,beforeId:Y}=v;if(Y!==S.beforeId&&u.moveLayer(m,Y),M!==S.layout){const ie=S.layout||{};for(const ne in M)oo(M[ne],ie[ne])||u.setLayoutProperty(m,ne,M[ne]);for(const ne in ie)M.hasOwnProperty(ne)||u.setLayoutProperty(m,ne,void 0)}if(R!==S.paint){const ie=S.paint||{};for(const ne in R)oo(R[ne],ie[ne])||u.setPaintProperty(m,ne,R[ne]);for(const ne in ie)R.hasOwnProperty(ne)||u.setPaintProperty(m,ne,void 0)}oo(E,S.filter)||u.setFilter(m,E),(l!==S.minzoom||O!==S.maxzoom)&&u.setLayerZoomRange(m,l,O)}function RC(u,m,v){if(u.style&&u.style._loaded&&(!("source"in v)||u.getSource(v.source))){const S={...v,id:m};delete S.beforeId,u.addLayer(S,v.beforeId)}}let LC=0;function Jx(u){const m=me.useContext(tm).map.getMap(),v=me.useRef(u),[,S]=me.useState(0),M=me.useMemo(()=>u.id||`jsx-layer-${LC++}`,[]);if(me.useEffect(()=>{if(m){const E=()=>S(l=>l+1);return m.on("styledata",E),E(),()=>{m.off("styledata",E),m.style&&m.style._loaded&&m.getLayer(M)&&m.removeLayer(M)}}},[m]),m&&m.style&&m.getLayer(M))try{IC(m,M,u,v.current)}catch(E){console.warn(E)}else RC(m,M,u);return v.current=u,null}var ky={exports:{}};var NC=ky.exports,ev;function jC(){return ev||(ev=1,(function(u,m){(function(v,S){u.exports=S()})(NC,(function(){var v={},S={};function M(E,l,O){if(S[E]=O,E==="index"){var Y="var sharedModule = {}; ("+S.shared+")(sharedModule); ("+S.worker+")(sharedModule);",ie={};return S.shared(ie),S.index(v,ie),typeof window<"u"&&v.setWorkerUrl(window.URL.createObjectURL(new Blob([Y],{type:"text/javascript"}))),v}}M("shared",["exports"],(function(E){function l(i,e,n,o){return new(n||(n=Promise))((function(h,p){function g(z){try{T(o.next(z))}catch(I){p(I)}}function b(z){try{T(o.throw(z))}catch(I){p(I)}}function T(z){var I;z.done?h(z.value):(I=z.value,I instanceof n?I:new n((function(N){N(I)}))).then(g,b)}T((o=o.apply(i,e||[])).next())}))}function O(i,e){this.x=i,this.y=e}function Y(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ie,ne;typeof SuppressedError=="function"&&SuppressedError,O.prototype={clone(){return new O(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround(i,e){const n=Math.cos(i),o=Math.sin(i),h=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:O},O.convert=function(i){if(i instanceof O)return i;if(Array.isArray(i))return new O(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new O(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var ze=(function(){if(ne)return ie;function i(e,n,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=h}return ne=1,ie=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var b=0,T=1;for(o=e,h=0;h<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));h++)e>p?b=o:T=o,o=.5*(T-b)+b;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},ie})(),Ce=Y(ze);let be,he;function te(){return be==null&&(be=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),be}function ve(){if(he==null&&(he=!1,te())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const h=4*o;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){he=!0;break}}}return he||!1}var qe=1e-6,lt=typeof Float32Array<"u"?Float32Array:Array;function Pt(){var i=new lt(9);return lt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Et(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function St(){var i=new lt(3);return lt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function nt(i){var e=i[0],n=i[1],o=i[2];return Math.sqrt(e*e+n*n+o*o)}function Be(i,e,n){var o=new lt(3);return o[0]=i,o[1]=e,o[2]=n,o}function it(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function $e(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function we(i,e,n){var o=e[0],h=e[1],p=e[2],g=n[0],b=n[1],T=n[2];return i[0]=h*T-p*b,i[1]=p*g-o*T,i[2]=o*b-h*g,i}var Qe,ut=nt;function Ye(i,e,n){var o=e[0],h=e[1],p=e[2],g=e[3];return i[0]=n[0]*o+n[4]*h+n[8]*p+n[12]*g,i[1]=n[1]*o+n[5]*h+n[9]*p+n[13]*g,i[2]=n[2]*o+n[6]*h+n[10]*p+n[14]*g,i[3]=n[3]*o+n[7]*h+n[11]*p+n[15]*g,i}function Ie(){var i=new lt(4);return lt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function le(i,e,n,o){var h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;e*=p,o*=p,n*=p;var g=Math.sin(e),b=Math.cos(e),T=Math.sin(n),z=Math.cos(n),I=Math.sin(o),N=Math.cos(o);switch(h){case"xyz":i[0]=g*z*N+b*T*I,i[1]=b*T*N-g*z*I,i[2]=b*z*I+g*T*N,i[3]=b*z*N-g*T*I;break;case"xzy":i[0]=g*z*N-b*T*I,i[1]=b*T*N-g*z*I,i[2]=b*z*I+g*T*N,i[3]=b*z*N+g*T*I;break;case"yxz":i[0]=g*z*N+b*T*I,i[1]=b*T*N-g*z*I,i[2]=b*z*I-g*T*N,i[3]=b*z*N+g*T*I;break;case"yzx":i[0]=g*z*N+b*T*I,i[1]=b*T*N+g*z*I,i[2]=b*z*I-g*T*N,i[3]=b*z*N-g*T*I;break;case"zxy":i[0]=g*z*N-b*T*I,i[1]=b*T*N+g*z*I,i[2]=b*z*I+g*T*N,i[3]=b*z*N-g*T*I;break;case"zyx":i[0]=g*z*N-b*T*I,i[1]=b*T*N+g*z*I,i[2]=b*z*I-g*T*N,i[3]=b*z*N+g*T*I;break;default:throw new Error("Unknown angle order "+h)}return i}function ke(){var i=new lt(2);return lt!=Float32Array&&(i[0]=0,i[1]=0),i}function De(i,e){var n=new lt(2);return n[0]=i,n[1]=e,n}St(),Qe=new lt(4),lt!=Float32Array&&(Qe[0]=0,Qe[1]=0,Qe[2]=0,Qe[3]=0),St(),Be(1,0,0),Be(0,1,0),Ie(),Ie(),Pt(),ke();const Fe=8192;function bt(i,e,n){return e*(Fe/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function de(i,e){return(i%e+e)%e}function He(i,e,n){return i*(1-n)+e*n}function _t(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function It(i,e,n,o){const h=new Ce(i,e,n,o);return p=>h.solve(p)}const Ze=It(.25,.1,.25,1);function Dt(i,e,n){return Math.min(n,Math.max(e,i))}function jt(i,e,n){const o=n-e,h=((i-e)%o+o)%o+e;return h===e?n:h}function $t(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let Ot=1;function ln(i,e,n){const o={};for(const h in i)o[h]=e.call(this,i[h],h,i);return o}function dn(i,e,n){const o={};for(const h in i)e.call(this,i[h],h,i)&&(o[h]=i[h]);return o}function rn(i){return Array.isArray(i)?i.map(rn):typeof i=="object"&&i?ln(i,rn):i}const gt={};function xt(i){gt[i]||(typeof console<"u"&&console.warn(i),gt[i]=!0)}function zt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function qt(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Gt=null;function gn(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Rn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function bn(i,e,n,o,h){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const g=p?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const b=g.startsWith("BGR"),T=new Uint8ClampedArray(o*h*4);if(yield p.copyTo(T,(function(z,I,N,B,F){const G=4*Math.max(-I,0),H=(Math.max(0,N)-N)*B*4+G,X=4*B,J=Math.max(0,I),ge=Math.max(0,N);return{rect:{x:J,y:ge,width:Math.min(z.width,I+B)-J,height:Math.min(z.height,N+F)-ge},layout:[{offset:H,stride:X}]}})(i,e,n,o,h)),b)for(let z=0;z<T.length;z+=4){const I=T[z];T[z]=T[z+2],T[z+2]=I}return T}finally{p.close()}}))}let Zn,Ln;function Wi(i,e,n,o){return i.addEventListener(e,n,o),{unsubscribe:()=>{i.removeEventListener(e,n,o)}}}function kn(i){return i*Math.PI/180}function Cn(i){return i/Math.PI*180}const Ue={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},W={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},$="AbortError";class K extends Error{constructor(e=$){super(e instanceof Error?e.message:e),this.name=$,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function ue(i){return i.name===$}const ye={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function je(i){return ye.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Le="global-dispatcher";class Me extends Error{constructor(e,n,o,h){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=h}}const Oe=()=>qt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Je=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=je(i.url);if(o)return o(i,e);if(qt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Le},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Oe())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,h){return l(this,void 0,void 0,(function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Oe(),signal:h.signal});let g,b;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{g=yield fetch(p)}catch(z){throw ue(z)?z:new Me(0,z.message,o.url,new Blob)}if(!g.ok){const z=yield g.blob();throw new Me(g.status,g.statusText,o.url,z)}b=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const T=yield b;return h.signal.throwIfAborted(),{data:T,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(i,e);if(qt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Le},e)}var n;return(function(o,h){return new Promise(((p,g)=>{var b;const T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(const z in o.headers)T.setRequestHeader(z,o.headers[z]);o.type==="json"&&(T.responseType="text",!((b=o.headers)===null||b===void 0)&&b.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{g(new Error(T.statusText))},T.onload=()=>{if(!h.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let z=T.response;if(o.type==="json")try{z=JSON.parse(T.response)}catch(I){return void g(I)}p({data:z,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const z=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});g(new Me(T.status,T.statusText,o.url,z))}},h.signal.addEventListener("abort",(()=>{T.abort(),g(new K(h.signal.reason))})),T.send(o.body)}))})(i,e)};function ft(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Bt(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Wt(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class Jt{constructor(e,n={}){$t(this,n),this.type=e}}class pn extends Jt{constructor(e,n={}){super("error",$t({error:e},n))}}class Mn{on(e,n){return this._listeners=this._listeners||{},Bt(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return Wt(e,n,this._listeners),Wt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Bt(e,n,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,n){typeof e=="string"&&(e=new Jt(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const b of h)b.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const b of p)Wt(o,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&($t(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof pn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Pn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Fi(i,e){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return Pn.forEach((o=>{o in e&&(n[o]=e[o])})),n}function yn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!yn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!yn(i[n],e[n]))return!1;return!0}return i===e}function qn(i,e){i.push(e)}function ir(i,e,n){qn(n,{command:"addSource",args:[i,e[i]]})}function ei(i,e,n){qn(e,{command:"removeSource",args:[i]}),n[i]=!0}function Ti(i,e,n,o){ei(i,n,o),ir(i,e,n)}function ii(i,e,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!yn(i[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!yn(i[n][o],e[n][o]))return!1;return!0}function Ui(i,e,n,o,h,p){i=i||{},e=e||{};for(const g in i)Object.prototype.hasOwnProperty.call(i,g)&&(yn(i[g],e[g])||n.push({command:p,args:[o,g,e[g],h]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(yn(i[g],e[g])||n.push({command:p,args:[o,g,e[g],h]}))}function Is(i){return i.id}function ds(i,e){return i[e.id]=e,i}class kt{constructor(e,n,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function br(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class hr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class _a{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,h]of n)this.bindings[o]=h}concat(e){return new _a(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Jn={kind:"null"},Rt={kind:"number"},xn={kind:"string"},En={kind:"boolean"},Zr={kind:"color"},hl={kind:"projectionDefinition"},xa={kind:"object"},_n={kind:"value"},Rs={kind:"collator"},Fa={kind:"formatted"},fs={kind:"padding"},ia={kind:"colorArray"},Xr={kind:"numberArray"},Ai={kind:"resolvedImage"},Ro={kind:"variableAnchorOffsetCollection"};function wr(i,e){return{kind:"array",itemType:i,N:e}}function On(i){if(i.kind==="array"){const e=On(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Ua=[Jn,Rt,xn,En,Zr,hl,Fa,xa,wr(_n),fs,Xr,ia,Ai,Ro];function Lo(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Lo(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Ua)if(!Lo(n,e))return null}}return`Expected ${On(i)} but found ${On(e)} instead.`}function co(i,e){return e.some((n=>n.kind===i.kind))}function Ls(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function va(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const dl=.96422,Va=.82521,Xe=4/29,dt=6/29,Vt=3*dt*dt,en=dt*dt*dt,tn=Math.PI/180,Xn=180/Math.PI;function Yn(i){return(i%=360)<0&&(i+=360),i}function ps([i,e,n,o]){let h,p;const g=qa((.2225045*(i=xi(i))+.7168786*(e=xi(e))+.0606169*(n=xi(n)))/1);i===e&&e===n?h=p=g:(h=qa((.4360747*i+.3850649*e+.1430804*n)/dl),p=qa((.0139322*i+.0971045*e+.7141733*n)/Va));const b=116*g-16;return[b<0?0:b,500*(h-g),200*(g-p),o]}function xi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function qa(i){return i>en?Math.pow(i,1/3):i/Vt+Xe}function fl([i,e,n,o]){let h=(i+16)/116,p=isNaN(e)?h:h+e/500,g=isNaN(n)?h:h-n/200;return h=1*Sr(h),p=dl*Sr(p),g=Va*Sr(g),[ms(3.1338561*p-1.6168667*h-.4906146*g),ms(-.9787684*p+1.9161415*h+.033454*g),ms(.0719453*p-.2289914*h+1.4052427*g),o]}function ms(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Sr(i){return i>dt?i*i*i:Vt*(i-Xe)}const Ju=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Ns(i,e){return Ju(i,e)?i[e]:void 0}function Ga(i){return parseInt(i.padEnd(2,i),16)/255}function Xc(i,e){return uo(e?i/100:i,0,1)}function uo(i,e,n){return Math.min(Math.max(e,i),n)}function tc(i){return!i.some(Number.isNaN)}const js={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function gs(i,e,n){return i+n*(e-i)}function ba(i,e,n){return i.map(((o,h)=>gs(o,e[h],n)))}class wn{constructor(e,n,o,h=1,p=!0){this.r=e,this.g=n,this.b=o,this.a=h,p||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,n,o,h]))}static parse(e){if(e instanceof wn)return e;if(typeof e!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Ns(js,o);if(h){const[g,b,T]=h;return[g/255,b/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let b=1;return[Ga(o.slice(b,b+=g)),Ga(o.slice(b,b+=g)),Ga(o.slice(b,b+=g)),Ga(o.slice(b,b+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[b,T,z,I,N,B,F,G,H,X,J,ge]=g,ee=[I||" ",F||" ",X].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ae=[z,B,H].join(""),xe=ae==="%%%"?100:ae===""?255:0;if(xe){const Ee=[uo(+T/xe,0,1),uo(+N/xe,0,1),uo(+G/xe,0,1),J?Xc(+J,ge):1];if(tc(Ee))return Ee}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[g,b,T,z,I,N,B,F,G]=p,H=[T||" ",I||" ",B].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const X=[+b,uo(+z,0,100),uo(+N,0,100),F?Xc(+F,G):1];if(tc(X))return(function([J,ge,ee,ae]){function xe(Ee){const We=(Ee+J/30)%12,yt=ge*Math.min(ee,1-ee);return ee-yt*Math.max(-1,Math.min(We-3,9-We,1))}return J=Yn(J),ge/=100,ee/=100,[xe(0),xe(8),xe(4),ae]})(X)}}})(e);return n?new wn(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:h}=this,p=h||1/0;return this.overwriteGetter("rgb",[e/p,n/p,o/p,h])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,o,h,p]=ps(e),g=Math.sqrt(o*o+h*h);return[Math.round(1e4*g)?Yn(Math.atan2(h,o)*Xn):NaN,g,n,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ps(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,h]=this.rgb;return`rgba(${[e,n,o].map((p=>Math.round(255*p))).join(",")},${h})`}static interpolate(e,n,o,h="rgb"){switch(h){case"rgb":{const[p,g,b,T]=ba(e.rgb,n.rgb,o);return new wn(p,g,b,T,!1)}case"hcl":{const[p,g,b,T]=e.hcl,[z,I,N,B]=n.hcl;let F,G;if(isNaN(p)||isNaN(z))isNaN(p)?isNaN(z)?F=NaN:(F=z,b!==1&&b!==0||(G=I)):(F=p,N!==1&&N!==0||(G=g));else{let ee=z-p;z>p&&ee>180?ee-=360:z<p&&p-z>180&&(ee+=360),F=p+o*ee}const[H,X,J,ge]=(function([ee,ae,xe,Ee]){return ee=isNaN(ee)?0:ee*tn,fl([xe,Math.cos(ee)*ae,Math.sin(ee)*ae,Ee])})([F,G??gs(g,I,o),gs(b,N,o),gs(T,B,o)]);return new wn(H,X,J,ge,!1)}case"lab":{const[p,g,b,T]=fl(ba(e.lab,n.lab,o));return new wn(p,g,b,T,!1)}}}}wn.black=new wn(0,0,0,1),wn.white=new wn(1,1,1,1),wn.transparent=new wn(0,0,0,0),wn.red=new wn(1,0,0,1);class wa{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const od=["bottom","center","top"];class Yc{constructor(e,n,o,h,p,g){this.text=e,this.image=n,this.scale=o,this.fontStack=h,this.textColor=p,this.verticalAlign=g}}class gr{constructor(e){this.sections=e}static fromString(e){return new gr([new Yc(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof gr?e:gr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class rr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rr)return e;if(typeof e=="number")return new rr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new rr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new rr(ba(e.values,n.values,o))}}class zi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof zi)return e;if(typeof e=="number")return new zi([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new zi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new zi(ba(e.values,n.values,o))}}class un{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof un)return e;if(typeof e=="string"){const o=wn.parse(e);return o?new un([o]):void 0}if(!Array.isArray(e))return;const n=[];for(const o of e){if(typeof o!="string")return;const h=wn.parse(o);if(!h)return;n.push(h)}return new un(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o,h="rgb"){const p=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)p.push(wn.interpolate(e.values[g],n.values[g],o,h));return new un(p)}}class fi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const $a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Vi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],h=e[n+1];if(typeof o!="string"||!$a.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Vi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){const h=e.values,p=n.values;if(h.length!==p.length)throw new fi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const g=[];for(let b=0;b<h.length;b+=2){if(h[b]!==p[b])throw new fi(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${h[b]}, to[${b}]: ${p[b]}`);g.push(h[b]);const[T,z]=h[b+1],[I,N]=p[b+1];g.push([gs(T,I,o),gs(z,N,o)])}return new Vi(g)}}class Yr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Yr({name:e,available:!1}):null}}class yr{constructor(e,n,o){this.from=e,this.to=n,this.transition=o}static interpolate(e,n,o){return new yr(e,n,o)}static parse(e){return e instanceof yr?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new yr(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new yr(e.from,e.to,e.transition):typeof e=="string"?new yr(e,e,1):void 0}}function Sa(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Os(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof yr||i instanceof wn||i instanceof wa||i instanceof gr||i instanceof rr||i instanceof zi||i instanceof un||i instanceof Vi||i instanceof Yr)return!0;if(Array.isArray(i)){for(const e of i)if(!Os(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Os(i[e]))return!1;return!0}return!1}function ki(i){if(i===null)return Jn;if(typeof i=="string")return xn;if(typeof i=="boolean")return En;if(typeof i=="number")return Rt;if(i instanceof wn)return Zr;if(i instanceof yr)return hl;if(i instanceof wa)return Rs;if(i instanceof gr)return Fa;if(i instanceof rr)return fs;if(i instanceof zi)return Xr;if(i instanceof un)return ia;if(i instanceof Vi)return Ro;if(i instanceof Yr)return Ai;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const h=ki(o);if(n){if(n===h)continue;n=_n;break}n=h}return wr(n||_n,e)}return xa}function No(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof wn||i instanceof yr||i instanceof gr||i instanceof rr||i instanceof zi||i instanceof un||i instanceof Vi||i instanceof Yr?i.toString():JSON.stringify(i)}class Ta{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Os(e[1]))return n.error("invalid value");const o=e[1];let h=ki(o);const p=n.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Ta(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const pl={string:xn,number:Rt,boolean:En,object:xa};class Kr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,h=1;const p=e[0];if(p==="array"){let b,T;if(e.length>2){const z=e[1];if(typeof z!="string"||!(z in pl)||z==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=pl[z],h++}else b=_n;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}o=wr(b,T)}else{if(!pl[p])throw new Error(`Types doesn't contain name = ${p}`);o=pl[p]}const g=[];for(;h<e.length;h++){const b=n.parse(e[h],h,_n);if(!b)return null;g.push(b)}return new Kr(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!Lo(this.type,ki(o)))return o;if(n===this.args.length-1)throw new fi(`Expected value to be of type ${On(this.type)}, but found ${On(ki(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const dr={"to-boolean":En,"to-color":Zr,"to-number":Rt,"to-string":xn};class Wr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!dr[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const h=dr[o],p=[];for(let g=1;g<e.length;g++){const b=n.parse(e[g],g,_n);if(!b)return null;p.push(b)}return new Wr(h,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const h of this.args){if(n=h.evaluate(e),o=null,n instanceof wn)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Sa(n[0],n[1],n[2],n[3]),!o))return new wn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new fi(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const h=rr.parse(n);if(h)return h}throw new fi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(e);const h=zi.parse(n);if(h)return h}throw new fi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(e);const h=un.parse(n);if(h)return h}throw new fi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const h=Vi.parse(n);if(h)return h}throw new fi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new fi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return gr.fromString(No(this.args[0].evaluate(e)));case"resolvedImage":return Yr.fromString(No(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return No(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Kc=["Unknown","Point","LineString","Polygon"];class ml{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Kc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=wn.parse(e),this._parseColorCache.set(e,n)),n}}class gl{constructor(e,n,o=[],h,p=new _a,g=[]){this.registry=e,this.path=o,this.key=o.map((b=>`[${b}]`)).join(""),this.scope=p,this.errors=g,this.expectedType=h,this._isConstant=n}parse(e,n,o,h,p={}){return n?this.concat(n,o,h)._parse(e,p):this._parse(e,p)}_parse(e,n){function o(h,p,g){return g==="assert"?new Kr(p,[h]):g==="coerce"?new Wr(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,T=g.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value"){if(b.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(b.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(b.kind)&&["value","number","array"].includes(T.kind)||b.kind==="colorArray"&&["value","string","array"].includes(T.kind)||b.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))g=o(g,b,n.typeAnnotation||"coerce");else if(this.checkSubtype(b,T))return null}else g=o(g,b,n.typeAnnotation||"assert")}if(!(g instanceof Ta)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const b=new ml;try{g=new Ta(g.type,g.evaluate(b))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const h=typeof e=="number"?this.path.concat(e):this.path,p=o?this.scope.concat(o):this.scope;return new gl(this.registry,this._isConstant,h,n||null,p,this.errors)}error(e,...n){const o=`${this.key}${n.map((h=>`[${h}]`)).join("")}`;this.errors.push(new hr(o,e))}checkSubtype(e,n){const o=Lo(e,n);return o&&this.error(o),o}}class li{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const b=n.parse(e[p+1],p+1);if(!b)return null;o.push([g,b])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return h?new li(o,h):null}outputDefined(){return this.result.outputDefined()}}class jo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new jo(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Dn{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Rt),h=n.parse(e[2],2,wr(n.expectedType||_n));return o&&h?new Dn(h.type.itemType,o,h):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new fi(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new fi(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new fi(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Sn{constructor(e,n){this.type=En,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,_n),h=n.parse(e[2],2,_n);return o&&h?co(o.type,[En,xn,Rt,Jn,_n])?new Sn(o,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${On(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Ls(n,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${On(ki(n))} instead.`);if(!Ls(o,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${On(ki(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class yl{constructor(e,n,o){this.type=Rt,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,_n),h=n.parse(e[2],2,_n);if(!o||!h)return null;if(!co(o.type,[En,xn,Rt,Jn,_n]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${On(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Rt);return p?new yl(o,h,p):null}return new yl(o,h)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ls(n,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${On(ki(n))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),Ls(o,["string"])){const p=o.indexOf(n,h);return p===-1?-1:[...o.slice(0,p)].length}if(Ls(o,["array"]))return o.indexOf(n,h);throw new fi(`Expected second argument to be of type array or string, but found ${On(ki(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Un{constructor(e,n,o,h,p,g){this.inputType=e,this.type=n,this.input=o,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const p={},g=[];for(let z=2;z<e.length-1;z+=2){let I=e[z];const N=e[z+1];Array.isArray(I)||(I=[I]);const B=n.concat(z);if(I.length===0)return B.error("Expected at least one branch label.");for(const G of I){if(typeof G!="number"&&typeof G!="string")return B.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,ki(G)))return null}else o=ki(G);if(p[String(G)]!==void 0)return B.error("Branch labels must be unique.");p[String(G)]=g.length}const F=n.parse(N,z,h);if(!F)return null;h=h||F.type,g.push(F)}const b=n.parse(e[1],1,_n);if(!b)return null;const T=n.parse(e[e.length-1],e.length-1,h);return T?b.type.kind!=="value"&&n.concat(1).checkSubtype(o,b.type)?null:new Un(o,h,b,p,g,T):null}evaluate(e){const n=this.input.evaluate(e);return(ki(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Wc{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const b=n.parse(e[g],g,En);if(!b)return null;const T=n.parse(e[g+1],g+1,o);if(!T)return null;h.push([b,T]),o=o||T.type}const p=n.parse(e[e.length-1],e.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new Wc(o,h,p)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Ha{constructor(e,n,o,h){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,_n),h=n.parse(e[2],2,Rt);if(!o||!h)return null;if(!co(o.type,[wr(_n),xn,_n]))return n.error(`Expected first argument to be of type array or string, but found ${On(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Rt);return p?new Ha(o.type,o,h,p):null}return new Ha(o.type,o,h)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),Ls(n,["string"]))return[...n].slice(o,h).join("");if(Ls(n,["array"]))return n.slice(o,h);throw new fi(`Expected first argument to be of type array or string, but found ${On(ki(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Oo(i,e){const n=i.length-1;let o,h,p=0,g=n,b=0;for(;p<=g;)if(b=Math.floor((p+g)/2),o=i[b],h=i[b+1],o<=e){if(b===n||e<h)return b;p=b+1}else{if(!(o>e))throw new fi("Input is not a number.");g=b-1}return 0}class Bo{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,p]of o)this.labels.push(h),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Rt);if(!o)return null;const h=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let g=1;g<e.length;g+=2){const b=g===1?-1/0:e[g],T=e[g+1],z=g,I=g+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(h.length&&h[h.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const N=n.parse(T,I,p);if(!N)return null;p=p||N.type,h.push([b,N])}return new Bo(p,o,h)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return o[0].evaluate(e);const p=n.length;return h>=n[p-1]?o[p-1].evaluate(e):o[Oo(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Af(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Qc,ld,nm=(function(){if(ld)return Qc;function i(e,n,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=h}return ld=1,Qc=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var b=0,T=1;for(o=e,h=0;h<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));h++)e>p?b=o:T=o,o=.5*(T-b)+b;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Qc})(),cd=Af(nm);class Qr{constructor(e,n,o,h,p){this.type=e,this.operator=n,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[g,b]of p)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,n,o,h){let p=0;if(e.name==="exponential")p=Bs(n,e.base,o,h);else if(e.name==="linear")p=Bs(n,1,o,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new cd(g[0],g[1],g[2],g[3]).solve(Bs(n,1,o,h))}return p}static parse(e,n){let[o,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const z=h[1];if(typeof z!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:z}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const z=h.slice(1);if(z.length!==4||z.some((I=>typeof I!="number"||I<0||I>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:z}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Rt),!p)return null;const b=[];let T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==ia?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=Zr;for(let z=0;z<g.length;z+=2){const I=g[z],N=g[z+1],B=z+3,F=z+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(b.length&&b[b.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const G=n.parse(N,F,T);if(!G)return null;T=T||G.type,b.push([I,G])}return va(T,Rt)||va(T,hl)||va(T,Zr)||va(T,fs)||va(T,Xr)||va(T,ia)||va(T,Ro)||va(T,wr(Rt))?new Qr(T,o,h,p,b):n.error(`Type ${On(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return o[0].evaluate(e);const p=n.length;if(h>=n[p-1])return o[p-1].evaluate(e);const g=Oo(n,h),b=Qr.interpolationFactor(this.interpolation,h,n[g],n[g+1]),T=o[g].evaluate(e),z=o[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return gs(T,z,b);case"color":return wn.interpolate(T,z,b);case"padding":return rr.interpolate(T,z,b);case"colorArray":return un.interpolate(T,z,b);case"numberArray":return zi.interpolate(T,z,b);case"variableAnchorOffsetCollection":return Vi.interpolate(T,z,b);case"array":return ba(T,z,b);case"projectionDefinition":return yr.interpolate(T,z,b)}case"interpolate-hcl":switch(this.type.kind){case"color":return wn.interpolate(T,z,b,"hcl");case"colorArray":return un.interpolate(T,z,b,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return wn.interpolate(T,z,b,"lab");case"colorArray":return un.interpolate(T,z,b,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Bs(i,e,n,o){const h=o-n,p=i-n;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}const Pi={color:wn.interpolate,number:gs,padding:rr.interpolate,numberArray:zi.interpolate,colorArray:un.interpolate,variableAnchorOffsetCollection:Vi.interpolate,array:ba};class _l{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=null;const h=n.expectedType;h&&h.kind!=="value"&&(o=h);const p=[];for(const b of e.slice(1)){const T=n.parse(b,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,p.push(T)}if(!o)throw new Error("No output type");const g=h&&p.some((b=>Lo(h,b.type)));return new _l(g?_n:o,p)}evaluate(e){let n,o=null,h=0;for(const p of this.args)if(h++,o=p.evaluate(e),o&&o instanceof Yr&&!o.available&&(n||(n=o.name),o=null,h===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Jc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function eu(i,e,n,o){return o.compare(e,n)===0}function qi(i,e,n){const o=i!=="=="&&i!=="!=";return class p1{constructor(p,g,b){this.type=En,this.lhs=p,this.rhs=g,this.collator=b,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const b=p[0];let T=g.parse(p[1],1,_n);if(!T)return null;if(!Jc(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${On(T.type)}'.`);let z=g.parse(p[2],2,_n);if(!z)return null;if(!Jc(b,z.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${On(z.type)}'.`);if(T.type.kind!==z.type.kind&&T.type.kind!=="value"&&z.type.kind!=="value")return g.error(`Cannot compare types '${On(T.type)}' and '${On(z.type)}'.`);o&&(T.type.kind==="value"&&z.type.kind!=="value"?T=new Kr(z.type,[T]):T.type.kind!=="value"&&z.type.kind==="value"&&(z=new Kr(T.type,[z])));let I=null;if(p.length===4){if(T.type.kind!=="string"&&z.type.kind!=="string"&&T.type.kind!=="value"&&z.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(p[3],3,Rs),!I)return null}return new p1(T,z,I)}evaluate(p){const g=this.lhs.evaluate(p),b=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const T=ki(g),z=ki(b);if(T.kind!==z.kind||T.kind!=="string"&&T.kind!=="number")throw new fi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${z.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=ki(g),z=ki(b);if(T.kind!=="string"||z.kind!=="string")return e(p,g,b)}return this.collator?n(p,g,b,this.collator.evaluate(p)):e(p,g,b)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const zf=qi("==",(function(i,e,n){return e===n}),eu),eh=qi("!=",(function(i,e,n){return e!==n}),(function(i,e,n,o){return!eu(0,e,n,o)})),kf=qi("<",(function(i,e,n){return e<n}),(function(i,e,n,o){return o.compare(e,n)<0})),im=qi(">",(function(i,e,n){return e>n}),(function(i,e,n,o){return o.compare(e,n)>0})),nc=qi("<=",(function(i,e,n){return e<=n}),(function(i,e,n,o){return o.compare(e,n)<=0})),th=qi(">=",(function(i,e,n){return e>=n}),(function(i,e,n,o){return o.compare(e,n)>=0}));class ic{constructor(e,n,o){this.type=Rs,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const h=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,En);if(!h)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,En);if(!p)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,xn),!g)?null:new ic(h,p,g)}evaluate(e){return new wa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class ud{constructor(e,n,o,h,p){this.type=xn,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Rt);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=n.parse(h.locale,1,xn),!p))return null;let g=null;if(h.currency&&(g=n.parse(h.currency,1,xn),!g))return null;let b=null;if(h["min-fraction-digits"]&&(b=n.parse(h["min-fraction-digits"],1,Rt),!b))return null;let T=null;return h["max-fraction-digits"]&&(T=n.parse(h["max-fraction-digits"],1,Rt),!T)?null:new ud(o,p,g,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class tu{constructor(e){this.type=Fa,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(p&&typeof b=="object"&&!Array.isArray(b)){p=!1;let T=null;if(b["font-scale"]&&(T=n.parse(b["font-scale"],1,Rt),!T))return null;let z=null;if(b["text-font"]&&(z=n.parse(b["text-font"],1,wr(xn)),!z))return null;let I=null;if(b["text-color"]&&(I=n.parse(b["text-color"],1,Zr),!I))return null;let N=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!od.includes(b["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(N=n.parse(b["vertical-align"],1,xn),!N)return null}const B=h[h.length-1];B.scale=T,B.font=z,B.textColor=I,B.verticalAlign=N}else{const T=n.parse(e[g],1,_n);if(!T)return null;const z=T.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new tu(h)}evaluate(e){return new gr(this.sections.map((n=>{const o=n.content.evaluate(e);return ki(o)===Ai?new Yc("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Yc(No(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class rc{constructor(e){this.type=Ai,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,xn);return o?new rc(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Yr.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class ac{constructor(e){this.type=Rt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${On(o.type)} instead.`):new ac(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new fi(`Expected value to be of type string or array, but found ${On(ki(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Qi=8192;function sc(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*Qi),Math.round(o*h*Qi)]}function oc(i,e){const n=Math.pow(2,e.z);return[(h=(i[0]/Qi+e.x)/n,360*h-180),(o=(i[1]/Qi+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function lc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Fo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Pf(i,e,n){const o=i[0]-e[0],h=i[1]-e[1],p=i[0]-n[0],g=i[1]-n[1];return o*g-p*h==0&&o*p<=0&&h*g<=0}function nu(i,e,n,o){return(h=[o[0]-n[0],o[1]-n[1]])[0]*(p=[e[0]-i[0],e[1]-i[1]])[1]-h[1]*p[0]!=0&&!(!ih(i,e,n,o)||!ih(n,o,i,e));var h,p}function Df(i,e,n){for(const o of n)for(let h=0;h<o.length-1;++h)if(nu(i,e,o[h],o[h+1]))return!0;return!1}function ys(i,e,n=!1){let o=!1;for(const b of e)for(let T=0;T<b.length-1;T++){if(Pf(i,b[T],b[T+1]))return n;(p=b[T])[1]>(h=i)[1]!=(g=b[T+1])[1]>h[1]&&h[0]<(g[0]-p[0])*(h[1]-p[1])/(g[1]-p[1])+p[0]&&(o=!o)}var h,p,g;return o}function nh(i,e){for(const n of e)if(ys(i,n))return!0;return!1}function If(i,e){for(const n of i)if(!ys(n,e))return!1;for(let n=0;n<i.length-1;++n)if(Df(i[n],i[n+1],e))return!1;return!0}function Rf(i,e){for(const n of e)if(If(i,n))return!0;return!1}function ih(i,e,n,o){const h=o[0]-n[0],p=o[1]-n[1],g=(i[0]-n[0])*p-h*(i[1]-n[1]),b=(e[0]-n[0])*p-h*(e[1]-n[1]);return g>0&&b<0||g<0&&b>0}function rh(i,e,n){const o=[];for(let h=0;h<i.length;h++){const p=[];for(let g=0;g<i[h].length;g++){const b=sc(i[h][g],n);lc(e,b),p.push(b)}o.push(p)}return o}function xl(i,e,n){const o=[];for(let h=0;h<i.length;h++){const p=rh(i[h],e,n);o.push(p)}return o}function cc(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const h=.5*o;let p=i[0]-n[0]>h?-o:n[0]-i[0]>h?o:0;p===0&&(p=i[0]-n[2]>h?-o:n[2]-i[0]>h?o:0),i[0]+=p}lc(e,i)}function Lf(i,e,n,o){const h=Math.pow(2,o.z)*Qi,p=[o.x*Qi,o.y*Qi],g=[];for(const b of i)for(const T of b){const z=[T.x+p[0],T.y+p[1]];cc(z,e,n,h),g.push(z)}return g}function iu(i,e,n,o){const h=Math.pow(2,o.z)*Qi,p=[o.x*Qi,o.y*Qi],g=[];for(const T of i){const z=[];for(const I of T){const N=[I.x+p[0],I.y+p[1]];lc(e,N),z.push(N)}g.push(z)}if(e[2]-e[0]<=h/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of g)for(const z of T)cc(z,e,n,h)}var b;return g}class Uo{constructor(e,n){this.type=En,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Os(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const h=[];for(const p of o.features){const{type:g,coordinates:b}=p.geometry;g==="Polygon"&&h.push(b),g==="MultiPolygon"&&h.push(...b)}if(h.length)return new Uo(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Uo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Uo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const b=rh(o.coordinates,p,g),T=Lf(n.geometry(),h,p,g);if(!Fo(h,p))return!1;for(const z of T)if(!ys(z,b))return!1}if(o.type==="MultiPolygon"){const b=xl(o.coordinates,p,g),T=Lf(n.geometry(),h,p,g);if(!Fo(h,p))return!1;for(const z of T)if(!nh(z,b))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const b=rh(o.coordinates,p,g),T=iu(n.geometry(),h,p,g);if(!Fo(h,p))return!1;for(const z of T)if(!If(z,b))return!1}if(o.type==="MultiPolygon"){const b=xl(o.coordinates,p,g),T=iu(n.geometry(),h,p,g);if(!Fo(h,p))return!1;for(const z of T)if(!Rf(z,b))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let hd=class{constructor(i=[],e=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,o=e[i];for(;i>0;){const h=i-1>>1,p=e[h];if(n(o,p)>=0)break;e[i]=p,i=h}e[i]=o}_down(i){const{data:e,compare:n}=this,o=this.length>>1,h=e[i];for(;i<o;){let p=1+(i<<1);const g=p+1;if(g<this.length&&n(e[g],e[p])<0&&(p=g),n(e[p],h)>=0)break;e[i]=e[p],i=p}e[i]=h}};function ru(i,e,n=0,o=i.length-1,h=dd){for(;o>n;){if(o-n>600){const T=o-n+1,z=e-n+1,I=Math.log(T),N=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*N*(T-N)/T)*(z-T/2<0?-1:1);ru(i,e,Math.max(n,Math.floor(e-z*N/T+B)),Math.min(o,Math.floor(e+(T-z)*N/T+B)),h)}const p=i[e];let g=n,b=o;for(Vo(i,n,e),h(i[o],p)>0&&Vo(i,n,o);g<b;){for(Vo(i,g,b),g++,b--;h(i[g],p)<0;)g++;for(;h(i[b],p)>0;)b--}h(i[n],p)===0?Vo(i,n,b):(b++,Vo(i,b,o)),b<=e&&(n=b+1),e<=b&&(o=b-1)}}function Vo(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function dd(i,e){return i<e?-1:i>e?1:0}function au(i,e){if(i.length<=1)return[i];const n=[];let o,h;for(const p of i){const g=rm(p);g!==0&&(p.area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(o&&n.push(o),o=[p]):o.push(p))}if(o&&n.push(o),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||(ru(n[p],e,1,n[p].length-1,Nf),n[p]=n[p].slice(0,e));return n}function Nf(i,e){return e.area-i.area}function rm(i){let e=0;for(let n,o,h=0,p=i.length,g=p-1;h<p;g=h++)n=i[h],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}const jf=1/298.257223563,su=jf*(2-jf),Of=Math.PI/180;class fd{constructor(e){const n=6378.137*Of*1e3,o=Math.cos(e*Of),h=1/(1-su*(1-o*o)),p=Math.sqrt(h);this.kx=n*p*o,this.ky=n*p*h*(1-su)}distance(e,n){const o=this.wrap(e[0]-n[0])*this.kx,h=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(e,n){let o,h,p,g,b=1/0;for(let T=0;T<e.length-1;T++){let z=e[T][0],I=e[T][1],N=this.wrap(e[T+1][0]-z)*this.kx,B=(e[T+1][1]-I)*this.ky,F=0;N===0&&B===0||(F=(this.wrap(n[0]-z)*this.kx*N+(n[1]-I)*this.ky*B)/(N*N+B*B),F>1?(z=e[T+1][0],I=e[T+1][1]):F>0&&(z+=N/this.kx*F,I+=B/this.ky*F)),N=this.wrap(n[0]-z)*this.kx,B=(n[1]-I)*this.ky;const G=N*N+B*B;G<b&&(b=G,o=z,h=I,p=T,g=F)}return{point:[o,h],index:p,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function ra(i,e){return e[0]-i[0]}function qo(i){return i[1]-i[0]+1}function Za(i,e){return i[1]>=i[0]&&i[1]<e}function ou(i,e){if(i[0]>i[1])return[null,null];const n=qo(i);if(e){if(n===2)return[i,null];const h=Math.floor(n/2);return[[i[0],i[0]+h],[i[0]+h,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function ah(i,e){if(!Za(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)lc(n,i[o]);return n}function sh(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)lc(e,o);return e}function lu(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function oh(i,e,n){if(!lu(i)||!lu(e))return NaN;let o=0,h=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(h=i[1]-e[3]),i[3]<e[1]&&(h=e[1]-i[3]),n.distance([0,0],[o,h])}function Xa(i,e,n){const o=n.pointOnLine(e,i);return n.distance(i,o.point)}function cu(i,e,n,o,h){const p=Math.min(Xa(i,[n,o],h),Xa(e,[n,o],h)),g=Math.min(Xa(n,[i,e],h),Xa(o,[i,e],h));return Math.min(p,g)}function uu(i,e,n,o,h){if(!Za(e,i.length)||!Za(o,n.length))return 1/0;let p=1/0;for(let g=e[0];g<e[1];++g){const b=i[g],T=i[g+1];for(let z=o[0];z<o[1];++z){const I=n[z],N=n[z+1];if(nu(b,T,I,N))return 0;p=Math.min(p,cu(b,T,I,N,h))}}return p}function lh(i,e,n,o,h){if(!Za(e,i.length)||!Za(o,n.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let b=o[0];b<=o[1];++b)if(p=Math.min(p,h.distance(i[g],n[b])),p===0)return p;return p}function Bf(i,e,n){if(ys(i,e,!0))return 0;let o=1/0;for(const h of e){const p=h[0],g=h[h.length-1];if(p!==g&&(o=Math.min(o,Xa(i,[g,p],n)),o===0))return o;const b=n.pointOnLine(h,i);if(o=Math.min(o,n.distance(i,b.point)),o===0)return o}return o}function vl(i,e,n,o){if(!Za(e,i.length))return NaN;for(let p=e[0];p<=e[1];++p)if(ys(i[p],n,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p){const g=i[p],b=i[p+1];for(const T of n)for(let z=0,I=T.length,N=I-1;z<I;N=z++){const B=T[N],F=T[z];if(nu(g,b,B,F))return 0;h=Math.min(h,cu(g,b,B,F,o))}}return h}function bl(i,e){for(const n of i)for(const o of n)if(ys(o,e,!0))return!0;return!1}function pd(i,e,n,o=1/0){const h=sh(i),p=sh(e);if(o!==1/0&&oh(h,p,n)>=o)return o;if(Fo(h,p)){if(bl(i,e))return 0}else if(bl(e,i))return 0;let g=1/0;for(const b of i)for(let T=0,z=b.length,I=z-1;T<z;I=T++){const N=b[I],B=b[T];for(const F of e)for(let G=0,H=F.length,X=H-1;G<H;X=G++){const J=F[X],ge=F[G];if(nu(N,B,J,ge))return 0;g=Math.min(g,cu(N,B,J,ge,n))}}return g}function Kn(i,e,n,o,h,p){if(!p)return;const g=oh(ah(o,p),h,n);g<e&&i.push([g,p,[0,0]])}function Fs(i,e,n,o,h,p,g){if(!p||!g)return;const b=oh(ah(o,p),ah(h,g),n);b<e&&i.push([b,p,g])}function hu(i,e,n,o,h=1/0){let p=Math.min(o.distance(i[0],n[0][0]),h);if(p===0)return p;const g=new hd([[0,[0,i.length-1],[0,0]]],ra),b=sh(n);for(;g.length>0;){const T=g.pop();if(T[0]>=p)continue;const z=T[1],I=e?50:100;if(qo(z)<=I){if(!Za(z,i.length))return NaN;if(e){const N=vl(i,z,n,o);if(isNaN(N)||N===0)return N;p=Math.min(p,N)}else for(let N=z[0];N<=z[1];++N){const B=Bf(i[N],n,o);if(p=Math.min(p,B),p===0)return 0}}else{const N=ou(z,e);Kn(g,p,o,i,b,N[0]),Kn(g,p,o,i,b,N[1])}}return p}function du(i,e,n,o,h,p=1/0){let g=Math.min(p,h.distance(i[0],n[0]));if(g===0)return g;const b=new hd([[0,[0,i.length-1],[0,n.length-1]]],ra);for(;b.length>0;){const T=b.pop();if(T[0]>=g)continue;const z=T[1],I=T[2],N=e?50:100,B=o?50:100;if(qo(z)<=N&&qo(I)<=B){if(!Za(z,i.length)&&Za(I,n.length))return NaN;let F;if(e&&o)F=uu(i,z,n,I,h),g=Math.min(g,F);else if(e&&!o){const G=i.slice(z[0],z[1]+1);for(let H=I[0];H<=I[1];++H)if(F=Xa(n[H],G,h),g=Math.min(g,F),g===0)return g}else if(!e&&o){const G=n.slice(I[0],I[1]+1);for(let H=z[0];H<=z[1];++H)if(F=Xa(i[H],G,h),g=Math.min(g,F),g===0)return g}else F=lh(i,z,n,I,h),g=Math.min(g,F)}else{const F=ou(z,e),G=ou(I,o);Fs(b,g,h,i,n,F[0],G[0]),Fs(b,g,h,i,n,F[0],G[1]),Fs(b,g,h,i,n,F[1],G[0]),Fs(b,g,h,i,n,F[1],G[1])}}return g}function ch(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class wl{constructor(e,n){this.type=Rt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Os(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new wl(o,o.features.map((h=>ch(h.geometry))).flat());if(o.type==="Feature")return new wl(o,ch(o.geometry));if("type"in o&&"coordinates"in o)return new wl(o,ch(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const h=n.geometry(),p=h.flat().map((T=>oc([T.x,T.y],n.canonical)));if(h.length===0)return NaN;const g=new fd(p[0][1]);let b=1/0;for(const T of o){switch(T.type){case"Point":b=Math.min(b,du(p,!1,[T.coordinates],!1,g,b));break;case"LineString":b=Math.min(b,du(p,!1,T.coordinates,!0,g,b));break;case"Polygon":b=Math.min(b,hu(p,!1,T.coordinates,g,b))}if(b===0)return b}return b})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const h=n.geometry(),p=h.flat().map((T=>oc([T.x,T.y],n.canonical)));if(h.length===0)return NaN;const g=new fd(p[0][1]);let b=1/0;for(const T of o){switch(T.type){case"Point":b=Math.min(b,du(p,!0,[T.coordinates],!1,g,b));break;case"LineString":b=Math.min(b,du(p,!0,T.coordinates,!0,g,b));break;case"Polygon":b=Math.min(b,hu(p,!0,T.coordinates,g,b))}if(b===0)return b}return b})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,o){const h=n.geometry();if(h.length===0||h[0].length===0)return NaN;const p=au(h,0).map((T=>T.map((z=>z.map((I=>oc([I.x,I.y],n.canonical))))))),g=new fd(p[0][0][0][1]);let b=1/0;for(const T of o)for(const z of p){switch(T.type){case"Point":b=Math.min(b,hu([T.coordinates],!1,z,g,b));break;case"LineString":b=Math.min(b,hu(T.coordinates,!0,z,g,b));break;case"Polygon":b=Math.min(b,pd(z,T.coordinates,g,b))}if(b===0)return b}return b})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class fu{constructor(e){this.type=_n,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new fu(o)}evaluate(e){var n;const o=(n=e.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?Ns(o,this.key):null}eachChild(){}outputDefined(){return!1}}const uc={"==":zf,"!=":eh,">":im,"<":kf,">=":th,"<=":nc,array:Kr,at:Dn,boolean:Kr,case:Wc,coalesce:_l,collator:ic,format:tu,image:rc,in:Sn,"index-of":yl,interpolate:Qr,"interpolate-hcl":Qr,"interpolate-lab":Qr,length:ac,let:li,literal:Ta,match:Un,number:Kr,"number-format":ud,object:Kr,slice:Ha,step:Bo,string:Kr,"to-boolean":Wr,"to-color":Wr,"to-number":Wr,"to-string":Wr,var:jo,within:Uo,distance:wl,"global-state":fu};class Ea{constructor(e,n,o,h){this.name=e,this.type=n,this._evaluate=o,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],h=Ea.definitions[o];if(!h)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=g.filter((([z])=>!Array.isArray(z)||z.length===e.length-1));let T=null;for(const[z,I]of b){T=new gl(n.registry,Jr,n.path,null,n.scope);const N=[];let B=!1;for(let F=1;F<e.length;F++){const G=e[F],H=Array.isArray(z)?z[F-1]:z.type,X=T.parse(G,1+N.length,H);if(!X){B=!0;break}N.push(X)}if(!B)if(Array.isArray(z)&&z.length!==N.length)T.error(`Expected ${z.length} arguments, but found ${N.length} instead.`);else{for(let F=0;F<N.length;F++){const G=Array.isArray(z)?z[F]:z.type,H=N[F];T.concat(F+1).checkSubtype(G,H.type)}if(T.errors.length===0)return new Ea(o,p,I,N)}}if(b.length===1)n.errors.push(...T.errors);else{const z=(b.length?b:g).map((([N])=>{return B=N,Array.isArray(B)?`(${B.map(On).join(", ")})`:`(${On(B.type)}...)`;var B})).join(" | "),I=[];for(let N=1;N<e.length;N++){const B=n.parse(e[N],1+I.length);if(!B)return null;I.push(On(B.type))}n.error(`Expected arguments of type ${z}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Ea.definitions=n;for(const o in n)e[o]=Ea}}function md(i,[e,n,o,h]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const p=h?h.evaluate(i):1,g=Sa(e,n,o,p);if(g)throw new fi(g);return new wn(e/255,n/255,o/255,p,!1)}function uh(i,e){return i in e}function Ma(i,e){const n=e[i];return n===void 0?null:n}function Us(i){return{type:i}}function Jr(i){if(i instanceof jo)return Jr(i.boundExpression);if(i instanceof Ea&&i.name==="error"||i instanceof ic||i instanceof Uo||i instanceof wl||i instanceof fu)return!1;const e=i instanceof Wr||i instanceof Kr;let n=!0;return i.eachChild((o=>{n=e?n&&Jr(o):n&&o instanceof Ta})),!!n&&ho(i)&&Tl(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ho(i){if(i instanceof Ea&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Uo||i instanceof wl)return!1;let e=!0;return i.eachChild((n=>{e&&!ho(n)&&(e=!1)})),e}function Sl(i){if(i instanceof Ea&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!Sl(n)&&(e=!1)})),e}function Tl(i,e){if(i instanceof Ea&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((o=>{n&&!Tl(o,e)&&(n=!1)})),n}function pu(i){return{result:"success",value:i}}function Go(i){return{result:"error",value:i}}function Ya(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function gd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function hc(i){return!!i.expression&&i.expression.interpolated}function Tn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function hh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&ki(i)===xa}function Ca(i){return i}function dh(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",o=n||!(n||i.property!==void 0),h=i.type||(hc(e)?"exponential":"interval"),p=(function(I){switch(I.type){case"color":return wn.parse;case"padding":return rr.parse;case"numberArray":return zi.parse;case"colorArray":return un.parse;default:return null}})(e);if(p&&((i=br({},i)).stops&&(i.stops=i.stops.map((I=>[I[0],p(I[1])]))),i.default=p(i.default?i.default:e.default)),i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;const b=(function(I){switch(I){case"exponential":return $o;case"interval":return fh;case"categorical":return Ff;case"identity":return yd;default:throw new Error(`Unknown function type "${I}"`)}})(h);let T,z;if(h==="categorical"){T=Object.create(null);for(const I of i.stops)T[I[0]]=I[1];z=typeof i.stops[0][0]}if(n){const I={},N=[];for(let G=0;G<i.stops.length;G++){const H=i.stops[G],X=H[0].zoom;I[X]===void 0&&(I[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},N.push(X)),I[X].stops.push([H[0].value,H[1]])}const B=[];for(const G of N)B.push([I[G].zoom,dh(I[G],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Qr.interpolationFactor.bind(void 0,F),zoomStops:B.map((G=>G[0])),evaluate:({zoom:G},H)=>$o({stops:B,base:i.base},e,G).evaluate(G,H)}}if(o){const I=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Qr.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map((N=>N[0])),evaluate:({zoom:N})=>b(i,e,N,T,z)}}return{kind:"source",evaluate(I,N){const B=N&&N.properties?N.properties[i.property]:void 0;return B===void 0?Aa(i.default,e.default):b(i,e,B,T,z)}}}function Aa(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Ff(i,e,n,o,h){return Aa(typeof n===h?o[n]:void 0,i.default,e.default)}function fh(i,e,n){if(Tn(n)!=="number")return Aa(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const h=Oo(i.stops.map((p=>p[0])),n);return i.stops[h][1]}function $o(i,e,n){const o=i.base!==void 0?i.base:1;if(Tn(n)!=="number")return Aa(i.default,e.default);const h=i.stops.length;if(h===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[h-1][0])return i.stops[h-1][1];const p=Oo(i.stops.map((I=>I[0])),n),g=(function(I,N,B,F){const G=F-B,H=I-B;return G===0?0:N===1?H/G:(Math.pow(N,H)-1)/(Math.pow(N,G)-1)})(n,o,i.stops[p][0],i.stops[p+1][0]),b=i.stops[p][1],T=i.stops[p+1][1],z=Pi[e.type]||Ca;return typeof b.evaluate=="function"?{evaluate(...I){const N=b.evaluate.apply(void 0,I),B=T.evaluate.apply(void 0,I);if(N!==void 0&&B!==void 0)return z(N,B,g,i.colorSpace)}}:z(b,T,g,i.colorSpace)}function yd(i,e,n){switch(e.type){case"color":n=wn.parse(n);break;case"formatted":n=gr.fromString(n.toString());break;case"resolvedImage":n=Yr.fromString(n.toString());break;case"padding":n=rr.parse(n);break;case"colorArray":n=un.parse(n);break;case"numberArray":n=zi.parse(n);break;default:Tn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return Aa(n,i.default,e.default)}Ea.register(uc,{error:[{kind:"error"},[xn],(i,[e])=>{throw new fi(e.evaluate(i))}],typeof:[xn,[_n],(i,[e])=>On(ki(e.evaluate(i)))],"to-rgba":[wr(Rt,4),[Zr],(i,[e])=>{const[n,o,h,p]=e.evaluate(i).rgb;return[255*n,255*o,255*h,p]}],rgb:[Zr,[Rt,Rt,Rt],md],rgba:[Zr,[Rt,Rt,Rt,Rt],md],has:{type:En,overloads:[[[xn],(i,[e])=>uh(e.evaluate(i),i.properties())],[[xn,xa],(i,[e,n])=>uh(e.evaluate(i),n.evaluate(i))]]},get:{type:_n,overloads:[[[xn],(i,[e])=>Ma(e.evaluate(i),i.properties())],[[xn,xa],(i,[e,n])=>Ma(e.evaluate(i),n.evaluate(i))]]},"feature-state":[_n,[xn],(i,[e])=>Ma(e.evaluate(i),i.featureState||{})],properties:[xa,[],i=>i.properties()],"geometry-type":[xn,[],i=>i.geometryType()],id:[_n,[],i=>i.id()],zoom:[Rt,[],i=>i.globals.zoom],"heatmap-density":[Rt,[],i=>i.globals.heatmapDensity||0],elevation:[Rt,[],i=>i.globals.elevation||0],"line-progress":[Rt,[],i=>i.globals.lineProgress||0],accumulated:[_n,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Rt,Us(Rt),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[Rt,Us(Rt),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:Rt,overloads:[[[Rt,Rt],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Rt],(i,[e])=>-e.evaluate(i)]]},"/":[Rt,[Rt,Rt],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Rt,[Rt,Rt],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Rt,[Rt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Rt,[Rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Rt,[Rt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Rt,[Rt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Rt,[Rt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Rt,[Rt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Rt,[Rt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Rt,[Rt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Rt,[Rt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Rt,[Rt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Rt,Us(Rt),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[Rt,Us(Rt),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[Rt,[Rt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Rt,[Rt],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Rt,[Rt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Rt,[Rt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[En,[xn,_n],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[En,[_n],(i,[e])=>i.id()===e.value],"filter-type-==":[En,[xn],(i,[e])=>i.geometryType()===e.value],"filter-<":[En,[xn,_n],(i,[e,n])=>{const o=i.properties()[e.value],h=n.value;return typeof o==typeof h&&o<h}],"filter-id-<":[En,[_n],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[En,[xn,_n],(i,[e,n])=>{const o=i.properties()[e.value],h=n.value;return typeof o==typeof h&&o>h}],"filter-id->":[En,[_n],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[En,[xn,_n],(i,[e,n])=>{const o=i.properties()[e.value],h=n.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[En,[_n],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[En,[xn,_n],(i,[e,n])=>{const o=i.properties()[e.value],h=n.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[En,[_n],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[En,[_n],(i,[e])=>e.value in i.properties()],"filter-has-id":[En,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[En,[wr(xn)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[En,[wr(_n)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[En,[xn,wr(_n)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[En,[xn,wr(_n)],(i,[e,n])=>(function(o,h,p,g){for(;p<=g;){const b=p+g>>1;if(h[b]===o)return!0;h[b]>o?g=b-1:p=b+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:En,overloads:[[[En,En],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Us(En),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:En,overloads:[[[En,En],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Us(En),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[En,[En],(i,[e])=>!e.evaluate(i)],"is-supported-script":[En,[xn],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[xn,[xn],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[xn,[xn],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[xn,Us(_n),(i,e)=>e.map((n=>No(n.evaluate(i)))).join("")],"resolved-locale":[xn,[Rs],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ph{constructor(e,n,o){this.expression=e,this._warningHistory={},this._evaluator=new ml,this._defaultValue=n?(function(h){if(h.type==="color"&&hh(h.default))return new wn(0,0,0,0);switch(h.type){case"color":return wn.parse(h.default)||null;case"padding":return rr.parse(h.default)||null;case"numberArray":return zi.parse(h.default)||null;case"colorArray":return un.parse(h.default)||null;case"variableAnchorOffsetCollection":return Vi.parse(h.default)||null;case"projectionDefinition":return yr.parse(h.default)||null;default:return h.default===void 0?null:h.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,n,o,h,p,g){return this._globalState&&(e=Tr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,h,p,g){this._globalState&&(e=Tr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new fi(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Ho(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in uc}function dc(i,e,n){const o=new gl(uc,Jr,[],e?(function(p){const g={color:Zr,string:xn,number:Rt,enum:xn,boolean:En,formatted:Fa,padding:fs,numberArray:Xr,colorArray:ia,projectionDefinition:hl,resolvedImage:Ai,variableAnchorOffsetCollection:Ro};return p.type==="array"?wr(g[p.value]||_n,p.length):g[p.type]})(e):void 0),h=o.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?pu(new ph(h,e,n)):Go(o.errors)}class ea{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Sl(n.expression),this.globalStateRefs=_r(n.expression),this._globalState=o}evaluateWithoutErrorHandling(e,n,o,h,p,g){return this._globalState&&(e=Tr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,h,p,g)}evaluate(e,n,o,h,p,g){return this._globalState&&(e=Tr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,h,p,g)}}class Zo{constructor(e,n,o,h,p){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Sl(n.expression),this.globalStateRefs=_r(n.expression),this.interpolationType=h,this._globalState=p}evaluateWithoutErrorHandling(e,n,o,h,p,g){return this._globalState&&(e=Tr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,h,p,g)}evaluate(e,n,o,h,p,g){return this._globalState&&(e=Tr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,h,p,g)}interpolationFactor(e,n,o){return this.interpolationType?Qr.interpolationFactor(this.interpolationType,e,n,o):0}}function Xo(i,e,n){const o=dc(i,e,n);if(o.result==="error")return o;const h=o.value.expression,p=ho(h);if(!p&&!Ya(e))return Go([new hr("","data expressions not supported")]);const g=Tl(h,["zoom"]);if(!g&&!gd(e))return Go([new hr("","zoom expressions not supported")]);const b=Yo(h);return b||g?b instanceof hr?Go([b]):b instanceof Qr&&!hc(e)?Go([new hr("",'"interpolate" expressions cannot be used with this property')]):pu(b?new Zo(p?"camera":"composite",o.value,b.labels,b instanceof Qr?b.interpolation:void 0,n):new ea(p?"constant":"source",o.value,n)):Go([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class El{constructor(e,n){this._parameters=e,this._specification=n,br(this,dh(this._parameters,this._specification))}static deserialize(e){return new El(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yo(i){let e=null;if(i instanceof li)e=Yo(i.result);else if(i instanceof _l){for(const n of i.args)if(e=Yo(n),e)break}else(i instanceof Bo||i instanceof Qr)&&i.input instanceof Ea&&i.input.name==="zoom"&&(e=i);return e instanceof hr||i.eachChild((n=>{const o=Yo(n);o instanceof hr?e=o:!e&&o?e=new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function _r(i,e=new Set){return i instanceof fu&&e.add(i.key),i.eachChild((n=>{_r(n,e)})),e}function Tr(i,e){const{zoom:n,heatmapDensity:o,elevation:h,lineProgress:p,isSupportedScript:g,accumulated:b}=i??{};return{zoom:n,heatmapDensity:o,elevation:h,lineProgress:p,isSupportedScript:g,accumulated:b,globalState:e}}function Vs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Vs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const qs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function aa(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Vs(i)||(i=Ml(i));const n=dc(i,qs,e);if(n.result==="error")throw new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,h,p)=>n.value.evaluate(o,h,{},p),needGeometry:_d(i),getGlobalStateRefs:()=>_r(n.value.expression)}}function fo(i,e){return i<e?-1:i>e?1:0}function _d(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(_d(i[e]))return!0;return!1}function Ml(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?fc(i[1],i[2],"=="):e==="!="?pi(fc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?fc(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Ml))):e==="all"?["all"].concat(i.slice(1).map(Ml)):e==="none"?["all"].concat(i.slice(1).map(Ml).map(pi)):e==="in"?xd(i[1],i.slice(2)):e==="!in"?pi(xd(i[1],i.slice(2))):e==="has"?Er(i[1]):e!=="!has"||pi(Er(i[1]));var n}function fc(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function xd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(fo)]]:["filter-in-small",i,["literal",e]]}}function Er(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function pi(i){return["!",i]}function Bn(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const p of i)h+=`${Bn(p)},`;return`${h}]`}const n=Object.keys(i).sort();let o="{";for(let h=0;h<n.length;h++)o+=`${JSON.stringify(n[h])}:${Bn(i[n[h]])},`;return`${o}}`}function po(i){let e="";for(const n of Pn)e+=`/${Bn(i[n])}`;return e}function za(i){const e=i.value;return e?[new kt(i.key,e,"constants have been deprecated as of v8")]:[]}function Ni(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function sa(i){if(Array.isArray(i))return i.map(sa);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=sa(i[n]);return e}return Ni(i)}function oa(i){const e=i.key,n=i.value,o=i.valueSpec||{},h=i.objectElementValidators||{},p=i.style,g=i.styleSpec,b=i.validateSpec;let T=[];const z=Tn(n);if(z!=="object")return[new kt(e,n,`object expected, ${z} found`)];for(const I in n){const N=I.split(".")[0],B=Ns(o,N)||o["*"];let F;if(Ns(h,N))F=h[N];else if(Ns(o,N)){if(n[I]===void 0)continue;F=b}else if(h["*"])F=h["*"];else{if(!o["*"]){T.push(new kt(e,n[I],`unknown property "${I}"`));continue}F=b}T=T.concat(F({key:(e&&`${e}.`)+I,value:n[I],valueSpec:B,style:p,styleSpec:g,object:n,objectKey:I,validateSpec:b},n))}for(const I in o)h[I]||o[I].required&&o[I].default===void 0&&n[I]===void 0&&T.push(new kt(e,n,`missing required property "${I}"`));return T}function mu(i){const e=i.value,n=i.valueSpec,o=i.style,h=i.styleSpec,p=i.key,g=i.arrayElementValidator||i.validateSpec;if(Tn(e)!=="array")return[new kt(p,e,`array expected, ${Tn(e)} found`)];if(n.length&&e.length!==n.length)return[new kt(p,e,`array length ${n.length} expected, length ${e.length} found`)];let b={type:n.value,values:n.values};h.$version<7&&(b.function=n.function),Tn(n.value)==="object"&&(b=n.value);let T=[];for(let z=0;z<e.length;z++)T=T.concat(g({array:e,arrayIndex:z,value:e[z],valueSpec:b,validateSpec:i.validateSpec,style:o,styleSpec:h,key:`${p}[${z}]`}));return T}function Gs(i){const e=i.key,n=i.value,o=i.valueSpec;let h=Tn(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new kt(e,n,`number expected, ${h} found`)]:"minimum"in o&&n<o.minimum?[new kt(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new kt(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function $s(i){const e=i.valueSpec,n=Ni(i.value.type);let o,h,p,g={};const b=n!=="categorical"&&i.value.property===void 0,T=!b,z=Tn(i.value.stops)==="array"&&Tn(i.value.stops[0])==="array"&&Tn(i.value.stops[0][0])==="object",I=oa({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new kt(F.key,F.value,'identity function may not have a "stops" property')];let G=[];const H=F.value;return G=G.concat(mu({key:F.key,value:H,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:N})),Tn(H)==="array"&&H.length===0&&G.push(new kt(F.key,H,"array must have at least one stop")),G},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&b&&I.push(new kt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||I.push(new kt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!hc(i.valueSpec)&&I.push(new kt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Ya(i.valueSpec)?I.push(new kt(i.key,i.value,"property functions not supported")):b&&!gd(i.valueSpec)&&I.push(new kt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!z||i.value.property!==void 0||I.push(new kt(i.key,i.value,'"property" property is required')),I;function N(F){let G=[];const H=F.value,X=F.key;if(Tn(H)!=="array")return[new kt(X,H,`array expected, ${Tn(H)} found`)];if(H.length!==2)return[new kt(X,H,`array length 2 expected, length ${H.length} found`)];if(z){if(Tn(H[0])!=="object")return[new kt(X,H,`object expected, ${Tn(H[0])} found`)];if(H[0].zoom===void 0)return[new kt(X,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new kt(X,H,"object stop key must have value")];if(p&&p>Ni(H[0].zoom))return[new kt(X,H[0].zoom,"stop zoom values must appear in ascending order")];Ni(H[0].zoom)!==p&&(p=Ni(H[0].zoom),h=void 0,g={}),G=G.concat(oa({key:`${X}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Gs,value:B}}))}else G=G.concat(B({key:`${X}[0]`,value:H[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},H));return Ho(sa(H[1]))?G.concat([new kt(`${X}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat(F.validateSpec({key:`${X}[1]`,value:H[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function B(F,G){const H=Tn(F.value),X=Ni(F.value),J=F.value!==null?F.value:G;if(o){if(H!==o)return[new kt(F.key,J,`${H} stop domain type must match previous stop domain type ${o}`)]}else o=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new kt(F.key,J,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&n!=="categorical"){let ge=`number expected, ${H} found`;return Ya(e)&&n===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(F.key,J,ge)]}return n!=="categorical"||H!=="number"||isFinite(X)&&Math.floor(X)===X?n!=="categorical"&&H==="number"&&h!==void 0&&X<h?[new kt(F.key,J,"stop domain values must appear in ascending order")]:(h=X,n==="categorical"&&X in g?[new kt(F.key,J,"stop domain values must be unique")]:(g[X]=!0,[])):[new kt(F.key,J,`integer expected, found ${X}`)]}}function Hs(i){const e=(i.expressionContext==="property"?Xo:dc)(sa(i.value),i.valueSpec);if(e.result==="error")return e.value.map((o=>new kt(`${i.key}${o.key}`,i.value,o.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new kt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Sl(n))return[new kt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Sl(n))return[new kt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Tl(n,["zoom","feature-state"]))return[new kt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ho(n))return[new kt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mo(i){const e=i.key,n=i.value,o=Tn(n);return o!=="string"?[new kt(e,n,`color expected, ${o} found`)]:wn.parse(String(n))?[]:[new kt(e,n,`color expected, "${n}" found`)]}function go(i){const e=i.key,n=i.value,o=i.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(Ni(n))===-1&&h.push(new kt(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ni(n))===-1&&h.push(new kt(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function Ka(i){return Vs(sa(i.value))?Hs(br({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Zs(i)}function Zs(i){const e=i.value,n=i.key;if(Tn(e)!=="array")return[new kt(n,e,`array expected, ${Tn(e)} found`)];const o=i.styleSpec;let h,p=[];if(e.length<1)return[new kt(n,e,"filter array must have at least 1 element")];switch(p=p.concat(go({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ni(e[1])==="$type"&&p.push(new kt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new kt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Tn(e[1]),h!=="string"&&p.push(new kt(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let g=2;g<e.length;g++)h=Tn(e[g]),Ni(e[1])==="$type"?p=p.concat(go({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new kt(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Zs({key:`${n}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Tn(e[1]),e.length!==2?p.push(new kt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new kt(`${n}[1]`,e[1],`string expected, ${h} found`))}return p}function yo(i,e){const n=i.key,o=i.validateSpec,h=i.style,p=i.styleSpec,g=i.value,b=i.objectKey,T=p[`${e}_${i.layerType}`];if(!T)return[];const z=b.match(/^(.*)-transition$/);if(e==="paint"&&z&&T[z[1]]&&T[z[1]].transition)return o({key:n,value:g,valueSpec:p.transition,style:h,styleSpec:p});const I=i.valueSpec||T[b];if(!I)return[new kt(n,g,`unknown property "${b}"`)];let N;if(Tn(g)==="string"&&Ya(I)&&!I.tokens&&(N=/^{([^}]+)}$/.exec(g)))return[new kt(n,g,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const B=[];return i.layerType==="symbol"&&b==="text-font"&&hh(sa(g))&&Ni(g.type)==="identity"&&B.push(new kt(n,g,'"text-font" does not support identity functions')),B.concat(o({key:i.key,value:g,valueSpec:I,style:h,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:b}))}function Xs(i){return yo(i,"paint")}function mh(i){return yo(i,"layout")}function gh(i){let e=[];const n=i.value,o=i.key,h=i.style,p=i.styleSpec;if(Tn(n)!=="object")return[new kt(o,n,`object expected, ${Tn(n)} found`)];n.type||n.ref||e.push(new kt(o,n,'either "type" or "ref" is required'));let g=Ni(n.type);const b=Ni(n.ref);if(n.id){const T=Ni(n.id);for(let z=0;z<i.arrayIndex;z++){const I=h.layers[z];Ni(I.id)===T&&e.push(new kt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach((z=>{z in n&&e.push(new kt(o,n[z],`"${z}" is prohibited for ref layers`))})),h.layers.forEach((z=>{Ni(z.id)===b&&(T=z)})),T?T.ref?e.push(new kt(o,n.ref,"ref cannot reference another ref layer")):g=Ni(T.type):e.push(new kt(o,n.ref,`ref layer "${b}" not found`))}else if(g!=="background")if(n.source){const T=h.sources&&h.sources[n.source],z=T&&Ni(T.type);T?z==="vector"&&g==="raster"?e.push(new kt(o,n.source,`layer "${n.id}" requires a raster source`)):z!=="raster-dem"&&g==="hillshade"||z!=="raster-dem"&&g==="color-relief"?e.push(new kt(o,n.source,`layer "${n.id}" requires a raster-dem source`)):z==="raster"&&g!=="raster"?e.push(new kt(o,n.source,`layer "${n.id}" requires a vector source`)):z!=="vector"||n["source-layer"]?z==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new kt(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||z==="geojson"&&T.lineMetrics||e.push(new kt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new kt(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new kt(o,n.source,`source "${n.source}" not found`))}else e.push(new kt(o,n,'missing required property "source"'));return e=e.concat(oa({key:o,value:n,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Ka,layout:T=>oa({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":z=>mh(br({layerType:g},z))}}),paint:T=>oa({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":z=>Xs(br({layerType:g},z))}})}})),e}function ka(i){const e=i.value,n=i.key,o=Tn(e);return o!=="string"?[new kt(n,e,`string expected, ${o} found`)]:[]}const pc={promoteId:function({key:i,value:e}){if(Tn(e)==="string")return ka({key:i,value:e});{const n=[];for(const o in e)n.push(...ka({key:`${i}.${o}`,value:e[o]}));return n}}};function _o(i){const e=i.value,n=i.key,o=i.styleSpec,h=i.style,p=i.validateSpec;if(!e.type)return[new kt(n,e,'"type" is required')];const g=Ni(e.type);let b;switch(g){case"vector":case"raster":return b=oa({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:pc,validateSpec:p}),b;case"raster-dem":return b=(function(T){var z;const I=(z=T.sourceName)!==null&&z!==void 0?z:"",N=T.value,B=T.styleSpec,F=B.source_raster_dem,G=T.style;let H=[];const X=Tn(N);if(N===void 0)return H;if(X!=="object")return H.push(new kt("source_raster_dem",N,`object expected, ${X} found`)),H;const J=Ni(N.encoding)==="custom",ge=["redFactor","greenFactor","blueFactor","baseShift"],ee=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ae in N)!J&&ge.includes(ae)?H.push(new kt(ae,N[ae],`In "${I}": "${ae}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):F[ae]?H=H.concat(T.validateSpec({key:ae,value:N[ae],valueSpec:F[ae],validateSpec:T.validateSpec,style:G,styleSpec:B})):H.push(new kt(ae,N[ae],`unknown property "${ae}"`));return H})({sourceName:n,value:e,style:i.style,styleSpec:o,validateSpec:p}),b;case"geojson":if(b=oa({key:n,value:e,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:p,objectElementValidators:pc}),e.cluster)for(const T in e.clusterProperties){const[z,I]=e.clusterProperties[T],N=typeof z=="string"?[z,["accumulated"],["get",T]]:z;b.push(...Hs({key:`${n}.${T}.map`,value:I,expressionContext:"cluster-map"})),b.push(...Hs({key:`${n}.${T}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return b;case"video":return oa({key:n,value:e,valueSpec:o.source_video,style:h,validateSpec:p,styleSpec:o});case"image":return oa({key:n,value:e,valueSpec:o.source_image,style:h,validateSpec:p,styleSpec:o});case"canvas":return[new kt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return go({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ar(i){const e=i.value,n=i.styleSpec,o=n.light,h=i.style;let p=[];const g=Tn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new kt("light",e,`object expected, ${g} found`)]),p;for(const b in e){const T=b.match(/^(.*)-transition$/);p=p.concat(T&&o[T[1]]&&o[T[1]].transition?i.validateSpec({key:b,value:e[b],valueSpec:n.transition,validateSpec:i.validateSpec,style:h,styleSpec:n}):o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new kt(b,e[b],`unknown property "${b}"`)])}return p}function gu(i){const e=i.value,n=i.styleSpec,o=n.sky,h=i.style,p=Tn(e);if(e===void 0)return[];if(p!=="object")return[new kt("sky",e,`object expected, ${p} found`)];let g=[];for(const b in e)g=g.concat(o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],style:h,styleSpec:n}):[new kt(b,e[b],`unknown property "${b}"`)]);return g}function yh(i){const e=i.value,n=i.styleSpec,o=n.terrain,h=i.style;let p=[];const g=Tn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new kt("terrain",e,`object expected, ${g} found`)]),p;for(const b in e)p=p.concat(o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new kt(b,e[b],`unknown property "${b}"`)]);return p}function vd(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const h=[],p=[];for(const g in n)n[g].id&&h.includes(n[g].id)&&e.push(new kt(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),h.push(n[g].id),n[g].url&&p.includes(n[g].url)&&e.push(new kt(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),p.push(n[g].url),e=e.concat(oa({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return ka({key:o,value:n})}function Uf(i){return!!i&&i.constructor===Object}function bd(i){return Uf(i.value)?[]:[new kt(i.key,i.value,`object expected, ${Tn(i.value)} found`)]}const Ji={"*":()=>[],array:mu,boolean:function(i){const e=i.value,n=i.key,o=Tn(e);return o!=="boolean"?[new kt(n,e,`boolean expected, ${o} found`)]:[]},number:Gs,color:mo,constants:za,enum:go,filter:Ka,function:$s,layer:gh,object:oa,source:_o,light:ar,sky:gu,terrain:yh,projection:function(i){const e=i.value,n=i.styleSpec,o=n.projection,h=i.style,p=Tn(e);if(e===void 0)return[];if(p!=="object")return[new kt("projection",e,`object expected, ${p} found`)];let g=[];for(const b in e)g=g.concat(o[b]?i.validateSpec({key:b,value:e[b],valueSpec:o[b],style:h,styleSpec:n}):[new kt(b,e[b],`unknown property "${b}"`)]);return g},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const o=Tn(n);return o!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(n)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(n)?["array","string"].includes(o)?[]:[new kt(e,n,`projection expected, invalid type "${o}" found`)]:[new kt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:ka,formatted:function(i){return ka(i).length===0?[]:Hs(i)},resolvedImage:function(i){return ka(i).length===0?[]:Hs(i)},padding:function(i){const e=i.key,n=i.value;if(Tn(n)==="array"){if(n.length<1||n.length>4)return[new kt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let h=[];for(let p=0;p<n.length;p++)h=h.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return h}return Gs({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(Tn(n)==="array"){const o={type:"number"};if(n.length<1)return[new kt(e,n,"array length at least 1 expected, length 0 found")];let h=[];for(let p=0;p<n.length;p++)h=h.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return h}return Gs({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(Tn(n)==="array"){if(n.length<1)return[new kt(e,n,"array length at least 1 expected, length 0 found")];let o=[];for(let h=0;h<n.length;h++)o=o.concat(mo({key:`${e}[${h}]`,value:n[h]}));return o}return mo({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,o=Tn(n),h=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new kt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let g=0;g<n.length;g+=2)p=p.concat(go({key:`${e}[${g}]`,value:n[g],valueSpec:h.layout_symbol["text-anchor"]})),p=p.concat(mu({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return p},sprite:vd,state:bd,fontFaces:function(i){const e=i.key,n=i.value,o=i.validateSpec,h=i.styleSpec,p=i.style;if(!Uf(n))return[new kt(e,n,`object expected, ${Tn(n)} found`)];const g=[];for(const b in n){const T=n[b],z=Tn(T);if(z==="string")g.push(...ka({key:`${e}.${b}`,value:T}));else if(z==="array"){const I={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[N,B]of T.entries())g.push(...oa({key:`${e}.${b}[${N}]`,value:B,valueSpec:I,styleSpec:h,style:p,validateSpec:o}))}else g.push(new kt(`${e}.${b}`,T,`string or array expected, ${z} found`))}return g}};function Ys(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=Ys,n.expression&&hh(Ni(e))?$s(i):n.expression&&Ho(sa(e))?Hs(i):n.type&&Ji[n.type]?Ji[n.type](i):oa(br({},i,{valueSpec:n.type?o[n.type]:n}))}function mc(i){const e=i.value,n=i.key,o=ka(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new kt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new kt(n,e,'"glyphs" url must include a "{range}" token'))),o}function Ur(i,e=Ve){let n=[];return n=n.concat(Ys({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Ys,objectElementValidators:{glyphs:mc,"*":()=>[]}})),i.constants&&(n=n.concat(za({key:"constants",value:i.constants}))),Cl(n)}function Pa(i){return function(e){return i(Object.assign({},e,{validateSpec:Ys}))}}function Cl(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function Vr(i){return function(...e){return Cl(i.apply(this,e))}}Ur.source=Vr(Pa(_o)),Ur.sprite=Vr(Pa(vd)),Ur.glyphs=Vr(Pa(mc)),Ur.light=Vr(Pa(ar)),Ur.sky=Vr(Pa(gu)),Ur.terrain=Vr(Pa(yh)),Ur.state=Vr(Pa(bd)),Ur.layer=Vr(Pa(gh)),Ur.filter=Vr(Pa(Ka)),Ur.paintProperty=Vr(Pa(Xs)),Ur.layoutProperty=Vr(Pa(mh));const am={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class gc{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=dc(e,am,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=_r(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const yu=Ve,xr=Ur,_s=xr.light,_h=xr.sky,xh=xr.paintProperty,Vf=xr.layoutProperty;function xs(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new pn(new Error(o.message))),n=!0;return n}class Ko{constructor(e,n,o){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let T=0;T<this.d*this.d;T++){const z=g[3+T],I=g[3+T+1];h.push(z===I?null:g.subarray(z,I))}const b=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],b),this.bboxes=g.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const p=o/n*e;this.min=-p,this.max=e+p}insert(e,n,o,h,p){this._forEachCell(n,o,h,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,h,p,g){this.cells[p].push(g)}query(e,n,o,h,p){const g=this.min,b=this.max;if(e<=g&&n<=g&&b<=o&&b<=h&&!p)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,o,h,this._queryCell,T,{},p),T}}_queryCell(e,n,o,h,p,g,b,T){const z=this.cells[p];if(z!==null){const I=this.keys,N=this.bboxes;for(let B=0;B<z.length;B++){const F=z[B];if(b[F]===void 0){const G=4*F;(T?T(N[G+0],N[G+1],N[G+2],N[G+3]):e<=N[G+2]&&n<=N[G+3]&&o>=N[G+0]&&h>=N[G+1])?(b[F]=!0,g.push(I[F])):b[F]=!1}}}}_forEachCell(e,n,o,h,p,g,b,T){const z=this._convertToCellCoord(e),I=this._convertToCellCoord(n),N=this._convertToCellCoord(o),B=this._convertToCellCoord(h);for(let F=z;F<=N;F++)for(let G=I;G<=B;G++){const H=this.d*G+F;if((!T||T(this._convertFromCellCoord(F),this._convertFromCellCoord(G),this._convertFromCellCoord(F+1),this._convertFromCellCoord(G+1)))&&p.call(this,e,n,o,h,H,g,b,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let p=n;for(let g=0;g<e.length;g++){const b=e[g];h[3+g]=p,h.set(b,p),p+=b.length}return h[3+e.length]=p,h.set(this.keys,p),p+=this.keys.length,h[3+e.length+1]=p,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new Ko(e.buffer)}}const la={};function Zt(i,e,n={}){if(la[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),la[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Zt("Object",Object),Zt("Set",Set),Zt("TransferableGridIndex",Ko),Zt("Color",wn),Zt("Error",Error),Zt("AJAXError",Me),Zt("ResolvedImage",Yr),Zt("StylePropertyFunction",El),Zt("StyleExpression",ph,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",Zo),Zt("ZoomConstantExpression",ea),Zt("CompoundExpression",Ea,{omit:["_evaluate"]});for(const i in uc)uc[i]._classRegistryKey||Zt(`Expression_${i}`,uc[i]);function _u(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function vh(i){return i.$name||i.constructor._classRegistryKey}function Wa(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=vh(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||_u(i)||gn(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function vs(i,e){if(Wa(i))return(_u(i)||gn(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const p=[];for(const g of i)p.push(vs(g,e));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=vh(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!la[n])throw new Error(`${n} is not registered.`);const{klass:o}=la[n],h=o.serialize?o.serialize(i,e):{};if(o.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||la[n].omit.indexOf(p)>=0)continue;const g=i[p];h[p]=la[n].shallow.indexOf(p)>=0?g:vs(g,e)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(h.$name=n),h}function yc(i){if(Wa(i))return i;if(Array.isArray(i))return i.map(yc);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=vh(i)||"Object";if(!la[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=la[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const p=i[h];o[h]=la[e].shallow.indexOf(h)>=0?p:yc(p)}return o}class bh{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function Ks(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Al(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function xu(i){return/\s/u.test(String.fromCodePoint(i))}function Ws(i){for(const e of i)if(Al(e.codePointAt(0)))return!0;return!1}function wh(i){for(const e of i)if(!wd(e.codePointAt(0)))return!1;return!0}function vu(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const Qs=vu(["Arab","Dupl","Mong","Ougr","Syrc"]);function wd(i){return!Qs.test(String.fromCodePoint(i))}function Js(i){return!(Al(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Sh=vu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function bu(i){return Sh.test(String.fromCodePoint(i))}function eo(i,e){return!(!e&&bu(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function xo(i){for(const e of i)if(bu(e.codePointAt(0)))return!0;return!1}const Qa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Qa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,o=new Promise((p=>{this.loadScriptResolve=p}));e(n);const h=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([o,h]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class ri{constructor(e,n){this.isSupportedScript=Sd,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new bh,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function Sd(i){return(function(e,n){for(const o of e)if(!eo(o.codePointAt(0),n))return!1;return!0})(i,Qa.getRTLTextPluginStatus()==="loaded")}const vo="-transition";class Wo{constructor(e,n,o){this.property=e,this.value=n,this.expression=(function(h,p,g){if(hh(h))return new El(h,p);if(Ho(h)){const b=Xo(h,p,g);if(b.result==="error")throw new Error(b.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return b.value}{let b=h;return p.type==="color"&&typeof h=="string"?b=wn.parse(h):p.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?p.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?p.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?b=Vi.parse(h):p.type==="projectionDefinition"&&typeof h=="string"&&(b=yr.parse(h)):b=un.parse(h):b=zi.parse(h):b=rr.parse(h),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>b}}})(n===void 0?e.specification.default:n,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class wu{constructor(e,n){this.property=e,this.value=new Wo(e,void 0,n)}transitioned(e,n){return new zl(this.property,this.value,n,$t({},e.transition,this.transition),e.now)}untransitioned(){return new zl(this.property,this.value,null,{},0)}}class Th{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return rn(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wu(this._values[e].property,this._globalState)),this._values[e].value=new Wo(this._values[e].property,n===null?void 0:rn(n),this._globalState)}getTransition(e){return rn(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new wu(this._values[e].property,this._globalState)),this._values[e].transition=rn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const h=this.getTransition(n);h!==void 0&&(e[`${n}${vo}`]=h)}return e}transitioned(e,n){const o=new Su(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(e,n._values[h]);return o}untransitioned(){const e=new Su(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class zl{constructor(e,n,o,h,p){this.property=e,this.value=n,this.begin=p+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const h=e.now||0,p=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,n,o);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),p,_t(b))}}return p}}class Su{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const h=new kl(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,n,o);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Td{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return rn(this._values[e].value)}setValue(e,n){this._values[e]=new Wo(this._values[e].property,n===null?void 0:rn(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const h=new kl(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,n,o);return h}}class Da{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,h){return this.property.evaluate(this.value,this.parameters,e,n,o,h)}}class kl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Yt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const h=Pi[this.specification.type];return h?h(e,n,o):e}}class nn{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,h){return new Da(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,h)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Da(this,{kind:"constant",value:void 0},e.parameters);const h=Pi[this.specification.type];if(h){const p=h(e.value.value,n.value.value,o);return new Da(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,n,o,h,p,g){return e.kind==="constant"?e.value:e.evaluate(n,o,h,p,g)}}class Ja extends nn{possiblyEvaluate(e,n,o,h){if(e.value===void 0)return new Da(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,h),g=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,b=this._calculate(g,g,g,n);return new Da(this,{kind:"constant",value:b},n)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Da(this,{kind:"constant",value:p},n)}return new Da(this,e.expression,n)}evaluate(e,n,o,h,p,g){if(e.kind==="source"){const b=e.evaluate(n,o,h,p,g);return this._calculate(b,b,b,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,h),e.evaluate({zoom:Math.floor(n.zoom)},o,h),e.evaluate({zoom:Math.floor(n.zoom)+1},o,h),n):e.value}_calculate(e,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class _c{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,h);return this._calculate(p,p,p,n)}return this._calculate(e.expression.evaluate(new ri(Math.floor(n.zoom-1),n)),e.expression.evaluate(new ri(Math.floor(n.zoom),n)),e.expression.evaluate(new ri(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class Tu{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,h){return!!e.expression.evaluate(n,null,{},o,h)}interpolate(){return!1}}class er{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new Wo(o,void 0,void 0),p=this.defaultTransitionablePropertyValues[n]=new wu(o,void 0);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}Zt("DataDrivenProperty",nn),Zt("DataConstantProperty",Yt),Zt("CrossFadedDataDrivenProperty",Ja),Zt("CrossFadedProperty",_c),Zt("ColorRampProperty",Tu);class ji extends Mn{constructor(e,n,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(h,p){return new gc(h,p)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=aa(e.filter,o)),n.layout&&(this._unevaluatedLayout=new Td(n.layout,o)),n.paint)){this._transitionablePaint=new Th(n.paint,o);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new kl(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=aa(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const h of o.getGlobalStateRefs())e.add(h)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const h=this._transitionablePaint._values[o].value;for(const p of h.getGlobalStateRefs()){const g=(e=n.get(p))!==null&&e!==void 0?e:[];g.push({name:o,value:h.value}),n.set(p,g)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,o={}){if(n==null||!this._validate(Vf,`layers.${this.id}.layout.${e}`,e,n,o))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith(vo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(xh,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(vo))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[e],p=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),b=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(e,b,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),dn(e,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(e,n,o,h,p={}){return(!p||p.validate!==!1)&&xs(this,e.call(xr,{key:n,layerType:this.type,objectKey:o,value:h,styleSpec:Ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Da&&Ya(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Gi;var Eu={get paint(){return Gi=Gi||new er({"raster-opacity":new Yt(Ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new Yt(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Yt(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Yt(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Yt(Ve.paint_raster["raster-saturation"]),"raster-contrast":new Yt(Ve.paint_raster["raster-contrast"]),"raster-resampling":new Yt(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Yt(Ve.paint_raster["raster-fade-duration"])})}};class bo extends ji{constructor(e,n){super(e,Eu,n)}}const zn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ti{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class An{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Di(i,e=1){let n=0,o=0;return{members:i.map((h=>{const p=zn[h.type].BYTES_PER_ELEMENT,g=n=es(n,Math.max(e,p)),b=h.components||1;return o=Math.max(o,p),n+=p*b,{name:h.name,type:h.type,components:b,offset:g}})),size:es(n,Math.max(o,e)),alignment:e}}function es(i,e){return Math.ceil(i/e)*e}class bs extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=o,e}}bs.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",bs);class Pl extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o)}emplace(e,n,o,h){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=h,e}}Pl.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",Pl);class Dl extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,h)}emplace(e,n,o,h,p){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=h,this.int16[g+3]=p,e}}Dl.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Dl);class wo extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,h,p,g)}emplace(e,n,o,h,p,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=h,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=b,e}}wo.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",wo);class Ed extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,h,p,g)}emplace(e,n,o,h,p,g,b){const T=4*e,z=8*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[z+4]=h,this.uint8[z+5]=p,this.uint8[z+6]=g,this.uint8[z+7]=b,e}}Ed.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",Ed);class Ei extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=o,e}}Ei.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",Ei);class ws extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g,b,T,z,I){const N=this.length;return this.resize(N+1),this.emplace(N,e,n,o,h,p,g,b,T,z,I)}emplace(e,n,o,h,p,g,b,T,z,I,N){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=o,this.uint16[B+2]=h,this.uint16[B+3]=p,this.uint16[B+4]=g,this.uint16[B+5]=b,this.uint16[B+6]=T,this.uint16[B+7]=z,this.uint16[B+8]=I,this.uint16[B+9]=N,e}}ws.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",ws);class xc extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g,b,T){const z=this.length;return this.resize(z+1),this.emplace(z,e,n,o,h,p,g,b,T)}emplace(e,n,o,h,p,g,b,T,z){const I=8*e;return this.uint16[I+0]=n,this.uint16[I+1]=o,this.uint16[I+2]=h,this.uint16[I+3]=p,this.uint16[I+4]=g,this.uint16[I+5]=b,this.uint16[I+6]=T,this.uint16[I+7]=z,e}}xc.prototype.bytesPerElement=16,Zt("StructArrayLayout8ui16",xc);class vc extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g,b,T,z,I,N,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,h,p,g,b,T,z,I,N,B)}emplace(e,n,o,h,p,g,b,T,z,I,N,B,F){const G=12*e;return this.int16[G+0]=n,this.int16[G+1]=o,this.int16[G+2]=h,this.int16[G+3]=p,this.uint16[G+4]=g,this.uint16[G+5]=b,this.uint16[G+6]=T,this.uint16[G+7]=z,this.int16[G+8]=I,this.int16[G+9]=N,this.int16[G+10]=B,this.int16[G+11]=F,e}}vc.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",vc);class Mu extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o)}emplace(e,n,o,h){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=h,e}}Mu.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",Mu);class Cu extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Cu.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",Cu);class Au extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g,b,T,z){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,o,h,p,g,b,T,z)}emplace(e,n,o,h,p,g,b,T,z,I){const N=10*e,B=5*e;return this.int16[N+0]=n,this.int16[N+1]=o,this.int16[N+2]=h,this.int16[N+3]=p,this.int16[N+4]=g,this.int16[N+5]=b,this.uint32[B+3]=T,this.uint16[N+8]=z,this.uint16[N+9]=I,e}}Au.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",Au);class Qo extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,h,p,g)}emplace(e,n,o,h,p,g,b){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=h,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=b,e}}Qo.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",Qo);class So extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,h,p)}emplace(e,n,o,h,p,g){const b=4*e,T=8*e;return this.float32[b+0]=n,this.float32[b+1]=o,this.float32[b+2]=h,this.int16[T+6]=p,this.int16[T+7]=g,e}}So.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",So);class Nr extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,o,h,p,g)}emplace(e,n,o,h,p,g,b){const T=16*e,z=4*e,I=8*e;return this.uint8[T+0]=n,this.uint8[T+1]=o,this.float32[z+1]=h,this.float32[z+2]=p,this.int16[I+6]=g,this.int16[I+7]=b,e}}Nr.prototype.bytesPerElement=16,Zt("StructArrayLayout2ub2f2i16",Nr);class Ii extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o)}emplace(e,n,o,h){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=h,e}}Ii.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",Ii);class to extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g,b,T,z,I,N,B,F,G,H,X,J){const ge=this.length;return this.resize(ge+1),this.emplace(ge,e,n,o,h,p,g,b,T,z,I,N,B,F,G,H,X,J)}emplace(e,n,o,h,p,g,b,T,z,I,N,B,F,G,H,X,J,ge){const ee=24*e,ae=12*e,xe=48*e;return this.int16[ee+0]=n,this.int16[ee+1]=o,this.uint16[ee+2]=h,this.uint16[ee+3]=p,this.uint32[ae+2]=g,this.uint32[ae+3]=b,this.uint32[ae+4]=T,this.uint16[ee+10]=z,this.uint16[ee+11]=I,this.uint16[ee+12]=N,this.float32[ae+7]=B,this.float32[ae+8]=F,this.uint8[xe+36]=G,this.uint8[xe+37]=H,this.uint8[xe+38]=X,this.uint32[ae+10]=J,this.int16[ee+22]=ge,e}}to.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",to);class Il extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,h,p,g,b,T,z,I,N,B,F,G,H,X,J,ge,ee,ae,xe,Ee,We,yt,ht,Tt,Ut,Ct){const mt=this.length;return this.resize(mt+1),this.emplace(mt,e,n,o,h,p,g,b,T,z,I,N,B,F,G,H,X,J,ge,ee,ae,xe,Ee,We,yt,ht,Tt,Ut,Ct)}emplace(e,n,o,h,p,g,b,T,z,I,N,B,F,G,H,X,J,ge,ee,ae,xe,Ee,We,yt,ht,Tt,Ut,Ct,mt){const st=32*e,Kt=16*e;return this.int16[st+0]=n,this.int16[st+1]=o,this.int16[st+2]=h,this.int16[st+3]=p,this.int16[st+4]=g,this.int16[st+5]=b,this.int16[st+6]=T,this.int16[st+7]=z,this.uint16[st+8]=I,this.uint16[st+9]=N,this.uint16[st+10]=B,this.uint16[st+11]=F,this.uint16[st+12]=G,this.uint16[st+13]=H,this.uint16[st+14]=X,this.uint16[st+15]=J,this.uint16[st+16]=ge,this.uint16[st+17]=ee,this.uint16[st+18]=ae,this.uint16[st+19]=xe,this.uint16[st+20]=Ee,this.uint16[st+21]=We,this.uint16[st+22]=yt,this.uint32[Kt+12]=ht,this.float32[Kt+13]=Tt,this.float32[Kt+14]=Ut,this.uint16[st+30]=Ct,this.uint16[st+31]=mt,e}}Il.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Il);class Rl extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Rl.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",Rl);class bc extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o)}emplace(e,n,o,h){const p=3*e;return this.uint16[6*e+0]=n,this.float32[p+1]=o,this.float32[p+2]=h,e}}bc.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",bc);class Ss extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o)}emplace(e,n,o,h){const p=4*e;return this.uint32[2*e+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=h,e}}Ss.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Ss);class y extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=o,e}}y.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",y);class t extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",t);class a extends An{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,h)}emplace(e,n,o,h,p){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=h,this.float32[g+3]=p,e}}a.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",a);class c extends ti{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new O(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class f extends Au{get(e){return new c(this,e)}}Zt("CollisionBoxArray",f);class x extends ti{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}x.prototype.size=48;class w extends to{get(e){return new x(this,e)}}Zt("PlacedSymbolArray",w);class C extends ti{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}C.prototype.size=64;class P extends Il{get(e){return new C(this,e)}}Zt("SymbolInstanceArray",P);class L extends Rl{getoffsetX(e){return this.float32[1*e+0]}}Zt("GlyphOffsetArray",L);class j extends Pl{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Zt("SymbolLineVertexArray",j);class V extends ti{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}V.prototype.size=12;class U extends bc{get(e){return new V(this,e)}}Zt("TextAnchorOffsetArray",U);class Z extends ti{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Z.prototype.size=8;class Q extends Ss{get(e){return new Z(this,e)}}Zt("FeatureIndexArray",Q);class se extends bs{}class ce extends bs{}class oe extends bs{}class pe extends wo{}class Te extends Ed{}class fe extends Ei{}class Se extends ws{}class Ae extends xc{}class _e extends vc{}class Re extends Mu{}class rt extends Cu{}class Ke extends Qo{}class et extends Nr{}class tt extends Ii{}class Lt extends y{}const Nt=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:wt}=Nt;class Ft{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,o,h){const p=this.segments[this.segments.length-1];return e>Ft.MAX_VERTEX_ARRAY_LENGTH&&xt(`Max vertices per segment is ${Ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ft.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>Ft.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h?this.createNewSegment(n,o,h):p}createNewSegment(e,n,o){const h={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(h.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(e,n,o){return this.prepareSegment(0,e,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,h){return new Ft([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function vn(i,e){return 256*(i=Dt(Math.floor(i),0,255))+Dt(Math.floor(e),0,255)}Ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Ft);const ni=Di([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),vi=Di([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var mi,Mi,ci,Oi={exports:{}},Ci={exports:{}},Mr={exports:{}},$i=(function(){if(ci)return Oi.exports;ci=1;var i=(mi||(mi=1,Ci.exports=function(n,o){var h,p,g,b,T,z,I,N;for(p=n.length-(h=3&n.length),g=o,T=3432918353,z=461845907,N=0;N<p;)I=255&n.charCodeAt(N)|(255&n.charCodeAt(++N))<<8|(255&n.charCodeAt(++N))<<16|(255&n.charCodeAt(++N))<<24,++N,g=27492+(65535&(b=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*z+(((I>>>16)*z&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(I=0,h){case 3:I^=(255&n.charCodeAt(N+2))<<16;case 2:I^=(255&n.charCodeAt(N+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&n.charCodeAt(N)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*z+(((I>>>16)*z&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Ci.exports),e=(Mi||(Mi=1,Mr.exports=function(n,o){for(var h,p=n.length,g=o^p,b=0;p>=4;)h=1540483477*(65535&(h=255&n.charCodeAt(b)|(255&n.charCodeAt(++b))<<8|(255&n.charCodeAt(++b))<<16|(255&n.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++b;switch(p){case 3:g^=(255&n.charCodeAt(b+2))<<16;case 2:g^=(255&n.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Mr.exports);return Oi.exports=i,Oi.exports.murmur3=i,Oi.exports.murmur2=e,Oi.exports})(),Hi=Y($i);class Cr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,h){this.ids.push(no(e)),this.positions.push(n,o,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=no(e);let o=0,h=this.ids.length-1;for(;o<h;){const g=o+h>>1;this.ids[g]>=n?h=g:o=g+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(e,n){const o=new Float64Array(e.ids),h=new Uint32Array(e.positions);return io(o,h,0,o.length-1),n&&n.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(e){const n=new Cr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function no(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Hi(String(i))}function io(i,e,n,o){for(;n<o;){const h=i[n+o>>1];let p=n-1,g=o+1;for(;;){do p++;while(i[p]<h);do g--;while(i[g]>h);if(p>=g)break;Ts(i,p,g),Ts(e,3*p,3*g),Ts(e,3*p+1,3*g+1),Ts(e,3*p+2,3*g+2)}g-n<o-g?(io(i,e,n,g),n=g+1):(io(i,e,g+1,o),o=g)}}function Ts(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}Zt("FeaturePositionMap",Cr);class ca{constructor(e,n){this.gl=e.gl,this.location=n}}class Ll extends ca{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class wc extends ca{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Es extends ca{constructor(e,n){super(e,n),this.current=wn.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ua=new Float32Array(16);function Ia(i){return[vn(255*i.r,255*i.g),vn(255*i.b,255*i.a)]}class ts{constructor(e,n,o){this.value=e,this.uniformNames=n.map((h=>`u_${h}`)),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new Es(e,n):new Ll(e,n)}}class ns{constructor(e,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,o,h){let p=null;h==="u_pattern_to"?p=this.patternTo:h==="u_pattern_from"?p=this.patternFrom:h==="u_dasharray_to"?p=this.dashTo:h==="u_dasharray_from"?p=this.dashFrom:h==="u_pixel_ratio_to"?p=this.pixelRatioTo:h==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&e.set(p)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new wc(e,n):new Ll(e,n)}}class ai{constructor(e,n,o,h){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,n,o){const h=this.paintVertexArray.length,p=this.expression.evaluate(new ri(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(h,e,p)}updatePaintArray(e,n,o,h,p){const g=this.expression.evaluate(new ri(0,p),o,h);this._setPaintValue(e,n,g)}_setPaintValue(e,n,o){if(this.type==="color"){const h=Ia(o);for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class gi{constructor(e,n,o,h,p,g){this.expression=e,this.uniformNames=n.map((b=>`u_${b}_t`)),this.type=o,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map((b=>({name:`a_${b}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,n,o){const h=this.expression.evaluate(new ri(this.zoom,o),n,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new ri(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,h,p)}updatePaintArray(e,n,o,h,p){const g=this.expression.evaluate(new ri(this.zoom,p),o,h),b=this.expression.evaluate(new ri(this.zoom+1,p),o,h);this._setPaintValue(e,n,g,b)}_setPaintValue(e,n,o,h){if(this.type==="color"){const p=Ia(o),g=Ia(h);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,p[0],p[1],g[0],g[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=Dt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,n,o){return new Ll(e,n)}}class sr{constructor(e,n,o,h,p,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=h,this.layerId=g,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,this.getPositionIds(n),o)}updatePaintArray(e,n,o,h,p){this._setPaintValues(e,n,this.getPositionIds(o),p)}_setPaintValues(e,n,o,h){const p=this.getPositions(h);if(!p||!o)return;const g=p[o.min],b=p[o.mid],T=p[o.max];if(g&&b&&T)for(let z=e;z<n;z++)this.emplace(this.zoomInPaintVertexArray,z,b,g),this.emplace(this.zoomOutPaintVertexArray,z,b,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fr extends sr{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return ni.members}emplace(e,n,o,h){e.emplace(n,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],o.pixelRatio,h.pixelRatio)}}class Eh extends sr{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return vi.members}emplace(e,n,o,h){e.emplace(n,0,o.y,o.height,o.width,0,h.y,h.height,h.width)}}class Mh{constructor(e,n,o){this.binders={},this._buffers=[];const h=[];for(const p in e.paint._values){if(!o(p))continue;const g=e.paint.get(p);if(!(g instanceof Da&&Ya(g.property.specification)))continue;const b=qf(p,e.type),T=g.value,z=g.property.specification.type,I=g.property.useIntegerZoom,N=g.property.specification["property-type"],B=N==="cross-faded"||N==="cross-faded-data-driven";if(T.kind==="constant")this.binders[p]=B?new ns(T.value,b):new ts(T.value,b,z),h.push(`/u_${p}`);else if(T.kind==="source"||B){const F=el(p,z,"source");this.binders[p]=B?p==="line-dasharray"?new Eh(T,z,I,n,F,e.id):new fr(T,z,I,n,F,e.id):new ai(T,b,z,F),h.push(`/a_${p}`)}else{const F=el(p,z,"composite");this.binders[p]=new gi(T,b,z,I,n,F),h.push(`/z_${p}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ai||n instanceof gi?n.maxValue:0}populatePaintArrays(e,n,o){for(const h in this.binders){const p=this.binders[h];(p instanceof ai||p instanceof gi||p instanceof sr)&&p.populatePaintArray(e,n,o)}}setConstantPatternPositions(e,n){for(const o in this.binders){const h=this.binders[o];h instanceof ns&&h.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const o in this.binders){const h=this.binders[o];h instanceof ns&&h.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,o,h,p){let g=!1;for(const b in e){const T=n.getPositions(b);for(const z of T){const I=o.feature(z.index);for(const N in this.binders){const B=this.binders[N];if((B instanceof ai||B instanceof gi||B instanceof sr)&&B.expression.isStateDependent===!0){const F=h.paint.get(N);B.expression=F.value,B.updatePaintArray(z.start,z.end,I,e[b],p),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof ts||o instanceof ns)&&e.push(...o.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ai||o instanceof gi)for(let h=0;h<o.paintVertexAttributes.length;h++)e.push(o.paintVertexAttributes[h].name);else if(o instanceof sr){const h=o.getVertexAttributes();for(const p of h)e.push(p.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ts||o instanceof ns||o instanceof gi)for(const h of o.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof ts||p instanceof ns||p instanceof gi){for(const g of p.uniformNames)if(n[g]){const b=p.getBinding(e,n[g],g);o.push({name:g,property:h,binding:b})}}}return o}setUniforms(e,n,o,h){for(const{name:p,property:g,binding:b}of n)this.binders[g].setUniform(b,h,o.get(g),p)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof sr){const h=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof ai||o instanceof gi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof ai||o instanceof gi||o instanceof sr)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ai||n instanceof gi||n instanceof sr)&&n.destroy()}}}class Jo{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Mh(h,n,o);this.needsUpload=!1,this._featureMap=new Cr,this._bufferOffset=0}populatePaintArrays(e,n,o,h){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,h);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,h){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function qf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function el(i,e,n){const o={color:{source:Ei,composite:a},number:{source:Rl,composite:Ei}},h=(function(p){return{"line-pattern":{source:Se,composite:Se},"fill-pattern":{source:Se,composite:Se},"fill-extrusion-pattern":{source:Se,composite:Se},"line-dasharray":{source:Ae,composite:Ae}}[p]})(i);return h&&h[n]||o[e][n]}Zt("ConstantBinder",ts),Zt("CrossFadedConstantBinder",ns),Zt("SourceExpressionBinder",ai),Zt("CrossFadedPatternBinder",fr),Zt("CrossFadedDasharrayBinder",Eh),Zt("CompositeExpressionBinder",gi),Zt("ProgramConfiguration",Mh,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Jo);const Ch=Math.pow(2,14)-1,To=-Ch-1;function Eo(i){const e=Fe/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const h=n[o];for(let p=0;p<h.length;p++){const g=h[p],b=Math.round(g.x*e),T=Math.round(g.y*e);g.x=Dt(b,To,Ch),g.y=Dt(T,To,Ch),(b<g.x||b>g.x+1||T<g.y||T>g.y+1)&&xt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ms(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Eo(i):[]}}const Ah=-32768;function zu(i,e,n,o,h){i.emplaceBack(Ah+8*e+o,Ah+8*n+h)}class ku{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ce,this.indexArray=new tt,this.segments=new Ft,this.programConfigurations=new Jo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){const h=this.layers[0],p=[];let g=null,b=!1,T=h.type==="heatmap";if(h.type==="circle"){const I=h;g=I.layout.get("circle-sort-key"),b=!g.isConstant(),T=T||I.paint.get("circle-pitch-alignment")==="map"}const z=T?n.subdivisionGranularity.circle:1;for(const{feature:I,id:N,index:B,sourceLayerIndex:F}of e){const G=this.layers[0]._featureFilter.needGeometry,H=Ms(I,G);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),H,o))continue;const X=b?g.evaluate(H,{},o):void 0,J={id:N,properties:I.properties,type:I.type,sourceLayerIndex:F,index:B,geometry:G?H.geometry:Eo(I),patterns:{},sortKey:X};p.push(J)}b&&p.sort(((I,N)=>I.sortKey-N.sortKey));for(const I of p){const{geometry:N,index:B,sourceLayerIndex:F}=I,G=e[B].feature;this.addFeature(I,N,B,o,z),n.featureIndex.insert(G,N,B,F,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,h,p=1){let g;switch(p){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const b=g.length;for(const T of n)for(const z of T){const I=z.x,N=z.y;if(I<0||I>=Fe||N<0||N>=Fe)continue;const B=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,e.sortKey),F=B.vertexLength;for(let G=0;G<b;G++)for(let H=0;H<b;H++)zu(this.layoutVertexArray,I,N,g[H],g[G]);for(let G=0;G<b-1;G++)for(let H=0;H<b-1;H++){const X=F+G*b+H,J=F+(G+1)*b+H;this.indexArray.emplaceBack(X,J+1,X+1),this.indexArray.emplaceBack(X,J,J+1)}B.vertexLength+=b*b,B.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:h})}}function Pu(i,e){for(let n=0;n<i.length;n++)if(tl(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(tl(i,e[n]))return!0;return!!jr(i,e)}function Gf(i,e,n){return!!tl(i,e)||!!Hf(e,i,n)}function $f(i,e){if(i.length===1)return om(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let h=0;h<o.length;h++)if(tl(i,o[h]))return!0}for(let n=0;n<i.length;n++)if(om(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(jr(i,e[n]))return!0;return!1}function Ar(i,e,n){if(i.length>1){if(jr(i,e))return!0;for(let o=0;o<e.length;o++)if(Hf(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Hf(i[o],e,n))return!0;return!1}function jr(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],h=i[n+1];for(let p=0;p<e.length-1;p++)if(wg(o,h,e[p],e[p+1]))return!0}return!1}function wg(i,e,n,o){return zt(i,n,o)!==zt(e,n,o)&&zt(i,e,n)!==zt(i,e,o)}function Hf(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let h=1;h<e.length;h++)if(sm(i,e[h-1],e[h])<o)return!0;return!1}function sm(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const h=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function om(i,e){let n,o,h,p=!1;for(let g=0;g<i.length;g++){n=i[g];for(let b=0,T=n.length-1;b<n.length;T=b++)o=n[b],h=n[T],o.y>e.y!=h.y>e.y&&e.x<(h.x-o.x)*(e.y-o.y)/(h.y-o.y)+o.x&&(p=!p)}return p}function tl(i,e){let n=!1;for(let o=0,h=i.length-1;o<i.length;h=o++){const p=i[o],g=i[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(n=!n)}return n}function Sg(i,e,n){const o=n[0],h=n[2];if(i.x<o.x&&e.x<o.x||i.x>h.x&&e.x>h.x||i.y<o.y&&e.y<o.y||i.y>h.y&&e.y>h.y)return!1;const p=zt(i,e,n[0]);return p!==zt(i,e,n[1])||p!==zt(i,e,n[2])||p!==zt(i,e,n[3])}function Nl(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Md(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Zf(i,e,n,o,h){if(!e[0]&&!e[1])return i;const p=O.convert(e)._mult(h);n==="viewport"&&p._rotate(-o);const g=[];for(let b=0;b<i.length;b++)g.push(i[b].sub(p));return g}function Xf(i){const e=[];for(let n=0;n<i.length;n++){const o=i[n],h=e.at(-1);(n===0||h&&!o.equals(h))&&e.push(o)}return e}function lm({queryGeometry:i,size:e},n){return Gf(i,n,e)}function Tg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:h},p){return Gf(i,p,e*(n.projectTileCoordinates(p.x,p.y,o,h).signedDistanceFromCamera/n.cameraToCenterDistance))}function Eg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:h},p){const g=n.projectTileCoordinates(p.x,p.y,o,h).signedDistanceFromCamera,b=e*(n.cameraToCenterDistance/g);return Gf(i,Cd(p,n,o,h),b)}function Mg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:h},p){return Gf(i,Cd(p,n,o,h),e)}function Yf({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:h,pitchAlignment:p="map",pitchScale:g="map"},b){const T=p==="map"?g==="map"?lm:Tg:g==="map"?Eg:Mg,z={queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:h};for(const I of b)for(const N of I)if(T(z,N))return!0;return!1}function Cd(i,e,n,o){const h=e.projectTileCoordinates(i.x,i.y,n,o).point;return new O((.5*h.x+.5)*e.width,(.5*-h.y+.5)*e.height)}let Kf,cm;Zt("CircleBucket",ku,{omit:["layers"]});var um={get paint(){return cm=cm||new er({"circle-radius":new nn(Ve.paint_circle["circle-radius"]),"circle-color":new nn(Ve.paint_circle["circle-color"]),"circle-blur":new nn(Ve.paint_circle["circle-blur"]),"circle-opacity":new nn(Ve.paint_circle["circle-opacity"]),"circle-translate":new Yt(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Yt(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Yt(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Yt(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new nn(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new nn(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new nn(Ve.paint_circle["circle-stroke-opacity"])})},get layout(){return Kf=Kf||new er({"circle-sort-key":new nn(Ve.layout_circle["circle-sort-key"])})}};class Wf extends ji{constructor(e,n){super(e,um,n)}createBucket(e){return new ku(e)}queryRadius(e){const n=e;return Nl("circle-radius",this,n)+Nl("circle-stroke-width",this,n)+Md(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:h,transform:p,pixelsToTileUnits:g,unwrappedTileID:b,getElevation:T}){const z=Zf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,g),I=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),N=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let F,G;return B==="map"?(F=z,G=I*g):(F=(function(H,X,J,ge){return H.map((ee=>Cd(ee,X,J,ge)))})(z,p,b,T),G=I),Yf({queryGeometry:F,size:G,transform:p,unwrappedTileID:b,getElevation:T,pitchAlignment:B,pitchScale:N},h)}}class Qf extends ku{}let hm;Zt("HeatmapBucket",Qf,{omit:["layers"]});var dm={get paint(){return hm=hm||new er({"heatmap-radius":new nn(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new nn(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Yt(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tu(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Yt(Ve.paint_heatmap["heatmap-opacity"])})}};function Jf(i,{width:e,height:n},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*n*o}`)}else h=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=h,i}function nl(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const h=Jf({},{width:e,height:n},o);Ad(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=h.data}function Ad(i,e,n,o,h,p){if(h.width===0||h.height===0)return e;if(h.width>i.width||h.height>i.height||n.x>i.width-h.width||n.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||o.x>e.width-h.width||o.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,b=e.data;if(g===b)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<h.height;T++){const z=((n.y+T)*i.width+n.x)*p,I=((o.y+T)*e.width+o.x)*p;for(let N=0;N<h.width*p;N++)b[I+N]=g[z+N]}return e}class zd{constructor(e,n){Jf(this,e,1,n)}resize(e){nl(this,e,1)}clone(){return new zd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,h,p){Ad(e,n,o,h,p,1)}}class ha{constructor(e,n){Jf(this,e,4,n)}resize(e){nl(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,h,p){Ad(e,n,o,h,p,4)}setPixel(e,n,o){const h=4*(e*this.width+n);this.data[h+0]=Math.round(255*o.r/o.a),this.data[h+1]=Math.round(255*o.g/o.a),this.data[h+2]=Math.round(255*o.b/o.a),this.data[h+3]=Math.round(255*o.a)}}function il(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,h=i.image||new ha({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(g,b,T)=>{e[i.evaluationKey]=T;const z=i.expression.evaluate(e);h.setPixel(g/4/n,b/4,z)};if(i.clips)for(let g=0,b=0;g<o;++g,b+=4*n)for(let T=0,z=0;T<n;T++,z+=4){const I=T/(n-1),{start:N,end:B}=i.clips[g];p(b,z,N*(1-I)+B*I)}else for(let g=0,b=0;g<n;g++,b+=4)p(0,b,g/(n-1));return h}Zt("AlphaImage",zd),Zt("RGBAImage",ha);const kd="big-fb";class Cg extends ji{createBucket(e){return new Qf(e)}constructor(e,n){super(e,dm,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=il({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(kd)&&this.heatmapFbos.delete(kd)}queryRadius(e){return Nl("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:h,transform:p,pixelsToTileUnits:g,unwrappedTileID:b,getElevation:T}){return Yf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,o)*g,transform:p,unwrappedTileID:b,getElevation:T},h)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Pd;var Dd={get paint(){return Pd=Pd||new er({"hillshade-illumination-direction":new Yt(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Yt(Ve.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Yt(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Yt(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Yt(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Yt(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Yt(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Yt(Ve.paint_hillshade["hillshade-method"])})}};class Zi extends ji{constructor(e,n){super(e,Dd,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,n.length,o.length,h.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),h=h.concat(Array(p-h.length).fill(h.at(-1)));const g=n.map(kn);return{directionRadians:e.map(kn),altitudeRadians:g,shadowColor:h,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Ag;var s_={get paint(){return Ag=Ag||new er({"color-relief-opacity":new Yt(Ve["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Tu(Ve["paint_color-relief"]["color-relief-color"])})}};class ep{constructor(e,n,o,h){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,o){const{width:h,height:p}=e,g=!(this.size&&this.size[0]===h&&this.size[1]===p||o),{context:b}=this,{gl:T}=b;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),g)this.size=[h,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||gn(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,h,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:z,y:I}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||gn(e)?T.texSubImage2D(T.TEXTURE_2D,0,z,I,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,z,I,h,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,o){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class zh{constructor(e,n,o,h=1,p=1,g=1,b=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void xt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=p,this.blueFactor=g,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<T;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(T,z)]=this.data[this._idx(T-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,T)]=this.data[this._idx(z,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<T;z++)for(let I=0;I<T;I++){const N=this.get(z,I);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(e,n){const o=new Uint8Array(this.data.buffer),h=4*this._idx(e,n);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return jl(e,this.getUnpackVector())}getPixels(){return new ha({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,p=n*this.dim+this.dim,g=o*this.dim,b=o*this.dim+this.dim;switch(n){case-1:h=p-1;break;case 1:p=h+1}switch(o){case-1:g=b-1;break;case 1:b=g+1}const T=-n*this.dim,z=-o*this.dim;for(let I=g;I<b;I++)for(let N=h;N<p;N++)this.data[this._idx(N,I)]=e.data[this._idx(N+T,I+z)]}}function jl(i,e){const n=e[0],o=e[1],h=e[2],p=e[3],g=Math.min(n,o,h),b=Math.round((i+p)/g);return{r:Math.floor(b*g/n)%256,g:Math.floor(b*g/o)%256,b:Math.floor(b*g/h)%256}}Zt("DEMData",zh);class zg extends ji{constructor(e,n){super(e,s_,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof ea&&o._styleExpression.expression instanceof Qr){this.colorRampExpression=o;const g=o._styleExpression.expression;n.elevationStops=g.labels,n.colorStops=[];for(const b of n.elevationStops)n.colorStops.push(g.evaluate({globals:{elevation:b}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[wn.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const h={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(e-1);for(let g=0;g<n.elevationStops.length-.5;g+=p)h.elevationStops.push(n.elevationStops[Math.round(g)]),h.colorStops.push(n.colorStops[Math.round(g)]);return xt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(n),p=new ha({width:h.colorStops.length,height:1}),g=new ha({width:h.colorStops.length,height:1});for(let b=0;b<h.elevationStops.length;b++){const T=jl(h.elevationStops[b],o);g.setPixel(0,b,new wn(T.r/255,T.g/255,T.b/255,1)),p.setPixel(0,b,h.colorStops[b])}return this.colorRampTextures={elevationTexture:new ep(e,g,e.gl.RGBA),colorTexture:new ep(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const kg=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:Id}=kg;function Cs(i,e,n){const o=n.patternDependencies;let h=!1;for(const p of e){const g=p.paint.get(`${i}-pattern`);g.isConstant()||(h=!0);const b=g.constantOr(null);b&&(h=!0,o[b.to]=!0,o[b.from]=!0)}return h}function tp(i,e,n,o,h){const{zoom:p}=o,g=h.patternDependencies;for(const b of e){const T=b.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let z=T.evaluate({zoom:p-1},n,{},h.availableImages),I=T.evaluate({zoom:p},n,{},h.availableImages),N=T.evaluate({zoom:p+1},n,{},h.availableImages);z=z&&z.name?z.name:z,I=I&&I.name?I.name:I,N=N&&N.name?N.name:N,g[z]=!0,g[I]=!0,g[N]=!0,n.patterns[b.id]={min:z,mid:I,max:N}}}return n}function np(i,e,n,o,h){let p;if(h===(function(g,b,T,z){let I=0;for(let N=b,B=T-z;N<T;N+=z)I+=(g[B]-g[N])*(g[N+1]+g[B+1]),B=N;return I})(i,e,n,o)>0)for(let g=e;g<n;g+=o)p=Ra(g/o|0,i[g],i[g+1],p);else for(let g=n-o;g>=e;g-=o)p=Ra(g/o|0,i[g],i[g+1],p);return p&&is(p,p.next)&&(La(p),p=p.next),p}function Sc(i,e){if(!i)return i;e||(e=i);let n,o=i;do if(n=!1,o.steiner||!is(o,o.next)&&Wn(o.prev,o,o.next)!==0)o=o.next;else{if(La(o),o=e=o.prev,o===o.next)break;n=!0}while(n||o!==e);return e}function Du(i,e,n,o,h,p,g){if(!i)return;!g&&p&&(function(T,z,I,N){let B=T;do B.z===0&&(B.z=kr(B.x,B.y,z,I,N)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,(function(F){let G,H=1;do{let X,J=F;F=null;let ge=null;for(G=0;J;){G++;let ee=J,ae=0;for(let Ee=0;Ee<H&&(ae++,ee=ee.nextZ,ee);Ee++);let xe=H;for(;ae>0||xe>0&&ee;)ae!==0&&(xe===0||!ee||J.z<=ee.z)?(X=J,J=J.nextZ,ae--):(X=ee,ee=ee.nextZ,xe--),ge?ge.nextZ=X:F=X,X.prevZ=ge,ge=X;J=ee}ge.nextZ=null,H*=2}while(G>1)})(B)})(i,o,h,p);let b=i;for(;i.prev!==i.next;){const T=i.prev,z=i.next;if(p?ip(i,o,h,p):fm(i))e.push(T.i,i.i,z.i),La(i),i=z.next,b=z.next;else if((i=z)===b){g?g===1?Du(i=Pg(Sc(i),e),e,n,o,h,p,2):g===2&&Ol(i,e,n,o,h,p):Du(Sc(i),e,n,o,h,p,1);break}}}function fm(i){const e=i.prev,n=i,o=i.next;if(Wn(e,n,o)>=0)return!1;const h=e.x,p=n.x,g=o.x,b=e.y,T=n.y,z=o.y,I=Math.min(h,p,g),N=Math.min(b,T,z),B=Math.max(h,p,g),F=Math.max(b,T,z);let G=o.next;for(;G!==e;){if(G.x>=I&&G.x<=B&&G.y>=N&&G.y<=F&&kh(h,b,p,T,g,z,G.x,G.y)&&Wn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function ip(i,e,n,o){const h=i.prev,p=i,g=i.next;if(Wn(h,p,g)>=0)return!1;const b=h.x,T=p.x,z=g.x,I=h.y,N=p.y,B=g.y,F=Math.min(b,T,z),G=Math.min(I,N,B),H=Math.max(b,T,z),X=Math.max(I,N,B),J=kr(F,G,e,n,o),ge=kr(H,X,e,n,o);let ee=i.prevZ,ae=i.nextZ;for(;ee&&ee.z>=J&&ae&&ae.z<=ge;){if(ee.x>=F&&ee.x<=H&&ee.y>=G&&ee.y<=X&&ee!==h&&ee!==g&&kh(b,I,T,N,z,B,ee.x,ee.y)&&Wn(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ae.x>=F&&ae.x<=H&&ae.y>=G&&ae.y<=X&&ae!==h&&ae!==g&&kh(b,I,T,N,z,B,ae.x,ae.y)&&Wn(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ee&&ee.z>=J;){if(ee.x>=F&&ee.x<=H&&ee.y>=G&&ee.y<=X&&ee!==h&&ee!==g&&kh(b,I,T,N,z,B,ee.x,ee.y)&&Wn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ae&&ae.z<=ge;){if(ae.x>=F&&ae.x<=H&&ae.y>=G&&ae.y<=X&&ae!==h&&ae!==g&&kh(b,I,T,N,z,B,ae.x,ae.y)&&Wn(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function Pg(i,e){let n=i;do{const o=n.prev,h=n.next.next;!is(o,h)&&gm(o,n,n.next,h)&&Nd(o,h)&&Nd(h,o)&&(e.push(o.i,n.i,h.i),La(n),La(n.next),n=i=h),n=n.next}while(n!==i);return Sc(n)}function Ol(i,e,n,o,h,p){let g=i;do{let b=g.next.next;for(;b!==g.prev;){if(g.i!==b.i&&tr(g,b)){let T=jd(g,b);return g=Sc(g,g.next),T=Sc(T,T.next),Du(g,e,n,o,h,p,0),void Du(T,e,n,o,h,p,0)}b=b.next}g=g.next}while(g!==i)}function zr(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function pm(i,e){const n=(function(h,p){let g=p;const b=h.x,T=h.y;let z,I=-1/0;if(is(h,g))return g;do{if(is(h,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const H=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(H<=b&&H>I&&(I=H,z=g.x<g.next.x?g:g.next,H===b))return z}g=g.next}while(g!==p);if(!z)return null;const N=z,B=z.x,F=z.y;let G=1/0;g=z;do{if(b>=g.x&&g.x>=B&&b!==g.x&&mm(T<F?b:I,T,B,F,T<F?I:b,T,g.x,g.y)){const H=Math.abs(T-g.y)/(b-g.x);Nd(g,h)&&(H<G||H===G&&(g.x>z.x||g.x===z.x&&Dg(z,g)))&&(z=g,G=H)}g=g.next}while(g!==N);return z})(i,e);if(!n)return e;const o=jd(n,i);return Sc(o,o.next),Sc(n,n.next)}function Dg(i,e){return Wn(i.prev,i,e.prev)<0&&Wn(e.next,i,i.next)<0}function kr(i,e,n,o,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function o_(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function mm(i,e,n,o,h,p,g,b){return(h-g)*(e-b)>=(i-g)*(p-b)&&(i-g)*(o-b)>=(n-g)*(e-b)&&(n-g)*(p-b)>=(h-g)*(o-b)}function kh(i,e,n,o,h,p,g,b){return!(i===g&&e===b)&&mm(i,e,n,o,h,p,g,b)}function tr(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,o){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==o.i&&h.next.i!==o.i&&gm(h,h.next,n,o))return!0;h=h.next}while(h!==n);return!1})(i,e)&&(Nd(i,e)&&Nd(e,i)&&(function(n,o){let h=n,p=!1;const g=(n.x+o.x)/2,b=(n.y+o.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&g<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==n);return p})(i,e)&&(Wn(i.prev,i,e.prev)||Wn(i,e.prev,e))||is(i,e)&&Wn(i.prev,i,i.next)>0&&Wn(e.prev,e,e.next)>0)}function Wn(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function is(i,e){return i.x===e.x&&i.y===e.y}function gm(i,e,n,o){const h=Ld(Wn(i,e,n)),p=Ld(Wn(i,e,o)),g=Ld(Wn(n,o,i)),b=Ld(Wn(n,o,e));return h!==p&&g!==b||!(h!==0||!Rd(i,n,e))||!(p!==0||!Rd(i,o,e))||!(g!==0||!Rd(n,i,o))||!(b!==0||!Rd(n,e,o))}function Rd(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Ld(i){return i>0?1:i<0?-1:0}function Nd(i,e){return Wn(i.prev,i,i.next)<0?Wn(i,e,i.next)>=0&&Wn(i,i.prev,e)>=0:Wn(i,e,i.prev)<0||Wn(i,i.next,e)<0}function jd(i,e){const n=rp(i.i,i.x,i.y),o=rp(e.i,e.x,e.y),h=i.next,p=e.prev;return i.next=e,e.prev=i,n.next=h,h.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function Ra(i,e,n,o){const h=rp(i,e,n);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function La(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function rp(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Or{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Od{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Od.noSubdivision=new Od({fill:new Or(0,0),line:new Or(0,0),tile:new Or(0,0),stencil:new Or(0,0),circle:1}),Zt("SubdivisionGranularityExpression",Or),Zt("SubdivisionGranularitySetting",Od);const rs=-32768,Mo=32767;class Bl{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Fe/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),h=0|Math.round(n),p=this._getKey(o,h);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,g),this._vertexBuffer.push(o,h),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(h,p){const g=[];for(let b=0;b<p.length;b+=3){const T=p[b],z=p[b+1],I=p[b+2],N=h[2*T],B=h[2*T+1];(h[2*z]-N)*(h[2*I+1]-B)-(h[2*z+1]-B)*(h[2*I]-N)>0?(g.push(T),g.push(I),g.push(z)):(g.push(T),g.push(z),g.push(I))}return g})(this._vertexBuffer,e);const n=[],o=e.length;for(let h=0;h<o;h+=3){const p=[e[h+0],e[h+1],e[h+2]],g=[this._vertexBuffer[2*e[h+0]+0],this._vertexBuffer[2*e[h+0]+1],this._vertexBuffer[2*e[h+1]+0],this._vertexBuffer[2*e[h+1]+1],this._vertexBuffer[2*e[h+2]+0],this._vertexBuffer[2*e[h+2]+1]];let b=1/0,T=1/0,z=-1/0,I=-1/0;for(let H=0;H<3;H++){const X=g[2*H],J=g[2*H+1];b=Math.min(b,X),z=Math.max(z,X),T=Math.min(T,J),I=Math.max(I,J)}if(b===z||T===I)continue;const N=Math.floor(b/this._granularityCellSize),B=Math.ceil(z/this._granularityCellSize),F=Math.floor(T/this._granularityCellSize),G=Math.ceil(I/this._granularityCellSize);if(N!==B||F!==G)for(let H=F;H<G;H++){const X=this._scanlineGenerateVertexRingForCellRow(H,g,p);Co(this._vertexBuffer,X,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(e,n,o){const h=e*this._granularityCellSize,p=h+this._granularityCellSize,g=[];for(let b=0;b<3;b++){const T=n[2*b],z=n[2*b+1],I=n[2*(b+1)%6],N=n[(2*(b+1)+1)%6],B=n[2*(b+2)%6],F=n[(2*(b+2)+1)%6],G=I-T,H=N-z,X=G===0,J=H===0,ge=(h-z)/H,ee=(p-z)/H,ae=Math.min(ge,ee),xe=Math.max(ge,ee);if(!J&&(ae>=1||xe<=0)||J&&(z<h||z>p)){N>=h&&N<=p&&g.push(o[(b+1)%3]);continue}!J&&ae>0&&g.push(this._vertexToIndex(T+G*ae,z+H*ae));const Ee=T+G*Math.max(ae,0),We=T+G*Math.min(xe,1);X||this._generateIntraEdgeVertices(g,T,z,I,N,Ee,We),!J&&xe<1&&g.push(this._vertexToIndex(T+G*xe,z+H*xe)),(J||N>=h&&N<=p)&&g.push(o[(b+1)%3]),!J&&(N<=h||N>=p)&&this._generateInterEdgeVertices(g,T,z,I,N,B,F,We,h,p)}return g}_generateIntraEdgeVertices(e,n,o,h,p,g,b){const T=h-n,z=p-o,I=z===0,N=I?Math.min(n,h):Math.min(g,b),B=I?Math.max(n,h):Math.max(g,b),F=Math.floor(N/this._granularityCellSize)+1,G=Math.ceil(B/this._granularityCellSize)-1;if(I?n<h:g<b)for(let H=F;H<=G;H++){const X=H*this._granularityCellSize;e.push(this._vertexToIndex(X,o+z*(X-n)/T))}else for(let H=G;H>=F;H--){const X=H*this._granularityCellSize;e.push(this._vertexToIndex(X,o+z*(X-n)/T))}}_generateInterEdgeVertices(e,n,o,h,p,g,b,T,z,I){const N=p-o,B=g-h,F=b-p,G=(z-p)/F,H=(I-p)/F,X=Math.min(G,H),J=Math.max(G,H),ge=h+B*X;let ee=Math.floor(Math.min(ge,T)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(ge,T)/this._granularityCellSize)-1,xe=T<ge;const Ee=F===0;if(Ee&&(b===z||b===I))return;if(Ee||X>=1||J<=0){const yt=o-b,ht=g+(n-g)*Math.min((z-b)/yt,(I-b)/yt);ee=Math.floor(Math.min(ht,T)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(ht,T)/this._granularityCellSize)-1,xe=T<ht}const We=N>0?I:z;if(xe)for(let yt=ee;yt<=ae;yt++)e.push(this._vertexToIndex(yt*this._granularityCellSize,We));else for(let yt=ae;yt>=ee;yt--)e.push(this._vertexToIndex(yt*this._granularityCellSize,We))}_generateOutline(e){const n=[];for(const o of e){const h=Fl(o,this._granularity,!0),p=this._pointArrayToIndices(h),g=[];for(let b=1;b<p.length;b++)g.push(p[b-1]),g.push(p[b]);n.push(g)}return n}_handlePoles(e){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(e,n,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const o=e[n+1];o===rs&&(e[n+1]=-32767),o===Mo&&(e[n+1]=32766)}}_generatePoleQuad(e,n,o,h,p,g){h>p!=(g===rs)?(e.push(n),e.push(o),e.push(this._vertexToIndex(h,g)),e.push(o),e.push(this._vertexToIndex(p,g)),e.push(this._vertexToIndex(h,g))):(e.push(o),e.push(n),e.push(this._vertexToIndex(h,g)),e.push(this._vertexToIndex(p,g)),e.push(o),e.push(this._vertexToIndex(h,g)))}_fillPoles(e,n,o){const h=this._vertexBuffer,p=Fe,g=e.length;for(let b=2;b<g;b+=3){const T=e[b-2],z=e[b-1],I=e[b],N=h[2*T],B=h[2*T+1],F=h[2*z],G=h[2*z+1],H=h[2*I],X=h[2*I+1];n&&(B===0&&G===0&&this._generatePoleQuad(e,T,z,N,F,rs),G===0&&X===0&&this._generatePoleQuad(e,z,I,F,H,rs),X===0&&B===0&&this._generatePoleQuad(e,I,T,H,N,rs)),o&&(B===p&&G===p&&this._generatePoleQuad(e,T,z,N,F,Mo),G===p&&X===p&&this._generatePoleQuad(e,z,I,F,H,Mo),X===p&&B===p&&this._generatePoleQuad(e,I,T,H,N,Mo))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:h}=(function(b){const T=[],z=[];for(const I of b)if(I.length!==0){I!==b[0]&&T.push(z.length/2);for(let N=0;N<I.length;N++)z.push(I[N].x),z.push(I[N].y)}return{flattened:z,holeIndices:T}})(e);let p;this._initializeVertices(o);try{const b=(function(z,I,N=2){const B=I&&I.length,F=B?I[0]*N:z.length;let G=np(z,0,F,N,!0);const H=[];if(!G||G.next===G.prev)return H;let X,J,ge;if(B&&(G=(function(ee,ae,xe,Ee){const We=[];for(let yt=0,ht=ae.length;yt<ht;yt++){const Tt=np(ee,ae[yt]*Ee,yt<ht-1?ae[yt+1]*Ee:ee.length,Ee,!1);Tt===Tt.next&&(Tt.steiner=!0),We.push(o_(Tt))}We.sort(zr);for(let yt=0;yt<We.length;yt++)xe=pm(We[yt],xe);return xe})(z,I,G,N)),z.length>80*N){X=z[0],J=z[1];let ee=X,ae=J;for(let xe=N;xe<F;xe+=N){const Ee=z[xe],We=z[xe+1];Ee<X&&(X=Ee),We<J&&(J=We),Ee>ee&&(ee=Ee),We>ae&&(ae=We)}ge=Math.max(ee-X,ae-J),ge=ge!==0?32767/ge:0}return Du(G,H,N,X,J,ge,0),H})(o,h),T=this._convertIndices(o,b);p=this._subdivideTrianglesScanline(T)}catch(b){console.error(b)}let g=[];return n&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:g}}_convertIndices(e,n){const o=[];for(let h=0;h<n.length;h++)o.push(this._vertexToIndex(e[2*n[h]],e[2*n[h]+1]));return o}_pointArrayToIndices(e){const n=[];for(let o=0;o<e.length;o++){const h=e[o];n.push(this._vertexToIndex(h.x,h.y))}return n}}function ap(i,e,n,o=!0){return new Bl(n,e).subdividePolygonInternal(i,o)}function Fl(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const o=i[0],h=i[i.length-1],p=n&&(o.x!==h.x||o.y!==h.y);if(e<2)return p?[...i,i[0]]:[...i];const g=Math.floor(Fe/e),b=[];b.push(new O(i[0].x,i[0].y));const T=i.length,z=p?T:T-1;for(let I=0;I<z;I++){const N=i[I],B=I<T-1?i[I+1]:i[0],F=N.x,G=N.y,H=B.x,X=B.y,J=F!==H,ge=G!==X;if(!J&&!ge)continue;const ee=H-F,ae=X-G,xe=Math.abs(ee),Ee=Math.abs(ae);let We=F,yt=G;for(;;){const Tt=ee>0?(Math.floor(We/g)+1)*g:(Math.ceil(We/g)-1)*g,Ut=ae>0?(Math.floor(yt/g)+1)*g:(Math.ceil(yt/g)-1)*g,Ct=Math.abs(We-Tt),mt=Math.abs(yt-Ut),st=Math.abs(We-H),Kt=Math.abs(yt-X),Xt=J?Ct/xe:Number.POSITIVE_INFINITY,Qt=ge?mt/Ee:Number.POSITIVE_INFINITY;if((st<=Ct||!J)&&(Kt<=mt||!ge))break;if(Xt<Qt&&J||!ge){We=Tt,yt+=ae*Xt;const Ht=new O(We,Math.round(yt));b[b.length-1].x===Ht.x&&b[b.length-1].y===Ht.y||b.push(Ht)}else{We+=ee*Qt,yt=Ut;const Ht=new O(Math.round(We),yt);b[b.length-1].x===Ht.x&&b[b.length-1].y===Ht.y||b.push(Ht)}}const ht=new O(H,X);b[b.length-1].x===ht.x&&b[b.length-1].y===ht.y||b.push(ht)}return b}function Co(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,h=i[2*e[0]];for(let T=1;T<e.length;T++){const z=i[2*e[T]];z<h&&(h=z,o=T)}const p=e.length;let g=o,b=(g+1)%p;for(;;){const T=g-1>=0?g-1:p-1,z=(b+1)%p,I=i[2*e[T]],N=i[2*e[z]],B=i[2*e[g]],F=i[2*e[g]+1],G=i[2*e[b]+1];let H=!1;if(I<N)H=!0;else if(I>N)H=!1;else{const X=G-F,J=-(i[2*e[b]]-B),ge=F<G?1:-1;((I-B)*X+(i[2*e[T]+1]-F)*J)*ge>((N-B)*X+(i[2*e[z]+1]-F)*J)*ge&&(H=!0)}if(H){const X=e[T],J=e[g],ge=e[b];X!==J&&X!==ge&&J!==ge&&n.push(ge,J,X),g--,g<0&&(g=p-1)}else{const X=e[z],J=e[g],ge=e[b];X!==J&&X!==ge&&J!==ge&&n.push(ge,J,X),b++,b>=p&&(b=0)}if(T===z)break}}function ym(i,e,n,o,h,p,g,b,T){const z=h.length/2,I=g&&b&&T;if(z<Ft.MAX_VERTEX_ARRAY_LENGTH){const N=e.prepareSegment(z,n,o),B=N.vertexLength;for(let H=0;H<p.length;H+=3)o.emplaceBack(B+p[H],B+p[H+1],B+p[H+2]);let F,G;N.vertexLength+=z,N.primitiveLength+=p.length/3,I&&(G=g.prepareSegment(z,n,b),F=G.vertexLength,G.vertexLength+=z);for(let H=0;H<h.length;H+=2)i(h[H],h[H+1]);if(I)for(let H=0;H<T.length;H++){const X=T[H];for(let J=1;J<X.length;J+=2)b.emplaceBack(F+X[J-1],F+X[J]);G.primitiveLength+=X.length/2}}else(function(N,B,F,G,H,X){const J=[];for(let Ee=0;Ee<G.length/2;Ee++)J.push(-1);const ge={count:0};let ee=0,ae=N.getOrCreateLatestSegment(B,F),xe=ae.vertexLength;for(let Ee=2;Ee<H.length;Ee+=3){const We=H[Ee-2],yt=H[Ee-1],ht=H[Ee];let Tt=J[We]<ee,Ut=J[yt]<ee,Ct=J[ht]<ee;ae.vertexLength+((Tt?1:0)+(Ut?1:0)+(Ct?1:0))>Ft.MAX_VERTEX_ARRAY_LENGTH&&(ae=N.createNewSegment(B,F),ee=ge.count,Tt=!0,Ut=!0,Ct=!0,xe=0);const mt=rl(J,G,X,ge,We,Tt,ae),st=rl(J,G,X,ge,yt,Ut,ae),Kt=rl(J,G,X,ge,ht,Ct,ae);F.emplaceBack(xe+mt-ee,xe+st-ee,xe+Kt-ee),ae.primitiveLength++}})(e,n,o,h,p,i),I&&(function(N,B,F,G,H,X){const J=[];for(let Ee=0;Ee<G.length/2;Ee++)J.push(-1);const ge={count:0};let ee=0,ae=N.getOrCreateLatestSegment(B,F),xe=ae.vertexLength;for(let Ee=0;Ee<H.length;Ee++){const We=H[Ee];for(let yt=1;yt<H[Ee].length;yt+=2){const ht=We[yt-1],Tt=We[yt];let Ut=J[ht]<ee,Ct=J[Tt]<ee;ae.vertexLength+((Ut?1:0)+(Ct?1:0))>Ft.MAX_VERTEX_ARRAY_LENGTH&&(ae=N.createNewSegment(B,F),ee=ge.count,Ut=!0,Ct=!0,xe=0);const mt=rl(J,G,X,ge,ht,Ut,ae),st=rl(J,G,X,ge,Tt,Ct,ae);F.emplaceBack(xe+mt-ee,xe+st-ee),ae.primitiveLength++}}})(g,n,b,h,T,i),e.forceNewSegmentOnNextPrepare(),g?.forceNewSegmentOnNextPrepare()}function rl(i,e,n,o,h,p,g){if(p){const b=o.count;return n(e[2*h],e[2*h+1]),i[h]=o.count,o.count++,g.vertexLength++,b}return i[h]}class Iu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new oe,this.indexArray=new tt,this.indexArray2=new Lt,this.programConfigurations=new Jo(e.layers,e.zoom),this.segments=new Ft,this.segments2=new Ft,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=Cs("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),p=!h.isConstant(),g=[];for(const{feature:b,id:T,index:z,sourceLayerIndex:I}of e){const N=this.layers[0]._featureFilter.needGeometry,B=Ms(b,N);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),B,o))continue;const F=p?h.evaluate(B,{},o,n.availableImages):void 0,G={id:T,properties:b.properties,type:b.type,sourceLayerIndex:I,index:z,geometry:N?B.geometry:Eo(b),patterns:{},sortKey:F};g.push(G)}p&&g.sort(((b,T)=>b.sortKey-T.sortKey));for(const b of g){const{geometry:T,index:z,sourceLayerIndex:I}=b;if(this.hasDependencies){const N=tp("fill",this.layers,b,{zoom:this.zoom},n);this.patternFeatures.push(N)}else this.addFeature(b,T,z,o,{},n.subdivisionGranularity);n.featureIndex.insert(e[z].feature,T,z,I,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,n,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Id),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,h,p,g){for(const b of au(n,500)){const T=ap(b,h,g.fill.getGranularityForZoomLevel(h.z)),z=this.layoutVertexArray;ym(((I,N)=>{z.emplaceBack(I,N)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:h})}}let Ph,Ru;Zt("FillBucket",Iu,{omit:["layers","patternFeatures"]});var Ig={get paint(){return Ru=Ru||new er({"fill-antialias":new Yt(Ve.paint_fill["fill-antialias"]),"fill-opacity":new nn(Ve.paint_fill["fill-opacity"]),"fill-color":new nn(Ve.paint_fill["fill-color"]),"fill-outline-color":new nn(Ve.paint_fill["fill-outline-color"]),"fill-translate":new Yt(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Yt(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ja(Ve.paint_fill["fill-pattern"])})},get layout(){return Ph=Ph||new er({"fill-sort-key":new nn(Ve.layout_fill["fill-sort-key"])})}};class Rg extends ji{constructor(e,n){super(e,Ig,n)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Iu(e)}queryRadius(){return Md(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:o,pixelsToTileUnits:h}){return $f(Zf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,h),n)}isTileClipped(){return!0}}const Bd=Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Lg=Di([{name:"a_centroid",components:2,type:"Int16"}],4),{members:sp}=Bd;class Dh{constructor(e,n,o,h,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(l_,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,o=[];let h,p=1,g=0,b=0,T=0;for(;e.pos<n;){if(g<=0){const z=e.readVarint();p=7&z,g=z>>3}if(g--,p===1||p===2)b+=e.readSVarint(),T+=e.readSVarint(),p===1&&(h&&o.push(h),h=[]),h&&h.push(new O(b,T));else{if(p!==7)throw new Error(`unknown command ${p}`);h&&h.push(h[0].clone())}}return h&&o.push(h),o}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let o=1,h=0,p=0,g=0,b=1/0,T=-1/0,z=1/0,I=-1/0;for(;e.pos<n;){if(h<=0){const N=e.readVarint();o=7&N,h=N>>3}if(h--,o===1||o===2)p+=e.readSVarint(),g+=e.readSVarint(),p<b&&(b=p),p>T&&(T=p),g<z&&(z=g),g>I&&(I=g);else if(o!==7)throw new Error(`unknown command ${o}`)}return[b,z,T,I]}toGeoJSON(e,n,o){const h=this.extent*Math.pow(2,o),p=this.extent*e,g=this.extent*n,b=this.loadGeometry();function T(B){return[360*(B.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+g)/h)*Math.PI))-90]}function z(B){return B.map(T)}let I;if(this.type===1){const B=[];for(const G of b)B.push(G[0]);const F=z(B);I=B.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const B=b.map(z);I=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=Ng(b),F=[];for(const G of B)F.push(G.map(z));I=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const N={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(N.id=this.id),N}}function l_(i,e,n){i===1?e.id=n.readVarint():i===2?(function(o,h){const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=h._keys[o.readVarint()],b=h._values[o.readVarint()];h.properties[g]=b}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function Ng(i){const e=i.length;if(e<=1)return[i];const n=[];let o,h;for(let p=0;p<e;p++){const g=yi(i[p]);g!==0&&(h===void 0&&(h=g<0),h===g<0?(o&&n.push(o),o=[i[p]]):o&&o.push(i[p]))}return o&&n.push(o),n}function yi(i){let e=0;for(let n,o,h=0,p=i.length,g=p-1;h<p;g=h++)n=i[h],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}Dh.types=["Unknown","Point","LineString","Polygon"];class Ri{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Gn,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Dh(this._pbf,n,this.extent,this._keys,this._values)}}function Gn(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(o){let h=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=o.readVarint()>>3;h=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(n))}class $n{constructor(e,n){this.layers=e.readFields(wi,{},n)}}function wi(i,e,n){if(i===3){const o=new Ri(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}const Na=Math.pow(2,13);function ro(i,e,n,o,h,p,g,b){i.emplaceBack(e,n,2*Math.floor(o*Na)+g,h*Na*2,p*Na*2,Math.round(b))}class Tc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new pe,this.centroidVertexArray=new se,this.indexArray=new tt,this.programConfigurations=new Jo(e.layers,e.zoom),this.segments=new Ft,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.features=[],this.hasDependencies=Cs("fill-extrusion",this.layers,n);for(const{feature:h,id:p,index:g,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,z=Ms(h,T);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),z,o))continue;const I={id:p,sourceLayerIndex:b,index:g,geometry:T?z.geometry:Eo(h),properties:h.properties,type:h.type,patterns:{}};this.hasDependencies?this.features.push(tp("fill-extrusion",this.layers,I,{zoom:this.zoom},n)):this.addFeature(I,I.geometry,g,o,{},n.subdivisionGranularity),n.featureIndex.insert(h,I.geometry,g,b,this.index,!0)}}addFeatures(e,n,o){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,n,o,e.subdivisionGranularity)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Lg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,h,p,g){for(const b of au(n,500)){const T={x:0,y:0,sampleCount:0},z=this.layoutVertexArray.length;this.processPolygon(T,h,e,b,g);const I=this.layoutVertexArray.length-z,N=Math.floor(T.x/T.sampleCount),B=Math.floor(T.y/T.sampleCount);for(let F=0;F<I;F++)this.centroidVertexArray.emplaceBack(N,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:h})}processPolygon(e,n,o,h,p){if(h.length<1||or(h[0]))return;for(const N of h)N.length!==0&&_m(e,N);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=p.fill.getGranularityForZoomLevel(n.z),T=Dh.types[o.type]==="Polygon";for(const N of h){if(N.length===0||or(N))continue;const B=Fl(N,b,T);this._generateSideFaces(B,g)}if(!T)return;const z=ap(h,n,b,!1),I=this.layoutVertexArray;ym(((N,B)=>{ro(I,N,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles)}_generateSideFaces(e,n){let o=0;for(let h=1;h<e.length;h++){const p=e[h],g=e[h-1];if(Ul(p,g))continue;n.segment.vertexLength+4>Ft.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const b=p.sub(g)._perp()._unit(),T=g.dist(p);o+T>32768&&(o=0),ro(this.layoutVertexArray,p.x,p.y,b.x,b.y,0,0,o),ro(this.layoutVertexArray,p.x,p.y,b.x,b.y,0,1,o),o+=T,ro(this.layoutVertexArray,g.x,g.y,b.x,b.y,0,0,o),ro(this.layoutVertexArray,g.x,g.y,b.x,b.y,0,1,o);const z=n.segment.vertexLength;this.indexArray.emplaceBack(z,z+2,z+1),this.indexArray.emplaceBack(z+1,z+2,z+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function _m(i,e){for(let n=0;n<e.length;n++){const o=e[n];n===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(i.x+=o.x,i.y+=o.y,i.sampleCount++)}}function Ul(i,e){return i.x===e.x&&(i.x<0||i.x>Fe)||i.y===e.y&&(i.y<0||i.y>Fe)}function or(i){return i.every((e=>e.x<0))||i.every((e=>e.x>Fe))||i.every((e=>e.y<0))||i.every((e=>e.y>Fe))}let Vl;Zt("FillExtrusionBucket",Tc,{omit:["layers","features"]});var Lu={get paint(){return Vl=Vl||new er({"fill-extrusion-opacity":new Yt(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new nn(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Yt(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Yt(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ja(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new nn(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new nn(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Yt(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class xm extends ji{constructor(e,n){super(e,Lu,n)}createBucket(e){return new Tc(e)}queryRadius(){return Md(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:h,transform:p,pixelsToTileUnits:g,pixelPosMatrix:b}){const T=Zf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,g),z=this.paint.get("fill-extrusion-height").evaluate(n,o),I=this.paint.get("fill-extrusion-base").evaluate(n,o),N=(function(F,G){const H=[];for(const X of F){const J=[X.x,X.y,0,1];Ye(J,J,G),H.push(new O(J[0]/J[3],J[1]/J[3]))}return H})(T,b),B=(function(F,G,H,X){const J=[],ge=[],ee=X[8]*G,ae=X[9]*G,xe=X[10]*G,Ee=X[11]*G,We=X[8]*H,yt=X[9]*H,ht=X[10]*H,Tt=X[11]*H;for(const Ut of F){const Ct=[],mt=[];for(const st of Ut){const Kt=st.x,Xt=st.y,Qt=X[0]*Kt+X[4]*Xt+X[12],Ht=X[1]*Kt+X[5]*Xt+X[13],on=X[2]*Kt+X[6]*Xt+X[14],Qn=X[3]*Kt+X[7]*Xt+X[15],jn=on+xe,Xi=Qn+Ee,ma=Qt+We,Rr=Ht+yt,Yi=on+ht,Bi=Qn+Tt,di=new O((Qt+ee)/Xi,(Ht+ae)/Xi);di.z=jn/Xi,Ct.push(di);const lr=new O(ma/Bi,Rr/Bi);lr.z=Yi/Bi,mt.push(lr)}J.push(Ct),ge.push(mt)}return[J,ge]})(h,I,z,b);return(function(F,G,H){let X=1/0;$f(H,G)&&(X=Nu(H,G[0]));for(let J=0;J<G.length;J++){const ge=G[J],ee=F[J];for(let ae=0;ae<ge.length-1;ae++){const xe=ge[ae],Ee=[xe,ge[ae+1],ee[ae+1],ee[ae],xe];Pu(H,Ee)&&(X=Math.min(X,Nu(H,Ee)))}}return X!==1/0&&X})(B[0],B[1],N)}}function ta(i,e){return i.x*e.x+i.y*e.y}function Nu(i,e){if(i.length===1){let n=0;const o=e[n++];let h;for(;!h||o.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const p=e[n],g=i[0],b=h.sub(o),T=p.sub(o),z=g.sub(o),I=ta(b,b),N=ta(b,T),B=ta(T,T),F=ta(z,b),G=ta(z,T),H=I*B-N*N,X=(B*F-N*G)/H,J=(I*G-N*F)/H,ge=o.z*(1-X-J)+h.z*X+p.z*J;if(isFinite(ge))return ge}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const Fd=Di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:as}=Fd,vm=Di([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:op}=vm,jg=Math.cos(Math.PI/180*37.5),Ud=Math.pow(2,14)/.5;class Ih{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Te,this.layoutVertexArray2=new fe,this.indexArray=new tt,this.programConfigurations=new Jo(e.layers,e.zoom),this.segments=new Ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=Cs("line",this.layers,n)||this.hasLineDasharray(this.layers);const h=this.layers[0].layout.get("line-sort-key"),p=!h.isConstant(),g=[];for(const{feature:b,id:T,index:z,sourceLayerIndex:I}of e){const N=this.layers[0]._featureFilter.needGeometry,B=Ms(b,N);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),B,o))continue;const F=p?h.evaluate(B,{},o):void 0,G={id:T,properties:b.properties,type:b.type,sourceLayerIndex:I,index:z,geometry:N?B.geometry:Eo(b),patterns:{},dashes:{},sortKey:F};g.push(G)}p&&g.sort(((b,T)=>b.sortKey-T.sortKey));for(const b of g){const{geometry:T,index:z,sourceLayerIndex:I}=b;this.hasDependencies?(Cs("line",this.layers,n)?tp("line",this.layers,b,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,b,this.zoom,n),this.patternFeatures.push(b)):this.addFeature(b,T,z,o,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[z].feature,T,z,I,this.index)}}update(e,n,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o,dashPositions:h})}addFeatures(e,n,o,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,op)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,as),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,h,p,g,b){const T=this.layers[0].layout,z=T.get("line-join").evaluate(e,{}),I=T.get("line-cap"),N=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of n)this.addLine(F,e,z,I,N,B,h,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,dashPositions:g,canonical:h})}addLine(e,n,o,h,p,g,b,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Fl(e,b?T.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=Dh.types[n.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let N=0;for(;N<I-1&&e[N].equals(e[N+1]);)N++;if(I<(z?3:2))return;o==="bevel"&&(p=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let G,H,X,J,ge;this.e1=this.e2=-1,z&&(G=e[I-2],ge=e[N].sub(G)._unit()._perp());for(let ee=N;ee<I;ee++){if(X=ee===I-1?z?e[N+1]:void 0:e[ee+1],X&&e[ee].equals(X))continue;ge&&(J=ge),G&&(H=G),G=e[ee],ge=X?X.sub(G)._unit()._perp():J,J=J||ge;let ae=J.add(ge);ae.x===0&&ae.y===0||ae._unit();const xe=J.x*ge.x+J.y*ge.y,Ee=ae.x*ge.x+ae.y*ge.y,We=Ee!==0?1/Ee:1/0,yt=2*Math.sqrt(2-2*Ee),ht=Ee<jg&&H&&X,Tt=J.x*ge.y-J.y*ge.x>0;if(ht&&ee>N){const mt=G.dist(H);if(mt>2*B){const st=G.sub(G.sub(H)._mult(B/mt)._round());this.updateDistance(H,st),this.addCurrentVertex(st,J,0,0,F),H=st}}const Ut=H&&X;let Ct=Ut?o:z?"butt":h;if(Ut&&Ct==="round"&&(We<g?Ct="miter":We<=2&&(Ct="fakeround")),Ct==="miter"&&We>p&&(Ct="bevel"),Ct==="bevel"&&(We>2&&(Ct="flipbevel"),We<p&&(Ct="miter")),H&&this.updateDistance(H,G),Ct==="miter")ae._mult(We),this.addCurrentVertex(G,ae,0,0,F);else if(Ct==="flipbevel"){if(We>100)ae=ge.mult(-1);else{const mt=We*J.add(ge).mag()/J.sub(ge).mag();ae._perp()._mult(mt*(Tt?-1:1))}this.addCurrentVertex(G,ae,0,0,F),this.addCurrentVertex(G,ae.mult(-1),0,0,F)}else if(Ct==="bevel"||Ct==="fakeround"){const mt=-Math.sqrt(We*We-1),st=Tt?mt:0,Kt=Tt?0:mt;if(H&&this.addCurrentVertex(G,J,st,Kt,F),Ct==="fakeround"){const Xt=Math.round(180*yt/Math.PI/20);for(let Qt=1;Qt<Xt;Qt++){let Ht=Qt/Xt;if(Ht!==.5){const Qn=Ht-.5;Ht+=Ht*Qn*(Ht-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*Qn*Qn+(.848013+xe*(.215638*xe-1.06021)))}const on=ge.sub(J)._mult(Ht)._add(J)._unit()._mult(Tt?-1:1);this.addHalfVertex(G,on.x,on.y,!1,Tt,0,F)}}X&&this.addCurrentVertex(G,ge,-st,-Kt,F)}else if(Ct==="butt")this.addCurrentVertex(G,ae,0,0,F);else if(Ct==="square"){const mt=H?1:-1;this.addCurrentVertex(G,ae,mt,mt,F)}else Ct==="round"&&(H&&(this.addCurrentVertex(G,J,0,0,F),this.addCurrentVertex(G,J,1,1,F,!0)),X&&(this.addCurrentVertex(G,ge,-1,-1,F,!0),this.addCurrentVertex(G,ge,0,0,F)));if(ht&&ee<I-1){const mt=G.dist(X);if(mt>2*B){const st=G.add(X.sub(G)._mult(B/mt)._round());this.updateDistance(G,st),this.addCurrentVertex(st,ge,0,0,F),G=st}}}}addCurrentVertex(e,n,o,h,p,g=!1){const b=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,p),this.addHalfVertex(e,b,T,g,!0,-h,p),this.distance>Ud/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,h,p,g))}addHalfVertex({x:e,y:n},o,h,p,g,b,T){const z=.5*(this.lineClips?this.scaledDistance*(Ud-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),T.primitiveLength++),g?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const o=n.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,n,o,h){for(const p of e){const g=p.paint.get("line-dasharray");if(!g||g.value.kind==="constant")continue;const b=p.layout.get("line-cap")==="round",T={dasharray:g.value.evaluate({zoom:o-1},n,{}),round:b},z={dasharray:g.value.evaluate({zoom:o},n,{}),round:b},I={dasharray:g.value.evaluate({zoom:o+1},n,{}),round:b},N=`${T.dasharray.join(",")},${T.round}`,B=`${z.dasharray.join(",")},${z.round}`,F=`${I.dasharray.join(",")},${I.round}`;h.dashDependencies[N]=T,h.dashDependencies[B]=z,h.dashDependencies[F]=I,n.dashes[p.id]={min:N,mid:B,max:F}}}}let ql,Pr;Zt("LineBucket",Ih,{omit:["layers","patternFeatures"]});var Gl={get paint(){return Pr=Pr||new er({"line-opacity":new nn(Ve.paint_line["line-opacity"]),"line-color":new nn(Ve.paint_line["line-color"]),"line-translate":new Yt(Ve.paint_line["line-translate"]),"line-translate-anchor":new Yt(Ve.paint_line["line-translate-anchor"]),"line-width":new nn(Ve.paint_line["line-width"]),"line-gap-width":new nn(Ve.paint_line["line-gap-width"]),"line-offset":new nn(Ve.paint_line["line-offset"]),"line-blur":new nn(Ve.paint_line["line-blur"]),"line-dasharray":new Ja(Ve.paint_line["line-dasharray"]),"line-pattern":new Ja(Ve.paint_line["line-pattern"]),"line-gradient":new Tu(Ve.paint_line["line-gradient"])})},get layout(){return ql=ql||new er({"line-cap":new Yt(Ve.layout_line["line-cap"]),"line-join":new nn(Ve.layout_line["line-join"]),"line-miter-limit":new Yt(Ve.layout_line["line-miter-limit"]),"line-round-limit":new Yt(Ve.layout_line["line-round-limit"]),"line-sort-key":new nn(Ve.layout_line["line-sort-key"])})}};class Rh extends nn{possiblyEvaluate(e,n){return n=new ri(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,h){return n=$t({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,h)}}let ao;class bm extends ji{constructor(e,n){super(e,Gl,n),this.gradientVersion=0,ao||(ao=new Rh(Gl.paint.properties["line-width"].specification),ao.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Bo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=ao.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Ih(e)}queryRadius(e){const n=e,o=lp(Nl("line-width",this,n),Nl("line-gap-width",this,n)),h=Nl("line-offset",this,n);return o/2+Math.abs(h)+Md(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:h,transform:p,pixelsToTileUnits:g}){const b=Zf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,g),T=g/2*lp(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),z=this.paint.get("line-offset").evaluate(n,o);return z&&(h=(function(I,N){const B=[];for(let F=0;F<I.length;F++){const G=Xf(I[F]),H=[];for(let X=0;X<G.length;X++){const J=G[X],ge=G[X-1],ee=G[X+1],ae=X===0?new O(0,0):J.sub(ge)._unit()._perp(),xe=X===G.length-1?new O(0,0):ee.sub(J)._unit()._perp(),Ee=ae._add(xe)._unit(),We=Ee.x*xe.x+Ee.y*xe.y;We!==0&&Ee._mult(1/We),H.push(Ee._mult(N)._add(J))}B.push(H)}return B})(h,z*g)),(function(I,N,B){for(let F=0;F<N.length;F++){const G=N[F];if(I.length>=3){for(let H=0;H<G.length;H++)if(tl(I,G[H]))return!0}if(Ar(I,G,B))return!0}return!1})(b,h,T)}isTileClipped(){return!0}}function lp(i,e){return e>0?e+2*i:i}const Og=Di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vd=Di([{name:"a_projected_pos",components:3,type:"Float32"}],4);Di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wm=Di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Di([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ss=Di([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bg=Di([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function os(i,e,n){return i.sections.forEach((o=>{o.text=(function(h,p,g){const b=p.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),Qa.applyArabicShaping&&(h=Qa.applyArabicShaping(h)),h})(o.text,e,n)})),i}Di([{name:"triangle",components:3,type:"Uint16"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Di([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Di([{type:"Float32",name:"offsetX"}]),Di([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Di([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var vr=24;const Lh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},c_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ec={40:!0};function qd(i,e,n,o,h,p){if("fontStack"in e){const g=n[e.fontStack],b=g&&g[i];return b?b.metrics.advance*e.scale+h:0}{const g=o[e.imageName];return g?g.displaySize[0]*e.scale*vr/p+h:0}}function cp(i,e,n,o){const h=Math.pow(i-e,2);return o?i<e?h/2:2*h:h+Math.abs(n)*n}function Nh(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Sm(i,e,n,o,h,p){let g=null,b=cp(e,n,h,p);for(const T of o){const z=cp(e-T.x,n,h,p)+T.badness;z<=b&&(g=T,b=z)}return{index:i,x:e,priorBreak:g,badness:b}}function Tm(i){return i?Tm(i.priorBreak).concat(i.index):[]}class ju{constructor(e="",n=[],o=[]){this.text=e,this.sections=n,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,n){const o=new ju;for(let h=0;h<e.sections.length;h++){const p=e.sections[h];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",o={premature:!0,value:void 0};const h=e[Symbol.iterator]();let p=h.next();const g=e[Symbol.iterator]();g.next();let b=g.next();for(;!p.done;)n+=!b.done&&Js(b.value.codePointAt(0))&&!Lh[b.value]||!o.premature&&Js(o.value.codePointAt(0))&&!Lh[o.value]||!Lh[p.value]?p.value:Lh[p.value],o={value:p.value,premature:!1},p=h.next(),b=g.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,o=this.text.match(/\S\s*$/),h=o?o[0].length-1:0;this.text=this.text.substring(n,this.text.length-h),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-h)}substring(e,n){const o=[...this.text].slice(e,n).join(""),h=this.sectionIndex.slice(e,n);return new ju(o,this.sections,h)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,o=0;for(let h=0;h<this.length();h++){const p=this.getSection(h);if("imageName"in p){const g=e[p.imageName];if(!g)continue;const b=g.displaySize;n=Math.max(n,b[0]),o=Math.max(o,b[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void xt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,o,h,p){const g=[],b=this.determineAverageLineWidth(e,n,o,h,p),T=this.hasZeroWidthSpaces();let z=0,I=0;const N=this.text[Symbol.iterator]();let B=N.next();const F=this.text[Symbol.iterator]();F.next();let G=F.next();const H=this.text[Symbol.iterator]();H.next(),H.next();let X=H.next();for(;!B.done;){const J=this.getSection(I),ge=B.value.codePointAt(0);if(xu(ge)||(z+=qd(ge,J,o,h,e,p)),!G.done){const ee=Ks(ge),ae=G.value.codePointAt(0);(c_[ge]||ee||"imageName"in J||!X.done&&Ec[ae])&&g.push(Sm(I+1,z,b,g,Nh(ge,ae,ee&&T),!1))}I++,B=N.next(),G=F.next(),X=H.next()}return Tm(Sm(this.length(),z,b,g,0,!0))}determineAverageLineWidth(e,n,o,h,p){let g=0,b=0;for(const T of this.text){const z=this.getSection(b);g+=qd(T.codePointAt(0),z,o,h,e,p),b++}return g/Math.max(1,Math.ceil(g/n))}}const up=4294967296,Gd=1/up,hp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class dp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,o=this.length){for(;this.pos<o;){const h=this.readVarint(),p=h>>3,g=this.pos;this.type=7&h,e(p,n,this),this.pos===g&&this.skip(h)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*up;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*up;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let o,h;return h=n[this.pos++],o=127&h,h<128?o:(h=n[this.pos++],o|=(127&h)<<7,h<128?o:(h=n[this.pos++],o|=(127&h)<<14,h<128?o:(h=n[this.pos++],o|=(127&h)<<21,h<128?o:(h=n[this.pos],o|=(15&h)<<28,(function(p,g,b){const T=b.buf;let z,I;if(I=T[b.pos++],z=(112&I)>>4,I<128||(I=T[b.pos++],z|=(127&I)<<3,I<128)||(I=T[b.pos++],z|=(127&I)<<10,I<128)||(I=T[b.pos++],z|=(127&I)<<17,I<128)||(I=T[b.pos++],z|=(127&I)<<24,I<128)||(I=T[b.pos++],z|=(1&I)<<31,I<128))return jh(p,z,g);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&hp?hp.decode(this.buf.subarray(n,e)):(function(o,h,p){let g="",b=h;for(;b<p;){const T=o[b];let z,I,N,B=null,F=T>239?4:T>223?3:T>191?2:1;if(b+F>p)break;F===1?T<128&&(B=T):F===2?(z=o[b+1],(192&z)==128&&(B=(31&T)<<6|63&z,B<=127&&(B=null))):F===3?(z=o[b+1],I=o[b+2],(192&z)==128&&(192&I)==128&&(B=(15&T)<<12|(63&z)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(z=o[b+1],I=o[b+2],N=o[b+3],(192&z)==128&&(192&I)==128&&(192&N)==128&&(B=(15&T)<<18|(63&z)<<12|(63&I)<<6|63&N,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),b+=F}return g})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Gd),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Gd),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,o){let h,p;if(n>=0?(h=n%4294967296|0,p=n/4294967296|0):(h=~(-n%4294967296),p=~(-n/4294967296),4294967295^h?h=h+1|0:(h=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(g,b,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)})(h,0,o),(function(g,b){const T=(7&g)<<4;b.buf[b.pos++]|=T|((g>>>=3)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g|((g>>>=7)?128:0),g&&(b.buf[b.pos++]=127&g)))))})(p,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(h,p,g){for(let b,T,z=0;z<p.length;z++){if(b=p.charCodeAt(z),b>55295&&b<57344){if(!T){b>56319||z+1===p.length?(h[g++]=239,h[g++]=191,h[g++]=189):T=b;continue}if(b<56320){h[g++]=239,h[g++]=191,h[g++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(h[g++]=239,h[g++]=191,h[g++]=189,T=null);b<128?h[g++]=b:(b<2048?h[g++]=b>>6|192:(b<65536?h[g++]=b>>12|224:(h[g++]=b>>18|240,h[g++]=b>>12&63|128),h[g++]=b>>6&63|128),h[g++]=63&b|128)}return g})(this.buf,e,this.pos);const o=this.pos-n;o>=128&&Fg(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,n){this.pos++;const o=this.pos;e(n,this);const h=this.pos-o;h>=128&&Fg(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h}writeMessage(e,n,o){this.writeTag(e,2),this.writeRawMessage(n,o)}writePackedVarint(e,n){n.length&&this.writeMessage(e,Ug,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,Vg,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,qg,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,Oh,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,fp,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,Gg,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,$g,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,Hg,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,Zg,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function jh(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Fg(i,e,n){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(let h=n.pos-1;h>=i;h--)n.buf[h+o]=n.buf[h]}function Ug(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function Vg(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function Oh(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function fp(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function qg(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function Gg(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function $g(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Hg(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function Zg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Xg(i,e,n){i===1&&n.readMessage(pp,e)}function pp(i,e,n){if(i===3){const{id:o,bitmap:h,width:p,height:g,left:b,top:T,advance:z}=n.readMessage(Yg,{});e.push({id:o,bitmap:new zd({width:p+6,height:g+6},h),metrics:{width:p,height:g,left:b,top:T,advance:z}})}}function Yg(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function Em(i){let e=0,n=0;for(const g of i)e+=g.w*g.h,n=Math.max(n,g.w);i.sort(((g,b)=>b.h-g.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,p=0;for(const g of i)for(let b=o.length-1;b>=0;b--){const T=o[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===T.w&&g.h===T.h){const z=o.pop();z&&b<o.length&&(o[b]=z)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(o.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}class _i{constructor(e,{pixelRatio:n,version:o,stretchX:h,stretchY:p,content:g,textFitWidth:b,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=p,this.content=g,this.version=o,this.textFitWidth=b,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class mp{constructor(e,n){const o={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,p),this.addImages(n,h,p);const{w:g,h:b}=Em(p),T=new ha({width:g||1,height:b||1});for(const z in e){const I=e[z],N=o[z].paddedRect;ha.copy(I.data,T,{x:0,y:0},{x:N.x+1,y:N.y+1},I.data)}for(const z in n){const I=n[z],N=h[z].paddedRect,B=N.x+1,F=N.y+1,G=I.data.width,H=I.data.height;ha.copy(I.data,T,{x:0,y:0},{x:B,y:F},I.data),ha.copy(I.data,T,{x:0,y:H-1},{x:B,y:F-1},{width:G,height:1}),ha.copy(I.data,T,{x:0,y:0},{x:B,y:F+H},{width:G,height:1}),ha.copy(I.data,T,{x:G-1,y:0},{x:B-1,y:F},{width:1,height:H}),ha.copy(I.data,T,{x:0,y:0},{x:B+G,y:F},{width:1,height:H})}this.image=T,this.iconPositions=o,this.patternPositions=h}addImages(e,n,o){for(const h in e){const p=e[h],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(g),n[h]=new _i(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,p]=e.tl;o.update(n.data,void 0,{x:h,y:p})}}var Mc;function $d(i,e,n,o,h,p,g,b,T,z,I,N,B,F,G){const H=ju.fromFeature(i,h);let X;N===E.az.vertical&&H.verticalizePunctuation();let J=H.determineLineBreaks(z,p,e,o,F);const{processBidirectionalText:ge,processStyledBidirectionalText:ee}=Qa;if(ge&&H.sections.length===1){X=[],J=J.map((We=>H.toCodeUnitIndex(We)));const Ee=ge(H.toString(),J);for(const We of Ee){const yt=[...We].map((()=>0));X.push(new ju(We,H.sections,yt))}}else if(ee){X=[],J=J.map((ht=>H.toCodeUnitIndex(ht)));let Ee=0;const We=[];for(const ht of H.text)We.push(...Array(ht.length).fill(H.sectionIndex[Ee])),Ee++;const yt=ee(H.text,We,J);for(const ht of yt){const Tt=[];let Ut="";for(const Ct of ht[0])Tt.push(ht[1][Ut.length]),Ut+=Ct;X.push(new ju(ht[0],H.sections,Tt))}}else X=(function(Ee,We){const yt=[];let ht=0;for(const Tt of We)yt.push(Ee.substring(ht,Tt)),ht=Tt;return ht<Ee.length()&&yt.push(Ee.substring(ht,Ee.length())),yt})(H,J);const ae=[],xe={positionedLines:ae,text:H.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:N,iconsInText:!1,verticalizable:!1};return(function(Ee,We,yt,ht,Tt,Ut,Ct,mt,st,Kt,Xt,Qt){let Ht=0,on=0,Qn=0,jn=0;const Xi=mt==="right"?1:mt==="left"?0:.5,ma=vr/Qt;let Rr=0;for(const di of Tt){di.trim();const lr=di.getMaxScale(),mr={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[Rr]=mr;const Li=mr.positionedGlyphs;let ks=0;if(!di.length()){on+=Ut,++Rr;continue}const ga=u_(ht,di,ma);let Ps=0;for(const $r of di.text){const nr=di.getSection(Ps),Lr=$r.codePointAt(0),cr=gp(st,Xt,Lr),Hr={glyph:Lr,imageName:null,x:Ht,y:on+-17,vertical:cr,scale:1,fontStack:"",sectionIndex:di.getSectionIndex(Ps),metrics:null,rect:null};let Uu;if("fontStack"in nr){if(Uu=Bh(nr,Lr,cr,ga,We,yt),!Uu)continue;Hr.fontStack=nr.fontStack}else{if(Ee.iconsInText=!0,nr.scale*=ma,Uu=Cm(nr,cr,lr,ga,ht),!Uu)continue;ks=Math.max(ks,Uu.imageOffset),Hr.imageName=nr.imageName}const{rect:Kl,metrics:og,baselineOffset:Yh}=Uu;Hr.y+=Yh,Hr.scale=nr.scale,Hr.metrics=og,Hr.rect=Kl,Li.push(Hr),cr?(Ee.verticalizable=!0,Ht+=("imageName"in nr?og.advance:vr)*nr.scale+Kt):Ht+=og.advance*nr.scale+Kt,Ps++}Li.length!==0&&(Qn=Math.max(Ht-Kt,Qn),yp(Li,0,Li.length-1,Xi)),Ht=0,mr.lineOffset=Math.max(ks,(lr-1)*vr);const ol=Ut*lr+ks;on+=ol,jn=Math.max(ol,jn),++Rr}const{horizontalAlign:Yi,verticalAlign:Bi}=Mm(Ct);(function(di,lr,mr,Li,ks,ga,Ps,ol,$r){const nr=(lr-mr)*ks;let Lr=0;Lr=ga!==Ps?-ol*Li- -17:-Li*$r*Ps+.5*Ps;for(const cr of di)for(const Hr of cr.positionedGlyphs)Hr.x+=nr,Hr.y+=Lr})(Ee.positionedLines,Xi,Yi,Bi,Qn,jn,Ut,on,Tt.length),Ee.top+=-Bi*on,Ee.bottom=Ee.top+on,Ee.left+=-Yi*Qn,Ee.right=Ee.left+Qn})(xe,e,n,o,X,g,b,T,N,z,B,G),!(function(Ee){for(const We of Ee)if(We.positionedGlyphs.length!==0)return!1;return!0})(ae)&&xe}function Mm(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function u_(i,e,n){const o=e.getMaxScale()*vr,{maxImageWidth:h,maxImageHeight:p}=e.getMaxImageSize(i),g=Math.max(o,p*n);return{verticalLineContentWidth:Math.max(o,h*n),horizontalLineContentHeight:g}}function Kg(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function gp(i,e,n){return!(i===E.az.horizontal||!e&&!Al(n)||e&&(xu(n)||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Bh(i,e,n,o,h,p){const g=p[i.fontStack],b=(function(z,I,N,B){if(z&&z.rect)return z;const F=I[N.fontStack],G=F&&F[B];return G?{rect:null,metrics:G.metrics}:null})(g&&g[e],h,i,e);if(b===null)return null;let T;if(n)T=o.verticalLineContentWidth-i.scale*vr;else{const z=Kg(i.verticalAlign);T=(o.horizontalLineContentHeight-i.scale*vr)*z}return{rect:b.rect,metrics:b.metrics,baselineOffset:T}}function Cm(i,e,n,o,h){const p=h[i.imageName];if(!p)return null;const g=p.paddedRect,b=p.displaySize,T={width:b[0],height:b[1],left:1,top:-3,advance:e?b[1]:b[0]};let z;if(e)z=o.verticalLineContentWidth-b[1]*i.scale;else{const I=Kg(i.verticalAlign);z=(o.horizontalLineContentHeight-b[1]*i.scale)*I}return{rect:g,metrics:T,baselineOffset:z,imageOffset:(e?b[0]:b[1])*i.scale-vr*n}}function yp(i,e,n,o){if(o===0)return;const h=i[n],p=(i[n].x+h.metrics.advance*h.scale)*o;for(let g=e;g<=n;g++)i[g].x-=p}function Am(i,e,n){const{horizontalAlign:o,verticalAlign:h}=Mm(n),p=e[0]-i.displaySize[0]*o,g=e[1]-i.displaySize[1]*h;return{image:i,top:g,bottom:g+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function $l(i){var e,n;let o=i.left,h=i.top,p=i.right-o,g=i.bottom-h;const b=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",z=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(T==="proportional"){if(b==="stretchOnly"&&p/g<z||b==="proportional"){const I=Math.ceil(g*z);o*=I/p,p=I}}else if(b==="proportional"&&T==="stretchOnly"&&z!==0&&p/g>z){const I=Math.ceil(p/z);h*=I/g,g=I}return{x1:o,y1:h,x2:o+p,y2:h+g}}function Ao(i,e,n,o,h,p){const g=i.image;let b;if(g.content){const X=g.content,J=g.pixelRatio||1;b=[X[0]/J,X[1]/J,g.displaySize[0]-X[2]/J,g.displaySize[1]-X[3]/J]}const T=e.left*p,z=e.right*p;let I,N,B,F;n==="width"||n==="both"?(F=h[0]+T-o[3],N=h[0]+z+o[1]):(F=h[0]+(T+z-g.displaySize[0])/2,N=F+g.displaySize[0]);const G=e.top*p,H=e.bottom*p;return n==="height"||n==="both"?(I=h[1]+G-o[0],B=h[1]+H+o[2]):(I=h[1]+(G+H-g.displaySize[1])/2,B=I+g.displaySize[1]),{image:g,top:I,right:N,bottom:B,left:F,collisionPadding:b}}Zt("ImagePosition",_i),Zt("ImageAtlas",mp),E.az=void 0,(Mc=E.az||(E.az={}))[Mc.none=0]="none",Mc[Mc.horizontal=1]="horizontal",Mc[Mc.vertical=2]="vertical",Mc[Mc.horizontalOnly=3]="horizontalOnly";const As=128,Cc=32640;function zm(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ri(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=n;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let g=p;for(;g<o.length&&o[g]<i+1;)g++;g=Math.min(o.length-1,g);const b=o[p],T=o[g];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:b,maxZoom:T,minSize:n.evaluate(new ri(b)),maxSize:n.evaluate(new ri(T)),interpolationType:h}}}function _p(i,e,n){let o="never";const h=i.get(e);return h?o=h:i.get(n)&&(o="always"),o}const Wg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hd(i,e,n,o,h,p,g,b,T,z,I,N,B){const F=b?Math.min(Cc,Math.round(b[0])):0,G=b?Math.min(Cc,Math.round(b[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*h),p,g,(F<<1)+(T?1:0),G,16*z,16*I,256*N,256*B)}function km(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Pm(i){for(const e of i.sections)if(xo(e.text))return!0;return!1}class xp{constructor(e){this.layoutVertexArray=new _e,this.indexArray=new tt,this.programConfigurations=e,this.segments=new Ft,this.dynamicLayoutVertexArray=new Re,this.opacityVertexArray=new rt,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Og.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Vd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Wg,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",xp);class vp{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Ft,this.collisionVertexArray=new et}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,wm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",vp);class Fh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zm(this.zoom,n["text-size"]),this.iconSizeData=zm(this.zoom,n["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=_p(o,"text-overlap","text-allow-overlap")!=="never"||_p(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((g=>E.az[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID}createArrays(){this.text=new xp(new Jo(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new xp(new Jo(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new L,this.lineVertexArray=new j,this.symbolInstances=new P,this.textAnchorOffsets=new U}calculateGlyphDependencies(e,n,o,h,p){for(const g of e)if(n[g.codePointAt(0)]=!0,(o||h)&&p){const b=Lh[g];b&&(n[b.codePointAt(0)]=!0)}}populate(e,n,o){const h=this.layers[0],p=h.layout,g=p.get("text-font"),b=p.get("text-field"),T=p.get("icon-image"),z=(b.value.kind!=="constant"||b.value.value instanceof gr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,N=p.get("symbol-sort-key");if(this.features=[],!z&&!I)return;const B=n.iconDependencies,F=n.glyphDependencies,G=n.availableImages,H=new ri(this.zoom);for(const{feature:X,id:J,index:ge,sourceLayerIndex:ee}of e){const ae=h._featureFilter.needGeometry,xe=Ms(X,ae);if(!h._featureFilter.filter(H,xe,o))continue;let Ee,We;if(ae||(xe.geometry=Eo(X)),z){const ht=h.getValueAndResolveTokens("text-field",xe,o,G),Tt=gr.factory(ht),Ut=this.hasRTLText=this.hasRTLText||Pm(Tt);(!Ut||Qa.getRTLTextPluginStatus()==="unavailable"||Ut&&Qa.isParsed())&&(Ee=os(Tt,h,xe))}if(I){const ht=h.getValueAndResolveTokens("icon-image",xe,o,G);We=ht instanceof Yr?ht:Yr.fromString(ht)}if(!Ee&&!We)continue;const yt=this.sortFeaturesByKey?N.evaluate(xe,{},o):void 0;if(this.features.push({id:J,text:Ee,icon:We,index:ge,sourceLayerIndex:ee,geometry:xe.geometry,properties:X.properties,type:Dh.types[X.type],sortKey:yt}),We&&(B[We.name]=!0),Ee){const ht=g.evaluate(xe,{},o).join(","),Tt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(E.az.vertical)>=0;for(const Ut of Ee.sections)if(Ut.image)B[Ut.image.name]=!0;else{const Ct=Ws(Ee.toString()),mt=Ut.fontStack||ht,st=F[mt]=F[mt]||{};this.calculateGlyphDependencies(Ut.text,st,Tt,this.allowVerticalPlacement,Ct)}}}p.get("symbol-placement")==="line"&&(this.features=(function(X){const J={},ge={},ee=[];let ae=0;function xe(ht){ee.push(X[ht]),ae++}function Ee(ht,Tt,Ut){const Ct=ge[ht];return delete ge[ht],ge[Tt]=Ct,ee[Ct].geometry[0].pop(),ee[Ct].geometry[0]=ee[Ct].geometry[0].concat(Ut[0]),Ct}function We(ht,Tt,Ut){const Ct=J[Tt];return delete J[Tt],J[ht]=Ct,ee[Ct].geometry[0].shift(),ee[Ct].geometry[0]=Ut[0].concat(ee[Ct].geometry[0]),Ct}function yt(ht,Tt,Ut){const Ct=Ut?Tt[0][Tt[0].length-1]:Tt[0][0];return`${ht}:${Ct.x}:${Ct.y}`}for(let ht=0;ht<X.length;ht++){const Tt=X[ht],Ut=Tt.geometry,Ct=Tt.text?Tt.text.toString():null;if(!Ct){xe(ht);continue}const mt=yt(Ct,Ut),st=yt(Ct,Ut,!0);if(mt in ge&&st in J&&ge[mt]!==J[st]){const Kt=We(mt,st,Ut),Xt=Ee(mt,st,ee[Kt].geometry);delete J[mt],delete ge[st],ge[yt(Ct,ee[Xt].geometry,!0)]=Xt,ee[Kt].geometry=null}else mt in ge?Ee(mt,st,Ut):st in J?We(mt,st,Ut):(xe(ht),J[mt]=ae-1,ge[st]=ae-1)}return ee.filter((ht=>ht.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((X,J)=>X.sortKey-J.sortKey))}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(n[e.segment+1]),p=e.dist(n[e.segment]);const g={};for(let b=e.segment+1;b<n.length;b++)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:h},b<n.length-1&&(h+=n[b+1].dist(n[b]));for(let b=e.segment||0;b>=0;b--)g[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:p},b>0&&(p+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){const T=g[b];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,h,p,g,b,T,z,I,N,B){const F=e.indexArray,G=e.layoutVertexArray,H=e.segments.prepareSegment(4*n.length,G,F,this.canOverlap?g.sortKey:void 0),X=this.glyphOffsetArray.length,J=H.vertexLength,ge=this.allowVerticalPlacement&&b===E.az.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let ae=0;ae<n.length;ae++){const{tl:xe,tr:Ee,bl:We,br:yt,tex:ht,pixelOffsetTL:Tt,pixelOffsetBR:Ut,minFontScaleX:Ct,minFontScaleY:mt,glyphOffset:st,isSDF:Kt,sectionIndex:Xt}=n[ae],Qt=H.vertexLength,Ht=st[1];Hd(G,T.x,T.y,xe.x,Ht+xe.y,ht.x,ht.y,o,Kt,Tt.x,Tt.y,Ct,mt),Hd(G,T.x,T.y,Ee.x,Ht+Ee.y,ht.x+ht.w,ht.y,o,Kt,Ut.x,Tt.y,Ct,mt),Hd(G,T.x,T.y,We.x,Ht+We.y,ht.x,ht.y+ht.h,o,Kt,Tt.x,Ut.y,Ct,mt),Hd(G,T.x,T.y,yt.x,Ht+yt.y,ht.x+ht.w,ht.y+ht.h,o,Kt,Ut.x,Ut.y,Ct,mt),km(e.dynamicLayoutVertexArray,T,ge),F.emplaceBack(Qt,Qt+2,Qt+1),F.emplaceBack(Qt+1,Qt+2,Qt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),ae!==n.length-1&&Xt===n[ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,g,g.index,{imagePositions:{},canonical:B,formattedSection:ee&&ee[Xt]})}e.placedSymbolArray.emplaceBack(T.x,T.y,X,this.glyphOffsetArray.length-X,J,z,I,T.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],b,0,!1,0,N)}_addCollisionDebugVertex(e,n,o,h,p,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,h,p,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,h,p,g,b){const T=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),z=T.vertexLength,I=p.layoutVertexArray,N=p.collisionVertexArray,B=b.anchorX,F=b.anchorY;this._addCollisionDebugVertex(I,N,g,B,F,new O(e,n)),this._addCollisionDebugVertex(I,N,g,B,F,new O(o,n)),this._addCollisionDebugVertex(I,N,g,B,F,new O(o,h)),this._addCollisionDebugVertex(I,N,g,B,F,new O(e,h)),T.vertexLength+=4;const G=p.indexArray;G.emplaceBack(z,z+1),G.emplaceBack(z+1,z+2),G.emplaceBack(z+2,z+3),G.emplaceBack(z+3,z),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,h){for(let p=e;p<n;p++){const g=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,h?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(Ke,ss.members,Lt),this.iconCollisionBox=new vp(Ke,ss.members,Lt);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,h,p,g,b,T,z){const I={};for(let N=n;N<o;N++){const B=e.get(N);I.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.textFeatureIndex=B.featureIndex;break}for(let N=h;N<p;N++){const B=e.get(N);I.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalTextFeatureIndex=B.featureIndex;break}for(let N=g;N<b;N++){const B=e.get(N);I.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.iconFeatureIndex=B.featureIndex;break}for(let N=T;N<z;N++){const B=e.get(N);I.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalIconFeatureIndex=B.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),h=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),h=[],p=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const T=this.symbolInstances.get(b);h.push(0|Math.round(n*T.anchorX+o*T.anchorY)),p.push(T.featureIndex)}return g.sort(((b,T)=>h[b]-h[T]||p[T]-p[b])),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((h,p,g)=>{h>=0&&g.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let bp,wp;Zt("SymbolBucket",Fh,{omit:["layers","collisionBoxArray","features","compareText"]}),Fh.MAX_GLYPHS=65535,Fh.addDynamicAttributes=km;var Dm={get paint(){return wp=wp||new er({"icon-opacity":new nn(Ve.paint_symbol["icon-opacity"]),"icon-color":new nn(Ve.paint_symbol["icon-color"]),"icon-halo-color":new nn(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new nn(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new nn(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Yt(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Yt(Ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new nn(Ve.paint_symbol["text-opacity"]),"text-color":new nn(Ve.paint_symbol["text-color"],{runtimeType:Zr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new nn(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new nn(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new nn(Ve.paint_symbol["text-halo-blur"]),"text-translate":new Yt(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new Yt(Ve.paint_symbol["text-translate-anchor"])})},get layout(){return bp=bp||new er({"symbol-placement":new Yt(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Yt(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Yt(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new nn(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Yt(Ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Yt(Ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Yt(Ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Yt(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Yt(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Yt(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new nn(Ve.layout_symbol["icon-size"]),"icon-text-fit":new Yt(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yt(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new nn(Ve.layout_symbol["icon-image"]),"icon-rotate":new nn(Ve.layout_symbol["icon-rotate"]),"icon-padding":new nn(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Yt(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new nn(Ve.layout_symbol["icon-offset"]),"icon-anchor":new nn(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Yt(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Yt(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Yt(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new nn(Ve.layout_symbol["text-field"]),"text-font":new nn(Ve.layout_symbol["text-font"]),"text-size":new nn(Ve.layout_symbol["text-size"]),"text-max-width":new nn(Ve.layout_symbol["text-max-width"]),"text-line-height":new Yt(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new nn(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new nn(Ve.layout_symbol["text-justify"]),"text-radial-offset":new nn(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Yt(Ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new nn(Ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new nn(Ve.layout_symbol["text-anchor"]),"text-max-angle":new Yt(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Yt(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new nn(Ve.layout_symbol["text-rotate"]),"text-padding":new Yt(Ve.layout_symbol["text-padding"]),"text-keep-upright":new Yt(Ve.layout_symbol["text-keep-upright"]),"text-transform":new nn(Ve.layout_symbol["text-transform"]),"text-offset":new nn(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new Yt(Ve.layout_symbol["text-allow-overlap"]),"text-overlap":new Yt(Ve.layout_symbol["text-overlap"]),"text-ignore-placement":new Yt(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new Yt(Ve.layout_symbol["text-optional"])})}};class Qg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Jn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",Qg,{omit:["defaultValue"]});class Ac extends ji{constructor(e,n){super(e,Dm,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const p of o)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,h){const p=this.layout.get(e).evaluate(n,{},o,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Ho(g.value)||!p?p:(function(b,T){return T.replace(/{([^{}]+)}/g,((z,I)=>b&&I in b?String(b[I]):""))})(n.properties,p)}createBucket(e){return new Fh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Dm.paint.overridableProperties){if(!Ac.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Qg(n),h=new ph(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new ea("source",h):new Zo("composite",h,n.value.zoomStops),this.paint._values[e]=new Da(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Ac.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),h=Dm.paint.properties[n];let p=!1;const g=b=>{for(const T of b)if(h.overrides&&h.overrides.hasOverride(T))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof gr)g(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const b=z=>{p||(z instanceof Ta&&ki(z.value)===Fa?g(z.value.sections):z instanceof tu?g(z.sections):z.eachChild(b))},T=o.value;T._styleExpression&&b(T._styleExpression.expression)}return p}}let Jg;var ey={get paint(){return Jg=Jg||new er({"background-color":new Yt(Ve.paint_background["background-color"]),"background-pattern":new _c(Ve.paint_background["background-pattern"]),"background-opacity":new Yt(Ve.paint_background["background-opacity"])})}};class Hn extends ji{constructor(e,n){super(e,ey,n)}}class Im extends ji{constructor(e,n){super(e,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Sp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Rm={once:!0},Tp=63710088e-1;class al{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new al(jt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,h=e.lat*n,p=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Tp*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof al)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new al(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new al(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Uh=2*Math.PI*Tp;function Zd(i){return Uh*Math.cos(i*Math.PI/180)}function ty(i){return(180+i)/360}function Lm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ny(i,e){return i/Zd(e)}function iy(i){return 360*i-180}function Xd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Nm(i,e){return i*Zd(Xd(e))}class ui{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=al.convert(e);return new ui(ty(o.lng),Lm(o.lat),ny(n,o.lat))}toLngLat(){return new al(iy(this.x),Xd(this.y))}toAltitude(){return Nm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Uh*(e=Xd(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ep(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Br{constructor(e,n,o){if(!(function(h,p,g){return!(h<0||h>25||g<0||g>=Math.pow(2,h)||p<0||p>=Math.pow(2,h))})(e,n,o))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Vh(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const h=(function(g,b,T){var z=Ep(256*g,256*(b=Math.pow(2,T)-b-1),T),I=Ep(256*(g+1),256*(b+1),T);return z[0]+","+z[1]+","+I[0]+","+I[1]})(this.x,this.y,this.z),p=(function(g,b,T){let z,I="";for(let N=g;N>0;N--)z=1<<N-1,I+=(b&z?1:0)+(T&z?2:0);return I})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,p).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new O((e.x*n-this.x)*Fe,(e.y*n-this.y)*Fe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ry{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Vh(e,n.z,n.z,n.x,n.y)}}class ls{constructor(e,n,o,h,p){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Br(o,+h,+p),this.key=Vh(n,e,o,h,p)}clone(){return new ls(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new ls(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Vh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Vh(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new ls(n,this.wrap,n,o,h),new ls(n,this.wrap,n,o+1,h),new ls(n,this.wrap,n,o,h+1),new ls(n,this.wrap,n,o+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ls(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ry(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new ui(e.x-this.wrap,e.y))}}function Vh(i,e,n,o,h){(i*=2)<0&&(i=-1*i-1);const p=1<<n;return(p*p*i+p*h+o).toString(36)+n.toString(36)+e.toString(36)}function Yd(i,e){return e?i.properties[e]:i.id}function jm(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const h=i.addOrUpdateProperties.findIndex((p=>p.key===o));h>-1&&i.addOrUpdateProperties.splice(h,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Kd(i){var e,n;if(!i)return{};const o={};return o.removeAll=i.removeAll,o.remove=new Set(i.remove||[]),o.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((h=>[h.id,h]))),o.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((h=>[h.id,h]))),o}Zt("CanonicalTileID",Br),Zt("OverscaledTileID",ls,{omit:["terrainRttPosMatrix32f"]});class zc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new zc;return n.extend(e(new O(this.minX,this.minY))),n.extend(e(new O(this.maxX,this.minY))),n.extend(e(new O(this.minX,this.maxY))),n.extend(e(new O(this.maxX,this.maxY))),n}static fromPoints(e){const n=new zc;for(const o of e)n.extend(o);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Om{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Mp{constructor(e,n,o,h,p){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=h,this._z=n,this.properties=e.properties,this.id=p}projectPoint(e,n,o,h){return[360*(e.x+n)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/h)*Math.PI))-90]}projectLine(e,n,o,h){return e.map((p=>this.projectPoint(p,n,o,h)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),o=e.extent*this._x,h=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const g=[];for(const T of p)g.push(T[0]);const b=this.projectLine(g,o,h,n);this._geometry=g.length===1?{type:"Point",coordinates:b[0]}:{type:"MultiPoint",coordinates:b};break}case 2:{const g=p.map((b=>this.projectLine(b,o,h,n)));this._geometry=g.length===1?{type:"LineString",coordinates:g[0]}:{type:"MultiLineString",coordinates:g};break}case 3:{const g=Ng(p),b=[];for(const T of g)b.push(T.map((z=>this.projectLine(z,o,h,n))));this._geometry=b.length===1?{type:"Polygon",coordinates:b[0]}:{type:"MultiPolygon",coordinates:b};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class kc{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,o){this._name=e,this.dataBuffer=n,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Cp extends kc{}class Ap extends Cp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Bm extends Cp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Fm extends kc{delta;constructor(e,n,o,h){super(e,n,h),this.delta=o}}class Um extends Fm{constructor(e,n,o,h){super(e,Int32Array.of(n),o,h)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Vm extends kc{constructor(e,n,o){super(e,Int32Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Pc{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,o,h,p=4096){this._name=e,this._geometryVector=n,this._idVector=o,this._propertyVectors=h,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const h=e?.next().value,p={};for(const g of this.propertyVectors){if(!g)continue;const b=g.name,T=g.getValue(n);T!==null&&(p[b]=T)}n++,yield{id:o,geometry:h,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const p={coordinates:n[o],type:this.geometryVector.geometryType(o)},g={};for(const b of this.propertyVectors){if(!b)continue;const T=b.name,z=b.getValue(o);z!==null&&(g[T]=z)}e.push({id:h,geometry:p,properties:g})}return e}containsMaxSaveIntegerValues(e){return e instanceof Ap||e instanceof Vm&&e instanceof Um||e instanceof Bm}}class ay{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var In,zo,qr,ko,Dc,da,pr,Dr,zs,ja;function Ir(i,e,n){const o=new Int32Array(n);let h=0,p=e.get();for(let g=0;g<o.length;g++){let b=i[p++],T=127&b;b<128||(b=i[p++],T|=(127&b)<<7,b<128||(b=i[p++],T|=(127&b)<<14,b<128||(b=i[p++],T|=(127&b)<<21,b<128||(b=i[p++],T|=(15&b)<<28)))),o[h++]=T}return e.set(p),o}function Wd(i,e,n){const o=new BigInt64Array(n);for(let h=0;h<o.length;h++)o[h]=zp(i,e);return o}function sy(i,e){let n,o;return o=i[e.get()],e.increment(),n=127&o,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<7,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<14,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<21,o<128?n:(o=i[e.get()],n|=(15&o)<<28,(function(h,p,g){let b,T;if(T=p[g.get()],g.increment(),b=(112&T)>>4,T<128||(T=p[g.get()],g.increment(),b|=(127&T)<<3,T<128)||(T=p[g.get()],g.increment(),b|=(127&T)<<10,T<128)||(T=p[g.get()],g.increment(),b|=(127&T)<<17,T<128)||(T=p[g.get()],g.increment(),b|=(127&T)<<24,T<128)||(T=p[g.get()],g.increment(),b|=(1&T)<<31,T<128))return 4294967296*b+(h>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function qh(i,e,n,o){throw new Error("FastPFor is not implemented yet.")}function Gr(i){return i>>>1^-(1&i)}function Ou(i){return i>>1n^-(1n&i)}function zp(i,e){let n=0n,o=0,h=e.get();for(;h<i.length;){const p=i[h++];if(n|=BigInt(127&p)<<BigInt(o),!(128&p))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(h),n}function sl(i,e,n){const o=new Int32Array(n);let h=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],h,h+g),h+=g}return o}function oy(i,e,n){const o=new BigInt64Array(n);let h=0;for(let p=0;p<e;p++){const g=Number(i[p]);o.fill(i[p+e],h,h+g),h+=g}return o}function ly(i,e,n){const o=new Float64Array(n);let h=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],h,h+g),h+=g}return o}function Ic(i){const e=i.length/4*4;let n=1;if(e>=4)for(let o=i[0];n<e-4;n+=4)o=i[n]+=o,o=i[n+1]+=o,o=i[n+2]+=o,o=i[n+3]+=o;for(;n!=i.length;)i[n]+=i[n-1],++n}function qm(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const o=i[n],h=i[n+1],p=i[n+2],g=i[n+3];i[n]=(o>>>1^-(1&o))+i[n-2],i[n+1]=(h>>>1^-(1&h))+i[n-1],i[n+2]=(p>>>1^-(1&p))+i[n],i[n+3]=(g>>>1^-(1&g))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(In||(In={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(zo||(zo={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(qr||(qr={}));class Gm{_dictionaryType;_offsetType;_lengthType;constructor(e,n,o){this._dictionaryType=e,this._offsetType=n,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function fa(i,e){const n=(function(o,h){const p=o[h.get()],g=Object.values(qr)[p>>4];let b=null;switch(g){case qr.DATA:b=new Gm(Object.values(ko)[15&p]);break;case qr.OFFSET:b=new Gm(null,Object.values(Dc)[15&p]);break;case qr.LENGTH:b=new Gm(null,null,Object.values(da)[15&p])}h.increment();const T=o[h.get()],z=Object.values(In)[T>>5],I=Object.values(In)[T>>2&7],N=Object.values(zo)[3&T];h.increment();const B=Ir(o,h,2),F=B[0];return{physicalStreamType:g,logicalStreamType:b,logicalLevelTechnique1:z,logicalLevelTechnique2:I,physicalLevelTechnique:N,numValues:F,byteLength:B[1],decompressedCount:F}})(i,e);return n.logicalLevelTechnique1===In.MORTON?(function(o,h,p){const g=Ir(h,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:g[0],coordinateShift:g[1]}})(n,i,e):In.RLE!==n.logicalLevelTechnique1&&In.RLE!==n.logicalLevelTechnique2||zo.NONE===n.physicalLevelTechnique?n:(function(o,h,p){const g=Ir(h,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:g[1],runs:g[0],numRleValues:g[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(ko||(ko={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(Dc||(Dc={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(da||(da={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(pr||(pr={}));class Po{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const o=Math.floor(e/8);this.values[o]=this.values[o]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function pa(i,e,n,o,h){return(function(p,g,b){switch(g.logicalLevelTechnique1){case In.DELTA:return g.logicalLevelTechnique2===In.RLE?(function(T,z,I){const N=new Int32Array(I);let B=0,F=0;for(let G=0;G<z;G++){const H=T[G],X=Gr(T[G+z]);for(let J=0;J<H;J++)F+=X,N[B++]=F}return N})(p,g.runs,g.numRleValues):((function(T){T[0]=T[0]>>>1^-(1&T[0]);const z=T.length/4*4;let I=1;if(z>=4)for(;I<z-4;I+=4){const N=T[I],B=T[I+1],F=T[I+2],G=T[I+3];T[I]=(N>>>1^-(1&N))+T[I-1],T[I+1]=(B>>>1^-(1&B))+T[I],T[I+2]=(F>>>1^-(1&F))+T[I+1],T[I+3]=(G>>>1^-(1&G))+T[I+2]}for(;I!=T.length;++I)T[I]=(T[I]>>>1^-(1&T[I]))+T[I-1]})(p),p);case In.RLE:return(function(T,z,I){return I?(function(N,B,F){const G=new Int32Array(F);let H=0;for(let X=0;X<B;X++){const J=N[X];let ge=N[X+B];ge=ge>>>1^-(1&ge),G.fill(ge,H,H+J),H+=J}return G})(T,z.runs,z.numRleValues):sl(T,z.runs,z.numRleValues)})(p,g,b);case In.MORTON:return Ic(p),p;case In.COMPONENTWISE_DELTA:return qm(p),p;case In.NONE:return b&&(function(T){for(let z=0;z<T.length;z++){const I=T[z];T[z]=I>>>1^-(1&I)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${g.logicalLevelTechnique1}`)}})(kp(i,e,n),n,o)}function Rc(i,e,n){return(function(o,h){if(h.logicalLevelTechnique1===In.DELTA&&h.logicalLevelTechnique2===In.NONE)return(function(g){const b=new Int32Array(g.length+1);b[0]=0,b[1]=Gr(g[0]);let T=b[1],z=2;for(;z!=b.length;++z){const I=g[z-1];T+=I>>>1^-(1&I),b[z]=b[z-1]+T}return b})(o);if(h.logicalLevelTechnique1===In.RLE&&h.logicalLevelTechnique2===In.NONE)return(function(g,b,T){const z=new Int32Array(T+1);z[0]=0;let I=1,N=z[0];for(let B=0;B<b;B++){const F=g[B],G=g[B+b];for(let H=I;H<I+F;H++)z[H]=G+N,N=z[H];I+=F}return z})(o,h.runs,h.numRleValues);if(h.logicalLevelTechnique1===In.NONE&&h.logicalLevelTechnique2===In.NONE){(function(g){let b=0;for(let T=0;T<g.length;T++)g[T]+=b,b=g[T]})(o);const p=new Int32Array(h.numValues+1);return p[0]=0,p.set(o,1),p}if(h.logicalLevelTechnique1===In.DELTA&&h.logicalLevelTechnique2===In.RLE){const p=(function(g,b,T){const z=new Int32Array(T+1);z[0]=0;let I=1,N=z[0];for(let B=0;B<b;B++){const F=g[B];let G=g[B+b];G=G>>>1^-(1&G);for(let H=I;H<I+F;H++)z[H]=G+N,N=z[H];I+=F}return z})(o,h.runs,h.numRleValues);return Ic(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(kp(i,e,n),n)}function kp(i,e,n){const o=n.physicalLevelTechnique;if(o===zo.FAST_PFOR)return qh();if(o===zo.VARINT)return Ir(i,e,n.numValues);if(o===zo.NONE){const h=e.get();e.add(n.byteLength);const p=i.subarray(h,e.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function $m(i,e,n,o){const h=kp(i,e,n);if(h.length===1){const p=h[0];return o?Gr(p):p}return o?(function(p){return Gr(p[1])})(h):(function(p){return p[1]})(h)}function Hm(i,e,n){return(function(o){if(o.length==2){const h=Gr(o[1]);return[h,h]}return[Gr(o[2]),Gr(o[3])]})(kp(i,e,n))}function Bu(i,e,n){return(function(o){if(o.length==2){const h=Ou(o[1]);return[h,h]}return[Ou(o[2]),Ou(o[3])]})(Wd(i,e,n.numValues))}function Gh(i,e,n,o){return(function(h,p,g){switch(p.logicalLevelTechnique1){case In.DELTA:return p.logicalLevelTechnique2===In.RLE?(function(b,T,z){const I=new BigInt64Array(z);let N=0,B=0n;for(let F=0;F<T;F++){const G=Number(b[F]),H=Ou(b[F+T]);for(let X=0;X<G;X++)B+=H,I[N++]=B}return I})(h,p.runs,p.numRleValues):((function(b){b[0]=b[0]>>1n^-(1n&b[0]);const T=b.length/4*4;let z=1;if(T>=4)for(;z<T-4;z+=4){const I=b[z],N=b[z+1],B=b[z+2],F=b[z+3];b[z]=(I>>1n^-(1n&I))+b[z-1],b[z+1]=(N>>1n^-(1n&N))+b[z],b[z+2]=(B>>1n^-(1n&B))+b[z+1],b[z+3]=(F>>1n^-(1n&F))+b[z+2]}for(;z!=b.length;++z)b[z]=(b[z]>>1n^-(1n&b[z]))+b[z-1]})(h),h);case In.RLE:return(function(b,T,z){return z?(function(I,N,B){const F=new BigInt64Array(B);let G=0;for(let H=0;H<N;H++){const X=Number(I[H]);let J=I[H+N];J=J>>1n^-(1n&J),F.fill(J,G,G+X),G+=X}return F})(b,T.runs,T.numRleValues):oy(b,T.runs,T.numRleValues)})(h,p,g);case In.NONE:return g&&(function(b){for(let T=0;T<b.length;T++){const z=b[T];b[T]=z>>1n^-(1n&z)}})(h),h;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(Wd(i,e,n.numValues),n,o)}function Zm(i,e,n,o){const h=Wd(i,e,n.numValues);if(h.length===1){const p=h[0];return o?Ou(p):p}return o?(function(p){return Ou(p[1])})(h):(function(p){return p[1]})(h)}function Xm(i,e,n,o,h){return(function(p,g,b,T){switch(g.logicalLevelTechnique1){case In.DELTA:return g.logicalLevelTechnique2===In.RLE&&(p=sl(p,g.runs,g.numRleValues)),(function(z,I){const N=new Int32Array(z.size());let B=0;z.get(0)?(N[0]=z.get(0)?I[0]>>>1^-(1&I[0]):0,B=1):N[0]=0;let F=1;for(;F!=N.length;++F)N[F]=z.get(F)?N[F-1]+(I[B]>>>1^-(1&I[B++])):N[F-1];return N})(T,p);case In.RLE:return(function(z,I,N,B){const F=I;return N?(function(G,H,X){const J=new Int32Array(G.size());let ge=0;for(let ee=0;ee<X;ee++){const ae=H[ee];let xe=H[ee+X];xe=xe>>>1^-(1&xe);for(let Ee=ge;Ee<ge+ae;Ee++)G.get(Ee)?J[Ee]=xe:(J[Ee]=0,ge++);ge+=ae}return J})(B,z,F.runs):(function(G,H,X){const J=new Int32Array(G.size());let ge=0;for(let ee=0;ee<X;ee++){const ae=H[ee],xe=H[ee+X];for(let Ee=ge;Ee<ge+ae;Ee++)G.get(Ee)?J[Ee]=xe:(J[Ee]=0,ge++);ge+=ae}return J})(B,z,F.runs)})(p,g,b,T);case In.MORTON:return Ic(p),p;case In.COMPONENTWISE_DELTA:return qm(p),p;case In.NONE:return p=b?(function(z,I){const N=new Int32Array(z.size());let B=0,F=0;for(;F!=N.length;++F)if(z.get(F)){const G=I[B++];N[F]=G>>>1^-(1&G)}else N[F]=0;return N})(T,p):(function(z,I){const N=new Int32Array(z.size());let B=0,F=0;for(;F!=N.length;++F)N[F]=z.get(F)?I[B++]:0;return N})(T,p),p;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===zo.FAST_PFOR?qh():Ir(i,e,n.numValues),n,o,h)}function Hl(i,e,n,o){const h=i.logicalLevelTechnique1;if(h===In.RLE)return i.runs===1?pr.CONST:pr.FLAT;const p=e instanceof Po?e.size():e;if(h===In.DELTA&&i.logicalLevelTechnique2===In.RLE){const g=i.runs,b=2;if(i.numRleValues!==p)return pr.FLAT;if(g===1)return pr.SEQUENCE;if(g===2){const T=o.get();let z;if(i.physicalLevelTechnique===zo.VARINT)z=Ir(n,o,4);else{const I=o.get();z=new Int32Array(n.buffer,n.byteOffset+I,4)}if(o.set(T),z[2]===b&&z[3]===b)return pr.SEQUENCE}}return i.numValues===1?pr.CONST:pr.FLAT}class $h extends Cp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Ym extends Fm{constructor(e,n,o,h){super(e,BigInt64Array.of(n),o,h)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Zl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,o){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Qd(i,e,n){return{x:Pp(i,e)-n,y:Pp(i>>1,e)-n}}function Pp(i,e){let n=0;for(let o=0;o<e;o++)n|=(i&1<<2*o)>>o;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(Dr||(Dr={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(zs||(zs={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(ja||(ja={}));class Dp{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function Km(i){const e=new Array(i.numGeometries);let n=1,o=1,h=1,p=0;const g=new Dp;let b=0,T=0;const z=i.mortonSettings,I=i.topologyVector,N=I.geometryOffsets,B=I.partOffsets,F=I.ringOffsets,G=i.vertexOffsets,H=i.containsPolygonGeometry(),X=i.vertexBuffer;for(let J=0;J<i.numGeometries;J++){const ge=i.geometryType(J);if(ge===Dr.POINT){if(G&&G.length!==0)if(i.vertexBufferType===ja.VEC_2){const ee=2*G[T++],ae=new O(X[ee],X[ee+1]);e[p++]=g.createPoint(ae)}else{const ee=Qd(X[G[T++]],z.numBits,z.coordinateShift),ae=new O(ee.x,ee.y);e[p++]=g.createPoint(ae)}else{const ee=new O(X[b++],X[b++]);e[p++]=g.createPoint(ee)}N&&h++,B&&n++,F&&o++}else if(ge===Dr.MULTIPOINT){const ee=N[h]-N[h-1];h++;const ae=new Array(ee);if(G&&G.length!==0){for(let xe=0;xe<ee;xe++){const Ee=2*G[T++];ae[xe]=new O(X[Ee],X[Ee+1])}e[p++]=g.createMultiPoint(ae)}else{for(let xe=0;xe<ee;xe++){const Ee=X[b++],We=X[b++];ae[xe]=new O(Ee,We)}e[p++]=g.createMultiPoint(ae)}}else if(ge===Dr.LINESTRING){let ee,ae=0;H?(ae=F[o]-F[o-1],o++):ae=B[n]-B[n-1],n++,G&&G.length!==0?(ee=i.vertexBufferType===ja.VEC_2?tf(X,G,T,ae,!1):Qm(X,G,T,ae,!1,z),T+=ae):(ee=Wm(X,b,ae,!1),b+=2*ae),e[p++]=g.createLineString(ee),N&&h++}else if(ge===Dr.POLYGON){const ee=B[n]-B[n-1];n++;const ae=new Array(ee-1);let xe=F[o]-F[o-1];if(o++,G&&G.length!==0){const Ee=i.vertexBufferType===ja.VEC_2?Ip(X,G,T,xe):ef(X,G,T,xe,0,z);T+=xe;for(let We=0;We<ae.length;We++)xe=F[o]-F[o-1],o++,ae[We]=i.vertexBufferType===ja.VEC_2?Ip(X,G,T,xe):ef(X,G,T,xe,0,z),T+=xe;e[p++]=g.createPolygon(Ee,ae)}else{const Ee=Jd(X,b,xe);b+=2*xe;for(let We=0;We<ae.length;We++)xe=F[o]-F[o-1],o++,ae[We]=Jd(X,b,xe),b+=2*xe;e[p++]=g.createPolygon(Ee,ae)}N&&h++}else if(ge===Dr.MULTILINESTRING){const ee=N[h]-N[h-1];h++;const ae=new Array(ee);if(G&&G.length!==0){for(let xe=0;xe<ee;xe++){let Ee=0;H?(Ee=F[o]-F[o-1],o++):Ee=B[n]-B[n-1],n++;const We=i.vertexBufferType===ja.VEC_2?tf(X,G,T,Ee,!1):Qm(X,G,T,Ee,!1,z);ae[xe]=We,T+=Ee}e[p++]=g.createMultiLineString(ae)}else{for(let xe=0;xe<ee;xe++){let Ee=0;H?(Ee=F[o]-F[o-1],o++):Ee=B[n]-B[n-1],n++,ae[xe]=Wm(X,b,Ee,!1),b+=2*Ee}e[p++]=g.createMultiLineString(ae)}}else{if(ge!==Dr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ee=N[h]-N[h-1];h++;const ae=new Array(ee);let xe=0;if(G&&G.length!==0){for(let Ee=0;Ee<ee;Ee++){const We=B[n]-B[n-1];n++;const yt=new Array(We-1);xe=F[o]-F[o-1],o++;const ht=i.vertexBufferType===ja.VEC_2?Ip(X,G,T,xe):ef(X,G,T,xe,0,z);T+=xe;for(let Tt=0;Tt<yt.length;Tt++)xe=F[o]-F[o-1],o++,yt[Tt]=i.vertexBufferType===ja.VEC_2?Ip(X,G,T,xe):ef(X,G,T,xe,0,z),T+=xe;ae[Ee]=g.createPolygon(ht,yt)}e[p++]=g.createMultiPolygon(ae)}else{for(let Ee=0;Ee<ee;Ee++){const We=B[n]-B[n-1];n++;const yt=new Array(We-1);xe=F[o]-F[o-1],o++;const ht=Jd(X,b,xe);b+=2*xe;for(let Tt=0;Tt<yt.length;Tt++){const Ut=F[o]-F[o-1];o++,yt[Tt]=Jd(X,b,Ut),b+=2*Ut}ae[Ee]=g.createPolygon(ht,yt)}e[p++]=g.createMultiPolygon(ae)}}}}return e}function Jd(i,e,n){return Wm(i,e,n,!0)}function Ip(i,e,n,o){return tf(i,e,n,o,!0)}function ef(i,e,n,o,h,p){return Qm(i,e,n,o,!0,p)}function Wm(i,e,n,o){const h=new Array(o?n+1:n);for(let p=0;p<2*n;p+=2)h[p/2]=new O(i[e+p],i[e+p+1]);return o&&(h[h.length-1]=h[0]),h}function tf(i,e,n,o,h){const p=new Array(h?o+1:o);for(let g=0;g<2*o;g+=2){const b=2*e[n+g/2];p[g/2]=new O(i[b],i[b+1])}return h&&(p[p.length-1]=p[0]),p}function Qm(i,e,n,o,h,p){const g=new Array(h?o+1:o);for(let b=0;b<o;b++){const T=Qd(i[e[n+b]],p.numBits,p.coordinateShift);g[b]=new O(T.x,T.y)}return h&&(g[g.length-1]=g[0]),g}class nf{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,o,h,p){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=o,this._vertexBuffer=h,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Km(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=Qd(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return Km(this)}get mortonSettings(){return this._mortonSettings}}class rf extends nf{_numGeometries;_geometryType;constructor(e,n,o,h,p,g,b){super(o,h,p,g,b),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Dr.POLYGON||this._geometryType===Dr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class af extends nf{_geometryTypes;constructor(e,n,o,h,p,g){super(e,o,h,p,g),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Dr.POLYGON||this.geometryType(e)===Dr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class cy{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,o,h){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=o,this._topologyVector=h}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,o=n.partOffsets,h=n.ringOffsets,p=n.geometryOffsets;let g=0,b=1,T=1,z=1;for(let I=0;I<this.numGeometries;I++)switch(this.geometryType(I)){case Dr.POLYGON:{const N=o[b]-o[b-1];b++;const B=[];for(let F=0;F<N;F++){const G=h[T]-h[T-1];T++;const H=[];for(let X=0;X<G;X++){const J=this._vertexBuffer[g++],ge=this._vertexBuffer[g++];H.push(new O(J,ge))}H.length>0&&H.push(H[0]),B.push(H)}e[I]=B,p&&z++}break;case Dr.MULTIPOLYGON:{const N=p[z]-p[z-1];z++;const B=[];for(let F=0;F<N;F++){const G=o[b]-o[b-1];b++;for(let H=0;H<G;H++){const X=h[T]-h[T-1];T++;const J=[];for(let ge=0;ge<X;ge++){const ee=this._vertexBuffer[g++],ae=this._vertexBuffer[g++];J.push(new O(ee,ae))}J.length>0&&J.push(J[0]),B.push(J)}}e[I]=B}}return e}[Symbol.iterator](){return null}}function Hh(i,e,n,o,h,p){return new h_(i,e,n,o,h,p)}class h_ extends cy{_numGeometries;_geometryType;constructor(e,n,o,h,p,g){super(o,h,p,g),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Jm(i,e,n,o,h){return new uy(i,e,n,o,h)}class uy extends cy{_geometryTypes;constructor(e,n,o,h,p){super(n,o,h,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function hy(i,e,n,o,h){const p=fa(i,n);let g=null,b=null,T=null,z=null,I=null,N=null,B=null,F=null;if(Hl(p,o,i,n)===pr.CONST){const H=$m(i,n,p,!1);for(let X=0;X<e-1;X++){const J=fa(i,n);switch(J.physicalStreamType){case qr.LENGTH:switch(J.logicalStreamType.lengthType){case da.GEOMETRIES:g=Rc(i,n,J);break;case da.PARTS:b=Rc(i,n,J);break;case da.RINGS:T=Rc(i,n,J);break;case da.TRIANGLES:B=Rc(i,n,J)}break;case qr.OFFSET:switch(J.logicalStreamType.offsetType){case Dc.VERTEX:z=pa(i,n,J,!1);break;case Dc.INDEX:F=pa(i,n,J,!1)}break;case qr.DATA:ko.VERTEX===J.logicalStreamType.dictionaryType?I=pa(i,n,J,!0):(N={numBits:J.numBits,coordinateShift:J.coordinateShift},I=pa(i,n,J,!1))}}return F!==null?g!=null||b!=null?Hh(o,H,B,F,I,new Zl(g,b,T)):Hh(o,H,B,F,I):N===null?(function(X,J,ge,ee,ae){return new rf(X,J,ja.VEC_2,ge,ee,ae)})(o,H,new Zl(g,b,T),z,I):(function(X,J,ge,ee,ae,xe){return new rf(X,J,ja.MORTON,ge,ee,ae,xe)})(o,H,new Zl(g,b,T),z,I,N)}const G=pa(i,n,p,!1);for(let H=0;H<e-1;H++){const X=fa(i,n);switch(X.physicalStreamType){case qr.LENGTH:switch(X.logicalStreamType.lengthType){case da.GEOMETRIES:g=pa(i,n,X,!1);break;case da.PARTS:b=pa(i,n,X,!1);break;case da.RINGS:T=pa(i,n,X,!1);break;case da.TRIANGLES:B=Rc(i,n,X)}break;case qr.OFFSET:switch(X.logicalStreamType.offsetType){case Dc.VERTEX:z=pa(i,n,X,!1);break;case Dc.INDEX:F=pa(i,n,X,!1)}break;case qr.DATA:ko.VERTEX===X.logicalStreamType.dictionaryType?I=pa(i,n,X,!0):(N={numBits:X.numBits,coordinateShift:X.coordinateShift},I=pa(i,n,X,!1))}}return F!==null&&b===null?Jm(G,B,F,I):(g!==null?(g=Rp(G,g,2),b!==null&&T!==null?(b=Lp(G,g,b,!1),T=(function(H,X,J,ge){const ee=new Int32Array(J[J.length-1]+1);let ae=0;ee[0]=ae;let xe=1,Ee=1,We=0;for(let yt=0;yt<H.length;yt++){const ht=H[yt],Tt=X[yt+1]-X[yt];if(ht!==0&&ht!==3)for(let Ut=0;Ut<Tt;Ut++){const Ct=J[xe]-J[xe-1];xe++;for(let mt=0;mt<Ct;mt++)ae=ee[Ee++]=ae+ge[We++]}else for(let Ut=0;Ut<Tt;Ut++)ee[Ee++]=++ae,xe++}return ee})(G,g,b,T)):b!==null&&(b=(function(H,X,J){const ge=new Int32Array(X[X.length-1]+1);let ee=0;ge[0]=ee;let ae=1,xe=0;for(let Ee=0;Ee<H.length;Ee++){const We=H[Ee],yt=X[Ee+1]-X[Ee];if(We===4||We===1)for(let ht=0;ht<yt;ht++)ee=ge[ae++]=ee+J[xe++];else for(let ht=0;ht<yt;ht++)ge[ae++]=++ee}return ge})(G,g,b))):b!==null&&T!==null?(b=Rp(G,b,1),T=Lp(G,b,T,!0)):b!==null&&(b=Rp(G,b,0)),F!==null?Jm(G,B,F,I,new Zl(g,b,T)):N===null?(function(H,X,J,ge){return new af(ja.VEC_2,H,X,J,ge)})(G,new Zl(g,b,T),z,I):(function(H,X,J,ge,ee){return new af(ja.MORTON,H,X,J,ge,ee)})(G,new Zl(g,b,T),z,I,N))}function Rp(i,e,n){const o=new Int32Array(i.length+1);let h=0;o[0]=h;let p=0;for(let g=0;g<i.length;g++)h=o[g+1]=h+(i[g]>n?e[p++]:1);return o}function Lp(i,e,n,o){const h=new Int32Array(e[e.length-1]+1);let p=0;h[0]=p;let g=1,b=0;for(let T=0;T<i.length;T++){const z=i[T],I=e[T+1]-e[T];if(z===5||z===2||o&&(z===4||z===1))for(let N=0;N<I;N++)p=h[g++]=p+n[b++];else for(let N=0;N<I;N++)h[g++]=++p}return h}class dy extends kc{dataVector;constructor(e,n,o){super(e,n.getBuffer(),o),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class fy extends Cp{getValueFromBuffer(e){return this.dataBuffer[e]}}class sf extends kc{constructor(e,n,o){super(e,BigInt64Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function of(i,e,n){return py(i,Math.ceil(e/8),n)}function py(i,e,n){const o=new Uint8Array(e);let h=0;for(;h<e;){const p=i[n.increment()];if(p<=127){const g=p+3,b=i[n.increment()],T=h+g;o.fill(b,h,T),h=T}else{const g=256-p;for(let b=0;b<g;b++)o[h++]=i[n.increment()]}}return o}const eg=new TextDecoder;function lf(i,e,n){return n-e>=12?eg.decode(i.subarray(e,n)):(function(o,h,p){let g="",b=h;for(;b<p;){const T=o[b];let z,I,N,B=null,F=T>239?4:T>223?3:T>191?2:1;if(b+F>p)break;F===1?T<128&&(B=T):F===2?(z=o[b+1],(192&z)==128&&(B=(31&T)<<6|63&z,B<=127&&(B=null))):F===3?(z=o[b+1],I=o[b+2],(192&z)==128&&(192&I)==128&&(B=(15&T)<<12|(63&z)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(z=o[b+1],I=o[b+2],N=o[b+3],(192&z)==128&&(192&I)==128&&(192&N)==128&&(B=(15&T)<<18|(63&z)<<12|(63&I)<<6|63&N,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),b+=F}return g})(i,e,n)}class Zh extends kc{offsetBuffer;constructor(e,n,o,h){super(e,o,h),this.offsetBuffer=n}}class Np extends Zh{textEncoder;constructor(e,n,o,h){super(e,n,o,h??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return lf(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Fu extends Zh{indexBuffer;textEncoder;constructor(e,n,o,h,p){super(e,o,h,p??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return lf(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class jp extends Zh{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,o,h,p,g,b){super(e,o,h,b),this.indexBuffer=n,this.symbolOffsetBuffer=p,this.symbolTableBuffer=g,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,h,p){const g=[],b=new Array(h.length).fill(0);for(let T=1;T<h.length;T++)b[T]=b[T-1]+h[T-1];for(let T=0;T<p.length;T++)if(p[T]===255)g.push(p[++T]);else{const z=h[p[T]],I=b[p[T]];for(let N=0;N<z;N++)g.push(o[I+N])}return new Uint8Array(g)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return lf(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let o=e[0];for(let h=1;h<e.length;h++){const p=e[h];n[h-1]=p-o,o=p}return n}}function Lc(i,e,n,o,h,p){return n.type==="scalarType"?(function(g,b,T,z,I,N){let B=null,F=0;if(g===0)return null;if(N.nullable){const H=fa(b,T);F=H.numValues;const X=T.get(),J=of(b,F,T);T.set(X+H.byteLength),B=new Po(J,H.numValues)}const G=B??z;switch(I.physicalType){case 4:case 3:return(function(H,X,J,ge,ee){const ae=fa(H,X),xe=Hl(ae,ee,H,X),Ee=ge.physicalType===3;if(xe===pr.FLAT){const We=so(ee)?Xm(H,X,ae,Ee,ee):pa(H,X,ae,Ee);return new Ap(J.name,We,ee)}if(xe===pr.SEQUENCE){const We=Hm(H,X,ae);return new Um(J.name,We[0],We[1],ae.numRleValues)}{const We=$m(H,X,ae,Ee);return new Vm(J.name,We,ee)}})(b,T,N,I,G);case 9:return(function(H,X,J,ge,ee){let ae=null,xe=null,Ee=null,We=null,yt=null,ht=null,Tt=null,Ut=null;for(let Ct=0;Ct<ge;Ct++){const mt=fa(X,J);if(mt.byteLength!==0)switch(mt.physicalStreamType){case qr.PRESENT:{const st=of(X,mt.numValues,J);ht=new Po(st,mt.numValues);break}case qr.OFFSET:xe=ee!=null||ht!=null?Xm(X,J,mt,!1,ee??ht):pa(X,J,mt,!1);break;case qr.LENGTH:{const st=Rc(X,J,mt);da.DICTIONARY===mt.logicalStreamType.lengthType?ae=st:da.SYMBOL===mt.logicalStreamType.lengthType?We=st:Tt=st;break}case qr.DATA:{const st=X.subarray(J.get(),J.get()+mt.byteLength);J.add(mt.byteLength);const Kt=mt.logicalStreamType.dictionaryType;ko.FSST===Kt?yt=st:ko.SINGLE===Kt||ko.SHARED===Kt?Ee=st:ko.NONE===Kt&&(Ut=st);break}}}return(function(Ct,mt,st,Kt,Xt,Qt,Ht){return mt?new jp(Ct,st,Kt,Xt,Qt,mt,Ht):null})(H,yt,xe,ae,Ee,We,ee??ht)??(function(Ct,mt,st,Kt,Xt){return mt?Xt?new Fu(Ct,st,Kt,mt,Xt):new Fu(Ct,st,Kt,mt):null})(H,Ee,xe,ae,ee??ht)??(function(Ct,mt,st,Kt,Xt){if(!mt||!st)return null;if(Kt)return Xt?new Fu(Ct,Kt,mt,st,Xt):new Fu(Ct,Kt,mt,st);if(Xt&&Xt.size()!==mt.length-1){const Qt=new Int32Array(Xt.size());let Ht=0;for(let on=0;on<Xt.size();on++)Qt[on]=Xt.get(on)?Ht++:0;return new Fu(Ct,Qt,mt,st,Xt)}return Xt?new Np(Ct,mt,st,Xt):new Np(Ct,mt,st)})(H,Tt,Ut,xe,ee??ht)})(N.name,b,T,N.nullable?g-1:g,B);case 0:return(function(H,X,J,ge,ee){const ae=fa(H,X),xe=ae.numValues,Ee=X.get(),We=so(ee)?(function(ht,Tt,Ut,Ct){const mt=py(ht,Math.ceil(Tt/8),Ut),st=new Po(mt,Tt),Kt=Ct.size(),Xt=new Po(new Uint8Array(Kt),Kt);let Qt=0;for(let Ht=0;Ht<Ct.size();Ht++){const on=!!Ct.get(Ht)&&st.get(Qt++);Xt.set(Ht,on)}return Xt.getBuffer()})(H,xe,X,ee):of(H,xe,X);X.set(Ee+ae.byteLength);const yt=new Po(We,xe);return new dy(J.name,yt,ee)})(b,T,N,0,G);case 6:case 5:return(function(H,X,J,ge,ee){const ae=fa(H,X),xe=Hl(ae,ge,H,X),Ee=ee.physicalType===5;if(xe===pr.FLAT){const We=so(ge)?(function(yt,ht,Tt,Ut,Ct){return(function(mt,st,Kt,Xt){switch(st.logicalLevelTechnique1){case In.DELTA:return st.logicalLevelTechnique2===In.RLE&&(mt=oy(mt,st.runs,st.numRleValues)),(function(Qt,Ht){const on=new BigInt64Array(Qt.size());let Qn=0;Qt.get(0)?(on[0]=Qt.get(0)?Ht[0]>>1n^-(1n&Ht[0]):0n,Qn=1):on[0]=0n;let jn=1;for(;jn!=on.length;++jn)on[jn]=Qt.get(jn)?on[jn-1]+(Ht[Qn]>>1n^-(1n&Ht[Qn++])):on[jn-1];return on})(Xt,mt);case In.RLE:return(function(Qt,Ht,on,Qn){const jn=Ht;return on?(function(Xi,ma,Rr){const Yi=new BigInt64Array(Xi.size());let Bi=0;for(let di=0;di<Rr;di++){const lr=Number(ma[di]);let mr=ma[di+Rr];mr=mr>>1n^-(1n&mr);for(let Li=Bi;Li<Bi+lr;Li++)Xi.get(Li)?Yi[Li]=mr:(Yi[Li]=0n,Bi++);Bi+=lr}return Yi})(Qn,Qt,jn.runs):(function(Xi,ma,Rr){const Yi=new BigInt64Array(Xi.size());let Bi=0;for(let di=0;di<Rr;di++){const lr=Number(ma[di]),mr=ma[di+Rr];for(let Li=Bi;Li<Bi+lr;Li++)Xi.get(Li)?Yi[Li]=mr:(Yi[Li]=0n,Bi++);Bi+=lr}return Yi})(Qn,Qt,jn.runs)})(mt,st,Kt,Xt);case In.NONE:return mt=Kt?(function(Qt,Ht){const on=new BigInt64Array(Qt.size());let Qn=0,jn=0;for(;jn!=on.length;++jn)if(Qt.get(jn)){const Xi=Ht[Qn++];on[jn]=Xi>>1n^-(1n&Xi)}else on[jn]=0n;return on})(Xt,mt):(function(Qt,Ht){const on=new BigInt64Array(Qt.size());let Qn=0,jn=0;for(;jn!=on.length;++jn)on[jn]=Qt.get(jn)?Ht[Qn++]:0n;return on})(Xt,mt),mt;default:throw new Error("The specified Logical level technique is not supported")}})(Wd(yt,ht,Tt.numValues),Tt,Ut,Ct)})(H,X,ae,Ee,ge):Gh(H,X,ae,Ee);return new $h(J.name,We,ge)}if(xe===pr.SEQUENCE){const We=Bu(H,X,ae);return new Ym(J.name,We[0],We[1],ae.numRleValues)}{const We=Zm(H,X,ae,Ee);return new sf(J.name,We,ge)}})(b,T,N,G,I);case 7:return(function(H,X,J,ge){const ee=fa(H,X),ae=so(ge)?(function(xe,Ee,We,yt){const ht=Ee.get(),Tt=ht+yt*Float32Array.BYTES_PER_ELEMENT,Ut=new Uint8Array(xe.subarray(ht,Tt)).buffer,Ct=new Float32Array(Ut);Ee.set(Tt);const mt=We.size(),st=new Float32Array(mt);let Kt=0;for(let Xt=0;Xt<mt;Xt++)st[Xt]=We.get(Xt)?Ct[Kt++]:0;return st})(H,X,ge,ee.numValues):(function(xe,Ee,We){const yt=Ee.get(),ht=yt+We*Float32Array.BYTES_PER_ELEMENT,Tt=new Uint8Array(xe.subarray(yt,ht)).buffer,Ut=new Float32Array(Tt);return Ee.set(ht),Ut})(H,X,ee.numValues);return new fy(J.name,ae,ge)})(b,T,N,G);case 8:return(function(H,X,J,ge){const ee=fa(H,X),ae=so(ge)?(function(xe,Ee,We,yt){const ht=Ee.get(),Tt=ht+yt*Float64Array.BYTES_PER_ELEMENT,Ut=new Uint8Array(xe.subarray(ht,Tt)).buffer,Ct=new Float64Array(Ut);Ee.set(Tt);const mt=We.size(),st=new Float64Array(mt);let Kt=0;for(let Xt=0;Xt<mt;Xt++)st[Xt]=We.get(Xt)?Ct[Kt++]:0;return st})(H,X,ge,ee.numValues):(function(xe,Ee,We){const yt=Ee.get(),ht=yt+We*Float64Array.BYTES_PER_ELEMENT,Tt=new Uint8Array(xe.subarray(yt,ht)).buffer,Ut=new Float64Array(Tt);return Ee.set(ht),Ut})(H,X,ee.numValues);return new Bm(J.name,ae,ge)})(b,T,N,G);default:throw new Error(`The specified data type for the field is currently not supported: ${I}`)}})(o,i,e,h,n.scalarType,n):o!=1?null:(function(g,b,T,z){let I=null,N=null,B=null,F=null,G=!1;for(;!G;){const ge=fa(g,b);switch(ge.physicalStreamType){case qr.LENGTH:da.DICTIONARY===ge.logicalStreamType.lengthType?I=Rc(g,b,ge):B=Rc(g,b,ge);break;case qr.DATA:ko.SINGLE===ge.logicalStreamType.dictionaryType||ko.SHARED===ge.logicalStreamType.dictionaryType?(N=g.subarray(b.get(),b.get()+ge.byteLength),G=!0):F=g.subarray(b.get(),b.get()+ge.byteLength),b.add(ge.byteLength)}}const H=T.complexType.children,X=[];let J=0;for(const ge of H){const ee=Ir(g,b,1)[0];if(ee==0)continue;const ae=`${T.name}${ge.name==="default"?"":":"+ge.name}`;if(ee!==2||ge.type!=="scalarField"||ge.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const xe=fa(g,b),Ee=of(g,xe.numValues,b),We=fa(g,b),yt=We.decompressedCount!==z?Xm(g,b,We,!1,new Po(Ee,xe.numValues)):pa(g,b,We,!1);X[J++]=F?new jp(ae,yt,I,N,B,F,new Po(Ee,xe.numValues)):new Fu(ae,yt,I,N,new Po(Ee,xe.numValues))}return X})(i,e,n,h)}function so(i){return i instanceof Po}function Nc(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const cf=new TextDecoder;function Xh(i,e){const n=Ir(i,e,1)[0];if(n===0)return"";const o=e.get(),h=i.subarray(o,o+n);return e.add(n),cf.decode(h)}function Xl(i,e){const n=Ir(i,e,1)[0]>>>0,o=!!(4&n),h=!!(2&n),p=Ir(i,e,1)[0]>>>0,g={};if(1&n&&(g.nullable=!0),h){const b={};if(o?(b.type="logicalType",b.logicalType=p):(b.type="physicalType",b.physicalType=p),8&n){const T=Ir(i,e,1)[0]>>>0;b.children=new Array(T);for(let z=0;z<T;z++)b.children[z]=Xl(i,e)}g.type="complexField",g.complexField=b}else{const b={};o?(b.type="logicalType",b.logicalType=p):(b.type="physicalType",b.physicalType=p),g.type="scalarField",g.scalarField=b}return g}function d_(i,e){const n=Ir(i,e,1)[0]>>>0,o=(function(h){switch(h){case 0:case 1:case 2:case 3:{const p={};p.nullable=!!(1&h),p.columnScope=0;const g={};return g.physicalType=h>1?6:4,g.type="physicalType",p.scalarType=g,p.type="scalarType",p}case 4:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:0};return p.type="complexType",p.complexType=g,p}case 30:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:1};return p.type="complexType",p.complexType=g,p}default:return(function(p){let g=null;switch(p){case 10:case 11:g=0;break;case 12:case 13:g=1;break;case 14:case 15:g=2;break;case 16:case 17:g=3;break;case 18:case 19:g=4;break;case 20:case 21:g=5;break;case 22:case 23:g=6;break;case 24:case 25:g=7;break;case 26:case 27:g=8;break;case 28:case 29:g=9;break;default:return null}const b={};b.nullable=!!(1&p),b.columnScope=0;const T={type:"physicalType"};return T.physicalType=g,b.type="scalarType",b.scalarType=T,b})(h)}})(n);if(!o)throw new Error(`Unsupported column type code: ${n}`);if((function(h){return h>=10})(n)?o.name=Xh(i,e):n>=0&&n<=3?o.name="id":n===4&&(o.name="geometry"),(function(h){return h===30})(n)){const h=Ir(i,e,1)[0]>>>0,p=o.complexType;p.children=new Array(h);for(let g=0;g<h;g++)p.children[g]=Xl(i,e)}return o}function my(i,e){const n={featureTables:[]},o={};o.name=Xh(i,e);const h=Ir(i,e,1)[0]>>>0,p=Ir(i,e,1)[0]>>>0;o.columns=new Array(p);for(let g=0;g<p;g++)o.columns[g]=d_(i,e);return n.featureTables.push(o),[n,h]}function uf(i,e,n,o,h,p,g=!1){const b=e.scalarType.physicalType,T=Hl(h,p,i,n);if(b===4)switch(T){case pr.FLAT:{const z=pa(i,n,h,!1);return new Ap(o,z,p)}case pr.SEQUENCE:{const z=Hm(i,n,h);return new Um(o,z[0],z[1],h.numRleValues)}case pr.CONST:{const z=$m(i,n,h,!1);return new Vm(o,z,p)}}else switch(T){case pr.FLAT:{if(g){const I=(function(N,B,F,G){const H=(function(X,J,ge){const ee=new Float64Array(J);for(let ae=0;ae<J;ae++)ee[ae]=sy(X,ge);return ee})(N,F.numValues,B);return(function(X,J,ge){switch(J.logicalLevelTechnique1){case In.DELTA:return J.logicalLevelTechnique2===In.RLE&&(X=ly(X,J.runs,J.numRleValues)),(function(ee){ee[0]=ee[0]%2==1?(ee[0]+1)/-2:ee[0]/2;const ae=ee.length/4*4;let xe=1;if(ae>=4)for(;xe<ae-4;xe+=4){const Ee=ee[xe],We=ee[xe+1],yt=ee[xe+2],ht=ee[xe+3];ee[xe]=(Ee%2==1?(Ee+1)/-2:Ee/2)+ee[xe-1],ee[xe+1]=(We%2==1?(We+1)/-2:We/2)+ee[xe],ee[xe+2]=(yt%2==1?(yt+1)/-2:yt/2)+ee[xe+1],ee[xe+3]=(ht%2==1?(ht+1)/-2:ht/2)+ee[xe+2]}for(;xe!=ee.length;++xe)ee[xe]=(ee[xe]%2==1?(ee[xe]+1)/-2:ee[xe]/2)+ee[xe-1]})(X),X;case In.RLE:return(function(ee,ae,xe){return ly(ee,ae.runs,ae.numRleValues)})(X,J);case In.NONE:return X;default:throw new Error(`The specified Logical level technique is not supported: ${J.logicalLevelTechnique1}`)}})(H,F)})(i,n,h);return new Bm(o,I,p)}const z=Gh(i,n,h,!1);return new $h(o,z,p)}case pr.SEQUENCE:{const z=Bu(i,n,h);return new Ym(o,z[0],z[1],h.numRleValues)}case pr.CONST:{const z=Zm(i,n,h,!1);return new sf(o,z,p)}}throw new Error("Vector type not supported for id column.")}class f_{constructor(e,n){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Dr.POINT:case Dr.MULTIPOINT:this.type=1;break;case Dr.LINESTRING:case Dr.MULTILINESTRING:this.type=2;break;case Dr.POLYGON:case Dr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const o=[];for(const h of n)o.push(new O(h.x,h.y));e.push(o)}return e}}class gy{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new f_(this.features[e],this.extent)}}class hf{constructor(e){this.layers={};const n=(function(o,h,p=!0){const g=new ay(0),b=[];for(;g.get()<o.length;){const T=Ir(o,g,1)[0]>>>0,z=g.get()+T;if(z>o.length)throw new Error(`Block overruns tile: ${z} > ${o.length}`);if(Ir(o,g,1)[0]>>>0!=1){g.set(z);continue}const I=my(o,g),N=I[1],B=I[0].featureTables[0];let F=null,G=null;const H=[];let X=0;for(const ge of B.columns){const ee=ge.name;if(ee==="id"){let ae=null;if(ge.nullable){const Ee=fa(o,g),We=g.get(),yt=of(o,Ee.numValues,g);g.set(We+Ee.byteLength),ae=new Po(yt,Ee.numValues)}const xe=fa(o,g);X=xe.decompressedCount,F=uf(o,ge,g,ee,xe,ae??X,p)}else if(ee==="geometry"){const ae=Ir(o,g,1)[0];if(X===0){const xe=g.get();X=fa(o,g).decompressedCount,g.set(xe)}G=hy(o,ae,g,X)}else{const ae=Nc(ge)?Ir(o,g,1)[0]:1;if(ae===0&&ge.type==="scalarType")continue;const xe=Lc(o,g,ge,ae,X);if(xe)if(Array.isArray(xe))for(const Ee of xe)H.push(Ee);else H.push(xe)}}const J=new Pc(B.name,G,F,H,N);b.push(J),g.set(z)}return b})(new Uint8Array(e));this.layers=n.reduce(((o,h)=>Object.assign(Object.assign({},o),{[h.name]:new gy(h)})),{})}}class yy{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of n){const h=[];for(const p of o)h.push(new O(p[0],p[1]));e.push(h)}return e}}const df="_geojsonTileLayer";function Op(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<i.length;p++)n.feature=i.feature(p),e.writeMessage(2,Bp,n);const o=n.keys;for(const p of o)e.writeStringField(3,p);const h=n.values;for(const p of h)e.writeMessage(4,Fp,p)}function Bp(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,_y,i),e.writeVarintField(3,n.type),e.writeMessage(4,ng,n)}function _y(i,e){for(const n in i.feature?.properties){let o=i.feature.properties[n],h=i.keycache[n];if(o==null)continue;h===void 0&&(i.keys.push(n),h=i.keys.length-1,i.keycache[n]=h),e.writeVarint(h),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const p=typeof o+":"+o;let g=i.valuecache[p];g===void 0&&(i.values.push(o),g=i.values.length-1,i.valuecache[p]=g),e.writeVarint(g)}}function jc(i,e){return(e<<3)+(7&i)}function tg(i){return i<<1^i>>31}function ng(i,e){const n=i.loadGeometry(),o=i.type;let h=0,p=0;for(const g of n){let b=1;o===1&&(b=g.length),e.writeVarint(jc(1,b));const T=o===3?g.length-1:g.length;for(let z=0;z<T;z++){z===1&&o!==1&&e.writeVarint(jc(2,T-1));const I=g[z].x-h,N=g[z].y-p;e.writeVarint(tg(I)),e.writeVarint(tg(N)),h+=I,p+=N}i.type===3&&e.writeVarint(jc(7,1))}}function Fp(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class ig{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ko(Fe,16,0),this.grid3D=new Ko(Fe,16,0),this.featureIndexArray=new Q,this.promoteId=n}insert(e,n,o,h,p,g){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,p);const T=g?this.grid3D:this.grid;for(let z=0;z<n.length;z++){const I=n[z],N=[1/0,1/0,-1/0,-1/0];for(let B=0;B<I.length;B++){const F=I[B];N[0]=Math.min(N[0],F.x),N[1]=Math.min(N[1],F.y),N[2]=Math.max(N[2],F.x),N[3]=Math.max(N[3],F.y)}N[0]<Fe&&N[1]<Fe&&N[2]>=0&&N[3]>=0&&T.insert(b,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new $n(new dp(this.rawTileData)).layers:new hf(this.rawTileData).layers,this.sourceLayerCoder=new Om(this.vtLayers?Object.keys(this.vtLayers).sort():[df])),this.vtLayers}query(e,n,o,h){this.loadVTLayers();const p=e.params,g=Fe/e.tileSize/e.scale,b=aa(p.filter,p.globalState),T=e.queryGeometry,z=e.queryPadding*g,I=zc.fromPoints(T),N=this.grid.query(I.minX-z,I.minY-z,I.maxX+z,I.maxY+z),B=zc.fromPoints(e.cameraQueryGeometry).expandBy(z),F=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((X,J,ge,ee)=>(function(ae,xe,Ee,We,yt){for(const Tt of ae)if(xe<=Tt.x&&Ee<=Tt.y&&We>=Tt.x&&yt>=Tt.y)return!0;const ht=[new O(xe,Ee),new O(xe,yt),new O(We,yt),new O(We,Ee)];if(ae.length>2){for(const Tt of ht)if(tl(ae,Tt))return!0}for(let Tt=0;Tt<ae.length-1;Tt++)if(Sg(ae[Tt],ae[Tt+1],ht))return!0;return!1})(e.cameraQueryGeometry,X-z,J-z,ge+z,ee+z)));for(const X of F)N.push(X);N.sort(Up);const G={};let H;for(let X=0;X<N.length;X++){const J=N[X];if(J===H)continue;H=J;const ge=this.featureIndexArray.get(J);let ee=null;this.loadMatchingFeature(G,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,b,p.layers,p.availableImages,n,o,h,((ae,xe,Ee)=>(ee||(ee=Eo(ae)),xe.queryIntersectsFeature({queryGeometry:T,feature:ae,featureState:Ee,geometry:ee,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return G}loadMatchingFeature(e,n,o,h,p,g,b,T,z,I,N){const B=this.bucketLayerIDs[n];if(g&&!B.some((X=>g.has(X))))return;const F=this.sourceLayerCoder.decode(o),G=this.vtLayers[F].feature(h);if(p.needGeometry){const X=Ms(G,!0);if(!p.filter(new ri(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!p.filter(new ri(this.tileID.overscaledZ),G))return;const H=this.getId(G,F);for(let X=0;X<B.length;X++){const J=B[X];if(g&&!g.has(J))continue;const ge=T[J];if(!ge)continue;let ee={};H&&I&&(ee=I.getState(ge.sourceLayer||df,H));const ae=$t({},z[J]);ae.paint=xy(ae.paint,ge.paint,G,ee,b),ae.layout=xy(ae.layout,ge.layout,G,ee,b);const xe=!N||N(G,ge,ee);if(!xe)continue;const Ee=new Mp(G,this.z,this.x,this.y,H);Ee.layer=ae;let We=e[J];We===void 0&&(We=e[J]=[]),We.push({featureIndex:h,feature:Ee,intersectionZ:xe})}}lookupSymbolFeatures(e,n,o,h,p,g,b,T){const z={};this.loadVTLayers();const I=aa(p.filterSpec,p.globalState);for(const N of e)this.loadMatchingFeature(z,o,h,N,I,g,b,T,n);return z}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){var o;let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(h=Number(e.properties.cluster_id))),h}}function xy(i,e,n,o,h){return ln(i,((p,g)=>{const b=e instanceof kl?e.get(g):null;return b&&b.evaluate?b.evaluate(n,o,h):b}))}function Up(i,e){return e-i}function r(i,e,n,o,h){const p=[];for(let g=0;g<i.length;g++){const b=i[g];let T;for(let z=0;z<b.length-1;z++){let I=b[z],N=b[z+1];I.x<e&&N.x<e||(I.x<e?I=new O(e,I.y+(e-I.x)/(N.x-I.x)*(N.y-I.y))._round():N.x<e&&(N=new O(e,I.y+(e-I.x)/(N.x-I.x)*(N.y-I.y))._round()),I.y<n&&N.y<n||(I.y<n?I=new O(I.x+(n-I.y)/(N.y-I.y)*(N.x-I.x),n)._round():N.y<n&&(N=new O(I.x+(n-I.y)/(N.y-I.y)*(N.x-I.x),n)._round()),I.x>=o&&N.x>=o||(I.x>=o?I=new O(o,I.y+(o-I.x)/(N.x-I.x)*(N.y-I.y))._round():N.x>=o&&(N=new O(o,I.y+(o-I.x)/(N.x-I.x)*(N.y-I.y))._round()),I.y>=h&&N.y>=h||(I.y>=h?I=new O(I.x+(h-I.y)/(N.y-I.y)*(N.x-I.x),h)._round():N.y>=h&&(N=new O(I.x+(h-I.y)/(N.y-I.y)*(N.x-I.x),h)._round()),T&&I.equals(T[T.length-1])||(T=[I],p.push(T)),T.push(N)))))}}return p}function s(i,e,n,o,h){switch(e){case 1:return(function(p,g,b,T){const z=[];for(const I of p)for(const N of I){const B=T===0?N.x:N.y;B>=g&&B<=b&&z.push([N])}return z})(i,n,o,h);case 2:return _(i,n,o,h,!1);case 3:return _(i,n,o,h,!0)}return[]}function d(i,e,n,o,h){const p=o===0?A:D;let g=[];const b=[];for(let I=0;I<i.length-1;I++){const N=i[I],B=i[I+1],F=o===0?N.x:N.y,G=o===0?B.x:B.y;let H=!1;F<e?G>e&&g.push(p(N,B,e)):F>n?G<n&&g.push(p(N,B,n)):g.push(N),G<e&&F>=e&&(g.push(p(N,B,e)),H=!0),G>n&&F<=n&&(g.push(p(N,B,n)),H=!0),!h&&H&&(b.push(g),g=[])}const T=i.length-1,z=o===0?i[T].x:i[T].y;return z>=e&&z<=n&&g.push(i[T]),h&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(new O(g[0].x,g[0].y)),g.length>0&&b.push(g),b}function _(i,e,n,o,h){const p=[];for(const g of i){const b=d(g,e,n,o,h);b.length>0&&p.push(...b)}return p}function A(i,e,n){return new O(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function D(i,e,n){return new O(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}Zt("FeatureIndex",ig,{omit:["rawTileData","sourceLayerCoder"]});class q extends O{constructor(e,n,o,h){super(e,n),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new q(this.x,this.y,this.angle,this.segment)}}function re(i,e,n,o,h){if(e.segment===void 0||n===0)return!0;let p=e,g=e.segment+1,b=0;for(;b>-n/2;){if(g--,g<0)return!1;b-=i[g].dist(p),p=i[g]}b+=i[g].dist(i[g+1]),g++;const T=[];let z=0;for(;b<n/2;){const I=i[g],N=i[g+1];if(!N)return!1;let B=i[g-1].angleTo(I)-I.angleTo(N);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:B}),z+=B;b-T[0].distance>o;)z-=T.shift().angleDelta;if(z>h)return!1;g++,b+=I.dist(N)}return!0}function Pe(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function ot(i,e,n){return i?.6*e*n:0}function vt(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function At(i,e,n,o,h,p){const g=ot(n,h,p),b=vt(n,o)*p;let T=0;const z=Pe(i)/2;for(let I=0;I<i.length-1;I++){const N=i[I],B=i[I+1],F=N.dist(B);if(T+F>z){const G=(z-T)/F,H=Pi.number(N.x,B.x,G),X=Pi.number(N.y,B.y,G),J=new q(H,X,B.angleTo(N),I);return J._round(),!g||re(i,J,b,g,e)?J:void 0}T+=F}}function ct(i,e,n,o,h,p,g,b,T){const z=ot(o,p,g),I=vt(o,h),N=I*g,B=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-N<e/4&&(e=N+e/4),pt(i,B?e/2*b%e:(I/2+2*p)*g*b%e,e,z,n,N,B,!1,T)}function pt(i,e,n,o,h,p,g,b,T){const z=p/2,I=Pe(i);let N=0,B=e-n,F=[];for(let G=0;G<i.length-1;G++){const H=i[G],X=i[G+1],J=H.dist(X),ge=X.angleTo(H);for(;B+n<N+J;){B+=n;const ee=(B-N)/J,ae=Pi.number(H.x,X.x,ee),xe=Pi.number(H.y,X.y,ee);if(ae>=0&&ae<T&&xe>=0&&xe<T&&B-z>=0&&B+z<=I){const Ee=new q(ae,xe,ge,G);Ee._round(),o&&!re(i,Ee,p,o,h)||F.push(Ee)}}N+=J}return b||F.length||g||(F=pt(i,N/2,n,o,h,p,g,!0,T)),F}function an(i,e,n,o){const h=[],p=i.image,g=p.pixelRatio,b=p.paddedRect.w-2,T=p.paddedRect.h-2;let z={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const I=p.stretchX||[[0,b]],N=p.stretchY||[[0,T]],B=(st,Kt)=>st+Kt[1]-Kt[0],F=I.reduce(B,0),G=N.reduce(B,0),H=b-F,X=T-G;let J=0,ge=F,ee=0,ae=G,xe=0,Ee=H,We=0,yt=X;if(p.content&&o){const st=p.content,Kt=st[2]-st[0],Xt=st[3]-st[1];(p.textFitWidth||p.textFitHeight)&&(z=$l(i)),J=mn(I,0,st[0]),ee=mn(N,0,st[1]),ge=mn(I,st[0],st[2]),ae=mn(N,st[1],st[3]),xe=st[0]-J,We=st[1]-ee,Ee=Kt-ge,yt=Xt-ae}const ht=z.x1,Tt=z.y1,Ut=z.x2-ht,Ct=z.y2-Tt,mt=(st,Kt,Xt,Qt)=>{const Ht=Ge(st.stretch-J,ge,Ut,ht),on=Ne(st.fixed-xe,Ee,st.stretch,F),Qn=Ge(Kt.stretch-ee,ae,Ct,Tt),jn=Ne(Kt.fixed-We,yt,Kt.stretch,G),Xi=Ge(Xt.stretch-J,ge,Ut,ht),ma=Ne(Xt.fixed-xe,Ee,Xt.stretch,F),Rr=Ge(Qt.stretch-ee,ae,Ct,Tt),Yi=Ne(Qt.fixed-We,yt,Qt.stretch,G),Bi=new O(Ht,Qn),di=new O(Xi,Qn),lr=new O(Xi,Rr),mr=new O(Ht,Rr),Li=new O(on/g,jn/g),ks=new O(ma/g,Yi/g),ga=e*Math.PI/180;if(ga){const $r=Math.sin(ga),nr=Math.cos(ga),Lr=[nr,-$r,$r,nr];Bi._matMult(Lr),di._matMult(Lr),mr._matMult(Lr),lr._matMult(Lr)}const Ps=st.stretch+st.fixed,ol=Kt.stretch+Kt.fixed;return{tl:Bi,tr:di,bl:mr,br:lr,tex:{x:p.paddedRect.x+1+Ps,y:p.paddedRect.y+1+ol,w:Xt.stretch+Xt.fixed-Ps,h:Qt.stretch+Qt.fixed-ol},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Li,pixelOffsetBR:ks,minFontScaleX:Ee/g/Ut,minFontScaleY:yt/g/Ct,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const st=Si(I,H,F),Kt=Si(N,X,G);for(let Xt=0;Xt<st.length-1;Xt++){const Qt=st[Xt],Ht=st[Xt+1];for(let on=0;on<Kt.length-1;on++)h.push(mt(Qt,Kt[on],Ht,Kt[on+1]))}}else h.push(mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return h}function mn(i,e,n){let o=0;for(const h of i)o+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return o}function Si(i,e,n){const o=[{fixed:-1,stretch:0}];for(const[h,p]of i){const g=o[o.length-1];o.push({fixed:h-g.stretch,stretch:g.stretch}),o.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return o.push({fixed:e+1,stretch:n}),o}function Ge(i,e,n,o){return i/e*n+o}function Ne(i,e,n,o){return i-e*n/o}Zt("Anchor",q);class at{constructor(e,n,o,h,p,g,b,T,z,I){var N;if(this.boxStartIndex=e.length,z){let B=g.top,F=g.bottom;const G=g.collisionPadding;G&&(B-=G[1],F+=G[3]);let H=F-B;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{const B=!((N=g.image)===null||N===void 0)&&N.content&&(g.image.textFitWidth||g.image.textFitHeight)?$l(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};B.y1=B.y1*b-T[0],B.y2=B.y2*b+T[2],B.x1=B.x1*b-T[3],B.x2=B.x2*b+T[1];const F=g.collisionPadding;if(F&&(B.x1-=F[0]*b,B.y1-=F[1]*b,B.x2+=F[2]*b,B.y2+=F[3]*b),I){const G=new O(B.x1,B.y1),H=new O(B.x2,B.y1),X=new O(B.x1,B.y2),J=new O(B.x2,B.y2),ge=I*Math.PI/180;G._rotate(ge),H._rotate(ge),X._rotate(ge),J._rotate(ge),B.x1=Math.min(G.x,H.x,X.x,J.x),B.x2=Math.max(G.x,H.x,X.x,J.x),B.y1=Math.min(G.y,H.y,X.y,J.y),B.y2=Math.max(G.y,H.y,X.y,J.y)}e.emplaceBack(n.x,n.y,B.x1,B.y1,B.x2,B.y2,o,h,p)}this.boxEndIndex=e.length}}class Mt{constructor(e=[],n=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,h=n[e];for(;e>0;){const p=e-1>>1,g=n[p];if(o(h,g)>=0)break;n[e]=g,e=p}n[e]=h}_down(e){const{data:n,compare:o}=this,h=this.length>>1,p=n[e];for(;e<h;){let g=1+(e<<1);const b=g+1;if(b<this.length&&o(n[b],n[g])<0&&(g=b),o(n[g],p)>=0)break;n[e]=n[g],e=g}n[e]=p}}function fn(i,e=1,n=!1){const o=zc.fromPoints(i[0]),h=Math.min(o.width(),o.height());let p=h/2;const g=new Mt([],hi),{minX:b,minY:T,maxX:z,maxY:I}=o;if(h===0)return new O(b,T);for(let F=b;F<z;F+=h)for(let G=T;G<I;G+=h)g.push(new sn(F+p,G+p,p,i));let N=(function(F){let G=0,H=0,X=0;const J=F[0];for(let ge=0,ee=J.length,ae=ee-1;ge<ee;ae=ge++){const xe=J[ge],Ee=J[ae],We=xe.x*Ee.y-Ee.x*xe.y;H+=(xe.x+Ee.x)*We,X+=(xe.y+Ee.y)*We,G+=3*We}return new sn(H/G,X/G,0,F)})(i),B=g.length;for(;g.length;){const F=g.pop();(F.d>N.d||!N.d)&&(N=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,B)),F.max-N.d<=e||(p=F.h/2,g.push(new sn(F.p.x-p,F.p.y-p,p,i)),g.push(new sn(F.p.x+p,F.p.y-p,p,i)),g.push(new sn(F.p.x-p,F.p.y+p,p,i)),g.push(new sn(F.p.x+p,F.p.y+p,p,i)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${N.d}`)),N.p}function hi(i,e){return e.max-i.max}function sn(i,e,n,o){this.p=new O(i,e),this.h=n,this.d=(function(h,p){let g=!1,b=1/0;for(let T=0;T<p.length;T++){const z=p[T];for(let I=0,N=z.length,B=N-1;I<N;B=I++){const F=z[I],G=z[B];F.y>h.y!=G.y>h.y&&h.x<(G.x-F.x)*(h.y-F.y)/(G.y-F.y)+F.x&&(g=!g),b=Math.min(b,sm(h,F,G))}}return(g?1:-1)*Math.sqrt(b)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var cn;E.aP=void 0,(cn=E.aP||(E.aP={}))[cn.center=1]="center",cn[cn.left=2]="left",cn[cn.right=3]="right",cn[cn.top=4]="top",cn[cn.bottom=5]="bottom",cn[cn["top-left"]=6]="top-left",cn[cn["top-right"]=7]="top-right",cn[cn["bottom-left"]=8]="bottom-left",cn[cn["bottom-right"]=9]="bottom-right";const Vn=Number.POSITIVE_INFINITY;function si(i,e){return e[1]!==Vn?(function(n,o,h){let p=0,g=0;switch(o=Math.abs(o),h=Math.abs(h),n){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,g]})(i,e[0],e[1]):(function(n,o){let h=0,p=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=o;break;case"right":h=-o}return[h,p]})(i,e[0])}function Yl(i,e,n){var o;const h=i.layout,p=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(p){const b=p.values,T=[];for(let z=0;z<b.length;z+=2){const I=T[z]=b[z],N=b[z+1].map((B=>B*vr));I.startsWith("top")?N[1]-=7:I.startsWith("bottom")&&(N[1]+=7),T[z+1]=N}return new Vi(T)}const g=h.get("text-variable-anchor");if(g){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},n)*vr,Vn]:h.get("text-offset").evaluate(e,{},n).map((z=>z*vr));const T=[];for(const z of g)T.push(z,si(z,b));return new Vi(T)}return null}function rg(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function I1(i,e,n,o,h,p,g,b,T,z,I,N){let B=p.textMaxSize.evaluate(e,{});B===void 0&&(B=g);const F=i.layers[0].layout,G=F.get("icon-offset").evaluate(e,{},I),H=Q0(n.horizontal),X=g/24,J=i.tilePixelRatio*X,ge=i.tilePixelRatio*B/24,ee=i.tilePixelRatio*b,ae=i.tilePixelRatio*F.get("symbol-spacing"),xe=F.get("text-padding")*i.tilePixelRatio,Ee=(function(Xt,Qt,Ht,on=1){const Qn=Xt.get("icon-padding").evaluate(Qt,{},Ht),jn=Qn&&Qn.values;return[jn[0]*on,jn[1]*on,jn[2]*on,jn[3]*on]})(F,e,I,i.tilePixelRatio),We=F.get("text-max-angle")/180*Math.PI,yt=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",ht=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Tt=F.get("symbol-placement"),Ut=ae/2,Ct=F.get("icon-text-fit");let mt;o&&Ct!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(mt=Ao(o,n.vertical,Ct,F.get("icon-text-fit-padding"),G,X)),H&&(o=Ao(o,H,Ct,F.get("icon-text-fit-padding"),G,X)));const st=I?N.line.getGranularityForZoomLevel(I.z):1,Kt=(Xt,Qt)=>{Qt.x<0||Qt.x>=Fe||Qt.y<0||Qt.y>=Fe||(function(Ht,on,Qn,jn,Xi,ma,Rr,Yi,Bi,di,lr,mr,Li,ks,ga,Ps,ol,$r,nr,Lr,cr,Hr,Uu,Kl,og){const Yh=Ht.addToLineVertexArray(on,Qn);let ff,Vp,qp,Gp,nx=0,ix=0,rx=0,ax=0,b_=-1,w_=-1;const Vu={};let sx=Hi("");if(Ht.allowVerticalPlacement&&jn.vertical){const Oa=Yi.layout.get("text-rotate").evaluate(cr,{},Kl)+90;qp=new at(Bi,on,di,lr,mr,jn.vertical,Li,ks,ga,Oa),Rr&&(Gp=new at(Bi,on,di,lr,mr,Rr,ol,$r,ga,Oa))}if(Xi){const Oa=Yi.layout.get("icon-rotate").evaluate(cr,{}),Do=Yi.layout.get("icon-text-fit")!=="none",pf=an(Xi,Oa,Uu,Do),Ql=Rr?an(Rr,Oa,Uu,Do):void 0;Vp=new at(Bi,on,di,lr,mr,Xi,ol,$r,!1,Oa),nx=4*pf.length;const mf=Ht.iconSizeData;let Oc=null;mf.kind==="source"?(Oc=[As*Yi.layout.get("icon-size").evaluate(cr,{})],Oc[0]>Cc&&xt(`${Ht.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):mf.kind==="composite"&&(Oc=[As*Hr.compositeIconSizes[0].evaluate(cr,{},Kl),As*Hr.compositeIconSizes[1].evaluate(cr,{},Kl)],(Oc[0]>Cc||Oc[1]>Cc)&&xt(`${Ht.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ht.addSymbols(Ht.icon,pf,Oc,Lr,nr,cr,E.az.none,on,Yh.lineStartIndex,Yh.lineLength,-1,Kl),b_=Ht.icon.placedSymbolArray.length-1,Ql&&(ix=4*Ql.length,Ht.addSymbols(Ht.icon,Ql,Oc,Lr,nr,cr,E.az.vertical,on,Yh.lineStartIndex,Yh.lineLength,-1,Kl),w_=Ht.icon.placedSymbolArray.length-1)}const ox=Object.keys(jn.horizontal);for(const Oa of ox){const Do=jn.horizontal[Oa];if(!ff){sx=Hi(Do.text);const Ql=Yi.layout.get("text-rotate").evaluate(cr,{},Kl);ff=new at(Bi,on,di,lr,mr,Do,Li,ks,ga,Ql)}const pf=Do.positionedLines.length===1;if(rx+=W0(Ht,on,Do,ma,Yi,ga,cr,Ps,Yh,jn.vertical?E.az.horizontal:E.az.horizontalOnly,pf?ox:[Oa],Vu,b_,Hr,Kl),pf)break}jn.vertical&&(ax+=W0(Ht,on,jn.vertical,ma,Yi,ga,cr,Ps,Yh,E.az.vertical,["vertical"],Vu,w_,Hr,Kl));const N1=ff?ff.boxStartIndex:Ht.collisionBoxArray.length,j1=ff?ff.boxEndIndex:Ht.collisionBoxArray.length,O1=qp?qp.boxStartIndex:Ht.collisionBoxArray.length,B1=qp?qp.boxEndIndex:Ht.collisionBoxArray.length,F1=Vp?Vp.boxStartIndex:Ht.collisionBoxArray.length,U1=Vp?Vp.boxEndIndex:Ht.collisionBoxArray.length,V1=Gp?Gp.boxStartIndex:Ht.collisionBoxArray.length,q1=Gp?Gp.boxEndIndex:Ht.collisionBoxArray.length;let Wl=-1;const by=(Oa,Do)=>Oa&&Oa.circleDiameter?Math.max(Oa.circleDiameter,Do):Do;Wl=by(ff,Wl),Wl=by(qp,Wl),Wl=by(Vp,Wl),Wl=by(Gp,Wl);const lx=Wl>-1?1:0;lx&&(Wl*=og/vr),Ht.glyphOffsetArray.length>=Fh.MAX_GLYPHS&&xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cr.sortKey!==void 0&&Ht.addToSortKeyRanges(Ht.symbolInstances.length,cr.sortKey);const G1=Yl(Yi,cr,Kl),[$1,H1]=(function(Oa,Do){const pf=Oa.length,Ql=Do?.values;if(Ql?.length>0)for(let mf=0;mf<Ql.length;mf+=2){const Oc=Ql[mf+1];Oa.emplaceBack(E.aP[Ql[mf]],Oc[0],Oc[1])}return[pf,Oa.length]})(Ht.textAnchorOffsets,G1);Ht.symbolInstances.emplaceBack(on.x,on.y,Vu.right>=0?Vu.right:-1,Vu.center>=0?Vu.center:-1,Vu.left>=0?Vu.left:-1,Vu.vertical||-1,b_,w_,sx,N1,j1,O1,B1,F1,U1,V1,q1,di,rx,ax,nx,ix,lx,0,Li,Wl,$1,H1)})(i,Qt,Xt,n,o,h,mt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,J,[xe,xe,xe,xe],yt,T,ee,Ee,ht,G,e,p,z,I,g)};if(Tt==="line")for(const Xt of r(e.geometry,0,0,Fe,Fe)){const Qt=Fl(Xt,st),Ht=ct(Qt,ae,We,n.vertical||H,o,24,ge,i.overscaling,Fe);for(const on of Ht)H&&R1(i,H.text,Ut,on)||Kt(Qt,on)}else if(Tt==="line-center"){for(const Xt of e.geometry)if(Xt.length>1){const Qt=Fl(Xt,st),Ht=At(Qt,We,n.vertical||H,o,24,ge);Ht&&Kt(Qt,Ht)}}else if(e.type==="Polygon")for(const Xt of au(e.geometry,0)){const Qt=fn(Xt,16);Kt(Fl(Xt[0],st,!0),new q(Qt.x,Qt.y,0))}else if(e.type==="LineString")for(const Xt of e.geometry){const Qt=Fl(Xt,st);Kt(Qt,new q(Qt[0].x,Qt[0].y,0))}else if(e.type==="Point")for(const Xt of e.geometry)for(const Qt of Xt)Kt([Qt],new q(Qt.x,Qt.y,0))}function W0(i,e,n,o,h,p,g,b,T,z,I,N,B,F,G){const H=(function(ge,ee,ae,xe,Ee,We,yt,ht){const Tt=xe.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,Ut=[];for(const Ct of ee.positionedLines)for(const mt of Ct.positionedGlyphs){if(!mt.rect)continue;const st=mt.rect||{};let Kt=4,Xt=!0,Qt=1,Ht=0;const on=(Ee||ht)&&mt.vertical,Qn=mt.metrics.advance*mt.scale/2;if(ht&&ee.verticalizable&&(Ht=Ct.lineOffset/2-(mt.imageName?-(vr-mt.metrics.width*mt.scale)/2:(mt.scale-1)*vr)),mt.imageName){const $r=yt[mt.imageName];Xt=$r.sdf,Qt=$r.pixelRatio,Kt=1/Qt}const jn=Ee?[mt.x+Qn,mt.y]:[0,0];let Xi=Ee?[0,0]:[mt.x+Qn+ae[0],mt.y+ae[1]-Ht],ma=[0,0];on&&(ma=Xi,Xi=[0,0]);const Rr=mt.metrics.isDoubleResolution?2:1,Yi=(mt.metrics.left-Kt)*mt.scale-Qn+Xi[0],Bi=(-mt.metrics.top-Kt)*mt.scale+Xi[1],di=Yi+st.w/Rr*mt.scale/Qt,lr=Bi+st.h/Rr*mt.scale/Qt,mr=new O(Yi,Bi),Li=new O(di,Bi),ks=new O(Yi,lr),ga=new O(di,lr);if(on){const $r=new O(-Qn,Qn- -17),nr=-Math.PI/2,Lr=12-Qn,cr=new O(22-Lr,-(mt.imageName?Lr:0)),Hr=new O(...ma);mr._rotateAround(nr,$r)._add(cr)._add(Hr),Li._rotateAround(nr,$r)._add(cr)._add(Hr),ks._rotateAround(nr,$r)._add(cr)._add(Hr),ga._rotateAround(nr,$r)._add(cr)._add(Hr)}if(Tt){const $r=Math.sin(Tt),nr=Math.cos(Tt),Lr=[nr,-$r,$r,nr];mr._matMult(Lr),Li._matMult(Lr),ks._matMult(Lr),ga._matMult(Lr)}const Ps=new O(0,0),ol=new O(0,0);Ut.push({tl:mr,tr:Li,bl:ks,br:ga,tex:st,writingMode:ee.writingMode,glyphOffset:jn,sectionIndex:mt.sectionIndex,isSDF:Xt,pixelOffsetTL:Ps,pixelOffsetBR:ol,minFontScaleX:0,minFontScaleY:0})}return Ut})(0,n,b,h,p,g,o,i.allowVerticalPlacement),X=i.textSizeData;let J=null;X.kind==="source"?(J=[As*h.layout.get("text-size").evaluate(g,{})],J[0]>Cc&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):X.kind==="composite"&&(J=[As*F.compositeTextSizes[0].evaluate(g,{},G),As*F.compositeTextSizes[1].evaluate(g,{},G)],(J[0]>Cc||J[1]>Cc)&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,H,J,b,p,g,z,e,T.lineStartIndex,T.lineLength,B,G);for(const ge of I)N[ge]=i.text.placedSymbolArray.length-1;return 4*H.length}function Q0(i){for(const e in i)return i[e];return null}function R1(i,e,n,o){const h=i.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(o.dist(p[g])<n)return!0}else h[e]=[];return h[e].push(o),!1}const J0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class p_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=J0[15&o];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new p_(b,g,p,e)}constructor(e,n=64,o=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=J0.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return m_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:b}=this,T=[0,p.length-1,0],z=[];for(;T.length;){const I=T.pop()||0,N=T.pop()||0,B=T.pop()||0;if(N-B<=b){for(let X=B;X<=N;X++){const J=g[2*X],ge=g[2*X+1];J>=e&&J<=o&&ge>=n&&ge<=h&&z.push(p[X])}continue}const F=B+N>>1,G=g[2*F],H=g[2*F+1];G>=e&&G<=o&&H>=n&&H<=h&&z.push(p[F]),(I===0?e<=G:n<=H)&&(T.push(B),T.push(F-1),T.push(1-I)),(I===0?o>=G:h>=H)&&(T.push(F+1),T.push(N),T.push(1-I))}return z}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,b=[0,h.length-1,0],T=[],z=o*o;for(;b.length;){const I=b.pop()||0,N=b.pop()||0,B=b.pop()||0;if(N-B<=g){for(let X=B;X<=N;X++)tx(p[2*X],p[2*X+1],e,n)<=z&&T.push(h[X]);continue}const F=B+N>>1,G=p[2*F],H=p[2*F+1];tx(G,H,e,n)<=z&&T.push(h[F]),(I===0?e-o<=G:n-o<=H)&&(b.push(B),b.push(F-1),b.push(1-I)),(I===0?e+o>=G:n+o>=H)&&(b.push(F+1),b.push(N),b.push(1-I))}return T}}function m_(i,e,n,o,h,p){if(h-o<=n)return;const g=o+h>>1;ex(i,e,g,o,h,p),m_(i,e,n,o,g-1,1-p),m_(i,e,n,g+1,h,1-p)}function ex(i,e,n,o,h,p){for(;h>o;){if(h-o>600){const z=h-o+1,I=n-o+1,N=Math.log(z),B=.5*Math.exp(2*N/3),F=.5*Math.sqrt(N*B*(z-B)/z)*(I-z/2<0?-1:1);ex(i,e,n,Math.max(o,Math.floor(n-I*B/z+F)),Math.min(h,Math.floor(n+(z-I)*B/z+F)),p)}const g=e[2*n+p];let b=o,T=h;for(ag(i,e,o,n),e[2*h+p]>g&&ag(i,e,o,h);b<T;){for(ag(i,e,b,T),b++,T--;e[2*b+p]<g;)b++;for(;e[2*T+p]>g;)T--}e[2*o+p]===g?ag(i,e,o,T):(T++,ag(i,e,T,h)),T<=n&&(o=T+1),n<=T&&(h=T-1)}}function ag(i,e,n,o){g_(i,n,o),g_(e,2*n,2*o),g_(e,2*n+1,2*o+1)}function g_(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function tx(i,e,n,o){const h=i-n,p=e-o;return h*h+p*p}var y_;E.cH=void 0,(y_=E.cH||(E.cH={})).create="create",y_.load="load",y_.fullLoad="fullLoad";let vy=null,sg=[];const __=1e3/60,x_="loadTime",v_="fullLoadTime",L1={mark(i){performance.mark(i)},frame(i){const e=i;vy!=null&&sg.push(e-vy),vy=e},clearMetrics(){vy=null,sg=[],performance.clearMeasures(x_),performance.clearMeasures(v_);for(const i in E.cH)performance.clearMarks(E.cH[i])},getPerformanceMetrics(){performance.measure(x_,E.cH.create,E.cH.load),performance.measure(v_,E.cH.create,E.cH.fullLoad);const i=performance.getEntriesByName(x_)[0].duration,e=performance.getEntriesByName(v_)[0].duration,n=sg.length,o=1/(sg.reduce(((p,g)=>p+g),0)/n/1e3),h=sg.filter((p=>p>__)).reduce(((p,g)=>p+(g-__)/__),0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};E.$=te,E.A=lt,E.B=xs,E.C=xr,E.D=Yt,E.E=Mn,E.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},E.G=Pi,E.H=ri,E.I=_i,E.J=_h,E.K=function(i){if(Gt==null){const e=i.navigator?i.navigator.userAgent:null;Gt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Gt},E.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Sp((()=>this.process())),this.subscription=Wi(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=qt(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,o)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=e?Wi(e.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[h];const T={id:h,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),Rm):null;this.resolveRejects[h]={resolve:T=>{p?.unsubscribe(),n(T)},reject:T=>{p?.unsubscribe(),o(T)}};const g=[],b=Object.assign(Object.assign({},i),{id:h,sourceMapId:this.mapId,origin:location.origin,data:vs(i.data,g)});this.target.postMessage(b,{transfer:g})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(qt(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return l(this,void 0,void 0,(function*(){if(e.type==="<response>"){const h=this.resolveRejects[i];return delete this.resolveRejects[i],h?void(e.error?h.reject(yc(e.error)):h.resolve(yc(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=yc(e.data),o=new AbortController;this.abortControllers[i]=o;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,n,o);this.completeTask(i,null,h)}catch(h){this.completeTask(i,h)}}))}completeTask(i,e,n){const o=[];delete this.abortControllers[i];const h={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?vs(e):null,data:vs(n,o)};this.target.postMessage(h,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},E.M=Le,E.N=function(){var i=new lt(16);return lt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},E.O=function(i,e,n){var o,h,p,g,b,T,z,I,N,B,F,G,H=n[0],X=n[1],J=n[2];return e===i?(i[12]=e[0]*H+e[4]*X+e[8]*J+e[12],i[13]=e[1]*H+e[5]*X+e[9]*J+e[13],i[14]=e[2]*H+e[6]*X+e[10]*J+e[14],i[15]=e[3]*H+e[7]*X+e[11]*J+e[15]):(h=e[1],p=e[2],g=e[3],b=e[4],T=e[5],z=e[6],I=e[7],N=e[8],B=e[9],F=e[10],G=e[11],i[0]=o=e[0],i[1]=h,i[2]=p,i[3]=g,i[4]=b,i[5]=T,i[6]=z,i[7]=I,i[8]=N,i[9]=B,i[10]=F,i[11]=G,i[12]=o*H+b*X+N*J+e[12],i[13]=h*H+T*X+B*J+e[13],i[14]=p*H+z*X+F*J+e[14],i[15]=g*H+I*X+G*J+e[15]),i},E.P=O,E.Q=function(i,e,n){var o=n[0],h=n[1],p=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},E.R=ha,E.S=function(i,e,n){var o=e[0],h=e[1],p=e[2],g=e[3],b=e[4],T=e[5],z=e[6],I=e[7],N=e[8],B=e[9],F=e[10],G=e[11],H=e[12],X=e[13],J=e[14],ge=e[15],ee=n[0],ae=n[1],xe=n[2],Ee=n[3];return i[0]=ee*o+ae*b+xe*N+Ee*H,i[1]=ee*h+ae*T+xe*B+Ee*X,i[2]=ee*p+ae*z+xe*F+Ee*J,i[3]=ee*g+ae*I+xe*G+Ee*ge,i[4]=(ee=n[4])*o+(ae=n[5])*b+(xe=n[6])*N+(Ee=n[7])*H,i[5]=ee*h+ae*T+xe*B+Ee*X,i[6]=ee*p+ae*z+xe*F+Ee*J,i[7]=ee*g+ae*I+xe*G+Ee*ge,i[8]=(ee=n[8])*o+(ae=n[9])*b+(xe=n[10])*N+(Ee=n[11])*H,i[9]=ee*h+ae*T+xe*B+Ee*X,i[10]=ee*p+ae*z+xe*F+Ee*J,i[11]=ee*g+ae*I+xe*G+Ee*ge,i[12]=(ee=n[12])*o+(ae=n[13])*b+(xe=n[14])*N+(Ee=n[15])*H,i[13]=ee*h+ae*T+xe*B+Ee*X,i[14]=ee*p+ae*z+xe*F+Ee*J,i[15]=ee*g+ae*I+xe*G+Ee*ge,i},E.T=ep,E.U=function(i,e){const n={};for(let o=0;o<e.length;o++){const h=e[o];h in i&&(n[h]=i[h])}return n},E.V=al,E.W=jt,E.X=Lm,E.Y=ty,E.Z=ue,E._=l,E.a=K,E.a$=$e,E.a0=ve,E.a1=bn,E.a2=ls,E.a3=iy,E.a4=Xd,E.a5=Fe,E.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const o=Kd(i),h=Kd(e);(function(g,b){b.removeAll&&(g.add.clear(),g.update.clear(),g.remove.clear(),b.remove.clear());for(const T of b.remove)g.add.delete(T),g.update.delete(T);for(const[T,z]of b.update){const I=g.update.get(T);I&&(b.update.set(T,jm(I,z)),g.update.delete(T))}})(o,h);const p={};if((o.removeAll||h.removeAll)&&(p.removeAll=!0),p.remove=new Set([...o.remove,...h.remove]),p.add=new Map([...o.add,...h.add]),p.update=new Map([...o.update,...h.update]),p.remove.size&&p.add.size)for(const g of p.add.keys())p.remove.delete(g);return(function(g){const b={};return g.removeAll&&(b.removeAll=g.removeAll),g.remove&&(b.remove=Array.from(g.remove)),g.add&&(b.add=Array.from(g.add.values())),g.update&&(b.update=Array.from(g.update.values())),b})(p)},E.a7=function(i,e){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const o=Yd(i,e);return o==null?void 0:(n.set(o,i),n)}if(i.type==="FeatureCollection"){const o=new Set;for(const h of i.features){const p=Yd(h,e);if(p==null||o.has(p))return;o.add(p),n.set(p,h)}return n}},E.a8=function(i,e,n){var o,h;const p=[];if(e.removeAll)i.clear();else if(e.remove)for(const g of e.remove){const b=i.get(g);b&&(p.push(b.geometry),i.delete(g))}if(e.add)for(const g of e.add){const b=Yd(g,n);if(b==null)continue;const T=i.get(b);T&&p.push(T.geometry),p.push(g.geometry),i.set(b,g)}if(e.update)for(const g of e.update){const b=i.get(g.id);if(!b)continue;const T=!!g.newGeometry,z=g.removeAllProperties||((o=g.removeProperties)===null||o===void 0?void 0:o.length)>0||((h=g.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0;if(!T&&!z)continue;p.push(b.geometry);const I=Object.assign({},b);if(i.set(g.id,I),T&&(p.push(g.newGeometry),I.geometry=g.newGeometry),z){if(I.properties=g.removeAllProperties?{}:Object.assign({},I.properties||{}),g.removeProperties)for(const N of g.removeProperties)delete I.properties[N];if(g.addOrUpdateProperties)for(const{key:N,value:B}of g.addOrUpdateProperties)I.properties[N]=B}}return p},E.a9=ui,E.aA=function(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:h}){return i.kind==="source"?o/As:i.kind==="composite"?Pi.number(o/As,h/As,n):e},E.aB=function(i,e){var n=e[0],o=e[1],h=e[2],p=e[3],g=e[4],b=e[5],T=e[6],z=e[7],I=e[8],N=e[9],B=e[10],F=e[11],G=e[12],H=e[13],X=e[14],J=e[15],ge=n*b-o*g,ee=n*T-h*g,ae=n*z-p*g,xe=o*T-h*b,Ee=o*z-p*b,We=h*z-p*T,yt=I*H-N*G,ht=I*X-B*G,Tt=I*J-F*G,Ut=N*X-B*H,Ct=N*J-F*H,mt=B*J-F*X,st=ge*mt-ee*Ct+ae*Ut+xe*Tt-Ee*ht+We*yt;return st?(i[0]=(b*mt-T*Ct+z*Ut)*(st=1/st),i[1]=(h*Ct-o*mt-p*Ut)*st,i[2]=(H*We-X*Ee+J*xe)*st,i[3]=(B*Ee-N*We-F*xe)*st,i[4]=(T*Tt-g*mt-z*ht)*st,i[5]=(n*mt-h*Tt+p*ht)*st,i[6]=(X*ae-G*We-J*ee)*st,i[7]=(I*We-B*ae+F*ee)*st,i[8]=(g*Ct-b*Tt+z*yt)*st,i[9]=(o*Tt-n*Ct-p*yt)*st,i[10]=(G*Ee-H*ae+J*ge)*st,i[11]=(N*ae-I*Ee-F*ge)*st,i[12]=(b*ht-g*Ut-T*yt)*st,i[13]=(n*Ut-o*ht+h*yt)*st,i[14]=(H*ee-G*xe-X*ge)*st,i[15]=(I*xe-N*ee+B*ge)*st,i):null},E.aC=ke,E.aD=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},E.aE=function(i){return i[0]=0,i[1]=0,i},E.aF=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},E.aG=km,E.aH=Ye,E.aI=function(i,e,n,o){const h=e.y-i.y,p=e.x-i.x,g=o.y-n.y,b=o.x-n.x,T=g*p-b*h;if(T===0)return null;const z=(b*(i.y-n.y)-g*(i.x-n.x))/T;return new O(i.x+z*p,i.y+z*h)},E.aJ=r,E.aK=Pu,E.aL=function(i){let e=1/0,n=1/0,o=-1/0,h=-1/0;for(const p of i)e=Math.min(e,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),h=Math.max(h,p.y);return[e,n,o,h]},E.aM=vr,E.aN=bt,E.aO=function(i,e,n,o,h=!1){if(!n[0]&&!n[1])return[0,0];const p=h?o==="map"?-i.bearingInRadians:0:o==="viewport"?i.bearingInRadians:0;if(p){const g=Math.sin(p),b=Math.cos(p);n=[n[0]*b-n[1]*g,n[0]*g+n[1]*b]}return[h?n[0]:bt(e,n[0],i.zoom),h?n[1]:bt(e,n[1],i.zoom)]},E.aQ=_p,E.aR=rg,E.aS=Mm,E.aT=p_,E.aU=Di,E.aV=Od,E.aW=se,E.aX=Ft,E.aY=tt,E.aZ=Cn,E.a_=Nm,E.aa=zc,E.ab=25,E.ac=Br,E.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const o of i){const h=window.document.createElement("source");ft(o)||(e.crossOrigin="Anonymous"),h.src=o,e.appendChild(h)}}))},E.ae=kt,E.af=function(){return Ot++},E.ag=f,E.ah=Fh,E.ai=df,E.aj=aa,E.ak=Ms,E.al=Mp,E.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,h,p)=>{const g=h||p;return e[o]=!g||g.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},E.an=Dt,E.ao=85.051129,E.ap=kn,E.aq=function(i){return Math.pow(2,i)},E.ar=Et,E.as=ny,E.at=function(i){return Math.log(i)/Math.LN2},E.au=function(i){var e=i[0],n=i[1];return e*e+n*n},E.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((T=>T.canonical.z)));let n=1/0,o=-1/0,h=1/0,p=-1/0;const g=[];for(const T of i){const{x:z,y:I,z:N}=T.canonical,B=Math.pow(2,e-N),F=z*B,G=I*B;g.push({id:T,x:F,y:G}),F<n&&(n=F),F>o&&(o=F),G<h&&(h=G),G>p&&(p=G)}const b=new Set;for(const T of g)T.x!==n&&T.x!==o&&T.y!==h&&T.y!==p||b.add(T.id);return b},E.aw=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},E.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const o=i.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const h={value:e,timeout:void 0};if(n!==void 0&&(h.timeout=setTimeout((()=>{this.remove(i,h)}),n)),this.data[o].push(h),this.order.push(o),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,o=e===void 0?0:this.data[n].indexOf(e),h=this.data[n][o];return this.data[n].splice(o,1),h.timeout&&clearTimeout(h.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(h.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const o of this.data[n])i(o.value)||e.push(o);for(const n of e)this.remove(n.value.tileID,n)}},E.ay=function(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:g}=i,b=h?Dt(Qr.interpolationFactor(h,e,p,g),0,1):0;i.kind==="camera"?o=Pi.number(i.minSize,i.maxSize,b):n=b}return{uSizeT:n,uSize:o}},E.b=gn,E.b$=Es,E.b0=it,E.b1=function(i){var e=new lt(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},E.b2=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},E.b3=function(i,e){var n=e[0],o=e[1],h=e[2],p=n*n+o*o+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i},E.b4=we,E.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},E.b6=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},E.b7=nt,E.b8=function(i,e,n){const o=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return o===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/o},E.b9=ut,E.bA=function(i,e,n,o){return i[0]=e[0]+n[0]*o,i[1]=e[1]+n[1]*o,i[2]=e[2]+n[2]*o,i},E.bB=le,E.bC=function(i,e,n){var o=n[0],h=n[1],p=n[2],g=n[3],b=e[0],T=e[1],z=e[2],I=h*z-p*T,N=p*b-o*z,B=o*T-h*b;return i[0]=b+g*(I+=I)+h*(B+=B)-p*(N+=N),i[1]=T+g*N+p*I-o*B,i[2]=z+g*B+o*N-h*I,i},E.bD=function(i,e,n){const o=(function(T){var z=T[3],I=T[4],N=T[5],B=T[6],F=T[7],G=T[8];return T[0]*(G*I-N*F)+T[1]*(-G*z+N*B)+T[2]*(F*z-I*B)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(o===0)return null;const h=we([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),p=we([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),g=we([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),b=$e([],h,-i[3]);return it(b,b,$e([],p,-e[3])),it(b,b,$e([],g,-n[3])),$e(b,b,1/o),b},E.bE=Tp,E.bF=function(){return new Float64Array(4)},E.bG=function(i,e,n,o){var h=[],p=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],p[0]=h[0]*Math.cos(o)-h[1]*Math.sin(o),p[1]=h[0]*Math.sin(o)+h[1]*Math.cos(o),p[2]=h[2],i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},E.bH=function(i,e,n,o){var h=[],p=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],p[0]=h[0],p[1]=h[1]*Math.cos(o)-h[2]*Math.sin(o),p[2]=h[1]*Math.sin(o)+h[2]*Math.cos(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},E.bI=function(i,e,n,o){var h=[],p=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],p[0]=h[2]*Math.sin(o)+h[0]*Math.cos(o),p[1]=h[1],p[2]=h[2]*Math.cos(o)-h[0]*Math.sin(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},E.bJ=function(i,e,n){var o=Math.sin(n),h=Math.cos(n),p=e[0],g=e[1],b=e[2],T=e[3],z=e[8],I=e[9],N=e[10],B=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*h-z*o,i[1]=g*h-I*o,i[2]=b*h-N*o,i[3]=T*h-B*o,i[8]=p*o+z*h,i[9]=g*o+I*h,i[10]=b*o+N*h,i[11]=T*o+B*h,i},E.bK=function(i,e){const n=de(i,360),o=de(e,360),h=o-n,p=o>n?h-360:h+360;return Math.abs(h)<Math.abs(p)?h:p},E.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},E.bM=function(i,e,n,o){const h=Math.sqrt(i*i+e*e),p=Math.sqrt(n*n+o*o);i/=h,e/=h,n/=p,o/=p;const g=Math.acos(i*n+e*o);return-e*n+i*o>0?g:-g},E.bN=function(i,e){const n=de(i,2*Math.PI),o=de(e,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},E.bO=function(){const i={},e=Ve.$version;for(const n in Ve.$root){const o=Ve.$root[n];if(o.required){let h=null;h=n==="version"?e:o.type==="array"?[]:{},h!=null&&(i[n]=h)}}return i},E.bP=Oe,E.bQ=bh,E.bR=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!i(e[o],n[o]))return!1;return!0}return e===n},E.bS=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Fi(i[n],e[i[n].ref]));return i},E.bT=function(i,e){if(i.type==="custom")return new Im(i,e);switch(i.type){case"background":return new Hn(i,e);case"circle":return new Wf(i,e);case"color-relief":return new zg(i,e);case"fill":return new Rg(i,e);case"fill-extrusion":return new xm(i,e);case"heatmap":return new Cg(i,e);case"hillshade":return new Zi(i,e);case"line":return new bm(i,e);case"raster":return new bo(i,e);case"symbol":return new Ac(i,e)}},E.bU=i=>i.type==="raster",E.bV=rn,E.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!yn(i.version,e.version))return[{command:"setStyle",args:[e]}];yn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),yn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),yn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),yn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),yn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),yn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),yn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),yn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),yn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),yn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),yn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),yn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),yn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),yn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const o={},h=[];(function(g,b,T,z){let I;for(I in b=b||{},g=g||{})Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(b,I)||ei(I,T,z));for(I in b)Object.prototype.hasOwnProperty.call(b,I)&&(Object.prototype.hasOwnProperty.call(g,I)?yn(g[I],b[I])||(g[I].type==="geojson"&&b[I].type==="geojson"&&ii(g,b,I)?qn(T,{command:"setGeoJSONSourceData",args:[I,b[I].data]}):Ti(I,b,T,z)):ir(I,b,T))})(i.sources,e.sources,h,o);const p=[];i.layers&&i.layers.forEach((g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):p.push(g)})),n=n.concat(h),(function(g,b,T){b=b||[];const z=(g=g||[]).map(Is),I=b.map(Is),N=g.reduce(ds,{}),B=b.reduce(ds,{}),F=z.slice(),G=Object.create(null);let H,X,J,ge,ee;for(let ae=0,xe=0;ae<z.length;ae++)H=z[ae],Object.prototype.hasOwnProperty.call(B,H)?xe++:(qn(T,{command:"removeLayer",args:[H]}),F.splice(F.indexOf(H,xe),1));for(let ae=0,xe=0;ae<I.length;ae++)H=I[I.length-1-ae],F[F.length-1-ae]!==H&&(Object.prototype.hasOwnProperty.call(N,H)?(qn(T,{command:"removeLayer",args:[H]}),F.splice(F.lastIndexOf(H,F.length-xe),1)):xe++,ge=F[F.length-ae],qn(T,{command:"addLayer",args:[B[H],ge]}),F.splice(F.length-ae,0,H),G[H]=!0);for(let ae=0;ae<I.length;ae++)if(H=I[ae],X=N[H],J=B[H],!G[H]&&!yn(X,J))if(yn(X.source,J.source)&&yn(X["source-layer"],J["source-layer"])&&yn(X.type,J.type)){for(ee in Ui(X.layout,J.layout,T,H,null,"setLayoutProperty"),Ui(X.paint,J.paint,T,H,null,"setPaintProperty"),yn(X.filter,J.filter)||qn(T,{command:"setFilter",args:[H,J.filter]}),yn(X.minzoom,J.minzoom)&&yn(X.maxzoom,J.maxzoom)||qn(T,{command:"setLayerZoomRange",args:[H,J.minzoom,J.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ui(X[ee],J[ee],T,H,ee.slice(6),"setPaintProperty"):yn(X[ee],J[ee])||qn(T,{command:"setLayerProperty",args:[H,ee,J[ee]]}));for(ee in J)Object.prototype.hasOwnProperty.call(J,ee)&&!Object.prototype.hasOwnProperty.call(X,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ui(X[ee],J[ee],T,H,ee.slice(6),"setPaintProperty"):yn(X[ee],J[ee])||qn(T,{command:"setLayerProperty",args:[H,ee,J[ee]]}))}else qn(T,{command:"removeLayer",args:[H]}),ge=F[F.lastIndexOf(H)+1],qn(T,{command:"addLayer",args:[J,ge]})})(p,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[e]}]}return n},E.bX=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},E.bY=ln,E.bZ=dn,E.b_=class extends ca{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},E.ba=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},E.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},E.bc=ry,E.bd=Vh,E.be=function(i,e,n,o,h){var p=1/Math.tan(e/2);if(i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0){var g=1/(o-h);i[10]=(h+o)*g,i[14]=2*h*o*g}else i[10]=-1,i[14]=-2*o;return i},E.bf=function(i){var e=new lt(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},E.bg=function(i,e,n){var o=Math.sin(n),h=Math.cos(n),p=e[0],g=e[1],b=e[2],T=e[3],z=e[4],I=e[5],N=e[6],B=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*h+z*o,i[1]=g*h+I*o,i[2]=b*h+N*o,i[3]=T*h+B*o,i[4]=z*h-p*o,i[5]=I*h-g*o,i[6]=N*h-b*o,i[7]=B*h-T*o,i},E.bh=function(i,e,n){var o=Math.sin(n),h=Math.cos(n),p=e[4],g=e[5],b=e[6],T=e[7],z=e[8],I=e[9],N=e[10],B=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*h+z*o,i[5]=g*h+I*o,i[6]=b*h+N*o,i[7]=T*h+B*o,i[8]=z*h-p*o,i[9]=I*h-g*o,i[10]=N*h-b*o,i[11]=B*h-T*o,i},E.bi=function(){const i=new Float32Array(16);return Et(i),i},E.bj=function(){const i=new Float64Array(16);return Et(i),i},E.bk=function(){return new Float64Array(16)},E.bl=function(i,e,n){const o=new Float64Array(4);return le(o,i,e-90,n),o},E.bm=function(i,e,n,o){var h,p,g,b,T,z=e[0],I=e[1],N=e[2],B=e[3],F=n[0],G=n[1],H=n[2],X=n[3];return(p=z*F+I*G+N*H+B*X)<0&&(p=-p,F=-F,G=-G,H=-H,X=-X),1-p>qe?(h=Math.acos(p),g=Math.sin(h),b=Math.sin((1-o)*h)/g,T=Math.sin(o*h)/g):(b=1-o,T=o),i[0]=b*z+T*F,i[1]=b*I+T*G,i[2]=b*N+T*H,i[3]=b*B+T*X,i},E.bn=function(i){const e=new Float64Array(9);(function(p,g){var b=g[0],T=g[1],z=g[2],I=g[3],N=b+b,B=T+T,F=z+z,G=b*N,H=T*N,X=T*B,J=z*N,ge=z*B,ee=z*F,ae=I*N,xe=I*B,Ee=I*F;p[0]=1-X-ee,p[3]=H-Ee,p[6]=J+xe,p[1]=H+Ee,p[4]=1-G-ee,p[7]=ge-ae,p[2]=J-xe,p[5]=ge+ae,p[8]=1-G-X})(e,i);const n=Cn(-Math.asin(Dt(e[2],-1,1)));let o,h;return Math.hypot(e[5],e[8])<.001?(o=0,h=-Cn(Math.atan2(e[3],e[4]))):(o=Cn(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),h=Cn(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:n+90,bearing:h}},E.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},E.bp=wn,E.bq=Ll,E.br=rs,E.bs=Mo,E.bt=Or,E.bu=He,E.bv=_t,E.bw=yr,E.bx=function(i,e,n,o,h){return He(o,h,Dt((i-e)/(n-e),0,1))},E.by=de,E.bz=function(){return new Float64Array(3)},E.c=ye,E.c$=function(i,e,n,o,h){return l(this,void 0,void 0,(function*(){if(ve())try{return yield bn(i,e,n,o,h)}catch{}return(function(p,g,b,T,z){const I=p.width,N=p.height;Zn&&Ln||(Zn=new OffscreenCanvas(I,N),Ln=Zn.getContext("2d",{willReadFrequently:!0})),Zn.width=I,Zn.height=N,Ln.drawImage(p,0,0,I,N);const B=Ln.getImageData(g,b,T,z);return Ln.clearRect(0,0,I,N),B.data})(i,e,n,o,h)}))},E.c0=class extends ca{constructor(i,e){super(i,e),this.current=ua}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},E.c1=wc,E.c2=class extends ca{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},E.c3=class extends ca{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},E.c4=Pt,E.c5=function(i,e){var n=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},E.c6=function(i,e,n){var o=e[0],h=e[1],p=e[2];return i[0]=o*n[0]+h*n[3]+p*n[6],i[1]=o*n[1]+h*n[4]+p*n[7],i[2]=o*n[2]+h*n[5]+p*n[8],i},E.c7=function(i,e,n,o,h,p,g){var b=1/(e-n),T=1/(o-h),z=1/(p-g);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*z,i[11]=0,i[12]=(e+n)*b,i[13]=(h+o)*T,i[14]=(g+p)*z,i[15]=1,i},E.c8=class extends ca{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},E.c9=class extends ca{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},E.cA=function(i,e){return Ue[e]&&"touches"in i},E.cB=function(i){return Ue[i]||W[i]},E.cC=function(i,e,n){var o=e[0],h=e[1];return i[0]=n[0]*o+n[4]*h+n[12],i[1]=n[1]*o+n[5]*h+n[13],i},E.cD=function(i,e){const{x:n,y:o}=ui.fromLngLat(e);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},E.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},E.cF=class extends Pl{},E.cG=L1,E.cI=Me,E.cJ=function(i,e){ye.REGISTERED_PROTOCOLS[i]=e},E.cK=function(i){delete ye.REGISTERED_PROTOCOLS[i]},E.cL=function(i,e){const n={};for(let h=0;h<i.length;h++){const p=e&&e[i[h].id]||po(i[h]);e&&(e[i[h].id]=p);let g=n[p];g||(g=n[p]=[]),g.push(i[h])}const o=[];for(const h in n)o.push(n[h]);return o},E.cM=Zt,E.cN=Om,E.cO=ig,E.cP=mp,E.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Fe/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new ri(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new ri(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new ri(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:I}=i.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new ri(z),i.canonical),o["text-size"].possiblyEvaluate(new ri(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:I}=i.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new ri(z),i.canonical),o["icon-size"].possiblyEvaluate(new ri(I),i.canonical)]}const p=n.get("text-line-height")*vr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",b=n.get("text-keep-upright"),T=n.get("text-size");for(const z of i.bucket.features){const I=n.get("text-font").evaluate(z,{},i.canonical).join(","),N=T.evaluate(z,{},i.canonical),B=h.layoutTextSize.evaluate(z,{},i.canonical),F=h.layoutIconSize.evaluate(z,{},i.canonical),G={horizontal:{},vertical:void 0},H=z.text;let X,J=[0,0];if(H){const ae=H.toString(),xe=n.get("text-letter-spacing").evaluate(z,{},i.canonical)*vr,Ee=wh(ae)?xe:0,We=n.get("text-anchor").evaluate(z,{},i.canonical),yt=Yl(e,z,i.canonical);if(!yt){const Ct=n.get("text-radial-offset").evaluate(z,{},i.canonical);J=Ct?si(We,[Ct*vr,Vn]):n.get("text-offset").evaluate(z,{},i.canonical).map((mt=>mt*vr))}let ht=g?"center":n.get("text-justify").evaluate(z,{},i.canonical);const Tt=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(z,{},i.canonical)*vr:1/0,Ut=()=>{i.bucket.allowVerticalPlacement&&Ws(ae)&&(G.vertical=$d(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,Tt,p,We,"left",Ee,J,E.az.vertical,!0,B,N))};if(!g&&yt){const Ct=new Set;if(ht==="auto")for(let st=0;st<yt.values.length;st+=2)Ct.add(rg(yt.values[st]));else Ct.add(ht);let mt=!1;for(const st of Ct)if(!G.horizontal[st])if(mt)G.horizontal[st]=G.horizontal[0];else{const Kt=$d(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,Tt,p,"center",st,Ee,J,E.az.horizontal,!1,B,N);Kt&&(G.horizontal[st]=Kt,mt=Kt.positionedLines.length===1)}Ut()}else{ht==="auto"&&(ht=rg(We));const Ct=$d(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,Tt,p,We,ht,Ee,J,E.az.horizontal,!1,B,N);Ct&&(G.horizontal[ht]=Ct),Ut(),Ws(ae)&&g&&b&&(G.vertical=$d(H,i.glyphMap,i.glyphPositions,i.imagePositions,I,Tt,p,We,ht,Ee,J,E.az.vertical,!1,B,N))}}let ge=!1;if(z.icon&&z.icon.name){const ae=i.imageMap[z.icon.name];ae&&(X=Am(i.imagePositions[z.icon.name],n.get("icon-offset").evaluate(z,{},i.canonical),n.get("icon-anchor").evaluate(z,{},i.canonical)),ge=!!ae.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ge:i.bucket.sdfIcons!==ge&&xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=Q0(G.horizontal)||G.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||X)&&I1(i.bucket,z,G,X,i.imageMap,h,B,F,J,ge,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},E.cR=Iu,E.cS=Tc,E.cT=Ih,E.cU=function(i){const e=new dp;return(function(n,o){for(const h in n.layers)o.writeMessage(3,Op,n.layers[h])})(i,e),e.finish()},E.cV=function(i,e,n,o,h,p){let g=s(i,e,n,h,0);return g=s(g,e,o,p,1),g},E.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},E.cX=$n,E.cY=dp,E.cZ=hf,E.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},E.ca=class extends So{},E.cb=Bg,E.cc=class extends Ii{},E.cd=kd,E.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},E.cf=il,E.cg=function(i,e,n){var o=e[0],h=e[1],p=e[2],g=n[3]*o+n[7]*h+n[11]*p+n[15];return i[0]=(n[0]*o+n[4]*h+n[8]*p+n[12])/(g=g||1),i[1]=(n[1]*o+n[5]*h+n[9]*p+n[13])/g,i[2]=(n[2]*o+n[6]*h+n[10]*p+n[14])/g,i},E.ch=class extends Dl{},E.ci=class extends t{},E.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},E.ck=function(i,e){var n=i[0],o=i[1],h=i[2],p=i[3],g=i[4],b=i[5],T=i[6],z=i[7],I=i[8],N=i[9],B=i[10],F=i[11],G=i[12],H=i[13],X=i[14],J=i[15],ge=e[0],ee=e[1],ae=e[2],xe=e[3],Ee=e[4],We=e[5],yt=e[6],ht=e[7],Tt=e[8],Ut=e[9],Ct=e[10],mt=e[11],st=e[12],Kt=e[13],Xt=e[14],Qt=e[15];return Math.abs(n-ge)<=qe*Math.max(1,Math.abs(n),Math.abs(ge))&&Math.abs(o-ee)<=qe*Math.max(1,Math.abs(o),Math.abs(ee))&&Math.abs(h-ae)<=qe*Math.max(1,Math.abs(h),Math.abs(ae))&&Math.abs(p-xe)<=qe*Math.max(1,Math.abs(p),Math.abs(xe))&&Math.abs(g-Ee)<=qe*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(b-We)<=qe*Math.max(1,Math.abs(b),Math.abs(We))&&Math.abs(T-yt)<=qe*Math.max(1,Math.abs(T),Math.abs(yt))&&Math.abs(z-ht)<=qe*Math.max(1,Math.abs(z),Math.abs(ht))&&Math.abs(I-Tt)<=qe*Math.max(1,Math.abs(I),Math.abs(Tt))&&Math.abs(N-Ut)<=qe*Math.max(1,Math.abs(N),Math.abs(Ut))&&Math.abs(B-Ct)<=qe*Math.max(1,Math.abs(B),Math.abs(Ct))&&Math.abs(F-mt)<=qe*Math.max(1,Math.abs(F),Math.abs(mt))&&Math.abs(G-st)<=qe*Math.max(1,Math.abs(G),Math.abs(st))&&Math.abs(H-Kt)<=qe*Math.max(1,Math.abs(H),Math.abs(Kt))&&Math.abs(X-Xt)<=qe*Math.max(1,Math.abs(X),Math.abs(Xt))&&Math.abs(J-Qt)<=qe*Math.max(1,Math.abs(J),Math.abs(Qt))},E.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},E.cm=i=>i.type==="symbol",E.cn=i=>i.type==="circle",E.co=i=>i.type==="heatmap",E.cp=i=>i.type==="line",E.cq=i=>i.type==="fill",E.cr=i=>i.type==="fill-extrusion",E.cs=i=>i.type==="hillshade",E.ct=i=>i.type==="color-relief",E.cu=i=>i.type==="background",E.cv=i=>i.type==="custom",E.cw=It,E.cx=function(i,e,n){const o=De(e.x-n.x,e.y-n.y),h=De(i.x-n.x,i.y-n.y),p=Math.atan2(o[0]*h[1]-o[1]*h[0],(function(g,b){return g[0]*b[0]+g[1]*b[1]})(o,h));return Cn(p)},E.cy=Ze,E.cz=function(i,e){return W[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},E.d=ft,E.d0=zh,E.d1=Y,E.d2=class{constructor(i,e){this.layers={[df]:this},this.name=df,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new yy(this.features[i],this.extent)}},E.d3=dc,E.d4=Qa,E.e=$t,E.f=i=>l(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),E.g=je,E.h=i=>new Promise(((e,n)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=Rn}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(h):Rn})),E.i=qt,E.j=(i,e)=>Je($t(i,{type:"json"}),e),E.k=pn,E.l=Jt,E.m=Je,E.n=(i,e)=>Je($t(i,{type:"arrayBuffer"}),e),E.o=function(i){return new dp(i).readFields(Xg,[])},E.p=Em,E.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},E.r=zd,E.s=Wi,E.t=er,E.u=Ve,E.v=yu,E.w=xt,E.x=Th,E.y=_s,E.z=vo})),M("worker",["./shared"],(function(E){class l{constructor(W,$){this.keyCache={},W&&this.replace(W,$)}replace(W,$){this._layerConfigs={},this._layers={},this.update(W,[],$)}update(W,$,K){for(const ye of W){this._layerConfigs[ye.id]=ye;const je=this._layers[ye.id]=E.bT(ye,K);je._featureFilter=E.aj(je.filter,K),this.keyCache[ye.id]&&delete this.keyCache[ye.id]}for(const ye of $)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ue=E.cL(Object.values(this._layerConfigs),this.keyCache);for(const ye of ue){const je=ye.map((Bt=>this._layers[Bt.id])),Le=je[0];if(Le.isHidden())continue;const Me=Le.source||"";let Oe=this.familiesBySource[Me];Oe||(Oe=this.familiesBySource[Me]={});const Je=Le.sourceLayer||E.ai;let ft=Oe[Je];ft||(ft=Oe[Je]=[]),ft.push(je)}}}class O{constructor(W){const $={},K=[];for(const Le in W){const Me=W[Le],Oe=$[Le]={};for(const Je in Me){const ft=Me[+Je];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;const Bt={x:0,y:0,w:ft.bitmap.width+2,h:ft.bitmap.height+2};K.push(Bt),Oe[Je]={rect:Bt,metrics:ft.metrics}}}const{w:ue,h:ye}=E.p(K),je=new E.r({width:ue||1,height:ye||1});for(const Le in W){const Me=W[Le];for(const Oe in Me){const Je=Me[+Oe];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const ft=$[Le][Oe].rect;E.r.copy(Je.bitmap,je,{x:0,y:0},{x:ft.x+1,y:ft.y+1},Je.bitmap)}}this.image=je,this.positions=$}}E.cM("GlyphAtlas",O);class Y{constructor(W){this.tileID=new E.a2(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,$,K,ue,ye){return E._(this,void 0,void 0,(function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new E.ag;const je=new E.cN(Object.keys(W.layers).sort()),Le=new E.cO(this.tileID,this.promoteId);Le.bucketLayerIDs=[];const Me={},Oe={featureIndex:Le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:K,subdivisionGranularity:ye},Je=$.familiesBySource[this.source];for(const ii in Je){const Ui=W.layers[ii];if(!Ui)continue;Ui.version===1&&E.w(`Vector tile source "${this.source}" layer "${ii}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Is=je.encode(ii),ds=[];for(let kt=0;kt<Ui.length;kt++){const br=Ui.feature(kt),hr=Le.getId(br,ii);ds.push({feature:br,id:hr,index:kt,sourceLayerIndex:Is})}for(const kt of Je[ii]){const br=kt[0];br.source!==this.source&&E.w(`layer.source = ${br.source} does not equal this.source = ${this.source}`),br.isHidden(this.zoom,!0)||(ie(kt,this.zoom,K),(Me[br.id]=br.createBucket({index:Le.bucketLayerIDs.length,layers:kt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Is,sourceID:this.source})).populate(ds,Oe,this.tileID.canonical),Le.bucketLayerIDs.push(kt.map((hr=>hr.id))))}}const ft=E.bY(Oe.glyphDependencies,(ii=>Object.keys(ii).map(Number)));this.inFlightDependencies.forEach((ii=>ii?.abort())),this.inFlightDependencies=[];let Bt=Promise.resolve({});if(Object.keys(ft).length){const ii=new AbortController;this.inFlightDependencies.push(ii),Bt=ue.sendAsync({type:"GG",data:{stacks:ft,source:this.source,tileID:this.tileID,type:"glyphs"}},ii)}const Wt=Object.keys(Oe.iconDependencies);let Jt=Promise.resolve({});if(Wt.length){const ii=new AbortController;this.inFlightDependencies.push(ii),Jt=ue.sendAsync({type:"GI",data:{icons:Wt,source:this.source,tileID:this.tileID,type:"icons"}},ii)}const pn=Object.keys(Oe.patternDependencies);let Mn=Promise.resolve({});if(pn.length){const ii=new AbortController;this.inFlightDependencies.push(ii),Mn=ue.sendAsync({type:"GI",data:{icons:pn,source:this.source,tileID:this.tileID,type:"patterns"}},ii)}const Ve=Oe.dashDependencies;let Pn=Promise.resolve({});if(Object.keys(Ve).length){const ii=new AbortController;this.inFlightDependencies.push(ii),Pn=ue.sendAsync({type:"GDA",data:{dashes:Ve}},ii)}const[Fi,yn,qn,ir]=yield Promise.all([Bt,Jt,Mn,Pn]),ei=new O(Fi),Ti=new E.cP(yn,qn);for(const ii in Me){const Ui=Me[ii];Ui instanceof E.ah?(ie(Ui.layers,this.zoom,K),E.cQ({bucket:Ui,glyphMap:Fi,glyphPositions:ei.positions,imageMap:yn,imagePositions:Ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Oe.subdivisionGranularity})):Ui.hasDependencies&&(Ui instanceof E.cR||Ui instanceof E.cS||Ui instanceof E.cT)&&(ie(Ui.layers,this.zoom,K),Ui.addFeatures(Oe,this.tileID.canonical,Ti.patternPositions,ir))}return this.status="done",{buckets:Object.values(Me).filter((ii=>!ii.isEmpty())),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ei.image,imageAtlas:Ti,dashPositions:ir,glyphMap:this.returnDependencies?Fi:null,iconMap:this.returnDependencies?yn:null,glyphPositions:this.returnDependencies?ei.positions:null}}))}}function ie(Ue,W,$){const K=new E.H(W);for(const ue of Ue)ue.recalculate(K,$)}class ne{constructor(W,$,K,ue,ye){this.type=W,this.properties=K||{},this.extent=ye,this.pointsArray=$,this.id=ue}loadGeometry(){return this.pointsArray.map((W=>W.map(($=>new E.P($.x,$.y)))))}}class ze{constructor(W,$,K){this.version=2,this._myFeatures=W,this.name=$,this.length=W.length,this.extent=K}feature(W){return this._myFeatures[W]}}class Ce{constructor(){this.layers={}}addLayer(W){this.layers[W.name]=W}}function be(Ue){let W=E.cU(Ue);return W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),{vectorTile:Ue,rawData:W.buffer}}function he(Ue,W,$){const{extent:K}=Ue,ue=Math.pow(2,$.z-W.z),ye=($.x-W.x*ue)*K,je=($.y-W.y*ue)*K,Le=[];for(let Me=0;Me<Ue.length;Me++){const Oe=Ue.feature(Me);let Je=Oe.loadGeometry();for(const Bt of Je)for(const Wt of Bt)Wt.x=Wt.x*ue-ye,Wt.y=Wt.y*ue-je;const ft=128;Je=E.cV(Je,Oe.type,-ft,-ft,K+ft,K+ft),Je.length!==0&&Le.push(new ne(Oe.type,Je,Oe.properties,Oe.id,K))}return new ze(Le,Ue.name,K)}class te{constructor(W,$,K){this.actor=W,this.layerIndex=$,this.availableImages=K,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new E.cW(1e3)}loadVectorTile(W,$){return E._(this,void 0,void 0,(function*(){const K=yield E.n(W.request,$);try{return{vectorTile:W.encoding!=="mlt"?new E.cX(new E.cY(K.data)):new E.cZ(K.data),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(ue){const ye=new Uint8Array(K.data);let je=`Unable to parse the tile at ${W.request.url}, `;throw je+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(je)}}))}loadTile(W){return E._(this,void 0,void 0,(function*(){const{uid:$,overzoomParameters:K}=W;K&&(W.request=K.overzoomRequest);const ue=!!(W&&W.request&&W.request.collectResourceTiming)&&new E.c_(W.request),ye=new Y(W);this.loading[$]=ye;const je=new AbortController;ye.abort=je;try{const Le=yield this.loadVectorTile(W,je);if(delete this.loading[$],!Le)return null;if(K){const Bt=this._getOverzoomTile(W,Le.vectorTile);Le.rawData=Bt.rawData,Le.vectorTile=Bt.vectorTile}const Me=Le.rawData,Oe={};Le.expires&&(Oe.expires=Le.expires),Le.cacheControl&&(Oe.cacheControl=Le.cacheControl);const Je={};if(ue){const Bt=ue.finish();Bt&&(Je.resourceTiming=JSON.parse(JSON.stringify(Bt)))}ye.vectorTile=Le.vectorTile;const ft=ye.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[$]=ye,this.fetching[$]={rawTileData:Me,cacheControl:Oe,resourceTiming:Je};try{const Bt=yield ft;return E.e({rawTileData:Me.slice(0),encoding:W.encoding},Bt,Oe,Je)}finally{delete this.fetching[$]}}catch(Le){throw delete this.loading[$],ye.status="done",this.loaded[$]=ye,Le}}))}_getOverzoomTile(W,$){const{tileID:K,source:ue,overzoomParameters:ye}=W,{maxZoomTileID:je}=ye,Le=`${je.key}_${K.key}`,Me=this.overzoomedTileResultCache.get(Le);if(Me)return Me;const Oe=new Ce,Je=this.layerIndex.familiesBySource[ue];for(const Bt in Je){const Wt=$.layers[Bt];if(!Wt)continue;const Jt=he(Wt,je,K.canonical);Jt.length>0&&Oe.addLayer(Jt)}const ft=be(Oe);return this.overzoomedTileResultCache.set(Le,ft),ft}reloadTile(W){return E._(this,void 0,void 0,(function*(){const $=W.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const K=this.loaded[$];if(K.showCollisionBoxes=W.showCollisionBoxes,K.status==="parsing"){const ue=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let ye;if(this.fetching[$]){const{rawTileData:je,cacheControl:Le,resourceTiming:Me}=this.fetching[$];delete this.fetching[$],ye=E.e({rawTileData:je.slice(0),encoding:W.encoding},ue,Le,Me)}else ye=ue;return ye}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)}))}abortTile(W){return E._(this,void 0,void 0,(function*(){const $=this.loading,K=W.uid;$&&$[K]&&$[K].abort&&($[K].abort.abort(),delete $[K])}))}removeTile(W){return E._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]}))}}class ve{constructor(){this.loaded={}}loadTile(W){return E._(this,void 0,void 0,(function*(){const{uid:$,encoding:K,rawImageData:ue,redFactor:ye,greenFactor:je,blueFactor:Le,baseShift:Me}=W,Oe=ue.width+2,Je=ue.height+2,ft=E.b(ue)?new E.R({width:Oe,height:Je},yield E.c$(ue,-1,-1,Oe,Je)):ue,Bt=new E.d0($,ft,K,ye,je,Le,Me);return this.loaded=this.loaded||{},this.loaded[$]=Bt,Bt}))}removeTile(W){const $=this.loaded,K=W.uid;$&&$[K]&&delete $[K]}}var qe,lt,Pt=(function(){if(lt)return qe;function Ue($,K){if($.length!==0){W($[0],K);for(var ue=1;ue<$.length;ue++)W($[ue],!K)}}function W($,K){for(var ue=0,ye=0,je=0,Le=$.length,Me=Le-1;je<Le;Me=je++){var Oe=($[je][0]-$[Me][0])*($[Me][1]+$[je][1]),Je=ue+Oe;ye+=Math.abs(ue)>=Math.abs(Oe)?ue-Je+Oe:Oe-Je+ue,ue=Je}ue+ye>=0!=!!K&&$.reverse()}return lt=1,qe=function $(K,ue){var ye,je=K&&K.type;if(je==="FeatureCollection")for(ye=0;ye<K.features.length;ye++)$(K.features[ye],ue);else if(je==="GeometryCollection")for(ye=0;ye<K.geometries.length;ye++)$(K.geometries[ye],ue);else if(je==="Feature")$(K.geometry,ue);else if(je==="Polygon")Ue(K.coordinates,ue);else if(je==="MultiPolygon")for(ye=0;ye<K.coordinates.length;ye++)Ue(K.coordinates[ye],ue);return K}})(),Et=E.d1(Pt);const St={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},nt=Math.fround||(Be=new Float32Array(1),Ue=>(Be[0]=+Ue,Be[0]));var Be;class it{constructor(W){this.options=Object.assign(Object.create(St),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:$,minZoom:K,maxZoom:ue}=this.options;$&&console.time("total time");const ye=`prepare ${W.length} points`;$&&console.time(ye),this.points=W;const je=[];for(let Me=0;Me<W.length;Me++){const Oe=W[Me];if(!Oe.geometry)continue;const[Je,ft]=Oe.geometry.coordinates,Bt=nt(Qe(Je)),Wt=nt(ut(ft));je.push(Bt,Wt,1/0,Me,-1,1),this.options.reduce&&je.push(0)}let Le=this.trees[ue+1]=this._createTree(je);$&&console.timeEnd(ye);for(let Me=ue;Me>=K;Me--){const Oe=+Date.now();Le=this.trees[Me]=this._createTree(this._cluster(Le,Me)),$&&console.log("z%d: %d clusters in %dms",Me,Le.numItems,+Date.now()-Oe)}return $&&console.timeEnd("total time"),this}getClusters(W,$){let K=((W[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,W[1]));let ye=W[2]===180?180:((W[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)K=-180,ye=180;else if(K>ye){const ft=this.getClusters([K,ue,180,je],$),Bt=this.getClusters([-180,ue,ye,je],$);return ft.concat(Bt)}const Le=this.trees[this._limitZoom($)],Me=Le.range(Qe(K),ut(je),Qe(ye),ut(ue)),Oe=Le.data,Je=[];for(const ft of Me){const Bt=this.stride*ft;Je.push(Oe[Bt+5]>1?$e(Oe,Bt,this.clusterProps):this.points[Oe[Bt+3]])}return Je}getChildren(W){const $=this._getOriginId(W),K=this._getOriginZoom(W),ue="No cluster with the specified id.",ye=this.trees[K];if(!ye)throw new Error(ue);const je=ye.data;if($*this.stride>=je.length)throw new Error(ue);const Le=this.options.radius/(this.options.extent*Math.pow(2,K-1)),Me=ye.within(je[$*this.stride],je[$*this.stride+1],Le),Oe=[];for(const Je of Me){const ft=Je*this.stride;je[ft+4]===W&&Oe.push(je[ft+5]>1?$e(je,ft,this.clusterProps):this.points[je[ft+3]])}if(Oe.length===0)throw new Error(ue);return Oe}getLeaves(W,$,K){const ue=[];return this._appendLeaves(ue,W,$=$||10,K=K||0,0),ue}getTile(W,$,K){const ue=this.trees[this._limitZoom(W)],ye=Math.pow(2,W),{extent:je,radius:Le}=this.options,Me=Le/je,Oe=(K-Me)/ye,Je=(K+1+Me)/ye,ft={features:[]};return this._addTileFeatures(ue.range(($-Me)/ye,Oe,($+1+Me)/ye,Je),ue.data,$,K,ye,ft),$===0&&this._addTileFeatures(ue.range(1-Me/ye,Oe,1,Je),ue.data,ye,K,ye,ft),$===ye-1&&this._addTileFeatures(ue.range(0,Oe,Me/ye,Je),ue.data,-1,K,ye,ft),ft.features.length?ft:null}getClusterExpansionZoom(W){let $=this._getOriginZoom(W)-1;for(;$<=this.options.maxZoom;){const K=this.getChildren(W);if($++,K.length!==1)break;W=K[0].properties.cluster_id}return $}_appendLeaves(W,$,K,ue,ye){const je=this.getChildren($);for(const Le of je){const Me=Le.properties;if(Me&&Me.cluster?ye+Me.point_count<=ue?ye+=Me.point_count:ye=this._appendLeaves(W,Me.cluster_id,K,ue,ye):ye<ue?ye++:W.push(Le),W.length===K)break}return ye}_createTree(W){const $=new E.aT(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<W.length;K+=this.stride)$.add(W[K],W[K+1]);return $.finish(),$.data=W,$}_addTileFeatures(W,$,K,ue,ye,je){for(const Le of W){const Me=Le*this.stride,Oe=$[Me+5]>1;let Je,ft,Bt;if(Oe)Je=we($,Me,this.clusterProps),ft=$[Me],Bt=$[Me+1];else{const pn=this.points[$[Me+3]];Je=pn.properties;const[Mn,Ve]=pn.geometry.coordinates;ft=Qe(Mn),Bt=ut(Ve)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(ft*ye-K)),Math.round(this.options.extent*(Bt*ye-ue))]],tags:Je};let Jt;Jt=Oe||this.options.generateId?$[Me+3]:this.points[$[Me+3]].id,Jt!==void 0&&(Wt.id=Jt),je.features.push(Wt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,$){const{radius:K,extent:ue,reduce:ye,minPoints:je}=this.options,Le=K/(ue*Math.pow(2,$)),Me=W.data,Oe=[],Je=this.stride;for(let ft=0;ft<Me.length;ft+=Je){if(Me[ft+2]<=$)continue;Me[ft+2]=$;const Bt=Me[ft],Wt=Me[ft+1],Jt=W.within(Me[ft],Me[ft+1],Le),pn=Me[ft+5];let Mn=pn;for(const Ve of Jt){const Pn=Ve*Je;Me[Pn+2]>$&&(Mn+=Me[Pn+5])}if(Mn>pn&&Mn>=je){let Ve,Pn=Bt*pn,Fi=Wt*pn,yn=-1;const qn=(ft/Je<<5)+($+1)+this.points.length;for(const ir of Jt){const ei=ir*Je;if(Me[ei+2]<=$)continue;Me[ei+2]=$;const Ti=Me[ei+5];Pn+=Me[ei]*Ti,Fi+=Me[ei+1]*Ti,Me[ei+4]=qn,ye&&(Ve||(Ve=this._map(Me,ft,!0),yn=this.clusterProps.length,this.clusterProps.push(Ve)),ye(Ve,this._map(Me,ei)))}Me[ft+4]=qn,Oe.push(Pn/Mn,Fi/Mn,1/0,qn,-1,Mn),ye&&Oe.push(yn)}else{for(let Ve=0;Ve<Je;Ve++)Oe.push(Me[ft+Ve]);if(Mn>1)for(const Ve of Jt){const Pn=Ve*Je;if(!(Me[Pn+2]<=$)){Me[Pn+2]=$;for(let Fi=0;Fi<Je;Fi++)Oe.push(Me[Pn+Fi])}}}}return Oe}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,$,K){if(W[$+5]>1){const je=this.clusterProps[W[$+6]];return K?Object.assign({},je):je}const ue=this.points[W[$+3]].properties,ye=this.options.map(ue);return K&&ye===ue?Object.assign({},ye):ye}}function $e(Ue,W,$){return{type:"Feature",id:Ue[W+3],properties:we(Ue,W,$),geometry:{type:"Point",coordinates:[(K=Ue[W],360*(K-.5)),Ye(Ue[W+1])]}};var K}function we(Ue,W,$){const K=Ue[W+5],ue=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,ye=Ue[W+6],je=ye===-1?{}:Object.assign({},$[ye]);return Object.assign(je,{cluster:!0,cluster_id:Ue[W+3],point_count:K,point_count_abbreviated:ue})}function Qe(Ue){return Ue/360+.5}function ut(Ue){const W=Math.sin(Ue*Math.PI/180),$=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return $<0?0:$>1?1:$}function Ye(Ue){const W=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Ie(Ue,W,$,K){let ue=K;const ye=W+($-W>>1);let je,Le=$-W;const Me=Ue[W],Oe=Ue[W+1],Je=Ue[$],ft=Ue[$+1];for(let Bt=W+3;Bt<$;Bt+=3){const Wt=le(Ue[Bt],Ue[Bt+1],Me,Oe,Je,ft);if(Wt>ue)je=Bt,ue=Wt;else if(Wt===ue){const Jt=Math.abs(Bt-ye);Jt<Le&&(je=Bt,Le=Jt)}}ue>K&&(je-W>3&&Ie(Ue,W,je,K),Ue[je+2]=ue,$-je>3&&Ie(Ue,je,$,K))}function le(Ue,W,$,K,ue,ye){let je=ue-$,Le=ye-K;if(je!==0||Le!==0){const Me=((Ue-$)*je+(W-K)*Le)/(je*je+Le*Le);Me>1?($=ue,K=ye):Me>0&&($+=je*Me,K+=Le*Me)}return je=Ue-$,Le=W-K,je*je+Le*Le}function ke(Ue,W,$,K){const ue={id:Ue??null,type:W,geometry:$,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")De(ue,$);else if(W==="Polygon")De(ue,$[0]);else if(W==="MultiLineString")for(const ye of $)De(ue,ye);else if(W==="MultiPolygon")for(const ye of $)De(ue,ye[0]);return ue}function De(Ue,W){for(let $=0;$<W.length;$+=3)Ue.minX=Math.min(Ue.minX,W[$]),Ue.minY=Math.min(Ue.minY,W[$+1]),Ue.maxX=Math.max(Ue.maxX,W[$]),Ue.maxY=Math.max(Ue.maxY,W[$+1])}function Fe(Ue,W,$,K){if(!W.geometry)return;const ue=W.geometry.coordinates;if(ue&&ue.length===0)return;const ye=W.geometry.type,je=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let Le=[],Me=W.id;if($.promoteId?Me=W.properties[$.promoteId]:$.generateId&&(Me=K||0),ye==="Point")bt(ue,Le);else if(ye==="MultiPoint")for(const Oe of ue)bt(Oe,Le);else if(ye==="LineString")de(ue,Le,je,!1);else if(ye==="MultiLineString"){if($.lineMetrics){for(const Oe of ue)Le=[],de(Oe,Le,je,!1),Ue.push(ke(Me,"LineString",Le,W.properties));return}He(ue,Le,je,!1)}else if(ye==="Polygon")He(ue,Le,je,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const Oe of W.geometry.geometries)Fe(Ue,{id:Me,geometry:Oe,properties:W.properties},$,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oe of ue){const Je=[];He(Oe,Je,je,!0),Le.push(Je)}}Ue.push(ke(Me,ye,Le,W.properties))}function bt(Ue,W){W.push(_t(Ue[0]),It(Ue[1]),0)}function de(Ue,W,$,K){let ue,ye,je=0;for(let Me=0;Me<Ue.length;Me++){const Oe=_t(Ue[Me][0]),Je=It(Ue[Me][1]);W.push(Oe,Je,0),Me>0&&(je+=K?(ue*Je-Oe*ye)/2:Math.sqrt(Math.pow(Oe-ue,2)+Math.pow(Je-ye,2))),ue=Oe,ye=Je}const Le=W.length-3;W[2]=1,Ie(W,0,Le,$),W[Le+2]=1,W.size=Math.abs(je),W.start=0,W.end=W.size}function He(Ue,W,$,K){for(let ue=0;ue<Ue.length;ue++){const ye=[];de(Ue[ue],ye,$,K),W.push(ye)}}function _t(Ue){return Ue/360+.5}function It(Ue){const W=Math.sin(Ue*Math.PI/180),$=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return $<0?0:$>1?1:$}function Ze(Ue,W,$,K,ue,ye,je,Le){if(K/=W,ye>=($/=W)&&je<K)return Ue;if(je<$||ye>=K)return null;const Me=[];for(const Oe of Ue){const Je=Oe.geometry;let ft=Oe.type;const Bt=ue===0?Oe.minX:Oe.minY,Wt=ue===0?Oe.maxX:Oe.maxY;if(Bt>=$&&Wt<K){Me.push(Oe);continue}if(Wt<$||Bt>=K)continue;let Jt=[];if(ft==="Point"||ft==="MultiPoint")Dt(Je,Jt,$,K,ue);else if(ft==="LineString")jt(Je,Jt,$,K,ue,!1,Le.lineMetrics);else if(ft==="MultiLineString")Ot(Je,Jt,$,K,ue,!1);else if(ft==="Polygon")Ot(Je,Jt,$,K,ue,!0);else if(ft==="MultiPolygon")for(const pn of Je){const Mn=[];Ot(pn,Mn,$,K,ue,!0),Mn.length&&Jt.push(Mn)}if(Jt.length){if(Le.lineMetrics&&ft==="LineString"){for(const pn of Jt)Me.push(ke(Oe.id,ft,pn,Oe.tags));continue}ft!=="LineString"&&ft!=="MultiLineString"||(Jt.length===1?(ft="LineString",Jt=Jt[0]):ft="MultiLineString"),ft!=="Point"&&ft!=="MultiPoint"||(ft=Jt.length===3?"Point":"MultiPoint"),Me.push(ke(Oe.id,ft,Jt,Oe.tags))}}return Me.length?Me:null}function Dt(Ue,W,$,K,ue){for(let ye=0;ye<Ue.length;ye+=3){const je=Ue[ye+ue];je>=$&&je<=K&&ln(W,Ue[ye],Ue[ye+1],Ue[ye+2])}}function jt(Ue,W,$,K,ue,ye,je){let Le=$t(Ue);const Me=ue===0?dn:rn;let Oe,Je,ft=Ue.start;for(let Mn=0;Mn<Ue.length-3;Mn+=3){const Ve=Ue[Mn],Pn=Ue[Mn+1],Fi=Ue[Mn+2],yn=Ue[Mn+3],qn=Ue[Mn+4],ir=ue===0?Ve:Pn,ei=ue===0?yn:qn;let Ti=!1;je&&(Oe=Math.sqrt(Math.pow(Ve-yn,2)+Math.pow(Pn-qn,2))),ir<$?ei>$&&(Je=Me(Le,Ve,Pn,yn,qn,$),je&&(Le.start=ft+Oe*Je)):ir>K?ei<K&&(Je=Me(Le,Ve,Pn,yn,qn,K),je&&(Le.start=ft+Oe*Je)):ln(Le,Ve,Pn,Fi),ei<$&&ir>=$&&(Je=Me(Le,Ve,Pn,yn,qn,$),Ti=!0),ei>K&&ir<=K&&(Je=Me(Le,Ve,Pn,yn,qn,K),Ti=!0),!ye&&Ti&&(je&&(Le.end=ft+Oe*Je),W.push(Le),Le=$t(Ue)),je&&(ft+=Oe)}let Bt=Ue.length-3;const Wt=Ue[Bt],Jt=Ue[Bt+1],pn=ue===0?Wt:Jt;pn>=$&&pn<=K&&ln(Le,Wt,Jt,Ue[Bt+2]),Bt=Le.length-3,ye&&Bt>=3&&(Le[Bt]!==Le[0]||Le[Bt+1]!==Le[1])&&ln(Le,Le[0],Le[1],Le[2]),Le.length&&W.push(Le)}function $t(Ue){const W=[];return W.size=Ue.size,W.start=Ue.start,W.end=Ue.end,W}function Ot(Ue,W,$,K,ue,ye){for(const je of Ue)jt(je,W,$,K,ue,ye,!1)}function ln(Ue,W,$,K){Ue.push(W,$,K)}function dn(Ue,W,$,K,ue,ye){const je=(ye-W)/(K-W);return ln(Ue,ye,$+(ue-$)*je,1),je}function rn(Ue,W,$,K,ue,ye){const je=(ye-$)/(ue-$);return ln(Ue,W+(K-W)*je,ye,1),je}function gt(Ue,W){const $=[];for(let K=0;K<Ue.length;K++){const ue=Ue[K],ye=ue.type;let je;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")je=xt(ue.geometry,W);else if(ye==="MultiLineString"||ye==="Polygon"){je=[];for(const Le of ue.geometry)je.push(xt(Le,W))}else if(ye==="MultiPolygon"){je=[];for(const Le of ue.geometry){const Me=[];for(const Oe of Le)Me.push(xt(Oe,W));je.push(Me)}}$.push(ke(ue.id,ye,je,ue.tags))}return $}function xt(Ue,W){const $=[];$.size=Ue.size,Ue.start!==void 0&&($.start=Ue.start,$.end=Ue.end);for(let K=0;K<Ue.length;K+=3)$.push(Ue[K]+W,Ue[K+1],Ue[K+2]);return $}function zt(Ue,W){if(Ue.transformed)return Ue;const $=1<<Ue.z,K=Ue.x,ue=Ue.y;for(const ye of Ue.features){const je=ye.geometry,Le=ye.type;if(ye.geometry=[],Le===1)for(let Me=0;Me<je.length;Me+=2)ye.geometry.push(qt(je[Me],je[Me+1],W,$,K,ue));else for(let Me=0;Me<je.length;Me++){const Oe=[];for(let Je=0;Je<je[Me].length;Je+=2)Oe.push(qt(je[Me][Je],je[Me][Je+1],W,$,K,ue));ye.geometry.push(Oe)}}return Ue.transformed=!0,Ue}function qt(Ue,W,$,K,ue,ye){return[Math.round($*(Ue*K-ue)),Math.round($*(W*K-ye))]}function Gt(Ue,W,$,K,ue){const ye=W===ue.maxZoom?0:ue.tolerance/((1<<W)*ue.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Ue.length,source:null,x:$,y:K,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Le of Ue)gn(je,Le,ye,ue);return je}function gn(Ue,W,$,K){const ue=W.geometry,ye=W.type,je=[];if(Ue.minX=Math.min(Ue.minX,W.minX),Ue.minY=Math.min(Ue.minY,W.minY),Ue.maxX=Math.max(Ue.maxX,W.maxX),Ue.maxY=Math.max(Ue.maxY,W.maxY),ye==="Point"||ye==="MultiPoint")for(let Le=0;Le<ue.length;Le+=3)je.push(ue[Le],ue[Le+1]),Ue.numPoints++,Ue.numSimplified++;else if(ye==="LineString")Rn(je,ue,Ue,$,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Le=0;Le<ue.length;Le++)Rn(je,ue[Le],Ue,$,ye==="Polygon",Le===0);else if(ye==="MultiPolygon")for(let Le=0;Le<ue.length;Le++){const Me=ue[Le];for(let Oe=0;Oe<Me.length;Oe++)Rn(je,Me[Oe],Ue,$,!0,Oe===0)}if(je.length){let Le=W.tags||null;if(ye==="LineString"&&K.lineMetrics){Le={};for(const Oe in W.tags)Le[Oe]=W.tags[Oe];Le.mapbox_clip_start=ue.start/ue.size,Le.mapbox_clip_end=ue.end/ue.size}const Me={geometry:je,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Le};W.id!==null&&(Me.id=W.id),Ue.features.push(Me)}}function Rn(Ue,W,$,K,ue,ye){const je=K*K;if(K>0&&W.size<(ue?je:K))return void($.numPoints+=W.length/3);const Le=[];for(let Me=0;Me<W.length;Me+=3)(K===0||W[Me+2]>je)&&($.numSimplified++,Le.push(W[Me],W[Me+1])),$.numPoints++;ue&&(function(Me,Oe){let Je=0;for(let ft=0,Bt=Me.length,Wt=Bt-2;ft<Bt;Wt=ft,ft+=2)Je+=(Me[ft]-Me[Wt])*(Me[ft+1]+Me[Wt+1]);if(Je>0===Oe)for(let ft=0,Bt=Me.length;ft<Bt/2;ft+=2){const Wt=Me[ft],Jt=Me[ft+1];Me[ft]=Me[Bt-2-ft],Me[ft+1]=Me[Bt-1-ft],Me[Bt-2-ft]=Wt,Me[Bt-1-ft]=Jt}})(Le,ye),Ue.push(Le)}const bn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Zn{constructor(W,$){const K=($=this.options=(function(ye,je){for(const Le in je)ye[Le]=je[Le];return ye})(Object.create(bn),$)).debug;if(K&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=(function(ye,je){const Le=[];if(ye.type==="FeatureCollection")for(let Me=0;Me<ye.features.length;Me++)Fe(Le,ye.features[Me],je,Me);else Fe(Le,ye.type==="Feature"?ye:{geometry:ye},je);return Le})(W,$);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=(function(ye,je){const Le=je.buffer/je.extent;let Me=ye;const Oe=Ze(ye,1,-1-Le,Le,0,-1,2,je),Je=Ze(ye,1,1-Le,2+Le,0,-1,2,je);return(Oe||Je)&&(Me=Ze(ye,1,-Le,1+Le,0,-1,2,je)||[],Oe&&(Me=gt(Oe,1).concat(Me)),Je&&(Me=Me.concat(gt(Je,-1)))),Me})(ue,$),ue.length&&this.splitTile(ue,0,0,0),K&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,$,K,ue,ye,je,Le){const Me=[W,$,K,ue],Oe=this.options,Je=Oe.debug;for(;Me.length;){ue=Me.pop(),K=Me.pop(),$=Me.pop(),W=Me.pop();const ft=1<<$,Bt=Ln($,K,ue);let Wt=this.tiles[Bt];if(!Wt&&(Je>1&&console.time("creation"),Wt=this.tiles[Bt]=Gt(W,$,K,ue,Oe),this.tileCoords.push({z:$,x:K,y:ue}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,K,ue,Wt.numFeatures,Wt.numPoints,Wt.numSimplified),console.timeEnd("creation"));const Ti=`z${$}`;this.stats[Ti]=(this.stats[Ti]||0)+1,this.total++}if(Wt.source=W,ye==null){if($===Oe.indexMaxZoom||Wt.numPoints<=Oe.indexMaxPoints)continue}else{if($===Oe.maxZoom||$===ye)continue;if(ye!=null){const Ti=ye-$;if(K!==je>>Ti||ue!==Le>>Ti)continue}}if(Wt.source=null,W.length===0)continue;Je>1&&console.time("clipping");const Jt=.5*Oe.buffer/Oe.extent,pn=.5-Jt,Mn=.5+Jt,Ve=1+Jt;let Pn=null,Fi=null,yn=null,qn=null,ir=Ze(W,ft,K-Jt,K+Mn,0,Wt.minX,Wt.maxX,Oe),ei=Ze(W,ft,K+pn,K+Ve,0,Wt.minX,Wt.maxX,Oe);W=null,ir&&(Pn=Ze(ir,ft,ue-Jt,ue+Mn,1,Wt.minY,Wt.maxY,Oe),Fi=Ze(ir,ft,ue+pn,ue+Ve,1,Wt.minY,Wt.maxY,Oe),ir=null),ei&&(yn=Ze(ei,ft,ue-Jt,ue+Mn,1,Wt.minY,Wt.maxY,Oe),qn=Ze(ei,ft,ue+pn,ue+Ve,1,Wt.minY,Wt.maxY,Oe),ei=null),Je>1&&console.timeEnd("clipping"),Me.push(Pn||[],$+1,2*K,2*ue),Me.push(Fi||[],$+1,2*K,2*ue+1),Me.push(yn||[],$+1,2*K+1,2*ue),Me.push(qn||[],$+1,2*K+1,2*ue+1)}}getTile(W,$,K){W=+W,$=+$,K=+K;const ue=this.options,{extent:ye,debug:je}=ue;if(W<0||W>24)return null;const Le=1<<W,Me=Ln(W,$=$+Le&Le-1,K);if(this.tiles[Me])return zt(this.tiles[Me],ye);je>1&&console.log("drilling down to z%d-%d-%d",W,$,K);let Oe,Je=W,ft=$,Bt=K;for(;!Oe&&Je>0;)Je--,ft>>=1,Bt>>=1,Oe=this.tiles[Ln(Je,ft,Bt)];return Oe&&Oe.source?(je>1&&(console.log("found parent tile z%d-%d-%d",Je,ft,Bt),console.time("drilling down")),this.splitTile(Oe.source,Je,ft,Bt,W,$,K),je>1&&console.timeEnd("drilling down"),this.tiles[Me]?zt(this.tiles[Me],ye):null):null}}function Ln(Ue,W,$){return 32*((1<<Ue)*$+W)+Ue}class Wi extends te{constructor(W,$,K,ue=kn){super(W,$,K),this._dataUpdateable=new Map,this._createGeoJSONIndex=ue}loadVectorTile(W,$){return E._(this,void 0,void 0,(function*(){const K=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(K.z,K.x,K.y);return ue?be(new E.d2(ue.features,{version:2,extent:E.a5})):null}))}loadData(W){return E._(this,void 0,void 0,(function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const K=this._startPerformance(W);this._pendingRequest=new AbortController;try{(!this._pendingData||W.request||W.data||W.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest));const ue=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ue,W),this.loaded={};const ye={};return W.request&&(ye.data=ue),this._finishPerformance(K,W,ye),ye}catch(ue){if(delete this._pendingRequest,E.Z(ue))return{abandoned:!0};throw ue}}))}_startPerformance(W){var $;if(!(($=W?.request)===null||$===void 0)&&$.collectResourceTiming)return new E.c_(W.request)}_finishPerformance(W,$,K){if(!W)return;const ue=W.finish();ue&&(K.resourceTiming={},K.resourceTiming[$.source]=JSON.parse(JSON.stringify(ue)))}getData(){return E._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(W){const $=this.loaded;return $&&$[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,$){return E._(this,void 0,void 0,(function*(){let K;if(W.request?K=yield this.loadGeoJSONFromUrl(W.request,W.promoteId,$):W.data?K=this._loadGeoJSONFromObject(W.data,W.promoteId):W.dataDiff&&(K=this._loadGeoJSONFromDiff(W.dataDiff,W.promoteId,W.source)),delete this._pendingRequest,typeof K!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);return Et(K,!0),W.filter&&(K=this._filterGeoJSON(K,W.filter)),K}))}loadGeoJSONFromUrl(W,$,K){return E._(this,void 0,void 0,(function*(){const ue=yield E.j(W,K);return this._dataUpdateable=E.a7(ue.data,$),ue.data}))}_loadGeoJSONFromObject(W,$){return this._dataUpdateable=E.a7(W,$),W}_loadGeoJSONFromDiff(W,$,K){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K}`);E.a8(this._dataUpdateable,W,$);const ue=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ue)}_filterGeoJSON(W,$){const K=E.d3($,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map((ye=>`${ye.key}: ${ye.message}`)).join(", "));const ue=W.features.filter((ye=>K.value.evaluate({zoom:0},ye)));return this._toFeatureCollection(ue)}_toFeatureCollection(W){return{type:"FeatureCollection",features:W}}removeSource(W){return E._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}function kn(Ue,W){return W.cluster?new it((function({superclusterOptions:$,clusterProperties:K}){if(!K||!$)return $;const ue={},ye={},je={accumulated:null,zoom:0},Le={properties:null},Me=Object.keys(K);for(const Oe of Me){const[Je,ft]=K[Oe],Bt=E.d3(ft),Wt=E.d3(typeof Je=="string"?[Je,["accumulated"],["get",Oe]]:Je);ue[Oe]=Bt.value,ye[Oe]=Wt.value}return $.map=Oe=>{Le.properties=Oe;const Je={};for(const ft of Me)Je[ft]=ue[ft].evaluate(je,Le);return Je},$.reduce=(Oe,Je)=>{Le.properties=Je;for(const ft of Me)je.accumulated=Oe[ft],Oe[ft]=ye[ft].evaluate(je,Le)},$})(W)).load(Ue.features):(function($,K){return new Zn($,K)})(Ue,W.geojsonVtOptions)}class Cn{constructor(W){this.self=W,this.actor=new E.L(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=($,K)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=K},this.self.addProtocol=E.cJ,this.self.removeProtocol=E.cK,this.self.registerRTLTextPlugin=$=>{E.d4.setMethods($)},this.actor.registerMessageHandler("LDT",(($,K)=>this._getDEMWorkerSource($,K.source).loadTile(K))),this.actor.registerMessageHandler("RDT",(($,K)=>E._(this,void 0,void 0,(function*(){this._getDEMWorkerSource($,K.source).removeTile(K)})))),this.actor.registerMessageHandler("GCEZ",(($,K)=>E._(this,void 0,void 0,(function*(){return this._getWorkerSource($,K.type,K.source).getClusterExpansionZoom(K)})))),this.actor.registerMessageHandler("GCC",(($,K)=>E._(this,void 0,void 0,(function*(){return this._getWorkerSource($,K.type,K.source).getClusterChildren(K)})))),this.actor.registerMessageHandler("GCL",(($,K)=>E._(this,void 0,void 0,(function*(){return this._getWorkerSource($,K.type,K.source).getClusterLeaves(K)})))),this.actor.registerMessageHandler("LD",(($,K)=>this._getWorkerSource($,K.type,K.source).loadData(K))),this.actor.registerMessageHandler("GD",(($,K)=>this._getWorkerSource($,K.type,K.source).getData())),this.actor.registerMessageHandler("LT",(($,K)=>this._getWorkerSource($,K.type,K.source).loadTile(K))),this.actor.registerMessageHandler("RT",(($,K)=>this._getWorkerSource($,K.type,K.source).reloadTile(K))),this.actor.registerMessageHandler("AT",(($,K)=>this._getWorkerSource($,K.type,K.source).abortTile(K))),this.actor.registerMessageHandler("RMT",(($,K)=>this._getWorkerSource($,K.type,K.source).removeTile(K))),this.actor.registerMessageHandler("RS",(($,K)=>E._(this,void 0,void 0,(function*(){if(!this.workerSources[$]||!this.workerSources[$][K.type]||!this.workerSources[$][K.type][K.source])return;const ue=this.workerSources[$][K.type][K.source];delete this.workerSources[$][K.type][K.source],ue.removeSource!==void 0&&ue.removeSource(K)})))),this.actor.registerMessageHandler("RM",($=>E._(this,void 0,void 0,(function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],this.globalStates.delete($)})))),this.actor.registerMessageHandler("SR",(($,K)=>E._(this,void 0,void 0,(function*(){this.referrer=K})))),this.actor.registerMessageHandler("SRPS",(($,K)=>this._syncRTLPluginState($,K))),this.actor.registerMessageHandler("IS",(($,K)=>E._(this,void 0,void 0,(function*(){this.self.importScripts(K)})))),this.actor.registerMessageHandler("SI",(($,K)=>this._setImages($,K))),this.actor.registerMessageHandler("UL",(($,K)=>E._(this,void 0,void 0,(function*(){this._getLayerIndex($).update(K.layers,K.removedIds,this._getGlobalState($))})))),this.actor.registerMessageHandler("UGS",(($,K)=>E._(this,void 0,void 0,(function*(){const ue=this._getGlobalState($);for(const ye in K)ue[ye]=K[ye]})))),this.actor.registerMessageHandler("SL",(($,K)=>E._(this,void 0,void 0,(function*(){this._getLayerIndex($).replace(K,this._getGlobalState($))}))))}_getGlobalState(W){let $=this.globalStates.get(W);return $||($={},this.globalStates.set(W,$)),$}_setImages(W,$){return E._(this,void 0,void 0,(function*(){this.availableImages[W]=$;for(const K in this.workerSources[W]){const ue=this.workerSources[W][K];for(const ye in ue)ue[ye].availableImages=$}}))}_syncRTLPluginState(W,$){return E._(this,void 0,void 0,(function*(){return yield E.d4.syncState($,this.self.importScripts)}))}_getAvailableImages(W){let $=this.availableImages[W];return $||($=[]),$}_getLayerIndex(W){let $=this.layerIndexes[W];return $||($=this.layerIndexes[W]=new l),$}_getWorkerSource(W,$,K){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][$]||(this.workerSources[W][$]={}),!this.workerSources[W][$][K]){const ue={sendAsync:(ye,je)=>(ye.targetMapId=W,this.actor.sendAsync(ye,je))};switch($){case"vector":this.workerSources[W][$][K]=new te(ue,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][$][K]=new Wi(ue,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][$][K]=new this.externalWorkerSourceTypes[$](ue,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][$][K]}_getDEMWorkerSource(W,$){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][$]||(this.demWorkerSources[W][$]=new ve),this.demWorkerSources[W][$]}}return E.i(self)&&(self.worker=new Cn(self)),Cn})),M("index",["exports","./shared"],(function(E,l){var O="5.15.0";function Y(){var y=new l.A(4);return l.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let ie,ne,ze;const Ce={frame(y,t,a){const c=requestAnimationFrame((x=>{f(),t(x)})),{unsubscribe:f}=l.s(y.signal,"abort",(()=>{f(),cancelAnimationFrame(c),a(new l.a(y.signal.reason))}),!1)},frameAsync(y){return new Promise(((t,a)=>{this.frame(y,t,a)}))},getImageData(y,t=0){return this.getImageCanvasContext(y).getImageData(-t,-t,y.width+2*t,y.height+2*t)},getImageCanvasContext(y){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=y.width,t.height=y.height,a.drawImage(y,0,0,y.width,y.height),a},resolveURL:y=>(ie||(ie=document.createElement("a")),ie.href=y,ie.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ze!==void 0?ze:!!matchMedia&&(ne==null&&(ne=matchMedia("(prefers-reduced-motion: reduce)")),ne.matches)},set prefersReducedMotion(y){ze=y}},be=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(y){this._frozenAt=y}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function he(){return be.getCurrentTime()}class te{static testProp(t){if(!te.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in te.docStyle)return t[a];return t[0]}static create(t,a,c){const f=window.document.createElement(t);return a!==void 0&&(f.className=a),c&&c.appendChild(f),f}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){te.docStyle&&te.selectProp&&(te.userSelect=te.docStyle[te.selectProp],te.docStyle[te.selectProp]="none")}static enableDrag(){te.docStyle&&te.selectProp&&(te.docStyle[te.selectProp]=te.userSelect)}static setTransform(t,a){t.style[te.transformProp]=a}static addEventListener(t,a,c,f={}){t.addEventListener(a,c,"passive"in f?f:f.capture)}static removeEventListener(t,a,c,f={}){t.removeEventListener(a,c,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",te.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",te.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",te.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,c){const f=a.boundingClientRect;return new l.P((c.clientX-f.left)/a.x-t.clientLeft,(c.clientY-f.top)/a.y-t.clientTop)}static mousePos(t,a){const c=te.getScale(t);return te.getPoint(t,c,a)}static touchPos(t,a){const c=[],f=te.getScale(t);for(let x=0;x<a.length;x++)c.push(te.getPoint(t,f,a[x]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(const f of c)f.remove();return te.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const c of a)te.removeAttributes(c),te.clean(c)}static removeAttributes(t){for(const{name:a,value:c}of t.attributes)te.isPossiblyDangerous(a,c)&&t.removeAttribute(a)}}te.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,te.selectProp=te.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),te.transformProp=te.testProp(["transform","WebkitTransform"]);const ve={supported:!1,testSupport:function(y){!Pt&&lt&&(Et?St(y):qe=y)}};let qe,lt,Pt=!1,Et=!1;function St(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,lt),y.isContextLost())return;ve.supported=!0}catch{}y.deleteTexture(t),Pt=!0}var nt;typeof document<"u"&&(lt=document.createElement("img"),lt.onload=()=>{qe&&St(qe),qe=null,Et=!0},lt.onerror=()=>{Pt=!0,qe=null},lt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(y){let t,a,c,f;y.resetRequestQueue=()=>{t=[],a=0,c=0,f={}},y.addThrottleControl=P=>{const L=c++;return f[L]=P,L},y.removeThrottleControl=P=>{delete f[P],w()},y.getImage=(P,L,j=!0)=>new Promise(((V,U)=>{ve.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),l.e(P,{type:"image"}),t.push({abortController:L,requestParameters:P,supportImageRefresh:j,state:"queued",onError:Z=>{U(Z)},onSuccess:Z=>{V(Z)}}),w()}));const x=P=>l._(this,void 0,void 0,(function*(){P.state="running";const{requestParameters:L,supportImageRefresh:j,onError:V,onSuccess:U,abortController:Z}=P,Q=j===!1&&!l.i(self)&&!l.g(L.url)&&(!L.headers||Object.keys(L.headers).reduce(((oe,pe)=>oe&&pe==="accept"),!0));a++;const se=Q?C(L,Z):l.m(L,Z);try{const oe=yield se;delete P.abortController,P.state="completed",oe.data instanceof HTMLImageElement||l.b(oe.data)?U(oe):oe.data&&U({data:yield(ce=oe.data,typeof createImageBitmap=="function"?l.f(ce):l.h(ce)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete P.abortController,V(oe)}finally{a--,w()}var ce})),w=()=>{const P=(()=>{for(const L of Object.keys(f))if(f[L]())return!0;return!1})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let L=a;L<P&&t.length>0;L++){const j=t.shift();j.abortController.signal.aborted?L--:x(j)}},C=(P,L)=>new Promise(((j,V)=>{const U=new Image,Z=P.url,Q=P.credentials;Q&&Q==="include"?U.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!l.d(Z))&&(U.crossOrigin="anonymous"),L.signal.addEventListener("abort",(()=>{U.src="",V(new l.a(L.signal.reason))})),U.fetchPriority="high",U.onload=()=>{U.onerror=U.onload=null,j({data:U})},U.onerror=()=>{U.onerror=U.onload=null,L.signal.aborted||V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},U.src=Z}))})(nt||(nt={})),nt.resetRequestQueue();class Be{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function it(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const a=[];for(const{id:c,url:f}of y){const x=`${c}${f}`;a.indexOf(x)===-1&&(a.push(x),t.push({id:c,url:f}))}}return t}function $e(y,t,a){try{const c=new URL(y);return c.pathname+=`${t}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function we(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class Qe extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new l.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||a<f[1])return!1;c=f[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,f=c&&c.width||a.data.width,x=c&&c.height||a.data.height;return!(t[0]<0||f<t[0]||t[1]<0||x<t[1]||t[2]<0||f<t[2]||t[3]<0||x<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const f=this.getImage(t);if(c&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,c)=>{let f=!0;if(!this.isLoaded())for(const x of t)this.images[x]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const c of t){let f=this.getImage(c);f||(this.fire(new l.l("styleimagemissing",{id:c})),f=this.getImage(c)),f?a[c]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},x=new l.I(f,c);this.patterns[t]={bin:f,position:x}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const x in this.patterns)t.push(this.patterns[x].bin);const{w:a,h:c}=l.p(t),f=this.atlasImage;f.resize({width:a||1,height:c||1});for(const x in this.patterns){const{bin:w}=this.patterns[x],C=w.x+1,P=w.y+1,L=this.getImage(x).data,j=L.width,V=L.height;l.R.copy(L,f,{x:0,y:0},{x:C,y:P},{width:j,height:V}),l.R.copy(L,f,{x:0,y:V-1},{x:C,y:P-1},{width:j,height:1}),l.R.copy(L,f,{x:0,y:0},{x:C,y:P+V},{width:j,height:1}),l.R.copy(L,f,{x:j-1,y:0},{x:C-1,y:P},{width:1,height:V}),l.R.copy(L,f,{x:0,y:0},{x:C+j,y:P},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||l.w(`Image with ID: "${a}" was not found`),we(c)&&this.updateImage(a,c)}}cloneImages(){const t={};for(const a in this.images){const c=this.images[a];t[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return t}}const ut=1e20;function Ye(y,t,a,c,f,x,w,C,P){for(let L=t;L<t+c;L++)Ie(y,a*x+L,x,f,w,C,P);for(let L=a;L<a+f;L++)Ie(y,L*x+t,1,c,w,C,P)}function Ie(y,t,a,c,f,x,w){x[0]=0,w[0]=-ut,w[1]=ut,f[0]=y[t];for(let C=1,P=0,L=0;C<c;C++){f[C]=y[t+C*a];const j=C*C;do{const V=x[P];L=(f[C]-f[V]+j-V*V)/(C-V)/2}while(L<=w[P]&&--P>-1);P++,x[P]=C,w[P]=L,w[P+1]=ut}for(let C=0,P=0;C<c;C++){for(;w[P+1]<C;)P++;const L=x[P],j=C-L;y[t+C*a]=f[L]+j*j}}const le=l.v.layout_symbol["text-font"].default.join(",");class ke{constructor(t,a,c){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,(function*(){const a=[];for(const x in t)for(const w of t[x])a.push(this._getAndCacheGlyphsPromise(x,w));const c=yield Promise.all(a),f={};for(const{stack:x,id:w,glyph:C}of c)f[x]||(f[x]={}),f[x][w]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return f}))}_getAndCacheGlyphsPromise(t,a){return l._(this,void 0,void 0,(function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let f=c.glyphs[a];return f!==void 0?{stack:t,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=c.glyphs[a]=this._drawGlyph(c,t,a),{stack:t,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return l._(this,void 0,void 0,(function*(){const c=this.entries[t],f=Math.floor(a/256);if(c.ranges[f])return{stack:t,id:a,glyph:null};if(!c.requests[f]){const x=ke.loadGlyphRange(t,f,this.url,this.requestManager);c.requests[f]=x}try{const x=yield c.requests[f];for(const w in x)c.glyphs[+w]=x[+w];return c.ranges[f]=!0,{stack:t,id:a,glyph:x[a]||null}}catch(x){const w=c.glyphs[a]=this._drawGlyph(c,t,a);return this._warnOnMissingGlyphRange(w,f,a,x),{stack:t,id:a,glyph:w}}}))}_warnOnMissingGlyphRange(t,a,c,f){const x=256*a,w=x+255,C=c.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${a}, ${x}-${w}. Rendering codepoint U+${C} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&l.q(t)}_drawGlyph(t,a,c){const f=a===le&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),x=f?"ideographTinySDF":"tinySDF";t[x]||(t[x]=this._createTinySDF(f?this.localIdeographFontFamily:a));const w=t[x].draw(String.fromCodePoint(c));return{id:c,bitmap:new l.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const c=a.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new ke.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[f,x]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(t)&&(c=`${x}`);return c}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}ke.loadGlyphRange=function(y,t,a,c){return l._(this,void 0,void 0,(function*(){const f=256*t,x=f+255,w=c.transformRequest(a.replace("{fontstack}",y).replace("{range}",`${f}-${x}`),"Glyphs"),C=yield l.n(w,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${t}, ${f}-${x}`);const P={};for(const L of l.o(C.data))P[L.id]=L;return P}))},ke.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:x="normal",fontStyle:w="normal",lang:C=null}={}){this.buffer=t,this.cutoff=c,this.radius=a,this.lang=C;const P=this.size=y+4*t,L=this._createCanvas(P),j=this.ctx=L.getContext("2d",{willReadFrequently:!0});j.font=`${w} ${x} ${y}px ${f}`,j.textBaseline="alphabetic",j.textAlign="left",j.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:x}=this.ctx.measureText(y),w=Math.ceil(a),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-f))),P=Math.min(this.size-this.buffer,w+Math.ceil(c)),L=C+2*this.buffer,j=P+2*this.buffer,V=Math.max(L*j,0),U=new Uint8ClampedArray(V),Z={data:U,width:L,height:j,glyphWidth:C,glyphHeight:P,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(C===0||P===0)return Z;const{ctx:Q,buffer:se,gridInner:ce,gridOuter:oe}=this;this.lang&&(Q.lang=this.lang),Q.clearRect(se,se,C,P),Q.fillText(y,se,se+w);const pe=Q.getImageData(se,se,C,P);oe.fill(ut,0,V),ce.fill(0,0,V);for(let Te=0;Te<P;Te++)for(let fe=0;fe<C;fe++){const Se=pe.data[4*(Te*C+fe)+3]/255;if(Se===0)continue;const Ae=(Te+se)*L+fe+se;if(Se===1)oe[Ae]=0,ce[Ae]=ut;else{const _e=.5-Se;oe[Ae]=_e>0?_e*_e:0,ce[Ae]=_e<0?_e*_e:0}}Ye(oe,0,0,L,j,L,this.f,this.v,this.z),Ye(ce,se,se,C,P,L,this.f,this.v,this.z);for(let Te=0;Te<V;Te++){const fe=Math.sqrt(oe[Te])-Math.sqrt(ce[Te]);U[Te]=Math.round(255-255*(fe/this.radius+this.cutoff))}return Z}};class De{constructor(){this.specification=l.u.light.position}possiblyEvaluate(t,a){return l.F(t.expression.evaluate(a))}interpolate(t,a,c){return{x:l.G.number(t.x,a.x,c),y:l.G.number(t.y,a.y,c),z:l.G.number(t.z,a.z,c)}}}let Fe;class bt extends l.E{constructor(t){super(),Fe=Fe||new l.t({anchor:new l.D(l.u.light.anchor),position:new De,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(Fe,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(l.y,t,a))for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&l.B(this,t.call(l.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const de=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class He extends l.E{constructor(t){super(),this._transitionable=new l.x(de,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0))}setSky(t,a={}){if(!this._validate(l.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c={}){return c?.validate!==!1&&l.B(this,t.call(l.C,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class _t{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const f=[];let x=t.length%2==1?-t[t.length-1]*c:0,w=t[0]*c,C=!0;f.push({left:x,right:w,isDash:C,zeroLength:t[0]===0});let P=t[0];for(let L=1;L<t.length;L++){C=!C;const j=t[L];x=P*c,P+=j,w=P*c,f.push({left:x,right:w,isDash:C,zeroLength:j===0})}return f}addRoundDash(t,a,c){const f=a/2;for(let x=-c;x<=c;x++){const w=this.width*(this.nextRow+c+x);let C=0,P=t[C];for(let L=0;L<this.width;L++){L/P.right>1&&(P=t[++C]);const j=Math.abs(L-P.left),V=Math.abs(L-P.right),U=Math.min(j,V);let Z;const Q=x/c*(f+1);if(P.isDash){const se=f-Math.abs(Q);Z=Math.sqrt(U*U+se*se)}else Z=f-Math.sqrt(U*U+Q*Q);this.data[w+L]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(t){for(let C=t.length-1;C>=0;--C){const P=t[C],L=t[C+1];P.zeroLength?t.splice(C,1):L&&L.isDash===P.isDash&&(L.left=P.left,t.splice(C,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const f=this.width*this.nextRow;let x=0,w=t[x];for(let C=0;C<this.width;C++){C/w.right>1&&(w=t[++x]);const P=Math.abs(C-w.left),L=Math.abs(C-w.right),j=Math.min(P,L);this.data[f+C]=Math.max(0,Math.min(255,(w.isDash?j:-j)+128))}}addDash(t,a){const c=a?7:0,f=2*c+1;if(this.nextRow+f>this.height)return l.w("LineAtlas out of space"),null;let x=0;for(let C=0;C<t.length;C++)x+=t[C];if(x!==0){const C=this.width/x,P=this.getDashRanges(t,this.width,C);a?this.addRoundDash(P,C,c):this.addRegularDash(P)}const w={y:this.nextRow+c,height:2*c,width:x};return this.nextRow+=f,this.dirty=!0,w}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const It="maplibre_preloaded_worker_pool";class Ze{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ze.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}const Dt=Math.floor(Ce.hardwareConcurrency/2);let jt,$t;function Ot(){return jt||(jt=new Ze),jt}Ze.workerCount=l.K(globalThis)?Math.max(Math.min(Dt,3),1):1;class ln{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let f=0;f<c.length;f++){const x=new l.L(c[f],a);x.name=`Worker ${f}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const c=[];for(const f of this.actors)c.push(f.sendAsync({type:t,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const c of this.actors)c.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function dn(){return $t||($t=new ln(Ot(),l.M),$t.registerMessageHandler("GR",((y,t,a)=>l.m(t,a)))),$t}function rn(y,t){const a=l.N();return l.O(a,a,[1,1,0]),l.Q(a,a,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?l.S(a,a,y.calculatePosMatrix(t.toUnwrapped())):a}function gt(y,t,a,c,f,x,w){var C;const P=(function(U,Z,Q){if(U)for(const se of U){const ce=Z[se];if(ce&&ce.source===Q&&ce.type==="fill-extrusion")return!0}else for(const se in Z){const ce=Z[se];if(ce.source===Q&&ce.type==="fill-extrusion")return!0}return!1})((C=f?.layers)!==null&&C!==void 0?C:null,t,y.id),L=x.maxPitchScaleFactor(),j=y.tilesIn(c,L,P);j.sort(xt);const V=[];for(const U of j)V.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(t,a,y.getState(),U.queryGeometry,U.cameraQueryGeometry,U.scale,f,x,L,rn(x,U.tileID),w?(Z,Q)=>w(U.tileID,Z,Q):void 0)});return(function(U,Z){for(const Q in U)for(const se of U[Q])zt(se,Z);return U})((function(U){const Z={},Q={};for(const se of U){const ce=se.queryResults,oe=se.wrappedTileID,pe=Q[oe]=Q[oe]||{};for(const Te in ce){const fe=ce[Te],Se=pe[Te]=pe[Te]||{},Ae=Z[Te]=Z[Te]||[];for(const _e of fe)Se[_e.featureIndex]||(Se[_e.featureIndex]=!0,Ae.push(_e))}}return Z})(V),y)}function xt(y,t){const a=y.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function zt(y,t){const a=y.feature,c=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function qt(y,t,a){return l._(this,void 0,void 0,(function*(){let c=y;if(y.url?c=(yield l.j(t.transformRequest(y.url,"Source"),a)).data:yield Ce.frameAsync(a),!c)return null;const f=l.U(l.e(c,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(f.vectorLayerIds=c.vector_layers.map((x=>x.id))),f}))}class Gt{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}extend(t){const a=this._sw,c=this._ne;let f,x;if(t instanceof l.V)f=t,x=t;else{if(!(t instanceof Gt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Gt.convert(t)):this.extend(l.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.V.convert(t)):this;if(f=t._sw,x=t._ne,!f||!x)return this}return a||c?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),c.lng=Math.max(x.lng,c.lng),c.lat=Math.max(x.lat,c.lat)):(this._sw=new l.V(f.lng,f.lat),this._ne=new l.V(x.lng,x.lat)),this}getCenter(){return new l.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.V(this.getWest(),this.getNorth())}getSouthEast(){return new l.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=l.V.convert(t);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}intersects(t){if(!((t=Gt.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),c=Math.abs(t.getEast()-t.getWest());if(a>=360||c>=360)return!0;const f=l.W(this.getWest(),-180,180),x=l.W(this.getEast(),-180,180),w=l.W(t.getWest(),-180,180),C=l.W(t.getEast(),-180,180),P=f>=x,L=w>=C;return!(!P||!L)||(P?C>=f||w<=x:L?x>=w||f<=C:w<=x&&C>=f)}static convert(t){return t instanceof Gt?t:t&&new Gt(t)}static fromLngLat(t,a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*t.lat);return new Gt(new l.V(t.lng-f,t.lat-c),new l.V(t.lng+f,t.lat+c))}adjustAntiMeridian(){const t=new l.V(this._sw.lng,this._sw.lat),a=new l.V(this._ne.lng,this._ne.lat);return new Gt(t,t.lng>a.lng?new l.V(a.lng+360,a.lat):a)}}class gn{constructor(t,a,c){this.bounds=Gt.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(l.Y(this.bounds.getWest())*a),f=Math.floor(l.X(this.bounds.getNorth())*a),x=Math.ceil(l.Y(this.bounds.getEast())*a),w=Math.ceil(l.X(this.bounds.getSouth())*a);return t.x>=c&&t.x<x&&t.y>=f&&t.y<w}}class Rn extends l.E{constructor(t,a,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield qt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new gn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,l.Z(t)||this.fire(new l.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};c.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((x,w)=>{t.reloadPromise={resolve:x,reject:w}}))}else t.actor=this.dispatcher.getActor(),f="LT";t.abortController=new AbortController;try{const x=yield t.actor.sendAsync({type:f,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,x)}catch(x){if(delete t.abortController,t.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class bn extends l.E{constructor(t,a,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.U(a,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield qt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new gn(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield nt.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const f=this.map.painter.context,x=f.gl,w=c.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new l.T(f,w,x.RGBA,{useMipmap:!0}),t.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Zn extends bn{constructor(t,a,c,f){super(t,a,c,f),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const f=yield nt.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){const x=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const w=l.b(x)&&l.$()?x:yield this.readImageNow(x),C={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const P=yield t.actor.sendAsync({type:"LDT",data:C});t.dem=P,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}readImageNow(t){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.a0()){const a=t.width+2,c=t.height+2;try{return new l.R({width:a,height:c},yield l.a1(t,-1,-1,a,c))}catch{}}return Ce.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),f=(a.x-1+c)%c,x=a.x===0?t.wrap-1:t.wrap,w=(a.x+1+c)%c,C=a.x+1===c?t.wrap+1:t.wrap,P={};return P[new l.a2(t.overscaledZ,x,a.z,f,a.y).key]={backfilled:!1},P[new l.a2(t.overscaledZ,C,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(P[new l.a2(t.overscaledZ,x,a.z,f,a.y-1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,C,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<c&&(P[new l.a2(t.overscaledZ,x,a.z,f,a.y+1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},P[new l.a2(t.overscaledZ,C,a.z,w,a.y+1).key]={backfilled:!1}),P}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Ln(y){return y.type==="GeometryCollection"?y.geometries.map((t=>t.coordinates)).flat(1/0):y.coordinates.flat(1/0)}function Wi(y){const t=new Gt;let a;switch(y.type){case"FeatureCollection":a=y.features.map((c=>Ln(c.geometry))).flat(1/0);break;case"Feature":a=Ln(y.geometry);break;default:a=Ln(y)}if(a.length==0)return t;for(let c=0;c<a.length-1;c+=2)t.extend([a[c],a[c+1]]);return t}class kn extends l.E{constructor(t,a,c,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(f),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:l.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(l.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const c=this._updateWorkerData();return a?c:this}updateData(t,a){this._pendingWorkerUpdate.diff=l.a6(this._pendingWorkerUpdate.diff,t);const c=this._updateWorkerData();return a?c:this}getData(){return l._(this,void 0,void 0,(function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return Wi(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:c}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,c=l.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(c.request=this.map._requestManager.transformRequest(Ce.resolveURL(t),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=t,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));f.data&&(this._data={geojson:f.data});const x=this._applyDiffToSource(a),w=this._getShouldReloadTileOptions(x);let C=null;f.resourceTiming&&f.resourceTiming[this.id]&&(C=f.resourceTiming[this.id].slice(0));const P={dataType:"source"};this._collectResourceTiming&&C&&C.length>0&&l.e(P,{resourceTiming:C}),this.fire(new l.l("data",Object.assign(Object.assign({},P),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},P),{sourceDataType:"content",shouldReloadTileOptions:w})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const f=l.a7(this._data.geojson,a);if(!f)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f}}if(!this._data.updateable)return;const c=l.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:c}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>Wi(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:c,extent:f}=this.workerOptions.geojsonVtOptions,x=(function({x:w,y:C,z:P},L=0){const j=l.a3((w-L)/Math.pow(2,P)),V=l.a4((C+1+L)/Math.pow(2,P)),U=l.a3((w+1+L)/Math.pow(2,P)),Z=l.a4((C-L)/Math.pow(2,P));return new Gt([j,V],[U,Z])})(t.tileID.canonical,c/f);for(const w of a)if(x.intersects(w))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(f,this.map.painter,a==="RT")}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Cn extends l.E{constructor(t,a,c,f){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(t){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield nt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(l.a9.fromLngLat);var c;return this.tileID=(function(f){const x=l.aa.fromPoints(f),w=x.width(),C=x.height(),P=Math.max(w,C),L=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),j=Math.pow(2,L);return new l.ac(L,Math.floor((x.minX+x.maxX)/2*j),Math.floor((x.minY+x.maxY)/2*j))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new l.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const x=this.tiles[f];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:c,maxX:f,maxY:x}=l.aa.fromPoints(t),w={};for(let C=0;C<=l.ab;C++){const P=Math.pow(2,C),L=Math.floor(a*P),j=Math.floor(c*P),V=Math.floor(f*P),U=Math.floor(x*P);w[C]={minTileX:L,minTileY:j,maxTileX:V,maxTileY:U}}return w}}class Ue extends Cn{constructor(t,a,c,f){super(t,a,c,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield l.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new l.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new l.k(new l.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const x=this.tiles[f];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class W extends Cn{constructor(t,a,c,f){super(t,a,c,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((w=>typeof w!="number"))))||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.k(new l.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new l.T(a,this.canvas,c.RGBA,{premultiply:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const x in this.tiles){const w=this.tiles[x];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const $={},K=y=>{switch(y){case"geojson":return kn;case"image":return Cn;case"raster":return bn;case"raster-dem":return Zn;case"vector":return Rn;case"video":return Ue;case"canvas":return W}return $[y]},ue="RTLPluginLoaded";class ye extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=dn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ce.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(ue))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let je=null;function Le(){return je||(je=new ye),je}var Me,Oe;(function(y){y[y.Base=0]="Base",y[y.Parent=1]="Parent"})(Me||(Me={})),(function(y){y[y.Departing=0]="Departing",y[y.Incoming=1]="Incoming"})(Oe||(Oe={}));class Je{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=l.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:c,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=f}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=he(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(f,x){const w={};if(!x)return w;for(const C of f){const P=C.layerIds.map((L=>x.getLayer(L))).filter(Boolean);if(P.length!==0){C.layers=P,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map((L=>P.filter((j=>j.id===L))[0])));for(const L of P)w[L.id]=C}}return w})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const x=this.buckets[f];if(x instanceof l.ah){if(this.hasSymbolBuckets=!0,!c)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const x=this.buckets[f];if(x instanceof l.ah&&x.hasRTLText){this.hasRTLText=!0,Le().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const x=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(x))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new l.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,f,x,w,C,P,L,j,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:x,scale:w,tileSize:this.tileSize,pixelPosMatrix:j,transform:P,params:C,queryPadding:this.queryPadding*L,getElevation:V},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),x=a&&a.sourceLayer?a.sourceLayer:"",w=f[l.ai]||f[x];if(!w)return;const C=l.aj(a?.filter,a?.globalState),{z:P,x:L,y:j}=this.tileID.canonical,V={z:P,x:L,y:j};for(let U=0;U<w.length;U++){const Z=w.feature(U);if(C.needGeometry){const ce=l.ak(Z,!0);if(!C.filter(new l.H(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!C.filter(new l.H(this.tileID.overscaledZ),Z))continue;const Q=c.getId(Z,x),se=new l.al(Z,P,L,j,Q);se.tile=V,t.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=l.am(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const x=this.expirationTime-a;x?this.expirationTime=c+Math.max(x,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const x=this.buckets[f],w=x.layers[0].sourceLayer||l.ai,C=c[w],P=t[w];if(!C||!P||Object.keys(P).length===0)continue;x.update(P,C,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const L=a&&a.style&&a.style.getLayer(f);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(x)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<he()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=he()+t}setDependencies(t,a){const c={};for(const f of a)c[f]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const f=this.dependencies[c];if(f){for(const x of a)if(f[x])return!0}}return!1}}class ft{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const f=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},l.e(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const x in this.state[t])x!==f&&(this.deletedStates[t][x]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const x in this.state[t][f])c[x]||(this.deletedStates[t][f][x]=null)}else for(const x in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][x]===null&&delete this.deletedStates[t][f][x]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const f=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),f=l.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const x=this.deletedStates[t][a];if(x===null)return{};for(const w in x)delete f[w]}return f}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const x={};for(const w in this.stateChanges[f])this.state[f][w]||(this.state[f][w]={}),l.e(this.state[f][w],this.stateChanges[f][w]),x[w]=this.state[f][w];c[f]=x}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const x={};if(this.deletedStates[f]===null)for(const w in this.state[f])x[w]={},this.state[f][w]={};else for(const w in this.deletedStates[f]){if(this.deletedStates[f][w]===null)this.state[f][w]={};else for(const C of Object.keys(this.deletedStates[f][w]))delete this.state[f][w][C];x[w]=this.state[f][w]}c[f]=c[f]||{},l.e(c[f],x)}this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0&&t.setFeatureState(c,a)}}const Bt=89.25;function Wt(y,t){const a=l.an(t.lat,-l.ao,l.ao);return new l.P(l.Y(t.lng)*y,l.X(a)*y)}function Jt(y,t){return new l.a9(t.x/y,t.y/y).toLngLat()}function pn(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(l.ap(90-y.pitch)),Math.tan(l.ap(Bt-y.pitch)))}function Mn(y,t){const a=y.canonical,c=t/l.aq(a.z),f=a.x+Math.pow(2,a.z)*y.wrap,x=l.ar(new Float64Array(16));return l.O(x,x,[f*c,a.y*c,0]),l.Q(x,x,[c/l.a5,c/l.a5,1]),x}function Ve(y,t,a,c,f){const x=l.a9.fromLngLat(y,t),w=f*l.as(1,y.lat),{x:C,y:P,z:L}=Pn(a,c);return new l.a9(x.x+w*-C,x.y+w*-P,x.z+w*-L)}function Pn(y,t){const a=l.ap(y),c=l.ap(t),f=Math.cos(-a),x=Math.sin(a);return{x:x*Math.sin(c),y:-x*Math.cos(c),z:f}}function Fi(y,t,a){const c=t.intersectsFrustum(y);if(!a||c===0)return c;const f=t.intersectsPlane(a);return f===0?0:c===2&&f===2?2:1}function yn(y,t,a){let c=0;const f=(a-t)/10;for(let x=0;x<10;x++)c+=f*Math.pow(Math.cos(t+(x+.5)/10*(a-t)),y);return c}function qn(y,t){return function(a,c,f,x,w){const C=2*((y-1)/l.at(Math.cos(l.ap(Bt-w))/Math.cos(l.ap(Bt)))-1),P=Math.acos(f/x),L=2*yn(C-1,0,l.ap(w/2)),j=Math.min(l.ap(Bt),P+l.ap(w/2)),V=yn(C-1,Math.min(j,P-l.ap(w/2)),j),U=Math.atan(c/f),Z=Math.hypot(c,f);let Q=a;return Q+=l.at(x/Z/Math.max(.5,Math.cos(l.ap(w/2)))),Q+=C*l.at(Math.cos(U))/2,Q-=l.at(Math.max(1,V/L/t))/2,Q}}const ir=qn(9.314,3);function ei(y,t){const a=(t.roundZoom?Math.round:Math.floor)(y.zoom+l.at(y.tileSize/t.tileSize));return Math.max(0,a)}function Ti(y,t){const a=y.getCameraFrustum(),c=y.getClippingPlane(),f=y.screenPointToMercatorCoordinate(y.getCameraPoint()),x=l.a9.fromLngLat(y.center,y.elevation);f.z=x.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const w=y.getCoveringTilesDetailsProvider(),C=w.allowVariableZoom(y,t),P=ei(y,t),L=t.minzoom||0,j=t.maxzoom!==void 0?t.maxzoom:y.maxZoom,V=Math.min(Math.max(0,P),j),U=Math.pow(2,V),Z=[U*f.x,U*f.y,0],Q=[U*x.x,U*x.y,0],se=Math.hypot(x.x-f.x,x.y-f.y),ce=Math.abs(x.z-f.z),oe=Math.hypot(se,ce),pe=Se=>({zoom:0,x:0,y:0,wrap:Se,fullyVisible:!1}),Te=[],fe=[];if(y.renderWorldCopies&&w.allowWorldCopies())for(let Se=1;Se<=3;Se++)Te.push(pe(-Se)),Te.push(pe(Se));for(Te.push(pe(0));Te.length>0;){const Se=Te.pop(),Ae=Se.x,_e=Se.y;let Re=Se.fullyVisible;const rt={x:Ae,y:_e,z:Se.zoom},Ke=w.getTileBoundingVolume(rt,Se.wrap,y.elevation,t);if(!Re){const Nt=Fi(a,Ke,c);if(Nt===0)continue;Re=Nt===2}const et=w.distanceToTile2d(f.x,f.y,rt,Ke);let tt=P;C&&(tt=(t.calculateTileZoom||ir)(y.zoom+l.at(y.tileSize/t.tileSize),et,ce,oe,y.fov)),tt=(t.roundZoom?Math.round:Math.floor)(tt),tt=Math.max(0,tt);const Lt=Math.min(tt,j);if(Se.wrap=w.getWrap(x,rt,Se.wrap),Se.zoom>=Lt){if(Se.zoom<L)continue;const Nt=V-Se.zoom,wt=Z[0]-.5-(Ae<<Nt),Ft=Z[1]-.5-(_e<<Nt),vn=t.reparseOverscaled?Math.max(Se.zoom,tt):Se.zoom;fe.push({tileID:new l.a2(Se.zoom===j?vn:Se.zoom,Se.wrap,Se.zoom,Ae,_e),distanceSq:l.au([Q[0]-.5-Ae,Q[1]-.5-_e]),tileDistanceToCamera:Math.sqrt(wt*wt+Ft*Ft)})}else for(let Nt=0;Nt<4;Nt++)Te.push({zoom:Se.zoom+1,x:(Ae<<1)+Nt%2,y:(_e<<1)+(Nt>>1),wrap:Se.wrap,fullyVisible:Re})}return fe.sort(((Se,Ae)=>Se.distanceSq-Ae.distanceSq)).map((Se=>Se.tileID))}const ii=l.aa.fromPoints([new l.P(0,0),new l.P(l.a5,l.a5)]);function Ui(y){return y==="raster"||y==="image"||y==="video"}function Is(y,t,a,c,f,x,w){if(!t.hasData())return!1;const{tileID:C,fadingRole:P,fadingDirection:L,fadingParentID:j}=t;if(P===Me.Base&&L===Oe.Incoming&&j)return a[j.key]=j,!0;const V=Math.max(C.overscaledZ-f,x);for(let U=C.overscaledZ-1;U>=V;U--){const Z=C.scaledTo(U),Q=y.getLoadedTile(Z);if(Q)return t.setCrossFadeLogic({fadingRole:Me.Base,fadingDirection:Oe.Incoming,fadingParentID:Q.tileID,fadeEndTime:c+w}),Q.setCrossFadeLogic({fadingRole:Me.Parent,fadingDirection:Oe.Departing,fadeEndTime:c+w}),a[Z.key]=Z,!0}return!1}function ds(y,t,a,c,f,x){if(!t.hasData())return!1;const w=t.tileID.children(f);let C=kt(y,t,w,a,c,f,x);if(C)return!0;for(const P of w)kt(y,t,P.children(f),a,c,f,x)&&(C=!0);return C}function kt(y,t,a,c,f,x,w){if(a[0].overscaledZ>=x)return!1;let C=!1;for(const P of a){const L=y.getLoadedTile(P);if(!L)continue;const{fadingRole:j,fadingDirection:V,fadingParentID:U}=L;j===Me.Base&&V===Oe.Departing&&U||(L.setCrossFadeLogic({fadingRole:Me.Base,fadingDirection:Oe.Departing,fadingParentID:t.tileID,fadeEndTime:f+w}),t.setCrossFadeLogic({fadingRole:Me.Parent,fadingDirection:Oe.Incoming,fadeEndTime:f+w})),c[P.key]=P,C=!0}return C}function br(y,t,a,c){const f=y.tileID;return!!y.selfFading||!y.hasData()&&!!t.has(f)&&(y.setSelfFadeLogic(a+c),!0)}function hr(y,t){var a;y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let c=t.tileID.canonical.x-y.tileID.canonical.x;const f=t.tileID.canonical.y-y.tileID.canonical.y,x=Math.pow(2,y.tileID.canonical.z),w=t.tileID.key;c===0&&f===0||Math.abs(f)>1||(Math.abs(c)>1&&(Math.abs(c+x)===1?c+=x:Math.abs(c-x)===1&&(c-=x)),t.dem&&y.dem&&(y.dem.backfillBorder(t.dem,c,f),!((a=y.neighboringTiles)===null||a===void 0)&&a[w]&&(y.neighboringTiles[w].backfilled=!0)))}class _a{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),a[f.tileID.key]=f}this._tiles=a}setFeatureState(t,a){for(const c in this._tiles)this._tiles[c].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(l.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var c;return(c=this.getTileById(t))===null||c===void 0?void 0:c.isRenderable(a)}getRenderableIds(t=0,a){const c=[];for(const f of this.getAllIds())this.isIdRenderable(f,a)&&c.push(this.getTileById(f));return a?c.sort(((f,x)=>{const w=f.tileID,C=x.tileID,P=new l.P(w.canonical.x,w.canonical.y)._rotate(-t),L=new l.P(C.canonical.x,C.canonical.y)._rotate(-t);return w.overscaledZ-C.overscaledZ||L.y-P.y||L.x-P.x})).map((f=>f.tileID.key)):c.map((f=>f.tileID)).sort(l.aw).map((f=>f.key))}}class Jn extends l.E{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,x,w,C)=>{const P=new(K(x.type))(f,x,w,C);if(P.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${P.id}`);return P})(t,a,c,this),this._inViewTiles=new _a,this._outOfViewCache=new l.ax(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new ft,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new _a}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,c){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,c)}catch(f){t.state="errored",f.status!==404?this._source.fire(new l.k(f,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const c=this.getLoadedTile(t.scaledTo(a));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(c);a&&!this._source.shouldReloadTile(f,a)||(t?this._reloadTile(c,"expired"):f.state!=="errored"&&this._reloadTile(c,"reloading"))}}}_reloadTile(t,a){return l._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(t);c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,t,a))}))}_tileLoaded(t,a,c){t.timeAdded=he(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(f,x){var w,C;const P=x.getRenderableIds();for(const L of P){if(!f.neighboringTiles||!f.neighboringTiles[L])continue;const j=x.getTileById(L);f.neighboringTiles[L].backfilled||hr(f,j),!((C=(w=j.neighboringTiles)===null||w===void 0?void 0:w[f.tileID.key])===null||C===void 0)&&C.backfilled||hr(j,f)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const c=this._getLoadedDescendents(a),f=new Set;for(const x of a){const w=c[x.key];if(!w?.length){f.add(x);continue}const C=x.overscaledZ+Jn.maxOverzooming,P=w.filter((V=>V.tileID.overscaledZ<=C));if(!P.length){f.add(x);continue}const L=Math.min(...P.map((V=>V.tileID.overscaledZ))),j=P.filter((V=>V.tileID.overscaledZ===L)).map((V=>V.tileID));for(const V of j)t[V.key]=V;this._areDescendentsComplete(j,L,x.overscaledZ)||f.add(x)}return f}_getLoadedDescendents(t){var a;const c={};for(const f of this._inViewTiles.getAllTiles().filter((x=>x.hasData())))for(const x of t)f.tileID.isChildOf(x)&&(c[a=x.key]||(c[a]=[])).push(f);return c}_areDescendentsComplete(t,a,c){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-c)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._outOfViewCache.setMaxSize(x)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((P=>new l.a2(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y))):(c=Ti(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((P=>this._source.hasTile(P))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const f=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=ei(t,this._source),w=this._updateRetainedTiles(c,x),C=Ui(this._source.type);C&&this._rasterFadeDuration>0&&!a&&(function(P,L,j,V,U,Z,Q){const se=he(),ce=l.av(L);for(const oe of L){const pe=P.getTileById(oe.key);pe.fadingDirection!==Oe.Departing&&pe.fadeOpacity!==0||pe.resetFadeLogic(),Is(P,pe,j,se,V,U,Q)||ds(P,pe,j,se,Z,Q)||br(pe,ce,se,Q)||pe.resetFadeLogic()}})(this._inViewTiles,c,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),C?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);t[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const c of t)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);a.push(f);const x=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(x)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var c;const f=new Set;for(const L of t)this._addTile(L).hasData()||f.add(L);const x=t.reduce(((L,j)=>(L[j.key]=j,L)),{}),w=this._retainLoadedChildren(x,f),C={},P=Math.max(a-Jn.maxUnderzooming,this._source.minzoom);for(const L of w){let j=this._inViewTiles.getTileById(L.key),V=j?.wasRequested();for(let U=L.overscaledZ-1;U>=P;--U){const Z=L.scaledTo(U);if(C[Z.key])break;if(C[Z.key]=!0,j=this.getTile(Z),!j&&V&&(j=this._addTile(Z)),j){const Q=j.hasData();if((Q||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||V)&&(x[Z.key]=Z),V=j.wasRequested(),Q)break}}}return x}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const c=a;return a||(a=new Je(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),c||this._source.fire(new l.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||c.state=="errored")&&t.some((f=>f.equals(c.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,c){const f=[],x=this.transform;if(!x)return f;const w=x.getCoveringTilesDetailsProvider().allowWorldCopies(),C=c?x.getCameraQueryGeometry(t):t,P=Z=>x.screenPointToMercatorCoordinate(Z,this.terrain),L=this.transformBbox(t,P,!w),j=this.transformBbox(C,P,!w),V=this.getIds(),U=l.aa.fromPoints(j);for(let Z=0;Z<V.length;Z++){const Q=this._inViewTiles.getTileById(V[Z]);if(Q.holdingForSymbolFade())continue;const se=w?[Q.tileID]:[Q.tileID.unwrapTo(-1),Q.tileID.unwrapTo(0)],ce=Math.pow(2,x.zoom-Q.tileID.overscaledZ),oe=a*Q.queryPadding*l.a5/Q.tileSize/ce;for(const pe of se){const Te=U.map((fe=>pe.getTilePoint(new l.a9(fe.x,fe.y))));if(Te.expandBy(oe),Te.intersects(ii)){const fe=L.map((Ae=>pe.getTilePoint(Ae))),Se=j.map((Ae=>pe.getTilePoint(Ae)));f.push({tile:Q,tileID:w?pe:pe.unwrapTo(0),queryGeometry:fe,cameraQueryGeometry:Se,scale:ce})}}}return f}transformBbox(t,a,c){let f=t.map(a);if(c){const x=l.aa.fromPoints(t);x.shrinkBy(.001*Math.min(x.width(),x.height()));const w=x.map(a);l.aa.fromPoints(f).covers(w)||(f=f.map((C=>C.x>.5?new l.a9(C.x-1,C.y,C.z):C)))}return f}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((c=>this._inViewTiles.getTileById(c).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!Ui(this._source.type)||!(function(t,a){if(a<=0)return!1;const c=he();for(const f of t.getAllTiles())if(f.fadeEndTime>=c)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,c){this._state.updateState(t=t||l.ai,a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||l.ai,a,c)}getFeatureState(t,a){return this._state.getState(t=t||l.ai,a)}setDependencies(t,a,c){const f=this._inViewTiles.getTileById(t);f&&f.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(t,a)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Jn.maxUnderzooming=10,Jn.maxOverzooming=3;class Rt{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.an(t,0,1);let a=1,c=this._distances[a];const f=t*this.paddedLength+this.padding;for(;c<f&&a<this._distances.length;)c=this._distances[++a];const x=a-1,w=this._distances[x],C=c-w,P=C>0?(f-w)/C:0;return this.points[x].mult(1-P).add(this.points[a].mult(P))}}function xn(y,t){let a=!0;return y==="always"||y!=="never"&&t!=="never"||(a=!1),a}class En{constructor(t,a,c){const f=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let w=0;w<this.xCellCount*this.yCellCount;w++)f.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,f,x){this._forEachCell(a,c,f,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(x)}insertCircle(t,a,c,f){this._forEachCell(a-f,c-f,a+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,a,c,f,x,w){this.boxCells[x].push(w)}_insertCircleCell(t,a,c,f,x,w){this.circleCells[x].push(w)}_query(t,a,c,f,x,w,C){if(c<0||t>this.width||f<0||a>this.height)return[];const P=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=f){if(x)return[{key:null,x1:t,y1:a,x2:c,y2:f}];for(let L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const j=this.circles[3*L],V=this.circles[3*L+1],U=this.circles[3*L+2];P.push({key:this.circleKeys[L],x1:j-U,y1:V-U,x2:j+U,y2:V+U})}}else this._forEachCell(t,a,c,f,this._queryCell,P,{hitTest:x,overlapMode:w,seenUids:{box:{},circle:{}}},C);return P}query(t,a,c,f){return this._query(t,a,c,f,!1,null)}hitTest(t,a,c,f,x,w){return this._query(t,a,c,f,!0,x,w).length>0}hitTestCircle(t,a,c,f,x){const w=t-c,C=t+c,P=a-c,L=a+c;if(C<0||w>this.width||L<0||P>this.height)return!1;const j=[];return this._forEachCell(w,P,C,L,this._queryCellCircle,j,{hitTest:!0,overlapMode:f,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},x),j.length>0}_queryCell(t,a,c,f,x,w,C,P){const{seenUids:L,hitTest:j,overlapMode:V}=C,U=this.boxCells[x];if(U!==null){const Q=this.bboxes;for(const se of U)if(!L.box[se]){L.box[se]=!0;const ce=4*se,oe=this.boxKeys[se];if(t<=Q[ce+2]&&a<=Q[ce+3]&&c>=Q[ce+0]&&f>=Q[ce+1]&&(!P||P(oe))&&(!j||!xn(V,oe.overlapMode))&&(w.push({key:oe,x1:Q[ce],y1:Q[ce+1],x2:Q[ce+2],y2:Q[ce+3]}),j))return!0}}const Z=this.circleCells[x];if(Z!==null){const Q=this.circles;for(const se of Z)if(!L.circle[se]){L.circle[se]=!0;const ce=3*se,oe=this.circleKeys[se];if(this._circleAndRectCollide(Q[ce],Q[ce+1],Q[ce+2],t,a,c,f)&&(!P||P(oe))&&(!j||!xn(V,oe.overlapMode))){const pe=Q[ce],Te=Q[ce+1],fe=Q[ce+2];if(w.push({key:oe,x1:pe-fe,y1:Te-fe,x2:pe+fe,y2:Te+fe}),j)return!0}}}return!1}_queryCellCircle(t,a,c,f,x,w,C,P){const{circle:L,seenUids:j,overlapMode:V}=C,U=this.boxCells[x];if(U!==null){const Q=this.bboxes;for(const se of U)if(!j.box[se]){j.box[se]=!0;const ce=4*se,oe=this.boxKeys[se];if(this._circleAndRectCollide(L.x,L.y,L.radius,Q[ce+0],Q[ce+1],Q[ce+2],Q[ce+3])&&(!P||P(oe))&&!xn(V,oe.overlapMode))return w.push(!0),!0}}const Z=this.circleCells[x];if(Z!==null){const Q=this.circles;for(const se of Z)if(!j.circle[se]){j.circle[se]=!0;const ce=3*se,oe=this.circleKeys[se];if(this._circlesCollide(Q[ce],Q[ce+1],Q[ce+2],L.x,L.y,L.radius)&&(!P||P(oe))&&!xn(V,oe.overlapMode))return w.push(!0),!0}}}_forEachCell(t,a,c,f,x,w,C,P){const L=this._convertToXCellCoord(t),j=this._convertToYCellCoord(a),V=this._convertToXCellCoord(c),U=this._convertToYCellCoord(f);for(let Z=L;Z<=V;Z++)for(let Q=j;Q<=U;Q++)if(x.call(this,t,a,c,f,this.xCellCount*Q+Z,w,C,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,f,x,w){const C=f-t,P=x-a,L=c+w;return L*L>C*C+P*P}_circleAndRectCollide(t,a,c,f,x,w,C){const P=(w-f)/2,L=Math.abs(t-(f+P));if(L>P+c)return!1;const j=(C-x)/2,V=Math.abs(a-(x+j));if(V>j+c)return!1;if(L<=P||V<=j)return!0;const U=L-P,Z=V-j;return U*U+Z*Z<=c*c}}function Zr(y,t,a){const c=l.N();if(!y){const{vecSouth:V,vecEast:U}=xa(t),Z=Y();Z[0]=U[0],Z[1]=U[1],Z[2]=V[0],Z[3]=V[1],f=Z,(j=(w=(x=Z)[0])*(L=x[3])-(P=x[2])*(C=x[1]))&&(f[0]=L*(j=1/j),f[1]=-C*j,f[2]=-P*j,f[3]=w*j),c[0]=Z[0],c[1]=Z[1],c[4]=Z[2],c[5]=Z[3]}var f,x,w,C,P,L,j;return l.Q(c,c,[1/a,1/a,1]),c}function hl(y,t,a,c){if(y){const f=l.N();if(!t){const{vecSouth:x,vecEast:w}=xa(a);f[0]=w[0],f[1]=w[1],f[4]=x[0],f[5]=x[1]}return l.Q(f,f,[c,c,1]),f}return a.pixelsToClipSpaceMatrix}function xa(y){const t=Math.cos(y.rollInRadians),a=Math.sin(y.rollInRadians),c=Math.cos(y.pitchInRadians),f=Math.cos(y.bearingInRadians),x=Math.sin(y.bearingInRadians),w=l.aC();w[0]=-f*c*a-x*t,w[1]=-x*c*a+f*t;const C=l.aD(w);C<1e-9?l.aE(w):l.aF(w,w,1/C);const P=l.aC();P[0]=f*c*t-x*a,P[1]=x*c*t+f*a;const L=l.aD(P);return L<1e-9?l.aE(P):l.aF(P,P,1/L),{vecEast:P,vecSouth:w}}function _n(y,t,a,c){let f;c?(f=[y,t,c(y,t),1],l.aH(f,f,a)):(f=[y,t,0,1],Xe(f,f,a));const x=f[3];return{point:new l.P(f[0]/x,f[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function Rs(y,t){return .5+y/t*.5}function Fa(y,t){return y.x>=-t[0]&&y.x<=t[0]&&y.y>=-t[1]&&y.y<=t[1]}function fs(y,t,a,c,f,x,w,C,P,L,j,V,U){const Z=a?y.textSizeData:y.iconSizeData,Q=l.ay(Z,t.transform.zoom),se=[256/t.width*2+1,256/t.height*2+1],ce=a?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ce.clear();const oe=y.lineVertexArray,pe=a?y.text.placedSymbolArray:y.icon.placedSymbolArray,Te=t.transform.width/t.transform.height;let fe=!1;for(let Se=0;Se<pe.length;Se++){const Ae=pe.get(Se);if(Ae.hidden||Ae.writingMode===l.az.vertical&&!fe){Va(Ae.numGlyphs,ce);continue}fe=!1;const _e=new l.P(Ae.anchorX,Ae.anchorY),Re={getElevation:U,pitchedLabelPlaneMatrix:c,lineVertexArray:oe,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:_e,unwrappedTileID:P,width:L,height:j,translation:V},rt=Lo(Ae.anchorX,Ae.anchorY,Re);if(!Fa(rt.point,se)){Va(Ae.numGlyphs,ce);continue}const Ke=Rs(t.transform.cameraToCenterDistance,rt.signedDistanceFromCamera),et=l.aA(Z,Q,Ae),tt=x?et*t.transform.getPitchedTextCorrection(Ae.anchorX,Ae.anchorY,P)/Ke:et*Ke,Lt=Ai({projectionContext:Re,pitchedLabelPlaneMatrixInverse:f,symbol:Ae,fontSize:tt,flip:!1,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:ce,aspectRatio:Te,rotateToLine:C});fe=Lt.useVertical,(Lt.notEnoughRoom||fe||Lt.needsFlipping&&Ai({projectionContext:Re,pitchedLabelPlaneMatrixInverse:f,symbol:Ae,fontSize:tt,flip:!0,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:ce,aspectRatio:Te,rotateToLine:C}).notEnoughRoom)&&Va(Ae.numGlyphs,ce)}a?y.text.dynamicLayoutVertexBuffer.updateData(ce):y.icon.dynamicLayoutVertexBuffer.updateData(ce)}function ia(y,t,a,c,f,x,w,C){const P=x.glyphStartIndex+x.numGlyphs,L=x.lineStartIndex,j=x.lineStartIndex+x.lineLength,V=t.getoffsetX(x.glyphStartIndex),U=t.getoffsetX(P-1),Z=va(y*V,a,c,f,x.segment,L,j,C,w);if(!Z)return null;const Q=va(y*U,a,c,f,x.segment,L,j,C,w);return Q?C.projectionCache.anyProjectionOccluded?null:{first:Z,last:Q}:null}function Xr(y,t,a,c){return y===l.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(y===l.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Ai(y){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:f,flip:x,keepUpright:w,glyphOffsetArray:C,dynamicLayoutVertexArray:P,aspectRatio:L,rotateToLine:j}=y,V=f/24,U=c.lineOffsetX*V,Z=c.lineOffsetY*V;let Q;if(c.numGlyphs>1){const se=c.glyphStartIndex+c.numGlyphs,ce=c.lineStartIndex,oe=c.lineStartIndex+c.lineLength,pe=ia(V,C,U,Z,x,c,j,t);if(!pe)return{notEnoughRoom:!0};const Te=Ua(pe.first.point.x,pe.first.point.y,t,a),fe=Ua(pe.last.point.x,pe.last.point.y,t,a);if(w&&!x){const Se=Xr(c.writingMode,Te,fe,L);if(Se)return Se}Q=[pe.first];for(let Se=c.glyphStartIndex+1;Se<se-1;Se++){const Ae=va(V*C.getoffsetX(Se),U,Z,x,c.segment,ce,oe,t,j);if(!Ae)return{notEnoughRoom:!0};Q.push(Ae)}Q.push(pe.last)}else{if(w&&!x){const ce=On(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,oe=c.lineStartIndex+c.segment+1,pe=new l.P(t.lineVertexArray.getx(oe),t.lineVertexArray.gety(oe)),Te=On(pe.x,pe.y,t),fe=Te.signedDistanceFromCamera>0?Te.point:Ro(t.tileAnchorPoint,pe,ce,1,t),Se=Ua(ce.x,ce.y,t,a),Ae=Ua(fe.x,fe.y,t,a),_e=Xr(c.writingMode,Se,Ae,L);if(_e)return _e}const se=va(V*C.getoffsetX(c.glyphStartIndex),U,Z,x,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,j);if(!se||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Q=[se]}for(const se of Q)l.aG(P,se.point,se.angle);return{}}function Ro(y,t,a,c,f){const x=y.add(y.sub(t)._unit()),w=On(x.x,x.y,f).point,C=a.sub(w);return a.add(C._mult(c/C.mag()))}function wr(y,t,a){const c=t.projectionCache;if(c.projections[y])return c.projections[y];const f=new l.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),x=On(f.x,f.y,t);if(x.signedDistanceFromCamera>0)return c.projections[y]=x.point,c.anyProjectionOccluded=c.anyProjectionOccluded||x.isOccluded,x.point;const w=y-a.direction;return Ro(a.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function On(y,t,a){const c=y+a.translation[0],f=t+a.translation[1];let x;return a.pitchWithMap?(x=_n(c,f,a.pitchedLabelPlaneMatrix,a.getElevation),x.isOccluded=!1):(x=a.transform.projectTileCoordinates(c,f,a.unwrappedTileID,a.getElevation),x.point.x=(.5*x.point.x+.5)*a.width,x.point.y=(.5*-x.point.y+.5)*a.height),x}function Ua(y,t,a,c){if(a.pitchWithMap){const f=[y,t,0,1];return l.aH(f,f,c),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:y/a.width*2-1,y:1-t/a.height*2}}function Lo(y,t,a){return a.transform.projectTileCoordinates(y,t,a.unwrappedTileID,a.getElevation)}function co(y,t,a){return y._unit()._perp()._mult(t*a)}function Ls(y,t,a,c,f,x,w,C,P){if(C.projectionCache.offsets[y])return C.projectionCache.offsets[y];const L=a.add(t);if(y+P.direction<c||y+P.direction>=f)return C.projectionCache.offsets[y]=L,L;const j=wr(y+P.direction,C,P),V=co(j.sub(a),w,P.direction),U=a.add(V),Z=j.add(V);return C.projectionCache.offsets[y]=l.aI(x,L,U,Z)||L,C.projectionCache.offsets[y]}function va(y,t,a,c,f,x,w,C,P){const L=c?y-t:y+t;let j=L>0?1:-1,V=0;c&&(j*=-1,V=Math.PI),j<0&&(V+=Math.PI);let U,Z=j>0?x+f:x+f+1;C.projectionCache.cachedAnchorPoint?U=C.projectionCache.cachedAnchorPoint:(U=On(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=U);let Q,se,ce=U,oe=U,pe=0,Te=0;const fe=Math.abs(L),Se=[];let Ae;for(;pe+Te<=fe;){if(Z+=j,Z<x||Z>=w)return null;pe+=Te,oe=ce,se=Q;const rt={absOffsetX:fe,direction:j,distanceFromAnchor:pe,previousVertex:oe};if(ce=wr(Z,C,rt),a===0)Se.push(oe),Ae=ce.sub(oe);else{let Ke;const et=ce.sub(oe);Ke=et.mag()===0?co(wr(Z+j,C,rt).sub(ce),a,j):co(et,a,j),se||(se=oe.add(Ke)),Q=Ls(Z,Ke,ce,x,w,se,a,C,rt),Se.push(se),Ae=Q.sub(se)}Te=Ae.mag()}const _e=Ae._mult((fe-pe)/Te)._add(se||oe),Re=V+Math.atan2(ce.y-oe.y,ce.x-oe.x);return Se.push(_e),{point:_e,angle:P?Re:0,path:Se}}const dl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Va(y,t){for(let a=0;a<y;a++){const c=t.length;t.resize(c+4),t.float32.set(dl,3*c)}}function Xe(y,t,a){const c=t[0],f=t[1];return y[0]=a[0]*c+a[4]*f+a[12],y[1]=a[1]*c+a[5]*f+a[13],y[3]=a[3]*c+a[7]*f+a[15],y}const dt=100;class Vt{constructor(t,a=new En(t.width+200,t.height+200,25),c=new En(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+dt,this.screenBottomBoundary=t.height+dt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,f,x,w,C,P,L,j,V,U){const Z=this.projectAndGetPerspectiveRatio(t.anchorPointX+P[0],t.anchorPointY+P[1],x,j,U),Q=c*Z.perspectiveRatio;let se;if(w||C)se=this._projectCollisionBox(t,Q,f,x,w,C,P,Z,j,V,U);else{const Ae=Z.x+(V?V.x*Q:0),_e=Z.y+(V?V.y*Q:0);se={allPointsOccluded:!1,box:[Ae+t.x1*Q,_e+t.y1*Q,Ae+t.x2*Q,_e+t.y2*Q]}}const[ce,oe,pe,Te]=se.box,fe=w?se.allPointsOccluded:Z.isOccluded;let Se=fe;return Se||(Se=Z.perspectiveRatio<this.perspectiveRatioCutoff),Se||(Se=!this.isInsideGrid(ce,oe,pe,Te)),Se||a!=="always"&&this.grid.hitTest(ce,oe,pe,Te,a,L)?{box:[ce,oe,pe,Te],placeable:!1,offscreen:!1,occluded:fe}:{box:[ce,oe,pe,Te],placeable:!0,offscreen:this.isOffscreen(ce,oe,pe,Te),occluded:fe}}placeCollisionCircles(t,a,c,f,x,w,C,P,L,j,V,U,Z,Q){const se=[],ce=new l.P(a.anchorX,a.anchorY),oe=this.getPerspectiveRatio(ce.x,ce.y,w,Q),pe=(L?x*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,w)/oe:x*oe)/l.aM,Te={getElevation:Q,pitchedLabelPlaneMatrix:C,lineVertexArray:c,pitchWithMap:L,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ce,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:Z},fe=ia(pe,f,a.lineOffsetX*pe,a.lineOffsetY*pe,!1,a,!1,Te);let Se=!1,Ae=!1,_e=!0;if(fe){const Re=.5*V*oe+U,rt=new l.P(-100,-100),Ke=new l.P(this.screenRightBoundary,this.screenBottomBoundary),et=new Rt,tt=fe.first,Lt=fe.last;let Nt=[];for(let vn=tt.path.length-1;vn>=1;vn--)Nt.push(tt.path[vn]);for(let vn=1;vn<Lt.path.length;vn++)Nt.push(Lt.path[vn]);const wt=2.5*Re;if(L){const vn=this.projectPathToScreenSpace(Nt,Te);Nt=vn.some((ni=>ni.signedDistanceFromCamera<=0))?[]:vn.map((ni=>ni.point))}let Ft=[];if(Nt.length>0){const vn=Nt[0].clone(),ni=Nt[0].clone();for(let vi=1;vi<Nt.length;vi++)vn.x=Math.min(vn.x,Nt[vi].x),vn.y=Math.min(vn.y,Nt[vi].y),ni.x=Math.max(ni.x,Nt[vi].x),ni.y=Math.max(ni.y,Nt[vi].y);Ft=vn.x>=rt.x&&ni.x<=Ke.x&&vn.y>=rt.y&&ni.y<=Ke.y?[Nt]:ni.x<rt.x||vn.x>Ke.x||ni.y<rt.y||vn.y>Ke.y?[]:l.aJ([Nt],rt.x,rt.y,Ke.x,Ke.y)}for(const vn of Ft){et.reset(vn,.25*Re);let ni=0;ni=et.length<=.5*Re?1:Math.ceil(et.paddedLength/wt)+1;for(let vi=0;vi<ni;vi++){const mi=vi/Math.max(ni-1,1),Mi=et.lerp(mi),ci=Mi.x+dt,Oi=Mi.y+dt;se.push(ci,Oi,Re,0);const Ci=ci-Re,Mr=Oi-Re,$i=ci+Re,Hi=Oi+Re;if(_e=_e&&this.isOffscreen(Ci,Mr,$i,Hi),Ae=Ae||this.isInsideGrid(Ci,Mr,$i,Hi),t!=="always"&&this.grid.hitTestCircle(ci,Oi,Re,t,j)&&(Se=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Se}}}}return{circles:!P&&Se||!Ae||oe<this.perspectiveRatioCutoff?[]:se,offscreen:_e,collisionDetected:Se}}projectPathToScreenSpace(t,a){const c=(function(f,x){const w=l.N();return l.aB(w,x.pitchedLabelPlaneMatrix),f.map((C=>{const P=_n(C.x,C.y,w,x.getElevation),L=x.transform.projectTileCoordinates(P.point.x,P.point.y,x.unwrappedTileID,x.getElevation);return L.point.x=(.5*L.point.x+.5)*x.width,L.point.y=(.5*-L.point.y+.5)*x.height,L}))})(t,a);return(function(f){let x=0,w=0,C=0,P=0;for(let L=0;L<f.length;L++)f[L].isOccluded?(C=L+1,P=0):(P++,P>w&&(w=P,x=C));return f.slice(x,x+w)})(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],c=new l.aa;for(const V of t){const U=new l.P(V.x+dt,V.y+dt);c.extend(U),a.push(U)}const{minX:f,minY:x,maxX:w,maxY:C}=c,P=this.grid.query(f,x,w,C).concat(this.ignoredGrid.query(f,x,w,C)),L={},j={};for(const V of P){const U=V.key;if(L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]={}),L[U.bucketInstanceId][U.featureIndex])continue;const Z=[new l.P(V.x1,V.y1),new l.P(V.x2,V.y1),new l.P(V.x2,V.y2),new l.P(V.x1,V.y2)];l.aK(a,Z)&&(L[U.bucketInstanceId][U.featureIndex]=!0,j[U.bucketInstanceId]===void 0&&(j[U.bucketInstanceId]=[]),j[U.bucketInstanceId].push(U.featureIndex))}return j}insertCollisionBox(t,a,c,f,x,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:x,collisionGroupID:w,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,f,x,w){const C=c?this.ignoredGrid:this.grid,P={bucketInstanceId:f,featureIndex:x,collisionGroupID:w,overlapMode:a};for(let L=0;L<t.length;L+=4)C.insertCircle(P,t[L],t[L+1],t[L+2])}projectAndGetPerspectiveRatio(t,a,c,f,x){if(x){let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,x)):(w=[t,a,0,1],Xe(w,w,x));const C=w[3];return{x:(w[0]/C+1)/2*this.transform.width+dt,y:(-w[1]/C+1)/2*this.transform.height+dt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{const w=this.transform.projectTileCoordinates(t,a,c,f);return{x:(w.point.x+1)/2*this.transform.width+dt,y:(1-w.point.y)/2*this.transform.height+dt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,c,f){const x=this.transform.projectTileCoordinates(t,a,c,f);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(t,a,c,f){return c<dt||t>=this.screenRightBoundary||f<dt||a>this.screenBottomBoundary}isInsideGrid(t,a,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=l.ar([]);return l.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,c,f,x,w,C,P,L,j,V){let U=1,Z=0,Q=0,se=1;const ce=t.anchorPointX+C[0],oe=t.anchorPointY+C[1];if(w&&!x){const Nt=this.projectAndGetPerspectiveRatio(ce+1,oe,f,L,V),wt=Nt.x-P.x,Ft=Math.atan((Nt.y-P.y)/wt)+(wt<0?Math.PI:0),vn=Math.sin(Ft),ni=Math.cos(Ft);U=ni,Z=vn,Q=-vn,se=ni}else if(!w&&x){const Nt=xa(this.transform);U=Nt.vecEast[0],Z=Nt.vecEast[1],Q=Nt.vecSouth[0],se=Nt.vecSouth[1]}let pe=P.x,Te=P.y,fe=a;x&&(pe=ce,Te=oe,fe=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),fe*=this.transform.getPitchedTextCorrection(ce,oe,f),j||(fe*=l.an(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),j&&(pe+=U*j.x*fe+Q*j.y*fe,Te+=Z*j.x*fe+se*j.y*fe);const Se=t.x1*fe,Ae=t.x2*fe,_e=(Se+Ae)/2,Re=t.y1*fe,rt=t.y2*fe,Ke=(Re+rt)/2,et=[{offsetX:Se,offsetY:Re},{offsetX:_e,offsetY:Re},{offsetX:Ae,offsetY:Re},{offsetX:Ae,offsetY:Ke},{offsetX:Ae,offsetY:rt},{offsetX:_e,offsetY:rt},{offsetX:Se,offsetY:rt},{offsetX:Se,offsetY:Ke}];let tt=[];for(const{offsetX:Nt,offsetY:wt}of et)tt.push(new l.P(pe+U*Nt+Q*wt,Te+Z*Nt+se*wt));let Lt=!1;if(x){const Nt=tt.map((wt=>this.projectAndGetPerspectiveRatio(wt.x,wt.y,f,L,V)));Lt=Nt.some((wt=>!wt.isOccluded)),tt=Nt.map((wt=>new l.P(wt.x,wt.y)))}else Lt=!0;return{box:l.aL(tt),allPointsOccluded:!Lt}}}class en{constructor(t,a,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class tn{constructor(t,a,c,f,x){this.text=new en(t?t.text:null,a,c,x),this.icon=new en(t?t.icon:null,a,f,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xn{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class Yn{constructor(t,a,c,f,x){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=x}}class ps{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function xi(y,t,a,c,f){const{horizontalAlign:x,verticalAlign:w}=l.aS(y);return new l.P(-(x-.5)*t+c[0]*f,-(w-.5)*a+c[1]*f)}class qa{constructor(t,a,c,f,x){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Vt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ps(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(c,f)=>a.getElevation(t,c,f):null}getBucketParts(t,a,c,f){const x=c.getBucket(a),w=c.latestFeatureIndex;if(!x||!w||a.id!==x.layerIds[0])return;const C=c.collisionBoxArray,P=x.layers[0].layout,L=x.layers[0].paint,j=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),V=c.tileSize/l.a5,U=c.tileID.toUnwrapped(),Z=P.get("text-rotation-alignment")==="map",Q=l.aN(c,1,this.transform.zoom),se=l.aO(this.collisionIndex.transform,c,L.get("text-translate"),L.get("text-translate-anchor")),ce=l.aO(this.collisionIndex.transform,c,L.get("icon-translate"),L.get("icon-translate-anchor")),oe=Zr(Z,this.transform,Q);this.retainedQueryData[x.bucketInstanceId]=new Yn(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,c.tileID);const pe={bucket:x,layout:P,translationText:se,translationIcon:ce,unwrappedTileID:U,pitchedLabelPlaneMatrix:oe,scale:j,textPixelRatio:V,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.ay(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(f)for(const Te of x.sortKeyRanges){const{sortKey:fe,symbolInstanceStart:Se,symbolInstanceEnd:Ae}=Te;t.push({sortKey:fe,symbolInstanceStart:Se,symbolInstanceEnd:Ae,parameters:pe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(t,a,c,f,x,w,C,P,L,j,V,U,Z,Q,se,ce,oe,pe,Te,fe){const Se=l.aP[t.textAnchor],Ae=[t.textOffset0,t.textOffset1],_e=xi(Se,c,f,Ae,x),Re=this.collisionIndex.placeCollisionBox(a,U,P,L,j,C,w,ce,V.predicate,Te,_e,fe);if((!pe||this.collisionIndex.placeCollisionBox(pe,U,P,L,j,C,w,oe,V.predicate,Te,_e,fe).placeable)&&Re.placeable){let rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(rt=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:Ae,width:c,height:f,anchor:Se,textBoxScale:x,prevAnchor:rt},this.markUsedJustification(Q,Se,Z,se),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,se,Z),this.placedOrientations[Z.crossTileID]=se),{shift:_e,placedGlyphBoxes:Re}}}placeLayerBucketPart(t,a,c){const{bucket:f,layout:x,translationText:w,translationIcon:C,unwrappedTileID:P,pitchedLabelPlaneMatrix:L,textPixelRatio:j,holdingForFade:V,collisionBoxArray:U,partiallyEvaluatedTextSize:Z,collisionGroup:Q}=t.parameters,se=x.get("text-optional"),ce=x.get("icon-optional"),oe=l.aQ(x,"text-overlap","text-allow-overlap"),pe=oe==="always",Te=l.aQ(x,"icon-overlap","icon-allow-overlap"),fe=Te==="always",Se=x.get("text-rotation-alignment")==="map",Ae=x.get("text-pitch-alignment")==="map",_e=x.get("icon-text-fit")!=="none",Re=x.get("symbol-z-order")==="viewport-y",rt=pe&&(fe||!f.hasIconData()||ce),Ke=fe&&(pe||!f.hasTextData()||se);!f.collisionArrays&&U&&f.deserializeCollisionBoxes(U);const et=this.retainedQueryData[f.bucketInstanceId].tileID,tt=this._getTerrainElevationFunc(et),Lt=this.transform.getFastPathSimpleProjectionMatrix(et),Nt=(wt,Ft,vn)=>{var ni,vi;if(a[wt.crossTileID])return;if(V)return void(this.placements[wt.crossTileID]=new Xn(!1,!1,!1));let mi=!1,Mi=!1,ci=!0,Oi=null,Ci={box:null,placeable:!1,offscreen:null,occluded:!1},Mr={placeable:!1},$i=null,Hi=null,Cr=null,no=0,io=0,Ts=0;Ft.textFeatureIndex?no=Ft.textFeatureIndex:wt.useRuntimeCollisionCircles&&(no=wt.featureIndex),Ft.verticalTextFeatureIndex&&(io=Ft.verticalTextFeatureIndex);const ca=Ft.textBox;if(ca){const ua=ai=>{let gi=l.az.horizontal;if(f.allowVerticalPlacement&&!ai&&this.prevPlacement){const sr=this.prevPlacement.placedOrientations[wt.crossTileID];sr&&(this.placedOrientations[wt.crossTileID]=sr,gi=sr,this.markUsedOrientation(f,gi,wt))}return gi},Ia=(ai,gi)=>{if(f.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&Ft.verticalTextBox){for(const sr of f.writingModes)if(sr===l.az.vertical?(Ci=gi(),Mr=Ci):Ci=ai(),Ci&&Ci.placeable)break}else Ci=ai()},ts=wt.textAnchorOffsetStartIndex,ns=wt.textAnchorOffsetEndIndex;if(ns===ts){const ai=(gi,sr)=>{const fr=this.collisionIndex.placeCollisionBox(gi,oe,j,et,P,Ae,Se,w,Q.predicate,tt,void 0,Lt);return fr&&fr.placeable&&(this.markUsedOrientation(f,sr,wt),this.placedOrientations[wt.crossTileID]=sr),fr};Ia((()=>ai(ca,l.az.horizontal)),(()=>{const gi=Ft.verticalTextBox;return f.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&gi?ai(gi,l.az.vertical):{box:null,offscreen:null}})),ua(Ci&&Ci.placeable)}else{let ai=l.aP[(vi=(ni=this.prevPlacement)===null||ni===void 0?void 0:ni.variableOffsets[wt.crossTileID])===null||vi===void 0?void 0:vi.anchor];const gi=(fr,Eh,Mh)=>{const Jo=fr.x2-fr.x1,qf=fr.y2-fr.y1,el=wt.textBoxScale,Ch=_e&&Te==="never"?Eh:null;let To=null,Eo=oe==="never"?1:2,Ms="never";ai&&Eo++;for(let Ah=0;Ah<Eo;Ah++){for(let zu=ts;zu<ns;zu++){const ku=f.textAnchorOffsets.get(zu);if(ai&&ku.textAnchor!==ai)continue;const Pu=this.attemptAnchorPlacement(ku,fr,Jo,qf,el,Se,Ae,j,et,P,Q,Ms,wt,f,Mh,w,C,Ch,tt);if(Pu&&(To=Pu.placedGlyphBoxes,To&&To.placeable))return mi=!0,Oi=Pu.shift,To}ai?ai=null:Ms=oe}return c&&!To&&(To={box:this.collisionIndex.placeCollisionBox(ca,"always",j,et,P,Ae,Se,w,Q.predicate,tt,void 0,Lt).box,offscreen:!1,placeable:!1,occluded:!1}),To};Ia((()=>gi(ca,Ft.iconBox,l.az.horizontal)),(()=>{const fr=Ft.verticalTextBox;return f.allowVerticalPlacement&&(!Ci||!Ci.placeable)&&wt.numVerticalGlyphVertices>0&&fr?gi(fr,Ft.verticalIconBox,l.az.vertical):{box:null,occluded:!0,offscreen:null}})),Ci&&(mi=Ci.placeable,ci=Ci.offscreen);const sr=ua(Ci&&Ci.placeable);if(!mi&&this.prevPlacement){const fr=this.prevPlacement.variableOffsets[wt.crossTileID];fr&&(this.variableOffsets[wt.crossTileID]=fr,this.markUsedJustification(f,fr.anchor,wt,sr))}}}if($i=Ci,mi=$i&&$i.placeable,ci=$i&&$i.offscreen,wt.useRuntimeCollisionCircles&&wt.centerJustifiedTextSymbolIndex>=0){const ua=f.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex),Ia=l.aA(f.textSizeData,Z,ua),ts=x.get("text-padding");Hi=this.collisionIndex.placeCollisionCircles(oe,ua,f.lineVertexArray,f.glyphOffsetArray,Ia,P,L,c,Ae,Q.predicate,wt.collisionCircleDiameter,ts,w,tt),Hi.circles.length&&Hi.collisionDetected&&!c&&l.w("Collisions detected, but collision boxes are not shown"),mi=pe||Hi.circles.length>0&&!Hi.collisionDetected,ci=ci&&Hi.offscreen}if(Ft.iconFeatureIndex&&(Ts=Ft.iconFeatureIndex),Ft.iconBox){const ua=Ia=>this.collisionIndex.placeCollisionBox(Ia,Te,j,et,P,Ae,Se,C,Q.predicate,tt,_e&&Oi?Oi:void 0,Lt);Mr&&Mr.placeable&&Ft.verticalIconBox?(Cr=ua(Ft.verticalIconBox),Mi=Cr.placeable):(Cr=ua(Ft.iconBox),Mi=Cr.placeable),ci=ci&&Cr.offscreen}const Ll=se||wt.numHorizontalGlyphVertices===0&&wt.numVerticalGlyphVertices===0,wc=ce||wt.numIconVertices===0;Ll||wc?wc?Ll||(Mi=Mi&&mi):mi=Mi&&mi:Mi=mi=Mi&&mi;const Es=Mi&&Cr.placeable;if(mi&&$i.placeable&&this.collisionIndex.insertCollisionBox($i.box,oe,x.get("text-ignore-placement"),f.bucketInstanceId,Mr&&Mr.placeable&&io?io:no,Q.ID),Es&&this.collisionIndex.insertCollisionBox(Cr.box,Te,x.get("icon-ignore-placement"),f.bucketInstanceId,Ts,Q.ID),Hi&&mi&&this.collisionIndex.insertCollisionCircles(Hi.circles,oe,x.get("text-ignore-placement"),f.bucketInstanceId,no,Q.ID),c&&this.storeCollisionData(f.bucketInstanceId,vn,Ft,$i,Cr,Hi),wt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[wt.crossTileID]=new Xn((mi||rt)&&!$i?.occluded,(Mi||Ke)&&!Cr?.occluded,ci||f.justReloaded),a[wt.crossTileID]=!0};if(Re){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const wt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ft=wt.length-1;Ft>=0;--Ft){const vn=wt[Ft];Nt(f.symbolInstances.get(vn),f.collisionArrays[vn],vn)}}else for(let wt=t.symbolInstanceStart;wt<t.symbolInstanceEnd;wt++)Nt(f.symbolInstances.get(wt),f.collisionArrays[wt],wt);f.justReloaded=!1}storeCollisionData(t,a,c,f,x,w){if(c.textBox||c.iconBox){let C,P;this.collisionBoxArrays.has(t)?C=this.collisionBoxArrays.get(t):(C=new Map,this.collisionBoxArrays.set(t,C)),C.has(a)?P=C.get(a):(P={text:null,icon:null},C.set(a,P)),c.textBox&&(P.text=f.box),c.iconBox&&(P.icon=x.box)}if(w){let C=this.collisionCircleArrays[t];C===void 0&&(C=this.collisionCircleArrays[t]=[]);for(let P=0;P<w.circles.length;P+=4)C.push(w.circles[P+0]-dt),C.push(w.circles[P+1]-dt),C.push(w.circles[P+2]),C.push(w.collisionDetected?1:0)}}markUsedJustification(t,a,c,f){let x;x=f===l.az.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.aR(a)];const w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const C of w)C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:c.crossTileID)}markUsedOrientation(t,a,c){const f=a===l.az.horizontal||a===l.az.horizontalOnly?a:0,x=a===l.az.vertical?a:0,w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const C of w)t.text.placedSymbolArray.get(C).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(t):1,x=a?a.opacities:{},w=a?a.variableOffsets:{},C=a?a.placedOrientations:{};for(const P in this.placements){const L=this.placements[P],j=x[P];j?(this.opacities[P]=new tn(j,f,L.text,L.icon),c=c||L.text!==j.text.placed||L.icon!==j.icon.placed):(this.opacities[P]=new tn(null,f,L.text,L.icon,L.skipFade),c=c||L.text||L.icon)}for(const P in x){const L=x[P];if(!this.opacities[P]){const j=new tn(L,f,!1,!1);j.isHidden()||(this.opacities[P]=j,c=c||L.text.placed||L.icon.placed)}}for(const P in w)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=w[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const f of a){const x=f.getBucket(t);x&&f.latestFeatureIndex&&t.id===x.layerIds[0]&&this.updateBucketOpacities(x,f.tileID,c,f.collisionBoxArray)}}updateBucketOpacities(t,a,c,f){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const x=t.layers[0],w=x.layout,C=new tn(null,0,!1,!1,!0),P=w.get("text-allow-overlap"),L=w.get("icon-allow-overlap"),j=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=w.get("text-rotation-alignment")==="map",U=w.get("text-pitch-alignment")==="map",Z=w.get("icon-text-fit")!=="none",Q=new tn(null,0,P&&(L||!t.hasIconData()||w.get("icon-optional")),L&&(P||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const se=(oe,pe,Te)=>{for(let fe=0;fe<pe/4;fe++)oe.opacityVertexArray.emplaceBack(Te);oe.hasVisibleVertices=oe.hasVisibleVertices||Te!==js},ce=this.collisionBoxArrays.get(t.bucketInstanceId);for(let oe=0;oe<t.symbolInstances.length;oe++){const pe=t.symbolInstances.get(oe),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:fe,crossTileID:Se}=pe;let Ae=this.opacities[Se];c[Se]?Ae=C:Ae||(Ae=Q,this.opacities[Se]=Ae),c[Se]=!0;const _e=pe.numIconVertices>0,Re=this.placedOrientations[pe.crossTileID],rt=Re===l.az.vertical,Ke=Re===l.az.horizontal||Re===l.az.horizontalOnly;if(Te>0||fe>0){const tt=tc(Ae.text);se(t.text,Te,rt?js:tt),se(t.text,fe,Ke?js:tt);const Lt=Ae.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach((Ft=>{Ft>=0&&(t.text.placedSymbolArray.get(Ft).hidden=Lt||rt?1:0)})),pe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=Lt||Ke?1:0);const Nt=this.variableOffsets[pe.crossTileID];Nt&&this.markUsedJustification(t,Nt.anchor,pe,Re);const wt=this.placedOrientations[pe.crossTileID];wt&&(this.markUsedJustification(t,"left",pe,wt),this.markUsedOrientation(t,wt,pe))}if(_e){const tt=tc(Ae.icon),Lt=!(Z&&pe.verticalPlacedIconSymbolIndex&&rt);pe.placedIconSymbolIndex>=0&&(se(t.icon,pe.numIconVertices,Lt?tt:js),t.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Ae.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(se(t.icon,pe.numVerticalIconVertices,Lt?js:tt),t.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Ae.icon.isHidden())}const et=ce&&ce.has(oe)?ce.get(oe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const tt=t.collisionArrays[oe];if(tt){let Lt=new l.P(0,0);if(tt.textBox||tt.verticalTextBox){let Nt=!0;if(j){const wt=this.variableOffsets[Se];wt?(Lt=xi(wt.anchor,wt.width,wt.height,wt.textOffset,wt.textBoxScale),V&&Lt._rotate(U?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Nt=!1}if(tt.textBox||tt.verticalTextBox){let wt;tt.textBox&&(wt=rt),tt.verticalTextBox&&(wt=Ke),fl(t.textCollisionBox.collisionVertexArray,Ae.text.placed,!Nt||wt,et.text,Lt.x,Lt.y)}}if(tt.iconBox||tt.verticalIconBox){const Nt=!!(!Ke&&tt.verticalIconBox);let wt;tt.iconBox&&(wt=Nt),tt.verticalIconBox&&(wt=!Nt),fl(t.iconCollisionBox.collisionVertexArray,Ae.icon.placed,wt,et.icon,Z?Lt.x:0,Z?Lt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function fl(y,t,a,c,f,x){c&&c.length!==0||(c=[0,0,0,0]);const w=c[0]-dt,C=c[1]-dt,P=c[2]-dt,L=c[3]-dt;y.emplaceBack(t?1:0,a?1:0,f||0,x||0,w,C),y.emplaceBack(t?1:0,a?1:0,f||0,x||0,P,C),y.emplaceBack(t?1:0,a?1:0,f||0,x||0,P,L),y.emplaceBack(t?1:0,a?1:0,f||0,x||0,w,L)}const ms=Math.pow(2,25),Sr=Math.pow(2,24),Ju=Math.pow(2,17),Ns=Math.pow(2,16),Ga=Math.pow(2,9),Xc=Math.pow(2,8),uo=Math.pow(2,1);function tc(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,a=Math.floor(127*y.opacity);return a*ms+t*Sr+a*Ju+t*Ns+a*Ga+t*Xc+a*uo+t}const js=0;class gs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,f,x){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((C,P)=>C.sortKey-P.sortKey)));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,x())return!0;return!1}}class ba{constructor(t,a,c,f,x,w,C,P){this.placement=new qa(t,a,w,C,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const f=he(),x=()=>!this._forceFullPlacement&&he()-f>2;for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=C)&&(!w.maxzoom||w.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new gs(w)),this._inProgressLayer.continuePlacement(c[w.source],this.placement,this._showCollisionBoxes,w,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const wn=512/l.a5/2;class wa{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let x=0;x<a.length;x++){const w=a.get(x),C=w.key,P=f.get(C);P?P.push(w):f.set(C,[w])}for(const[x,w]of f){const C={positions:w.map((P=>({x:Math.floor(P.anchorX*wn),y:Math.floor(P.anchorY*wn)}))),crossTileIDs:w.map((P=>P.crossTileID))};if(C.positions.length>128){const P=new l.aT(C.positions.length,16,Uint16Array);for(const{x:L,y:j}of C.positions)P.add(L,j);P.finish(),delete C.positions,C.index=P}this._symbolsByKey[x]=C}}getScaledCoordinates(t,a){const{x:c,y:f,z:x}=this.tileID.canonical,{x:w,y:C,z:P}=a.canonical,L=wn/Math.pow(2,P-x),j=(C*l.a5+t.anchorY)*L,V=f*l.a5*wn;return{x:Math.floor((w*l.a5+t.anchorX)*L-c*l.a5*wn),y:Math.floor(j-V)}}findMatches(t,a,c){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let x=0;x<t.length;x++){const w=t.get(x);if(w.crossTileID)continue;const C=this._symbolsByKey[w.key];if(!C)continue;const P=this.getScaledCoordinates(w,a);if(C.index){const L=C.index.range(P.x-f,P.y-f,P.x+f,P.y+f).sort();for(const j of L){const V=C.crossTileIDs[j];if(!c[V]){c[V]=!0,w.crossTileID=V;break}}}else if(C.positions)for(let L=0;L<C.positions.length;L++){const j=C.positions[L],V=C.crossTileIDs[L];if(Math.abs(j.x-P.x)<=f&&Math.abs(j.y-P.y)<=f&&!c[V]){c[V]=!0,w.crossTileID=V;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class od{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const f=this.indexes[c],x={};for(const w in f){const C=f[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+a),x[C.tileID.key]=C}this.indexes[c]=x}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let x=0;x<a.symbolInstances.length;x++)a.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>t.overscaledZ)for(const C in w){const P=w[C];P.tileID.isChildOf(t)&&P.findMatches(a.symbolInstances,t,f)}else{const C=w[t.scaledTo(Number(x)).key];C&&C.findMatches(a.symbolInstances,t,f)}}for(let x=0;x<a.symbolInstances.length;x++){const w=a.symbolInstances.get(x);w.crossTileID||(w.crossTileID=c.generate(),f[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new wa(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const f=this.indexes[c];for(const x in f)t[f[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[x]),delete f[x],a=!0)}return a}}class gr{constructor(){this.layerIndexes={},this.crossTileIDs=new od,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Yc);let x=!1;const w={};f.handleWrapJump(c);for(const C of a){const P=C.getBucket(t);P&&t.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(C.tileID,P,this.crossTileIDs)&&(x=!0),w[P.bucketInstanceId]=!0)}return f.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(t){const a={};t.forEach((c=>{a[c]=!0}));for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var rr="void main() {fragColor=vec4(1.0);}";const zi={prelude:un(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:un("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:un("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:un(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:un(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:un(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:un(rr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:un(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:un("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:un("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:un("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:un(rr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:un(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:un(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:un(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:un(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:un(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:un(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:un(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:un(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:un(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:un(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:un(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:un(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:un(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:un(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:un("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:un("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:un("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:un("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:un(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:un("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function un(y,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),f=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=x?x.concat(f):f,C={};return{fragmentSource:y=y.replace(a,((P,L,j,V,U)=>(C[U]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${j} ${V} ${U};
#else
uniform ${j} ${V} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${j} ${V} ${U} = u_${U};
#endif
`))),vertexSource:t=t.replace(a,((P,L,j,V,U)=>{const Z=V==="float"?"vec2":"vec4",Q=U.match(/color/)?"color":Z;return C[U]?L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${j} ${Z} a_${U};
out ${j} ${V} ${U};
#else
uniform ${j} ${V} u_${U};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${j} ${V} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${Q}(a_${U}, u_${U}_t);
#else
    ${j} ${V} ${U} = u_${U};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${j} ${Z} a_${U};
#else
uniform ${j} ${V} u_${U};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${j} ${V} ${U} = a_${U};
#else
    ${j} ${V} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${j} ${V} ${U} = unpack_mix_${Q}(a_${U}, u_${U}_t);
#else
    ${j} ${V} ${U} = u_${U};
#endif
`})),staticAttributes:c,staticUniforms:w}}class fi{constructor(t,a,c){this.vertexBuffer=t,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var $a=l.aU([{name:"a_pos",type:"Int16",components:2}]);const Vi="#define PROJECTION_MERCATOR",Yr="mercator";class yr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Yr}get shaderDefine(){return Vi}get shaderPreludeCode(){return zi.projectionMercator}get vertexShaderPreludeCode(){return zi.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,c,f,x){if(this._cachedMesh)return this._cachedMesh;const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(l.a5,0),w.emplaceBack(0,l.a5),w.emplaceBack(l.a5,l.a5);const C=t.createVertexBuffer(w,$a.members),P=l.aX.simpleSegment(0,0,4,2),L=new l.aY;L.emplaceBack(1,0,2),L.emplaceBack(1,2,3);const j=t.createIndexBuffer(L);return this._cachedMesh=new fi(C,j,P),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Sa{constructor(t=0,a=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=f}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=l.G.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=l.G.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=l.G.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=l.G.number(t.right,a.right,c)),this}getCenter(t,a){const c=l.an((this.left+t-this.right)/2,0,t),f=l.an((this.top+a-this.bottom)/2,0,a);return new l.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Sa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Os(y,t){if(!y.renderWorldCopies||y.lngRange)return;const a=t.lng-y.center.lng;t.lng+=a>180?-360:a<-180?360:0}function ki(y){return Math.max(0,Math.floor(y))}class No{constructor(t,a){var c;this.applyConstrain=(f,x)=>this._constrainOverride!==null?this._constrainOverride(f,x):this._callbacks.defaultConstrain(f,x),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ki(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Sa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,c){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=ki(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Sa(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=l.W(t,-180,180)*Math.PI/180;var c,f,x,w,C,P,L,j,V;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=Y(),c=this._rotationMatrix,x=-this._bearingInRadians,w=(f=this._rotationMatrix)[0],C=f[1],P=f[2],L=f[3],j=Math.sin(x),V=Math.cos(x),c[0]=w*V+P*j,c[1]=C*V+L*j,c[2]=w*-j+P*V,c[3]=C*-j+L*V)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=l.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aZ(this._fovInRadians)}setFov(t){t=l.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=l.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=l.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this.constrainInternal(),this._calcMatrices()}resize(t,a,c=!0){this._width=t,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Gt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.ao,l.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:c,minY:f,maxX:x,maxY:w}=l.aa.fromPoints(a).extend(t);return[new l.P(c,f),new l.P(x,f),new l.P(x,w),new l.P(c,w),new l.P(c,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=l.ar(new Float64Array(16));l.Q(t,t,[this._width/2,-this._height/2,1]),l.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=l.ar(new Float64Array(16)),l.Q(t,t,[1,-1,1]),l.O(t,t,[-1,-1,0]),l.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,c,f){const x=c!==void 0?c:this.bearing,w=f=f!==void 0?f:this.pitch,{distanceToCenter:C,clampedElevation:P}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,w),{x:L,y:j}=Pn(w,x),V=l.a9.fromLngLat(t,a);let U,Z,Q=l.a_(1,V.y),se=0;do{if(se+=1,se>10)break;Z=C/Q,U=new l.a9(V.x+L*Z,V.y+j*Z),Q=1/U.meterInMercatorCoordinateUnits()}while(Math.abs(C-Z*Q)>1e-12);return{center:U.toLngLat(),elevation:P,zoom:l.at(this.height/2/Math.tan(this.fovInRadians/2)/Z/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,c=l.as(1,this.center.lat)*this.worldSize,f=l.a9.fromLngLat(this.center,this.elevation),x=f.x/a,w=f.y/a,C=f.z/a,P=this.pitch,L=this.bearing,{x:j,y:V,z:U}=Pn(P,L),Z=this.cameraToCenterDistance,Q=x+Z*-j,se=w+Z*-V,ce=C+Z*U,{distanceToCenter:oe,clampedElevation:pe}=this._distanceToCenterFromAltElevationPitch(ce/c,t,P),Te=oe*c,fe=new l.a9((Q+j*Te)*a,(se+V*Te)*a,0).toLngLat(),Se=l.as(1,fe.lat),Ae=l.at(this.height/2/Math.tan(this.fovInRadians/2)/oe/Se/this.tileSize);this._elevation=pe,this._center=fe,this.setZoom(Ae)}_distanceToCenterFromAltElevationPitch(t,a,c){const f=-Math.cos(l.ap(c)),x=t-a;let w,C=a;return f*x>=0||Math.abs(f)<.1?(w=1e4,C=t+w*f):w=-x/f,{distanceToCenter:w,clampedElevation:C}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Ve(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/l.a5,1/a/l.a5]}}class Ta{constructor(t,a){this.min=t,this.max=a,this.center=l.a$([],l.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],c=l.b1(this.min),f=l.b1(this.max);for(let x=0;x<a.length;x++)c[x]=a[x]?this.min[x]:this.center[x],f[x]=a[x]?this.center[x]:this.max[x];return f[2]=this.max[2],new Ta(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let c=0;c<t.planes.length;c++){const f=this.intersectsPlane(t.planes[c]);if(f===0)return 0;f===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],c=t[3];for(let f=0;f<3;f++)t[f]>0?(a+=t[f]*this.min[f],c+=t[f]*this.max[f]):(c+=t[f]*this.min[f],a+=t[f]*this.max[f]);return a>=0?2:c<0?0:1}}class pl{distanceToTile2d(t,a,c,f){const x=f.distanceX([t,a]),w=f.distanceY([t,a]);return Math.hypot(x,w)}getWrap(t,a,c){return c}getTileBoundingVolume(t,a,c,f){var x,w;let C=0,P=0;if(f?.terrain){const j=new l.a2(t.z,a,t.z,t.x,t.y),V=f.terrain.getMinMaxElevation(j);C=(x=V.minElevation)!==null&&x!==void 0?x:Math.min(0,c),P=(w=V.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}const L=1<<t.z;return new Ta([a+t.x/L,t.y/L,C],[a+(t.x+1)/L,(t.y+1)/L,P])}allowVariableZoom(t,a){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,f=l.an(78.5-c/2,0,60);return!!a.terrain||t.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class Kr{constructor(t,a,c){this.points=t,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(t,a=1,c=0,f,x){const w=x?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],C=Math.pow(2,c),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((U=>(function(Z,Q,se,ce){const oe=l.aH([],Z,Q),pe=1/oe[3]/se*ce;return l.b6(oe,oe,[pe,pe,1/oe[3],pe])})(U,t,a,C)));f&&(function(U,Z,Q,se){const ce=se?4:0,oe=se?0:4;let pe=0;const Te=[],fe=[];for(let _e=0;_e<4;_e++){const Re=l.b2([],U[_e+oe],U[_e+ce]),rt=l.b7(Re);l.a$(Re,Re,1/rt),Te.push(rt),fe.push(Re)}for(let _e=0;_e<4;_e++){const Re=l.b8(U[_e+ce],fe[_e],Q);pe=Re!==null&&Re>=0?Math.max(pe,Re):Math.max(pe,Te[_e])}const Se=(function(_e,Re){const rt=l.b2([],_e[Re[0]],_e[Re[1]]),Ke=l.b2([],_e[Re[2]],_e[Re[1]]),et=[0,0,0,0];return l.b3(et,l.b4([],rt,Ke)),et[3]=-l.b5(et,_e[Re[0]]),et})(U,Z),Ae=(function(_e,Re){const rt=l.b9(_e),Ke=l.ba([],_e,1/rt),et=l.b2([],Re,l.a$([],Ke,l.b5(Re,Ke))),tt=l.b9(et);if(tt>0){const Lt=Math.sqrt(1-Ke[3]*Ke[3]),Nt=l.a$([],Ke,-Ke[3]),wt=l.b0([],Nt,l.a$([],et,Lt/tt));return l.bb(Re,wt)}return null})(Q,Se);if(Ae!==null){const _e=Ae/l.b5(fe[0],Se);pe=Math.min(pe,_e)}for(let _e=0;_e<4;_e++){const Re=Math.min(pe,Te[_e]);U[_e+oe]=[U[_e+ce][0]+fe[_e][0]*Re,U[_e+ce][1]+fe[_e][1]*Re,U[_e+ce][2]+fe[_e][2]*Re,1]}})(P,w[0],f,x);const L=w.map((U=>{const Z=l.b2([],P[U[0]],P[U[1]]),Q=l.b2([],P[U[2]],P[U[1]]),se=l.b3([],l.b4([],Z,Q)),ce=-l.b5(se,P[U[1]]);return se.concat(ce)})),j=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],V=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const U of P)for(let Z=0;Z<3;Z++)j[Z]=Math.min(j[Z],U[Z]),V[Z]=Math.max(V[Z],U[Z]);return new Kr(P,L,new Ta(j,V))}}class dr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=l.an(+c,this.minZoom,this.maxZoom);const f={center:new l.V(a.lng,a.lat),zoom:c};let x=this._helper._lngRange;if(!this._helper._renderWorldCopies&&x===null){const fe=179.9999999999;x=[-fe,fe]}const w=this.tileSize*l.aq(f.zoom);let C=0,P=w,L=0,j=w,V=0,U=0;const{x:Z,y:Q}=this.size;if(this._helper._latRange){const fe=this._helper._latRange;C=l.X(fe[1])*w,P=l.X(fe[0])*w,P-C<Q&&(V=Q/(P-C))}x&&(L=l.W(l.Y(x[0])*w,0,w),j=l.W(l.Y(x[1])*w,0,w),j<L&&(j+=w),j-L<Z&&(U=Z/(j-L)));const{x:se,y:ce}=Wt(w,a);let oe,pe;const Te=Math.max(U||0,V||0);if(Te){const fe=new l.P(U?(j+L)/2:se,V?(P+C)/2:ce);return f.center=Jt(w,fe).wrap(),f.zoom+=l.at(Te),f}if(this._helper._latRange){const fe=Q/2;ce-fe<C&&(pe=C+fe),ce+fe>P&&(pe=P-fe)}if(x){const fe=(L+j)/2;let Se=se;this._helper._renderWorldCopies&&(Se=l.W(se,fe-w/2,fe+w/2));const Ae=Z/2;Se-Ae<L&&(oe=L+Ae),Se+Ae>j&&(oe=j-Ae)}if(oe!==void 0||pe!==void 0){const fe=new l.P(oe??se,pe??ce);f.center=Jt(w,fe).wrap()}return f},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new No({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new pl}clone(){const t=new dr;return t.apply(this),t}apply(t,a,c){this._helper.apply(t,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new l.bc(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new l.P(0,0)),f=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),x=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),C=Math.floor(Math.min(c.x,f.x,x.x,w.x)),P=Math.floor(Math.max(c.x,f.x,x.x,w.x)),L=1;for(let j=C-L;j<=P+L;j++)j!==0&&a.push(new l.bc(j,t))}return a}getCameraFrustum(){return Kr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,a){const c=l.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,c),x=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),w=l.a9.fromLngLat(t),C=new l.a9(w.x-(f.x-x.x),w.y-(f.y-x.y));this.setCenter(C?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(l.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(l.a9.fromLngLat(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const c=a||0,f=[t.x,t.y,0,1],x=[t.x,t.y,1,1];l.aH(f,f,this._pixelMatrixInverse),l.aH(x,x,this._pixelMatrixInverse);const w=f[3],C=x[3],P=f[1]/w,L=x[1]/C,j=f[2]/w,V=x[2]/C,U=j===V?0:(c-j)/(V-j);return new l.a9(l.G.number(f[0]/w,x[0]/C,U)/this.worldSize,l.G.number(P,L,U)/this.worldSize,c)}coordinatePoint(t,a=0,c=this._pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,a,1];return l.aH(f,f,c),new l.P(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this._helper._height/2-pn(this));return new Gt().extend(this.screenPointToLocation(new l.P(0,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-pn(this)}calculatePosMatrix(t,a=!1,c){var f;const x=(f=t.key)!==null&&f!==void 0?f:l.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),w=a?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(x)){const L=w.get(x);return c?L.f32:L.f64}const C=Mn(t,this.worldSize);l.S(C,a?this._alignedProjMatrix:this._viewProjMatrix,C);const P={f64:C,f32:new Float32Array(C)};return w.set(x,P),c?P.f32:P.f64}calculateFogMatrix(t){const a=t.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);const f=Mn(t,this.worldSize);return l.S(f,this._fogMatrix,f),c.set(a,new Float32Array(f)),c.get(a)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}_calculateNearFarZIfNeeded(t,a,c){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),x=t-f*this._helper._pixelPerMeter/Math.cos(a),w=f<0?x:t,C=Math.PI/2+this.pitchInRadians,P=l.ap(this.fov)*(Math.abs(Math.cos(l.ap(this.roll)))*this.height+Math.abs(Math.sin(l.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),L=Math.sin(P)*w/Math.sin(l.an(Math.PI-C-P,.01,Math.PI-.01)),j=pn(this),V=Math.atan(j/this._helper.cameraToCenterDistance),U=l.ap(.75),Z=V>U?2*V*(.5+c.y/(2*j)):U,Q=Math.sin(Z)*w/Math.sin(l.an(Math.PI-C-Z,.01,Math.PI-.01)),se=Math.min(L,Q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*se+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Wt(this.worldSize,this.center),c=a.x,f=a.y;this._helper._pixelPerMeter=l.as(1,this.center.lat)*this.worldSize;const x=l.ap(Math.min(this.pitch,Bt)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(x));let C;this._calculateNearFarZIfNeeded(w,x,t),C=new Float64Array(16),l.be(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aB(this._invProjMatrix,C),C[8]=2*-t.x/this._helper._width,C[9]=2*t.y/this._helper._height,this._projectionMatrix=l.bf(C),l.Q(C,C,[1,-1,1]),l.O(C,C,[0,0,-this._helper.cameraToCenterDistance]),l.bg(C,C,-this.rollInRadians),l.bh(C,C,this.pitchInRadians),l.bg(C,C,-this.bearingInRadians),l.O(C,C,[-c,-f,0]),this._mercatorMatrix=l.Q([],C,[this.worldSize,this.worldSize,this.worldSize]),l.Q(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),l.O(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=l.aB([],C);const P=[0,0,-1,1];l.aH(P,P,this._invViewProjMatrix),this._cameraPosition=[P[0]/P[3],P[1]/P[3],P[2]/P[3]],this._fogMatrix=new Float64Array(16),l.be(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,l.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.O(this._fogMatrix,this._fogMatrix,[-c,-f,0]),l.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);const L=this._helper._width%2/2,j=this._helper._height%2/2,V=Math.cos(this.bearingInRadians),U=Math.sin(-this.bearingInRadians),Z=c-Math.round(c)+V*L+U*j,Q=f-Math.round(f)+V*j+U*L,se=new Float64Array(C);if(l.O(se,se,[Z>.5?Z-1:Z,Q>.5?Q-1:Q,0]),this._alignedProjMatrix=se,C=l.aB(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new l.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Ve(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const c=l.a9.fromLngLat(t),f=[c.x*this.worldSize,c.y*this.worldSize,a,1];return l.aH(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(t){const{overscaledTileID:a,aligned:c,applyTerrainMatrix:f}=t,x=this._helper.getMercatorTileCoordinates(a),w=a?this.calculatePosMatrix(a,c,!0):null;let C;return C=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:w||l.bi(),{mainMatrix:C,tileMercatorCoords:x,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,c){return 1}transformLightDirection(t){return l.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,c,f){const x=this.calculatePosMatrix(c);let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,x)):(w=[t,a,0,1],Xe(w,w,x));const C=w[3];return{point:new l.P(w[0]/C,w[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const c=l.a9.fromLngLat(t,a),f=c.meterInMercatorCoordinateUnits(),x=l.bj();return l.O(x,x,[c.x,c.y,c.z]),l.bg(x,x,Math.PI),l.bh(x,x,Math.PI/2),l.Q(x,x,[-f,f,f]),x}getProjectionDataForCustomLayer(t=!0){const a=new l.a2(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),f=Mn(a,this.worldSize);l.S(f,this._viewProjMatrix,f),c.tileMercatorCoords=[0,0,1,1];const x=[l.a5,l.a5,this.worldSize/this._helper.pixelsPerMeter],w=l.bk();return l.Q(w,f,x),c.fallbackMatrix=w,c.mainMatrix=w,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Wr(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Kc(y){if(y.useSlerp)if(y.k<1){const t=l.bl(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),a=l.bl(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),c=new Float64Array(4);l.bm(c,t,a,y.k);const f=l.bn(c);y.tr.setRoll(f.roll),y.tr.setPitch(f.pitch),y.tr.setBearing(f.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(l.G.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(l.G.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(l.G.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function ml(y,t,a,c,f){const x=f.padding,w=Wt(f.worldSize,a.getNorthWest()),C=Wt(f.worldSize,a.getNorthEast()),P=Wt(f.worldSize,a.getSouthEast()),L=Wt(f.worldSize,a.getSouthWest()),j=l.ap(-c),V=w.rotate(j),U=C.rotate(j),Z=P.rotate(j),Q=L.rotate(j),se=new l.P(Math.max(V.x,U.x,Q.x,Z.x),Math.max(V.y,U.y,Q.y,Z.y)),ce=new l.P(Math.min(V.x,U.x,Q.x,Z.x),Math.min(V.y,U.y,Q.y,Z.y)),oe=se.sub(ce),pe=(f.width-(x.left+x.right+t.left+t.right))/oe.x,Te=(f.height-(x.top+x.bottom+t.top+t.bottom))/oe.y;if(Te<0||pe<0)return void Wr();const fe=Math.min(l.at(f.scale*Math.min(pe,Te)),y.maxZoom),Se=l.P.convert(y.offset),Ae=new l.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(l.ap(c)),_e=Se.add(Ae).mult(f.scale/l.aq(fe));return{center:Jt(f.worldSize,w.add(P).div(2).sub(_e)),zoom:fe,bearing:c}}class gl{get useGlobeControls(){return!1}handlePanInertia(t,a){const c=t.mag(),f=Math.abs(pn(a));return{easingOffset:t.mult(Math.min(.75*f/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,c){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,a,c,f,x){return ml(t,a,c,f,x)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(l.V.convert(a.center))}handleEaseTo(t,a){const c=t.zoom,f=t.padding,x={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},C=a.zoom!==void 0,P=!t.isPaddingEqual(a.padding);let L=!1;const j=C?+a.zoom:t.zoom;let V=t.centerPoint.add(a.offsetAsPoint);const U=t.screenPointToLocation(V),{center:Z,zoom:Q}=t.applyConstrain(l.V.convert(a.center||U),j??c);Os(t,Z);const se=Wt(t.worldSize,U),ce=Wt(t.worldSize,Z).sub(se),oe=l.aq(Q-c);return L=Q!==c,{easeFunc:pe=>{if(L&&t.setZoom(l.G.number(c,Q,pe)),l.bo(x,w)||Kc({startEulerAngles:x,endEulerAngles:w,tr:t,k:pe,useSlerp:x.roll!=w.roll}),P&&(t.interpolatePadding(f,a.padding,pe),V=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const Te=l.aq(t.zoom-c),fe=Q>c?Math.min(2,oe):Math.max(.5,oe),Se=Math.pow(fe,1-pe),Ae=Jt(t.worldSize,se.add(ce.mult(pe*Se)).mult(Te));t.setLocationAtPoint(t.renderWorldCopies?Ae.wrap():Ae,V)}},isZooming:L,elevationCenter:Z}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.zoom,x=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),c?+a.zoom:f),w=x.center,C=x.zoom;Os(t,w);const P=Wt(t.worldSize,a.locationAtOffset),L=Wt(t.worldSize,w).sub(P),j=L.mag(),V=l.aq(C-f);let U;if(a.minZoom!==void 0){const Z=Math.min(+a.minZoom,f,C),Q=t.applyConstrain(w,Z).zoom;U=l.aq(Q-f)}return{easeFunc:(Z,Q,se,ce)=>{t.setZoom(Z===1?C:f+l.at(Q));const oe=Z===1?w:Jt(t.worldSize,P.add(L.mult(se)).mult(Q));t.setLocationAtPoint(t.renderWorldCopies?oe.wrap():oe,ce)},scaleOfZoom:V,targetCenter:w,scaleOfMinZoom:U,pixelPathLength:j}}}class li{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}li.Replace=[1,0],li.disabled=new li(li.Replace,l.bp.transparent,[!1,!1,!1,!1]),li.unblended=new li(li.Replace,l.bp.transparent,[!0,!0,!0,!0]),li.alphaBlended=new li([1,771],l.bp.transparent,[!0,!0,!0,!0]);const jo=2305;class Dn{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}Dn.disabled=new Dn(!1,1029,jo),Dn.backCCW=new Dn(!0,1029,jo),Dn.frontCCW=new Dn(!0,1028,jo);class Sn{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}Sn.ReadOnly=!1,Sn.ReadWrite=!0,Sn.disabled=new Sn(519,Sn.ReadOnly,[0,1]);const yl=7680;class Un{constructor(t,a,c,f,x,w){this.test=t,this.ref=a,this.mask=c,this.fail=f,this.depthFail=x,this.pass=w}}Un.disabled=new Un({func:519,mask:0},0,0,yl,yl,yl);const Wc=new WeakMap;function Ha(y){var t;if(Wc.has(y))return Wc.get(y);{const a=(t=y.getParameter(y.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Wc.set(y,a),a}}class Oo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const f=new l.aW;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const x=new l.aY;x.emplaceBack(0,1,2),this._fullscreenTriangle=new fi(a.createVertexBuffer(f,$a.members),a.createIndexBuffer(x),l.aX.simpleSegment(0,0,f.length,x.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);const w=c.createTexture();c.bindTexture(c.TEXTURE_2D,w),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Ha(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const c=this._cachedRenderContext.context,f=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:l.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,f.TRIANGLES,Sn.disabled,Un.disabled,li.unblended,Dn.disabled,((x,w)=>({u_input:x,u_output_expected:w}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ha(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const x=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:x}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ha(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Oo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const Bo=l.a5/128;function Af(y,t){const a=y.granularity!==void 0?Math.max(y.granularity,1):1,c=a+(y.generateBorders?2:0),f=a+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),x=c+1,w=f+1,C=y.generateBorders?-1:0,P=y.generateBorders||y.extendToNorthPole?-1:0,L=a+(y.generateBorders?1:0),j=a+(y.generateBorders||y.extendToSouthPole?1:0),V=x*w,U=c*f*6,Z=x*w>65536;if(Z&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Q=Z||t==="32bit",se=new Int16Array(2*V);let ce=0;for(let Te=P;Te<=j;Te++)for(let fe=C;fe<=L;fe++){let Se=fe/a*l.a5;fe===-1&&(Se=-Bo),fe===a+1&&(Se=l.a5+Bo);let Ae=Te/a*l.a5;Te===-1&&(Ae=y.extendToNorthPole?l.br:-Bo),Te===a+1&&(Ae=y.extendToSouthPole?l.bs:l.a5+Bo),se[ce++]=Se,se[ce++]=Ae}const oe=Q?new Uint32Array(U):new Uint16Array(U);let pe=0;for(let Te=0;Te<f;Te++)for(let fe=0;fe<c;fe++){const Se=fe+1+Te*x,Ae=fe+(Te+1)*x,_e=fe+1+(Te+1)*x;oe[pe++]=fe+Te*x,oe[pe++]=Ae,oe[pe++]=Se,oe[pe++]=Se,oe[pe++]=Ae,oe[pe++]=_e}return{vertices:se.buffer.slice(0),indices:oe.buffer.slice(0),uses32bitIndices:Q}}const Qc=new l.aV({fill:new l.bt(128,2),line:new l.bt(512,0),tile:new l.bt(128,32),stencil:new l.bt(128,1),circle:3});class ld{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return zi.projectionGlobe}get vertexShaderPreludeCode(){return zi.projectionMercator.vertexSource}get subdivisionGranularity(){return Qc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Oo(t));const a=l.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,c),x=he();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=x);const w=Math.min(Math.max((x-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bv(w))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,c,f,x){const w=(x==="stencil"?Qc.stencil:Qc.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:w,generateBorders:c,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(t,a){const c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];const f=(function(x,w){const C=Af(w,"16bit"),P=l.aW.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),L=l.aY.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new fi(x.createVertexBuffer(P,$a.members),x.createIndexBuffer(L),l.aX.simpleSegment(0,0,P.length,L.length))})(t,a);return this._tileMeshCache[c]=f,f}recalculate(t){}hasTransition(){const t=he();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const nm=new l.t({type:new l.D(l.u.projection.type)});class cd extends l.E{constructor(t){super(),this._transitionable=new l.x(nm,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0)),this._mercatorProjection=new yr,this._verticalPerspectiveProjection=new ld}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof l.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,c,f,x){return this.currentProjection.getMeshFromTileID(t,a,c,f,x)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Qr(y){const t=_l(y.worldSize,y.center.lat);return 2*Math.PI*t}function Bs(y,t,a,c,f){const x=1/(1<<f),w=t/l.a5*x+c*x,C=l.by((y/l.a5*x+a*x)*Math.PI*2+Math.PI,2*Math.PI),P=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,L=Math.cos(P),j=new Float64Array(3);return j[0]=Math.sin(C)*L,j[1]=Math.sin(P),j[2]=Math.cos(C)*L,j}function Pi(y){return(function(t,a){const c=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(t)*c,f[1]=Math.sin(a),f[2]=Math.cos(t)*c,f})(y.lng*Math.PI/180,y.lat*Math.PI/180)}function _l(y,t){return y/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Jc(y){const t=Math.asin(y[1])/Math.PI*180,a=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(a>1e-6){const c=y[0]/a,f=Math.acos(y[2]/a),x=(c>0?f:-f)/Math.PI*180;return new l.V(l.W(x,-180,180),t)}return new l.V(0,t)}function eu(y){return Math.cos(y*Math.PI/180)}function qi(y,t){const a=eu(y),c=eu(t);return l.at(c/a)}function zf(y,t){const a=y.rotate(t.bearingInRadians),c=t.zoom+qi(t.center.lat,0),f=l.bu(1/eu(t.center.lat),1/eu(Math.min(Math.abs(t.center.lat),60)),l.bx(c,7,3,0,1)),x=360/Qr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new l.V(t.center.lng-a.x*x*f,l.an(t.center.lat+a.y*x,-l.ao,l.ao))}function eh(y){const t=.5*y,a=Math.sin(t),c=Math.cos(t);return Math.log(a+c)-Math.log(c-a)}function kf(y,t,a,c){const f=y.lat+a*c;if(Math.abs(a)>1){const x=(Math.sign(y.lat+a)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,w=Math.abs(y.lat+a)*Math.PI/180,C=eh(x+c*(w-x)),P=eh(x),L=eh(w);return new l.V(y.lng+t*((C-P)/(L-P)),f)}return new l.V(y.lng+t*c,f)}class im{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,c,f){const x=`${t.z}_${t.x}_${t.y}_${f?.terrain?"t":""}`,w=this._cache.get(x);if(w)return w;const C=this._cachePrevious.get(x);if(C)return this._cache.set(x,C),C;const P=this._boundingVolumeFactory(t,a,c,f);return this._cache.set(x,P),this._hadAnyChanges=!0,P}}class nc{constructor(t,a,c,f){this.min=c,this.max=f,this.points=t,this.planes=a}static fromAabb(t,a){const c=[];for(let f=0;f<8;f++)c.push([1&~f?t[0]:a[0],(f>>1&1)==1?a[1]:t[1],(f>>2&1)==1?a[2]:t[2]]);return new nc(c,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,c){const f=l.bB([],c[0],c[1],c[2]),x=l.bC([],[a[0],0,0],f),w=l.bC([],[0,a[1],0],f),C=l.bC([],[0,0,a[2]],f),P=[...t],L=[...t];for(let V=0;V<8;V++)for(let U=0;U<3;U++){const Z=t[U]+x[U]*(1&~V?-1:1)+w[U]*((V>>1&1)==1?1:-1)+C[U]*((V>>2&1)==1?1:-1);P[U]=Math.min(P[U],Z),L[U]=Math.max(L[U],Z)}const j=[];for(let V=0;V<8;V++){const U=[...t];l.b0(U,U,l.a$([],x,1&~V?-1:1)),l.b0(U,U,l.a$([],w,(V>>1&1)==1?1:-1)),l.b0(U,U,l.a$([],C,(V>>2&1)==1?1:-1)),j.push(U)}return new nc(j,[[...x,-l.b5(x,j[0])],[...w,-l.b5(w,j[0])],[...C,-l.b5(C,j[0])],[-x[0],-x[1],-x[2],-l.b5(x,j[7])],[-w[0],-w[1],-w[2],-l.b5(w,j[7])],[-C[0],-C[1],-C[2],-l.b5(C,j[7])]],P,L)}intersectsFrustum(t){let a=!0;const c=this.points.length,f=this.planes.length,x=t.planes.length,w=t.points.length;for(let C=0;C<x;C++){const P=t.planes[C];let L=0;for(let j=0;j<c;j++){const V=this.points[j];P[0]*V[0]+P[1]*V[1]+P[2]*V[2]+P[3]>=0&&L++}if(L===0)return 0;L<c&&(a=!1)}if(a)return 2;for(let C=0;C<f;C++){const P=this.planes[C];let L=0;for(let j=0;j<w;j++){const V=t.points[j];P[0]*V[0]+P[1]*V[1]+P[2]*V[2]+P[3]>=0&&L++}if(L===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let c=0;for(let f=0;f<a;f++){const x=this.points[f];t[0]*x[0]+t[1]*x[1]+t[2]*x[2]+t[3]>=0&&c++}return c===a?2:c===0?0:1}}function th(y,t,a){const c=y-t;return c<0?-c:Math.max(0,c-a)}function ic(y,t,a,c,f){const x=y-a;let w;return w=x<0?Math.min(-x,1+x-f):x>1?Math.min(Math.max(x-f,0),1-x):0,Math.max(w,th(t,c,f))}class ud{constructor(){this._boundingVolumeCache=new im(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,c,f){const x=1<<c.z,w=1/x,C=c.x/x,P=c.y/x;let L=2;return L=Math.min(L,ic(t,a,C,P,w)),L=Math.min(L,ic(t,a,C+.5,-P-w,w)),L=Math.min(L,ic(t,a,C+.5,2-P-w,w)),L}getWrap(t,a,c){const f=1<<a.z,x=1/f,w=a.x/f,C=th(t.x,w,x),P=th(t.x,w-1,x),L=th(t.x,w+1,x),j=Math.min(C,P,L);return j===L?1:j===P?-1:0}allowVariableZoom(t,a){return ei(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,c,f){return this._boundingVolumeCache.getTileBoundingVolume(t,a,c,f)}_computeTileBoundingVolume(t,a,c,f){var x,w;let C=0,P=0;if(f?.terrain){const L=new l.a2(t.z,a,t.z,t.x,t.y),j=f.terrain.getMinMaxElevation(L);C=(x=j.minElevation)!==null&&x!==void 0?x:Math.min(0,c),P=(w=j.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}if(C/=l.bE,P/=l.bE,C+=1,P+=1,t.z<=0)return nc.fromAabb([-P,-P,-P],[P,P,P]);if(t.z===1)return nc.fromAabb([t.x===0?-P:0,t.y===0?0:-P,-P],[t.x===0?0:P,t.y===0?P:0,P]);{const L=[Bs(0,0,t.x,t.y,t.z),Bs(l.a5,0,t.x,t.y,t.z),Bs(l.a5,l.a5,t.x,t.y,t.z),Bs(0,l.a5,t.x,t.y,t.z)],j=[];for(const et of L)j.push(l.a$([],et,P));if(P!==C)for(const et of L)j.push(l.a$([],et,C));t.y===0&&j.push([0,1,0]),t.y===(1<<t.z)-1&&j.push([0,-1,0]);const V=[1,1,1],U=[-1,-1,-1];for(const et of j)for(let tt=0;tt<3;tt++)V[tt]=Math.min(V[tt],et[tt]),U[tt]=Math.max(U[tt],et[tt]);const Z=Bs(l.a5/2,l.a5/2,t.x,t.y,t.z),Q=l.b4([],[0,1,0],Z);l.b3(Q,Q);const se=l.b4([],Z,Q);l.b3(se,se);const ce=l.b4([],L[2],L[1]);l.b3(ce,ce);const oe=l.b4([],L[0],L[3]);l.b3(oe,oe),j.push(l.a$([],Z,P)),t.y>=(1<<t.z)/2&&j.push(l.a$([],Bs(l.a5/2,0,t.x,t.y,t.z),P)),t.y<(1<<t.z)/2&&j.push(l.a$([],Bs(l.a5/2,l.a5,t.x,t.y,t.z),P));const pe=tu(Z,j),Te=tu(se,j),fe=[-Z[0],-Z[1],-Z[2],pe.max],Se=[Z[0],Z[1],Z[2],-pe.min],Ae=[-se[0],-se[1],-se[2],Te.max],_e=[se[0],se[1],se[2],-Te.min],Re=[...ce,0],rt=[...oe,0],Ke=[];return t.y===0?Ke.push(l.bD(rt,Re,fe),l.bD(rt,Re,Se)):Ke.push(l.bD(Ae,Re,fe),l.bD(Ae,Re,Se),l.bD(Ae,rt,fe),l.bD(Ae,rt,Se)),t.y===(1<<t.z)-1?Ke.push(l.bD(rt,Re,fe),l.bD(rt,Re,Se)):Ke.push(l.bD(_e,Re,fe),l.bD(_e,Re,Se),l.bD(_e,rt,fe),l.bD(_e,rt,Se)),new nc(Ke,[fe,Se,Ae,_e,Re,rt],V,U)}}}function tu(y,t){let a=1/0,c=-1/0;for(const f of t){const x=l.b5(y,f);a=Math.min(a,x),c=Math.max(c,x)}return{min:a,max:c}}class rc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=l.bF(),this._projectionMatrix=l.bj(),this._globeViewProjMatrix32f=l.bi(),this._globeViewProjMatrixNoCorrection=l.bj(),this._globeViewProjMatrixNoCorrectionInverted=l.bj(),this._globeProjMatrixInverted=l.bj(),this._cameraPosition=l.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{const f=l.an(a.lat,-l.ao,l.ao),x=l.an(+c,this.minZoom+qi(0,f),this.maxZoom);return{center:new l.V(a.lng,f),zoom:x}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new No({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new ud}clone(){const t=new rc;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=l.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:c}=t,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,c=this.cameraToCenterDistance/t,f=Math.sin(a)*c,x=Math.cos(a)*c+1,w=1/Math.sqrt(f*f+x*x)*1;let C=-f,P=x;const L=Math.sqrt(C*C+P*P);C/=L,P/=L;const j=[0,C,P];l.bG(j,j,[0,0,0],-this.bearingInRadians),l.bH(j,j,[0,0,0],-1*this.center.lat*Math.PI/180),l.bI(j,j,[0,0,0],this.center.lng*Math.PI/180);const V=1/l.b7(j);return l.a$(j,j,V),[...j,-w*V]}isLocationOccluded(t){return!this.isSurfacePointVisible(Pi(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,f=Math.cos(c),x=[Math.sin(a)*f,Math.sin(c),Math.cos(a)*f],w=[x[2],0,-x[0]],C=[0,0,0];l.b4(C,w,x),l.b3(w,w),l.b3(C,C);const P=[0,0,0];return l.b3(P,[w[0]*t[0]+C[0]*t[1]+x[0]*t[2],w[1]*t[0]+C[1]*t[1]+x[1]*t[2],w[2]*t[0]+C[2]*t[1]+x[2]*t[2]]),P}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,c){const f=(function(C,P,L){const j=1/(1<<L.z);return new l.a9(C/l.a5*j+L.x*j,P/l.a5*j+L.y*j)})(t,a,c.canonical),x=(w=f.y,[l.by(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(x[1])}projectTileCoordinates(t,a,c,f){const x=c.canonical,w=Bs(t,a,x.x,x.y,x.z),C=1+(f?f(t,a):0)/l.bE,P=[w[0]*C,w[1]*C,w[2]*C,1];l.aH(P,P,this._globeViewProjMatrixNoCorrection);const L=this._cachedClippingPlane,j=L[0]*w[0]+L[1]*w[1]+L[2]*w[2]+L[3]<0;return{point:new l.P(P[0]/P[3],P[1]/P[3]),signedDistanceFromCamera:P[3],isOccluded:j}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=_l(this.worldSize,this.center.lat),a=l.bk(),c=l.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),l.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=l.bf(a),this._globeProjMatrixInverted=l.bk(),l.aB(this._globeProjMatrixInverted,a),l.O(a,a,[0,0,-this.cameraToCenterDistance]),l.bg(a,a,this.rollInRadians),l.bh(a,a,-this.pitchInRadians),l.bg(a,a,this.bearingInRadians),l.O(a,a,[0,0,-t]);const x=l.bz();x[0]=t,x[1]=t,x[2]=t,l.bh(c,a,this.center.lat*Math.PI/180),l.bJ(c,c,-this.center.lng*Math.PI/180),l.Q(c,c,x),this._globeViewProjMatrixNoCorrection=c,l.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bJ(a,a,-this.center.lng*Math.PI/180),l.Q(a,a,x),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=l.bk(),l.aB(this._globeViewProjMatrixNoCorrectionInverted,c);const w=l.bz();this._cameraPosition=l.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,l.bG(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),l.bH(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),l.bG(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),l.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bH(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),l.bI(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const C=l.bf(this._globeViewProjMatrixNoCorrectionInverted);l.Q(C,C,[1,1,-1]),this._cachedFrustum=Kr.fromInvProjectionMatrix(C,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){l.w("calculateFogMatrix is not supported on globe projection.");const a=l.bk();return l.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new l.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=Pi(t);l.a$(c,c,1+a/l.bE);const f=l.bF();return l.aH(f,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,c=[new l.P(0,0),new l.P(t,0),new l.P(this.width,0),new l.P(this.width,a),new l.P(this.width,this.height),new l.P(t,this.height),new l.P(0,this.height),new l.P(0,a)],f=[];for(const V of c)f.push(this.unprojectScreenPoint(V));let x=0,w=0,C=0,P=0;const L=this.center;for(const V of f){const U=l.bK(L.lng,V.lng),Z=l.bK(L.lat,V.lat);U<w&&(w=U),U>x&&(x=U),Z<P&&(P=Z),Z>C&&(C=Z)}const j=[L.lng+w,L.lat+P,L.lng+x,L.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(j[3]=90,j[0]=-180,j[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(j[1]=-90,j[0]=-180,j[2]=180),new Gt(j)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){const c=Pi(this.unprojectScreenPoint(a)),f=Pi(t),x=l.bz();l.bL(x);const w=l.bz();l.bI(w,c,x,-this.center.lng*Math.PI/180),l.bH(w,w,x,this.center.lat*Math.PI/180);const C=f[0]*f[0]+f[2]*f[2],P=w[0]*w[0];if(C<P)return;const L=Math.sqrt(C-P),j=-L,V=l.bM(f[0],f[2],w[0],L),U=l.bM(f[0],f[2],w[0],j),Z=l.bz();l.bI(Z,f,x,-V);const Q=l.bM(Z[1],Z[2],w[1],w[2]),se=l.bz();l.bI(se,f,x,-U);const ce=l.bM(se[1],se[2],w[1],w[2]),oe=.5*Math.PI,pe=Q>=-oe&&Q<=oe,Te=ce>=-oe&&ce<=oe;let fe,Se;if(pe&&Te){const rt=this.center.lng*Math.PI/180,Ke=this.center.lat*Math.PI/180;l.bN(V,rt)+l.bN(Q,Ke)<l.bN(U,rt)+l.bN(ce,Ke)?(fe=V,Se=Q):(fe=U,Se=ce)}else if(pe)fe=V,Se=Q;else{if(!Te)return;fe=U,Se=ce}const Ae=fe/Math.PI*180,_e=Se/Math.PI*180,Re=this.center.lat;this.setCenter(new l.V(Ae,l.an(_e,-90,90))),this.setZoom(this.zoom+qi(Re,this.center.lat))}locationToScreenPoint(t,a){const c=Pi(t);if(a){const f=a.getElevationForLngLatZoom(t,this._helper._tileZoom);l.a$(c,c,1+f/l.bE)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new l.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c)return c}return l.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,a){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,f)}getRayDirectionFromPixel(t){const a=l.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,l.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const c=l.bz();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];const f=l.bz();return l.b3(f,c),f}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const c=l.b5(t,a),f=l.bz(),x=l.bz();l.a$(x,a,c),l.b2(f,t,x);const w=1-l.b5(f,f);if(w<0)return null;const C=l.b5(t,t)-1,P=-c+(c<0?1:-1)*Math.sqrt(w),L=C/P,j=P;return{tMin:Math.min(L,j),tMax:Math.max(L,j)}}unprojectScreenPoint(t){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t),f=this.rayPlanetIntersection(a,c);if(f){const j=l.bz();l.b0(j,a,[c[0]*f.tMin,c[1]*f.tMin,c[2]*f.tMin]);const V=l.bz();return l.b3(V,j),Jc(V)}const x=this._cachedClippingPlane,w=x[0]*c[0]+x[1]*c[1]+x[2]*c[2],C=-l.bb(x,a)/w,P=l.bz();if(C>0)l.b0(P,a,[c[0]*C,c[1]*C,c[2]*C]);else{const j=l.bz();l.b0(j,a,[2*c[0],2*c[1],2*c[2]]);const V=l.bb(this._cachedClippingPlane,j);l.b2(P,j,[this._cachedClippingPlane[0]*V,this._cachedClippingPlane[1]*V,this._cachedClippingPlane[2]*V])}const L=(function(j){const V=l.bz();return V[0]=j[0]*-j[3],V[1]=j[1]*-j[3],V[2]=j[2]*-j[3],{center:V,radius:Math.sqrt(1-j[3]*j[3])}})(x);return Jc((function(j,V,U){const Z=l.bz();l.b2(Z,U,j);const Q=l.bz();return l.bA(Q,j,Z,V/l.b9(Z)),Q})(L.center,L.radius,P))}getMatrixForModel(t,a){const c=l.V.convert(t),f=1/l.bE,x=l.bj();return l.bJ(x,x,c.lng/180*Math.PI),l.bh(x,x,-c.lat/180*Math.PI),l.O(x,x,[0,0,1+a/l.bE]),l.bh(x,x,.5*Math.PI),l.Q(x,x,[f,f,f]),x}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new l.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class ac{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new No({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._globeness=1,this._mercatorTransform=new dr,this._verticalPerspectiveTransform=new rc}clone(){const t=new ac;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return l.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,c){const f=this._mercatorTransform.getPitchedTextCorrection(t,a,c),x=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,c);return l.bu(f,x,this._globeness)}projectTileCoordinates(t,a,c,f){return this.currentTransform.projectTileCoordinates(t,a,c,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Qi{get useGlobeControls(){return!0}handlePanInertia(t,a){const c=zf(t,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const c=t.around,f=a.screenPointToLocation(c);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const x=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const w=a.zoom-x;if(w===0)return;const C=l.bK(a.center.lng,f.lng),P=C/(Math.abs(C/180)+1),L=l.bK(a.center.lat,f.lat),j=a.getRayDirectionFromPixel(c),V=a.cameraPosition,U=-1*l.b5(V,j),Z=l.bz();l.b0(Z,V,[j[0]*U,j[1]*U,j[2]*U]);const Q=l.b7(Z)-1,se=Math.exp(.5*-Math.max(Q-.3,0)),ce=_l(a.worldSize,a.center.lat)/Math.min(a.width,a.height),oe=l.bx(ce,.9,.5,1,.25),pe=(1-l.aq(-w))*Math.min(se,oe),Te=a.center.lat,fe=a.zoom,Se=new l.V(a.center.lng+P*pe,l.an(a.center.lat+L*pe,-l.ao,l.ao));a.setLocationAtPoint(f,c);const Ae=a.center,_e=l.bx(Math.abs(C),45,85,0,1),Re=l.bx(ce,.75,.35,0,1),rt=Math.pow(Math.max(_e,Re),.25),Ke=l.bK(Ae.lng,Se.lng),et=l.bK(Ae.lat,Se.lat);a.setCenter(new l.V(Ae.lng+Ke*rt,Ae.lat+et*rt).wrap()),a.setZoom(fe+qi(Te,a.center.lat))}handleMapControlsPan(t,a,c){if(!t.panDelta)return;const f=a.center.lat,x=a.zoom;a.setCenter(zf(t.panDelta,a).wrap()),a.setZoom(x+qi(f,a.center.lat))}cameraForBoxAndBearing(t,a,c,f,x){const w=ml(t,a,c,f,x),C=a.left/x.width*2-1,P=(x.width-a.right)/x.width*2-1,L=a.top/x.height*-2+1,j=(x.height-a.bottom)/x.height*-2+1,V=l.bK(c.getWest(),c.getEast())<0,U=V?c.getEast():c.getWest(),Z=V?c.getWest():c.getEast(),Q=Math.max(c.getNorth(),c.getSouth()),se=Math.min(c.getNorth(),c.getSouth()),ce=U+.5*l.bK(U,Z),oe=Q+.5*l.bK(Q,se),pe=x.clone();pe.setCenter(w.center),pe.setBearing(w.bearing),pe.setPitch(0),pe.setRoll(0),pe.setZoom(w.zoom);const Te=pe.modelViewProjectionMatrix,fe=[Pi(c.getNorthWest()),Pi(c.getNorthEast()),Pi(c.getSouthWest()),Pi(c.getSouthEast()),Pi(new l.V(Z,oe)),Pi(new l.V(U,oe)),Pi(new l.V(ce,Q)),Pi(new l.V(ce,se))],Se=Pi(w.center);let Ae=Number.POSITIVE_INFINITY;for(const _e of fe)C<0&&(Ae=Qi.getLesserNonNegativeNonNull(Ae,Qi.solveVectorScale(_e,Se,Te,"x",C))),P>0&&(Ae=Qi.getLesserNonNegativeNonNull(Ae,Qi.solveVectorScale(_e,Se,Te,"x",P))),L>0&&(Ae=Qi.getLesserNonNegativeNonNull(Ae,Qi.solveVectorScale(_e,Se,Te,"y",L))),j<0&&(Ae=Qi.getLesserNonNegativeNonNull(Ae,Qi.solveVectorScale(_e,Se,Te,"y",j)));if(Number.isFinite(Ae)&&Ae!==0)return w.zoom=pe.zoom+l.at(Ae),w;Wr()}handleJumpToCenterZoom(t,a){const c=t.center.lat,f=t.applyConstrain(a.center?l.V.convert(a.center):t.center,t.zoom).center;t.setCenter(f.wrap());const x=a.zoom!==void 0?+a.zoom:t.zoom+qi(c,f.lat);t.zoom!==x&&t.setZoom(x)}handleEaseTo(t,a){const c=t.zoom,f=t.center,x=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},C={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},P=a.zoom!==void 0,L=!t.isPaddingEqual(a.padding);let j=!1;const V=a.center?l.V.convert(a.center):f,U=t.applyConstrain(V,c).center;Os(t,U);const Z=t.clone();Z.setCenter(U),Z.setZoom(P?+a.zoom:c+qi(f.lat,V.lat)),Z.setBearing(a.bearing);const Q=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));Z.setLocationAtPoint(U,Q);const se=(a.offset&&a.offsetAsPoint.mag())>0?Z.center:U,ce=P?+a.zoom:c+qi(f.lat,se.lat),oe=c+qi(f.lat,0),pe=ce+qi(se.lat,0),Te=l.bK(f.lng,se.lng),fe=l.bK(f.lat,se.lat),Se=l.aq(pe-oe);return j=ce!==c,{easeFunc:Ae=>{if(l.bo(w,C)||Kc({startEulerAngles:w,endEulerAngles:C,tr:t,k:Ae,useSlerp:w.roll!=C.roll}),L&&t.interpolatePadding(x,a.padding,Ae),a.around)l.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const _e=pe>oe?Math.min(2,Se):Math.max(.5,Se),Re=Math.pow(_e,1-Ae),rt=kf(f,Te,fe,Ae*Re);t.setCenter(rt.wrap())}if(j){const _e=l.G.number(oe,pe,Ae)+qi(0,t.center.lat);t.setZoom(_e)}},isZooming:j,elevationCenter:se}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.center,x=t.zoom,w=t.padding,C=!t.isPaddingEqual(a.padding),P=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),x).center,L=c?+a.zoom:t.zoom+qi(t.center.lat,P.lat),j=t.clone();j.setCenter(P),j.setZoom(L),j.setBearing(a.bearing);const V=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));j.setLocationAtPoint(P,V);const U=j.center;Os(t,U);const Z=(function(fe,Se,Ae){const _e=Pi(Se),Re=Pi(Ae),rt=l.b5(_e,Re),Ke=Math.acos(rt),et=Qr(fe);return Ke/(2*Math.PI)*et})(t,f,U),Q=x+qi(f.lat,0),se=L+qi(U.lat,0),ce=l.aq(se-Q);let oe;if(typeof a.minZoom=="number"){const fe=+a.minZoom+qi(U.lat,0),Se=Math.min(fe,Q,se)+qi(0,U.lat),Ae=t.applyConstrain(U,Se).zoom+qi(U.lat,0);oe=l.aq(Ae-Q)}const pe=l.bK(f.lng,U.lng),Te=l.bK(f.lat,U.lat);return{easeFunc:(fe,Se,Ae,_e)=>{const Re=kf(f,pe,Te,Ae);C&&t.interpolatePadding(w,a.padding,fe);const rt=fe===1?U:Re;t.setCenter(rt.wrap());const Ke=Q+l.at(Se);t.setZoom(fe===1?L:Ke+qi(0,rt.lat))},scaleOfZoom:ce,targetCenter:U,scaleOfMinZoom:oe,pixelPathLength:Z}}static solveVectorScale(t,a,c,f,x){const w=f==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],C=[c[3],c[7],c[11],c[15]],P=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],L=t[0]*C[0]+t[1]*C[1]+t[2]*C[2],j=a[0]*w[0]+a[1]*w[1]+a[2]*w[2],V=a[0]*C[0]+a[1]*C[1]+a[2]*C[2];return j+x*L===P+x*V||C[3]*(P-j)+w[3]*(V-L)+P*V==j*L?null:(j+w[3]-x*V-x*C[3])/(j-P-x*V+x*L)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class sc{constructor(t){this._globe=t,this._mercatorCameraHelper=new gl,this._verticalPerspectiveCameraHelper=new Qi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,c){this.currentHelper.handleMapControlsPan(t,a,c)}cameraForBoxAndBearing(t,a,c,f,x){return this.currentHelper.cameraForBoxAndBearing(t,a,c,f,x)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const oc=(y,t)=>l.B(y,t&&t.filter((a=>a.identifier!=="source.canvas"))),lc=l.bO();class Fo extends l.E{constructor(t,a={}){var c,f;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const C=this.tileManagers[w].getSource().type;C!=="vector"&&C!=="geojson"||this.tileManagers[w].reload()}},this.map=t,this.dispatcher=new ln(Ot(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((w,C)=>this.getGlyphs(w,C))),this.dispatcher.registerMessageHandler("GI",((w,C)=>this.getImages(w,C))),this.dispatcher.registerMessageHandler("GDA",((w,C)=>this.getDashes(w,C))),this.imageManager=new Qe,this.imageManager.setEventedParent(this);const x=((c=t._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new ke(t._requestManager,a.localIdeographFontFamily,x),this.lineAtlas=new _t(256,512),this.crossTileSymbolIndex=new gr,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bP()),Le().on(ue,this._rtlPluginLoaded),this.on("data",(w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const C=this.tileManagers[w.sourceId];if(!C)return;const P=C.getSource();if(P&&P.vectorLayerIds)for(const L in this._layers){const j=this._layers[L];j.source===P.id&&this._validateLayer(j)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var c,f,x;this._checkLoaded();const w=a===null?(x=(f=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||f===void 0?void 0:f.default)!==null&&x!==void 0?x:null:a;if(l.bR(w,this._globalState[t]))return this;this._globalState[t]=w,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const c in t)!l.bR(this._globalState[c],t[c].default)&&(a.push(c),this._globalState[c]=t[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,c={};for(const f of t){c[f]=this._globalState[f];for(const x in this._layers){const w=this._layers[x],C=w.getLayoutAffectingGlobalStateRefs(),P=w.getPaintAffectingGlobalStateRefs(),L=w.getVisibilityAffectingGlobalStateRefs();if(C.has(f)&&a.add(w.source),P.has(f))for(const{name:j,value:V}of P.get(f))this._updatePaintProperty(w,j,V);L?.has(f)&&(w.recalculateVisibility(),this._updateLayer(w))}}this.dispatcher.broadcast("UGS",c);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const x=this._loadStyleRequest;l.j(f,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,a,c)})).catch((w=>{this._loadStyleRequest=null,w&&!x.signal.aborted&&this.fire(new l.k(w))}))}loadJSON(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ce.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(lc,{validate:!1})}_load(t,a,c){var f,x;let w=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!oc(this,l.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const C in w.sources)this.addSource(C,w.sources[C],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new bt(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new He(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var t,a,c;const f=l.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",f),this._order=f.map((x=>x.id)),this._layers={},this._serializedLayers=null;for(const x of f){const w=l.bT(x,this._globalState);if(w.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=w,l.bU(w)&&this.tileManagers[w.source]){const C=(c=(a=x.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(C)}}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1);const f=new AbortController;let x;this._spriteRequest=f,(function(w,C,P,L){return l._(this,void 0,void 0,(function*(){const j=it(w),V=P>1?"@2x":"",U={},Z={};for(const{id:Q,url:se}of j){const ce=C.transformRequest($e(se,V,".json"),"SpriteJSON");U[Q]=l.j(ce,L);const oe=C.transformRequest($e(se,V,".png"),"SpriteImage");Z[Q]=nt.getImage(oe,L)}return yield Promise.all([...Object.values(U),...Object.values(Z)]),(function(Q,se){return l._(this,void 0,void 0,(function*(){const ce={};for(const oe in Q){ce[oe]={};const pe=Ce.getImageCanvasContext((yield se[oe]).data),Te=(yield Q[oe]).data;for(const fe in Te){const{width:Se,height:Ae,x:_e,y:Re,sdf:rt,pixelRatio:Ke,stretchX:et,stretchY:tt,content:Lt,textFitWidth:Nt,textFitHeight:wt}=Te[fe];ce[oe][fe]={data:null,pixelRatio:Ke,sdf:rt,stretchX:et,stretchY:tt,content:Lt,textFitWidth:Nt,textFitHeight:wt,spriteData:{width:Se,height:Ae,x:_e,y:Re,context:pe}}}}return ce}))})(U,Z)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const C in w){this._spritesImagesIds[C]=[];const P=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter((L=>!(L in w))):[];for(const L of P)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in w[C]){const j=C==="default"?L:`${C}:${L}`;this._spritesImagesIds[C].push(j),j in this.imageManager.images?this.imageManager.updateImage(j,w[C][L],!1):this.imageManager.addImage(j,w[C][L]),a&&(this._changedImages[j]=!0)}}})).catch((w=>{this._spriteRequest=null,x=w,f.signal.aborted||this.fire(new l.k(x))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),c&&c(x)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.k(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?l.bV(c):c);const f=[];for(const x of t)if(c[x]){const w=a?l.bV(c[x]):c[x];f.push(w)}return f}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const f=this._layers[c];f.type!=="custom"&&(t[c]=f.serialize())}return t}hasTransitions(){var t,a,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(f.length||x.length)&&this._updateWorkerLayers(f,x);for(const w in this._updatedSources){const C=this._updatedSources[w];if(C==="reload")this._reloadSource(w);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const f in this.tileManagers){const x=this.tileManagers[f];c[f]=x.used,x.used=!1}for(const f of this._order){const x=this._layers[f];x.recalculate(t,this._availableImages),!x.isHidden(t.zoom)&&x.source&&(this.tileManagers[x.source].used=!0)}for(const f in c){const x=this.tileManagers[f];!!c[f]!=!!x.used&&x.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var c;this._checkLoaded();const f=this.serialize();if(t=a.transformStyle?a.transformStyle(f,t):t,((c=a.validate)===null||c===void 0||c)&&oc(this,l.C(t)))return!1;(t=l.bV(t)).layers=l.bS(t.layers);const x=l.bW(f,t),w=this._getOperationsToPerform(x);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const C of w.operations)C();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],c=[];for(const f of t)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(f.command)}return{operations:a,unimplemented:c}}addImage(t,a){if(this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.C.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[t]=new Jn(t,a,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t}))),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.tileManagers[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new l.k(new Error(`Layer "${f}" already exists on this map.`)));let x;if(t.type==="custom"){if(oc(this,l.bX(t)))return;x=l.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(f,t.source),t=l.bV(t),t=l.e(t,{source:f})),this._validate(l.C.layer,`layers.${f}`,t,{arrayIndex:-1},c))return;x=l.bT(t,this._globalState),this._validateLayer(x),x.setEventedParent(this,{layer:{id:f}})}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new l.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,f),this._layerOrderChanged=!0,this._layers[f]=x,this._removedLayers[f]&&x.source&&x.type!=="custom"){const C=this._removedLayers[f];delete this._removedLayers[f],C.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.tileManagers[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new l.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===a&&f.maxzoom===c||(a!=null&&(f.minzoom=a),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!l.bR(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(l.C.filter,`layers.${f.id}.filter`,a,null,c)||(f.setFilter(l.bV(a)),this._updateLayer(f)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,c,f={}){this._checkLoaded();const x=this.getLayer(t);x?l.bR(x.getLayoutProperty(a),c)||(x.setLayoutProperty(a,c,f),this._updateLayer(x)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,f={}){this._checkLoaded();const x=this.getLayer(t);x?l.bR(x.getPaintProperty(a),c)||this._updatePaintProperty(x,a,c,f):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,c,f={}){t.setPaintProperty(a,c,f)&&this._updateLayer(t),l.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,f=t.sourceLayer,x=this.tileManagers[c];if(x===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const w=x.getSource().type;w==="geojson"&&f?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||f?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),x.setFeatureState(f,t.id,a)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,f=this.tileManagers[c];if(f===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const x=f.getSource().type,w=x==="vector"?t.sourceLayer:void 0;x!=="vector"||w?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(w,t.id,a):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,t.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.bY(this.tileManagers,(x=>x.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,f=this.stylesheet;return l.bZ({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:t,layers:a,terrain:c},(x=>x!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",c={},f=[];for(let w=this._order.length-1;w>=0;w--){const C=this._order[w];if(a(C)){c[C]=w;for(const P of t){const L=P[C];if(L)for(const j of L)f.push(j)}}}f.sort(((w,C)=>C.intersectionZ-w.intersectionZ));const x=[];for(let w=this._order.length-1;w>=0;w--){const C=this._order[w];if(a(C))for(let P=f.length-1;P>=0;P--){const L=f[P].feature;if(c[L.layer.id]<w)break;x.push(L),f.pop()}else for(const P of t){const L=P[C];if(L)for(const j of L)x.push(j.feature)}}return x}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(l.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const L of a.layers){const j=this._layers[L];if(!j)return this.fire(new l.k(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];f[j.source]=!0}}const x=[];a.availableImages=this._availableImages;const w=this._serializedAllLayers(),C=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,P=Object.assign(Object.assign({},a),{layers:C,globalState:this._globalState});for(const L in this.tileManagers)a.layers&&!f[L]||x.push(gt(this.tileManagers[L],this._layers,w,t,P,c,this.map.terrain?(j,V,U)=>this.map.terrain.getElevation(j,V,U):void 0));return this.placement&&x.push((function(L,j,V,U,Z,Q,se){const ce={},oe=Q.queryRenderedSymbols(U),pe=[];for(const Te of Object.keys(oe).map(Number))pe.push(se[Te]);pe.sort(xt);for(const Te of pe){const fe=Te.featureIndex.lookupSymbolFeatures(oe[Te.bucketInstanceId],j,Te.bucketIndex,Te.sourceLayerIndex,{filterSpec:Z.filter,globalState:Z.globalState},Z.layers,Z.availableImages,L);for(const Se in fe){const Ae=ce[Se]=ce[Se]||[],_e=fe[Se];_e.sort(((Re,rt)=>{const Ke=Te.featureSortOrder;if(Ke){const et=Ke.indexOf(Re.featureIndex);return Ke.indexOf(rt.featureIndex)-et}return rt.featureIndex-Re.featureIndex}));for(const Re of _e)Ae.push(Re)}}return(function(Te,fe,Se){for(const Ae in Te)for(const _e of Te[Ae])zt(_e,Se[fe[Ae].source]);return Te})(ce,L,V)})(this._layers,w,this.tileManagers,t,P,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(t,a){a?.filter&&this._validate(l.C.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.tileManagers[t];return c?(function(f,x){const w=f.getRenderableIds().map((L=>f.getTileByID(L))),C=[],P={};for(let L=0;L<w.length;L++){const j=w[L],V=j.tileID.canonical.key;P[V]||(P[V]=!0,j.querySourceFeatures(C,x))}return C})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const x={now:he(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(x)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const c=this.getSky();let f=!1;if(!t&&!c)return;if(t&&!c)f=!0;else if(!t&&c)f=!0;else for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const x={now:he(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(x)}_setProjectionInternal(t){const a=(function(c,f){const x={constrainOverride:f};if(Array.isArray(c)){const w=new cd({type:c});return{projection:w,transform:new ac(x),cameraHelper:new sc(w)}}switch(c){case"mercator":return{projection:new yr,transform:new dr(x),cameraHelper:new gl};case"globe":{const w=new cd({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new ac(x),cameraHelper:new sc(w)}}case"vertical-perspective":return{projection:new ld,transform:new rc(x),cameraHelper:new Qi};default:return l.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new yr,transform:new dr(x),cameraHelper:new gl}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(t,a,c,f,x={}){return(!x||x.validate!==!1)&&oc(this,t.call(l.C,l.e({key:a,style:this.serialize(),value:c,styleSpec:l.u},f)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Le().off(ue,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,c,f,x=!1){let w=!1,C=!1;const P={};for(const L of this._order){const j=this._layers[L];if(j.type!=="symbol")continue;if(!P[j.source]){const U=this.tileManagers[j.source];P[j.source]=U.getRenderableIds(!0).map((Z=>U.getTileByID(Z))).sort(((Z,Q)=>Q.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(Q.tileID)?-1:1)))}const V=this.crossTileSymbolIndex.addLayer(j,P[j.source],t.center.lng);w=w||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(he(),t.zoom))&&(this.pauseablePlacement=new ba(t,this.map.terrain,this._order,x,a,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(he()),C=!0),w&&this.pauseablePlacement.placement.setStale()),C||w)for(const L of this._order){const j=this._layers[L];j.type==="symbol"&&this.placement.updateLayerOpacities(j,P[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(he())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(l.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return l._(this,void 0,void 0,(function*(){const c={};for(const[f,x]of Object.entries(a.dashes))c[f]=this.lineAtlas.getDash(x.dasharray,x.round);return c}))}addSprite(t,a,c={},f){this._checkLoaded();const x=[{id:t,url:a}],w=[...it(this.stylesheet.sprite),...x];this._validate(l.C.sprite,"sprite",w,null,c)||(this.stylesheet.sprite=w,this._loadSprite(x,!0,f))}removeSprite(t){this._checkLoaded();const a=it(this.stylesheet.sprite);if(a.find((c=>c.id===t))){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return it(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(l.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Pf=l.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class nu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,f,x,w,C,P,L){this.context=t;let j=this.boundPaintVertexBuffers.length!==f.length;for(let V=0;!j&&V<f.length;V++)this.boundPaintVertexBuffers[V]!==f[V]&&(j=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||j||this.boundIndexBuffer!==x||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==L?this.freshBind(a,c,f,x,w,C,P,L):(t.bindVertexArray.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind(),L&&L.bind())}freshBind(t,a,c,f,x,w,C,P){const L=t.numAttributes,j=this.context,V=j.gl;this.vao&&this.destroy(),this.vao=j.createVertexArray(),j.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=P,a.enableAttributes(V,t);for(const U of c)U.enableAttributes(V,t);w&&w.enableAttributes(V,t),C&&C.enableAttributes(V,t),P&&P.enableAttributes(V,t),a.bind(),a.setVertexAttribPointers(V,t,x);for(const U of c)U.bind(),U.setVertexAttribPointers(V,t,x);w&&(w.bind(),w.setVertexAttribPointers(V,t,x)),f&&f.bind(),C&&(C.bind(),C.setVertexAttribPointers(V,t,x)),P&&(P.bind(),P.setVertexAttribPointers(V,t,x)),j.currentNumAttributes=L}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Df=(y,t,a,c,f)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):l.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):l.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),ys={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function nh(y){const t=[];for(let a=0;a<y.length;a++){if(y[a]===null)continue;const c=y[a].split(" ");t.push(c.pop())}return t}class If{constructor(t,a,c,f,x,w,C,P,L=[]){const j=t.gl;this.program=j.createProgram();const V=nh(a.staticAttributes),U=c?c.getBinderAttributes():[],Z=V.concat(U),Q=zi.prelude.staticUniforms?nh(zi.prelude.staticUniforms):[],se=C.staticUniforms?nh(C.staticUniforms):[],ce=a.staticUniforms?nh(a.staticUniforms):[],oe=c?c.getBinderUniforms():[],pe=Q.concat(se).concat(ce).concat(oe),Te=[];for(const Ke of pe)Te.indexOf(Ke)<0&&Te.push(Ke);const fe=c?c.defines():[];Ha(j)&&fe.unshift("#version 300 es"),x&&fe.push("#define OVERDRAW_INSPECTOR;"),w&&fe.push("#define TERRAIN3D;"),P&&fe.push(P),L&&fe.push(...L);let Se=fe.concat(zi.prelude.fragmentSource,C.fragmentSource,a.fragmentSource).join(`
`),Ae=fe.concat(zi.prelude.vertexSource,C.vertexSource,a.vertexSource).join(`
`);Ha(j)||(Se=(function(Ke){return Ke.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Se),Ae=(function(Ke){return Ke.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ae));const _e=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(_e,Se),j.compileShader(_e),!j.getShaderParameter(_e,j.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${j.getShaderInfoLog(_e)}`);j.attachShader(this.program,_e);const Re=j.createShader(j.VERTEX_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(Re,Ae),j.compileShader(Re),!j.getShaderParameter(Re,j.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${j.getShaderInfoLog(Re)}`);j.attachShader(this.program,Re),this.attributes={};const rt={};this.numAttributes=Z.length;for(let Ke=0;Ke<this.numAttributes;Ke++)Z[Ke]&&(j.bindAttribLocation(this.program,Ke,Z[Ke]),this.attributes[Z[Ke]]=Ke);if(j.linkProgram(this.program),!j.getProgramParameter(this.program,j.LINK_STATUS))throw new Error(`Program failed to link: ${j.getProgramInfoLog(this.program)}`);j.deleteShader(Re),j.deleteShader(_e);for(let Ke=0;Ke<Te.length;Ke++){const et=Te[Ke];if(et&&!rt[et]){const tt=j.getUniformLocation(this.program,et);tt&&(rt[et]=tt)}}this.fixedUniforms=f(t,rt),this.terrainUniforms=((Ke,et)=>({u_depth:new l.b_(Ke,et.u_depth),u_terrain:new l.b_(Ke,et.u_terrain),u_terrain_dim:new l.bq(Ke,et.u_terrain_dim),u_terrain_matrix:new l.c0(Ke,et.u_terrain_matrix),u_terrain_unpack:new l.c1(Ke,et.u_terrain_unpack),u_terrain_exaggeration:new l.bq(Ke,et.u_terrain_exaggeration)}))(t,rt),this.projectionUniforms=((Ke,et)=>({u_projection_matrix:new l.c0(Ke,et.u_projection_matrix),u_projection_tile_mercator_coords:new l.c1(Ke,et.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.c1(Ke,et.u_projection_clipping_plane),u_projection_transition:new l.bq(Ke,et.u_projection_transition),u_projection_fallback_matrix:new l.c0(Ke,et.u_projection_fallback_matrix)}))(t,rt),this.binderUniforms=c?c.getUniforms(t,rt):[]}draw(t,a,c,f,x,w,C,P,L,j,V,U,Z,Q,se,ce,oe,pe,Te){const fe=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(f),t.setColorMode(x),t.setCullFace(w),P){t.activeTexture.set(fe.TEXTURE2),fe.bindTexture(fe.TEXTURE_2D,P.depthTexture),t.activeTexture.set(fe.TEXTURE3),fe.bindTexture(fe.TEXTURE_2D,P.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(P[Ae])}if(L)for(const Ae in L)this.projectionUniforms[ys[Ae]].set(L[Ae]);if(C)for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(C[Ae]);ce&&ce.setUniforms(t,this.binderUniforms,Q,{zoom:se});let Se=0;switch(a){case fe.LINES:Se=2;break;case fe.TRIANGLES:Se=3;break;case fe.LINE_STRIP:Se=1}for(const Ae of Z.get()){const _e=Ae.vaos||(Ae.vaos={});(_e[j]||(_e[j]=new nu)).bind(t,this,V,ce?ce.getPaintVertexBuffers():[],U,Ae.vertexOffset,oe,pe,Te),fe.drawElements(a,Ae.primitiveLength*Se,fe.UNSIGNED_SHORT,Ae.primitiveOffset*Se*2)}}}function Rf(y,t,a){const c=1/l.aN(a,1,t.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),x=a.tileSize*Math.pow(2,t.transform.tileZoom)/f,w=x*(a.tileID.canonical.x+a.tileID.wrap*f),C=x*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[w>>16,C>>16],u_pixel_coord_lower:[65535&w,65535&C]}}const ih=(y,t,a,c)=>{const f=y.style.light,x=f.properties.get("position"),w=[x.x,x.y,x.z],C=l.c4();f.properties.get("anchor")==="viewport"&&l.c5(C,y.transform.bearingInRadians),l.c6(w,w,C);const P=y.transform.transformLightDirection(w),L=f.properties.get("color");return{u_lightpos:w,u_lightpos_globe:P,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:c}},rh=(y,t,a,c,f,x,w)=>l.e(ih(y,t,a,c),Rf(x,y,w),{u_height_factor:-Math.pow(2,f.overscaledZ)/w.tileSize/8}),xl=(y,t,a,c)=>l.e(Rf(t,y,a),{u_fill_translate:c}),cc=(y,t)=>({u_world:y,u_fill_translate:t}),Lf=(y,t,a,c,f)=>l.e(xl(y,t,a,f),{u_world:c}),iu=(y,t,a,c,f)=>{const x=y.transform;let w,C,P=0;if(a.paint.get("circle-pitch-alignment")==="map"){const L=l.aN(t,1,x.zoom);w=!0,C=[L,L],P=L/(l.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*f}else w=!1,C=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:P,u_translate:c}},Uo=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),hd=y=>({u_viewport_size:[y.width,y.height]}),ru=(y,t=1)=>({u_color:y,u_overlay:0,u_overlay_scale:t}),Vo=(y,t,a,c)=>{const f=l.aN(y,1,t)/(l.a5*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:l.aN(y,1,t),u_intensity:a,u_globe_extrude_scale:f}},dd=(y,t,a,c)=>{const f=l.N();l.c7(f,0,y.width,y.height,0,0,1);const x=y.context.gl;return{u_matrix:f,u_world:[x.drawingBufferWidth,x.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},au=(y,t,a)=>{const c=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const x=a.getIlluminationProperties();for(let w=0;w<x.directionRadians.length;w++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(x.directionRadians[w]+=y.transform.bearingInRadians);return{u_image:0,u_latrange:rm(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:x.altitudeRadians,u_azimuths:x.directionRadians,u_accent:c,u_method:f,u_highlights:x.highlightColor,u_shadows:x.shadowColor}},Nf=(y,t)=>{const a=t.stride,c=l.N();return l.c7(c,0,l.a5,-l.a5,0,0,1),l.O(c,c,[0,-l.a5,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:y.overscaledZ,u_unpack:t.getUnpackVector()}};function rm(y,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.a9(0,c/a).toLngLat().lat,new l.a9(0,(c+1)/a).toLngLat().lat]}const jf=(y,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:y.paint.get("color-relief-opacity")}),su=(y,t,a,c)=>{const f=y.transform;return{u_translation:ou(y,t,a),u_ratio:c/l.aN(t,1,f.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Of=(y,t,a,c,f)=>l.e(su(y,t,a,c),{u_image:0,u_image_height:f}),fd=(y,t,a,c,f)=>{const x=y.transform,w=Za(t,x);return{u_translation:ou(y,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:c/l.aN(t,1,x.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[w,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},ra=(y,t,a,c,f)=>{const x=Za(t,y.transform);return l.e(su(y,t,a,c),{u_tileratio:x,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})},qo=(y,t,a,c,f,x)=>{const w=Za(t,y.transform);return l.e(su(y,t,a,c),{u_image:0,u_image_height:x,u_tileratio:w,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})};function Za(y,t){return 1/l.aN(y,1,t.tileZoom)}function ou(y,t,a){return l.aO(y.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ah=(y,t,a,c,f)=>{return{u_tl_parent:y,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(x=c.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:sh(c.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var x,w};function sh(y){y*=Math.PI/180;const t=Math.sin(y),a=Math.cos(y);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const lu=(y,t,a,c,f,x,w,C,P,L,j,V,U)=>{const Z=w.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:Z.width/Z.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:P,u_is_text:+j,u_pitch_with_map:+c,u_is_along_line:f,u_is_variable_anchor:x,u_texsize:V,u_texture:0,u_translation:L,u_pitched_scale:U}},oh=(y,t,a,c,f,x,w,C,P,L,j,V,U,Z)=>{const Q=w.transform;return l.e(lu(y,t,a,c,f,x,w,C,P,L,j,V,Z),{u_gamma_scale:c?Math.cos(Q.pitch*Math.PI/180)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},Xa=(y,t,a,c,f,x,w,C,P,L,j,V,U)=>l.e(oh(y,t,a,c,f,x,w,C,P,L,!0,j,0,U),{u_texsize_icon:V,u_texture_icon:1}),cu=(y,t)=>({u_opacity:y,u_color:t}),uu=(y,t,a,c,f)=>l.e((function(x,w,C,P){const L=C.imageManager.getPattern(x.from.toString()),j=C.imageManager.getPattern(x.to.toString()),{width:V,height:U}=C.imageManager.getPixelSize(),Z=Math.pow(2,P.tileID.overscaledZ),Q=P.tileSize*Math.pow(2,C.transform.tileZoom)/Z,se=Q*(P.tileID.canonical.x+P.tileID.wrap*Z),ce=Q*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[V,U],u_mix:w.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/l.aN(P,1,C.transform.tileZoom),u_pixel_coord_upper:[se>>16,ce>>16],u_pixel_coord_lower:[65535&se,65535&ce]}})(a,f,t,c),{u_opacity:y}),lh=(y,t)=>{},Bf={fillExtrusion:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillExtrusionPattern:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_height_factor:new l.bq(y,t.u_height_factor),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),fill:(y,t)=>({u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillPattern:(y,t)=>({u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutline:(y,t)=>({u_world:new l.c3(y,t.u_world),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutlinePattern:(y,t)=>({u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),circle:(y,t)=>({u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_scale_with_map:new l.b_(y,t.u_scale_with_map),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_extrude_scale:new l.c3(y,t.u_extrude_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale),u_translate:new l.c3(y,t.u_translate)}),collisionBox:(y,t)=>({u_pixel_extrude_scale:new l.c3(y,t.u_pixel_extrude_scale)}),collisionCircle:(y,t)=>({u_viewport_size:new l.c3(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new l.b$(y,t.u_color),u_overlay:new l.b_(y,t.u_overlay),u_overlay_scale:new l.bq(y,t.u_overlay_scale)}),depth:lh,clippingMask:lh,heatmap:(y,t)=>({u_extrude_scale:new l.bq(y,t.u_extrude_scale),u_intensity:new l.bq(y,t.u_intensity),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale)}),heatmapTexture:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_color_ramp:new l.b_(y,t.u_color_ramp),u_opacity:new l.bq(y,t.u_opacity)}),hillshade:(y,t)=>({u_image:new l.b_(y,t.u_image),u_latrange:new l.c3(y,t.u_latrange),u_exaggeration:new l.bq(y,t.u_exaggeration),u_altitudes:new l.c9(y,t.u_altitudes),u_azimuths:new l.c9(y,t.u_azimuths),u_accent:new l.b$(y,t.u_accent),u_method:new l.b_(y,t.u_method),u_shadows:new l.c8(y,t.u_shadows),u_highlights:new l.c8(y,t.u_highlights)}),hillshadePrepare:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_image:new l.b_(y,t.u_image),u_dimension:new l.c3(y,t.u_dimension),u_zoom:new l.bq(y,t.u_zoom),u_unpack:new l.c1(y,t.u_unpack)}),colorRelief:(y,t)=>({u_image:new l.b_(y,t.u_image),u_unpack:new l.c1(y,t.u_unpack),u_dimension:new l.c3(y,t.u_dimension),u_elevation_stops:new l.b_(y,t.u_elevation_stops),u_color_stops:new l.b_(y,t.u_color_stops),u_color_ramp_size:new l.b_(y,t.u_color_ramp_size),u_opacity:new l.bq(y,t.u_opacity)}),line:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height)}),linePattern:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_texsize:new l.c3(y,t.u_texsize),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_image:new l.b_(y,t.u_image),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),lineSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_mix:new l.bq(y,t.u_mix),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),lineGradientSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_image_dash:new l.b_(y,t.u_image_dash),u_mix:new l.bq(y,t.u_mix),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),raster:(y,t)=>({u_tl_parent:new l.c3(y,t.u_tl_parent),u_scale_parent:new l.bq(y,t.u_scale_parent),u_buffer_scale:new l.bq(y,t.u_buffer_scale),u_fade_t:new l.bq(y,t.u_fade_t),u_opacity:new l.bq(y,t.u_opacity),u_image0:new l.b_(y,t.u_image0),u_image1:new l.b_(y,t.u_image1),u_brightness_low:new l.bq(y,t.u_brightness_low),u_brightness_high:new l.bq(y,t.u_brightness_high),u_saturation_factor:new l.bq(y,t.u_saturation_factor),u_contrast_factor:new l.bq(y,t.u_contrast_factor),u_spin_weights:new l.c2(y,t.u_spin_weights),u_coords_top:new l.c1(y,t.u_coords_top),u_coords_bottom:new l.c1(y,t.u_coords_bottom)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texsize_icon:new l.c3(y,t.u_texsize_icon),u_texture:new l.b_(y,t.u_texture),u_texture_icon:new l.b_(y,t.u_texture_icon),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),background:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_color:new l.b$(y,t.u_color)}),backgroundPattern:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_image:new l.b_(y,t.u_image),u_pattern_tl_a:new l.c3(y,t.u_pattern_tl_a),u_pattern_br_a:new l.c3(y,t.u_pattern_br_a),u_pattern_tl_b:new l.c3(y,t.u_pattern_tl_b),u_pattern_br_b:new l.c3(y,t.u_pattern_br_b),u_texsize:new l.c3(y,t.u_texsize),u_mix:new l.bq(y,t.u_mix),u_pattern_size_a:new l.c3(y,t.u_pattern_size_a),u_pattern_size_b:new l.c3(y,t.u_pattern_size_b),u_scale_a:new l.bq(y,t.u_scale_a),u_scale_b:new l.bq(y,t.u_scale_b),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bq(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_ele_delta:new l.bq(y,t.u_ele_delta),u_fog_matrix:new l.c0(y,t.u_fog_matrix),u_fog_color:new l.b$(y,t.u_fog_color),u_fog_ground_blend:new l.bq(y,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bq(y,t.u_fog_ground_blend_opacity),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon_fog_blend:new l.bq(y,t.u_horizon_fog_blend),u_is_globe_mode:new l.bq(y,t.u_is_globe_mode)}),terrainDepth:(y,t)=>({u_ele_delta:new l.bq(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_terrain_coords_id:new l.bq(y,t.u_terrain_coords_id),u_ele_delta:new l.bq(y,t.u_ele_delta)}),projectionErrorMeasurement:(y,t)=>({u_input:new l.bq(y,t.u_input),u_output_expected:new l.bq(y,t.u_output_expected)}),atmosphere:(y,t)=>({u_sun_pos:new l.c2(y,t.u_sun_pos),u_atmosphere_blend:new l.bq(y,t.u_atmosphere_blend),u_globe_position:new l.c2(y,t.u_globe_position),u_globe_radius:new l.bq(y,t.u_globe_radius),u_inv_proj_matrix:new l.c0(y,t.u_inv_proj_matrix)}),sky:(y,t)=>({u_sky_color:new l.b$(y,t.u_sky_color),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon:new l.c3(y,t.u_horizon),u_horizon_normal:new l.c3(y,t.u_horizon_normal),u_sky_horizon_blend:new l.bq(y,t.u_sky_horizon_blend),u_sky_blend:new l.bq(y,t.u_sky_blend)})};class vl{constructor(t,a,c){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pd{constructor(t,a,c,f){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=t;const x=t.gl;this.buffer=x.createBuffer(),t.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const f=a.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,a,c){for(let f=0;f<this.attributes.length;f++){const x=this.attributes[f],w=a.attributes[x.name];w!==void 0&&t.vertexAttribPointer(w,x.components,t[bl[x.type]],!1,this.itemSize,x.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Kn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fs extends Kn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class hu extends Kn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class du extends Kn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ch extends Kn{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wl extends Kn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class fu extends Kn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class uc extends Kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ea extends Kn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class md extends Kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class uh extends Kn{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ma extends Kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Us extends Kn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Jr extends Kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class ho extends Kn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Sl extends Kn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Tl extends Kn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class pu extends Kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Go extends Kn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ya extends Kn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class gd extends Kn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class hc extends Kn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Tn extends Kn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hh extends Kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ca extends Kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class dh extends Kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Aa extends Kn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ff extends Kn{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class fh extends Kn{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Ha(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class $o extends Kn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class yd extends Kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ph extends Kn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ho extends Kn{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class dc extends Ho{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ea extends Ho{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Zo extends Ho{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Xo="Framebuffer is not complete";class El{constructor(t,a,c,f,x){this.context=t,this.width=a,this.height=c;const w=t.gl,C=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new dc(t,C),f)this.depthAttachment=x?new Zo(t,C):new ea(t,C);else if(x)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(Xo)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Yo{constructor(t){var a,c;if(this.gl=t,this.clearColor=new Fs(this),this.clearDepth=new hu(this),this.clearStencil=new du(this),this.colorMask=new ch(this),this.depthMask=new wl(this),this.stencilMask=new fu(this),this.stencilFunc=new uc(this),this.stencilOp=new Ea(this),this.stencilTest=new md(this),this.depthRange=new uh(this),this.depthTest=new Ma(this),this.depthFunc=new Us(this),this.blend=new Jr(this),this.blendFunc=new ho(this),this.blendColor=new Sl(this),this.blendEquation=new Tl(this),this.cullFace=new pu(this),this.cullFaceSide=new Go(this),this.frontFace=new Ya(this),this.program=new gd(this),this.activeTexture=new hc(this),this.viewport=new Tn(this),this.bindFramebuffer=new hh(this),this.bindRenderbuffer=new Ca(this),this.bindTexture=new dh(this),this.bindVertexBuffer=new Aa(this),this.bindElementBuffer=new Ff(this),this.bindVertexArray=new fh(this),this.pixelStoreUnpack=new $o(this),this.pixelStoreUnpackPremultiplyAlpha=new yd(this),this.pixelStoreUnpackFlipY=new ph(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ha(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:f?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new vl(this,t,a)}createVertexBuffer(t,a,c){return new pd(this,t,a,c)}createRenderbuffer(t,a,c){const f=this.gl,x=f.createRenderbuffer();return this.bindRenderbuffer.set(x),f.renderbufferStorage(f.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),x}createFramebuffer(t,a,c,f){return new El(this,t,a,c,f)}clear({color:t,depth:a,stencil:c}){const f=this.gl;let x=0;t&&(x|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(x|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(x|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.bR(t.blendFunction,li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ha(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Ha(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let _r;function Tr(y,t,a,c,f){const x=y.context,w=y.transform,C=x.gl,P=y.useProgram("collisionBox"),L=[];let j=0,V=0;for(let oe=0;oe<c.length;oe++){const pe=c[oe],Te=t.getTile(pe).getBucket(a);if(!Te)continue;const fe=f?Te.textCollisionBox:Te.iconCollisionBox,Se=Te.collisionCircleArray;Se.length>0&&(L.push({circleArray:Se,circleOffset:V,coord:pe}),j+=Se.length/4,V=j),fe&&P.draw(x,C.LINES,Sn.disabled,Un.disabled,y.colorModeForRenderPass(),Dn.disabled,Uo(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe),w.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,y.transform.zoom,null,null,fe.collisionVertexBuffer)}if(!f||!L.length)return;const U=y.useProgram("collisionCircle"),Z=new l.ca;Z.resize(4*j),Z._trim();let Q=0;for(const oe of L)for(let pe=0;pe<oe.circleArray.length/4;pe++){const Te=4*pe,fe=oe.circleArray[Te+0],Se=oe.circleArray[Te+1],Ae=oe.circleArray[Te+2],_e=oe.circleArray[Te+3];Z.emplace(Q++,fe,Se,Ae,_e,0),Z.emplace(Q++,fe,Se,Ae,_e,1),Z.emplace(Q++,fe,Se,Ae,_e,2),Z.emplace(Q++,fe,Se,Ae,_e,3)}(!_r||_r.length<2*j)&&(_r=(function(oe){const pe=2*oe,Te=new l.cc;Te.resize(pe),Te._trim();for(let fe=0;fe<pe;fe++){const Se=6*fe;Te.uint16[Se+0]=4*fe+0,Te.uint16[Se+1]=4*fe+1,Te.uint16[Se+2]=4*fe+2,Te.uint16[Se+3]=4*fe+2,Te.uint16[Se+4]=4*fe+3,Te.uint16[Se+5]=4*fe+0}return Te})(j));const se=x.createIndexBuffer(_r,!0),ce=x.createVertexBuffer(Z,l.cb.members,!0);for(const oe of L){const pe=hd(y.transform);U.draw(x,C.TRIANGLES,Sn.disabled,Un.disabled,y.colorModeForRenderPass(),Dn.disabled,pe,y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe.coord),null,a.id,ce,se,l.aX.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,y.transform.zoom,null,null,null)}ce.destroy(),se.destroy()}const Vs=l.ar(new Float32Array(16));function qs(y,t,a,c,f,x){const{horizontalAlign:w,verticalAlign:C}=l.aS(y);return new l.P((-(w-.5)*t/f+c[0])*x,(-(C-.5)*a/f+c[1])*x)}function aa(y,t,a,c,f,x){const w=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let C=c.mult(x);a||(C=C.rotate(-f));const P=w.add(C);return _n(P.x,P.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const C=On(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(y),P=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return y.add(c.rotate(P))}return y.add(c)}function fo(y,t,a,c,f,x,w,C,P,L,j,V){const U=y.text.placedSymbolArray,Z=y.text.dynamicLayoutVertexArray,Q=y.icon.dynamicLayoutVertexArray,se={};Z.clear();for(let ce=0;ce<U.length;ce++){const oe=U.get(ce),pe=oe.hidden||!oe.crossTileID||y.allowVerticalPlacement&&!oe.placedOrientation?null:c[oe.crossTileID];if(pe){const Te=new l.P(oe.anchorX,oe.anchorY),fe={getElevation:V,width:f.width,height:f.height,pitchedLabelPlaneMatrix:x,pitchWithMap:a,transform:f,tileAnchorPoint:Te,translation:L,unwrappedTileID:j},Se=a?Lo(Te.x,Te.y,fe):On(Te.x,Te.y,fe),Ae=Rs(f.cameraToCenterDistance,Se.signedDistanceFromCamera);let _e=l.aA(y.textSizeData,C,oe)*Ae/l.aM;a&&(_e*=y.tilePixelRatio/w);const{width:Re,height:rt,anchor:Ke,textOffset:et,textBoxScale:tt}=pe,Lt=qs(Ke,Re,rt,et,tt,_e),Nt=f.getPitchedTextCorrection(Te.x+L[0],Te.y+L[1],j),wt=aa(Se.point,fe,t,Lt,-f.bearingInRadians,Nt),Ft=y.allowVerticalPlacement&&oe.placedOrientation===l.az.vertical?Math.PI/2:0;for(let vn=0;vn<oe.numGlyphs;vn++)l.aG(Z,wt,Ft);P&&oe.associatedIconIndex>=0&&(se[oe.associatedIconIndex]={shiftedAnchor:wt,angle:Ft})}else Va(oe.numGlyphs,Z)}if(P){Q.clear();const ce=y.icon.placedSymbolArray;for(let oe=0;oe<ce.length;oe++){const pe=ce.get(oe);if(pe.hidden)Va(pe.numGlyphs,Q);else{const Te=se[oe];if(Te)for(let fe=0;fe<pe.numGlyphs;fe++)l.aG(Q,Te.shiftedAnchor,Te.angle);else Va(pe.numGlyphs,Q)}}y.icon.dynamicLayoutVertexBuffer.updateData(Q)}y.text.dynamicLayoutVertexBuffer.updateData(Z)}function _d(y,t,a){return a.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Ml(y,t,a,c,f,x,w,C,P,L,j,V,U){const Z=y.context,Q=Z.gl,se=y.transform,ce=C==="map",oe=P==="map",pe=C!=="viewport"&&a.layout.get("symbol-placement")!=="point",Te=ce&&!oe&&!pe,fe=!a.layout.get("symbol-sort-key").isConstant();let Se=!1;const Ae=y.getDepthModeForSublayer(0,Sn.ReadOnly),_e=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[],rt=se.getCircleRadiusCorrection();for(const Ke of c){const et=t.getTile(Ke),tt=et.getBucket(a);if(!tt)continue;const Lt=f?tt.text:tt.icon;if(!Lt||!Lt.segments.get().length||!Lt.hasVisibleVertices)continue;const Nt=Lt.programConfigurations.get(a.id),wt=f||tt.sdfIcons,Ft=f?tt.textSizeData:tt.iconSizeData,vn=oe||se.pitch!==0,ni=y.useProgram(_d(wt,f,tt),Nt),vi=l.ay(Ft,se.zoom),mi=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ke);let Mi,ci,Oi,Ci,Mr=[0,0],$i=null;if(f)ci=et.glyphAtlasTexture,Oi=Q.LINEAR,Mi=et.glyphAtlasTexture.size,tt.iconsInText&&(Mr=et.imageAtlasTexture.size,$i=et.imageAtlasTexture,Ci=vn||y.options.rotating||y.options.zooming||Ft.kind==="composite"||Ft.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const ai=a.layout.get("icon-size").constantOr(0)!==1||tt.iconsNeedLinear;ci=et.imageAtlasTexture,Oi=wt||y.options.rotating||y.options.zooming||ai||vn?Q.LINEAR:Q.NEAREST,Mi=et.imageAtlasTexture.size}const Hi=l.aN(et,1,y.transform.zoom),Cr=Zr(ce,y.transform,Hi),no=l.N();l.aB(no,Cr);const io=hl(oe,ce,y.transform,Hi),Ts=l.aO(se,et,x,w),ca=se.getProjectionData({overscaledTileID:Ke,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),Ll=_e&&tt.hasTextData(),wc=a.layout.get("icon-text-fit")!=="none"&&Ll&&tt.hasIconData();if(pe){const ai=y.style.map.terrain?(sr,fr)=>y.style.map.terrain.getElevation(Ke,sr,fr):null,gi=a.layout.get("text-rotation-alignment")==="map";fs(tt,y,f,Cr,no,oe,L,gi,Ke.toUnwrapped(),se.width,se.height,Ts,ai)}const Es=f&&_e||wc,ua=pe||Es?Vs:oe?Cr:y.transform.clipSpaceToPixelsMatrix,Ia=wt&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ts;ts=wt?tt.iconsInText?Xa(Ft.kind,vi,Te,oe,pe,Es,y,ua,io,Ts,Mi,Mr,rt):oh(Ft.kind,vi,Te,oe,pe,Es,y,ua,io,Ts,f,Mi,0,rt):lu(Ft.kind,vi,Te,oe,pe,Es,y,ua,io,Ts,f,Mi,rt);const ns={program:ni,buffers:Lt,uniformValues:ts,projectionData:ca,atlasTexture:ci,atlasTextureIcon:$i,atlasInterpolation:Oi,atlasInterpolationIcon:Ci,isSDF:wt,hasHalo:Ia};if(fe&&tt.canOverlap){Se=!0;const ai=Lt.segments.get();for(const gi of ai)Re.push({segments:new l.aX([gi]),sortKey:gi.sortKey,state:ns,terrainData:mi})}else Re.push({segments:Lt.segments,sortKey:0,state:ns,terrainData:mi})}Se&&Re.sort(((Ke,et)=>Ke.sortKey-et.sortKey));for(const Ke of Re){const et=Ke.state;if(Z.activeTexture.set(Q.TEXTURE0),et.atlasTexture.bind(et.atlasInterpolation,Q.CLAMP_TO_EDGE),et.atlasTextureIcon&&(Z.activeTexture.set(Q.TEXTURE1),et.atlasTextureIcon&&et.atlasTextureIcon.bind(et.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),et.isSDF){const tt=et.uniformValues;et.hasHalo&&(tt.u_is_halo=1,fc(et.buffers,Ke.segments,a,y,et.program,Ae,j,V,tt,et.projectionData,Ke.terrainData)),tt.u_is_halo=0}fc(et.buffers,Ke.segments,a,y,et.program,Ae,j,V,et.uniformValues,et.projectionData,Ke.terrainData)}}function fc(y,t,a,c,f,x,w,C,P,L,j){const V=c.context;f.draw(V,V.gl.TRIANGLES,x,w,C,Dn.backCCW,P,j,L,a.id,y.layoutVertexBuffer,y.indexBuffer,t,a.paint,c.transform.zoom,y.programConfigurations.get(a.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function xd(y,t,a,c,f){const x=y.context,w=x.gl,C=Un.disabled,P=new li([w.ONE,w.ONE],l.bp.transparent,[!0,!0,!0,!0]),L=t.getBucket(a);if(!L)return;const j=c.key;let V=a.heatmapFbos.get(j);V||(V=pi(x,t.tileSize,t.tileSize),a.heatmapFbos.set(j,V)),x.bindFramebuffer.set(V.framebuffer),x.viewport.set([0,0,t.tileSize,t.tileSize]),x.clear({color:l.bp.transparent});const U=L.programConfigurations.get(a.id),Z=y.useProgram("heatmap",U,!f),Q=y.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=y.style.map.terrain.getTerrainData(c);Z.draw(x,w.TRIANGLES,Sn.disabled,C,P,Dn.disabled,Vo(t,y.transform.zoom,a.paint.get("heatmap-intensity"),1),se,Q,a.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,a.paint,y.transform.zoom,U)}function Er(y,t,a,c,f){const x=y.context,w=x.gl,C=y.transform;x.setColorMode(y.colorModeForRenderPass());const P=Bn(x,t),L=a.key,j=t.heatmapFbos.get(L);if(!j)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,j.colorAttachment.get()),x.activeTexture.set(w.TEXTURE1),P.bind(w.LINEAR,w.CLAMP_TO_EDGE);const V=C.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!c});y.useProgram("heatmapTexture").draw(x,w.TRIANGLES,Sn.disabled,Un.disabled,y.colorModeForRenderPass(),Dn.disabled,dd(y,t,0,1),null,V,t.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,t.paint,C.zoom),j.destroy(),t.heatmapFbos.delete(L)}function pi(y,t,a){var c,f;const x=y.gl,w=x.createTexture();x.bindTexture(x.TEXTURE_2D,w),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR);const C=(c=y.HALF_FLOAT)!==null&&c!==void 0?c:x.UNSIGNED_BYTE,P=(f=y.RGBA16F)!==null&&f!==void 0?f:x.RGBA;x.texImage2D(x.TEXTURE_2D,0,P,t,a,0,x.RGBA,C,null);const L=y.createFramebuffer(t,a,!1,!1);return L.colorAttachment.set(w),L}function Bn(y,t){return t.colorRampTexture||(t.colorRampTexture=new l.T(y,t.colorRamp,y.gl.RGBA)),t.colorRampTexture}function po(y,t,a,c,f,x,w,C){let P=256;if(f.stepInterpolant){const L=t.getSource().maxzoom,j=w.canonical.z===L?Math.ceil(1<<y.transform.maxZoom-w.canonical.z):1;P=l.an(l.ce(x.maxLineLength/l.a5*1024*j),256,a.maxTextureSize)}return C.gradient=l.cf({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:P,image:C.gradient||void 0,clips:x.lineClipsArray}),C.texture?C.texture.update(C.gradient):C.texture=new l.T(a,C.gradient,c.RGBA),C.version=f.gradientVersion,C.texture}function za(y,t,a,c,f){y.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),c.updatePaintBuffers(f)}function Ni(y,t,a,c,f,x){(f||y.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),y.lineAtlas.bind(t)),c.updatePaintBuffers(x)}function sa(y,t,a,c,f,x,w){const C=x.gradients[f.id];let P=C.texture;f.gradientVersion!==C.version&&(P=po(y,t,a,c,f,x,w,C)),a.activeTexture.set(c.TEXTURE0),P.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function oa(y,t,a,c,f,x,w,C,P){const L=x.gradients[f.id];let j=L.texture;f.gradientVersion!==L.version&&(j=po(y,t,a,c,f,x,w,L)),a.activeTexture.set(c.TEXTURE0),j.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),y.lineAtlas.bind(a),C.updatePaintBuffers(P)}function mu(y,t,a,c,f){if(!a||!c||!c.imageAtlas)return;const x=c.imageAtlas.patternPositions;let w=x[a.to.toString()],C=x[a.from.toString()];if(!w&&C&&(w=C),!C&&w&&(C=w),!w||!C){const P=f.getPaintProperty(t);w=x[P],C=x[P]}w&&C&&y.setConstantPatternPositions(w,C)}function Gs(y,t,a,c,f,x,w,C){const P=y.context.gl,L="fill-pattern",j=a.paint.get(L),V=j&&j.constantOr(1),U=a.getCrossfadeParameters();let Z,Q,se,ce,oe;const pe=y.transform,Te=a.paint.get("fill-translate"),fe=a.paint.get("fill-translate-anchor");w?(Q=V&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=P.LINES):(Q=V?"fillPattern":"fill",Z=P.TRIANGLES);const Se=j.constantOr(null);for(const Ae of c){const _e=t.getTile(Ae);if(V&&!_e.patternsLoaded())continue;const Re=_e.getBucket(a);if(!Re)continue;const rt=Re.programConfigurations.get(a.id),Ke=y.useProgram(Q,rt),et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae);V&&(y.context.activeTexture.set(P.TEXTURE0),_e.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),rt.updatePaintBuffers(U)),mu(rt,L,Se,_e,a);const tt=pe.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),Lt=l.aO(pe,_e,Te,fe);if(w){ce=Re.indexBuffer2,oe=Re.segments2;const wt=[P.drawingBufferWidth,P.drawingBufferHeight];se=Q==="fillOutlinePattern"&&V?Lf(y,U,_e,wt,Lt):cc(wt,Lt)}else ce=Re.indexBuffer,oe=Re.segments,se=V?xl(y,U,_e,Lt):{u_fill_translate:Lt};const Nt=y.stencilModeForClipping(Ae);Ke.draw(y.context,Z,f,Nt,x,Dn.backCCW,se,et,tt,a.id,Re.layoutVertexBuffer,ce,oe,a.paint,y.transform.zoom,rt)}}function $s(y,t,a,c,f,x,w,C){const P=y.context,L=P.gl,j="fill-extrusion-pattern",V=a.paint.get(j),U=V.constantOr(1),Z=a.getCrossfadeParameters(),Q=a.paint.get("fill-extrusion-opacity"),se=V.constantOr(null),ce=y.transform;for(const oe of c){const pe=t.getTile(oe),Te=pe.getBucket(a);if(!Te)continue;const fe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe),Se=Te.programConfigurations.get(a.id),Ae=y.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Se);U&&(y.context.activeTexture.set(L.TEXTURE0),pe.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Se.updatePaintBuffers(Z));const _e=ce.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!C,applyTerrainMatrix:!0});mu(Se,j,se,pe,a);const Re=l.aO(ce,pe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),rt=a.paint.get("fill-extrusion-vertical-gradient"),Ke=U?rh(y,rt,Q,Re,oe,Z,pe):ih(y,rt,Q,Re);Ae.draw(P,P.gl.TRIANGLES,f,x,w,Dn.backCCW,Ke,fe,_e,a.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,a.paint,y.transform.zoom,Se,y.style.map.terrain&&Te.centroidVertexBuffer)}}function Hs(y,t,a,c,f,x,w,C,P){var L;const j=y.style.projection,V=y.context,U=y.transform,Z=V.gl,Q=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],se=y.useProgram("hillshade",null,!1,Q),ce=!y.options.moving;for(const oe of c){const pe=t.getTile(oe),Te=pe.fbo;if(!Te)continue;const fe=j.getMeshFromTileID(V,oe.canonical,C,!0,"raster"),Se=(L=y.style.map.terrain)===null||L===void 0?void 0:L.getTerrainData(oe);V.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,Te.colorAttachment.get());const Ae=U.getProjectionData({overscaledTileID:oe,aligned:ce,applyGlobeMatrix:!P,applyTerrainMatrix:!0});se.draw(V,Z.TRIANGLES,x,f[oe.overscaledZ],w,Dn.backCCW,au(y,pe,a),Se,Ae,a.id,fe.vertexBuffer,fe.indexBuffer,fe.segments)}}function mo(y,t,a,c,f,x,w,C,P){var L;const j=y.style.projection,V=y.context,U=y.transform,Z=V.gl,Q=y.useProgram("colorRelief"),se=!y.options.moving;let ce=!0,oe=0;for(const pe of c){const Te=t.getTile(pe),fe=Te.dem;if(ce){const Ke=Z.getParameter(Z.MAX_TEXTURE_SIZE),{elevationTexture:et,colorTexture:tt}=a.getColorRampTextures(V,Ke,fe.getUnpackVector());V.activeTexture.set(Z.TEXTURE1),et.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),V.activeTexture.set(Z.TEXTURE4),tt.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ce=!1,oe=et.size[0]}if(!fe||!fe.data)continue;const Se=fe.stride,Ae=fe.getPixels();if(V.activeTexture.set(Z.TEXTURE0),V.pixelStoreUnpackPremultiplyAlpha.set(!1),Te.demTexture=Te.demTexture||y.getTileTexture(Se),Te.demTexture){const Ke=Te.demTexture;Ke.update(Ae,{premultiply:!1}),Ke.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}else Te.demTexture=new l.T(V,Ae,Z.RGBA,{premultiply:!1}),Te.demTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const _e=j.getMeshFromTileID(V,pe.canonical,C,!0,"raster"),Re=(L=y.style.map.terrain)===null||L===void 0?void 0:L.getTerrainData(pe),rt=U.getProjectionData({overscaledTileID:pe,aligned:se,applyGlobeMatrix:!P,applyTerrainMatrix:!0});Q.draw(V,Z.TRIANGLES,x,f[pe.overscaledZ],w,Dn.backCCW,jf(a,Te.dem,oe),Re,rt,a.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}const go=[new l.P(0,0),new l.P(l.a5,0),new l.P(l.a5,l.a5),new l.P(0,l.a5)];function Ka(y,t,a,c,f,x,w,C,P=!1,L=!1){const j=c[c.length-1].overscaledZ,V=y.context,U=V.gl,Z=y.useProgram("raster"),Q=y.transform,se=y.style.projection,ce=y.colorModeForRenderPass(),oe=!y.options.moving,pe=a.paint.get("raster-opacity"),Te=a.paint.get("raster-resampling"),fe=a.paint.get("raster-fade-duration"),Se=!!y.style.map.terrain;for(const Ae of c){const _e=y.getDepthModeForSublayer(Ae.overscaledZ-j,pe===1?Sn.ReadWrite:Sn.ReadOnly,U.LESS),Re=t.getTile(Ae),rt=Te==="nearest"?U.NEAREST:U.LINEAR;V.activeTexture.set(U.TEXTURE0),Re.texture.bind(rt,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST),V.activeTexture.set(U.TEXTURE1);const{parentTile:Ke,parentScaleBy:et,parentTopLeft:tt,fadeValues:Lt}=Zs(Re,t,fe,Se);Re.fadeOpacity=Lt.tileOpacity,Ke?(Ke.fadeOpacity=Lt.parentTileOpacity,Ke.texture.bind(rt,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST)):Re.texture.bind(rt,U.CLAMP_TO_EDGE,U.LINEAR_MIPMAP_NEAREST),Re.texture.useMipmap&&V.extTextureFilterAnisotropic&&y.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const Nt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae),wt=Q.getProjectionData({overscaledTileID:Ae,aligned:oe,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),Ft=ah(tt,et,Lt.fadeMix,a,C),vn=se.getMeshFromTileID(V,Ae.canonical,x,w,"raster");Z.draw(V,U.TRIANGLES,_e,f?f[Ae.overscaledZ]:Un.disabled,ce,P?Dn.frontCCW:Dn.backCCW,Ft,Nt,wt,a.id,vn.vertexBuffer,vn.indexBuffer,vn.segments)}}function Zs(y,t,a,c){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return f;if(y.fadingParentID){const x=t.getLoadedTile(y.fadingParentID);if(!x)return f;const w=Math.pow(2,x.tileID.overscaledZ-y.tileID.overscaledZ),C=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1],P=(function(L,j,V){const U=he(),Z=(U-j.timeAdded)/V,Q=L.fadingDirection===Oe.Incoming,se=l.an((U-L.timeAdded)/V,0,1),ce=l.an(1-Z,0,1),oe=Q?se:ce;return{tileOpacity:oe,parentTileOpacity:Q?ce:se,fadeMix:{opacity:1,mix:1-oe}}})(y,x,a);return{parentTile:x,parentScaleBy:w,parentTopLeft:C,fadeValues:P}}if(y.selfFading){const x=(function(w,C){const P=(he()-w.timeAdded)/C,L=l.an(P,0,1);return{tileOpacity:L,fadeMix:{opacity:L,mix:0}}})(y,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:x}}return f}const yo=new l.bp(1,0,0,1),Xs=new l.bp(0,1,0,1),mh=new l.bp(0,0,1,1),gh=new l.bp(1,0,1,1),ka=new l.bp(0,1,1,1);function pc(y,t,a,c){ar(y,0,t+a/2,y.transform.width,a,c)}function _o(y,t,a,c){ar(y,t-a/2,0,a,y.transform.height,c)}function ar(y,t,a,c,f,x){const w=y.context,C=w.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*y.pixelRatio,a*y.pixelRatio,c*y.pixelRatio,f*y.pixelRatio),w.clear({color:x}),C.disable(C.SCISSOR_TEST)}function gu(y,t,a){const c=y.context,f=c.gl,x=y.useProgram("debug"),w=Sn.disabled,C=Un.disabled,P=y.colorModeForRenderPass(),L="$debug",j=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);c.activeTexture.set(f.TEXTURE0);const V=t.getTileByID(a.key).latestRawTileData,U=Math.floor((V&&V.byteLength||0)/1024),Z=t.getTile(a).tileSize,Q=512/Math.min(Z,512)*(a.overscaledZ/y.transform.zoom)*.5;let se=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(se+=` => ${a.overscaledZ}`),(function(oe,pe){oe.initDebugOverlayCanvas();const Te=oe.debugOverlayCanvas,fe=oe.context.gl,Se=oe.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,Te.width,Te.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(pe,5,5),Se.strokeText(pe,5,5),oe.debugOverlayTexture.update(Te),oe.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)})(y,`${se} ${U}kB`);const ce=y.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(c,f.TRIANGLES,w,C,li.alphaBlended,Dn.disabled,ru(l.bp.transparent,Q),null,ce,L,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),x.draw(c,f.LINE_STRIP,w,C,P,Dn.disabled,ru(l.bp.red),j,ce,L,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function yh(y,t,a,c){const{isRenderingGlobe:f}=c,x=y.context,w=x.gl,C=y.transform,P=y.colorModeForRenderPass(),L=y.getDepthModeFor3D(),j=y.useProgram("terrain");x.bindFramebuffer.set(null),x.viewport.set([0,0,y.width,y.height]);for(const V of a){const U=t.getTerrainMesh(V.tileID),Z=y.renderToTexture.getTexture(V),Q=t.getTerrainData(V.tileID);x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,Z.texture);const se=t.getMeshFrameDelta(C.zoom),ce=C.calculateFogMatrix(V.tileID.toUnwrapped()),oe=Df(se,ce,y.style.sky,C.pitch,f),pe=C.getProjectionData({overscaledTileID:V.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});j.draw(x,w.TRIANGLES,L,Un.disabled,P,Dn.backCCW,oe,Q,pe,"terrain",U.vertexBuffer,U.indexBuffer,U.segments)}}function vd(y,t){if(!t.mesh){const a=new l.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const c=new l.aY;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new fi(y.createVertexBuffer(a,$a.members),y.createIndexBuffer(c),l.aX.simpleSegment(0,0,a.length,c.length))}return t.mesh}class Uf{constructor(t,a){this.context=new Yo(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Jn.maxOverzooming+Jn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gr}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,a=new l.aW;a.emplaceBack(0,0),a.emplaceBack(l.a5,0),a.emplaceBack(0,l.a5),a.emplaceBack(l.a5,l.a5),this.tileExtentBuffer=t.createVertexBuffer(a,$a.members),this.tileExtentSegments=l.aX.simpleSegment(0,0,4,2);const c=new l.aW;c.emplaceBack(0,0),c.emplaceBack(l.a5,0),c.emplaceBack(0,l.a5),c.emplaceBack(l.a5,l.a5),this.debugBuffer=t.createVertexBuffer(c,$a.members),this.debugSegments=l.aX.simpleSegment(0,0,4,5);const f=new l.ch;f.emplaceBack(0,0,0,0),f.emplaceBack(l.a5,0,l.a5,0),f.emplaceBack(0,l.a5,0,l.a5),f.emplaceBack(l.a5,l.a5,l.a5,l.a5),this.rasterBoundsBuffer=t.createVertexBuffer(f,Pf.members),this.rasterBoundsSegments=l.aX.simpleSegment(0,0,4,2);const x=new l.aW;x.emplaceBack(0,0),x.emplaceBack(l.a5,0),x.emplaceBack(0,l.a5),x.emplaceBack(l.a5,l.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(x,$a.members),this.rasterBoundsSegmentsPosOnly=l.aX.simpleSegment(0,0,4,5);const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,$a.members),this.viewportSegments=l.aX.simpleSegment(0,0,4,2);const C=new l.ci;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(C);const P=new l.aY;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(P);const L=this.context.gl;this.stencilClearMode=new Un({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.tileExtentMesh=new fi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.N();l.c7(c,0,this.width,this.height,0,0,1),l.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,Sn.disabled,this.stencilClearMode,li.disabled,Dn.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(li.disabled),f.setDepthMode(Sn.disabled);const x={};for(const w of a)x[w.key]=this.nextStencilID++;this._renderTileMasks(x,a,c,!0),this._renderTileMasks(x,a,c,!1),this._tileClippingMaskIDs=x}_renderTileMasks(t,a,c,f){const x=this.context,w=x.gl,C=this.style.projection,P=this.transform,L=this.useProgram("clippingMask");for(const j of a){const V=t[j.key],U=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j),Z=C.getMeshFromTileID(this.context,j.canonical,f,!0,"stencil"),Q=P.getProjectionData({overscaledTileID:j,applyGlobeMatrix:!c,applyTerrainMatrix:!0});L.draw(x,w.TRIANGLES,Sn.disabled,new Un({func:w.ALWAYS,mask:0},V,255,w.KEEP,w.KEEP,w.REPLACE),li.disabled,c?Dn.disabled:Dn.backCCW,null,U,Q,"$clipping",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,c=this.style.projection,f=this.transform,x=this.useProgram("depth"),w=this.getDepthModeFor3D(),C=Ti(f,{tileSize:f.tileSize});for(const P of C){const L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),j=c.getMeshFromTileID(this.context,P.canonical,!0,!0,"raster"),V=f.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0});x.draw(t,a.TRIANGLES,w,Un.disabled,li.disabled,Dn.backCCW,null,L,V,"$clipping",j.vertexBuffer,j.indexBuffer,j.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Un({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Un({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,c=t.sort(((w,C)=>C.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,x=c[0].overscaledZ-f+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let C=0;C<x;C++)w[C+f]=new Un({func:a.GEQUAL,mask:255},C+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=x,[w,c]}return[{[f]:Un.disabled},c]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,c=t.sort(((w,C)=>C.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,x=c[0].overscaledZ-f+1;if(this.clearStencil(),x>1){const w={},C={};for(let P=0;P<x;P++)w[P+f]=new Un({func:a.GREATER,mask:255},x+1+P,255,a.KEEP,a.KEEP,a.REPLACE),C[P+f]=new Un({func:a.GREATER,mask:255},1+P,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*x+1,[w,C,c]}return this.nextStencilID=3,[{[f]:new Un({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new Un({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new li([t.CONSTANT_COLOR,t.ONE],new l.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?li.unblended:li.alphaBlended}getDepthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return Sn.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Sn(c||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new Sn(this.context.gl.LEQUAL,Sn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var c,f;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(he()),this.imageManager.beginFrame();const x=this.style._order,w=this.style.tileManagers,C={},P={},L={},j={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const U in w){const Z=w[U];Z.used&&Z.prepare(this.context),C[U]=Z.getVisibleCoordinates(!1),P[U]=C[U].slice().reverse(),L[U]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let U=0;U<x.length;U++)if(this.style._layers[x[U]].is3D()){this.opaquePassCutoff=U;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const U of x){const Z=this.style._layers[U];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const Q=P[Z.source];(Z.type==="custom"||Q.length)&&this.renderLayer(this,w[Z.source],Z,Q,j)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:U=>this.useProgram(U)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.bp.black:l.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(U,Z){const Q=U.context,se=Q.gl,ce=((Ae,_e,Re)=>{const rt=Math.cos(_e.rollInRadians),Ke=Math.sin(_e.rollInRadians),et=pn(_e),tt=_e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ae.properties.get("sky-color"),u_horizon_color:Ae.properties.get("horizon-color"),u_horizon:[(_e.width/2-et*Ke)*Re,(_e.height/2+et*rt)*Re],u_horizon_normal:[-Ke,rt],u_sky_horizon_blend:Ae.properties.get("sky-horizon-blend")*_e.height/2*Re,u_sky_blend:tt}})(Z,U.style.map.transform,U.pixelRatio),oe=new Sn(se.LEQUAL,Sn.ReadWrite,[0,1]),pe=Un.disabled,Te=U.colorModeForRenderPass(),fe=U.useProgram("sky"),Se=vd(Q,Z);fe.draw(Q,se.TRIANGLES,oe,pe,Te,Dn.disabled,ce,null,void 0,"sky",Se.vertexBuffer,Se.indexBuffer,Se.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const U=this.style._layers[x[this.currentLayer]],Z=w[U.source],Q=C[U.source];this._renderTileClippingMasks(U,Q,!1),this.renderLayer(this,Z,U,Q,j)}this.renderPass="translucent";let V=!1;for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const U=this.style._layers[x[this.currentLayer]],Z=w[U.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(U,j))continue;this.opaquePassEnabledForLayer()||V||(V=!0,j.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Q=(U.type==="symbol"?L:P)[U.source];this._renderTileClippingMasks(U,C[U.source],!!this.renderToTexture),this.renderLayer(this,Z,U,Q,j)}if(j.isRenderingGlobe&&(function(U,Z,Q){const se=U.context,ce=se.gl,oe=U.useProgram("atmosphere"),pe=new Sn(ce.LEQUAL,Sn.ReadOnly,[0,1]),Te=U.transform,fe=(function(tt,Lt){const Nt=tt.properties.get("position"),wt=[-Nt.x,-Nt.y,-Nt.z],Ft=l.ar(new Float64Array(16));return tt.properties.get("anchor")==="map"&&(l.bg(Ft,Ft,Lt.rollInRadians),l.bh(Ft,Ft,-Lt.pitchInRadians),l.bg(Ft,Ft,Lt.bearingInRadians),l.bh(Ft,Ft,Lt.center.lat*Math.PI/180),l.bJ(Ft,Ft,-Lt.center.lng*Math.PI/180)),l.cg(wt,wt,Ft),wt})(Q,U.transform),Se=Te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ae=Z.properties.get("atmosphere-blend")*Se.projectionTransition;if(Ae===0)return;const _e=_l(Te.worldSize,Te.center.lat),Re=Te.inverseProjectionMatrix,rt=new Float64Array(4);rt[3]=1,l.aH(rt,rt,Te.modelViewProjectionMatrix),rt[0]/=rt[3],rt[1]/=rt[3],rt[2]/=rt[3],rt[3]=1,l.aH(rt,rt,Re),rt[0]/=rt[3],rt[1]/=rt[3],rt[2]/=rt[3],rt[3]=1;const Ke=((tt,Lt,Nt,wt,Ft)=>({u_sun_pos:tt,u_atmosphere_blend:Lt,u_globe_position:Nt,u_globe_radius:wt,u_inv_proj_matrix:Ft}))(fe,Ae,[rt[0],rt[1],rt[2]],_e,Re),et=vd(se,Z);oe.draw(se,ce.TRIANGLES,pe,Un.disabled,li.alphaBlended,Dn.disabled,Ke,null,null,"atmosphere",et.vertexBuffer,et.indexBuffer,et.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const U=(function(Z,Q){let se=null;const ce=Object.values(Z._layers).flatMap((fe=>fe.source&&!fe.isHidden(Q)?[Z.tileManagers[fe.source]]:[])),oe=ce.filter((fe=>fe.getSource().type==="vector")),pe=ce.filter((fe=>fe.getSource().type!=="vector")),Te=fe=>{(!se||se.getSource().maxzoom<fe.getSource().maxzoom)&&(se=fe)};return oe.forEach((fe=>Te(fe))),se||pe.forEach((fe=>Te(fe))),se})(this.style,this.transform.zoom);U&&(function(Z,Q,se){for(let ce=0;ce<se.length;ce++)gu(Z,Q,se[ce])})(this,U,U.getVisibleCoordinates())}this.options.showPadding&&(function(U){const Z=U.transform.padding;pc(U,U.transform.height-(Z.top||0),3,yo),pc(U,Z.bottom||0,3,Xs),_o(U,Z.left||0,3,mh),_o(U,U.transform.width-(Z.right||0),3,gh);const Q=U.transform.centerPoint;(function(se,ce,oe,pe){ar(se,ce-1,oe-10,2,20,pe),ar(se,ce-10,oe-1,20,2,pe)})(U,Q.x,U.transform.height-Q.y,ka)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=t?!l.cj(a,c):!l.ck(a,c)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(l.cl(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(x,w){const C=x.context,P=C.gl,L=x.transform,j=li.unblended,V=new Sn(P.LEQUAL,Sn.ReadWrite,[0,1]),U=w.tileManager.getRenderableTiles(),Z=x.useProgram("terrainDepth");C.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.bp.transparent,depth:1});for(const Q of U){const se=w.getTerrainMesh(Q.tileID),ce=w.getTerrainData(Q.tileID),oe=L.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),pe={u_ele_delta:w.getMeshFrameDelta(L.zoom)};Z.draw(C,P.TRIANGLES,V,Un.disabled,j,Dn.backCCW,pe,ce,oe,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain),(function(x,w){const C=x.context,P=C.gl,L=x.transform,j=li.unblended,V=new Sn(P.LEQUAL,Sn.ReadWrite,[0,1]),U=w.getCoordsTexture(),Z=w.tileManager.getRenderableTiles(),Q=x.useProgram("terrainCoords");C.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.bp.transparent,depth:1}),w.coordsIndex=[];for(const se of Z){const ce=w.getTerrainMesh(se.tileID),oe=w.getTerrainData(se.tileID);C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,U.texture);const pe={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(L.zoom)},Te=L.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Q.draw(C,P.TRIANGLES,V,Un.disabled,j,Dn.backCCW,pe,oe,Te,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments),w.coordsIndex.push(se.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])})(this,this.style.map.terrain))}renderLayer(t,a,c,f,x){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(f||[]).length)&&(this.id=c.id,l.cm(c)?(function(w,C,P,L,j,V){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=V,Z=Un.disabled,Q=w.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(se,ce,oe,pe,Te,fe,Se,Ae,_e){const Re=ce.transform,rt=ce.style.map.terrain,Ke=Te==="map",et=fe==="map";for(const tt of se){const Lt=pe.getTile(tt),Nt=Lt.getBucket(oe);if(!Nt||!Nt.text||!Nt.text.segments.get().length)continue;const wt=l.ay(Nt.textSizeData,Re.zoom),Ft=l.aN(Lt,1,ce.transform.zoom),vn=Zr(Ke,ce.transform,Ft),ni=oe.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(wt){const vi=Math.pow(2,Re.zoom-Lt.tileID.overscaledZ),mi=rt?(Mi,ci)=>rt.getElevation(tt,Mi,ci):null;fo(Nt,Ke,et,_e,Re,vn,vi,wt,ni,l.aO(Re,Lt,Se,Ae),tt.toUnwrapped(),mi)}}})(L,w,P,C,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),j),P.paint.get("icon-opacity").constantOr(1)!==0&&Ml(w,C,P,L,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),Z,Q,U),P.paint.get("text-opacity").constantOr(1)!==0&&Ml(w,C,P,L,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),Z,Q,U),C.map.showCollisionBoxes&&(Tr(w,C,P,L,!0),Tr(w,C,P,L,!1))})(t,a,c,f,this.style.placement.variableOffsets,x):l.cn(c)?(function(w,C,P,L,j){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:V}=j,U=P.paint.get("circle-opacity"),Z=P.paint.get("circle-stroke-width"),Q=P.paint.get("circle-stroke-opacity"),se=!P.layout.get("circle-sort-key").isConstant();if(U.constantOr(1)===0&&(Z.constantOr(1)===0||Q.constantOr(1)===0))return;const ce=w.context,oe=ce.gl,pe=w.transform,Te=w.getDepthModeForSublayer(0,Sn.ReadOnly),fe=Un.disabled,Se=w.colorModeForRenderPass(),Ae=[],_e=pe.getCircleRadiusCorrection();for(let Re=0;Re<L.length;Re++){const rt=L[Re],Ke=C.getTile(rt),et=Ke.getBucket(P);if(!et)continue;const tt=P.paint.get("circle-translate"),Lt=P.paint.get("circle-translate-anchor"),Nt=l.aO(pe,Ke,tt,Lt),wt=et.programConfigurations.get(P.id),Ft=w.useProgram("circle",wt),vn=et.layoutVertexBuffer,ni=et.indexBuffer,vi=w.style.map.terrain&&w.style.map.terrain.getTerrainData(rt),mi={programConfiguration:wt,program:Ft,layoutVertexBuffer:vn,indexBuffer:ni,uniformValues:iu(w,Ke,P,Nt,_e),terrainData:vi,projectionData:pe.getProjectionData({overscaledTileID:rt,applyGlobeMatrix:!V,applyTerrainMatrix:!0})};if(se){const Mi=et.segments.get();for(const ci of Mi)Ae.push({segments:new l.aX([ci]),sortKey:ci.sortKey,state:mi})}else Ae.push({segments:et.segments,sortKey:0,state:mi})}se&&Ae.sort(((Re,rt)=>Re.sortKey-rt.sortKey));for(const Re of Ae){const{programConfiguration:rt,program:Ke,layoutVertexBuffer:et,indexBuffer:tt,uniformValues:Lt,terrainData:Nt,projectionData:wt}=Re.state;Ke.draw(ce,oe.TRIANGLES,Te,fe,Se,Dn.backCCW,Lt,Nt,wt,P.id,et,tt,Re.segments,P.paint,w.transform.zoom,rt)}})(t,a,c,f,x):l.co(c)?(function(w,C,P,L,j){if(P.paint.get("heatmap-opacity")===0)return;const V=w.context,{isRenderingToTexture:U,isRenderingGlobe:Z}=j;if(w.style.map.terrain){for(const Q of L){const se=C.getTile(Q);C.hasRenderableParent(Q)||(w.renderPass==="offscreen"?xd(w,se,P,Q,Z):w.renderPass==="translucent"&&Er(w,P,Q,U,Z))}V.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?(function(Q,se,ce,oe){const pe=Q.context,Te=pe.gl,fe=Q.transform,Se=Un.disabled,Ae=new li([Te.ONE,Te.ONE],l.bp.transparent,[!0,!0,!0,!0]);(function(_e,Re,rt){const Ke=_e.gl;_e.activeTexture.set(Ke.TEXTURE1),_e.viewport.set([0,0,Re.width/4,Re.height/4]);let et=rt.heatmapFbos.get(l.cd);et?(Ke.bindTexture(Ke.TEXTURE_2D,et.colorAttachment.get()),_e.bindFramebuffer.set(et.framebuffer)):(et=pi(_e,Re.width/4,Re.height/4),rt.heatmapFbos.set(l.cd,et))})(pe,Q,ce),pe.clear({color:l.bp.transparent});for(let _e=0;_e<oe.length;_e++){const Re=oe[_e];if(se.hasRenderableParent(Re))continue;const rt=se.getTile(Re),Ke=rt.getBucket(ce);if(!Ke)continue;const et=Ke.programConfigurations.get(ce.id),tt=Q.useProgram("heatmap",et),Lt=fe.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Nt=fe.getCircleRadiusCorrection();tt.draw(pe,Te.TRIANGLES,Sn.disabled,Se,Ae,Dn.backCCW,Vo(rt,fe.zoom,ce.paint.get("heatmap-intensity"),Nt),null,Lt,ce.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,ce.paint,fe.zoom,et)}pe.viewport.set([0,0,Q.width,Q.height])})(w,C,P,L):w.renderPass==="translucent"&&(function(Q,se){const ce=Q.context,oe=ce.gl;ce.setColorMode(Q.colorModeForRenderPass());const pe=se.heatmapFbos.get(l.cd);pe&&(ce.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,pe.colorAttachment.get()),ce.activeTexture.set(oe.TEXTURE1),Bn(ce,se).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Q.useProgram("heatmapTexture").draw(ce,oe.TRIANGLES,Sn.disabled,Un.disabled,Q.colorModeForRenderPass(),Dn.disabled,dd(Q,se,0,1),null,null,se.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments,se.paint,Q.transform.zoom))})(w,P)})(t,a,c,f,x):l.cp(c)?(function(w,C,P,L,j){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:V}=j,U=P.paint.get("line-opacity"),Z=P.paint.get("line-width");if(U.constantOr(1)===0||Z.constantOr(1)===0)return;const Q=w.getDepthModeForSublayer(0,Sn.ReadOnly),se=w.colorModeForRenderPass(),ce=P.paint.get("line-dasharray"),oe=ce.constantOr(1),pe=P.paint.get("line-pattern"),Te=pe.constantOr(1),fe=P.paint.get("line-gradient"),Se=P.getCrossfadeParameters();let Ae;Ae=Te?"linePattern":oe&&fe?"lineGradientSDF":oe?"lineSDF":fe?"lineGradient":"line";const _e=w.context,Re=_e.gl,rt=w.transform;let Ke=!0;for(const et of L){const tt=C.getTile(et);if(Te&&!tt.patternsLoaded())continue;const Lt=tt.getBucket(P);if(!Lt)continue;const Nt=Lt.programConfigurations.get(P.id),wt=w.context.program.get(),Ft=w.useProgram(Ae,Nt),vn=Ke||Ft.program!==wt,ni=w.style.map.terrain&&w.style.map.terrain.getTerrainData(et),vi=pe.constantOr(null),mi=ce&&ce.constantOr(null);if(vi&&tt.imageAtlas){const Mr=tt.imageAtlas,$i=Mr.patternPositions[vi.to.toString()],Hi=Mr.patternPositions[vi.from.toString()];$i&&Hi&&Nt.setConstantPatternPositions($i,Hi)}else if(mi){const Mr=P.layout.get("line-cap")==="round",$i=w.lineAtlas.getDash(mi.to,Mr),Hi=w.lineAtlas.getDash(mi.from,Mr);Nt.setConstantDashPositions($i,Hi)}const Mi=rt.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),ci=rt.getPixelScale();let Oi;Te?(Oi=fd(w,tt,P,ci,Se),za(_e,Re,tt,Nt,Se)):oe&&fe?(Oi=qo(w,tt,P,ci,Se,Lt.lineClipsArray.length),oa(w,C,_e,Re,P,Lt,et,Nt,Se)):oe?(Oi=ra(w,tt,P,ci,Se),Ni(w,_e,Re,Nt,vn,Se)):fe?(Oi=Of(w,tt,P,ci,Lt.lineClipsArray.length),sa(w,C,_e,Re,P,Lt,et)):Oi=su(w,tt,P,ci);const Ci=w.stencilModeForClipping(et);Ft.draw(_e,Re.TRIANGLES,Q,Ci,se,Dn.disabled,Oi,ni,Mi,P.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,P.paint,w.transform.zoom,Nt,Lt.layoutVertexBuffer2),Ke=!1}})(t,a,c,f,x):l.cq(c)?(function(w,C,P,L,j){const V=P.paint.get("fill-color"),U=P.paint.get("fill-opacity");if(U.constantOr(1)===0)return;const{isRenderingToTexture:Z}=j,Q=w.colorModeForRenderPass(),se=P.paint.get("fill-pattern"),ce=w.opaquePassEnabledForLayer()&&!se.constantOr(1)&&V.constantOr(l.bp.transparent).a===1&&U.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===ce){const oe=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?Sn.ReadWrite:Sn.ReadOnly);Gs(w,C,P,L,oe,Q,!1,Z)}if(w.renderPass==="translucent"&&P.paint.get("fill-antialias")){const oe=w.getDepthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Sn.ReadOnly);Gs(w,C,P,L,oe,Q,!0,Z)}})(t,a,c,f,x):l.cr(c)?(function(w,C,P,L,j){const V=P.paint.get("fill-extrusion-opacity");if(V===0)return;const{isRenderingToTexture:U}=j;if(w.renderPass==="translucent"){const Z=new Sn(w.context.gl.LEQUAL,Sn.ReadWrite,w.depthRangeFor3D);if(V!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))$s(w,C,P,L,Z,Un.disabled,li.disabled,U),$s(w,C,P,L,Z,w.stencilModeFor3D(),w.colorModeForRenderPass(),U);else{const Q=w.colorModeForRenderPass();$s(w,C,P,L,Z,Un.disabled,Q,U)}}})(t,a,c,f,x):l.cs(c)?(function(w,C,P,L,j){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:V}=j,U=w.context,Z=w.style.projection.useSubdivision,Q=w.getDepthModeForSublayer(0,Sn.ReadOnly),se=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(ce,oe,pe,Te,fe,Se,Ae){const _e=ce.context,Re=_e.gl;for(const rt of pe){const Ke=oe.getTile(rt),et=Ke.dem;if(!et||!et.data||!Ke.needsHillshadePrepare)continue;const tt=et.dim,Lt=et.stride,Nt=et.getPixels();if(_e.activeTexture.set(Re.TEXTURE1),_e.pixelStoreUnpackPremultiplyAlpha.set(!1),Ke.demTexture=Ke.demTexture||ce.getTileTexture(Lt),Ke.demTexture){const Ft=Ke.demTexture;Ft.update(Nt,{premultiply:!1}),Ft.bind(Re.NEAREST,Re.CLAMP_TO_EDGE)}else Ke.demTexture=new l.T(_e,Nt,Re.RGBA,{premultiply:!1}),Ke.demTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE);_e.activeTexture.set(Re.TEXTURE0);let wt=Ke.fbo;if(!wt){const Ft=new l.T(_e,{width:tt,height:tt,data:null},Re.RGBA);Ft.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),wt=Ke.fbo=_e.createFramebuffer(tt,tt,!0,!1),wt.colorAttachment.set(Ft.texture)}_e.bindFramebuffer.set(wt.framebuffer),_e.viewport.set([0,0,tt,tt]),ce.useProgram("hillshadePrepare").draw(_e,Re.TRIANGLES,fe,Se,Ae,Dn.disabled,Nf(Ke.tileID,et),null,null,Te.id,ce.rasterBoundsBuffer,ce.quadTriangleIndexBuffer,ce.rasterBoundsSegments),Ke.needsHillshadePrepare=!1}})(w,C,L,P,Q,Un.disabled,se),U.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(Z){const[ce,oe,pe]=w.stencilConfigForOverlapTwoPass(L);Hs(w,C,P,pe,ce,Q,se,!1,V),Hs(w,C,P,pe,oe,Q,se,!0,V)}else{const[ce,oe]=w.getStencilConfigForOverlapAndUpdateStencilID(L);Hs(w,C,P,oe,ce,Q,se,!1,V)}})(t,a,c,f,x):l.ct(c)?(function(w,C,P,L,j){if(w.renderPass!=="translucent"||!L.length)return;const{isRenderingToTexture:V}=j,U=w.style.projection.useSubdivision,Z=w.getDepthModeForSublayer(0,Sn.ReadOnly),Q=w.colorModeForRenderPass();if(U){const[se,ce,oe]=w.stencilConfigForOverlapTwoPass(L);mo(w,C,P,oe,se,Z,Q,!1,V),mo(w,C,P,oe,ce,Z,Q,!0,V)}else{const[se,ce]=w.getStencilConfigForOverlapAndUpdateStencilID(L);mo(w,C,P,ce,se,Z,Q,!1,V)}})(t,a,c,f,x):l.bU(c)?(function(w,C,P,L,j){if(w.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!L.length)return;const{isRenderingToTexture:V}=j,U=C.getSource(),Z=w.style.projection.useSubdivision;if(U instanceof Cn)Ka(w,C,P,L,null,!1,!1,U.tileCoords,U.flippedWindingOrder,V);else if(Z){const[Q,se,ce]=w.stencilConfigForOverlapTwoPass(L);Ka(w,C,P,ce,Q,!1,!0,go,!1,V),Ka(w,C,P,ce,se,!0,!0,go,!1,V)}else{const[Q,se]=w.getStencilConfigForOverlapAndUpdateStencilID(L);Ka(w,C,P,se,Q,!1,!0,go,!1,V)}})(t,a,c,f,x):l.cu(c)?(function(w,C,P,L,j){const V=P.paint.get("background-color"),U=P.paint.get("background-opacity");if(U===0)return;const{isRenderingToTexture:Z}=j,Q=w.context,se=Q.gl,ce=w.style.projection,oe=w.transform,pe=oe.tileSize,Te=P.paint.get("background-pattern");if(w.isPatternMissing(Te))return;const fe=!Te&&V.a===1&&U===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==fe)return;const Se=Un.disabled,Ae=w.getDepthModeForSublayer(0,fe==="opaque"?Sn.ReadWrite:Sn.ReadOnly),_e=w.colorModeForRenderPass(),Re=w.useProgram(Te?"backgroundPattern":"background"),rt=L||Ti(oe,{tileSize:pe,terrain:w.style.map.terrain});Te&&(Q.activeTexture.set(se.TEXTURE0),w.imageManager.bind(w.context));const Ke=P.getCrossfadeParameters();for(const et of rt){const tt=oe.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Lt=Te?uu(U,w,Te,{tileID:et,tileSize:pe},Ke):cu(U,V),Nt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(et),wt=ce.getMeshFromTileID(Q,et.canonical,!1,!0,"raster");Re.draw(Q,se.TRIANGLES,Ae,Se,_e,Dn.backCCW,Lt,Nt,tt,P.id,wt.vertexBuffer,wt.indexBuffer,wt.segments)}})(t,0,c,f,x):l.cv(c)&&(function(w,C,P,L){const{isRenderingGlobe:j}=L,V=w.context,U=P.implementation,Z=w.style.projection,Q=w.transform,se=Q.getProjectionDataForCustomLayer(j),ce={farZ:Q.farZ,nearZ:Q.nearZ,fov:Q.fov*Math.PI/180,modelViewProjectionMatrix:Q.modelViewProjectionMatrix,projectionMatrix:Q.projectionMatrix,shaderData:{variantName:Z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Z.shaderPreludeCode.vertexSource}`,define:Z.shaderDefine},defaultProjectionData:se},oe=U.renderingMode?U.renderingMode:"2d";if(w.renderPass==="offscreen"){const pe=U.prerender;pe&&(w.setCustomLayerDefaults(),V.setColorMode(w.colorModeForRenderPass()),pe.call(U,V.gl,ce),V.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),V.setColorMode(w.colorModeForRenderPass()),V.setStencilMode(Un.disabled);const pe=oe==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,Sn.ReadOnly);V.setDepthMode(pe),U.render(V.gl,ce),V.setDirty(),w.setBaseState(),V.bindFramebuffer.set(null)}})(t,0,c,x))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a,c=!1,f=[]){this.cache=this.cache||{};const x=!!this.style.map.terrain,w=this.style.projection,C=c?zi.projectionMercator:w.shaderPreludeCode,P=c?Vi:w.shaderDefine,L=t+(a?a.cacheKey:"")+`/${c?Yr:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(x?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[L]||(this.cache[L]=new If(this.context,zi[t],a,Bf[t],this._showOverdrawInspector,x,C,P,f)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const c in this._tileTextures){const f=this._tileTextures[c];if(f)for(const x of f)x.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const f=this.cache[c];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function bd(y,t){let a,c=!1,f=null,x=null;const w=()=>{f=null,c&&(y.apply(x,a),f=setTimeout(w,t),c=!1)};return(...C)=>(c=!0,x=this,a=C,f||w(),f)}class Ji{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let f=c;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${c}`);let x=window.location.hash.replace(f,"");x.startsWith("#&")?x=x.slice(0,1)+x.slice(2):x==="#"&&(x="");let w=window.location.href.replace(/(#.+)?$/,x);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=bd(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,f),w=Math.round(a.lng*x)/x,C=Math.round(a.lat*x)/x,P=this._map.getBearing(),L=this._map.getPitch();let j="";if(j+=t?`/${w}/${C}/${c}`:`${c}/${C}/${w}`,(P||L)&&(j+="/"+Math.round(10*P)/10),L&&(j+=`/${Math.round(L)}`),this._hashName){const V=this._hashName;let U=!1;const Z=window.location.hash.slice(1).split("&").map((Q=>{const se=Q.split("=")[0];return se===V?(U=!0,`${se}=${j}`):Q})).filter((Q=>Q));return U||Z.push(`${V}=${j}`),`#${Z.join("&")}`}return`#${j}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new l.V(+t[2],+t[1])}catch{return!1}const a=+t[0],c=+(t[3]||0),f=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const Ys={linearity:.3,easing:l.cw(0,0,.3,1)},mc=l.e({deceleration:2500,maxSpeed:1400},Ys),Ur=l.e({deceleration:20,maxSpeed:1400},Ys),Pa=l.e({deceleration:1e3,maxSpeed:360},Ys),Cl=l.e({deceleration:1e3,maxSpeed:90},Ys),Vr=l.e({deceleration:1e3,maxSpeed:360},Ys);class am{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:he(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=he();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)a.zoom+=x.zoomDelta||0,a.bearing+=x.bearingDelta||0,a.pitch+=x.pitchDelta||0,a.roll+=x.rollDelta||0,x.panDelta&&a.pan._add(x.panDelta),x.around&&(a.around=x.around),x.pinchAround&&(a.pinchAround=x.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const x=yu(a.pan.mag(),c,l.e({},mc,t||{})),w=a.pan.mult(x.amount/a.pan.mag()),C=this._map.cameraHelper.handlePanInertia(w,this._map.transform);f.center=C.easingCenter,f.offset=C.easingOffset,gc(f,x)}if(a.zoom){const x=yu(a.zoom,c,Ur);f.zoom=this._map.transform.zoom+x.amount,gc(f,x)}if(a.bearing){const x=yu(a.bearing,c,Pa);f.bearing=this._map.transform.bearing+l.an(x.amount,-179,179),gc(f,x)}if(a.pitch){const x=yu(a.pitch,c,Cl);f.pitch=this._map.transform.pitch+x.amount,gc(f,x)}if(a.roll){const x=yu(a.roll,c,Vr);f.roll=this._map.transform.roll+l.an(x.amount,-179,179),gc(f,x)}if(f.zoom||f.bearing){const x=a.pinchAround===void 0?a.around:a.pinchAround;f.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.e(f,{noMoveStart:!0})}}function gc(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function yu(y,t,a){const{maxSpeed:c,linearity:f,deceleration:x}=a,w=l.an(y*f/(t/1e3),-c,c),C=Math.abs(w)/(x*f);return{easing:a.easing,duration:1e3*C,amount:w*(C/2)}}class xr extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,f={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const x=te.mousePos(a.getCanvas(),c),w=a.unproject(x);super(t,l.e({point:x,lngLat:w,originalEvent:c},f)),this._defaultPrevented=!1,this.target=a}}class _s extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const f=t==="touchend"?c.changedTouches:c.touches,x=te.touchPos(a.getCanvasContainer(),f),w=x.map((P=>a.unproject(P))),C=x.reduce(((P,L,j,V)=>P.add(L.div(V.length))),new l.P(0,0));super(t,{points:x,point:C,lngLats:w,lngLat:a.unproject(C),originalEvent:c}),this._defaultPrevented=!1}}class _h extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class xh{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new _h(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new xr(t.type,this._map,t))}mouseup(t){this._map.fire(new xr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new xr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new xr(t.type,this._map,t))}mouseover(t){this._map.fire(new xr(t.type,this._map,t))}mouseout(t){this._map.fire(new xr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _s(t.type,this._map,t))}touchmove(t){this._map.fire(new _s(t.type,this._map,t))}touchend(t){this._map.fire(new _s(t.type,this._map,t))}touchcancel(t){this._map.fire(new _s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new xr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new xr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xs{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(l.P.convert(t),this._map.terrain)}}class Ko{constructor(t,a){this._map=t,this._tr=new xs(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(te.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=te.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(f.x,c.x),w=Math.max(f.x,c.x),C=Math.min(f.y,c.y),P=Math.max(f.y,c.y);te.setTransform(this._box,`translate(${x}px,${C}px)`),this._box.style.width=w-x+"px",this._box.style.height=P-C+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,f=a;if(this.reset(),te.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:t})),{cameraAnimation:x=>x.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(te.remove(this._box),this._box=null),te.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new l.l(t,{originalEvent:a}))}}function la(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const a={};for(let c=0;c<y.length;c++)a[y[c].identifier]=t[c];return a}class Zt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const x=new l.P(0,0);for(const w of f)x._add(w);return x.div(f.length)})(a),this.touches=la(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const f=la(c,a);for(const x in this.touches){const w=f[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class _u{constructor(t){this.singleTap=new Zt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const f=this.singleTap.touchend(t,a,c);if(f){const x=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(f)<30;if(x&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class vh{constructor(t){this._tr=new xs(t),this._zoomIn=new _u({numTouches:1,numTaps:2}),this._zoomOut=new _u({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const f=this._zoomIn.touchend(t,a,c),x=this._zoomOut.touchend(t,a,c),w=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(f)},{originalEvent:t})}):x?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(x)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wa{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&te.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vs=0,yc=2,bh={[vs]:1,[yc]:2};class Ks{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=te.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,c){const f=bh[c];return a.buttons===void 0||(a.buttons&f)!==f})(t,this._eventButton)}isValidEndEvent(t){return te.mouseButton(t)===this._eventButton}}class Al{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class xu{constructor(t=new Ks({checkCorrectEvent:()=>!0}),a=new Al){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,c){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Ws=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=t=>{t.preventDefault()}};class wh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const f=la(c,a),x=new l.P(0,0),w=new l.P(0,0);let C=0;for(const L in f){const j=f[L],V=this._touches[L];V&&(x._add(j),w._add(j.sub(V)),C++,f[L]=j)}if(this._touches=f,this._shouldBePrevented(C)||!w.mag())return;const P=w.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[f,x]=this._firstTwoTouches,w=Qs(c,a,f),C=Qs(c,a,x);if(!w||!C)return;const P=this._aroundCenter?null:w.add(C).div(2);return this._move([w,C],P,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[f,x]=this._firstTwoTouches,w=Qs(c,a,f),C=Qs(c,a,x);w&&C||(this._active&&te.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Qs(y,t,a){for(let c=0;c<y.length;c++)if(y[c].identifier===a)return t[c]}function wd(y,t){return Math.log(y/t)/Math.LN2}class Js extends vu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(wd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wd(this._distance,c),pinchAround:a}}}function Sh(y,t){return 180*y.angleWith(t)/Math.PI}class bu extends vu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,c){const f=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sh(this._vector,f),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=Sh(t,this._startVector);return Math.abs(c)<a}}function eo(y){return Math.abs(y.y)>Math.abs(y.x)}class xo extends vu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,eo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),x=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,x,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,x=a.mag()>=2;if(!f&&!x)return;if(!f||!x)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return eo(t)&&eo(a)&&w}}const Qa={panStep:100,bearingStep:15,pitchStep:10};class ri{constructor(t){this._tr=new xs(t);const a=Qa;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,f=0,x=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),x=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),x=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:C=>{const P=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Sd,zoom:a?Math.round(P.zoom)+a*(t.shiftKey?2:1):P.zoom,bearing:P.bearing+c*this._bearingStep,pitch:P.pitch+f*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:P.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sd(y){return y*(2-y)}const vo=4.000244140625,Wo=1/450;class wu{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new xs(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Wo}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=he(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%vo==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=te.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(l.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const C=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>vo?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&P!==0&&(P=1/P);const L=typeof this._targetZoom!="number"?t.scale:l.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),l.at(L*P)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,f=this._easing;let x,w=!1;if(this._type==="wheel"&&c&&f){const C=he()-this._lastWheelEventTime,P=Math.min((C+5)/200,1),L=f(P);x=l.G.number(c,a,L),P<1?this._frameId||(this._frameId=!0):w=!0}else x=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=x,{noInertia:!0,needsRenderFrame:!w,zoomDelta:x-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=l.cy;if(this._prevEase){const c=this._prevEase,f=(he()-c.start)/c.duration,x=c.easing(f+.01)-c.easing(f),w=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-w*w);a=l.cw(w,C,.25,1)}return this._prevEase={start:he(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Th{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zl{constructor(t){this._tr=new xs(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Su{constructor(){this._tap=new _u({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const f=a[0],x=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(f)<30;x&&w?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=a[0],x=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(t,a,c);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Td{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Da{constructor(t,a,c,f){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class kl{constructor(t,a,c,f){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Yt{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=te.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=c,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(te.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const nn=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class Ja extends l.l{}function _c(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class Tu{constructor(t,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,x)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=f.type==="renderFrame"?void 0:f,C={needsRenderFrame:!1},P={},L={};for(const{handlerName:U,handler:Z,allowed:Q}of this._handlers){if(!Z.isEnabled())continue;let se;if(this._blockedByActive(L,Q,U))Z.reset();else if(Z[x||f.type]){if(l.cz(f,x||f.type)){const ce=te.mousePos(this._map.getCanvas(),f);se=Z[x||f.type](f,ce)}else if(l.cA(f,x||f.type)){const ce=this._getMapTouches(f.touches),oe=te.touchPos(this._map.getCanvas(),ce);se=Z[x||f.type](f,oe,ce)}else l.cB(x||f.type)||(se=Z[x||f.type](f));this.mergeHandlerResult(C,P,se,U,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||Z.isActive())&&(L[U]=Z)}const j={};for(const U in this._previousActiveHandlers)L[U]||(j[U]=w);this._previousActiveHandlers=L,(Object.keys(j).length||_c(C))&&(this._changes.push([C,P,j]),this._triggerRenderFrame()),(Object.keys(L).length||_c(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=C;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new am(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,x,w]of this._listeners)te.addEventListener(f,x,f===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,c]of this._listeners)te.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new xh(a,t));const f=a.boxZoom=new Ko(a,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const x=a.cooperativeGestures=new Yt(a,t.cooperativeGestures);this._add("cooperativeGestures",x),t.cooperativeGestures&&x.enable();const w=new vh(a),C=new zl(a);a.doubleClickZoom=new Th(C,w),this._add("tapZoom",w),this._add("clickZoom",C),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const P=new Su;this._add("tapDragZoom",P);const L=a.touchPitch=new xo(a);this._add("touchPitch",L),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const j=()=>a.project(a.getCenter()),V=(function({enable:fe,clickTolerance:Se,aroundCenter:Ae=!0,minPixelCenterThreshold:_e=100,rotateDegreesPerPixelMoved:Re=.8},rt){const Ke=new Ks({checkCorrectEvent:et=>te.mouseButton(et)===0&&et.ctrlKey||te.mouseButton(et)===2&&!et.ctrlKey});return new Wa({clickTolerance:Se,move:(et,tt)=>{const Lt=rt();if(Ae&&Math.abs(Lt.y-et.y)>_e)return{bearingDelta:l.cx(new l.P(et.x,tt.y),tt,Lt)};let Nt=(tt.x-et.x)*Re;return Ae&&tt.y<Lt.y&&(Nt=-Nt),{bearingDelta:Nt}},moveStateManager:Ke,enable:fe,assignEvents:Ws})})(t,j),U=(function({enable:fe,clickTolerance:Se,pitchDegreesPerPixelMoved:Ae=-.5}){const _e=new Ks({checkCorrectEvent:Re=>te.mouseButton(Re)===0&&Re.ctrlKey||te.mouseButton(Re)===2});return new Wa({clickTolerance:Se,move:(Re,rt)=>({pitchDelta:(rt.y-Re.y)*Ae}),moveStateManager:_e,enable:fe,assignEvents:Ws})})(t),Z=(function({enable:fe,clickTolerance:Se,rollDegreesPerPixelMoved:Ae=.3},_e){const Re=new Ks({checkCorrectEvent:rt=>te.mouseButton(rt)===2&&rt.ctrlKey});return new Wa({clickTolerance:Se,move:(rt,Ke)=>{const et=_e();let tt=(Ke.x-rt.x)*Ae;return Ke.y<et.y&&(tt=-tt),{rollDelta:tt}},moveStateManager:Re,enable:fe,assignEvents:Ws})})(t,j);a.dragRotate=new Da(t,V,U,Z),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",U,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Z,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const Q=(function({enable:fe,clickTolerance:Se}){const Ae=new Ks({checkCorrectEvent:_e=>te.mouseButton(_e)===0&&!_e.ctrlKey});return new Wa({clickTolerance:Se,move:(_e,Re)=>({around:Re,panDelta:Re.sub(_e)}),activateOnStart:!0,moveStateManager:Ae,enable:fe,assignEvents:Ws})})(t),se=new wh(t,a);a.dragPan=new Td(c,Q,se),this._add("mousePan",Q),this._add("touchPan",se,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const ce=new bu,oe=new Js;a.touchZoomRotate=new kl(c,oe,ce,P),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Vf(a));const pe=a.scrollZoom=new wu(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",pe,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const Te=a.keyboard=new ri(a);this._add("keyboard",Te),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!nn(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const f in t)if(f!==c&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,f,x){if(!c)return;l.e(t,c);const w={handlerName:f,originalEvent:c.originalEvent||x};c.zoomDelta!==void 0&&(a.zoom=w),c.panDelta!==void 0&&(a.drag=w),c.rollDelta!==void 0&&(a.roll=w),c.pitchDelta!==void 0&&(a.pitch=w),c.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},c={};for(const[f,x,w]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(t.rollDelta=(t.rollDelta||0)+f.rollDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),l.e(a,x),l.e(c,w);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const f=this._map,x=f._getTransformForUpdate(),w=f.terrain;if(!(_c(t)||w&&this._terrainMovement))return this._fireEvents(a,c,!0);f._stop(!0);let{panDelta:C,zoomDelta:P,bearingDelta:L,pitchDelta:j,rollDelta:V,around:U,pinchAround:Z}=t;Z!==void 0&&(U=Z),U=U||f.transform.centerPoint,w&&!x.isPointOnMapSurface(U)&&(U=x.centerPoint);const Q={panDelta:C,zoomDelta:P,rollDelta:V,pitchDelta:j,bearingDelta:L,around:U};this._map.cameraHelper.useGlobeControls&&!x.isPointOnMapSurface(U)&&(U=x.centerPoint);const se=U.distSqr(x.centerPoint)<.01?x.center:x.screenPointToLocation(C?U.sub(C):U);this._handleMapControls({terrain:w,tr:x,deltasForHelper:Q,preZoomAroundLoc:se,combinedEventsInProgress:a,panDelta:C}),f._applyUpdatedTransform(x),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:c,preZoomAroundLoc:f,combinedEventsInProgress:x,panDelta:w}){const C=this._map.cameraHelper;if(C.handleMapControlsRollPitchBearingZoom(c,a),t)return C.useGlobeControls?(this._terrainMovement||!x.drag&&!x.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void C.handleMapControlsPan(c,a,f)):this._terrainMovement||!x.drag&&!x.zoom?void(x.drag&&this._terrainMovement&&w?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(w))):C.handleMapControlsPan(c,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void C.handleMapControlsPan(c,a,f));C.handleMapControlsPan(c,a,f)}_fireEvents(t,a,c){const f=nn(this._eventsInProgress),x=nn(t),w={};for(const V in t){const{originalEvent:U}=t[V];this._eventsInProgress[V]||(w[`${V}start`]=U),this._eventsInProgress[V]=t[V]}!f&&x&&this._fireEvent("movestart",x.originalEvent);for(const V in w)this._fireEvent(V,w[V]);x&&this._fireEvent("move",x.originalEvent);for(const V in t){const{originalEvent:U}=t[V];this._fireEvent(V,U)}const C={};let P;for(const V in this._eventsInProgress){const{handlerName:U,originalEvent:Z}=this._eventsInProgress[V];this._handlersById[U].isActive()||(delete this._eventsInProgress[V],P=a[U]||Z,C[`${V}end`]=P)}for(const V in C)this._fireEvent(V,C[V]);const L=nn(this._eventsInProgress),j=(f||x)&&!L;if(j&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const V=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&V.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(V)}if(c&&j){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!V||!V.essential&&Ce.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:P})),U(this._map.getBearing())&&this._map.resetNorth()):(U(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new l.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Ja("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class er extends l.E{constructor(t,a,c){super(),this._renderFrameCallback=()=>{const f=Math.min((he()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new l.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,c){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},a),c)}panTo(t,a,c){return this.easeTo(l.e({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(l.e({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)).fire(new l.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(l.e({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,l.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=Gt.convert(t).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,f){const x={top:0,bottom:0,right:0,left:0};if(typeof(f=l.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const L=f.padding;f.padding={top:L,bottom:L,right:L,left:L}}const w=l.e(x,f.padding);f.padding=w;const C=this.transform,P=new Gt(t,a);return this.cameraHelper.cameraForBoxAndBearing(f,w,P,c,C)}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,f,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(t)),this.transform.screenPointToLocation(l.P.convert(a)),c,f),f,x)}_fitInternal(t,a,c){return t?(delete(a=l.e(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let f=!1,x=!1,w=!1;const C=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const P=c.zoom!==C;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(f=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(x=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(w=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)),P&&this.fire(new l.l("zoomstart",a)).fire(new l.l("zoom",a)).fire(new l.l("zoomend",a)),f&&this.fire(new l.l("rotatestart",a)).fire(new l.l("rotate",a)).fire(new l.l("rotateend",a)),x&&this.fire(new l.l("pitchstart",a)).fire(new l.l("pitch",a)).fire(new l.l("pitchend",a)),w&&this.fire(new l.l("rollstart",a)).fire(new l.l("roll",a)).fire(new l.l("rollend",a)),this.fire(new l.l("moveend",a))}calculateCameraOptionsFromTo(t,a,c,f=0){const x=l.a9.fromLngLat(t,a),w=l.a9.fromLngLat(c,f),C=w.x-x.x,P=w.y-x.y,L=w.z-x.z,j=Math.hypot(C,P,L);if(j===0)throw new Error("Can't calculate camera options with same From and To");const V=Math.hypot(C,P),U=l.at(this.transform.cameraToCenterDistance/j/this.transform.tileSize),Z=180*Math.atan2(C,-P)/Math.PI;let Q=180*Math.acos(V/j)/Math.PI;return Q=L<0?90-Q:90+Q,{center:w.toLngLat(),elevation:f,zoom:U,pitch:Q,bearing:Z}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,c,f,x){const w=this.transform.calculateCenterFromCameraLngLatAlt(t,a,c,f);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:c,pitch:f,roll:x}}easeTo(t,a){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.cy},t)).animate===!1||!t.essential&&Ce.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getBearing(),x=c.pitch,w=c.roll,C="bearing"in t?this._normalizeBearing(t.bearing,f):f,P="pitch"in t?+t.pitch:x,L="roll"in t?this._normalizeBearing(t.roll,w):w,j="padding"in t?t.padding:c.padding,V=l.P.convert(t.offset);let U,Z;t.around&&(U=l.V.convert(t.around),Z=c.locationToScreenPoint(U));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(c,{bearing:C,pitch:P,roll:L,padding:j,around:U,aroundPoint:Z,offsetAsPoint:V,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||f!==C,this._pitching=this._pitching||P!==x,this._rolling=this._rolling||L!==w,this._padding=!c.isPaddingEqual(j),this._zooming=this._zooming||se.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Q),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease((ce=>{se.easeFunc(ce),this.terrain&&!t.freezeElevation&&this._updateElevation(ce),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(ce=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,ce)}),t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new l.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new l.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(l.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),c=t.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(c<f){const x=this.calculateCameraOptionsFromTo(a,f,t.center,t.elevation);return{pitch:x.pitch,zoom:x.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&a.push((f=>this.transformCameraUpdate(f))),!a.length)return;const c=t.clone();for(const f of a){const x=c.clone(),{center:w,zoom:C,roll:P,pitch:L,bearing:j,elevation:V}=f(x);w&&x.setCenter(w),V!==void 0&&x.setElevation(V),C!==void 0&&x.setZoom(C),P!==void 0&&x.setRoll(P),L!==void 0&&x.setPitch(L),j!==void 0&&x.setBearing(j),c.apply(x)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new l.l("move",t)),this._zooming&&this.fire(new l.l("zoom",t)),this._rotating&&this.fire(new l.l("rotate",t)),this._pitching&&this.fire(new l.l("pitch",t)),this._rolling&&this.fire(new l.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,f=this._rotating,x=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new l.l("zoomend",t)),f&&this.fire(new l.l("rotateend",t)),x&&this.fire(new l.l("pitchend",t)),w&&this.fire(new l.l("rollend",t)),this.fire(new l.l("moveend",t))}flyTo(t,a){if(!t.essential&&Ce.prefersReducedMotion){const tt=l.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(tt,a)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cy},t);const c=this._getTransformForUpdate(),f=c.bearing,x=c.pitch,w=c.roll,C=c.padding,P="bearing"in t?this._normalizeBearing(t.bearing,f):f,L="pitch"in t?+t.pitch:x,j="roll"in t?this._normalizeBearing(t.roll,w):w,V="padding"in t?t.padding:c.padding,U=l.P.convert(t.offset);let Z=c.centerPoint.add(U);const Q=c.screenPointToLocation(Z),se=this.cameraHelper.handleFlyTo(c,{bearing:P,pitch:L,roll:j,padding:V,locationAtOffset:Q,offsetAsPoint:U,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ce=t.curve;const oe=Math.max(c.width,c.height),pe=oe/se.scaleOfZoom,Te=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(ce=Math.sqrt(oe/se.scaleOfMinZoom/Te*2));const fe=ce*ce;function Se(tt){const Lt=(pe*pe-oe*oe+(tt?-1:1)*fe*fe*Te*Te)/(2*(tt?pe:oe)*fe*Te);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function Ae(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function _e(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Re=Se(!1);let rt=function(tt){return _e(Re)/_e(Re+ce*tt)},Ke=function(tt){return oe*((_e(Re)*(Ae(Lt=Re+ce*tt)/_e(Lt))-Ae(Re))/fe)/Te;var Lt},et=(Se(!0)-Re)/ce;if(Math.abs(Te)<2e-6||!isFinite(et)){if(Math.abs(oe-pe)<1e-6)return this.easeTo(t,a);const tt=pe<oe?-1:1;et=Math.abs(Math.log(pe/oe))/ce,Ke=()=>0,rt=Lt=>Math.exp(tt*ce*Lt)}return t.duration="duration"in t?+t.duration:1e3*et/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==P,this._pitching=L!==x,this._rolling=j!==w,this._padding=!c.isPaddingEqual(V),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease((tt=>{const Lt=tt*et,Nt=1/rt(Lt),wt=Ke(Lt);this._rotating&&c.setBearing(l.G.number(f,P,tt)),this._pitching&&c.setPitch(l.G.number(x,L,tt)),this._rolling&&c.setRoll(l.G.number(w,j,tt)),this._padding&&(c.interpolatePadding(C,V,tt),Z=c.centerPoint.add(U)),se.easeFunc(tt,Nt,wt,Z),this.terrain&&!t.freezeElevation&&this._updateElevation(tt),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=he(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=l.W(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(l.V.convert(t),this.transform):null}}const ji={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Gi{constructor(t=ji){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=te.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=te.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const x=a[f];if(x.used||x.usedForTerrain){const w=x.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter((f=>String(f).trim())),t.sort(((f,x)=>f.length-x.length)),t=t.filter(((f,x)=>{for(let w=x+1;w<t.length;w++)if(t[w].indexOf(f)>=0)return!1;return!0}));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=te.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Eu{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=te.create("div","maplibregl-ctrl");const a=te.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){te.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class bo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zn=l.aU([{name:"a_pos3d",type:"Int16",components:3}]);class ti extends l.E{constructor(t){super(),this._lastTilesetChange=he(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const c={};for(const f of Ti(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),l.c7(f.terrainRttPosMatrix32f,0,l.a5,l.a5,0,0,1),this._tiles[f.key]=new Je(f,this.tileSize),this._lastTilesetChange=he());for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID,x=t.clone(),w=l.bk();if(f.canonical.equals(t.canonical))l.c7(w,0,l.a5,l.a5,0,0,1);else if(f.canonical.isChildOf(t.canonical)){const C=f.canonical.z-t.canonical.z,P=f.canonical.x-(f.canonical.x>>C<<C),L=f.canonical.y-(f.canonical.y>>C<<C),j=l.a5>>C;l.c7(w,0,j,j,0,0,1),l.O(w,w,[-P*j,-L*j,0])}else{if(!t.canonical.isChildOf(f.canonical))continue;{const C=t.canonical.z-f.canonical.z,P=t.canonical.x-(t.canonical.x>>C<<C),L=t.canonical.y-(t.canonical.y>>C<<C),j=l.a5>>C;l.c7(w,0,l.a5,l.a5,0,0,1),l.O(w,w,[P*j,L*j,0]),l.Q(w,w,[1/2**C,1/2**C,0])}}x.terrainRttPosMatrix32f=new Float32Array(w),a[c]=x}return a}_getTerrainCoordsForTileRanges(t,a){const c={};for(const f of this._renderableTilesKeys){const x=this._tiles[f].tileID;if(!this._isWithinTileRanges(x,a))continue;const w=t.clone(),C=l.bk();if(x.canonical.z===t.canonical.z){const P=t.canonical.x-x.canonical.x,L=t.canonical.y-x.canonical.y;l.c7(C,0,l.a5,l.a5,0,0,1),l.O(C,C,[P*l.a5,L*l.a5,0])}else if(x.canonical.z>t.canonical.z){const P=x.canonical.z-t.canonical.z,L=x.canonical.x-(x.canonical.x>>P<<P),j=x.canonical.y-(x.canonical.y>>P<<P),V=t.canonical.x-(x.canonical.x>>P),U=t.canonical.y-(x.canonical.y>>P),Z=l.a5>>P;l.c7(C,0,Z,Z,0,0,1),l.O(C,C,[-L*Z+V*l.a5,-j*Z+U*l.a5,0])}else{const P=t.canonical.z-x.canonical.z,L=t.canonical.x-(t.canonical.x>>P<<P),j=t.canonical.y-(t.canonical.y>>P<<P),V=(t.canonical.x>>P)-x.canonical.x,U=(t.canonical.y>>P)-x.canonical.y,Z=l.a5<<P;l.c7(C,0,Z,Z,0,0,1),l.O(C,C,[L*l.a5+V*Z,j*l.a5+U*Z,0])}w.terrainRttPosMatrix32f=new Float32Array(C),c[f]=w}return c}getSourceTile(t,a){const c=this.tileManager._source;let f=t.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let x=this.findTileInCaches(this._sourceTileCache[t.key]);if(!x?.dem&&a)for(;f>=c.minzoom&&!x?.dem;)x=this.findTileInCaches(t.scaledTo(f--).key);return x}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class An{constructor(t,a,c){this._meshCache={},this.painter=t,this.tileManager=new ti(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,f=l.a5){var x;if(!(a>=0&&a<f&&c>=0&&c<f))return 0;const w=this.getTerrainData(t),C=(x=w.tile)===null||x===void 0?void 0:x.dem;if(!C)return 0;const P=l.cC([],[a/f*l.a5,c/f*l.a5],w.u_terrain_matrix),L=[P[0]*C.dim,P[1]*C.dim],j=Math.floor(L[0]),V=Math.floor(L[1]),U=L[0]-j,Z=L[1]-V;return C.get(j,V)*(1-U)*(1-Z)+C.get(j+1,V)*U*(1-Z)+C.get(j,V+1)*(1-U)*Z+C.get(j+1,V+1)*U*Z}getElevationForLngLatZoom(t,a){if(!l.cD(a,t.wrap()))return 0;const{tileID:c,mercatorX:f,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,f%l.a5,x%l.a5,l.a5)}getElevationForLngLat(t,a){const c=Ti(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let f=0;for(const x of c)x.canonical.z>f&&(f=Math.min(x.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,f)}getElevation(t,a,c,f=l.a5){return this.getDEMElevation(t,a,c,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,x=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(f,x,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(f,new l.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new l.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a.toString()+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const f=this.tileManager.getSource().maxzoom;let x=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?x=t.canonical.z-f:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>x<<x),C=t.canonical.y-(t.canonical.y>>x<<x),P=l.cE(new Float64Array(16),[1/(l.a5<<x),1/(l.a5<<x),0]);l.O(P,P,[w*l.a5,C*l.a5,0]),this._demMatrixCache[t.key]={matrix:P,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,w=0;x<this._coordsTextureSize;x++)for(let C=0;C<this._coordsTextureSize;C++,w+=4)a[w+0]=255&C,a[w+1]=255&x,a[w+2]=C>>8<<4|x>>8,a[w+3]=0;const c=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new l.T(t,c,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,f=c.gl,x=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(x,C-w-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const P=a[0]+(a[2]>>4<<8),L=a[1]+((15&a[2])<<8),j=this.coordsIndex[255-a[3]],V=j&&this.tileManager.getTileByID(j);if(!V)return null;const U=this._coordsTextureSize,Z=(1<<V.tileID.canonical.z)*U;return new l.a9((V.tileID.canonical.x*U+P)/Z+V.tileID.wrap,(V.tileID.canonical.y*U+L)/Z,this.getElevation(V.tileID,P,L,U))}depthAtPoint(t){const a=new Uint8Array(4),c=this.painter.context,f=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=c&&t.canonical.y===0,x=c&&t.canonical.y===(1<<t.canonical.z)-1,w=`m_${f?"n":""}_${x?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const C=this.painter.context,P=new l.cF,L=new l.aY,j=this.meshSize,V=l.a5/j,U=j*j;for(let _e=0;_e<=j;_e++)for(let Re=0;Re<=j;Re++)P.emplaceBack(Re*V,_e*V,0);for(let _e=0;_e<U;_e+=j+1)for(let Re=0;Re<j;Re++)L.emplaceBack(Re+_e,j+Re+_e+1,j+Re+_e+2),L.emplaceBack(Re+_e,j+Re+_e+2,Re+_e+1);const Z=P.length,Q=Z+(j+1),se=(j+1)*j,ce=f?l.br:0,oe=f?0:1,pe=x?l.bs:l.a5,Te=x?0:1;for(let _e=0;_e<=j;_e++)P.emplaceBack(_e*V,ce,oe);for(let _e=0;_e<=j;_e++)P.emplaceBack(_e*V,pe,Te);for(let _e=0;_e<j;_e++)L.emplaceBack(se+_e,Q+_e,Q+_e+1),L.emplaceBack(se+_e,Q+_e+1,se+_e+1),L.emplaceBack(0+_e,Z+_e+1,Z+_e),L.emplaceBack(0+_e,0+_e+1,Z+_e+1);const fe=P.length,Se=fe+2*(j+1);for(const _e of[0,1])for(let Re=0;Re<=j;Re++)for(const rt of[0,1])P.emplaceBack(_e*l.a5,Re*V,rt);for(let _e=0;_e<2*j;_e+=2)L.emplaceBack(fe+_e,fe+_e+1,fe+_e+3),L.emplaceBack(fe+_e,fe+_e+3,fe+_e+2),L.emplaceBack(Se+_e,Se+_e+3,Se+_e+1),L.emplaceBack(Se+_e,Se+_e+2,Se+_e+3);const Ae=new fi(C.createVertexBuffer(P,zn.members),C.createIndexBuffer(L),l.aX.simpleSegment(0,0,P.length,L.length));return this._meshCache[w]=Ae,Ae}getMeshFrameDelta(t){return 2*Math.PI*l.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var c;if(!l.cD(a,t.wrap()))return 0;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=l.a9.fromLngLat(t.wrap()),f=(1<<a)*l.a5,x=c.x*f,w=c.y*f,C=Math.floor(x/l.a5),P=Math.floor(w/l.a5);return{tileID:new l.a2(a,0,a,C,P),mercatorX:x,mercatorY:w}}}class Di{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const es={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class bs{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Di(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((c=>!t._layers[c].isHidden(a))),this._coordsAscending={};for(const c in t.tileManagers){this._coordsAscending[c]={};const f=t.tileManagers[c].getVisibleCoordinates(),x=t.tileManagers[c].getSource(),w=x instanceof Cn?x.terrainTileRanges:null;for(const C of f){const P=this.terrain.tileManager.getTerrainCoords(C,w);for(const L in P)this._coordsAscending[c][L]||(this._coordsAscending[c][L]=[]),this._coordsAscending[c][L].push(P[L])}}this._coordsAscendingStr={};for(const c of t._order){const f=t._layers[c],x=f.source;if(es[f.type]&&!this._coordsAscendingStr[x]){this._coordsAscendingStr[x]={};for(const w in this._coordsAscending[x])this._coordsAscendingStr[x][w]=this._coordsAscending[x][w].map((C=>C.key)).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsAscendingStr){const x=this._coordsAscendingStr[f][c.tileID.key];x&&x!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=t.type,x=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(es[f]&&(this._prevType&&es[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!w))return!0;if(es[this._prevType]||es[f]&&w){this._prevType=f;const C=this._stacks.length-1,P=this._stacks[C]||[];for(const L of this._renderableTiles){if(this.pool.isFull()&&(yh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(L),L.rtt[C]){const V=this.pool.getObjectForId(L.rtt[C].id);if(V.stamp===L.rtt[C].stamp){this.pool.useObject(V);continue}}const j=this.pool.getOrCreateFreeObject();this.pool.useObject(j),this.pool.stampObject(j),L.rtt[C]={id:j.id,stamp:j.stamp},x.context.bindFramebuffer.set(j.fbo.framebuffer),x.context.clear({color:l.bp.transparent,stencil:0}),x.currentStencilSource=void 0;for(let V=0;V<P.length;V++){const U=x.style._layers[P[V]],Z=U.source?this._coordsAscending[U.source][L.tileID.key]:[L.tileID];x.context.viewport.set([0,0,j.fbo.width,j.fbo.height]),x._renderTileClippingMasks(U,Z,!0),x.renderLayer(x,x.style.tileManagers[U.source],U,Z,c),U.source&&(L.rttCoords[U.source]=this._coordsAscendingStr[U.source][L.tileID.key])}}return yh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),es[f]}return!1}}const Pl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Dl=O,wo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ji,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Ed={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ei{constructor(t,a,c=!1){this.mousedown=x=>{this.startMove(x,te.mousePos(this.element,x)),te.addEventListener(window,"mousemove",this.mousemove),te.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.move(x,te.mousePos(this.element,x))},this.mouseup=x=>{this._rotatePitchHandler.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te.touchPos(this.element,x.targetTouches)[0],this.startMove(x,this._startPos),te.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=te.touchPos(this.element,x.targetTouches)[0],this.move(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new xu;this._rotatePitchHandler=new Wa({clickTolerance:3,move:(x,w)=>{const C=a.getBoundingClientRect(),P=new l.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:l.cx(new l.P(x.x,w.y),w,P),pitchDelta:c?-.5*(w.y-x.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=t,te.addEventListener(a,"mousedown",this.mousedown),te.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),te.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),te.disableDrag()}move(t,a){const c=this.map,{bearingDelta:f,pitchDelta:x}=this._rotatePitchHandler.dragMove(t,a)||{};f&&c.setBearing(c.getBearing()+f),x&&c.setPitch(c.getPitch()+x)}off(){const t=this.element;te.removeEventListener(t,"mousedown",this.mousedown),te.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend),te.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){te.enableDrag(),te.removeEventListener(window,"mousemove",this.mousemove),te.removeEventListener(window,"mouseup",this.mouseup),te.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),te.removeEventListener(window,"touchend",this.touchend)}}let ws;function xc(y,t,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return y?.wrap();const f=new l.V(y.lng,y.lat);if(y=new l.V(y.lng,y.lat),t){const x=new l.V(y.lng-360,y.lat),w=new l.V(y.lng+360,y.lat),C=a.locationToScreenPoint(y).distSqr(t);a.locationToScreenPoint(x).distSqr(t)<C?y=x:a.locationToScreenPoint(w).distSqr(t)<C&&(y=w)}for(;Math.abs(y.lng-a.center.lng)>180;){const x=a.locationToScreenPoint(y);if(x.x>=0&&x.y>=0&&x.x<=a.width&&x.y<=a.height)break;y.lng>a.center.lng?y.lng-=360:y.lng+=360}return y.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(y))?y:f}const vc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Mu(y,t,a){const c=y.classList;for(const f in vc)c.remove(`maplibregl-${a}-anchor-${f}`);c.add(`maplibregl-${a}-anchor-${t}`)}class Cu extends l.E{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,f=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=xc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),te.setTransform(this._element,`${vc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${f}`),Ce.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=te.create("div");const a=te.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const x=te.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const w=te.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const C=te.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of P){const pe=te.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",oe.rx),pe.setAttributeNS(null,"ry",oe.ry),C.appendChild(pe)}const L=te.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill",this._color);const j=te.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),L.appendChild(j);const V=te.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const U=te.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild(U);const Z=te.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const Q=te.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=te.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const ce=te.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),Q.appendChild(se),Q.appendChild(ce),w.appendChild(C),w.appendChild(L),w.appendChild(V),w.appendChild(Z),w.appendChild(Q),a.appendChild(w),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Mu(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),te.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,c;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,x=this._map.transform.isLocationOccluded(this._lngLat);if(!f||x){const Z=x?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Z&&(this._element.style.opacity=Z))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const w=this._map,C=w.terrain.depthAtPoint(this._pos),P=w.terrain.getElevationForLngLat(this._lngLat,w.transform);if(w.transform.lngLatToCameraDepth(this._lngLat,P)-C<.006)return void(this._element.style.opacity=this._opacity);const L=-this._offset.y/w.transform.pixelsPerMeter,j=Math.sin(w.getPitch()*Math.PI/180)*L,V=w.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),U=w.transform.lngLatToCameraDepth(this._lngLat,P+j)-V>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&U&&this._popup.remove(),this._element.style.opacity=U?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Au={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Qo=0,So=!1;const Nr={maxWidth:100,unit:"metric"};function Ii(y,t,a){const c=a&&a.maxWidth||100,f=y._container.clientHeight/2,x=y._container.clientWidth/2,w=y.unproject([x-c/2,f]),C=y.unproject([x+c/2,f]),P=Math.round(y.project(C).x-y.project(w).x),L=Math.min(c,P,y._container.clientWidth),j=w.distanceTo(C);if(a&&a.unit==="imperial"){const V=3.2808*j;V>5280?to(t,L,V/5280,y._getUIString("ScaleControl.Miles")):to(t,L,V,y._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?to(t,L,j/1852,y._getUIString("ScaleControl.NauticalMiles")):j>=1e3?to(t,L,j/1e3,y._getUIString("ScaleControl.Kilometers")):to(t,L,j,y._getUIString("ScaleControl.Meters"))}function to(y,t,a,c){const f=(function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/w;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:(function(P){const L=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*L)/L})(C),w*C})(a);y.style.width=t*(f/a)+"px",y.innerHTML=`${f}&nbsp;${c}`}const Il={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Rl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bc(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-y),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const t=l.P.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return bc(new l.P(0,0))}const Ss=O;E.AJAXError=l.cI,E.Event=l.l,E.Evented=l.E,E.LngLat=l.V,E.MercatorCoordinate=l.a9,E.Point=l.P,E.addProtocol=l.cJ,E.config=l.c,E.removeProtocol=l.cK,E.AttributionControl=Gi,E.BoxZoomHandler=Ko,E.CanvasSource=W,E.CooperativeGesturesHandler=Yt,E.DoubleClickZoomHandler=Th,E.DragPanHandler=Td,E.DragRotateHandler=Da,E.EdgeInsets=Sa,E.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){te.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=te.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);te.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},E.GeoJSONSource=kn,E.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new l.V(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,f=this._map.getBearing(),x=l.e({bearing:f},this.options.fitBoundsOptions),w=Gt.fromLngLat(a,c);this._map.fitBounds(w,x,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new l.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&So)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=te.create("button","maplibregl-ctrl-geolocate",this._container),te.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cu({element:this._dotElement}),this._circleElement=te.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},Au,y)}onAdd(y){return this._map=y,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(t=!1){if(ws!==void 0&&!t)return ws;if(window.navigator.permissions===void 0)return ws=!!window.navigator.geolocation,ws;try{ws=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ws=!!window.navigator.geolocation}return ws}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),te.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Qo=0,So=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),a=y.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const y=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&y))return;const t=this._map.project(y),a=this._map.unproject([t.x+100,t.y]),c=y.distanceTo(a)/100,f=2*this._accuracy/c;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Qo--,So=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Qo++,Qo>1?(y={maximumAge:6e5,timeout:0},So=!0):(y=this.options.positionOptions,So=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},E.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const t=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=te.create("button","maplibregl-ctrl-globe",this._container),te.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){te.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},E.Hash=Ji,E.ImageSource=Cn,E.KeyboardHandler=ri,E.LngLatBounds=Gt,E.LogoControl=Eu,E.Map=class extends er{constructor(y){var t,a;l.cG.mark(l.cH.create);const c=Object.assign(Object.assign(Object.assign({},wo),y),{canvasContextAttributes:Object.assign(Object.assign({},wo.canvasContextAttributes),y.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new dr,x=new gl;if(c.minZoom!==void 0&&f.setMinZoom(c.minZoom),c.maxZoom!==void 0&&f.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&f.setMinPitch(c.minPitch),c.maxPitch!==void 0&&f.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&f.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&f.setConstrainOverride(c.transformConstrain),super(f,x,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new bo,this._controls=[],this._mapId=l.af(),this._lostContextStyle={style:null,images:null},this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const P of Object.values(this.style._layers))if(P.type==="custom"&&console.warn(`Custom layer with id '${P.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),P._listeners)for(const[L]of Object.entries(P._listeners))console.warn(`Custom layer with id '${P.id}' had event listeners for event '${L}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Pl),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(Ce.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=nt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Be(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1;const P=bd((L=>{this._trackResize&&!this._removed&&(this.resize(L),this.redraw())}),50);this._resizeObserver=new ResizeObserver((L=>{C?P(L):C=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Tu(this,c),this._hash=c.hash&&new Ji(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,l.e({},c.fitBoundsOptions,{duration:0}))));const w=typeof c.style=="string"||((a=(t=c.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Gi(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Eu,c.logoPosition),this.on("style.load",(()=>{if(w||this._resizeTransform(),this.transform.unmodified){const C=l.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}})),this.on("data",(C=>{this._update(C.dataType==="style"),this.fire(new l.l(`${C.dataType}data`,C))})),this.on("dataloading",(C=>{this.fire(new l.l(`${C.dataType}dataloading`,C))})),this.on("dataabort",(C=>{this.fire(new l.l("sourcedataabort",C))}))}_getMapId(){return this._mapId}setGlobalStateProperty(y,t){return this.style.setGlobalStateProperty(y,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=y.onAdd(this);this._controls.push(y);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}coveringTiles(y){return Ti(this.transform,y)}calculateCameraOptionsFromTo(y,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(y,t,a,c)}resize(y,t=!0){const[a,c]=this._containerDimensions(),f=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,f),this.painter.resize(a,c,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const C=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,C),this.painter.resize(a,c,C)}this._resizeTransform(t);const x=!this._moving;return x&&(this.stop(),this.fire(new l.l("movestart",y)).fire(new l.l("move",y))),this.fire(new l.l("resize",y)),x&&this.fire(new l.l("moveend",y)),this}_resizeTransform(y=!0){var t;const[a,c]=this._containerDimensions();this.transform.resize(a,c,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c,y)}_getClampedPixelRatio(y,t){const{0:a,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),x=y*f,w=t*f;return Math.min(x>a?a/x:1,w>c?c/w:1)*f}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Gt.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.setMinPitch(y),this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch)return this.transform.setMaxPitch(y),this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}setTransformConstrain(y){return this.transform.setConstrainOverride(y),this._update()}project(y){return this.transform.locationToScreenPoint(l.V.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,a){if(y==="mouseenter"||y==="mouseover"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:x=>{const w=t.filter((P=>this.getLayer(P))),C=w.length!==0?this.queryRenderedFeatures(x.point,{layers:w}):[];C.length?c||(c=!0,a.call(this,new xr(y,this,x.originalEvent,{features:C}))):c=!1},mouseout:()=>{c=!1}}}}if(y==="mouseleave"||y==="mouseout"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:w=>{const C=t.filter((P=>this.getLayer(P)));(C.length!==0?this.queryRenderedFeatures(w.point,{layers:C}):[]).length?c=!0:c&&(c=!1,a.call(this,new xr(y,this,w.originalEvent)))},mouseout:w=>{c&&(c=!1,a.call(this,new xr(y,this,w.originalEvent)))}}}}{const c=f=>{const x=t.filter((C=>this.getLayer(C))),w=x.length!==0?this.queryRenderedFeatures(f.point,{layers:x}):[];w.length&&(f.features=w,a.call(this,f),delete f.features)};return{layers:t,listener:a,delegates:{[y]:c}}}}_saveDelegatedListener(y,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(t)}_removeDelegatedListener(y,t,a){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const c=this._delegatedListeners[y];for(let f=0;f<c.length;f++){const x=c[f];if(x.listener===a&&x.layers.length===t.length&&x.layers.every((w=>t.includes(w)))){for(const w in x.delegates)this.off(w,x.delegates[w]);return void c.splice(f,1)}}}on(y,t,a){if(a===void 0)return super.on(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);this._saveDelegatedListener(y,f);for(const x in f.delegates)this.on(x,f.delegates[x]);return{unsubscribe:()=>{this._removeDelegatedListener(y,c,a)}}}once(y,t,a){if(a===void 0)return super.once(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);for(const x in f.delegates){const w=f.delegates[x];f.delegates[x]=(...C)=>{this._removeDelegatedListener(y,c,a),w(...C)}}this._saveDelegatedListener(y,f);for(const x in f.delegates)this.once(x,f.delegates[x]);return this}off(y,t,a){return a===void 0?super.off(y,t):(this._removeDelegatedListener(y,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let a;const c=y instanceof l.P||Array.isArray(y),f=c?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:y)||{},f instanceof l.P||typeof f[0]=="number")a=[l.P.convert(f)];else{const x=l.P.convert(f[0]),w=l.P.convert(f[1]);a=[x,new l.P(w.x,x.y),w,new l.P(x.x,w.y),x]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){var a,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(y,t)));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Fo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,f):this.style.loadJSON(y,t,f),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const a=this._requestManager.transformRequest(y,"Style");l.j(a,new AbortController).then((c=>{this._updateDiff(c.data,t)})).catch((c=>{c&&this.fire(new l.k(c))}))}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.tileManagers[y];if(t!==void 0)return t.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.tileManagers[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===y.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new An(this.painter,t,y),this.painter.renderToTexture=new bs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.tileManagers;for(const t of Object.values(y))if(!t.areTilesLoaded())return!1;return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}setSourceTileLodParams(y,t,a){if(a){const c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=qn(Math.max(1,y),Math.max(1,t))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=qn(Math.max(1,y),Math.max(1,t));return this._update(!0),this}refreshTiles(y,t){const a=this.style.tileManagers[y];if(!a)throw new Error(`There is no tile manager with ID "${y}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((c=>new l.ac(c.z,c.x,c.y))))}addImage(y,t,a={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:x,stretchY:w,content:C,textFitWidth:P,textFitHeight:L}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:j,height:V,data:U}=t,Z=t;return this.style.addImage(y,{data:new l.R({width:j,height:V},new Uint8Array(U)),pixelRatio:c,stretchX:x,stretchY:w,content:C,textFitWidth:P,textFitHeight:L,sdf:f,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,y),this}}{const{width:j,height:V,data:U}=Ce.getImageData(t);this.style.addImage(y,{data:new l.R({width:j,height:V},U),pixelRatio:c,stretchX:x,stretchY:w,content:C,textFitWidth:P,textFitHeight:L,sdf:f,version:0})}}updateImage(y,t){const a=this.style.getImage(y);if(!a)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.b(t)?Ce.getImageData(t):t,{width:f,height:x,data:w}=c;if(f===void 0||x===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||x!==a.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(t instanceof HTMLImageElement||l.b(t));return a.data.replace(w,C),this.style.updateImage(y,a),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return nt.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,t,a){return this.style.setLayerZoomRange(y,t,a),this._update(!0)}setFilter(y,t,a={}){return this.style.setFilter(y,t,a),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,a,c={}){return this.style.setPaintProperty(y,t,a,c),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,a,c={}){return this.style.setLayoutProperty(y,t,a,c),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,a,(c=>{c||this._update(!0)})),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,(a=>{a||this._update(!0)})),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=te.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=te.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const f=this._controlContainer=te.create("div","maplibregl-control-container",y),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{x[w]=te.create("div",`maplibregl-ctrl-${w} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,t,a){this._canvas.width=Math.floor(a*y),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{t={requestedAttributes:y},c&&(t.statusMessage=c.statusMessage,t.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new Uf(a,this.transform),ve.testSupport(a)}migrateProjection(y,t){super.migrateProjection(y,t),this.painter.transform=y,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var t,a,c,f,x;const w=this._idleTriggered?this._fadeDuration:0,C=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let P=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,U=he();this.style.zoomHistory.update(V,U);const Z=new l.H(V,{now:U,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=Z.crossFadingFactor();Q===1&&Q===this._crossFadingFactor||(P=!0,this._crossFadingFactor=Q),this.style.update(Z)}const L=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==C;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(x=this.style.projection)===null||x===void 0?void 0:x.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||L)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,L),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cG.mark(l.cH.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||P)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const j=this._sourcesDirty||this._styleDirty||this._placementDirty;return j||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,l.cG.mark(l.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),nt.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),te.remove(this._canvasContainer),te.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cG.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ce.frame(this._frameRequest,(y=>{l.cG.frame(y),this._frameRequest=null;try{this._render(y)}catch(t){if(!l.Z(t)&&!(function(a){return a.message===Xo})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Dl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},E.MapMouseEvent=xr,E.MapTouchEvent=_s,E.MapWheelEvent=_h,E.Marker=Cu,E.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=l.e({},Ed,y),this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),te.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),te.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=te.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ei(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){te.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const a=te.create("button",y,this._container);return a.type="button",a.addEventListener("click",t),a}},E.Popup=class extends l.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&te.remove(this._content),this._container&&(te.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=te.create("div","maplibregl-popup",this._map.getContainer()),this._tip=te.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=xc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const f=bc(this.options.offset);if(!c){const w=this._container.offsetWidth,C=this._container.offsetHeight;let P;P=a.y+f.bottom.y<C?["top"]:a.y>this._map.transform.height-C?["bottom"]:[],a.x<w/2?P.push("left"):a.x>this._map.transform.width-w/2&&P.push("right"),c=P.length===0?"bottom":P.join("-")}let x=a.add(f[c]);this.options.subpixelPositioning||(x=x.round()),te.setTransform(this._container,`${vc[c]} translate(${x.x}px,${x.y}px)`),Mu(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Il),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.V.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=y;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=te.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=te.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Rl);y&&y.focus()}},E.RasterDEMTileSource=Zn,E.RasterTileSource=bn,E.ScaleControl=class{constructor(y){this._onMove=()=>{Ii(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ii(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Nr),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){te.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},E.ScrollZoomHandler=wu,E.Style=Fo,E.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=te.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=te.create("button","maplibregl-ctrl-terrain",this._container),te.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){te.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},E.TwoFingersTouchPitchHandler=xo,E.TwoFingersTouchRotateHandler=bu,E.TwoFingersTouchZoomHandler=Js,E.TwoFingersTouchZoomRotateHandler=kl,E.VectorTileSource=Rn,E.VideoSource=Ue,E.addSourceType=(y,t)=>l._(void 0,void 0,void 0,(function*(){if(K(y))throw new Error(`A source type called "${y}" already exists.`);((a,c)=>{$[a]=c})(y,t)})),E.clearPrewarmedResources=function(){const y=jt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(It),jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},E.createTileMesh=Af,E.getMaxParallelImageRequests=function(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS},E.getRTLTextPluginStatus=function(){return Le().getRTLTextPluginStatus()},E.getVersion=function(){return Ss},E.getWorkerCount=function(){return Ze.workerCount},E.getWorkerUrl=function(){return l.c.WORKER_URL},E.importScriptInWorkers=function(y){return dn().broadcast("IS",y)},E.isTimeFrozen=function(){return be.isFrozen()},E.now=he,E.prewarm=function(){Ot().acquire(It)},E.restoreNow=function(){be.restoreNow()},E.setMaxParallelImageRequests=function(y){l.c.MAX_PARALLEL_IMAGE_REQUESTS=y},E.setNow=function(y){be.setNow(y)},E.setRTLTextPlugin=function(y,t){return Le().setRTLTextPlugin(y,t)},E.setWorkerCount=function(y){Ze.workerCount=y},E.setWorkerUrl=function(y){l.c.WORKER_URL=y}}));var R=v;return R}))})(ky)),ky.exports}var m1=jC();const g1=vg(m1),OC=Z1({__proto__:null,default:g1},[m1]),hn={PARKING_LOG:31417,OPEN_SPOT_BROADCAST:31714,ROUTE_LOG:34171,RELAY_LIST:10002,LISTED_PARKING_METADATA:31147,PARKING_SPOT_LISTING:37141,LISTED_SPOT_LOG:1714,PRIVATE_LOG_NOTE:1417},Fn=["wss://relay.primal.net","wss://nos.lol","wss://relay.snort.social"];var V_={},tv;function BC(){if(tv)return V_;tv=1;var u=function(){},m="+",v=8,S="0",M="23456789CFGHJMPQRVWX",R=M.length,E=90,l=180,O=10,Y=[20,1,.05,.0025,125e-6],ie=4,ne=5,ze=125e-6,Ce=6;u.prototype.isValid=function(Be){if(!Be||Be.indexOf(m)==-1||Be.indexOf(m)!=Be.lastIndexOf(m)||Be.length==1||Be.indexOf(m)>v||Be.indexOf(m)%2==1)return!1;if(Be.indexOf(S)>-1){if(Be.indexOf(S)==0)return!1;var it=Be.match(new RegExp("("+S+"+)","g"));if(it.length>1||it[0].length%2==1||it[0].length>v-2||Be.charAt(Be.length-1)!=m)return!1}if(Be.length-Be.indexOf(m)-1==1)return!1;Be=Be.replace(new RegExp("\\"+m+"+"),"").replace(new RegExp(S+"+"),"");for(var $e=0,we=Be.length;$e<we;$e++){var Qe=Be.charAt($e).toUpperCase();if(Qe!=m&&M.indexOf(Qe)==-1)return!1}return!0},u.prototype.isShort=function(Be){return this.isValid(Be)?Be.indexOf(m)>=0&&Be.indexOf(m)<v:!1},u.prototype.isFull=function(Be){if(!this.isValid(Be)||this.isShort(Be))return!1;var it=M.indexOf(Be.charAt(0).toUpperCase())*R;if(it>=E*2)return!1;if(Be.length>1){var $e=M.indexOf(Be.charAt(1).toUpperCase())*R;if($e>=l*2)return!1}return!0},u.prototype.encode=function(Be,it,$e){if(typeof $e>"u"&&($e=O),$e<2||$e<v&&$e%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";Be=be(Be),it=te(it),Be==90&&(Be=Be-he($e));var we=ve(Be,it,Math.min($e,O));return $e>O&&(we+=qe(Be,it,$e-O)),we},u.prototype.decode=function(Be){if(!this.isFull(Be))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+Be;Be=Be.replace(m,""),Be=Be.replace(new RegExp(S+"+"),""),Be=Be.toUpperCase();var it=lt(Be.substring(0,O));if(Be.length<=O)return it;var $e=Et(Be.substring(O));return St(it.latitudeLo+$e.latitudeLo,it.longitudeLo+$e.longitudeLo,it.latitudeLo+$e.latitudeHi,it.longitudeLo+$e.longitudeHi,it.codeLength+$e.codeLength)},u.prototype.recoverNearest=function(Be,it,$e){if(!this.isShort(Be)){if(this.isFull(Be))return Be;throw"ValueError: Passed short code is not valid: "+Be}it=be(it),$e=te($e),Be=Be.toUpperCase();var we=v-Be.indexOf(m),Qe=Math.pow(20,2-we/2),ut=Qe/2,Ye=Math.floor(it/Qe)*Qe,Ie=Math.floor($e/Qe)*Qe,le=this.decode(this.encode(Ye,Ie).substr(0,we)+Be),ke=le.latitudeCenter-it;return ke>ut?le.latitudeCenter-=Qe:ke<-ut&&(le.latitudeCenter+=Qe),ke=le.longitudeCenter-$e,ke>ut?le.longitudeCenter-=Qe:ke<-ut&&(le.longitudeCenter+=Qe),this.encode(le.latitudeCenter,le.longitudeCenter,le.codeLength)},u.prototype.shorten=function(we,it,$e){if(!this.isFull(we))throw"ValueError: Passed code is not valid and full: "+we;if(we.indexOf(S)!=-1)throw"ValueError: Cannot shorten padded codes: "+we;var we=we.toUpperCase(),Qe=this.decode(we);if(Qe.codeLength<Ce)throw"ValueError: Code length must be at least "+Ce;it=be(it),$e=te($e);for(var ut=Math.max(Math.abs(Qe.latitudeCenter-it),Math.abs(Qe.longitudeCenter-$e)),Ye=Y.length-2;Ye>=1;Ye--)if(ut<Y[Ye]*.3)return we.substring((Ye+1)*2);return we};var be=function(Be){return Math.min(90,Math.max(-90,Be))},he=function(Be){return Be<=10?Math.pow(20,Math.floor(Be/-2+2)):Math.pow(20,-3)/Math.pow(ne,Be-10)},te=function(Be){for(;Be<-180;)Be=Be+360;for(;Be>=180;)Be=Be-360;return Be},ve=function(Be,it,$e){for(var we="",Qe=Be+E,ut=it+l,Ye=0;Ye<$e;){var Ie=Y[Math.floor(Ye/2)],le=Math.floor(Qe/Ie);Qe-=le*Ie,we+=M.charAt(le),Ye+=1,le=Math.floor(ut/Ie),ut-=le*Ie,we+=M.charAt(le),Ye+=1,Ye==v&&Ye<$e&&(we+=m)}return we.length<v&&(we=we+Array(v-we.length+1).join(S)),we.length==v&&(we=we+m),we},qe=function(Be,it,$e){for(var we="",Qe=ze,ut=ze,Ye=(Be+E)%Qe,Ie=(it+l)%ut,le=0;le<$e;le++){var ke=Math.floor(Ye/(Qe/ne)),De=Math.floor(Ie/(ut/ie));Qe/=ne,ut/=ie,Ye-=ke*Qe,Ie-=De*ut,we+=M.charAt(ke*ie+De)}return we},lt=function(Be){var it=Pt(Be,0),$e=Pt(Be,1);return new St(it[0]-E,$e[0]-l,it[1]-E,$e[1]-l,Be.length)},Pt=function(Be,it){for(var $e=0,we=0;$e*2+it<Be.length;)we+=M.indexOf(Be.charAt($e*2+it))*Y[$e],$e+=1;return[we,we+Y[$e-1]]},Et=function(Be){for(var it=0,$e=0,we=ze,Qe=ze,ut=0;ut<Be.length;){var Ye=M.indexOf(Be.charAt(ut)),Ie=Math.floor(Ye/ie),le=Ye%ie;we/=ne,Qe/=ie,it+=Ie*we,$e+=le*Qe,ut+=1}return St(it,$e,it+we,$e+Qe,Be.length)},St=u.prototype.CodeArea=function(Be,it,$e,we,Qe){return new nt.init(Be,it,$e,we,Qe)},nt={init:function(Be,it,$e,we,Qe){this.latitudeLo=Be,this.longitudeLo=it,this.latitudeHi=$e,this.longitudeHi=we,this.codeLength=Qe,this.latitudeCenter=Math.min(Be+($e-Be)/2,E),this.longitudeCenter=Math.min(it+(we-it)/2,l)}};return V_.OpenLocationCode=u,V_}var FC=BC();const UC=vg(FC);function gg(u,m,v=10){const S=[16,8,4,2,1],M="0123456789bcdefghjkmnpqrstuvwxyz";let R=!0,E=-90,l=90,O=-180,Y=180,ie="",ne=0,ze=0;for(;ie.length<v;){if(R){const Ce=(O+Y)/2;m>Ce?(ze|=S[ne],O=Ce):Y=Ce}else{const Ce=(E+l)/2;u>Ce?(ze|=S[ne],E=Ce):l=Ce}R=!R,ne<4?ne++:(ie+=M[ze],ne=0,ze=0)}return ie}function VC(u,m){return`${u.toFixed(6)}, ${m.toFixed(6)}`}function qC(u,m,v=5){const S=gg(u,m,v),M=v===5?.02:v===6?.005:.001,R=v===5?.04:v===6?.01:.002,E=new Set;E.add(S);const l=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[O,Y]of l){const ie=u+O*M,ne=m+Y*R;E.add(gg(ie,ne,v))}return Array.from(E)}const q_=UC,GC=q_.OpenLocationCode||q_.default?.OpenLocationCode||q_,na=new GC;function $C(u,m,v){try{if(na&&na.recoverNearest){console.log("[Parlens] Attempting Plus Code recovery:",u,"near",m,v);const S=na.recoverNearest(u,m,v);console.log("[Parlens] Recovered full code:",S);const M=na.decode(S);return console.log("[Parlens] Decoded coordinates:",M.latitudeCenter,M.longitudeCenter),{lat:M.latitudeCenter,lon:M.longitudeCenter,type:"plus_code"}}}catch(S){console.error("[Parlens] Plus Code recovery failed:",S)}return null}function nv(u){const m=u.trim();if(m.replace(//g,"").replace(/,/g," ").split(/\s+/).filter(M=>M.length>0).length>=2){let M=null,R=null;const E=m.match(/^(-?\d+(\.\d+)?)[,\s]+(-?\d+(\.\d+)?)$/);if(E)M=parseFloat(E[1]),R=parseFloat(E[3]);else{const l=m.matchAll(/([0-9.-]+)\s*?\s*([NSEWnsew])?/g),O=Array.from(l);if(O.length===2){const Y=parseFloat(O[0][1]),ie=O[0][2]?.toUpperCase(),ne=parseFloat(O[1][1]),ze=O[1][2]?.toUpperCase(),Ce=(te,ve)=>{let qe=te;return(ve==="S"||ve==="W")&&(qe=-te),ve==="N"||ve==="S"?{type:"lat",val:qe}:ve==="E"||ve==="W"?{type:"lon",val:qe}:{type:"unknown",val:qe}},be=Ce(Y,ie),he=Ce(ne,ze);be.type==="lat"&&he.type==="lon"?(M=be.val,R=he.val):be.type==="lon"&&he.type==="lat"?(R=be.val,M=he.val):be.type==="unknown"&&he.type==="unknown"&&(M=be.val,R=he.val)}}if(M!==null&&R!==null&&!isNaN(M)&&!isNaN(R)&&M>=-90&&M<=90&&R>=-180&&R<=180)return{lat:M,lon:R,type:"coordinate"}}try{const R=m.split(/[\s,]+/)[0];if(na&&na.isValid&&na.isValid(m)&&na.isFull(m)){const E=na.decode(m);return{lat:E.latitudeCenter,lon:E.longitudeCenter,type:"plus_code"}}if(R.length>=6&&R.includes("+")&&na&&na.isValid&&na.isValid(R)&&na.isFull(R)){const E=na.decode(R);return{lat:E.latitudeCenter,lon:E.longitudeCenter,type:"plus_code"}}if(!m.includes("+")){const E=m.toUpperCase().replace(/\s+/g,"+");if(na&&na.isValid&&na.isValid(E)&&na.isFull(E)){const l=na.decode(E);return{lat:l.latitudeCenter,lon:l.longitudeCenter,type:"plus_code"}}}}catch{}return null}function iv(u,m,v,S){const R=(v-u)*Math.PI/180,E=(S-m)*Math.PI/180,l=Math.sin(R/2)*Math.sin(R/2)+Math.cos(u*Math.PI/180)*Math.cos(v*Math.PI/180)*Math.sin(E/2)*Math.sin(E/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}async function X0(u,m,v){const S=JSON.stringify(u);if(v){const M=pg.getConversationKey(v,m);return pg.encrypt(S,M)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(m,S);throw new Error("No encryption method available")}async function y1(u,m,v){let S;if(v){const M=pg.getConversationKey(v,m);S=pg.decrypt(u,M)}else if(window.nostr?.nip44?.decrypt)S=await window.nostr.nip44.decrypt(m,u);else throw new Error("No decryption method available");return JSON.parse(S)}const Fy={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function _1(u,m){try{const v=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${u}&lon=${m}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!v.ok)throw new Error("Geocoding failed");const M=(await v.json()).address?.country_code?.toUpperCase();return M&&Fy[M]?Fy[M]:"USD"}catch(v){return console.warn("Currency detection failed, using locale fallback:",v),x1()}}function x1(){try{const m=window.navigator.language.split("-")[1]?.toUpperCase();return m&&Fy[m]?Fy[m]:"USD"}catch{return"USD"}}function yg(u){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:u,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[u]||"$"}}const HC={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function ZC(u){return(HC[u]||"US").toUpperCase().replace(/./g,v=>String.fromCodePoint(v.charCodeAt(0)+127397))}var xf=Symbol("verified"),XC=u=>u instanceof Object;function v1(u){if(!XC(u)||typeof u.kind!="number"||typeof u.content!="string"||typeof u.created_at!="number"||typeof u.pubkey!="string"||!u.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(u.tags))return!1;for(let m=0;m<u.tags.length;m++){let v=u.tags[m];if(!Array.isArray(v))return!1;for(let S=0;S<v.length;S++)if(typeof v[S]!="string")return!1}return!0}new TextDecoder("utf-8");var YC=new TextEncoder,KC=class{generateSecretKey(){return Uc.utils.randomPrivateKey()}getPublicKey(u){return Ki(Uc.getPublicKey(u))}finalizeEvent(u,m){const v=u;return v.pubkey=Ki(Uc.getPublicKey(m)),v.id=Py(v),v.sig=Ki(Uc.sign(Py(v),m)),v[xf]=!0,v}verifyEvent(u){if(typeof u[xf]=="boolean")return u[xf];const m=Py(u);if(m!==u.id)return u[xf]=!1,!1;try{const v=Uc.verify(u.sig,m,u.pubkey);return u[xf]=v,v}catch{return u[xf]=!1,!1}}};function b1(u){if(!v1(u))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,u.pubkey,u.created_at,u.kind,u.tags,u.content])}function Py(u){let m=ad(YC.encode(b1(u)));return Ki(m)}var i_=new KC,w1=i_.generateSecretKey,WC=i_.getPublicKey,S1=i_.finalizeEvent;i_.verifyEvent;const s0=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:S1,generateSecretKey:w1,getEventHash:Py,getPublicKey:WC,serializeEvent:b1,validateEvent:v1,verifiedSymbol:xf},Symbol.toStringTag,{value:"Module"})),QC=({status:u,setStatus:m,searchLocation:v,vehicleType:S,setOpenSpots:M,parkLocation:R,setParkLocation:E,sessionStart:l,setSessionStart:O,listedParkingSession:Y,onQRScan:ie})=>{const{pubkey:ne,pool:ze,signEvent:Ce}=Zc(),[be,he]=me.useState(!1),[te,ve]=me.useState("0"),[qe,lt]=me.useState("USD"),[Pt,Et]=me.useState("$"),[St,nt]=me.useState("00:00:00"),[Be,it]=me.useState(new Set),$e=me.useRef(new Map);me.useEffect(()=>{if(u==="parked"&&l){const Ye=()=>{const ke=Math.floor(Date.now()/1e3)-l,De=Math.floor(ke/3600),Fe=Math.floor(ke%3600/60),bt=ke%60;nt(`${De.toString().padStart(2,"0")}:${Fe.toString().padStart(2,"0")}:${bt.toString().padStart(2,"0")}`)},Ie=setInterval(Ye,1e3);return Ye(),()=>clearInterval(Ie)}},[u,l]),me.useEffect(()=>{if(u==="search"&&v){const Ye=qC(v[0],v[1],5);it(Ie=>{const le=new Set(Ie);return Ye.forEach(ke=>le.add(ke)),le.size!==Ie.size?le:Ie})}else u==="idle"&&(it(new Set),$e.current.clear(),M([]))},[u,v,M]),me.useEffect(()=>{if(ze&&($e.current.clear(),M([]),u==="search"&&Be.size>0)){console.log("[Parlens] Subscribing to spots in geohashes:",Array.from(Be));const Ye=Math.floor(Date.now()/1e3),Ie=De=>{try{const Fe=Math.floor(Date.now()/1e3);if(De.kind===hn.OPEN_SPOT_BROADCAST){const jt=De.tags.find($t=>$t[0]==="expiration");if(jt&&parseInt(jt[1])<Fe)return}const bt=De.tags.find(jt=>jt[0]==="location");if(!bt)return;const[de,He]=bt[1].split(",").map(Number);let _t="car",It=0,Ze="USD";if(De.kind===hn.OPEN_SPOT_BROADCAST){const jt=De.tags.find(ln=>ln[0]==="hourly_rate"),$t=De.tags.find(ln=>ln[0]==="currency"),Ot=De.tags.find(ln=>ln[0]==="type");It=jt?parseFloat(jt[1]):0,Ze=$t?$t[1]:"USD",_t=Ot?Ot[1]:"car"}else if(De.kind===hn.LISTED_SPOT_LOG){const jt=JSON.parse(De.content);if(jt.status!=="open")return;It=jt.hourly_rate||0,Ze=jt.currency||"USD",_t=jt.type||"car"}const Dt={id:De.id,lat:de,lon:He,price:It,currency:Ze,type:_t};$e.current.has(De.id)||$e.current.set(De.id,Dt)}catch(Fe){console.warn("[Parlens] Error parsing spot event:",Fe)}};(async()=>{try{const De=await ze.querySync(Fn,{kinds:[hn.OPEN_SPOT_BROADCAST,hn.LISTED_SPOT_LOG],"#g":Array.from(Be),since:Ye-600});for(const Fe of De)Ie(Fe);$e.current.size>0&&M(Array.from($e.current.values()))}catch(De){console.error("[Parlens] Initial spot fetch failed:",De)}})();const ke=ze.subscribeMany(Fn,[{kinds:[hn.OPEN_SPOT_BROADCAST,hn.LISTED_SPOT_LOG],"#g":Array.from(Be),since:Ye-600}],{onevent(De){Ie(De),$e.current.has(De.id)||($e.current.set(De.id,De),M(Array.from($e.current.values())))},oneose(){}});return()=>{console.log("[Parlens] Unsubscribing from spots"),ke.close()}}},[u,Be,ze,M]);const we=me.useRef(!1);me.useEffect(()=>{(async()=>{if(we.current)return;const Ie=x1();if(lt(Ie),Et(yg(Ie)),v){we.current=!0;try{const le=await _1(v[0],v[1]);lt(le),Et(yg(le))}catch{console.warn("GPS currency detection failed")}}})()},[v]);const Qe=async()=>{u==="idle"?m("search"):u==="search"?(O(Math.floor(Date.now()/1e3)),E(v?[v[0],v[1]]:null),m("parked")):u==="parked"&&(Y?ie?.():(ve("0"),he(!0)))},ut=async()=>{m("idle"),he(!1);const Ye=R?R[0]:v?v[0]:0,Ie=R?R[1]:v?v[1]:0,le=gg(Ye,Ie,5),ke=Math.floor(Date.now()/1e3),De=l||ke;try{const Fe={status:"vacated",lat:Ye,lon:Ie,geohash:le,fee:te,currency:qe,type:S,started_at:De,finished_at:ke},bt=localStorage.getItem("parlens_privkey"),de=bt?new Uint8Array(bt.match(/.{1,2}/g).map(zt=>parseInt(zt,16))):void 0,He=await X0(Fe,ne,de),_t={kind:hn.PARKING_LOG,content:He,tags:[["d",`session_${De}`],["client","parlens"]],created_at:ke,pubkey:ne},It=await Ce(_t);console.log("Publishing log:",It.id,"to",Fn);const Ze=await Promise.allSettled(ze.publish(Fn,It)),Dt=Ze.filter(zt=>zt.status==="fulfilled").length,jt=Ze.filter(zt=>zt.status==="rejected").length;console.log(`[Parlens] Publish results: ${Dt}/${Ze.length} succeeded, ${jt} failed`),Ze.forEach((zt,qt)=>{zt.status==="rejected"&&console.warn(`[Parlens] Relay ${Fn[qt]} failed:`,zt.reason)}),Dt===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(zt=>setTimeout(zt,300)),window.dispatchEvent(new Event("parking-log-updated"));const $t=w1(),Ot=ke-De,ln=Math.max(Math.ceil(Ot/3600),1),dn=String(Math.round(parseFloat(te)/ln)),rn=ke+300,gt={kind:hn.OPEN_SPOT_BROADCAST,content:"",tags:[["d",`spot_${le}_${ke}`],["g",le],["location",`${Ye},${Ie}`],["hourly_rate",dn],["currency",qe],["type",S],["expiration",String(rn)],["client","parlens"]],created_at:ke},xt=S1(gt,$t);console.log("[Parlens] *** BROADCASTING OPEN SPOT ***"),console.log("[Parlens] Geohash:",le),console.log("[Parlens] Location:",`${Ye},${Ie}`),console.log("[Parlens] Event ID:",xt.id),console.log("[Parlens] Pubkey:",xt.pubkey.substring(0,20)+"..."),ze.publish(Fn,xt),O(null),E(null)}catch(Fe){console.error("Persistence error:",Fe),alert("Could not save to Nostr. Check relay connections.")}};return k.jsxs("div",{className:"relative flex flex-col items-end gap-4",children:[k.jsxs("div",{className:"flex items-center gap-4",children:[u==="search"&&k.jsx("button",{onClick:()=>m("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8",children:"CANCEL"}),u==="parked"&&k.jsx("div",{className:"h-14 px-6 rounded-full bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-2xl flex items-center justify-center animate-in slide-in-from-left-8 pointer-events-none",children:k.jsx("span",{className:"font-mono text-xl font-bold tabular-nums text-zinc-900 dark:text-white",children:St})}),k.jsxs("button",{onClick:Qe,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 ${u==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":u==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[u==="idle"&&k.jsx(u1,{size:32,strokeWidth:2.5}),u==="search"&&k.jsx(Hc,{size:32,strokeWidth:2.5,className:"animate-pulse"}),u==="parked"&&(S==="bicycle"?k.jsx("span",{className:"text-3xl",children:""}):S==="motorcycle"?k.jsx("span",{className:"text-3xl",children:""}):k.jsx("span",{className:"text-3xl",children:""}))]})]}),be&&k.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:k.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[k.jsxs("div",{className:"text-center space-y-1",children:[k.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),k.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),k.jsxs("div",{className:"flex items-center gap-4",children:[k.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[k.jsx("span",{className:"text-2xl font-bold text-blue-500",children:Pt}),k.jsx("input",{type:"number",value:te,onChange:Ye=>ve(Ye.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),k.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:qe})]}),k.jsxs("div",{className:"flex flex-col gap-1.5",children:[k.jsx("button",{onClick:()=>ve(String(Math.max(0,parseFloat(te||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(n_,{size:22,className:"text-zinc-600 dark:text-white/70"})}),k.jsx("button",{onClick:()=>ve(String(Math.max(0,parseFloat(te||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(nd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),k.jsxs("div",{className:"w-full space-y-3",children:[k.jsxs("button",{onClick:ut,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",k.jsx(l1,{size:20})]}),k.jsx("button",{onClick:()=>he(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};function JC(){const{pool:u,pubkey:m}=Zc(),[v,S]=me.useState([]),[M,R]=me.useState(!0),E=me.useRef(new Set),l=me.useCallback(async()=>{if(!(!m||!u)){R(!0),console.log("[useParkingLogs] Fetching logs for",m);try{const Y=await u.querySync(Fn,{kinds:[hn.PARKING_LOG,5],authors:[m],limit:100});console.log("[useParkingLogs] Fetched",Y.length,"events");const ie=new Set,ne=Y.filter(he=>he.kind===5);for(const he of ne)for(const te of he.tags)te[0]==="a"&&ie.add(te[1]);const Ce=Y.filter(he=>he.kind===hn.PARKING_LOG).filter(he=>{const te=he.tags?.find(qe=>qe[0]==="d")?.[1];if(!te)return!0;if(E.current.has(te))return!1;const ve=`${he.kind}:${he.pubkey}:${te}`;return!ie.has(ve)});console.log("[useParkingLogs] Valid logs after filtering:",Ce.length);const be=Ce.sort((he,te)=>te.created_at-he.created_at);S(be)}catch(Y){console.error("[useParkingLogs] Fetch error:",Y)}finally{R(!1)}}},[u,m]),O=me.useCallback(Y=>{console.log("[useParkingLogs] Marking deleted:",Y),E.current.add(Y)},[]);return me.useEffect(()=>{m&&l()},[m,l]),me.useEffect(()=>{const Y=()=>{console.log("[useParkingLogs] Received update event, refetching..."),l()};return window.addEventListener("parking-log-updated",Y),window.addEventListener("visibility-refresh",Y),()=>{window.removeEventListener("parking-log-updated",Y),window.removeEventListener("visibility-refresh",Y)}},[l]),{logs:v,loading:M,refetch:l,markDeleted:O}}const eA=({setHistorySpots:u,onOpenChange:m,onHelpClick:v})=>{const{pubkey:S,logout:M,pool:R,signEvent:E}=Zc(),{logs:l,refetch:O,markDeleted:Y}=JC(),[ie,ne]=me.useState(!1),[ze,Ce]=me.useState(!1),[be,he]=me.useState([]),[te,ve]=me.useState(!1),[qe,lt]=me.useState(!1),[Pt,Et]=me.useState(""),[St,nt]=me.useState(!1),[Be,it]=me.useState(null);me.useEffect(()=>{m?.(ie)},[ie,m]);const[$e,we]=me.useState(null),[Qe,ut]=me.useState([]),[Ye,Ie]=me.useState(!1),[le,ke]=me.useState("all"),[De,Fe]=me.useState(null),[bt,de]=me.useState(""),[He,_t]=me.useState(!1),It=async gt=>{if(!(!S||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){Ce(!0);try{const xt=gt.tags?.find(Gt=>Gt[0]==="d")?.[1];if(!xt)throw new Error("Missing d tag on event");const zt={kind:5,content:"Deleted by user",tags:[["a",`${hn.PARKING_LOG}:${S}:${xt}`],["k",String(hn.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:S},qt=await E(zt);await Promise.allSettled(R.publish(Fn,qt)),Y(xt),ut(Gt=>Gt.filter(gn=>gn.id!==gt.id))}catch(xt){console.error("Failed to delete parking log:",xt),alert("Failed to delete. Please try again.")}finally{Ce(!1)}}};me.useEffect(()=>{S&&(async()=>{const xt=await R.get(Fn,{kinds:[0],authors:[S]});if(xt)try{const zt=JSON.parse(xt.content);we({name:zt.name||zt.display_name||"Nostr User",npub:Sf.npubEncode(S),picture:zt.picture})}catch(zt){console.error("Error parsing profile:",zt)}else we({name:"Nostr User",npub:Sf.npubEncode(S),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${S}`})})()},[S,R]),me.useEffect(()=>{(async()=>{if(!S||!l.length)return;const xt=localStorage.getItem("parlens_privkey"),zt=xt?new Uint8Array(xt.match(/.{1,2}/g).map(Gt=>parseInt(Gt,16))):void 0,qt=await Promise.all(l.map(async Gt=>{try{const gn=await y1(Gt.content,S,zt);return{...Gt,decryptedContent:gn}}catch{return{...Gt,decryptedContent:null}}}));ut(qt.filter(Gt=>Gt.decryptedContent))})()},[l,S]),me.useEffect(()=>{u&&u(Ye?Qe:[])},[Ye,Qe,u]);const Ze=()=>{const gt=localStorage.getItem("parlens_privkey");if(gt){const xt=Sf.nsecEncode(new Uint8Array(gt.match(/.{1,2}/g).map(zt=>parseInt(zt,16))));navigator.clipboard.writeText(xt),alert("Copied to clipboard")}},Dt=(gt,xt)=>{if(!gt)return"Unknown";const zt=xt.getTime()-gt.getTime(),qt=Math.floor(zt/(1e3*60));if(qt<60)return`${qt}m`;const Gt=Math.floor(qt/60),gn=qt%60;return gn>0?`${Gt}h ${gn}m`:`${Gt}h`},jt=async(gt,xt)=>{if(!(!S||!E)){_t(!0);try{const zt=gt.tags?.find(Ln=>Ln[0]==="d")?.[1];if(!zt)throw new Error("Missing d tag");const qt=localStorage.getItem("parlens_privkey"),Gt=qt?new Uint8Array(qt.match(/.{1,2}/g).map(Ln=>parseInt(Ln,16))):void 0,gn={...gt.decryptedContent,note:xt},Rn=await X0(gn,S,Gt),bn={kind:hn.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",zt],["client","parlens"]],content:Rn},Zn=await E(bn);await Promise.allSettled(R.publish(Fn,Zn)),ut(Ln=>Ln.map(Wi=>Wi.id===gt.id?{...Wi,decryptedContent:gn}:Wi)),Fe(null),de("")}catch(zt){console.error("Failed to update note:",zt),alert("Failed to save note")}finally{_t(!1)}}},$t=me.useMemo(()=>Qe.filter(gt=>{const zt=gt.decryptedContent.type||"car";return!(le!=="all"&&zt!==le)}),[Qe,le]),Ot=me.useCallback(async()=>{if(!(!R||!S)){nt(!0);try{const gt=await R.get(Fn,{kinds:[hn.RELAY_LIST],authors:[S]});if(gt){const xt=gt.tags.filter(zt=>zt[0]==="r").map(zt=>zt[1]);he(xt)}else he([...Fn])}catch(gt){console.error("Error fetching preferred relays:",gt),he([...Fn])}finally{nt(!1)}}},[R,S]),ln=async gt=>{if(!R||!S||!E)return;const xt={kind:hn.RELAY_LIST,created_at:Math.floor(Date.now()/1e3),tags:gt.map(qt=>["r",qt]),content:""},zt=await E(xt);await Promise.allSettled(R.publish(Fn,zt)),he(gt)},dn=async()=>{const gt=Pt.trim();if(it(null),!gt.startsWith("wss://")){it("Relay URL must start with wss://");return}if(be.includes(gt)){it("This relay is already in your list");return}nt(!0);try{await ln([...be,gt]),Et(""),lt(!1)}catch(xt){console.error("Error adding relay:",xt),it("Failed to add relay")}finally{nt(!1)}},rn=async gt=>{if(confirm(`Are you sure you want to remove this relay?

${gt}

This action cannot be undone.`)){nt(!0);try{await ln(be.filter(xt=>xt!==gt))}catch(xt){console.error("Error removing relay:",xt),alert("Failed to remove relay")}finally{nt(!1)}}};return me.useEffect(()=>{ie&&S&&Ot()},[ie,S,Ot]),k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:()=>{O(),ne(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:k.jsx(sC,{size:20})}),ie&&k.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[k.jsx("button",{onClick:()=>ne(!1),className:"absolute inset-0 z-0 cursor-default"}),ze&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:k.jsxs("div",{className:"flex flex-col items-center gap-3",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),k.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),k.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent",children:$e?.name||"Nostr User"}),k.jsxs("div",{className:"flex gap-4 items-center",children:[k.jsx("button",{onClick:()=>v?.(),className:"w-10 h-10 flex items-center justify-center rounded-full bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 active:scale-95 transition-all",children:k.jsx("span",{className:"text-xl font-bold",children:"?"})}),k.jsx("button",{onClick:()=>ne(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform",children:k.jsx(Io,{size:20})})]})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Keys"}),k.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText($e?.npub),alert("Copied to clipboard")},children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:k.jsx(a0,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),k.jsx(Ef,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),k.jsxs("div",{onClick:Ze,className:"flex items-center justify-between p-4 cursor-pointer transition-colors active:bg-black/10 dark:active:bg-white/10",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:k.jsx(h1,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),k.jsx(Ef,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost. Use these keys to login to any Nostr client."})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Preferred Relays"}),k.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[k.jsxs("button",{onClick:()=>ve(!te),className:"w-full p-5 flex items-center justify-between transition-colors",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-green-500/10 dark:bg-green-500/20 text-green-500 dark:text-green-400",children:k.jsx(Vx,{size:20})}),k.jsxs("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:["Manage Relays (",be.length,")"]})]}),k.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:te?"Hide":"Show"})]}),te&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),k.jsx("div",{className:"p-4 space-y-2",children:St&&be.length===0?k.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):k.jsxs(k.Fragment,{children:[be.map(gt=>k.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[k.jsx(Vx,{size:16,className:"text-green-500 shrink-0"}),k.jsx("span",{className:"text-sm text-zinc-700 dark:text-white truncate",children:gt.replace("wss://","")})]}),k.jsx("button",{onClick:()=>rn(gt),disabled:be.length<=1,className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform disabled:opacity-30 disabled:cursor-not-allowed",title:be.length<=1?"At least one relay is required":"Remove relay",children:k.jsx(Mf,{size:16})})]},gt)),k.jsxs("button",{onClick:()=>{lt(!0),it(null),Et("")},className:"w-full p-3 flex items-center justify-center gap-2 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors active:scale-[0.98]",children:[k.jsx(mg,{size:16,className:"text-blue-500"}),k.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Relay"})]})]})})]})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Relay address(es) listed in this section tell Parlens where to look for and store data. Parlens requires a connection to at least one relay to work."}),qe&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",onClick:()=>lt(!1),children:k.jsxs("div",{className:"w-[90%] max-w-sm bg-white dark:bg-[#2c2c2e] rounded-2xl p-5 space-y-4 animate-in zoom-in-95 duration-200",onClick:gt=>gt.stopPropagation(),children:[k.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Add Relay"}),k.jsxs("div",{className:"space-y-2",children:[k.jsx("input",{type:"text",value:Pt,onChange:gt=>{Et(gt.target.value),it(null)},placeholder:"wss://relay.example.com",className:"w-full h-12 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onKeyDown:gt=>{gt.key==="Enter"&&dn(),gt.key==="Escape"&&lt(!1)}}),Be&&k.jsx("p",{className:"text-xs text-red-500 ml-1",children:Be})]}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:()=>lt(!1),className:"flex-1 h-11 rounded-xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-medium transition-all active:scale-95",children:"Cancel"}),k.jsx("button",{onClick:dn,disabled:St||!Pt.trim(),className:"flex-1 h-11 rounded-xl bg-[#007AFF] text-white font-medium disabled:opacity-50 transition-all active:scale-95",children:St?"...":"Add"})]})]})}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),u&&k.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:k.jsx(Hc,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),k.jsx("button",{onClick:()=>Ie(!Ye),className:`w-12 h-7 rounded-full transition-colors relative ${Ye?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:k.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${Ye?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),k.jsx("div",{className:"space-y-3",children:k.jsx("div",{className:"flex justify-between items-center gap-2 p-1 bg-zinc-100 dark:bg-white/5 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:["all","bicycle","motorcycle","car"].map(gt=>k.jsx("button",{onClick:()=>ke(gt),className:`flex-1 flex items-center justify-center py-2.5 rounded-[1.2rem] text-sm transition-all active:scale-95 ${le===gt?"bg-white dark:bg-white/10 text-zinc-900 dark:text-white font-bold shadow-sm":"text-zinc-400 dark:text-white/40 hover:text-zinc-600 dark:hover:text-white/60"}`,children:gt==="all"?"All":k.jsx("span",{className:"text-xl",children:gt==="bicycle"?"":gt==="motorcycle"?"":""})},gt))})}),$t.length>0?$t.map(gt=>{const xt=gt.decryptedContent,zt=yg(xt.currency||"USD"),qt=xt.started_at?new Date(xt.started_at*1e3):null,Gt=xt.finished_at?new Date(xt.finished_at*1e3):new Date(gt.created_at*1e3),gn=xt.lat&&xt.lon?`${xt.lat.toFixed(5)}, ${xt.lon.toFixed(5)}`:null,Rn=Dt(qt,Gt),bn=qt?qt.toLocaleDateString(void 0,{month:"short",day:"numeric"}):Gt.toLocaleDateString(void 0,{month:"short",day:"numeric"}),Zn=xt.type||"car",Ln=Zn==="bicycle"?"":Zn==="motorcycle"?"":"",Wi=De===gt.id;return k.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("span",{className:"text-2xl",children:Ln}),k.jsx("p",{className:"font-bold text-xl",children:`${zt}${xt.fee||"0"}`})]}),k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"text-2xl",children:ZC(xt.currency||"USD")}),k.jsx("button",{onClick:()=>It(gt),className:"p-1.5 text-zinc-400 dark:text-white/30 transition-colors",title:"Delete entry",children:k.jsx(Mf,{size:16})})]})]}),k.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[k.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 dark:text-white/50",children:[k.jsx(c1,{size:12,className:"text-green-500 dark:text-green-400"}),k.jsx("span",{className:"font-semibold",children:Rn})]}),k.jsx("span",{className:"text-zinc-400 dark:text-white/30",children:bn})]}),gn&&k.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[k.jsx(Hc,{size:12,className:"text-[#007AFF]"}),k.jsx("span",{className:"font-mono",children:gn})]}),k.jsx("div",{className:"flex items-center gap-2 text-xs text-zinc-500 dark:text-white/50 bg-zinc-100 dark:bg-white/5 rounded-lg px-3 py-2",children:Wi?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:bt,onChange:kn=>de(kn.target.value),placeholder:"Add note",className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-[#007AFF]",autoFocus:!0,onFocus:kn=>kn.currentTarget.select(),onKeyDown:kn=>{kn.key==="Enter"&&jt(gt,bt),kn.key==="Escape"&&Fe(null)}}),k.jsx("button",{onClick:()=>jt(gt,bt),disabled:He,className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors disabled:opacity-50",children:k.jsx(Xp,{size:16})}),k.jsx("button",{onClick:()=>Fe(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:k.jsx(Io,{size:16})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:`flex-1 cursor-pointer ${xt.note?"":"text-zinc-400 dark:text-white/30"}`,onClick:()=>{Fe(gt.id),de(xt.note||"")},children:xt.note||"Add note"}),k.jsx("button",{onClick:()=>{Fe(gt.id),de(xt.note||"")},className:"p-1 text-zinc-400 dark:text-white/30 shrink-0",children:k.jsx(Wp,{size:12})})]})})]},gt.id)}):k.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:k.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:Qe.length>0?"No entries match filters":"No recent activity"})})]})]}),k.jsx("button",{onClick:()=>{M(),ne(!1)},className:"w-full py-5 rounded-[2rem] bg-zinc-100 dark:bg-zinc-800 text-red-500 font-bold tracking-wide border border-black/5 dark:border-white/5 transition-all active:scale-95 text-center mt-4",children:"Logout"})]})]})]})},tA=({query:u,onSelect:m,countryCode:v,currentLocation:S})=>{const[M,R]=me.useState(null),[E,l]=me.useState(!1);return me.useEffect(()=>{const Y=setTimeout(async()=>{if(!u||u.length<4)return;l(!0);const ie=async()=>{try{const be=u.indexOf(" ");if(be>3&&u.includes("+")){const he=u.substring(0,be).trim(),te=u.substring(be+1).trim();if(he.includes("+")&&te.length>0){console.log("[Parlens] Plus Code search:",he,"in",te);const qe=await(await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(te)}&format=json&limit=1`)).json();if(qe&&qe.length>0){const lt=parseFloat(qe[0].lat),Pt=parseFloat(qe[0].lon),Et=$C(he,lt,Pt);if(Et)return{place_id:-1,lat:Et.lat.toString(),lon:Et.lon.toString(),display_name:`Plus Code: ${he.toUpperCase()}, ${qe[0].display_name}`,type:"plus_code"}}}}}catch(be){console.error("[Parlens] Plus Code search error:",be)}return null},ne=async()=>{try{let be=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(u)}&format=json&limit=1`;if(v&&(be+=`&countrycodes=${v}`),S){const[ve,qe]=S,lt=`${qe-1},${ve+1},${qe+1},${ve-1}`;be+=`&viewbox=${lt}`}console.log("[Parlens] Nominatim search:",be);const te=await(await fetch(be)).json();return console.log("[Parlens] Nominatim result:",te),te&&te.length>0?te[0]:null}catch(be){return console.error("[Parlens] Nominatim search error:",be),null}},[ze,Ce]=await Promise.all([ie(),ne()]);R(ze||Ce||null),l(!1)},500);return()=>clearTimeout(Y)},[u,v]),E?k.jsxs("div",{className:"mb-2 p-3 text-xs text-zinc-400 dark:text-white/40 italic flex items-center gap-2",children:[k.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-zinc-300 border-t-zinc-600 animate-spin"}),"Searching..."]}):M?k.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-purple-50 dark:bg-purple-500/10 border border-purple-500/20",children:[k.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium text-purple-700 dark:text-purple-400 bg-purple-100/50 dark:bg-purple-500/5",children:[" ",M.type==="plus_code"?"Plus Code Location":"Global Search Result"]}),k.jsxs("button",{onClick:()=>m(M),className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[k.jsx(Hc,{size:16,className:"text-purple-600 dark:text-purple-400 shrink-0"}),k.jsxs("div",{className:"flex-1 truncate",children:[k.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white truncate",children:M.display_name.split(",")[0]}),k.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:M.display_name})]})]})]}):null},nA=({vehicleType:u,onRouteChange:m,currentLocation:v,onDropPinModeChange:S,pendingWaypoints:M,onDropPinConsumed:R,onOpenChange:E,onWaypointsChange:l,onRequestOrientationPermission:O})=>{const{pool:Y,pubkey:ie,signEvent:ne}=Zc(),[ze,Ce]=me.useState(!1);me.useEffect(()=>{E?.(ze)},[ze,E]);const[be,he]=me.useState([]);me.useEffect(()=>{l?.(be)},[be,l]);const[te,ve]=me.useState(""),[qe,lt]=me.useState(!1),[Pt,Et]=me.useState(null),[St,nt]=me.useState(null),[Be,it]=me.useState(!1),$e=me.useRef(null),[we,Qe]=me.useState([]),[ut,Ye]=me.useState(""),[Ie,le]=me.useState(!1),[ke,De]=me.useState(!1),[Fe,bt]=me.useState(!1),[de,He]=me.useState(!1),[_t,It]=me.useState(null),[Ze,Dt]=me.useState(""),[jt,$t]=me.useState(!1),[Ot,ln]=me.useState(null),[dn,rn]=me.useState({}),gt=me.useRef(new Set);me.useEffect(()=>{(async()=>{if(!(!v||Ot))try{const ue=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${v[0]}&lon=${v[1]}&format=json`)).json();ue&&ue.address&&ue.address.country_code&&(console.log("[Parlens] Detected Country:",ue.address.country_code),ln(ue.address.country_code))}catch(K){console.error("[Parlens] Failed to detect country:",K)}})()},[v,Ot]);const xt=p0.useMemo(()=>{if(!te||te.length<2)return[];const $=te.toLowerCase(),K=[];for(const ue of we)for(const ye of ue.decryptedContent.waypoints)ye.name.toLowerCase().includes($)&&(K.find(je=>je.name.toLowerCase()===ye.name.toLowerCase())||K.push({name:ye.name,lat:ye.lat,lon:ye.lon}));return K.slice(0,5)},[te,we]),zt=$=>{const K=be.filter(ue=>ue.id!==$);he(K),Et(null),nt(null),lt(!1),m(null,null,K,!1)},qt=()=>{he([]),Et(null),nt(null),lt(!1),m(null,null,[],!1)},Gt=($,K)=>{if($+K<0||$+K>=be.length)return;const ue=[...be];[ue[$],ue[$+K]]=[ue[$+K],ue[$]],he(ue),Et(null),nt(null),lt(!1),m(null,null,ue,!1)},gn=()=>{const $=[...be].reverse();he($),Et(null),nt(null),lt(!1),m(null,null,$,!1)},Rn=async()=>{if(be.length<2){alert("Add at least 2 waypoints to create a route");return}it(!0);try{const K={bicycle:"bike",motorcycle:"driving",car:"driving"}[u],ue=[],ye=[],je={};for(let Je=0;Je<be.length-1;Je++){const ft=be[Je],Bt=be[Je+1],Wt=`${ft.lon},${ft.lat};${Bt.lon},${Bt.lat}`;console.log(`[Parlens] Fetching segment ${Je+1}: ${ft.name}  ${Bt.name}`);const Jt=await fetch(`https://router.project-osrm.org/route/v1/${K}/${Wt}?overview=full&geometries=geojson&alternatives=true`);if(!Jt.ok)throw new Error(`OSRM error: ${Jt.status}`);const pn=await Jt.json();if(pn.code==="Ok"&&pn.routes&&pn.routes[0]){if(pn.waypoints&&pn.waypoints.length>=2){const Ve=pn.waypoints[0].location,Pn=pn.waypoints[1].location;je[Je]||(je[Je]={lat:Ve[1],lon:Ve[0]}),je[Je+1]={lat:Pn[1],lon:Pn[0]}}const Mn=pn.routes[0].geometry.coordinates.map(Ve=>[Ve[1],Ve[0]]);if(ue.push(Mn),pn.routes.length>1){const Ve=pn.routes[1].geometry.coordinates.map(Pn=>[Pn[1],Pn[0]]);ye.push(Ve),console.log(`[Parlens] Segment ${Je+1} has alternate route`)}else ye.push(Mn),console.log(`[Parlens] Segment ${Je+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${Je+1}`)}const Le=[],Me=[];for(let Je=0;Je<ue.length;Je++){const ft=Je===0?0:1;Le.push(...ue[Je].slice(ft)),Me.push(...ye[Je].slice(ft))}console.log("[Parlens] Combined primary route:",Le.length,"points"),console.log("[Parlens] Combined alternate route:",Me.length,"points"),Et(Le),nt(Me),rn(je),lt(!0);const Oe=Object.keys(je).length===be.length?be.map((Je,ft)=>({...Je,...je[ft]})):be;m(Le,Me,Oe.map(Je=>({lat:Je.lat,lon:Je.lon})),!0),O&&O(),Ce(!1)}catch($){console.error("Route creation error:",$);const K=be.map(ue=>[ue.lat,ue.lon]);Et(K),nt(null),rn({}),lt(!0),m(K,null,be.map(ue=>({lat:ue.lat,lon:ue.lon})),!0),Ce(!1)}finally{it(!1)}},bn=()=>{const $=!qe;lt($);const K=Object.keys(dn).length===be.length?be.map((ue,ye)=>({...ue,...dn[ye]})):be;m(Pt,St,K.map(ue=>({lat:ue.lat,lon:ue.lon})),$)},Zn=me.useCallback(async()=>{if(!(!Y||!ie)){De(!0);try{const $=await Y.querySync(Fn,{kinds:[hn.ROUTE_LOG],authors:[ie]});console.log("[Parlens] Fetched route events:",$.length);const K=localStorage.getItem("parlens_privkey"),ue=K?new Uint8Array(K.match(/.{1,2}/g).map(je=>parseInt(je,16))):void 0,ye=[];for(const je of $){if(je.tags.find(Me=>Me[0]==="deleted"))continue;const Le=je.tags.find(Me=>Me[0]==="d")?.[1]||"";if(!(Le&&gt.current.has(Le))&&je.content)try{const Me=await y1(je.content,ie,ue);if(Me){const Oe=je.tags.find(Je=>Je[0]==="d")?.[1]||"";ye.push({id:je.id,dTag:Oe,decryptedContent:Me,created_at:je.created_at})}}catch(Me){console.warn("[Parlens] Failed to decrypt route:",Me)}}Qe(je=>{const Le=new Map;je.forEach(Oe=>Le.set(Oe.id,Oe)),ye.forEach(Oe=>Le.set(Oe.id,Oe));const Me=Array.from(Le.values()).sort((Oe,Je)=>Je.created_at-Oe.created_at);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Me))}catch(Oe){console.warn("[Parlens] Failed to cache routes:",Oe)}return Me})}catch($){console.error("Error fetching saved routes:",$)}finally{De(!1)}}},[Y,ie]);me.useEffect(()=>{if(ze&&ie){try{const $=localStorage.getItem("parlens_route_cache_v1");if($){const K=JSON.parse($);Qe(K)}}catch($){console.warn("[Parlens] Failed to load cached routes:",$)}Zn()}},[ze,ie,Zn]);const Ln=()=>{const $=!de;He($),S?.($),$&&(Ce(!1),l?.(be))};me.useEffect(()=>{if(M){if(M.length>0){const $=M.map((K,ue)=>({id:crypto.randomUUID(),name:K.name||`Pin ${be.length+ue+1}`,lat:K.lat,lon:K.lon}));he(K=>[...K,...$]),Et(null),nt(null),lt(!1),m(null,null,[...be,...$],!1),rn({})}R?.(),Ce(!0),S?.(!1)}},[M,R,S,m]);const Wi=async()=>{if(!Y||!ie||!ne||!Pt||be.length<2){alert("Please create a route first");return}const $=ut.trim()||`Route ${new Date().toLocaleDateString()}`;le(!0);try{const K=Object.keys(dn).length===be.length?be.map((Jt,pn)=>({name:Jt.name,lat:dn[pn].lat,lon:dn[pn].lon})):be.map(Jt=>({name:Jt.name,lat:Jt.lat,lon:Jt.lon})),ue={name:$,waypoints:K,routeCoords:Pt,alternateRouteCoords:St||void 0,vehicleType:u,created_at:Math.floor(Date.now()/1e3)},ye=localStorage.getItem("parlens_privkey"),je=ye?new Uint8Array(ye.match(/.{1,2}/g).map(Jt=>parseInt(Jt,16))):void 0,Le=await X0(ue,ie,je),Me=`route_${Date.now()}`,Oe={kind:hn.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Me],["client","parlens"]],content:Le},Je=await ne(Oe);console.log("[Parlens] Signed route event:",Je);const ft=await Promise.allSettled(Y.publish(Fn,Je)),Bt=ft.filter(Jt=>Jt.status==="fulfilled").length;console.log("[Parlens] Route published:",Bt,"of",ft.length,"relays"),Bt===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)");const Wt={id:Je.id,dTag:Me,decryptedContent:ue,created_at:Je.created_at};Qe(Jt=>{const pn=[Wt,...Jt];try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(pn))}catch(Mn){console.warn("Cache update failed",Mn)}return pn}),Ye("")}catch(K){console.error("[Parlens] Error saving route:",K),alert("Failed to save route, try again later")}finally{le(!1)}},kn=($,K)=>{he(ue=>ue.map(ye=>ye.id===$?{...ye,name:K}:ye)),It(null),Dt("")},Cn=$=>{It($.id),Dt($.name)},Ue=async $=>{const K=$.decryptedContent,ue=K.waypoints.map(ye=>({id:crypto.randomUUID(),name:ye.name,lat:ye.lat,lon:ye.lon}));he(ue),Et(K.routeCoords),nt(K.alternateRouteCoords||null),rn({}),lt(!0),bt(!1),m(K.routeCoords,K.alternateRouteCoords||null,K.waypoints.map(ye=>({lat:ye.lat,lon:ye.lon})),!0),Ce(!1)},W=async $=>{if(!(!Y||!ie||!ne)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){$t(!0);try{const K={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",$.id],["a",`${hn.ROUTE_LOG}:${ie}:${$.dTag}`]],content:"Deleted by user"},ue=await ne(K);await Promise.allSettled(Y.publish(Fn,ue));const ye={kind:hn.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",$.dTag],["deleted","true"]],content:""},je=await ne(ye);await Promise.allSettled(Y.publish(Fn,je)),gt.current.add($.dTag),Qe(Le=>{const Me=Le.filter(Oe=>Oe.id!==$.id);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Me))}catch(Oe){console.warn("Cache update failed",Oe)}return Me})}catch(K){console.error("Error deleting route:",K),alert("Failed to delete route")}finally{$t(!1)}}};return k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:()=>Ce(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:k.jsx(XM,{size:20})}),ze&&k.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[k.jsx("button",{onClick:()=>Ce(!1),className:"absolute inset-0 z-0 cursor-default"}),jt&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:k.jsxs("div",{className:"flex flex-col items-center gap-3",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),k.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),Ie&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:k.jsxs("div",{className:"flex flex-col items-center gap-3",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),k.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),k.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),k.jsx("button",{onClick:()=>Ce(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:k.jsx(Io,{size:20,className:"text-black/60 dark:text-white/60"})})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Add Waypoint"}),k.jsxs("div",{className:"relative",children:[k.jsx("input",{ref:$e,type:"text",placeholder:"Search waypoint",value:te,onChange:$=>ve($.target.value),className:"w-full h-14 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 pr-12 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500"}),te&&k.jsx("button",{onClick:()=>ve(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 text-zinc-400 dark:text-white/40 active:opacity-50 transition-opacity",children:k.jsx(Io,{size:16})})]}),(()=>{const $=nv(te);return $?k.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-blue-50 dark:bg-blue-500/10 border border-blue-500/20",children:[k.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium text-blue-700 dark:text-blue-400 bg-blue-100/50 dark:bg-blue-500/5",children:[" ",$.type==="plus_code"?"Plus Code Location":"Coordinate"]}),k.jsxs("button",{onClick:()=>{const K={id:crypto.randomUUID(),name:$.type==="plus_code"?`Plus Code: ${te}`:`Loc: ${VC($.lat,$.lon)}`,lat:$.lat,lon:$.lon};he(ue=>[...ue,K]),ve(""),Et(null),nt(null),lt(!1),m(null,null,null,!1),rn({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[k.jsx(Hc,{size:16,className:"text-blue-600 dark:text-blue-400 shrink-0"}),k.jsxs("div",{className:"flex-1 truncate",children:[k.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Add Location"}),k.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/60",children:[$.lat.toFixed(6),", ",$.lon.toFixed(6)]})]})]})]}):null})(),te.length>3&&!nv(te)&&k.jsx(tA,{query:te,countryCode:Ot,currentLocation:v,onSelect:$=>{const K={id:crypto.randomUUID(),name:$.display_name.split(",")[0],lat:parseFloat($.lat),lon:parseFloat($.lon)};he(ue=>[...ue,K]),ve(""),Et(null),nt(null),lt(!1),m(null,null,null,!1),rn({})}}),xt.length>0&&k.jsxs("div",{className:"rounded-2xl overflow-hidden bg-green-50 dark:bg-green-500/10 border border-green-500/20",children:[k.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-500/5",children:" From your saved routes"}),xt.map(($,K)=>k.jsxs("button",{onClick:()=>{const ue={id:crypto.randomUUID(),name:$.name,lat:$.lat,lon:$.lon};he(ye=>[...ye,ue]),ve(""),Et(null),nt(null),lt(!1),m(null,null,null,!1),rn({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left border-b border-green-500/10 last:border-0",children:[k.jsx(Hc,{size:16,className:"text-green-600 dark:text-green-400 shrink-0"}),k.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white/80 truncate",children:$.name})]},`saved-${K}`))]}),v&&k.jsxs("button",{onClick:()=>{const $={id:crypto.randomUUID(),name:"Current Location",lat:v[0],lon:v[1]};he(K=>[...K,$]),Et(null),nt(null),lt(!1),m(null,null,null,!1),rn({})},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors",children:[k.jsx(FM,{size:16,className:"text-blue-500"}),k.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),k.jsxs("button",{onClick:Ln,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 transition-colors",children:[k.jsx(OM,{size:16,className:"text-orange-500"}),k.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),k.jsxs("div",{className:"space-y-2 flex-1",children:[k.jsxs("div",{className:"flex items-center justify-between ml-2 mr-2",children:[k.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Waypoints (",be.length,")"]}),be.length>1&&k.jsx("button",{onClick:gn,className:"p-1 rounded-md transition-colors",title:"Reverse Order",children:k.jsx(yM,{size:14,className:"text-zinc-400 dark:text-white/30"})})]}),be.length===0?k.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):k.jsx("div",{className:"space-y-2",children:be.map(($,K)=>k.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"flex flex-col gap-0.5 -ml-1 mr-1",children:[k.jsx("button",{onClick:()=>Gt(K,-1),disabled:K===0,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(n_,{size:12})}),k.jsx("button",{onClick:()=>Gt(K,1),disabled:K===be.length-1,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(nd,{size:12})})]}),k.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] text-white text-xs font-bold flex items-center justify-center shrink-0",children:K+1}),_t===$.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:Ze,onChange:ue=>Dt(ue.target.value),className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onFocus:ue=>ue.currentTarget.select(),onKeyDown:ue=>{ue.key==="Enter"&&kn($.id,Ze),ue.key==="Escape"&&It(null)}}),k.jsx("button",{onClick:()=>kn($.id,Ze),className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors",children:k.jsx(Xp,{size:16})}),k.jsx("button",{onClick:()=>It(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:k.jsx(Io,{size:16})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:$.name}),k.jsx("button",{onClick:()=>Cn($),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:k.jsx(Wp,{size:14})}),k.jsx("button",{onClick:()=>zt($.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:k.jsx(Mf,{size:16})})]})]},$.id))})]}),Pt&&k.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[qe?k.jsx(zM,{size:20,className:"text-blue-500"}):k.jsx(CM,{size:20,className:"text-zinc-400"}),k.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),k.jsx("button",{onClick:bn,className:`w-14 h-8 rounded-full transition-colors ${qe?"bg-[#007AFF]":"bg-zinc-300 dark:bg-white/20"}`,children:k.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${qe?"translate-x-7":"translate-x-1"}`})})]}),Pt&&ie&&k.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[k.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[k.jsx(KM,{size:14}),"Save Route"]}),k.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[k.jsx("input",{type:"text",value:ut,onChange:$=>Ye($.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),k.jsx("button",{onClick:Wi,disabled:Ie,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:Ie?"...":"Save"})]})]}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:qt,disabled:be.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),k.jsx("button",{onClick:Rn,disabled:be.length<2||Be,className:"flex-1 h-14 rounded-2xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:Be?"Creating...":"Create Route"})]}),!Pt&&be.length>=2&&ie&&k.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),ie&&k.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[k.jsxs("button",{onClick:()=>bt(!Fe),className:"w-full flex items-center justify-between",children:[k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx(PM,{size:18,className:"text-zinc-500 dark:text-white/50"}),k.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Saved Routes (",we.length,")"]})]}),k.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:Fe?"Hide":"Show"})]}),Fe&&k.jsx("div",{className:"space-y-2",children:ke?k.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):we.length===0?k.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):we.map($=>k.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("button",{onClick:()=>Ue($),className:"flex-1 text-left",children:[k.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:$.decryptedContent.name}),k.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[k.jsxs("span",{children:[$.decryptedContent.waypoints.length," stops"]}),k.jsx("span",{children:""}),k.jsx(c1,{size:12}),k.jsx("span",{children:new Date($.created_at*1e3).toLocaleDateString()})]})]}),k.jsx("button",{onClick:()=>W($),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:k.jsx(Mf,{size:16})})]},$.id))})]}),k.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:k.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[k.jsx("strong",{children:"Tip:"})," If place name does not return results, use coordinate or Google Maps plus code in waypoint search. Edit waypoint names to label locations. When you save routes, waypoint names become searchable  building your personal offline map over time! "]})})]})]})]})};function iA(u){return u>=17?8:u>=15?7:u>=13?6:u>=11?5:u>=9?4:3}function rv(u,m,v=!0){if(!v||u.length<2)return u;const S=iA(m),M=new Map;for(const E of u){const l=m>=15?`${E.lat.toFixed(4)},${E.lon.toFixed(4)}`:gg(E.lat,E.lon,S);if(M.has(l)){const O=M.get(l);O.spots.push(E),O.count++,O.minPrice=Math.min(O.minPrice,E.price),O.maxPrice=Math.max(O.maxPrice,E.price),O.lat=O.spots.reduce((Y,ie)=>Y+ie.lat,0)/O.count,O.lon=O.spots.reduce((Y,ie)=>Y+ie.lon,0)/O.count}else M.set(l,{id:`cluster-${l}`,lat:E.lat,lon:E.lon,spots:[E],minPrice:E.price,maxPrice:E.price,currency:E.currency,count:1})}const R=[];for(const E of M.values())E.count===1?R.push(E.spots[0]):R.push(E);return R}function av(u){return"count"in u&&u.count>1}var G_,sv;function rA(){if(sv)return G_;sv=1;for(var u="0123456789bcdefghjkmnpqrstuvwxyz",m={},v=0;v<u.length;v++)m[u.charAt(v)]=v;var S="auto",M=-90,R=90,E=-180,l=180,O=[0,5,7,8,11,12,13,15,16,17,18],Y=function(it,$e,we){if(we===S){if(typeof it=="number"||typeof $e=="number")throw new Error("string notation required for auto precision.");var Qe=it.split(".")[1].length,ut=$e.split(".")[1].length,Ye=Math.max(Qe,ut);we=O[Ye]}else we===void 0&&(we=9);for(var Ie=[],le=0,ke=0,De=0,Fe=R,bt=M,de=l,He=E,_t;Ie.length<we;)if(ke%2===0?(_t=(de+He)/2,$e>_t?(De=(De<<1)+1,He=_t):(De=(De<<1)+0,de=_t)):(_t=(Fe+bt)/2,it>_t?(De=(De<<1)+1,bt=_t):(De=(De<<1)+0,Fe=_t)),le++,ke++,le===5){var It=u[De];Ie.push(It),le=0,De=0}return Ie.join("")},ie=function(it,$e,we){we=we||52;for(var Qe=0,ut=R,Ye=M,Ie=l,le=E,ke,De=0;Qe<we;)De*=2,Qe%2===0?(ke=(Ie+le)/2,$e>ke?(De+=1,le=ke):Ie=ke):(ke=(ut+Ye)/2,it>ke?(De+=1,Ye=ke):ut=ke),Qe++;return De},ne=function(it){for(var $e=!0,we=R,Qe=M,ut=l,Ye=E,Ie,le=0,ke=0,De=it.length;ke<De;ke++){var Fe=it[ke].toLowerCase();le=m[Fe];for(var bt=4;bt>=0;bt--){var de=le>>bt&1;$e?(Ie=(ut+Ye)/2,de===1?Ye=Ie:ut=Ie):(Ie=(we+Qe)/2,de===1?Qe=Ie:we=Ie),$e=!$e}}return[Qe,Ye,we,ut]},ze=function(it,$e){$e=$e||52;for(var we=R,Qe=M,ut=l,Ye=E,Ie=0,le=0,ke=$e/2,De=0;De<ke;De++)le=Ce(it,(ke-De)*2-1),Ie=Ce(it,(ke-De)*2-2),Ie===0?we=(we+Qe)/2:Qe=(we+Qe)/2,le===0?ut=(ut+Ye)/2:Ye=(ut+Ye)/2;return[Qe,Ye,we,ut]};function Ce(it,$e){return it/Math.pow(2,$e)&1}var be=function(it){var $e=ne(it),we=($e[0]+$e[2])/2,Qe=($e[1]+$e[3])/2,ut=$e[2]-we,Ye=$e[3]-Qe;return{latitude:we,longitude:Qe,error:{latitude:ut,longitude:Ye}}},he=function(it,$e){var we=ze(it,$e),Qe=(we[0]+we[2])/2,ut=(we[1]+we[3])/2,Ye=we[2]-Qe,Ie=we[3]-ut;return{latitude:Qe,longitude:ut,error:{latitude:Ye,longitude:Ie}}},te=function(it,$e){var we=be(it),Qe=we.latitude+$e[0]*we.error.latitude*2,ut=we.longitude+$e[1]*we.error.longitude*2;return ut=St(ut),Qe=nt(Qe),Y(Qe,ut,it.length)},ve=function(it,$e,we){we=we||52;var Qe=he(it,we),ut=Qe.latitude+$e[0]*Qe.error.latitude*2,Ye=Qe.longitude+$e[1]*Qe.error.longitude*2;return Ye=St(Ye),ut=nt(ut),ie(ut,Ye,we)},qe=function(it){var $e=it.length,we=be(it),Qe=we.latitude,ut=we.longitude,Ye=we.error.latitude*2,Ie=we.error.longitude*2,le,ke,De=[Fe(1,0),Fe(1,1),Fe(0,1),Fe(-1,1),Fe(-1,0),Fe(-1,-1),Fe(0,-1),Fe(1,-1)];function Fe(bt,de){return le=Qe+bt*Ye,ke=ut+de*Ie,ke=St(ke),le=nt(le),Y(le,ke,$e)}return De},lt=function(it,$e){$e=$e||52;var we=he(it,$e),Qe=we.latitude,ut=we.longitude,Ye=we.error.latitude*2,Ie=we.error.longitude*2,le,ke,De=[Fe(1,0),Fe(1,1),Fe(0,1),Fe(-1,1),Fe(-1,0),Fe(-1,-1),Fe(0,-1),Fe(1,-1)];function Fe(bt,de){return le=Qe+bt*Ye,ke=ut+de*Ie,ke=St(ke),le=nt(le),ie(le,ke,$e)}return De},Pt=function(it,$e,we,Qe,ut){ut=ut||9;for(var Ye=Y(it,$e,ut),Ie=Y(we,Qe,ut),le=be(Ye),ke=le.error.latitude*2,De=le.error.longitude*2,Fe=ne(Ye),bt=ne(Ie),de=Math.round((bt[0]-Fe[0])/ke),He=Math.round((bt[1]-Fe[1])/De),_t=[],It=0;It<=de;It++)for(var Ze=0;Ze<=He;Ze++)_t.push(te(Ye,[It,Ze]));return _t},Et=function(it,$e,we,Qe,ut){ut=ut||52;for(var Ye=ie(it,$e,ut),Ie=ie(we,Qe,ut),le=he(Ye,ut),ke=le.error.latitude*2,De=le.error.longitude*2,Fe=ze(Ye,ut),bt=ze(Ie,ut),de=Math.round((bt[0]-Fe[0])/ke),He=Math.round((bt[1]-Fe[1])/De),_t=[],It=0;It<=de;It++)for(var Ze=0;Ze<=He;Ze++)_t.push(ve(Ye,[It,Ze],ut));return _t};function St(it){return it>l?E+it%l:it<E?l+it%l:it}function nt(it){return it>R?R:it<M?M:it}var Be={ENCODE_AUTO:S,encode:Y,encode_uint64:ie,encode_int:ie,decode:be,decode_int:he,decode_uint64:he,decode_bbox:ne,decode_bbox_uint64:ze,decode_bbox_int:ze,neighbor:te,neighbor_int:ve,neighbors:qe,neighbors_int:lt,bboxes:Pt,bboxes_int:Et};return G_=Be,G_}var aA=rA();const ov=vg(aA);class $_{q;r;x;p;k;initialized=!1;constructor(m=1e-5,v=.001){this.q=m,this.r=v,this.x=0,this.p=1,this.k=0}filter(m){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(m-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=m,this.initialized=!0,m)}reset(){this.initialized=!1,this.x=0,this.p=1}}class sA{latFilter;lonFilter;bearingFilter;hasLastBearing=!1;constructor(){this.latFilter=new $_(1e-5,.002),this.lonFilter=new $_(1e-5,.002),this.bearingFilter=new $_(.005,.8)}cumulativeBearing=0;lastInputBearing=0;smoothLocation(m,v){return[this.latFilter.filter(m),this.lonFilter.filter(v)]}smoothBearing(m,v,S=!1){if(!S&&v<2)return null;const M=(m%360+360)%360;if(!this.hasLastBearing)return this.lastInputBearing=M,this.cumulativeBearing=M,this.hasLastBearing=!0,this.bearingFilter.reset(),this.bearingFilter.filter(M),M;let R=M-this.lastInputBearing;return R>180?R-=360:R<-180&&(R+=360),this.cumulativeBearing+=R,this.lastInputBearing=M,(this.bearingFilter.filter(this.cumulativeBearing)%360+360)%360}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.cumulativeBearing=0,this.lastInputBearing=0,this.hasLastBearing=!1}}class oA{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(m){const v=(m%360+360)%360;if(!this.initialized)return this.currentRotation=v,this.lastRawBearing=v,this.initialized=!0,this.currentRotation;let S=v-this.lastRawBearing;return S>180?S-=360:S<-180&&(S+=360),this.currentRotation+=S,this.lastRawBearing=v,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(m=0){this.currentRotation=m,this.lastRawBearing=(m%360+360)%360,this.initialized=!0}}class lA{startLat=0;startLon=0;targetLat=0;targetLon=0;currentLat=0;currentLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(m){this.onUpdate=m}animateTo(m,v,S=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=m,this.targetLon=v,this.currentLat=m,this.currentLon=v,this.onUpdate&&this.onUpdate(m,v);return}this.startLat=this.currentLat||this.targetLat,this.startLon=this.currentLon||this.targetLon,this.targetLat=m,this.targetLon=v,this.startTime=performance.now(),this.duration=S,this.animate()}animate=()=>{const v=performance.now()-this.startTime,S=Math.min(v/this.duration,1),M=1-Math.pow(1-S,3),R=this.startLat+(this.targetLat-this.startLat)*M,E=this.startLon+(this.targetLon-this.startLon)*M;this.currentLat=R,this.currentLon=E,this.onUpdate&&this.onUpdate(R,E),S<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class cA{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:15,walking:8,vehicle:5,fast_vehicle:3};pollIntervals={stationary:15e3,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1200,walking:800,vehicle:400,fast_vehicle:200};haversineDistance(m,v,S,M){const E=(S-m)*Math.PI/180,l=(M-v)*Math.PI/180,O=Math.sin(E/2)*Math.sin(E/2)+Math.cos(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(O),Math.sqrt(1-O)))}calculateBearing(m,v,S,M){const R=(M-v)*Math.PI/180,E=Math.sin(R)*Math.cos(S*Math.PI/180),l=Math.cos(m*Math.PI/180)*Math.sin(S*Math.PI/180)-Math.sin(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.cos(R);return(Math.atan2(E,l)*180/Math.PI+360)%360}updateLocation(m,v){const S=Date.now();if(!this.initialized)return this.anchorLat=m,this.anchorLon=v,this.displayLat=m,this.displayLon=v,this.lastRawLat=m,this.lastRawLon=v,this.lastUpdateTime=S,this.initialized=!0,{displayLat:m,displayLon:v,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0,bearing:null};const M=this.haversineDistance(this.anchorLat,this.anchorLon,m,v),R=(S-this.lastUpdateTime)/1e3,E=this.haversineDistance(this.lastRawLat,this.lastRawLon,m,v),l=R>0?E/R:0;this.speedHistory.push(l),this.speedHistory.length>5&&this.speedHistory.shift();const O=this.speedHistory.reduce((be,he)=>be+he,0)/this.speedHistory.length;let Y;O<.5?Y="stationary":O<2?Y="walking":O<10?Y="vehicle":Y="fast_vehicle",this.currentSpeedClass=Y;const ie=this.bufferZones[Y];if(E>1){const be=this.calculateBearing(this.lastRawLat,this.lastRawLon,m,v);this.directionChangeBuffer.push(be),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((he,te)=>he+te,0)/this.directionChangeBuffer.length}this.lastRawLat=m,this.lastRawLon=v,this.lastUpdateTime=S;let ne=!1,ze=this.displayLat,Ce=this.displayLon;return M>ie?(this.anchorLat=m,this.anchorLon=v,ze=m,Ce=v,ne=!0):(ze=this.anchorLat,Ce=this.anchorLon,ne=!1),ne&&(this.displayLat=ze,this.displayLon=Ce),{displayLat:this.displayLat,displayLon:this.displayLon,speed:O,speedClass:Y,shouldUpdate:ne,animationDuration:this.animationDurations[Y],bearing:this.predictedBearing}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}lastAccuracy=10;updateLocationWithAccuracy(m,v,S){this.lastAccuracy=S;const M=this.updateLocation(m,v);if(M.speedClass==="stationary"){const R=Math.max(this.bufferZones.stationary,S*1.5);if(this.haversineDistance(this.anchorLat,this.anchorLon,m,v)<=R)return{...M,displayLat:this.displayLat,displayLon:this.displayLon,shouldUpdate:!1,accuracy:S}}return{...M,accuracy:S}}getLastAccuracy(){return this.lastAccuracy}getSpeedHistoryAverage(){return this.speedHistory.length===0?0:this.speedHistory.reduce((m,v)=>m+v,0)/this.speedHistory.length}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}const uA=()=>{const u=me.useRef(null),[m,v]=me.useState(!1),S=me.useCallback(async()=>{if("wakeLock"in navigator)try{const R=await navigator.wakeLock.request("screen");u.current=R,v(!0),R.addEventListener("release",()=>{v(!1),u.current=null}),console.log("[Parlens] Screen Wake Lock acquired")}catch(R){console.warn("[Parlens] Failed to acquire Wake Lock:",R),v(!1)}else console.warn("[Parlens] Wake Lock API not supported")},[]),M=me.useCallback(async()=>{if(u.current)try{await u.current.release(),u.current=null,v(!1),console.log("[Parlens] Screen Wake Lock released")}catch(R){console.warn("[Parlens] Failed to release Wake Lock:",R)}},[]);return me.useEffect(()=>{const R=async()=>{document.visibilityState==="visible"&&m&&await S()};return document.addEventListener("visibilitychange",R),()=>{document.removeEventListener("visibilitychange",R)}},[m,S]),{requestLock:S,releaseLock:M,isLocked:m}};var Ey=new TextDecoder("utf-8");new TextEncoder;var T1=5e3;function hA(u){let{prefix:m,words:v}=$c.decode(u,T1),S=new Uint8Array($c.fromWords(v));switch(m){case"nprofile":{let M=H_(S);if(!M[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(M[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ki(M[0][0]),relays:M[1]?M[1].map(R=>Ey.decode(R)):[]}}}case"nevent":{let M=H_(S);if(!M[0]?.[0])throw new Error("missing TLV 0 for nevent");if(M[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(M[2]&&M[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(M[3]&&M[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ki(M[0][0]),relays:M[1]?M[1].map(R=>Ey.decode(R)):[],author:M[2]?.[0]?Ki(M[2][0]):void 0,kind:M[3]?.[0]?parseInt(Ki(M[3][0]),16):void 0}}}case"naddr":{let M=H_(S);if(!M[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!M[2]?.[0])throw new Error("missing TLV 2 for naddr");if(M[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!M[3]?.[0])throw new Error("missing TLV 3 for naddr");if(M[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ey.decode(M[0][0]),pubkey:Ki(M[2][0]),kind:parseInt(Ki(M[3][0]),16),relays:M[1]?M[1].map(R=>Ey.decode(R)):[]}}}case"nsec":return{type:m,data:S};case"npub":case"note":return{type:m,data:Ki(S)};default:throw new Error(`unknown prefix ${m}`)}}function H_(u){let m={},v=u;for(;v.length>0;){let S=v[0],M=v[1],R=v.slice(2,2+M);if(v=v.slice(2+M),R.length<M)throw new Error(`not enough data to read on TLV ${S}`);m[S]=m[S]||[],m[S].push(R)}return m}function lv(u){return fA("npub",rd(u))}function dA(u,m){let v=$c.toWords(m);return $c.encode(u,v,T1)}function fA(u,m){return dA(u,m)}const pA=({onClose:u,currentLocation:m,countryCode:v,onPickLocation:S,pickedLocation:M})=>{const{pubkey:R,pool:E,signEvent:l}=Zc(),[O,Y]=me.useState("public"),[ie,ne]=me.useState(null),[ze,Ce]=me.useState(!1),[be,he]=me.useState(!0),[te,ve]=me.useState([]),[qe,lt]=me.useState([]),[Pt,Et]=me.useState(new Map),[St,nt]=me.useState(null),[Be,it]=me.useState(null),[$e,we]=me.useState(!1),[Qe,ut]=me.useState("all"),[Ye,Ie]=me.useState(""),[le,ke]=me.useState(new Map),[De,Fe]=me.useState(null),bt=me.useCallback(async()=>{if(E){he(!0);try{const Ze=await E.querySync(Fn,{kinds:[hn.LISTED_PARKING_METADATA],limit:100}),Dt=new Map;Ze.forEach(zt=>{const qt=zt.tags.find(gn=>gn[0]==="d")?.[1];if(!qt||zt.content==="Parlens Relay Check"||qt.startsWith("test-relay-check-"))return;const Gt=`${zt.pubkey}:${qt}`;(!Dt.has(Gt)||Dt.get(Gt).created_at<zt.created_at)&&Dt.set(Gt,zt)});const $t=Array.from(Dt.values()).map(zt=>{const qt=Cn=>zt.tags.find(Ue=>Ue[0]===Cn)?.[1]||"",Gt=Cn=>zt.tags.filter(Ue=>Ue[0]===Cn).map(Ue=>Ue[1]),gn=zt.tags.filter(Cn=>Cn[0]==="p"&&Cn[2]==="admin").map(Cn=>Cn[1]),Rn=zt.tags.filter(Cn=>Cn[0]==="p"&&Cn[2]==="write").map(Cn=>Cn[1]),bn=zt.tags.filter(Cn=>Cn[0]==="p"&&Cn[2]==="read").map(Cn=>Cn[1]),Zn=Gt("relay"),Ln=qt("floor_plan"),Wi=Ln?JSON.parse(Ln):void 0;let kn;try{const Cn=qt("rates");Cn&&(kn=JSON.parse(Cn))}catch{}return{id:zt.id,pubkey:zt.pubkey,d:qt("d"),listing_name:qt("listing_name")||"Unnamed",location:qt("location"),g:qt("g"),floors:qt("floors"),floor_plan:Wi,rates:kn,listing_type:qt("listing_type")||"public",qr_type:qt("qr_type")||"static",status:qt("status")||"open",owners:gn,managers:Rn,members:bn,relays:Zn,local_area:qt("local_area"),city:qt("city"),zipcode:qt("zipcode"),description:zt.content,created_at:zt.created_at,originalEvent:zt}});ve($t);const Ot=$t.map(zt=>`${hn.LISTED_PARKING_METADATA}:${zt.pubkey}:${zt.d}`);if(Ot.length===0){he(!1);return}const ln=await E.querySync(Fn,{kinds:[hn.PARKING_SPOT_LISTING],"#a":Ot});console.log(`[Parlens] Fetched ${ln.length} spots for ${$t.length} listings. aTags queried:`,Ot.length);const dn=ln.map(zt=>{const qt=zt.tags.find(Gt=>Gt[0]==="d")?.[1];return`${hn.PARKING_SPOT_LISTING}:${zt.pubkey}:${qt}`});let rn=[];dn.length>0&&(rn=await E.querySync(Fn,{kinds:[hn.LISTED_SPOT_LOG],"#a":dn}));const gt=new Map;rn.sort((zt,qt)=>qt.created_at-zt.created_at),rn.forEach(zt=>{const qt=zt.tags.find(Gt=>Gt[0]==="a")?.[1];if(qt&&!gt.has(qt)){const Gt=zt.tags.find(gn=>gn[0]==="status")?.[1];gt.set(qt,Gt||"open")}});const xt=new Map;for(const zt of $t){const qt=`${hn.LISTED_PARKING_METADATA}:${zt.pubkey}:${zt.d}`,Gt=ln.filter(Rn=>Rn.tags.find(bn=>bn[0]==="a")?.[1]===qt),gn={car:{open:0,occupied:0,closed:0,total:0,rate:zt.rates?.car?.hourly||0},motorcycle:{open:0,occupied:0,closed:0,total:0,rate:zt.rates?.motorcycle?.hourly||0},bicycle:{open:0,occupied:0,closed:0,total:0,rate:zt.rates?.bicycle?.hourly||0}};for(const Rn of Gt){const bn=Rn.tags.find(kn=>kn[0]==="d")?.[1],Zn=Rn.tags.find(kn=>kn[0]==="type")?.[1]||"car",Ln=`${hn.PARKING_SPOT_LISTING}:${Rn.pubkey}:${bn}`,Wi=gt.get(Ln)||"open";gn[Zn]&&(gn[Zn].total++,Wi==="occupied"?gn[Zn].occupied++:Wi==="closed"?gn[Zn].closed++:gn[Zn].open++)}xt.set(zt.id,gn)}ke(xt)}catch(Ze){console.error("Error fetching listings:",Ze)}finally{he(!1)}}},[E]),de=me.useCallback(async Ze=>{if(E)try{const Dt=`${hn.LISTED_PARKING_METADATA}:${Ze.pubkey}:${Ze.d}`,$t=(await E.querySync(Fn,{kinds:[hn.PARKING_SPOT_LISTING],"#a":[Dt]})).map(gt=>{const xt=zt=>gt.tags.find(qt=>qt[0]===zt)?.[1]||"";return{id:gt.id,pubkey:gt.pubkey,d:xt("d"),a:xt("a"),spot_number:xt("spot_number"),floor:xt("floor"),short_name:xt("short_name"),type:xt("type")||"car",location:xt("location"),g:xt("g"),content:gt.content,rates:Ze.rates?.[xt("type")||"car"]}});$t.sort((gt,xt)=>parseInt(gt.spot_number)-parseInt(xt.spot_number)),lt($t);const Ot=$t.map(gt=>`${hn.PARKING_SPOT_LISTING}:${gt.pubkey}:${gt.d}`),ln=await E.querySync(Fn,{kinds:[hn.LISTED_SPOT_LOG],"#a":Ot}),dn=new Map;ln.forEach(gt=>{const xt=gt.tags.find(zt=>zt[0]==="a")?.[1];(!dn.has(xt)||dn.get(xt).created_at<gt.created_at)&&dn.set(xt,gt)});const rn=new Map;dn.forEach((gt,xt)=>{const zt=$t.find(qt=>`${hn.PARKING_SPOT_LISTING}:${qt.pubkey}:${qt.d}`===xt);if(zt){const qt=Gt=>gt.tags.find(gn=>gn[0]===Gt)?.[1]||"";rn.set(zt.d,{id:gt.id,pubkey:gt.pubkey,a:qt("a"),status:qt("status")||"open",updated_by:qt("updated_by"),authorizer:qt("authorizer"),created_at:gt.created_at})}}),Et(rn)}catch(Dt){console.error("Error fetching spots:",Dt)}},[E]);me.useEffect(()=>{bt()},[bt,O]),me.useEffect(()=>{if(!E)return;let Ze=[];if(qe.length>0)Ze=qe.map($t=>`${hn.PARKING_SPOT_LISTING}:${$t.pubkey}:${$t.d}`);else return;if(Ze.length===0)return;console.log("[Parlens] Subscribing to status updates for",Ze.length,"spots");const Dt=new Map,jt=E.subscribeMany(Fn,[{kinds:[hn.LISTED_SPOT_LOG],"#a":Ze,since:Math.floor(Date.now()/1e3)-3600}],{onevent($t){const Ot=$t.tags.find(rn=>rn[0]==="a")?.[1],ln=$t.tags.find(rn=>rn[0]==="status")?.[1];if(!Ot||!ln)return;const dn=Dt.get(Ot);dn&&dn.created_at>=$t.created_at||(Dt.set(Ot,{status:ln,created_at:$t.created_at}),Et(rn=>{const gt=Ot.split(":").pop();if(!gt)return rn;const xt=new Map(rn),zt=xt.get(gt);return(!zt||zt.created_at<$t.created_at)&&xt.set(gt,{id:$t.id,pubkey:$t.pubkey,a:Ot,status:ln,updated_by:$t.tags.find(qt=>qt[0]==="updated_by")?.[1]||"",authorizer:$t.tags.find(qt=>qt[0]==="authorizer")?.[1]||"",created_at:$t.created_at}),xt}))},oneose(){console.log("[Parlens] Real-time subscription active")}});return()=>{console.log("[Parlens] Closing real-time status subscription"),jt.close()}},[E,te]),me.useEffect(()=>{ie&&de(ie)},[ie,de]);const He=async Ze=>{if(!(!E||!R||!l)&&confirm(`Delete "${Ze.listing_name}" ? This will delete all spots.`)){we(!0);try{const Dt=`${hn.LISTED_PARKING_METADATA}:${Ze.pubkey}:${Ze.d}`,jt=await E.querySync(Fn,{kinds:[hn.PARKING_SPOT_LISTING],"#a":[Dt]});for(const Ot of jt){const ln=Ot.tags.find(dn=>dn[0]==="d")?.[1];if(ln){const dn={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Ot.id],["a",`${hn.PARKING_SPOT_LISTING}:${R}:${ln}`]],content:"Deleted"};await Promise.allSettled(E.publish(Fn,await l(dn)))}}const $t={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Ze.id],["a",`${hn.LISTED_PARKING_METADATA}:${R}:${Ze.d}`]],content:"Deleted"};await Promise.allSettled(E.publish(Fn,await l($t))),ve(Ot=>Ot.filter(ln=>ln.id!==Ze.id)),ne(null)}catch(Dt){console.error(Dt)}finally{we(!1)}}},_t=me.useMemo(()=>{let Ze=te.filter(Dt=>{let jt=!1;if(O==="public"?jt=Dt.listing_type==="public":O==="private"?jt=Dt.listing_type==="private"&&(Dt.members.includes(R)||Dt.owners.includes(R)||Dt.managers.includes(R)):O==="my"&&(jt=Dt.owners.includes(R)||Dt.managers.includes(R)),!jt)return!1;if(Ye){const $t=Ye.toLowerCase();if(!(Dt.listing_name.toLowerCase().includes($t)||Dt.local_area?.toLowerCase().includes($t)||Dt.city?.toLowerCase().includes($t)||Dt.zipcode?.toLowerCase().includes($t)))return!1}return!0});return Ze.sort((Dt,jt)=>{if(m&&Dt.location&&jt.location){const[gt,xt]=Dt.location.split(",").map(Gt=>parseFloat(Gt.trim())),[zt,qt]=jt.location.split(",").map(Gt=>parseFloat(Gt.trim()));if(!isNaN(gt)&&!isNaN(xt)&&!isNaN(zt)&&!isNaN(qt)){const Gt=iv(m[0],m[1],gt,xt),gn=iv(m[0],m[1],zt,qt);if(Math.abs(Gt-gn)>.1)return Gt-gn}}const $t=le.get(Dt.id),Ot=le.get(jt.id),ln=gt=>gt?Qe==="all"?gt.car.open+gt.motorcycle.open+gt.bicycle.open:gt[Qe]?.open||0:0,dn=ln($t),rn=ln(Ot);return dn!==rn?rn-dn:Dt.listing_name.localeCompare(jt.listing_name)}),Ze},[te,O,R,Ye,le,Qe,m]),It=me.useMemo(()=>qe.filter(Ze=>Qe==="all"||Ze.type===Qe),[qe,Qe]);return k.jsxs("div",{className:"fixed inset-0 z-[3000] bg-zinc-50 dark:bg-black flex flex-col transition-colors",children:[$e&&k.jsxs("div",{className:"fixed inset-0 z-[3100] flex items-center justify-center bg-black/50 backdrop-blur-sm flex-col",children:[k.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-white/20 border-t-white rounded-full"}),k.jsx("div",{className:"text-white font-bold mt-4",children:"Deleting..."})]}),k.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-black/5 dark:border-white/10 bg-white dark:bg-[#1c1c1e]",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("button",{onClick:ie?()=>ne(null):u,className:"p-2 rounded-full bg-black/5 dark:bg-white/10",children:k.jsx(Ef,{size:20,className:"text-black/60 dark:text-white/60 rotate-180"})}),k.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 bg-clip-text text-transparent",children:ie?ie.listing_name:"Listed Parking"})]}),!ie&&k.jsxs("button",{onClick:()=>Ce(!0),className:"flex items-center gap-2 p-3 md:px-4 md:py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full text-sm font-bold shadow-lg shadow-blue-500/20 active:scale-95 transition-transform",children:[k.jsx(mg,{size:20}),k.jsx("span",{className:"hidden md:inline",children:"Create Listing"})]})]}),k.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:ie?k.jsxs("div",{className:"flex-1 flex flex-col p-4 bg-zinc-50 dark:bg-black/50 overflow-hidden",children:[k.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2 no-scrollbar",children:k.jsx("div",{className:"w-full flex justify-between items-center gap-2 p-1 bg-zinc-100 dark:bg-white/5 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:["all","bicycle","motorcycle","car"].map(Ze=>k.jsx("button",{onClick:()=>ut(Ze),className:`flex-1 flex items-center justify-center py-2.5 rounded-[1.2rem] text-sm transition-all active:scale-95 ${Qe===Ze?"bg-white dark:bg-white/10 text-zinc-900 dark:text-white font-bold shadow-sm":"text-zinc-400 dark:text-white/40 hover:text-zinc-600 dark:hover:text-white/60"}`,children:Ze==="all"?"All":k.jsx("span",{className:"text-xl",children:Ze==="bicycle"?"":Ze==="motorcycle"?"":""})},Ze))})}),k.jsx("div",{className:"flex-1 overflow-y-auto",children:k.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:It.map(Ze=>{const Dt=Pt.get(Ze.d),jt=Dt?.status==="occupied"?"bg-red-500/10 border-red-500/20 text-red-600 dark:text-red-400":Dt?.status==="closed"?"bg-zinc-500/10 border-zinc-500/20 text-zinc-600 dark:text-zinc-400":"bg-green-500/10 border-green-500/20 text-green-600 dark:text-green-400";return k.jsxs("button",{onClick:()=>nt(Ze),className:`p-3 rounded-2xl border ${jt} text-center active:scale-[0.98] transition-transform`,children:[k.jsx("div",{className:"text-3xl mb-1",children:Ze.type==="car"?"":Ze.type==="motorcycle"?"":""}),k.jsx("p",{className:"font-bold text-sm text-zinc-900 dark:text-white",children:Ze.short_name||`#${Ze.spot_number}`}),Ze.floor&&k.jsx("p",{className:"text-xs opacity-60",children:Ze.floor}),k.jsx("p",{className:"mt-1 text-[10px] font-bold uppercase tracking-wider opacity-80",children:Dt?.status||"Open"})]},Ze.id)})})})]}):k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"flex border-b border-black/5 dark:border-white/10 bg-white dark:bg-[#1c1c1e]",children:["public","private","my"].map(Ze=>k.jsx("button",{onClick:()=>Y(Ze),className:`flex-1 py-3 text-sm font-bold transition-colors ${O===Ze?"text-[#007AFF] border-b-2 border-[#007AFF]":"text-zinc-400"}`,children:Ze==="public"?"Public Listings":Ze==="private"?"Private Listings":"My Listings"},Ze))}),k.jsx("div",{className:"flex flex-col gap-3 px-4 py-2",children:k.jsxs("div",{className:"flex flex-col gap-2",children:[k.jsxs("div",{className:"relative w-full flex items-center gap-2",children:[k.jsxs("div",{className:"relative flex-1",children:[k.jsx(u1,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400",size:16}),k.jsx("input",{value:Ye,onChange:Ze=>Ie(Ze.target.value),placeholder:"Search listing name or location",className:"w-full pl-10 pr-4 py-2.5 bg-zinc-100 dark:bg-white/10 rounded-xl text-sm font-medium text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all placeholder:text-zinc-400 dark:placeholder:text-white/40"})]}),k.jsx("button",{onClick:()=>bt(),className:"p-2.5 bg-zinc-100 dark:bg-white/10 border border-black/5 dark:border-white/10 rounded-xl hover:bg-zinc-200 dark:hover:bg-white/20 active:scale-95 transition-all text-zinc-600 dark:text-white shadow-sm",title:"Refresh Listings",children:k.jsx(HM,{size:20})})]}),k.jsxs("div",{className:"flex items-center gap-4 text-[10px] font-bold uppercase tracking-wider text-zinc-500 justify-start pl-1",children:[k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"Open"]}),k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),"Occupied"]}),k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("div",{className:"w-2 h-2 rounded-full bg-zinc-400"}),"Closed"]})]})]})}),k.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:be?k.jsx("div",{className:"flex justify-center p-8",children:k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"})}):_t.length===0?k.jsx("div",{className:"text-center py-10 text-zinc-400",children:"No listings found"}):_t.map(Ze=>{const Dt=le.get(Ze.id),jt=Ze.status==="closed",$t=jt?{car:{...Dt?.car,open:0},motorcycle:{...Dt?.motorcycle,open:0},bicycle:{...Dt?.bicycle,open:0}}:Dt;return k.jsxs("div",{className:"group relative bg-white dark:bg-[#1c1c1e] rounded-2xl p-4 border border-black/5 dark:border-white/10 shadow-sm transition-all hover:shadow-md active:scale-[0.99] cursor-pointer",onClick:()=>ne(Ze),children:[k.jsxs("div",{className:"flex flex-col items-start mb-3",children:[k.jsx("div",{className:"flex items-center justify-between w-full gap-2 mb-1",children:k.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[k.jsx("h3",{className:"font-bold text-zinc-900 dark:text-white text-lg leading-tight truncate",children:Ze.listing_name}),k.jsx("span",{className:`shrink-0 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider ${Ze.listing_type==="public"?"bg-green-500/10 text-green-600":"bg-purple-500/10 text-purple-600"}`,children:Ze.listing_type}),jt&&k.jsx("span",{className:"shrink-0 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider bg-zinc-500/10 text-zinc-500 dark:text-zinc-400",children:"CLOSED"})]})}),k.jsxs("div",{className:"absolute top-4 right-4 flex gap-1",children:[k.jsx("button",{onClick:Ot=>{Ot.stopPropagation(),Fe(Ze)},className:"p-1.5 text-zinc-400 hover:text-blue-500 active:opacity-50 transition-colors",children:k.jsx(lC,{size:18})}),O==="my"&&(Ze.owners.includes(R)||Ze.managers.includes(R))&&k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:Ot=>{Ot.stopPropagation(),it(Ze),Ce(!0)},className:"p-1.5 text-zinc-400 hover:text-zinc-600 dark:hover:text-white active:opacity-50 transition-colors",children:k.jsx(Wp,{size:18})}),k.jsx("button",{onClick:Ot=>{Ot.stopPropagation(),He(Ze)},className:"p-1.5 text-zinc-400 hover:text-red-500 active:opacity-50 transition-colors",children:k.jsx(Mf,{size:18})})]})]}),k.jsxs("p",{className:"text-xs text-zinc-500 dark:text-white/40 flex items-center gap-1",children:[k.jsx(Hc,{size:12})," ",Ze.location||"No location"]}),Ze.description&&k.jsx("p",{className:"text-xs text-zinc-500 dark:text-white/60 mt-1 line-clamp-2",children:Ze.description})]}),k.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{type:"car",icon:"",data:$t?.car,rate:Ze.rates?.car},{type:"motorcycle",icon:"",data:$t?.motorcycle,rate:Ze.rates?.motorcycle},{type:"bicycle",icon:"",data:$t?.bicycle,rate:Ze.rates?.bicycle}].map(Ot=>{const ln=(Ot.data?.total||0)>0,dn=Ot.rate||{hourly:0,currency:"INR"},rn=!!Ot.rate||ln&&Ze.listing_type==="public";return k.jsxs("div",{className:`bg-zinc-50 dark:bg-white/10 rounded-xl p-2 text-center flex flex-col items-center justify-center min-h-[80px] ${jt?"opacity-50":""}`,children:[k.jsx("div",{className:"text-3xl mb-1",children:Ot.icon}),ln?k.jsxs("div",{className:"flex flex-col items-center w-full",children:[k.jsxs("div",{className:"font-bold text-sm flex items-center gap-1.5 mb-1.5",children:[k.jsx("span",{className:"text-green-500",children:Ot.data?.open||0}),k.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),k.jsx("span",{className:"text-red-500",children:Ot.data?.occupied||0}),k.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),k.jsx("span",{className:"text-zinc-400",children:Ot.data?.closed||0})]}),rn&&k.jsx("div",{className:"w-full bg-black/5 dark:bg-white/5 rounded-lg py-0.5 px-2",children:k.jsxs("div",{className:"text-zinc-900 dark:text-white font-bold text-sm",children:[dn.currency==="USD"?"$":dn.currency==="EUR"?"":dn.currency==="GBP"?"":"",dn.hourly,k.jsx("span",{className:"text-[10px] font-normal opacity-60",children:"/hr"})]})})]}):k.jsx("div",{className:"text-xs text-zinc-400 dark:text-white/30 font-medium",children:"Not Available"})]},Ot.type)})}),O==="my"&&(Ze.owners.includes(R)||Ze.managers.includes(R))&&k.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5 dark:border-white/5 flex items-center justify-between",onClick:Ot=>Ot.stopPropagation(),children:[k.jsx("span",{className:`text-sm font-semibold ${jt?"text-zinc-500 dark:text-white/50":"text-green-600 dark:text-green-400"}`,children:jt?"Listing Closed":"Listing Open"}),k.jsx("button",{onClick:async()=>{const Ot=jt?"open":"closed";if(!confirm(Ot==="closed"?"This will mark ALL spots as CLOSED. Continue?":"This will mark ALL spots as OPEN. Continue?"))return;ve(rn=>rn.map(gt=>gt.id===Ze.id?{...gt,status:Ot}:gt));const dn=le.get(Ze.id);if(dn){const rn={...dn};["car","motorcycle","bicycle"].forEach(gt=>{const xt=rn[gt].total;Ot==="closed"?rn[gt]={...rn[gt],open:0,occupied:0,closed:xt}:rn[gt]={...rn[gt],open:xt,occupied:0,closed:0}}),ke(gt=>new Map(gt).set(Ze.id,rn))}try{const rn=`${hn.LISTED_PARKING_METADATA}:${Ze.pubkey}:${Ze.d}`,gt=await E.querySync(Fn,{kinds:[hn.PARKING_SPOT_LISTING],"#a":[rn]});for(const qt of gt){const Gt=qt.tags.find(Zn=>Zn[0]==="d")?.[1],gn=`${hn.PARKING_SPOT_LISTING}:${qt.pubkey}:${Gt}`,Rn={kind:hn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["a",gn],["status",Ot],["updated_by",R],["client","parlens"]],content:""},bn=await l(Rn);await Promise.allSettled(E.publish(Fn,bn))}const xt={...Ze.originalEvent,created_at:Math.floor(Date.now()/1e3),tags:[...Ze.originalEvent.tags.filter(qt=>qt[0]!=="status"),["status",Ot]]},zt=await l(xt);await Promise.allSettled(E.publish(Fn,zt))}catch{ve(gt=>gt.map(xt=>xt.id===Ze.id?{...xt,status:jt?"closed":"open"}:xt)),alert("Failed to update status")}},className:`relative h-7 w-12 rounded-full transition-colors ${jt?"bg-zinc-200 dark:bg-white/10":"bg-green-500"}`,children:k.jsx("span",{className:`block h-5 w-5 rounded-full bg-white shadow-sm transition-transform ${jt?"translate-x-[4px]":"translate-x-[26px]"}`})})]})]},Ze.id)})})]})}),ze&&k.jsx(mA,{editing:Be,currentLocation:m,countryCode:v,onPickLocation:S,pickedLocation:M,onClose:()=>{Ce(!1),it(null)},onCreated:()=>{Ce(!1),it(null),bt()}}),St&&ie&&k.jsx(gA,{spot:St,listing:ie,status:Pt.get(St.d),isManager:ie.owners.includes(R)||ie.managers.includes(R),onClose:()=>nt(null),onStatusChange:()=>de(ie)}),De&&k.jsx(yA,{listing:De,onClose:()=>Fe(null)})]})},mA=({editing:u,onClose:m,onCreated:v,currentLocation:S,countryCode:M,onPickLocation:R,pickedLocation:E})=>{const{pubkey:l,signEvent:O,pool:Y}=Zc(),[ie,ne]=me.useState(1),[ze,Ce]=me.useState(!1),[be,he]=me.useState(!1),te=me.useMemo(()=>u?.floor_plan?u.floor_plan:[],[u]),[ve,qe]=me.useState({listing_name:u?.listing_name||"",description:u?.description||"",location:u?.location||"",local_area:u?.local_area||"",city:u?.city||"",zipcode:u?.zipcode||"",country:u?.country||"",listing_type:u?.listing_type||"public",qr_type:u?.qr_type||"static",owners:u?.owners?.join(", ")||"",managers:u?.managers?.join(", ")||"",members:u?.members?.join(", ")||"",relays:u?.relays?.join(", ")||"",currency:"USD"}),[lt,Pt]=me.useState(te),[Et,St]=me.useState({name:"",counts:{car:0,motorcycle:0,bicycle:0},rates:{car:0,motorcycle:0,bicycle:0}});me.useEffect(()=>{if(!u&&M){const we={US:"USD",GB:"GBP",EU:"EUR",IN:"INR"};qe(Qe=>({...Qe,currency:we[M]||"USD"}))}else u?.rates?.car?.currency&&qe(we=>({...we,currency:u.rates.car.currency}))},[M,u]),me.useEffect(()=>{E&&(qe(we=>({...we,location:`${E.lat.toFixed(6)}, ${E.lon.toFixed(6)} `})),_1(E.lat,E.lon).then(we=>{we&&we!==ve.currency&&qe(Qe=>({...Qe,currency:we}))}))},[E]),me.useEffect(()=>{const we=document.getElementById("create-listing-content");we&&we.scrollTo({top:0,behavior:"smooth"})},[ie]);const nt=we=>{if(!we)return null;const Qe=we.split(",").map(ut=>ut.trim()).filter(Boolean);return Qe.length===0?null:k.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Qe.map((ut,Ye)=>k.jsx("span",{className:"px-2 py-1 bg-zinc-200 dark:bg-white/10 rounded-lg text-[10px] font-mono text-zinc-600 dark:text-zinc-400 flex items-center gap-1 max-w-full",children:k.jsx("span",{className:"truncate max-w-[150px]",children:ut})},Ye))})},Be=()=>{Et.name&&(Pt([...lt,{...Et,id:crypto.randomUUID()}]),St(we=>({...we,name:"",counts:{car:0,motorcycle:0,bicycle:0}})))},it=we=>{Pt(lt.filter((Qe,ut)=>ut!==we))},$e=async()=>{if(!ve.listing_name)return;let we=[...lt];if(Et.name&&(Et.counts.car>0||Et.counts.motorcycle>0||Et.counts.bicycle>0)&&be&&(console.log("[Parlens] Auto-adding pending floor from open form:",Et.name),we.push({...Et,id:crypto.randomUUID()})),we.length===0){alert("Please add at least one floor with parking spots.");return}let Qe="";if(ve.location){const[De,Fe]=ve.location.split(",").map(bt=>parseFloat(bt.trim()));!isNaN(De)&&!isNaN(Fe)&&(Qe=gg(De,Fe,10))}const ut=(u?.d||crypto.randomUUID()).trim();console.log("[Parlens] Submitting Listing ID:",ut);const Ye=De=>De.split(",").map(Fe=>Fe.trim()).filter(Boolean).map(Fe=>{if(Fe.startsWith("npub"))try{const{data:bt}=hA(Fe);return bt}catch{return console.error("Invalid npub:",Fe),Fe}return Fe});let Ie=0;const le={};we.forEach(De=>{Ie+=(De.counts.car||0)+(De.counts.motorcycle||0)+(De.counts.bicycle||0),!le.car&&De.rates.car&&(le.car={hourly:De.rates.car,currency:ve.currency}),!le.motorcycle&&De.rates.motorcycle&&(le.motorcycle={hourly:De.rates.motorcycle,currency:ve.currency}),!le.bicycle&&De.rates.bicycle&&(le.bicycle={hourly:De.rates.bicycle,currency:ve.currency})});const ke={kind:hn.LISTED_PARKING_METADATA,created_at:Math.floor(Date.now()/1e3),tags:[["d",ut],["listing_name",ve.listing_name],["location",ve.location],["g",Qe],["local_area",ve.local_area||""],["city",ve.city||""],["zipcode",ve.zipcode||""],["country",ve.country||""],["floors",we.map(De=>De.name).join(", ")],["floor_plan",JSON.stringify(we)],["total_spots",String(Ie+(u&&!u.floor_plan&&u.total_spots||0))],["rates",JSON.stringify(le)],["listing_type",ve.listing_type],["qr_type",ve.qr_type],["client","parlens"],...Ye(ve.owners).map(De=>["p",De,"admin"]),...Ye(ve.managers).map(De=>["p",De,"write"]),...Ye(ve.members).map(De=>["p",De,"read"]),...Ye(ve.relays).map(De=>["relay",De])],content:ve.description};ke.tags.find(De=>De[0]==="p"&&De[1]===l&&De[2]==="admin")||ke.tags.push(["p",l,"admin"]),Ce(!0);try{if(await Promise.allSettled(Y.publish(Fn,await O(ke))),!u){console.log("[Parlens] Creating spots for floors:",we.length);let De=1;for(const Fe of we)for(const[bt,de]of Object.entries(Fe.counts)){console.log(`[Parlens] Floor ${Fe.name} Type ${bt} Count ${de}`);for(let He=0;He<de;He++){const _t=`${ut}-spot-${De}`,It=`${hn.LISTED_PARKING_METADATA}:${l}:${ut}`,Ze={kind:hn.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:[["d",_t],["a",It],["spot_number",String(De)],["floor",Fe.name],["type",bt],["location",ve.location],["g",Qe],["client","parlens"]],content:`${ve.listing_name} #${De}`};await Promise.allSettled(Y.publish(Fn,await O(Ze))),De++}}}v()}catch(De){console.error("Failed to save listing:",De),alert("Failed to save listing. Please try again.")}finally{Ce(!1)}};return k.jsx("div",{className:"fixed inset-0 z-[4000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:k.jsxs("div",{id:"create-listing-content",className:"w-full max-w-lg bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 shadow-2xl overflow-y-auto max-h-[90vh]",children:[ze&&k.jsxs("div",{className:"absolute inset-0 z-50 bg-white/50 dark:bg-black/50 backdrop-blur-[2px] flex flex-col items-center justify-center rounded-3xl",children:[k.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),k.jsx("div",{className:"text-zinc-900 dark:text-white font-bold animate-pulse",children:"Saving Listing..."})]}),k.jsxs("div",{className:"flex justify-between items-center mb-6",children:[k.jsx("h2",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:u?"Edit Listing":"Create Listing"}),k.jsx("button",{onClick:m,children:k.jsx(Io,{className:"text-zinc-500 dark:text-white"})})]}),ie===1?k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Listing Name"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",value:ve.listing_name,onChange:we=>qe({...ve,listing_name:we.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Description"}),k.jsx("textarea",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",rows:3,value:ve.description,onChange:we=>qe({...ve,description:we.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Location"}),k.jsxs("div",{className:"flex gap-2",children:[k.jsx("input",{className:"flex-1 p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"lat, lon",value:ve.location,onChange:we=>qe({...ve,location:we.target.value})}),k.jsx("button",{onClick:S?()=>qe({...ve,location:`${S[0].toFixed(6)}, ${S[1].toFixed(6)}`}):void 0,className:"p-3 bg-blue-500/10 text-blue-500 rounded-xl",children:k.jsx(RM,{size:20})}),R&&k.jsx("button",{onClick:R,className:"p-3 bg-orange-500/10 text-orange-600 dark:text-orange-400 border border-orange-500/20 rounded-xl",children:k.jsx(Hc,{size:20})})]})]}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Local Area"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. Indiranagar",value:ve.local_area,onChange:we=>qe({...ve,local_area:we.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"City"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. Bangalore",value:ve.city,onChange:we=>qe({...ve,city:we.target.value})})]})]}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Zipcode"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. 560038",value:ve.zipcode,onChange:we=>qe({...ve,zipcode:we.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Country"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. India",value:ve.country,onChange:we=>qe({...ve,country:we.target.value})})]})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Access Type"}),k.jsx("div",{className:"flex gap-2",children:k.jsxs("div",{className:"flex gap-2",children:[k.jsx("button",{onClick:()=>qe({...ve,listing_type:"public"}),className:`flex-1 p-3 rounded-xl font-bold transition-colors ${ve.listing_type==="public"?"bg-green-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white hover:bg-zinc-200 dark:hover:bg-white/10"}`,children:"Public"}),k.jsx("button",{onClick:()=>qe({...ve,listing_type:"private"}),className:`flex-1 p-3 rounded-xl font-bold transition-colors ${ve.listing_type==="private"?"bg-purple-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white hover:bg-zinc-200 dark:hover:bg-white/10"}`,children:"Private"})]})})]}),k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl space-y-2",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400",children:"QR Code Type"}),k.jsxs("div",{className:"flex gap-4",children:[k.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[k.jsx("input",{type:"radio",checked:ve.qr_type==="static",onChange:()=>qe({...ve,qr_type:"static"})})," Static (Standard)"]}),k.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[k.jsx("input",{type:"radio",checked:ve.qr_type==="dynamic",onChange:()=>qe({...ve,qr_type:"dynamic"})})," Dynamic (Rotating)"]})]})]}),ve.listing_type==="private"&&k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Members"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys (comma separated)",value:ve.members,onChange:we=>qe({...ve,members:we.target.value})}),nt(ve.members)]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Relays"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"URLs (comma separated)",value:ve.relays,onChange:we=>qe({...ve,relays:we.target.value})})]})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Owners"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Additional Pubkeys",value:ve.owners,onChange:we=>qe({...ve,owners:we.target.value})}),nt(ve.owners)]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Managers"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys",value:ve.managers,onChange:we=>qe({...ve,managers:we.target.value})}),nt(ve.managers)]})]}),k.jsxs("button",{onClick:()=>ne(2),className:"w-full py-3 bg-[#007AFF] text-white rounded-xl font-bold flex items-center justify-center gap-2",children:["Next ",k.jsx(Ef,{size:16})]})]}):k.jsxs("div",{className:"space-y-6",children:[k.jsxs("div",{className:"flex justify-between items-center",children:[k.jsx("h3",{className:"font-bold dark:text-white",children:"Floors & Spots"}),k.jsxs("select",{className:"p-2 bg-zinc-100 dark:bg-white/5 rounded-lg text-zinc-900 dark:text-white text-sm",value:ve.currency,onChange:we=>qe({...ve,currency:we.target.value}),children:[k.jsx("option",{value:"USD",children:"USD ($)"}),k.jsx("option",{value:"EUR",children:"EUR ()"}),k.jsx("option",{value:"GBP",children:"GBP ()"}),k.jsx("option",{value:"INR",children:"INR ()"})]})]}),k.jsx("div",{className:"space-y-3",children:lt.map((we,Qe)=>k.jsxs("div",{className:"p-3 bg-zinc-50 dark:bg-white/5 rounded-xl flex justify-between items-center",children:[k.jsxs("div",{children:[k.jsx("div",{className:"font-bold dark:text-white",children:we.name}),k.jsxs("div",{className:"text-xs text-zinc-500",children:[we.counts.car>0&&` ${we.counts.car} `,we.counts.motorcycle>0&&` ${we.counts.motorcycle} `,we.counts.bicycle>0&&` ${we.counts.bicycle} `]})]}),k.jsx("button",{onClick:()=>it(Qe),className:"p-2 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-full",children:k.jsx(Mf,{size:14})})]},Qe))}),be?k.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl space-y-4",children:[k.jsx("h4",{className:"font-bold text-sm dark:text-white",children:"New Floor Details"}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Floor Name"}),k.jsx("input",{className:"w-full p-2 bg-white dark:bg-white/5 rounded-lg text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"e.g. B1, Ground",value:Et.name,onChange:we=>St({...Et,name:we.target.value})})]}),["car","motorcycle","bicycle"].map(we=>k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("span",{className:"text-2xl w-8",children:we==="car"?"":we==="motorcycle"?"":""}),k.jsxs("div",{className:"flex-1",children:[k.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Spots"}),k.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Et.counts[we]||"",onChange:Qe=>St(ut=>({...ut,counts:{...ut.counts,[we]:parseInt(Qe.target.value)||0}}))})]}),k.jsxs("div",{className:"flex-1",children:[k.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Rate"}),k.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Et.rates[we]||"",onChange:Qe=>St(ut=>({...ut,rates:{...ut.rates,[we]:parseFloat(Qe.target.value)||0}}))})]})]},we)),k.jsxs("div",{className:"flex gap-2",children:[k.jsx("button",{onClick:()=>he(!1),className:"flex-1 py-2 bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 rounded-xl font-bold text-sm",children:"Cancel"}),k.jsx("button",{onClick:()=>{Be(),he(!1)},className:"flex-1 py-2 bg-blue-500 text-white rounded-xl font-bold text-sm",children:"Save Floor"})]})]}):k.jsxs("button",{onClick:()=>he(!0),className:"w-full py-3 bg-zinc-100 dark:bg-white/5 border-2 border-dashed border-zinc-300 dark:border-zinc-700 text-zinc-500 dark:text-zinc-400 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-zinc-200 dark:hover:bg-white/10 transition-colors",children:[k.jsx(mg,{size:18})," Add Another Floor"]}),k.jsxs("div",{className:"flex gap-2 pt-2",children:[k.jsx("button",{onClick:()=>ne(1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Back"}),k.jsx("button",{onClick:$e,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save Listing"})]})]})]})})},gA=({spot:u,listing:m,status:v,onClose:S,isManager:M,onStatusChange:R})=>{const{pubkey:E,signEvent:l,pool:O}=Zc(),Y=`${hn.PARKING_SPOT_LISTING}:${u.pubkey}:${u.d} `,ie=JSON.stringify({a:Y,authorizer:m.owners?.[0]||E,auth:`static - ${u.d} `}),[ne,ze]=me.useState(!1),[Ce,be]=me.useState(!1),[he,te]=me.useState({short_name:u.short_name||"",type:u.type,rate:u.rates?.hourly||0}),[ve,qe]=me.useState([]),[lt,Pt]=me.useState(new Map),[Et,St]=me.useState(!0),[nt,Be]=me.useState(""),[it,$e]=me.useState(!1);me.useEffect(()=>{M&&(async()=>{if(O)try{const Ie=await O.querySync(Fn,{kinds:[hn.LISTED_SPOT_LOG,hn.PRIVATE_LOG_NOTE],"#a":[Y],limit:50}),le=Ie.filter(Fe=>Fe.kind===hn.LISTED_SPOT_LOG).sort((Fe,bt)=>bt.created_at-Fe.created_at),ke=Ie.filter(Fe=>Fe.kind===hn.PRIVATE_LOG_NOTE),De=new Map;ke.forEach(Fe=>{const bt=Fe.tags.find(de=>de[0]==="e")?.[1];if(bt){const de=De.get(bt)||[];de.push(Fe),De.set(bt,de)}}),qe(le),Pt(De)}catch(Ie){console.error("Failed to fetch spot history:",Ie)}finally{St(!1)}})()},[O,Y,M]);const we=async Ye=>{const Ie=JSON.stringify({status:Ye,hourly_rate:u.rates?.hourly||0,currency:u.rates?.currency||"USD",type:u.type||"car",updated_at:Math.floor(Date.now()/1e3)}),le=[["a",Y],["status",Ye],["updated_by",E],["client","parlens"]];u.location&&le.push(["location",u.location]),u.g&&le.push(["g",u.g]),u.type&&le.push(["type",u.type]);const ke={kind:hn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:le,content:Ie},De=await l(ke);await Promise.allSettled(O.publish(Fn,De)),qe(Fe=>[De,...Fe]),R()},Qe=async(Ye,Ie)=>{const le=Ie||nt;if(!le.trim())return;const ke=Ye||ve[0]?.id;if(!ke){alert("No activity log found to attach note to.");return}const De={kind:hn.PRIVATE_LOG_NOTE,created_at:Math.floor(Date.now()/1e3),tags:[["e",ke],["a",Y],["p",E],["client","parlens"]],content:le};try{const Fe=await l(De);await Promise.allSettled(O.publish(Fn,Fe)),Ie||Be(""),Pt(bt=>{const de=new Map(bt),He=de.get(ke)||[];return de.set(ke,[...He,Fe]),de})}catch{alert("Failed to add note")}},ut=async()=>{const Ye=[["d",u.d],["a",u.a],["spot_number",u.spot_number],["floor",u.floor||""],["type",he.type],["short_name",he.short_name],["location",u.location],["g",u.g],["client","parlens"]];he.rate;const Ie={kind:hn.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:Ye,content:he.short_name||`${m.listing_name} #${u.spot_number} `};await Promise.allSettled(O.publish(Fn,await l(Ie))),R(),be(!1)};return Ce?k.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:S,children:k.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative",onClick:Ye=>Ye.stopPropagation(),children:[k.jsx("button",{onClick:()=>be(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:k.jsx(Io,{size:20})}),k.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Edit Spot"}),k.jsxs("div",{className:"space-y-2 text-left",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Name / Short Code"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white",value:he.short_name,onChange:Ye=>te({...he,short_name:Ye.target.value}),placeholder:`#${u.spot_number} `}),k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Type"}),k.jsxs("select",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white",value:he.type,onChange:Ye=>te({...he,type:Ye.target.value}),children:[k.jsx("option",{value:"car",children:"Car"}),k.jsx("option",{value:"motorcycle",children:"Motorcycle"}),k.jsx("option",{value:"bicycle",children:"Bicycle"})]})]}),k.jsxs("div",{className:"flex gap-2",children:[k.jsx("button",{onClick:()=>be(!1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Cancel"}),k.jsx("button",{onClick:ut,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save"})]})]})}):k.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:S,children:k.jsx("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative max-h-[85vh] overflow-y-auto min-h-[400px]",onClick:Ye=>Ye.stopPropagation(),children:it?k.jsxs("div",{className:"flex flex-col h-full space-y-4 animate-in fade-in slide-in-from-right-4",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("button",{onClick:()=>$e(!1),className:"p-2 -ml-2 rounded-full text-zinc-600 dark:text-white hover:bg-black/5 dark:hover:bg-white/10",children:k.jsx(o1,{size:24})}),k.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Status Log"}),k.jsx("div",{className:"w-10"})," "]}),k.jsxs("div",{className:"flex gap-2",children:[k.jsx("input",{value:nt,onChange:Ye=>Be(Ye.target.value),placeholder:"Add note to latest log...",className:"flex-1 p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white text-sm placeholder:text-zinc-500"}),k.jsx("button",{onClick:()=>Qe(),disabled:!nt.trim(),className:"px-4 py-3 bg-blue-500 text-white font-bold rounded-xl disabled:opacity-50",children:k.jsx(mg,{size:20})})]}),k.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 min-h-[300px]",children:Et?k.jsx("div",{className:"text-center text-zinc-400 py-8",children:"Loading logs..."}):ve.length===0?k.jsxs("div",{className:"text-center text-zinc-400 py-8 flex flex-col items-center gap-2",children:[k.jsx("div",{className:"text-4xl opacity-20",children:""}),k.jsx("p",{children:"No activity yet"})]}):ve.map((Ye,Ie)=>{const le=Ye.tags?.find(de=>de[0]==="status")?.[1],ke=Ye.tags?.find(de=>de[0]==="updated_by")?.[1],De=Ye.tags?.find(de=>de[0]==="authorizer")?.[1],Fe=new Date(Ye.created_at*1e3),bt=lt.get(Ye.id)||[];return k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"flex items-center justify-between mb-2",children:[k.jsxs("div",{className:`font - bold capitalize flex items - center gap - 2 ${le==="open"?"text-green-500":le==="occupied"?"text-red-500":"text-zinc-500"} `,children:[k.jsx("div",{className:`w - 2 h - 2 rounded - full ${le==="open"?"bg-green-500":le==="occupied"?"bg-red-500":"bg-zinc-500"} `}),le||"unknown"]}),k.jsxs("div",{className:"text-xs text-zinc-400 font-medium tabular-nums",children:[Fe.toLocaleDateString(void 0,{month:"short",day:"numeric"}),"  ",Fe.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})]})]}),k.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/40 flex flex-col gap-1",children:[k.jsxs("div",{children:["By: ",ke?ke===E?"You":`${ke.slice(0,8)}...`:"Unknown"]}),De&&k.jsxs("div",{children:["Auth: ",De.slice(0,8),"..."]})]}),k.jsx("div",{className:"flex justify-end mt-1",children:k.jsx("button",{onClick:()=>{const de=document.getElementById(`note-input-${Ye.id}`);de&&de.focus()},className:"text-[10px] text-[#007AFF] font-bold uppercase tracking-wider hover:underline",children:"+ Add Note"})}),k.jsx("div",{className:"mt-2 flex gap-2",children:k.jsx("input",{id:`note-input-${Ye.id}`,placeholder:"Add private note...",className:"flex-1 p-2 bg-zinc-100 dark:bg-white/10 rounded-lg text-xs text-zinc-900 dark:text-white border-none focus:ring-1 focus:ring-blue-500 placeholder:text-zinc-500",onKeyDown:de=>{de.key==="Enter"&&(Qe(Ye.id,de.target.value),de.target.value="")}})}),bt.length>0&&k.jsx("div",{className:"mt-3 space-y-2 pt-3 border-t border-black/5 dark:border-white/5",children:bt.map(de=>k.jsx("div",{className:"text-xs bg-yellow-50 dark:bg-yellow-900/10 p-2 rounded-lg text-zinc-700 dark:text-yellow-100/80",children:de.content},de.id))})]},Ye.id||Ie)})})]}):k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:S,className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:k.jsx(Io,{size:20})}),k.jsx("h2",{className:"text-xl font-bold dark:text-white pr-8 text-left",children:u.short_name||u.content}),M&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"p-8 bg-white dark:bg-white rounded-3xl flex justify-center shadow-sm border border-black/5",children:k.jsx(zy,{size:160,className:"text-black"})}),k.jsxs("div",{onClick:()=>{navigator.clipboard.writeText(ie),ze(!0),setTimeout(()=>ze(!1),2e3)},className:"flex justify-center items-center gap-2 text-[#007AFF] font-bold cursor-pointer py-2 hover:opacity-80 transition-opacity",children:[ne?k.jsx(Xp,{size:18}):k.jsx(Z0,{size:18})," ",ne?"Copied":"Copy Auth Code"]})]}),k.jsxs("div",{className:"grid grid-cols-2 gap-3 text-left",children:[k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Rate"}),k.jsxs("div",{className:"text-lg font-bold dark:text-white tabular-nums",children:[u.rates?.currency||m.rates?.car?.currency||"$",u.rates?.hourly||m.rates?.[u.type]?.hourly,"/hr"]})]}),k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Status"}),(()=>{const Ie=(ve.length>0?ve[0].tags.find(le=>le[0]==="status")?.[1]:null)||v?.status||"open";return k.jsx("div",{className:`text-lg font-bold capitalize ${Ie==="occupied"?"text-red-500":Ie==="closed"?"text-zinc-500":"text-green-500"}`,children:Ie})})()]})]}),k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left space-y-2",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Latest Note"}),(()=>{let Ye=null,Ie=0;return lt.forEach(le=>{le.forEach(ke=>{ke.created_at>Ie&&(Ye=ke,Ie=ke.created_at)})}),Ye?k.jsxs("div",{className:"text-sm dark:text-white italic",children:['"',Ye.content,'" ',k.jsxs("span",{className:"text-xs text-zinc-400 not-italic",children:["- ",new Date(Ye.created_at*1e3).toLocaleDateString()]})]}):k.jsx("div",{className:"text-sm text-zinc-400 italic",children:"No notes added yet"})})(),k.jsxs("div",{className:"flex gap-2 pt-2",children:[k.jsx("input",{value:nt,onChange:Ye=>Be(Ye.target.value),placeholder:"Add visible note...",className:"flex-1 p-2.5 bg-white dark:bg-white/10 rounded-xl text-sm text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-zinc-400",onKeyDown:Ye=>{Ye.key==="Enter"&&Qe()}}),k.jsx("button",{onClick:()=>Qe(),disabled:!nt.trim(),className:"p-2.5 bg-[#007AFF] text-white rounded-xl disabled:opacity-50",children:k.jsx(mg,{size:20})})]})]}),M&&k.jsxs("div",{className:"space-y-4 pt-2",children:[k.jsxs("div",{className:"flex gap-2 p-1 bg-zinc-100 dark:bg-white/5 rounded-2xl",children:[k.jsx("button",{onClick:()=>we("open"),className:"flex-1 py-3 text-green-600 dark:text-green-400 font-bold text-sm rounded-xl hover:bg-white dark:hover:bg-white/10 transition-colors",children:"Open"}),k.jsx("button",{onClick:()=>we("occupied"),className:"flex-1 py-3 text-red-500 font-bold text-sm rounded-xl hover:bg-white dark:hover:bg-white/10 transition-colors",children:"Occupied"}),k.jsx("button",{onClick:()=>we("closed"),className:"flex-1 py-3 text-zinc-500 dark:text-zinc-400 font-bold text-sm rounded-xl hover:bg-white dark:hover:bg-white/10 transition-colors",children:"Closed"})]}),k.jsxs("button",{onClick:()=>$e(!0),className:"w-full py-4 bg-blue-500/10 text-[#007AFF] font-bold rounded-2xl flex items-center justify-center gap-2 hover:bg-blue-500/15 transition-colors",children:["View Status Log & Notes (",ve.length,") ",k.jsx(Ef,{size:18})]}),k.jsxs("div",{className:"flex gap-3 pt-2 border-t border-black/5 dark:border-white/5",children:[k.jsxs("button",{onClick:()=>be(!0),className:"flex-1 py-3 text-zinc-600 dark:text-zinc-300 font-bold text-sm flex items-center justify-center gap-2 hover:bg-black/5 dark:hover:bg-white/5 rounded-xl transition-colors",children:[k.jsx(Wp,{size:16})," Edit"]}),k.jsxs("button",{onClick:async()=>{if(!confirm("Delete this spot?"))return;const Ye={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",u.id],["a",`${hn.PARKING_SPOT_LISTING}:${E}:${u.d}`]],content:"Deleted"};await Promise.allSettled(O.publish(Fn,await l(Ye))),R(),S()},className:"flex-1 py-3 text-red-500 font-bold text-sm flex items-center justify-center gap-2 hover:bg-red-500/5 rounded-xl transition-colors",children:[k.jsx(Mf,{size:16})," Delete"]})]})]})]})})})},yA=({listing:u,onClose:m})=>{const v=(S,M)=>!M||M.length===0?null:k.jsxs("div",{className:"space-y-2",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:S}),k.jsx("div",{className:"space-y-1",children:M.map(R=>k.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-50 dark:bg-white/5 rounded-xl",children:[k.jsx("div",{className:"flex flex-col overflow-hidden",children:R.startsWith("npub")?k.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:R}):k.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:(()=>{try{return lv(R)}catch{return R}})()})}),k.jsx("button",{onClick:()=>{const E=R.startsWith("npub")?R:(()=>{try{return lv(R)}catch{return R}})();navigator.clipboard.writeText(E),alert("Copied")},className:"p-2 text-blue-500 bg-blue-500/10 rounded-full hover:bg-blue-500/20 active:scale-95 transition-all",children:k.jsx(Z0,{size:16})})]},R))})]});return k.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",onClick:m,children:k.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-6 relative border border-black/5 dark:border-white/10 shadow-2xl",onClick:S=>S.stopPropagation(),children:[k.jsxs("div",{className:"flex justify-between items-center",children:[k.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Access List"}),k.jsx("button",{onClick:m,children:k.jsx(Io,{className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-white"})})]}),k.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:[v("Owners",u.owners),v("Managers",u.managers),v("Members",u.members),v("Relays",u.relays||[]),!u.owners?.length&&!u.managers?.length&&!u.members?.length&&k.jsx("div",{className:"text-center text-zinc-400 py-8",children:"No access details found"})]})]})})},cv={light:"https://tiles.openfreemap.org/styles/positron",dark:"https://tiles.openfreemap.org/styles/dark"},uv=me.memo(({price:u,emoji:m,currency:v,isHistory:S=!1})=>{const M=yg(v);return k.jsxs("div",{className:"flex flex-col items-center justify-center transition-transform active:scale-95 pointer-events-none group",children:[k.jsx("div",{className:"text-[32px] leading-none drop-shadow-md z-10 filter pointer-events-auto cursor-pointer",children:m}),k.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap pointer-events-auto
                    ${S?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[M,Math.round(u),"/hr"]})]})}),o0=me.memo(({bearing:u,mapBearing:m,isNavigationMode:v})=>{const S=u-m,M=me.useRef(0),R=me.useRef(0),E=S-R.current;Math.abs(E)>180&&(E>0?M.current-=360:M.current+=360),R.current=S;const l=S+M.current;return k.jsx("div",{style:{transform:`rotate(${l}deg) scale(1)`,transition:"transform 0.2s ease-out",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:k.jsx("div",{style:{width:28,height:28,background:"#007AFF",border:"3px solid white",borderRadius:"50%",boxShadow:`0 0 0 ${v?3:2}px rgba(0,122,255,${v?.5:.4}), 0 4px 12px rgba(0,0,0,0.4)`,display:"flex",alignItems:"center",justifyContent:"center"},children:k.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"translateY(-1px)"},children:k.jsx("path",{d:"M7 0L14 14L7 12L0 14L7 0Z",fill:"white"})})})})});o0.displayName="UserLocationMarker";const l0=me.memo(({count:u,minPrice:m,maxPrice:v,currency:S,type:M})=>{const R=M==="open"?"":"",E=M==="history",l=yg(S),O=m===v?`${l}${m}`:`${l}${m}-${v}`;return k.jsxs("div",{className:"flex flex-col items-center justify-center transition-transform active:scale-95 pointer-events-none group",children:[k.jsxs("div",{className:"relative text-[32px] leading-none drop-shadow-md z-10 filter pointer-events-auto cursor-pointer",children:[R,k.jsx("div",{className:`
                    absolute -top-1 -right-1 flex items-center justify-center min-w-[18px] h-[18px] px-1
                    text-[10px] font-bold text-white rounded-full border-2 border-white shadow-sm
                    ${E?"bg-zinc-500":"bg-[#34C759]"}
                `,children:u})]}),k.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${E?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[O,"/hr"]})]})});l0.displayName="ClusterMarkerContent";const E1=me.memo(({vehicleType:u})=>{const m=u==="bicycle"?"":u==="motorcycle"?"":"";return k.jsx("div",{style:{fontSize:36,filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.4))",pointerEvents:"none"},children:m})});E1.displayName="ActiveSessionMarkerContent";const M1=me.memo(({vehicleType:u,onVehicleChange:m,disabled:v})=>{const[S,M]=me.useState(!1),R=["bicycle","motorcycle","car"],E={bicycle:"",motorcycle:"",car:""};return k.jsx("div",{className:"flex flex-col rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg mb-2 overflow-hidden transition-all duration-300",children:S?k.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[R.map(l=>k.jsx("button",{onClick:()=>{v?v&&alert("Please end your current session before changing vehicle type."):(m(l),M(!1))},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${u===l?"bg-blue-500/20 shadow-inner":"transition-colors"}`,children:k.jsx("span",{className:`text-lg ${u===l?"":"opacity-50"}`,children:E[l]})},l)),k.jsx("button",{onClick:()=>M(!1),className:"w-10 h-6 flex items-center justify-center text-zinc-400 dark:text-white/40 transition-colors",children:k.jsx(n_,{size:16})})]}):k.jsxs("button",{onClick:()=>M(!0),className:"flex flex-col items-center p-1 transition-all",children:[k.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-500/20",children:k.jsx("span",{className:"text-lg",children:E[u]})}),k.jsx(nd,{size:14,className:"text-zinc-400 dark:text-white/40 mt-0.5"})]})})});M1.displayName="VehicleToggle";const _A=()=>{const{pubkey:u,signEvent:m,pool:v}=Zc(),S=me.useRef(null),[M,R]=me.useState(null),E=me.useRef(new sA),l=me.useRef(new oA),O=me.useRef(new lA),[Y,ie]=me.useState(null),[ne,ze]=me.useState("idle"),[Ce,be]=me.useState("fixed"),[he,te]=me.useState(!1),[ve,qe]=me.useState(!1),[lt,Pt]=me.useState(!1),[Et,St]=me.useState(!1),[nt,Be]=me.useState(()=>{const Xe=localStorage.getItem("parlens_vehicle_type");return Xe==="bicycle"||Xe==="motorcycle"||Xe==="car"?Xe:"car"}),[it,$e]=me.useState([]),[we,Qe]=me.useState([]),[ut,Ye]=me.useState(null),[Ie,le]=me.useState(()=>{const Xe=localStorage.getItem("parlens_listed_parking_session");return Xe?JSON.parse(Xe):null}),[ke,De]=me.useState(!1),Fe=me.useCallback(async Xe=>{console.log("[Parlens] Processing scanned code:",Xe),St(!1);try{const{generateSecretKey:dt,finalizeEvent:Vt,getPublicKey:en}=await Dy(async()=>{const{generateSecretKey:ba,finalizeEvent:wn,getPublicKey:wa}=await Promise.resolve().then(()=>s0);return{generateSecretKey:ba,finalizeEvent:wn,getPublicKey:wa}},void 0);let tn;try{tn=JSON.parse(Xe)}catch{tn={a:Xe,authorizer:"",auth:""}}if(!tn.a){alert("Invalid QR code format");return}const Xn="parlens_listed_parking_session",Yn=localStorage.getItem(Xn);let ps=!1;Yn&&JSON.parse(Yn).spotATag===tn.a&&(ps=!0);const xi=dt(),qa=en(xi);if(ps){const ba=JSON.parse(Yn);Mn({authData:tn,session:ba,tempPrivkey:xi,tempPubkey:qa}),Bt(!0);return}const ms=[["a",tn.a],["status","occupied"],["updated_by",qa],["authorizer",tn.authorizer||u||""],...tn.auth?[["auth",tn.auth]]:[],["client","parlens"]],Sr=tn.listingLocation||null;if(Sr){ms.push(["location",`${Sr[0]},${Sr[1]}`]);try{const ba=ov.encode(Sr[0],Sr[1],9);ms.push(["g",ba])}catch{}}const Ju={kind:hn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:ms,content:""},Ns=Vt(Ju,xi);await Promise.allSettled(v.publish(Fn,Ns)),console.log("[Parlens] Status update published:",Ns.id);const Ga=`parking-${Date.now()}`,Xc=tn.listingLocation||M,uo=JSON.stringify({spotATag:tn.a,listingATag:tn.a.replace(/37141:/,"31147:").split(":").slice(0,2).join(":"),statusLogEventId:Ns.id,listingName:tn.listingName||"",spotNumber:tn.spotNumber||"",shortName:tn.shortName||"",tempPubkey:qa,started_at:Date.now()}),tc={kind:hn.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Ga],["a",tn.a],["status","parked"],["client","parlens"]],content:uo},js=await m(tc);await Promise.allSettled(v.publish(Fn,js));const gs={spotATag:tn.a,dTag:Ga,startTime:Date.now(),authorizer:tn.authorizer,tempPubkey:qa,listingName:tn.listingName||"",spotNumber:tn.spotNumber||"",shortName:tn.shortName||"",listingLocation:Xc||void 0};localStorage.setItem(Xn,JSON.stringify(gs)),le(gs),ze("parked"),Ye(Xc||null),xt(Math.floor(Date.now()/1e3)),console.log("[Parlens] Listed parking started:",js.id)}catch(dt){console.error("Failed to process QR code:",dt),alert("Failed to process parking. Please try again.")}},[u,m,v,M,ze]),bt=async()=>{if(!pn)return;const{authData:Xe,session:dt,tempPrivkey:Vt,tempPubkey:en}=pn;try{const{finalizeEvent:tn}=await Dy(async()=>{const{finalizeEvent:Sr}=await Promise.resolve().then(()=>s0);return{finalizeEvent:Sr}},void 0),Xn=[["a",Xe.a],["status","open"],["updated_by",en],["authorizer",Xe.authorizer||u||""],...Xe.auth?[["auth",Xe.auth]]:[],["client","parlens"]],Yn=Xe.listingLocation||dt.listingLocation;if(Yn){Xn.push(["location",`${Yn[0]},${Yn[1]}`]);try{const Sr=ov.encode(Yn[0],Yn[1],9);Xn.push(["g",Sr])}catch{}}const ps={kind:hn.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:Xn,content:""},xi=tn(ps,Vt);await Promise.allSettled(v.publish(Fn,xi));const qa=JSON.stringify({spotATag:Xe.a,statusLogEventId:xi.id,listingName:dt.listingName||"",spotNumber:dt.spotNumber||"",shortName:dt.shortName||"",ended_at:Date.now(),fee:Wt,currency:"USD"}),fl={kind:hn.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",dt.dTag||`parking-${Date.now()}`],["a",Xe.a],["status","idle"],["client","parlens"]],content:qa},ms=await m(fl);await Promise.allSettled(v.publish(Fn,ms)),localStorage.removeItem("parlens_listed_parking_session"),le(null),ze("idle"),Ye(null),xt(null),Bt(!1),Mn(null),Jt("0"),console.log("[Parlens] Listed parking ended")}catch(tn){console.error("Failed to end listed session:",tn),alert("Failed to end session. Please try again.")}},[de,He]=me.useState(!1),[_t,It]=me.useState(17),[Ze,Dt]=me.useState(null),[jt,$t]=me.useState(null),[Ot,ln]=me.useState(null),[dn,rn]=me.useState(!1),[gt,xt]=me.useState(null),[zt,qt]=me.useState(!1),[Gt,gn]=me.useState({longitude:77.5946,latitude:12.9716,zoom:17,bearing:0,pitch:0}),Rn=me.useRef(!1),bn=me.useRef(!1),Zn=window.matchMedia("(prefers-color-scheme: dark)").matches,[Ln,Wi]=me.useState(!1),[kn,Cn]=me.useState([]),[Ue,W]=me.useState(null),[$,K]=me.useState(null),[ue,ye]=me.useState(null),[je,Le]=me.useState(""),[,Me]=me.useState(!1),[Oe,Je]=me.useState([]),[ft,Bt]=me.useState(!1),[Wt,Jt]=me.useState("0"),[pn,Mn]=me.useState(null),[Ve,Pn]=me.useState(!1),[Fi,yn]=me.useState(null),[qn,ir]=me.useState(null);me.useEffect(()=>{const dt=setTimeout(async()=>{if(!(!M||qn))try{const en=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${M[0]}&lon=${M[1]}&format=json`)).json();en&&en.address&&en.address.country_code&&(console.log("[Parlens] Detected Country:",en.address.country_code),ir(en.address.country_code.toUpperCase()))}catch(Vt){console.error("[Parlens] Failed to detect country:",Vt)}},2e3);return()=>clearTimeout(dt)},[M,qn]);const ei=me.useCallback(()=>{const Xe=Gt,dt=Oe.length+kn.length+1,Vt={id:crypto.randomUUID(),lat:Xe.latitude,lon:Xe.longitude,name:`Waypoint ${dt}`};Cn(en=>[...en,Vt])},[Gt,Oe.length,kn.length]),Ti=(Xe,dt)=>{Cn(Vt=>Vt.map(en=>en.id===Xe?{...en,name:dt}:en))},ii=Xe=>{Cn(dt=>dt.filter(en=>en.id!==Xe).map((en,tn)=>en.name.startsWith("Waypoint ")?{...en,name:`Waypoint ${tn+1}`}:en)),$===Xe&&K(null)},Ui=me.useCallback(()=>{const Xe=kn.map(dt=>({lat:dt.lat,lon:dt.lon,name:dt.name}));W(Xe),Cn([]),Wi(!1)},[kn]),[Is,ds]=me.useState(!1),[kt,br]=me.useState(0),[hr,_a]=me.useState(0),{requestLock:Jn,releaseLock:Rt}=uA(),xn=me.useRef(new cA),[En,Zr]=me.useState(0),hl=me.useRef(!1),xa=me.useRef(0),_n=me.useRef(0);me.useEffect(()=>{if(ne==="parked"){be("fixed");const Xe=S.current?.getBearing()||0,dt=Math.round(Xe/360)*360;S.current?.rotateTo(dt,{duration:800})}},[ne]),me.useEffect(()=>(Jn(),()=>{Rt()}),[Jn,Rt]),me.useEffect(()=>{if(!navigator.geolocation){ie("Geolocation is not supported by your browser");return}const Xe=navigator.geolocation.watchPosition(dt=>{const{latitude:Vt,longitude:en,accuracy:tn}=dt.coords,Xn=xn.current.updateLocationWithAccuracy(Vt,en,tn);Zr(Xn.speed),xa.current=Xn.speed,Xn.speedClass==="stationary"?Xn.shouldUpdate&&O.current.animateTo(Xn.displayLat,Xn.displayLon,Xn.animationDuration):O.current.animateTo(Vt,en,300),hl.current||(hl.current=!0,R([Xn.displayLat,Xn.displayLon]),gn(Yn=>({...Yn,latitude:Xn.displayLat,longitude:Xn.displayLon})))},dt=>{let Vt="Unable to get your location";dt.code===1?Vt="Location access denied. Please enable location services.":dt.code===2?Vt="Location unavailable. Check your GPS settings.":dt.code===3&&(Vt="Location request timed out."),ie(Vt)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return O.current.setUpdateCallback((dt,Vt)=>{R([dt,Vt]),be(en=>{if((en==="auto"||en==="recentre")&&!Rn.current){if(xa.current<.3&&en!=="recentre")return en;gn(tn=>{const Xn=S.current?.getZoom()??tn.zoom,Yn=.1,ps=tn.latitude+(dt-tn.latitude)*Yn,xi=tn.longitude+(Vt-tn.longitude)*Yn;return{...tn,latitude:ps,longitude:xi,zoom:Xn}})}return en})}),()=>{navigator.geolocation.clearWatch(Xe),O.current.stop()}},[]),me.useEffect(()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&ds(!0);const Xe=dt=>{if(Rn.current)return;let Vt=null;if(dt.webkitCompassHeading?Vt=dt.webkitCompassHeading:dt.alpha!==null&&(Vt=360-dt.alpha),Vt!==null){const en=window.screen.orientation?.angle??window.orientation??0;Vt=(Vt+en)%360}if(Vt!==null){_n.current=Vt,_a(tn=>{let Yn=Vt-tn;return Yn>180&&(Yn-=360),Yn<-180&&(Yn+=360),Math.abs(Yn)<2?tn:tn+Yn*.1});const en=E.current.smoothBearing(Vt,0,!0);if(en!==null){const tn=l.current.setBearing(en);br(tn)}}};return window.addEventListener("deviceorientation",Xe,!0),()=>{window.removeEventListener("deviceorientation",Xe,!0)}},[]);const Rs=async()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission()==="granted"&&ds(!1)};me.useEffect(()=>{!Rn.current&&!bn.current&&M&&(Ce==="auto"||Ce==="recentre")&&gn(Xe=>{const dt=S.current?.getZoom()??Xe.zoom,Vt={...Xe,longitude:M[1],latitude:M[0],zoom:dt,pitch:0};if(Ln)return Xe;if(Ce==="auto"){Vt.bearing=kt;const en=dt>=17?300:dt>=15?200:150;Vt.transitionDuration=en}else if(Ce==="recentre"){const en=dt>=17?400:dt>=15?300:200;Vt.transitionDuration=en}return Vt})},[M,kt,Ce,dn,Ln]),me.useEffect(()=>(Jn(),()=>{Rt()}),[Jn,Rt]),me.useEffect(()=>{const Xe=localStorage.getItem("parlens_session");if(Xe)try{const dt=JSON.parse(Xe);dt.status==="parked"&&dt.parkLocation&&dt.sessionStart?(console.log("[Parlens] Restoring parked session:",dt),xt(dt.sessionStart),Ye(dt.parkLocation),ze("parked")):dt.status==="search"&&(console.log("[Parlens] Restoring search session"),ze("search"))}catch(dt){console.warn("[Parlens] Failed to restore session:",dt),localStorage.removeItem("parlens_session")}},[]),me.useEffect(()=>{ne==="parked"&&gt&&ut?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:gt,parkLocation:ut})):ne==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):ne==="idle"&&(localStorage.removeItem("parlens_session"),xt(null))},[ne,gt,ut]),me.useEffect(()=>{if(!M){He(!1);return}const[Xe,dt]=M,Vt=Math.sqrt(Math.pow(Gt.latitude-Xe,2)+Math.pow(Gt.longitude-dt,2));He(Vt>5e-4)},[M,Gt.latitude,Gt.longitude]);const Fa=me.useCallback(Xe=>{gn(Xe.viewState);let dt=!1;if(S.current&&(Xr.current&&(dt=!0),S.current.isZooming()&&(dt=!0),Xe&&Xe.originalEvent&&Xe.originalEvent.touches&&Xe.originalEvent.touches.length>1&&(dt=!0)),Rn.current&&(Ce==="auto"||Ce==="recentre")&&!dt){let Vt=1;M&&(Vt=Math.sqrt(Math.pow(Xe.viewState.longitude-M[1],2)+Math.pow(Xe.viewState.latitude-M[0],2))),Vt>1e-4&&be("fixed")}},[M,Ce,de]),fs=me.useCallback(Xe=>{Xe.originalEvent&&(Rn.current=!0,O.current.stop(),bn.current&&(S.current?.stop(),bn.current=!1))},[]),ia=me.useCallback(()=>{setTimeout(()=>{Rn.current=!1},1e3),It(Gt.zoom)},[Gt.zoom]),Xr=me.useRef(!1),Ai=me.useCallback(()=>{Xr.current=!0,Rn.current=!0,O.current.stop(),bn.current&&(S.current?.stop(),bn.current=!1)},[]),Ro=me.useCallback(()=>{Xr.current=!1,setTimeout(()=>{Xr.current||(Rn.current=!1)},1e3)},[]),wr=Xe=>{if(ne!=="idle"){alert("Please end your current session before changing vehicle type.");return}Be(Xe),localStorage.setItem("parlens_vehicle_type",Xe)},On=me.useCallback((Xe,dt,Vt,en)=>{if(Dt(Xe),$t(dt),ln(Vt),rn(en),Xe&&Xe.length>1&&S.current&&en){const tn=[...Xe];dt&&dt.length>0&&tn.push(...dt);const Xn=tn.map(xi=>xi[1]),Yn=tn.map(xi=>xi[0]),ps=new g1.LngLatBounds([Math.min(...Xn),Math.min(...Yn)],[Math.max(...Xn),Math.max(...Yn)]);bn.current=!0,S.current.fitBounds(ps,{padding:50,duration:1e3}),be("fixed"),setTimeout(()=>{bn.current=!1,typeof DeviceOrientationEvent.requestPermission=="function"&&ds(!0)},1200)}},[]),Ua=me.useMemo(()=>we.filter(dt=>(dt.decryptedContent?.type||"car")===nt).map(dt=>{const Vt=dt.decryptedContent;return Vt&&Vt.lat&&Vt.lon?{id:dt.id,lat:Vt.lat,lon:Vt.lon,price:parseFloat(Vt.fee)||0,currency:Vt.currency||"USD",original:dt}:null}).filter(Boolean),[we,nt]),Lo=me.useMemo(()=>rv(Ua,_t),[Ua,_t]),co=me.useMemo(()=>ne!=="search"?[]:it.filter(Xe=>(Xe.type||"car")===nt).map(Xe=>({id:Xe.id,lat:Xe.lat,lon:Xe.lon,price:Xe.price,currency:Xe.currency,original:Xe})),[it,nt,ne]),Ls=me.useMemo(()=>rv(co,_t),[co,_t]),va=Zn?cv.dark:cv.light,dl={id:"route",type:"line",paint:{"line-color":"#007AFF","line-width":5,"line-opacity":.9}},Va={id:"alternate-route",type:"line",paint:{"line-color":"#007AFF","line-width":3,"line-opacity":.4,"line-dasharray":[2,2]}};return k.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[(!M&&!Y||!zt)&&k.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:k.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:Y?k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:k.jsx("span",{className:"text-2xl",children:""})}),k.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:Y}),k.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-[#007AFF] text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),k.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})}),ne==="parked"&&k.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-[#34C759] rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[k.jsx("div",{className:"text-xl",children:nt==="bicycle"?"":nt==="motorcycle"?"":""}),k.jsx("span",{className:"font-bold text-white whitespace-nowrap",children:"Session Active"})]}),ne==="search"&&k.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-white dark:bg-zinc-800 rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[k.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#FF9500] animate-pulse"}),k.jsx("span",{className:"font-bold text-zinc-900 dark:text-white whitespace-nowrap",children:"Searching for spots"})]}),Ce==="auto"&&M&&k.jsx("div",{className:"absolute top-1/2 left-1/2 z-[900] pointer-events-none flex items-center justify-center",style:{transform:"translate(-50%, -50%)",width:"40px",height:"40px"},children:k.jsx(o0,{bearing:hr,mapBearing:Gt.bearing,isNavigationMode:!0})}),k.jsxs("div",{className:"absolute inset-0",onPointerDownCapture:()=>{Rn.current=!0,O.current.stop(),bn.current&&(S.current?.stop(),bn.current=!1)},onTouchStartCapture:()=>{Rn.current=!0,O.current.stop(),bn.current&&(S.current?.stop(),bn.current=!1)},onWheelCapture:()=>{Rn.current=!0,bn.current&&(S.current?.stop(),bn.current=!1),window.wheelDebounce&&clearTimeout(window.wheelDebounce),window.wheelDebounce=setTimeout(()=>{Rn.current=!1},1e3)},style:{touchAction:"none"},children:[k.jsxs(bC,{ref:S,...Gt,onStyleData:Xe=>{const dt=Xe.target;dt&&(dt.getStyle().layers?.forEach(tn=>{(tn.id.includes("oneway")||tn.id.includes("arrow")||tn.id.includes("direction"))&&dt.getLayoutProperty(tn.id,"visibility")!=="none"&&dt.setLayoutProperty(tn.id,"visibility","none")}),Object.entries({"icon-bus":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M4 6C4 4.89543 4.89543 4 6 4H18C19.1046 4 20 4.89543 20 6V17C20 18.1046 19.1046 19 18 19H16.5L17.5 21H15.5L14.5 19H9.5L8.5 21H6.5L7.5 19H6C4.89543 19 4 18.1046 4 17V6ZM6 6V10H18V6H6ZM6 12V16H18V12H6ZM8 14C8.55228 14 9 13.5523 9 13C9 12.4477 8.55228 12 8 12C7.44772 12 7 12.4477 7 13C7 13.5523 7.44772 14 8 14ZM16 14C16.5523 14 17 13.5523 17 13C17 12.4477 16.5523 12 16 12C15.4477 12 15 12.4477 15 13C15 13.5523 15.4477 14 16 14Z"/></svg>',"icon-train":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8 2 4 2.5 4 6V15.5C4 17.433 5.567 19 7.5 19L6 20.5V21H18V20.5L16.5 19C18.433 19 20 17.433 20 15.5V6C20 2.5 16 2 12 2ZM12 4C14.5 4 18 4.5 18 6V10H6V6C6 4.5 9.5 4 12 4ZM12 17C10.8954 17 10 16.1046 10 15C10 13.8954 10.8954 13 12 13C13.1046 13 14 13.8954 14 15C14 16.1046 13.1046 17 12 17ZM7.5 17C6.67157 17 6 16.3284 6 15.5V12H9.05C9.02 12.3 9 12.64 9 13C9 14.6569 10.3431 16 12 16C13.6569 16 15 14.6569 15 13C15 12.64 14.98 12.3 14.95 12H18V15.5C18 16.3284 17.3284 17 16.5 17H7.5Z"/></svg>',"icon-subway":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M17.8 2.8C16 2.09 13.86 2 12 2C10.14 2 8 2.09 6.2 2.8C4.30002 3.55 3.00002 4.97 3.00002 6.5V15.5C3.00002 17.4 4.40002 19.34 6.6 19.89L5.00002 21.5V22H19V21.5L17.4 19.89C19.6 19.34 21 17.4 21 15.5V6.5C21 4.97 19.7 3.55 17.8 2.8ZM16.5 16C15.12 16 14 14.88 14 13.5C14 12.12 15.12 11 16.5 11C17.88 11 19 12.12 19 13.5C19 14.88 17.88 16 16.5 16ZM12 9C7.58 9 6 6.5 6 6.5C6 6.5 8 5.5 12 5.5C16 5.5 18 6.5 18 6.5C18 6.5 16.42 9 12 9ZM7.5 16C6.12 16 5.00002 14.88 5.00002 13.5C5.00002 12.12 6.12 11 7.5 11C8.88 11 10 12.12 10 13.5C10 14.88 8.88 16 7.5 16Z"/></svg>',"icon-tram":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M13 5.5V2H11V5.5L7 8H17L13 5.5ZM5 9V17.5C5 18.7 5.7 19.7 6.8 20.2L6 21H8L9 20H15L16 21H18L17.2 20.2C18.3 19.7 19 18.7 19 17.5V9H5ZM16 16.5C16 17.05 15.55 17.5 15 17.5H9C8.45 17.5 8 17.05 8 16.5V14H16V16.5ZM16 12.5H8V10.5H16V12.5Z"/></svg>',"icon-stop":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="6" stroke="white" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="white"/></svg>'}).forEach(([tn,Xn])=>{if(!dt.hasImage(tn)){const Yn=new Image(24,24);Yn.onload=()=>dt.addImage(tn,Yn,{sdf:!0}),Yn.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(Xn)}}),dt.getLayer("transit-stops")||dt.addLayer({id:"transit-stops",type:"symbol",source:"openmaptiles","source-layer":"poi",minzoom:12,filter:["match",["get","class"],["bus_station","railway","bus_stop","tram_stop","subway","rail","train_station"],!0,!1],layout:{"icon-image":["match",["get","class"],"bus_station","icon-bus","bus_stop","icon-stop","railway","icon-train","rail","icon-train","train_station","icon-train","tram_stop","icon-tram","subway","icon-subway","icon-stop"],"icon-size":["interpolate",["linear"],["zoom"],12,.5,14,.6,18,1],"icon-allow-overlap":!1,"icon-padding":2,"text-field":["upcase",["coalesce",["get","name_en"],["get","name"]]],"text-size":11,"text-offset":[0,1.2],"text-anchor":"top","text-font":["Noto Sans Regular"],"text-optional":!0},paint:{"icon-color":Zn?"#999999":"#555555","icon-halo-color":Zn?"rgba(0,0,0,0.5)":"#ffffff","icon-halo-width":1,"text-color":Zn?"#aaaaaa":"#666666","text-halo-color":Zn?"rgba(0,0,0,0.8)":"#ffffff","text-halo-width":1,"text-opacity":["interpolate",["linear"],["zoom"],13.5,0,14,1]}}))},onLoad:Xe=>{qt(!0);const dt=Xe.target;dt&&dt.getStyle().layers?.forEach(en=>{(en.id.includes("oneway")||en.id.includes("arrow")||en.id.includes("direction"))&&dt.setLayoutProperty(en.id,"visibility","none")})},onMove:Fa,onMoveStart:fs,onMoveEnd:ia,onZoomStart:Ai,onZoomEnd:Ro,onRotateStart:()=>{Rn.current=!0,O.current.stop()},onRotateEnd:ia,onPitchStart:()=>{Rn.current=!0,O.current.stop()},onPitchEnd:ia,style:{width:"100%",height:"100%"},mapStyle:va,attributionControl:!1,dragPan:!bn.current,minZoom:3,maxZoom:20,renderWorldCopies:!0,maxTileCacheSize:500,children:[dn&&jt&&jt.length>1&&k.jsx(Qx,{id:"alternate-route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:jt.map(Xe=>[Xe[1],Xe[0]])}},children:k.jsx(Jx,{...Va})}),dn&&Ze&&Ze.length>1&&k.jsx(Qx,{id:"route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Ze.map(Xe=>[Xe[1],Xe[0]])}},children:k.jsx(Jx,{...dl})}),ne==="search"&&Ls.map(Xe=>{const dt=av(Xe);return k.jsx(yf,{longitude:Xe.lon,latitude:Xe.lat,anchor:"center",style:{willChange:"transform"},onClick:Vt=>{Vt.originalEvent.stopPropagation(),dt&&S.current?.flyTo({center:[Xe.lon,Xe.lat],zoom:Gt.zoom+2})},children:dt?k.jsx(l0,{count:Xe.count,minPrice:Xe.minPrice,maxPrice:Xe.maxPrice,currency:Xe.currency,type:"open"}):k.jsx(uv,{price:Xe.price,currency:Xe.currency,emoji:""})},`open-${Xe.id}`)}),(dn||Ln)&&(Ot||Oe.length>0)&&k.jsx(k.Fragment,{children:(Ln?Oe.length>0?Oe:Ot||[]:Ot||[]).map((Xe,dt)=>k.jsx(yf,{longitude:Xe.lon,latitude:Xe.lat,anchor:"center",onClick:Vt=>{Vt.originalEvent?.preventDefault(),Vt.originalEvent?.stopPropagation();const en=Xe.id;K($===en?null:en),Le(Xe.name||`Stop ${dt+1}`)},className:"cursor-pointer",style:{zIndex:$===Xe.id?200:100},children:k.jsxs("div",{className:"relative flex flex-col items-center",children:[Ln&&k.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[200]",onClick:Vt=>Vt.stopPropagation(),children:ue===Xe.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:je,onChange:Vt=>Le(Vt.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:Vt=>Vt.currentTarget.select(),onKeyDown:Vt=>{if(Vt.key==="Enter"){const en=Xe.id;en&&Je(tn=>tn.map(Xn=>Xn.id===en?{...Xn,name:je}:Xn)),ye(null)}}}),k.jsx("button",{onClick:()=>{const Vt=Xe.id;Vt&&Je(en=>en.map(tn=>tn.id===Vt?{...tn,name:je}:tn)),ye(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:k.jsx(Xp,{size:12,strokeWidth:3})}),k.jsx("button",{onClick:()=>ye(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:k.jsx(Io,{size:12})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Xe.name||`Stop ${dt+1}`}),k.jsx("button",{onClick:()=>{Le(Xe.name||`Stop ${dt+1}`),ye(Xe.id)},className:"p-1 rounded-lg transition-colors",children:k.jsx(Wp,{size:12})}),k.jsx("button",{onClick:()=>{const Vt=Xe.id;Vt&&Je(en=>en.filter(tn=>tn.id!==Vt))},className:"p-1 rounded-lg transition-colors",children:k.jsx(qx,{size:12})})]})}),k.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",style:{zIndex:10},children:dt+1})]})},`wp-${Xe.id||dt}`))}),Ln&&kn.map((Xe,dt)=>{const Vt=Oe.length+dt+1;return k.jsx(yf,{longitude:Xe.lon,latitude:Xe.lat,anchor:"center",onClick:en=>{en.originalEvent?.preventDefault(),en.originalEvent?.stopPropagation(),K($===Xe.id?null:Xe.id),Le(Xe.name)},className:"cursor-pointer",style:{zIndex:$===Xe.id?2e3:1e3},children:k.jsxs("div",{className:"relative flex flex-col items-center",children:[k.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[2000]",onClick:en=>en.stopPropagation(),children:ue===Xe.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:je,onChange:en=>Le(en.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:en=>en.currentTarget.select(),onKeyDown:en=>{en.key==="Enter"&&(Ti(Xe.id,je),ye(null))}}),k.jsx("button",{onClick:()=>{Ti(Xe.id,je),ye(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:k.jsx(Xp,{size:12,strokeWidth:3})}),k.jsx("button",{onClick:()=>ye(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:k.jsx(Io,{size:12})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Xe.name}),k.jsx("button",{onClick:()=>{Le(Xe.name),ye(Xe.id)},className:"p-1 rounded-lg transition-colors",children:k.jsx(Wp,{size:12})}),k.jsx("button",{onClick:()=>ii(Xe.id),className:"p-1 rounded-lg transition-colors",children:k.jsx(qx,{size:12})})]})}),k.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",children:Vt})]})},Xe.id)}),"     ",Lo.map(Xe=>{const dt=av(Xe);return k.jsx(yf,{longitude:Xe.lon,latitude:Xe.lat,anchor:"center",style:{willChange:"transform"},onClick:Vt=>{Vt.originalEvent.stopPropagation(),dt&&S.current?.flyTo({center:[Xe.lon,Xe.lat],zoom:Gt.zoom+2})},children:dt?k.jsx(l0,{count:Xe.count,minPrice:Xe.minPrice,maxPrice:Xe.maxPrice,currency:Xe.currency,type:"history"}):k.jsx(uv,{price:Xe.price,currency:Xe.currency,emoji:"",isHistory:!0})},`history-${Xe.id}`)}),ne==="parked"&&ut&&k.jsx(yf,{longitude:ut[1],latitude:ut[0],anchor:"center",children:k.jsx(E1,{vehicleType:nt})}),Ie&&(Ie.listingLocation||ut)&&k.jsx(yf,{longitude:(Ie.listingLocation||ut)[1],latitude:(Ie.listingLocation||ut)[0],anchor:"bottom",onClick:Xe=>{Xe.originalEvent.stopPropagation(),De(!0)},style:{zIndex:1800},children:k.jsxs("div",{className:"flex flex-col items-center -translate-y-8",children:[k.jsx("div",{className:"bg-white dark:bg-zinc-800 p-3 rounded-full shadow-xl border-2 border-[#007AFF] cursor-pointer hover:scale-110 transition-transform",children:k.jsx(zy,{size:20,className:"text-[#007AFF]"})}),k.jsx("div",{className:"w-0.5 h-3 bg-[#007AFF]/50"})]})}),ke&&Ie&&k.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in",onClick:()=>De(!1),children:k.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] w-full max-w-sm rounded-[2rem] shadow-2xl p-6 space-y-6 relative border border-black/5 dark:border-white/10",onClick:Xe=>Xe.stopPropagation(),children:[k.jsx("button",{onClick:()=>De(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:k.jsx(Io,{size:24})}),k.jsxs("div",{className:"text-center space-y-1",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:"Active Session"}),k.jsx("h2",{className:"text-2xl font-bold dark:text-white leading-tight",children:Ie.listingName||"Parking Spot"}),k.jsx("div",{className:"text-lg text-blue-500 font-bold",children:Ie.shortName||`#${Ie.spotNumber}`})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("div",{className:"p-6 bg-zinc-50 dark:bg-white/5 rounded-3xl flex justify-center border border-black/5 dark:border-white/5",children:k.jsx(zy,{size:120,className:"dark:text-white opacity-80"})}),k.jsxs("div",{onClick:()=>{navigator.clipboard.writeText(Ie.dTag||""),alert("Copied parking ID")},className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl cursor-pointer hover:bg-zinc-100 dark:hover:bg-white/10 transition-colors",children:[k.jsxs("div",{className:"overflow-hidden",children:[k.jsx("div",{className:"text-xs font-bold text-zinc-400 uppercase mb-1",children:"Parking ID"}),k.jsx("div",{className:"text-sm font-mono text-zinc-600 dark:text-white/70 truncate",children:Ie.dTag||"N/A"})]}),k.jsx("div",{className:"p-2 bg-blue-500/10 rounded-full text-blue-500",children:k.jsx(Z0,{size:20})})]})]}),k.jsx("button",{onClick:()=>De(!1),className:"w-full py-4 bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white font-bold rounded-2xl",children:"Close"})]})}),M&&Ce!=="auto"&&k.jsx(yf,{longitude:M[1],latitude:M[0],anchor:"center",style:{zIndex:1e3},children:k.jsx(o0,{bearing:hr,mapBearing:Gt.bearing,isNavigationMode:!1})})]}),Ln&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1600]",children:k.jsxs("div",{className:"relative flex items-center justify-center",children:[k.jsx("div",{className:"absolute w-8 h-8 rounded-full bg-blue-500/10 dark:bg-blue-400/10 animate-pulse"}),k.jsx("div",{className:"w-1.5 h-1.5 bg-[#007AFF] rounded-full shadow-sm z-10"}),k.jsx("div",{className:"absolute w-6 h-[1.5px] bg-[#007AFF]/60 rounded-full"}),k.jsx("div",{className:"absolute h-6 w-[1.5px] bg-[#007AFF]/60 rounded-full"})]})}),k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-12 z-[1500]",children:k.jsxs("button",{onClick:ei,className:"bg-white dark:bg-zinc-800 text-[#007AFF] px-6 py-2.5 rounded-full font-bold text-sm shadow-xl backdrop-blur-md active:scale-95 transition-all flex items-center gap-2 border border-black/5 dark:border-white/10",children:[k.jsx(Hc,{size:16,className:"fill-current"}),"Drop Pin Here"]})}),k.jsx("div",{className:"absolute top-4 right-4 z-[2000] animate-in slide-in-from-top-4 fade-in",children:k.jsxs("button",{onClick:Ui,className:"bg-[#007AFF] text-white px-6 py-2.5 rounded-full font-bold shadow-lg flex items-center gap-2 transition-transform active:scale-95 active:bg-[#007AFF]",children:[k.jsx(Xp,{size:18,strokeWidth:3}),"Done"]})})]})]}),k.jsxs("div",{className:`absolute z-[1000] flex flex-col items-start gap-3 animate-in slide-in-from-left-6 transition-opacity duration-300 ${Ln?"opacity-0 pointer-events-none":"opacity-100"}`,style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[k.jsx(M1,{vehicleType:nt,onVehicleChange:wr,disabled:ne!=="idle"}),k.jsx("button",{onClick:()=>St(!0),onContextMenu:Xe=>{Xe.preventDefault();const dt=prompt("Enter Parking Code manually:");dt&&Fe(dt)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95",title:"Scan QR Code (Long press for manual)",children:k.jsx("div",{className:"relative",children:k.jsx(QM,{size:20})})}),k.jsx("button",{onClick:()=>Pt(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95",title:"Listed Parking",children:k.jsx("span",{className:"text-3xl font-light leading-none pb-1",children:""})})]}),k.jsxs("div",{className:"absolute z-[1000] flex flex-col items-end gap-3 animate-in slide-in-from-right-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[Math.abs(Gt.bearing)>5&&Ce!=="auto"&&k.jsx("button",{onClick:()=>{const Xe=S.current?.getBearing()||0,dt=Math.round(Xe/360)*360;S.current?.rotateTo(dt,{duration:400}),gn(Vt=>({...Vt,pitch:0}))},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10",title:"Reset to true north",children:k.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-Gt.bearing}deg)`},children:[k.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid rgb(239 68 68)"}}),k.jsx("span",{className:"text-sm font-bold text-zinc-600 dark:text-white/70",style:{marginTop:"-2px"},children:"N"})]})}),k.jsx("button",{onClick:async()=>{if(Is){await Rs();return}if(Ln){M&&S.current?.flyTo({center:[M[1],M[0]],zoom:17,duration:800,essential:!0});return}S.current?.stop(),bn.current=!1;const Xe=Gt.zoom,dt=17;if(de){if(M){const Vt=Xe<dt?dt:Xe;bn.current=!0,S.current?.flyTo({center:[M[1],M[0]],zoom:Vt,duration:800,essential:!0}),S.current?.once("moveend",()=>{bn.current=!1})}be("recentre"),He(!1);return}if((Ce==="fixed"||Ce==="recentre")&&M&&(bn.current=!0,S.current?.flyTo({center:[M[1],M[0]],zoom:Xe<dt?dt:Xe,bearing:Math.round((S.current?.getBearing()||0)/360)*360,duration:800,essential:!0}),S.current?.once("moveend",()=>{bn.current=!1,Ce==="fixed"&&be("recentre")})),Ce==="recentre"){if(ne==="parked"){bn.current=!0,S.current?.flyTo({bearing:Math.round((S.current?.getBearing()||0)/360)*360,pitch:0,zoom:16.5,duration:800,essential:!0}),S.current?.once("moveend",()=>{bn.current=!1}),be("fixed");return}const Vt=hr||0;bn.current=!0,te(!0),S.current?.rotateTo(Vt,{duration:800}),S.current?.once("moveend",()=>{bn.current=!1,te(!1),l.current.reset(Vt),be("auto")});return}be(Vt=>{if(Vt==="auto"){const en=S.current?.getBearing()||0,tn=Math.round(en/360)*360;return bn.current=!0,S.current?.flyTo({bearing:tn,pitch:0,zoom:16.5,duration:800,essential:!0}),S.current?.once("moveend",()=>{bn.current=!1}),te(!1),"fixed"}return"recentre"})},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg ${Is?"bg-orange-500/20 border-orange-500/50 text-orange-500 animate-pulse":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:Is?k.jsx(Ty,{size:20,className:"text-orange-500 animate-pulse"}):Ln?k.jsx(Ty,{size:20,className:"text-zinc-600 dark:text-white/70"}):Ce==="auto"||he?k.jsx(xM,{size:20,className:"text-blue-500"}):Ce==="recentre"?k.jsx(Ty,{size:20,fill:"currentColor",className:"text-green-500"}):k.jsx(Ty,{size:20,className:`text-zinc-600 dark:text-white/70 ${de?"opacity-50":""}`})}),k.jsx("div",{className:Ln?"hidden":"block",children:k.jsx(nA,{vehicleType:nt,onRouteChange:On,currentLocation:M,onDropPinModeChange:Wi,pendingWaypoints:Ue,onDropPinConsumed:()=>W(null),onOpenChange:Me,onWaypointsChange:Je,onRequestOrientationPermission:Rs})}),!Ln&&k.jsx("div",{className:"relative z-[1010]",children:k.jsx(eA,{setHistorySpots:Qe,onHelpClick:()=>qe(!0)})}),!Ln&&k.jsx(QC,{status:ne,setStatus:ze,searchLocation:M,vehicleType:nt,setOpenSpots:$e,parkLocation:ut,setParkLocation:Ye,sessionStart:gt,setSessionStart:xt,listedParkingSession:Ie,onQRScan:()=>St(!0)})]}),ve&&k.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[k.jsx("button",{onClick:()=>qe(!1),className:"absolute inset-0 z-0 cursor-default"}),k.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",style:{overscrollBehaviorY:"contain"},children:[k.jsx("button",{onClick:()=>qe(!1),className:"absolute top-6 left-6 p-2 rounded-full transition-colors text-black/60 dark:text-white/60 hover:bg-black/10 dark:hover:bg-white/20",children:k.jsx(o1,{size:20})}),k.jsxs("div",{className:"text-center space-y-2 pt-4",children:[k.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:k.jsx("span",{className:"text-3xl font-bold",children:"?"})}),k.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"}),k.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Decentralized Route & Parking Management"})]}),k.jsxs("div",{className:"space-y-3",children:[k.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),k.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[k.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Browser Menu (Android)"}),k.jsx(nd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add to Home screen"})]}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add"})," to confirm"]})]}),k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Install"})]})]})]})]}),k.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[k.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Share Button (iOS)"}),k.jsx(nd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsxs("li",{children:["Tap the ",k.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),k.jsxs("li",{children:["Scroll down and tap ",k.jsx("strong",{children:"Add to Home Screen"}),"."]}),k.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),k.jsxs("div",{className:"space-y-6 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. If the system generated route(s) between your start and end points are not to your liking, add additional waypoints in locations you would prefer travelling through. Click the location button to re-centre and turn on follow-me or navigation mode for route tracking."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking"}),"Click the main button once to see open spots in listed parking spaces and open spots reported by others live or within the last 5 minutes. For standard parking: Click again to mark your location. When leaving, click once more to end the session, log the fee and report the spot. For listed parking: Click the QR code scanner button below the vehicle type selector. Scan the QR code at the parking location to start the session. When leaving, scan it again to end the session and log the fee. Use the profile button to see your parking history."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Create and manage a listed parking (optional)"}),"Users who oversee one or more parking spots can create a listed parking to simplify spot and lot management. Click the parking services button () at the bottom left-hand corner of the screen, and click the '+' button to create a listing. Provide the relevant details requested in form to create an online listing that matches your real-world space. Listed parkings can be public (open to all users) or private (open to select users and only publish to select relays). Once created you can see your listings as viewed by other users in the public or private listing page. You should use the my listing page to manage your listing(s). Larger listings may take longer to create."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Create your own mirror (optional)"}),k.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 dark:text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"6. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys, only accessible by you and stored on relays of your preference. Open spot broadcasts and listed parking log updates use temporary identifiers to prevent your permanent public key from being shared."]}),k.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20 mt-6",children:k.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[k.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent personal IP address(es) from being associated with your data."]})})]})]})]}),k.jsx("div",{style:{display:lt&&!Ve?"block":"none"},children:lt&&k.jsx(pA,{onClose:()=>Pt(!1),currentLocation:M,countryCode:qn,onPickLocation:()=>Pn(!0),pickedLocation:Fi})}),Ve&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1500]",children:k.jsxs("div",{className:"relative",children:[k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-4 bg-black/50"}),k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-1 bg-black/50"}),k.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 rounded-full flex items-center justify-center bg-white/20 backdrop-blur-sm shadow-xl animate-in zoom-in spin-in-180 duration-500",children:k.jsx(Hc,{size:16,className:"text-purple-600 fill-current"})})]})}),k.jsxs("div",{className:"absolute bottom-10 left-0 right-0 z-[2000] flex justify-center gap-4 px-4 pb-safe animate-in slide-in-from-bottom",children:[k.jsx("button",{onClick:()=>Pn(!1),className:"px-6 py-3 rounded-full bg-white text-zinc-900 font-bold shadow-lg",children:"Cancel"}),k.jsx("button",{onClick:()=>{yn({lat:Gt.latitude,lon:Gt.longitude}),Pn(!1)},className:"px-6 py-3 rounded-full bg-purple-600 text-white font-bold shadow-lg shadow-purple-500/30",children:"Confirm Location"})]})]}),ft&&k.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:k.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[k.jsxs("div",{className:"text-center space-y-1",children:[k.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),k.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee"})]}),k.jsxs("div",{className:"flex items-center gap-4",children:[k.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[k.jsx("span",{className:"text-2xl font-bold text-blue-500",children:"$"}),k.jsx("input",{type:"number",value:Wt,onChange:Xe=>Jt(Xe.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),k.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:"USD"})]}),k.jsxs("div",{className:"flex flex-col gap-1.5",children:[k.jsx("button",{onClick:()=>Jt(String(Math.max(0,parseFloat(Wt||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(n_,{size:22,className:"text-zinc-600 dark:text-white/70"})}),k.jsx("button",{onClick:()=>Jt(String(Math.max(0,parseFloat(Wt||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(nd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),k.jsxs("div",{className:"w-full space-y-3",children:[k.jsxs("button",{onClick:bt,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",k.jsx(l1,{size:20})]}),k.jsx("button",{onClick:()=>{Bt(!1),Mn(null),Jt("0")},className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})}),Et&&k.jsxs("div",{className:"fixed inset-0 z-[3000] bg-black/90 flex flex-col items-center justify-center animate-in fade-in",children:[k.jsx("button",{onClick:()=>St(!1),className:"absolute top-6 right-6 p-3 rounded-full bg-white/10 text-white",children:k.jsx(Io,{size:24})}),k.jsxs("div",{className:"text-center space-y-6 px-8",children:[k.jsx("div",{className:"w-64 h-64 border-4 border-white/50 rounded-3xl flex items-center justify-center mx-auto",children:k.jsx(zy,{size:64,className:"text-white/30"})}),k.jsx("p",{className:"text-white/60 text-sm",children:"Point your camera at the parking spot QR code"}),k.jsx("button",{onClick:()=>{const Xe=prompt("Enter QR code manually:");Xe&&Fe(Xe)},className:"px-6 py-3 bg-white/10 text-white rounded-full text-sm font-medium active:scale-95 transition-transform",children:"Enter Code Manually"})]})]})]})},xA=()=>{const{login:u}=Zc(),[m,v]=me.useState(""),[S,M]=me.useState(""),[R,E]=me.useState(!1),[l,O]=me.useState("landing"),[Y,ie]=me.useState(""),[ne,ze]=me.useState(null),Ce=async ve=>{E(!0),M("");try{await u(ve,ve==="nsec"?m:void 0)}catch(qe){M(qe.message)}finally{E(!1)}},be=()=>{O("setup")},he=async()=>{if(!Y.trim()){M("Please enter a username");return}E(!0);try{const{generateSecretKey:ve,getPublicKey:qe}=await Dy(async()=>{const{generateSecretKey:Be,getPublicKey:it}=await Promise.resolve().then(()=>s0);return{generateSecretKey:Be,getPublicKey:it}},void 0),lt=Be=>Array.from(Be).map(it=>it.toString(16).padStart(2,"0")).join(""),Pt=ve(),Et=qe(Pt);localStorage.setItem("parlens_privkey",lt(Pt)),localStorage.setItem("parlens_pubkey",Et),localStorage.setItem("parlens_pending_username",Y);const St=Sf.npubEncode(Et),nt=Sf.nsecEncode(Pt);ze({npub:St,nsec:nt}),O("backup")}catch(ve){M(ve.message)}finally{E(!1)}},te=async()=>{E(!0);try{const ve=localStorage.getItem("parlens_pending_username");await u("create",void 0,ve||Y),localStorage.removeItem("parlens_pending_username")}catch(ve){M(ve.message)}finally{E(!1)}};return k.jsx("div",{className:"min-h-screen bg-zinc-50 dark:bg-black p-6 text-zinc-900 dark:text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center transition-colors duration-300",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:k.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[k.jsxs("div",{className:"space-y-4",children:[k.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),k.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter text-zinc-900 dark:text-white",children:"Parlens"}),k.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-white/40 tracking-tight",children:"Decentralized Route & Parking Management"})]}),k.jsxs("div",{className:"space-y-4",children:[l==="landing"?k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:be,disabled:R,className:"w-full h-16 rounded-3xl bg-white dark:bg-white text-black font-bold text-lg shadow-xl shadow-black/5 dark:shadow-none active:scale-95 transition-all flex items-center justify-center gap-3 border border-black/5 dark:border-transparent",children:R?"Creating...":k.jsxs(k.Fragment,{children:[k.jsx(rC,{size:20,strokeWidth:3}),"Create a New Account"]})}),k.jsxs("button",{onClick:()=>O("nsec"),disabled:R,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[k.jsx(a0,{size:18}),"Login with Nostr Account"]})]}):l==="setup"?k.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[k.jsxs("div",{className:"text-center pb-2",children:[k.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Pick a Username"}),k.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),k.jsx("input",{type:"text",placeholder:"Username",value:Y,onChange:ve=>ie(ve.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:()=>O("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),k.jsx("button",{onClick:he,disabled:R||!Y,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:R?"Creating...":"Continue"})]})]}):l==="backup"?k.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[k.jsxs("div",{className:"text-center pb-2",children:[k.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:" Account Created!"}),k.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm mt-1",children:"Backup your keys before continuing"})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30 ml-2",children:"Keys"}),k.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white dark:bg-white/[0.03] border border-black/5 dark:border-white/10 shadow-sm dark:shadow-none",children:[k.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{ne&&(navigator.clipboard.writeText(ne.npub),alert("Copied to clipboard"))},children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400",children:k.jsx(a0,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),k.jsx(Ef,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),k.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),k.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{ne&&(navigator.clipboard.writeText(ne.nsec),alert("Copied to clipboard"))},children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-500",children:k.jsx(h1,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),k.jsx(Ef,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed text-center",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost."})]}),k.jsxs("div",{className:"space-y-6 pt-6 border-t border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"space-y-2",children:[k.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Getting Started"}),k.jsx("p",{className:"text-sm text-zinc-500 dark:text-white/60",children:"Follow these steps to get the most out of Parlens."})]}),k.jsxs("div",{className:"space-y-4 text-sm text-zinc-600 dark:text-white/60 leading-relaxed",children:[k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. If the system generated route(s) between your start and end points are not to your liking, add additional waypoints in locations you would prefer travelling through. Click the location button to re-centre and turn on follow-me or navigation mode for route tracking."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking"}),"Click the main button once to see open spots in listed parking spaces and open spots reported by others live or within the last 5 minutes. For standard parking: Click again to mark your location. When leaving, click once more to end the session, log the fee and report the spot. For listed parking: Click the QR code scanner button below the vehicle type selector. Scan the QR code at the parking location to start the session. When leaving, scan it again to end the session and log the fee. Use the profile button to see your parking history."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Create and manage a listed parking (optional)"}),"Users who oversee one or more parking spots can create a listed parking to simplify spot and lot management. Click the parking services button () at the bottom left-hand corner of the screen, and click the '+' button to create a listing. Provide the relevant details requested in form to create an online listing that matches your real-world space. Listed parkings can be public (open to all users) or private (open to select users and only publish to select relays). Once created you can see your listings as viewed by other users in the public or private listing page. You should use the my listing page to manage your listing(s). Larger listings may take longer to create."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Create your own mirror (optional)"}),k.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"6. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys, only accessible by you and stored on relays of your preference. Open spot broadcasts and listed parking log updates use temporary identifiers to prevent your permanent public key from being shared."]}),k.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 border border-amber-500/20 mt-4",children:k.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-500/90 leading-relaxed",children:[k.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent personal IP address(es) from being associated with your data."]})})]})]}),k.jsx("button",{onClick:te,disabled:R,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:R?"Starting...":"Start Using Parlens"})]}):k.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[k.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:m,onChange:ve=>v(ve.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:()=>O("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),k.jsx("button",{onClick:()=>Ce("nsec"),disabled:R||!m,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:R?"Decrypting...":"Login with Key"})]})]}),S&&k.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:S}),k.jsxs("div",{className:"space-y-3 pt-6 border-t border-black/5 dark:border-white/10",children:[k.jsx("h3",{className:"text-center font-bold text-zinc-500 dark:text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),k.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[k.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Browser Menu (Android)"}),k.jsx(nd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:[k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80",children:"Chrome & Brave:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add to Home screen"})]}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add"})," to confirm"]})]}),k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80 mt-3",children:"Firefox:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Install"})]})]})]})]}),k.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[k.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Share Button (iOS)"}),k.jsx(nd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsxs("li",{children:["Tap the ",k.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Share"})," button in Safari menu bar."]}),k.jsxs("li",{children:["Scroll down and tap ",k.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Add to Home Screen"}),"."]}),k.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},vA=()=>{const{pubkey:u}=Zc();return p0.useEffect(()=>{let m=0;const v=()=>{if(document.visibilityState==="hidden")m=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&m>0){const M=Date.now()-m;console.log("[App] Foregrounded after",M,"ms"),M>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},S=M=>{M.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",v),window.addEventListener("pageshow",S),()=>{document.removeEventListener("visibilitychange",v),window.removeEventListener("pageshow",S)}},[]),u?k.jsx(_A,{}):k.jsx(xA,{})};var r_=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(u){return this.listeners.add(u),this.onSubscribe(),()=>{this.listeners.delete(u),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},bA={setTimeout:(u,m)=>setTimeout(u,m),clearTimeout:u=>clearTimeout(u),setInterval:(u,m)=>setInterval(u,m),clearInterval:u=>clearInterval(u)},wA=class{#e=bA;#t=!1;setTimeoutProvider(u){this.#e=u}setTimeout(u,m){return this.#e.setTimeout(u,m)}clearTimeout(u){this.#e.clearTimeout(u)}setInterval(u,m){return this.#e.setInterval(u,m)}clearInterval(u){this.#e.clearInterval(u)}},c0=new wA;function SA(u){setTimeout(u,0)}var a_=typeof window>"u"||"Deno"in globalThis;function Jl(){}function TA(u,m){return typeof u=="function"?u(m):u}function EA(u){return typeof u=="number"&&u>=0&&u!==1/0}function MA(u,m){return Math.max(u+(m||0)-Date.now(),0)}function u0(u,m){return typeof u=="function"?u(m):u}function CA(u,m){return typeof u=="function"?u(m):u}function hv(u,m){const{type:v="all",exact:S,fetchStatus:M,predicate:R,queryKey:E,stale:l}=u;if(E){if(S){if(m.queryHash!==Y0(E,m.options))return!1}else if(!xg(m.queryKey,E))return!1}if(v!=="all"){const O=m.isActive();if(v==="active"&&!O||v==="inactive"&&O)return!1}return!(typeof l=="boolean"&&m.isStale()!==l||M&&M!==m.state.fetchStatus||R&&!R(m))}function dv(u,m){const{exact:v,status:S,predicate:M,mutationKey:R}=u;if(R){if(!m.options.mutationKey)return!1;if(v){if(_g(m.options.mutationKey)!==_g(R))return!1}else if(!xg(m.options.mutationKey,R))return!1}return!(S&&m.state.status!==S||M&&!M(m))}function Y0(u,m){return(m?.queryKeyHashFn||_g)(u)}function _g(u){return JSON.stringify(u,(m,v)=>h0(v)?Object.keys(v).sort().reduce((S,M)=>(S[M]=v[M],S),{}):v)}function xg(u,m){return u===m?!0:typeof u!=typeof m?!1:u&&m&&typeof u=="object"&&typeof m=="object"?Object.keys(m).every(v=>xg(u[v],m[v])):!1}var AA=Object.prototype.hasOwnProperty;function C1(u,m){if(u===m)return u;const v=fv(u)&&fv(m);if(!v&&!(h0(u)&&h0(m)))return m;const M=(v?u:Object.keys(u)).length,R=v?m:Object.keys(m),E=R.length,l=v?new Array(E):{};let O=0;for(let Y=0;Y<E;Y++){const ie=v?Y:R[Y],ne=u[ie],ze=m[ie];if(ne===ze){l[ie]=ne,(v?Y<M:AA.call(u,ie))&&O++;continue}if(ne===null||ze===null||typeof ne!="object"||typeof ze!="object"){l[ie]=ze;continue}const Ce=C1(ne,ze);l[ie]=Ce,Ce===ne&&O++}return M===E&&O===M?u:l}function fv(u){return Array.isArray(u)&&u.length===Object.keys(u).length}function h0(u){if(!pv(u))return!1;const m=u.constructor;if(m===void 0)return!0;const v=m.prototype;return!(!pv(v)||!v.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(u)!==Object.prototype)}function pv(u){return Object.prototype.toString.call(u)==="[object Object]"}function zA(u){return new Promise(m=>{c0.setTimeout(m,u)})}function kA(u,m,v){return typeof v.structuralSharing=="function"?v.structuralSharing(u,m):v.structuralSharing!==!1?C1(u,m):m}function PA(u,m,v=0){const S=[...u,m];return v&&S.length>v?S.slice(1):S}function DA(u,m,v=0){const S=[m,...u];return v&&S.length>v?S.slice(0,-1):S}var K0=Symbol();function A1(u,m){return!u.queryFn&&m?.initialPromise?()=>m.initialPromise:!u.queryFn||u.queryFn===K0?()=>Promise.reject(new Error(`Missing queryFn: '${u.queryHash}'`)):u.queryFn}var IA=class extends r_{#e;#t;#n;constructor(){super(),this.#n=u=>{if(!a_&&window.addEventListener){const m=()=>u();return window.addEventListener("visibilitychange",m,!1),()=>{window.removeEventListener("visibilitychange",m)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(m=>{typeof m=="boolean"?this.setFocused(m):this.onFocus()})}setFocused(u){this.#e!==u&&(this.#e=u,this.onFocus())}onFocus(){const u=this.isFocused();this.listeners.forEach(m=>{m(u)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},z1=new IA;function RA(){let u,m;const v=new Promise((M,R)=>{u=M,m=R});v.status="pending",v.catch(()=>{});function S(M){Object.assign(v,M),delete v.resolve,delete v.reject}return v.resolve=M=>{S({status:"fulfilled",value:M}),u(M)},v.reject=M=>{S({status:"rejected",reason:M}),m(M)},v}var LA=SA;function NA(){let u=[],m=0,v=l=>{l()},S=l=>{l()},M=LA;const R=l=>{m?u.push(l):M(()=>{v(l)})},E=()=>{const l=u;u=[],l.length&&M(()=>{S(()=>{l.forEach(O=>{v(O)})})})};return{batch:l=>{let O;m++;try{O=l()}finally{m--,m||E()}return O},batchCalls:l=>(...O)=>{R(()=>{l(...O)})},schedule:R,setNotifyFunction:l=>{v=l},setBatchNotifyFunction:l=>{S=l},setScheduler:l=>{M=l}}}var Ds=NA(),jA=class extends r_{#e=!0;#t;#n;constructor(){super(),this.#n=u=>{if(!a_&&window.addEventListener){const m=()=>u(!0),v=()=>u(!1);return window.addEventListener("online",m,!1),window.addEventListener("offline",v,!1),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",v)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(u){this.#n=u,this.#t?.(),this.#t=u(this.setOnline.bind(this))}setOnline(u){this.#e!==u&&(this.#e=u,this.listeners.forEach(v=>{v(u)}))}isOnline(){return this.#e}},Uy=new jA;function OA(u){return Math.min(1e3*2**u,3e4)}function k1(u){return(u??"online")==="online"?Uy.isOnline():!0}var d0=class extends Error{constructor(u){super("CancelledError"),this.revert=u?.revert,this.silent=u?.silent}};function P1(u){let m=!1,v=0,S;const M=RA(),R=()=>M.status!=="pending",E=he=>{if(!R()){const te=new d0(he);ze(te),u.onCancel?.(te)}},l=()=>{m=!0},O=()=>{m=!1},Y=()=>z1.isFocused()&&(u.networkMode==="always"||Uy.isOnline())&&u.canRun(),ie=()=>k1(u.networkMode)&&u.canRun(),ne=he=>{R()||(S?.(),M.resolve(he))},ze=he=>{R()||(S?.(),M.reject(he))},Ce=()=>new Promise(he=>{S=te=>{(R()||Y())&&he(te)},u.onPause?.()}).then(()=>{S=void 0,R()||u.onContinue?.()}),be=()=>{if(R())return;let he;const te=v===0?u.initialPromise:void 0;try{he=te??u.fn()}catch(ve){he=Promise.reject(ve)}Promise.resolve(he).then(ne).catch(ve=>{if(R())return;const qe=u.retry??(a_?0:3),lt=u.retryDelay??OA,Pt=typeof lt=="function"?lt(v,ve):lt,Et=qe===!0||typeof qe=="number"&&v<qe||typeof qe=="function"&&qe(v,ve);if(m||!Et){ze(ve);return}v++,u.onFail?.(v,ve),zA(Pt).then(()=>Y()?void 0:Ce()).then(()=>{m?ze(ve):be()})})};return{promise:M,status:()=>M.status,cancel:E,continue:()=>(S?.(),M),cancelRetry:l,continueRetry:O,canStart:ie,start:()=>(ie()?be():Ce().then(be),M)}}var D1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),EA(this.gcTime)&&(this.#e=c0.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(u){this.gcTime=Math.max(this.gcTime||0,u??(a_?1/0:300*1e3))}clearGcTimeout(){this.#e&&(c0.clearTimeout(this.#e),this.#e=void 0)}},BA=class extends D1{#e;#t;#n;#r;#i;#s;#o;constructor(u){super(),this.#o=!1,this.#s=u.defaultOptions,this.setOptions(u.options),this.observers=[],this.#r=u.client,this.#n=this.#r.getQueryCache(),this.queryKey=u.queryKey,this.queryHash=u.queryHash,this.#e=gv(this.options),this.state=u.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(u){if(this.options={...this.#s,...u},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const m=gv(this.options);m.data!==void 0&&(this.setState(mv(m.data,m.dataUpdatedAt)),this.#e=m)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(u,m){const v=kA(this.state.data,u,this.options);return this.#a({data:v,type:"success",dataUpdatedAt:m?.updatedAt,manual:m?.manual}),v}setState(u,m){this.#a({type:"setState",state:u,setStateOptions:m})}cancel(u){const m=this.#i?.promise;return this.#i?.cancel(u),m?m.then(Jl).catch(Jl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(u=>CA(u.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===K0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(u=>u0(u.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(u=>u.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(u=0){return this.state.data===void 0?!0:u==="static"?!1:this.state.isInvalidated?!0:!MA(this.state.dataUpdatedAt,u)}onFocus(){this.observers.find(m=>m.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(m=>m.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(u){this.observers.includes(u)||(this.observers.push(u),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:u}))}removeObserver(u){this.observers.includes(u)&&(this.observers=this.observers.filter(m=>m!==u),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:u}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(u,m){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&m?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(u&&this.setOptions(u),!this.options.queryFn){const l=this.observers.find(O=>O.options.queryFn);l&&this.setOptions(l.options)}const v=new AbortController,S=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#o=!0,v.signal)})},M=()=>{const l=A1(this.options,m),Y=(()=>{const ie={client:this.#r,queryKey:this.queryKey,meta:this.meta};return S(ie),ie})();return this.#o=!1,this.options.persister?this.options.persister(l,Y,this):l(Y)},E=(()=>{const l={fetchOptions:m,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:M};return S(l),l})();this.options.behavior?.onFetch(E,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==E.fetchOptions?.meta)&&this.#a({type:"fetch",meta:E.fetchOptions?.meta}),this.#i=P1({initialPromise:m?.initialPromise,fn:E.fetchFn,onCancel:l=>{l instanceof d0&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),v.abort()},onFail:(l,O)=>{this.#a({type:"failed",failureCount:l,error:O})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:E.options.retry,retryDelay:E.options.retryDelay,networkMode:E.options.networkMode,canRun:()=>!0});try{const l=await this.#i.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#n.config.onSuccess?.(l,this),this.#n.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof d0){if(l.silent)return this.#i.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#a({type:"error",error:l}),this.#n.config.onError?.(l,this),this.#n.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#a(u){const m=v=>{switch(u.type){case"failed":return{...v,fetchFailureCount:u.failureCount,fetchFailureReason:u.error};case"pause":return{...v,fetchStatus:"paused"};case"continue":return{...v,fetchStatus:"fetching"};case"fetch":return{...v,...FA(v.data,this.options),fetchMeta:u.meta??null};case"success":const S={...v,...mv(u.data,u.dataUpdatedAt),dataUpdateCount:v.dataUpdateCount+1,...!u.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=u.manual?S:void 0,S;case"error":const M=u.error;return{...v,error:M,errorUpdateCount:v.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:v.fetchFailureCount+1,fetchFailureReason:M,fetchStatus:"idle",status:"error"};case"invalidate":return{...v,isInvalidated:!0};case"setState":return{...v,...u.state}}};this.state=m(this.state),Ds.batch(()=>{this.observers.forEach(v=>{v.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:u})})}};function FA(u,m){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:k1(m.networkMode)?"fetching":"paused",...u===void 0&&{error:null,status:"pending"}}}function mv(u,m){return{data:u,dataUpdatedAt:m??Date.now(),error:null,isInvalidated:!1,status:"success"}}function gv(u){const m=typeof u.initialData=="function"?u.initialData():u.initialData,v=m!==void 0,S=v?typeof u.initialDataUpdatedAt=="function"?u.initialDataUpdatedAt():u.initialDataUpdatedAt:0;return{data:m,dataUpdateCount:0,dataUpdatedAt:v?S??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:v?"success":"pending",fetchStatus:"idle"}}function yv(u){return{onFetch:(m,v)=>{const S=m.options,M=m.fetchOptions?.meta?.fetchMore?.direction,R=m.state.data?.pages||[],E=m.state.data?.pageParams||[];let l={pages:[],pageParams:[]},O=0;const Y=async()=>{let ie=!1;const ne=be=>{Object.defineProperty(be,"signal",{enumerable:!0,get:()=>(m.signal.aborted?ie=!0:m.signal.addEventListener("abort",()=>{ie=!0}),m.signal)})},ze=A1(m.options,m.fetchOptions),Ce=async(be,he,te)=>{if(ie)return Promise.reject();if(he==null&&be.pages.length)return Promise.resolve(be);const qe=(()=>{const St={client:m.client,queryKey:m.queryKey,pageParam:he,direction:te?"backward":"forward",meta:m.options.meta};return ne(St),St})(),lt=await ze(qe),{maxPages:Pt}=m.options,Et=te?DA:PA;return{pages:Et(be.pages,lt,Pt),pageParams:Et(be.pageParams,he,Pt)}};if(M&&R.length){const be=M==="backward",he=be?UA:_v,te={pages:R,pageParams:E},ve=he(S,te);l=await Ce(te,ve,be)}else{const be=u??R.length;do{const he=O===0?E[0]??S.initialPageParam:_v(S,l);if(O>0&&he==null)break;l=await Ce(l,he),O++}while(O<be)}return l};m.options.persister?m.fetchFn=()=>m.options.persister?.(Y,{client:m.client,queryKey:m.queryKey,meta:m.options.meta,signal:m.signal},v):m.fetchFn=Y}}}function _v(u,{pages:m,pageParams:v}){const S=m.length-1;return m.length>0?u.getNextPageParam(m[S],m,v[S],v):void 0}function UA(u,{pages:m,pageParams:v}){return m.length>0?u.getPreviousPageParam?.(m[0],m,v[0],v):void 0}var VA=class extends D1{#e;#t;#n;#r;constructor(u){super(),this.#e=u.client,this.mutationId=u.mutationId,this.#n=u.mutationCache,this.#t=[],this.state=u.state||qA(),this.setOptions(u.options),this.scheduleGc()}setOptions(u){this.options=u,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(u){this.#t.includes(u)||(this.#t.push(u),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:u}))}removeObserver(u){this.#t=this.#t.filter(m=>m!==u),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:u})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(u){const m=()=>{this.#i({type:"continue"})},v={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=P1({fn:()=>this.options.mutationFn?this.options.mutationFn(u,v):Promise.reject(new Error("No mutationFn found")),onFail:(R,E)=>{this.#i({type:"failed",failureCount:R,error:E})},onPause:()=>{this.#i({type:"pause"})},onContinue:m,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const S=this.state.status==="pending",M=!this.#r.canStart();try{if(S)m();else{this.#i({type:"pending",variables:u,isPaused:M}),await this.#n.config.onMutate?.(u,this,v);const E=await this.options.onMutate?.(u,v);E!==this.state.context&&this.#i({type:"pending",context:E,variables:u,isPaused:M})}const R=await this.#r.start();return await this.#n.config.onSuccess?.(R,u,this.state.context,this,v),await this.options.onSuccess?.(R,u,this.state.context,v),await this.#n.config.onSettled?.(R,null,this.state.variables,this.state.context,this,v),await this.options.onSettled?.(R,null,u,this.state.context,v),this.#i({type:"success",data:R}),R}catch(R){try{throw await this.#n.config.onError?.(R,u,this.state.context,this,v),await this.options.onError?.(R,u,this.state.context,v),await this.#n.config.onSettled?.(void 0,R,this.state.variables,this.state.context,this,v),await this.options.onSettled?.(void 0,R,u,this.state.context,v),R}finally{this.#i({type:"error",error:R})}}finally{this.#n.runNext(this)}}#i(u){const m=v=>{switch(u.type){case"failed":return{...v,failureCount:u.failureCount,failureReason:u.error};case"pause":return{...v,isPaused:!0};case"continue":return{...v,isPaused:!1};case"pending":return{...v,context:u.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:u.isPaused,status:"pending",variables:u.variables,submittedAt:Date.now()};case"success":return{...v,data:u.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...v,data:void 0,error:u.error,failureCount:v.failureCount+1,failureReason:u.error,isPaused:!1,status:"error"}}};this.state=m(this.state),Ds.batch(()=>{this.#t.forEach(v=>{v.onMutationUpdate(u)}),this.#n.notify({mutation:this,type:"updated",action:u})})}};function qA(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var GA=class extends r_{constructor(u={}){super(),this.config=u,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(u,m,v){const S=new VA({client:u,mutationCache:this,mutationId:++this.#n,options:u.defaultMutationOptions(m),state:v});return this.add(S),S}add(u){this.#e.add(u);const m=My(u);if(typeof m=="string"){const v=this.#t.get(m);v?v.push(u):this.#t.set(m,[u])}this.notify({type:"added",mutation:u})}remove(u){if(this.#e.delete(u)){const m=My(u);if(typeof m=="string"){const v=this.#t.get(m);if(v)if(v.length>1){const S=v.indexOf(u);S!==-1&&v.splice(S,1)}else v[0]===u&&this.#t.delete(m)}}this.notify({type:"removed",mutation:u})}canRun(u){const m=My(u);if(typeof m=="string"){const S=this.#t.get(m)?.find(M=>M.state.status==="pending");return!S||S===u}else return!0}runNext(u){const m=My(u);return typeof m=="string"?this.#t.get(m)?.find(S=>S!==u&&S.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Ds.batch(()=>{this.#e.forEach(u=>{this.notify({type:"removed",mutation:u})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(u){const m={exact:!0,...u};return this.getAll().find(v=>dv(m,v))}findAll(u={}){return this.getAll().filter(m=>dv(u,m))}notify(u){Ds.batch(()=>{this.listeners.forEach(m=>{m(u)})})}resumePausedMutations(){const u=this.getAll().filter(m=>m.state.isPaused);return Ds.batch(()=>Promise.all(u.map(m=>m.continue().catch(Jl))))}};function My(u){return u.options.scope?.id}var $A=class extends r_{constructor(u={}){super(),this.config=u,this.#e=new Map}#e;build(u,m,v){const S=m.queryKey,M=m.queryHash??Y0(S,m);let R=this.get(M);return R||(R=new BA({client:u,queryKey:S,queryHash:M,options:u.defaultQueryOptions(m),state:v,defaultOptions:u.getQueryDefaults(S)}),this.add(R)),R}add(u){this.#e.has(u.queryHash)||(this.#e.set(u.queryHash,u),this.notify({type:"added",query:u}))}remove(u){const m=this.#e.get(u.queryHash);m&&(u.destroy(),m===u&&this.#e.delete(u.queryHash),this.notify({type:"removed",query:u}))}clear(){Ds.batch(()=>{this.getAll().forEach(u=>{this.remove(u)})})}get(u){return this.#e.get(u)}getAll(){return[...this.#e.values()]}find(u){const m={exact:!0,...u};return this.getAll().find(v=>hv(m,v))}findAll(u={}){const m=this.getAll();return Object.keys(u).length>0?m.filter(v=>hv(u,v)):m}notify(u){Ds.batch(()=>{this.listeners.forEach(m=>{m(u)})})}onFocus(){Ds.batch(()=>{this.getAll().forEach(u=>{u.onFocus()})})}onOnline(){Ds.batch(()=>{this.getAll().forEach(u=>{u.onOnline()})})}},HA=class{#e;#t;#n;#r;#i;#s;#o;#a;constructor(u={}){this.#e=u.queryCache||new $A,this.#t=u.mutationCache||new GA,this.#n=u.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#o=z1.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=Uy.subscribe(async u=>{u&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(u){return this.#e.findAll({...u,fetchStatus:"fetching"}).length}isMutating(u){return this.#t.findAll({...u,status:"pending"}).length}getQueryData(u){const m=this.defaultQueryOptions({queryKey:u});return this.#e.get(m.queryHash)?.state.data}ensureQueryData(u){const m=this.defaultQueryOptions(u),v=this.#e.build(this,m),S=v.state.data;return S===void 0?this.fetchQuery(u):(u.revalidateIfStale&&v.isStaleByTime(u0(m.staleTime,v))&&this.prefetchQuery(m),Promise.resolve(S))}getQueriesData(u){return this.#e.findAll(u).map(({queryKey:m,state:v})=>{const S=v.data;return[m,S]})}setQueryData(u,m,v){const S=this.defaultQueryOptions({queryKey:u}),R=this.#e.get(S.queryHash)?.state.data,E=TA(m,R);if(E!==void 0)return this.#e.build(this,S).setData(E,{...v,manual:!0})}setQueriesData(u,m,v){return Ds.batch(()=>this.#e.findAll(u).map(({queryKey:S})=>[S,this.setQueryData(S,m,v)]))}getQueryState(u){const m=this.defaultQueryOptions({queryKey:u});return this.#e.get(m.queryHash)?.state}removeQueries(u){const m=this.#e;Ds.batch(()=>{m.findAll(u).forEach(v=>{m.remove(v)})})}resetQueries(u,m){const v=this.#e;return Ds.batch(()=>(v.findAll(u).forEach(S=>{S.reset()}),this.refetchQueries({type:"active",...u},m)))}cancelQueries(u,m={}){const v={revert:!0,...m},S=Ds.batch(()=>this.#e.findAll(u).map(M=>M.cancel(v)));return Promise.all(S).then(Jl).catch(Jl)}invalidateQueries(u,m={}){return Ds.batch(()=>(this.#e.findAll(u).forEach(v=>{v.invalidate()}),u?.refetchType==="none"?Promise.resolve():this.refetchQueries({...u,type:u?.refetchType??u?.type??"active"},m)))}refetchQueries(u,m={}){const v={...m,cancelRefetch:m.cancelRefetch??!0},S=Ds.batch(()=>this.#e.findAll(u).filter(M=>!M.isDisabled()&&!M.isStatic()).map(M=>{let R=M.fetch(void 0,v);return v.throwOnError||(R=R.catch(Jl)),M.state.fetchStatus==="paused"?Promise.resolve():R}));return Promise.all(S).then(Jl)}fetchQuery(u){const m=this.defaultQueryOptions(u);m.retry===void 0&&(m.retry=!1);const v=this.#e.build(this,m);return v.isStaleByTime(u0(m.staleTime,v))?v.fetch(m):Promise.resolve(v.state.data)}prefetchQuery(u){return this.fetchQuery(u).then(Jl).catch(Jl)}fetchInfiniteQuery(u){return u.behavior=yv(u.pages),this.fetchQuery(u)}prefetchInfiniteQuery(u){return this.fetchInfiniteQuery(u).then(Jl).catch(Jl)}ensureInfiniteQueryData(u){return u.behavior=yv(u.pages),this.ensureQueryData(u)}resumePausedMutations(){return Uy.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(u){this.#n=u}setQueryDefaults(u,m){this.#r.set(_g(u),{queryKey:u,defaultOptions:m})}getQueryDefaults(u){const m=[...this.#r.values()],v={};return m.forEach(S=>{xg(u,S.queryKey)&&Object.assign(v,S.defaultOptions)}),v}setMutationDefaults(u,m){this.#i.set(_g(u),{mutationKey:u,defaultOptions:m})}getMutationDefaults(u){const m=[...this.#i.values()],v={};return m.forEach(S=>{xg(u,S.mutationKey)&&Object.assign(v,S.defaultOptions)}),v}defaultQueryOptions(u){if(u._defaulted)return u;const m={...this.#n.queries,...this.getQueryDefaults(u.queryKey),...u,_defaulted:!0};return m.queryHash||(m.queryHash=Y0(m.queryKey,m)),m.refetchOnReconnect===void 0&&(m.refetchOnReconnect=m.networkMode!=="always"),m.throwOnError===void 0&&(m.throwOnError=!!m.suspense),!m.networkMode&&m.persister&&(m.networkMode="offlineFirst"),m.queryFn===K0&&(m.enabled=!1),m}defaultMutationOptions(u){return u?._defaulted?u:{...this.#n.mutations,...u?.mutationKey&&this.getMutationDefaults(u.mutationKey),...u,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},ZA=me.createContext(void 0),XA=({client:u,children:m})=>(me.useEffect(()=>(u.mount(),()=>{u.unmount()}),[u]),k.jsx(ZA.Provider,{value:u,children:m}));const YA=new HA;iw.createRoot(document.getElementById("root")).render(k.jsx(p0.StrictMode,{children:k.jsx(XA,{client:YA,children:k.jsx(lM,{children:k.jsx(vA,{})})})}));
