(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const O of document.querySelectorAll('link[rel="modulepreload"]'))M(O);new MutationObserver(O=>{for(const j of O)if(j.type==="childList")for(const D of j.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&M(D)}).observe(document,{childList:!0,subtree:!0});function T(O){const j={};return O.integrity&&(j.integrity=O.integrity),O.referrerPolicy&&(j.referrerPolicy=O.referrerPolicy),O.crossOrigin==="use-credentials"?j.credentials="include":O.crossOrigin==="anonymous"?j.credentials="omit":j.credentials="same-origin",j}function M(O){if(O.ep)return;O.ep=!0;const j=T(O);fetch(O.href,j)}})();function Yy(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var hy={exports:{}},Jm={};var X0;function g1(){if(X0)return Jm;X0=1;var f=Symbol.for("react.transitional.element"),_=Symbol.for("react.fragment");function T(M,O,j){var D=null;if(j!==void 0&&(D=""+j),O.key!==void 0&&(D=""+O.key),"key"in O){j={};for(var u in O)u!=="key"&&(j[u]=O[u])}else j=O;return O=j.ref,{$$typeof:f,type:M,key:D,ref:O!==void 0?O:null,props:j}}return Jm.Fragment=_,Jm.jsx=T,Jm.jsxs=T,Jm}var Y0;function _1(){return Y0||(Y0=1,hy.exports=g1()),hy.exports}var ne=_1(),dy={exports:{}},Fi={};var W0;function y1(){if(W0)return Fi;W0=1;var f=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),O=Symbol.for("react.profiler"),j=Symbol.for("react.consumer"),D=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),te=Symbol.for("react.memo"),fe=Symbol.for("react.lazy"),ue=Symbol.for("react.activity"),De=Symbol.iterator;function Pe(_e){return _e===null||typeof _e!="object"?null:(_e=De&&_e[De]||_e["@@iterator"],typeof _e=="function"?_e:null)}var je={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},be=Object.assign,de={};function He(_e,Ue,yt){this.props=_e,this.context=Ue,this.refs=de,this.updater=yt||je}He.prototype.isReactComponent={},He.prototype.setState=function(_e,Ue){if(typeof _e!="object"&&typeof _e!="function"&&_e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_e,Ue,"setState")},He.prototype.forceUpdate=function(_e){this.updater.enqueueForceUpdate(this,_e,"forceUpdate")};function ut(){}ut.prototype=He.prototype;function Fe(_e,Ue,yt){this.props=_e,this.context=Ue,this.refs=de,this.updater=yt||je}var Ut=Fe.prototype=new ut;Ut.constructor=Fe,be(Ut,He.prototype),Ut.isPureReactComponent=!0;var Rt=Array.isArray;function dt(){}var rt={H:null,A:null,T:null,S:null},Ct=Object.prototype.hasOwnProperty;function jt(_e,Ue,yt){var Pt=yt.ref;return{$$typeof:f,type:_e,key:Ue,ref:Pt!==void 0?Pt:null,props:yt}}function Ht(_e,Ue){return jt(_e.type,Ue,_e.props)}function Ot(_e){return typeof _e=="object"&&_e!==null&&_e.$$typeof===f}function Yt(_e){var Ue={"=":"=0",":":"=2"};return"$"+_e.replace(/[=:]/g,function(yt){return Ue[yt]})}var si=/\/+/g;function oi(_e,Ue){return typeof _e=="object"&&_e!==null&&_e.key!=null?Yt(""+_e.key):Ue.toString(36)}function wt(_e){switch(_e.status){case"fulfilled":return _e.value;case"rejected":throw _e.reason;default:switch(typeof _e.status=="string"?_e.then(dt,dt):(_e.status="pending",_e.then(function(Ue){_e.status==="pending"&&(_e.status="fulfilled",_e.value=Ue)},function(Ue){_e.status==="pending"&&(_e.status="rejected",_e.reason=Ue)})),_e.status){case"fulfilled":return _e.value;case"rejected":throw _e.reason}}throw _e}function ze(_e,Ue,yt,Pt,Dt){var Lt=typeof _e;(Lt==="undefined"||Lt==="boolean")&&(_e=null);var Kt=!1;if(_e===null)Kt=!0;else switch(Lt){case"bigint":case"string":case"number":Kt=!0;break;case"object":switch(_e.$$typeof){case f:case _:Kt=!0;break;case fe:return Kt=_e._init,ze(Kt(_e._payload),Ue,yt,Pt,Dt)}}if(Kt)return Dt=Dt(_e),Kt=Pt===""?"."+oi(_e,0):Pt,Rt(Dt)?(yt="",Kt!=null&&(yt=Kt.replace(si,"$&/")+"/"),ze(Dt,Ue,yt,"",function(mn){return mn})):Dt!=null&&(Ot(Dt)&&(Dt=Ht(Dt,yt+(Dt.key==null||_e&&_e.key===Dt.key?"":(""+Dt.key).replace(si,"$&/")+"/")+Kt)),Ue.push(Dt)),1;Kt=0;var ui=Pt===""?".":Pt+":";if(Rt(_e))for(var Ai=0;Ai<_e.length;Ai++)Pt=_e[Ai],Lt=ui+oi(Pt,Ai),Kt+=ze(Pt,Ue,yt,Lt,Dt);else if(Ai=Pe(_e),typeof Ai=="function")for(_e=Ai.call(_e),Ai=0;!(Pt=_e.next()).done;)Pt=Pt.value,Lt=ui+oi(Pt,Ai++),Kt+=ze(Pt,Ue,yt,Lt,Dt);else if(Lt==="object"){if(typeof _e.then=="function")return ze(wt(_e),Ue,yt,Pt,Dt);throw Ue=String(_e),Error("Objects are not valid as a React child (found: "+(Ue==="[object Object]"?"object with keys {"+Object.keys(_e).join(", ")+"}":Ue)+"). If you meant to render a collection of children, use an array instead.")}return Kt}function Je(_e,Ue,yt){if(_e==null)return _e;var Pt=[],Dt=0;return ze(_e,Pt,"","",function(Lt){return Ue.call(yt,Lt,Dt++)}),Pt}function st(_e){if(_e._status===-1){var Ue=_e._result;Ue=Ue(),Ue.then(function(yt){(_e._status===0||_e._status===-1)&&(_e._status=1,_e._result=yt)},function(yt){(_e._status===0||_e._status===-1)&&(_e._status=2,_e._result=yt)}),_e._status===-1&&(_e._status=0,_e._result=Ue)}if(_e._status===1)return _e._result.default;throw _e._result}var Et=typeof reportError=="function"?reportError:function(_e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ue=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof _e=="object"&&_e!==null&&typeof _e.message=="string"?String(_e.message):String(_e),error:_e});if(!window.dispatchEvent(Ue))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",_e);return}console.error(_e)},lt={map:Je,forEach:function(_e,Ue,yt){Je(_e,function(){Ue.apply(this,arguments)},yt)},count:function(_e){var Ue=0;return Je(_e,function(){Ue++}),Ue},toArray:function(_e){return Je(_e,function(Ue){return Ue})||[]},only:function(_e){if(!Ot(_e))throw Error("React.Children.only expected to receive a single React element child.");return _e}};return Fi.Activity=ue,Fi.Children=lt,Fi.Component=He,Fi.Fragment=T,Fi.Profiler=O,Fi.PureComponent=Fe,Fi.StrictMode=M,Fi.Suspense=V,Fi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=rt,Fi.__COMPILER_RUNTIME={__proto__:null,c:function(_e){return rt.H.useMemoCache(_e)}},Fi.cache=function(_e){return function(){return _e.apply(null,arguments)}},Fi.cacheSignal=function(){return null},Fi.cloneElement=function(_e,Ue,yt){if(_e==null)throw Error("The argument must be a React element, but you passed "+_e+".");var Pt=be({},_e.props),Dt=_e.key;if(Ue!=null)for(Lt in Ue.key!==void 0&&(Dt=""+Ue.key),Ue)!Ct.call(Ue,Lt)||Lt==="key"||Lt==="__self"||Lt==="__source"||Lt==="ref"&&Ue.ref===void 0||(Pt[Lt]=Ue[Lt]);var Lt=arguments.length-2;if(Lt===1)Pt.children=yt;else if(1<Lt){for(var Kt=Array(Lt),ui=0;ui<Lt;ui++)Kt[ui]=arguments[ui+2];Pt.children=Kt}return jt(_e.type,Dt,Pt)},Fi.createContext=function(_e){return _e={$$typeof:D,_currentValue:_e,_currentValue2:_e,_threadCount:0,Provider:null,Consumer:null},_e.Provider=_e,_e.Consumer={$$typeof:j,_context:_e},_e},Fi.createElement=function(_e,Ue,yt){var Pt,Dt={},Lt=null;if(Ue!=null)for(Pt in Ue.key!==void 0&&(Lt=""+Ue.key),Ue)Ct.call(Ue,Pt)&&Pt!=="key"&&Pt!=="__self"&&Pt!=="__source"&&(Dt[Pt]=Ue[Pt]);var Kt=arguments.length-2;if(Kt===1)Dt.children=yt;else if(1<Kt){for(var ui=Array(Kt),Ai=0;Ai<Kt;Ai++)ui[Ai]=arguments[Ai+2];Dt.children=ui}if(_e&&_e.defaultProps)for(Pt in Kt=_e.defaultProps,Kt)Dt[Pt]===void 0&&(Dt[Pt]=Kt[Pt]);return jt(_e,Lt,Dt)},Fi.createRef=function(){return{current:null}},Fi.forwardRef=function(_e){return{$$typeof:u,render:_e}},Fi.isValidElement=Ot,Fi.lazy=function(_e){return{$$typeof:fe,_payload:{_status:-1,_result:_e},_init:st}},Fi.memo=function(_e,Ue){return{$$typeof:te,type:_e,compare:Ue===void 0?null:Ue}},Fi.startTransition=function(_e){var Ue=rt.T,yt={};rt.T=yt;try{var Pt=_e(),Dt=rt.S;Dt!==null&&Dt(yt,Pt),typeof Pt=="object"&&Pt!==null&&typeof Pt.then=="function"&&Pt.then(dt,Et)}catch(Lt){Et(Lt)}finally{Ue!==null&&yt.types!==null&&(Ue.types=yt.types),rt.T=Ue}},Fi.unstable_useCacheRefresh=function(){return rt.H.useCacheRefresh()},Fi.use=function(_e){return rt.H.use(_e)},Fi.useActionState=function(_e,Ue,yt){return rt.H.useActionState(_e,Ue,yt)},Fi.useCallback=function(_e,Ue){return rt.H.useCallback(_e,Ue)},Fi.useContext=function(_e){return rt.H.useContext(_e)},Fi.useDebugValue=function(){},Fi.useDeferredValue=function(_e,Ue){return rt.H.useDeferredValue(_e,Ue)},Fi.useEffect=function(_e,Ue){return rt.H.useEffect(_e,Ue)},Fi.useEffectEvent=function(_e){return rt.H.useEffectEvent(_e)},Fi.useId=function(){return rt.H.useId()},Fi.useImperativeHandle=function(_e,Ue,yt){return rt.H.useImperativeHandle(_e,Ue,yt)},Fi.useInsertionEffect=function(_e,Ue){return rt.H.useInsertionEffect(_e,Ue)},Fi.useLayoutEffect=function(_e,Ue){return rt.H.useLayoutEffect(_e,Ue)},Fi.useMemo=function(_e,Ue){return rt.H.useMemo(_e,Ue)},Fi.useOptimistic=function(_e,Ue){return rt.H.useOptimistic(_e,Ue)},Fi.useReducer=function(_e,Ue,yt){return rt.H.useReducer(_e,Ue,yt)},Fi.useRef=function(_e){return rt.H.useRef(_e)},Fi.useState=function(_e){return rt.H.useState(_e)},Fi.useSyncExternalStore=function(_e,Ue,yt){return rt.H.useSyncExternalStore(_e,Ue,yt)},Fi.useTransition=function(){return rt.H.useTransition()},Fi.version="19.2.3",Fi}var K0;function Wy(){return K0||(K0=1,dy.exports=y1()),dy.exports}var ht=Wy();const Up=Yy(ht);var fy={exports:{}},eg={},py={exports:{}},my={};var Q0;function v1(){return Q0||(Q0=1,(function(f){function _(ze,Je){var st=ze.length;ze.push(Je);e:for(;0<st;){var Et=st-1>>>1,lt=ze[Et];if(0<O(lt,Je))ze[Et]=Je,ze[st]=lt,st=Et;else break e}}function T(ze){return ze.length===0?null:ze[0]}function M(ze){if(ze.length===0)return null;var Je=ze[0],st=ze.pop();if(st!==Je){ze[0]=st;e:for(var Et=0,lt=ze.length,_e=lt>>>1;Et<_e;){var Ue=2*(Et+1)-1,yt=ze[Ue],Pt=Ue+1,Dt=ze[Pt];if(0>O(yt,st))Pt<lt&&0>O(Dt,yt)?(ze[Et]=Dt,ze[Pt]=st,Et=Pt):(ze[Et]=yt,ze[Ue]=st,Et=Ue);else if(Pt<lt&&0>O(Dt,st))ze[Et]=Dt,ze[Pt]=st,Et=Pt;else break e}}return Je}function O(ze,Je){var st=ze.sortIndex-Je.sortIndex;return st!==0?st:ze.id-Je.id}if(f.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var j=performance;f.unstable_now=function(){return j.now()}}else{var D=Date,u=D.now();f.unstable_now=function(){return D.now()-u}}var V=[],te=[],fe=1,ue=null,De=3,Pe=!1,je=!1,be=!1,de=!1,He=typeof setTimeout=="function"?setTimeout:null,ut=typeof clearTimeout=="function"?clearTimeout:null,Fe=typeof setImmediate<"u"?setImmediate:null;function Ut(ze){for(var Je=T(te);Je!==null;){if(Je.callback===null)M(te);else if(Je.startTime<=ze)M(te),Je.sortIndex=Je.expirationTime,_(V,Je);else break;Je=T(te)}}function Rt(ze){if(be=!1,Ut(ze),!je)if(T(V)!==null)je=!0,dt||(dt=!0,Yt());else{var Je=T(te);Je!==null&&wt(Rt,Je.startTime-ze)}}var dt=!1,rt=-1,Ct=5,jt=-1;function Ht(){return de?!0:!(f.unstable_now()-jt<Ct)}function Ot(){if(de=!1,dt){var ze=f.unstable_now();jt=ze;var Je=!0;try{e:{je=!1,be&&(be=!1,ut(rt),rt=-1),Pe=!0;var st=De;try{t:{for(Ut(ze),ue=T(V);ue!==null&&!(ue.expirationTime>ze&&Ht());){var Et=ue.callback;if(typeof Et=="function"){ue.callback=null,De=ue.priorityLevel;var lt=Et(ue.expirationTime<=ze);if(ze=f.unstable_now(),typeof lt=="function"){ue.callback=lt,Ut(ze),Je=!0;break t}ue===T(V)&&M(V),Ut(ze)}else M(V);ue=T(V)}if(ue!==null)Je=!0;else{var _e=T(te);_e!==null&&wt(Rt,_e.startTime-ze),Je=!1}}break e}finally{ue=null,De=st,Pe=!1}Je=void 0}}finally{Je?Yt():dt=!1}}}var Yt;if(typeof Fe=="function")Yt=function(){Fe(Ot)};else if(typeof MessageChannel<"u"){var si=new MessageChannel,oi=si.port2;si.port1.onmessage=Ot,Yt=function(){oi.postMessage(null)}}else Yt=function(){He(Ot,0)};function wt(ze,Je){rt=He(function(){ze(f.unstable_now())},Je)}f.unstable_IdlePriority=5,f.unstable_ImmediatePriority=1,f.unstable_LowPriority=4,f.unstable_NormalPriority=3,f.unstable_Profiling=null,f.unstable_UserBlockingPriority=2,f.unstable_cancelCallback=function(ze){ze.callback=null},f.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ct=0<ze?Math.floor(1e3/ze):5},f.unstable_getCurrentPriorityLevel=function(){return De},f.unstable_next=function(ze){switch(De){case 1:case 2:case 3:var Je=3;break;default:Je=De}var st=De;De=Je;try{return ze()}finally{De=st}},f.unstable_requestPaint=function(){de=!0},f.unstable_runWithPriority=function(ze,Je){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var st=De;De=ze;try{return Je()}finally{De=st}},f.unstable_scheduleCallback=function(ze,Je,st){var Et=f.unstable_now();switch(typeof st=="object"&&st!==null?(st=st.delay,st=typeof st=="number"&&0<st?Et+st:Et):st=Et,ze){case 1:var lt=-1;break;case 2:lt=250;break;case 5:lt=1073741823;break;case 4:lt=1e4;break;default:lt=5e3}return lt=st+lt,ze={id:fe++,callback:Je,priorityLevel:ze,startTime:st,expirationTime:lt,sortIndex:-1},st>Et?(ze.sortIndex=st,_(te,ze),T(V)===null&&ze===T(te)&&(be?(ut(rt),rt=-1):be=!0,wt(Rt,st-Et))):(ze.sortIndex=lt,_(V,ze),je||Pe||(je=!0,dt||(dt=!0,Yt()))),ze},f.unstable_shouldYield=Ht,f.unstable_wrapCallback=function(ze){var Je=De;return function(){var st=De;De=Je;try{return ze.apply(this,arguments)}finally{De=st}}}})(my)),my}var J0;function x1(){return J0||(J0=1,py.exports=v1()),py.exports}var gy={exports:{}},Ys={};var ev;function b1(){if(ev)return Ys;ev=1;var f=Wy();function _(V){var te="https://react.dev/errors/"+V;if(1<arguments.length){te+="?args[]="+encodeURIComponent(arguments[1]);for(var fe=2;fe<arguments.length;fe++)te+="&args[]="+encodeURIComponent(arguments[fe])}return"Minified React error #"+V+"; visit "+te+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function T(){}var M={d:{f:T,r:function(){throw Error(_(522))},D:T,C:T,L:T,m:T,X:T,S:T,M:T},p:0,findDOMNode:null},O=Symbol.for("react.portal");function j(V,te,fe){var ue=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O,key:ue==null?null:""+ue,children:V,containerInfo:te,implementation:fe}}var D=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(V,te){if(V==="font")return"";if(typeof te=="string")return te==="use-credentials"?te:""}return Ys.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,Ys.createPortal=function(V,te){var fe=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!te||te.nodeType!==1&&te.nodeType!==9&&te.nodeType!==11)throw Error(_(299));return j(V,te,null,fe)},Ys.flushSync=function(V){var te=D.T,fe=M.p;try{if(D.T=null,M.p=2,V)return V()}finally{D.T=te,M.p=fe,M.d.f()}},Ys.preconnect=function(V,te){typeof V=="string"&&(te?(te=te.crossOrigin,te=typeof te=="string"?te==="use-credentials"?te:"":void 0):te=null,M.d.C(V,te))},Ys.prefetchDNS=function(V){typeof V=="string"&&M.d.D(V)},Ys.preinit=function(V,te){if(typeof V=="string"&&te&&typeof te.as=="string"){var fe=te.as,ue=u(fe,te.crossOrigin),De=typeof te.integrity=="string"?te.integrity:void 0,Pe=typeof te.fetchPriority=="string"?te.fetchPriority:void 0;fe==="style"?M.d.S(V,typeof te.precedence=="string"?te.precedence:void 0,{crossOrigin:ue,integrity:De,fetchPriority:Pe}):fe==="script"&&M.d.X(V,{crossOrigin:ue,integrity:De,fetchPriority:Pe,nonce:typeof te.nonce=="string"?te.nonce:void 0})}},Ys.preinitModule=function(V,te){if(typeof V=="string")if(typeof te=="object"&&te!==null){if(te.as==null||te.as==="script"){var fe=u(te.as,te.crossOrigin);M.d.M(V,{crossOrigin:fe,integrity:typeof te.integrity=="string"?te.integrity:void 0,nonce:typeof te.nonce=="string"?te.nonce:void 0})}}else te==null&&M.d.M(V)},Ys.preload=function(V,te){if(typeof V=="string"&&typeof te=="object"&&te!==null&&typeof te.as=="string"){var fe=te.as,ue=u(fe,te.crossOrigin);M.d.L(V,fe,{crossOrigin:ue,integrity:typeof te.integrity=="string"?te.integrity:void 0,nonce:typeof te.nonce=="string"?te.nonce:void 0,type:typeof te.type=="string"?te.type:void 0,fetchPriority:typeof te.fetchPriority=="string"?te.fetchPriority:void 0,referrerPolicy:typeof te.referrerPolicy=="string"?te.referrerPolicy:void 0,imageSrcSet:typeof te.imageSrcSet=="string"?te.imageSrcSet:void 0,imageSizes:typeof te.imageSizes=="string"?te.imageSizes:void 0,media:typeof te.media=="string"?te.media:void 0})}},Ys.preloadModule=function(V,te){if(typeof V=="string")if(te){var fe=u(te.as,te.crossOrigin);M.d.m(V,{as:typeof te.as=="string"&&te.as!=="script"?te.as:void 0,crossOrigin:fe,integrity:typeof te.integrity=="string"?te.integrity:void 0})}else M.d.m(V)},Ys.requestFormReset=function(V){M.d.r(V)},Ys.unstable_batchedUpdates=function(V,te){return V(te)},Ys.useFormState=function(V,te,fe){return D.H.useFormState(V,te,fe)},Ys.useFormStatus=function(){return D.H.useHostTransitionStatus()},Ys.version="19.2.3",Ys}var tv;function qv(){if(tv)return gy.exports;tv=1;function f(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f)}catch(_){console.error(_)}}return f(),gy.exports=b1(),gy.exports}var iv;function w1(){if(iv)return eg;iv=1;var f=x1(),_=Wy(),T=qv();function M(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function O(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function j(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function D(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function u(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function V(r){if(j(r)!==r)throw Error(M(188))}function te(r){var s=r.alternate;if(!s){if(s=j(r),s===null)throw Error(M(188));return s!==r?null:r}for(var d=r,x=s;;){var P=d.return;if(P===null)break;var k=P.alternate;if(k===null){if(x=P.return,x!==null){d=x;continue}break}if(P.child===k.child){for(k=P.child;k;){if(k===d)return V(P),r;if(k===x)return V(P),s;k=k.sibling}throw Error(M(188))}if(d.return!==x.return)d=P,x=k;else{for(var X=!1,le=P.child;le;){if(le===d){X=!0,d=P,x=k;break}if(le===x){X=!0,x=P,d=k;break}le=le.sibling}if(!X){for(le=k.child;le;){if(le===d){X=!0,d=k,x=P;break}if(le===x){X=!0,x=k,d=P;break}le=le.sibling}if(!X)throw Error(M(189))}}if(d.alternate!==x)throw Error(M(190))}if(d.tag!==3)throw Error(M(188));return d.stateNode.current===d?r:s}function fe(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=fe(r),s!==null)return s;r=r.sibling}return null}var ue=Object.assign,De=Symbol.for("react.element"),Pe=Symbol.for("react.transitional.element"),je=Symbol.for("react.portal"),be=Symbol.for("react.fragment"),de=Symbol.for("react.strict_mode"),He=Symbol.for("react.profiler"),ut=Symbol.for("react.consumer"),Fe=Symbol.for("react.context"),Ut=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),dt=Symbol.for("react.suspense_list"),rt=Symbol.for("react.memo"),Ct=Symbol.for("react.lazy"),jt=Symbol.for("react.activity"),Ht=Symbol.for("react.memo_cache_sentinel"),Ot=Symbol.iterator;function Yt(r){return r===null||typeof r!="object"?null:(r=Ot&&r[Ot]||r["@@iterator"],typeof r=="function"?r:null)}var si=Symbol.for("react.client.reference");function oi(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===si?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case be:return"Fragment";case He:return"Profiler";case de:return"StrictMode";case Rt:return"Suspense";case dt:return"SuspenseList";case jt:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case je:return"Portal";case Fe:return r.displayName||"Context";case ut:return(r._context.displayName||"Context")+".Consumer";case Ut:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case rt:return s=r.displayName||null,s!==null?s:oi(r.type)||"Memo";case Ct:s=r._payload,r=r._init;try{return oi(r(s))}catch{}}return null}var wt=Array.isArray,ze=_.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Je=T.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,st={pending:!1,data:null,method:null,action:null},Et=[],lt=-1;function _e(r){return{current:r}}function Ue(r){0>lt||(r.current=Et[lt],Et[lt]=null,lt--)}function yt(r,s){lt++,Et[lt]=r.current,r.current=s}var Pt=_e(null),Dt=_e(null),Lt=_e(null),Kt=_e(null);function ui(r,s){switch(yt(Lt,s),yt(Dt,r),yt(Pt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?Eu(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=Eu(s),r=Pm(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Ue(Pt),yt(Pt,r)}function Ai(){Ue(Pt),Ue(Dt),Ue(Lt)}function mn(r){r.memoizedState!==null&&yt(Kt,r);var s=Pt.current,d=Pm(s,r.type);s!==d&&(yt(Dt,r),yt(Pt,d))}function vr(r){Dt.current===r&&(Ue(Pt),Ue(Dt)),Kt.current===r&&(Ue(Kt),pd._currentValue=st)}var tn,ar;function Gi(r){if(tn===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);tn=s&&s[1]||"",ar=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tn+r+ar}var Fn=!1;function Jn(r,s){if(!r||Fn)return"";Fn=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(s){var At=function(){throw Error()};if(Object.defineProperty(At.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(At,[])}catch(pt){var ot=pt}Reflect.construct(r,[],At)}else{try{At.call()}catch(pt){ot=pt}r.call(At.prototype)}}else{try{throw Error()}catch(pt){ot=pt}(At=r())&&typeof At.catch=="function"&&At.catch(function(){})}}catch(pt){if(pt&&ot&&typeof pt.stack=="string")return[pt.stack,ot.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var P=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");P&&P.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var k=x.DetermineComponentFrameRoot(),X=k[0],le=k[1];if(X&&le){var ke=X.split(`
`),nt=le.split(`
`);for(P=x=0;x<ke.length&&!ke[x].includes("DetermineComponentFrameRoot");)x++;for(;P<nt.length&&!nt[P].includes("DetermineComponentFrameRoot");)P++;if(x===ke.length||P===nt.length)for(x=ke.length-1,P=nt.length-1;1<=x&&0<=P&&ke[x]!==nt[P];)P--;for(;1<=x&&0<=P;x--,P--)if(ke[x]!==nt[P]){if(x!==1||P!==1)do if(x--,P--,0>P||ke[x]!==nt[P]){var vt=`
`+ke[x].replace(" at new "," at ");return r.displayName&&vt.includes("<anonymous>")&&(vt=vt.replace("<anonymous>",r.displayName)),vt}while(1<=x&&0<=P);break}}}finally{Fn=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?Gi(d):""}function ln(r,s){switch(r.tag){case 26:case 27:case 5:return Gi(r.type);case 16:return Gi("Lazy");case 13:return r.child!==s&&s!==null?Gi("Suspense Fallback"):Gi("Suspense");case 19:return Gi("SuspenseList");case 0:case 15:return Jn(r.type,!1);case 11:return Jn(r.type.render,!1);case 1:return Jn(r.type,!0);case 31:return Gi("Activity");default:return""}}function Lr(r){try{var s="",d=null;do s+=ln(r,d),d=r,r=r.return;while(r);return s}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var pa=Object.prototype.hasOwnProperty,Jt=f.unstable_scheduleCallback,li=f.unstable_cancelCallback,fi=f.unstable_shouldYield,Ci=f.unstable_requestPaint,Ei=f.unstable_now,cn=f.unstable_getCurrentPriorityLevel,Re=f.unstable_ImmediatePriority,Q=f.unstable_UserBlockingPriority,ee=f.unstable_NormalPriority,se=f.unstable_LowPriority,ge=f.unstable_IdlePriority,we=f.log,Ze=f.unstable_setDisableYieldValue,Ne=null,Ie=null;function qe(r){if(typeof we=="function"&&Ze(r),Ie&&typeof Ie.setStrictMode=="function")try{Ie.setStrictMode(Ne,r)}catch{}}var gt=Math.clz32?Math.clz32:ei,ft=Math.log,Ft=Math.LN2;function ei(r){return r>>>=0,r===0?32:31-(ft(r)/Ft|0)|0}var hi=256,Vi=262144,Di=4194304;function $e(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Wi(r,s,d){var x=r.pendingLanes;if(x===0)return 0;var P=0,k=r.suspendedLanes,X=r.pingedLanes;r=r.warmLanes;var le=x&134217727;return le!==0?(x=le&~k,x!==0?P=$e(x):(X&=le,X!==0?P=$e(X):d||(d=le&~r,d!==0&&(P=$e(d))))):(le=x&~k,le!==0?P=$e(le):X!==0?P=$e(X):d||(d=x&~r,d!==0&&(P=$e(d)))),P===0?0:s!==0&&s!==P&&(s&k)===0&&(k=P&-P,d=s&-s,k>=d||k===32&&(d&4194048)!==0)?s:P}function er(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function pi(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ki(){var r=Di;return Di<<=1,(Di&62914560)===0&&(Di=4194304),r}function un(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function ji(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Ln(r,s,d,x,P,k){var X=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var le=r.entanglements,ke=r.expirationTimes,nt=r.hiddenUpdates;for(d=X&~d;0<d;){var vt=31-gt(d),At=1<<vt;le[vt]=0,ke[vt]=-1;var ot=nt[vt];if(ot!==null)for(nt[vt]=null,vt=0;vt<ot.length;vt++){var pt=ot[vt];pt!==null&&(pt.lane&=-536870913)}d&=~At}x!==0&&sn(r,x,0),k!==0&&P===0&&r.tag!==0&&(r.suspendedLanes|=k&~(X&~s))}function sn(r,s,d){r.pendingLanes|=s,r.suspendedLanes&=~s;var x=31-gt(s);r.entangledLanes|=s,r.entanglements[x]=r.entanglements[x]|1073741824|d&261930}function sr(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var x=31-gt(d),P=1<<x;P&s|r[x]&s&&(r[x]|=s),d&=~P}}function Ol(r,s){var d=s&-s;return d=(d&42)!==0?1:qr(d),(d&(r.suspendedLanes|s))!==0?0:d}function qr(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Qe(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function kr(){var r=Je.p;return r!==0?r:(r=window.event,r===void 0?32:yh(r.type))}function Rr(r,s){var d=Je.p;try{return Je.p=r,s()}finally{Je.p=d}}var Za=Math.random().toString(36).slice(2),gn="__reactFiber$"+Za,It="__reactProps$"+Za,yi="__reactContainer$"+Za,gi="__reactEvents$"+Za,ma="__reactListeners$"+Za,Qc="__reactHandles$"+Za,Ms="__reactResources$"+Za,vi="__reactMarker$"+Za;function il(r){delete r[gn],delete r[It],delete r[gi],delete r[ma],delete r[Qc]}function rs(r){var s=r[gn];if(s)return s;for(var d=r.parentNode;d;){if(s=d[yi]||d[gn]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=of(r);r!==null;){if(d=r[gn])return d;r=of(r)}return s}r=d,d=r.parentNode}return null}function Qs(r){if(r=r[gn]||r[yi]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Oa(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(M(33))}function As(r){var s=r[Ms];return s||(s=r[Ms]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Gn(r){r[vi]=!0}var Bl=new Set,Gr={};function Zi(r,s){as(r,s),as(r+"Capture",s)}function as(r,s){for(Gr[r]=s,r=0;r<s.length;r++)Bl.add(s[r])}var Cs=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),nl={},Js={};function ia(r){return pa.call(Js,r)?!0:pa.call(nl,r)?!1:Cs.test(r)?Js[r]=!0:(nl[r]=!0,!1)}function qi(r,s,d){if(ia(s))if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var x=s.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+d)}}function nn(r,s,d){if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+d)}}function na(r,s,d,x){if(x===null)r.removeAttribute(d);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(s,d,""+x)}}function Ri(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Mo(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Jc(r,s,d){var x=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var P=x.get,k=x.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return P.call(this)},set:function(X){d=""+X,k.call(this,X)}}),Object.defineProperty(r,s,{enumerable:x.enumerable}),{getValue:function(){return d},setValue:function(X){d=""+X},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function Si(r){if(!r._valueTracker){var s=Mo(r)?"checked":"value";r._valueTracker=Jc(r,s,""+r[s])}}function Hn(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),x="";return r&&(x=Mo(r)?r.checked?"true":"false":r.value),r=x,r!==d?(s.setValue(r),!0):!1}function rl(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var uc=/[\n"\\]/g;function Pn(r){return r.replace(uc,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function hc(r,s,d,x,P,k,X,le){r.name="",X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?r.type=X:r.removeAttribute("type"),s!=null?X==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+Ri(s)):r.value!==""+Ri(s)&&(r.value=""+Ri(s)):X!=="submit"&&X!=="reset"||r.removeAttribute("value"),s!=null?ss(r,X,Ri(s)):d!=null?ss(r,X,Ri(d)):x!=null&&r.removeAttribute("value"),P==null&&k!=null&&(r.defaultChecked=!!k),P!=null&&(r.checked=P&&typeof P!="function"&&typeof P!="symbol"),le!=null&&typeof le!="function"&&typeof le!="symbol"&&typeof le!="boolean"?r.name=""+Ri(le):r.removeAttribute("name")}function al(r,s,d,x,P,k,X,le){if(k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(r.type=k),s!=null||d!=null){if(!(k!=="submit"&&k!=="reset"||s!=null)){Si(r);return}d=d!=null?""+Ri(d):"",s=s!=null?""+Ri(s):d,le||s===r.value||(r.value=s),r.defaultValue=s}x=x??P,x=typeof x!="function"&&typeof x!="symbol"&&!!x,r.checked=le?r.checked:!!x,r.defaultChecked=!!x,X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"&&(r.name=X),Si(r)}function ss(r,s,d){s==="number"&&rl(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function Sn(r,s,d,x){if(r=r.options,s){s={};for(var P=0;P<d.length;P++)s["$"+d[P]]=!0;for(d=0;d<r.length;d++)P=s.hasOwnProperty("$"+r[d].value),r[d].selected!==P&&(r[d].selected=P),P&&x&&(r[d].defaultSelected=!0)}else{for(d=""+Ri(d),s=null,P=0;P<r.length;P++){if(r[P].value===d){r[P].selected=!0,x&&(r[P].defaultSelected=!0);return}s!==null||r[P].disabled||(s=r[P])}s!==null&&(s.selected=!0)}}function Ao(r,s,d){if(s!=null&&(s=""+Ri(s),s!==r.value&&(r.value=s),d==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=d!=null?""+Ri(d):""}function Ps(r,s,d,x){if(s==null){if(x!=null){if(d!=null)throw Error(M(92));if(wt(x)){if(1<x.length)throw Error(M(93));x=x[0]}d=x}d==null&&(d=""),s=d}d=Ri(s),r.defaultValue=d,x=r.textContent,x===d&&x!==""&&x!==null&&(r.value=x),Si(r)}function Ba(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var eu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function os(r,s,d){var x=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?x?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":x?r.setProperty(s,d):typeof d!="number"||d===0||eu.has(s)?s==="float"?r.cssFloat=d:r[s]=(""+d).trim():r[s]=d+"px"}function Nl(r,s,d){if(s!=null&&typeof s!="object")throw Error(M(62));if(r=r.style,d!=null){for(var x in d)!d.hasOwnProperty(x)||s!=null&&s.hasOwnProperty(x)||(x.indexOf("--")===0?r.setProperty(x,""):x==="float"?r.cssFloat="":r[x]="");for(var P in s)x=s[P],s.hasOwnProperty(P)&&d[P]!==x&&os(r,P,x)}else for(var k in s)s.hasOwnProperty(k)&&os(r,k,s[k])}function eo(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ls=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Co=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bi(r){return Co.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function ga(){}var tu=null;function sl(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var xr=null,ii=null;function Hi(r){var s=Qs(r);if(s&&(r=s.stateNode)){var d=r[It]||null;e:switch(r=s.stateNode,s.type){case"input":if(hc(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Pn(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var x=d[s];if(x!==r&&x.form===r.form){var P=x[It]||null;if(!P)throw Error(M(90));hc(x,P.value,P.defaultValue,P.defaultValue,P.checked,P.defaultChecked,P.type,P.name)}}for(s=0;s<d.length;s++)x=d[s],x.form===r.form&&Hn(x)}break e;case"textarea":Ao(r,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&Sn(r,!!d.multiple,s,!1)}}}var $t=!1;function hn(r,s,d){if($t)return r(s,d);$t=!0;try{var x=r(s);return x}finally{if($t=!1,(xr!==null||ii!==null)&&(Qd(),xr&&(s=xr,r=ii,ii=xr=null,Hi(s),r)))for(s=0;s<r.length;s++)Hi(r[s])}}function _a(r,s){var d=r.stateNode;if(d===null)return null;var x=d[It]||null;if(x===null)return null;d=x[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(M(231,s,typeof d));return d}var kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Or=!1;if(kn)try{var Rn={};Object.defineProperty(Rn,"passive",{get:function(){Or=!0}}),window.addEventListener("test",Rn,Rn),window.removeEventListener("test",Rn,Rn)}catch{Or=!1}var ra=null,ya=null,Pi=null;function va(){if(Pi)return Pi;var r,s=ya,d=s.length,x,P="value"in ra?ra.value:ra.textContent,k=P.length;for(r=0;r<d&&s[r]===P[r];r++);var X=d-r;for(x=1;x<=X&&s[d-x]===P[k-x];x++);return Pi=P.slice(r,1<x?1-x:void 0)}function xa(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Po(){return!0}function aa(){return!1}function or(r){function s(d,x,P,k,X){this._reactName=d,this._targetInst=P,this.type=x,this.nativeEvent=k,this.target=X,this.currentTarget=null;for(var le in r)r.hasOwnProperty(le)&&(d=r[le],this[le]=d?d(k):k[le]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?Po:aa,this.isPropagationStopped=aa,this}return ue(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Po)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Po)},persist:function(){},isPersistent:Po}),s}var Br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dc=or(Br),zo=ue({},Br,{view:0,detail:0}),Ii=or(zo),dn,Pr,Mi,xi=ue({},zo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mc,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Mi&&(Mi&&r.type==="mousemove"?(dn=r.screenX-Mi.screenX,Pr=r.screenY-Mi.screenY):Pr=dn=0,Mi=r),dn)},movementY:function(r){return"movementY"in r?r.movementY:Pr}}),ol=or(xi),Bi=ue({},xi,{dataTransfer:0}),fc=or(Bi),Na=ue({},zo,{relatedTarget:0}),Do=or(Na),Io=ue({},Br,{animationName:0,elapsedTime:0,pseudoElement:0}),iu=or(Io),pc=ue({},Br,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),qa=or(pc),Ad=ue({},Br,{data:0}),nu=or(Ad),tr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function to(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=zn[r])?!!s[r]:!1}function mc(){return to}var Fl=ue({},zo,{key:function(r){if(r.key){var s=tr[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=xa(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?cs[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mc,charCode:function(r){return r.type==="keypress"?xa(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?xa(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),jn=or(Fl),zh=ue({},xi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ru=or(zh),au=ue({},zo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mc}),Cd=or(au),ll=ue({},Br,{propertyName:0,elapsedTime:0,pseudoElement:0}),gc=or(ll),io=ue({},xi,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),no=or(io),_c=ue({},Br,{newState:0,oldState:0}),zs=or(_c),Nr=[9,13,27,32],$n=kn&&"CompositionEvent"in window,cl=null;kn&&"documentMode"in document&&(cl=document.documentMode);var jl=kn&&"TextEvent"in window&&!cl,Lo=kn&&(!$n||cl&&8<cl&&11>=cl),Ds=" ",Dh=!1;function yc(r,s){switch(r){case"keyup":return Nr.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zu(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var us=!1;function ba(r,s){switch(r){case"compositionend":return Zu(s);case"keypress":return s.which!==32?null:(Dh=!0,Ds);case"textInput":return r=s.data,r===Ds&&Dh?null:r;default:return null}}function ul(r,s){if(us)return r==="compositionend"||!$n&&yc(r,s)?(r=va(),Pi=ya=ra=null,us=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Lo&&s.locale!=="ko"?null:s.data;default:return null}}var Ih={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ga(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Ih[r.type]:s==="textarea"}function su(r,s,d,x){xr?ii?ii.push(x):ii=[x]:xr=x,s=nf(s,"onChange"),0<s.length&&(d=new dc("onChange","change",null,d,x),r.push({event:d,listeners:s}))}var Ha=null,Ul=null;function Vl(r){qg(r,0)}function Zl(r){var s=Oa(r);if(Hn(s))return r}function hs(r,s){if(r==="change")return s}var qu=!1;if(kn){var $a;if(kn){var ds="oninput"in document;if(!ds){var Gu=document.createElement("div");Gu.setAttribute("oninput","return;"),ds=typeof Gu.oninput=="function"}$a=ds}else $a=!1;qu=$a&&(!document.documentMode||9<document.documentMode)}function hl(){Ha&&(Ha.detachEvent("onpropertychange",Lh),Ul=Ha=null)}function Lh(r){if(r.propertyName==="value"&&Zl(Ul)){var s=[];su(s,Ul,r,sl(r)),hn(Vl,s)}}function ro(r,s,d){r==="focusin"?(hl(),Ha=s,Ul=d,Ha.attachEvent("onpropertychange",Lh)):r==="focusout"&&hl()}function kh(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Zl(Ul)}function Is(r,s){if(r==="click")return Zl(s)}function Rh(r,s){if(r==="input"||r==="change")return Zl(s)}function fs(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Fr=typeof Object.is=="function"?Object.is:fs;function ao(r,s){if(Fr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),x=Object.keys(s);if(d.length!==x.length)return!1;for(x=0;x<d.length;x++){var P=d[x];if(!pa.call(s,P)||!Fr(r[P],s[P]))return!1}return!0}function wa(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function ko(r,s){var d=wa(r);r=0;for(var x;d;){if(d.nodeType===3){if(x=r+d.textContent.length,r<=s&&x>=s)return{node:d,offset:s-r};r=x}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=wa(d)}}function ql(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?ql(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function dl(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=rl(r.document);s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=rl(r.document)}return s}function Ls(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var fl=kn&&"documentMode"in document&&11>=document.documentMode,Ta=null,Gl=null,vc=null,pl=!1;function Oh(r,s,d){var x=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;pl||Ta==null||Ta!==rl(x)||(x=Ta,"selectionStart"in x&&Ls(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),vc&&ao(vc,x)||(vc=x,x=nf(Gl,"onSelect"),0<x.length&&(s=new dc("onSelect","select",null,s,d),r.push({event:s,listeners:x}),s.target=Ta)))}function Ro(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var ml={animationend:Ro("Animation","AnimationEnd"),animationiteration:Ro("Animation","AnimationIteration"),animationstart:Ro("Animation","AnimationStart"),transitionrun:Ro("Transition","TransitionRun"),transitionstart:Ro("Transition","TransitionStart"),transitioncancel:Ro("Transition","TransitionCancel"),transitionend:Ro("Transition","TransitionEnd")},ou={},$i={};kn&&($i=document.createElement("div").style,"AnimationEvent"in window||(delete ml.animationend.animation,delete ml.animationiteration.animation,delete ml.animationstart.animation),"TransitionEvent"in window||delete ml.transitionend.transition);function br(r){if(ou[r])return ou[r];if(!ml[r])return r;var s=ml[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in $i)return ou[r]=s[d];return r}var Oo=br("animationend"),xc=br("animationiteration"),gl=br("animationstart"),_l=br("transitionrun"),Hl=br("transitionstart"),$l=br("transitioncancel"),jr=br("transitionend"),Hu=new Map,so="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");so.push("scrollEnd");function Sa(r,s){Hu.set(r,s),Zi(s,[r])}var ps=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},sa=[],Ur=0,Bo=0;function No(){for(var r=Ur,s=Bo=Ur=0;s<r;){var d=sa[s];sa[s++]=null;var x=sa[s];sa[s++]=null;var P=sa[s];sa[s++]=null;var k=sa[s];if(sa[s++]=null,x!==null&&P!==null){var X=x.pending;X===null?P.next=P:(P.next=X.next,X.next=P),x.pending=P}k!==0&&yl(d,P,k)}}function oo(r,s,d,x){sa[Ur++]=r,sa[Ur++]=s,sa[Ur++]=d,sa[Ur++]=x,Bo|=x,r.lanes|=x,r=r.alternate,r!==null&&(r.lanes|=x)}function Fo(r,s,d,x){return oo(r,s,d,x),vl(r)}function oa(r,s){return oo(r,null,null,s),vl(r)}function yl(r,s,d){r.lanes|=d;var x=r.alternate;x!==null&&(x.lanes|=d);for(var P=!1,k=r.return;k!==null;)k.childLanes|=d,x=k.alternate,x!==null&&(x.childLanes|=d),k.tag===22&&(r=k.stateNode,r===null||r._visibility&1||(P=!0)),r=k,k=k.return;return r.tag===3?(k=r.stateNode,P&&s!==null&&(P=31-gt(d),r=k.hiddenUpdates,x=r[P],x===null?r[P]=[s]:x.push(s),s.lane=d|536870912),k):null}function vl(r){if(50<Kd)throw Kd=0,fm=null,Error(M(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var wi={};function lu(r,s,d,x){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ea(r,s,d,x){return new lu(r,s,d,x)}function bc(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Ma(r,s){var d=r.alternate;return d===null?(d=Ea(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function $u(r,s){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,s=d.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function wc(r,s,d,x,P,k){var X=0;if(x=r,typeof r=="function")bc(r)&&(X=1);else if(typeof r=="string")X=Mp(r,d,Pt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case jt:return r=Ea(31,d,s,P),r.elementType=jt,r.lanes=k,r;case be:return jo(d.children,P,k,s);case de:X=8,P|=24;break;case He:return r=Ea(12,d,s,P|2),r.elementType=He,r.lanes=k,r;case Rt:return r=Ea(13,d,s,P),r.elementType=Rt,r.lanes=k,r;case dt:return r=Ea(19,d,s,P),r.elementType=dt,r.lanes=k,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Fe:X=10;break e;case ut:X=9;break e;case Ut:X=11;break e;case rt:X=14;break e;case Ct:X=16,x=null;break e}X=29,d=Error(M(130,r===null?"null":typeof r,"")),x=null}return s=Ea(X,d,s,P),s.elementType=r,s.type=x,s.lanes=k,s}function jo(r,s,d,x){return r=Ea(7,r,x,s),r.lanes=d,r}function cu(r,s,d){return r=Ea(6,r,null,s),r.lanes=d,r}function Tc(r){var s=Ea(18,null,null,0);return s.stateNode=r,s}function Uo(r,s,d){return s=Ea(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var l=new WeakMap;function v(r,s){if(typeof r=="object"&&r!==null){var d=l.get(r);return d!==void 0?d:(s={value:r,source:s,stack:Lr(s)},l.set(r,s),s)}return{value:r,source:s,stack:Lr(s)}}var A=[],B=0,H=null,ae=0,Ae=[],Ve=0,at=null,Mt=1,Zt="";function ci(r,s){A[B++]=ae,A[B++]=H,H=r,ae=s}function Li(r,s,d){Ae[Ve++]=Mt,Ae[Ve++]=Zt,Ae[Ve++]=at,at=r;var x=Mt;r=Zt;var P=32-gt(x)-1;x&=~(1<<P),d+=1;var k=32-gt(s)+P;if(30<k){var X=P-P%5;k=(x&(1<<X)-1).toString(32),x>>=X,P-=X,Mt=1<<32-gt(s)+P|d<<P|x,Zt=k+r}else Mt=1<<k|d<<P|x,Zt=r}function lr(r){r.return!==null&&(ci(r,1),Li(r,1,0))}function Xn(r){for(;r===H;)H=A[--B],A[B]=null,ae=A[--B],A[B]=null;for(;r===at;)at=Ae[--Ve],Ae[Ve]=null,Zt=Ae[--Ve],Ae[Ve]=null,Mt=Ae[--Ve],Ae[Ve]=null}function Aa(r,s){Ae[Ve++]=Mt,Ae[Ve++]=Zt,Ae[Ve++]=at,Mt=s.id,Zt=s.overflow,at=r}var on=null,Xi=null,Ni=!1,lo=null,Fa=!1,On=Error(M(519));function Ca(r){var s=Error(M(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw co(v(s,r)),On}function la(r){var s=r.stateNode,d=r.type,x=r.memoizedProps;switch(s[gn]=r,s[It]=x,d){case"dialog":en("cancel",s),en("close",s);break;case"iframe":case"object":case"embed":en("load",s);break;case"video":case"audio":for(d=0;d<Su.length;d++)en(Su[d],s);break;case"source":en("error",s);break;case"img":case"image":case"link":en("error",s),en("load",s);break;case"details":en("toggle",s);break;case"input":en("invalid",s),al(s,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":en("invalid",s);break;case"textarea":en("invalid",s),Ps(s,x.value,x.defaultValue,x.children)}d=x.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||x.suppressHydrationWarning===!0||Am(s.textContent,d)?(x.popover!=null&&(en("beforetoggle",s),en("toggle",s)),x.onScroll!=null&&en("scroll",s),x.onScrollEnd!=null&&en("scrollend",s),x.onClick!=null&&(s.onclick=ga),s=!0):s=!1,s||Ca(r,!0)}function Un(r){for(on=r.return;on;)switch(on.tag){case 5:case 31:case 13:Fa=!1;return;case 27:case 3:Fa=!0;return;default:on=on.return}}function ja(r){if(r!==on)return!1;if(!Ni)return Un(r),Ni=!0,!1;var s=r.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||vp(r.type,r.memoizedProps)),d=!d),d&&Xi&&Ca(r),Un(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(M(317));Xi=Jr(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(M(317));Xi=Jr(r)}else s===27?(s=Xi,Au(r.type)?(r=Ts,Ts=null,Xi=r):Xi=s):Xi=on?wo(r.stateNode.nextSibling):null;return!0}function ks(){Xi=on=null,Ni=!1}function Rs(){var r=lo;return r!==null&&(Gs===null?Gs=r:Gs.push.apply(Gs,r),lo=null),r}function co(r){lo===null?lo=[r]:lo.push(r)}var ms=_e(null),Ua=null,Os=null;function xl(r,s,d){yt(ms,s._currentValue),s._currentValue=d}function Vo(r){r._currentValue=ms.current,Ue(ms)}function Bh(r,s,d){for(;r!==null;){var x=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,x!==null&&(x.childLanes|=s)):x!==null&&(x.childLanes&s)!==s&&(x.childLanes|=s),r===d)break;r=r.return}}function Nh(r,s,d,x){var P=r.child;for(P!==null&&(P.return=r);P!==null;){var k=P.dependencies;if(k!==null){var X=P.child;k=k.firstContext;e:for(;k!==null;){var le=k;k=P;for(var ke=0;ke<s.length;ke++)if(le.context===s[ke]){k.lanes|=d,le=k.alternate,le!==null&&(le.lanes|=d),Bh(k.return,d,r),x||(X=null);break e}k=le.next}}else if(P.tag===18){if(X=P.return,X===null)throw Error(M(341));X.lanes|=d,k=X.alternate,k!==null&&(k.lanes|=d),Bh(X,d,r),X=null}else X=P.child;if(X!==null)X.return=P;else for(X=P;X!==null;){if(X===r){X=null;break}if(P=X.sibling,P!==null){P.return=X.return,X=P;break}X=X.return}P=X}}function gs(r,s,d,x){r=null;for(var P=s,k=!1;P!==null;){if(!k){if((P.flags&524288)!==0)k=!0;else if((P.flags&262144)!==0)break}if(P.tag===10){var X=P.alternate;if(X===null)throw Error(M(387));if(X=X.memoizedProps,X!==null){var le=P.type;Fr(P.pendingProps.value,X.value)||(r!==null?r.push(le):r=[le])}}else if(P===Kt.current){if(X=P.alternate,X===null)throw Error(M(387));X.memoizedState.memoizedState!==P.memoizedState.memoizedState&&(r!==null?r.push(pd):r=[pd])}P=P.return}r!==null&&Nh(s,r,d,x),s.flags|=262144}function uu(r){for(r=r.firstContext;r!==null;){if(!Fr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function bl(r){Ua=r,Os=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function wr(r){return Fh(Ua,r)}function Xu(r,s){return Ua===null&&bl(r),Fh(r,s)}function Fh(r,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},Os===null){if(r===null)throw Error(M(308));Os=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Os=Os.next=s;return d}var Pd=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(d,x){r.push(x)}};this.abort=function(){s.aborted=!0,r.forEach(function(d){return d()})}},kf=f.unstable_scheduleCallback,zd=f.unstable_NormalPriority,mr={$$typeof:Fe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zo(){return{controller:new Pd,data:new Map,refCount:0}}function hu(r){r.refCount--,r.refCount===0&&kf(zd,function(){r.controller.abort()})}var Pa=null,_s=0,Sc=0,za=null;function Wp(r,s){if(Pa===null){var d=Pa=[];_s=0,Sc=wm(),za={status:"pending",value:void 0,then:function(x){d.push(x)}}}return _s++,s.then(du,du),s}function du(){if(--_s===0&&Pa!==null){za!==null&&(za.status="fulfilled");var r=Pa;Pa=null,Sc=0,za=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Yu(r,s){var d=[],x={status:"pending",value:null,reason:null,then:function(P){d.push(P)}};return r.then(function(){x.status="fulfilled",x.value=s;for(var P=0;P<d.length;P++)(0,d[P])(s)},function(P){for(x.status="rejected",x.reason=P,P=0;P<d.length;P++)(0,d[P])(void 0)}),x}var Vr=ze.S;ze.S=function(r,s){Ag=Ei(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Wp(r,s),Vr!==null&&Vr(r,s)};var uo=_e(null);function jh(){var r=uo.current;return r!==null?r:Kn.pooledCache}function Uh(r,s){s===null?yt(uo,uo.current):yt(uo,s.pool)}function Rf(){var r=jh();return r===null?null:{parent:mr._currentValue,pool:r}}var ho=Error(M(460)),Xl=Error(M(474)),Xa=Error(M(542)),qt={then:function(){}};function Wu(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Vh(r,s,d){switch(d=r[d],d===void 0?r.push(s):d!==s&&(s.then(ga,ga),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Zh(r),r;default:if(typeof s.status=="string")s.then(ga,ga);else{if(r=Kn,r!==null&&100<r.shellSuspendCounter)throw Error(M(482));r=s,r.status="pending",r.then(function(x){if(s.status==="pending"){var P=s;P.status="fulfilled",P.value=x}},function(x){if(s.status==="pending"){var P=s;P.status="rejected",P.reason=x}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Zh(r),r}throw fo=s,ho}}function Bs(r){try{var s=r._init;return s(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(fo=d,ho):d}}var fo=null;function fu(){if(fo===null)throw Error(M(459));var r=fo;return fo=null,r}function Zh(r){if(r===ho||r===Xa)throw Error(M(483))}var qo=null,Ec=0;function Ku(r){var s=Ec;return Ec+=1,qo===null&&(qo=[]),Vh(qo,r,s)}function Go(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function qh(r,s){throw s.$$typeof===De?Error(M(525)):(r=Object.prototype.toString.call(s),Error(M(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function Qu(r){function s(Ge,Be){if(r){var tt=Ge.deletions;tt===null?(Ge.deletions=[Be],Ge.flags|=16):tt.push(Be)}}function d(Ge,Be){if(!r)return null;for(;Be!==null;)s(Ge,Be),Be=Be.sibling;return null}function x(Ge){for(var Be=new Map;Ge!==null;)Ge.key!==null?Be.set(Ge.key,Ge):Be.set(Ge.index,Ge),Ge=Ge.sibling;return Be}function P(Ge,Be){return Ge=Ma(Ge,Be),Ge.index=0,Ge.sibling=null,Ge}function k(Ge,Be,tt){return Ge.index=tt,r?(tt=Ge.alternate,tt!==null?(tt=tt.index,tt<Be?(Ge.flags|=67108866,Be):tt):(Ge.flags|=67108866,Be)):(Ge.flags|=1048576,Be)}function X(Ge){return r&&Ge.alternate===null&&(Ge.flags|=67108866),Ge}function le(Ge,Be,tt,Tt){return Be===null||Be.tag!==6?(Be=cu(tt,Ge.mode,Tt),Be.return=Ge,Be):(Be=P(Be,tt),Be.return=Ge,Be)}function ke(Ge,Be,tt,Tt){var mi=tt.type;return mi===be?vt(Ge,Be,tt.props.children,Tt,tt.key):Be!==null&&(Be.elementType===mi||typeof mi=="object"&&mi!==null&&mi.$$typeof===Ct&&Bs(mi)===Be.type)?(Be=P(Be,tt.props),Go(Be,tt),Be.return=Ge,Be):(Be=wc(tt.type,tt.key,tt.props,null,Ge.mode,Tt),Go(Be,tt),Be.return=Ge,Be)}function nt(Ge,Be,tt,Tt){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==tt.containerInfo||Be.stateNode.implementation!==tt.implementation?(Be=Uo(tt,Ge.mode,Tt),Be.return=Ge,Be):(Be=P(Be,tt.children||[]),Be.return=Ge,Be)}function vt(Ge,Be,tt,Tt,mi){return Be===null||Be.tag!==7?(Be=jo(tt,Ge.mode,Tt,mi),Be.return=Ge,Be):(Be=P(Be,tt),Be.return=Ge,Be)}function At(Ge,Be,tt){if(typeof Be=="string"&&Be!==""||typeof Be=="number"||typeof Be=="bigint")return Be=cu(""+Be,Ge.mode,tt),Be.return=Ge,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case Pe:return tt=wc(Be.type,Be.key,Be.props,null,Ge.mode,tt),Go(tt,Be),tt.return=Ge,tt;case je:return Be=Uo(Be,Ge.mode,tt),Be.return=Ge,Be;case Ct:return Be=Bs(Be),At(Ge,Be,tt)}if(wt(Be)||Yt(Be))return Be=jo(Be,Ge.mode,tt,null),Be.return=Ge,Be;if(typeof Be.then=="function")return At(Ge,Ku(Be),tt);if(Be.$$typeof===Fe)return At(Ge,Xu(Ge,Be),tt);qh(Ge,Be)}return null}function ot(Ge,Be,tt,Tt){var mi=Be!==null?Be.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return mi!==null?null:le(Ge,Be,""+tt,Tt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case Pe:return tt.key===mi?ke(Ge,Be,tt,Tt):null;case je:return tt.key===mi?nt(Ge,Be,tt,Tt):null;case Ct:return tt=Bs(tt),ot(Ge,Be,tt,Tt)}if(wt(tt)||Yt(tt))return mi!==null?null:vt(Ge,Be,tt,Tt,null);if(typeof tt.then=="function")return ot(Ge,Be,Ku(tt),Tt);if(tt.$$typeof===Fe)return ot(Ge,Be,Xu(Ge,tt),Tt);qh(Ge,tt)}return null}function pt(Ge,Be,tt,Tt,mi){if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number"||typeof Tt=="bigint")return Ge=Ge.get(tt)||null,le(Be,Ge,""+Tt,mi);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case Pe:return Ge=Ge.get(Tt.key===null?tt:Tt.key)||null,ke(Be,Ge,Tt,mi);case je:return Ge=Ge.get(Tt.key===null?tt:Tt.key)||null,nt(Be,Ge,Tt,mi);case Ct:return Tt=Bs(Tt),pt(Ge,Be,tt,Tt,mi)}if(wt(Tt)||Yt(Tt))return Ge=Ge.get(tt)||null,vt(Be,Ge,Tt,mi,null);if(typeof Tt.then=="function")return pt(Ge,Be,tt,Ku(Tt),mi);if(Tt.$$typeof===Fe)return pt(Ge,Be,tt,Xu(Be,Tt),mi);qh(Be,Tt)}return null}function ni(Ge,Be,tt,Tt){for(var mi=null,wn=null,ri=Be,di=Be=0,Yi=null;ri!==null&&di<tt.length;di++){ri.index>di?(Yi=ri,ri=null):Yi=ri.sibling;var vn=ot(Ge,ri,tt[di],Tt);if(vn===null){ri===null&&(ri=Yi);break}r&&ri&&vn.alternate===null&&s(Ge,ri),Be=k(vn,Be,di),wn===null?mi=vn:wn.sibling=vn,wn=vn,ri=Yi}if(di===tt.length)return d(Ge,ri),Ni&&ci(Ge,di),mi;if(ri===null){for(;di<tt.length;di++)ri=At(Ge,tt[di],Tt),ri!==null&&(Be=k(ri,Be,di),wn===null?mi=ri:wn.sibling=ri,wn=ri);return Ni&&ci(Ge,di),mi}for(ri=x(ri);di<tt.length;di++)Yi=pt(ri,Ge,di,tt[di],Tt),Yi!==null&&(r&&Yi.alternate!==null&&ri.delete(Yi.key===null?di:Yi.key),Be=k(Yi,Be,di),wn===null?mi=Yi:wn.sibling=Yi,wn=Yi);return r&&ri.forEach(function(Hc){return s(Ge,Hc)}),Ni&&ci(Ge,di),mi}function _i(Ge,Be,tt,Tt){if(tt==null)throw Error(M(151));for(var mi=null,wn=null,ri=Be,di=Be=0,Yi=null,vn=tt.next();ri!==null&&!vn.done;di++,vn=tt.next()){ri.index>di?(Yi=ri,ri=null):Yi=ri.sibling;var Hc=ot(Ge,ri,vn.value,Tt);if(Hc===null){ri===null&&(ri=Yi);break}r&&ri&&Hc.alternate===null&&s(Ge,ri),Be=k(Hc,Be,di),wn===null?mi=Hc:wn.sibling=Hc,wn=Hc,ri=Yi}if(vn.done)return d(Ge,ri),Ni&&ci(Ge,di),mi;if(ri===null){for(;!vn.done;di++,vn=tt.next())vn=At(Ge,vn.value,Tt),vn!==null&&(Be=k(vn,Be,di),wn===null?mi=vn:wn.sibling=vn,wn=vn);return Ni&&ci(Ge,di),mi}for(ri=x(ri);!vn.done;di++,vn=tt.next())vn=pt(ri,Ge,di,vn.value,Tt),vn!==null&&(r&&vn.alternate!==null&&ri.delete(vn.key===null?di:vn.key),Be=k(vn,Be,di),wn===null?mi=vn:wn.sibling=vn,wn=vn);return r&&ri.forEach(function(Ym){return s(Ge,Ym)}),Ni&&ci(Ge,di),mi}function Nn(Ge,Be,tt,Tt){if(typeof tt=="object"&&tt!==null&&tt.type===be&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case Pe:e:{for(var mi=tt.key;Be!==null;){if(Be.key===mi){if(mi=tt.type,mi===be){if(Be.tag===7){d(Ge,Be.sibling),Tt=P(Be,tt.props.children),Tt.return=Ge,Ge=Tt;break e}}else if(Be.elementType===mi||typeof mi=="object"&&mi!==null&&mi.$$typeof===Ct&&Bs(mi)===Be.type){d(Ge,Be.sibling),Tt=P(Be,tt.props),Go(Tt,tt),Tt.return=Ge,Ge=Tt;break e}d(Ge,Be);break}else s(Ge,Be);Be=Be.sibling}tt.type===be?(Tt=jo(tt.props.children,Ge.mode,Tt,tt.key),Tt.return=Ge,Ge=Tt):(Tt=wc(tt.type,tt.key,tt.props,null,Ge.mode,Tt),Go(Tt,tt),Tt.return=Ge,Ge=Tt)}return X(Ge);case je:e:{for(mi=tt.key;Be!==null;){if(Be.key===mi)if(Be.tag===4&&Be.stateNode.containerInfo===tt.containerInfo&&Be.stateNode.implementation===tt.implementation){d(Ge,Be.sibling),Tt=P(Be,tt.children||[]),Tt.return=Ge,Ge=Tt;break e}else{d(Ge,Be);break}else s(Ge,Be);Be=Be.sibling}Tt=Uo(tt,Ge.mode,Tt),Tt.return=Ge,Ge=Tt}return X(Ge);case Ct:return tt=Bs(tt),Nn(Ge,Be,tt,Tt)}if(wt(tt))return ni(Ge,Be,tt,Tt);if(Yt(tt)){if(mi=Yt(tt),typeof mi!="function")throw Error(M(150));return tt=mi.call(tt),_i(Ge,Be,tt,Tt)}if(typeof tt.then=="function")return Nn(Ge,Be,Ku(tt),Tt);if(tt.$$typeof===Fe)return Nn(Ge,Be,Xu(Ge,tt),Tt);qh(Ge,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint"?(tt=""+tt,Be!==null&&Be.tag===6?(d(Ge,Be.sibling),Tt=P(Be,tt),Tt.return=Ge,Ge=Tt):(d(Ge,Be),Tt=cu(tt,Ge.mode,Tt),Tt.return=Ge,Ge=Tt),X(Ge)):d(Ge,Be)}return function(Ge,Be,tt,Tt){try{Ec=0;var mi=Nn(Ge,Be,tt,Tt);return qo=null,mi}catch(ri){if(ri===ho||ri===Xa)throw ri;var wn=Ea(29,ri,null,Ge.mode);return wn.lanes=Tt,wn.return=Ge,wn}}}var Ho=Qu(!0),Dd=Qu(!1),$o=!1;function Gh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ju(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Xo(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function wl(r,s,d){var x=r.updateQueue;if(x===null)return null;if(x=x.shared,(An&2)!==0){var P=x.pending;return P===null?s.next=s:(s.next=P.next,P.next=s),x.pending=s,s=vl(r),yl(r,null,d),s}return oo(r,x,s,d),vl(r)}function Ns(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var x=s.lanes;x&=r.pendingLanes,d|=x,s.lanes=d,sr(r,d)}}function _n(r,s){var d=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,d===x)){var P=null,k=null;if(d=d.firstBaseUpdate,d!==null){do{var X={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};k===null?P=k=X:k=k.next=X,d=d.next}while(d!==null);k===null?P=k=s:k=k.next=s}else P=k=s;d={baseState:x.baseState,firstBaseUpdate:P,lastBaseUpdate:k,shared:x.shared,callbacks:x.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}var Id=!1;function Tl(){if(Id){var r=za;if(r!==null)throw r}}function Yl(r,s,d,x){Id=!1;var P=r.updateQueue;$o=!1;var k=P.firstBaseUpdate,X=P.lastBaseUpdate,le=P.shared.pending;if(le!==null){P.shared.pending=null;var ke=le,nt=ke.next;ke.next=null,X===null?k=nt:X.next=nt,X=ke;var vt=r.alternate;vt!==null&&(vt=vt.updateQueue,le=vt.lastBaseUpdate,le!==X&&(le===null?vt.firstBaseUpdate=nt:le.next=nt,vt.lastBaseUpdate=ke))}if(k!==null){var At=P.baseState;X=0,vt=nt=ke=null,le=k;do{var ot=le.lane&-536870913,pt=ot!==le.lane;if(pt?(Ji&ot)===ot:(x&ot)===ot){ot!==0&&ot===Sc&&(Id=!0),vt!==null&&(vt=vt.next={lane:0,tag:le.tag,payload:le.payload,callback:null,next:null});e:{var ni=r,_i=le;ot=s;var Nn=d;switch(_i.tag){case 1:if(ni=_i.payload,typeof ni=="function"){At=ni.call(Nn,At,ot);break e}At=ni;break e;case 3:ni.flags=ni.flags&-65537|128;case 0:if(ni=_i.payload,ot=typeof ni=="function"?ni.call(Nn,At,ot):ni,ot==null)break e;At=ue({},At,ot);break e;case 2:$o=!0}}ot=le.callback,ot!==null&&(r.flags|=64,pt&&(r.flags|=8192),pt=P.callbacks,pt===null?P.callbacks=[ot]:pt.push(ot))}else pt={lane:ot,tag:le.tag,payload:le.payload,callback:le.callback,next:null},vt===null?(nt=vt=pt,ke=At):vt=vt.next=pt,X|=ot;if(le=le.next,le===null){if(le=P.shared.pending,le===null)break;pt=le,le=pt.next,pt.next=null,P.lastBaseUpdate=pt,P.shared.pending=null}}while(!0);vt===null&&(ke=At),P.baseState=ke,P.firstBaseUpdate=nt,P.lastBaseUpdate=vt,k===null&&(P.shared.lanes=0),Fc|=X,r.lanes=X,r.memoizedState=At}}function eh(r,s){if(typeof r!="function")throw Error(M(191,r));r.call(s)}function Hh(r,s){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)eh(d[r],s)}var Mc=_e(null),th=_e(0);function Ld(r,s){r=Nc,yt(th,r),yt(Mc,s),Nc=r|s.baseLanes}function ys(){yt(th,Nc),yt(Mc,Mc.current)}function Ac(){Nc=th.current,Ue(Mc),Ue(th)}var Xt=_e(null),ti=null;function Fs(r){var s=r.alternate;yt(cr,cr.current&1),yt(Xt,r),ti===null&&(s===null||Mc.current!==null||s.memoizedState!==null)&&(ti=r)}function pu(r){yt(cr,cr.current),yt(Xt,r),ti===null&&(ti=r)}function ih(r){r.tag===22?(yt(cr,cr.current),yt(Xt,r),ti===null&&(ti=r)):gr()}function gr(){yt(cr,cr.current),yt(Xt,Xt.current)}function ir(r){Ue(Xt),ti===r&&(ti=null),Ue(cr)}var cr=_e(0);function nh(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Qa(d)||Dr(d)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Sl=0,ki=null,fn=null,zi=null,Yn=!1,js=!1,po=!1,Cc=0,Pc=0,El=null,kd=0;function Vn(){throw Error(M(321))}function mo(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!Fr(r[d],s[d]))return!1;return!0}function mu(r,s,d,x,P,k){return Sl=k,ki=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,ze.H=r===null||r.memoizedState===null?Mn:Tr,po=!1,k=d(x,P),po=!1,js&&(k=rh(s,d,x,P)),gu(r),k}function gu(r){ze.H=yn;var s=fn!==null&&fn.next!==null;if(Sl=0,zi=fn=ki=null,Yn=!1,Pc=0,El=null,s)throw Error(M(300));r===null||Xr||(r=r.dependencies,r!==null&&uu(r)&&(Xr=!0))}function rh(r,s,d,x){ki=r;var P=0;do{if(js&&(El=null),Pc=0,js=!1,25<=P)throw Error(M(301));if(P+=1,zi=fn=null,r.updateQueue!=null){var k=r.updateQueue;k.lastEffect=null,k.events=null,k.stores=null,k.memoCache!=null&&(k.memoCache.index=0)}ze.H=zr,k=s(d,x)}while(js);return k}function ah(){var r=ze.H,s=r.useState()[0];return s=typeof s.then=="function"?zc(s):s,r=r.useState()[0],(fn!==null?fn.memoizedState:null)!==r&&(ki.flags|=1024),s}function sh(){var r=Cc!==0;return Cc=0,r}function Wl(r,s,d){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~d}function Ml(r){if(Yn){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Yn=!1}Sl=0,zi=fn=ki=null,js=!1,Pc=Cc=0,El=null}function ca(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zi===null?ki.memoizedState=zi=r:zi=zi.next=r,zi}function Wn(){if(fn===null){var r=ki.alternate;r=r!==null?r.memoizedState:null}else r=fn.next;var s=zi===null?ki.memoizedState:zi.next;if(s!==null)zi=s,fn=r;else{if(r===null)throw ki.alternate===null?Error(M(467)):Error(M(310));fn=r,r={memoizedState:fn.memoizedState,baseState:fn.baseState,baseQueue:fn.baseQueue,queue:fn.queue,next:null},zi===null?ki.memoizedState=zi=r:zi=zi.next=r}return zi}function Yo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zc(r){var s=Pc;return Pc+=1,El===null&&(El=[]),r=Vh(El,r,s),s=ki,(zi===null?s.memoizedState:zi.next)===null&&(s=s.alternate,ze.H=s===null||s.memoizedState===null?Mn:Tr),r}function Dc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return zc(r);if(r.$$typeof===Fe)return wr(r)}throw Error(M(438,String(r)))}function _u(r){var s=null,d=ki.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var x=ki.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(s={data:x.data.map(function(P){return P.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=Yo(),ki.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(r),x=0;x<r;x++)d[x]=Ht;return s.index++,d}function go(r,s){return typeof s=="function"?s(r):s}function y(r){var s=Wn();return t(s,fn,r)}function t(r,s,d){var x=r.queue;if(x===null)throw Error(M(311));x.lastRenderedReducer=d;var P=r.baseQueue,k=x.pending;if(k!==null){if(P!==null){var X=P.next;P.next=k.next,k.next=X}s.baseQueue=P=k,x.pending=null}if(k=r.baseState,P===null)r.memoizedState=k;else{s=P.next;var le=X=null,ke=null,nt=s,vt=!1;do{var At=nt.lane&-536870913;if(At!==nt.lane?(Ji&At)===At:(Sl&At)===At){var ot=nt.revertLane;if(ot===0)ke!==null&&(ke=ke.next={lane:0,revertLane:0,gesture:null,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null}),At===Sc&&(vt=!0);else if((Sl&ot)===ot){nt=nt.next,ot===Sc&&(vt=!0);continue}else At={lane:0,revertLane:nt.revertLane,gesture:null,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null},ke===null?(le=ke=At,X=k):ke=ke.next=At,ki.lanes|=ot,Fc|=ot;At=nt.action,po&&d(k,At),k=nt.hasEagerState?nt.eagerState:d(k,At)}else ot={lane:At,revertLane:nt.revertLane,gesture:nt.gesture,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null},ke===null?(le=ke=ot,X=k):ke=ke.next=ot,ki.lanes|=At,Fc|=At;nt=nt.next}while(nt!==null&&nt!==s);if(ke===null?X=k:ke.next=le,!Fr(k,r.memoizedState)&&(Xr=!0,vt&&(d=za,d!==null)))throw d;r.memoizedState=k,r.baseState=X,r.baseQueue=ke,x.lastRenderedState=k}return P===null&&(x.lanes=0),[r.memoizedState,x.dispatch]}function a(r){var s=Wn(),d=s.queue;if(d===null)throw Error(M(311));d.lastRenderedReducer=r;var x=d.dispatch,P=d.pending,k=s.memoizedState;if(P!==null){d.pending=null;var X=P=P.next;do k=r(k,X.action),X=X.next;while(X!==P);Fr(k,s.memoizedState)||(Xr=!0),s.memoizedState=k,s.baseQueue===null&&(s.baseState=k),d.lastRenderedState=k}return[k,x]}function c(r,s,d){var x=ki,P=Wn(),k=Ni;if(k){if(d===void 0)throw Error(M(407));d=d()}else d=s();var X=!Fr((fn||P).memoizedState,d);if(X&&(P.memoizedState=d,Xr=!0),P=P.queue,Ke(S.bind(null,x,P,r),[r]),P.getSnapshot!==s||X||zi!==null&&zi.memoizedState.tag&1){if(x.flags|=2048,Te(9,{destroy:void 0},b.bind(null,x,P,d,s),null),Kn===null)throw Error(M(349));k||(Sl&127)!==0||p(x,s,d)}return d}function p(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=ki.updateQueue,s===null?(s=Yo(),ki.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function b(r,s,d,x){s.value=d,s.getSnapshot=x,C(s)&&I(r)}function S(r,s,d){return d(function(){C(s)&&I(r)})}function C(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!Fr(r,d)}catch{return!0}}function I(r){var s=oa(r,2);s!==null&&$s(s,r,2)}function N(r){var s=ca();if(typeof r=="function"){var d=r;if(r=d(),po){qe(!0);try{d()}finally{qe(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:r},s}function U(r,s,d,x){return r.baseState=d,t(r,fn,typeof x=="function"?x:go)}function $(r,s,d,x,P){if(vs(r))throw Error(M(485));if(r=s.action,r!==null){var k={payload:P,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(X){k.listeners.push(X)}};ze.T!==null?d(!0):k.isTransition=!1,x(k),d=s.pending,d===null?(k.next=s.pending=k,G(s,k)):(k.next=d.next,s.pending=d.next=k)}}function G(r,s){var d=s.action,x=s.payload,P=r.state;if(s.isTransition){var k=ze.T,X={};ze.T=X;try{var le=d(P,x),ke=ze.S;ke!==null&&ke(X,le),K(r,s,le)}catch(nt){he(r,s,nt)}finally{k!==null&&X.types!==null&&(k.types=X.types),ze.T=k}}else try{k=d(P,x),K(r,s,k)}catch(nt){he(r,s,nt)}}function K(r,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(x){ie(r,s,x)},function(x){return he(r,s,x)}):ie(r,s,d)}function ie(r,s,d){s.status="fulfilled",s.value=d,me(s),r.state=d,s=r.pending,s!==null&&(d=s.next,d===s?r.pending=null:(d=d.next,s.next=d,G(r,d)))}function he(r,s,d){var x=r.pending;if(r.pending=null,x!==null){x=x.next;do s.status="rejected",s.reason=d,me(s),s=s.next;while(s!==x)}r.action=null}function me(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function pe(r,s){return s}function ve(r,s){if(Ni){var d=Kn.formState;if(d!==null){e:{var x=ki;if(Ni){if(Xi){t:{for(var P=Xi,k=Fa;P.nodeType!==8;){if(!k){P=null;break t}if(P=wo(P.nextSibling),P===null){P=null;break t}}k=P.data,P=k==="F!"||k==="F"?P:null}if(P){Xi=wo(P.nextSibling),x=P.data==="F!";break e}}Ca(x)}x=!1}x&&(s=d[0])}}return d=ca(),d.memoizedState=d.baseState=s,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pe,lastRenderedState:s},d.queue=x,d=yu.bind(null,ki,x),x.dispatch=d,x=N(!1),k=Wa.bind(null,ki,!1,x.queue),x=ca(),P={state:s,dispatch:null,action:r,pending:null},x.queue=P,d=$.bind(null,ki,P,k,d),P.dispatch=d,x.memoizedState=r,[s,d,!1]}function Me(r){var s=Wn();return ye(s,fn,r)}function ye(r,s,d){if(s=t(r,s,pe)[0],r=y(go)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var x=zc(s)}catch(X){throw X===ho?Xa:X}else x=s;s=Wn();var P=s.queue,k=P.dispatch;return d!==s.memoizedState&&(ki.flags|=2048,Te(9,{destroy:void 0},Ee.bind(null,P,d),null)),[x,k,r]}function Ee(r,s){r.action=s}function Le(r){var s=Wn(),d=fn;if(d!==null)return ye(s,d,r);Wn(),s=s.memoizedState,d=Wn();var x=d.queue.dispatch;return d.memoizedState=r,[s,x,!1]}function Te(r,s,d,x){return r={tag:r,create:d,deps:x,inst:s,next:null},s=ki.updateQueue,s===null&&(s=Yo(),ki.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=r.next=r:(x=d.next,d.next=r,r.next=x,s.lastEffect=r),r}function Oe(){return Wn().memoizedState}function et(r,s,d,x){var P=ca();ki.flags|=r,P.memoizedState=Te(1|s,{destroy:void 0},d,x===void 0?null:x)}function Xe(r,s,d,x){var P=Wn();x=x===void 0?null:x;var k=P.memoizedState.inst;fn!==null&&x!==null&&mo(x,fn.memoizedState.deps)?P.memoizedState=Te(s,k,d,x):(ki.flags|=r,P.memoizedState=Te(1|s,k,d,x))}function We(r,s){et(8390656,8,r,s)}function Ke(r,s){Xe(2048,8,r,s)}function zt(r){ki.flags|=4;var s=ki.updateQueue;if(s===null)s=Yo(),ki.updateQueue=s,s.events=[r];else{var d=s.events;d===null?s.events=[r]:d.push(r)}}function kt(r){var s=Wn().memoizedState;return zt({ref:s,nextImpl:r}),function(){if((An&2)!==0)throw Error(M(440));return s.impl.apply(void 0,arguments)}}function xt(r,s){return Xe(4,2,r,s)}function Bt(r,s){return Xe(4,4,r,s)}function Ti(r,s){if(typeof s=="function"){r=r();var d=s(r);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function pn(r,s,d){d=d!=null?d.concat([r]):null,Xe(4,4,Ti.bind(null,s,r),d)}function Dn(){}function En(r,s){var d=Wn();s=s===void 0?null:s;var x=d.memoizedState;return s!==null&&mo(s,x[1])?x[0]:(d.memoizedState=[r,s],r)}function Zn(r,s){var d=Wn();s=s===void 0?null:s;var x=d.memoizedState;if(s!==null&&mo(s,x[1]))return x[0];if(x=r(),po){qe(!0);try{r()}finally{qe(!1)}}return d.memoizedState=[x,s],x}function xn(r,s,d){return d===void 0||(Sl&1073741824)!==0&&(Ji&261930)===0?r.memoizedState=s:(r.memoizedState=d,r=Pg(),ki.lanes|=r,Fc|=r,d)}function nr(r,s,d,x){return Fr(d,s)?d:Mc.current!==null?(r=xn(r,d,x),Fr(r,s)||(Xr=!0),r):(Sl&42)===0||(Sl&1073741824)!==0&&(Ji&261930)===0?(Xr=!0,r.memoizedState=d):(r=Pg(),ki.lanes|=r,Fc|=r,s)}function qn(r,s,d,x,P){var k=Je.p;Je.p=k!==0&&8>k?k:8;var X=ze.T,le={};ze.T=le,Wa(r,!1,s,d);try{var ke=P(),nt=ze.S;if(nt!==null&&nt(le,ke),ke!==null&&typeof ke=="object"&&typeof ke.then=="function"){var vt=Yu(ke,x);yo(r,s,vt,Hs(r))}else yo(r,s,x,Hs(r))}catch(At){yo(r,s,{then:function(){},status:"rejected",reason:At},Hs())}finally{Je.p=k,X!==null&&le.types!==null&&(X.types=le.types),ze.T=X}}function Hr(){}function ur(r,s,d,x){if(r.tag!==5)throw Error(M(476));var P=hr(r).queue;qn(r,P,s,st,d===null?Hr:function(){return $r(r),d(x)})}function hr(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:st,baseState:st,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:st},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:go,lastRenderedState:d},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function $r(r){var s=hr(r);s.next===null&&(s=r.alternate.memoizedState),yo(r,s.next.queue,{},Hs())}function Wo(){return wr(pd)}function Ko(){return Wn().memoizedState}function _o(){return Wn().memoizedState}function Ya(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var d=Hs();r=Xo(d);var x=wl(s,r,d);x!==null&&($s(x,s,d),Ns(x,s,d)),s={cache:Zo()},r.payload=s;return}s=s.return}}function Ic(r,s,d){var x=Hs();d={lane:x,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},vs(r)?Us(s,d):(d=Fo(r,s,d,x),d!==null&&($s(d,r,x),Vs(d,s,x)))}function yu(r,s,d){var x=Hs();yo(r,s,d,x)}function yo(r,s,d,x){var P={lane:x,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(vs(r))Us(s,P);else{var k=r.alternate;if(r.lanes===0&&(k===null||k.lanes===0)&&(k=s.lastRenderedReducer,k!==null))try{var X=s.lastRenderedState,le=k(X,d);if(P.hasEagerState=!0,P.eagerState=le,Fr(le,X))return oo(r,s,P,0),Kn===null&&No(),!1}catch{}if(d=Fo(r,s,P,x),d!==null)return $s(d,r,x),Vs(d,s,x),!0}return!1}function Wa(r,s,d,x){if(x={lane:2,revertLane:wm(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},vs(r)){if(s)throw Error(M(479))}else s=Fo(r,d,x,2),s!==null&&$s(s,r,2)}function vs(r){var s=r.alternate;return r===ki||s!==null&&s===ki}function Us(r,s){js=Yn=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function Vs(r,s,d){if((d&4194048)!==0){var x=s.lanes;x&=r.pendingLanes,d|=x,s.lanes=d,sr(r,d)}}var yn={readContext:wr,use:Dc,useCallback:Vn,useContext:Vn,useEffect:Vn,useImperativeHandle:Vn,useLayoutEffect:Vn,useInsertionEffect:Vn,useMemo:Vn,useReducer:Vn,useRef:Vn,useState:Vn,useDebugValue:Vn,useDeferredValue:Vn,useTransition:Vn,useSyncExternalStore:Vn,useId:Vn,useHostTransitionStatus:Vn,useFormState:Vn,useActionState:Vn,useOptimistic:Vn,useMemoCache:Vn,useCacheRefresh:Vn};yn.useEffectEvent=Vn;var Mn={readContext:wr,use:Dc,useCallback:function(r,s){return ca().memoizedState=[r,s===void 0?null:s],r},useContext:wr,useEffect:We,useImperativeHandle:function(r,s,d){d=d!=null?d.concat([r]):null,et(4194308,4,Ti.bind(null,s,r),d)},useLayoutEffect:function(r,s){return et(4194308,4,r,s)},useInsertionEffect:function(r,s){et(4,2,r,s)},useMemo:function(r,s){var d=ca();s=s===void 0?null:s;var x=r();if(po){qe(!0);try{r()}finally{qe(!1)}}return d.memoizedState=[x,s],x},useReducer:function(r,s,d){var x=ca();if(d!==void 0){var P=d(s);if(po){qe(!0);try{d(s)}finally{qe(!1)}}}else P=s;return x.memoizedState=x.baseState=P,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:P},x.queue=r,r=r.dispatch=Ic.bind(null,ki,r),[x.memoizedState,r]},useRef:function(r){var s=ca();return r={current:r},s.memoizedState=r},useState:function(r){r=N(r);var s=r.queue,d=yu.bind(null,ki,s);return s.dispatch=d,[r.memoizedState,d]},useDebugValue:Dn,useDeferredValue:function(r,s){var d=ca();return xn(d,r,s)},useTransition:function(){var r=N(!1);return r=qn.bind(null,ki,r.queue,!0,!1),ca().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,d){var x=ki,P=ca();if(Ni){if(d===void 0)throw Error(M(407));d=d()}else{if(d=s(),Kn===null)throw Error(M(349));(Ji&127)!==0||p(x,s,d)}P.memoizedState=d;var k={value:d,getSnapshot:s};return P.queue=k,We(S.bind(null,x,k,r),[r]),x.flags|=2048,Te(9,{destroy:void 0},b.bind(null,x,k,d,s),null),d},useId:function(){var r=ca(),s=Kn.identifierPrefix;if(Ni){var d=Zt,x=Mt;d=(x&~(1<<32-gt(x)-1)).toString(32)+d,s="_"+s+"R_"+d,d=Cc++,0<d&&(s+="H"+d.toString(32)),s+="_"}else d=kd++,s="_"+s+"r_"+d.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:Wo,useFormState:ve,useActionState:ve,useOptimistic:function(r){var s=ca();s.memoizedState=s.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=Wa.bind(null,ki,!0,d),d.dispatch=s,[r,s]},useMemoCache:_u,useCacheRefresh:function(){return ca().memoizedState=Ya.bind(null,ki)},useEffectEvent:function(r){var s=ca(),d={impl:r};return s.memoizedState=d,function(){if((An&2)!==0)throw Error(M(440));return d.impl.apply(void 0,arguments)}}},Tr={readContext:wr,use:Dc,useCallback:En,useContext:wr,useEffect:Ke,useImperativeHandle:pn,useInsertionEffect:xt,useLayoutEffect:Bt,useMemo:Zn,useReducer:y,useRef:Oe,useState:function(){return y(go)},useDebugValue:Dn,useDeferredValue:function(r,s){var d=Wn();return nr(d,fn.memoizedState,r,s)},useTransition:function(){var r=y(go)[0],s=Wn().memoizedState;return[typeof r=="boolean"?r:zc(r),s]},useSyncExternalStore:c,useId:Ko,useHostTransitionStatus:Wo,useFormState:Me,useActionState:Me,useOptimistic:function(r,s){var d=Wn();return U(d,fn,r,s)},useMemoCache:_u,useCacheRefresh:_o};Tr.useEffectEvent=kt;var zr={readContext:wr,use:Dc,useCallback:En,useContext:wr,useEffect:Ke,useImperativeHandle:pn,useInsertionEffect:xt,useLayoutEffect:Bt,useMemo:Zn,useReducer:a,useRef:Oe,useState:function(){return a(go)},useDebugValue:Dn,useDeferredValue:function(r,s){var d=Wn();return fn===null?xn(d,r,s):nr(d,fn.memoizedState,r,s)},useTransition:function(){var r=a(go)[0],s=Wn().memoizedState;return[typeof r=="boolean"?r:zc(r),s]},useSyncExternalStore:c,useId:Ko,useHostTransitionStatus:Wo,useFormState:Le,useActionState:Le,useOptimistic:function(r,s){var d=Wn();return fn!==null?U(d,fn,r,s):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:_u,useCacheRefresh:_o};zr.useEffectEvent=kt;function $h(r,s,d,x){s=r.memoizedState,d=d(x,s),d=d==null?s:ue({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Xh={enqueueSetState:function(r,s,d){r=r._reactInternals;var x=Hs(),P=Xo(x);P.payload=s,d!=null&&(P.callback=d),s=wl(r,P,x),s!==null&&($s(s,r,x),Ns(s,r,x))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var x=Hs(),P=Xo(x);P.tag=1,P.payload=s,d!=null&&(P.callback=d),s=wl(r,P,x),s!==null&&($s(s,r,x),Ns(s,r,x))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=Hs(),x=Xo(d);x.tag=2,s!=null&&(x.callback=s),s=wl(r,x,d),s!==null&&($s(s,r,d),Ns(s,r,d))}};function Kl(r,s,d,x,P,k,X){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,k,X):s.prototype&&s.prototype.isPureReactComponent?!ao(d,x)||!ao(P,k):!0}function Of(r,s,d,x){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,x),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,x),s.state!==r&&Xh.enqueueReplaceState(s,s.state,null)}function Ql(r,s){var d=s;if("ref"in s){d={};for(var x in s)x!=="ref"&&(d[x]=s[x])}if(r=r.defaultProps){d===s&&(d=ue({},d));for(var P in r)d[P]===void 0&&(d[P]=r[P])}return d}function Yh(r){ps(r)}function Al(r){console.error(r)}function Cl(r){ps(r)}function vo(r,s){try{var d=r.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(x){setTimeout(function(){throw x})}}function Wh(r,s,d){try{var x=r.onCaughtError;x(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(P){setTimeout(function(){throw P})}}function oh(r,s,d){return d=Xo(d),d.tag=3,d.payload={element:null},d.callback=function(){vo(r,s)},d}function lh(r){return r=Xo(r),r.tag=3,r}function ch(r,s,d,x){var P=d.type.getDerivedStateFromError;if(typeof P=="function"){var k=x.value;r.payload=function(){return P(k)},r.callback=function(){Wh(s,d,x)}}var X=d.stateNode;X!==null&&typeof X.componentDidCatch=="function"&&(r.callback=function(){Wh(s,d,x),typeof P!="function"&&(jc===null?jc=new Set([this]):jc.add(this));var le=x.stack;this.componentDidCatch(x.value,{componentStack:le!==null?le:""})})}function Bf(r,s,d,x,P){if(d.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(s=d.alternate,s!==null&&gs(s,d,P,!0),d=Xt.current,d!==null){switch(d.tag){case 31:case 13:return ti===null?Jd():d.alternate===null&&Sr===0&&(Sr=3),d.flags&=-257,d.flags|=65536,d.lanes=P,x===qt?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([x]):s.add(x),lp(r,x,P)),!1;case 22:return d.flags|=65536,x===qt?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([x])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([x]):d.add(x)),lp(r,x,P)),!1}throw Error(M(435,d.tag))}return lp(r,x,P),Jd(),!1}if(Ni)return s=Xt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=P,x!==On&&(r=Error(M(422),{cause:x}),co(v(r,d)))):(x!==On&&(s=Error(M(423),{cause:x}),co(v(s,d))),r=r.current.alternate,r.flags|=65536,P&=-P,r.lanes|=P,x=v(x,d),P=oh(r.stateNode,x,P),_n(r,P),Sr!==4&&(Sr=2)),!1;var k=Error(M(520),{cause:x});if(k=v(k,d),Yd===null?Yd=[k]:Yd.push(k),Sr!==4&&(Sr=2),s===null)return!0;x=v(x,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,r=P&-P,d.lanes|=r,r=oh(d.stateNode,x,r),_n(d,r),!1;case 1:if(s=d.type,k=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(jc===null||!jc.has(k))))return d.flags|=65536,P&=-P,d.lanes|=P,P=lh(P),ch(P,r,d,x),_n(d,P),!1}d=d.return}while(d!==null);return!1}var Nf=Error(M(461)),Xr=!1;function ua(r,s,d,x){s.child=r===null?Dd(s,null,d,x):Ho(s,r.child,d,x)}function dg(r,s,d,x,P){d=d.render;var k=s.ref;if("ref"in x){var X={};for(var le in x)le!=="ref"&&(X[le]=x[le])}else X=x;return bl(s),x=mu(r,s,d,X,k,P),le=sh(),r!==null&&!Xr?(Wl(r,s,P),ec(r,s,P)):(Ni&&le&&lr(s),s.flags|=1,ua(r,s,x,P),s.child)}function Ff(r,s,d,x,P){if(r===null){var k=d.type;return typeof k=="function"&&!bc(k)&&k.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=k,Kp(r,s,k,x,P)):(r=wc(d.type,null,x,s,s.mode,P),r.ref=s.ref,r.return=s,s.child=r)}if(k=r.child,!Bd(r,P)){var X=k.memoizedProps;if(d=d.compare,d=d!==null?d:ao,d(X,x)&&r.ref===s.ref)return ec(r,s,P)}return s.flags|=1,r=Ma(k,x),r.ref=s.ref,r.return=s,s.child=r}function Kp(r,s,d,x,P){if(r!==null){var k=r.memoizedProps;if(ao(k,x)&&r.ref===s.ref)if(Xr=!1,s.pendingProps=x=k,Bd(r,P))(r.flags&131072)!==0&&(Xr=!0);else return s.lanes=r.lanes,ec(r,s,P)}return Jp(r,s,d,x,P)}function Qp(r,s,d,x){var P=x.children,k=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((s.flags&128)!==0){if(k=k!==null?k.baseLanes|d:d,r!==null){for(x=s.child=r.child,P=0;x!==null;)P=P|x.lanes|x.childLanes,x=x.sibling;x=P&~k}else x=0,s.child=null;return fg(r,s,k,d,x)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&Uh(s,k!==null?k.cachePool:null),k!==null?Ld(s,k):ys(),ih(s);else return x=s.lanes=536870912,fg(r,s,k!==null?k.baseLanes|d:d,d,x)}else k!==null?(Uh(s,k.cachePool),Ld(s,k),gr(),s.memoizedState=null):(r!==null&&Uh(s,null),ys(),gr());return ua(r,s,P,d),s.child}function Jl(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function fg(r,s,d,x,P){var k=jh();return k=k===null?null:{parent:mr._currentValue,pool:k},s.memoizedState={baseLanes:d,cachePool:k},r!==null&&Uh(s,null),ys(),ih(s),r!==null&&gs(r,s,x,!0),s.childLanes=P,null}function Lc(r,s){return s=qf({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function Rd(r,s,d){return Ho(s,r.child,null,d),r=Lc(s,s.pendingProps),r.flags|=2,ir(s),s.memoizedState=null,r}function jf(r,s,d){var x=s.pendingProps,P=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(Ni){if(x.mode==="hidden")return r=Lc(s,x),s.lanes=536870912,Jl(null,r);if(pu(s),(r=Xi)?(r=Cu(r,Fa),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:at!==null?{id:Mt,overflow:Zt}:null,retryLane:536870912,hydrationErrors:null},d=Tc(r),d.return=s,s.child=d,on=s,Xi=null)):r=null,r===null)throw Ca(s);return s.lanes=536870912,null}return Lc(s,x)}var k=r.memoizedState;if(k!==null){var X=k.dehydrated;if(pu(s),P)if(s.flags&256)s.flags&=-257,s=Rd(r,s,d);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(M(558));else if(Xr||gs(r,s,d,!1),P=(d&r.childLanes)!==0,Xr||P){if(x=Kn,x!==null&&(X=Ol(x,d),X!==0&&X!==k.retryLane))throw k.retryLane=X,oa(r,X),$s(x,r,X),Nf;Jd(),s=Rd(r,s,d)}else r=k.treeContext,Xi=wo(X.nextSibling),on=s,Ni=!0,lo=null,Fa=!1,r!==null&&Aa(s,r),s=Lc(s,x),s.flags|=4096;return s}return r=Ma(r.child,{mode:x.mode,children:x.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Uf(r,s){var d=s.ref;if(d===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(M(284));(r===null||r.ref!==d)&&(s.flags|=4194816)}}function Jp(r,s,d,x,P){return bl(s),d=mu(r,s,d,x,void 0,P),x=sh(),r!==null&&!Xr?(Wl(r,s,P),ec(r,s,P)):(Ni&&x&&lr(s),s.flags|=1,ua(r,s,d,P),s.child)}function pg(r,s,d,x,P,k){return bl(s),s.updateQueue=null,d=rh(s,x,d,P),gu(r),x=sh(),r!==null&&!Xr?(Wl(r,s,k),ec(r,s,k)):(Ni&&x&&lr(s),s.flags|=1,ua(r,s,d,k),s.child)}function mg(r,s,d,x,P){if(bl(s),s.stateNode===null){var k=wi,X=d.contextType;typeof X=="object"&&X!==null&&(k=wr(X)),k=new d(x,k),s.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,k.updater=Xh,s.stateNode=k,k._reactInternals=s,k=s.stateNode,k.props=x,k.state=s.memoizedState,k.refs={},Gh(s),X=d.contextType,k.context=typeof X=="object"&&X!==null?wr(X):wi,k.state=s.memoizedState,X=d.getDerivedStateFromProps,typeof X=="function"&&($h(s,d,X,x),k.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(X=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),X!==k.state&&Xh.enqueueReplaceState(k,k.state,null),Yl(s,x,k,P),Tl(),k.state=s.memoizedState),typeof k.componentDidMount=="function"&&(s.flags|=4194308),x=!0}else if(r===null){k=s.stateNode;var le=s.memoizedProps,ke=Ql(d,le);k.props=ke;var nt=k.context,vt=d.contextType;X=wi,typeof vt=="object"&&vt!==null&&(X=wr(vt));var At=d.getDerivedStateFromProps;vt=typeof At=="function"||typeof k.getSnapshotBeforeUpdate=="function",le=s.pendingProps!==le,vt||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(le||nt!==X)&&Of(s,k,x,X),$o=!1;var ot=s.memoizedState;k.state=ot,Yl(s,x,k,P),Tl(),nt=s.memoizedState,le||ot!==nt||$o?(typeof At=="function"&&($h(s,d,At,x),nt=s.memoizedState),(ke=$o||Kl(s,d,ke,x,ot,nt,X))?(vt||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(s.flags|=4194308)):(typeof k.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=x,s.memoizedState=nt),k.props=x,k.state=nt,k.context=X,x=ke):(typeof k.componentDidMount=="function"&&(s.flags|=4194308),x=!1)}else{k=s.stateNode,Ju(r,s),X=s.memoizedProps,vt=Ql(d,X),k.props=vt,At=s.pendingProps,ot=k.context,nt=d.contextType,ke=wi,typeof nt=="object"&&nt!==null&&(ke=wr(nt)),le=d.getDerivedStateFromProps,(nt=typeof le=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(X!==At||ot!==ke)&&Of(s,k,x,ke),$o=!1,ot=s.memoizedState,k.state=ot,Yl(s,x,k,P),Tl();var pt=s.memoizedState;X!==At||ot!==pt||$o||r!==null&&r.dependencies!==null&&uu(r.dependencies)?(typeof le=="function"&&($h(s,d,le,x),pt=s.memoizedState),(vt=$o||Kl(s,d,vt,x,ot,pt,ke)||r!==null&&r.dependencies!==null&&uu(r.dependencies))?(nt||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(x,pt,ke),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(x,pt,ke)),typeof k.componentDidUpdate=="function"&&(s.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof k.componentDidUpdate!="function"||X===r.memoizedProps&&ot===r.memoizedState||(s.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||X===r.memoizedProps&&ot===r.memoizedState||(s.flags|=1024),s.memoizedProps=x,s.memoizedState=pt),k.props=x,k.state=pt,k.context=ke,x=vt):(typeof k.componentDidUpdate!="function"||X===r.memoizedProps&&ot===r.memoizedState||(s.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||X===r.memoizedProps&&ot===r.memoizedState||(s.flags|=1024),x=!1)}return k=x,Uf(r,s),x=(s.flags&128)!==0,k||x?(k=s.stateNode,d=x&&typeof d.getDerivedStateFromError!="function"?null:k.render(),s.flags|=1,r!==null&&x?(s.child=Ho(s,r.child,null,P),s.child=Ho(s,null,d,P)):ua(r,s,d,P),s.memoizedState=k.state,r=s.child):r=ec(r,s,P),r}function gg(r,s,d,x){return ks(),s.flags|=256,ua(r,s,d,x),s.child}var Vf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Od(r){return{baseLanes:r,cachePool:Rf()}}function Zf(r,s,d){return r=r!==null?r.childLanes&~d:0,s&&(r|=Va),r}function em(r,s,d){var x=s.pendingProps,P=!1,k=(s.flags&128)!==0,X;if((X=k)||(X=r!==null&&r.memoizedState===null?!1:(cr.current&2)!==0),X&&(P=!0,s.flags&=-129),X=(s.flags&32)!==0,s.flags&=-33,r===null){if(Ni){if(P?Fs(s):gr(),(r=Xi)?(r=Cu(r,Fa),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:at!==null?{id:Mt,overflow:Zt}:null,retryLane:536870912,hydrationErrors:null},d=Tc(r),d.return=s,s.child=d,on=s,Xi=null)):r=null,r===null)throw Ca(s);return Dr(r)?s.lanes=32:s.lanes=536870912,null}var le=x.children;return x=x.fallback,P?(gr(),P=s.mode,le=qf({mode:"hidden",children:le},P),x=jo(x,P,d,null),le.return=s,x.return=s,le.sibling=x,s.child=le,x=s.child,x.memoizedState=Od(d),x.childLanes=Zf(r,X,d),s.memoizedState=Vf,Jl(null,x)):(Fs(s),tm(s,le))}var ke=r.memoizedState;if(ke!==null&&(le=ke.dehydrated,le!==null)){if(k)s.flags&256?(Fs(s),s.flags&=-257,s=Gf(r,s,d)):s.memoizedState!==null?(gr(),s.child=r.child,s.flags|=128,s=null):(gr(),le=x.fallback,P=s.mode,x=qf({mode:"visible",children:x.children},P),le=jo(le,P,d,null),le.flags|=2,x.return=s,le.return=s,x.sibling=le,s.child=x,Ho(s,r.child,null,d),x=s.child,x.memoizedState=Od(d),x.childLanes=Zf(r,X,d),s.memoizedState=Vf,s=Jl(null,x));else if(Fs(s),Dr(le)){if(X=le.nextSibling&&le.nextSibling.dataset,X)var nt=X.dgst;X=nt,x=Error(M(419)),x.stack="",x.digest=X,co({value:x,source:null,stack:null}),s=Gf(r,s,d)}else if(Xr||gs(r,s,d,!1),X=(d&r.childLanes)!==0,Xr||X){if(X=Kn,X!==null&&(x=Ol(X,d),x!==0&&x!==ke.retryLane))throw ke.retryLane=x,oa(r,x),$s(X,r,x),Nf;Qa(le)||Jd(),s=Gf(r,s,d)}else Qa(le)?(s.flags|=192,s.child=r.child,s=null):(r=ke.treeContext,Xi=wo(le.nextSibling),on=s,Ni=!0,lo=null,Fa=!1,r!==null&&Aa(s,r),s=tm(s,x.children),s.flags|=4096);return s}return P?(gr(),le=x.fallback,P=s.mode,ke=r.child,nt=ke.sibling,x=Ma(ke,{mode:"hidden",children:x.children}),x.subtreeFlags=ke.subtreeFlags&65011712,nt!==null?le=Ma(nt,le):(le=jo(le,P,d,null),le.flags|=2),le.return=s,x.return=s,x.sibling=le,s.child=x,Jl(null,x),x=s.child,le=r.child.memoizedState,le===null?le=Od(d):(P=le.cachePool,P!==null?(ke=mr._currentValue,P=P.parent!==ke?{parent:ke,pool:ke}:P):P=Rf(),le={baseLanes:le.baseLanes|d,cachePool:P}),x.memoizedState=le,x.childLanes=Zf(r,X,d),s.memoizedState=Vf,Jl(r.child,x)):(Fs(s),d=r.child,r=d.sibling,d=Ma(d,{mode:"visible",children:x.children}),d.return=s,d.sibling=null,r!==null&&(X=s.deletions,X===null?(s.deletions=[r],s.flags|=16):X.push(r)),s.child=d,s.memoizedState=null,d)}function tm(r,s){return s=qf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function qf(r,s){return r=Ea(22,r,null,s),r.lanes=0,r}function Gf(r,s,d){return Ho(s,r.child,null,d),r=tm(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function im(r,s,d){r.lanes|=s;var x=r.alternate;x!==null&&(x.lanes|=s),Bh(r.return,s,d)}function nm(r,s,d,x,P,k){var X=r.memoizedState;X===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:x,tail:d,tailMode:P,treeForkCount:k}:(X.isBackwards=s,X.rendering=null,X.renderingStartTime=0,X.last=x,X.tail=d,X.tailMode=P,X.treeForkCount=k)}function Hf(r,s,d){var x=s.pendingProps,P=x.revealOrder,k=x.tail;x=x.children;var X=cr.current,le=(X&2)!==0;if(le?(X=X&1|2,s.flags|=128):X&=1,yt(cr,X),ua(r,s,x,d),x=Ni?ae:0,!le&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&im(r,d,s);else if(r.tag===19)im(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(P){case"forwards":for(d=s.child,P=null;d!==null;)r=d.alternate,r!==null&&nh(r)===null&&(P=d),d=d.sibling;d=P,d===null?(P=s.child,s.child=null):(P=d.sibling,d.sibling=null),nm(s,!1,P,d,k,x);break;case"backwards":case"unstable_legacy-backwards":for(d=null,P=s.child,s.child=null;P!==null;){if(r=P.alternate,r!==null&&nh(r)===null){s.child=P;break}r=P.sibling,P.sibling=d,d=P,P=r}nm(s,!0,d,null,k,x);break;case"together":nm(s,!1,null,null,void 0,x);break;default:s.memoizedState=null}return s.child}function ec(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),Fc|=s.lanes,(d&s.childLanes)===0)if(r!==null){if(gs(r,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(M(153));if(s.child!==null){for(r=s.child,d=Ma(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=Ma(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function Bd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&uu(r)))}function Nd(r,s,d){switch(s.tag){case 3:ui(s,s.stateNode.containerInfo),xl(s,mr,r.memoizedState.cache),ks();break;case 27:case 5:mn(s);break;case 4:ui(s,s.stateNode.containerInfo);break;case 10:xl(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,pu(s),null;break;case 13:var x=s.memoizedState;if(x!==null)return x.dehydrated!==null?(Fs(s),s.flags|=128,null):(d&s.child.childLanes)!==0?em(r,s,d):(Fs(s),r=ec(r,s,d),r!==null?r.sibling:null);Fs(s);break;case 19:var P=(r.flags&128)!==0;if(x=(d&s.childLanes)!==0,x||(gs(r,s,d,!1),x=(d&s.childLanes)!==0),P){if(x)return Hf(r,s,d);s.flags|=128}if(P=s.memoizedState,P!==null&&(P.rendering=null,P.tail=null,P.lastEffect=null),yt(cr,cr.current),x)break;return null;case 22:return s.lanes=0,Qp(r,s,d,s.pendingProps);case 24:xl(s,mr,r.memoizedState.cache)}return ec(r,s,d)}function Ka(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps)Xr=!0;else{if(!Bd(r,d)&&(s.flags&128)===0)return Xr=!1,Nd(r,s,d);Xr=(r.flags&131072)!==0}else Xr=!1,Ni&&(s.flags&1048576)!==0&&Li(s,ae,s.index);switch(s.lanes=0,s.tag){case 16:e:{var x=s.pendingProps;if(r=Bs(s.elementType),s.type=r,typeof r=="function")bc(r)?(x=Ql(r,x),s.tag=1,s=mg(null,s,r,x,d)):(s.tag=0,s=Jp(null,s,r,x,d));else{if(r!=null){var P=r.$$typeof;if(P===Ut){s.tag=11,s=dg(null,s,r,x,d);break e}else if(P===rt){s.tag=14,s=Ff(null,s,r,x,d);break e}}throw s=oi(r)||r,Error(M(306,s,""))}}return s;case 0:return Jp(r,s,s.type,s.pendingProps,d);case 1:return x=s.type,P=Ql(x,s.pendingProps),mg(r,s,x,P,d);case 3:e:{if(ui(s,s.stateNode.containerInfo),r===null)throw Error(M(387));x=s.pendingProps;var k=s.memoizedState;P=k.element,Ju(r,s),Yl(s,x,null,d);var X=s.memoizedState;if(x=X.cache,xl(s,mr,x),x!==k.cache&&Nh(s,[mr],d,!0),Tl(),x=X.element,k.isDehydrated)if(k={element:x,isDehydrated:!1,cache:X.cache},s.updateQueue.baseState=k,s.memoizedState=k,s.flags&256){s=gg(r,s,x,d);break e}else if(x!==P){P=v(Error(M(424)),s),co(P),s=gg(r,s,x,d);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Xi=wo(r.firstChild),on=s,Ni=!0,lo=null,Fa=!0,d=Dd(s,null,x,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(ks(),x===P){s=ec(r,s,d);break e}ua(r,s,x,d)}s=s.child}return s;case 26:return Uf(r,s),r===null?(d=Bm(s.type,null,s.pendingProps,null))?s.memoizedState=d:Ni||(d=s.type,r=s.pendingProps,x=sf(Lt.current).createElement(d),x[gn]=s,x[It]=r,da(x,d,r),Gn(x),s.stateNode=x):s.memoizedState=Bm(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return mn(s),r===null&&Ni&&(x=s.stateNode=Wg(s.type,s.pendingProps,Lt.current),on=s,Fa=!0,P=Xi,Au(s.type)?(Ts=P,Xi=wo(x.firstChild)):Xi=P),ua(r,s,s.pendingProps.children,d),Uf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&Ni&&((P=x=Xi)&&(x=Da(x,s.type,s.pendingProps,Fa),x!==null?(s.stateNode=x,on=s,Xi=wo(x.firstChild),Fa=!1,P=!0):P=!1),P||Ca(s)),mn(s),P=s.type,k=s.pendingProps,X=r!==null?r.memoizedProps:null,x=k.children,vp(P,k)?x=null:X!==null&&vp(P,X)&&(s.flags|=32),s.memoizedState!==null&&(P=mu(r,s,ah,null,null,d),pd._currentValue=P),Uf(r,s),ua(r,s,x,d),s.child;case 6:return r===null&&Ni&&((r=d=Xi)&&(d=Ll(d,s.pendingProps,Fa),d!==null?(s.stateNode=d,on=s,Xi=null,r=!0):r=!1),r||Ca(s)),null;case 13:return em(r,s,d);case 4:return ui(s,s.stateNode.containerInfo),x=s.pendingProps,r===null?s.child=Ho(s,null,x,d):ua(r,s,x,d),s.child;case 11:return dg(r,s,s.type,s.pendingProps,d);case 7:return ua(r,s,s.pendingProps,d),s.child;case 8:return ua(r,s,s.pendingProps.children,d),s.child;case 12:return ua(r,s,s.pendingProps.children,d),s.child;case 10:return x=s.pendingProps,xl(s,s.type,x.value),ua(r,s,x.children,d),s.child;case 9:return P=s.type._context,x=s.pendingProps.children,bl(s),P=wr(P),x=x(P),s.flags|=1,ua(r,s,x,d),s.child;case 14:return Ff(r,s,s.type,s.pendingProps,d);case 15:return Kp(r,s,s.type,s.pendingProps,d);case 19:return Hf(r,s,d);case 31:return jf(r,s,d);case 22:return Qp(r,s,d,s.pendingProps);case 24:return bl(s),x=wr(mr),r===null?(P=jh(),P===null&&(P=Kn,k=Zo(),P.pooledCache=k,k.refCount++,k!==null&&(P.pooledCacheLanes|=d),P=k),s.memoizedState={parent:x,cache:P},Gh(s),xl(s,mr,P)):((r.lanes&d)!==0&&(Ju(r,s),Yl(s,null,null,d),Tl()),P=r.memoizedState,k=s.memoizedState,P.parent!==x?(P={parent:x,cache:x},s.memoizedState=P,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=P),xl(s,mr,x)):(x=k.cache,xl(s,mr,x),x!==P.cache&&Nh(s,[mr],d,!0))),ua(r,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(M(156,s.tag))}function tc(r){r.flags|=4}function Fd(r,s,d,x,P){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(P&335544128)===P)if(r.stateNode.complete)r.flags|=8192;else if(mm())r.flags|=8192;else throw fo=qt,Xl}else r.flags&=-16777217}function _g(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!uf(s))if(mm())r.flags|=8192;else throw fo=qt,Xl}function jd(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?Ki():536870912,r.lanes|=s,ph|=s)}function Ud(r,s){if(!Ni)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var x=null;d!==null;)d.alternate!==null&&(x=d),d=d.sibling;x===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function dr(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,x=0;if(s)for(var P=r.child;P!==null;)d|=P.lanes|P.childLanes,x|=P.subtreeFlags&65011712,x|=P.flags&65011712,P.return=r,P=P.sibling;else for(P=r.child;P!==null;)d|=P.lanes|P.childLanes,x|=P.subtreeFlags,x|=P.flags,P.return=r,P=P.sibling;return r.subtreeFlags|=x,r.childLanes=d,s}function yg(r,s,d){var x=s.pendingProps;switch(Xn(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return dr(s),null;case 1:return dr(s),null;case 3:return d=s.stateNode,x=null,r!==null&&(x=r.memoizedState.cache),s.memoizedState.cache!==x&&(s.flags|=2048),Vo(mr),Ai(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(ja(s)?tc(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Rs())),dr(s),null;case 26:var P=s.type,k=s.memoizedState;return r===null?(tc(s),k!==null?(dr(s),_g(s,k)):(dr(s),Fd(s,P,null,x,d))):k?k!==r.memoizedState?(tc(s),dr(s),_g(s,k)):(dr(s),s.flags&=-16777217):(r=r.memoizedProps,r!==x&&tc(s),dr(s),Fd(s,P,r,x,d)),null;case 27:if(vr(s),d=Lt.current,P=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&tc(s);else{if(!x){if(s.stateNode===null)throw Error(M(166));return dr(s),null}r=Pt.current,ja(s)?la(s):(r=Wg(P,x,d),s.stateNode=r,tc(s))}return dr(s),null;case 5:if(vr(s),P=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&tc(s);else{if(!x){if(s.stateNode===null)throw Error(M(166));return dr(s),null}if(k=Pt.current,ja(s))la(s);else{var X=sf(Lt.current);switch(k){case 1:k=X.createElementNS("http://www.w3.org/2000/svg",P);break;case 2:k=X.createElementNS("http://www.w3.org/1998/Math/MathML",P);break;default:switch(P){case"svg":k=X.createElementNS("http://www.w3.org/2000/svg",P);break;case"math":k=X.createElementNS("http://www.w3.org/1998/Math/MathML",P);break;case"script":k=X.createElement("div"),k.innerHTML="<script><\/script>",k=k.removeChild(k.firstChild);break;case"select":k=typeof x.is=="string"?X.createElement("select",{is:x.is}):X.createElement("select"),x.multiple?k.multiple=!0:x.size&&(k.size=x.size);break;default:k=typeof x.is=="string"?X.createElement(P,{is:x.is}):X.createElement(P)}}k[gn]=s,k[It]=x;e:for(X=s.child;X!==null;){if(X.tag===5||X.tag===6)k.appendChild(X.stateNode);else if(X.tag!==4&&X.tag!==27&&X.child!==null){X.child.return=X,X=X.child;continue}if(X===s)break e;for(;X.sibling===null;){if(X.return===null||X.return===s)break e;X=X.return}X.sibling.return=X.return,X=X.sibling}s.stateNode=k;e:switch(da(k,P,x),P){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&tc(s)}}return dr(s),Fd(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,d),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==x&&tc(s);else{if(typeof x!="string"&&s.stateNode===null)throw Error(M(166));if(r=Lt.current,ja(s)){if(r=s.stateNode,d=s.memoizedProps,x=null,P=on,P!==null)switch(P.tag){case 27:case 5:x=P.memoizedProps}r[gn]=s,r=!!(r.nodeValue===d||x!==null&&x.suppressHydrationWarning===!0||Am(r.nodeValue,d)),r||Ca(s,!0)}else r=sf(r).createTextNode(x),r[gn]=s,s.stateNode=r}return dr(s),null;case 31:if(d=s.memoizedState,r===null||r.memoizedState!==null){if(x=ja(s),d!==null){if(r===null){if(!x)throw Error(M(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(M(557));r[gn]=s}else ks(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;dr(s),r=!1}else d=Rs(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return s.flags&256?(ir(s),s):(ir(s),null);if((s.flags&128)!==0)throw Error(M(558))}return dr(s),null;case 13:if(x=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(P=ja(s),x!==null&&x.dehydrated!==null){if(r===null){if(!P)throw Error(M(318));if(P=s.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(M(317));P[gn]=s}else ks(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;dr(s),P=!1}else P=Rs(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=P),P=!0;if(!P)return s.flags&256?(ir(s),s):(ir(s),null)}return ir(s),(s.flags&128)!==0?(s.lanes=d,s):(d=x!==null,r=r!==null&&r.memoizedState!==null,d&&(x=s.child,P=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(P=x.alternate.memoizedState.cachePool.pool),k=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(k=x.memoizedState.cachePool.pool),k!==P&&(x.flags|=2048)),d!==r&&d&&(s.child.flags|=8192),jd(s,s.updateQueue),dr(s),null);case 4:return Ai(),r===null&&Em(s.stateNode.containerInfo),dr(s),null;case 10:return Vo(s.type),dr(s),null;case 19:if(Ue(cr),x=s.memoizedState,x===null)return dr(s),null;if(P=(s.flags&128)!==0,k=x.rendering,k===null)if(P)Ud(x,!1);else{if(Sr!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(k=nh(r),k!==null){for(s.flags|=128,Ud(x,!1),r=k.updateQueue,s.updateQueue=r,jd(s,r),s.subtreeFlags=0,r=d,d=s.child;d!==null;)$u(d,r),d=d.sibling;return yt(cr,cr.current&1|2),Ni&&ci(s,x.treeForkCount),s.child}r=r.sibling}x.tail!==null&&Ei()>Wd&&(s.flags|=128,P=!0,Ud(x,!1),s.lanes=4194304)}else{if(!P)if(r=nh(k),r!==null){if(s.flags|=128,P=!0,r=r.updateQueue,s.updateQueue=r,jd(s,r),Ud(x,!0),x.tail===null&&x.tailMode==="hidden"&&!k.alternate&&!Ni)return dr(s),null}else 2*Ei()-x.renderingStartTime>Wd&&d!==536870912&&(s.flags|=128,P=!0,Ud(x,!1),s.lanes=4194304);x.isBackwards?(k.sibling=s.child,s.child=k):(r=x.last,r!==null?r.sibling=k:s.child=k,x.last=k)}return x.tail!==null?(r=x.tail,x.rendering=r,x.tail=r.sibling,x.renderingStartTime=Ei(),r.sibling=null,d=cr.current,yt(cr,P?d&1|2:d&1),Ni&&ci(s,x.treeForkCount),r):(dr(s),null);case 22:case 23:return ir(s),Ac(),x=s.memoizedState!==null,r!==null?r.memoizedState!==null!==x&&(s.flags|=8192):x&&(s.flags|=8192),x?(d&536870912)!==0&&(s.flags&128)===0&&(dr(s),s.subtreeFlags&6&&(s.flags|=8192)):dr(s),d=s.updateQueue,d!==null&&jd(s,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),x=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(x=s.memoizedState.cachePool.pool),x!==d&&(s.flags|=2048),r!==null&&Ue(uo),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Vo(mr),dr(s),null;case 25:return null;case 30:return null}throw Error(M(156,s.tag))}function X_(r,s){switch(Xn(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Vo(mr),Ai(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return vr(s),null;case 31:if(s.memoizedState!==null){if(ir(s),s.alternate===null)throw Error(M(340));ks()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(ir(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(M(340));ks()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Ue(cr),null;case 4:return Ai(),null;case 10:return Vo(s.type),null;case 22:case 23:return ir(s),Ac(),r!==null&&Ue(uo),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Vo(mr),null;case 25:return null;default:return null}}function $f(r,s){switch(Xn(s),s.tag){case 3:Vo(mr),Ai();break;case 26:case 27:case 5:vr(s);break;case 4:Ai();break;case 31:s.memoizedState!==null&&ir(s);break;case 13:ir(s);break;case 19:Ue(cr);break;case 10:Vo(s.type);break;case 22:case 23:ir(s),Ac(),r!==null&&Ue(uo);break;case 24:Vo(mr)}}function Kh(r,s){try{var d=s.updateQueue,x=d!==null?d.lastEffect:null;if(x!==null){var P=x.next;d=P;do{if((d.tag&r)===r){x=void 0;var k=d.create,X=d.inst;x=k(),X.destroy=x}d=d.next}while(d!==P)}}catch(le){Cn(s,s.return,le)}}function kc(r,s,d){try{var x=s.updateQueue,P=x!==null?x.lastEffect:null;if(P!==null){var k=P.next;x=k;do{if((x.tag&r)===r){var X=x.inst,le=X.destroy;if(le!==void 0){X.destroy=void 0,P=s;var ke=d,nt=le;try{nt()}catch(vt){Cn(P,ke,vt)}}}x=x.next}while(x!==k)}}catch(vt){Cn(s,s.return,vt)}}function vg(r){var s=r.updateQueue;if(s!==null){var d=r.stateNode;try{Hh(s,d)}catch(x){Cn(r,r.return,x)}}}function xg(r,s,d){d.props=Ql(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(x){Cn(r,s,x)}}function Vd(r,s){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var x=r.stateNode;break;case 30:x=r.stateNode;break;default:x=r.stateNode}typeof d=="function"?r.refCleanup=d(x):d.current=x}}catch(P){Cn(r,s,P)}}function xo(r,s){var d=r.ref,x=r.refCleanup;if(d!==null)if(typeof x=="function")try{x()}catch(P){Cn(r,s,P)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(P){Cn(r,s,P)}else d.current=null}function Xf(r){var s=r.type,d=r.memoizedProps,x=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&x.focus();break e;case"img":d.src?x.src=d.src:d.srcSet&&(x.srcset=d.srcSet)}}catch(P){Cn(r,r.return,P)}}function Yf(r,s,d){try{var x=r.stateNode;Xg(x,r.type,d,s),x[It]=s}catch(P){Cn(r,r.return,P)}}function vu(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Au(r.type)||r.tag===4}function uh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||vu(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Au(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function rm(r,s,d){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(r),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=ga));else if(x!==4&&(x===27&&Au(r.type)&&(d=r.stateNode,s=null),r=r.child,r!==null))for(rm(r,s,d),r=r.sibling;r!==null;)rm(r,s,d),r=r.sibling}function Wf(r,s,d){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(x!==4&&(x===27&&Au(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(Wf(r,s,d),r=r.sibling;r!==null;)Wf(r,s,d),r=r.sibling}function bg(r){var s=r.stateNode,d=r.memoizedProps;try{for(var x=r.type,P=s.attributes;P.length;)s.removeAttributeNode(P[0]);da(s,x,d),s[gn]=r,s[It]=d}catch(k){Cn(r,r.return,k)}}var Rc=!1,Yr=!1,am=!1,wg=typeof WeakSet=="function"?WeakSet:Set,Wr=null;function Y_(r,s){if(r=r.containerInfo,af=mf,r=dl(r),Ls(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var x=d.getSelection&&d.getSelection();if(x&&x.rangeCount!==0){d=x.anchorNode;var P=x.anchorOffset,k=x.focusNode;x=x.focusOffset;try{d.nodeType,k.nodeType}catch{d=null;break e}var X=0,le=-1,ke=-1,nt=0,vt=0,At=r,ot=null;t:for(;;){for(var pt;At!==d||P!==0&&At.nodeType!==3||(le=X+P),At!==k||x!==0&&At.nodeType!==3||(ke=X+x),At.nodeType===3&&(X+=At.nodeValue.length),(pt=At.firstChild)!==null;)ot=At,At=pt;for(;;){if(At===r)break t;if(ot===d&&++nt===P&&(le=X),ot===k&&++vt===x&&(ke=X),(pt=At.nextSibling)!==null)break;At=ot,ot=At.parentNode}At=pt}d=le===-1||ke===-1?null:{start:le,end:ke}}else d=null}d=d||{start:0,end:0}}else d=null;for(Cm={focusedElem:r,selectionRange:d},mf=!1,Wr=s;Wr!==null;)if(s=Wr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Wr=r;else for(;Wr!==null;){switch(s=Wr,k=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)P=r[d],P.ref.impl=P.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&k!==null){r=void 0,d=s,P=k.memoizedProps,k=k.memoizedState,x=d.stateNode;try{var ni=Ql(d.type,P);r=x.getSnapshotBeforeUpdate(ni,k),x.__reactInternalSnapshotBeforeUpdate=r}catch(_i){Cn(d,d.return,_i)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,d=r.nodeType,d===9)Il(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Il(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(M(163))}if(r=s.sibling,r!==null){r.return=s.return,Wr=r;break}Wr=s.return}}function sm(r,s,d){var x=d.flags;switch(d.tag){case 0:case 11:case 15:qs(r,d),x&4&&Kh(5,d);break;case 1:if(qs(r,d),x&4)if(r=d.stateNode,s===null)try{r.componentDidMount()}catch(X){Cn(d,d.return,X)}else{var P=Ql(d.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(P,s,r.__reactInternalSnapshotBeforeUpdate)}catch(X){Cn(d,d.return,X)}}x&64&&vg(d),x&512&&Vd(d,d.return);break;case 3:if(qs(r,d),x&64&&(r=d.updateQueue,r!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{Hh(r,s)}catch(X){Cn(d,d.return,X)}}break;case 27:s===null&&x&4&&bg(d);case 26:case 5:qs(r,d),s===null&&x&4&&Xf(d),x&512&&Vd(d,d.return);break;case 12:qs(r,d);break;case 31:qs(r,d),x&4&&Zd(r,d);break;case 13:qs(r,d),x&4&&qd(r,d),x&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=_m.bind(null,d),Qr(r,d))));break;case 22:if(x=d.memoizedState!==null||Rc,!x){s=s!==null&&s.memoizedState!==null||Yr,P=Rc;var k=Yr;Rc=x,(Yr=s)&&!k?Oc(r,d,(d.subtreeFlags&8772)!==0):qs(r,d),Rc=P,Yr=k}break;case 30:break;default:qs(r,d)}}function Qh(r){var s=r.alternate;s!==null&&(r.alternate=null,Qh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&il(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var _r=null,rn=!1;function Zs(r,s,d){for(d=d.child;d!==null;)om(r,s,d),d=d.sibling}function om(r,s,d){if(Ie&&typeof Ie.onCommitFiberUnmount=="function")try{Ie.onCommitFiberUnmount(Ne,d)}catch{}switch(d.tag){case 26:Yr||xo(d,s),Zs(r,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:Yr||xo(d,s);var x=_r,P=rn;Au(d.type)&&(_r=d.stateNode,rn=!1),Zs(r,s,d),hd(d.stateNode),_r=x,rn=P;break;case 5:Yr||xo(d,s);case 6:if(x=_r,P=rn,_r=null,Zs(r,s,d),_r=x,rn=P,_r!==null)if(rn)try{(_r.nodeType===9?_r.body:_r.nodeName==="HTML"?_r.ownerDocument.body:_r).removeChild(d.stateNode)}catch(k){Cn(d,s,k)}else try{_r.removeChild(d.stateNode)}catch(k){Cn(d,s,k)}break;case 18:_r!==null&&(rn?(r=_r,Yg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),Lu(r)):Yg(_r,d.stateNode));break;case 4:x=_r,P=rn,_r=d.stateNode.containerInfo,rn=!0,Zs(r,s,d),_r=x,rn=P;break;case 0:case 11:case 14:case 15:kc(2,d,s),Yr||kc(4,d,s),Zs(r,s,d);break;case 1:Yr||(xo(d,s),x=d.stateNode,typeof x.componentWillUnmount=="function"&&xg(d,s,x)),Zs(r,s,d);break;case 21:Zs(r,s,d);break;case 22:Yr=(x=Yr)||d.memoizedState!==null,Zs(r,s,d),Yr=x;break;default:Zs(r,s,d)}}function Zd(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Lu(r)}catch(d){Cn(s,s.return,d)}}}function qd(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Lu(r)}catch(d){Cn(s,s.return,d)}}function Gd(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new wg),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new wg),s;default:throw Error(M(435,r.tag))}}function Hd(r,s){var d=Gd(r);s.forEach(function(x){if(!d.has(x)){d.add(x);var P=Q_.bind(null,r,x);x.then(P,P)}})}function xs(r,s){var d=s.deletions;if(d!==null)for(var x=0;x<d.length;x++){var P=d[x],k=r,X=s,le=X;e:for(;le!==null;){switch(le.tag){case 27:if(Au(le.type)){_r=le.stateNode,rn=!1;break e}break;case 5:_r=le.stateNode,rn=!1;break e;case 3:case 4:_r=le.stateNode.containerInfo,rn=!0;break e}le=le.return}if(_r===null)throw Error(M(160));om(k,X,P),_r=null,rn=!1,k=P.alternate,k!==null&&(k.return=null),P.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Kf(s,r),s=s.sibling}var bs=null;function Kf(r,s){var d=r.alternate,x=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:xs(s,r),ha(r),x&4&&(kc(3,r,r.return),Kh(3,r),kc(5,r,r.return));break;case 1:xs(s,r),ha(r),x&512&&(Yr||d===null||xo(d,d.return)),x&64&&Rc&&(r=r.updateQueue,r!==null&&(x=r.callbacks,x!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?x:d.concat(x))));break;case 26:var P=bs;if(xs(s,r),ha(r),x&512&&(Yr||d===null||xo(d,d.return)),x&4){var k=d!==null?d.memoizedState:null;if(x=r.memoizedState,d===null)if(x===null)if(r.stateNode===null){e:{x=r.type,d=r.memoizedProps,P=P.ownerDocument||P;t:switch(x){case"title":k=P.getElementsByTagName("title")[0],(!k||k[vi]||k[gn]||k.namespaceURI==="http://www.w3.org/2000/svg"||k.hasAttribute("itemprop"))&&(k=P.createElement(x),P.head.insertBefore(k,P.querySelector("head > title"))),da(k,x,d),k[gn]=r,Gn(k),x=k;break e;case"link":var X=Um("link","href",P).get(x+(d.href||""));if(X){for(var le=0;le<X.length;le++)if(k=X[le],k.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&k.getAttribute("rel")===(d.rel==null?null:d.rel)&&k.getAttribute("title")===(d.title==null?null:d.title)&&k.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){X.splice(le,1);break t}}k=P.createElement(x),da(k,x,d),P.head.appendChild(k);break;case"meta":if(X=Um("meta","content",P).get(x+(d.content||""))){for(le=0;le<X.length;le++)if(k=X[le],k.getAttribute("content")===(d.content==null?null:""+d.content)&&k.getAttribute("name")===(d.name==null?null:d.name)&&k.getAttribute("property")===(d.property==null?null:d.property)&&k.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&k.getAttribute("charset")===(d.charSet==null?null:d.charSet)){X.splice(le,1);break t}}k=P.createElement(x),da(k,x,d),P.head.appendChild(k);break;default:throw Error(M(468,x))}k[gn]=r,Gn(k),x=k}r.stateNode=x}else cf(P,r.type,r.stateNode);else r.stateNode=jm(P,x,r.memoizedProps);else k!==x?(k===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):k.count--,x===null?cf(P,r.type,r.stateNode):jm(P,x,r.memoizedProps)):x===null&&r.stateNode!==null&&Yf(r,r.memoizedProps,d.memoizedProps)}break;case 27:xs(s,r),ha(r),x&512&&(Yr||d===null||xo(d,d.return)),d!==null&&x&4&&Yf(r,r.memoizedProps,d.memoizedProps);break;case 5:if(xs(s,r),ha(r),x&512&&(Yr||d===null||xo(d,d.return)),r.flags&32){P=r.stateNode;try{Ba(P,"")}catch(ni){Cn(r,r.return,ni)}}x&4&&r.stateNode!=null&&(P=r.memoizedProps,Yf(r,P,d!==null?d.memoizedProps:P)),x&1024&&(am=!0);break;case 6:if(xs(s,r),ha(r),x&4){if(r.stateNode===null)throw Error(M(162));x=r.memoizedProps,d=r.stateNode;try{d.nodeValue=x}catch(ni){Cn(r,r.return,ni)}}break;case 3:if(Ep=null,P=bs,bs=wp(s.containerInfo),xs(s,r),bs=P,ha(r),x&4&&d!==null&&d.memoizedState.isDehydrated)try{Lu(s.containerInfo)}catch(ni){Cn(r,r.return,ni)}am&&(am=!1,$d(r));break;case 4:x=bs,bs=wp(r.stateNode.containerInfo),xs(s,r),ha(r),bs=x;break;case 12:xs(s,r),ha(r);break;case 31:xs(s,r),ha(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,Hd(r,x)));break;case 13:xs(s,r),ha(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(ep=Ei()),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,Hd(r,x)));break;case 22:P=r.memoizedState!==null;var ke=d!==null&&d.memoizedState!==null,nt=Rc,vt=Yr;if(Rc=nt||P,Yr=vt||ke,xs(s,r),Yr=vt,Rc=nt,ha(r),x&8192)e:for(s=r.stateNode,s._visibility=P?s._visibility&-2:s._visibility|1,P&&(d===null||ke||Rc||Yr||Pl(r)),d=null,s=r;;){if(s.tag===5||s.tag===26){if(d===null){ke=d=s;try{if(k=ke.stateNode,P)X=k.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none";else{le=ke.stateNode;var At=ke.memoizedProps.style,ot=At!=null&&At.hasOwnProperty("display")?At.display:null;le.style.display=ot==null||typeof ot=="boolean"?"":(""+ot).trim()}}catch(ni){Cn(ke,ke.return,ni)}}}else if(s.tag===6){if(d===null){ke=s;try{ke.stateNode.nodeValue=P?"":ke.memoizedProps}catch(ni){Cn(ke,ke.return,ni)}}}else if(s.tag===18){if(d===null){ke=s;try{var pt=ke.stateNode;P?Oi(pt,!0):Oi(ke.stateNode,!1)}catch(ni){Cn(ke,ke.return,ni)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}x&4&&(x=r.updateQueue,x!==null&&(d=x.retryQueue,d!==null&&(x.retryQueue=null,Hd(r,d))));break;case 19:xs(s,r),ha(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,Hd(r,x)));break;case 30:break;case 21:break;default:xs(s,r),ha(r)}}function ha(r){var s=r.flags;if(s&2){try{for(var d,x=r.return;x!==null;){if(vu(x)){d=x;break}x=x.return}if(d==null)throw Error(M(160));switch(d.tag){case 27:var P=d.stateNode,k=uh(r);Wf(r,k,P);break;case 5:var X=d.stateNode;d.flags&32&&(Ba(X,""),d.flags&=-33);var le=uh(r);Wf(r,le,X);break;case 3:case 4:var ke=d.stateNode.containerInfo,nt=uh(r);rm(r,nt,ke);break;default:throw Error(M(161))}}catch(vt){Cn(r,r.return,vt)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function $d(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;$d(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function qs(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)sm(r,s.alternate,s),s=s.sibling}function Pl(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:kc(4,s,s.return),Pl(s);break;case 1:xo(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&xg(s,s.return,d),Pl(s);break;case 27:hd(s.stateNode);case 26:case 5:xo(s,s.return),Pl(s);break;case 22:s.memoizedState===null&&Pl(s);break;case 30:Pl(s);break;default:Pl(s)}r=r.sibling}}function Oc(r,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var x=s.alternate,P=r,k=s,X=k.flags;switch(k.tag){case 0:case 11:case 15:Oc(P,k,d),Kh(4,k);break;case 1:if(Oc(P,k,d),x=k,P=x.stateNode,typeof P.componentDidMount=="function")try{P.componentDidMount()}catch(nt){Cn(x,x.return,nt)}if(x=k,P=x.updateQueue,P!==null){var le=x.stateNode;try{var ke=P.shared.hiddenCallbacks;if(ke!==null)for(P.shared.hiddenCallbacks=null,P=0;P<ke.length;P++)eh(ke[P],le)}catch(nt){Cn(x,x.return,nt)}}d&&X&64&&vg(k),Vd(k,k.return);break;case 27:bg(k);case 26:case 5:Oc(P,k,d),d&&x===null&&X&4&&Xf(k),Vd(k,k.return);break;case 12:Oc(P,k,d);break;case 31:Oc(P,k,d),d&&X&4&&Zd(P,k);break;case 13:Oc(P,k,d),d&&X&4&&qd(P,k);break;case 22:k.memoizedState===null&&Oc(P,k,d),Vd(k,k.return);break;case 30:break;default:Oc(P,k,d)}s=s.sibling}}function Qf(r,s){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&hu(d))}function Bc(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&hu(r))}function zl(r,s,d,x){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)lm(r,s,d,x),s=s.sibling}function lm(r,s,d,x){var P=s.flags;switch(s.tag){case 0:case 11:case 15:zl(r,s,d,x),P&2048&&Kh(9,s);break;case 1:zl(r,s,d,x);break;case 3:zl(r,s,d,x),P&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&hu(r)));break;case 12:if(P&2048){zl(r,s,d,x),r=s.stateNode;try{var k=s.memoizedProps,X=k.id,le=k.onPostCommit;typeof le=="function"&&le(X,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(ke){Cn(s,s.return,ke)}}else zl(r,s,d,x);break;case 31:zl(r,s,d,x);break;case 13:zl(r,s,d,x);break;case 23:break;case 22:k=s.stateNode,X=s.alternate,s.memoizedState!==null?k._visibility&2?zl(r,s,d,x):hh(r,s):k._visibility&2?zl(r,s,d,x):(k._visibility|=2,ic(r,s,d,x,(s.subtreeFlags&10256)!==0||!1)),P&2048&&Qf(X,s);break;case 24:zl(r,s,d,x),P&2048&&Bc(s.alternate,s);break;default:zl(r,s,d,x)}}function ic(r,s,d,x,P){for(P=P&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var k=r,X=s,le=d,ke=x,nt=X.flags;switch(X.tag){case 0:case 11:case 15:ic(k,X,le,ke,P),Kh(8,X);break;case 23:break;case 22:var vt=X.stateNode;X.memoizedState!==null?vt._visibility&2?ic(k,X,le,ke,P):hh(k,X):(vt._visibility|=2,ic(k,X,le,ke,P)),P&&nt&2048&&Qf(X.alternate,X);break;case 24:ic(k,X,le,ke,P),P&&nt&2048&&Bc(X.alternate,X);break;default:ic(k,X,le,ke,P)}s=s.sibling}}function hh(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=r,x=s,P=x.flags;switch(x.tag){case 22:hh(d,x),P&2048&&Qf(x.alternate,x);break;case 24:hh(d,x),P&2048&&Bc(x.alternate,x);break;default:hh(d,x)}s=s.sibling}}var Jh=8192;function dh(r,s,d){if(r.subtreeFlags&Jh)for(r=r.child;r!==null;)Tg(r,s,d),r=r.sibling}function Tg(r,s,d){switch(r.tag){case 26:dh(r,s,d),r.flags&Jh&&r.memoizedState!==null&&Vm(d,bs,r.memoizedState,r.memoizedProps);break;case 5:dh(r,s,d);break;case 3:case 4:var x=bs;bs=wp(r.stateNode.containerInfo),dh(r,s,d),bs=x;break;case 22:r.memoizedState===null&&(x=r.alternate,x!==null&&x.memoizedState!==null?(x=Jh,Jh=16777216,dh(r,s,d),Jh=x):dh(r,s,d));break;default:dh(r,s,d)}}function Sg(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Xd(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var x=s[d];Wr=x,ed(x,r)}Sg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Eg(r),r=r.sibling}function Eg(r){switch(r.tag){case 0:case 11:case 15:Xd(r),r.flags&2048&&kc(9,r,r.return);break;case 3:Xd(r);break;case 12:Xd(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Jf(r)):Xd(r);break;default:Xd(r)}}function Jf(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var x=s[d];Wr=x,ed(x,r)}Sg(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:kc(8,s,s.return),Jf(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,Jf(s));break;default:Jf(s)}r=r.sibling}}function ed(r,s){for(;Wr!==null;){var d=Wr;switch(d.tag){case 0:case 11:case 15:kc(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var x=d.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:hu(d.memoizedState.cache)}if(x=d.child,x!==null)x.return=d,Wr=x;else e:for(d=r;Wr!==null;){x=Wr;var P=x.sibling,k=x.return;if(Qh(x),x===d){Wr=null;break e}if(P!==null){P.return=k,Wr=P;break e}Wr=k}}}var W_={getCacheForType:function(r){var s=wr(mr),d=s.data.get(r);return d===void 0&&(d=r(),s.data.set(r,d)),d},cacheSignal:function(){return wr(mr).controller.signal}},Mg=typeof WeakMap=="function"?WeakMap:Map,An=0,Kn=null,Qi=null,Ji=0,Bn=0,ws=null,Qo=!1,xu=!1,cm=!1,Nc=0,Sr=0,Fc=0,fh=0,um=0,Va=0,ph=0,Yd=null,Gs=null,hm=!1,ep=0,Ag=0,Wd=1/0,td=null,jc=null,Kr=0,Uc=null,id=null,Jo=0,dm=0,tp=null,Cg=null,Kd=0,fm=null;function Hs(){return(An&2)!==0&&Ji!==0?Ji&-Ji:ze.T!==null?wm():kr()}function Pg(){if(Va===0)if((Ji&536870912)===0||Ni){var r=Vi;Vi<<=1,(Vi&3932160)===0&&(Vi=262144),Va=r}else Va=536870912;return r=Xt.current,r!==null&&(r.flags|=32),Va}function $s(r,s,d){(r===Kn&&(Bn===2||Bn===9)||r.cancelPendingCommit!==null)&&(rd(r,0),bu(r,Ji,Va,!1)),ji(r,d),((An&2)===0||r!==Kn)&&(r===Kn&&((An&2)===0&&(fh|=d),Sr===4&&bu(r,Ji,Va,!1)),Dl(r))}function Zr(r,s,d){if((An&6)!==0)throw Error(M(327));var x=!d&&(s&127)===0&&(s&r.expiredLanes)===0||er(r,s),P=x?ad(r,s):rp(r,s,!0),k=x;do{if(P===0){xu&&!x&&bu(r,s,0,!1);break}else{if(d=r.current.alternate,k&&!K_(d)){P=rp(r,s,!1),k=!1;continue}if(P===2){if(k=s,r.errorRecoveryDisabledLanes&k)var X=0;else X=r.pendingLanes&-536870913,X=X!==0?X:X&536870912?536870912:0;if(X!==0){s=X;e:{var le=r;P=Yd;var ke=le.current.memoizedState.isDehydrated;if(ke&&(rd(le,X).flags|=256),X=rp(le,X,!1),X!==2){if(cm&&!ke){le.errorRecoveryDisabledLanes|=k,fh|=k,P=4;break e}k=Gs,Gs=P,k!==null&&(Gs===null?Gs=k:Gs.push.apply(Gs,k))}P=X}if(k=!1,P!==2)continue}}if(P===1){rd(r,0),bu(r,s,0,!0);break}e:{switch(x=r,k=P,k){case 0:case 1:throw Error(M(345));case 4:if((s&4194048)!==s)break;case 6:bu(x,s,Va,!Qo);break e;case 2:Gs=null;break;case 3:case 5:break;default:throw Error(M(329))}if((s&62914560)===s&&(P=ep+300-Ei(),10<P)){if(bu(x,s,Va,!Qo),Wi(x,0,!0)!==0)break e;Jo=s,x.timeoutHandle=bp(nd.bind(null,x,d,Gs,td,hm,s,Va,fh,ph,Qo,k,"Throttled",-0,0),P);break e}nd(x,d,Gs,td,hm,s,Va,fh,ph,Qo,k,null,-0,0)}}break}while(!0);Dl(r)}function nd(r,s,d,x,P,k,X,le,ke,nt,vt,At,ot,pt){if(r.timeoutHandle=-1,At=s.subtreeFlags,At&8192||(At&16785408)===16785408){At={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ga},Tg(s,k,At);var ni=(k&62914560)===k?ep-Ei():(k&4194048)===k?Ag-Ei():0;if(ni=Zm(At,ni),ni!==null){Jo=k,r.cancelPendingCommit=ni(kg.bind(null,r,s,k,d,x,P,X,le,ke,vt,At,null,ot,pt)),bu(r,k,X,!nt);return}}kg(r,s,k,d,x,P,X,le,ke)}function K_(r){for(var s=r;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var x=0;x<d.length;x++){var P=d[x],k=P.getSnapshot;P=P.value;try{if(!Fr(k(),P))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function bu(r,s,d,x){s&=~um,s&=~fh,r.suspendedLanes|=s,r.pingedLanes&=~s,x&&(r.warmLanes|=s),x=r.expirationTimes;for(var P=s;0<P;){var k=31-gt(P),X=1<<k;x[k]=-1,P&=~X}d!==0&&sn(r,d,s)}function Qd(){return(An&6)===0?(bo(0),!1):!0}function ip(){if(Qi!==null){if(Bn===0)var r=Qi.return;else r=Qi,Os=Ua=null,Ml(r),qo=null,Ec=0,r=Qi;for(;r!==null;)$f(r.alternate,r),r=r.return;Qi=null}}function rd(r,s){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,zm(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),Jo=0,ip(),Kn=r,Qi=d=Ma(r.current,null),Ji=s,Bn=0,ws=null,Qo=!1,xu=er(r,s),cm=!1,ph=Va=um=fh=Fc=Sr=0,Gs=Yd=null,hm=!1,(s&8)!==0&&(s|=s&32);var x=r.entangledLanes;if(x!==0)for(r=r.entanglements,x&=s;0<x;){var P=31-gt(x),k=1<<P;s|=r[P],x&=~k}return Nc=s,No(),d}function pm(r,s){ki=null,ze.H=yn,s===ho||s===Xa?(s=fu(),Bn=3):s===Xl?(s=fu(),Bn=4):Bn=s===Nf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,ws=s,Qi===null&&(Sr=1,vo(r,v(s,r.current)))}function mm(){var r=Xt.current;return r===null?!0:(Ji&4194048)===Ji?ti===null:(Ji&62914560)===Ji||(Ji&536870912)!==0?r===ti:!1}function mh(){var r=ze.H;return ze.H=yn,r===null?yn:r}function np(){var r=ze.A;return ze.A=W_,r}function Jd(){Sr=4,Qo||(Ji&4194048)!==Ji&&Xt.current!==null||(xu=!0),(Fc&134217727)===0&&(fh&134217727)===0||Kn===null||bu(Kn,Ji,Va,!1)}function rp(r,s,d){var x=An;An|=2;var P=mh(),k=np();(Kn!==r||Ji!==s)&&(td=null,rd(r,s)),s=!1;var X=Sr;e:do try{if(Bn!==0&&Qi!==null){var le=Qi,ke=ws;switch(Bn){case 8:ip(),X=6;break e;case 3:case 2:case 9:case 6:Xt.current===null&&(s=!0);var nt=Bn;if(Bn=0,ws=null,sd(r,le,ke,nt),d&&xu){X=0;break e}break;default:nt=Bn,Bn=0,ws=null,sd(r,le,ke,nt)}}ap(),X=Sr;break}catch(vt){pm(r,vt)}while(!0);return s&&r.shellSuspendCounter++,Os=Ua=null,An=x,ze.H=P,ze.A=k,Qi===null&&(Kn=null,Ji=0,No()),X}function ap(){for(;Qi!==null;)Dg(Qi)}function ad(r,s){var d=An;An|=2;var x=mh(),P=np();Kn!==r||Ji!==s?(td=null,Wd=Ei()+500,rd(r,s)):xu=er(r,s);e:do try{if(Bn!==0&&Qi!==null){s=Qi;var k=ws;t:switch(Bn){case 1:Bn=0,ws=null,sd(r,s,k,1);break;case 2:case 9:if(Wu(k)){Bn=0,ws=null,Ig(s);break}s=function(){Bn!==2&&Bn!==9||Kn!==r||(Bn=7),Dl(r)},k.then(s,s);break e;case 3:Bn=7;break e;case 4:Bn=5;break e;case 7:Wu(k)?(Bn=0,ws=null,Ig(s)):(Bn=0,ws=null,sd(r,s,k,7));break;case 5:var X=null;switch(Qi.tag){case 26:X=Qi.memoizedState;case 5:case 27:var le=Qi;if(X?uf(X):le.stateNode.complete){Bn=0,ws=null;var ke=le.sibling;if(ke!==null)Qi=ke;else{var nt=le.return;nt!==null?(Qi=nt,sp(nt)):Qi=null}break t}}Bn=0,ws=null,sd(r,s,k,5);break;case 6:Bn=0,ws=null,sd(r,s,k,6);break;case 8:ip(),Sr=6;break e;default:throw Error(M(462))}}zg();break}catch(vt){pm(r,vt)}while(!0);return Os=Ua=null,ze.H=x,ze.A=P,An=d,Qi!==null?0:(Kn=null,Ji=0,No(),Sr)}function zg(){for(;Qi!==null&&!fi();)Dg(Qi)}function Dg(r){var s=Ka(r.alternate,r,Nc);r.memoizedProps=r.pendingProps,s===null?sp(r):Qi=s}function Ig(r){var s=r,d=s.alternate;switch(s.tag){case 15:case 0:s=pg(d,s,s.pendingProps,s.type,void 0,Ji);break;case 11:s=pg(d,s,s.pendingProps,s.type.render,s.ref,Ji);break;case 5:Ml(s);default:$f(d,s),s=Qi=$u(s,Nc),s=Ka(d,s,Nc)}r.memoizedProps=r.pendingProps,s===null?sp(r):Qi=s}function sd(r,s,d,x){Os=Ua=null,Ml(s),qo=null,Ec=0;var P=s.return;try{if(Bf(r,P,s,d,Ji)){Sr=1,vo(r,v(d,r.current)),Qi=null;return}}catch(k){if(P!==null)throw Qi=P,k;Sr=1,vo(r,v(d,r.current)),Qi=null;return}s.flags&32768?(Ni||x===1?r=!0:xu||(Ji&536870912)!==0?r=!1:(Qo=r=!0,(x===2||x===9||x===3||x===6)&&(x=Xt.current,x!==null&&x.tag===13&&(x.flags|=16384))),Lg(s,r)):sp(s)}function sp(r){var s=r;do{if((s.flags&32768)!==0){Lg(s,Qo);return}r=s.return;var d=yg(s.alternate,s,Nc);if(d!==null){Qi=d;return}if(s=s.sibling,s!==null){Qi=s;return}Qi=s=r}while(s!==null);Sr===0&&(Sr=5)}function Lg(r,s){do{var d=X_(r.alternate,r);if(d!==null){d.flags&=32767,Qi=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(r=r.sibling,r!==null)){Qi=r;return}Qi=r=d}while(r!==null);Sr=6,Qi=null}function kg(r,s,d,x,P,k,X,le,ke){r.cancelPendingCommit=null;do op();while(Kr!==0);if((An&6)!==0)throw Error(M(327));if(s!==null){if(s===r.current)throw Error(M(177));if(k=s.lanes|s.childLanes,k|=Bo,Ln(r,d,k,X,le,ke),r===Kn&&(Qi=Kn=null,Ji=0),id=s,Uc=r,Jo=d,dm=k,tp=P,Cg=x,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,jg(ee,function(){return Fg(),null})):(r.callbackNode=null,r.callbackPriority=0),x=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||x){x=ze.T,ze.T=null,P=Je.p,Je.p=2,X=An,An|=4;try{Y_(r,s,d)}finally{An=X,Je.p=P,ze.T=x}}Kr=1,Rg(),Og(),Bg()}}function Rg(){if(Kr===1){Kr=0;var r=Uc,s=id,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=ze.T,ze.T=null;var x=Je.p;Je.p=2;var P=An;An|=4;try{Kf(s,r);var k=Cm,X=dl(r.containerInfo),le=k.focusedElem,ke=k.selectionRange;if(X!==le&&le&&le.ownerDocument&&ql(le.ownerDocument.documentElement,le)){if(ke!==null&&Ls(le)){var nt=ke.start,vt=ke.end;if(vt===void 0&&(vt=nt),"selectionStart"in le)le.selectionStart=nt,le.selectionEnd=Math.min(vt,le.value.length);else{var At=le.ownerDocument||document,ot=At&&At.defaultView||window;if(ot.getSelection){var pt=ot.getSelection(),ni=le.textContent.length,_i=Math.min(ke.start,ni),Nn=ke.end===void 0?_i:Math.min(ke.end,ni);!pt.extend&&_i>Nn&&(X=Nn,Nn=_i,_i=X);var Ge=ko(le,_i),Be=ko(le,Nn);if(Ge&&Be&&(pt.rangeCount!==1||pt.anchorNode!==Ge.node||pt.anchorOffset!==Ge.offset||pt.focusNode!==Be.node||pt.focusOffset!==Be.offset)){var tt=At.createRange();tt.setStart(Ge.node,Ge.offset),pt.removeAllRanges(),_i>Nn?(pt.addRange(tt),pt.extend(Be.node,Be.offset)):(tt.setEnd(Be.node,Be.offset),pt.addRange(tt))}}}}for(At=[],pt=le;pt=pt.parentNode;)pt.nodeType===1&&At.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof le.focus=="function"&&le.focus(),le=0;le<At.length;le++){var Tt=At[le];Tt.element.scrollLeft=Tt.left,Tt.element.scrollTop=Tt.top}}mf=!!af,Cm=af=null}finally{An=P,Je.p=x,ze.T=d}}r.current=s,Kr=2}}function Og(){if(Kr===2){Kr=0;var r=Uc,s=id,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=ze.T,ze.T=null;var x=Je.p;Je.p=2;var P=An;An|=4;try{sm(r,s.alternate,s)}finally{An=P,Je.p=x,ze.T=d}}Kr=3}}function Bg(){if(Kr===4||Kr===3){Kr=0,Ci();var r=Uc,s=id,d=Jo,x=Cg;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Kr=5:(Kr=0,id=Uc=null,Ng(r,r.pendingLanes));var P=r.pendingLanes;if(P===0&&(jc=null),Qe(d),s=s.stateNode,Ie&&typeof Ie.onCommitFiberRoot=="function")try{Ie.onCommitFiberRoot(Ne,s,void 0,(s.current.flags&128)===128)}catch{}if(x!==null){s=ze.T,P=Je.p,Je.p=2,ze.T=null;try{for(var k=r.onRecoverableError,X=0;X<x.length;X++){var le=x[X];k(le.value,{componentStack:le.stack})}}finally{ze.T=s,Je.p=P}}(Jo&3)!==0&&op(),Dl(r),P=r.pendingLanes,(d&261930)!==0&&(P&42)!==0?r===fm?Kd++:(Kd=0,fm=r):Kd=0,bo(0)}}function Ng(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,hu(s)))}function op(){return Rg(),Og(),Bg(),Fg()}function Fg(){if(Kr!==5)return!1;var r=Uc,s=dm;dm=0;var d=Qe(Jo),x=ze.T,P=Je.p;try{Je.p=32>d?32:d,ze.T=null,d=tp,tp=null;var k=Uc,X=Jo;if(Kr=0,id=Uc=null,Jo=0,(An&6)!==0)throw Error(M(331));var le=An;if(An|=4,Eg(k.current),lm(k,k.current,X,d),An=le,bo(0,!1),Ie&&typeof Ie.onPostCommitFiberRoot=="function")try{Ie.onPostCommitFiberRoot(Ne,k)}catch{}return!0}finally{Je.p=P,ze.T=x,Ng(r,s)}}function gm(r,s,d){s=v(d,s),s=oh(r.stateNode,s,2),r=wl(r,s,2),r!==null&&(ji(r,2),Dl(r))}function Cn(r,s,d){if(r.tag===3)gm(r,r,d);else for(;s!==null;){if(s.tag===3){gm(s,r,d);break}else if(s.tag===1){var x=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(jc===null||!jc.has(x))){r=v(d,r),d=lh(2),x=wl(s,d,2),x!==null&&(ch(d,x,s,r),ji(x,2),Dl(x));break}}s=s.return}}function lp(r,s,d){var x=r.pingCache;if(x===null){x=r.pingCache=new Mg;var P=new Set;x.set(s,P)}else P=x.get(s),P===void 0&&(P=new Set,x.set(s,P));P.has(d)||(cm=!0,P.add(d),r=wu.bind(null,r,s,d),s.then(r,r))}function wu(r,s,d){var x=r.pingCache;x!==null&&x.delete(s),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,Kn===r&&(Ji&d)===d&&(Sr===4||Sr===3&&(Ji&62914560)===Ji&&300>Ei()-ep?(An&2)===0&&rd(r,0):um|=d,ph===Ji&&(ph=0)),Dl(r)}function ef(r,s){s===0&&(s=Ki()),r=oa(r,s),r!==null&&(ji(r,s),Dl(r))}function _m(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),ef(r,d)}function Q_(r,s){var d=0;switch(r.tag){case 31:case 13:var x=r.stateNode,P=r.memoizedState;P!==null&&(d=P.retryLane);break;case 19:x=r.stateNode;break;case 22:x=r.stateNode._retryCache;break;default:throw Error(M(314))}x!==null&&x.delete(s),ef(r,d)}function jg(r,s){return Jt(r,s)}var cp=null,od=null,ym=!1,up=!1,vm=!1,Vc=0;function Dl(r){r!==od&&r.next===null&&(od===null?cp=od=r:od=od.next=r),up=!0,ym||(ym=!0,bm())}function bo(r,s){if(!vm&&up){vm=!0;do for(var d=!1,x=cp;x!==null;){if(r!==0){var P=x.pendingLanes;if(P===0)var k=0;else{var X=x.suspendedLanes,le=x.pingedLanes;k=(1<<31-gt(42|r)+1)-1,k&=P&~(X&~le),k=k&201326741?k&201326741|1:k?k|2:0}k!==0&&(d=!0,tf(x,k))}else k=Ji,k=Wi(x,x===Kn?k:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(k&3)===0||er(x,k)||(d=!0,tf(x,k));x=x.next}while(d);vm=!1}}function Tu(){xm()}function xm(){up=ym=!1;var r=0;Vc!==0&&xp()&&(r=Vc);for(var s=Ei(),d=null,x=cp;x!==null;){var P=x.next,k=hp(x,s);k===0?(x.next=null,d===null?cp=P:d.next=P,P===null&&(od=d)):(d=x,(r!==0||(k&3)!==0)&&(up=!0)),x=P}Kr!==0&&Kr!==5||bo(r),Vc!==0&&(Vc=0)}function hp(r,s){for(var d=r.suspendedLanes,x=r.pingedLanes,P=r.expirationTimes,k=r.pendingLanes&-62914561;0<k;){var X=31-gt(k),le=1<<X,ke=P[X];ke===-1?((le&d)===0||(le&x)!==0)&&(P[X]=pi(le,s)):ke<=s&&(r.expiredLanes|=le),k&=~le}if(s=Kn,d=Ji,d=Wi(r,r===s?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x=r.callbackNode,d===0||r===s&&(Bn===2||Bn===9)||r.cancelPendingCommit!==null)return x!==null&&x!==null&&li(x),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||er(r,d)){if(s=d&-d,s===r.callbackPriority)return s;switch(x!==null&&li(x),Qe(d)){case 2:case 8:d=Q;break;case 32:d=ee;break;case 268435456:d=ge;break;default:d=ee}return x=Ug.bind(null,r),d=Jt(d,x),r.callbackPriority=s,r.callbackNode=d,s}return x!==null&&x!==null&&li(x),r.callbackPriority=2,r.callbackNode=null,2}function Ug(r,s){if(Kr!==0&&Kr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(op()&&r.callbackNode!==d)return null;var x=Ji;return x=Wi(r,r===Kn?x:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x===0?null:(Zr(r,x,s),hp(r,Ei()),r.callbackNode!=null&&r.callbackNode===d?Ug.bind(null,r):null)}function tf(r,s){if(op())return null;Zr(r,s,!0)}function bm(){Im(function(){(An&6)!==0?Jt(Re,Tu):xm()})}function wm(){if(Vc===0){var r=Sc;r===0&&(r=hi,hi<<=1,(hi&261888)===0&&(hi=256)),Vc=r}return Vc}function dp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:bi(""+r)}function fp(r,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,r.id&&d.setAttribute("form",r.id),s.parentNode.insertBefore(d,s),r=new FormData(r),d.parentNode.removeChild(d),r}function ld(r,s,d,x,P){if(s==="submit"&&d&&d.stateNode===P){var k=dp((P[It]||null).action),X=x.submitter;X&&(s=(s=X[It]||null)?dp(s.formAction):X.getAttribute("formAction"),s!==null&&(k=s,X=null));var le=new dc("action","action",null,x,P);r.push({event:le,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(Vc!==0){var ke=X?fp(P,X):new FormData(P);ur(d,{pending:!0,data:ke,method:P.method,action:k},null,ke)}}else typeof k=="function"&&(le.preventDefault(),ke=X?fp(P,X):new FormData(P),ur(d,{pending:!0,data:ke,method:P.method,action:k},k,ke))},currentTarget:P}]})}}for(var pp=0;pp<so.length;pp++){var mp=so[pp],Tm=mp.toLowerCase(),Vg=mp[0].toUpperCase()+mp.slice(1);Sa(Tm,"on"+Vg)}Sa(Oo,"onAnimationEnd"),Sa(xc,"onAnimationIteration"),Sa(gl,"onAnimationStart"),Sa("dblclick","onDoubleClick"),Sa("focusin","onFocus"),Sa("focusout","onBlur"),Sa(_l,"onTransitionRun"),Sa(Hl,"onTransitionStart"),Sa($l,"onTransitionCancel"),Sa(jr,"onTransitionEnd"),as("onMouseEnter",["mouseout","mouseover"]),as("onMouseLeave",["mouseout","mouseover"]),as("onPointerEnter",["pointerout","pointerover"]),as("onPointerLeave",["pointerout","pointerover"]),Zi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Zi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Zi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Zi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Su="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Su));function qg(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var x=r[d],P=x.event;x=x.listeners;e:{var k=void 0;if(s)for(var X=x.length-1;0<=X;X--){var le=x[X],ke=le.instance,nt=le.currentTarget;if(le=le.listener,ke!==k&&P.isPropagationStopped())break e;k=le,P.currentTarget=nt;try{k(P)}catch(vt){ps(vt)}P.currentTarget=null,k=ke}else for(X=0;X<x.length;X++){if(le=x[X],ke=le.instance,nt=le.currentTarget,le=le.listener,ke!==k&&P.isPropagationStopped())break e;k=le,P.currentTarget=nt;try{k(P)}catch(vt){ps(vt)}P.currentTarget=null,k=ke}}}}function en(r,s){var d=s[gi];d===void 0&&(d=s[gi]=new Set);var x=r+"__bubble";d.has(x)||(_p(s,r,2,!1),d.add(x))}function Sm(r,s,d){var x=0;s&&(x|=4),_p(d,r,x,s)}var gp="_reactListening"+Math.random().toString(36).slice(2);function Em(r){if(!r[gp]){r[gp]=!0,Bl.forEach(function(d){d!=="selectionchange"&&(Zg.has(d)||Sm(d,!1,r),Sm(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[gp]||(s[gp]=!0,Sm("selectionchange",!1,s))}}function _p(r,s,d,x){switch(yh(s)){case 2:var P=gf;break;case 8:P=r_;break;default:P=Gm}d=P.bind(null,s,d,r),P=void 0,!Or||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(P=!0),x?P!==void 0?r.addEventListener(s,d,{capture:!0,passive:P}):r.addEventListener(s,d,!0):P!==void 0?r.addEventListener(s,d,{passive:P}):r.addEventListener(s,d,!1)}function nc(r,s,d,x,P){var k=x;if((s&1)===0&&(s&2)===0&&x!==null)e:for(;;){if(x===null)return;var X=x.tag;if(X===3||X===4){var le=x.stateNode.containerInfo;if(le===P)break;if(X===4)for(X=x.return;X!==null;){var ke=X.tag;if((ke===3||ke===4)&&X.stateNode.containerInfo===P)return;X=X.return}for(;le!==null;){if(X=rs(le),X===null)return;if(ke=X.tag,ke===5||ke===6||ke===26||ke===27){x=k=X;continue e}le=le.parentNode}}x=x.return}hn(function(){var nt=k,vt=sl(d),At=[];e:{var ot=Hu.get(r);if(ot!==void 0){var pt=dc,ni=r;switch(r){case"keypress":if(xa(d)===0)break e;case"keydown":case"keyup":pt=jn;break;case"focusin":ni="focus",pt=Do;break;case"focusout":ni="blur",pt=Do;break;case"beforeblur":case"afterblur":pt=Do;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=ol;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=fc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=Cd;break;case Oo:case xc:case gl:pt=iu;break;case jr:pt=gc;break;case"scroll":case"scrollend":pt=Ii;break;case"wheel":pt=no;break;case"copy":case"cut":case"paste":pt=qa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=ru;break;case"toggle":case"beforetoggle":pt=zs}var _i=(s&4)!==0,Nn=!_i&&(r==="scroll"||r==="scrollend"),Ge=_i?ot!==null?ot+"Capture":null:ot;_i=[];for(var Be=nt,tt;Be!==null;){var Tt=Be;if(tt=Tt.stateNode,Tt=Tt.tag,Tt!==5&&Tt!==26&&Tt!==27||tt===null||Ge===null||(Tt=_a(Be,Ge),Tt!=null&&_i.push(cd(Be,Tt,tt))),Nn)break;Be=Be.return}0<_i.length&&(ot=new pt(ot,ni,null,d,vt),At.push({event:ot,listeners:_i}))}}if((s&7)===0){e:{if(ot=r==="mouseover"||r==="pointerover",pt=r==="mouseout"||r==="pointerout",ot&&d!==tu&&(ni=d.relatedTarget||d.fromElement)&&(rs(ni)||ni[yi]))break e;if((pt||ot)&&(ot=vt.window===vt?vt:(ot=vt.ownerDocument)?ot.defaultView||ot.parentWindow:window,pt?(ni=d.relatedTarget||d.toElement,pt=nt,ni=ni?rs(ni):null,ni!==null&&(Nn=j(ni),_i=ni.tag,ni!==Nn||_i!==5&&_i!==27&&_i!==6)&&(ni=null)):(pt=null,ni=nt),pt!==ni)){if(_i=ol,Tt="onMouseLeave",Ge="onMouseEnter",Be="mouse",(r==="pointerout"||r==="pointerover")&&(_i=ru,Tt="onPointerLeave",Ge="onPointerEnter",Be="pointer"),Nn=pt==null?ot:Oa(pt),tt=ni==null?ot:Oa(ni),ot=new _i(Tt,Be+"leave",pt,d,vt),ot.target=Nn,ot.relatedTarget=tt,Tt=null,rs(vt)===nt&&(_i=new _i(Ge,Be+"enter",ni,d,vt),_i.target=tt,_i.relatedTarget=Nn,Tt=_i),Nn=Tt,pt&&ni)t:{for(_i=Gg,Ge=pt,Be=ni,tt=0,Tt=Ge;Tt;Tt=_i(Tt))tt++;Tt=0;for(var mi=Be;mi;mi=_i(mi))Tt++;for(;0<tt-Tt;)Ge=_i(Ge),tt--;for(;0<Tt-tt;)Be=_i(Be),Tt--;for(;tt--;){if(Ge===Be||Be!==null&&Ge===Be.alternate){_i=Ge;break t}Ge=_i(Ge),Be=_i(Be)}_i=null}else _i=null;pt!==null&&Mm(At,ot,pt,_i,!1),ni!==null&&Nn!==null&&Mm(At,Nn,ni,_i,!0)}}e:{if(ot=nt?Oa(nt):window,pt=ot.nodeName&&ot.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ot.type==="file")var wn=hs;else if(Ga(ot))if(qu)wn=Rh;else{wn=kh;var ri=ro}else pt=ot.nodeName,!pt||pt.toLowerCase()!=="input"||ot.type!=="checkbox"&&ot.type!=="radio"?nt&&eo(nt.elementType)&&(wn=hs):wn=Is;if(wn&&(wn=wn(r,nt))){su(At,wn,d,vt);break e}ri&&ri(r,ot,nt),r==="focusout"&&nt&&ot.type==="number"&&nt.memoizedProps.value!=null&&ss(ot,"number",ot.value)}switch(ri=nt?Oa(nt):window,r){case"focusin":(Ga(ri)||ri.contentEditable==="true")&&(Ta=ri,Gl=nt,vc=null);break;case"focusout":vc=Gl=Ta=null;break;case"mousedown":pl=!0;break;case"contextmenu":case"mouseup":case"dragend":pl=!1,Oh(At,d,vt);break;case"selectionchange":if(fl)break;case"keydown":case"keyup":Oh(At,d,vt)}var di;if($n)e:{switch(r){case"compositionstart":var Yi="onCompositionStart";break e;case"compositionend":Yi="onCompositionEnd";break e;case"compositionupdate":Yi="onCompositionUpdate";break e}Yi=void 0}else us?yc(r,d)&&(Yi="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Yi="onCompositionStart");Yi&&(Lo&&d.locale!=="ko"&&(us||Yi!=="onCompositionStart"?Yi==="onCompositionEnd"&&us&&(di=va()):(ra=vt,ya="value"in ra?ra.value:ra.textContent,us=!0)),ri=nf(nt,Yi),0<ri.length&&(Yi=new nu(Yi,r,null,d,vt),At.push({event:Yi,listeners:ri}),di?Yi.data=di:(di=Zu(d),di!==null&&(Yi.data=di)))),(di=jl?ba(r,d):ul(r,d))&&(Yi=nf(nt,"onBeforeInput"),0<Yi.length&&(ri=new nu("onBeforeInput","beforeinput",null,d,vt),At.push({event:ri,listeners:Yi}),ri.data=di)),ld(At,r,nt,d,vt)}qg(At,s)})}function cd(r,s,d){return{instance:r,listener:s,currentTarget:d}}function nf(r,s){for(var d=s+"Capture",x=[];r!==null;){var P=r,k=P.stateNode;if(P=P.tag,P!==5&&P!==26&&P!==27||k===null||(P=_a(r,d),P!=null&&x.unshift(cd(r,P,k)),P=_a(r,s),P!=null&&x.push(cd(r,P,k))),r.tag===3)return x;r=r.return}return[]}function Gg(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Mm(r,s,d,x,P){for(var k=s._reactName,X=[];d!==null&&d!==x;){var le=d,ke=le.alternate,nt=le.stateNode;if(le=le.tag,ke!==null&&ke===x)break;le!==5&&le!==26&&le!==27||nt===null||(ke=nt,P?(nt=_a(d,k),nt!=null&&X.unshift(cd(d,nt,ke))):P||(nt=_a(d,k),nt!=null&&X.push(cd(d,nt,ke)))),d=d.return}X.length!==0&&r.push({event:s,listeners:X})}var Hg=/\r\n?/g,$g=/\u0000|\uFFFD/g;function rf(r){return(typeof r=="string"?r:""+r).replace(Hg,`
`).replace($g,"")}function Am(r,s){return s=rf(s),rf(r)===s}function bn(r,s,d,x,P,k){switch(d){case"children":typeof x=="string"?s==="body"||s==="textarea"&&x===""||Ba(r,x):(typeof x=="number"||typeof x=="bigint")&&s!=="body"&&Ba(r,""+x);break;case"className":nn(r,"class",x);break;case"tabIndex":nn(r,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":nn(r,d,x);break;case"style":Nl(r,x,k);break;case"data":if(s!=="object"){nn(r,"data",x);break}case"src":case"href":if(x===""&&(s!=="a"||d!=="href")){r.removeAttribute(d);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(d);break}x=bi(""+x),r.setAttribute(d,x);break;case"action":case"formAction":if(typeof x=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof k=="function"&&(d==="formAction"?(s!=="input"&&bn(r,s,"name",P.name,P,null),bn(r,s,"formEncType",P.formEncType,P,null),bn(r,s,"formMethod",P.formMethod,P,null),bn(r,s,"formTarget",P.formTarget,P,null)):(bn(r,s,"encType",P.encType,P,null),bn(r,s,"method",P.method,P,null),bn(r,s,"target",P.target,P,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(d);break}x=bi(""+x),r.setAttribute(d,x);break;case"onClick":x!=null&&(r.onclick=ga);break;case"onScroll":x!=null&&en("scroll",r);break;case"onScrollEnd":x!=null&&en("scrollend",r);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(M(61));if(d=x.__html,d!=null){if(P.children!=null)throw Error(M(60));r.innerHTML=d}}break;case"multiple":r.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":r.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){r.removeAttribute("xlink:href");break}d=bi(""+x),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,""+x):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":x===!0?r.setAttribute(d,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,x):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?r.setAttribute(d,x):r.removeAttribute(d);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?r.removeAttribute(d):r.setAttribute(d,x);break;case"popover":en("beforetoggle",r),en("toggle",r),qi(r,"popover",x);break;case"xlinkActuate":na(r,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":na(r,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":na(r,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":na(r,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":na(r,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":na(r,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":na(r,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":na(r,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":na(r,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":qi(r,"is",x);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=ls.get(d)||d,qi(r,d,x))}}function yp(r,s,d,x,P,k){switch(d){case"style":Nl(r,x,k);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(M(61));if(d=x.__html,d!=null){if(P.children!=null)throw Error(M(60));r.innerHTML=d}}break;case"children":typeof x=="string"?Ba(r,x):(typeof x=="number"||typeof x=="bigint")&&Ba(r,""+x);break;case"onScroll":x!=null&&en("scroll",r);break;case"onScrollEnd":x!=null&&en("scrollend",r);break;case"onClick":x!=null&&(r.onclick=ga);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Gr.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(P=d.endsWith("Capture"),s=d.slice(2,P?d.length-7:void 0),k=r[It]||null,k=k!=null?k[d]:null,typeof k=="function"&&r.removeEventListener(s,k,P),typeof x=="function")){typeof k!="function"&&k!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(s,x,P);break e}d in r?r[d]=x:x===!0?r.setAttribute(d,""):qi(r,d,x)}}}function da(r,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":en("error",r),en("load",r);var x=!1,P=!1,k;for(k in d)if(d.hasOwnProperty(k)){var X=d[k];if(X!=null)switch(k){case"src":x=!0;break;case"srcSet":P=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(M(137,s));default:bn(r,s,k,X,d,null)}}P&&bn(r,s,"srcSet",d.srcSet,d,null),x&&bn(r,s,"src",d.src,d,null);return;case"input":en("invalid",r);var le=k=X=P=null,ke=null,nt=null;for(x in d)if(d.hasOwnProperty(x)){var vt=d[x];if(vt!=null)switch(x){case"name":P=vt;break;case"type":X=vt;break;case"checked":ke=vt;break;case"defaultChecked":nt=vt;break;case"value":k=vt;break;case"defaultValue":le=vt;break;case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(M(137,s));break;default:bn(r,s,x,vt,d,null)}}al(r,k,le,ke,nt,X,P,!1);return;case"select":en("invalid",r),x=X=k=null;for(P in d)if(d.hasOwnProperty(P)&&(le=d[P],le!=null))switch(P){case"value":k=le;break;case"defaultValue":X=le;break;case"multiple":x=le;default:bn(r,s,P,le,d,null)}s=k,d=X,r.multiple=!!x,s!=null?Sn(r,!!x,s,!1):d!=null&&Sn(r,!!x,d,!0);return;case"textarea":en("invalid",r),k=P=x=null;for(X in d)if(d.hasOwnProperty(X)&&(le=d[X],le!=null))switch(X){case"value":x=le;break;case"defaultValue":P=le;break;case"children":k=le;break;case"dangerouslySetInnerHTML":if(le!=null)throw Error(M(91));break;default:bn(r,s,X,le,d,null)}Ps(r,x,P,k);return;case"option":for(ke in d)d.hasOwnProperty(ke)&&(x=d[ke],x!=null)&&(ke==="selected"?r.selected=x&&typeof x!="function"&&typeof x!="symbol":bn(r,s,ke,x,d,null));return;case"dialog":en("beforetoggle",r),en("toggle",r),en("cancel",r),en("close",r);break;case"iframe":case"object":en("load",r);break;case"video":case"audio":for(x=0;x<Su.length;x++)en(Su[x],r);break;case"image":en("error",r),en("load",r);break;case"details":en("toggle",r);break;case"embed":case"source":case"link":en("error",r),en("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(nt in d)if(d.hasOwnProperty(nt)&&(x=d[nt],x!=null))switch(nt){case"children":case"dangerouslySetInnerHTML":throw Error(M(137,s));default:bn(r,s,nt,x,d,null)}return;default:if(eo(s)){for(vt in d)d.hasOwnProperty(vt)&&(x=d[vt],x!==void 0&&yp(r,s,vt,x,d,void 0));return}}for(le in d)d.hasOwnProperty(le)&&(x=d[le],x!=null&&bn(r,s,le,x,d,null))}function Xg(r,s,d,x){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var P=null,k=null,X=null,le=null,ke=null,nt=null,vt=null;for(pt in d){var At=d[pt];if(d.hasOwnProperty(pt)&&At!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":ke=At;default:x.hasOwnProperty(pt)||bn(r,s,pt,null,x,At)}}for(var ot in x){var pt=x[ot];if(At=d[ot],x.hasOwnProperty(ot)&&(pt!=null||At!=null))switch(ot){case"type":k=pt;break;case"name":P=pt;break;case"checked":nt=pt;break;case"defaultChecked":vt=pt;break;case"value":X=pt;break;case"defaultValue":le=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(M(137,s));break;default:pt!==At&&bn(r,s,ot,pt,x,At)}}hc(r,X,le,ke,nt,vt,k,P);return;case"select":pt=X=le=ot=null;for(k in d)if(ke=d[k],d.hasOwnProperty(k)&&ke!=null)switch(k){case"value":break;case"multiple":pt=ke;default:x.hasOwnProperty(k)||bn(r,s,k,null,x,ke)}for(P in x)if(k=x[P],ke=d[P],x.hasOwnProperty(P)&&(k!=null||ke!=null))switch(P){case"value":ot=k;break;case"defaultValue":le=k;break;case"multiple":X=k;default:k!==ke&&bn(r,s,P,k,x,ke)}s=le,d=X,x=pt,ot!=null?Sn(r,!!d,ot,!1):!!x!=!!d&&(s!=null?Sn(r,!!d,s,!0):Sn(r,!!d,d?[]:"",!1));return;case"textarea":pt=ot=null;for(le in d)if(P=d[le],d.hasOwnProperty(le)&&P!=null&&!x.hasOwnProperty(le))switch(le){case"value":break;case"children":break;default:bn(r,s,le,null,x,P)}for(X in x)if(P=x[X],k=d[X],x.hasOwnProperty(X)&&(P!=null||k!=null))switch(X){case"value":ot=P;break;case"defaultValue":pt=P;break;case"children":break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(M(91));break;default:P!==k&&bn(r,s,X,P,x,k)}Ao(r,ot,pt);return;case"option":for(var ni in d)ot=d[ni],d.hasOwnProperty(ni)&&ot!=null&&!x.hasOwnProperty(ni)&&(ni==="selected"?r.selected=!1:bn(r,s,ni,null,x,ot));for(ke in x)ot=x[ke],pt=d[ke],x.hasOwnProperty(ke)&&ot!==pt&&(ot!=null||pt!=null)&&(ke==="selected"?r.selected=ot&&typeof ot!="function"&&typeof ot!="symbol":bn(r,s,ke,ot,x,pt));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _i in d)ot=d[_i],d.hasOwnProperty(_i)&&ot!=null&&!x.hasOwnProperty(_i)&&bn(r,s,_i,null,x,ot);for(nt in x)if(ot=x[nt],pt=d[nt],x.hasOwnProperty(nt)&&ot!==pt&&(ot!=null||pt!=null))switch(nt){case"children":case"dangerouslySetInnerHTML":if(ot!=null)throw Error(M(137,s));break;default:bn(r,s,nt,ot,x,pt)}return;default:if(eo(s)){for(var Nn in d)ot=d[Nn],d.hasOwnProperty(Nn)&&ot!==void 0&&!x.hasOwnProperty(Nn)&&yp(r,s,Nn,void 0,x,ot);for(vt in x)ot=x[vt],pt=d[vt],!x.hasOwnProperty(vt)||ot===pt||ot===void 0&&pt===void 0||yp(r,s,vt,ot,x,pt);return}}for(var Ge in d)ot=d[Ge],d.hasOwnProperty(Ge)&&ot!=null&&!x.hasOwnProperty(Ge)&&bn(r,s,Ge,null,x,ot);for(At in x)ot=x[At],pt=d[At],!x.hasOwnProperty(At)||ot===pt||ot==null&&pt==null||bn(r,s,At,ot,x,pt)}function Xs(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ud(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,d=performance.getEntriesByType("resource"),x=0;x<d.length;x++){var P=d[x],k=P.transferSize,X=P.initiatorType,le=P.duration;if(k&&le&&Xs(X)){for(X=0,le=P.responseEnd,x+=1;x<d.length;x++){var ke=d[x],nt=ke.startTime;if(nt>le)break;var vt=ke.transferSize,At=ke.initiatorType;vt&&Xs(At)&&(ke=ke.responseEnd,X+=vt*(ke<le?1:(le-nt)/(ke-nt)))}if(--x,s+=8*(k+X)/(P.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var af=null,Cm=null;function sf(r){return r.nodeType===9?r:r.ownerDocument}function Eu(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Pm(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function vp(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Mu=null;function xp(){var r=window.event;return r&&r.type==="popstate"?r===Mu?!1:(Mu=r,!0):(Mu=null,!1)}var bp=typeof setTimeout=="function"?setTimeout:void 0,zm=typeof clearTimeout=="function"?clearTimeout:void 0,Dm=typeof Promise=="function"?Promise:void 0,Im=typeof queueMicrotask=="function"?queueMicrotask:typeof Dm<"u"?function(r){return Dm.resolve(null).then(r).catch(Lm)}:bp;function Lm(r){setTimeout(function(){throw r})}function Au(r){return r==="head"}function Yg(r,s){var d=s,x=0;do{var P=d.nextSibling;if(r.removeChild(d),P&&P.nodeType===8)if(d=P.data,d==="/$"||d==="/&"){if(x===0){r.removeChild(P),Lu(s);return}x--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")x++;else if(d==="html")hd(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,hd(d);for(var k=d.firstChild;k;){var X=k.nextSibling,le=k.nodeName;k[vi]||le==="SCRIPT"||le==="STYLE"||le==="LINK"&&k.rel.toLowerCase()==="stylesheet"||d.removeChild(k),k=X}}else d==="body"&&hd(r.ownerDocument.body);d=P}while(d);Lu(s)}function Oi(r,s){var d=r;r=0;do{var x=d.nextSibling;if(d.nodeType===1?s?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(s?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),x&&x.nodeType===8)if(d=x.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=x}while(d)}function Il(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Il(d),il(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function Da(r,s,d,x){for(;r.nodeType===1;){var P=d;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!x&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(x){if(!r[vi])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(k=r.getAttribute("rel"),k==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(k!==P.rel||r.getAttribute("href")!==(P.href==null||P.href===""?null:P.href)||r.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin)||r.getAttribute("title")!==(P.title==null?null:P.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(k=r.getAttribute("src"),(k!==(P.src==null?null:P.src)||r.getAttribute("type")!==(P.type==null?null:P.type)||r.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin))&&k&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var k=P.name==null?null:""+P.name;if(P.type==="hidden"&&r.getAttribute("name")===k)return r}else return r;if(r=wo(r.nextSibling),r===null)break}return null}function Ll(r,s,d){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=wo(r.nextSibling),r===null))return null;return r}function Cu(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=wo(r.nextSibling),r===null))return null;return r}function Qa(r){return r.data==="$?"||r.data==="$~"}function Dr(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function Qr(r,s){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||d.readyState!=="loading")s();else{var x=function(){s(),d.removeEventListener("DOMContentLoaded",x)};d.addEventListener("DOMContentLoaded",x),r._reactRetry=x}}function wo(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var Ts=null;function Jr(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(s===0)return wo(r.nextSibling);s--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||s++}r=r.nextSibling}return null}function of(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(s===0)return r;s--}else d!=="/$"&&d!=="/&"||s++}r=r.previousSibling}return null}function Wg(r,s,d){switch(s=sf(d),r){case"html":if(r=s.documentElement,!r)throw Error(M(452));return r;case"head":if(r=s.head,!r)throw Error(M(453));return r;case"body":if(r=s.body,!r)throw Error(M(454));return r;default:throw Error(M(451))}}function hd(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);il(r)}var Ia=new Map,gh=new Set;function wp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var rc=Je.d;Je.d={f:Kg,r:Qg,D:Rm,C:Ja,L:kl,m:es,X:Tp,S:zu,M:Om};function Kg(){var r=rc.f(),s=Qd();return r||s}function Qg(r){var s=Qs(r);s!==null&&s.tag===5&&s.type==="form"?$r(s):rc.r(r)}var Pu=typeof document>"u"?null:document;function km(r,s,d){var x=Pu;if(x&&typeof s=="string"&&s){var P=Pn(s);P='link[rel="'+r+'"][href="'+P+'"]',typeof d=="string"&&(P+='[crossorigin="'+d+'"]'),gh.has(P)||(gh.add(P),r={rel:r,crossOrigin:d,href:s},x.querySelector(P)===null&&(s=x.createElement("link"),da(s,"link",r),Gn(s),x.head.appendChild(s)))}}function Rm(r){rc.D(r),km("dns-prefetch",r,null)}function Ja(r,s){rc.C(r,s),km("preconnect",r,s)}function kl(r,s,d){rc.L(r,s,d);var x=Pu;if(x&&r&&s){var P='link[rel="preload"][as="'+Pn(s)+'"]';s==="image"&&d&&d.imageSrcSet?(P+='[imagesrcset="'+Pn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(P+='[imagesizes="'+Pn(d.imageSizes)+'"]')):P+='[href="'+Pn(r)+'"]';var k=P;switch(s){case"style":k=_h(r);break;case"script":k=Zc(r)}Ia.has(k)||(r=ue({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:r,as:s},d),Ia.set(k,r),x.querySelector(P)!==null||s==="style"&&x.querySelector(dd(k))||s==="script"&&x.querySelector(fd(k))||(s=x.createElement("link"),da(s,"link",r),Gn(s),x.head.appendChild(s)))}}function es(r,s){rc.m(r,s);var d=Pu;if(d&&r){var x=s&&typeof s.as=="string"?s.as:"script",P='link[rel="modulepreload"][as="'+Pn(x)+'"][href="'+Pn(r)+'"]',k=P;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":k=Zc(r)}if(!Ia.has(k)&&(r=ue({rel:"modulepreload",href:r},s),Ia.set(k,r),d.querySelector(P)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(fd(k)))return}x=d.createElement("link"),da(x,"link",r),Gn(x),d.head.appendChild(x)}}}function zu(r,s,d){rc.S(r,s,d);var x=Pu;if(x&&r){var P=As(x).hoistableStyles,k=_h(r);s=s||"default";var X=P.get(k);if(!X){var le={loading:0,preload:null};if(X=x.querySelector(dd(k)))le.loading=5;else{r=ue({rel:"stylesheet",href:r,"data-precedence":s},d),(d=Ia.get(k))&&lf(r,d);var ke=X=x.createElement("link");Gn(ke),da(ke,"link",r),ke._p=new Promise(function(nt,vt){ke.onload=nt,ke.onerror=vt}),ke.addEventListener("load",function(){le.loading|=1}),ke.addEventListener("error",function(){le.loading|=2}),le.loading|=4,qc(X,s,x)}X={type:"stylesheet",instance:X,count:1,state:le},P.set(k,X)}}}function Tp(r,s){rc.X(r,s);var d=Pu;if(d&&r){var x=As(d).hoistableScripts,P=Zc(r),k=x.get(P);k||(k=d.querySelector(fd(P)),k||(r=ue({src:r,async:!0},s),(s=Ia.get(P))&&Sp(r,s),k=d.createElement("script"),Gn(k),da(k,"link",r),d.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},x.set(P,k))}}function Om(r,s){rc.M(r,s);var d=Pu;if(d&&r){var x=As(d).hoistableScripts,P=Zc(r),k=x.get(P);k||(k=d.querySelector(fd(P)),k||(r=ue({src:r,async:!0,type:"module"},s),(s=Ia.get(P))&&Sp(r,s),k=d.createElement("script"),Gn(k),da(k,"link",r),d.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},x.set(P,k))}}function Bm(r,s,d,x){var P=(P=Lt.current)?wp(P):null;if(!P)throw Error(M(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=_h(d.href),d=As(P).hoistableStyles,x=d.get(s),x||(x={type:"style",instance:null,count:0,state:null},d.set(s,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=_h(d.href);var k=As(P).hoistableStyles,X=k.get(r);if(X||(P=P.ownerDocument||P,X={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},k.set(r,X),(k=P.querySelector(dd(r)))&&!k._p&&(X.instance=k,X.state.loading=5),Ia.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Ia.set(r,d),k||Fm(P,r,d,X.state))),s&&x===null)throw Error(M(528,""));return X}if(s&&x!==null)throw Error(M(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Zc(d),d=As(P).hoistableScripts,x=d.get(s),x||(x={type:"script",instance:null,count:0,state:null},d.set(s,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(M(444,r))}}function _h(r){return'href="'+Pn(r)+'"'}function dd(r){return'link[rel="stylesheet"]['+r+"]"}function Nm(r){return ue({},r,{"data-precedence":r.precedence,precedence:null})}function Fm(r,s,d,x){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?x.loading=1:(s=r.createElement("link"),x.preload=s,s.addEventListener("load",function(){return x.loading|=1}),s.addEventListener("error",function(){return x.loading|=2}),da(s,"link",d),Gn(s),r.head.appendChild(s))}function Zc(r){return'[src="'+Pn(r)+'"]'}function fd(r){return"script[async]"+r}function jm(r,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var x=r.querySelector('style[data-href~="'+Pn(d.href)+'"]');if(x)return s.instance=x,Gn(x),x;var P=ue({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return x=(r.ownerDocument||r).createElement("style"),Gn(x),da(x,"style",P),qc(x,d.precedence,r),s.instance=x;case"stylesheet":P=_h(d.href);var k=r.querySelector(dd(P));if(k)return s.state.loading|=4,s.instance=k,Gn(k),k;x=Nm(d),(P=Ia.get(P))&&lf(x,P),k=(r.ownerDocument||r).createElement("link"),Gn(k);var X=k;return X._p=new Promise(function(le,ke){X.onload=le,X.onerror=ke}),da(k,"link",x),s.state.loading|=4,qc(k,d.precedence,r),s.instance=k;case"script":return k=Zc(d.src),(P=r.querySelector(fd(k)))?(s.instance=P,Gn(P),P):(x=d,(P=Ia.get(k))&&(x=ue({},d),Sp(x,P)),r=r.ownerDocument||r,P=r.createElement("script"),Gn(P),da(P,"link",x),r.head.appendChild(P),s.instance=P);case"void":return null;default:throw Error(M(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(x=s.instance,s.state.loading|=4,qc(x,d.precedence,r));return s.instance}function qc(r,s,d){for(var x=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),P=x.length?x[x.length-1]:null,k=P,X=0;X<x.length;X++){var le=x[X];if(le.dataset.precedence===s)k=le;else if(k!==P)break}k?k.parentNode.insertBefore(r,k.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(r,s.firstChild))}function lf(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Sp(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Ep=null;function Um(r,s,d){if(Ep===null){var x=new Map,P=Ep=new Map;P.set(d,x)}else P=Ep,x=P.get(d),x||(x=new Map,P.set(d,x));if(x.has(r))return x;for(x.set(r,null),d=d.getElementsByTagName(r),P=0;P<d.length;P++){var k=d[P];if(!(k[vi]||k[gn]||r==="link"&&k.getAttribute("rel")==="stylesheet")&&k.namespaceURI!=="http://www.w3.org/2000/svg"){var X=k.getAttribute(s)||"";X=r+X;var le=x.get(X);le?le.push(k):x.set(X,[k])}}return x}function cf(r,s,d){r=r.ownerDocument||r,r.head.insertBefore(d,s==="title"?r.querySelector("head > title"):null)}function Mp(r,s,d){if(d===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function uf(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Vm(r,s,d,x){if(d.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var P=_h(x.href),k=s.querySelector(dd(P));if(k){s=k._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=df.bind(r),s.then(r,r)),d.state.loading|=4,d.instance=k,Gn(k);return}k=s.ownerDocument||s,x=Nm(x),(P=Ia.get(P))&&lf(x,P),k=k.createElement("link"),Gn(k);var X=k;X._p=new Promise(function(le,ke){X.onload=le,X.onerror=ke}),da(k,"link",x),d.instance=k}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=df.bind(r),s.addEventListener("load",d),s.addEventListener("error",d))}}var hf=0;function Zm(r,s){return r.stylesheets&&r.count===0&&pf(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var x=setTimeout(function(){if(r.stylesheets&&pf(r,r.stylesheets),r.unsuspend){var k=r.unsuspend;r.unsuspend=null,k()}},6e4+s);0<r.imgBytes&&hf===0&&(hf=62500*ud());var P=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&pf(r,r.stylesheets),r.unsuspend)){var k=r.unsuspend;r.unsuspend=null,k()}},(r.imgBytes>hf?50:800)+s);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(x),clearTimeout(P)}}:null}function df(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)pf(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var ff=null;function pf(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,ff=new Map,s.forEach(Jg,r),ff=null,df.call(r))}function Jg(r,s){if(!(s.state.loading&4)){var d=ff.get(r);if(d)var x=d.get(null);else{d=new Map,ff.set(r,d);for(var P=r.querySelectorAll("link[data-precedence],style[data-precedence]"),k=0;k<P.length;k++){var X=P[k];(X.nodeName==="LINK"||X.getAttribute("media")!=="not all")&&(d.set(X.dataset.precedence,X),x=X)}x&&d.set(null,x)}P=s.instance,X=P.getAttribute("data-precedence"),k=d.get(X)||x,k===x&&d.set(null,P),d.set(X,P),this.count++,x=df.bind(this),P.addEventListener("load",x),P.addEventListener("error",x),k?k.parentNode.insertBefore(P,k.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(P,r.firstChild)),s.state.loading|=4}}var pd={$$typeof:Fe,Provider:null,Consumer:null,_currentValue:st,_currentValue2:st,_threadCount:0};function J_(r,s,d,x,P,k,X,le,ke){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=un(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=un(0),this.hiddenUpdates=un(null),this.identifierPrefix=x,this.onUncaughtError=P,this.onCaughtError=k,this.onRecoverableError=X,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ke,this.incompleteTransitions=new Map}function qm(r,s,d,x,P,k,X,le,ke,nt,vt,At){return r=new J_(r,s,d,X,ke,nt,vt,At,le),s=1,k===!0&&(s|=24),k=Ea(3,null,null,s),r.current=k,k.stateNode=r,s=Zo(),s.refCount++,r.pooledCache=s,s.refCount++,k.memoizedState={element:x,isDehydrated:d,cache:s},Gh(k),r}function e_(r){return r?(r=wi,r):wi}function t_(r,s,d,x,P,k){P=e_(P),x.context===null?x.context=P:x.pendingContext=P,x=Xo(s),x.payload={element:d},k=k===void 0?null:k,k!==null&&(x.callback=k),d=wl(r,x,s),d!==null&&($s(d,r,s),Ns(d,r,s))}function Ap(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function Cp(r,s){Ap(r,s),(r=r.alternate)&&Ap(r,s)}function i_(r){if(r.tag===13||r.tag===31){var s=oa(r,67108864);s!==null&&$s(s,r,67108864),Cp(r,67108864)}}function n_(r){if(r.tag===13||r.tag===31){var s=Hs();s=qr(s);var d=oa(r,s);d!==null&&$s(d,r,s),Cp(r,s)}}var mf=!0;function gf(r,s,d,x){var P=ze.T;ze.T=null;var k=Je.p;try{Je.p=2,Gm(r,s,d,x)}finally{Je.p=k,ze.T=P}}function r_(r,s,d,x){var P=ze.T;ze.T=null;var k=Je.p;try{Je.p=8,Gm(r,s,d,x)}finally{Je.p=k,ze.T=P}}function Gm(r,s,d,x){if(mf){var P=_f(x);if(P===null)nc(r,s,x,md,d),a_(r,x);else if(ty(P,r,s,d,x))x.stopPropagation();else if(a_(r,x),s&4&&-1<ey.indexOf(r)){for(;P!==null;){var k=Qs(P);if(k!==null)switch(k.tag){case 3:if(k=k.stateNode,k.current.memoizedState.isDehydrated){var X=$e(k.pendingLanes);if(X!==0){var le=k;for(le.pendingLanes|=2,le.entangledLanes|=2;X;){var ke=1<<31-gt(X);le.entanglements[1]|=ke,X&=~ke}Dl(k),(An&6)===0&&(Wd=Ei()+500,bo(0))}}break;case 31:case 13:le=oa(k,2),le!==null&&$s(le,k,2),Qd(),Cp(k,2)}if(k=_f(x),k===null&&nc(r,s,x,md,d),k===P)break;P=k}P!==null&&x.stopPropagation()}else nc(r,s,x,null,d)}}function _f(r){return r=sl(r),Pp(r)}var md=null;function Pp(r){if(md=null,r=rs(r),r!==null){var s=j(r);if(s===null)r=null;else{var d=s.tag;if(d===13){if(r=D(s),r!==null)return r;r=null}else if(d===31){if(r=u(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return md=r,null}function yh(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(cn()){case Re:return 2;case Q:return 8;case ee:case se:return 32;case ge:return 268435456;default:return 32}default:return 32}}var zp=!1,Du=null,el=null,Iu=null,yf=new Map,gd=new Map,Gc=[],ey="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function a_(r,s){switch(r){case"focusin":case"focusout":Du=null;break;case"dragenter":case"dragleave":el=null;break;case"mouseover":case"mouseout":Iu=null;break;case"pointerover":case"pointerout":yf.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":gd.delete(s.pointerId)}}function vf(r,s,d,x,P,k){return r===null||r.nativeEvent!==k?(r={blockedOn:s,domEventName:d,eventSystemFlags:x,nativeEvent:k,targetContainers:[P]},s!==null&&(s=Qs(s),s!==null&&i_(s)),r):(r.eventSystemFlags|=x,s=r.targetContainers,P!==null&&s.indexOf(P)===-1&&s.push(P),r)}function ty(r,s,d,x,P){switch(s){case"focusin":return Du=vf(Du,r,s,d,x,P),!0;case"dragenter":return el=vf(el,r,s,d,x,P),!0;case"mouseover":return Iu=vf(Iu,r,s,d,x,P),!0;case"pointerover":var k=P.pointerId;return yf.set(k,vf(yf.get(k)||null,r,s,d,x,P)),!0;case"gotpointercapture":return k=P.pointerId,gd.set(k,vf(gd.get(k)||null,r,s,d,x,P)),!0}return!1}function s_(r){var s=rs(r.target);if(s!==null){var d=j(s);if(d!==null){if(s=d.tag,s===13){if(s=D(d),s!==null){r.blockedOn=s,Rr(r.priority,function(){n_(d)});return}}else if(s===31){if(s=u(d),s!==null){r.blockedOn=s,Rr(r.priority,function(){n_(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function xf(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=_f(r.nativeEvent);if(d===null){d=r.nativeEvent;var x=new d.constructor(d.type,d);tu=x,d.target.dispatchEvent(x),tu=null}else return s=Qs(d),s!==null&&i_(s),r.blockedOn=d,!1;s.shift()}return!0}function o_(r,s,d){xf(r)&&d.delete(s)}function bf(){zp=!1,Du!==null&&xf(Du)&&(Du=null),el!==null&&xf(el)&&(el=null),Iu!==null&&xf(Iu)&&(Iu=null),yf.forEach(o_),gd.forEach(o_)}function Dp(r,s){r.blockedOn===s&&(r.blockedOn=null,zp||(zp=!0,f.unstable_scheduleCallback(f.unstable_NormalPriority,bf)))}var Ip=null;function l_(r){Ip!==r&&(Ip=r,f.unstable_scheduleCallback(f.unstable_NormalPriority,function(){Ip===r&&(Ip=null);for(var s=0;s<r.length;s+=3){var d=r[s],x=r[s+1],P=r[s+2];if(typeof x!="function"){if(Pp(x||d)===null)continue;break}var k=Qs(d);k!==null&&(r.splice(s,3),s-=3,ur(k,{pending:!0,data:P,method:d.method,action:x},x,P))}}))}function Lu(r){function s(ke){return Dp(ke,r)}Du!==null&&Dp(Du,r),el!==null&&Dp(el,r),Iu!==null&&Dp(Iu,r),yf.forEach(s),gd.forEach(s);for(var d=0;d<Gc.length;d++){var x=Gc[d];x.blockedOn===r&&(x.blockedOn=null)}for(;0<Gc.length&&(d=Gc[0],d.blockedOn===null);)s_(d),d.blockedOn===null&&Gc.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(x=0;x<d.length;x+=3){var P=d[x],k=d[x+1],X=P[It]||null;if(typeof k=="function")X||l_(d);else if(X){var le=null;if(k&&k.hasAttribute("formAction")){if(P=k,X=k[It]||null)le=X.formAction;else if(Pp(P)!==null)continue}else le=X.action;typeof le=="function"?d[x+1]=le:(d.splice(x,3),x-=3),l_(d)}}}function Hm(){function r(k){k.canIntercept&&k.info==="react-transition"&&k.intercept({handler:function(){return new Promise(function(X){return P=X})},focusReset:"manual",scroll:"manual"})}function s(){P!==null&&(P(),P=null),x||setTimeout(d,20)}function d(){if(!x&&!navigation.transition){var k=navigation.currentEntry;k&&k.url!=null&&navigation.navigate(k.url,{state:k.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,P=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(d,100),function(){x=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),P!==null&&(P(),P=null)}}}function $m(r){this._internalRoot=r}Lp.prototype.render=$m.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(M(409));var d=s.current,x=Hs();t_(d,x,r,s,null,null)},Lp.prototype.unmount=$m.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;t_(r.current,2,null,r,null,null),Qd(),s[yi]=null}};function Lp(r){this._internalRoot=r}Lp.prototype.unstable_scheduleHydration=function(r){if(r){var s=kr();r={blockedOn:null,target:r,priority:s};for(var d=0;d<Gc.length&&s!==0&&s<Gc[d].priority;d++);Gc.splice(d,0,r),d===0&&s_(r)}};var Xm=_.version;if(Xm!=="19.2.3")throw Error(M(527,Xm,"19.2.3"));Je.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(M(188)):(r=Object.keys(r).join(","),Error(M(268,r)));return r=te(s),r=r!==null?fe(r):null,r=r===null?null:r.stateNode,r};var c_={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:ze,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kp.isDisabled&&kp.supportsFiber)try{Ne=kp.inject(c_),Ie=kp}catch{}}return eg.createRoot=function(r,s){if(!O(r))throw Error(M(299));var d=!1,x="",P=Yh,k=Al,X=Cl;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(x=s.identifierPrefix),s.onUncaughtError!==void 0&&(P=s.onUncaughtError),s.onCaughtError!==void 0&&(k=s.onCaughtError),s.onRecoverableError!==void 0&&(X=s.onRecoverableError)),s=qm(r,1,!1,null,null,d,x,null,P,k,X,Hm),r[yi]=s.current,Em(r),new $m(s)},eg.hydrateRoot=function(r,s,d){if(!O(r))throw Error(M(299));var x=!1,P="",k=Yh,X=Al,le=Cl,ke=null;return d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(P=d.identifierPrefix),d.onUncaughtError!==void 0&&(k=d.onUncaughtError),d.onCaughtError!==void 0&&(X=d.onCaughtError),d.onRecoverableError!==void 0&&(le=d.onRecoverableError),d.formState!==void 0&&(ke=d.formState)),s=qm(r,1,!0,s,d??null,x,P,ke,k,X,le,Hm),s.context=e_(null),d=s.current,x=Hs(),x=qr(x),P=Xo(x),P.callback=null,wl(d,P,x),d=x,s.current.lanes=d,ji(s,d),Dl(s),r[yi]=s.current,Em(r),new Lp(s)},eg.version="19.2.3",eg}var nv;function T1(){if(nv)return fy.exports;nv=1;function f(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(f)}catch(_){console.error(_)}}return f(),fy.exports=w1(),fy.exports}var S1=T1();const E1=Yy(S1),M1="modulepreload",A1=function(f){return"/parlens-pwa/"+f},rv={},C1=function(_,T,M){let O=Promise.resolve();if(T&&T.length>0){let te=function(fe){return Promise.all(fe.map(ue=>Promise.resolve(ue).then(De=>({status:"fulfilled",value:De}),De=>({status:"rejected",reason:De}))))};var D=te;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),V=u?.nonce||u?.getAttribute("nonce");O=te(T.map(fe=>{if(fe=A1(fe),fe in rv)return;rv[fe]=!0;const ue=fe.endsWith(".css"),De=ue?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${fe}"]${De}`))return;const Pe=document.createElement("link");if(Pe.rel=ue?"stylesheet":M1,ue||(Pe.as="script"),Pe.crossOrigin="",Pe.href=fe,V&&Pe.setAttribute("nonce",V),document.head.appendChild(Pe),ue)return new Promise((je,be)=>{Pe.addEventListener("load",je),Pe.addEventListener("error",()=>be(new Error(`Unable to preload CSS for ${fe}`)))})}))}function j(u){const V=new Event("vite:preloadError",{cancelable:!0});if(V.payload=u,window.dispatchEvent(V),!V.defaultPrevented)throw u}return O.then(u=>{for(const V of u||[])V.status==="rejected"&&j(V.reason);return _().catch(j)})};function av(f){if(!Number.isSafeInteger(f)||f<0)throw new Error(`Wrong positive integer: ${f}`)}function Gv(f,..._){if(!(f instanceof Uint8Array))throw new Error("Expected Uint8Array");if(_.length>0&&!_.includes(f.length))throw new Error(`Expected Uint8Array of length ${_}, not of length=${f.length}`)}function P1(f){if(typeof f!="function"||typeof f.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");av(f.outputLen),av(f.blockLen)}function x_(f,_=!0){if(f.destroyed)throw new Error("Hash instance has been destroyed");if(_&&f.finished)throw new Error("Hash#digest() has already been called")}function z1(f,_){Gv(f);const T=_.outputLen;if(f.length<T)throw new Error(`digestInto() expects output buffer of length at least ${T}`)}const _y=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Hv=f=>f instanceof Uint8Array,yy=f=>new DataView(f.buffer,f.byteOffset,f.byteLength),Ru=(f,_)=>f<<32-_|f>>>_,D1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!D1)throw new Error("Non little-endian hardware is not supported");function I1(f){if(typeof f!="string")throw new Error(`utf8ToBytes expected string, got ${typeof f}`);return new Uint8Array(new TextEncoder().encode(f))}function Ky(f){if(typeof f=="string"&&(f=I1(f)),!Hv(f))throw new Error(`expected Uint8Array, got ${typeof f}`);return f}function L1(...f){const _=new Uint8Array(f.reduce((M,O)=>M+O.length,0));let T=0;return f.forEach(M=>{if(!Hv(M))throw new Error("Uint8Array expected");_.set(M,T),T+=M.length}),_}let $v=class{clone(){return this._cloneInto()}};function k1(f){const _=M=>f().update(Ky(M)).digest(),T=f();return _.outputLen=T.outputLen,_.blockLen=T.blockLen,_.create=()=>f(),_}function Xv(f=32){if(_y&&typeof _y.getRandomValues=="function")return _y.getRandomValues(new Uint8Array(f));throw new Error("crypto.getRandomValues must be defined")}function R1(f,_,T,M){if(typeof f.setBigUint64=="function")return f.setBigUint64(_,T,M);const O=BigInt(32),j=BigInt(4294967295),D=Number(T>>O&j),u=Number(T&j),V=M?4:0,te=M?0:4;f.setUint32(_+V,D,M),f.setUint32(_+te,u,M)}let O1=class extends $v{constructor(_,T,M,O){super(),this.blockLen=_,this.outputLen=T,this.padOffset=M,this.isLE=O,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(_),this.view=yy(this.buffer)}update(_){x_(this);const{view:T,buffer:M,blockLen:O}=this;_=Ky(_);const j=_.length;for(let D=0;D<j;){const u=Math.min(O-this.pos,j-D);if(u===O){const V=yy(_);for(;O<=j-D;D+=O)this.process(V,D);continue}M.set(_.subarray(D,D+u),this.pos),this.pos+=u,D+=u,this.pos===O&&(this.process(T,0),this.pos=0)}return this.length+=_.length,this.roundClean(),this}digestInto(_){x_(this),z1(_,this),this.finished=!0;const{buffer:T,view:M,blockLen:O,isLE:j}=this;let{pos:D}=this;T[D++]=128,this.buffer.subarray(D).fill(0),this.padOffset>O-D&&(this.process(M,0),D=0);for(let ue=D;ue<O;ue++)T[ue]=0;R1(M,O-8,BigInt(this.length*8),j),this.process(M,0);const u=yy(_),V=this.outputLen;if(V%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const te=V/4,fe=this.get();if(te>fe.length)throw new Error("_sha2: outputLen bigger than state");for(let ue=0;ue<te;ue++)u.setUint32(4*ue,fe[ue],j)}digest(){const{buffer:_,outputLen:T}=this;this.digestInto(_);const M=_.slice(0,T);return this.destroy(),M}_cloneInto(_){_||(_=new this.constructor),_.set(...this.get());const{blockLen:T,buffer:M,length:O,finished:j,destroyed:D,pos:u}=this;return _.length=O,_.pos=u,_.finished=j,_.destroyed=D,O%T&&_.buffer.set(M),_}};const B1=(f,_,T)=>f&_^~f&T,N1=(f,_,T)=>f&_^f&T^_&T,F1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),vd=new Uint32Array(64);let j1=class extends O1{constructor(){super(64,32,8,!1),this.A=yd[0]|0,this.B=yd[1]|0,this.C=yd[2]|0,this.D=yd[3]|0,this.E=yd[4]|0,this.F=yd[5]|0,this.G=yd[6]|0,this.H=yd[7]|0}get(){const{A:_,B:T,C:M,D:O,E:j,F:D,G:u,H:V}=this;return[_,T,M,O,j,D,u,V]}set(_,T,M,O,j,D,u,V){this.A=_|0,this.B=T|0,this.C=M|0,this.D=O|0,this.E=j|0,this.F=D|0,this.G=u|0,this.H=V|0}process(_,T){for(let ue=0;ue<16;ue++,T+=4)vd[ue]=_.getUint32(T,!1);for(let ue=16;ue<64;ue++){const De=vd[ue-15],Pe=vd[ue-2],je=Ru(De,7)^Ru(De,18)^De>>>3,be=Ru(Pe,17)^Ru(Pe,19)^Pe>>>10;vd[ue]=be+vd[ue-7]+je+vd[ue-16]|0}let{A:M,B:O,C:j,D,E:u,F:V,G:te,H:fe}=this;for(let ue=0;ue<64;ue++){const De=Ru(u,6)^Ru(u,11)^Ru(u,25),Pe=fe+De+B1(u,V,te)+F1[ue]+vd[ue]|0,be=(Ru(M,2)^Ru(M,13)^Ru(M,22))+N1(M,O,j)|0;fe=te,te=V,V=u,u=D+Pe|0,D=j,j=O,O=M,M=Pe+be|0}M=M+this.A|0,O=O+this.B|0,j=j+this.C|0,D=D+this.D|0,u=u+this.E|0,V=V+this.F|0,te=te+this.G|0,fe=fe+this.H|0,this.set(M,O,j,D,u,V,te,fe)}roundClean(){vd.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Dy=k1(()=>new j1);const Yv=BigInt(0),z_=BigInt(1),U1=BigInt(2),D_=f=>f instanceof Uint8Array,V1=Array.from({length:256},(f,_)=>_.toString(16).padStart(2,"0"));function Vp(f){if(!D_(f))throw new Error("Uint8Array expected");let _="";for(let T=0;T<f.length;T++)_+=V1[f[T]];return _}function Wv(f){const _=f.toString(16);return _.length&1?`0${_}`:_}function Qy(f){if(typeof f!="string")throw new Error("hex string expected, got "+typeof f);return BigInt(f===""?"0":`0x${f}`)}function Zp(f){if(typeof f!="string")throw new Error("hex string expected, got "+typeof f);const _=f.length;if(_%2)throw new Error("padded hex string expected, got unpadded hex of length "+_);const T=new Uint8Array(_/2);for(let M=0;M<T.length;M++){const O=M*2,j=f.slice(O,O+2),D=Number.parseInt(j,16);if(Number.isNaN(D)||D<0)throw new Error("Invalid byte sequence");T[M]=D}return T}function tl(f){return Qy(Vp(f))}function Jy(f){if(!D_(f))throw new Error("Uint8Array expected");return Qy(Vp(Uint8Array.from(f).reverse()))}function Sd(f,_){return Zp(f.toString(16).padStart(_*2,"0"))}function e0(f,_){return Sd(f,_).reverse()}function Z1(f){return Zp(Wv(f))}function Ws(f,_,T){let M;if(typeof _=="string")try{M=Zp(_)}catch(j){throw new Error(`${f} must be valid hex string, got "${_}". Cause: ${j}`)}else if(D_(_))M=Uint8Array.from(_);else throw new Error(`${f} must be hex string or Uint8Array`);const O=M.length;if(typeof T=="number"&&O!==T)throw new Error(`${f} expected ${T} bytes, got ${O}`);return M}function If(...f){const _=new Uint8Array(f.reduce((M,O)=>M+O.length,0));let T=0;return f.forEach(M=>{if(!D_(M))throw new Error("Uint8Array expected");_.set(M,T),T+=M.length}),_}function q1(f,_){if(f.length!==_.length)return!1;for(let T=0;T<f.length;T++)if(f[T]!==_[T])return!1;return!0}function G1(f){if(typeof f!="string")throw new Error(`utf8ToBytes expected string, got ${typeof f}`);return new Uint8Array(new TextEncoder().encode(f))}function H1(f){let _;for(_=0;f>Yv;f>>=z_,_+=1);return _}function $1(f,_){return f>>BigInt(_)&z_}const X1=(f,_,T)=>f|(T?z_:Yv)<<BigInt(_),t0=f=>(U1<<BigInt(f-1))-z_,vy=f=>new Uint8Array(f),sv=f=>Uint8Array.from(f);function Kv(f,_,T){if(typeof f!="number"||f<2)throw new Error("hashLen must be a number");if(typeof _!="number"||_<2)throw new Error("qByteLen must be a number");if(typeof T!="function")throw new Error("hmacFn must be a function");let M=vy(f),O=vy(f),j=0;const D=()=>{M.fill(1),O.fill(0),j=0},u=(...ue)=>T(O,M,...ue),V=(ue=vy())=>{O=u(sv([0]),ue),M=u(),ue.length!==0&&(O=u(sv([1]),ue),M=u())},te=()=>{if(j++>=1e3)throw new Error("drbg: tried 1000 values");let ue=0;const De=[];for(;ue<_;){M=u();const Pe=M.slice();De.push(Pe),ue+=M.length}return If(...De)};return(ue,De)=>{D(),V(ue);let Pe;for(;!(Pe=De(te()));)V();return D(),Pe}}const Y1={bigint:f=>typeof f=="bigint",function:f=>typeof f=="function",boolean:f=>typeof f=="boolean",string:f=>typeof f=="string",stringOrUint8Array:f=>typeof f=="string"||f instanceof Uint8Array,isSafeInteger:f=>Number.isSafeInteger(f),array:f=>Array.isArray(f),field:(f,_)=>_.Fp.isValid(f),hash:f=>typeof f=="function"&&Number.isSafeInteger(f.outputLen)};function hg(f,_,T={}){const M=(O,j,D)=>{const u=Y1[j];if(typeof u!="function")throw new Error(`Invalid validator "${j}", expected function`);const V=f[O];if(!(D&&V===void 0)&&!u(V,f))throw new Error(`Invalid param ${String(O)}=${V} (${typeof V}), expected ${j}`)};for(const[O,j]of Object.entries(_))M(O,j,!1);for(const[O,j]of Object.entries(T))M(O,j,!0);return f}const W1=Object.freeze(Object.defineProperty({__proto__:null,bitGet:$1,bitLen:H1,bitMask:t0,bitSet:X1,bytesToHex:Vp,bytesToNumberBE:tl,bytesToNumberLE:Jy,concatBytes:If,createHmacDrbg:Kv,ensureBytes:Ws,equalBytes:q1,hexToBytes:Zp,hexToNumber:Qy,numberToBytesBE:Sd,numberToBytesLE:e0,numberToHexUnpadded:Wv,numberToVarBytesBE:Z1,utf8ToBytes:G1,validateObject:hg},Symbol.toStringTag,{value:"Module"}));const ns=BigInt(0),fa=BigInt(1),Cf=BigInt(2),K1=BigInt(3),Iy=BigInt(4),ov=BigInt(5),lv=BigInt(8);BigInt(9);BigInt(16);function Es(f,_){const T=f%_;return T>=ns?T:_+T}function Q1(f,_,T){if(T<=ns||_<ns)throw new Error("Expected power/modulo > 0");if(T===fa)return ns;let M=fa;for(;_>ns;)_&fa&&(M=M*f%T),f=f*f%T,_>>=fa;return M}function sc(f,_,T){let M=f;for(;_-- >ns;)M*=M,M%=T;return M}function Ly(f,_){if(f===ns||_<=ns)throw new Error(`invert: expected positive integers, got n=${f} mod=${_}`);let T=Es(f,_),M=_,O=ns,j=fa;for(;T!==ns;){const u=M/T,V=M%T,te=O-j*u;M=T,T=V,O=j,j=te}if(M!==fa)throw new Error("invert: does not exist");return Es(O,_)}function J1(f){const _=(f-fa)/Cf;let T,M,O;for(T=f-fa,M=0;T%Cf===ns;T/=Cf,M++);for(O=Cf;O<f&&Q1(O,_,f)!==f-fa;O++);if(M===1){const D=(f+fa)/Iy;return function(V,te){const fe=V.pow(te,D);if(!V.eql(V.sqr(fe),te))throw new Error("Cannot find square root");return fe}}const j=(T+fa)/Cf;return function(u,V){if(u.pow(V,_)===u.neg(u.ONE))throw new Error("Cannot find square root");let te=M,fe=u.pow(u.mul(u.ONE,O),T),ue=u.pow(V,j),De=u.pow(V,T);for(;!u.eql(De,u.ONE);){if(u.eql(De,u.ZERO))return u.ZERO;let Pe=1;for(let be=u.sqr(De);Pe<te&&!u.eql(be,u.ONE);Pe++)be=u.sqr(be);const je=u.pow(fe,fa<<BigInt(te-Pe-1));fe=u.sqr(je),ue=u.mul(ue,je),De=u.mul(De,fe),te=Pe}return ue}}function ew(f){if(f%Iy===K1){const _=(f+fa)/Iy;return function(M,O){const j=M.pow(O,_);if(!M.eql(M.sqr(j),O))throw new Error("Cannot find square root");return j}}if(f%lv===ov){const _=(f-ov)/lv;return function(M,O){const j=M.mul(O,Cf),D=M.pow(j,_),u=M.mul(O,D),V=M.mul(M.mul(u,Cf),D),te=M.mul(u,M.sub(V,M.ONE));if(!M.eql(M.sqr(te),O))throw new Error("Cannot find square root");return te}}return J1(f)}const tw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function iw(f){const _={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},T=tw.reduce((M,O)=>(M[O]="function",M),_);return hg(f,T)}function nw(f,_,T){if(T<ns)throw new Error("Expected power > 0");if(T===ns)return f.ONE;if(T===fa)return _;let M=f.ONE,O=_;for(;T>ns;)T&fa&&(M=f.mul(M,O)),O=f.sqr(O),T>>=fa;return M}function rw(f,_){const T=new Array(_.length),M=_.reduce((j,D,u)=>f.is0(D)?j:(T[u]=j,f.mul(j,D)),f.ONE),O=f.inv(M);return _.reduceRight((j,D,u)=>f.is0(D)?j:(T[u]=f.mul(j,T[u]),f.mul(j,D)),O),T}function Qv(f,_){const T=_!==void 0?_:f.toString(2).length,M=Math.ceil(T/8);return{nBitLength:T,nByteLength:M}}function aw(f,_,T=!1,M={}){if(f<=ns)throw new Error(`Expected Field ORDER > 0, got ${f}`);const{nBitLength:O,nByteLength:j}=Qv(f,_);if(j>2048)throw new Error("Field lengths over 2048 bytes are not supported");const D=ew(f),u=Object.freeze({ORDER:f,BITS:O,BYTES:j,MASK:t0(O),ZERO:ns,ONE:fa,create:V=>Es(V,f),isValid:V=>{if(typeof V!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof V}`);return ns<=V&&V<f},is0:V=>V===ns,isOdd:V=>(V&fa)===fa,neg:V=>Es(-V,f),eql:(V,te)=>V===te,sqr:V=>Es(V*V,f),add:(V,te)=>Es(V+te,f),sub:(V,te)=>Es(V-te,f),mul:(V,te)=>Es(V*te,f),pow:(V,te)=>nw(u,V,te),div:(V,te)=>Es(V*Ly(te,f),f),sqrN:V=>V*V,addN:(V,te)=>V+te,subN:(V,te)=>V-te,mulN:(V,te)=>V*te,inv:V=>Ly(V,f),sqrt:M.sqrt||(V=>D(u,V)),invertBatch:V=>rw(u,V),cmov:(V,te,fe)=>fe?te:V,toBytes:V=>T?e0(V,j):Sd(V,j),fromBytes:V=>{if(V.length!==j)throw new Error(`Fp.fromBytes: expected ${j}, got ${V.length}`);return T?Jy(V):tl(V)}});return Object.freeze(u)}function Jv(f){if(typeof f!="bigint")throw new Error("field order must be bigint");const _=f.toString(2).length;return Math.ceil(_/8)}function ex(f){const _=Jv(f);return _+Math.ceil(_/2)}function sw(f,_,T=!1){const M=f.length,O=Jv(_),j=ex(_);if(M<16||M<j||M>1024)throw new Error(`expected ${j}-1024 bytes of input, got ${M}`);const D=T?tl(f):Jy(f),u=Es(D,_-fa)+fa;return T?e0(u,O):Sd(u,O)}const ow=BigInt(0),xy=BigInt(1);function lw(f,_){const T=(O,j)=>{const D=j.negate();return O?D:j},M=O=>{const j=Math.ceil(_/O)+1,D=2**(O-1);return{windows:j,windowSize:D}};return{constTimeNegate:T,unsafeLadder(O,j){let D=f.ZERO,u=O;for(;j>ow;)j&xy&&(D=D.add(u)),u=u.double(),j>>=xy;return D},precomputeWindow(O,j){const{windows:D,windowSize:u}=M(j),V=[];let te=O,fe=te;for(let ue=0;ue<D;ue++){fe=te,V.push(fe);for(let De=1;De<u;De++)fe=fe.add(te),V.push(fe);te=fe.double()}return V},wNAF(O,j,D){const{windows:u,windowSize:V}=M(O);let te=f.ZERO,fe=f.BASE;const ue=BigInt(2**O-1),De=2**O,Pe=BigInt(O);for(let je=0;je<u;je++){const be=je*V;let de=Number(D&ue);D>>=Pe,de>V&&(de-=De,D+=xy);const He=be,ut=be+Math.abs(de)-1,Fe=je%2!==0,Ut=de<0;de===0?fe=fe.add(T(Fe,j[He])):te=te.add(T(Ut,j[ut]))}return{p:te,f:fe}},wNAFCached(O,j,D,u){const V=O._WINDOW_SIZE||1;let te=j.get(O);return te||(te=this.precomputeWindow(O,V),V!==1&&j.set(O,u(te))),this.wNAF(V,te,D)}}}function tx(f){return iw(f.Fp),hg(f,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Qv(f.n,f.nBitLength),...f,p:f.Fp.ORDER})}function cw(f){const _=tx(f);hg(_,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:T,Fp:M,a:O}=_;if(T){if(!M.eql(O,M.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof T!="object"||typeof T.beta!="bigint"||typeof T.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({..._})}const{bytesToNumberBE:uw,hexToBytes:hw}=W1,zf={Err:class extends Error{constructor(_=""){super(_)}},_parseInt(f){const{Err:_}=zf;if(f.length<2||f[0]!==2)throw new _("Invalid signature integer tag");const T=f[1],M=f.subarray(2,T+2);if(!T||M.length!==T)throw new _("Invalid signature integer: wrong length");if(M[0]&128)throw new _("Invalid signature integer: negative");if(M[0]===0&&!(M[1]&128))throw new _("Invalid signature integer: unnecessary leading zero");return{d:uw(M),l:f.subarray(T+2)}},toSig(f){const{Err:_}=zf,T=typeof f=="string"?hw(f):f;if(!(T instanceof Uint8Array))throw new Error("ui8a expected");let M=T.length;if(M<2||T[0]!=48)throw new _("Invalid signature tag");if(T[1]!==M-2)throw new _("Invalid signature: incorrect length");const{d:O,l:j}=zf._parseInt(T.subarray(2)),{d:D,l:u}=zf._parseInt(j);if(u.length)throw new _("Invalid signature: left bytes after parsing");return{r:O,s:D}},hexFromSig(f){const _=te=>Number.parseInt(te[0],16)&8?"00"+te:te,T=te=>{const fe=te.toString(16);return fe.length&1?`0${fe}`:fe},M=_(T(f.s)),O=_(T(f.r)),j=M.length/2,D=O.length/2,u=T(j),V=T(D);return`30${T(D+j+4)}02${V}${O}02${u}${M}`}},Th=BigInt(0),oc=BigInt(1);BigInt(2);const cv=BigInt(3);BigInt(4);function dw(f){const _=cw(f),{Fp:T}=_,M=_.toBytes||((je,be,de)=>{const He=be.toAffine();return If(Uint8Array.from([4]),T.toBytes(He.x),T.toBytes(He.y))}),O=_.fromBytes||(je=>{const be=je.subarray(1),de=T.fromBytes(be.subarray(0,T.BYTES)),He=T.fromBytes(be.subarray(T.BYTES,2*T.BYTES));return{x:de,y:He}});function j(je){const{a:be,b:de}=_,He=T.sqr(je),ut=T.mul(He,je);return T.add(T.add(ut,T.mul(je,be)),de)}if(!T.eql(T.sqr(_.Gy),j(_.Gx)))throw new Error("bad generator point: equation left != right");function D(je){return typeof je=="bigint"&&Th<je&&je<_.n}function u(je){if(!D(je))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function V(je){const{allowedPrivateKeyLengths:be,nByteLength:de,wrapPrivateKey:He,n:ut}=_;if(be&&typeof je!="bigint"){if(je instanceof Uint8Array&&(je=Vp(je)),typeof je!="string"||!be.includes(je.length))throw new Error("Invalid key");je=je.padStart(de*2,"0")}let Fe;try{Fe=typeof je=="bigint"?je:tl(Ws("private key",je,de))}catch{throw new Error(`private key must be ${de} bytes, hex or bigint, not ${typeof je}`)}return He&&(Fe=Es(Fe,ut)),u(Fe),Fe}const te=new Map;function fe(je){if(!(je instanceof ue))throw new Error("ProjectivePoint expected")}class ue{constructor(be,de,He){if(this.px=be,this.py=de,this.pz=He,be==null||!T.isValid(be))throw new Error("x required");if(de==null||!T.isValid(de))throw new Error("y required");if(He==null||!T.isValid(He))throw new Error("z required")}static fromAffine(be){const{x:de,y:He}=be||{};if(!be||!T.isValid(de)||!T.isValid(He))throw new Error("invalid affine point");if(be instanceof ue)throw new Error("projective point not allowed");const ut=Fe=>T.eql(Fe,T.ZERO);return ut(de)&&ut(He)?ue.ZERO:new ue(de,He,T.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(be){const de=T.invertBatch(be.map(He=>He.pz));return be.map((He,ut)=>He.toAffine(de[ut])).map(ue.fromAffine)}static fromHex(be){const de=ue.fromAffine(O(Ws("pointHex",be)));return de.assertValidity(),de}static fromPrivateKey(be){return ue.BASE.multiply(V(be))}_setWindowSize(be){this._WINDOW_SIZE=be,te.delete(this)}assertValidity(){if(this.is0()){if(_.allowInfinityPoint&&!T.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:be,y:de}=this.toAffine();if(!T.isValid(be)||!T.isValid(de))throw new Error("bad point: x or y not FE");const He=T.sqr(de),ut=j(be);if(!T.eql(He,ut))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:be}=this.toAffine();if(T.isOdd)return!T.isOdd(be);throw new Error("Field doesn't support isOdd")}equals(be){fe(be);const{px:de,py:He,pz:ut}=this,{px:Fe,py:Ut,pz:Rt}=be,dt=T.eql(T.mul(de,Rt),T.mul(Fe,ut)),rt=T.eql(T.mul(He,Rt),T.mul(Ut,ut));return dt&&rt}negate(){return new ue(this.px,T.neg(this.py),this.pz)}double(){const{a:be,b:de}=_,He=T.mul(de,cv),{px:ut,py:Fe,pz:Ut}=this;let Rt=T.ZERO,dt=T.ZERO,rt=T.ZERO,Ct=T.mul(ut,ut),jt=T.mul(Fe,Fe),Ht=T.mul(Ut,Ut),Ot=T.mul(ut,Fe);return Ot=T.add(Ot,Ot),rt=T.mul(ut,Ut),rt=T.add(rt,rt),Rt=T.mul(be,rt),dt=T.mul(He,Ht),dt=T.add(Rt,dt),Rt=T.sub(jt,dt),dt=T.add(jt,dt),dt=T.mul(Rt,dt),Rt=T.mul(Ot,Rt),rt=T.mul(He,rt),Ht=T.mul(be,Ht),Ot=T.sub(Ct,Ht),Ot=T.mul(be,Ot),Ot=T.add(Ot,rt),rt=T.add(Ct,Ct),Ct=T.add(rt,Ct),Ct=T.add(Ct,Ht),Ct=T.mul(Ct,Ot),dt=T.add(dt,Ct),Ht=T.mul(Fe,Ut),Ht=T.add(Ht,Ht),Ct=T.mul(Ht,Ot),Rt=T.sub(Rt,Ct),rt=T.mul(Ht,jt),rt=T.add(rt,rt),rt=T.add(rt,rt),new ue(Rt,dt,rt)}add(be){fe(be);const{px:de,py:He,pz:ut}=this,{px:Fe,py:Ut,pz:Rt}=be;let dt=T.ZERO,rt=T.ZERO,Ct=T.ZERO;const jt=_.a,Ht=T.mul(_.b,cv);let Ot=T.mul(de,Fe),Yt=T.mul(He,Ut),si=T.mul(ut,Rt),oi=T.add(de,He),wt=T.add(Fe,Ut);oi=T.mul(oi,wt),wt=T.add(Ot,Yt),oi=T.sub(oi,wt),wt=T.add(de,ut);let ze=T.add(Fe,Rt);return wt=T.mul(wt,ze),ze=T.add(Ot,si),wt=T.sub(wt,ze),ze=T.add(He,ut),dt=T.add(Ut,Rt),ze=T.mul(ze,dt),dt=T.add(Yt,si),ze=T.sub(ze,dt),Ct=T.mul(jt,wt),dt=T.mul(Ht,si),Ct=T.add(dt,Ct),dt=T.sub(Yt,Ct),Ct=T.add(Yt,Ct),rt=T.mul(dt,Ct),Yt=T.add(Ot,Ot),Yt=T.add(Yt,Ot),si=T.mul(jt,si),wt=T.mul(Ht,wt),Yt=T.add(Yt,si),si=T.sub(Ot,si),si=T.mul(jt,si),wt=T.add(wt,si),Ot=T.mul(Yt,wt),rt=T.add(rt,Ot),Ot=T.mul(ze,wt),dt=T.mul(oi,dt),dt=T.sub(dt,Ot),Ot=T.mul(oi,Yt),Ct=T.mul(ze,Ct),Ct=T.add(Ct,Ot),new ue(dt,rt,Ct)}subtract(be){return this.add(be.negate())}is0(){return this.equals(ue.ZERO)}wNAF(be){return Pe.wNAFCached(this,te,be,de=>{const He=T.invertBatch(de.map(ut=>ut.pz));return de.map((ut,Fe)=>ut.toAffine(He[Fe])).map(ue.fromAffine)})}multiplyUnsafe(be){const de=ue.ZERO;if(be===Th)return de;if(u(be),be===oc)return this;const{endo:He}=_;if(!He)return Pe.unsafeLadder(this,be);let{k1neg:ut,k1:Fe,k2neg:Ut,k2:Rt}=He.splitScalar(be),dt=de,rt=de,Ct=this;for(;Fe>Th||Rt>Th;)Fe&oc&&(dt=dt.add(Ct)),Rt&oc&&(rt=rt.add(Ct)),Ct=Ct.double(),Fe>>=oc,Rt>>=oc;return ut&&(dt=dt.negate()),Ut&&(rt=rt.negate()),rt=new ue(T.mul(rt.px,He.beta),rt.py,rt.pz),dt.add(rt)}multiply(be){u(be);let de=be,He,ut;const{endo:Fe}=_;if(Fe){const{k1neg:Ut,k1:Rt,k2neg:dt,k2:rt}=Fe.splitScalar(de);let{p:Ct,f:jt}=this.wNAF(Rt),{p:Ht,f:Ot}=this.wNAF(rt);Ct=Pe.constTimeNegate(Ut,Ct),Ht=Pe.constTimeNegate(dt,Ht),Ht=new ue(T.mul(Ht.px,Fe.beta),Ht.py,Ht.pz),He=Ct.add(Ht),ut=jt.add(Ot)}else{const{p:Ut,f:Rt}=this.wNAF(de);He=Ut,ut=Rt}return ue.normalizeZ([He,ut])[0]}multiplyAndAddUnsafe(be,de,He){const ut=ue.BASE,Fe=(Rt,dt)=>dt===Th||dt===oc||!Rt.equals(ut)?Rt.multiplyUnsafe(dt):Rt.multiply(dt),Ut=Fe(this,de).add(Fe(be,He));return Ut.is0()?void 0:Ut}toAffine(be){const{px:de,py:He,pz:ut}=this,Fe=this.is0();be==null&&(be=Fe?T.ONE:T.inv(ut));const Ut=T.mul(de,be),Rt=T.mul(He,be),dt=T.mul(ut,be);if(Fe)return{x:T.ZERO,y:T.ZERO};if(!T.eql(dt,T.ONE))throw new Error("invZ was invalid");return{x:Ut,y:Rt}}isTorsionFree(){const{h:be,isTorsionFree:de}=_;if(be===oc)return!0;if(de)return de(ue,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:be,clearCofactor:de}=_;return be===oc?this:de?de(ue,this):this.multiplyUnsafe(_.h)}toRawBytes(be=!0){return this.assertValidity(),M(ue,this,be)}toHex(be=!0){return Vp(this.toRawBytes(be))}}ue.BASE=new ue(_.Gx,_.Gy,T.ONE),ue.ZERO=new ue(T.ZERO,T.ONE,T.ZERO);const De=_.nBitLength,Pe=lw(ue,_.endo?Math.ceil(De/2):De);return{CURVE:_,ProjectivePoint:ue,normPrivateKeyToScalar:V,weierstrassEquation:j,isWithinCurveOrder:D}}function fw(f){const _=tx(f);return hg(_,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,..._})}function pw(f){const _=fw(f),{Fp:T,n:M}=_,O=T.BYTES+1,j=2*T.BYTES+1;function D(wt){return Th<wt&&wt<T.ORDER}function u(wt){return Es(wt,M)}function V(wt){return Ly(wt,M)}const{ProjectivePoint:te,normPrivateKeyToScalar:fe,weierstrassEquation:ue,isWithinCurveOrder:De}=dw({..._,toBytes(wt,ze,Je){const st=ze.toAffine(),Et=T.toBytes(st.x),lt=If;return Je?lt(Uint8Array.from([ze.hasEvenY()?2:3]),Et):lt(Uint8Array.from([4]),Et,T.toBytes(st.y))},fromBytes(wt){const ze=wt.length,Je=wt[0],st=wt.subarray(1);if(ze===O&&(Je===2||Je===3)){const Et=tl(st);if(!D(Et))throw new Error("Point is not on curve");const lt=ue(Et);let _e=T.sqrt(lt);const Ue=(_e&oc)===oc;return(Je&1)===1!==Ue&&(_e=T.neg(_e)),{x:Et,y:_e}}else if(ze===j&&Je===4){const Et=T.fromBytes(st.subarray(0,T.BYTES)),lt=T.fromBytes(st.subarray(T.BYTES,2*T.BYTES));return{x:Et,y:lt}}else throw new Error(`Point of length ${ze} was invalid. Expected ${O} compressed bytes or ${j} uncompressed bytes`)}}),Pe=wt=>Vp(Sd(wt,_.nByteLength));function je(wt){const ze=M>>oc;return wt>ze}function be(wt){return je(wt)?u(-wt):wt}const de=(wt,ze,Je)=>tl(wt.slice(ze,Je));class He{constructor(ze,Je,st){this.r=ze,this.s=Je,this.recovery=st,this.assertValidity()}static fromCompact(ze){const Je=_.nByteLength;return ze=Ws("compactSignature",ze,Je*2),new He(de(ze,0,Je),de(ze,Je,2*Je))}static fromDER(ze){const{r:Je,s:st}=zf.toSig(Ws("DER",ze));return new He(Je,st)}assertValidity(){if(!De(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!De(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(ze){return new He(this.r,this.s,ze)}recoverPublicKey(ze){const{r:Je,s:st,recovery:Et}=this,lt=rt(Ws("msgHash",ze));if(Et==null||![0,1,2,3].includes(Et))throw new Error("recovery id invalid");const _e=Et===2||Et===3?Je+_.n:Je;if(_e>=T.ORDER)throw new Error("recovery id 2 or 3 invalid");const Ue=(Et&1)===0?"02":"03",yt=te.fromHex(Ue+Pe(_e)),Pt=V(_e),Dt=u(-lt*Pt),Lt=u(st*Pt),Kt=te.BASE.multiplyAndAddUnsafe(yt,Dt,Lt);if(!Kt)throw new Error("point at infinify");return Kt.assertValidity(),Kt}hasHighS(){return je(this.s)}normalizeS(){return this.hasHighS()?new He(this.r,u(-this.s),this.recovery):this}toDERRawBytes(){return Zp(this.toDERHex())}toDERHex(){return zf.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Zp(this.toCompactHex())}toCompactHex(){return Pe(this.r)+Pe(this.s)}}const ut={isValidPrivateKey(wt){try{return fe(wt),!0}catch{return!1}},normPrivateKeyToScalar:fe,randomPrivateKey:()=>{const wt=ex(_.n);return sw(_.randomBytes(wt),_.n)},precompute(wt=8,ze=te.BASE){return ze._setWindowSize(wt),ze.multiply(BigInt(3)),ze}};function Fe(wt,ze=!0){return te.fromPrivateKey(wt).toRawBytes(ze)}function Ut(wt){const ze=wt instanceof Uint8Array,Je=typeof wt=="string",st=(ze||Je)&&wt.length;return ze?st===O||st===j:Je?st===2*O||st===2*j:wt instanceof te}function Rt(wt,ze,Je=!0){if(Ut(wt))throw new Error("first arg must be private key");if(!Ut(ze))throw new Error("second arg must be public key");return te.fromHex(ze).multiply(fe(wt)).toRawBytes(Je)}const dt=_.bits2int||function(wt){const ze=tl(wt),Je=wt.length*8-_.nBitLength;return Je>0?ze>>BigInt(Je):ze},rt=_.bits2int_modN||function(wt){return u(dt(wt))},Ct=t0(_.nBitLength);function jt(wt){if(typeof wt!="bigint")throw new Error("bigint expected");if(!(Th<=wt&&wt<Ct))throw new Error(`bigint expected < 2^${_.nBitLength}`);return Sd(wt,_.nByteLength)}function Ht(wt,ze,Je=Ot){if(["recovered","canonical"].some(Ai=>Ai in Je))throw new Error("sign() legacy options not supported");const{hash:st,randomBytes:Et}=_;let{lowS:lt,prehash:_e,extraEntropy:Ue}=Je;lt==null&&(lt=!0),wt=Ws("msgHash",wt),_e&&(wt=Ws("prehashed msgHash",st(wt)));const yt=rt(wt),Pt=fe(ze),Dt=[jt(Pt),jt(yt)];if(Ue!=null){const Ai=Ue===!0?Et(T.BYTES):Ue;Dt.push(Ws("extraEntropy",Ai))}const Lt=If(...Dt),Kt=yt;function ui(Ai){const mn=dt(Ai);if(!De(mn))return;const vr=V(mn),tn=te.BASE.multiply(mn).toAffine(),ar=u(tn.x);if(ar===Th)return;const Gi=u(vr*u(Kt+ar*Pt));if(Gi===Th)return;let Fn=(tn.x===ar?0:2)|Number(tn.y&oc),Jn=Gi;return lt&&je(Gi)&&(Jn=be(Gi),Fn^=1),new He(ar,Jn,Fn)}return{seed:Lt,k2sig:ui}}const Ot={lowS:_.lowS,prehash:!1},Yt={lowS:_.lowS,prehash:!1};function si(wt,ze,Je=Ot){const{seed:st,k2sig:Et}=Ht(wt,ze,Je),lt=_;return Kv(lt.hash.outputLen,lt.nByteLength,lt.hmac)(st,Et)}te.BASE._setWindowSize(8);function oi(wt,ze,Je,st=Yt){const Et=wt;if(ze=Ws("msgHash",ze),Je=Ws("publicKey",Je),"strict"in st)throw new Error("options.strict was renamed to lowS");const{lowS:lt,prehash:_e}=st;let Ue,yt;try{if(typeof Et=="string"||Et instanceof Uint8Array)try{Ue=He.fromDER(Et)}catch(tn){if(!(tn instanceof zf.Err))throw tn;Ue=He.fromCompact(Et)}else if(typeof Et=="object"&&typeof Et.r=="bigint"&&typeof Et.s=="bigint"){const{r:tn,s:ar}=Et;Ue=new He(tn,ar)}else throw new Error("PARSE");yt=te.fromHex(Je)}catch(tn){if(tn.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(lt&&Ue.hasHighS())return!1;_e&&(ze=_.hash(ze));const{r:Pt,s:Dt}=Ue,Lt=rt(ze),Kt=V(Dt),ui=u(Lt*Kt),Ai=u(Pt*Kt),mn=te.BASE.multiplyAndAddUnsafe(yt,ui,Ai)?.toAffine();return mn?u(mn.x)===Pt:!1}return{CURVE:_,getPublicKey:Fe,getSharedSecret:Rt,sign:si,verify:oi,ProjectivePoint:te,Signature:He,utils:ut}}let ix=class extends $v{constructor(_,T){super(),this.finished=!1,this.destroyed=!1,P1(_);const M=Ky(T);if(this.iHash=_.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const O=this.blockLen,j=new Uint8Array(O);j.set(M.length>O?_.create().update(M).digest():M);for(let D=0;D<j.length;D++)j[D]^=54;this.iHash.update(j),this.oHash=_.create();for(let D=0;D<j.length;D++)j[D]^=106;this.oHash.update(j),j.fill(0)}update(_){return x_(this),this.iHash.update(_),this}digestInto(_){x_(this),Gv(_,this.outputLen),this.finished=!0,this.iHash.digestInto(_),this.oHash.update(_),this.oHash.digestInto(_),this.destroy()}digest(){const _=new Uint8Array(this.oHash.outputLen);return this.digestInto(_),_}_cloneInto(_){_||(_=Object.create(Object.getPrototypeOf(this),{}));const{oHash:T,iHash:M,finished:O,destroyed:j,blockLen:D,outputLen:u}=this;return _=_,_.finished=O,_.destroyed=j,_.blockLen=D,_.outputLen=u,_.oHash=T._cloneInto(_.oHash),_.iHash=M._cloneInto(_.iHash),_}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const nx=(f,_,T)=>new ix(f,_).update(T).digest();nx.create=(f,_)=>new ix(f,_);function mw(f){return{hash:f,hmac:(_,...T)=>nx(f,_,L1(...T)),randomBytes:Xv}}function gw(f,_){const T=M=>pw({...f,...mw(M)});return Object.freeze({...T(_),create:T})}const I_=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),b_=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),rx=BigInt(1),w_=BigInt(2),uv=(f,_)=>(f+_/w_)/_;function ax(f){const _=I_,T=BigInt(3),M=BigInt(6),O=BigInt(11),j=BigInt(22),D=BigInt(23),u=BigInt(44),V=BigInt(88),te=f*f*f%_,fe=te*te*f%_,ue=sc(fe,T,_)*fe%_,De=sc(ue,T,_)*fe%_,Pe=sc(De,w_,_)*te%_,je=sc(Pe,O,_)*Pe%_,be=sc(je,j,_)*je%_,de=sc(be,u,_)*be%_,He=sc(de,V,_)*de%_,ut=sc(He,u,_)*be%_,Fe=sc(ut,T,_)*fe%_,Ut=sc(Fe,D,_)*je%_,Rt=sc(Ut,M,_)*te%_,dt=sc(Rt,w_,_);if(!ky.eql(ky.sqr(dt),f))throw new Error("Cannot find square root");return dt}const ky=aw(I_,void 0,void 0,{sqrt:ax}),Hp=gw({a:BigInt(0),b:BigInt(7),Fp:ky,n:b_,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:f=>{const _=b_,T=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),M=-rx*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),O=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),j=T,D=BigInt("0x100000000000000000000000000000000"),u=uv(j*f,_),V=uv(-M*f,_);let te=Es(f-u*T-V*O,_),fe=Es(-u*M-V*j,_);const ue=te>D,De=fe>D;if(ue&&(te=_-te),De&&(fe=_-fe),te>D||fe>D)throw new Error("splitScalar: Endomorphism failed, k="+f);return{k1neg:ue,k1:te,k2neg:De,k2:fe}}}},Dy),L_=BigInt(0),sx=f=>typeof f=="bigint"&&L_<f&&f<I_,_w=f=>typeof f=="bigint"&&L_<f&&f<b_,hv={};function T_(f,..._){let T=hv[f];if(T===void 0){const M=Dy(Uint8Array.from(f,O=>O.charCodeAt(0)));T=If(M,M),hv[f]=T}return Dy(If(T,..._))}const i0=f=>f.toRawBytes(!0).slice(1),Ry=f=>Sd(f,32),by=f=>Es(f,I_),ng=f=>Es(f,b_),n0=Hp.ProjectivePoint,yw=(f,_,T)=>n0.BASE.multiplyAndAddUnsafe(f,_,T);function Oy(f){let _=Hp.utils.normPrivateKeyToScalar(f),T=n0.fromPrivateKey(_);return{scalar:T.hasEvenY()?_:ng(-_),bytes:i0(T)}}function ox(f){if(!sx(f))throw new Error("bad x: need 0 < x < p");const _=by(f*f),T=by(_*f+BigInt(7));let M=ax(T);M%w_!==L_&&(M=by(-M));const O=new n0(f,M,rx);return O.assertValidity(),O}function lx(...f){return ng(tl(T_("BIP0340/challenge",...f)))}function vw(f){return Oy(f).bytes}function xw(f,_,T=Xv(32)){const M=Ws("message",f),{bytes:O,scalar:j}=Oy(_),D=Ws("auxRand",T,32),u=Ry(j^tl(T_("BIP0340/aux",D))),V=T_("BIP0340/nonce",u,O,M),te=ng(tl(V));if(te===L_)throw new Error("sign failed: k is zero");const{bytes:fe,scalar:ue}=Oy(te),De=lx(fe,O,M),Pe=new Uint8Array(64);if(Pe.set(fe,0),Pe.set(Ry(ng(ue+De*j)),32),!cx(Pe,M,O))throw new Error("sign: Invalid signature produced");return Pe}function cx(f,_,T){const M=Ws("signature",f,64),O=Ws("message",_),j=Ws("publicKey",T,32);try{const D=ox(tl(j)),u=tl(M.subarray(0,32));if(!sx(u))return!1;const V=tl(M.subarray(32,64));if(!_w(V))return!1;const te=lx(Ry(u),i0(D),O),fe=yw(D,V,ng(-te));return!(!fe||!fe.hasEvenY()||fe.toAffine().x!==u)}catch{return!1}}const Bu={getPublicKey:vw,sign:xw,verify:cx,utils:{randomPrivateKey:Hp.utils.randomPrivateKey,lift_x:ox,pointToBytes:i0,numberToBytesBE:Sd,bytesToNumberBE:tl,taggedHash:T_,mod:Es}},wy=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const r0=f=>f instanceof Uint8Array,Ty=f=>new DataView(f.buffer,f.byteOffset,f.byteLength),Ou=(f,_)=>f<<32-_|f>>>_,bw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!bw)throw new Error("Non little-endian hardware is not supported");const ww=Array.from({length:256},(f,_)=>_.toString(16).padStart(2,"0"));function Ra(f){if(!r0(f))throw new Error("Uint8Array expected");let _="";for(let T=0;T<f.length;T++)_+=ww[f[T]];return _}function Lf(f){if(typeof f!="string")throw new Error("hex string expected, got "+typeof f);const _=f.length;if(_%2)throw new Error("padded hex string expected, got unpadded hex of length "+_);const T=new Uint8Array(_/2);for(let M=0;M<T.length;M++){const O=M*2,j=f.slice(O,O+2),D=Number.parseInt(j,16);if(Number.isNaN(D)||D<0)throw new Error("Invalid byte sequence");T[M]=D}return T}function Tw(f){if(typeof f!="string")throw new Error(`utf8ToBytes expected string, got ${typeof f}`);return new Uint8Array(new TextEncoder().encode(f))}function rg(f){if(typeof f=="string"&&(f=Tw(f)),!r0(f))throw new Error(`expected Uint8Array, got ${typeof f}`);return f}function k_(...f){const _=new Uint8Array(f.reduce((M,O)=>M+O.length,0));let T=0;return f.forEach(M=>{if(!r0(M))throw new Error("Uint8Array expected");_.set(M,T),T+=M.length}),_}class ux{clone(){return this._cloneInto()}}function hx(f){const _=M=>f().update(rg(M)).digest(),T=f();return _.outputLen=T.outputLen,_.blockLen=T.blockLen,_.create=()=>f(),_}function dx(f=32){if(wy&&typeof wy.getRandomValues=="function")return wy.getRandomValues(new Uint8Array(f));throw new Error("crypto.getRandomValues must be defined")}function By(f){if(!Number.isSafeInteger(f)||f<0)throw new Error(`Wrong positive integer: ${f}`)}function Sw(f){if(typeof f!="boolean")throw new Error(`Expected boolean, not ${f}`)}function fx(f,..._){if(!(f instanceof Uint8Array))throw new Error("Expected Uint8Array");if(_.length>0&&!_.includes(f.length))throw new Error(`Expected Uint8Array of length ${_}, not of length=${f.length}`)}function Ew(f){if(typeof f!="function"||typeof f.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");By(f.outputLen),By(f.blockLen)}function Mw(f,_=!0){if(f.destroyed)throw new Error("Hash instance has been destroyed");if(_&&f.finished)throw new Error("Hash#digest() has already been called")}function Aw(f,_){fx(f);const T=_.outputLen;if(f.length<T)throw new Error(`digestInto() expects output buffer of length at least ${T}`)}const Nu={number:By,bool:Sw,bytes:fx,hash:Ew,exists:Mw,output:Aw};function Cw(f,_,T,M){if(typeof f.setBigUint64=="function")return f.setBigUint64(_,T,M);const O=BigInt(32),j=BigInt(4294967295),D=Number(T>>O&j),u=Number(T&j),V=M?4:0,te=M?0:4;f.setUint32(_+V,D,M),f.setUint32(_+te,u,M)}class Pw extends ux{constructor(_,T,M,O){super(),this.blockLen=_,this.outputLen=T,this.padOffset=M,this.isLE=O,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(_),this.view=Ty(this.buffer)}update(_){Nu.exists(this);const{view:T,buffer:M,blockLen:O}=this;_=rg(_);const j=_.length;for(let D=0;D<j;){const u=Math.min(O-this.pos,j-D);if(u===O){const V=Ty(_);for(;O<=j-D;D+=O)this.process(V,D);continue}M.set(_.subarray(D,D+u),this.pos),this.pos+=u,D+=u,this.pos===O&&(this.process(T,0),this.pos=0)}return this.length+=_.length,this.roundClean(),this}digestInto(_){Nu.exists(this),Nu.output(_,this),this.finished=!0;const{buffer:T,view:M,blockLen:O,isLE:j}=this;let{pos:D}=this;T[D++]=128,this.buffer.subarray(D).fill(0),this.padOffset>O-D&&(this.process(M,0),D=0);for(let ue=D;ue<O;ue++)T[ue]=0;Cw(M,O-8,BigInt(this.length*8),j),this.process(M,0);const u=Ty(_),V=this.outputLen;if(V%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const te=V/4,fe=this.get();if(te>fe.length)throw new Error("_sha2: outputLen bigger than state");for(let ue=0;ue<te;ue++)u.setUint32(4*ue,fe[ue],j)}digest(){const{buffer:_,outputLen:T}=this;this.digestInto(_);const M=_.slice(0,T);return this.destroy(),M}_cloneInto(_){_||(_=new this.constructor),_.set(...this.get());const{blockLen:T,buffer:M,length:O,finished:j,destroyed:D,pos:u}=this;return _.length=O,_.pos=u,_.finished=j,_.destroyed=D,O%T&&_.buffer.set(M),_}}const zw=(f,_,T)=>f&_^~f&T,Dw=(f,_,T)=>f&_^f&T^_&T,Iw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),bd=new Uint32Array(64);class px extends Pw{constructor(){super(64,32,8,!1),this.A=xd[0]|0,this.B=xd[1]|0,this.C=xd[2]|0,this.D=xd[3]|0,this.E=xd[4]|0,this.F=xd[5]|0,this.G=xd[6]|0,this.H=xd[7]|0}get(){const{A:_,B:T,C:M,D:O,E:j,F:D,G:u,H:V}=this;return[_,T,M,O,j,D,u,V]}set(_,T,M,O,j,D,u,V){this.A=_|0,this.B=T|0,this.C=M|0,this.D=O|0,this.E=j|0,this.F=D|0,this.G=u|0,this.H=V|0}process(_,T){for(let ue=0;ue<16;ue++,T+=4)bd[ue]=_.getUint32(T,!1);for(let ue=16;ue<64;ue++){const De=bd[ue-15],Pe=bd[ue-2],je=Ou(De,7)^Ou(De,18)^De>>>3,be=Ou(Pe,17)^Ou(Pe,19)^Pe>>>10;bd[ue]=be+bd[ue-7]+je+bd[ue-16]|0}let{A:M,B:O,C:j,D,E:u,F:V,G:te,H:fe}=this;for(let ue=0;ue<64;ue++){const De=Ou(u,6)^Ou(u,11)^Ou(u,25),Pe=fe+De+zw(u,V,te)+Iw[ue]+bd[ue]|0,be=(Ou(M,2)^Ou(M,13)^Ou(M,22))+Dw(M,O,j)|0;fe=te,te=V,V=u,u=D+Pe|0,D=j,j=O,O=M,M=Pe+be|0}M=M+this.A|0,O=O+this.B|0,j=j+this.C|0,D=D+this.D|0,u=u+this.E|0,V=V+this.F|0,te=te+this.G|0,fe=fe+this.H|0,this.set(M,O,j,D,u,V,te,fe)}roundClean(){bd.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Lw extends px{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Ed=hx(()=>new px);hx(()=>new Lw);function $p(f){if(!Number.isSafeInteger(f))throw new Error(`Wrong integer: ${f}`)}function Ah(...f){const _=(O,j)=>D=>O(j(D)),T=Array.from(f).reverse().reduce((O,j)=>O?_(O,j.encode):j.encode,void 0),M=f.reduce((O,j)=>O?_(O,j.decode):j.decode,void 0);return{encode:T,decode:M}}function Ch(f){return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return _.map(T=>{if($p(T),T<0||T>=f.length)throw new Error(`Digit index outside alphabet: ${T} (alphabet: ${f.length})`);return f[T]})},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("alphabet.decode input should be array of strings");return _.map(T=>{if(typeof T!="string")throw new Error(`alphabet.decode: not string element=${T}`);const M=f.indexOf(T);if(M===-1)throw new Error(`Unknown letter: "${T}". Allowed: ${f}`);return M})}}}function Ph(f=""){if(typeof f!="string")throw new Error("join separator should be string");return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("join.encode input should be array of strings");for(let T of _)if(typeof T!="string")throw new Error(`join.encode: non-string input=${T}`);return _.join(f)},decode:_=>{if(typeof _!="string")throw new Error("join.decode input should be string");return _.split(f)}}}function R_(f,_="="){if($p(f),typeof _!="string")throw new Error("padding chr should be string");return{encode(T){if(!Array.isArray(T)||T.length&&typeof T[0]!="string")throw new Error("padding.encode input should be array of strings");for(let M of T)if(typeof M!="string")throw new Error(`padding.encode: non-string input=${M}`);for(;T.length*f%8;)T.push(_);return T},decode(T){if(!Array.isArray(T)||T.length&&typeof T[0]!="string")throw new Error("padding.encode input should be array of strings");for(let O of T)if(typeof O!="string")throw new Error(`padding.decode: non-string input=${O}`);let M=T.length;if(M*f%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;M>0&&T[M-1]===_;M--)if(!((M-1)*f%8))throw new Error("Invalid padding: string has too much padding");return T.slice(0,M)}}}function mx(f){if(typeof f!="function")throw new Error("normalize fn should be function");return{encode:_=>_,decode:_=>f(_)}}function dv(f,_,T){if(_<2)throw new Error(`convertRadix: wrong from=${_}, base cannot be less than 2`);if(T<2)throw new Error(`convertRadix: wrong to=${T}, base cannot be less than 2`);if(!Array.isArray(f))throw new Error("convertRadix: data should be array");if(!f.length)return[];let M=0;const O=[],j=Array.from(f);for(j.forEach(D=>{if($p(D),D<0||D>=_)throw new Error(`Wrong integer: ${D}`)});;){let D=0,u=!0;for(let V=M;V<j.length;V++){const te=j[V],fe=_*D+te;if(!Number.isSafeInteger(fe)||_*D/_!==D||fe-te!==_*D)throw new Error("convertRadix: carry overflow");if(D=fe%T,j[V]=Math.floor(fe/T),!Number.isSafeInteger(j[V])||j[V]*T+D!==fe)throw new Error("convertRadix: carry overflow");if(u)j[V]?u=!1:M=V;else continue}if(O.push(D),u)break}for(let D=0;D<f.length-1&&f[D]===0;D++)O.push(0);return O.reverse()}const gx=(f,_)=>_?gx(_,f%_):f,S_=(f,_)=>f+(_-gx(f,_));function Ny(f,_,T,M){if(!Array.isArray(f))throw new Error("convertRadix2: data should be array");if(_<=0||_>32)throw new Error(`convertRadix2: wrong from=${_}`);if(T<=0||T>32)throw new Error(`convertRadix2: wrong to=${T}`);if(S_(_,T)>32)throw new Error(`convertRadix2: carry overflow from=${_} to=${T} carryBits=${S_(_,T)}`);let O=0,j=0;const D=2**T-1,u=[];for(const V of f){if($p(V),V>=2**_)throw new Error(`convertRadix2: invalid data word=${V} from=${_}`);if(O=O<<_|V,j+_>32)throw new Error(`convertRadix2: carry overflow pos=${j} from=${_}`);for(j+=_;j>=T;j-=T)u.push((O>>j-T&D)>>>0);O&=2**j-1}if(O=O<<T-j&D,!M&&j>=_)throw new Error("Excess padding");if(!M&&O)throw new Error(`Non-zero padding: ${O}`);return M&&j>0&&u.push(O>>>0),u}function kw(f){return $p(f),{encode:_=>{if(!(_ instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return dv(Array.from(_),2**8,f)},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(dv(_,f,2**8))}}}function Md(f,_=!1){if($p(f),f<=0||f>32)throw new Error("radix2: bits should be in (0..32]");if(S_(8,f)>32||S_(f,8)>32)throw new Error("radix2: carry overflow");return{encode:T=>{if(!(T instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ny(Array.from(T),8,f,!_)},decode:T=>{if(!Array.isArray(T)||T.length&&typeof T[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ny(T,f,8,_))}}}function fv(f){if(typeof f!="function")throw new Error("unsafeWrapper fn should be function");return function(..._){try{return f.apply(null,_)}catch{}}}const Rw=Ah(Md(4),Ch("0123456789ABCDEF"),Ph("")),Ow=Ah(Md(5),Ch("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),R_(5),Ph(""));Ah(Md(5),Ch("0123456789ABCDEFGHIJKLMNOPQRSTUV"),R_(5),Ph(""));Ah(Md(5),Ch("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Ph(""),mx(f=>f.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Mh=Ah(Md(6),Ch("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),R_(6),Ph("")),Bw=Ah(Md(6),Ch("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),R_(6),Ph("")),a0=f=>Ah(kw(58),Ch(f),Ph("")),Fy=a0("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");a0("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");a0("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const pv=[0,2,3,5,6,7,9,10,11],Nw={encode(f){let _="";for(let T=0;T<f.length;T+=8){const M=f.subarray(T,T+8);_+=Fy.encode(M).padStart(pv[M.length],"1")}return _},decode(f){let _=[];for(let T=0;T<f.length;T+=11){const M=f.slice(T,T+11),O=pv.indexOf(M.length),j=Fy.decode(M);for(let D=0;D<j.length-O;D++)if(j[D]!==0)throw new Error("base58xmr: wrong padding");_=_.concat(Array.from(j.slice(j.length-O)))}return Uint8Array.from(_)}},jy=Ah(Ch("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ph("")),mv=[996825010,642813549,513874426,1027748829,705979059];function tg(f){const _=f>>25;let T=(f&33554431)<<5;for(let M=0;M<mv.length;M++)(_>>M&1)===1&&(T^=mv[M]);return T}function gv(f,_,T=1){const M=f.length;let O=1;for(let j=0;j<M;j++){const D=f.charCodeAt(j);if(D<33||D>126)throw new Error(`Invalid prefix (${f})`);O=tg(O)^D>>5}O=tg(O);for(let j=0;j<M;j++)O=tg(O)^f.charCodeAt(j)&31;for(let j of _)O=tg(O)^j;for(let j=0;j<6;j++)O=tg(O);return O^=T,jy.encode(Ny([O%2**30],30,5,!1))}function _x(f){const _=f==="bech32"?1:734539939,T=Md(5),M=T.decode,O=T.encode,j=fv(M);function D(fe,ue,De=90){if(typeof fe!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof fe}`);if(!Array.isArray(ue)||ue.length&&typeof ue[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ue}`);const Pe=fe.length+7+ue.length;if(De!==!1&&Pe>De)throw new TypeError(`Length ${Pe} exceeds limit ${De}`);return fe=fe.toLowerCase(),`${fe}1${jy.encode(ue)}${gv(fe,ue,_)}`}function u(fe,ue=90){if(typeof fe!="string")throw new Error(`bech32.decode input should be string, not ${typeof fe}`);if(fe.length<8||ue!==!1&&fe.length>ue)throw new TypeError(`Wrong string length: ${fe.length} (${fe}). Expected (8..${ue})`);const De=fe.toLowerCase();if(fe!==De&&fe!==fe.toUpperCase())throw new Error("String must be lowercase or uppercase");fe=De;const Pe=fe.lastIndexOf("1");if(Pe===0||Pe===-1)throw new Error('Letter "1" must be present between prefix and data only');const je=fe.slice(0,Pe),be=fe.slice(Pe+1);if(be.length<6)throw new Error("Data must be at least 6 characters long");const de=jy.decode(be).slice(0,-6),He=gv(je,de,_);if(!be.endsWith(He))throw new Error(`Invalid checksum in ${fe}: expected "${He}"`);return{prefix:je,words:de}}const V=fv(u);function te(fe){const{prefix:ue,words:De}=u(fe,!1);return{prefix:ue,words:De,bytes:M(De)}}return{encode:D,decode:u,decodeToBytes:te,decodeUnsafe:V,fromWords:M,fromWordsUnsafe:j,toWords:O}}const qp=_x("bech32");_x("bech32m");const Fw={encode:f=>new TextDecoder().decode(f),decode:f=>new TextEncoder().encode(f)},jw=Ah(Md(4),Ch("0123456789abcdef"),Ph(""),mx(f=>{if(typeof f!="string"||f.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof f} with length ${f.length}`);return f.toLowerCase()})),Uw={utf8:Fw,hex:jw,base16:Rw,base32:Ow,base64:Mh,base64url:Bw,base58:Fy,base58xmr:Nw};`${Object.keys(Uw).join(", ")}`;function Sy(f){if(!Number.isSafeInteger(f)||f<0)throw new Error(`positive integer expected, not ${f}`)}function _v(f){if(typeof f!="boolean")throw new Error(`boolean expected, not ${f}`)}function Vw(f){return f instanceof Uint8Array||f!=null&&typeof f=="object"&&f.constructor.name==="Uint8Array"}function Fu(f,..._){if(!Vw(f))throw new Error("Uint8Array expected");if(_.length>0&&!_.includes(f.length))throw new Error(`Uint8Array expected of length ${_}, not of length=${f.length}`)}const Ks=f=>new Uint32Array(f.buffer,f.byteOffset,Math.floor(f.byteLength/4)),Zw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Zw)throw new Error("Non little-endian hardware is not supported");const qw=Array.from({length:256},(f,_)=>_.toString(16).padStart(2,"0"));function Np(f){Fu(f);let _="";for(let T=0;T<f.length;T++)_+=qw[f[T]];return _}const bh={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function yv(f){if(f>=bh._0&&f<=bh._9)return f-bh._0;if(f>=bh._A&&f<=bh._F)return f-(bh._A-10);if(f>=bh._a&&f<=bh._f)return f-(bh._a-10)}function yx(f){if(typeof f!="string")throw new Error("hex string expected, got "+typeof f);const _=f.length,T=_/2;if(_%2)throw new Error("padded hex string expected, got unpadded hex of length "+_);const M=new Uint8Array(T);for(let O=0,j=0;O<T;O++,j+=2){const D=yv(f.charCodeAt(j)),u=yv(f.charCodeAt(j+1));if(D===void 0||u===void 0){const V=f[j]+f[j+1];throw new Error('hex string expected, got non-hex character "'+V+'" at index '+j)}M[O]=D*16+u}return M}function Gw(f,_){if(_==null||typeof _!="object")throw new Error("options must be defined");return Object.assign(f,_)}function Hw(f,_){if(f.length!==_.length)return!1;let T=0;for(let M=0;M<f.length;M++)T|=f[M]^_[M];return T===0}const $w=(f,_)=>(Object.assign(_,f),_),Td=16,Xw=283;function s0(f){return f<<1^Xw&-(f>>7)}function Fp(f,_){let T=0;for(;_>0;_>>=1)T^=f&-(_&1),f=s0(f);return T}const Uy=(()=>{let f=new Uint8Array(256);for(let T=0,M=1;T<256;T++,M^=s0(M))f[T]=M;const _=new Uint8Array(256);_[0]=99;for(let T=0;T<255;T++){let M=f[255-T];M|=M<<8,_[f[T]]=(M^M>>4^M>>5^M>>6^M>>7^99)&255}return _})(),Yw=Uy.map((f,_)=>Uy.indexOf(_)),Ww=f=>f<<24|f>>>8,Ey=f=>f<<8|f>>>24;function vx(f,_){if(f.length!==256)throw new Error("Wrong sbox length");const T=new Uint32Array(256).map((te,fe)=>_(f[fe])),M=T.map(Ey),O=M.map(Ey),j=O.map(Ey),D=new Uint32Array(256*256),u=new Uint32Array(256*256),V=new Uint16Array(256*256);for(let te=0;te<256;te++)for(let fe=0;fe<256;fe++){const ue=te*256+fe;D[ue]=T[te]^M[fe],u[ue]=O[te]^j[fe],V[ue]=f[te]<<8|f[fe]}return{sbox:f,sbox2:V,T0:T,T1:M,T2:O,T3:j,T01:D,T23:u}}const o0=vx(Uy,f=>Fp(f,3)<<24|f<<16|f<<8|Fp(f,2)),xx=vx(Yw,f=>Fp(f,11)<<24|Fp(f,13)<<16|Fp(f,9)<<8|Fp(f,14)),Kw=(()=>{const f=new Uint8Array(16);for(let _=0,T=1;_<16;_++,T=s0(T))f[_]=T;return f})();function bx(f){Fu(f);const _=f.length;if(![16,24,32].includes(_))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${_}`);const{sbox2:T}=o0,M=Ks(f),O=M.length,j=u=>ju(T,u,u,u,u),D=new Uint32Array(_+28);D.set(M);for(let u=O;u<D.length;u++){let V=D[u-1];u%O===0?V=j(Ww(V))^Kw[u/O-1]:O>6&&u%O===4&&(V=j(V)),D[u]=D[u-O]^V}return D}function Qw(f){const _=bx(f),T=_.slice(),M=_.length,{sbox2:O}=o0,{T0:j,T1:D,T2:u,T3:V}=xx;for(let te=0;te<M;te+=4)for(let fe=0;fe<4;fe++)T[te+fe]=_[M-te-4+fe];_.fill(0);for(let te=4;te<M-4;te++){const fe=T[te],ue=ju(O,fe,fe,fe,fe);T[te]=j[ue&255]^D[ue>>>8&255]^u[ue>>>16&255]^V[ue>>>24]}return T}function wd(f,_,T,M,O,j){return f[T<<8&65280|M>>>8&255]^_[O>>>8&65280|j>>>24&255]}function ju(f,_,T,M,O){return f[_&255|T&65280]|f[M>>>16&255|O>>>16&65280]<<16}function vv(f,_,T,M,O){const{sbox2:j,T01:D,T23:u}=o0;let V=0;_^=f[V++],T^=f[V++],M^=f[V++],O^=f[V++];const te=f.length/4-2;for(let je=0;je<te;je++){const be=f[V++]^wd(D,u,_,T,M,O),de=f[V++]^wd(D,u,T,M,O,_),He=f[V++]^wd(D,u,M,O,_,T),ut=f[V++]^wd(D,u,O,_,T,M);_=be,T=de,M=He,O=ut}const fe=f[V++]^ju(j,_,T,M,O),ue=f[V++]^ju(j,T,M,O,_),De=f[V++]^ju(j,M,O,_,T),Pe=f[V++]^ju(j,O,_,T,M);return{s0:fe,s1:ue,s2:De,s3:Pe}}function Jw(f,_,T,M,O){const{sbox2:j,T01:D,T23:u}=xx;let V=0;_^=f[V++],T^=f[V++],M^=f[V++],O^=f[V++];const te=f.length/4-2;for(let je=0;je<te;je++){const be=f[V++]^wd(D,u,_,O,M,T),de=f[V++]^wd(D,u,T,_,O,M),He=f[V++]^wd(D,u,M,T,_,O),ut=f[V++]^wd(D,u,O,M,T,_);_=be,T=de,M=He,O=ut}const fe=f[V++]^ju(j,_,O,M,T),ue=f[V++]^ju(j,T,_,O,M),De=f[V++]^ju(j,M,T,_,O),Pe=f[V++]^ju(j,O,M,T,_);return{s0:fe,s1:ue,s2:De,s3:Pe}}function wx(f,_){if(!_)return new Uint8Array(f);if(Fu(_),_.length<f)throw new Error(`aes: wrong destination length, expected at least ${f}, got: ${_.length}`);return _}function e2(f){if(Fu(f),f.length%Td!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Td}`)}function t2(f,_,T){let M=f.length;const O=M%Td;if(!_&&O!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const j=Ks(f);if(_){let V=Td-O;V||(V=Td),M=M+V}const D=wx(M,T),u=Ks(D);return{b:j,o:u,out:D}}function i2(f,_){if(!_)return f;const T=f.length;if(!T)throw new Error("aes/pcks5: empty ciphertext not allowed");const M=f[T-1];if(M<=0||M>16)throw new Error(`aes/pcks5: wrong padding byte: ${M}`);const O=f.subarray(0,-M);for(let j=0;j<M;j++)if(f[T-j-1]!==M)throw new Error("aes/pcks5: wrong padding");return O}function n2(f){const _=new Uint8Array(16),T=Ks(_);_.set(f);const M=Td-f.length;for(let O=Td-M;O<Td;O++)_[O]=M;return T}const Tx=$w({blockSize:16,nonceLength:16},function(_,T,M={}){Fu(_),Fu(T,16);const O=!M.disablePadding;return{encrypt:(j,D)=>{const u=bx(_),{b:V,o:te,out:fe}=t2(j,O,D),ue=Ks(T);let De=ue[0],Pe=ue[1],je=ue[2],be=ue[3],de=0;for(;de+4<=V.length;)De^=V[de+0],Pe^=V[de+1],je^=V[de+2],be^=V[de+3],{s0:De,s1:Pe,s2:je,s3:be}=vv(u,De,Pe,je,be),te[de++]=De,te[de++]=Pe,te[de++]=je,te[de++]=be;if(O){const He=n2(j.subarray(de*4));De^=He[0],Pe^=He[1],je^=He[2],be^=He[3],{s0:De,s1:Pe,s2:je,s3:be}=vv(u,De,Pe,je,be),te[de++]=De,te[de++]=Pe,te[de++]=je,te[de++]=be}return u.fill(0),fe},decrypt:(j,D)=>{e2(j);const u=Qw(_),V=Ks(T),te=wx(j.length,D),fe=Ks(j),ue=Ks(te);let De=V[0],Pe=V[1],je=V[2],be=V[3];for(let de=0;de+4<=fe.length;){const He=De,ut=Pe,Fe=je,Ut=be;De=fe[de+0],Pe=fe[de+1],je=fe[de+2],be=fe[de+3];const{s0:Rt,s1:dt,s2:rt,s3:Ct}=Jw(u,De,Pe,je,be);ue[de++]=Rt^He,ue[de++]=dt^ut,ue[de++]=rt^Fe,ue[de++]=Ct^Ut}return u.fill(0),i2(te,O)}}}),Sx=f=>Uint8Array.from(f.split("").map(_=>_.charCodeAt(0))),r2=Sx("expand 16-byte k"),a2=Sx("expand 32-byte k"),s2=Ks(r2),Ex=Ks(a2);Ex.slice();function In(f,_){return f<<_|f>>>32-_}function Vy(f){return f.byteOffset%4===0}const d_=64,o2=16,Mx=2**32-1,xv=new Uint32Array;function l2(f,_,T,M,O,j,D,u){const V=O.length,te=new Uint8Array(d_),fe=Ks(te),ue=Vy(O)&&Vy(j),De=ue?Ks(O):xv,Pe=ue?Ks(j):xv;for(let je=0;je<V;D++){if(f(_,T,M,fe,D,u),D>=Mx)throw new Error("arx: counter overflow");const be=Math.min(d_,V-je);if(ue&&be===d_){const de=je/4;if(je%4!==0)throw new Error("arx: invalid block position");for(let He=0,ut;He<o2;He++)ut=de+He,Pe[ut]=De[ut]^fe[He];je+=d_;continue}for(let de=0,He;de<be;de++)He=je+de,j[He]=O[He]^te[de];je+=be}}function c2(f,_){const{allowShortKeys:T,extendNonceFn:M,counterLength:O,counterRight:j,rounds:D}=Gw({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},_);if(typeof f!="function")throw new Error("core must be a function");return Sy(O),Sy(D),_v(j),_v(T),(u,V,te,fe,ue=0)=>{Fu(u),Fu(V),Fu(te);const De=te.length;if(fe||(fe=new Uint8Array(De)),Fu(fe),Sy(ue),ue<0||ue>=Mx)throw new Error("arx: counter overflow");if(fe.length<De)throw new Error(`arx: output (${fe.length}) is shorter than data (${De})`);const Pe=[];let je=u.length,be,de;if(je===32)be=u.slice(),Pe.push(be),de=Ex;else if(je===16&&T)be=new Uint8Array(32),be.set(u),be.set(u,16),de=s2,Pe.push(be);else throw new Error(`arx: invalid 32-byte key, got length=${je}`);Vy(V)||(V=V.slice(),Pe.push(V));const He=Ks(be);if(M){if(V.length!==24)throw new Error("arx: extended nonce must be 24 bytes");M(de,He,Ks(V.subarray(0,16)),He),V=V.subarray(16)}const ut=16-O;if(ut!==V.length)throw new Error(`arx: nonce must be ${ut} or 16 bytes`);if(ut!==12){const Ut=new Uint8Array(12);Ut.set(V,j?0:12-V.length),V=Ut,Pe.push(V)}const Fe=Ks(V);for(l2(f,de,He,Fe,te,fe,ue,D);Pe.length>0;)Pe.pop().fill(0);return fe}}function u2(f,_,T,M,O,j=20){let D=f[0],u=f[1],V=f[2],te=f[3],fe=_[0],ue=_[1],De=_[2],Pe=_[3],je=_[4],be=_[5],de=_[6],He=_[7],ut=O,Fe=T[0],Ut=T[1],Rt=T[2],dt=D,rt=u,Ct=V,jt=te,Ht=fe,Ot=ue,Yt=De,si=Pe,oi=je,wt=be,ze=de,Je=He,st=ut,Et=Fe,lt=Ut,_e=Rt;for(let yt=0;yt<j;yt+=2)dt=dt+Ht|0,st=In(st^dt,16),oi=oi+st|0,Ht=In(Ht^oi,12),dt=dt+Ht|0,st=In(st^dt,8),oi=oi+st|0,Ht=In(Ht^oi,7),rt=rt+Ot|0,Et=In(Et^rt,16),wt=wt+Et|0,Ot=In(Ot^wt,12),rt=rt+Ot|0,Et=In(Et^rt,8),wt=wt+Et|0,Ot=In(Ot^wt,7),Ct=Ct+Yt|0,lt=In(lt^Ct,16),ze=ze+lt|0,Yt=In(Yt^ze,12),Ct=Ct+Yt|0,lt=In(lt^Ct,8),ze=ze+lt|0,Yt=In(Yt^ze,7),jt=jt+si|0,_e=In(_e^jt,16),Je=Je+_e|0,si=In(si^Je,12),jt=jt+si|0,_e=In(_e^jt,8),Je=Je+_e|0,si=In(si^Je,7),dt=dt+Ot|0,_e=In(_e^dt,16),ze=ze+_e|0,Ot=In(Ot^ze,12),dt=dt+Ot|0,_e=In(_e^dt,8),ze=ze+_e|0,Ot=In(Ot^ze,7),rt=rt+Yt|0,st=In(st^rt,16),Je=Je+st|0,Yt=In(Yt^Je,12),rt=rt+Yt|0,st=In(st^rt,8),Je=Je+st|0,Yt=In(Yt^Je,7),Ct=Ct+si|0,Et=In(Et^Ct,16),oi=oi+Et|0,si=In(si^oi,12),Ct=Ct+si|0,Et=In(Et^Ct,8),oi=oi+Et|0,si=In(si^oi,7),jt=jt+Ht|0,lt=In(lt^jt,16),wt=wt+lt|0,Ht=In(Ht^wt,12),jt=jt+Ht|0,lt=In(lt^jt,8),wt=wt+lt|0,Ht=In(Ht^wt,7);let Ue=0;M[Ue++]=D+dt|0,M[Ue++]=u+rt|0,M[Ue++]=V+Ct|0,M[Ue++]=te+jt|0,M[Ue++]=fe+Ht|0,M[Ue++]=ue+Ot|0,M[Ue++]=De+Yt|0,M[Ue++]=Pe+si|0,M[Ue++]=je+oi|0,M[Ue++]=be+wt|0,M[Ue++]=de+ze|0,M[Ue++]=He+Je|0,M[Ue++]=ut+st|0,M[Ue++]=Fe+Et|0,M[Ue++]=Ut+lt|0,M[Ue++]=Rt+_e|0}const Ax=c2(u2,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Cx extends ux{constructor(_,T){super(),this.finished=!1,this.destroyed=!1,Nu.hash(_);const M=rg(T);if(this.iHash=_.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const O=this.blockLen,j=new Uint8Array(O);j.set(M.length>O?_.create().update(M).digest():M);for(let D=0;D<j.length;D++)j[D]^=54;this.iHash.update(j),this.oHash=_.create();for(let D=0;D<j.length;D++)j[D]^=106;this.oHash.update(j),j.fill(0)}update(_){return Nu.exists(this),this.iHash.update(_),this}digestInto(_){Nu.exists(this),Nu.bytes(_,this.outputLen),this.finished=!0,this.iHash.digestInto(_),this.oHash.update(_),this.oHash.digestInto(_),this.destroy()}digest(){const _=new Uint8Array(this.oHash.outputLen);return this.digestInto(_),_}_cloneInto(_){_||(_=Object.create(Object.getPrototypeOf(this),{}));const{oHash:T,iHash:M,finished:O,destroyed:j,blockLen:D,outputLen:u}=this;return _=_,_.finished=O,_.destroyed=j,_.blockLen=D,_.outputLen=u,_.oHash=T._cloneInto(_.oHash),_.iHash=M._cloneInto(_.iHash),_}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const O_=(f,_,T)=>new Cx(f,_).update(T).digest();O_.create=(f,_)=>new Cx(f,_);function h2(f,_,T){return Nu.hash(f),O_(f,rg(T),rg(_))}const My=new Uint8Array([0]),bv=new Uint8Array;function d2(f,_,T,M=32){if(Nu.hash(f),Nu.number(M),M>255*f.outputLen)throw new Error("Length should be <= 255*HashLen");const O=Math.ceil(M/f.outputLen);T===void 0&&(T=bv);const j=new Uint8Array(O*f.outputLen),D=O_.create(f,_),u=D._cloneInto(),V=new Uint8Array(D.outputLen);for(let te=0;te<O;te++)My[0]=te+1,u.update(te===0?bv:V).update(T).update(My).digestInto(V),j.set(V,f.outputLen*te),D._cloneInto(u);return D.destroy(),u.destroy(),V.fill(0),My.fill(0),j.slice(0,M)}var f2=Object.defineProperty,Ar=(f,_)=>{for(var T in _)f2(f,T,{get:_[T],enumerable:!0})},Mf=Symbol("verified"),p2=f=>f instanceof Object;function l0(f){if(!p2(f)||typeof f.kind!="number"||typeof f.content!="string"||typeof f.created_at!="number"||typeof f.pubkey!="string"||!f.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(f.tags))return!1;for(let _=0;_<f.tags.length;_++){let T=f.tags[_];if(!Array.isArray(T))return!1;for(let M=0;M<T.length;M++)if(typeof T[M]!="string")return!1}return!0}var m2={};Ar(m2,{Queue:()=>zx,QueueNode:()=>Px,binarySearch:()=>c0,bytesToHex:()=>Ra,hexToBytes:()=>Lf,insertEventIntoAscendingList:()=>_2,insertEventIntoDescendingList:()=>g2,normalizeURL:()=>Pf,utf8Decoder:()=>Eh,utf8Encoder:()=>Kc});var Eh=new TextDecoder("utf-8"),Kc=new TextEncoder;function Pf(f){try{f.indexOf("://")===-1&&(f="wss://"+f);let _=new URL(f);return _.protocol==="http:"?_.protocol="ws:":_.protocol==="https:"&&(_.protocol="wss:"),_.pathname=_.pathname.replace(/\/+/g,"/"),_.pathname.endsWith("/")&&(_.pathname=_.pathname.slice(0,-1)),(_.port==="80"&&_.protocol==="ws:"||_.port==="443"&&_.protocol==="wss:")&&(_.port=""),_.searchParams.sort(),_.hash="",_.toString()}catch{throw new Error(`Invalid URL: ${f}`)}}function g2(f,_){const[T,M]=c0(f,O=>_.id===O.id?0:_.created_at===O.created_at?-1:O.created_at-_.created_at);return M||f.splice(T,0,_),f}function _2(f,_){const[T,M]=c0(f,O=>_.id===O.id?0:_.created_at===O.created_at?-1:_.created_at-O.created_at);return M||f.splice(T,0,_),f}function c0(f,_){let T=0,M=f.length-1;for(;T<=M;){const O=Math.floor((T+M)/2),j=_(f[O]);if(j===0)return[O,!0];j<0?M=O-1:T=O+1}return[T,!1]}var Px=class{value;next=null;prev=null;constructor(f){this.value=f}},zx=class{first;last;constructor(){this.first=null,this.last=null}enqueue(f){const _=new Px(f);return this.last?this.last===this.first?(this.last=_,this.last.prev=this.first,this.first.next=_):(_.prev=this.last,this.last.next=_,this.last=_):(this.first=_,this.last=_),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const _=this.first;return this.first=null,this.last=null,_.value}const f=this.first;return this.first=f.next,this.first&&(this.first.prev=null),f.value}},y2=class{generateSecretKey(){return Bu.utils.randomPrivateKey()}getPublicKey(_){return Ra(Bu.getPublicKey(_))}finalizeEvent(_,T){const M=_;return M.pubkey=Ra(Bu.getPublicKey(T)),M.id=m_(M),M.sig=Ra(Bu.sign(m_(M),T)),M[Mf]=!0,M}verifyEvent(_){if(typeof _[Mf]=="boolean")return _[Mf];const T=m_(_);if(T!==_.id)return _[Mf]=!1,!1;try{const M=Bu.verify(_.sig,T,_.pubkey);return _[Mf]=M,M}catch{return _[Mf]=!1,!1}}};function v2(f){if(!l0(f))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,f.pubkey,f.created_at,f.kind,f.tags,f.content])}function m_(f){let _=Ed(Kc.encode(v2(f)));return Ra(_)}var B_=new y2,Dx=B_.generateSecretKey,ag=B_.getPublicKey,cc=B_.finalizeEvent,N_=B_.verifyEvent,x2={};Ar(x2,{Application:()=>IT,BadgeAward:()=>C2,BadgeDefinition:()=>ET,BlockedRelaysList:()=>oT,BlossomServerList:()=>pT,BookmarkList:()=>rT,Bookmarksets:()=>wT,Calendar:()=>FT,CalendarEventRSVP:()=>jT,ChannelCreation:()=>Bx,ChannelHideMessage:()=>jx,ChannelMessage:()=>Fx,ChannelMetadata:()=>Nx,ChannelMuteUser:()=>Ux,ChatMessage:()=>P2,ClassifiedListing:()=>RT,ClientAuth:()=>Zx,Comment:()=>N2,CommunitiesList:()=>aT,CommunityDefinition:()=>qT,CommunityPostApproval:()=>H2,Contacts:()=>E2,CreateOrUpdateProduct:()=>CT,CreateOrUpdateStall:()=>AT,Curationsets:()=>TT,Date:()=>BT,DirectMessageRelaysList:()=>dT,DraftClassifiedListing:()=>OT,DraftLong:()=>zT,Emojisets:()=>DT,EncryptedDirectMessage:()=>M2,EventDeletion:()=>A2,FavoriteRelays:()=>cT,FileMessage:()=>D2,FileMetadata:()=>B2,FileServerPreference:()=>fT,Followsets:()=>vT,ForumThread:()=>z2,GenericRepost:()=>p0,Genericlists:()=>xT,GiftWrap:()=>Vx,GroupMetadata:()=>GT,HTTPAuth:()=>m0,Handlerinformation:()=>ZT,Handlerrecommendation:()=>VT,Highlights:()=>J2,InterestsList:()=>uT,Interestsets:()=>MT,JobFeedback:()=>Y2,JobRequest:()=>$2,JobResult:()=>X2,Label:()=>G2,LightningPubRPC:()=>gT,LiveChatMessage:()=>F2,LiveEvent:()=>LT,LongFormArticle:()=>PT,Metadata:()=>T2,Mutelist:()=>tT,NWCWalletInfo:()=>mT,NWCWalletRequest:()=>qx,NWCWalletResponse:()=>_T,NormalVideo:()=>L2,NostrConnect:()=>yT,OpenTimestamps:()=>R2,Photo:()=>I2,Pinlist:()=>iT,Poll:()=>O2,PollResponse:()=>eT,PrivateDirectMessage:()=>Ox,ProblemTracker:()=>V2,ProfileBadges:()=>ST,PublicChatsList:()=>sT,Reaction:()=>f0,RecommendRelay:()=>S2,RelayList:()=>nT,RelayReview:()=>UT,Relaysets:()=>bT,Report:()=>Z2,Reporting:()=>q2,Repost:()=>d0,Seal:()=>Rx,SearchRelaysList:()=>lT,ShortTextNote:()=>kx,ShortVideo:()=>k2,Time:()=>NT,UserEmojiList:()=>hT,UserStatuses:()=>kT,Voice:()=>j2,VoiceComment:()=>U2,Zap:()=>Q2,ZapGoal:()=>W2,ZapRequest:()=>K2,classifyKind:()=>b2,isAddressableKind:()=>h0,isEphemeralKind:()=>Lx,isKind:()=>w2,isRegularKind:()=>Ix,isReplaceableKind:()=>u0});function Ix(f){return f<1e4&&f!==0&&f!==3}function u0(f){return f===0||f===3||1e4<=f&&f<2e4}function Lx(f){return 2e4<=f&&f<3e4}function h0(f){return 3e4<=f&&f<4e4}function b2(f){return Ix(f)?"regular":u0(f)?"replaceable":Lx(f)?"ephemeral":h0(f)?"parameterized":"unknown"}function w2(f,_){const T=_ instanceof Array?_:[_];return l0(f)&&T.includes(f.kind)||!1}var T2=0,kx=1,S2=2,E2=3,M2=4,A2=5,d0=6,f0=7,C2=8,P2=9,z2=11,Rx=13,Ox=14,D2=15,p0=16,I2=20,L2=21,k2=22,Bx=40,Nx=41,Fx=42,jx=43,Ux=44,R2=1040,Vx=1059,O2=1068,B2=1063,N2=1111,F2=1311,j2=1222,U2=1244,V2=1971,Z2=1984,q2=1984,G2=1985,H2=4550,$2=5999,X2=6999,Y2=7e3,W2=9041,K2=9734,Q2=9735,J2=9802,eT=1018,tT=1e4,iT=10001,nT=10002,rT=10003,aT=10004,sT=10005,oT=10006,lT=10007,cT=10012,uT=10015,hT=10030,dT=10050,fT=10096,pT=10063,mT=13194,gT=21e3,Zx=22242,qx=23194,_T=23195,yT=24133,m0=27235,vT=3e4,xT=30001,bT=30002,wT=30003,TT=30004,ST=30008,ET=30009,MT=30015,AT=30017,CT=30018,PT=30023,zT=30024,DT=30030,IT=30078,LT=30311,kT=30315,RT=30402,OT=30403,BT=31922,NT=31923,FT=31924,jT=31925,UT=31987,VT=31989,ZT=31990,qT=34550,GT=39e3;function HT(f,_){if(f.ids&&f.ids.indexOf(_.id)===-1||f.kinds&&f.kinds.indexOf(_.kind)===-1||f.authors&&f.authors.indexOf(_.pubkey)===-1)return!1;for(let T in f)if(T[0]==="#"){let M=T.slice(1),O=f[`#${M}`];if(O&&!_.tags.find(([j,D])=>j===T.slice(1)&&O.indexOf(D)!==-1))return!1}return!(f.since&&_.created_at<f.since||f.until&&_.created_at>f.until)}function $T(f,_){for(let T=0;T<f.length;T++)if(HT(f[T],_))return!0;return!1}var XT={};Ar(XT,{getHex64:()=>F_,getInt:()=>Gx,getSubscriptionId:()=>Hx,matchEventId:()=>YT,matchEventKind:()=>KT,matchEventPubkey:()=>WT});function F_(f,_){let T=_.length+3,M=f.indexOf(`"${_}":`)+T,O=f.slice(M).indexOf('"')+M+1;return f.slice(O,O+64)}function Gx(f,_){let T=_.length,M=f.indexOf(`"${_}":`)+T+3,O=f.slice(M),j=Math.min(O.indexOf(","),O.indexOf("}"));return parseInt(O.slice(0,j),10)}function Hx(f){let _=f.slice(0,22).indexOf('"EVENT"');if(_===-1)return null;let T=f.slice(_+7+1).indexOf('"');if(T===-1)return null;let M=_+7+1+T,O=f.slice(M+1,80).indexOf('"');if(O===-1)return null;let j=M+1+O;return f.slice(M+1,j)}function YT(f,_){return _===F_(f,"id")}function WT(f,_){return _===F_(f,"pubkey")}function KT(f,_){return _===Gx(f,"kind")}var QT={};Ar(QT,{makeAuthEvent:()=>$x});function $x(f,_){return{kind:Zx,created_at:Math.floor(Date.now()/1e3),tags:[["relay",f],["challenge",_]],content:""}}async function JT(){return new Promise((f,_)=>{try{if(typeof MessageChannel<"u"){const T=new MessageChannel,M=()=>{T.port1.removeEventListener("message",M),f()};T.port1.addEventListener("message",M),T.port2.postMessage(0),T.port1.start()}else typeof setImmediate<"u"?setImmediate(f):typeof setTimeout<"u"?setTimeout(f,0):f()}catch(T){console.error("during yield: ",T),_(T)}})}var eS=f=>(f[Mf]=!0,!0),Xx=class extends Error{constructor(f,_){super(`Tried to send message '${f} on a closed connection to ${_}.`),this.name="SendingOnClosedConnection"}},Yx=class{url;_connected=!1;onclose=null;onnotice=f=>console.debug(`NOTICE from ${this.url}: ${f}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new zx;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(f,_){this.url=Pf(f),this.verifyEvent=_.verifyEvent,this._WebSocket=_.websocketImplementation||WebSocket,this.enablePing=_.enablePing,this.enableReconnect=_.enableReconnect||!1}static async connect(f,_){const T=new Yx(f,_);return await T.connect(),T}closeAllSubscriptions(f){for(let[_,T]of this.openSubs)T.close(f);this.openSubs.clear();for(let[_,T]of this.openEventPublishes)T.reject(new Error(f));this.openEventPublishes.clear();for(let[_,T]of this.openCountRequests)T.reject(new Error(f));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const f=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},f)}handleHardClose(f){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const _=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!_?this.reconnect():this.closeAllSubscriptions(f)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((f,_)=>{this.connectionTimeoutHandle=setTimeout(()=>{_("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(T){clearTimeout(this.connectionTimeoutHandle),_(T);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const T=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const M of this.openSubs.values()){if(M.eosed=!1,T)for(let O=0;O<M.filters.length;O++)M.lastEmitted&&(M.filters[O].since=M.lastEmitted+1);M.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),f()},this.ws.onerror=T=>{clearTimeout(this.connectionTimeoutHandle),_(T.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=T=>{clearTimeout(this.connectionTimeoutHandle),_(T.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(f=>{this.ws.once("pong",()=>f(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((f,_)=>{if(!this.connectionPromise)return _(new Error(`no connection to ${this.url}, can't ping`));try{const T=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{f(!0),T.close()},onclose(){f(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(T){_(T)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(_=>setTimeout(()=>_(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await JT();this.queueRunning=!1}handleNext(){const f=this.incomingMessageQueue.dequeue();if(!f)return!1;const _=Hx(f);if(_){const T=this.openSubs.get(_);if(!T)return;const M=F_(f,"id"),O=T.alreadyHaveEvent?.(M);if(T.receivedEvent?.(this,M),O)return}try{let T=JSON.parse(f);switch(T[0]){case"EVENT":{const M=this.openSubs.get(T[1]),O=T[2];this.verifyEvent(O)&&$T(M.filters,O)&&M.onevent(O),(!M.lastEmitted||M.lastEmitted<O.created_at)&&(M.lastEmitted=O.created_at);return}case"COUNT":{const M=T[1],O=T[2],j=this.openCountRequests.get(M);j&&(j.resolve(O.count),this.openCountRequests.delete(M));return}case"EOSE":{const M=this.openSubs.get(T[1]);if(!M)return;M.receivedEose();return}case"OK":{const M=T[1],O=T[2],j=T[3],D=this.openEventPublishes.get(M);D&&(clearTimeout(D.timeout),O?D.resolve(j):D.reject(new Error(j)),this.openEventPublishes.delete(M));return}case"CLOSED":{const M=T[1],O=this.openSubs.get(M);if(!O)return;O.closed=!0,O.close(T[2]);return}case"NOTICE":{this.onnotice(T[1]);return}case"AUTH":{this.challenge=T[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(T[1])?.oncustom?.(T);return}}}catch{return}}async send(f){if(!this.connectionPromise)throw new Xx(f,this.url);this.connectionPromise.then(()=>{this.ws?.send(f)})}async auth(f){const _=this.challenge;if(!_)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(T,M)=>{try{let O=await f($x(this.url,_)),j=setTimeout(()=>{let D=this.openEventPublishes.get(O.id);D&&(D.reject(new Error("auth timed out")),this.openEventPublishes.delete(O.id))},this.publishTimeout);this.openEventPublishes.set(O.id,{resolve:T,reject:M,timeout:j}),this.send('["AUTH",'+JSON.stringify(O)+"]")}catch(O){console.warn("subscribe auth function failed:",O)}}),this.authPromise)}async publish(f){const _=new Promise((T,M)=>{const O=setTimeout(()=>{const j=this.openEventPublishes.get(f.id);j&&(j.reject(new Error("publish timed out")),this.openEventPublishes.delete(f.id))},this.publishTimeout);this.openEventPublishes.set(f.id,{resolve:T,reject:M,timeout:O})});return this.send('["EVENT",'+JSON.stringify(f)+"]"),_}async count(f,_){this.serial++;const T=_?.id||"count:"+this.serial,M=new Promise((O,j)=>{this.openCountRequests.set(T,{resolve:O,reject:j})});return this.send('["COUNT","'+T+'",'+JSON.stringify(f).substring(1)),M}subscribe(f,_){const T=this.prepareSubscription(f,_);return T.fire(),T}prepareSubscription(f,_){this.serial++;const T=_.id||(_.label?_.label+":":"sub:")+this.serial,M=new tS(this,T,f,_);return this.openSubs.set(T,M),M}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(f){this.incomingMessageQueue.enqueue(f.data),this.queueRunning||this.runQueue()}},tS=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(f,_,T,M){if(T.length===0)throw new Error("subscription can't be created with zero filters");this.relay=f,this.filters=T,this.id=_,this.alreadyHaveEvent=M.alreadyHaveEvent,this.receivedEvent=M.receivedEvent,this.eoseTimeout=M.eoseTimeout||f.baseEoseTimeout,this.oneose=M.oneose,this.onclose=M.onclose,this.onevent=M.onevent||(O=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,O)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(f="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(_){if(!(_ instanceof Xx))throw _}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(f)}},iS;try{iS=WebSocket}catch{}var nS=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(f){this.verifyEvent=f.verifyEvent,this._WebSocket=f.websocketImplementation,this.enablePing=f.enablePing,this.enableReconnect=f.enableReconnect||!1,this.automaticallyAuth=f.automaticallyAuth}async ensureRelay(f,_){f=Pf(f);let T=this.relays.get(f);if(T||(T=new Yx(f,{verifyEvent:this.trustedRelayURLs.has(f)?eS:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),T.onclose=()=>{T&&!T.enableReconnect&&this.relays.delete(f)},_?.connectionTimeout&&(T.connectionTimeout=_.connectionTimeout),this.relays.set(f,T)),this.automaticallyAuth){const M=this.automaticallyAuth(f);M&&(T.onauth=M)}return await T.connect(),T}close(f){f.map(Pf).forEach(_=>{this.relays.get(_)?.close(),this.relays.delete(_)})}subscribe(f,_,T){const M=[];for(let O=0;O<f.length;O++){const j=Pf(f[O]);M.find(D=>D.url===j)||M.push({url:j,filter:_})}return this.subscribeMap(M,T)}subscribeMany(f,_,T){const M=[],O=[];for(let j=0;j<f.length;j++){const D=Pf(f[j]);O.indexOf(D)===-1&&(O.push(D),M.push({url:D,filter:_}))}return this.subscribeMap(M,T)}subscribeMap(f,_){const T=new Map;for(const De of f){const{url:Pe,filter:je}=De;T.has(Pe)||T.set(Pe,[]),T.get(Pe).push(je)}const M=Array.from(T.entries()).map(([De,Pe])=>({url:De,filters:Pe}));this.trackRelays&&(_.receivedEvent=(De,Pe)=>{let je=this.seenOn.get(Pe);je||(je=new Set,this.seenOn.set(Pe,je)),je.add(De)});const O=new Set,j=[],D=[];let u=De=>{D[De]||(D[De]=!0,D.filter(Pe=>Pe).length===M.length&&(_.oneose?.(),u=()=>{}))};const V=[];let te=(De,Pe)=>{V[De]||(u(De),V[De]=Pe,V.filter(je=>je).length===M.length&&(_.onclose?.(V),te=()=>{}))};const fe=De=>{if(_.alreadyHaveEvent?.(De))return!0;const Pe=O.has(De);return O.add(De),Pe},ue=Promise.all(M.map(async({url:De,filters:Pe},je)=>{let be;try{be=await this.ensureRelay(De,{connectionTimeout:_.maxWait?Math.max(_.maxWait*.8,_.maxWait-1e3):void 0})}catch(He){te(je,He?.message||String(He));return}let de=be.subscribe(Pe,{..._,oneose:()=>u(je),onclose:He=>{He.startsWith("auth-required: ")&&_.onauth?be.auth(_.onauth).then(()=>{be.subscribe(Pe,{..._,oneose:()=>u(je),onclose:ut=>{te(je,ut)},alreadyHaveEvent:fe,eoseTimeout:_.maxWait})}).catch(ut=>{te(je,`auth was required and attempted, but failed with: ${ut}`)}):te(je,He)},alreadyHaveEvent:fe,eoseTimeout:_.maxWait});j.push(de)}));return{async close(De){await ue,j.forEach(Pe=>{Pe.close(De)})}}}subscribeEose(f,_,T){const M=this.subscribe(f,_,{...T,oneose(){M.close("closed automatically on eose")}});return M}subscribeManyEose(f,_,T){const M=this.subscribeMany(f,_,{...T,oneose(){M.close("closed automatically on eose")}});return M}async querySync(f,_,T){return new Promise(async M=>{const O=[];this.subscribeEose(f,_,{...T,onevent(j){O.push(j)},onclose(j){M(O)}})})}async get(f,_,T){_.limit=1;const M=await this.querySync(f,_,T);return M.sort((O,j)=>j.created_at-O.created_at),M[0]||null}publish(f,_,T){return f.map(Pf).map(async(M,O,j)=>{if(j.indexOf(M)!==O)return Promise.reject("duplicate url");let D=await this.ensureRelay(M);return D.publish(_).catch(async u=>{if(u instanceof Error&&u.message.startsWith("auth-required: ")&&T?.onauth)return await D.auth(T.onauth),D.publish(_);throw u}).then(u=>{if(this.trackRelays){let V=this.seenOn.get(_.id);V||(V=new Set,this.seenOn.set(_.id,V)),V.add(D)}return u})})}listConnectionStatus(){const f=new Map;return this.relays.forEach((_,T)=>f.set(T,_.connected)),f}destroy(){this.relays.forEach(f=>f.close()),this.relays=new Map}},Wx;try{Wx=WebSocket}catch{}var rS=class extends nS{constructor(f){super({verifyEvent:N_,websocketImplementation:Wx,...f})}},Df={};Ar(Df,{BECH32_REGEX:()=>Kx,Bech32MaxSize:()=>g0,NostrTypeGuard:()=>aS,decode:()=>j_,decodeNostrURI:()=>oS,encodeBytes:()=>V_,naddrEncode:()=>fS,neventEncode:()=>dS,noteEncode:()=>uS,nprofileEncode:()=>hS,npubEncode:()=>cS,nsecEncode:()=>lS});var aS={isNProfile:f=>/^nprofile1[a-z\d]+$/.test(f||""),isNEvent:f=>/^nevent1[a-z\d]+$/.test(f||""),isNAddr:f=>/^naddr1[a-z\d]+$/.test(f||""),isNSec:f=>/^nsec1[a-z\d]{58}$/.test(f||""),isNPub:f=>/^npub1[a-z\d]{58}$/.test(f||""),isNote:f=>/^note1[a-z\d]+$/.test(f||""),isNcryptsec:f=>/^ncryptsec1[a-z\d]+$/.test(f||"")},g0=5e3,Kx=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function sS(f){const _=new Uint8Array(4);return _[0]=f>>24&255,_[1]=f>>16&255,_[2]=f>>8&255,_[3]=f&255,_}function oS(f){try{return f.startsWith("nostr:")&&(f=f.substring(6)),j_(f)}catch{return{type:"invalid",data:null}}}function j_(f){let{prefix:_,words:T}=qp.decode(f,g0),M=new Uint8Array(qp.fromWords(T));switch(_){case"nprofile":{let O=Ay(M);if(!O[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(O[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ra(O[0][0]),relays:O[1]?O[1].map(j=>Eh.decode(j)):[]}}}case"nevent":{let O=Ay(M);if(!O[0]?.[0])throw new Error("missing TLV 0 for nevent");if(O[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(O[2]&&O[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(O[3]&&O[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ra(O[0][0]),relays:O[1]?O[1].map(j=>Eh.decode(j)):[],author:O[2]?.[0]?Ra(O[2][0]):void 0,kind:O[3]?.[0]?parseInt(Ra(O[3][0]),16):void 0}}}case"naddr":{let O=Ay(M);if(!O[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!O[2]?.[0])throw new Error("missing TLV 2 for naddr");if(O[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!O[3]?.[0])throw new Error("missing TLV 3 for naddr");if(O[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Eh.decode(O[0][0]),pubkey:Ra(O[2][0]),kind:parseInt(Ra(O[3][0]),16),relays:O[1]?O[1].map(j=>Eh.decode(j)):[]}}}case"nsec":return{type:_,data:M};case"npub":case"note":return{type:_,data:Ra(M)};default:throw new Error(`unknown prefix ${_}`)}}function Ay(f){let _={},T=f;for(;T.length>0;){let M=T[0],O=T[1],j=T.slice(2,2+O);if(T=T.slice(2+O),j.length<O)throw new Error(`not enough data to read on TLV ${M}`);_[M]=_[M]||[],_[M].push(j)}return _}function lS(f){return V_("nsec",f)}function cS(f){return V_("npub",Lf(f))}function uS(f){return V_("note",Lf(f))}function U_(f,_){let T=qp.toWords(_);return qp.encode(f,T,g0)}function V_(f,_){return U_(f,_)}function hS(f){let _=_0({0:[Lf(f.pubkey)],1:(f.relays||[]).map(T=>Kc.encode(T))});return U_("nprofile",_)}function dS(f){let _;f.kind!==void 0&&(_=sS(f.kind));let T=_0({0:[Lf(f.id)],1:(f.relays||[]).map(M=>Kc.encode(M)),2:f.author?[Lf(f.author)]:[],3:_?[new Uint8Array(_)]:[]});return U_("nevent",T)}function fS(f){let _=new ArrayBuffer(4);new DataView(_).setUint32(0,f.kind,!1);let T=_0({0:[Kc.encode(f.identifier)],1:(f.relays||[]).map(M=>Kc.encode(M)),2:[Lf(f.pubkey)],3:[new Uint8Array(_)]});return U_("naddr",T)}function _0(f){let _=[];return Object.entries(f).reverse().forEach(([T,M])=>{M.forEach(O=>{let j=new Uint8Array(O.length+2);j.set([parseInt(T)],0),j.set([O.length],1),j.set(O,2),_.push(j)})}),k_(..._)}var pS={};Ar(pS,{decrypt:()=>mS,encrypt:()=>Qx});function Qx(f,_,T){const M=f instanceof Uint8Array?Ra(f):f,O=Hp.getSharedSecret(M,"02"+_),j=Jx(O);let D=Uint8Array.from(dx(16)),u=Kc.encode(T),V=Tx(j,D).encrypt(u),te=Mh.encode(new Uint8Array(V)),fe=Mh.encode(new Uint8Array(D.buffer));return`${te}?iv=${fe}`}function mS(f,_,T){const M=f instanceof Uint8Array?Ra(f):f;let[O,j]=T.split("?iv="),D=Hp.getSharedSecret(M,"02"+_),u=Jx(D),V=Mh.decode(j),te=Mh.decode(O),fe=Tx(u,V).decrypt(te);return Eh.decode(fe)}function Jx(f){return f.slice(1,33)}var gS={};Ar(gS,{NIP05_REGEX:()=>y0,isNip05:()=>_S,isValid:()=>xS,queryProfile:()=>eb,searchDomain:()=>vS,useFetchImplementation:()=>yS});var y0=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,_S=f=>y0.test(f||""),Z_;try{Z_=fetch}catch{}function yS(f){Z_=f}async function vS(f,_=""){try{const T=`https://${f}/.well-known/nostr.json?name=${_}`,M=await Z_(T,{redirect:"manual"});if(M.status!==200)throw Error("Wrong response code");return(await M.json()).names}catch{return{}}}async function eb(f){const _=f.match(y0);if(!_)return null;const[,T="_",M]=_;try{const O=`https://${M}/.well-known/nostr.json?name=${T}`,j=await Z_(O,{redirect:"manual"});if(j.status!==200)throw Error("Wrong response code");const D=await j.json(),u=D.names[T];return u?{pubkey:u,relays:D.relays?.[u]}:null}catch{return null}}async function xS(f,_){const T=await eb(_);return T?T.pubkey===f:!1}var bS={};Ar(bS,{parse:()=>wS});function wS(f){const _={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let T,M;for(let O=f.tags.length-1;O>=0;O--){const j=f.tags[O];if(j[0]==="e"&&j[1]){const[D,u,V,te,fe]=j,ue={id:u,relays:V?[V]:[],author:fe};if(te==="root"){_.root=ue;continue}if(te==="reply"){_.reply=ue;continue}if(te==="mention"){_.mentions.push(ue);continue}T?M=ue:T=ue,_.mentions.push(ue);continue}if(j[0]==="q"&&j[1]){const[D,u,V]=j;_.quotes.push({id:u,relays:V?[V]:[]})}if(j[0]==="p"&&j[1]){_.profiles.push({pubkey:j[1],relays:j[2]?[j[2]]:[]});continue}}return _.root||(_.root=M||T||_.reply),_.reply||(_.reply=T||_.root),[_.reply,_.root].forEach(O=>{if(!O)return;let j=_.mentions.indexOf(O);if(j!==-1&&_.mentions.splice(j,1),O.author){let D=_.profiles.find(u=>u.pubkey===O.author);D&&D.relays&&(O.relays||(O.relays=[]),D.relays.forEach(u=>{O.relays?.indexOf(u)===-1&&O.relays.push(u)}),D.relays=O.relays)}}),_.mentions.forEach(O=>{if(O.author){let j=_.profiles.find(D=>D.pubkey===O.author);j&&j.relays&&(O.relays||(O.relays=[]),j.relays.forEach(D=>{O.relays.indexOf(D)===-1&&O.relays.push(D)}),j.relays=O.relays)}}),_}var TS={};Ar(TS,{fetchRelayInformation:()=>ES,useFetchImplementation:()=>SS});var tb;try{tb=fetch}catch{}function SS(f){tb=f}async function ES(f){return await(await fetch(f.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var MS={};Ar(MS,{fastEventHash:()=>nb,getPow:()=>ib,minePow:()=>AS});function ib(f){let _=0;for(let T=0;T<64;T+=8){const M=parseInt(f.substring(T,T+8),16);if(M===0)_+=32;else{_+=Math.clz32(M);break}}return _}function AS(f,_){let T=0;const M=f,O=["nonce",T.toString(),_.toString()];for(M.tags.push(O);;){const j=Math.floor(new Date().getTime()/1e3);if(j!==M.created_at&&(T=0,M.created_at=j),O[1]=(++T).toString(),M.id=nb(M),ib(M.id)>=_)break}return M}function nb(f){return Ra(Ed(Kc.encode(JSON.stringify([0,f.pubkey,f.created_at,f.kind,f.tags,f.content]))))}var CS={};Ar(CS,{unwrapEvent:()=>FS,unwrapManyEvents:()=>jS,wrapEvent:()=>gb,wrapManyEvents:()=>NS});var PS={};Ar(PS,{createRumor:()=>db,createSeal:()=>fb,createWrap:()=>pb,unwrapEvent:()=>T0,unwrapManyEvents:()=>mb,wrapEvent:()=>E_,wrapManyEvents:()=>OS});var sg={};Ar(sg,{decrypt:()=>w0,encrypt:()=>b0,getConversationKey:()=>v0,v2:()=>kS});var rb=1,ab=65535;function v0(f,_){const T=Hp.getSharedSecret(f,"02"+_).subarray(1,33);return h2(Ed,T,"nip44-v2")}function sb(f,_){const T=d2(Ed,f,_,76);return{chacha_key:T.subarray(0,32),chacha_nonce:T.subarray(32,44),hmac_key:T.subarray(44,76)}}function x0(f){if(!Number.isSafeInteger(f)||f<1)throw new Error("expected positive integer");if(f<=32)return 32;const _=1<<Math.floor(Math.log2(f-1))+1,T=_<=256?32:_/8;return T*(Math.floor((f-1)/T)+1)}function zS(f){if(!Number.isSafeInteger(f)||f<rb||f>ab)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const _=new Uint8Array(2);return new DataView(_.buffer).setUint16(0,f,!1),_}function DS(f){const _=Kc.encode(f),T=_.length,M=zS(T),O=new Uint8Array(x0(T)-T);return k_(M,_,O)}function IS(f){const _=new DataView(f.buffer).getUint16(0),T=f.subarray(2,2+_);if(_<rb||_>ab||T.length!==_||f.length!==2+x0(_))throw new Error("invalid padding");return Eh.decode(T)}function ob(f,_,T){if(T.length!==32)throw new Error("AAD associated data must be 32 bytes");const M=k_(T,_);return O_(Ed,f,M)}function LS(f){if(typeof f!="string")throw new Error("payload must be a valid string");const _=f.length;if(_<132||_>87472)throw new Error("invalid payload length: "+_);if(f[0]==="#")throw new Error("unknown encryption version");let T;try{T=Mh.decode(f)}catch(j){throw new Error("invalid base64: "+j.message)}const M=T.length;if(M<99||M>65603)throw new Error("invalid data length: "+M);const O=T[0];if(O!==2)throw new Error("unknown encryption version "+O);return{nonce:T.subarray(1,33),ciphertext:T.subarray(33,-32),mac:T.subarray(-32)}}function b0(f,_,T=dx(32)){const{chacha_key:M,chacha_nonce:O,hmac_key:j}=sb(_,T),D=DS(f),u=Ax(M,O,D),V=ob(j,u,T);return Mh.encode(k_(new Uint8Array([2]),T,u,V))}function w0(f,_){const{nonce:T,ciphertext:M,mac:O}=LS(f),{chacha_key:j,chacha_nonce:D,hmac_key:u}=sb(_,T),V=ob(u,M,T);if(!Hw(V,O))throw new Error("invalid MAC");const te=Ax(j,D,M);return IS(te)}var kS={utils:{getConversationKey:v0,calcPaddedLen:x0},encrypt:b0,decrypt:w0},RS=2880*60,lb=()=>Math.round(Date.now()/1e3),cb=()=>Math.round(lb()-Math.random()*RS),ub=(f,_)=>v0(f,_),hb=(f,_,T)=>b0(JSON.stringify(f),ub(_,T)),wv=(f,_)=>JSON.parse(w0(f.content,ub(_,f.pubkey)));function db(f,_){const T={created_at:lb(),content:"",tags:[],...f,pubkey:ag(_)};return T.id=m_(T),T}function fb(f,_,T){return cc({kind:Rx,content:hb(f,_,T),created_at:cb(),tags:[]},_)}function pb(f,_){const T=Dx();return cc({kind:Vx,content:hb(f,T,_),created_at:cb(),tags:[["p",_]]},T)}function E_(f,_,T){const M=db(f,_),O=fb(M,_,T);return pb(O,T)}function OS(f,_,T){if(!T||T.length===0)throw new Error("At least one recipient is required.");const M=ag(_),O=[E_(f,_,M)];return T.forEach(j=>{O.push(E_(f,_,j))}),O}function T0(f,_){const T=wv(f,_);return wv(T,_)}function mb(f,_){let T=[];return f.forEach(M=>{T.push(T0(M,_))}),T.sort((M,O)=>M.created_at-O.created_at),T}function BS(f,_,T,M){const O={created_at:Math.ceil(Date.now()/1e3),kind:Ox,tags:[],content:_};return(Array.isArray(f)?f:[f]).forEach(({publicKey:D,relayUrl:u})=>{O.tags.push(u?["p",D,u]:["p",D])}),M&&O.tags.push(["e",M.eventId,M.relayUrl||"","reply"]),T&&O.tags.push(["subject",T]),O}function gb(f,_,T,M,O){const j=BS(_,T,M,O);return E_(j,f,_.publicKey)}function NS(f,_,T,M,O){if(!_||_.length===0)throw new Error("At least one recipient is required.");return[{publicKey:ag(f)},..._].map(D=>gb(f,D,T,M,O))}var FS=T0,jS=mb,US={};Ar(US,{finishRepostEvent:()=>VS,getRepostedEvent:()=>ZS,getRepostedEventPointer:()=>_b});function VS(f,_,T,M){let O;const j=[...f.tags??[],["e",_.id,T],["p",_.pubkey]];return _.kind===kx?O=d0:(O=p0,j.push(["k",String(_.kind)])),cc({kind:O,tags:j,content:f.content===""||_.tags?.find(D=>D[0]==="-")?"":JSON.stringify(_),created_at:f.created_at},M)}function _b(f){if(![d0,p0].includes(f.kind))return;let _,T;for(let M=f.tags.length-1;M>=0&&(_===void 0||T===void 0);M--){const O=f.tags[M];O.length>=2&&(O[0]==="e"&&_===void 0?_=O:O[0]==="p"&&T===void 0&&(T=O))}if(_!==void 0)return{id:_[1],relays:[_[2],T?.[2]].filter(M=>typeof M=="string"),author:T?.[1]}}function ZS(f,{skipVerification:_}={}){const T=_b(f);if(T===void 0||f.content==="")return;let M;try{M=JSON.parse(f.content)}catch{return}if(M.id===T.id&&!(!_&&!N_(M)))return M}var qS={};Ar(qS,{NOSTR_URI_REGEX:()=>S0,parse:()=>HS,test:()=>GS});var S0=new RegExp(`nostr:(${Kx.source})`);function GS(f){return typeof f=="string"&&new RegExp(`^${S0.source}$`).test(f)}function HS(f){const _=f.match(new RegExp(`^${S0.source}$`));if(!_)throw new Error(`Invalid Nostr URI: ${f}`);return{uri:_[0],value:_[1],decoded:j_(_[1])}}var $S={};Ar($S,{finishReactionEvent:()=>XS,getReactedEventPointer:()=>YS});function XS(f,_,T){const M=_.tags.filter(O=>O.length>=2&&(O[0]==="e"||O[0]==="p"));return cc({...f,kind:f0,tags:[...f.tags??[],...M,["e",_.id],["p",_.pubkey]],content:f.content??"+"},T)}function YS(f){if(f.kind!==f0)return;let _,T;for(let M=f.tags.length-1;M>=0&&(_===void 0||T===void 0);M--){const O=f.tags[M];O.length>=2&&(O[0]==="e"&&_===void 0?_=O:O[0]==="p"&&T===void 0&&(T=O))}if(!(_===void 0||T===void 0))return{id:_[1],relays:[_[2],T[2]].filter(M=>M!==void 0),author:T[1]}}var WS={};Ar(WS,{parse:()=>QS});var Tv=/\W/m,Sv=/[^\w\/] |[^\w\/]$|$|,| /m,KS=42;function*QS(f){let _=[];if(typeof f!="string"){for(let j=0;j<f.tags.length;j++){const D=f.tags[j];D[0]==="emoji"&&D.length>=3&&_.push({type:"emoji",shortcode:D[1],url:D[2]})}f=f.content}const T=f.length;let M=0,O=0;e:for(;O<T;){const j=f.indexOf(":",O),D=f.indexOf("#",O);if(j===-1&&D===-1)break e;if(j===-1||D>=0&&D<j){if(D===0||f[D-1]===" "){const u=f.slice(D+1,D+KS).match(Tv),V=u?D+1+u.index:T;yield{type:"text",text:f.slice(M,D)},yield{type:"hashtag",value:f.slice(D+1,V)},O=V,M=O;continue e}O=D+1;continue e}if(f.slice(j-5,j)==="nostr"){const u=f.slice(j+60).match(Tv),V=u?j+60+u.index:T;try{let te,{data:fe,type:ue}=j_(f.slice(j+1,V));switch(ue){case"npub":te={pubkey:fe};break;case"note":te={id:fe};break;case"nsec":O=V+1;continue;default:te=fe}M!==j-5&&(yield{type:"text",text:f.slice(M,j-5)}),yield{type:"reference",pointer:te},O=V,M=O;continue e}catch{O=j+1;continue e}}else if(f.slice(j-5,j)==="https"||f.slice(j-4,j)==="http"){const u=f.slice(j+4).match(Sv),V=u?j+4+u.index:T,te=f[j-1]==="s"?5:4;try{let fe=new URL(f.slice(j-te,V));if(fe.hostname.indexOf(".")===-1)throw new Error("invalid url");if(M!==j-te&&(yield{type:"text",text:f.slice(M,j-te)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(fe.pathname)){yield{type:"image",url:fe.toString()},O=V,M=O;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(fe.pathname)){yield{type:"video",url:fe.toString()},O=V,M=O;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(fe.pathname)){yield{type:"audio",url:fe.toString()},O=V,M=O;continue e}yield{type:"url",url:fe.toString()},O=V,M=O;continue e}catch{O=V+1;continue e}}else if(f.slice(j-3,j)==="wss"||f.slice(j-2,j)==="ws"){const u=f.slice(j+4).match(Sv),V=u?j+4+u.index:T,te=f[j-1]==="s"?3:2;try{let fe=new URL(f.slice(j-te,V));if(fe.hostname.indexOf(".")===-1)throw new Error("invalid ws url");M!==j-te&&(yield{type:"text",text:f.slice(M,j-te)}),yield{type:"relay",url:fe.toString()},O=V,M=O;continue e}catch{O=V+1;continue e}}else{for(let u=0;u<_.length;u++){const V=_[u];if(f[j+V.shortcode.length+1]===":"&&f.slice(j+1,j+V.shortcode.length+1)===V.shortcode){M!==j&&(yield{type:"text",text:f.slice(M,j)}),yield V,O=j+V.shortcode.length+2,M=O;continue e}}O=j+1;continue e}}M!==T&&(yield{type:"text",text:f.slice(M)})}var JS={};Ar(JS,{channelCreateEvent:()=>eE,channelHideMessageEvent:()=>nE,channelMessageEvent:()=>iE,channelMetadataEvent:()=>tE,channelMuteUserEvent:()=>rE});var eE=(f,_)=>{let T;if(typeof f.content=="object")T=JSON.stringify(f.content);else if(typeof f.content=="string")T=f.content;else return;return cc({kind:Bx,tags:[...f.tags??[]],content:T,created_at:f.created_at},_)},tE=(f,_)=>{let T;if(typeof f.content=="object")T=JSON.stringify(f.content);else if(typeof f.content=="string")T=f.content;else return;return cc({kind:Nx,tags:[["e",f.channel_create_event_id],...f.tags??[]],content:T,created_at:f.created_at},_)},iE=(f,_)=>{const T=[["e",f.channel_create_event_id,f.relay_url,"root"]];return f.reply_to_channel_message_event_id&&T.push(["e",f.reply_to_channel_message_event_id,f.relay_url,"reply"]),cc({kind:Fx,tags:[...T,...f.tags??[]],content:f.content,created_at:f.created_at},_)},nE=(f,_)=>{let T;if(typeof f.content=="object")T=JSON.stringify(f.content);else if(typeof f.content=="string")T=f.content;else return;return cc({kind:jx,tags:[["e",f.channel_message_event_id],...f.tags??[]],content:T,created_at:f.created_at},_)},rE=(f,_)=>{let T;if(typeof f.content=="object")T=JSON.stringify(f.content);else if(typeof f.content=="string")T=f.content;else return;return cc({kind:Ux,tags:[["p",f.pubkey_to_mute],...f.tags??[]],content:T,created_at:f.created_at},_)},aE={};Ar(aE,{EMOJI_SHORTCODE_REGEX:()=>yb,matchAll:()=>sE,regex:()=>E0,replaceAll:()=>oE});var yb=/:(\w+):/,E0=()=>new RegExp(`\\B${yb.source}\\B`,"g");function*sE(f){const _=f.matchAll(E0());for(const T of _)try{const[M,O]=T;yield{shortcode:M,name:O,start:T.index,end:T.index+M.length}}catch{}}function oE(f,_){return f.replaceAll(E0(),(T,M)=>_({shortcode:T,name:M}))}var lE={};Ar(lE,{useFetchImplementation:()=>cE,validateGithub:()=>uE});var M0;try{M0=fetch}catch{}function cE(f){M0=f}async function uE(f,_,T){try{return await(await M0(`https://gist.github.com/${_}/${T}/raw`)).text()===`Verifying that I control the following Nostr public key: ${f}`}catch{return!1}}var hE={};Ar(hE,{makeNwcRequestEvent:()=>fE,parseConnectionString:()=>dE});function dE(f){const{host:_,pathname:T,searchParams:M}=new URL(f),O=T||_,j=M.get("relay"),D=M.get("secret");if(!O||!j||!D)throw new Error("invalid connection string");return{pubkey:O,relay:j,secret:D}}async function fE(f,_,T){const O=Qx(_,f,JSON.stringify({method:"pay_invoice",params:{invoice:T}})),j={kind:qx,created_at:Math.round(Date.now()/1e3),content:O,tags:[["p",f]]};return cc(j,_)}var pE={};Ar(pE,{normalizeIdentifier:()=>mE});function mE(f){return f=f.trim().toLowerCase(),f=f.normalize("NFKC"),Array.from(f).map(_=>new RegExp("\\p{Letter}","u").test(_)||new RegExp("\\p{Number}","u").test(_)?_:"-").join("")}var gE={};Ar(gE,{getSatoshisAmountFromBolt11:()=>wE,getZapEndpoint:()=>yE,makeZapReceipt:()=>bE,makeZapRequest:()=>vE,useFetchImplementation:()=>_E,validateZapRequest:()=>xE});var A0;try{A0=fetch}catch{}function _E(f){A0=f}async function yE(f){try{let _="",{lud06:T,lud16:M}=JSON.parse(f.content);if(M){let[D,u]=M.split("@");_=new URL(`/.well-known/lnurlp/${D}`,`https://${u}`).toString()}else if(T){let{words:D}=qp.decode(T,1e3),u=qp.fromWords(D);_=Eh.decode(u)}else return null;let j=await(await A0(_)).json();if(j.allowsNostr&&j.nostrPubkey)return j.callback}catch{}return null}function vE(f){let _={kind:9734,created_at:Math.round(Date.now()/1e3),content:f.comment||"",tags:[["p","pubkey"in f?f.pubkey:f.event.pubkey],["amount",f.amount.toString()],["relays",...f.relays]]};if("event"in f){if(_.tags.push(["e",f.event.id]),u0(f.event.kind)){const T=["a",`${f.event.kind}:${f.event.pubkey}:`];_.tags.push(T)}else if(h0(f.event.kind)){let T=f.event.tags.find(([O,j])=>O==="d"&&j);if(!T)throw new Error("d tag not found or is empty");const M=["a",`${f.event.kind}:${f.event.pubkey}:${T[1]}`];_.tags.push(M)}_.tags.push(["k",f.event.kind.toString()])}return _}function xE(f){let _;try{_=JSON.parse(f)}catch{return"Invalid zap request JSON."}if(!l0(_))return"Zap request is not a valid Nostr event.";if(!N_(_))return"Invalid signature on zap request.";let T=_.tags.find(([j,D])=>j==="p"&&D);if(!T)return"Zap request doesn't have a 'p' tag.";if(!T[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let M=_.tags.find(([j,D])=>j==="e"&&D);return M&&!M[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":_.tags.find(([j,D])=>j==="relays"&&D)?null:"Zap request doesn't have a 'relays' tag."}function bE({zapRequest:f,preimage:_,bolt11:T,paidAt:M}){let O=JSON.parse(f),j=O.tags.filter(([u])=>u==="e"||u==="p"||u==="a"),D={kind:9735,created_at:Math.round(M.getTime()/1e3),content:"",tags:[...j,["P",O.pubkey],["bolt11",T],["description",f]]};return _&&D.tags.push(["preimage",_]),D}function wE(f){if(f.length<50)return 0;f=f.substring(0,50);const _=f.lastIndexOf("1");if(_===-1)return 0;const T=f.substring(0,_);if(!T.startsWith("lnbc"))return 0;const M=T.substring(4);if(M.length<1)return 0;const O=M[M.length-1],j=O.charCodeAt(0)-48,D=j>=0&&j<=9;let u=M.length-1;if(D&&u++,u<1)return 0;const V=parseInt(M.substring(0,u));switch(O){case"m":return V*1e5;case"u":return V*100;case"n":return V/10;case"p":return V/1e4;default:return V*1e8}}var TE={};Ar(TE,{Negentropy:()=>xb,NegentropyStorageVector:()=>ME,NegentropySync:()=>AE});var Cy=97,jp=32,vb=16,Ef={Skip:0,Fingerprint:1,IdList:2},Sh=class{_raw;length;constructor(f){typeof f=="number"?(this._raw=new Uint8Array(f),this.length=0):f instanceof Uint8Array?(this._raw=new Uint8Array(f),this.length=f.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(f){if(f instanceof Sh&&(f=f.unwrap()),typeof f.length!="number")throw Error("bad length");const _=f.length+this.length;if(this.capacity<_){const T=this._raw,M=Math.max(this.capacity*2,_);this._raw=new Uint8Array(M),this._raw.set(T)}this._raw.set(f,this.length),this.length+=f.length}shift(){const f=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,f}shiftN(f=1){const _=this._raw.subarray(0,f);return this._raw=this._raw.subarray(f),this.length-=f,_}};function f_(f){let _=0;for(;;){if(f.length===0)throw Error("parse ends prematurely");let T=f.shift();if(_=_<<7|T&127,(T&128)===0)break}return _}function wh(f){if(f===0)return new Sh(new Uint8Array([0]));let _=[];for(;f!==0;)_.push(f&127),f>>>=7;_.reverse();for(let T=0;T<_.length-1;T++)_[T]|=128;return new Sh(new Uint8Array(_))}function SE(f){return g_(f,1)[0]}function g_(f,_){if(f.length<_)throw Error("parse ends prematurely");return f.shiftN(_)}var EE=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(jp)}add(f){let _=0,T=0,M=new DataView(this.buf.buffer),O=new DataView(f.buffer);for(let j=0;j<8;j++){let D=j*4,u=M.getUint32(D,!0),V=O.getUint32(D,!0),te=u;te+=_,te+=V,te>4294967295&&(T=1),M.setUint32(D,te&4294967295,!0),_=T,T=0}}negate(){let f=new DataView(this.buf.buffer);for(let T=0;T<8;T++){let M=T*4;f.setUint32(M,~f.getUint32(M,!0))}let _=new Uint8Array(jp);_[0]=1,this.add(_)}getFingerprint(f){let _=new Sh;return _.extend(this.buf),_.extend(wh(f)),Ed(_.unwrap()).subarray(0,vb)}},ME=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(f,_){if(this.sealed)throw Error("already sealed");const T=yx(_);if(T.byteLength!==jp)throw Error("bad id size for added item");this.items.push({timestamp:f,id:T})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(Py);for(let f=1;f<this.items.length;f++)if(Py(this.items[f-1],this.items[f])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(f){if(this._checkSealed(),f>=this.items.length)throw Error("out of range");return this.items[f]}iterate(f,_,T){this._checkSealed(),this._checkBounds(f,_);for(let M=f;M<_&&T(this.items[M],M);++M);}findLowerBound(f,_,T){return this._checkSealed(),this._checkBounds(f,_),this._binarySearch(this.items,f,_,M=>Py(M,T)<0)}fingerprint(f,_){let T=new EE;return T.setToZero(),this.iterate(f,_,M=>(T.add(M.id),!0)),T.getFingerprint(_-f)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(f,_){if(f>_||_>this.items.length)throw Error("bad range")}_binarySearch(f,_,T,M){let O=T-_;for(;O>0;){let j=_,D=Math.floor(O/2);j+=D,M(f[j])?(_=++j,O-=D+1):O=D}return _}},xb=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(f,_=6e4){if(_<4096)throw Error("frameSizeLimit too small");this.storage=f,this.frameSizeLimit=_,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(f,_){return{timestamp:f,id:_||new Uint8Array(0)}}initiate(){let f=new Sh;return f.extend(new Uint8Array([Cy])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),f),Np(f.unwrap())}reconcile(f,_,T){const M=new Sh(yx(f));this.lastTimestampIn=this.lastTimestampOut=0;let O=new Sh;O.extend(new Uint8Array([Cy]));let j=SE(M);if(j<96||j>111)throw Error("invalid negentropy protocol version byte");if(j!==Cy)throw Error("unsupported negentropy protocol version requested: "+(j-96));let D=this.storage.size(),u=this._bound(0),V=0,te=!1;for(;M.length!==0;){let fe=new Sh,ue=()=>{te&&(te=!1,fe.extend(this.encodeBound(u)),fe.extend(wh(Ef.Skip)))},De=this.decodeBound(M),Pe=f_(M),je=V,be=this.storage.findLowerBound(V,D,De);if(Pe===Ef.Skip)te=!0;else if(Pe===Ef.Fingerprint){let de=g_(M,vb),He=this.storage.fingerprint(je,be);bb(de,He)!==0?(ue(),this.splitRange(je,be,De,fe)):te=!0}else if(Pe===Ef.IdList){let de=f_(M),He={};for(let ut=0;ut<de;ut++){let Fe=g_(M,jp);He[Np(Fe)]=Fe}if(te=!0,this.storage.iterate(je,be,ut=>{let Fe=ut.id;const Ut=Np(Fe);return He[Ut]?delete He[Np(Fe)]:_?.(Ut),!0}),T)for(let ut of Object.values(He))T(Np(ut))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(O.length+fe.length)){let de=this.storage.fingerprint(be,D);O.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),O.extend(wh(Ef.Fingerprint)),O.extend(de);break}else O.extend(fe);V=be,u=De}return O.length===1?null:Np(O.unwrap())}splitRange(f,_,T,M){let O=_-f,j=16;if(O<j*2)M.extend(this.encodeBound(T)),M.extend(wh(Ef.IdList)),M.extend(wh(O)),this.storage.iterate(f,_,D=>(M.extend(D.id),!0));else{let D=Math.floor(O/j),u=O%j,V=f;for(let te=0;te<j;te++){let fe=D+(te<u?1:0),ue=this.storage.fingerprint(V,V+fe);V+=fe;let De;if(V===_)De=T;else{let Pe,je;this.storage.iterate(V-1,V+1,(be,de)=>(de===V-1?Pe=be:je=be,!0)),De=this.getMinimalBound(Pe,je)}M.extend(this.encodeBound(De)),M.extend(wh(Ef.Fingerprint)),M.extend(ue)}}}exceededFrameSizeLimit(f){return f>this.frameSizeLimit-200}decodeTimestampIn(f){let _=f_(f);return _=_===0?Number.MAX_VALUE:_-1,this.lastTimestampIn===Number.MAX_VALUE||_===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(_+=this.lastTimestampIn,this.lastTimestampIn=_,_)}decodeBound(f){let _=this.decodeTimestampIn(f),T=f_(f);if(T>jp)throw Error("bound key too long");let M=g_(f,T);return{timestamp:_,id:M}}encodeTimestampOut(f){if(f===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,wh(0);let _=f;return f-=this.lastTimestampOut,this.lastTimestampOut=_,wh(f+1)}encodeBound(f){let _=new Sh;return _.extend(this.encodeTimestampOut(f.timestamp)),_.extend(wh(f.id.length)),_.extend(f.id),_}getMinimalBound(f,_){if(_.timestamp!==f.timestamp)return this._bound(_.timestamp);{let T=0,M=_.id,O=f.id;for(let j=0;j<jp&&M[j]===O[j];j++)T++;return this._bound(_.timestamp,_.id.subarray(0,T+1))}}};function bb(f,_){for(let T=0;T<f.byteLength;T++){if(f[T]<_[T])return-1;if(f[T]>_[T])return 1}return f.byteLength>_.byteLength?1:f.byteLength<_.byteLength?-1:0}function Py(f,_){return f.timestamp===_.timestamp?bb(f.id,_.id):f.timestamp-_.timestamp}var AE=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(f,_,T,M={}){this.relay=f,this.storage=_,this.neg=new xb(_),this.onhave=M.onhave,this.onneed=M.onneed,this.filter=T,this.subscription=this.relay.prepareSubscription([{}],{label:M.label||"negentropy"}),this.subscription.oncustom=O=>{switch(O[0]){case"NEG-MSG":{O.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${O}`);try{const j=this.neg.reconcile(O[2],this.onhave,this.onneed);j?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${j}"]`):(this.close(),M.onclose?.())}catch(j){console.error("negentropy reconcile error:",j),M?.onclose?.(`reconcile error: ${j}`)}break}case"NEG-CLOSE":{const j=O[2];console.warn("negentropy error:",j),M.onclose?.(j);break}case"NEG-ERR":M.onclose?.()}}}async start(){const f=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${f}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},CE={};Ar(CE,{getToken:()=>PE,hashPayload:()=>C0,unpackEventFromToken:()=>Tb,validateEvent:()=>Pb,validateEventKind:()=>Eb,validateEventMethodTag:()=>Ab,validateEventPayloadTag:()=>Cb,validateEventTimestamp:()=>Sb,validateEventUrlTag:()=>Mb,validateToken:()=>zE});var wb="Nostr ";async function PE(f,_,T,M=!1,O){const j={kind:m0,tags:[["u",f],["method",_]],created_at:Math.round(new Date().getTime()/1e3),content:""};O&&j.tags.push(["payload",C0(O)]);const D=await T(j);return(M?wb:"")+Mh.encode(Kc.encode(JSON.stringify(D)))}async function zE(f,_,T){const M=await Tb(f).catch(j=>{throw j});return await Pb(M,_,T).catch(j=>{throw j})}async function Tb(f){if(!f)throw new Error("Missing token");f=f.replace(wb,"");const _=Eh.decode(Mh.decode(f));if(!_||_.length===0||!_.startsWith("{"))throw new Error("Invalid token");return JSON.parse(_)}function Sb(f){return f.created_at?Math.round(new Date().getTime()/1e3)-f.created_at<60:!1}function Eb(f){return f.kind===m0}function Mb(f,_){const T=f.tags.find(M=>M[0]==="u");return T?T.length>0&&T[1]===_:!1}function Ab(f,_){const T=f.tags.find(M=>M[0]==="method");return T?T.length>0&&T[1].toLowerCase()===_.toLowerCase():!1}function C0(f){const _=Ed(Kc.encode(JSON.stringify(f)));return Ra(_)}function Cb(f,_){const T=f.tags.find(O=>O[0]==="payload");if(!T)return!1;const M=C0(_);return T.length>0&&T[1]===M}async function Pb(f,_,T,M){if(!N_(f))throw new Error("Invalid nostr event, signature invalid");if(!Eb(f))throw new Error("Invalid nostr event, kind invalid");if(!Sb(f))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Mb(f,_))throw new Error("Invalid nostr event, url tag invalid");if(!Ab(f,T))throw new Error("Invalid nostr event, method tag invalid");if(M&&typeof M=="object"&&Object.keys(M).length>0&&!Cb(f,M))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Ev=f=>Array.from(f).map(_=>_.toString(16).padStart(2,"0")).join(""),zb=ht.createContext(null),DE=({children:f})=>{const[_,T]=ht.useState(localStorage.getItem("parlens_pubkey")),[M]=ht.useState(()=>new rS({enablePing:!0,enableReconnect:!0})),O=async(u,V,te)=>{let fe="",ue=null;if(u==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");fe=await window.nostr.getPublicKey()}else if(u==="nsec"&&V)try{const De=Df.decode(V);if(De.type!=="nsec")throw new Error("Not an nsec");ue=De.data,fe=ag(ue),localStorage.setItem("parlens_privkey",Ev(ue))}catch{throw new Error("Invalid nsec format")}else u==="create"&&(ue=Dx(),fe=ag(ue),localStorage.setItem("parlens_privkey",Ev(ue)));if(T(fe),localStorage.setItem("parlens_pubkey",fe),u==="create"&&te&&ue)try{const De=cc({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:te,display_name:te,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${fe}`})},ue);await Promise.any([M.publish(["wss://relay.damus.io","wss://nos.lol"],De)])}catch(De){console.warn("Failed to publish metadata:",De)}},j=()=>{T(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},D=async u=>{const V=localStorage.getItem("parlens_privkey");if(V){const te=new Uint8Array(V.match(/.{1,2}/g).map(fe=>parseInt(fe,16)));return cc(u,te)}if(window.nostr)return await window.nostr.signEvent(u);throw new Error("No signing method available")};return ne.jsx(zb.Provider,{value:{pubkey:_,login:O,logout:j,pool:M,signEvent:D},children:f})},Xp=()=>{const f=ht.useContext(zb);if(!f)throw new Error("useAuth must be used within AuthProvider");return f};const IE=f=>f.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),LE=f=>f.replace(/^([A-Z])|[\s-_]+(\w)/g,(_,T,M)=>M?M.toUpperCase():T.toLowerCase()),Mv=f=>{const _=LE(f);return _.charAt(0).toUpperCase()+_.slice(1)},Db=(...f)=>f.filter((_,T,M)=>!!_&&_.trim()!==""&&M.indexOf(_)===T).join(" ").trim(),kE=f=>{for(const _ in f)if(_.startsWith("aria-")||_==="role"||_==="title")return!0};var RE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const OE=ht.forwardRef(({color:f="currentColor",size:_=24,strokeWidth:T=2,absoluteStrokeWidth:M,className:O="",children:j,iconNode:D,...u},V)=>ht.createElement("svg",{ref:V,...RE,width:_,height:_,stroke:f,strokeWidth:M?Number(T)*24/Number(_):T,className:Db("lucide",O),...!j&&!kE(u)&&{"aria-hidden":"true"},...u},[...D.map(([te,fe])=>ht.createElement(te,fe)),...Array.isArray(j)?j:[j]]));const Cr=(f,_)=>{const T=ht.forwardRef(({className:M,...O},j)=>ht.createElement(OE,{ref:j,iconNode:_,className:Db(`lucide-${IE(Mv(f))}`,`lucide-${f}`,M),...O}));return T.displayName=Mv(f),T};const BE=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],NE=Cr("arrow-right",BE);const FE=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],jE=Cr("check",FE);const UE=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],og=Cr("chevron-down",UE);const VE=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],M_=Cr("chevron-right",VE);const ZE=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],qE=Cr("chevron-up",ZE);const GE=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Av=Cr("circle-question-mark",GE);const HE=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ib=Cr("clock",HE);const $E=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],XE=Cr("compass",$E);const YE=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],WE=Cr("eye-off",YE);const KE=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],QE=Cr("eye",KE);const JE=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],eM=Cr("folder-open",JE);const tM=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Zy=Cr("key",tM);const iM=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],lg=Cr("map-pin",iM);const nM=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],rM=Cr("map-pinned",nM);const aM=[["polygon",{points:"12 2 19 21 12 17 5 21 12 2",key:"x8c0qg"}]],sM=Cr("navigation-2",aM);const oM=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],lM=Cr("navigation",oM);const cM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],uM=Cr("pencil",cM);const hM=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],dM=Cr("route",hM);const fM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],pM=Cr("save",fM);const mM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],gM=Cr("search",mM);const _M=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Lb=Cr("shield",_M);const yM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],qy=Cr("trash-2",yM);const vM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],xM=Cr("user-plus",vM);const bM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],wM=Cr("user",bM);const TM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],P0=Cr("x",TM);function SM(f,_){const T=ht.useRef(_);ht.useEffect(function(){_!==T.current&&f.attributionControl!=null&&(T.current!=null&&f.attributionControl.removeAttribution(T.current),_!=null&&f.attributionControl.addAttribution(_)),T.current=_},[f,_])}qv();const EM=1;function MM(f){return Object.freeze({__version:EM,map:f})}function kb(f,_){return Object.freeze({...f,..._})}const z0=ht.createContext(null);function D0(){const f=ht.use(z0);if(f==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return f}function Rb(f){function _(T,M){const{instance:O,context:j}=f(T).current;ht.useImperativeHandle(M,()=>O);const{children:D}=T;return D==null?null:Up.createElement(z0,{value:j},D)}return ht.forwardRef(_)}function Ob(f,_){const T=ht.useRef(void 0);ht.useEffect(function(){return _!=null&&f.instance.on(_),T.current=_,function(){T.current!=null&&f.instance.off(T.current),T.current=null}},[f,_])}function Bb(f,_){const T=f.pane??_.pane;return T?{...f,pane:T}:f}var ig={exports:{}};var AM=ig.exports,Cv;function Nb(){return Cv||(Cv=1,(function(f,_){(function(T,M){M(_)})(AM,(function(T){var M="1.9.4";function O(l){var v,A,B,H;for(A=1,B=arguments.length;A<B;A++){H=arguments[A];for(v in H)l[v]=H[v]}return l}var j=Object.create||(function(){function l(){}return function(v){return l.prototype=v,new l}})();function D(l,v){var A=Array.prototype.slice;if(l.bind)return l.bind.apply(l,A.call(arguments,1));var B=A.call(arguments,2);return function(){return l.apply(v,B.length?B.concat(A.call(arguments)):arguments)}}var u=0;function V(l){return"_leaflet_id"in l||(l._leaflet_id=++u),l._leaflet_id}function te(l,v,A){var B,H,ae,Ae;return Ae=function(){B=!1,H&&(ae.apply(A,H),H=!1)},ae=function(){B?H=arguments:(l.apply(A,arguments),setTimeout(Ae,v),B=!0)},ae}function fe(l,v,A){var B=v[1],H=v[0],ae=B-H;return l===B&&A?l:((l-H)%ae+ae)%ae+H}function ue(){return!1}function De(l,v){if(v===!1)return l;var A=Math.pow(10,v===void 0?6:v);return Math.round(l*A)/A}function Pe(l){return l.trim?l.trim():l.replace(/^\s+|\s+$/g,"")}function je(l){return Pe(l).split(/\s+/)}function be(l,v){Object.prototype.hasOwnProperty.call(l,"options")||(l.options=l.options?j(l.options):{});for(var A in v)l.options[A]=v[A];return l.options}function de(l,v,A){var B=[];for(var H in l)B.push(encodeURIComponent(A?H.toUpperCase():H)+"="+encodeURIComponent(l[H]));return(!v||v.indexOf("?")===-1?"?":"&")+B.join("&")}var He=/\{ *([\w_ -]+) *\}/g;function ut(l,v){return l.replace(He,function(A,B){var H=v[B];if(H===void 0)throw new Error("No value provided for variable "+A);return typeof H=="function"&&(H=H(v)),H})}var Fe=Array.isArray||function(l){return Object.prototype.toString.call(l)==="[object Array]"};function Ut(l,v){for(var A=0;A<l.length;A++)if(l[A]===v)return A;return-1}var Rt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function dt(l){return window["webkit"+l]||window["moz"+l]||window["ms"+l]}var rt=0;function Ct(l){var v=+new Date,A=Math.max(0,16-(v-rt));return rt=v+A,window.setTimeout(l,A)}var jt=window.requestAnimationFrame||dt("RequestAnimationFrame")||Ct,Ht=window.cancelAnimationFrame||dt("CancelAnimationFrame")||dt("CancelRequestAnimationFrame")||function(l){window.clearTimeout(l)};function Ot(l,v,A){if(A&&jt===Ct)l.call(v);else return jt.call(window,D(l,v))}function Yt(l){l&&Ht.call(window,l)}var si={__proto__:null,extend:O,create:j,bind:D,get lastId(){return u},stamp:V,throttle:te,wrapNum:fe,falseFn:ue,formatNum:De,trim:Pe,splitWords:je,setOptions:be,getParamString:de,template:ut,isArray:Fe,indexOf:Ut,emptyImageUrl:Rt,requestFn:jt,cancelFn:Ht,requestAnimFrame:Ot,cancelAnimFrame:Yt};function oi(){}oi.extend=function(l){var v=function(){be(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},A=v.__super__=this.prototype,B=j(A);B.constructor=v,v.prototype=B;for(var H in this)Object.prototype.hasOwnProperty.call(this,H)&&H!=="prototype"&&H!=="__super__"&&(v[H]=this[H]);return l.statics&&O(v,l.statics),l.includes&&(wt(l.includes),O.apply(null,[B].concat(l.includes))),O(B,l),delete B.statics,delete B.includes,B.options&&(B.options=A.options?j(A.options):{},O(B.options,l.options)),B._initHooks=[],B.callInitHooks=function(){if(!this._initHooksCalled){A.callInitHooks&&A.callInitHooks.call(this),this._initHooksCalled=!0;for(var ae=0,Ae=B._initHooks.length;ae<Ae;ae++)B._initHooks[ae].call(this)}},v},oi.include=function(l){var v=this.prototype.options;return O(this.prototype,l),l.options&&(this.prototype.options=v,this.mergeOptions(l.options)),this},oi.mergeOptions=function(l){return O(this.prototype.options,l),this},oi.addInitHook=function(l){var v=Array.prototype.slice.call(arguments,1),A=typeof l=="function"?l:function(){this[l].apply(this,v)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(A),this};function wt(l){if(!(typeof L>"u"||!L||!L.Mixin)){l=Fe(l)?l:[l];for(var v=0;v<l.length;v++)l[v]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var ze={on:function(l,v,A){if(typeof l=="object")for(var B in l)this._on(B,l[B],v);else{l=je(l);for(var H=0,ae=l.length;H<ae;H++)this._on(l[H],v,A)}return this},off:function(l,v,A){if(!arguments.length)delete this._events;else if(typeof l=="object")for(var B in l)this._off(B,l[B],v);else{l=je(l);for(var H=arguments.length===1,ae=0,Ae=l.length;ae<Ae;ae++)H?this._off(l[ae]):this._off(l[ae],v,A)}return this},_on:function(l,v,A,B){if(typeof v!="function"){console.warn("wrong listener type: "+typeof v);return}if(this._listens(l,v,A)===!1){A===this&&(A=void 0);var H={fn:v,ctx:A};B&&(H.once=!0),this._events=this._events||{},this._events[l]=this._events[l]||[],this._events[l].push(H)}},_off:function(l,v,A){var B,H,ae;if(this._events&&(B=this._events[l],!!B)){if(arguments.length===1){if(this._firingCount)for(H=0,ae=B.length;H<ae;H++)B[H].fn=ue;delete this._events[l];return}if(typeof v!="function"){console.warn("wrong listener type: "+typeof v);return}var Ae=this._listens(l,v,A);if(Ae!==!1){var Ve=B[Ae];this._firingCount&&(Ve.fn=ue,this._events[l]=B=B.slice()),B.splice(Ae,1)}}},fire:function(l,v,A){if(!this.listens(l,A))return this;var B=O({},v,{type:l,target:this,sourceTarget:v&&v.sourceTarget||this});if(this._events){var H=this._events[l];if(H){this._firingCount=this._firingCount+1||1;for(var ae=0,Ae=H.length;ae<Ae;ae++){var Ve=H[ae],at=Ve.fn;Ve.once&&this.off(l,at,Ve.ctx),at.call(Ve.ctx||this,B)}this._firingCount--}}return A&&this._propagateEvent(B),this},listens:function(l,v,A,B){typeof l!="string"&&console.warn('"string" type argument expected');var H=v;typeof v!="function"&&(B=!!v,H=void 0,A=void 0);var ae=this._events&&this._events[l];if(ae&&ae.length&&this._listens(l,H,A)!==!1)return!0;if(B){for(var Ae in this._eventParents)if(this._eventParents[Ae].listens(l,v,A,B))return!0}return!1},_listens:function(l,v,A){if(!this._events)return!1;var B=this._events[l]||[];if(!v)return!!B.length;A===this&&(A=void 0);for(var H=0,ae=B.length;H<ae;H++)if(B[H].fn===v&&B[H].ctx===A)return H;return!1},once:function(l,v,A){if(typeof l=="object")for(var B in l)this._on(B,l[B],v,!0);else{l=je(l);for(var H=0,ae=l.length;H<ae;H++)this._on(l[H],v,A,!0)}return this},addEventParent:function(l){return this._eventParents=this._eventParents||{},this._eventParents[V(l)]=l,this},removeEventParent:function(l){return this._eventParents&&delete this._eventParents[V(l)],this},_propagateEvent:function(l){for(var v in this._eventParents)this._eventParents[v].fire(l.type,O({layer:l.target,propagatedFrom:l.target},l),!0)}};ze.addEventListener=ze.on,ze.removeEventListener=ze.clearAllEventListeners=ze.off,ze.addOneTimeEventListener=ze.once,ze.fireEvent=ze.fire,ze.hasEventListeners=ze.listens;var Je=oi.extend(ze);function st(l,v,A){this.x=A?Math.round(l):l,this.y=A?Math.round(v):v}var Et=Math.trunc||function(l){return l>0?Math.floor(l):Math.ceil(l)};st.prototype={clone:function(){return new st(this.x,this.y)},add:function(l){return this.clone()._add(lt(l))},_add:function(l){return this.x+=l.x,this.y+=l.y,this},subtract:function(l){return this.clone()._subtract(lt(l))},_subtract:function(l){return this.x-=l.x,this.y-=l.y,this},divideBy:function(l){return this.clone()._divideBy(l)},_divideBy:function(l){return this.x/=l,this.y/=l,this},multiplyBy:function(l){return this.clone()._multiplyBy(l)},_multiplyBy:function(l){return this.x*=l,this.y*=l,this},scaleBy:function(l){return new st(this.x*l.x,this.y*l.y)},unscaleBy:function(l){return new st(this.x/l.x,this.y/l.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Et(this.x),this.y=Et(this.y),this},distanceTo:function(l){l=lt(l);var v=l.x-this.x,A=l.y-this.y;return Math.sqrt(v*v+A*A)},equals:function(l){return l=lt(l),l.x===this.x&&l.y===this.y},contains:function(l){return l=lt(l),Math.abs(l.x)<=Math.abs(this.x)&&Math.abs(l.y)<=Math.abs(this.y)},toString:function(){return"Point("+De(this.x)+", "+De(this.y)+")"}};function lt(l,v,A){return l instanceof st?l:Fe(l)?new st(l[0],l[1]):l==null?l:typeof l=="object"&&"x"in l&&"y"in l?new st(l.x,l.y):new st(l,v,A)}function _e(l,v){if(l)for(var A=v?[l,v]:l,B=0,H=A.length;B<H;B++)this.extend(A[B])}_e.prototype={extend:function(l){var v,A;if(!l)return this;if(l instanceof st||typeof l[0]=="number"||"x"in l)v=A=lt(l);else if(l=Ue(l),v=l.min,A=l.max,!v||!A)return this;return!this.min&&!this.max?(this.min=v.clone(),this.max=A.clone()):(this.min.x=Math.min(v.x,this.min.x),this.max.x=Math.max(A.x,this.max.x),this.min.y=Math.min(v.y,this.min.y),this.max.y=Math.max(A.y,this.max.y)),this},getCenter:function(l){return lt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,l)},getBottomLeft:function(){return lt(this.min.x,this.max.y)},getTopRight:function(){return lt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(l){var v,A;return typeof l[0]=="number"||l instanceof st?l=lt(l):l=Ue(l),l instanceof _e?(v=l.min,A=l.max):v=A=l,v.x>=this.min.x&&A.x<=this.max.x&&v.y>=this.min.y&&A.y<=this.max.y},intersects:function(l){l=Ue(l);var v=this.min,A=this.max,B=l.min,H=l.max,ae=H.x>=v.x&&B.x<=A.x,Ae=H.y>=v.y&&B.y<=A.y;return ae&&Ae},overlaps:function(l){l=Ue(l);var v=this.min,A=this.max,B=l.min,H=l.max,ae=H.x>v.x&&B.x<A.x,Ae=H.y>v.y&&B.y<A.y;return ae&&Ae},isValid:function(){return!!(this.min&&this.max)},pad:function(l){var v=this.min,A=this.max,B=Math.abs(v.x-A.x)*l,H=Math.abs(v.y-A.y)*l;return Ue(lt(v.x-B,v.y-H),lt(A.x+B,A.y+H))},equals:function(l){return l?(l=Ue(l),this.min.equals(l.getTopLeft())&&this.max.equals(l.getBottomRight())):!1}};function Ue(l,v){return!l||l instanceof _e?l:new _e(l,v)}function yt(l,v){if(l)for(var A=v?[l,v]:l,B=0,H=A.length;B<H;B++)this.extend(A[B])}yt.prototype={extend:function(l){var v=this._southWest,A=this._northEast,B,H;if(l instanceof Dt)B=l,H=l;else if(l instanceof yt){if(B=l._southWest,H=l._northEast,!B||!H)return this}else return l?this.extend(Lt(l)||Pt(l)):this;return!v&&!A?(this._southWest=new Dt(B.lat,B.lng),this._northEast=new Dt(H.lat,H.lng)):(v.lat=Math.min(B.lat,v.lat),v.lng=Math.min(B.lng,v.lng),A.lat=Math.max(H.lat,A.lat),A.lng=Math.max(H.lng,A.lng)),this},pad:function(l){var v=this._southWest,A=this._northEast,B=Math.abs(v.lat-A.lat)*l,H=Math.abs(v.lng-A.lng)*l;return new yt(new Dt(v.lat-B,v.lng-H),new Dt(A.lat+B,A.lng+H))},getCenter:function(){return new Dt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Dt(this.getNorth(),this.getWest())},getSouthEast:function(){return new Dt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(l){typeof l[0]=="number"||l instanceof Dt||"lat"in l?l=Lt(l):l=Pt(l);var v=this._southWest,A=this._northEast,B,H;return l instanceof yt?(B=l.getSouthWest(),H=l.getNorthEast()):B=H=l,B.lat>=v.lat&&H.lat<=A.lat&&B.lng>=v.lng&&H.lng<=A.lng},intersects:function(l){l=Pt(l);var v=this._southWest,A=this._northEast,B=l.getSouthWest(),H=l.getNorthEast(),ae=H.lat>=v.lat&&B.lat<=A.lat,Ae=H.lng>=v.lng&&B.lng<=A.lng;return ae&&Ae},overlaps:function(l){l=Pt(l);var v=this._southWest,A=this._northEast,B=l.getSouthWest(),H=l.getNorthEast(),ae=H.lat>v.lat&&B.lat<A.lat,Ae=H.lng>v.lng&&B.lng<A.lng;return ae&&Ae},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(l,v){return l?(l=Pt(l),this._southWest.equals(l.getSouthWest(),v)&&this._northEast.equals(l.getNorthEast(),v)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Pt(l,v){return l instanceof yt?l:new yt(l,v)}function Dt(l,v,A){if(isNaN(l)||isNaN(v))throw new Error("Invalid LatLng object: ("+l+", "+v+")");this.lat=+l,this.lng=+v,A!==void 0&&(this.alt=+A)}Dt.prototype={equals:function(l,v){if(!l)return!1;l=Lt(l);var A=Math.max(Math.abs(this.lat-l.lat),Math.abs(this.lng-l.lng));return A<=(v===void 0?1e-9:v)},toString:function(l){return"LatLng("+De(this.lat,l)+", "+De(this.lng,l)+")"},distanceTo:function(l){return ui.distance(this,Lt(l))},wrap:function(){return ui.wrapLatLng(this)},toBounds:function(l){var v=180*l/40075017,A=v/Math.cos(Math.PI/180*this.lat);return Pt([this.lat-v,this.lng-A],[this.lat+v,this.lng+A])},clone:function(){return new Dt(this.lat,this.lng,this.alt)}};function Lt(l,v,A){return l instanceof Dt?l:Fe(l)&&typeof l[0]!="object"?l.length===3?new Dt(l[0],l[1],l[2]):l.length===2?new Dt(l[0],l[1]):null:l==null?l:typeof l=="object"&&"lat"in l?new Dt(l.lat,"lng"in l?l.lng:l.lon,l.alt):v===void 0?null:new Dt(l,v,A)}var Kt={latLngToPoint:function(l,v){var A=this.projection.project(l),B=this.scale(v);return this.transformation._transform(A,B)},pointToLatLng:function(l,v){var A=this.scale(v),B=this.transformation.untransform(l,A);return this.projection.unproject(B)},project:function(l){return this.projection.project(l)},unproject:function(l){return this.projection.unproject(l)},scale:function(l){return 256*Math.pow(2,l)},zoom:function(l){return Math.log(l/256)/Math.LN2},getProjectedBounds:function(l){if(this.infinite)return null;var v=this.projection.bounds,A=this.scale(l),B=this.transformation.transform(v.min,A),H=this.transformation.transform(v.max,A);return new _e(B,H)},infinite:!1,wrapLatLng:function(l){var v=this.wrapLng?fe(l.lng,this.wrapLng,!0):l.lng,A=this.wrapLat?fe(l.lat,this.wrapLat,!0):l.lat,B=l.alt;return new Dt(A,v,B)},wrapLatLngBounds:function(l){var v=l.getCenter(),A=this.wrapLatLng(v),B=v.lat-A.lat,H=v.lng-A.lng;if(B===0&&H===0)return l;var ae=l.getSouthWest(),Ae=l.getNorthEast(),Ve=new Dt(ae.lat-B,ae.lng-H),at=new Dt(Ae.lat-B,Ae.lng-H);return new yt(Ve,at)}},ui=O({},Kt,{wrapLng:[-180,180],R:6371e3,distance:function(l,v){var A=Math.PI/180,B=l.lat*A,H=v.lat*A,ae=Math.sin((v.lat-l.lat)*A/2),Ae=Math.sin((v.lng-l.lng)*A/2),Ve=ae*ae+Math.cos(B)*Math.cos(H)*Ae*Ae,at=2*Math.atan2(Math.sqrt(Ve),Math.sqrt(1-Ve));return this.R*at}}),Ai=6378137,mn={R:Ai,MAX_LATITUDE:85.0511287798,project:function(l){var v=Math.PI/180,A=this.MAX_LATITUDE,B=Math.max(Math.min(A,l.lat),-A),H=Math.sin(B*v);return new st(this.R*l.lng*v,this.R*Math.log((1+H)/(1-H))/2)},unproject:function(l){var v=180/Math.PI;return new Dt((2*Math.atan(Math.exp(l.y/this.R))-Math.PI/2)*v,l.x*v/this.R)},bounds:(function(){var l=Ai*Math.PI;return new _e([-l,-l],[l,l])})()};function vr(l,v,A,B){if(Fe(l)){this._a=l[0],this._b=l[1],this._c=l[2],this._d=l[3];return}this._a=l,this._b=v,this._c=A,this._d=B}vr.prototype={transform:function(l,v){return this._transform(l.clone(),v)},_transform:function(l,v){return v=v||1,l.x=v*(this._a*l.x+this._b),l.y=v*(this._c*l.y+this._d),l},untransform:function(l,v){return v=v||1,new st((l.x/v-this._b)/this._a,(l.y/v-this._d)/this._c)}};function tn(l,v,A,B){return new vr(l,v,A,B)}var ar=O({},ui,{code:"EPSG:3857",projection:mn,transformation:(function(){var l=.5/(Math.PI*mn.R);return tn(l,.5,-l,.5)})()}),Gi=O({},ar,{code:"EPSG:900913"});function Fn(l){return document.createElementNS("http://www.w3.org/2000/svg",l)}function Jn(l,v){var A="",B,H,ae,Ae,Ve,at;for(B=0,ae=l.length;B<ae;B++){for(Ve=l[B],H=0,Ae=Ve.length;H<Ae;H++)at=Ve[H],A+=(H?"L":"M")+at.x+" "+at.y;A+=v?Qe.svg?"z":"x":""}return A||"M0 0"}var ln=document.documentElement.style,Lr="ActiveXObject"in window,pa=Lr&&!document.addEventListener,Jt="msLaunchUri"in navigator&&!("documentMode"in document),li=qr("webkit"),fi=qr("android"),Ci=qr("android 2")||qr("android 3"),Ei=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),cn=fi&&qr("Google")&&Ei<537&&!("AudioNode"in window),Re=!!window.opera,Q=!Jt&&qr("chrome"),ee=qr("gecko")&&!li&&!Re&&!Lr,se=!Q&&qr("safari"),ge=qr("phantom"),we="OTransition"in ln,Ze=navigator.platform.indexOf("Win")===0,Ne=Lr&&"transition"in ln,Ie="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ci,qe="MozPerspective"in ln,gt=!window.L_DISABLE_3D&&(Ne||Ie||qe)&&!we&&!ge,ft=typeof orientation<"u"||qr("mobile"),Ft=ft&&li,ei=ft&&Ie,hi=!window.PointerEvent&&window.MSPointerEvent,Vi=!!(window.PointerEvent||hi),Di="ontouchstart"in window||!!window.TouchEvent,$e=!window.L_NO_TOUCH&&(Di||Vi),Wi=ft&&Re,er=ft&&ee,pi=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ki=(function(){var l=!1;try{var v=Object.defineProperty({},"passive",{get:function(){l=!0}});window.addEventListener("testPassiveEventSupport",ue,v),window.removeEventListener("testPassiveEventSupport",ue,v)}catch{}return l})(),un=(function(){return!!document.createElement("canvas").getContext})(),ji=!!(document.createElementNS&&Fn("svg").createSVGRect),Ln=!!ji&&(function(){var l=document.createElement("div");return l.innerHTML="<svg/>",(l.firstChild&&l.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),sn=!ji&&(function(){try{var l=document.createElement("div");l.innerHTML='<v:shape adj="1"/>';var v=l.firstChild;return v.style.behavior="url(#default#VML)",v&&typeof v.adj=="object"}catch{return!1}})(),sr=navigator.platform.indexOf("Mac")===0,Ol=navigator.platform.indexOf("Linux")===0;function qr(l){return navigator.userAgent.toLowerCase().indexOf(l)>=0}var Qe={ie:Lr,ielt9:pa,edge:Jt,webkit:li,android:fi,android23:Ci,androidStock:cn,opera:Re,chrome:Q,gecko:ee,safari:se,phantom:ge,opera12:we,win:Ze,ie3d:Ne,webkit3d:Ie,gecko3d:qe,any3d:gt,mobile:ft,mobileWebkit:Ft,mobileWebkit3d:ei,msPointer:hi,pointer:Vi,touch:$e,touchNative:Di,mobileOpera:Wi,mobileGecko:er,retina:pi,passiveEvents:Ki,canvas:un,svg:ji,vml:sn,inlineSvg:Ln,mac:sr,linux:Ol},kr=Qe.msPointer?"MSPointerDown":"pointerdown",Rr=Qe.msPointer?"MSPointerMove":"pointermove",Za=Qe.msPointer?"MSPointerUp":"pointerup",gn=Qe.msPointer?"MSPointerCancel":"pointercancel",It={touchstart:kr,touchmove:Rr,touchend:Za,touchcancel:gn},yi={touchstart:As,touchmove:Oa,touchend:Oa,touchcancel:Oa},gi={},ma=!1;function Qc(l,v,A){return v==="touchstart"&&Qs(),yi[v]?(A=yi[v].bind(this,A),l.addEventListener(It[v],A,!1),A):(console.warn("wrong event specified:",v),ue)}function Ms(l,v,A){if(!It[v]){console.warn("wrong event specified:",v);return}l.removeEventListener(It[v],A,!1)}function vi(l){gi[l.pointerId]=l}function il(l){gi[l.pointerId]&&(gi[l.pointerId]=l)}function rs(l){delete gi[l.pointerId]}function Qs(){ma||(document.addEventListener(kr,vi,!0),document.addEventListener(Rr,il,!0),document.addEventListener(Za,rs,!0),document.addEventListener(gn,rs,!0),ma=!0)}function Oa(l,v){if(v.pointerType!==(v.MSPOINTER_TYPE_MOUSE||"mouse")){v.touches=[];for(var A in gi)v.touches.push(gi[A]);v.changedTouches=[v],l(v)}}function As(l,v){v.MSPOINTER_TYPE_TOUCH&&v.pointerType===v.MSPOINTER_TYPE_TOUCH&&Pi(v),Oa(l,v)}function Gn(l){var v={},A,B;for(B in l)A=l[B],v[B]=A&&A.bind?A.bind(l):A;return l=v,v.type="dblclick",v.detail=2,v.isTrusted=!1,v._simulated=!0,v}var Bl=200;function Gr(l,v){l.addEventListener("dblclick",v);var A=0,B;function H(ae){if(ae.detail!==1){B=ae.detail;return}if(!(ae.pointerType==="mouse"||ae.sourceCapabilities&&!ae.sourceCapabilities.firesTouchEvents)){var Ae=xa(ae);if(!(Ae.some(function(at){return at instanceof HTMLLabelElement&&at.attributes.for})&&!Ae.some(function(at){return at instanceof HTMLInputElement||at instanceof HTMLSelectElement}))){var Ve=Date.now();Ve-A<=Bl?(B++,B===2&&v(Gn(ae))):B=1,A=Ve}}}return l.addEventListener("click",H),{dblclick:v,simDblclick:H}}function Zi(l,v){l.removeEventListener("dblclick",v.dblclick),l.removeEventListener("click",v.simDblclick)}var as=al(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Cs=al(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),nl=Cs==="webkitTransition"||Cs==="OTransition"?Cs+"End":"transitionend";function Js(l){return typeof l=="string"?document.getElementById(l):l}function ia(l,v){var A=l.style[v]||l.currentStyle&&l.currentStyle[v];if((!A||A==="auto")&&document.defaultView){var B=document.defaultView.getComputedStyle(l,null);A=B?B[v]:null}return A==="auto"?null:A}function qi(l,v,A){var B=document.createElement(l);return B.className=v||"",A&&A.appendChild(B),B}function nn(l){var v=l.parentNode;v&&v.removeChild(l)}function na(l){for(;l.firstChild;)l.removeChild(l.firstChild)}function Ri(l){var v=l.parentNode;v&&v.lastChild!==l&&v.appendChild(l)}function Mo(l){var v=l.parentNode;v&&v.firstChild!==l&&v.insertBefore(l,v.firstChild)}function Jc(l,v){if(l.classList!==void 0)return l.classList.contains(v);var A=uc(l);return A.length>0&&new RegExp("(^|\\s)"+v+"(\\s|$)").test(A)}function Si(l,v){if(l.classList!==void 0)for(var A=je(v),B=0,H=A.length;B<H;B++)l.classList.add(A[B]);else if(!Jc(l,v)){var ae=uc(l);rl(l,(ae?ae+" ":"")+v)}}function Hn(l,v){l.classList!==void 0?l.classList.remove(v):rl(l,Pe((" "+uc(l)+" ").replace(" "+v+" "," ")))}function rl(l,v){l.className.baseVal===void 0?l.className=v:l.className.baseVal=v}function uc(l){return l.correspondingElement&&(l=l.correspondingElement),l.className.baseVal===void 0?l.className:l.className.baseVal}function Pn(l,v){"opacity"in l.style?l.style.opacity=v:"filter"in l.style&&hc(l,v)}function hc(l,v){var A=!1,B="DXImageTransform.Microsoft.Alpha";try{A=l.filters.item(B)}catch{if(v===1)return}v=Math.round(v*100),A?(A.Enabled=v!==100,A.Opacity=v):l.style.filter+=" progid:"+B+"(opacity="+v+")"}function al(l){for(var v=document.documentElement.style,A=0;A<l.length;A++)if(l[A]in v)return l[A];return!1}function ss(l,v,A){var B=v||new st(0,0);l.style[as]=(Qe.ie3d?"translate("+B.x+"px,"+B.y+"px)":"translate3d("+B.x+"px,"+B.y+"px,0)")+(A?" scale("+A+")":"")}function Sn(l,v){l._leaflet_pos=v,Qe.any3d?ss(l,v):(l.style.left=v.x+"px",l.style.top=v.y+"px")}function Ao(l){return l._leaflet_pos||new st(0,0)}var Ps,Ba,eu;if("onselectstart"in document)Ps=function(){ii(window,"selectstart",Pi)},Ba=function(){$t(window,"selectstart",Pi)};else{var os=al(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ps=function(){if(os){var l=document.documentElement.style;eu=l[os],l[os]="none"}},Ba=function(){os&&(document.documentElement.style[os]=eu,eu=void 0)}}function Nl(){ii(window,"dragstart",Pi)}function eo(){$t(window,"dragstart",Pi)}var ls,Co;function bi(l){for(;l.tabIndex===-1;)l=l.parentNode;l.style&&(ga(),ls=l,Co=l.style.outlineStyle,l.style.outlineStyle="none",ii(window,"keydown",ga))}function ga(){ls&&(ls.style.outlineStyle=Co,ls=void 0,Co=void 0,$t(window,"keydown",ga))}function tu(l){do l=l.parentNode;while((!l.offsetWidth||!l.offsetHeight)&&l!==document.body);return l}function sl(l){var v=l.getBoundingClientRect();return{x:v.width/l.offsetWidth||1,y:v.height/l.offsetHeight||1,boundingClientRect:v}}var xr={__proto__:null,TRANSFORM:as,TRANSITION:Cs,TRANSITION_END:nl,get:Js,getStyle:ia,create:qi,remove:nn,empty:na,toFront:Ri,toBack:Mo,hasClass:Jc,addClass:Si,removeClass:Hn,setClass:rl,getClass:uc,setOpacity:Pn,testProp:al,setTransform:ss,setPosition:Sn,getPosition:Ao,get disableTextSelection(){return Ps},get enableTextSelection(){return Ba},disableImageDrag:Nl,enableImageDrag:eo,preventOutline:bi,restoreOutline:ga,getSizedParentNode:tu,getScale:sl};function ii(l,v,A,B){if(v&&typeof v=="object")for(var H in v)kn(l,H,v[H],A);else{v=je(v);for(var ae=0,Ae=v.length;ae<Ae;ae++)kn(l,v[ae],A,B)}return this}var Hi="_leaflet_events";function $t(l,v,A,B){if(arguments.length===1)hn(l),delete l[Hi];else if(v&&typeof v=="object")for(var H in v)Or(l,H,v[H],A);else if(v=je(v),arguments.length===2)hn(l,function(Ve){return Ut(v,Ve)!==-1});else for(var ae=0,Ae=v.length;ae<Ae;ae++)Or(l,v[ae],A,B);return this}function hn(l,v){for(var A in l[Hi]){var B=A.split(/\d/)[0];(!v||v(B))&&Or(l,B,null,null,A)}}var _a={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function kn(l,v,A,B){var H=v+V(A)+(B?"_"+V(B):"");if(l[Hi]&&l[Hi][H])return this;var ae=function(Ve){return A.call(B||l,Ve||window.event)},Ae=ae;!Qe.touchNative&&Qe.pointer&&v.indexOf("touch")===0?ae=Qc(l,v,ae):Qe.touch&&v==="dblclick"?ae=Gr(l,ae):"addEventListener"in l?v==="touchstart"||v==="touchmove"||v==="wheel"||v==="mousewheel"?l.addEventListener(_a[v]||v,ae,Qe.passiveEvents?{passive:!1}:!1):v==="mouseenter"||v==="mouseleave"?(ae=function(Ve){Ve=Ve||window.event,Br(l,Ve)&&Ae(Ve)},l.addEventListener(_a[v],ae,!1)):l.addEventListener(v,Ae,!1):l.attachEvent("on"+v,ae),l[Hi]=l[Hi]||{},l[Hi][H]=ae}function Or(l,v,A,B,H){H=H||v+V(A)+(B?"_"+V(B):"");var ae=l[Hi]&&l[Hi][H];if(!ae)return this;!Qe.touchNative&&Qe.pointer&&v.indexOf("touch")===0?Ms(l,v,ae):Qe.touch&&v==="dblclick"?Zi(l,ae):"removeEventListener"in l?l.removeEventListener(_a[v]||v,ae,!1):l.detachEvent("on"+v,ae),l[Hi][H]=null}function Rn(l){return l.stopPropagation?l.stopPropagation():l.originalEvent?l.originalEvent._stopped=!0:l.cancelBubble=!0,this}function ra(l){return kn(l,"wheel",Rn),this}function ya(l){return ii(l,"mousedown touchstart dblclick contextmenu",Rn),l._leaflet_disable_click=!0,this}function Pi(l){return l.preventDefault?l.preventDefault():l.returnValue=!1,this}function va(l){return Pi(l),Rn(l),this}function xa(l){if(l.composedPath)return l.composedPath();for(var v=[],A=l.target;A;)v.push(A),A=A.parentNode;return v}function Po(l,v){if(!v)return new st(l.clientX,l.clientY);var A=sl(v),B=A.boundingClientRect;return new st((l.clientX-B.left)/A.x-v.clientLeft,(l.clientY-B.top)/A.y-v.clientTop)}var aa=Qe.linux&&Qe.chrome?window.devicePixelRatio:Qe.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function or(l){return Qe.edge?l.wheelDeltaY/2:l.deltaY&&l.deltaMode===0?-l.deltaY/aa:l.deltaY&&l.deltaMode===1?-l.deltaY*20:l.deltaY&&l.deltaMode===2?-l.deltaY*60:l.deltaX||l.deltaZ?0:l.wheelDelta?(l.wheelDeltaY||l.wheelDelta)/2:l.detail&&Math.abs(l.detail)<32765?-l.detail*20:l.detail?l.detail/-32765*60:0}function Br(l,v){var A=v.relatedTarget;if(!A)return!0;try{for(;A&&A!==l;)A=A.parentNode}catch{return!1}return A!==l}var dc={__proto__:null,on:ii,off:$t,stopPropagation:Rn,disableScrollPropagation:ra,disableClickPropagation:ya,preventDefault:Pi,stop:va,getPropagationPath:xa,getMousePosition:Po,getWheelDelta:or,isExternalTarget:Br,addListener:ii,removeListener:$t},zo=Je.extend({run:function(l,v,A,B){this.stop(),this._el=l,this._inProgress=!0,this._duration=A||.25,this._easeOutPower=1/Math.max(B||.5,.2),this._startPos=Ao(l),this._offset=v.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Ot(this._animate,this),this._step()},_step:function(l){var v=+new Date-this._startTime,A=this._duration*1e3;v<A?this._runFrame(this._easeOut(v/A),l):(this._runFrame(1),this._complete())},_runFrame:function(l,v){var A=this._startPos.add(this._offset.multiplyBy(l));v&&A._round(),Sn(this._el,A),this.fire("step")},_complete:function(){Yt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(l){return 1-Math.pow(1-l,this._easeOutPower)}}),Ii=Je.extend({options:{crs:ar,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(l,v){v=be(this,v),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(l),this._initLayout(),this._onResize=D(this._onResize,this),this._initEvents(),v.maxBounds&&this.setMaxBounds(v.maxBounds),v.zoom!==void 0&&(this._zoom=this._limitZoom(v.zoom)),v.center&&v.zoom!==void 0&&this.setView(Lt(v.center),v.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Cs&&Qe.any3d&&!Qe.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ii(this._proxy,nl,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(l,v,A){if(v=v===void 0?this._zoom:this._limitZoom(v),l=this._limitCenter(Lt(l),v,this.options.maxBounds),A=A||{},this._stop(),this._loaded&&!A.reset&&A!==!0){A.animate!==void 0&&(A.zoom=O({animate:A.animate},A.zoom),A.pan=O({animate:A.animate,duration:A.duration},A.pan));var B=this._zoom!==v?this._tryAnimatedZoom&&this._tryAnimatedZoom(l,v,A.zoom):this._tryAnimatedPan(l,A.pan);if(B)return clearTimeout(this._sizeTimer),this}return this._resetView(l,v,A.pan&&A.pan.noMoveStart),this},setZoom:function(l,v){return this._loaded?this.setView(this.getCenter(),l,{zoom:v}):(this._zoom=l,this)},zoomIn:function(l,v){return l=l||(Qe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+l,v)},zoomOut:function(l,v){return l=l||(Qe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-l,v)},setZoomAround:function(l,v,A){var B=this.getZoomScale(v),H=this.getSize().divideBy(2),ae=l instanceof st?l:this.latLngToContainerPoint(l),Ae=ae.subtract(H).multiplyBy(1-1/B),Ve=this.containerPointToLatLng(H.add(Ae));return this.setView(Ve,v,{zoom:A})},_getBoundsCenterZoom:function(l,v){v=v||{},l=l.getBounds?l.getBounds():Pt(l);var A=lt(v.paddingTopLeft||v.padding||[0,0]),B=lt(v.paddingBottomRight||v.padding||[0,0]),H=this.getBoundsZoom(l,!1,A.add(B));if(H=typeof v.maxZoom=="number"?Math.min(v.maxZoom,H):H,H===1/0)return{center:l.getCenter(),zoom:H};var ae=B.subtract(A).divideBy(2),Ae=this.project(l.getSouthWest(),H),Ve=this.project(l.getNorthEast(),H),at=this.unproject(Ae.add(Ve).divideBy(2).add(ae),H);return{center:at,zoom:H}},fitBounds:function(l,v){if(l=Pt(l),!l.isValid())throw new Error("Bounds are not valid.");var A=this._getBoundsCenterZoom(l,v);return this.setView(A.center,A.zoom,v)},fitWorld:function(l){return this.fitBounds([[-90,-180],[90,180]],l)},panTo:function(l,v){return this.setView(l,this._zoom,{pan:v})},panBy:function(l,v){if(l=lt(l).round(),v=v||{},!l.x&&!l.y)return this.fire("moveend");if(v.animate!==!0&&!this.getSize().contains(l))return this._resetView(this.unproject(this.project(this.getCenter()).add(l)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new zo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),v.noMoveStart||this.fire("movestart"),v.animate!==!1){Si(this._mapPane,"leaflet-pan-anim");var A=this._getMapPanePos().subtract(l).round();this._panAnim.run(this._mapPane,A,v.duration||.25,v.easeLinearity)}else this._rawPanBy(l),this.fire("move").fire("moveend");return this},flyTo:function(l,v,A){if(A=A||{},A.animate===!1||!Qe.any3d)return this.setView(l,v,A);this._stop();var B=this.project(this.getCenter()),H=this.project(l),ae=this.getSize(),Ae=this._zoom;l=Lt(l),v=v===void 0?Ae:v;var Ve=Math.max(ae.x,ae.y),at=Ve*this.getZoomScale(Ae,v),Mt=H.distanceTo(B)||1,Zt=1.42,ci=Zt*Zt;function Li(Un){var ja=Un?-1:1,ks=Un?at:Ve,Rs=at*at-Ve*Ve+ja*ci*ci*Mt*Mt,co=2*ks*ci*Mt,ms=Rs/co,Ua=Math.sqrt(ms*ms+1)-ms,Os=Ua<1e-9?-18:Math.log(Ua);return Os}function lr(Un){return(Math.exp(Un)-Math.exp(-Un))/2}function Xn(Un){return(Math.exp(Un)+Math.exp(-Un))/2}function Aa(Un){return lr(Un)/Xn(Un)}var on=Li(0);function Xi(Un){return Ve*(Xn(on)/Xn(on+Zt*Un))}function Ni(Un){return Ve*(Xn(on)*Aa(on+Zt*Un)-lr(on))/ci}function lo(Un){return 1-Math.pow(1-Un,1.5)}var Fa=Date.now(),On=(Li(1)-on)/Zt,Ca=A.duration?1e3*A.duration:1e3*On*.8;function la(){var Un=(Date.now()-Fa)/Ca,ja=lo(Un)*On;Un<=1?(this._flyToFrame=Ot(la,this),this._move(this.unproject(B.add(H.subtract(B).multiplyBy(Ni(ja)/Mt)),Ae),this.getScaleZoom(Ve/Xi(ja),Ae),{flyTo:!0})):this._move(l,v)._moveEnd(!0)}return this._moveStart(!0,A.noMoveStart),la.call(this),this},flyToBounds:function(l,v){var A=this._getBoundsCenterZoom(l,v);return this.flyTo(A.center,A.zoom,v)},setMaxBounds:function(l){return l=Pt(l),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),l.isValid()?(this.options.maxBounds=l,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(l){var v=this.options.minZoom;return this.options.minZoom=l,this._loaded&&v!==l&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(l):this},setMaxZoom:function(l){var v=this.options.maxZoom;return this.options.maxZoom=l,this._loaded&&v!==l&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(l):this},panInsideBounds:function(l,v){this._enforcingBounds=!0;var A=this.getCenter(),B=this._limitCenter(A,this._zoom,Pt(l));return A.equals(B)||this.panTo(B,v),this._enforcingBounds=!1,this},panInside:function(l,v){v=v||{};var A=lt(v.paddingTopLeft||v.padding||[0,0]),B=lt(v.paddingBottomRight||v.padding||[0,0]),H=this.project(this.getCenter()),ae=this.project(l),Ae=this.getPixelBounds(),Ve=Ue([Ae.min.add(A),Ae.max.subtract(B)]),at=Ve.getSize();if(!Ve.contains(ae)){this._enforcingBounds=!0;var Mt=ae.subtract(Ve.getCenter()),Zt=Ve.extend(ae).getSize().subtract(at);H.x+=Mt.x<0?-Zt.x:Zt.x,H.y+=Mt.y<0?-Zt.y:Zt.y,this.panTo(this.unproject(H),v),this._enforcingBounds=!1}return this},invalidateSize:function(l){if(!this._loaded)return this;l=O({animate:!1,pan:!0},l===!0?{animate:!0}:l);var v=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var A=this.getSize(),B=v.divideBy(2).round(),H=A.divideBy(2).round(),ae=B.subtract(H);return!ae.x&&!ae.y?this:(l.animate&&l.pan?this.panBy(ae):(l.pan&&this._rawPanBy(ae),this.fire("move"),l.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(D(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:v,newSize:A}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(l){if(l=this._locateOptions=O({timeout:1e4,watch:!1},l),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var v=D(this._handleGeolocationResponse,this),A=D(this._handleGeolocationError,this);return l.watch?this._locationWatchId=navigator.geolocation.watchPosition(v,A,l):navigator.geolocation.getCurrentPosition(v,A,l),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(l){if(this._container._leaflet_id){var v=l.code,A=l.message||(v===1?"permission denied":v===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:v,message:"Geolocation error: "+A+"."})}},_handleGeolocationResponse:function(l){if(this._container._leaflet_id){var v=l.coords.latitude,A=l.coords.longitude,B=new Dt(v,A),H=B.toBounds(l.coords.accuracy*2),ae=this._locateOptions;if(ae.setView){var Ae=this.getBoundsZoom(H);this.setView(B,ae.maxZoom?Math.min(Ae,ae.maxZoom):Ae)}var Ve={latlng:B,bounds:H,timestamp:l.timestamp};for(var at in l.coords)typeof l.coords[at]=="number"&&(Ve[at]=l.coords[at]);this.fire("locationfound",Ve)}},addHandler:function(l,v){if(!v)return this;var A=this[l]=new v(this);return this._handlers.push(A),this.options[l]&&A.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),nn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Yt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var l;for(l in this._layers)this._layers[l].remove();for(l in this._panes)nn(this._panes[l]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(l,v){var A="leaflet-pane"+(l?" leaflet-"+l.replace("Pane","")+"-pane":""),B=qi("div",A,v||this._mapPane);return l&&(this._panes[l]=B),B},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var l=this.getPixelBounds(),v=this.unproject(l.getBottomLeft()),A=this.unproject(l.getTopRight());return new yt(v,A)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(l,v,A){l=Pt(l),A=lt(A||[0,0]);var B=this.getZoom()||0,H=this.getMinZoom(),ae=this.getMaxZoom(),Ae=l.getNorthWest(),Ve=l.getSouthEast(),at=this.getSize().subtract(A),Mt=Ue(this.project(Ve,B),this.project(Ae,B)).getSize(),Zt=Qe.any3d?this.options.zoomSnap:1,ci=at.x/Mt.x,Li=at.y/Mt.y,lr=v?Math.max(ci,Li):Math.min(ci,Li);return B=this.getScaleZoom(lr,B),Zt&&(B=Math.round(B/(Zt/100))*(Zt/100),B=v?Math.ceil(B/Zt)*Zt:Math.floor(B/Zt)*Zt),Math.max(H,Math.min(ae,B))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new st(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(l,v){var A=this._getTopLeftPoint(l,v);return new _e(A,A.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(l){return this.options.crs.getProjectedBounds(l===void 0?this.getZoom():l)},getPane:function(l){return typeof l=="string"?this._panes[l]:l},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(l,v){var A=this.options.crs;return v=v===void 0?this._zoom:v,A.scale(l)/A.scale(v)},getScaleZoom:function(l,v){var A=this.options.crs;v=v===void 0?this._zoom:v;var B=A.zoom(l*A.scale(v));return isNaN(B)?1/0:B},project:function(l,v){return v=v===void 0?this._zoom:v,this.options.crs.latLngToPoint(Lt(l),v)},unproject:function(l,v){return v=v===void 0?this._zoom:v,this.options.crs.pointToLatLng(lt(l),v)},layerPointToLatLng:function(l){var v=lt(l).add(this.getPixelOrigin());return this.unproject(v)},latLngToLayerPoint:function(l){var v=this.project(Lt(l))._round();return v._subtract(this.getPixelOrigin())},wrapLatLng:function(l){return this.options.crs.wrapLatLng(Lt(l))},wrapLatLngBounds:function(l){return this.options.crs.wrapLatLngBounds(Pt(l))},distance:function(l,v){return this.options.crs.distance(Lt(l),Lt(v))},containerPointToLayerPoint:function(l){return lt(l).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(l){return lt(l).add(this._getMapPanePos())},containerPointToLatLng:function(l){var v=this.containerPointToLayerPoint(lt(l));return this.layerPointToLatLng(v)},latLngToContainerPoint:function(l){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Lt(l)))},mouseEventToContainerPoint:function(l){return Po(l,this._container)},mouseEventToLayerPoint:function(l){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(l))},mouseEventToLatLng:function(l){return this.layerPointToLatLng(this.mouseEventToLayerPoint(l))},_initContainer:function(l){var v=this._container=Js(l);if(v){if(v._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ii(v,"scroll",this._onScroll,this),this._containerId=V(v)},_initLayout:function(){var l=this._container;this._fadeAnimated=this.options.fadeAnimation&&Qe.any3d,Si(l,"leaflet-container"+(Qe.touch?" leaflet-touch":"")+(Qe.retina?" leaflet-retina":"")+(Qe.ielt9?" leaflet-oldie":"")+(Qe.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var v=ia(l,"position");v!=="absolute"&&v!=="relative"&&v!=="fixed"&&v!=="sticky"&&(l.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var l=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Sn(this._mapPane,new st(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Si(l.markerPane,"leaflet-zoom-hide"),Si(l.shadowPane,"leaflet-zoom-hide"))},_resetView:function(l,v,A){Sn(this._mapPane,new st(0,0));var B=!this._loaded;this._loaded=!0,v=this._limitZoom(v),this.fire("viewprereset");var H=this._zoom!==v;this._moveStart(H,A)._move(l,v)._moveEnd(H),this.fire("viewreset"),B&&this.fire("load")},_moveStart:function(l,v){return l&&this.fire("zoomstart"),v||this.fire("movestart"),this},_move:function(l,v,A,B){v===void 0&&(v=this._zoom);var H=this._zoom!==v;return this._zoom=v,this._lastCenter=l,this._pixelOrigin=this._getNewPixelOrigin(l),B?A&&A.pinch&&this.fire("zoom",A):((H||A&&A.pinch)&&this.fire("zoom",A),this.fire("move",A)),this},_moveEnd:function(l){return l&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Yt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(l){Sn(this._mapPane,this._getMapPanePos().subtract(l))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(l){this._targets={},this._targets[V(this._container)]=this;var v=l?$t:ii;v(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&v(window,"resize",this._onResize,this),Qe.any3d&&this.options.transform3DLimit&&(l?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Yt(this._resizeRequest),this._resizeRequest=Ot(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var l=this._getMapPanePos();Math.max(Math.abs(l.x),Math.abs(l.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(l,v){for(var A=[],B,H=v==="mouseout"||v==="mouseover",ae=l.target||l.srcElement,Ae=!1;ae;){if(B=this._targets[V(ae)],B&&(v==="click"||v==="preclick")&&this._draggableMoved(B)){Ae=!0;break}if(B&&B.listens(v,!0)&&(H&&!Br(ae,l)||(A.push(B),H))||ae===this._container)break;ae=ae.parentNode}return!A.length&&!Ae&&!H&&this.listens(v,!0)&&(A=[this]),A},_isClickDisabled:function(l){for(;l&&l!==this._container;){if(l._leaflet_disable_click)return!0;l=l.parentNode}},_handleDOMEvent:function(l){var v=l.target||l.srcElement;if(!(!this._loaded||v._leaflet_disable_events||l.type==="click"&&this._isClickDisabled(v))){var A=l.type;A==="mousedown"&&bi(v),this._fireDOMEvent(l,A)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(l,v,A){if(l.type==="click"){var B=O({},l);B.type="preclick",this._fireDOMEvent(B,B.type,A)}var H=this._findEventTargets(l,v);if(A){for(var ae=[],Ae=0;Ae<A.length;Ae++)A[Ae].listens(v,!0)&&ae.push(A[Ae]);H=ae.concat(H)}if(H.length){v==="contextmenu"&&Pi(l);var Ve=H[0],at={originalEvent:l};if(l.type!=="keypress"&&l.type!=="keydown"&&l.type!=="keyup"){var Mt=Ve.getLatLng&&(!Ve._radius||Ve._radius<=10);at.containerPoint=Mt?this.latLngToContainerPoint(Ve.getLatLng()):this.mouseEventToContainerPoint(l),at.layerPoint=this.containerPointToLayerPoint(at.containerPoint),at.latlng=Mt?Ve.getLatLng():this.layerPointToLatLng(at.layerPoint)}for(Ae=0;Ae<H.length;Ae++)if(H[Ae].fire(v,at,!0),at.originalEvent._stopped||H[Ae].options.bubblingMouseEvents===!1&&Ut(this._mouseEvents,v)!==-1)return}},_draggableMoved:function(l){return l=l.dragging&&l.dragging.enabled()?l:this,l.dragging&&l.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var l=0,v=this._handlers.length;l<v;l++)this._handlers[l].disable()},whenReady:function(l,v){return this._loaded?l.call(v||this,{target:this}):this.on("load",l,v),this},_getMapPanePos:function(){return Ao(this._mapPane)||new st(0,0)},_moved:function(){var l=this._getMapPanePos();return l&&!l.equals([0,0])},_getTopLeftPoint:function(l,v){var A=l&&v!==void 0?this._getNewPixelOrigin(l,v):this.getPixelOrigin();return A.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(l,v){var A=this.getSize()._divideBy(2);return this.project(l,v)._subtract(A)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(l,v,A){var B=this._getNewPixelOrigin(A,v);return this.project(l,v)._subtract(B)},_latLngBoundsToNewLayerBounds:function(l,v,A){var B=this._getNewPixelOrigin(A,v);return Ue([this.project(l.getSouthWest(),v)._subtract(B),this.project(l.getNorthWest(),v)._subtract(B),this.project(l.getSouthEast(),v)._subtract(B),this.project(l.getNorthEast(),v)._subtract(B)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(l){return this.latLngToLayerPoint(l).subtract(this._getCenterLayerPoint())},_limitCenter:function(l,v,A){if(!A)return l;var B=this.project(l,v),H=this.getSize().divideBy(2),ae=new _e(B.subtract(H),B.add(H)),Ae=this._getBoundsOffset(ae,A,v);return Math.abs(Ae.x)<=1&&Math.abs(Ae.y)<=1?l:this.unproject(B.add(Ae),v)},_limitOffset:function(l,v){if(!v)return l;var A=this.getPixelBounds(),B=new _e(A.min.add(l),A.max.add(l));return l.add(this._getBoundsOffset(B,v))},_getBoundsOffset:function(l,v,A){var B=Ue(this.project(v.getNorthEast(),A),this.project(v.getSouthWest(),A)),H=B.min.subtract(l.min),ae=B.max.subtract(l.max),Ae=this._rebound(H.x,-ae.x),Ve=this._rebound(H.y,-ae.y);return new st(Ae,Ve)},_rebound:function(l,v){return l+v>0?Math.round(l-v)/2:Math.max(0,Math.ceil(l))-Math.max(0,Math.floor(v))},_limitZoom:function(l){var v=this.getMinZoom(),A=this.getMaxZoom(),B=Qe.any3d?this.options.zoomSnap:1;return B&&(l=Math.round(l/B)*B),Math.max(v,Math.min(A,l))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Hn(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(l,v){var A=this._getCenterOffset(l)._trunc();return(v&&v.animate)!==!0&&!this.getSize().contains(A)?!1:(this.panBy(A,v),!0)},_createAnimProxy:function(){var l=this._proxy=qi("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(l),this.on("zoomanim",function(v){var A=as,B=this._proxy.style[A];ss(this._proxy,this.project(v.center,v.zoom),this.getZoomScale(v.zoom,1)),B===this._proxy.style[A]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){nn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var l=this.getCenter(),v=this.getZoom();ss(this._proxy,this.project(l,v),this.getZoomScale(v,1))},_catchTransitionEnd:function(l){this._animatingZoom&&l.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(l,v,A){if(this._animatingZoom)return!0;if(A=A||{},!this._zoomAnimated||A.animate===!1||this._nothingToAnimate()||Math.abs(v-this._zoom)>this.options.zoomAnimationThreshold)return!1;var B=this.getZoomScale(v),H=this._getCenterOffset(l)._divideBy(1-1/B);return A.animate!==!0&&!this.getSize().contains(H)?!1:(Ot(function(){this._moveStart(!0,A.noMoveStart||!1)._animateZoom(l,v,!0)},this),!0)},_animateZoom:function(l,v,A,B){this._mapPane&&(A&&(this._animatingZoom=!0,this._animateToCenter=l,this._animateToZoom=v,Si(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:l,zoom:v,noUpdate:B}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(D(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Hn(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function dn(l,v){return new Ii(l,v)}var Pr=oi.extend({options:{position:"topright"},initialize:function(l){be(this,l)},getPosition:function(){return this.options.position},setPosition:function(l){var v=this._map;return v&&v.removeControl(this),this.options.position=l,v&&v.addControl(this),this},getContainer:function(){return this._container},addTo:function(l){this.remove(),this._map=l;var v=this._container=this.onAdd(l),A=this.getPosition(),B=l._controlCorners[A];return Si(v,"leaflet-control"),A.indexOf("bottom")!==-1?B.insertBefore(v,B.firstChild):B.appendChild(v),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(nn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(l){this._map&&l&&l.screenX>0&&l.screenY>0&&this._map.getContainer().focus()}}),Mi=function(l){return new Pr(l)};Ii.include({addControl:function(l){return l.addTo(this),this},removeControl:function(l){return l.remove(),this},_initControlPos:function(){var l=this._controlCorners={},v="leaflet-",A=this._controlContainer=qi("div",v+"control-container",this._container);function B(H,ae){var Ae=v+H+" "+v+ae;l[H+ae]=qi("div",Ae,A)}B("top","left"),B("top","right"),B("bottom","left"),B("bottom","right")},_clearControlPos:function(){for(var l in this._controlCorners)nn(this._controlCorners[l]);nn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var xi=Pr.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(l,v,A,B){return A<B?-1:B<A?1:0}},initialize:function(l,v,A){be(this,A),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var B in l)this._addLayer(l[B],B);for(B in v)this._addLayer(v[B],B,!0)},onAdd:function(l){this._initLayout(),this._update(),this._map=l,l.on("zoomend",this._checkDisabledLayers,this);for(var v=0;v<this._layers.length;v++)this._layers[v].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(l){return Pr.prototype.addTo.call(this,l),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(l,v){return this._addLayer(l,v),this._map?this._update():this},addOverlay:function(l,v){return this._addLayer(l,v,!0),this._map?this._update():this},removeLayer:function(l){l.off("add remove",this._onLayerChange,this);var v=this._getLayer(V(l));return v&&this._layers.splice(this._layers.indexOf(v),1),this._map?this._update():this},expand:function(){Si(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var l=this._map.getSize().y-(this._container.offsetTop+50);return l<this._section.clientHeight?(Si(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=l+"px"):Hn(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Hn(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var l="leaflet-control-layers",v=this._container=qi("div",l),A=this.options.collapsed;v.setAttribute("aria-haspopup",!0),ya(v),ra(v);var B=this._section=qi("section",l+"-list");A&&(this._map.on("click",this.collapse,this),ii(v,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var H=this._layersLink=qi("a",l+"-toggle",v);H.href="#",H.title="Layers",H.setAttribute("role","button"),ii(H,{keydown:function(ae){ae.keyCode===13&&this._expandSafely()},click:function(ae){Pi(ae),this._expandSafely()}},this),A||this.expand(),this._baseLayersList=qi("div",l+"-base",B),this._separator=qi("div",l+"-separator",B),this._overlaysList=qi("div",l+"-overlays",B),v.appendChild(B)},_getLayer:function(l){for(var v=0;v<this._layers.length;v++)if(this._layers[v]&&V(this._layers[v].layer)===l)return this._layers[v]},_addLayer:function(l,v,A){this._map&&l.on("add remove",this._onLayerChange,this),this._layers.push({layer:l,name:v,overlay:A}),this.options.sortLayers&&this._layers.sort(D(function(B,H){return this.options.sortFunction(B.layer,H.layer,B.name,H.name)},this)),this.options.autoZIndex&&l.setZIndex&&(this._lastZIndex++,l.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;na(this._baseLayersList),na(this._overlaysList),this._layerControlInputs=[];var l,v,A,B,H=0;for(A=0;A<this._layers.length;A++)B=this._layers[A],this._addItem(B),v=v||B.overlay,l=l||!B.overlay,H+=B.overlay?0:1;return this.options.hideSingleBase&&(l=l&&H>1,this._baseLayersList.style.display=l?"":"none"),this._separator.style.display=v&&l?"":"none",this},_onLayerChange:function(l){this._handlingClick||this._update();var v=this._getLayer(V(l.target)),A=v.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;A&&this._map.fire(A,v)},_createRadioElement:function(l,v){var A='<input type="radio" class="leaflet-control-layers-selector" name="'+l+'"'+(v?' checked="checked"':"")+"/>",B=document.createElement("div");return B.innerHTML=A,B.firstChild},_addItem:function(l){var v=document.createElement("label"),A=this._map.hasLayer(l.layer),B;l.overlay?(B=document.createElement("input"),B.type="checkbox",B.className="leaflet-control-layers-selector",B.defaultChecked=A):B=this._createRadioElement("leaflet-base-layers_"+V(this),A),this._layerControlInputs.push(B),B.layerId=V(l.layer),ii(B,"click",this._onInputClick,this);var H=document.createElement("span");H.innerHTML=" "+l.name;var ae=document.createElement("span");v.appendChild(ae),ae.appendChild(B),ae.appendChild(H);var Ae=l.overlay?this._overlaysList:this._baseLayersList;return Ae.appendChild(v),this._checkDisabledLayers(),v},_onInputClick:function(){if(!this._preventClick){var l=this._layerControlInputs,v,A,B=[],H=[];this._handlingClick=!0;for(var ae=l.length-1;ae>=0;ae--)v=l[ae],A=this._getLayer(v.layerId).layer,v.checked?B.push(A):v.checked||H.push(A);for(ae=0;ae<H.length;ae++)this._map.hasLayer(H[ae])&&this._map.removeLayer(H[ae]);for(ae=0;ae<B.length;ae++)this._map.hasLayer(B[ae])||this._map.addLayer(B[ae]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var l=this._layerControlInputs,v,A,B=this._map.getZoom(),H=l.length-1;H>=0;H--)v=l[H],A=this._getLayer(v.layerId).layer,v.disabled=A.options.minZoom!==void 0&&B<A.options.minZoom||A.options.maxZoom!==void 0&&B>A.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var l=this._section;this._preventClick=!0,ii(l,"click",Pi),this.expand();var v=this;setTimeout(function(){$t(l,"click",Pi),v._preventClick=!1})}}),ol=function(l,v,A){return new xi(l,v,A)},Bi=Pr.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(l){var v="leaflet-control-zoom",A=qi("div",v+" leaflet-bar"),B=this.options;return this._zoomInButton=this._createButton(B.zoomInText,B.zoomInTitle,v+"-in",A,this._zoomIn),this._zoomOutButton=this._createButton(B.zoomOutText,B.zoomOutTitle,v+"-out",A,this._zoomOut),this._updateDisabled(),l.on("zoomend zoomlevelschange",this._updateDisabled,this),A},onRemove:function(l){l.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(l){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(l.shiftKey?3:1))},_zoomOut:function(l){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(l.shiftKey?3:1))},_createButton:function(l,v,A,B,H){var ae=qi("a",A,B);return ae.innerHTML=l,ae.href="#",ae.title=v,ae.setAttribute("role","button"),ae.setAttribute("aria-label",v),ya(ae),ii(ae,"click",va),ii(ae,"click",H,this),ii(ae,"click",this._refocusOnMap,this),ae},_updateDisabled:function(){var l=this._map,v="leaflet-disabled";Hn(this._zoomInButton,v),Hn(this._zoomOutButton,v),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||l._zoom===l.getMinZoom())&&(Si(this._zoomOutButton,v),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||l._zoom===l.getMaxZoom())&&(Si(this._zoomInButton,v),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ii.mergeOptions({zoomControl:!0}),Ii.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Bi,this.addControl(this.zoomControl))});var fc=function(l){return new Bi(l)},Na=Pr.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(l){var v="leaflet-control-scale",A=qi("div",v),B=this.options;return this._addScales(B,v+"-line",A),l.on(B.updateWhenIdle?"moveend":"move",this._update,this),l.whenReady(this._update,this),A},onRemove:function(l){l.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(l,v,A){l.metric&&(this._mScale=qi("div",v,A)),l.imperial&&(this._iScale=qi("div",v,A))},_update:function(){var l=this._map,v=l.getSize().y/2,A=l.distance(l.containerPointToLatLng([0,v]),l.containerPointToLatLng([this.options.maxWidth,v]));this._updateScales(A)},_updateScales:function(l){this.options.metric&&l&&this._updateMetric(l),this.options.imperial&&l&&this._updateImperial(l)},_updateMetric:function(l){var v=this._getRoundNum(l),A=v<1e3?v+" m":v/1e3+" km";this._updateScale(this._mScale,A,v/l)},_updateImperial:function(l){var v=l*3.2808399,A,B,H;v>5280?(A=v/5280,B=this._getRoundNum(A),this._updateScale(this._iScale,B+" mi",B/A)):(H=this._getRoundNum(v),this._updateScale(this._iScale,H+" ft",H/v))},_updateScale:function(l,v,A){l.style.width=Math.round(this.options.maxWidth*A)+"px",l.innerHTML=v},_getRoundNum:function(l){var v=Math.pow(10,(Math.floor(l)+"").length-1),A=l/v;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:1,v*A}}),Do=function(l){return new Na(l)},Io='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',iu=Pr.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Qe.inlineSvg?Io+" ":"")+"Leaflet</a>"},initialize:function(l){be(this,l),this._attributions={}},onAdd:function(l){l.attributionControl=this,this._container=qi("div","leaflet-control-attribution"),ya(this._container);for(var v in l._layers)l._layers[v].getAttribution&&this.addAttribution(l._layers[v].getAttribution());return this._update(),l.on("layeradd",this._addAttribution,this),this._container},onRemove:function(l){l.off("layeradd",this._addAttribution,this)},_addAttribution:function(l){l.layer.getAttribution&&(this.addAttribution(l.layer.getAttribution()),l.layer.once("remove",function(){this.removeAttribution(l.layer.getAttribution())},this))},setPrefix:function(l){return this.options.prefix=l,this._update(),this},addAttribution:function(l){return l?(this._attributions[l]||(this._attributions[l]=0),this._attributions[l]++,this._update(),this):this},removeAttribution:function(l){return l?(this._attributions[l]&&(this._attributions[l]--,this._update()),this):this},_update:function(){if(this._map){var l=[];for(var v in this._attributions)this._attributions[v]&&l.push(v);var A=[];this.options.prefix&&A.push(this.options.prefix),l.length&&A.push(l.join(", ")),this._container.innerHTML=A.join(' <span aria-hidden="true">|</span> ')}}});Ii.mergeOptions({attributionControl:!0}),Ii.addInitHook(function(){this.options.attributionControl&&new iu().addTo(this)});var pc=function(l){return new iu(l)};Pr.Layers=xi,Pr.Zoom=Bi,Pr.Scale=Na,Pr.Attribution=iu,Mi.layers=ol,Mi.zoom=fc,Mi.scale=Do,Mi.attribution=pc;var qa=oi.extend({initialize:function(l){this._map=l},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});qa.addTo=function(l,v){return l.addHandler(v,this),this};var Ad={Events:ze},nu=Qe.touch?"touchstart mousedown":"mousedown",tr=Je.extend({options:{clickTolerance:3},initialize:function(l,v,A,B){be(this,B),this._element=l,this._dragStartTarget=v||l,this._preventOutline=A},enable:function(){this._enabled||(ii(this._dragStartTarget,nu,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(tr._dragging===this&&this.finishDrag(!0),$t(this._dragStartTarget,nu,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(l){if(this._enabled&&(this._moved=!1,!Jc(this._element,"leaflet-zoom-anim"))){if(l.touches&&l.touches.length!==1){tr._dragging===this&&this.finishDrag();return}if(!(tr._dragging||l.shiftKey||l.which!==1&&l.button!==1&&!l.touches)&&(tr._dragging=this,this._preventOutline&&bi(this._element),Nl(),Ps(),!this._moving)){this.fire("down");var v=l.touches?l.touches[0]:l,A=tu(this._element);this._startPoint=new st(v.clientX,v.clientY),this._startPos=Ao(this._element),this._parentScale=sl(A);var B=l.type==="mousedown";ii(document,B?"mousemove":"touchmove",this._onMove,this),ii(document,B?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(l){if(this._enabled){if(l.touches&&l.touches.length>1){this._moved=!0;return}var v=l.touches&&l.touches.length===1?l.touches[0]:l,A=new st(v.clientX,v.clientY)._subtract(this._startPoint);!A.x&&!A.y||Math.abs(A.x)+Math.abs(A.y)<this.options.clickTolerance||(A.x/=this._parentScale.x,A.y/=this._parentScale.y,Pi(l),this._moved||(this.fire("dragstart"),this._moved=!0,Si(document.body,"leaflet-dragging"),this._lastTarget=l.target||l.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Si(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(A),this._moving=!0,this._lastEvent=l,this._updatePosition())}},_updatePosition:function(){var l={originalEvent:this._lastEvent};this.fire("predrag",l),Sn(this._element,this._newPos),this.fire("drag",l)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(l){Hn(document.body,"leaflet-dragging"),this._lastTarget&&(Hn(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),$t(document,"mousemove touchmove",this._onMove,this),$t(document,"mouseup touchend touchcancel",this._onUp,this),eo(),Ba();var v=this._moved&&this._moving;this._moving=!1,tr._dragging=!1,v&&this.fire("dragend",{noInertia:l,distance:this._newPos.distanceTo(this._startPos)})}});function cs(l,v,A){var B,H=[1,4,2,8],ae,Ae,Ve,at,Mt,Zt,ci,Li;for(ae=0,Zt=l.length;ae<Zt;ae++)l[ae]._code=no(l[ae],v);for(Ve=0;Ve<4;Ve++){for(ci=H[Ve],B=[],ae=0,Zt=l.length,Ae=Zt-1;ae<Zt;Ae=ae++)at=l[ae],Mt=l[Ae],at._code&ci?Mt._code&ci||(Li=io(Mt,at,ci,v,A),Li._code=no(Li,v),B.push(Li)):(Mt._code&ci&&(Li=io(Mt,at,ci,v,A),Li._code=no(Li,v),B.push(Li)),B.push(at));l=B}return l}function zn(l,v){var A,B,H,ae,Ae,Ve,at,Mt,Zt;if(!l||l.length===0)throw new Error("latlngs not passed");Nr(l)||(console.warn("latlngs are not flat! Only the first ring will be used"),l=l[0]);var ci=Lt([0,0]),Li=Pt(l),lr=Li.getNorthWest().distanceTo(Li.getSouthWest())*Li.getNorthEast().distanceTo(Li.getNorthWest());lr<1700&&(ci=to(l));var Xn=l.length,Aa=[];for(A=0;A<Xn;A++){var on=Lt(l[A]);Aa.push(v.project(Lt([on.lat-ci.lat,on.lng-ci.lng])))}for(Ve=at=Mt=0,A=0,B=Xn-1;A<Xn;B=A++)H=Aa[A],ae=Aa[B],Ae=H.y*ae.x-ae.y*H.x,at+=(H.x+ae.x)*Ae,Mt+=(H.y+ae.y)*Ae,Ve+=Ae*3;Ve===0?Zt=Aa[0]:Zt=[at/Ve,Mt/Ve];var Xi=v.unproject(lt(Zt));return Lt([Xi.lat+ci.lat,Xi.lng+ci.lng])}function to(l){for(var v=0,A=0,B=0,H=0;H<l.length;H++){var ae=Lt(l[H]);v+=ae.lat,A+=ae.lng,B++}return Lt([v/B,A/B])}var mc={__proto__:null,clipPolygon:cs,polygonCenter:zn,centroid:to};function Fl(l,v){if(!v||!l.length)return l.slice();var A=v*v;return l=Cd(l,A),l=ru(l,A),l}function jn(l,v,A){return Math.sqrt(zs(l,v,A,!0))}function zh(l,v,A){return zs(l,v,A)}function ru(l,v){var A=l.length,B=typeof Uint8Array<"u"?Uint8Array:Array,H=new B(A);H[0]=H[A-1]=1,au(l,H,v,0,A-1);var ae,Ae=[];for(ae=0;ae<A;ae++)H[ae]&&Ae.push(l[ae]);return Ae}function au(l,v,A,B,H){var ae=0,Ae,Ve,at;for(Ve=B+1;Ve<=H-1;Ve++)at=zs(l[Ve],l[B],l[H],!0),at>ae&&(Ae=Ve,ae=at);ae>A&&(v[Ae]=1,au(l,v,A,B,Ae),au(l,v,A,Ae,H))}function Cd(l,v){for(var A=[l[0]],B=1,H=0,ae=l.length;B<ae;B++)_c(l[B],l[H])>v&&(A.push(l[B]),H=B);return H<ae-1&&A.push(l[ae-1]),A}var ll;function gc(l,v,A,B,H){var ae=B?ll:no(l,A),Ae=no(v,A),Ve,at,Mt;for(ll=Ae;;){if(!(ae|Ae))return[l,v];if(ae&Ae)return!1;Ve=ae||Ae,at=io(l,v,Ve,A,H),Mt=no(at,A),Ve===ae?(l=at,ae=Mt):(v=at,Ae=Mt)}}function io(l,v,A,B,H){var ae=v.x-l.x,Ae=v.y-l.y,Ve=B.min,at=B.max,Mt,Zt;return A&8?(Mt=l.x+ae*(at.y-l.y)/Ae,Zt=at.y):A&4?(Mt=l.x+ae*(Ve.y-l.y)/Ae,Zt=Ve.y):A&2?(Mt=at.x,Zt=l.y+Ae*(at.x-l.x)/ae):A&1&&(Mt=Ve.x,Zt=l.y+Ae*(Ve.x-l.x)/ae),new st(Mt,Zt,H)}function no(l,v){var A=0;return l.x<v.min.x?A|=1:l.x>v.max.x&&(A|=2),l.y<v.min.y?A|=4:l.y>v.max.y&&(A|=8),A}function _c(l,v){var A=v.x-l.x,B=v.y-l.y;return A*A+B*B}function zs(l,v,A,B){var H=v.x,ae=v.y,Ae=A.x-H,Ve=A.y-ae,at=Ae*Ae+Ve*Ve,Mt;return at>0&&(Mt=((l.x-H)*Ae+(l.y-ae)*Ve)/at,Mt>1?(H=A.x,ae=A.y):Mt>0&&(H+=Ae*Mt,ae+=Ve*Mt)),Ae=l.x-H,Ve=l.y-ae,B?Ae*Ae+Ve*Ve:new st(H,ae)}function Nr(l){return!Fe(l[0])||typeof l[0][0]!="object"&&typeof l[0][0]<"u"}function $n(l){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Nr(l)}function cl(l,v){var A,B,H,ae,Ae,Ve,at,Mt;if(!l||l.length===0)throw new Error("latlngs not passed");Nr(l)||(console.warn("latlngs are not flat! Only the first ring will be used"),l=l[0]);var Zt=Lt([0,0]),ci=Pt(l),Li=ci.getNorthWest().distanceTo(ci.getSouthWest())*ci.getNorthEast().distanceTo(ci.getNorthWest());Li<1700&&(Zt=to(l));var lr=l.length,Xn=[];for(A=0;A<lr;A++){var Aa=Lt(l[A]);Xn.push(v.project(Lt([Aa.lat-Zt.lat,Aa.lng-Zt.lng])))}for(A=0,B=0;A<lr-1;A++)B+=Xn[A].distanceTo(Xn[A+1])/2;if(B===0)Mt=Xn[0];else for(A=0,ae=0;A<lr-1;A++)if(Ae=Xn[A],Ve=Xn[A+1],H=Ae.distanceTo(Ve),ae+=H,ae>B){at=(ae-B)/H,Mt=[Ve.x-at*(Ve.x-Ae.x),Ve.y-at*(Ve.y-Ae.y)];break}var on=v.unproject(lt(Mt));return Lt([on.lat+Zt.lat,on.lng+Zt.lng])}var jl={__proto__:null,simplify:Fl,pointToSegmentDistance:jn,closestPointOnSegment:zh,clipSegment:gc,_getEdgeIntersection:io,_getBitCode:no,_sqClosestPointOnSegment:zs,isFlat:Nr,_flat:$n,polylineCenter:cl},Lo={project:function(l){return new st(l.lng,l.lat)},unproject:function(l){return new Dt(l.y,l.x)},bounds:new _e([-180,-90],[180,90])},Ds={R:6378137,R_MINOR:6356752314245179e-9,bounds:new _e([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(l){var v=Math.PI/180,A=this.R,B=l.lat*v,H=this.R_MINOR/A,ae=Math.sqrt(1-H*H),Ae=ae*Math.sin(B),Ve=Math.tan(Math.PI/4-B/2)/Math.pow((1-Ae)/(1+Ae),ae/2);return B=-A*Math.log(Math.max(Ve,1e-10)),new st(l.lng*v*A,B)},unproject:function(l){for(var v=180/Math.PI,A=this.R,B=this.R_MINOR/A,H=Math.sqrt(1-B*B),ae=Math.exp(-l.y/A),Ae=Math.PI/2-2*Math.atan(ae),Ve=0,at=.1,Mt;Ve<15&&Math.abs(at)>1e-7;Ve++)Mt=H*Math.sin(Ae),Mt=Math.pow((1-Mt)/(1+Mt),H/2),at=Math.PI/2-2*Math.atan(ae*Mt)-Ae,Ae+=at;return new Dt(Ae*v,l.x*v/A)}},Dh={__proto__:null,LonLat:Lo,Mercator:Ds,SphericalMercator:mn},yc=O({},ui,{code:"EPSG:3395",projection:Ds,transformation:(function(){var l=.5/(Math.PI*Ds.R);return tn(l,.5,-l,.5)})()}),Zu=O({},ui,{code:"EPSG:4326",projection:Lo,transformation:tn(1/180,1,-1/180,.5)}),us=O({},Kt,{projection:Lo,transformation:tn(1,0,-1,0),scale:function(l){return Math.pow(2,l)},zoom:function(l){return Math.log(l)/Math.LN2},distance:function(l,v){var A=v.lng-l.lng,B=v.lat-l.lat;return Math.sqrt(A*A+B*B)},infinite:!0});Kt.Earth=ui,Kt.EPSG3395=yc,Kt.EPSG3857=ar,Kt.EPSG900913=Gi,Kt.EPSG4326=Zu,Kt.Simple=us;var ba=Je.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(l){return l.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(l){return l&&l.removeLayer(this),this},getPane:function(l){return this._map.getPane(l?this.options[l]||l:this.options.pane)},addInteractiveTarget:function(l){return this._map._targets[V(l)]=this,this},removeInteractiveTarget:function(l){return delete this._map._targets[V(l)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(l){var v=l.target;if(v.hasLayer(this)){if(this._map=v,this._zoomAnimated=v._zoomAnimated,this.getEvents){var A=this.getEvents();v.on(A,this),this.once("remove",function(){v.off(A,this)},this)}this.onAdd(v),this.fire("add"),v.fire("layeradd",{layer:this})}}});Ii.include({addLayer:function(l){if(!l._layerAdd)throw new Error("The provided object is not a Layer.");var v=V(l);return this._layers[v]?this:(this._layers[v]=l,l._mapToAdd=this,l.beforeAdd&&l.beforeAdd(this),this.whenReady(l._layerAdd,l),this)},removeLayer:function(l){var v=V(l);return this._layers[v]?(this._loaded&&l.onRemove(this),delete this._layers[v],this._loaded&&(this.fire("layerremove",{layer:l}),l.fire("remove")),l._map=l._mapToAdd=null,this):this},hasLayer:function(l){return V(l)in this._layers},eachLayer:function(l,v){for(var A in this._layers)l.call(v,this._layers[A]);return this},_addLayers:function(l){l=l?Fe(l)?l:[l]:[];for(var v=0,A=l.length;v<A;v++)this.addLayer(l[v])},_addZoomLimit:function(l){(!isNaN(l.options.maxZoom)||!isNaN(l.options.minZoom))&&(this._zoomBoundLayers[V(l)]=l,this._updateZoomLevels())},_removeZoomLimit:function(l){var v=V(l);this._zoomBoundLayers[v]&&(delete this._zoomBoundLayers[v],this._updateZoomLevels())},_updateZoomLevels:function(){var l=1/0,v=-1/0,A=this._getZoomSpan();for(var B in this._zoomBoundLayers){var H=this._zoomBoundLayers[B].options;l=H.minZoom===void 0?l:Math.min(l,H.minZoom),v=H.maxZoom===void 0?v:Math.max(v,H.maxZoom)}this._layersMaxZoom=v===-1/0?void 0:v,this._layersMinZoom=l===1/0?void 0:l,A!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ul=ba.extend({initialize:function(l,v){be(this,v),this._layers={};var A,B;if(l)for(A=0,B=l.length;A<B;A++)this.addLayer(l[A])},addLayer:function(l){var v=this.getLayerId(l);return this._layers[v]=l,this._map&&this._map.addLayer(l),this},removeLayer:function(l){var v=l in this._layers?l:this.getLayerId(l);return this._map&&this._layers[v]&&this._map.removeLayer(this._layers[v]),delete this._layers[v],this},hasLayer:function(l){var v=typeof l=="number"?l:this.getLayerId(l);return v in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(l){var v=Array.prototype.slice.call(arguments,1),A,B;for(A in this._layers)B=this._layers[A],B[l]&&B[l].apply(B,v);return this},onAdd:function(l){this.eachLayer(l.addLayer,l)},onRemove:function(l){this.eachLayer(l.removeLayer,l)},eachLayer:function(l,v){for(var A in this._layers)l.call(v,this._layers[A]);return this},getLayer:function(l){return this._layers[l]},getLayers:function(){var l=[];return this.eachLayer(l.push,l),l},setZIndex:function(l){return this.invoke("setZIndex",l)},getLayerId:function(l){return V(l)}}),Ih=function(l,v){return new ul(l,v)},Ga=ul.extend({addLayer:function(l){return this.hasLayer(l)?this:(l.addEventParent(this),ul.prototype.addLayer.call(this,l),this.fire("layeradd",{layer:l}))},removeLayer:function(l){return this.hasLayer(l)?(l in this._layers&&(l=this._layers[l]),l.removeEventParent(this),ul.prototype.removeLayer.call(this,l),this.fire("layerremove",{layer:l})):this},setStyle:function(l){return this.invoke("setStyle",l)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var l=new yt;for(var v in this._layers){var A=this._layers[v];l.extend(A.getBounds?A.getBounds():A.getLatLng())}return l}}),su=function(l,v){return new Ga(l,v)},Ha=oi.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(l){be(this,l)},createIcon:function(l){return this._createIcon("icon",l)},createShadow:function(l){return this._createIcon("shadow",l)},_createIcon:function(l,v){var A=this._getIconUrl(l);if(!A){if(l==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var B=this._createImg(A,v&&v.tagName==="IMG"?v:null);return this._setIconStyles(B,l),(this.options.crossOrigin||this.options.crossOrigin==="")&&(B.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),B},_setIconStyles:function(l,v){var A=this.options,B=A[v+"Size"];typeof B=="number"&&(B=[B,B]);var H=lt(B),ae=lt(v==="shadow"&&A.shadowAnchor||A.iconAnchor||H&&H.divideBy(2,!0));l.className="leaflet-marker-"+v+" "+(A.className||""),ae&&(l.style.marginLeft=-ae.x+"px",l.style.marginTop=-ae.y+"px"),H&&(l.style.width=H.x+"px",l.style.height=H.y+"px")},_createImg:function(l,v){return v=v||document.createElement("img"),v.src=l,v},_getIconUrl:function(l){return Qe.retina&&this.options[l+"RetinaUrl"]||this.options[l+"Url"]}});function Ul(l){return new Ha(l)}var Vl=Ha.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(l){return typeof Vl.imagePath!="string"&&(Vl.imagePath=this._detectIconPath()),(this.options.imagePath||Vl.imagePath)+Ha.prototype._getIconUrl.call(this,l)},_stripUrl:function(l){var v=function(A,B,H){var ae=B.exec(A);return ae&&ae[H]};return l=v(l,/^url\((['"])?(.+)\1\)$/,2),l&&v(l,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var l=qi("div","leaflet-default-icon-path",document.body),v=ia(l,"background-image")||ia(l,"backgroundImage");if(document.body.removeChild(l),v=this._stripUrl(v),v)return v;var A=document.querySelector('link[href$="leaflet.css"]');return A?A.href.substring(0,A.href.length-11-1):""}}),Zl=qa.extend({initialize:function(l){this._marker=l},addHooks:function(){var l=this._marker._icon;this._draggable||(this._draggable=new tr(l,l,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Si(l,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Hn(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(l){var v=this._marker,A=v._map,B=this._marker.options.autoPanSpeed,H=this._marker.options.autoPanPadding,ae=Ao(v._icon),Ae=A.getPixelBounds(),Ve=A.getPixelOrigin(),at=Ue(Ae.min._subtract(Ve).add(H),Ae.max._subtract(Ve).subtract(H));if(!at.contains(ae)){var Mt=lt((Math.max(at.max.x,ae.x)-at.max.x)/(Ae.max.x-at.max.x)-(Math.min(at.min.x,ae.x)-at.min.x)/(Ae.min.x-at.min.x),(Math.max(at.max.y,ae.y)-at.max.y)/(Ae.max.y-at.max.y)-(Math.min(at.min.y,ae.y)-at.min.y)/(Ae.min.y-at.min.y)).multiplyBy(B);A.panBy(Mt,{animate:!1}),this._draggable._newPos._add(Mt),this._draggable._startPos._add(Mt),Sn(v._icon,this._draggable._newPos),this._onDrag(l),this._panRequest=Ot(this._adjustPan.bind(this,l))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(l){this._marker.options.autoPan&&(Yt(this._panRequest),this._panRequest=Ot(this._adjustPan.bind(this,l)))},_onDrag:function(l){var v=this._marker,A=v._shadow,B=Ao(v._icon),H=v._map.layerPointToLatLng(B);A&&Sn(A,B),v._latlng=H,l.latlng=H,l.oldLatLng=this._oldLatLng,v.fire("move",l).fire("drag",l)},_onDragEnd:function(l){Yt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",l)}}),hs=ba.extend({options:{icon:new Vl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(l,v){be(this,v),this._latlng=Lt(l)},onAdd:function(l){this._zoomAnimated=this._zoomAnimated&&l.options.markerZoomAnimation,this._zoomAnimated&&l.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(l){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&l.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(l){var v=this._latlng;return this._latlng=Lt(l),this.update(),this.fire("move",{oldLatLng:v,latlng:this._latlng})},setZIndexOffset:function(l){return this.options.zIndexOffset=l,this.update()},getIcon:function(){return this.options.icon},setIcon:function(l){return this.options.icon=l,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var l=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(l)}return this},_initIcon:function(){var l=this.options,v="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),A=l.icon.createIcon(this._icon),B=!1;A!==this._icon&&(this._icon&&this._removeIcon(),B=!0,l.title&&(A.title=l.title),A.tagName==="IMG"&&(A.alt=l.alt||"")),Si(A,v),l.keyboard&&(A.tabIndex="0",A.setAttribute("role","button")),this._icon=A,l.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ii(A,"focus",this._panOnFocus,this);var H=l.icon.createShadow(this._shadow),ae=!1;H!==this._shadow&&(this._removeShadow(),ae=!0),H&&(Si(H,v),H.alt=""),this._shadow=H,l.opacity<1&&this._updateOpacity(),B&&this.getPane().appendChild(this._icon),this._initInteraction(),H&&ae&&this.getPane(l.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&$t(this._icon,"focus",this._panOnFocus,this),nn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&nn(this._shadow),this._shadow=null},_setPos:function(l){this._icon&&Sn(this._icon,l),this._shadow&&Sn(this._shadow,l),this._zIndex=l.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(l){this._icon&&(this._icon.style.zIndex=this._zIndex+l)},_animateZoom:function(l){var v=this._map._latLngToNewLayerPoint(this._latlng,l.zoom,l.center).round();this._setPos(v)},_initInteraction:function(){if(this.options.interactive&&(Si(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Zl)){var l=this.options.draggable;this.dragging&&(l=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Zl(this),l&&this.dragging.enable()}},setOpacity:function(l){return this.options.opacity=l,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var l=this.options.opacity;this._icon&&Pn(this._icon,l),this._shadow&&Pn(this._shadow,l)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var l=this._map;if(l){var v=this.options.icon.options,A=v.iconSize?lt(v.iconSize):lt(0,0),B=v.iconAnchor?lt(v.iconAnchor):lt(0,0);l.panInside(this._latlng,{paddingTopLeft:B,paddingBottomRight:A.subtract(B)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function qu(l,v){return new hs(l,v)}var $a=ba.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(l){this._renderer=l.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(l){return be(this,l),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&l&&Object.prototype.hasOwnProperty.call(l,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ds=$a.extend({options:{fill:!0,radius:10},initialize:function(l,v){be(this,v),this._latlng=Lt(l),this._radius=this.options.radius},setLatLng:function(l){var v=this._latlng;return this._latlng=Lt(l),this.redraw(),this.fire("move",{oldLatLng:v,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(l){return this.options.radius=this._radius=l,this.redraw()},getRadius:function(){return this._radius},setStyle:function(l){var v=l&&l.radius||this._radius;return $a.prototype.setStyle.call(this,l),this.setRadius(v),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var l=this._radius,v=this._radiusY||l,A=this._clickTolerance(),B=[l+A,v+A];this._pxBounds=new _e(this._point.subtract(B),this._point.add(B))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(l){return l.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Gu(l,v){return new ds(l,v)}var hl=ds.extend({initialize:function(l,v,A){if(typeof v=="number"&&(v=O({},A,{radius:v})),be(this,v),this._latlng=Lt(l),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(l){return this._mRadius=l,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var l=[this._radius,this._radiusY||this._radius];return new yt(this._map.layerPointToLatLng(this._point.subtract(l)),this._map.layerPointToLatLng(this._point.add(l)))},setStyle:$a.prototype.setStyle,_project:function(){var l=this._latlng.lng,v=this._latlng.lat,A=this._map,B=A.options.crs;if(B.distance===ui.distance){var H=Math.PI/180,ae=this._mRadius/ui.R/H,Ae=A.project([v+ae,l]),Ve=A.project([v-ae,l]),at=Ae.add(Ve).divideBy(2),Mt=A.unproject(at).lat,Zt=Math.acos((Math.cos(ae*H)-Math.sin(v*H)*Math.sin(Mt*H))/(Math.cos(v*H)*Math.cos(Mt*H)))/H;(isNaN(Zt)||Zt===0)&&(Zt=ae/Math.cos(Math.PI/180*v)),this._point=at.subtract(A.getPixelOrigin()),this._radius=isNaN(Zt)?0:at.x-A.project([Mt,l-Zt]).x,this._radiusY=at.y-Ae.y}else{var ci=B.unproject(B.project(this._latlng).subtract([this._mRadius,0]));this._point=A.latLngToLayerPoint(this._latlng),this._radius=this._point.x-A.latLngToLayerPoint(ci).x}this._updateBounds()}});function Lh(l,v,A){return new hl(l,v,A)}var ro=$a.extend({options:{smoothFactor:1,noClip:!1},initialize:function(l,v){be(this,v),this._setLatLngs(l)},getLatLngs:function(){return this._latlngs},setLatLngs:function(l){return this._setLatLngs(l),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(l){for(var v=1/0,A=null,B=zs,H,ae,Ae=0,Ve=this._parts.length;Ae<Ve;Ae++)for(var at=this._parts[Ae],Mt=1,Zt=at.length;Mt<Zt;Mt++){H=at[Mt-1],ae=at[Mt];var ci=B(l,H,ae,!0);ci<v&&(v=ci,A=B(l,H,ae))}return A&&(A.distance=Math.sqrt(v)),A},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return cl(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(l,v){return v=v||this._defaultShape(),l=Lt(l),v.push(l),this._bounds.extend(l),this.redraw()},_setLatLngs:function(l){this._bounds=new yt,this._latlngs=this._convertLatLngs(l)},_defaultShape:function(){return Nr(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(l){for(var v=[],A=Nr(l),B=0,H=l.length;B<H;B++)A?(v[B]=Lt(l[B]),this._bounds.extend(v[B])):v[B]=this._convertLatLngs(l[B]);return v},_project:function(){var l=new _e;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,l),this._bounds.isValid()&&l.isValid()&&(this._rawPxBounds=l,this._updateBounds())},_updateBounds:function(){var l=this._clickTolerance(),v=new st(l,l);this._rawPxBounds&&(this._pxBounds=new _e([this._rawPxBounds.min.subtract(v),this._rawPxBounds.max.add(v)]))},_projectLatlngs:function(l,v,A){var B=l[0]instanceof Dt,H=l.length,ae,Ae;if(B){for(Ae=[],ae=0;ae<H;ae++)Ae[ae]=this._map.latLngToLayerPoint(l[ae]),A.extend(Ae[ae]);v.push(Ae)}else for(ae=0;ae<H;ae++)this._projectLatlngs(l[ae],v,A)},_clipPoints:function(){var l=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(l))){if(this.options.noClip){this._parts=this._rings;return}var v=this._parts,A,B,H,ae,Ae,Ve,at;for(A=0,H=0,ae=this._rings.length;A<ae;A++)for(at=this._rings[A],B=0,Ae=at.length;B<Ae-1;B++)Ve=gc(at[B],at[B+1],l,B,!0),Ve&&(v[H]=v[H]||[],v[H].push(Ve[0]),(Ve[1]!==at[B+1]||B===Ae-2)&&(v[H].push(Ve[1]),H++))}},_simplifyPoints:function(){for(var l=this._parts,v=this.options.smoothFactor,A=0,B=l.length;A<B;A++)l[A]=Fl(l[A],v)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(l,v){var A,B,H,ae,Ae,Ve,at=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(l))return!1;for(A=0,ae=this._parts.length;A<ae;A++)for(Ve=this._parts[A],B=0,Ae=Ve.length,H=Ae-1;B<Ae;H=B++)if(!(!v&&B===0)&&jn(l,Ve[H],Ve[B])<=at)return!0;return!1}});function kh(l,v){return new ro(l,v)}ro._flat=$n;var Is=ro.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return zn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(l){var v=ro.prototype._convertLatLngs.call(this,l),A=v.length;return A>=2&&v[0]instanceof Dt&&v[0].equals(v[A-1])&&v.pop(),v},_setLatLngs:function(l){ro.prototype._setLatLngs.call(this,l),Nr(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Nr(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var l=this._renderer._bounds,v=this.options.weight,A=new st(v,v);if(l=new _e(l.min.subtract(A),l.max.add(A)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(l))){if(this.options.noClip){this._parts=this._rings;return}for(var B=0,H=this._rings.length,ae;B<H;B++)ae=cs(this._rings[B],l,!0),ae.length&&this._parts.push(ae)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(l){var v=!1,A,B,H,ae,Ae,Ve,at,Mt;if(!this._pxBounds||!this._pxBounds.contains(l))return!1;for(ae=0,at=this._parts.length;ae<at;ae++)for(A=this._parts[ae],Ae=0,Mt=A.length,Ve=Mt-1;Ae<Mt;Ve=Ae++)B=A[Ae],H=A[Ve],B.y>l.y!=H.y>l.y&&l.x<(H.x-B.x)*(l.y-B.y)/(H.y-B.y)+B.x&&(v=!v);return v||ro.prototype._containsPoint.call(this,l,!0)}});function Rh(l,v){return new Is(l,v)}var fs=Ga.extend({initialize:function(l,v){be(this,v),this._layers={},l&&this.addData(l)},addData:function(l){var v=Fe(l)?l:l.features,A,B,H;if(v){for(A=0,B=v.length;A<B;A++)H=v[A],(H.geometries||H.geometry||H.features||H.coordinates)&&this.addData(H);return this}var ae=this.options;if(ae.filter&&!ae.filter(l))return this;var Ae=Fr(l,ae);return Ae?(Ae.feature=fl(l),Ae.defaultOptions=Ae.options,this.resetStyle(Ae),ae.onEachFeature&&ae.onEachFeature(l,Ae),this.addLayer(Ae)):this},resetStyle:function(l){return l===void 0?this.eachLayer(this.resetStyle,this):(l.options=O({},l.defaultOptions),this._setLayerStyle(l,this.options.style),this)},setStyle:function(l){return this.eachLayer(function(v){this._setLayerStyle(v,l)},this)},_setLayerStyle:function(l,v){l.setStyle&&(typeof v=="function"&&(v=v(l.feature)),l.setStyle(v))}});function Fr(l,v){var A=l.type==="Feature"?l.geometry:l,B=A?A.coordinates:null,H=[],ae=v&&v.pointToLayer,Ae=v&&v.coordsToLatLng||wa,Ve,at,Mt,Zt;if(!B&&!A)return null;switch(A.type){case"Point":return Ve=Ae(B),ao(ae,l,Ve,v);case"MultiPoint":for(Mt=0,Zt=B.length;Mt<Zt;Mt++)Ve=Ae(B[Mt]),H.push(ao(ae,l,Ve,v));return new Ga(H);case"LineString":case"MultiLineString":return at=ko(B,A.type==="LineString"?0:1,Ae),new ro(at,v);case"Polygon":case"MultiPolygon":return at=ko(B,A.type==="Polygon"?1:2,Ae),new Is(at,v);case"GeometryCollection":for(Mt=0,Zt=A.geometries.length;Mt<Zt;Mt++){var ci=Fr({geometry:A.geometries[Mt],type:"Feature",properties:l.properties},v);ci&&H.push(ci)}return new Ga(H);case"FeatureCollection":for(Mt=0,Zt=A.features.length;Mt<Zt;Mt++){var Li=Fr(A.features[Mt],v);Li&&H.push(Li)}return new Ga(H);default:throw new Error("Invalid GeoJSON object.")}}function ao(l,v,A,B){return l?l(v,A):new hs(A,B&&B.markersInheritOptions&&B)}function wa(l){return new Dt(l[1],l[0],l[2])}function ko(l,v,A){for(var B=[],H=0,ae=l.length,Ae;H<ae;H++)Ae=v?ko(l[H],v-1,A):(A||wa)(l[H]),B.push(Ae);return B}function ql(l,v){return l=Lt(l),l.alt!==void 0?[De(l.lng,v),De(l.lat,v),De(l.alt,v)]:[De(l.lng,v),De(l.lat,v)]}function dl(l,v,A,B){for(var H=[],ae=0,Ae=l.length;ae<Ae;ae++)H.push(v?dl(l[ae],Nr(l[ae])?0:v-1,A,B):ql(l[ae],B));return!v&&A&&H.length>0&&H.push(H[0].slice()),H}function Ls(l,v){return l.feature?O({},l.feature,{geometry:v}):fl(v)}function fl(l){return l.type==="Feature"||l.type==="FeatureCollection"?l:{type:"Feature",properties:{},geometry:l}}var Ta={toGeoJSON:function(l){return Ls(this,{type:"Point",coordinates:ql(this.getLatLng(),l)})}};hs.include(Ta),hl.include(Ta),ds.include(Ta),ro.include({toGeoJSON:function(l){var v=!Nr(this._latlngs),A=dl(this._latlngs,v?1:0,!1,l);return Ls(this,{type:(v?"Multi":"")+"LineString",coordinates:A})}}),Is.include({toGeoJSON:function(l){var v=!Nr(this._latlngs),A=v&&!Nr(this._latlngs[0]),B=dl(this._latlngs,A?2:v?1:0,!0,l);return v||(B=[B]),Ls(this,{type:(A?"Multi":"")+"Polygon",coordinates:B})}}),ul.include({toMultiPoint:function(l){var v=[];return this.eachLayer(function(A){v.push(A.toGeoJSON(l).geometry.coordinates)}),Ls(this,{type:"MultiPoint",coordinates:v})},toGeoJSON:function(l){var v=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(v==="MultiPoint")return this.toMultiPoint(l);var A=v==="GeometryCollection",B=[];return this.eachLayer(function(H){if(H.toGeoJSON){var ae=H.toGeoJSON(l);if(A)B.push(ae.geometry);else{var Ae=fl(ae);Ae.type==="FeatureCollection"?B.push.apply(B,Ae.features):B.push(Ae)}}}),A?Ls(this,{geometries:B,type:"GeometryCollection"}):{type:"FeatureCollection",features:B}}});function Gl(l,v){return new fs(l,v)}var vc=Gl,pl=ba.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(l,v,A){this._url=l,this._bounds=Pt(v),be(this,A)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Si(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){nn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(l){return this.options.opacity=l,this._image&&this._updateOpacity(),this},setStyle:function(l){return l.opacity&&this.setOpacity(l.opacity),this},bringToFront:function(){return this._map&&Ri(this._image),this},bringToBack:function(){return this._map&&Mo(this._image),this},setUrl:function(l){return this._url=l,this._image&&(this._image.src=l),this},setBounds:function(l){return this._bounds=Pt(l),this._map&&this._reset(),this},getEvents:function(){var l={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(l.zoomanim=this._animateZoom),l},setZIndex:function(l){return this.options.zIndex=l,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var l=this._url.tagName==="IMG",v=this._image=l?this._url:qi("img");if(Si(v,"leaflet-image-layer"),this._zoomAnimated&&Si(v,"leaflet-zoom-animated"),this.options.className&&Si(v,this.options.className),v.onselectstart=ue,v.onmousemove=ue,v.onload=D(this.fire,this,"load"),v.onerror=D(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(v.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),l){this._url=v.src;return}v.src=this._url,v.alt=this.options.alt},_animateZoom:function(l){var v=this._map.getZoomScale(l.zoom),A=this._map._latLngBoundsToNewLayerBounds(this._bounds,l.zoom,l.center).min;ss(this._image,A,v)},_reset:function(){var l=this._image,v=new _e(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),A=v.getSize();Sn(l,v.min),l.style.width=A.x+"px",l.style.height=A.y+"px"},_updateOpacity:function(){Pn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var l=this.options.errorOverlayUrl;l&&this._url!==l&&(this._url=l,this._image.src=l)},getCenter:function(){return this._bounds.getCenter()}}),Oh=function(l,v,A){return new pl(l,v,A)},Ro=pl.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var l=this._url.tagName==="VIDEO",v=this._image=l?this._url:qi("video");if(Si(v,"leaflet-image-layer"),this._zoomAnimated&&Si(v,"leaflet-zoom-animated"),this.options.className&&Si(v,this.options.className),v.onselectstart=ue,v.onmousemove=ue,v.onloadeddata=D(this.fire,this,"load"),l){for(var A=v.getElementsByTagName("source"),B=[],H=0;H<A.length;H++)B.push(A[H].src);this._url=A.length>0?B:[v.src];return}Fe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(v.style,"objectFit")&&(v.style.objectFit="fill"),v.autoplay=!!this.options.autoplay,v.loop=!!this.options.loop,v.muted=!!this.options.muted,v.playsInline=!!this.options.playsInline;for(var ae=0;ae<this._url.length;ae++){var Ae=qi("source");Ae.src=this._url[ae],v.appendChild(Ae)}}});function ml(l,v,A){return new Ro(l,v,A)}var ou=pl.extend({_initImage:function(){var l=this._image=this._url;Si(l,"leaflet-image-layer"),this._zoomAnimated&&Si(l,"leaflet-zoom-animated"),this.options.className&&Si(l,this.options.className),l.onselectstart=ue,l.onmousemove=ue}});function $i(l,v,A){return new ou(l,v,A)}var br=ba.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(l,v){l&&(l instanceof Dt||Fe(l))?(this._latlng=Lt(l),be(this,v)):(be(this,l),this._source=v),this.options.content&&(this._content=this.options.content)},openOn:function(l){return l=arguments.length?l:this._source._map,l.hasLayer(this)||l.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(l){return this._map?this.close():(arguments.length?this._source=l:l=this._source,this._prepareOpen(),this.openOn(l._map)),this},onAdd:function(l){this._zoomAnimated=l._zoomAnimated,this._container||this._initLayout(),l._fadeAnimated&&Pn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),l._fadeAnimated&&Pn(this._container,1),this.bringToFront(),this.options.interactive&&(Si(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(l){l._fadeAnimated?(Pn(this._container,0),this._removeTimeout=setTimeout(D(nn,void 0,this._container),200)):nn(this._container),this.options.interactive&&(Hn(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(l){return this._latlng=Lt(l),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(l){return this._content=l,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var l={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(l.zoomanim=this._animateZoom),l},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ri(this._container),this},bringToBack:function(){return this._map&&Mo(this._container),this},_prepareOpen:function(l){var v=this._source;if(!v._map)return!1;if(v instanceof Ga){v=null;var A=this._source._layers;for(var B in A)if(A[B]._map){v=A[B];break}if(!v)return!1;this._source=v}if(!l)if(v.getCenter)l=v.getCenter();else if(v.getLatLng)l=v.getLatLng();else if(v.getBounds)l=v.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(l),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var l=this._contentNode,v=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof v=="string")l.innerHTML=v;else{for(;l.hasChildNodes();)l.removeChild(l.firstChild);l.appendChild(v)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var l=this._map.latLngToLayerPoint(this._latlng),v=lt(this.options.offset),A=this._getAnchor();this._zoomAnimated?Sn(this._container,l.add(A)):v=v.add(l).add(A);var B=this._containerBottom=-v.y,H=this._containerLeft=-Math.round(this._containerWidth/2)+v.x;this._container.style.bottom=B+"px",this._container.style.left=H+"px"}},_getAnchor:function(){return[0,0]}});Ii.include({_initOverlay:function(l,v,A,B){var H=v;return H instanceof l||(H=new l(B).setContent(v)),A&&H.setLatLng(A),H}}),ba.include({_initOverlay:function(l,v,A,B){var H=A;return H instanceof l?(be(H,B),H._source=this):(H=v&&!B?v:new l(B,this),H.setContent(A)),H}});var Oo=br.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(l){return l=arguments.length?l:this._source._map,!l.hasLayer(this)&&l._popup&&l._popup.options.autoClose&&l.removeLayer(l._popup),l._popup=this,br.prototype.openOn.call(this,l)},onAdd:function(l){br.prototype.onAdd.call(this,l),l.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof $a||this._source.on("preclick",Rn))},onRemove:function(l){br.prototype.onRemove.call(this,l),l.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof $a||this._source.off("preclick",Rn))},getEvents:function(){var l=br.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(l.preclick=this.close),this.options.keepInView&&(l.moveend=this._adjustPan),l},_initLayout:function(){var l="leaflet-popup",v=this._container=qi("div",l+" "+(this.options.className||"")+" leaflet-zoom-animated"),A=this._wrapper=qi("div",l+"-content-wrapper",v);if(this._contentNode=qi("div",l+"-content",A),ya(v),ra(this._contentNode),ii(v,"contextmenu",Rn),this._tipContainer=qi("div",l+"-tip-container",v),this._tip=qi("div",l+"-tip",this._tipContainer),this.options.closeButton){var B=this._closeButton=qi("a",l+"-close-button",v);B.setAttribute("role","button"),B.setAttribute("aria-label","Close popup"),B.href="#close",B.innerHTML='<span aria-hidden="true">&#215;</span>',ii(B,"click",function(H){Pi(H),this.close()},this)}},_updateLayout:function(){var l=this._contentNode,v=l.style;v.width="",v.whiteSpace="nowrap";var A=l.offsetWidth;A=Math.min(A,this.options.maxWidth),A=Math.max(A,this.options.minWidth),v.width=A+1+"px",v.whiteSpace="",v.height="";var B=l.offsetHeight,H=this.options.maxHeight,ae="leaflet-popup-scrolled";H&&B>H?(v.height=H+"px",Si(l,ae)):Hn(l,ae),this._containerWidth=this._container.offsetWidth},_animateZoom:function(l){var v=this._map._latLngToNewLayerPoint(this._latlng,l.zoom,l.center),A=this._getAnchor();Sn(this._container,v.add(A))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var l=this._map,v=parseInt(ia(this._container,"marginBottom"),10)||0,A=this._container.offsetHeight+v,B=this._containerWidth,H=new st(this._containerLeft,-A-this._containerBottom);H._add(Ao(this._container));var ae=l.layerPointToContainerPoint(H),Ae=lt(this.options.autoPanPadding),Ve=lt(this.options.autoPanPaddingTopLeft||Ae),at=lt(this.options.autoPanPaddingBottomRight||Ae),Mt=l.getSize(),Zt=0,ci=0;ae.x+B+at.x>Mt.x&&(Zt=ae.x+B-Mt.x+at.x),ae.x-Zt-Ve.x<0&&(Zt=ae.x-Ve.x),ae.y+A+at.y>Mt.y&&(ci=ae.y+A-Mt.y+at.y),ae.y-ci-Ve.y<0&&(ci=ae.y-Ve.y),(Zt||ci)&&(this.options.keepInView&&(this._autopanning=!0),l.fire("autopanstart").panBy([Zt,ci]))}},_getAnchor:function(){return lt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),xc=function(l,v){return new Oo(l,v)};Ii.mergeOptions({closePopupOnClick:!0}),Ii.include({openPopup:function(l,v,A){return this._initOverlay(Oo,l,v,A).openOn(this),this},closePopup:function(l){return l=arguments.length?l:this._popup,l&&l.close(),this}}),ba.include({bindPopup:function(l,v){return this._popup=this._initOverlay(Oo,this._popup,l,v),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(l){return this._popup&&(this instanceof Ga||(this._popup._source=this),this._popup._prepareOpen(l||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(l){return this._popup&&this._popup.setContent(l),this},getPopup:function(){return this._popup},_openPopup:function(l){if(!(!this._popup||!this._map)){va(l);var v=l.layer||l.target;if(this._popup._source===v&&!(v instanceof $a)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(l.latlng);return}this._popup._source=v,this.openPopup(l.latlng)}},_movePopup:function(l){this._popup.setLatLng(l.latlng)},_onKeyPress:function(l){l.originalEvent.keyCode===13&&this._openPopup(l)}});var gl=br.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(l){br.prototype.onAdd.call(this,l),this.setOpacity(this.options.opacity),l.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(l){br.prototype.onRemove.call(this,l),l.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var l=br.prototype.getEvents.call(this);return this.options.permanent||(l.preclick=this.close),l},_initLayout:function(){var l="leaflet-tooltip",v=l+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=qi("div",v),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+V(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(l){var v,A,B=this._map,H=this._container,ae=B.latLngToContainerPoint(B.getCenter()),Ae=B.layerPointToContainerPoint(l),Ve=this.options.direction,at=H.offsetWidth,Mt=H.offsetHeight,Zt=lt(this.options.offset),ci=this._getAnchor();Ve==="top"?(v=at/2,A=Mt):Ve==="bottom"?(v=at/2,A=0):Ve==="center"?(v=at/2,A=Mt/2):Ve==="right"?(v=0,A=Mt/2):Ve==="left"?(v=at,A=Mt/2):Ae.x<ae.x?(Ve="right",v=0,A=Mt/2):(Ve="left",v=at+(Zt.x+ci.x)*2,A=Mt/2),l=l.subtract(lt(v,A,!0)).add(Zt).add(ci),Hn(H,"leaflet-tooltip-right"),Hn(H,"leaflet-tooltip-left"),Hn(H,"leaflet-tooltip-top"),Hn(H,"leaflet-tooltip-bottom"),Si(H,"leaflet-tooltip-"+Ve),Sn(H,l)},_updatePosition:function(){var l=this._map.latLngToLayerPoint(this._latlng);this._setPosition(l)},setOpacity:function(l){this.options.opacity=l,this._container&&Pn(this._container,l)},_animateZoom:function(l){var v=this._map._latLngToNewLayerPoint(this._latlng,l.zoom,l.center);this._setPosition(v)},_getAnchor:function(){return lt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),_l=function(l,v){return new gl(l,v)};Ii.include({openTooltip:function(l,v,A){return this._initOverlay(gl,l,v,A).openOn(this),this},closeTooltip:function(l){return l.close(),this}}),ba.include({bindTooltip:function(l,v){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(gl,this._tooltip,l,v),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(l){if(!(!l&&this._tooltipHandlersAdded)){var v=l?"off":"on",A={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?A.add=this._openTooltip:(A.mouseover=this._openTooltip,A.mouseout=this.closeTooltip,A.click=this._openTooltip,this._map?this._addFocusListeners():A.add=this._addFocusListeners),this._tooltip.options.sticky&&(A.mousemove=this._moveTooltip),this[v](A),this._tooltipHandlersAdded=!l}},openTooltip:function(l){return this._tooltip&&(this instanceof Ga||(this._tooltip._source=this),this._tooltip._prepareOpen(l)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(l){return this._tooltip&&this._tooltip.setContent(l),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(l){var v=typeof l.getElement=="function"&&l.getElement();v&&(ii(v,"focus",function(){this._tooltip._source=l,this.openTooltip()},this),ii(v,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(l){var v=typeof l.getElement=="function"&&l.getElement();v&&v.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(l){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var v=this;this._map.once("moveend",function(){v._openOnceFlag=!1,v._openTooltip(l)});return}this._tooltip._source=l.layer||l.target,this.openTooltip(this._tooltip.options.sticky?l.latlng:void 0)}},_moveTooltip:function(l){var v=l.latlng,A,B;this._tooltip.options.sticky&&l.originalEvent&&(A=this._map.mouseEventToContainerPoint(l.originalEvent),B=this._map.containerPointToLayerPoint(A),v=this._map.layerPointToLatLng(B)),this._tooltip.setLatLng(v)}});var Hl=Ha.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(l){var v=l&&l.tagName==="DIV"?l:document.createElement("div"),A=this.options;if(A.html instanceof Element?(na(v),v.appendChild(A.html)):v.innerHTML=A.html!==!1?A.html:"",A.bgPos){var B=lt(A.bgPos);v.style.backgroundPosition=-B.x+"px "+-B.y+"px"}return this._setIconStyles(v,"icon"),v},createShadow:function(){return null}});function $l(l){return new Hl(l)}Ha.Default=Vl;var jr=ba.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Qe.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(l){be(this,l)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(l){l._addZoomLimit(this)},onRemove:function(l){this._removeAllTiles(),nn(this._container),l._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ri(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Mo(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(l){return this.options.opacity=l,this._updateOpacity(),this},setZIndex:function(l){return this.options.zIndex=l,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var l=this._clampZoom(this._map.getZoom());l!==this._tileZoom&&(this._tileZoom=l,this._updateLevels()),this._update()}return this},getEvents:function(){var l={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=te(this._onMoveEnd,this.options.updateInterval,this)),l.move=this._onMove),this._zoomAnimated&&(l.zoomanim=this._animateZoom),l},createTile:function(){return document.createElement("div")},getTileSize:function(){var l=this.options.tileSize;return l instanceof st?l:new st(l,l)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(l){for(var v=this.getPane().children,A=-l(-1/0,1/0),B=0,H=v.length,ae;B<H;B++)ae=v[B].style.zIndex,v[B]!==this._container&&ae&&(A=l(A,+ae));isFinite(A)&&(this.options.zIndex=A+l(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Qe.ielt9){Pn(this._container,this.options.opacity);var l=+new Date,v=!1,A=!1;for(var B in this._tiles){var H=this._tiles[B];if(!(!H.current||!H.loaded)){var ae=Math.min(1,(l-H.loaded)/200);Pn(H.el,ae),ae<1?v=!0:(H.active?A=!0:this._onOpaqueTile(H),H.active=!0)}}A&&!this._noPrune&&this._pruneTiles(),v&&(Yt(this._fadeFrame),this._fadeFrame=Ot(this._updateOpacity,this))}},_onOpaqueTile:ue,_initContainer:function(){this._container||(this._container=qi("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var l=this._tileZoom,v=this.options.maxZoom;if(l!==void 0){for(var A in this._levels)A=Number(A),this._levels[A].el.children.length||A===l?(this._levels[A].el.style.zIndex=v-Math.abs(l-A),this._onUpdateLevel(A)):(nn(this._levels[A].el),this._removeTilesAtZoom(A),this._onRemoveLevel(A),delete this._levels[A]);var B=this._levels[l],H=this._map;return B||(B=this._levels[l]={},B.el=qi("div","leaflet-tile-container leaflet-zoom-animated",this._container),B.el.style.zIndex=v,B.origin=H.project(H.unproject(H.getPixelOrigin()),l).round(),B.zoom=l,this._setZoomTransform(B,H.getCenter(),H.getZoom()),ue(B.el.offsetWidth),this._onCreateLevel(B)),this._level=B,B}},_onUpdateLevel:ue,_onRemoveLevel:ue,_onCreateLevel:ue,_pruneTiles:function(){if(this._map){var l,v,A=this._map.getZoom();if(A>this.options.maxZoom||A<this.options.minZoom){this._removeAllTiles();return}for(l in this._tiles)v=this._tiles[l],v.retain=v.current;for(l in this._tiles)if(v=this._tiles[l],v.current&&!v.active){var B=v.coords;this._retainParent(B.x,B.y,B.z,B.z-5)||this._retainChildren(B.x,B.y,B.z,B.z+2)}for(l in this._tiles)this._tiles[l].retain||this._removeTile(l)}},_removeTilesAtZoom:function(l){for(var v in this._tiles)this._tiles[v].coords.z===l&&this._removeTile(v)},_removeAllTiles:function(){for(var l in this._tiles)this._removeTile(l)},_invalidateAll:function(){for(var l in this._levels)nn(this._levels[l].el),this._onRemoveLevel(Number(l)),delete this._levels[l];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(l,v,A,B){var H=Math.floor(l/2),ae=Math.floor(v/2),Ae=A-1,Ve=new st(+H,+ae);Ve.z=+Ae;var at=this._tileCoordsToKey(Ve),Mt=this._tiles[at];return Mt&&Mt.active?(Mt.retain=!0,!0):(Mt&&Mt.loaded&&(Mt.retain=!0),Ae>B?this._retainParent(H,ae,Ae,B):!1)},_retainChildren:function(l,v,A,B){for(var H=2*l;H<2*l+2;H++)for(var ae=2*v;ae<2*v+2;ae++){var Ae=new st(H,ae);Ae.z=A+1;var Ve=this._tileCoordsToKey(Ae),at=this._tiles[Ve];if(at&&at.active){at.retain=!0;continue}else at&&at.loaded&&(at.retain=!0);A+1<B&&this._retainChildren(H,ae,A+1,B)}},_resetView:function(l){var v=l&&(l.pinch||l.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),v,v)},_animateZoom:function(l){this._setView(l.center,l.zoom,!0,l.noUpdate)},_clampZoom:function(l){var v=this.options;return v.minNativeZoom!==void 0&&l<v.minNativeZoom?v.minNativeZoom:v.maxNativeZoom!==void 0&&v.maxNativeZoom<l?v.maxNativeZoom:l},_setView:function(l,v,A,B){var H=Math.round(v);this.options.maxZoom!==void 0&&H>this.options.maxZoom||this.options.minZoom!==void 0&&H<this.options.minZoom?H=void 0:H=this._clampZoom(H);var ae=this.options.updateWhenZooming&&H!==this._tileZoom;(!B||ae)&&(this._tileZoom=H,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),H!==void 0&&this._update(l),A||this._pruneTiles(),this._noPrune=!!A),this._setZoomTransforms(l,v)},_setZoomTransforms:function(l,v){for(var A in this._levels)this._setZoomTransform(this._levels[A],l,v)},_setZoomTransform:function(l,v,A){var B=this._map.getZoomScale(A,l.zoom),H=l.origin.multiplyBy(B).subtract(this._map._getNewPixelOrigin(v,A)).round();Qe.any3d?ss(l.el,H,B):Sn(l.el,H)},_resetGrid:function(){var l=this._map,v=l.options.crs,A=this._tileSize=this.getTileSize(),B=this._tileZoom,H=this._map.getPixelWorldBounds(this._tileZoom);H&&(this._globalTileRange=this._pxBoundsToTileRange(H)),this._wrapX=v.wrapLng&&!this.options.noWrap&&[Math.floor(l.project([0,v.wrapLng[0]],B).x/A.x),Math.ceil(l.project([0,v.wrapLng[1]],B).x/A.y)],this._wrapY=v.wrapLat&&!this.options.noWrap&&[Math.floor(l.project([v.wrapLat[0],0],B).y/A.x),Math.ceil(l.project([v.wrapLat[1],0],B).y/A.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(l){var v=this._map,A=v._animatingZoom?Math.max(v._animateToZoom,v.getZoom()):v.getZoom(),B=v.getZoomScale(A,this._tileZoom),H=v.project(l,this._tileZoom).floor(),ae=v.getSize().divideBy(B*2);return new _e(H.subtract(ae),H.add(ae))},_update:function(l){var v=this._map;if(v){var A=this._clampZoom(v.getZoom());if(l===void 0&&(l=v.getCenter()),this._tileZoom!==void 0){var B=this._getTiledPixelBounds(l),H=this._pxBoundsToTileRange(B),ae=H.getCenter(),Ae=[],Ve=this.options.keepBuffer,at=new _e(H.getBottomLeft().subtract([Ve,-Ve]),H.getTopRight().add([Ve,-Ve]));if(!(isFinite(H.min.x)&&isFinite(H.min.y)&&isFinite(H.max.x)&&isFinite(H.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Mt in this._tiles){var Zt=this._tiles[Mt].coords;(Zt.z!==this._tileZoom||!at.contains(new st(Zt.x,Zt.y)))&&(this._tiles[Mt].current=!1)}if(Math.abs(A-this._tileZoom)>1){this._setView(l,A);return}for(var ci=H.min.y;ci<=H.max.y;ci++)for(var Li=H.min.x;Li<=H.max.x;Li++){var lr=new st(Li,ci);if(lr.z=this._tileZoom,!!this._isValidTile(lr)){var Xn=this._tiles[this._tileCoordsToKey(lr)];Xn?Xn.current=!0:Ae.push(lr)}}if(Ae.sort(function(on,Xi){return on.distanceTo(ae)-Xi.distanceTo(ae)}),Ae.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Aa=document.createDocumentFragment();for(Li=0;Li<Ae.length;Li++)this._addTile(Ae[Li],Aa);this._level.el.appendChild(Aa)}}}},_isValidTile:function(l){var v=this._map.options.crs;if(!v.infinite){var A=this._globalTileRange;if(!v.wrapLng&&(l.x<A.min.x||l.x>A.max.x)||!v.wrapLat&&(l.y<A.min.y||l.y>A.max.y))return!1}if(!this.options.bounds)return!0;var B=this._tileCoordsToBounds(l);return Pt(this.options.bounds).overlaps(B)},_keyToBounds:function(l){return this._tileCoordsToBounds(this._keyToTileCoords(l))},_tileCoordsToNwSe:function(l){var v=this._map,A=this.getTileSize(),B=l.scaleBy(A),H=B.add(A),ae=v.unproject(B,l.z),Ae=v.unproject(H,l.z);return[ae,Ae]},_tileCoordsToBounds:function(l){var v=this._tileCoordsToNwSe(l),A=new yt(v[0],v[1]);return this.options.noWrap||(A=this._map.wrapLatLngBounds(A)),A},_tileCoordsToKey:function(l){return l.x+":"+l.y+":"+l.z},_keyToTileCoords:function(l){var v=l.split(":"),A=new st(+v[0],+v[1]);return A.z=+v[2],A},_removeTile:function(l){var v=this._tiles[l];v&&(nn(v.el),delete this._tiles[l],this.fire("tileunload",{tile:v.el,coords:this._keyToTileCoords(l)}))},_initTile:function(l){Si(l,"leaflet-tile");var v=this.getTileSize();l.style.width=v.x+"px",l.style.height=v.y+"px",l.onselectstart=ue,l.onmousemove=ue,Qe.ielt9&&this.options.opacity<1&&Pn(l,this.options.opacity)},_addTile:function(l,v){var A=this._getTilePos(l),B=this._tileCoordsToKey(l),H=this.createTile(this._wrapCoords(l),D(this._tileReady,this,l));this._initTile(H),this.createTile.length<2&&Ot(D(this._tileReady,this,l,null,H)),Sn(H,A),this._tiles[B]={el:H,coords:l,current:!0},v.appendChild(H),this.fire("tileloadstart",{tile:H,coords:l})},_tileReady:function(l,v,A){v&&this.fire("tileerror",{error:v,tile:A,coords:l});var B=this._tileCoordsToKey(l);A=this._tiles[B],A&&(A.loaded=+new Date,this._map._fadeAnimated?(Pn(A.el,0),Yt(this._fadeFrame),this._fadeFrame=Ot(this._updateOpacity,this)):(A.active=!0,this._pruneTiles()),v||(Si(A.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:A.el,coords:l})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Qe.ielt9||!this._map._fadeAnimated?Ot(this._pruneTiles,this):setTimeout(D(this._pruneTiles,this),250)))},_getTilePos:function(l){return l.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(l){var v=new st(this._wrapX?fe(l.x,this._wrapX):l.x,this._wrapY?fe(l.y,this._wrapY):l.y);return v.z=l.z,v},_pxBoundsToTileRange:function(l){var v=this.getTileSize();return new _e(l.min.unscaleBy(v).floor(),l.max.unscaleBy(v).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var l in this._tiles)if(!this._tiles[l].loaded)return!1;return!0}});function Hu(l){return new jr(l)}var so=jr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(l,v){this._url=l,v=be(this,v),v.detectRetina&&Qe.retina&&v.maxZoom>0?(v.tileSize=Math.floor(v.tileSize/2),v.zoomReverse?(v.zoomOffset--,v.minZoom=Math.min(v.maxZoom,v.minZoom+1)):(v.zoomOffset++,v.maxZoom=Math.max(v.minZoom,v.maxZoom-1)),v.minZoom=Math.max(0,v.minZoom)):v.zoomReverse?v.minZoom=Math.min(v.maxZoom,v.minZoom):v.maxZoom=Math.max(v.minZoom,v.maxZoom),typeof v.subdomains=="string"&&(v.subdomains=v.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(l,v){return this._url===l&&v===void 0&&(v=!0),this._url=l,v||this.redraw(),this},createTile:function(l,v){var A=document.createElement("img");return ii(A,"load",D(this._tileOnLoad,this,v,A)),ii(A,"error",D(this._tileOnError,this,v,A)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(A.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(A.referrerPolicy=this.options.referrerPolicy),A.alt="",A.src=this.getTileUrl(l),A},getTileUrl:function(l){var v={r:Qe.retina?"@2x":"",s:this._getSubdomain(l),x:l.x,y:l.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var A=this._globalTileRange.max.y-l.y;this.options.tms&&(v.y=A),v["-y"]=A}return ut(this._url,O(v,this.options))},_tileOnLoad:function(l,v){Qe.ielt9?setTimeout(D(l,this,null,v),0):l(null,v)},_tileOnError:function(l,v,A){var B=this.options.errorTileUrl;B&&v.getAttribute("src")!==B&&(v.src=B),l(A,v)},_onTileRemove:function(l){l.tile.onload=null},_getZoomForUrl:function(){var l=this._tileZoom,v=this.options.maxZoom,A=this.options.zoomReverse,B=this.options.zoomOffset;return A&&(l=v-l),l+B},_getSubdomain:function(l){var v=Math.abs(l.x+l.y)%this.options.subdomains.length;return this.options.subdomains[v]},_abortLoading:function(){var l,v;for(l in this._tiles)if(this._tiles[l].coords.z!==this._tileZoom&&(v=this._tiles[l].el,v.onload=ue,v.onerror=ue,!v.complete)){v.src=Rt;var A=this._tiles[l].coords;nn(v),delete this._tiles[l],this.fire("tileabort",{tile:v,coords:A})}},_removeTile:function(l){var v=this._tiles[l];if(v)return v.el.setAttribute("src",Rt),jr.prototype._removeTile.call(this,l)},_tileReady:function(l,v,A){if(!(!this._map||A&&A.getAttribute("src")===Rt))return jr.prototype._tileReady.call(this,l,v,A)}});function Sa(l,v){return new so(l,v)}var ps=so.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(l,v){this._url=l;var A=O({},this.defaultWmsParams);for(var B in v)B in this.options||(A[B]=v[B]);v=be(this,v);var H=v.detectRetina&&Qe.retina?2:1,ae=this.getTileSize();A.width=ae.x*H,A.height=ae.y*H,this.wmsParams=A},onAdd:function(l){this._crs=this.options.crs||l.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var v=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[v]=this._crs.code,so.prototype.onAdd.call(this,l)},getTileUrl:function(l){var v=this._tileCoordsToNwSe(l),A=this._crs,B=Ue(A.project(v[0]),A.project(v[1])),H=B.min,ae=B.max,Ae=(this._wmsVersion>=1.3&&this._crs===Zu?[H.y,H.x,ae.y,ae.x]:[H.x,H.y,ae.x,ae.y]).join(","),Ve=so.prototype.getTileUrl.call(this,l);return Ve+de(this.wmsParams,Ve,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Ae},setParams:function(l,v){return O(this.wmsParams,l),v||this.redraw(),this}});function sa(l,v){return new ps(l,v)}so.WMS=ps,Sa.wms=sa;var Ur=ba.extend({options:{padding:.1},initialize:function(l){be(this,l),V(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Si(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var l={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(l.zoomanim=this._onAnimZoom),l},_onAnimZoom:function(l){this._updateTransform(l.center,l.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(l,v){var A=this._map.getZoomScale(v,this._zoom),B=this._map.getSize().multiplyBy(.5+this.options.padding),H=this._map.project(this._center,v),ae=B.multiplyBy(-A).add(H).subtract(this._map._getNewPixelOrigin(l,v));Qe.any3d?ss(this._container,ae,A):Sn(this._container,ae)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var l in this._layers)this._layers[l]._reset()},_onZoomEnd:function(){for(var l in this._layers)this._layers[l]._project()},_updatePaths:function(){for(var l in this._layers)this._layers[l]._update()},_update:function(){var l=this.options.padding,v=this._map.getSize(),A=this._map.containerPointToLayerPoint(v.multiplyBy(-l)).round();this._bounds=new _e(A,A.add(v.multiplyBy(1+l*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Bo=Ur.extend({options:{tolerance:0},getEvents:function(){var l=Ur.prototype.getEvents.call(this);return l.viewprereset=this._onViewPreReset,l},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ur.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var l=this._container=document.createElement("canvas");ii(l,"mousemove",this._onMouseMove,this),ii(l,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ii(l,"mouseout",this._handleMouseOut,this),l._leaflet_disable_events=!0,this._ctx=l.getContext("2d")},_destroyContainer:function(){Yt(this._redrawRequest),delete this._ctx,nn(this._container),$t(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var l;this._redrawBounds=null;for(var v in this._layers)l=this._layers[v],l._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ur.prototype._update.call(this);var l=this._bounds,v=this._container,A=l.getSize(),B=Qe.retina?2:1;Sn(v,l.min),v.width=B*A.x,v.height=B*A.y,v.style.width=A.x+"px",v.style.height=A.y+"px",Qe.retina&&this._ctx.scale(2,2),this._ctx.translate(-l.min.x,-l.min.y),this.fire("update")}},_reset:function(){Ur.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(l){this._updateDashArray(l),this._layers[V(l)]=l;var v=l._order={layer:l,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=v),this._drawLast=v,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(l){this._requestRedraw(l)},_removePath:function(l){var v=l._order,A=v.next,B=v.prev;A?A.prev=B:this._drawLast=B,B?B.next=A:this._drawFirst=A,delete l._order,delete this._layers[V(l)],this._requestRedraw(l)},_updatePath:function(l){this._extendRedrawBounds(l),l._project(),l._update(),this._requestRedraw(l)},_updateStyle:function(l){this._updateDashArray(l),this._requestRedraw(l)},_updateDashArray:function(l){if(typeof l.options.dashArray=="string"){var v=l.options.dashArray.split(/[, ]+/),A=[],B,H;for(H=0;H<v.length;H++){if(B=Number(v[H]),isNaN(B))return;A.push(B)}l.options._dashArray=A}else l.options._dashArray=l.options.dashArray},_requestRedraw:function(l){this._map&&(this._extendRedrawBounds(l),this._redrawRequest=this._redrawRequest||Ot(this._redraw,this))},_extendRedrawBounds:function(l){if(l._pxBounds){var v=(l.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new _e,this._redrawBounds.extend(l._pxBounds.min.subtract([v,v])),this._redrawBounds.extend(l._pxBounds.max.add([v,v]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var l=this._redrawBounds;if(l){var v=l.getSize();this._ctx.clearRect(l.min.x,l.min.y,v.x,v.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var l,v=this._redrawBounds;if(this._ctx.save(),v){var A=v.getSize();this._ctx.beginPath(),this._ctx.rect(v.min.x,v.min.y,A.x,A.y),this._ctx.clip()}this._drawing=!0;for(var B=this._drawFirst;B;B=B.next)l=B.layer,(!v||l._pxBounds&&l._pxBounds.intersects(v))&&l._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(l,v){if(this._drawing){var A,B,H,ae,Ae=l._parts,Ve=Ae.length,at=this._ctx;if(Ve){for(at.beginPath(),A=0;A<Ve;A++){for(B=0,H=Ae[A].length;B<H;B++)ae=Ae[A][B],at[B?"lineTo":"moveTo"](ae.x,ae.y);v&&at.closePath()}this._fillStroke(at,l)}}},_updateCircle:function(l){if(!(!this._drawing||l._empty())){var v=l._point,A=this._ctx,B=Math.max(Math.round(l._radius),1),H=(Math.max(Math.round(l._radiusY),1)||B)/B;H!==1&&(A.save(),A.scale(1,H)),A.beginPath(),A.arc(v.x,v.y/H,B,0,Math.PI*2,!1),H!==1&&A.restore(),this._fillStroke(A,l)}},_fillStroke:function(l,v){var A=v.options;A.fill&&(l.globalAlpha=A.fillOpacity,l.fillStyle=A.fillColor||A.color,l.fill(A.fillRule||"evenodd")),A.stroke&&A.weight!==0&&(l.setLineDash&&l.setLineDash(v.options&&v.options._dashArray||[]),l.globalAlpha=A.opacity,l.lineWidth=A.weight,l.strokeStyle=A.color,l.lineCap=A.lineCap,l.lineJoin=A.lineJoin,l.stroke())},_onClick:function(l){for(var v=this._map.mouseEventToLayerPoint(l),A,B,H=this._drawFirst;H;H=H.next)A=H.layer,A.options.interactive&&A._containsPoint(v)&&(!(l.type==="click"||l.type==="preclick")||!this._map._draggableMoved(A))&&(B=A);this._fireEvent(B?[B]:!1,l)},_onMouseMove:function(l){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var v=this._map.mouseEventToLayerPoint(l);this._handleMouseHover(l,v)}},_handleMouseOut:function(l){var v=this._hoveredLayer;v&&(Hn(this._container,"leaflet-interactive"),this._fireEvent([v],l,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(l,v){if(!this._mouseHoverThrottled){for(var A,B,H=this._drawFirst;H;H=H.next)A=H.layer,A.options.interactive&&A._containsPoint(v)&&(B=A);B!==this._hoveredLayer&&(this._handleMouseOut(l),B&&(Si(this._container,"leaflet-interactive"),this._fireEvent([B],l,"mouseover"),this._hoveredLayer=B)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,l),this._mouseHoverThrottled=!0,setTimeout(D(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(l,v,A){this._map._fireDOMEvent(v,A||v.type,l)},_bringToFront:function(l){var v=l._order;if(v){var A=v.next,B=v.prev;if(A)A.prev=B;else return;B?B.next=A:A&&(this._drawFirst=A),v.prev=this._drawLast,this._drawLast.next=v,v.next=null,this._drawLast=v,this._requestRedraw(l)}},_bringToBack:function(l){var v=l._order;if(v){var A=v.next,B=v.prev;if(B)B.next=A;else return;A?A.prev=B:B&&(this._drawLast=B),v.prev=null,v.next=this._drawFirst,this._drawFirst.prev=v,this._drawFirst=v,this._requestRedraw(l)}}});function No(l){return Qe.canvas?new Bo(l):null}var oo=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(l){return document.createElement("<lvml:"+l+' class="lvml">')}}catch{}return function(l){return document.createElement("<"+l+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Fo={_initContainer:function(){this._container=qi("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ur.prototype._update.call(this),this.fire("update"))},_initPath:function(l){var v=l._container=oo("shape");Si(v,"leaflet-vml-shape "+(this.options.className||"")),v.coordsize="1 1",l._path=oo("path"),v.appendChild(l._path),this._updateStyle(l),this._layers[V(l)]=l},_addPath:function(l){var v=l._container;this._container.appendChild(v),l.options.interactive&&l.addInteractiveTarget(v)},_removePath:function(l){var v=l._container;nn(v),l.removeInteractiveTarget(v),delete this._layers[V(l)]},_updateStyle:function(l){var v=l._stroke,A=l._fill,B=l.options,H=l._container;H.stroked=!!B.stroke,H.filled=!!B.fill,B.stroke?(v||(v=l._stroke=oo("stroke")),H.appendChild(v),v.weight=B.weight+"px",v.color=B.color,v.opacity=B.opacity,B.dashArray?v.dashStyle=Fe(B.dashArray)?B.dashArray.join(" "):B.dashArray.replace(/( *, *)/g," "):v.dashStyle="",v.endcap=B.lineCap.replace("butt","flat"),v.joinstyle=B.lineJoin):v&&(H.removeChild(v),l._stroke=null),B.fill?(A||(A=l._fill=oo("fill")),H.appendChild(A),A.color=B.fillColor||B.color,A.opacity=B.fillOpacity):A&&(H.removeChild(A),l._fill=null)},_updateCircle:function(l){var v=l._point.round(),A=Math.round(l._radius),B=Math.round(l._radiusY||A);this._setPath(l,l._empty()?"M0 0":"AL "+v.x+","+v.y+" "+A+","+B+" 0,"+65535*360)},_setPath:function(l,v){l._path.v=v},_bringToFront:function(l){Ri(l._container)},_bringToBack:function(l){Mo(l._container)}},oa=Qe.vml?oo:Fn,yl=Ur.extend({_initContainer:function(){this._container=oa("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=oa("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){nn(this._container),$t(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ur.prototype._update.call(this);var l=this._bounds,v=l.getSize(),A=this._container;(!this._svgSize||!this._svgSize.equals(v))&&(this._svgSize=v,A.setAttribute("width",v.x),A.setAttribute("height",v.y)),Sn(A,l.min),A.setAttribute("viewBox",[l.min.x,l.min.y,v.x,v.y].join(" ")),this.fire("update")}},_initPath:function(l){var v=l._path=oa("path");l.options.className&&Si(v,l.options.className),l.options.interactive&&Si(v,"leaflet-interactive"),this._updateStyle(l),this._layers[V(l)]=l},_addPath:function(l){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(l._path),l.addInteractiveTarget(l._path)},_removePath:function(l){nn(l._path),l.removeInteractiveTarget(l._path),delete this._layers[V(l)]},_updatePath:function(l){l._project(),l._update()},_updateStyle:function(l){var v=l._path,A=l.options;v&&(A.stroke?(v.setAttribute("stroke",A.color),v.setAttribute("stroke-opacity",A.opacity),v.setAttribute("stroke-width",A.weight),v.setAttribute("stroke-linecap",A.lineCap),v.setAttribute("stroke-linejoin",A.lineJoin),A.dashArray?v.setAttribute("stroke-dasharray",A.dashArray):v.removeAttribute("stroke-dasharray"),A.dashOffset?v.setAttribute("stroke-dashoffset",A.dashOffset):v.removeAttribute("stroke-dashoffset")):v.setAttribute("stroke","none"),A.fill?(v.setAttribute("fill",A.fillColor||A.color),v.setAttribute("fill-opacity",A.fillOpacity),v.setAttribute("fill-rule",A.fillRule||"evenodd")):v.setAttribute("fill","none"))},_updatePoly:function(l,v){this._setPath(l,Jn(l._parts,v))},_updateCircle:function(l){var v=l._point,A=Math.max(Math.round(l._radius),1),B=Math.max(Math.round(l._radiusY),1)||A,H="a"+A+","+B+" 0 1,0 ",ae=l._empty()?"M0 0":"M"+(v.x-A)+","+v.y+H+A*2+",0 "+H+-A*2+",0 ";this._setPath(l,ae)},_setPath:function(l,v){l._path.setAttribute("d",v)},_bringToFront:function(l){Ri(l._path)},_bringToBack:function(l){Mo(l._path)}});Qe.vml&&yl.include(Fo);function vl(l){return Qe.svg||Qe.vml?new yl(l):null}Ii.include({getRenderer:function(l){var v=l.options.renderer||this._getPaneRenderer(l.options.pane)||this.options.renderer||this._renderer;return v||(v=this._renderer=this._createRenderer()),this.hasLayer(v)||this.addLayer(v),v},_getPaneRenderer:function(l){if(l==="overlayPane"||l===void 0)return!1;var v=this._paneRenderers[l];return v===void 0&&(v=this._createRenderer({pane:l}),this._paneRenderers[l]=v),v},_createRenderer:function(l){return this.options.preferCanvas&&No(l)||vl(l)}});var wi=Is.extend({initialize:function(l,v){Is.prototype.initialize.call(this,this._boundsToLatLngs(l),v)},setBounds:function(l){return this.setLatLngs(this._boundsToLatLngs(l))},_boundsToLatLngs:function(l){return l=Pt(l),[l.getSouthWest(),l.getNorthWest(),l.getNorthEast(),l.getSouthEast()]}});function lu(l,v){return new wi(l,v)}yl.create=oa,yl.pointsToPath=Jn,fs.geometryToLayer=Fr,fs.coordsToLatLng=wa,fs.coordsToLatLngs=ko,fs.latLngToCoords=ql,fs.latLngsToCoords=dl,fs.getFeature=Ls,fs.asFeature=fl,Ii.mergeOptions({boxZoom:!0});var Ea=qa.extend({initialize:function(l){this._map=l,this._container=l._container,this._pane=l._panes.overlayPane,this._resetStateTimeout=0,l.on("unload",this._destroy,this)},addHooks:function(){ii(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){$t(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){nn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(l){if(!l.shiftKey||l.which!==1&&l.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Ps(),Nl(),this._startPoint=this._map.mouseEventToContainerPoint(l),ii(document,{contextmenu:va,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(l){this._moved||(this._moved=!0,this._box=qi("div","leaflet-zoom-box",this._container),Si(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(l);var v=new _e(this._point,this._startPoint),A=v.getSize();Sn(this._box,v.min),this._box.style.width=A.x+"px",this._box.style.height=A.y+"px"},_finish:function(){this._moved&&(nn(this._box),Hn(this._container,"leaflet-crosshair")),Ba(),eo(),$t(document,{contextmenu:va,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(l){if(!(l.which!==1&&l.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(D(this._resetState,this),0);var v=new yt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(v).fire("boxzoomend",{boxZoomBounds:v})}},_onKeyDown:function(l){l.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ii.addInitHook("addHandler","boxZoom",Ea),Ii.mergeOptions({doubleClickZoom:!0});var bc=qa.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(l){var v=this._map,A=v.getZoom(),B=v.options.zoomDelta,H=l.originalEvent.shiftKey?A-B:A+B;v.options.doubleClickZoom==="center"?v.setZoom(H):v.setZoomAround(l.containerPoint,H)}});Ii.addInitHook("addHandler","doubleClickZoom",bc),Ii.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Ma=qa.extend({addHooks:function(){if(!this._draggable){var l=this._map;this._draggable=new tr(l._mapPane,l._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),l.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),l.on("zoomend",this._onZoomEnd,this),l.whenReady(this._onZoomEnd,this))}Si(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Hn(this._map._container,"leaflet-grab"),Hn(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var l=this._map;if(l._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var v=Pt(this._map.options.maxBounds);this._offsetLimit=Ue(this._map.latLngToContainerPoint(v.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(v.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;l.fire("movestart").fire("dragstart"),l.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(l){if(this._map.options.inertia){var v=this._lastTime=+new Date,A=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(A),this._times.push(v),this._prunePositions(v)}this._map.fire("move",l).fire("drag",l)},_prunePositions:function(l){for(;this._positions.length>1&&l-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var l=this._map.getSize().divideBy(2),v=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=v.subtract(l).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(l,v){return l-(l-v)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var l=this._draggable._newPos.subtract(this._draggable._startPos),v=this._offsetLimit;l.x<v.min.x&&(l.x=this._viscousLimit(l.x,v.min.x)),l.y<v.min.y&&(l.y=this._viscousLimit(l.y,v.min.y)),l.x>v.max.x&&(l.x=this._viscousLimit(l.x,v.max.x)),l.y>v.max.y&&(l.y=this._viscousLimit(l.y,v.max.y)),this._draggable._newPos=this._draggable._startPos.add(l)}},_onPreDragWrap:function(){var l=this._worldWidth,v=Math.round(l/2),A=this._initialWorldOffset,B=this._draggable._newPos.x,H=(B-v+A)%l+v-A,ae=(B+v+A)%l-v-A,Ae=Math.abs(H+A)<Math.abs(ae+A)?H:ae;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Ae},_onDragEnd:function(l){var v=this._map,A=v.options,B=!A.inertia||l.noInertia||this._times.length<2;if(v.fire("dragend",l),B)v.fire("moveend");else{this._prunePositions(+new Date);var H=this._lastPos.subtract(this._positions[0]),ae=(this._lastTime-this._times[0])/1e3,Ae=A.easeLinearity,Ve=H.multiplyBy(Ae/ae),at=Ve.distanceTo([0,0]),Mt=Math.min(A.inertiaMaxSpeed,at),Zt=Ve.multiplyBy(Mt/at),ci=Mt/(A.inertiaDeceleration*Ae),Li=Zt.multiplyBy(-ci/2).round();!Li.x&&!Li.y?v.fire("moveend"):(Li=v._limitOffset(Li,v.options.maxBounds),Ot(function(){v.panBy(Li,{duration:ci,easeLinearity:Ae,noMoveStart:!0,animate:!0})}))}}});Ii.addInitHook("addHandler","dragging",Ma),Ii.mergeOptions({keyboard:!0,keyboardPanDelta:80});var $u=qa.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(l){this._map=l,this._setPanDelta(l.options.keyboardPanDelta),this._setZoomDelta(l.options.zoomDelta)},addHooks:function(){var l=this._map._container;l.tabIndex<=0&&(l.tabIndex="0"),ii(l,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),$t(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var l=document.body,v=document.documentElement,A=l.scrollTop||v.scrollTop,B=l.scrollLeft||v.scrollLeft;this._map._container.focus(),window.scrollTo(B,A)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(l){var v=this._panKeys={},A=this.keyCodes,B,H;for(B=0,H=A.left.length;B<H;B++)v[A.left[B]]=[-1*l,0];for(B=0,H=A.right.length;B<H;B++)v[A.right[B]]=[l,0];for(B=0,H=A.down.length;B<H;B++)v[A.down[B]]=[0,l];for(B=0,H=A.up.length;B<H;B++)v[A.up[B]]=[0,-1*l]},_setZoomDelta:function(l){var v=this._zoomKeys={},A=this.keyCodes,B,H;for(B=0,H=A.zoomIn.length;B<H;B++)v[A.zoomIn[B]]=l;for(B=0,H=A.zoomOut.length;B<H;B++)v[A.zoomOut[B]]=-l},_addHooks:function(){ii(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){$t(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(l){if(!(l.altKey||l.ctrlKey||l.metaKey)){var v=l.keyCode,A=this._map,B;if(v in this._panKeys){if(!A._panAnim||!A._panAnim._inProgress)if(B=this._panKeys[v],l.shiftKey&&(B=lt(B).multiplyBy(3)),A.options.maxBounds&&(B=A._limitOffset(lt(B),A.options.maxBounds)),A.options.worldCopyJump){var H=A.wrapLatLng(A.unproject(A.project(A.getCenter()).add(B)));A.panTo(H)}else A.panBy(B)}else if(v in this._zoomKeys)A.setZoom(A.getZoom()+(l.shiftKey?3:1)*this._zoomKeys[v]);else if(v===27&&A._popup&&A._popup.options.closeOnEscapeKey)A.closePopup();else return;va(l)}}});Ii.addInitHook("addHandler","keyboard",$u),Ii.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var wc=qa.extend({addHooks:function(){ii(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){$t(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(l){var v=or(l),A=this._map.options.wheelDebounceTime;this._delta+=v,this._lastMousePos=this._map.mouseEventToContainerPoint(l),this._startTime||(this._startTime=+new Date);var B=Math.max(A-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(D(this._performZoom,this),B),va(l)},_performZoom:function(){var l=this._map,v=l.getZoom(),A=this._map.options.zoomSnap||0;l._stop();var B=this._delta/(this._map.options.wheelPxPerZoomLevel*4),H=4*Math.log(2/(1+Math.exp(-Math.abs(B))))/Math.LN2,ae=A?Math.ceil(H/A)*A:H,Ae=l._limitZoom(v+(this._delta>0?ae:-ae))-v;this._delta=0,this._startTime=null,Ae&&(l.options.scrollWheelZoom==="center"?l.setZoom(v+Ae):l.setZoomAround(this._lastMousePos,v+Ae))}});Ii.addInitHook("addHandler","scrollWheelZoom",wc);var jo=600;Ii.mergeOptions({tapHold:Qe.touchNative&&Qe.safari&&Qe.mobile,tapTolerance:15});var cu=qa.extend({addHooks:function(){ii(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){$t(this._map._container,"touchstart",this._onDown,this)},_onDown:function(l){if(clearTimeout(this._holdTimeout),l.touches.length===1){var v=l.touches[0];this._startPos=this._newPos=new st(v.clientX,v.clientY),this._holdTimeout=setTimeout(D(function(){this._cancel(),this._isTapValid()&&(ii(document,"touchend",Pi),ii(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",v))},this),jo),ii(document,"touchend touchcancel contextmenu",this._cancel,this),ii(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function l(){$t(document,"touchend",Pi),$t(document,"touchend touchcancel",l)},_cancel:function(){clearTimeout(this._holdTimeout),$t(document,"touchend touchcancel contextmenu",this._cancel,this),$t(document,"touchmove",this._onMove,this)},_onMove:function(l){var v=l.touches[0];this._newPos=new st(v.clientX,v.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(l,v){var A=new MouseEvent(l,{bubbles:!0,cancelable:!0,view:window,screenX:v.screenX,screenY:v.screenY,clientX:v.clientX,clientY:v.clientY});A._simulated=!0,v.target.dispatchEvent(A)}});Ii.addInitHook("addHandler","tapHold",cu),Ii.mergeOptions({touchZoom:Qe.touch,bounceAtZoomLimits:!0});var Tc=qa.extend({addHooks:function(){Si(this._map._container,"leaflet-touch-zoom"),ii(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Hn(this._map._container,"leaflet-touch-zoom"),$t(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(l){var v=this._map;if(!(!l.touches||l.touches.length!==2||v._animatingZoom||this._zooming)){var A=v.mouseEventToContainerPoint(l.touches[0]),B=v.mouseEventToContainerPoint(l.touches[1]);this._centerPoint=v.getSize()._divideBy(2),this._startLatLng=v.containerPointToLatLng(this._centerPoint),v.options.touchZoom!=="center"&&(this._pinchStartLatLng=v.containerPointToLatLng(A.add(B)._divideBy(2))),this._startDist=A.distanceTo(B),this._startZoom=v.getZoom(),this._moved=!1,this._zooming=!0,v._stop(),ii(document,"touchmove",this._onTouchMove,this),ii(document,"touchend touchcancel",this._onTouchEnd,this),Pi(l)}},_onTouchMove:function(l){if(!(!l.touches||l.touches.length!==2||!this._zooming)){var v=this._map,A=v.mouseEventToContainerPoint(l.touches[0]),B=v.mouseEventToContainerPoint(l.touches[1]),H=A.distanceTo(B)/this._startDist;if(this._zoom=v.getScaleZoom(H,this._startZoom),!v.options.bounceAtZoomLimits&&(this._zoom<v.getMinZoom()&&H<1||this._zoom>v.getMaxZoom()&&H>1)&&(this._zoom=v._limitZoom(this._zoom)),v.options.touchZoom==="center"){if(this._center=this._startLatLng,H===1)return}else{var ae=A._add(B)._divideBy(2)._subtract(this._centerPoint);if(H===1&&ae.x===0&&ae.y===0)return;this._center=v.unproject(v.project(this._pinchStartLatLng,this._zoom).subtract(ae),this._zoom)}this._moved||(v._moveStart(!0,!1),this._moved=!0),Yt(this._animRequest);var Ae=D(v._move,v,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Ot(Ae,this,!0),Pi(l)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Yt(this._animRequest),$t(document,"touchmove",this._onTouchMove,this),$t(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ii.addInitHook("addHandler","touchZoom",Tc),Ii.BoxZoom=Ea,Ii.DoubleClickZoom=bc,Ii.Drag=Ma,Ii.Keyboard=$u,Ii.ScrollWheelZoom=wc,Ii.TapHold=cu,Ii.TouchZoom=Tc,T.Bounds=_e,T.Browser=Qe,T.CRS=Kt,T.Canvas=Bo,T.Circle=hl,T.CircleMarker=ds,T.Class=oi,T.Control=Pr,T.DivIcon=Hl,T.DivOverlay=br,T.DomEvent=dc,T.DomUtil=xr,T.Draggable=tr,T.Evented=Je,T.FeatureGroup=Ga,T.GeoJSON=fs,T.GridLayer=jr,T.Handler=qa,T.Icon=Ha,T.ImageOverlay=pl,T.LatLng=Dt,T.LatLngBounds=yt,T.Layer=ba,T.LayerGroup=ul,T.LineUtil=jl,T.Map=Ii,T.Marker=hs,T.Mixin=Ad,T.Path=$a,T.Point=st,T.PolyUtil=mc,T.Polygon=Is,T.Polyline=ro,T.Popup=Oo,T.PosAnimation=zo,T.Projection=Dh,T.Rectangle=wi,T.Renderer=Ur,T.SVG=yl,T.SVGOverlay=ou,T.TileLayer=so,T.Tooltip=gl,T.Transformation=vr,T.Util=si,T.VideoOverlay=Ro,T.bind=D,T.bounds=Ue,T.canvas=No,T.circle=Lh,T.circleMarker=Gu,T.control=Mi,T.divIcon=$l,T.extend=O,T.featureGroup=su,T.geoJSON=Gl,T.geoJson=vc,T.gridLayer=Hu,T.icon=Ul,T.imageOverlay=Oh,T.latLng=Lt,T.latLngBounds=Pt,T.layerGroup=Ih,T.map=dn,T.marker=qu,T.point=lt,T.polygon=Rh,T.polyline=kh,T.popup=xc,T.rectangle=lu,T.setOptions=be,T.stamp=V,T.svg=vl,T.svgOverlay=$i,T.tileLayer=Sa,T.tooltip=_l,T.transformation=tn,T.version=M,T.videoOverlay=ml;var Uo=window.L;T.noConflict=function(){return window.L=Uo,this},window.L=T}))})(ig,ig.exports)),ig.exports}var q_=Nb();const Vu=Yy(q_);function Fb(f,_,T){return Object.freeze({instance:f,context:_,container:T})}function jb(f,_){return _==null?function(M,O){const j=ht.useRef(void 0);return j.current||(j.current=f(M,O)),j}:function(M,O){const j=ht.useRef(void 0);j.current||(j.current=f(M,O));const D=ht.useRef(M),{instance:u}=j.current;return ht.useEffect(function(){D.current!==M&&(_(u,M,D.current),D.current=M)},[u,M,_]),j}}function Ub(f,_){ht.useEffect(function(){return(_.layerContainer??_.map).addLayer(f.instance),function(){_.layerContainer?.removeLayer(f.instance),_.map.removeLayer(f.instance)}},[_,f])}function CM(f){return function(T){const M=D0(),O=f(Bb(T,M),M);return SM(M.map,T.attribution),Ob(O.current,T.eventHandlers),Ub(O.current,M),O}}function PM(f,_){const T=ht.useRef(void 0);ht.useEffect(function(){if(_.pathOptions!==T.current){const O=_.pathOptions??{};f.instance.setStyle(O),T.current=O}},[f,_])}function zM(f){return function(T){const M=D0(),O=f(Bb(T,M),M);return Ob(O.current,T.eventHandlers),Ub(O.current,M),PM(O.current,T),O}}function DM(f,_){const T=jb(f,_),M=CM(T);return Rb(M)}function IM(f,_){const T=jb(f,_),M=zM(T);return Rb(M)}function I0(){return D0().map}function L0(f){const _=I0();return ht.useEffect(function(){return _.on(f),function(){_.off(f)}},[_,f]),_}function LM({bounds:f,boundsOptions:_,center:T,children:M,className:O,id:j,placeholder:D,style:u,whenReady:V,zoom:te,...fe},ue){const[De]=ht.useState({className:O,id:j,style:u}),[Pe,je]=ht.useState(null),be=ht.useRef(void 0);ht.useImperativeHandle(ue,()=>Pe?.map??null,[Pe]);const de=ht.useCallback(ut=>{if(ut!==null&&!be.current){const Fe=new q_.Map(ut,fe);be.current=Fe,T!=null&&te!=null?Fe.setView(T,te):f!=null&&Fe.fitBounds(f,_),V!=null&&Fe.whenReady(V),je(MM(Fe))}},[]);ht.useEffect(()=>()=>{Pe?.map.remove()},[Pe]);const He=Pe?Up.createElement(z0,{value:Pe},M):D??null;return Up.createElement("div",{...De,ref:de},He)}const kM=ht.forwardRef(LM),Yp=DM(function({position:_,...T},M){const O=new q_.Marker(_,T);return Fb(O,kb(M,{overlayContainer:O}))},function(_,T,M){T.position!==M.position&&_.setLatLng(T.position),T.icon!=null&&T.icon!==M.icon&&_.setIcon(T.icon),T.zIndexOffset!=null&&T.zIndexOffset!==M.zIndexOffset&&_.setZIndexOffset(T.zIndexOffset),T.opacity!=null&&T.opacity!==M.opacity&&_.setOpacity(T.opacity),_.dragging!=null&&T.draggable!==M.draggable&&(T.draggable===!0?_.dragging.enable():_.dragging.disable())}),Pv=IM(function({positions:_,...T},M){const O=new q_.Polyline(_,T);return Fb(O,kb(M,{overlayContainer:O}))},function(_,T,M){T.positions!==M.positions&&_.setLatLngs(T.positions)}),Uu={PARKING_LOG:31417,OPEN_SPOT_BROADCAST:31714,ROUTE_LOG:34171},lc=["wss://relay.damus.io","wss://nos.lol","wss://relay.primal.net","wss://relay.snort.social"];function A_(f,_,T=10){const M=[16,8,4,2,1],O="0123456789bcdefghjkmnpqrstuvwxyz";let j=!0,D=-90,u=90,V=-180,te=180,fe="",ue=0,De=0;for(;fe.length<T;){if(j){const Pe=(V+te)/2;_>Pe?(De|=M[ue],V=Pe):te=Pe}else{const Pe=(D+u)/2;f>Pe?(De|=M[ue],D=Pe):u=Pe}j=!j,ue<4?ue++:(fe+=O[De],ue=0,De=0)}return fe}function RM(f,_,T=5){const M=A_(f,_,T),O=T===5?.02:T===6?.005:.001,j=T===5?.04:T===6?.01:.002,D=new Set;D.add(M);const u=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[V,te]of u){const fe=f+V*O,ue=_+te*j;D.add(A_(fe,ue,T))}return Array.from(D)}async function Vb(f,_,T){const M=JSON.stringify(f);if(T){const O=sg.getConversationKey(T,_);return sg.encrypt(M,O)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(_,M);throw new Error("No encryption method available")}async function Zb(f,_,T){let M;if(T){const O=sg.getConversationKey(T,_);M=sg.decrypt(f,O)}else if(window.nostr?.nip44?.decrypt)M=await window.nostr.nip44.decrypt(_,f);else throw new Error("No decryption method available");return JSON.parse(M)}const C_={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function OM(f,_){try{const T=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${f}&lon=${_}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!T.ok)throw new Error("Geocoding failed");const O=(await T.json()).address?.country_code?.toUpperCase();return O&&C_[O]?C_[O]:"USD"}catch(T){return console.warn("Currency detection failed, using locale fallback:",T),qb()}}function qb(){try{const _=window.navigator.language.split("-")[1]?.toUpperCase();return _&&C_[_]?C_[_]:"USD"}catch{return"USD"}}function Gp(f){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:f,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[f]||"$"}}const BM={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function NM(f){return(BM[f]||"US").toUpperCase().replace(/./g,T=>String.fromCodePoint(T.charCodeAt(0)+127397))}var Af=Symbol("verified"),FM=f=>f instanceof Object;function Gb(f){if(!FM(f)||typeof f.kind!="number"||typeof f.content!="string"||typeof f.created_at!="number"||typeof f.pubkey!="string"||!f.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(f.tags))return!1;for(let _=0;_<f.tags.length;_++){let T=f.tags[_];if(!Array.isArray(T))return!1;for(let M=0;M<T.length;M++)if(typeof T[M]!="string")return!1}return!0}new TextDecoder("utf-8");var jM=new TextEncoder,UM=class{generateSecretKey(){return Bu.utils.randomPrivateKey()}getPublicKey(f){return Ra(Bu.getPublicKey(f))}finalizeEvent(f,_){const T=f;return T.pubkey=Ra(Bu.getPublicKey(_)),T.id=__(T),T.sig=Ra(Bu.sign(__(T),_)),T[Af]=!0,T}verifyEvent(f){if(typeof f[Af]=="boolean")return f[Af];const _=__(f);if(_!==f.id)return f[Af]=!1,!1;try{const T=Bu.verify(f.sig,_,f.pubkey);return f[Af]=T,T}catch{return f[Af]=!1,!1}}};function Hb(f){if(!Gb(f))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,f.pubkey,f.created_at,f.kind,f.tags,f.content])}function __(f){let _=Ed(jM.encode(Hb(f)));return Ra(_)}var G_=new UM,$b=G_.generateSecretKey,VM=G_.getPublicKey,Xb=G_.finalizeEvent;G_.verifyEvent;const ZM=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:Xb,generateSecretKey:$b,getEventHash:__,getPublicKey:VM,serializeEvent:Hb,validateEvent:Gb,verifiedSymbol:Af},Symbol.toStringTag,{value:"Module"})),qM=({status:f,setStatus:_,location:T,vehicleType:M,setOpenSpots:O,parkLocation:j,setParkLocation:D})=>{const{pubkey:u,pool:V,signEvent:te}=Xp(),[fe,ue]=ht.useState(!1),[De,Pe]=ht.useState("0"),[je,be]=ht.useState("USD"),[de,He]=ht.useState("$"),[ut,Fe]=ht.useState(null);ht.useEffect(()=>{if(f==="search"&&T){const dt=RM(T[0],T[1],5);console.log("[Parlens] Starting spot search with polling in geohashes:",dt);const rt=async()=>{try{const Ht=Math.floor(Date.now()/1e3);console.log("[Parlens] Querying for spots since:",Ht-300);const Ot=await V.querySync(lc,{kinds:[Uu.OPEN_SPOT_BROADCAST],"#g":dt,since:Ht-300});console.log("[Parlens] Found",Ot.length,"spot events");const Yt=Math.floor(Date.now()/1e3),si=[];for(const oi of Ot){const wt=oi.tags.find(ze=>ze[0]==="expiration");if(!(wt&&parseInt(wt[1])<Yt))try{const ze=oi.tags,Je=ze.find(_e=>_e[0]==="location"),st=ze.find(_e=>_e[0]==="hourly_rate"),Et=ze.find(_e=>_e[0]==="currency"),lt=ze.find(_e=>_e[0]==="type");if(Je){const[_e,Ue]=Je[1].split(",").map(Number),yt=lt?lt[1]:"car";si.push({id:oi.id,lat:_e,lon:Ue,price:st?parseFloat(st[1]):0,currency:Et?Et[1]:"USD",type:yt})}}catch(ze){console.warn("[Parlens] Error parsing spot:",ze)}}console.log("[Parlens] Setting",si.length,"valid spots"),O(si)}catch(Ht){console.error("[Parlens] Spot query error:",Ht)}};rt();const Ct=setInterval(rt,1e4),jt=()=>{console.log("[Parlens] Visibility refresh triggered, searching spots..."),rt()};return window.addEventListener("visibility-refresh",jt),()=>{console.log("[Parlens] Stopping spot search"),clearInterval(Ct),window.removeEventListener("visibility-refresh",jt)}}else O([])},[f,M,V]),ht.useEffect(()=>{const dt=localStorage.getItem("parlens_session");if(dt)try{const rt=JSON.parse(dt);rt.status==="parked"&&rt.parkLocation&&rt.sessionStart?(console.log("[Parlens] Restoring parked session:",rt),Fe(rt.sessionStart),D(rt.parkLocation),_("parked")):rt.status==="search"&&(console.log("[Parlens] Restoring search session"),_("search"))}catch(rt){console.warn("[Parlens] Failed to restore session:",rt),localStorage.removeItem("parlens_session")}},[]),ht.useEffect(()=>{f==="parked"&&ut&&j?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:ut,parkLocation:j})):f==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):f==="idle"&&localStorage.removeItem("parlens_session")},[f,ut,j]),ht.useEffect(()=>{(async()=>{const rt=qb();if(be(rt),He(Gp(rt)),T)try{const Ct=await OM(T[0],T[1]);be(Ct),He(Gp(Ct))}catch{console.warn("GPS currency detection failed")}})()},[T]);const Ut=async()=>{f==="idle"?_("search"):f==="search"?(Fe(Math.floor(Date.now()/1e3)),D([T[0],T[1]]),_("parked")):f==="parked"&&(Pe("0"),ue(!0))},Rt=async()=>{_("idle"),ue(!1);const dt=j?j[0]:T[0],rt=j?j[1]:T[1],Ct=A_(dt,rt,5),jt=Math.floor(Date.now()/1e3),Ht=ut||jt;try{const Ot={status:"vacated",lat:dt,lon:rt,geohash:Ct,fee:De,currency:je,type:M,started_at:Ht,finished_at:jt},Yt=localStorage.getItem("parlens_privkey"),si=Yt?new Uint8Array(Yt.match(/.{1,2}/g).map(Kt=>parseInt(Kt,16))):void 0,oi=await Vb(Ot,u,si),wt={kind:Uu.PARKING_LOG,content:oi,tags:[["d",`session_${Ht}`],["client","parlens"]],created_at:jt,pubkey:u},ze=await te(wt);console.log("Publishing log:",ze.id,"to",lc);const Je=await Promise.allSettled(V.publish(lc,ze)),st=Je.filter(Kt=>Kt.status==="fulfilled").length,Et=Je.filter(Kt=>Kt.status==="rejected").length;console.log(`[Parlens] Publish results: ${st}/${Je.length} succeeded, ${Et} failed`),Je.forEach((Kt,ui)=>{Kt.status==="rejected"&&console.warn(`[Parlens] Relay ${lc[ui]} failed:`,Kt.reason)}),st===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(Kt=>setTimeout(Kt,300)),window.dispatchEvent(new Event("parking-log-updated"));const lt=$b(),_e=jt-Ht,Ue=Math.max(Math.ceil(_e/3600),1),yt=String(Math.round(parseFloat(De)/Ue)),Pt=jt+60,Dt={kind:Uu.OPEN_SPOT_BROADCAST,content:"",tags:[["d",`spot_${Ct}_${jt}`],["g",Ct],["location",`${dt},${rt}`],["hourly_rate",yt],["currency",je],["type",M],["expiration",String(Pt)],["client","parlens"]],created_at:jt},Lt=Xb(Dt,lt);console.log("[Parlens] *** BROADCASTING OPEN SPOT ***"),console.log("[Parlens] Geohash:",Ct),console.log("[Parlens] Location:",`${dt},${rt}`),console.log("[Parlens] Event ID:",Lt.id),console.log("[Parlens] Pubkey:",Lt.pubkey.substring(0,20)+"..."),V.publish(lc,Lt),Fe(null),D(null)}catch(Ot){console.error("Persistence error:",Ot),alert("Could not save to Nostr. Check relay connections.")}};return ne.jsxs("div",{className:"relative flex flex-col items-end gap-4",children:[ne.jsxs("div",{className:"flex items-center gap-4",children:[f==="search"&&ne.jsx("button",{onClick:()=>_("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8",children:"CANCEL"}),ne.jsxs("button",{onClick:Ut,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 ${f==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":f==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[f==="idle"&&ne.jsx(gM,{size:32,strokeWidth:2.5}),f==="search"&&ne.jsx(lg,{size:32,strokeWidth:2.5,className:"animate-pulse"}),f==="parked"&&(M==="bicycle"?ne.jsx("span",{className:"text-3xl",children:""}):M==="motorcycle"?ne.jsx("span",{className:"text-3xl",children:""}):ne.jsx("span",{className:"text-3xl",children:""}))]})]}),fe&&ne.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:ne.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[ne.jsxs("div",{className:"text-center space-y-1",children:[ne.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),ne.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),ne.jsxs("div",{className:"flex items-center gap-4",children:[ne.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[ne.jsx("span",{className:"text-2xl font-bold text-blue-500",children:de}),ne.jsx("input",{type:"number",value:De,onChange:dt=>Pe(dt.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),ne.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:je})]}),ne.jsxs("div",{className:"flex flex-col gap-1.5",children:[ne.jsx("button",{onClick:()=>Pe(String(Math.max(0,parseFloat(De||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 hover:bg-zinc-200 dark:bg-white/10 dark:hover:bg-white/20 active:scale-95 transition-all flex items-center justify-center",children:ne.jsx(qE,{size:22,className:"text-zinc-600 dark:text-white/70"})}),ne.jsx("button",{onClick:()=>Pe(String(Math.max(0,parseFloat(De||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 hover:bg-zinc-200 dark:bg-white/10 dark:hover:bg-white/20 active:scale-95 transition-all flex items-center justify-center",children:ne.jsx(og,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),ne.jsxs("div",{className:"w-full space-y-3",children:[ne.jsxs("button",{onClick:Rt,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",ne.jsx(NE,{size:20})]}),ne.jsx("button",{onClick:()=>ue(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 hover:text-zinc-600 dark:hover:text-white/50 transition-colors",children:"Cancel"})]})]})})]})};function GM(){const{pool:f,pubkey:_}=Xp(),[T,M]=ht.useState([]),[O,j]=ht.useState(!0),D=ht.useRef(new Set),u=ht.useCallback(async()=>{if(!(!_||!f)){j(!0),console.log("[useParkingLogs] Fetching logs for",_);try{const te=await f.querySync(lc,{kinds:[Uu.PARKING_LOG],authors:[_],limit:50});console.log("[useParkingLogs] Fetched",te.length,"events");const fe=te.filter(De=>{const Pe=De.tags?.find(je=>je[0]==="d")?.[1];return Pe?!D.current.has(Pe):!0});console.log("[useParkingLogs] After filtering locally deleted:",fe.length,"events");const ue=fe.sort((De,Pe)=>Pe.created_at-De.created_at);M(ue)}catch(te){console.error("[useParkingLogs] Fetch error:",te)}finally{j(!1)}}},[f,_]),V=ht.useCallback(te=>{console.log("[useParkingLogs] Marking deleted:",te),D.current.add(te)},[]);return ht.useEffect(()=>{_&&u()},[_,u]),ht.useEffect(()=>{const te=()=>{console.log("[useParkingLogs] Received update event, refetching..."),u()};return window.addEventListener("parking-log-updated",te),window.addEventListener("visibility-refresh",te),()=>{window.removeEventListener("parking-log-updated",te),window.removeEventListener("visibility-refresh",te)}},[u]),{logs:T,loading:O,refetch:u,markDeleted:V}}const HM=({setHistorySpots:f,onOpenChange:_})=>{const{pubkey:T,logout:M,pool:O,signEvent:j}=Xp(),{logs:D,refetch:u,markDeleted:V}=GM(),[te,fe]=ht.useState(!1),[ue,De]=ht.useState(!1);ht.useEffect(()=>{_?.(te)},[te,_]);const[Pe,je]=ht.useState(null),[be,de]=ht.useState([]),[He,ut]=ht.useState(!1),Fe=async Rt=>{if(!(!T||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){De(!0);try{const dt=Rt.tags?.find(jt=>jt[0]==="d")?.[1];if(!dt)throw new Error("Missing d tag on event");const rt={kind:5,content:"Deleted by user",tags:[["a",`${Uu.PARKING_LOG}:${T}:${dt}`],["k",String(Uu.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:T},Ct=await j(rt);await Promise.allSettled(O.publish(lc,Ct)),V(dt),de(jt=>jt.filter(Ht=>Ht.id!==Rt.id))}catch(dt){console.error("Failed to delete parking log:",dt),alert("Failed to delete. Please try again.")}finally{De(!1)}}};ht.useEffect(()=>{T&&(async()=>{const dt=await O.get(lc,{kinds:[0],authors:[T]});if(dt)try{const rt=JSON.parse(dt.content);je({name:rt.name||rt.display_name||"Nostr User",npub:Df.npubEncode(T),picture:rt.picture})}catch(rt){console.error("Error parsing profile:",rt)}else je({name:"Nostr User",npub:Df.npubEncode(T),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${T}`})})()},[T,O]),ht.useEffect(()=>{(async()=>{if(!T||!D.length)return;const dt=localStorage.getItem("parlens_privkey"),rt=dt?new Uint8Array(dt.match(/.{1,2}/g).map(jt=>parseInt(jt,16))):void 0,Ct=await Promise.all(D.map(async jt=>{try{const Ht=await Zb(jt.content,T,rt);return{...jt,decryptedContent:Ht}}catch{return{...jt,decryptedContent:null}}}));de(Ct.filter(jt=>jt.decryptedContent))})()},[D,T]),ht.useEffect(()=>{f&&f(He?be:[])},[He,be,f]);const Ut=()=>{const Rt=localStorage.getItem("parlens_privkey");if(Rt){const dt=Df.nsecEncode(new Uint8Array(Rt.match(/.{1,2}/g).map(rt=>parseInt(rt,16))));navigator.clipboard.writeText(dt),alert("Copied to clipboard")}};return ne.jsxs(ne.Fragment,{children:[ne.jsx("button",{onClick:()=>{u(),fe(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 hover:bg-white dark:hover:bg-white/20 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:ne.jsx(wM,{size:20})}),te&&ne.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[ne.jsx("button",{onClick:()=>fe(!1),className:"absolute inset-0 z-0 cursor-default"}),ue&&ne.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:ne.jsxs("div",{className:"flex flex-col items-center gap-3",children:[ne.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),ne.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),ne.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[ne.jsxs("div",{className:"flex items-center justify-between",children:[ne.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent",children:Pe?.name||"Nostr User"}),ne.jsx("button",{onClick:()=>fe(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 hover:bg-black/10 dark:hover:bg-white/20 transition-colors",children:ne.jsx(P0,{size:20,className:"text-black/60 dark:text-white/60"})})]}),ne.jsxs("div",{className:"space-y-4",children:[ne.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Keys"}),ne.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[ne.jsxs("div",{className:"p-5 flex items-center justify-between hover:bg-black/5 dark:hover:bg-white/5 transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText(Pe?.npub),alert("Copied to clipboard")},children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:ne.jsx(Zy,{size:20})}),ne.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),ne.jsx(M_,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&ne.jsxs(ne.Fragment,{children:[ne.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),ne.jsxs("div",{onClick:Ut,className:"flex items-center justify-between p-4 cursor-pointer hover:bg-black/5 dark:hover:bg-white/5 transition-colors active:bg-black/10 dark:active:bg-white/10",children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:ne.jsx(Lb,{size:20})}),ne.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),ne.jsx(M_,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),ne.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost."})]}),ne.jsxs("div",{className:"space-y-4",children:[ne.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),f&&ne.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5 mb-4",children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("div",{className:"p-2.5 rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:ne.jsx(lg,{size:20})}),ne.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),ne.jsx("button",{onClick:()=>ut(!He),className:`w-12 h-7 rounded-full transition-colors relative ${He?"bg-blue-500":"bg-zinc-200 dark:bg-white/20"}`,children:ne.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${He?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),ne.jsx("div",{className:"space-y-2",children:be.length>0?be.map(Rt=>{const dt=Rt.decryptedContent,rt=Gp(dt.currency||"USD"),Ct=dt.started_at?new Date(dt.started_at*1e3):null,jt=dt.finished_at?new Date(dt.finished_at*1e3):new Date(Rt.created_at*1e3),Ht=dt.lat&&dt.lon?`${dt.lat.toFixed(5)}, ${dt.lon.toFixed(5)}`:null,Ot=dt.type||"car",Yt=Ot==="bicycle"?"":Ot==="motorcycle"?"":"";return ne.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[ne.jsxs("div",{className:"flex items-center justify-between",children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("span",{className:"text-2xl",children:Yt}),ne.jsx("p",{className:"font-bold text-xl",children:`${rt}${dt.fee||"0"}`})]}),ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx("span",{className:"text-2xl",children:NM(dt.currency||"USD")}),ne.jsx("button",{onClick:()=>Fe(Rt),className:"p-1.5 text-zinc-400 dark:text-white/30 hover:text-zinc-600 dark:hover:text-white/50 transition-colors",title:"Delete entry",children:ne.jsx(qy,{size:16})})]})]}),Ht&&ne.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[ne.jsx(lg,{size:12,className:"text-blue-500 dark:text-blue-400"}),ne.jsx("span",{className:"font-mono",children:Ht})]}),ne.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/30",children:[ne.jsx(Ib,{size:12,className:"text-green-500 dark:text-green-400"}),ne.jsxs("div",{className:"space-x-1",children:[Ct&&ne.jsxs("span",{children:["Start: ",Ct.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",Ct.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),ne.jsx("span",{className:"text-black/10 dark:text-white/10",children:""}),ne.jsxs("span",{children:["End: ",jt.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",jt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]},Rt.id)}):ne.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:ne.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:"No recent activity"})})})]}),ne.jsx("button",{onClick:()=>{M(),fe(!1)},className:"w-full py-5 rounded-[2rem] bg-zinc-100 dark:bg-zinc-800 text-red-500 font-bold tracking-wide border border-black/5 dark:border-white/5 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all active:scale-95 text-center mt-4",children:"Logout"})]})]})]})},$M=({vehicleType:f,onRouteChange:_,currentLocation:T,onDropPinModeChange:M,pendingDropPin:O,onDropPinConsumed:j,onOpenChange:D})=>{const{pool:u,pubkey:V,signEvent:te}=Xp(),[fe,ue]=ht.useState(!1);ht.useEffect(()=>{D?.(fe)},[fe,D]);const[De,Pe]=ht.useState([]),[je,be]=ht.useState(""),[de,He]=ht.useState(!1),[ut,Fe]=ht.useState(null),[Ut,Rt]=ht.useState(null),[dt,rt]=ht.useState(!1),Ct=ht.useRef(null),[jt,Ht]=ht.useState([]),[Ot,Yt]=ht.useState(""),[si,oi]=ht.useState(!1),[wt,ze]=ht.useState(!1),[Je,st]=ht.useState(!1),[Et,lt]=ht.useState(!1),[_e,Ue]=ht.useState(null),[yt,Pt]=ht.useState(""),[Dt,Lt]=ht.useState(!1),Kt=ht.useRef(new Set),ui=Up.useMemo(()=>{if(!je||je.length<2)return[];const Jt=je.toLowerCase(),li=[];for(const fi of jt)for(const Ci of fi.decryptedContent.waypoints)Ci.name.toLowerCase().includes(Jt)&&(li.find(Ei=>Ei.name.toLowerCase()===Ci.name.toLowerCase())||li.push({name:Ci.name,lat:Ci.lat,lon:Ci.lon}));return li.slice(0,5)},[je,jt]),Ai=Jt=>{Pe(li=>li.filter(fi=>fi.id!==Jt)),Fe(null),Rt(null),He(!1),_(null,null,null,!1)},mn=()=>{Pe([]),Fe(null),Rt(null),He(!1),_(null,null,null,!1)},vr=async()=>{if(De.length<2){alert("Add at least 2 waypoints to create a route");return}rt(!0);try{const li={bicycle:"cycling",motorcycle:"driving",car:"driving"}[f],fi=[],Ci=[];for(let Re=0;Re<De.length-1;Re++){const Q=De[Re],ee=De[Re+1],se=`${Q.lon},${Q.lat};${ee.lon},${ee.lat}`;console.log(`[Parlens] Fetching segment ${Re+1}: ${Q.name}  ${ee.name}`);const ge=await fetch(`https://router.project-osrm.org/route/v1/${li}/${se}?overview=full&geometries=geojson&alternatives=true`);if(!ge.ok)throw new Error(`OSRM error: ${ge.status}`);const we=await ge.json();if(we.routes&&we.routes[0]){const Ze=we.routes[0].geometry.coordinates.map(Ne=>[Ne[1],Ne[0]]);if(fi.push(Ze),we.routes.length>1){const Ne=we.routes[1].geometry.coordinates.map(Ie=>[Ie[1],Ie[0]]);Ci.push(Ne),console.log(`[Parlens] Segment ${Re+1} has alternate route`)}else Ci.push(Ze),console.log(`[Parlens] Segment ${Re+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${Re+1}`)}const Ei=[],cn=[];for(let Re=0;Re<fi.length;Re++){const Q=Re===0?0:1;Ei.push(...fi[Re].slice(Q)),cn.push(...Ci[Re].slice(Q))}console.log("[Parlens] Combined primary route:",Ei.length,"points"),console.log("[Parlens] Combined alternate route:",cn.length,"points"),Fe(Ei),Rt(cn),He(!0),_(Ei,cn,De.map(Re=>({lat:Re.lat,lon:Re.lon})),!0),ue(!1)}catch(Jt){console.error("Route creation error:",Jt);const li=De.map(fi=>[fi.lat,fi.lon]);Fe(li),Rt(null),He(!0),_(li,null,De.map(fi=>({lat:fi.lat,lon:fi.lon})),!0),ue(!1)}finally{rt(!1)}},tn=()=>{const Jt=!de;He(Jt),_(ut,Ut,De.map(li=>({lat:li.lat,lon:li.lon})),Jt)},ar=ht.useCallback(async()=>{if(!(!u||!V)){ze(!0);try{const Jt=await u.querySync(lc,{kinds:[Uu.ROUTE_LOG],authors:[V]});console.log("[Parlens] Fetched route events:",Jt.length);const li=localStorage.getItem("parlens_privkey"),fi=li?new Uint8Array(li.match(/.{1,2}/g).map(Ei=>parseInt(Ei,16))):void 0,Ci=[];for(const Ei of Jt){if(Ei.tags.find(Re=>Re[0]==="deleted"))continue;const cn=Ei.tags.find(Re=>Re[0]==="d")?.[1]||"";if(!(cn&&Kt.current.has(cn))&&Ei.content)try{const Re=await Zb(Ei.content,V,fi);if(Re){const Q=Ei.tags.find(ee=>ee[0]==="d")?.[1]||"";Ci.push({id:Ei.id,dTag:Q,decryptedContent:Re,created_at:Ei.created_at})}}catch(Re){console.warn("[Parlens] Failed to decrypt route:",Re)}}Ci.sort((Ei,cn)=>cn.created_at-Ei.created_at),Ht(Ci)}catch(Jt){console.error("Error fetching saved routes:",Jt)}finally{ze(!1)}}},[u,V]);ht.useEffect(()=>{fe&&V&&ar()},[fe,V,ar]);const Gi=()=>{const Jt=!Et;lt(Jt),M?.(Jt),Jt&&ue(!1)};ht.useEffect(()=>{if(O){const Jt={id:crypto.randomUUID(),name:`Pin ${De.length+1}`,lat:O.lat,lon:O.lon};Pe(li=>[...li,Jt]),Fe(null),Rt(null),He(!1),_(null,null,null,!1),j?.(),ue(!0),lt(!1),M?.(!1)}},[O]);const Fn=async()=>{if(!u||!V||!te||!ut||De.length<2){alert("Please create a route first");return}const Jt=Ot.trim()||`Route ${new Date().toLocaleDateString()}`;oi(!0);try{const li={name:Jt,waypoints:De.map(ge=>({name:ge.name,lat:ge.lat,lon:ge.lon})),routeCoords:ut,alternateRouteCoords:Ut||void 0,vehicleType:f,created_at:Math.floor(Date.now()/1e3)},fi=localStorage.getItem("parlens_privkey"),Ci=fi?new Uint8Array(fi.match(/.{1,2}/g).map(ge=>parseInt(ge,16))):void 0,Ei=await Vb(li,V,Ci),cn=`route_${Date.now()}`,Re={kind:Uu.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",cn],["client","parlens"]],content:Ei},Q=await te(Re);console.log("[Parlens] Signed route event:",Q);const ee=await Promise.allSettled(u.publish(lc,Q)),se=ee.filter(ge=>ge.status==="fulfilled").length;console.log("[Parlens] Route published:",se,"of",ee.length,"relays"),se===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),Yt(""),setTimeout(()=>ar(),500)}catch(li){console.error("[Parlens] Error saving route:",li),alert("Failed to save route, try again later")}finally{oi(!1)}},Jn=(Jt,li)=>{Pe(fi=>fi.map(Ci=>Ci.id===Jt?{...Ci,name:li}:Ci)),Ue(null),Pt("")},ln=Jt=>{Ue(Jt.id),Pt(Jt.name)},Lr=async Jt=>{const li=Jt.decryptedContent,fi=li.waypoints.map(Ci=>({id:crypto.randomUUID(),name:Ci.name,lat:Ci.lat,lon:Ci.lon}));Pe(fi),Fe(li.routeCoords),Rt(li.alternateRouteCoords||null),He(!0),st(!1),_(li.routeCoords,li.alternateRouteCoords||null,li.waypoints.map(Ci=>({lat:Ci.lat,lon:Ci.lon})),!0),ue(!1)},pa=async Jt=>{if(!(!u||!V||!te)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){Lt(!0);try{const li={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Jt.id],["a",`${Uu.ROUTE_LOG}:${V}:${Jt.dTag}`]],content:"Deleted by user"},fi=await te(li);await Promise.allSettled(u.publish(lc,fi));const Ci={kind:Uu.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Jt.dTag],["deleted","true"]],content:""},Ei=await te(Ci);await Promise.allSettled(u.publish(lc,Ei)),Kt.current.add(Jt.dTag),Ht(cn=>cn.filter(Re=>Re.id!==Jt.id))}catch(li){console.error("Error deleting route:",li),alert("Failed to delete route")}finally{Lt(!1)}}};return ne.jsxs(ne.Fragment,{children:[ne.jsx("button",{onClick:()=>ue(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 hover:bg-white dark:hover:bg-white/20 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:ne.jsx(dM,{size:20})}),fe&&ne.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[ne.jsx("button",{onClick:()=>ue(!1),className:"absolute inset-0 z-0 cursor-default"}),Dt&&ne.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:ne.jsxs("div",{className:"flex flex-col items-center gap-3",children:[ne.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),ne.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),si&&ne.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:ne.jsxs("div",{className:"flex flex-col items-center gap-3",children:[ne.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),ne.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),ne.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[ne.jsxs("div",{className:"flex items-center justify-between",children:[ne.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),ne.jsx("button",{onClick:()=>ue(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 hover:bg-black/10 dark:hover:bg-white/20 transition-colors",children:ne.jsx(P0,{size:20,className:"text-black/60 dark:text-white/60"})})]}),ne.jsxs("div",{className:"space-y-2",children:[ne.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30 ml-2",children:"Add Waypoint"}),ne.jsx("div",{className:"relative",children:ne.jsx("input",{ref:Ct,type:"text",placeholder:"Search waypoints from saved routes",value:je,onChange:Jt=>be(Jt.target.value),className:"w-full h-14 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),ui.length>0&&ne.jsxs("div",{className:"rounded-2xl overflow-hidden bg-green-50 dark:bg-green-500/10 border border-green-500/20",children:[ne.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-500/5",children:" From your saved routes"}),ui.map((Jt,li)=>ne.jsxs("button",{onClick:()=>{const fi={id:crypto.randomUUID(),name:Jt.name,lat:Jt.lat,lon:Jt.lon};Pe(Ci=>[...Ci,fi]),be(""),Fe(null),Rt(null),He(!1),_(null,null,null,!1)},className:"w-full p-3 flex items-center gap-3 hover:bg-green-100 dark:hover:bg-green-500/10 transition-colors text-left border-b border-green-500/10 last:border-0",children:[ne.jsx(lg,{size:16,className:"text-green-600 dark:text-green-400 shrink-0"}),ne.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white/80 truncate",children:Jt.name})]},`saved-${li}`))]}),T&&ne.jsxs("button",{onClick:()=>{const Jt={id:crypto.randomUUID(),name:"Current Location",lat:T[0],lon:T[1]};Pe(li=>[...li,Jt]),Fe(null),Rt(null),He(!1),_(null,null,null,!1)},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 hover:bg-blue-500/20 transition-colors",children:[ne.jsx(lM,{size:16,className:"text-blue-500"}),ne.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),ne.jsxs("button",{onClick:Gi,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 hover:bg-orange-500/20 transition-colors",children:[ne.jsx(rM,{size:16,className:"text-orange-500"}),ne.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),ne.jsxs("div",{className:"space-y-2 flex-1",children:[ne.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30 ml-2",children:["Waypoints (",De.length,")"]}),De.length===0?ne.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):ne.jsx("div",{className:"space-y-2",children:De.map((Jt,li)=>ne.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[ne.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 text-white text-xs font-bold flex items-center justify-center shrink-0",children:li+1}),_e===Jt.id?ne.jsxs(ne.Fragment,{children:[ne.jsx("input",{type:"text",value:yt,onChange:fi=>Pt(fi.target.value),className:"flex-1 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onKeyDown:fi=>{fi.key==="Enter"&&Jn(Jt.id,yt),fi.key==="Escape"&&Ue(null)}}),ne.jsx("button",{onClick:()=>Jn(Jt.id,yt),className:"p-2 rounded-xl text-green-500 hover:bg-green-500/10 transition-colors",children:ne.jsx(jE,{size:16})})]}):ne.jsxs(ne.Fragment,{children:[ne.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:Jt.name}),ne.jsx("button",{onClick:()=>ln(Jt),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:ne.jsx(uM,{size:14})})]}),ne.jsx("button",{onClick:()=>Ai(Jt.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:ne.jsx(qy,{size:16})})]},Jt.id))})]}),ut&&ne.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[de?ne.jsx(QE,{size:20,className:"text-blue-500"}):ne.jsx(WE,{size:20,className:"text-zinc-400"}),ne.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),ne.jsx("button",{onClick:tn,className:`w-14 h-8 rounded-full transition-colors ${de?"bg-blue-500":"bg-zinc-300 dark:bg-white/20"}`,children:ne.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${de?"translate-x-7":"translate-x-1"}`})})]}),ut&&V&&ne.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[ne.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[ne.jsx(pM,{size:14}),"Save Route"]}),ne.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[ne.jsx("input",{type:"text",value:Ot,onChange:Jt=>Yt(Jt.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),ne.jsx("button",{onClick:Fn,disabled:si,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:si?"...":"Save"})]})]}),ne.jsxs("div",{className:"flex gap-3",children:[ne.jsx("button",{onClick:mn,disabled:De.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),ne.jsx("button",{onClick:vr,disabled:De.length<2||dt,className:"flex-1 h-14 rounded-2xl bg-blue-500 text-white font-bold shadow-lg shadow-blue-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:dt?"Creating...":"Create Route"})]}),!ut&&De.length>=2&&V&&ne.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),V&&ne.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[ne.jsxs("button",{onClick:()=>st(!Je),className:"w-full flex items-center justify-between",children:[ne.jsxs("div",{className:"flex items-center gap-2",children:[ne.jsx(eM,{size:18,className:"text-zinc-500 dark:text-white/50"}),ne.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30",children:["Saved Routes (",jt.length,")"]})]}),ne.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:Je?"Hide":"Show"})]}),Je&&ne.jsx("div",{className:"space-y-2",children:wt?ne.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):jt.length===0?ne.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):jt.map(Jt=>ne.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[ne.jsxs("button",{onClick:()=>Lr(Jt),className:"flex-1 text-left",children:[ne.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:Jt.decryptedContent.name}),ne.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[ne.jsxs("span",{children:[Jt.decryptedContent.waypoints.length," stops"]}),ne.jsx("span",{children:""}),ne.jsx(Ib,{size:12}),ne.jsx("span",{children:new Date(Jt.created_at*1e3).toLocaleDateString()})]})]}),ne.jsx("button",{onClick:()=>pa(Jt),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:ne.jsx(qy,{size:16})})]},Jt.id))})]}),ne.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:ne.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[ne.jsx("strong",{children:"Tip:"})," Use ",ne.jsx("strong",{children:"Drop Pin on Map"})," and",ne.jsx("strong",{children:" edit waypoint names"})," to label locations. When you ",ne.jsx("strong",{children:"save routes"}),", waypoint names become searchable  building your personal offline map over time! "]})})]})]})]})};var y_={exports:{}},v_={exports:{}};var XM=v_.exports,zv;function YM(){return zv||(zv=1,(function(f,_){(function(T,M){f.exports=M()})(XM,(function(){var T={},M={};function O(D,u,V){if(M[D]=V,D==="index"){var te="var sharedModule = {}; ("+M.shared+")(sharedModule); ("+M.worker+")(sharedModule);",fe={};return M.shared(fe),M.index(T,fe),typeof window<"u"&&T.setWorkerUrl(window.URL.createObjectURL(new Blob([te],{type:"text/javascript"}))),T}}O("shared",["exports"],(function(D){function u(n,e,i,o){return new(i||(i=Promise))((function(h,m){function g(z){try{E(o.next(z))}catch(R){m(R)}}function w(z){try{E(o.throw(z))}catch(R){m(R)}}function E(z){var R;z.done?h(z.value):(R=z.value,R instanceof i?R:new i((function(F){F(R)}))).then(g,w)}E((o=o.apply(n,e||[])).next())}))}function V(n,e){this.x=n,this.y=e}function te(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fe,ue;typeof SuppressedError=="function"&&SuppressedError,V.prototype={clone(){return new V(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),h=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:V},V.convert=function(n){if(n instanceof V)return n;if(Array.isArray(n))return new V(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new V(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var De=(function(){if(ue)return fe;function n(e,i,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=h}return ue=1,fe=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var m=this.sampleCurveX(o)-e;if(Math.abs(m)<i)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=m/g}var w=0,E=1;for(o=e,h=0;h<20&&(m=this.sampleCurveX(o),!(Math.abs(m-e)<i));h++)e>m?w=o:E=o,o=.5*(E-w)+w;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},fe})(),Pe=te(De);let je,be;function de(){return je==null&&(je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),je}function He(){if(be==null&&(be=!1,de())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const h=4*o;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){be=!0;break}}}return be||!1}var ut=1e-6,Fe=typeof Float32Array<"u"?Float32Array:Array;function Ut(){var n=new Fe(9);return Fe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Rt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function dt(){var n=new Fe(3);return Fe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function rt(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function Ct(n,e,i){var o=new Fe(3);return o[0]=n,o[1]=e,o[2]=i,o}function jt(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Ht(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Ot(n,e,i){var o=e[0],h=e[1],m=e[2],g=i[0],w=i[1],E=i[2];return n[0]=h*E-m*w,n[1]=m*g-o*E,n[2]=o*w-h*g,n}var Yt,si=rt;function oi(n,e,i){var o=e[0],h=e[1],m=e[2],g=e[3];return n[0]=i[0]*o+i[4]*h+i[8]*m+i[12]*g,n[1]=i[1]*o+i[5]*h+i[9]*m+i[13]*g,n[2]=i[2]*o+i[6]*h+i[10]*m+i[14]*g,n[3]=i[3]*o+i[7]*h+i[11]*m+i[15]*g,n}function wt(){var n=new Fe(4);return Fe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function ze(n,e,i,o){var h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",m=Math.PI/360;e*=m,o*=m,i*=m;var g=Math.sin(e),w=Math.cos(e),E=Math.sin(i),z=Math.cos(i),R=Math.sin(o),F=Math.cos(o);switch(h){case"xyz":n[0]=g*z*F+w*E*R,n[1]=w*E*F-g*z*R,n[2]=w*z*R+g*E*F,n[3]=w*z*F-g*E*R;break;case"xzy":n[0]=g*z*F-w*E*R,n[1]=w*E*F-g*z*R,n[2]=w*z*R+g*E*F,n[3]=w*z*F+g*E*R;break;case"yxz":n[0]=g*z*F+w*E*R,n[1]=w*E*F-g*z*R,n[2]=w*z*R-g*E*F,n[3]=w*z*F+g*E*R;break;case"yzx":n[0]=g*z*F+w*E*R,n[1]=w*E*F+g*z*R,n[2]=w*z*R-g*E*F,n[3]=w*z*F-g*E*R;break;case"zxy":n[0]=g*z*F-w*E*R,n[1]=w*E*F+g*z*R,n[2]=w*z*R+g*E*F,n[3]=w*z*F-g*E*R;break;case"zyx":n[0]=g*z*F-w*E*R,n[1]=w*E*F+g*z*R,n[2]=w*z*R-g*E*F,n[3]=w*z*F+g*E*R;break;default:throw new Error("Unknown angle order "+h)}return n}function Je(){var n=new Fe(2);return Fe!=Float32Array&&(n[0]=0,n[1]=0),n}function st(n,e){var i=new Fe(2);return i[0]=n,i[1]=e,i}dt(),Yt=new Fe(4),Fe!=Float32Array&&(Yt[0]=0,Yt[1]=0,Yt[2]=0,Yt[3]=0),dt(),Ct(1,0,0),Ct(0,1,0),wt(),wt(),Ut(),Je();const Et=8192;function lt(n,e,i){return e*(Et/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function _e(n,e){return(n%e+e)%e}function Ue(n,e,i){return n*(1-i)+e*i}function yt(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Pt(n,e,i,o){const h=new Pe(n,e,i,o);return m=>h.solve(m)}const Dt=Pt(.25,.1,.25,1);function Lt(n,e,i){return Math.min(i,Math.max(e,n))}function Kt(n,e,i){const o=i-e,h=((n-e)%o+o)%o+e;return h===e?i:h}function ui(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let Ai=1;function mn(n,e,i){const o={};for(const h in n)o[h]=e.call(this,n[h],h,n);return o}function vr(n,e,i){const o={};for(const h in n)e.call(this,n[h],h,n)&&(o[h]=n[h]);return o}function tn(n){return Array.isArray(n)?n.map(tn):typeof n=="object"&&n?mn(n,tn):n}const ar={};function Gi(n){ar[n]||(typeof console<"u"&&console.warn(n),ar[n]=!0)}function Fn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Jn(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let ln=null;function Lr(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const pa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Jt(n,e,i,o,h){return u(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(n,{timestamp:0});try{const g=m?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const w=g.startsWith("BGR"),E=new Uint8ClampedArray(o*h*4);if(yield m.copyTo(E,(function(z,R,F,Z,q){const Y=4*Math.max(-R,0),W=(Math.max(0,F)-F)*Z*4+Y,J=4*Z,re=Math.max(0,R),xe=Math.max(0,F);return{rect:{x:re,y:xe,width:Math.min(z.width,R+Z)-re,height:Math.min(z.height,F+q)-xe},layout:[{offset:W,stride:J}]}})(n,e,i,o,h)),w)for(let z=0;z<E.length;z+=4){const R=E[z];E[z]=E[z+2],E[z+2]=R}return E}finally{m.close()}}))}let li,fi;function Ci(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function Ei(n){return n*Math.PI/180}function cn(n){return n/Math.PI*180}const Re={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Q={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ee="AbortError";class se extends Error{constructor(e=ee){super(e instanceof Error?e.message:e),this.name=ee,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function ge(n){return n.name===ee}const we={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ze(n){return we.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Ne="global-dispatcher";class Ie extends Error{constructor(e,i,o,h){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=h}}const qe=()=>Jn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,gt=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Ze(n.url);if(o)return o(n,e);if(Jn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Ne},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(qe())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,h){return u(this,void 0,void 0,(function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:qe(),signal:h.signal});let g,w;o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");try{g=yield fetch(m)}catch(z){throw ge(z)?z:new Ie(0,z.message,o.url,new Blob)}if(!g.ok){const z=yield g.blob();throw new Ie(g.status,g.statusText,o.url,z)}w=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const E=yield w;return h.signal.throwIfAborted(),{data:E,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(n,e);if(Jn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Ne},e)}var i;return(function(o,h){return new Promise(((m,g)=>{var w;const E=new XMLHttpRequest;E.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(E.responseType="arraybuffer");for(const z in o.headers)E.setRequestHeader(z,o.headers[z]);o.type==="json"&&(E.responseType="text",!((w=o.headers)===null||w===void 0)&&w.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=o.credentials==="include",E.onerror=()=>{g(new Error(E.statusText))},E.onload=()=>{if(!h.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let z=E.response;if(o.type==="json")try{z=JSON.parse(E.response)}catch(R){return void g(R)}m({data:z,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const z=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});g(new Ie(E.status,E.statusText,o.url,z))}},h.signal.addEventListener("abort",(()=>{E.abort(),g(new se(h.signal.reason))})),E.send(o.body)}))})(n,e)};function ft(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function Ft(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function ei(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class hi{constructor(e,i={}){ui(this,i),this.type=e}}class Vi extends hi{constructor(e,i={}){super("error",ui({error:e},i))}}class Di{on(e,i){return this._listeners=this._listeners||{},Ft(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return ei(e,i,this._listeners),ei(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ft(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new hi(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const w of h)w.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const w of m)ei(o,w,this._oneTimeListeners),w.call(this,e);const g=this._eventedParent;g&&(ui(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Vi&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Wi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function er(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return Wi.forEach((o=>{o in e&&(i[o]=e[o])})),i}function pi(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!pi(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!pi(n[i],e[i]))return!1;return!0}return n===e}function Ki(n,e){n.push(e)}function un(n,e,i){Ki(i,{command:"addSource",args:[n,e[n]]})}function ji(n,e,i){Ki(e,{command:"removeSource",args:[n]}),i[n]=!0}function Ln(n,e,i,o){ji(n,i,o),un(n,e,i)}function sn(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!pi(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!pi(n[i][o],e[i][o]))return!1;return!0}function sr(n,e,i,o,h,m){n=n||{},e=e||{};for(const g in n)Object.prototype.hasOwnProperty.call(n,g)&&(pi(n[g],e[g])||i.push({command:m,args:[o,g,e[g],h]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(n,g)&&(pi(n[g],e[g])||i.push({command:m,args:[o,g,e[g],h]}))}function Ol(n){return n.id}function qr(n,e){return n[e.id]=e,n}class Qe{constructor(e,i,o,h){this.message=(e?`${e}: `:"")+o,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function kr(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class Rr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Za{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,h]of i)this.bindings[o]=h}concat(e){return new Za(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gn={kind:"null"},It={kind:"number"},yi={kind:"string"},gi={kind:"boolean"},ma={kind:"color"},Qc={kind:"projectionDefinition"},Ms={kind:"object"},vi={kind:"value"},il={kind:"collator"},rs={kind:"formatted"},Qs={kind:"padding"},Oa={kind:"colorArray"},As={kind:"numberArray"},Gn={kind:"resolvedImage"},Bl={kind:"variableAnchorOffsetCollection"};function Gr(n,e){return{kind:"array",itemType:n,N:e}}function Zi(n){if(n.kind==="array"){const e=Zi(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const as=[gn,It,yi,gi,ma,Qc,rs,Ms,Gr(vi),Qs,As,Oa,Gn,Bl];function Cs(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Cs(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of as)if(!Cs(i,e))return null}}return`Expected ${Zi(n)} but found ${Zi(e)} instead.`}function nl(n,e){return e.some((i=>i.kind===n.kind))}function Js(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function ia(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const qi=.96422,nn=.82521,na=4/29,Ri=6/29,Mo=3*Ri*Ri,Jc=Ri*Ri*Ri,Si=Math.PI/180,Hn=180/Math.PI;function rl(n){return(n%=360)<0&&(n+=360),n}function uc([n,e,i,o]){let h,m;const g=hc((.2225045*(n=Pn(n))+.7168786*(e=Pn(e))+.0606169*(i=Pn(i)))/1);n===e&&e===i?h=m=g:(h=hc((.4360747*n+.3850649*e+.1430804*i)/qi),m=hc((.0139322*n+.0971045*e+.7141733*i)/nn));const w=116*g-16;return[w<0?0:w,500*(h-g),200*(g-m),o]}function Pn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function hc(n){return n>Jc?Math.pow(n,1/3):n/Mo+na}function al([n,e,i,o]){let h=(n+16)/116,m=isNaN(e)?h:h+e/500,g=isNaN(i)?h:h-i/200;return h=1*Sn(h),m=qi*Sn(m),g=nn*Sn(g),[ss(3.1338561*m-1.6168667*h-.4906146*g),ss(-.9787684*m+1.9161415*h+.033454*g),ss(.0719453*m-.2289914*h+1.4052427*g),o]}function ss(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Sn(n){return n>Ri?n*n*n:Mo*(n-na)}const Ao=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function Ps(n,e){return Ao(n,e)?n[e]:void 0}function Ba(n){return parseInt(n.padEnd(2,n),16)/255}function eu(n,e){return os(e?n/100:n,0,1)}function os(n,e,i){return Math.min(Math.max(e,n),i)}function Nl(n){return!n.some(Number.isNaN)}const eo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ls(n,e,i){return n+i*(e-n)}function Co(n,e,i){return n.map(((o,h)=>ls(o,e[h],i)))}class bi{constructor(e,i,o,h=1,m=!0){this.r=e,this.g=i,this.b=o,this.a=h,m||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,i,o,h]))}static parse(e){if(e instanceof bi)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Ps(eo,o);if(h){const[g,w,E]=h;return[g/255,w/255,E/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let w=1;return[Ba(o.slice(w,w+=g)),Ba(o.slice(w,w+=g)),Ba(o.slice(w,w+=g)),Ba(o.slice(w,w+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[w,E,z,R,F,Z,q,Y,W,J,re,xe]=g,oe=[R||" ",q||" ",J].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const ce=[z,Z,W].join(""),Se=ce==="%%%"?100:ce===""?255:0;if(Se){const Ce=[os(+E/Se,0,1),os(+F/Se,0,1),os(+Y/Se,0,1),re?eu(+re,xe):1];if(Nl(Ce))return Ce}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,w,E,z,R,F,Z,q,Y]=m,W=[E||" ",R||" ",Z].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const J=[+w,os(+z,0,100),os(+F,0,100),q?eu(+q,Y):1];if(Nl(J))return(function([re,xe,oe,ce]){function Se(Ce){const Ye=(Ce+re/30)%12,_t=xe*Math.min(oe,1-oe);return oe-_t*Math.max(-1,Math.min(Ye-3,9-Ye,1))}return re=rl(re),xe/=100,oe/=100,[Se(0),Se(8),Se(4),ce]})(J)}}})(e);return i?new bi(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:h}=this,m=h||1/0;return this.overwriteGetter("rgb",[e/m,i/m,o/m,h])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,h,m]=uc(e),g=Math.sqrt(o*o+h*h);return[Math.round(1e4*g)?rl(Math.atan2(h,o)*Hn):NaN,g,i,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",uc(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,h]=this.rgb;return`rgba(${[e,i,o].map((m=>Math.round(255*m))).join(",")},${h})`}static interpolate(e,i,o,h="rgb"){switch(h){case"rgb":{const[m,g,w,E]=Co(e.rgb,i.rgb,o);return new bi(m,g,w,E,!1)}case"hcl":{const[m,g,w,E]=e.hcl,[z,R,F,Z]=i.hcl;let q,Y;if(isNaN(m)||isNaN(z))isNaN(m)?isNaN(z)?q=NaN:(q=z,w!==1&&w!==0||(Y=R)):(q=m,F!==1&&F!==0||(Y=g));else{let oe=z-m;z>m&&oe>180?oe-=360:z<m&&m-z>180&&(oe+=360),q=m+o*oe}const[W,J,re,xe]=(function([oe,ce,Se,Ce]){return oe=isNaN(oe)?0:oe*Si,al([Se,Math.cos(oe)*ce,Math.sin(oe)*ce,Ce])})([q,Y??ls(g,R,o),ls(w,F,o),ls(E,Z,o)]);return new bi(W,J,re,xe,!1)}case"lab":{const[m,g,w,E]=al(Co(e.lab,i.lab,o));return new bi(m,g,w,E,!1)}}}}bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1);class ga{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const tu=["bottom","center","top"];class sl{constructor(e,i,o,h,m,g){this.text=e,this.image=i,this.scale=o,this.fontStack=h,this.textColor=m,this.verticalAlign=g}}class xr{constructor(e){this.sections=e}static fromString(e){return new xr([new sl(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof xr?e:xr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class ii{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ii)return e;if(typeof e=="number")return new ii([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ii(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new ii(Co(e.values,i.values,o))}}class Hi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Hi)return e;if(typeof e=="number")return new Hi([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new Hi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Hi(Co(e.values,i.values,o))}}class $t{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof $t)return e;if(typeof e=="string"){const o=bi.parse(e);return o?new $t([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const h=bi.parse(o);if(!h)return;i.push(h)}return new $t(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,h="rgb"){const m=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)m.push(bi.interpolate(e.values[g],i.values[g],o,h));return new $t(m)}}class hn extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const _a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof kn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],h=e[i+1];if(typeof o!="string"||!_a.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new kn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const h=e.values,m=i.values;if(h.length!==m.length)throw new hn(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const g=[];for(let w=0;w<h.length;w+=2){if(h[w]!==m[w])throw new hn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${h[w]}, to[${w}]: ${m[w]}`);g.push(h[w]);const[E,z]=h[w+1],[R,F]=m[w+1];g.push([ls(E,R,o),ls(z,F,o)])}return new kn(g)}}class Or{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Or({name:e,available:!1}):null}}class Rn{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new Rn(e,i,o)}static parse(e){return e instanceof Rn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Rn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Rn(e.from,e.to,e.transition):typeof e=="string"?new Rn(e,e,1):void 0}}function ra(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ya(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Rn||n instanceof bi||n instanceof ga||n instanceof xr||n instanceof ii||n instanceof Hi||n instanceof $t||n instanceof kn||n instanceof Or)return!0;if(Array.isArray(n)){for(const e of n)if(!ya(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!ya(n[e]))return!1;return!0}return!1}function Pi(n){if(n===null)return gn;if(typeof n=="string")return yi;if(typeof n=="boolean")return gi;if(typeof n=="number")return It;if(n instanceof bi)return ma;if(n instanceof Rn)return Qc;if(n instanceof ga)return il;if(n instanceof xr)return rs;if(n instanceof ii)return Qs;if(n instanceof Hi)return As;if(n instanceof $t)return Oa;if(n instanceof kn)return Bl;if(n instanceof Or)return Gn;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const h=Pi(o);if(i){if(i===h)continue;i=vi;break}i=h}return Gr(i||vi,e)}return Ms}function va(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof bi||n instanceof Rn||n instanceof xr||n instanceof ii||n instanceof Hi||n instanceof $t||n instanceof kn||n instanceof Or?n.toString():JSON.stringify(n)}class xa{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ya(e[1]))return i.error("invalid value");const o=e[1];let h=Pi(o);const m=i.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new xa(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Po={string:yi,number:It,boolean:gi,object:Ms};class aa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,h=1;const m=e[0];if(m==="array"){let w,E;if(e.length>2){const z=e[1];if(typeof z!="string"||!(z in Po)||z==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=Po[z],h++}else w=vi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],h++}o=Gr(w,E)}else{if(!Po[m])throw new Error(`Types doesn't contain name = ${m}`);o=Po[m]}const g=[];for(;h<e.length;h++){const w=i.parse(e[h],h,vi);if(!w)return null;g.push(w)}return new aa(o,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Cs(this.type,Pi(o)))return o;if(i===this.args.length-1)throw new hn(`Expected value to be of type ${Zi(this.type)}, but found ${Zi(Pi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const or={"to-boolean":gi,"to-color":ma,"to-number":It,"to-string":yi};class Br{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!or[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const h=or[o],m=[];for(let g=1;g<e.length;g++){const w=i.parse(e[g],g,vi);if(!w)return null;m.push(w)}return new Br(h,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const h of this.args){if(i=h.evaluate(e),o=null,i instanceof bi)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ra(i[0],i[1],i[2],i[3]),!o))return new bi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new hn(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const h=ii.parse(i);if(h)return h}throw new hn(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const h=Hi.parse(i);if(h)return h}throw new hn(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const h=$t.parse(i);if(h)return h}throw new hn(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const h=kn.parse(i);if(h)return h}throw new hn(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new hn(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return xr.fromString(va(this.args[0].evaluate(e)));case"resolvedImage":return Or.fromString(va(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return va(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const dc=["Unknown","Point","LineString","Polygon"];class zo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=bi.parse(e),this._parseColorCache.set(e,i)),i}}class Ii{constructor(e,i,o=[],h,m=new Za,g=[]){this.registry=e,this.path=o,this.key=o.map((w=>`[${w}]`)).join(""),this.scope=m,this.errors=g,this.expectedType=h,this._isConstant=i}parse(e,i,o,h,m={}){return i?this.concat(i,o,h)._parse(e,m):this._parse(e,m)}_parse(e,i){function o(h,m,g){return g==="assert"?new aa(m,[h]):g==="coerce"?new Br(m,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const w=this.expectedType,E=g.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(E.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(E.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(E.kind)||w.kind==="colorArray"&&["value","string","array"].includes(E.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(E.kind))g=o(g,w,i.typeAnnotation||"coerce");else if(this.checkSubtype(w,E))return null}else g=o(g,w,i.typeAnnotation||"assert")}if(!(g instanceof xa)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const w=new zo;try{g=new xa(g.type,g.evaluate(w))}catch(E){return this.error(E.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const h=typeof e=="number"?this.path.concat(e):this.path,m=o?this.scope.concat(o):this.scope;return new Ii(this.registry,this._isConstant,h,i||null,m,this.errors)}error(e,...i){const o=`${this.key}${i.map((h=>`[${h}]`)).join("")}`;this.errors.push(new Rr(o,e))}checkSubtype(e,i){const o=Cs(e,i);return o&&this.error(o),o}}class dn{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const w=i.parse(e[m+1],m+1);if(!w)return null;o.push([g,w])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return h?new dn(o,h):null}outputDefined(){return this.result.outputDefined()}}class Pr{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Pr(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Mi{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,It),h=i.parse(e[2],2,Gr(i.expectedType||vi));return o&&h?new Mi(h.type.itemType,o,h):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new hn(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new hn(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new hn(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class xi{constructor(e,i){this.type=gi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,vi),h=i.parse(e[2],2,vi);return o&&h?nl(o.type,[gi,yi,It,gn,vi])?new xi(o,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Js(i,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Pi(i))} instead.`);if(!Js(o,["string","array"]))throw new hn(`Expected second argument to be of type array or string, but found ${Zi(Pi(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ol{constructor(e,i,o){this.type=It,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,vi),h=i.parse(e[2],2,vi);if(!o||!h)return null;if(!nl(o.type,[gi,yi,It,gn,vi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,It);return m?new ol(o,h,m):null}return new ol(o,h)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Js(i,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Pi(i))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),Js(o,["string"])){const m=o.indexOf(i,h);return m===-1?-1:[...o.slice(0,m)].length}if(Js(o,["array"]))return o.indexOf(i,h);throw new hn(`Expected second argument to be of type array or string, but found ${Zi(Pi(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Bi{constructor(e,i,o,h,m,g){this.inputType=e,this.type=i,this.input=o,this.cases=h,this.outputs=m,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const m={},g=[];for(let z=2;z<e.length-1;z+=2){let R=e[z];const F=e[z+1];Array.isArray(R)||(R=[R]);const Z=i.concat(z);if(R.length===0)return Z.error("Expected at least one branch label.");for(const Y of R){if(typeof Y!="number"&&typeof Y!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return Z.error("Numeric branch labels must be integer values.");if(o){if(Z.checkSubtype(o,Pi(Y)))return null}else o=Pi(Y);if(m[String(Y)]!==void 0)return Z.error("Branch labels must be unique.");m[String(Y)]=g.length}const q=i.parse(F,z,h);if(!q)return null;h=h||q.type,g.push(q)}const w=i.parse(e[1],1,vi);if(!w)return null;const E=i.parse(e[e.length-1],e.length-1,h);return E?w.type.kind!=="value"&&i.concat(1).checkSubtype(o,w.type)?null:new Bi(o,h,w,m,g,E):null}evaluate(e){const i=this.input.evaluate(e);return(Pi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class fc{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const w=i.parse(e[g],g,gi);if(!w)return null;const E=i.parse(e[g+1],g+1,o);if(!E)return null;h.push([w,E]),o=o||E.type}const m=i.parse(e[e.length-1],e.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new fc(o,h,m)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class Na{constructor(e,i,o,h){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,vi),h=i.parse(e[2],2,It);if(!o||!h)return null;if(!nl(o.type,[Gr(vi),yi,vi]))return i.error(`Expected first argument to be of type array or string, but found ${Zi(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,It);return m?new Na(o.type,o,h,m):null}return new Na(o.type,o,h)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),Js(i,["string"]))return[...i].slice(o,h).join("");if(Js(i,["array"]))return i.slice(o,h);throw new hn(`Expected first argument to be of type array or string, but found ${Zi(Pi(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Do(n,e){const i=n.length-1;let o,h,m=0,g=i,w=0;for(;m<=g;)if(w=Math.floor((m+g)/2),o=n[w],h=n[w+1],o<=e){if(w===i||e<h)return w;m=w+1}else{if(!(o>e))throw new hn("Input is not a number.");g=w-1}return 0}class Io{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,m]of o)this.labels.push(h),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,It);if(!o)return null;const h=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let g=1;g<e.length;g+=2){const w=g===1?-1/0:e[g],E=e[g+1],z=g,R=g+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(h.length&&h[h.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const F=i.parse(E,R,m);if(!F)return null;m=m||F.type,h.push([w,F])}return new Io(m,o,h)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const m=i.length;return h>=i[m-1]?o[m-1].evaluate(e):o[Do(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function iu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var pc,qa,Ad=(function(){if(qa)return pc;function n(e,i,o,h){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=h}return qa=1,pc=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,h=0;h<8;h++){var m=this.sampleCurveX(o)-e;if(Math.abs(m)<i)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=m/g}var w=0,E=1;for(o=e,h=0;h<20&&(m=this.sampleCurveX(o),!(Math.abs(m-e)<i));h++)e>m?w=o:E=o,o=.5*(E-w)+w;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},pc})(),nu=iu(Ad);class tr{constructor(e,i,o,h,m){this.type=e,this.operator=i,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[g,w]of m)this.labels.push(g),this.outputs.push(w)}static interpolationFactor(e,i,o,h){let m=0;if(e.name==="exponential")m=cs(i,e.base,o,h);else if(e.name==="linear")m=cs(i,1,o,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new nu(g[0],g[1],g[2],g[3]).solve(cs(i,1,o,h))}return m}static parse(e,i){let[o,h,m,...g]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const z=h[1];if(typeof z!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:z}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const z=h.slice(1);if(z.length!==4||z.some((R=>typeof R!="number"||R<0||R>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:z}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,It),!m)return null;const w=[];let E=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==Oa?i.expectedType&&i.expectedType.kind!=="value"&&(E=i.expectedType):E=ma;for(let z=0;z<g.length;z+=2){const R=g[z],F=g[z+1],Z=z+3,q=z+4;if(typeof R!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(w.length&&w[w.length-1][0]>=R)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const Y=i.parse(F,q,E);if(!Y)return null;E=E||Y.type,w.push([R,Y])}return ia(E,It)||ia(E,Qc)||ia(E,ma)||ia(E,Qs)||ia(E,As)||ia(E,Oa)||ia(E,Bl)||ia(E,Gr(It))?new tr(E,o,h,m,w):i.error(`Type ${Zi(E)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return o[0].evaluate(e);const m=i.length;if(h>=i[m-1])return o[m-1].evaluate(e);const g=Do(i,h),w=tr.interpolationFactor(this.interpolation,h,i[g],i[g+1]),E=o[g].evaluate(e),z=o[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ls(E,z,w);case"color":return bi.interpolate(E,z,w);case"padding":return ii.interpolate(E,z,w);case"colorArray":return $t.interpolate(E,z,w);case"numberArray":return Hi.interpolate(E,z,w);case"variableAnchorOffsetCollection":return kn.interpolate(E,z,w);case"array":return Co(E,z,w);case"projectionDefinition":return Rn.interpolate(E,z,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return bi.interpolate(E,z,w,"hcl");case"colorArray":return $t.interpolate(E,z,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return bi.interpolate(E,z,w,"lab");case"colorArray":return $t.interpolate(E,z,w,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function cs(n,e,i,o){const h=o-i,m=n-i;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}const zn={color:bi.interpolate,number:ls,padding:ii.interpolate,numberArray:Hi.interpolate,colorArray:$t.interpolate,variableAnchorOffsetCollection:kn.interpolate,array:Co};class to{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const h=i.expectedType;h&&h.kind!=="value"&&(o=h);const m=[];for(const w of e.slice(1)){const E=i.parse(w,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!E)return null;o=o||E.type,m.push(E)}if(!o)throw new Error("No output type");const g=h&&m.some((w=>Cs(h,w.type)));return new to(g?vi:o,m)}evaluate(e){let i,o=null,h=0;for(const m of this.args)if(h++,o=m.evaluate(e),o&&o instanceof Or&&!o.available&&(i||(i=o.name),o=null,h===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function mc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Fl(n,e,i,o){return o.compare(e,i)===0}function jn(n,e,i){const o=n!=="=="&&n!=="!=";return class Yb{constructor(m,g,w){this.type=gi,this.lhs=m,this.rhs=g,this.collator=w,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const w=m[0];let E=g.parse(m[1],1,vi);if(!E)return null;if(!mc(w,E.type))return g.concat(1).error(`"${w}" comparisons are not supported for type '${Zi(E.type)}'.`);let z=g.parse(m[2],2,vi);if(!z)return null;if(!mc(w,z.type))return g.concat(2).error(`"${w}" comparisons are not supported for type '${Zi(z.type)}'.`);if(E.type.kind!==z.type.kind&&E.type.kind!=="value"&&z.type.kind!=="value")return g.error(`Cannot compare types '${Zi(E.type)}' and '${Zi(z.type)}'.`);o&&(E.type.kind==="value"&&z.type.kind!=="value"?E=new aa(z.type,[E]):E.type.kind!=="value"&&z.type.kind==="value"&&(z=new aa(E.type,[z])));let R=null;if(m.length===4){if(E.type.kind!=="string"&&z.type.kind!=="string"&&E.type.kind!=="value"&&z.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(R=g.parse(m[3],3,il),!R)return null}return new Yb(E,z,R)}evaluate(m){const g=this.lhs.evaluate(m),w=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const E=Pi(g),z=Pi(w);if(E.kind!==z.kind||E.kind!=="string"&&E.kind!=="number")throw new hn(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${E.kind}, ${z.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const E=Pi(g),z=Pi(w);if(E.kind!=="string"||z.kind!=="string")return e(m,g,w)}return this.collator?i(m,g,w,this.collator.evaluate(m)):e(m,g,w)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const zh=jn("==",(function(n,e,i){return e===i}),Fl),ru=jn("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!Fl(0,e,i,o)})),au=jn("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),Cd=jn(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),ll=jn("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),gc=jn(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class io{constructor(e,i,o){this.type=il,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const h=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,gi);if(!h)return null;const m=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,gi);if(!m)return null;let g=null;return o.locale&&(g=i.parse(o.locale,1,yi),!g)?null:new io(h,m,g)}evaluate(e){return new ga(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class no{constructor(e,i,o,h,m){this.type=yi,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,It);if(!o)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=i.parse(h.locale,1,yi),!m))return null;let g=null;if(h.currency&&(g=i.parse(h.currency,1,yi),!g))return null;let w=null;if(h["min-fraction-digits"]&&(w=i.parse(h["min-fraction-digits"],1,It),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=i.parse(h["max-fraction-digits"],1,It),!E)?null:new no(o,m,g,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class _c{constructor(e){this.type=rs,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const h=[];let m=!1;for(let g=1;g<=e.length-1;++g){const w=e[g];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;let E=null;if(w["font-scale"]&&(E=i.parse(w["font-scale"],1,It),!E))return null;let z=null;if(w["text-font"]&&(z=i.parse(w["text-font"],1,Gr(yi)),!z))return null;let R=null;if(w["text-color"]&&(R=i.parse(w["text-color"],1,ma),!R))return null;let F=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!tu.includes(w["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(F=i.parse(w["vertical-align"],1,yi),!F)return null}const Z=h[h.length-1];Z.scale=E,Z.font=z,Z.textColor=R,Z.verticalAlign=F}else{const E=i.parse(e[g],1,vi);if(!E)return null;const z=E.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new _c(h)}evaluate(e){return new xr(this.sections.map((i=>{const o=i.content.evaluate(e);return Pi(o)===Gn?new sl("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new sl(va(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class zs{constructor(e){this.type=Gn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,yi);return o?new zs(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Or.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Nr{constructor(e){this.type=It,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Zi(o.type)} instead.`):new Nr(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new hn(`Expected value to be of type string or array, but found ${Zi(Pi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const $n=8192;function cl(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*$n),Math.round(o*h*$n)]}function jl(n,e){const i=Math.pow(2,e.z);return[(h=(n[0]/$n+e.x)/i,360*h-180),(o=(n[1]/$n+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function Lo(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ds(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Dh(n,e,i){const o=n[0]-e[0],h=n[1]-e[1],m=n[0]-i[0],g=n[1]-i[1];return o*g-m*h==0&&o*m<=0&&h*g<=0}function yc(n,e,i,o){return(h=[o[0]-i[0],o[1]-i[1]])[0]*(m=[e[0]-n[0],e[1]-n[1]])[1]-h[1]*m[0]!=0&&!(!Ga(n,e,i,o)||!Ga(i,o,n,e));var h,m}function Zu(n,e,i){for(const o of i)for(let h=0;h<o.length-1;++h)if(yc(n,e,o[h],o[h+1]))return!0;return!1}function us(n,e,i=!1){let o=!1;for(const w of e)for(let E=0;E<w.length-1;E++){if(Dh(n,w[E],w[E+1]))return i;(m=w[E])[1]>(h=n)[1]!=(g=w[E+1])[1]>h[1]&&h[0]<(g[0]-m[0])*(h[1]-m[1])/(g[1]-m[1])+m[0]&&(o=!o)}var h,m,g;return o}function ba(n,e){for(const i of e)if(us(n,i))return!0;return!1}function ul(n,e){for(const i of n)if(!us(i,e))return!1;for(let i=0;i<n.length-1;++i)if(Zu(n[i],n[i+1],e))return!1;return!0}function Ih(n,e){for(const i of e)if(ul(n,i))return!0;return!1}function Ga(n,e,i,o){const h=o[0]-i[0],m=o[1]-i[1],g=(n[0]-i[0])*m-h*(n[1]-i[1]),w=(e[0]-i[0])*m-h*(e[1]-i[1]);return g>0&&w<0||g<0&&w>0}function su(n,e,i){const o=[];for(let h=0;h<n.length;h++){const m=[];for(let g=0;g<n[h].length;g++){const w=cl(n[h][g],i);Lo(e,w),m.push(w)}o.push(m)}return o}function Ha(n,e,i){const o=[];for(let h=0;h<n.length;h++){const m=su(n[h],e,i);o.push(m)}return o}function Ul(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const h=.5*o;let m=n[0]-i[0]>h?-o:i[0]-n[0]>h?o:0;m===0&&(m=n[0]-i[2]>h?-o:i[2]-n[0]>h?o:0),n[0]+=m}Lo(e,n)}function Vl(n,e,i,o){const h=Math.pow(2,o.z)*$n,m=[o.x*$n,o.y*$n],g=[];for(const w of n)for(const E of w){const z=[E.x+m[0],E.y+m[1]];Ul(z,e,i,h),g.push(z)}return g}function Zl(n,e,i,o){const h=Math.pow(2,o.z)*$n,m=[o.x*$n,o.y*$n],g=[];for(const E of n){const z=[];for(const R of E){const F=[R.x+m[0],R.y+m[1]];Lo(e,F),z.push(F)}g.push(z)}if(e[2]-e[0]<=h/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of g)for(const z of E)Ul(z,e,i,h)}var w;return g}class hs{constructor(e,i){this.type=gi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ya(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const h=[];for(const m of o.features){const{type:g,coordinates:w}=m.geometry;g==="Polygon"&&h.push(w),g==="MultiPolygon"&&h.push(...w)}if(h.length)return new hs(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new hs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new hs(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(o.type==="Polygon"){const w=su(o.coordinates,m,g),E=Vl(i.geometry(),h,m,g);if(!Ds(h,m))return!1;for(const z of E)if(!us(z,w))return!1}if(o.type==="MultiPolygon"){const w=Ha(o.coordinates,m,g),E=Vl(i.geometry(),h,m,g);if(!Ds(h,m))return!1;for(const z of E)if(!ba(z,w))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(o.type==="Polygon"){const w=su(o.coordinates,m,g),E=Zl(i.geometry(),h,m,g);if(!Ds(h,m))return!1;for(const z of E)if(!ul(z,w))return!1}if(o.type==="MultiPolygon"){const w=Ha(o.coordinates,m,g),E=Zl(i.geometry(),h,m,g);if(!Ds(h,m))return!1;for(const z of E)if(!Ih(z,w))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let qu=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const h=n-1>>1,m=e[h];if(i(o,m)>=0)break;e[n]=m,n=h}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,h=e[n];for(;n<o;){let m=1+(n<<1);const g=m+1;if(g<this.length&&i(e[g],e[m])<0&&(m=g),i(e[m],h)>=0)break;e[n]=e[m],n=m}e[n]=h}};function $a(n,e,i=0,o=n.length-1,h=Gu){for(;o>i;){if(o-i>600){const E=o-i+1,z=e-i+1,R=Math.log(E),F=.5*Math.exp(2*R/3),Z=.5*Math.sqrt(R*F*(E-F)/E)*(z-E/2<0?-1:1);$a(n,e,Math.max(i,Math.floor(e-z*F/E+Z)),Math.min(o,Math.floor(e+(E-z)*F/E+Z)),h)}const m=n[e];let g=i,w=o;for(ds(n,i,e),h(n[o],m)>0&&ds(n,i,o);g<w;){for(ds(n,g,w),g++,w--;h(n[g],m)<0;)g++;for(;h(n[w],m)>0;)w--}h(n[i],m)===0?ds(n,i,w):(w++,ds(n,w,o)),w<=e&&(i=w+1),e<=w&&(o=w-1)}}function ds(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Gu(n,e){return n<e?-1:n>e?1:0}function hl(n,e){if(n.length<=1)return[n];const i=[];let o,h;for(const m of n){const g=ro(m);g!==0&&(m.area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(o&&i.push(o),o=[m]):o.push(m))}if(o&&i.push(o),e>1)for(let m=0;m<i.length;m++)i[m].length<=e||($a(i[m],e,1,i[m].length-1,Lh),i[m]=i[m].slice(0,e));return i}function Lh(n,e){return e.area-n.area}function ro(n){let e=0;for(let i,o,h=0,m=n.length,g=m-1;h<m;g=h++)i=n[h],o=n[g],e+=(o.x-i.x)*(i.y+o.y);return e}const kh=1/298.257223563,Is=kh*(2-kh),Rh=Math.PI/180;class fs{constructor(e){const i=6378.137*Rh*1e3,o=Math.cos(e*Rh),h=1/(1-Is*(1-o*o)),m=Math.sqrt(h);this.kx=i*m*o,this.ky=i*m*h*(1-Is)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(e,i){let o,h,m,g,w=1/0;for(let E=0;E<e.length-1;E++){let z=e[E][0],R=e[E][1],F=this.wrap(e[E+1][0]-z)*this.kx,Z=(e[E+1][1]-R)*this.ky,q=0;F===0&&Z===0||(q=(this.wrap(i[0]-z)*this.kx*F+(i[1]-R)*this.ky*Z)/(F*F+Z*Z),q>1?(z=e[E+1][0],R=e[E+1][1]):q>0&&(z+=F/this.kx*q,R+=Z/this.ky*q)),F=this.wrap(i[0]-z)*this.kx,Z=(i[1]-R)*this.ky;const Y=F*F+Z*Z;Y<w&&(w=Y,o=z,h=R,m=E,g=q)}return{point:[o,h],index:m,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Fr(n,e){return e[0]-n[0]}function ao(n){return n[1]-n[0]+1}function wa(n,e){return n[1]>=n[0]&&n[1]<e}function ko(n,e){if(n[0]>n[1])return[null,null];const i=ao(n);if(e){if(i===2)return[n,null];const h=Math.floor(i/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function ql(n,e){if(!wa(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Lo(i,n[o]);return i}function dl(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)Lo(e,o);return e}function Ls(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function fl(n,e,i){if(!Ls(n)||!Ls(e))return NaN;let o=0,h=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(h=n[1]-e[3]),n[3]<e[1]&&(h=e[1]-n[3]),i.distance([0,0],[o,h])}function Ta(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Gl(n,e,i,o,h){const m=Math.min(Ta(n,[i,o],h),Ta(e,[i,o],h)),g=Math.min(Ta(i,[n,e],h),Ta(o,[n,e],h));return Math.min(m,g)}function vc(n,e,i,o,h){if(!wa(e,n.length)||!wa(o,i.length))return 1/0;let m=1/0;for(let g=e[0];g<e[1];++g){const w=n[g],E=n[g+1];for(let z=o[0];z<o[1];++z){const R=i[z],F=i[z+1];if(yc(w,E,R,F))return 0;m=Math.min(m,Gl(w,E,R,F,h))}}return m}function pl(n,e,i,o,h){if(!wa(e,n.length)||!wa(o,i.length))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let w=o[0];w<=o[1];++w)if(m=Math.min(m,h.distance(n[g],i[w])),m===0)return m;return m}function Oh(n,e,i){if(us(n,e,!0))return 0;let o=1/0;for(const h of e){const m=h[0],g=h[h.length-1];if(m!==g&&(o=Math.min(o,Ta(n,[g,m],i)),o===0))return o;const w=i.pointOnLine(h,n);if(o=Math.min(o,i.distance(n,w.point)),o===0)return o}return o}function Ro(n,e,i,o){if(!wa(e,n.length))return NaN;for(let m=e[0];m<=e[1];++m)if(us(n[m],i,!0))return 0;let h=1/0;for(let m=e[0];m<e[1];++m){const g=n[m],w=n[m+1];for(const E of i)for(let z=0,R=E.length,F=R-1;z<R;F=z++){const Z=E[F],q=E[z];if(yc(g,w,Z,q))return 0;h=Math.min(h,Gl(g,w,Z,q,o))}}return h}function ml(n,e){for(const i of n)for(const o of i)if(us(o,e,!0))return!0;return!1}function ou(n,e,i,o=1/0){const h=dl(n),m=dl(e);if(o!==1/0&&fl(h,m,i)>=o)return o;if(Ds(h,m)){if(ml(n,e))return 0}else if(ml(e,n))return 0;let g=1/0;for(const w of n)for(let E=0,z=w.length,R=z-1;E<z;R=E++){const F=w[R],Z=w[E];for(const q of e)for(let Y=0,W=q.length,J=W-1;Y<W;J=Y++){const re=q[J],xe=q[Y];if(yc(F,Z,re,xe))return 0;g=Math.min(g,Gl(F,Z,re,xe,i))}}return g}function $i(n,e,i,o,h,m){if(!m)return;const g=fl(ql(o,m),h,i);g<e&&n.push([g,m,[0,0]])}function br(n,e,i,o,h,m,g){if(!m||!g)return;const w=fl(ql(o,m),ql(h,g),i);w<e&&n.push([w,m,g])}function Oo(n,e,i,o,h=1/0){let m=Math.min(o.distance(n[0],i[0][0]),h);if(m===0)return m;const g=new qu([[0,[0,n.length-1],[0,0]]],Fr),w=dl(i);for(;g.length>0;){const E=g.pop();if(E[0]>=m)continue;const z=E[1],R=e?50:100;if(ao(z)<=R){if(!wa(z,n.length))return NaN;if(e){const F=Ro(n,z,i,o);if(isNaN(F)||F===0)return F;m=Math.min(m,F)}else for(let F=z[0];F<=z[1];++F){const Z=Oh(n[F],i,o);if(m=Math.min(m,Z),m===0)return 0}}else{const F=ko(z,e);$i(g,m,o,n,w,F[0]),$i(g,m,o,n,w,F[1])}}return m}function xc(n,e,i,o,h,m=1/0){let g=Math.min(m,h.distance(n[0],i[0]));if(g===0)return g;const w=new qu([[0,[0,n.length-1],[0,i.length-1]]],Fr);for(;w.length>0;){const E=w.pop();if(E[0]>=g)continue;const z=E[1],R=E[2],F=e?50:100,Z=o?50:100;if(ao(z)<=F&&ao(R)<=Z){if(!wa(z,n.length)&&wa(R,i.length))return NaN;let q;if(e&&o)q=vc(n,z,i,R,h),g=Math.min(g,q);else if(e&&!o){const Y=n.slice(z[0],z[1]+1);for(let W=R[0];W<=R[1];++W)if(q=Ta(i[W],Y,h),g=Math.min(g,q),g===0)return g}else if(!e&&o){const Y=i.slice(R[0],R[1]+1);for(let W=z[0];W<=z[1];++W)if(q=Ta(n[W],Y,h),g=Math.min(g,q),g===0)return g}else q=pl(n,z,i,R,h),g=Math.min(g,q)}else{const q=ko(z,e),Y=ko(R,o);br(w,g,h,n,i,q[0],Y[0]),br(w,g,h,n,i,q[0],Y[1]),br(w,g,h,n,i,q[1],Y[0]),br(w,g,h,n,i,q[1],Y[1])}}return g}function gl(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class _l{constructor(e,i){this.type=It,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ya(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new _l(o,o.features.map((h=>gl(h.geometry))).flat());if(o.type==="Feature")return new _l(o,gl(o.geometry));if("type"in o&&"coordinates"in o)return new _l(o,gl(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const h=i.geometry(),m=h.flat().map((E=>jl([E.x,E.y],i.canonical)));if(h.length===0)return NaN;const g=new fs(m[0][1]);let w=1/0;for(const E of o){switch(E.type){case"Point":w=Math.min(w,xc(m,!1,[E.coordinates],!1,g,w));break;case"LineString":w=Math.min(w,xc(m,!1,E.coordinates,!0,g,w));break;case"Polygon":w=Math.min(w,Oo(m,!1,E.coordinates,g,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const h=i.geometry(),m=h.flat().map((E=>jl([E.x,E.y],i.canonical)));if(h.length===0)return NaN;const g=new fs(m[0][1]);let w=1/0;for(const E of o){switch(E.type){case"Point":w=Math.min(w,xc(m,!0,[E.coordinates],!1,g,w));break;case"LineString":w=Math.min(w,xc(m,!0,E.coordinates,!0,g,w));break;case"Polygon":w=Math.min(w,Oo(m,!0,E.coordinates,g,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const h=i.geometry();if(h.length===0||h[0].length===0)return NaN;const m=hl(h,0).map((E=>E.map((z=>z.map((R=>jl([R.x,R.y],i.canonical))))))),g=new fs(m[0][0][0][1]);let w=1/0;for(const E of o)for(const z of m){switch(E.type){case"Point":w=Math.min(w,Oo([E.coordinates],!1,z,g,w));break;case"LineString":w=Math.min(w,Oo(E.coordinates,!0,z,g,w));break;case"Polygon":w=Math.min(w,ou(z,E.coordinates,g,w))}if(w===0)return w}return w})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Hl{constructor(e){this.type=vi,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Hl(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?Ps(o,this.key):null}eachChild(){}outputDefined(){return!1}}const $l={"==":zh,"!=":ru,">":Cd,"<":au,">=":gc,"<=":ll,array:aa,at:Mi,boolean:aa,case:fc,coalesce:to,collator:io,format:_c,image:zs,in:xi,"index-of":ol,interpolate:tr,"interpolate-hcl":tr,"interpolate-lab":tr,length:Nr,let:dn,literal:xa,match:Bi,number:aa,"number-format":no,object:aa,slice:Na,step:Io,string:aa,"to-boolean":Br,"to-color":Br,"to-number":Br,"to-string":Br,var:Pr,within:hs,distance:_l,"global-state":Hl};class jr{constructor(e,i,o,h){this.name=e,this.type=i,this._evaluate=o,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],h=jr.definitions[o];if(!h)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=g.filter((([z])=>!Array.isArray(z)||z.length===e.length-1));let E=null;for(const[z,R]of w){E=new Ii(i.registry,sa,i.path,null,i.scope);const F=[];let Z=!1;for(let q=1;q<e.length;q++){const Y=e[q],W=Array.isArray(z)?z[q-1]:z.type,J=E.parse(Y,1+F.length,W);if(!J){Z=!0;break}F.push(J)}if(!Z)if(Array.isArray(z)&&z.length!==F.length)E.error(`Expected ${z.length} arguments, but found ${F.length} instead.`);else{for(let q=0;q<F.length;q++){const Y=Array.isArray(z)?z[q]:z.type,W=F[q];E.concat(q+1).checkSubtype(Y,W.type)}if(E.errors.length===0)return new jr(o,m,R,F)}}if(w.length===1)i.errors.push(...E.errors);else{const z=(w.length?w:g).map((([F])=>{return Z=F,Array.isArray(Z)?`(${Z.map(Zi).join(", ")})`:`(${Zi(Z.type)}...)`;var Z})).join(" | "),R=[];for(let F=1;F<e.length;F++){const Z=i.parse(e[F],1+R.length);if(!Z)return null;R.push(Zi(Z.type))}i.error(`Expected arguments of type ${z}, but found (${R.join(", ")}) instead.`)}return null}static register(e,i){jr.definitions=i;for(const o in i)e[o]=jr}}function Hu(n,[e,i,o,h]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const m=h?h.evaluate(n):1,g=ra(e,i,o,m);if(g)throw new hn(g);return new bi(e/255,i/255,o/255,m,!1)}function so(n,e){return n in e}function Sa(n,e){const i=e[n];return i===void 0?null:i}function ps(n){return{type:n}}function sa(n){if(n instanceof Pr)return sa(n.boundExpression);if(n instanceof jr&&n.name==="error"||n instanceof io||n instanceof hs||n instanceof _l||n instanceof Hl)return!1;const e=n instanceof Br||n instanceof aa;let i=!0;return n.eachChild((o=>{i=e?i&&sa(o):i&&o instanceof xa})),!!i&&Ur(n)&&No(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ur(n){if(n instanceof jr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof hs||n instanceof _l)return!1;let e=!0;return n.eachChild((i=>{e&&!Ur(i)&&(e=!1)})),e}function Bo(n){if(n instanceof jr&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!Bo(i)&&(e=!1)})),e}function No(n,e){if(n instanceof jr&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!No(o,e)&&(i=!1)})),i}function oo(n){return{result:"success",value:n}}function Fo(n){return{result:"error",value:n}}function oa(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function yl(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function vl(n){return!!n.expression&&n.expression.interpolated}function wi(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function lu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Pi(n)===Ms}function Ea(n){return n}function bc(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),h=n.type||(vl(e)?"exponential":"interval"),m=(function(R){switch(R.type){case"color":return bi.parse;case"padding":return ii.parse;case"numberArray":return Hi.parse;case"colorArray":return $t.parse;default:return null}})(e);if(m&&((n=kr({},n)).stops&&(n.stops=n.stops.map((R=>[R[0],m(R[1])]))),n.default=m(n.default?n.default:e.default)),n.colorSpace&&(g=n.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var g;const w=(function(R){switch(R){case"exponential":return jo;case"interval":return wc;case"categorical":return $u;case"identity":return cu;default:throw new Error(`Unknown function type "${R}"`)}})(h);let E,z;if(h==="categorical"){E=Object.create(null);for(const R of n.stops)E[R[0]]=R[1];z=typeof n.stops[0][0]}if(i){const R={},F=[];for(let Y=0;Y<n.stops.length;Y++){const W=n.stops[Y],J=W[0].zoom;R[J]===void 0&&(R[J]={zoom:J,type:n.type,property:n.property,default:n.default,stops:[]},F.push(J)),R[J].stops.push([W[0].value,W[1]])}const Z=[];for(const Y of F)Z.push([R[Y].zoom,bc(R[Y],e)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:tr.interpolationFactor.bind(void 0,q),zoomStops:Z.map((Y=>Y[0])),evaluate:({zoom:Y},W)=>jo({stops:Z,base:n.base},e,Y).evaluate(Y,W)}}if(o){const R=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:tr.interpolationFactor.bind(void 0,R),zoomStops:n.stops.map((F=>F[0])),evaluate:({zoom:F})=>w(n,e,F,E,z)}}return{kind:"source",evaluate(R,F){const Z=F&&F.properties?F.properties[n.property]:void 0;return Z===void 0?Ma(n.default,e.default):w(n,e,Z,E,z)}}}function Ma(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function $u(n,e,i,o,h){return Ma(typeof i===h?o[i]:void 0,n.default,e.default)}function wc(n,e,i){if(wi(i)!=="number")return Ma(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const h=Do(n.stops.map((m=>m[0])),i);return n.stops[h][1]}function jo(n,e,i){const o=n.base!==void 0?n.base:1;if(wi(i)!=="number")return Ma(n.default,e.default);const h=n.stops.length;if(h===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[h-1][0])return n.stops[h-1][1];const m=Do(n.stops.map((R=>R[0])),i),g=(function(R,F,Z,q){const Y=q-Z,W=R-Z;return Y===0?0:F===1?W/Y:(Math.pow(F,W)-1)/(Math.pow(F,Y)-1)})(i,o,n.stops[m][0],n.stops[m+1][0]),w=n.stops[m][1],E=n.stops[m+1][1],z=zn[e.type]||Ea;return typeof w.evaluate=="function"?{evaluate(...R){const F=w.evaluate.apply(void 0,R),Z=E.evaluate.apply(void 0,R);if(F!==void 0&&Z!==void 0)return z(F,Z,g,n.colorSpace)}}:z(w,E,g,n.colorSpace)}function cu(n,e,i){switch(e.type){case"color":i=bi.parse(i);break;case"formatted":i=xr.fromString(i.toString());break;case"resolvedImage":i=Or.fromString(i.toString());break;case"padding":i=ii.parse(i);break;case"colorArray":i=$t.parse(i);break;case"numberArray":i=Hi.parse(i);break;default:wi(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return Ma(i,n.default,e.default)}jr.register($l,{error:[{kind:"error"},[yi],(n,[e])=>{throw new hn(e.evaluate(n))}],typeof:[yi,[vi],(n,[e])=>Zi(Pi(e.evaluate(n)))],"to-rgba":[Gr(It,4),[ma],(n,[e])=>{const[i,o,h,m]=e.evaluate(n).rgb;return[255*i,255*o,255*h,m]}],rgb:[ma,[It,It,It],Hu],rgba:[ma,[It,It,It,It],Hu],has:{type:gi,overloads:[[[yi],(n,[e])=>so(e.evaluate(n),n.properties())],[[yi,Ms],(n,[e,i])=>so(e.evaluate(n),i.evaluate(n))]]},get:{type:vi,overloads:[[[yi],(n,[e])=>Sa(e.evaluate(n),n.properties())],[[yi,Ms],(n,[e,i])=>Sa(e.evaluate(n),i.evaluate(n))]]},"feature-state":[vi,[yi],(n,[e])=>Sa(e.evaluate(n),n.featureState||{})],properties:[Ms,[],n=>n.properties()],"geometry-type":[yi,[],n=>n.geometryType()],id:[vi,[],n=>n.id()],zoom:[It,[],n=>n.globals.zoom],"heatmap-density":[It,[],n=>n.globals.heatmapDensity||0],elevation:[It,[],n=>n.globals.elevation||0],"line-progress":[It,[],n=>n.globals.lineProgress||0],accumulated:[vi,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[It,ps(It),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[It,ps(It),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:It,overloads:[[[It,It],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[It],(n,[e])=>-e.evaluate(n)]]},"/":[It,[It,It],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[It,[It,It],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[It,[],()=>Math.LN2],pi:[It,[],()=>Math.PI],e:[It,[],()=>Math.E],"^":[It,[It,It],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[It,[It],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[It,[It],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[It,[It],(n,[e])=>Math.log(e.evaluate(n))],log2:[It,[It],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[It,[It],(n,[e])=>Math.sin(e.evaluate(n))],cos:[It,[It],(n,[e])=>Math.cos(e.evaluate(n))],tan:[It,[It],(n,[e])=>Math.tan(e.evaluate(n))],asin:[It,[It],(n,[e])=>Math.asin(e.evaluate(n))],acos:[It,[It],(n,[e])=>Math.acos(e.evaluate(n))],atan:[It,[It],(n,[e])=>Math.atan(e.evaluate(n))],min:[It,ps(It),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[It,ps(It),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[It,[It],(n,[e])=>Math.abs(e.evaluate(n))],round:[It,[It],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[It,[It],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[It,[It],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[gi,[yi,vi],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[gi,[vi],(n,[e])=>n.id()===e.value],"filter-type-==":[gi,[yi],(n,[e])=>n.geometryType()===e.value],"filter-<":[gi,[yi,vi],(n,[e,i])=>{const o=n.properties()[e.value],h=i.value;return typeof o==typeof h&&o<h}],"filter-id-<":[gi,[vi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[gi,[yi,vi],(n,[e,i])=>{const o=n.properties()[e.value],h=i.value;return typeof o==typeof h&&o>h}],"filter-id->":[gi,[vi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[gi,[yi,vi],(n,[e,i])=>{const o=n.properties()[e.value],h=i.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[gi,[vi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[gi,[yi,vi],(n,[e,i])=>{const o=n.properties()[e.value],h=i.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[gi,[vi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[gi,[vi],(n,[e])=>e.value in n.properties()],"filter-has-id":[gi,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[gi,[Gr(yi)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[gi,[Gr(vi)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[gi,[yi,Gr(vi)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[gi,[yi,Gr(vi)],(n,[e,i])=>(function(o,h,m,g){for(;m<=g;){const w=m+g>>1;if(h[w]===o)return!0;h[w]>o?g=w-1:m=w+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:gi,overloads:[[[gi,gi],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ps(gi),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:gi,overloads:[[[gi,gi],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ps(gi),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[gi,[gi],(n,[e])=>!e.evaluate(n)],"is-supported-script":[gi,[yi],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[yi,[yi],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[yi,[yi],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[yi,ps(vi),(n,e)=>e.map((i=>va(i.evaluate(n)))).join("")],"resolved-locale":[yi,[il],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Tc{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new zo,this._defaultValue=i?(function(h){if(h.type==="color"&&lu(h.default))return new bi(0,0,0,0);switch(h.type){case"color":return bi.parse(h.default)||null;case"padding":return ii.parse(h.default)||null;case"numberArray":return Hi.parse(h.default)||null;case"colorArray":return $t.parse(h.default)||null;case"variableAnchorOffsetCollection":return kn.parse(h.default)||null;case"projectionDefinition":return Rn.parse(h.default)||null;default:return h.default===void 0?null:h.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,h,m,g){return this._globalState&&(e=Ve(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,h,m,g){this._globalState&&(e=Ve(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new hn(`Expected value to be one of ${Object.keys(this._enumValues).map((E=>JSON.stringify(E))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Uo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in $l}function l(n,e,i){const o=new Ii($l,sa,[],e?(function(m){const g={color:ma,string:yi,number:It,enum:yi,boolean:gi,formatted:rs,padding:Qs,numberArray:As,colorArray:Oa,projectionDefinition:Qc,resolvedImage:Gn,variableAnchorOffsetCollection:Bl};return m.type==="array"?Gr(g[m.value]||vi,m.length):g[m.type]})(e):void 0),h=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?oo(new Tc(h,e,i)):Fo(o.errors)}class v{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Bo(i.expression),this.globalStateRefs=Ae(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,h,m,g){return this._globalState&&(e=Ve(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,m,g)}evaluate(e,i,o,h,m,g){return this._globalState&&(e=Ve(e,this._globalState)),this._styleExpression.evaluate(e,i,o,h,m,g)}}class A{constructor(e,i,o,h,m){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Bo(i.expression),this.globalStateRefs=Ae(i.expression),this.interpolationType=h,this._globalState=m}evaluateWithoutErrorHandling(e,i,o,h,m,g){return this._globalState&&(e=Ve(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,h,m,g)}evaluate(e,i,o,h,m,g){return this._globalState&&(e=Ve(e,this._globalState)),this._styleExpression.evaluate(e,i,o,h,m,g)}interpolationFactor(e,i,o){return this.interpolationType?tr.interpolationFactor(this.interpolationType,e,i,o):0}}function B(n,e,i){const o=l(n,e,i);if(o.result==="error")return o;const h=o.value.expression,m=Ur(h);if(!m&&!oa(e))return Fo([new Rr("","data expressions not supported")]);const g=No(h,["zoom"]);if(!g&&!yl(e))return Fo([new Rr("","zoom expressions not supported")]);const w=ae(h);return w||g?w instanceof Rr?Fo([w]):w instanceof tr&&!vl(e)?Fo([new Rr("",'"interpolate" expressions cannot be used with this property')]):oo(w?new A(m?"camera":"composite",o.value,w.labels,w instanceof tr?w.interpolation:void 0,i):new v(m?"constant":"source",o.value,i)):Fo([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class H{constructor(e,i){this._parameters=e,this._specification=i,kr(this,bc(this._parameters,this._specification))}static deserialize(e){return new H(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ae(n){let e=null;if(n instanceof dn)e=ae(n.result);else if(n instanceof to){for(const i of n.args)if(e=ae(i),e)break}else(n instanceof Io||n instanceof tr)&&n.input instanceof jr&&n.input.name==="zoom"&&(e=n);return e instanceof Rr||n.eachChild((i=>{const o=ae(i);o instanceof Rr?e=o:!e&&o?e=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Ae(n,e=new Set){return n instanceof Hl&&e.add(n.key),n.eachChild((i=>{Ae(i,e)})),e}function Ve(n,e){const{zoom:i,heatmapDensity:o,elevation:h,lineProgress:m,isSupportedScript:g,accumulated:w}=n??{};return{zoom:i,heatmapDensity:o,elevation:h,lineProgress:m,isSupportedScript:g,accumulated:w,globalState:e}}function at(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!at(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Mt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Zt(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};at(n)||(n=lr(n));const i=l(n,Mt,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,h,m)=>i.value.evaluate(o,h,{},m),needGeometry:Li(n),getGlobalStateRefs:()=>Ae(i.value.expression)}}function ci(n,e){return n<e?-1:n>e?1:0}function Li(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Li(n[e]))return!0;return!1}function lr(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Xn(n[1],n[2],"=="):e==="!="?Xi(Xn(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Xn(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(lr))):e==="all"?["all"].concat(n.slice(1).map(lr)):e==="none"?["all"].concat(n.slice(1).map(lr).map(Xi)):e==="in"?Aa(n[1],n.slice(2)):e==="!in"?Xi(Aa(n[1],n.slice(2))):e==="has"?on(n[1]):e!=="!has"||Xi(on(n[1]));var i}function Xn(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Aa(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(ci)]]:["filter-in-small",n,["literal",e]]}}function on(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Xi(n){return["!",n]}function Ni(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const m of n)h+=`${Ni(m)},`;return`${h}]`}const i=Object.keys(n).sort();let o="{";for(let h=0;h<i.length;h++)o+=`${JSON.stringify(i[h])}:${Ni(n[i[h]])},`;return`${o}}`}function lo(n){let e="";for(const i of Wi)e+=`/${Ni(n[i])}`;return e}function Fa(n){const e=n.value;return e?[new Qe(n.key,e,"constants have been deprecated as of v8")]:[]}function On(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ca(n){if(Array.isArray(n))return n.map(Ca);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Ca(n[i]);return e}return On(n)}function la(n){const e=n.key,i=n.value,o=n.valueSpec||{},h=n.objectElementValidators||{},m=n.style,g=n.styleSpec,w=n.validateSpec;let E=[];const z=wi(i);if(z!=="object")return[new Qe(e,i,`object expected, ${z} found`)];for(const R in i){const F=R.split(".")[0],Z=Ps(o,F)||o["*"];let q;if(Ps(h,F))q=h[F];else if(Ps(o,F)){if(i[R]===void 0)continue;q=w}else if(h["*"])q=h["*"];else{if(!o["*"]){E.push(new Qe(e,i[R],`unknown property "${R}"`));continue}q=w}E=E.concat(q({key:(e&&`${e}.`)+R,value:i[R],valueSpec:Z,style:m,styleSpec:g,object:i,objectKey:R,validateSpec:w},i))}for(const R in o)h[R]||o[R].required&&o[R].default===void 0&&i[R]===void 0&&E.push(new Qe(e,i,`missing required property "${R}"`));return E}function Un(n){const e=n.value,i=n.valueSpec,o=n.style,h=n.styleSpec,m=n.key,g=n.arrayElementValidator||n.validateSpec;if(wi(e)!=="array")return[new Qe(m,e,`array expected, ${wi(e)} found`)];if(i.length&&e.length!==i.length)return[new Qe(m,e,`array length ${i.length} expected, length ${e.length} found`)];let w={type:i.value,values:i.values};h.$version<7&&(w.function=i.function),wi(i.value)==="object"&&(w=i.value);let E=[];for(let z=0;z<e.length;z++)E=E.concat(g({array:e,arrayIndex:z,value:e[z],valueSpec:w,validateSpec:n.validateSpec,style:o,styleSpec:h,key:`${m}[${z}]`}));return E}function ja(n){const e=n.key,i=n.value,o=n.valueSpec;let h=wi(i);return h==="number"&&i!=i&&(h="NaN"),h!=="number"?[new Qe(e,i,`number expected, ${h} found`)]:"minimum"in o&&i<o.minimum?[new Qe(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Qe(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function ks(n){const e=n.valueSpec,i=On(n.value.type);let o,h,m,g={};const w=i!=="categorical"&&n.value.property===void 0,E=!w,z=wi(n.value.stops)==="array"&&wi(n.value.stops[0])==="array"&&wi(n.value.stops[0][0])==="object",R=la({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(q){if(i==="identity")return[new Qe(q.key,q.value,'identity function may not have a "stops" property')];let Y=[];const W=q.value;return Y=Y.concat(Un({key:q.key,value:W,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:F})),wi(W)==="array"&&W.length===0&&Y.push(new Qe(q.key,W,"array must have at least one stop")),Y},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return i==="identity"&&w&&R.push(new Qe(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||R.push(new Qe(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!vl(n.valueSpec)&&R.push(new Qe(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(E&&!oa(n.valueSpec)?R.push(new Qe(n.key,n.value,"property functions not supported")):w&&!yl(n.valueSpec)&&R.push(new Qe(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!z||n.value.property!==void 0||R.push(new Qe(n.key,n.value,'"property" property is required')),R;function F(q){let Y=[];const W=q.value,J=q.key;if(wi(W)!=="array")return[new Qe(J,W,`array expected, ${wi(W)} found`)];if(W.length!==2)return[new Qe(J,W,`array length 2 expected, length ${W.length} found`)];if(z){if(wi(W[0])!=="object")return[new Qe(J,W,`object expected, ${wi(W[0])} found`)];if(W[0].zoom===void 0)return[new Qe(J,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new Qe(J,W,"object stop key must have value")];if(m&&m>On(W[0].zoom))return[new Qe(J,W[0].zoom,"stop zoom values must appear in ascending order")];On(W[0].zoom)!==m&&(m=On(W[0].zoom),h=void 0,g={}),Y=Y.concat(la({key:`${J}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:ja,value:Z}}))}else Y=Y.concat(Z({key:`${J}[0]`,value:W[0],validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},W));return Uo(Ca(W[1]))?Y.concat([new Qe(`${J}[1]`,W[1],"expressions are not allowed in function stops.")]):Y.concat(q.validateSpec({key:`${J}[1]`,value:W[1],valueSpec:e,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function Z(q,Y){const W=wi(q.value),J=On(q.value),re=q.value!==null?q.value:Y;if(o){if(W!==o)return[new Qe(q.key,re,`${W} stop domain type must match previous stop domain type ${o}`)]}else o=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new Qe(q.key,re,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&i!=="categorical"){let xe=`number expected, ${W} found`;return oa(e)&&i===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(q.key,re,xe)]}return i!=="categorical"||W!=="number"||isFinite(J)&&Math.floor(J)===J?i!=="categorical"&&W==="number"&&h!==void 0&&J<h?[new Qe(q.key,re,"stop domain values must appear in ascending order")]:(h=J,i==="categorical"&&J in g?[new Qe(q.key,re,"stop domain values must be unique")]:(g[J]=!0,[])):[new Qe(q.key,re,`integer expected, found ${J}`)]}}function Rs(n){const e=(n.expressionContext==="property"?B:l)(Ca(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new Qe(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new Qe(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Bo(i))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Bo(i))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!No(i,["zoom","feature-state"]))return[new Qe(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ur(i))return[new Qe(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function co(n){const e=n.key,i=n.value,o=wi(i);return o!=="string"?[new Qe(e,i,`color expected, ${o} found`)]:bi.parse(String(i))?[]:[new Qe(e,i,`color expected, "${i}" found`)]}function ms(n){const e=n.key,i=n.value,o=n.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(On(i))===-1&&h.push(new Qe(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(On(i))===-1&&h.push(new Qe(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Ua(n){return at(Ca(n.value))?Rs(kr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Os(n)}function Os(n){const e=n.value,i=n.key;if(wi(e)!=="array")return[new Qe(i,e,`array expected, ${wi(e)} found`)];const o=n.styleSpec;let h,m=[];if(e.length<1)return[new Qe(i,e,"filter array must have at least 1 element")];switch(m=m.concat(ms({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),On(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&On(e[1])==="$type"&&m.push(new Qe(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Qe(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=wi(e[1]),h!=="string"&&m.push(new Qe(`${i}[1]`,e[1],`string expected, ${h} found`)));for(let g=2;g<e.length;g++)h=wi(e[g]),On(e[1])==="$type"?m=m.concat(ms({key:`${i}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&m.push(new Qe(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(Os({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=wi(e[1]),e.length!==2?m.push(new Qe(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&m.push(new Qe(`${i}[1]`,e[1],`string expected, ${h} found`))}return m}function xl(n,e){const i=n.key,o=n.validateSpec,h=n.style,m=n.styleSpec,g=n.value,w=n.objectKey,E=m[`${e}_${n.layerType}`];if(!E)return[];const z=w.match(/^(.*)-transition$/);if(e==="paint"&&z&&E[z[1]]&&E[z[1]].transition)return o({key:i,value:g,valueSpec:m.transition,style:h,styleSpec:m});const R=n.valueSpec||E[w];if(!R)return[new Qe(i,g,`unknown property "${w}"`)];let F;if(wi(g)==="string"&&oa(R)&&!R.tokens&&(F=/^{([^}]+)}$/.exec(g)))return[new Qe(i,g,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const Z=[];return n.layerType==="symbol"&&w==="text-font"&&lu(Ca(g))&&On(g.type)==="identity"&&Z.push(new Qe(i,g,'"text-font" does not support identity functions')),Z.concat(o({key:n.key,value:g,valueSpec:R,style:h,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:w}))}function Vo(n){return xl(n,"paint")}function Bh(n){return xl(n,"layout")}function Nh(n){let e=[];const i=n.value,o=n.key,h=n.style,m=n.styleSpec;if(wi(i)!=="object")return[new Qe(o,i,`object expected, ${wi(i)} found`)];i.type||i.ref||e.push(new Qe(o,i,'either "type" or "ref" is required'));let g=On(i.type);const w=On(i.ref);if(i.id){const E=On(i.id);for(let z=0;z<n.arrayIndex;z++){const R=h.layers[z];On(R.id)===E&&e.push(new Qe(o,i.id,`duplicate layer id "${i.id}", previously used at line ${R.id.__line__}`))}}if("ref"in i){let E;["type","source","source-layer","filter","layout"].forEach((z=>{z in i&&e.push(new Qe(o,i[z],`"${z}" is prohibited for ref layers`))})),h.layers.forEach((z=>{On(z.id)===w&&(E=z)})),E?E.ref?e.push(new Qe(o,i.ref,"ref cannot reference another ref layer")):g=On(E.type):e.push(new Qe(o,i.ref,`ref layer "${w}" not found`))}else if(g!=="background")if(i.source){const E=h.sources&&h.sources[i.source],z=E&&On(E.type);E?z==="vector"&&g==="raster"?e.push(new Qe(o,i.source,`layer "${i.id}" requires a raster source`)):z!=="raster-dem"&&g==="hillshade"||z!=="raster-dem"&&g==="color-relief"?e.push(new Qe(o,i.source,`layer "${i.id}" requires a raster-dem source`)):z==="raster"&&g!=="raster"?e.push(new Qe(o,i.source,`layer "${i.id}" requires a vector source`)):z!=="vector"||i["source-layer"]?z==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new Qe(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]||z==="geojson"&&E.lineMetrics||e.push(new Qe(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Qe(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Qe(o,i.source,`source "${i.source}" not found`))}else e.push(new Qe(o,i,'missing required property "source"'));return e=e.concat(la({key:o,value:i,valueSpec:m.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:m.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:Ua,layout:E=>la({layer:i,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":z=>Bh(kr({layerType:g},z))}}),paint:E=>la({layer:i,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":z=>Vo(kr({layerType:g},z))}})}})),e}function gs(n){const e=n.value,i=n.key,o=wi(e);return o!=="string"?[new Qe(i,e,`string expected, ${o} found`)]:[]}const uu={promoteId:function({key:n,value:e}){if(wi(e)==="string")return gs({key:n,value:e});{const i=[];for(const o in e)i.push(...gs({key:`${n}.${o}`,value:e[o]}));return i}}};function bl(n){const e=n.value,i=n.key,o=n.styleSpec,h=n.style,m=n.validateSpec;if(!e.type)return[new Qe(i,e,'"type" is required')];const g=On(e.type);let w;switch(g){case"vector":case"raster":return w=la({key:i,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:uu,validateSpec:m}),w;case"raster-dem":return w=(function(E){var z;const R=(z=E.sourceName)!==null&&z!==void 0?z:"",F=E.value,Z=E.styleSpec,q=Z.source_raster_dem,Y=E.style;let W=[];const J=wi(F);if(F===void 0)return W;if(J!=="object")return W.push(new Qe("source_raster_dem",F,`object expected, ${J} found`)),W;const re=On(F.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],oe=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const ce in F)!re&&xe.includes(ce)?W.push(new Qe(ce,F[ce],`In "${R}": "${ce}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):q[ce]?W=W.concat(E.validateSpec({key:ce,value:F[ce],valueSpec:q[ce],validateSpec:E.validateSpec,style:Y,styleSpec:Z})):W.push(new Qe(ce,F[ce],`unknown property "${ce}"`));return W})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:m}),w;case"geojson":if(w=la({key:i,value:e,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:m,objectElementValidators:uu}),e.cluster)for(const E in e.clusterProperties){const[z,R]=e.clusterProperties[E],F=typeof z=="string"?[z,["accumulated"],["get",E]]:z;w.push(...Rs({key:`${i}.${E}.map`,value:R,expressionContext:"cluster-map"})),w.push(...Rs({key:`${i}.${E}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return w;case"video":return la({key:i,value:e,valueSpec:o.source_video,style:h,validateSpec:m,styleSpec:o});case"image":return la({key:i,value:e,valueSpec:o.source_image,style:h,validateSpec:m,styleSpec:o});case"canvas":return[new Qe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ms({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function wr(n){const e=n.value,i=n.styleSpec,o=i.light,h=n.style;let m=[];const g=wi(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Qe("light",e,`object expected, ${g} found`)]),m;for(const w in e){const E=w.match(/^(.*)-transition$/);m=m.concat(E&&o[E[1]]&&o[E[1]].transition?n.validateSpec({key:w,value:e[w],valueSpec:i.transition,validateSpec:n.validateSpec,style:h,styleSpec:i}):o[w]?n.validateSpec({key:w,value:e[w],valueSpec:o[w],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new Qe(w,e[w],`unknown property "${w}"`)])}return m}function Xu(n){const e=n.value,i=n.styleSpec,o=i.sky,h=n.style,m=wi(e);if(e===void 0)return[];if(m!=="object")return[new Qe("sky",e,`object expected, ${m} found`)];let g=[];for(const w in e)g=g.concat(o[w]?n.validateSpec({key:w,value:e[w],valueSpec:o[w],style:h,styleSpec:i}):[new Qe(w,e[w],`unknown property "${w}"`)]);return g}function Fh(n){const e=n.value,i=n.styleSpec,o=i.terrain,h=n.style;let m=[];const g=wi(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Qe("terrain",e,`object expected, ${g} found`)]),m;for(const w in e)m=m.concat(o[w]?n.validateSpec({key:w,value:e[w],valueSpec:o[w],validateSpec:n.validateSpec,style:h,styleSpec:i}):[new Qe(w,e[w],`unknown property "${w}"`)]);return m}function Pd(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const h=[],m=[];for(const g in i)i[g].id&&h.includes(i[g].id)&&e.push(new Qe(o,i,`all the sprites' ids must be unique, but ${i[g].id} is duplicated`)),h.push(i[g].id),i[g].url&&m.includes(i[g].url)&&e.push(new Qe(o,i,`all the sprites' URLs must be unique, but ${i[g].url} is duplicated`)),m.push(i[g].url),e=e.concat(la({key:`${o}[${g}]`,value:i[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return gs({key:o,value:i})}function kf(n){return!!n&&n.constructor===Object}function zd(n){return kf(n.value)?[]:[new Qe(n.key,n.value,`object expected, ${wi(n.value)} found`)]}const mr={"*":()=>[],array:Un,boolean:function(n){const e=n.value,i=n.key,o=wi(e);return o!=="boolean"?[new Qe(i,e,`boolean expected, ${o} found`)]:[]},number:ja,color:co,constants:Fa,enum:ms,filter:Ua,function:ks,layer:Nh,object:la,source:bl,light:wr,sky:Xu,terrain:Fh,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,h=n.style,m=wi(e);if(e===void 0)return[];if(m!=="object")return[new Qe("projection",e,`object expected, ${m} found`)];let g=[];for(const w in e)g=g.concat(o[w]?n.validateSpec({key:w,value:e[w],valueSpec:o[w],style:h,styleSpec:i}):[new Qe(w,e[w],`unknown property "${w}"`)]);return g},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=wi(i);return o!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(i)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(i)?["array","string"].includes(o)?[]:[new Qe(e,i,`projection expected, invalid type "${o}" found`)]:[new Qe(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:gs,formatted:function(n){return gs(n).length===0?[]:Rs(n)},resolvedImage:function(n){return gs(n).length===0?[]:Rs(n)},padding:function(n){const e=n.key,i=n.value;if(wi(i)==="array"){if(i.length<1||i.length>4)return[new Qe(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let h=[];for(let m=0;m<i.length;m++)h=h.concat(n.validateSpec({key:`${e}[${m}]`,value:i[m],validateSpec:n.validateSpec,valueSpec:o}));return h}return ja({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(wi(i)==="array"){const o={type:"number"};if(i.length<1)return[new Qe(e,i,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<i.length;m++)h=h.concat(n.validateSpec({key:`${e}[${m}]`,value:i[m],validateSpec:n.validateSpec,valueSpec:o}));return h}return ja({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(wi(i)==="array"){if(i.length<1)return[new Qe(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let h=0;h<i.length;h++)o=o.concat(co({key:`${e}[${h}]`,value:i[h]}));return o}return co({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=wi(i),h=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Qe(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<i.length;g+=2)m=m.concat(ms({key:`${e}[${g}]`,value:i[g],valueSpec:h.layout_symbol["text-anchor"]})),m=m.concat(Un({key:`${e}[${g+1}]`,value:i[g+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return m},sprite:Pd,state:zd,fontFaces:function(n){const e=n.key,i=n.value,o=n.validateSpec,h=n.styleSpec,m=n.style;if(!kf(i))return[new Qe(e,i,`object expected, ${wi(i)} found`)];const g=[];for(const w in i){const E=i[w],z=wi(E);if(z==="string")g.push(...gs({key:`${e}.${w}`,value:E}));else if(z==="array"){const R={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[F,Z]of E.entries())g.push(...la({key:`${e}.${w}[${F}]`,value:Z,valueSpec:R,styleSpec:h,style:m,validateSpec:o}))}else g.push(new Qe(`${e}.${w}`,E,`string or array expected, ${z} found`))}return g}};function Zo(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=Zo,i.expression&&lu(On(e))?ks(n):i.expression&&Uo(Ca(e))?Rs(n):i.type&&mr[i.type]?mr[i.type](n):la(kr({},n,{valueSpec:i.type?o[i.type]:i}))}function hu(n){const e=n.value,i=n.key,o=gs(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Qe(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Qe(i,e,'"glyphs" url must include a "{range}" token'))),o}function Pa(n,e=$e){let i=[];return i=i.concat(Zo({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:Zo,objectElementValidators:{glyphs:hu,"*":()=>[]}})),n.constants&&(i=i.concat(Fa({key:"constants",value:n.constants}))),Sc(i)}function _s(n){return function(e){return n(Object.assign({},e,{validateSpec:Zo}))}}function Sc(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function za(n){return function(...e){return Sc(n.apply(this,e))}}Pa.source=za(_s(bl)),Pa.sprite=za(_s(Pd)),Pa.glyphs=za(_s(hu)),Pa.light=za(_s(wr)),Pa.sky=za(_s(Xu)),Pa.terrain=za(_s(Fh)),Pa.state=za(_s(zd)),Pa.layer=za(_s(Nh)),Pa.filter=za(_s(Ua)),Pa.paintProperty=za(_s(Vo)),Pa.layoutProperty=za(_s(Bh));const Wp={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class du{constructor(e,i){this._globalState=i,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const i=l(e,Wp,this._globalState);if(i.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=i.value,this._globalStateRefs=Ae(i.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Yu=$e,Vr=Pa,uo=Vr.light,jh=Vr.sky,Uh=Vr.paintProperty,Rf=Vr.layoutProperty;function ho(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new Vi(new Error(o.message))),i=!0;return i}class Xl{constructor(e,i,o){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(i=g[1])+2*(o=g[2]);for(let E=0;E<this.d*this.d;E++){const z=g[3+E],R=g[3+E+1];h.push(z===R?null:g.subarray(z,R))}const w=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],w),this.bboxes=g.subarray(w),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let g=0;g<this.d*this.d;g++)h.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const m=o/i*e;this.min=-m,this.max=e+m}insert(e,i,o,h,m){this._forEachCell(i,o,h,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,h,m,g){this.cells[m].push(g)}query(e,i,o,h,m){const g=this.min,w=this.max;if(e<=g&&i<=g&&w<=o&&w<=h&&!m)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(e,i,o,h,this._queryCell,E,{},m),E}}_queryCell(e,i,o,h,m,g,w,E){const z=this.cells[m];if(z!==null){const R=this.keys,F=this.bboxes;for(let Z=0;Z<z.length;Z++){const q=z[Z];if(w[q]===void 0){const Y=4*q;(E?E(F[Y+0],F[Y+1],F[Y+2],F[Y+3]):e<=F[Y+2]&&i<=F[Y+3]&&o>=F[Y+0]&&h>=F[Y+1])?(w[q]=!0,g.push(R[q])):w[q]=!1}}}}_forEachCell(e,i,o,h,m,g,w,E){const z=this._convertToCellCoord(e),R=this._convertToCellCoord(i),F=this._convertToCellCoord(o),Z=this._convertToCellCoord(h);for(let q=z;q<=F;q++)for(let Y=R;Y<=Z;Y++){const W=this.d*Y+q;if((!E||E(this._convertFromCellCoord(q),this._convertFromCellCoord(Y),this._convertFromCellCoord(q+1),this._convertFromCellCoord(Y+1)))&&m.call(this,e,i,o,h,W,g,w,E))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const h=new Int32Array(i+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let m=i;for(let g=0;g<e.length;g++){const w=e[g];h[3+g]=m,h.set(w,m),m+=w.length}return h[3+e.length]=m,h.set(this.keys,m),m+=this.keys.length,h[3+e.length+1]=m,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new Xl(e.buffer)}}const Xa={};function qt(n,e,i={}){if(Xa[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Xa[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}qt("Object",Object),qt("Set",Set),qt("TransferableGridIndex",Xl),qt("Color",bi),qt("Error",Error),qt("AJAXError",Ie),qt("ResolvedImage",Or),qt("StylePropertyFunction",H),qt("StyleExpression",Tc,{omit:["_evaluator"]}),qt("ZoomDependentExpression",A),qt("ZoomConstantExpression",v),qt("CompoundExpression",jr,{omit:["_evaluate"]});for(const n in $l)$l[n]._classRegistryKey||qt(`Expression_${n}`,$l[n]);function Wu(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Vh(n){return n.$name||n.constructor._classRegistryKey}function Bs(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=Vh(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Wu(n)||Lr(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function fo(n,e){if(Bs(n))return(Wu(n)||Lr(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const m=[];for(const g of n)m.push(fo(g,e));return m}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=Vh(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Xa[i])throw new Error(`${i} is not registered.`);const{klass:o}=Xa[i],h=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in n){if(!n.hasOwnProperty(m)||Xa[i].omit.indexOf(m)>=0)continue;const g=n[m];h[m]=Xa[i].shallow.indexOf(m)>=0?g:fo(g,e)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(h.$name=i),h}function fu(n){if(Bs(n))return n;if(Array.isArray(n))return n.map(fu);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=Vh(n)||"Object";if(!Xa[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Xa[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const m=n[h];o[h]=Xa[e].shallow.indexOf(h)>=0?m:fu(m)}return o}class Zh{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function qo(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Ec(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Ku(n){return/\s/u.test(String.fromCodePoint(n))}function Go(n){for(const e of n)if(Ec(e.codePointAt(0)))return!0;return!1}function qh(n){for(const e of n)if(!Dd(e.codePointAt(0)))return!1;return!0}function Qu(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const Ho=Qu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Dd(n){return!Ho.test(String.fromCodePoint(n))}function $o(n){return!(Ec(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Gh=Qu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ju(n){return Gh.test(String.fromCodePoint(n))}function Xo(n,e){return!(!e&&Ju(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function wl(n){for(const e of n)if(Ju(e.codePointAt(0)))return!0;return!1}const Ns=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Ns.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return u(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((m=>{this.loadScriptResolve=m}));e(i);const h=new Promise((m=>setTimeout((()=>m()),this.TIMEOUT)));if(yield Promise.race([o,h]),this.isParsed()){const m={pluginStatus:"loaded",pluginURL:i};return this.setState(m),m}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class _n{constructor(e,i){this.isSupportedScript=Id,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new Zh,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Zh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function Id(n){return(function(e,i){for(const o of e)if(!Xo(o.codePointAt(0),i))return!1;return!0})(n,Ns.getRTLTextPluginStatus()==="loaded")}const Tl="-transition";class Yl{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(h,m,g){if(lu(h))return new H(h,m);if(Uo(h)){const w=B(h,m,g);if(w.result==="error")throw new Error(w.value.map((E=>`${E.key}: ${E.message}`)).join(", "));return w.value}{let w=h;return m.type==="color"&&typeof h=="string"?w=bi.parse(h):m.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?m.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?m.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?w=kn.parse(h):m.type==="projectionDefinition"&&typeof h=="string"&&(w=Rn.parse(h)):w=$t.parse(h):w=Hi.parse(h):w=ii.parse(h),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>w}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class eh{constructor(e,i){this.property=e,this.value=new Yl(e,void 0,i)}transitioned(e,i){return new Mc(this.property,this.value,i,ui({},e.transition,this.transition),e.now)}untransitioned(){return new Mc(this.property,this.value,null,{},0)}}class Hh{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return tn(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new eh(this._values[e].property,this._globalState)),this._values[e].value=new Yl(this._values[e].property,i===null?void 0:tn(i),this._globalState)}getTransition(e){return tn(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new eh(this._values[e].property,this._globalState)),this._values[e].transition=tn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const h=this.getTransition(i);h!==void 0&&(e[`${i}${Tl}`]=h)}return e}transitioned(e,i){const o=new th(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(e,i._values[h]);return o}untransitioned(){const e=new th(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Mc{constructor(e,i,o,h,m){this.property=e,this.value=i,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const h=e.now||0,m=this.value.possiblyEvaluate(e,i,o),g=this.prior;if(g){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return g.possiblyEvaluate(e,i,o);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,o),m,yt(w))}}return m}}class th{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const h=new Ac(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,i,o);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ld{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return tn(this._values[e].value)}setValue(e,i){this._values[e]=new Yl(this._values[e].property,i===null?void 0:tn(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const h=new Ac(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,i,o);return h}}class ys{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,h){return this.property.evaluate(this.value,this.parameters,e,i,o,h)}}class Ac{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Xt{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const h=zn[this.specification.type];return h?h(e,i,o):e}}class ti{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,h){return new ys(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,h)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new ys(this,{kind:"constant",value:void 0},e.parameters);const h=zn[this.specification.type];if(h){const m=h(e.value.value,i.value.value,o);return new ys(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,i,o,h,m,g){return e.kind==="constant"?e.value:e.evaluate(i,o,h,m,g)}}class Fs extends ti{possiblyEvaluate(e,i,o,h){if(e.value===void 0)return new ys(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},o,h),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,w=this._calculate(g,g,g,i);return new ys(this,{kind:"constant",value:w},i)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new ys(this,{kind:"constant",value:m},i)}return new ys(this,e.expression,i)}evaluate(e,i,o,h,m,g){if(e.kind==="source"){const w=e.evaluate(i,o,h,m,g);return this._calculate(w,w,w,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,h),e.evaluate({zoom:Math.floor(i.zoom)},o,h),e.evaluate({zoom:Math.floor(i.zoom)+1},o,h),i):e.value}_calculate(e,i,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class pu{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},o,h);return this._calculate(m,m,m,i)}return this._calculate(e.expression.evaluate(new _n(Math.floor(i.zoom-1),i)),e.expression.evaluate(new _n(Math.floor(i.zoom),i)),e.expression.evaluate(new _n(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class ih{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,h){return!!e.expression.evaluate(i,null,{},o,h)}interpolate(){return!1}}class gr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const h=this.defaultPropertyValues[i]=new Yl(o,void 0,void 0),m=this.defaultTransitionablePropertyValues[i]=new eh(o,void 0);this.defaultTransitioningPropertyValues[i]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=h.possiblyEvaluate({})}}}qt("DataDrivenProperty",ti),qt("DataConstantProperty",Xt),qt("CrossFadedDataDrivenProperty",Fs),qt("CrossFadedProperty",pu),qt("ColorRampProperty",ih);class ir extends Di{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(h,m){return new du(h,m)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Zt(e.filter,o)),i.layout&&(this._unevaluatedLayout=new Ld(i.layout,o)),i.paint)){this._transitionablePaint=new Hh(i.paint,o);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ac(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=Zt(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const i of this._visibilityExpression.getGlobalStateRefs())e.add(i);if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const h of o.getGlobalStateRefs())e.add(h)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const h=this._transitionablePaint._values[o].value;for(const m of h.getGlobalStateRefs()){const g=(e=i.get(m))!==null&&e!==void 0?e:[];g.push({name:o,value:h.value}),i.set(m,g)}}return i}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,i,o={}){if(i==null||!this._validate(Rf,`layers.${this.id}.layout.${e}`,e,i,o))return e==="visibility"?(this.visibility=i,this._visibilityExpression.setValue(i),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,i)}getPaintProperty(e){return e.endsWith(Tl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Uh,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(Tl))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[e],m=h.property.specification["property-type"]==="cross-faded-data-driven",g=h.value.isDataDriven(),w=h.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,w,E)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e=this.minzoom,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),vr(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,h,m={}){return(!m||m.validate!==!1)&&ho(this,e.call(Vr,{key:i,layerType:this.type,objectKey:o,value:h,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof ys&&oa(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let cr;var nh={get paint(){return cr=cr||new gr({"raster-opacity":new Xt($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Xt($e.paint_raster["raster-saturation"]),"raster-contrast":new Xt($e.paint_raster["raster-contrast"]),"raster-resampling":new Xt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Xt($e.paint_raster["raster-fade-duration"])})}};class Sl extends ir{constructor(e,i){super(e,nh,i)}}const ki={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fn{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Yn(n,e=1){let i=0,o=0;return{members:n.map((h=>{const m=ki[h.type].BYTES_PER_ELEMENT,g=i=js(i,Math.max(e,m)),w=h.components||1;return o=Math.max(o,m),i+=m*w,{name:h.name,type:h.type,components:w,offset:g}})),size:js(i,Math.max(o,e)),alignment:e}}function js(n,e){return Math.ceil(n/e)*e}class po extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=o,e}}po.prototype.bytesPerElement=4,qt("StructArrayLayout2i4",po);class Cc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.int16[m+2]=h,e}}Cc.prototype.bytesPerElement=6,qt("StructArrayLayout3i6",Cc);class Pc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,h)}emplace(e,i,o,h,m){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=h,this.int16[g+3]=m,e}}Pc.prototype.bytesPerElement=8,qt("StructArrayLayout4i8",Pc);class El extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,m,g)}emplace(e,i,o,h,m,g,w){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=o,this.int16[E+2]=h,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=w,e}}El.prototype.bytesPerElement=12,qt("StructArrayLayout2i4i12",El);class kd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,m,g)}emplace(e,i,o,h,m,g,w){const E=4*e,z=8*e;return this.int16[E+0]=i,this.int16[E+1]=o,this.uint8[z+4]=h,this.uint8[z+5]=m,this.uint8[z+6]=g,this.uint8[z+7]=w,e}}kd.prototype.bytesPerElement=8,qt("StructArrayLayout2i4ub8",kd);class Vn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=o,e}}Vn.prototype.bytesPerElement=8,qt("StructArrayLayout2f8",Vn);class mo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g,w,E,z,R){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,o,h,m,g,w,E,z,R)}emplace(e,i,o,h,m,g,w,E,z,R,F){const Z=10*e;return this.uint16[Z+0]=i,this.uint16[Z+1]=o,this.uint16[Z+2]=h,this.uint16[Z+3]=m,this.uint16[Z+4]=g,this.uint16[Z+5]=w,this.uint16[Z+6]=E,this.uint16[Z+7]=z,this.uint16[Z+8]=R,this.uint16[Z+9]=F,e}}mo.prototype.bytesPerElement=20,qt("StructArrayLayout10ui20",mo);class mu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g,w,E){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,o,h,m,g,w,E)}emplace(e,i,o,h,m,g,w,E,z){const R=8*e;return this.uint16[R+0]=i,this.uint16[R+1]=o,this.uint16[R+2]=h,this.uint16[R+3]=m,this.uint16[R+4]=g,this.uint16[R+5]=w,this.uint16[R+6]=E,this.uint16[R+7]=z,e}}mu.prototype.bytesPerElement=16,qt("StructArrayLayout8ui16",mu);class gu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g,w,E,z,R,F,Z){const q=this.length;return this.resize(q+1),this.emplace(q,e,i,o,h,m,g,w,E,z,R,F,Z)}emplace(e,i,o,h,m,g,w,E,z,R,F,Z,q){const Y=12*e;return this.int16[Y+0]=i,this.int16[Y+1]=o,this.int16[Y+2]=h,this.int16[Y+3]=m,this.uint16[Y+4]=g,this.uint16[Y+5]=w,this.uint16[Y+6]=E,this.uint16[Y+7]=z,this.int16[Y+8]=R,this.int16[Y+9]=F,this.int16[Y+10]=Z,this.int16[Y+11]=q,e}}gu.prototype.bytesPerElement=24,qt("StructArrayLayout4i4ui4i24",gu);class rh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=o,this.float32[m+2]=h,e}}rh.prototype.bytesPerElement=12,qt("StructArrayLayout3f12",rh);class ah extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ah.prototype.bytesPerElement=4,qt("StructArrayLayout1ul4",ah);class sh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g,w,E,z){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,o,h,m,g,w,E,z)}emplace(e,i,o,h,m,g,w,E,z,R){const F=10*e,Z=5*e;return this.int16[F+0]=i,this.int16[F+1]=o,this.int16[F+2]=h,this.int16[F+3]=m,this.int16[F+4]=g,this.int16[F+5]=w,this.uint32[Z+3]=E,this.uint16[F+8]=z,this.uint16[F+9]=R,e}}sh.prototype.bytesPerElement=20,qt("StructArrayLayout6i1ul2ui20",sh);class Wl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,m,g)}emplace(e,i,o,h,m,g,w){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=o,this.int16[E+2]=h,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=w,e}}Wl.prototype.bytesPerElement=12,qt("StructArrayLayout2i2i2i12",Wl);class Ml extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,h,m)}emplace(e,i,o,h,m,g){const w=4*e,E=8*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=h,this.int16[E+6]=m,this.int16[E+7]=g,e}}Ml.prototype.bytesPerElement=16,qt("StructArrayLayout2f1f2i16",Ml);class ca extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,h,m,g)}emplace(e,i,o,h,m,g,w){const E=16*e,z=4*e,R=8*e;return this.uint8[E+0]=i,this.uint8[E+1]=o,this.float32[z+1]=h,this.float32[z+2]=m,this.int16[R+6]=g,this.int16[R+7]=w,e}}ca.prototype.bytesPerElement=16,qt("StructArrayLayout2ub2f2i16",ca);class Wn extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=o,this.uint16[m+2]=h,e}}Wn.prototype.bytesPerElement=6,qt("StructArrayLayout3ui6",Wn);class Yo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g,w,E,z,R,F,Z,q,Y,W,J,re){const xe=this.length;return this.resize(xe+1),this.emplace(xe,e,i,o,h,m,g,w,E,z,R,F,Z,q,Y,W,J,re)}emplace(e,i,o,h,m,g,w,E,z,R,F,Z,q,Y,W,J,re,xe){const oe=24*e,ce=12*e,Se=48*e;return this.int16[oe+0]=i,this.int16[oe+1]=o,this.uint16[oe+2]=h,this.uint16[oe+3]=m,this.uint32[ce+2]=g,this.uint32[ce+3]=w,this.uint32[ce+4]=E,this.uint16[oe+10]=z,this.uint16[oe+11]=R,this.uint16[oe+12]=F,this.float32[ce+7]=Z,this.float32[ce+8]=q,this.uint8[Se+36]=Y,this.uint8[Se+37]=W,this.uint8[Se+38]=J,this.uint32[ce+10]=re,this.int16[oe+22]=xe,e}}Yo.prototype.bytesPerElement=48,qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Yo);class zc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h,m,g,w,E,z,R,F,Z,q,Y,W,J,re,xe,oe,ce,Se,Ce,Ye,_t,ct,bt,Nt,St){const mt=this.length;return this.resize(mt+1),this.emplace(mt,e,i,o,h,m,g,w,E,z,R,F,Z,q,Y,W,J,re,xe,oe,ce,Se,Ce,Ye,_t,ct,bt,Nt,St)}emplace(e,i,o,h,m,g,w,E,z,R,F,Z,q,Y,W,J,re,xe,oe,ce,Se,Ce,Ye,_t,ct,bt,Nt,St,mt){const it=32*e,Wt=16*e;return this.int16[it+0]=i,this.int16[it+1]=o,this.int16[it+2]=h,this.int16[it+3]=m,this.int16[it+4]=g,this.int16[it+5]=w,this.int16[it+6]=E,this.int16[it+7]=z,this.uint16[it+8]=R,this.uint16[it+9]=F,this.uint16[it+10]=Z,this.uint16[it+11]=q,this.uint16[it+12]=Y,this.uint16[it+13]=W,this.uint16[it+14]=J,this.uint16[it+15]=re,this.uint16[it+16]=xe,this.uint16[it+17]=oe,this.uint16[it+18]=ce,this.uint16[it+19]=Se,this.uint16[it+20]=Ce,this.uint16[it+21]=Ye,this.uint16[it+22]=_t,this.uint32[Wt+12]=ct,this.float32[Wt+13]=bt,this.float32[Wt+14]=Nt,this.uint16[it+30]=St,this.uint16[it+31]=mt,e}}zc.prototype.bytesPerElement=64,qt("StructArrayLayout8i15ui1ul2f2ui64",zc);class Dc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Dc.prototype.bytesPerElement=4,qt("StructArrayLayout1f4",Dc);class _u extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const m=3*e;return this.uint16[6*e+0]=i,this.float32[m+1]=o,this.float32[m+2]=h,e}}_u.prototype.bytesPerElement=12,qt("StructArrayLayout1ui2f12",_u);class go extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o)}emplace(e,i,o,h){const m=4*e;return this.uint32[2*e+0]=i,this.uint16[m+2]=o,this.uint16[m+3]=h,e}}go.prototype.bytesPerElement=8,qt("StructArrayLayout1ul2ui8",go);class y extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,e}}y.prototype.bytesPerElement=4,qt("StructArrayLayout2ui4",y);class t extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}t.prototype.bytesPerElement=2,qt("StructArrayLayout1ui2",t);class a extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,h)}emplace(e,i,o,h,m){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=h,this.float32[g+3]=m,e}}a.prototype.bytesPerElement=16,qt("StructArrayLayout4f16",a);class c extends fn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new V(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class p extends sh{get(e){return new c(this,e)}}qt("CollisionBoxArray",p);class b extends fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}b.prototype.size=48;class S extends Yo{get(e){return new b(this,e)}}qt("PlacedSymbolArray",S);class C extends fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}C.prototype.size=64;class I extends zc{get(e){return new C(this,e)}}qt("SymbolInstanceArray",I);class N extends Dc{getoffsetX(e){return this.float32[1*e+0]}}qt("GlyphOffsetArray",N);class U extends Cc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}qt("SymbolLineVertexArray",U);class $ extends fn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}$.prototype.size=12;class G extends _u{get(e){return new $(this,e)}}qt("TextAnchorOffsetArray",G);class K extends fn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}K.prototype.size=8;class ie extends go{get(e){return new K(this,e)}}qt("FeatureIndexArray",ie);class he extends po{}class me extends po{}class pe extends po{}class ve extends El{}class Me extends kd{}class ye extends Vn{}class Ee extends mo{}class Le extends mu{}class Te extends gu{}class Oe extends rh{}class et extends ah{}class Xe extends Wl{}class We extends ca{}class Ke extends Wn{}class zt extends y{}const kt=Yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:xt}=kt;class Bt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,h){const m=this.segments[this.segments.length-1];return e>Bt.MAX_VERTEX_ARRAY_LENGTH&&Gi(`Max vertices per segment is ${Bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Bt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!m||m.vertexLength+e>Bt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h?this.createNewSegment(i,o,h):m}createNewSegment(e,i,o){const h={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(h.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,h){return new Bt([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function Ti(n,e){return 256*(n=Lt(Math.floor(n),0,255))+Lt(Math.floor(e),0,255)}Bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt("SegmentVector",Bt);const pn=Yn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Dn=Yn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var En,Zn,xn,nr={exports:{}},qn={exports:{}},Hr={exports:{}},ur=(function(){if(xn)return nr.exports;xn=1;var n=(En||(En=1,qn.exports=function(i,o){var h,m,g,w,E,z,R,F;for(m=i.length-(h=3&i.length),g=o,E=3432918353,z=461845907,F=0;F<m;)R=255&i.charCodeAt(F)|(255&i.charCodeAt(++F))<<8|(255&i.charCodeAt(++F))<<16|(255&i.charCodeAt(++F))<<24,++F,g=27492+(65535&(w=5*(65535&(g=(g^=R=(65535&(R=(R=(65535&R)*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*z+(((R>>>16)*z&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(R=0,h){case 3:R^=(255&i.charCodeAt(F+2))<<16;case 2:R^=(255&i.charCodeAt(F+1))<<8;case 1:g^=R=(65535&(R=(R=(65535&(R^=255&i.charCodeAt(F)))*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*z+(((R>>>16)*z&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),qn.exports),e=(Zn||(Zn=1,Hr.exports=function(i,o){for(var h,m=i.length,g=o^m,w=0;m>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++w;switch(m){case 3:g^=(255&i.charCodeAt(w+2))<<16;case 2:g^=(255&i.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Hr.exports);return nr.exports=n,nr.exports.murmur3=n,nr.exports.murmur2=e,nr.exports})(),hr=te(ur);class $r{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,h){this.ids.push(Wo(e)),this.positions.push(i,o,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Wo(e);let o=0,h=this.ids.length-1;for(;o<h;){const g=o+h>>1;this.ids[g]>=i?h=g:o=g+1}const m=[];for(;this.ids[o]===i;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(e,i){const o=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Ko(o,h,0,o.length-1),i&&i.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(e){const i=new $r;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Wo(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:hr(String(n))}function Ko(n,e,i,o){for(;i<o;){const h=n[i+o>>1];let m=i-1,g=o+1;for(;;){do m++;while(n[m]<h);do g--;while(n[g]>h);if(m>=g)break;_o(n,m,g),_o(e,3*m,3*g),_o(e,3*m+1,3*g+1),_o(e,3*m+2,3*g+2)}g-i<o-g?(Ko(n,e,i,g),i=g+1):(Ko(n,e,g+1,o),o=g)}}function _o(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}qt("FeaturePositionMap",$r);class Ya{constructor(e,i){this.gl=e.gl,this.location=i}}class Ic extends Ya{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class yu extends Ya{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class yo extends Ya{constructor(e,i){super(e,i),this.current=bi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Wa=new Float32Array(16);function vs(n){return[Ti(255*n.r,255*n.g),Ti(255*n.b,255*n.a)]}class Us{constructor(e,i,o){this.value=e,this.uniformNames=i.map((h=>`u_${h}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new yo(e,i):new Ic(e,i)}}class Vs{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,h){let m=null;h==="u_pattern_to"?m=this.patternTo:h==="u_pattern_from"?m=this.patternFrom:h==="u_dasharray_to"?m=this.dashTo:h==="u_dasharray_from"?m=this.dashFrom:h==="u_pixel_ratio_to"?m=this.pixelRatioTo:h==="u_pixel_ratio_from"&&(m=this.pixelRatioFrom),m!==null&&e.set(m)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new yu(e,i):new Ic(e,i)}}class yn{constructor(e,i,o,h){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,i,o){const h=this.paintVertexArray.length,m=this.expression.evaluate(new _n(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(h,e,m)}updatePaintArray(e,i,o,h,m){const g=this.expression.evaluate(new _n(0,m),o,h);this._setPaintValue(e,i,g)}_setPaintValue(e,i,o){if(this.type==="color"){const h=vs(o);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mn{constructor(e,i,o,h,m,g){this.expression=e,this.uniformNames=i.map((w=>`u_${w}_t`)),this.type=o,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=i.map((w=>({name:`a_${w}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,i,o){const h=this.expression.evaluate(new _n(this.zoom,o),i,{},o.canonical,[],o.formattedSection),m=this.expression.evaluate(new _n(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,h,m)}updatePaintArray(e,i,o,h,m){const g=this.expression.evaluate(new _n(this.zoom,m),o,h),w=this.expression.evaluate(new _n(this.zoom+1,m),o,h);this._setPaintValue(e,i,g,w)}_setPaintValue(e,i,o,h){if(this.type==="color"){const m=vs(o),g=vs(h);for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,m[0],m[1],g[0],g[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,h=Lt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,i,o){return new Ic(e,i)}}class Tr{constructor(e,i,o,h,m,g){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=h,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,i,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,h,m){this._setPaintValues(e,i,this.getPositionIds(o),m)}_setPaintValues(e,i,o,h){const m=this.getPositions(h);if(!m||!o)return;const g=m[o.min],w=m[o.mid],E=m[o.max];if(g&&w&&E)for(let z=e;z<i;z++)this.emplace(this.zoomInPaintVertexArray,z,w,g),this.emplace(this.zoomOutPaintVertexArray,z,w,E)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zr extends Tr{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return pn.members}emplace(e,i,o,h){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],o.pixelRatio,h.pixelRatio)}}class $h extends Tr{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Dn.members}emplace(e,i,o,h){e.emplace(i,0,o.y,o.height,o.width,0,h.y,h.height,h.width)}}class Xh{constructor(e,i,o){this.binders={},this._buffers=[];const h=[];for(const m in e.paint._values){if(!o(m))continue;const g=e.paint.get(m);if(!(g instanceof ys&&oa(g.property.specification)))continue;const w=Of(m,e.type),E=g.value,z=g.property.specification.type,R=g.property.useIntegerZoom,F=g.property.specification["property-type"],Z=F==="cross-faded"||F==="cross-faded-data-driven";if(E.kind==="constant")this.binders[m]=Z?new Vs(E.value,w):new Us(E.value,w,z),h.push(`/u_${m}`);else if(E.kind==="source"||Z){const q=Ql(m,z,"source");this.binders[m]=Z?m==="line-dasharray"?new $h(E,z,R,i,q,e.id):new zr(E,z,R,i,q,e.id):new yn(E,w,z,q),h.push(`/a_${m}`)}else{const q=Ql(m,z,"composite");this.binders[m]=new Mn(E,w,z,R,i,q),h.push(`/z_${m}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof yn||i instanceof Mn?i.maxValue:0}populatePaintArrays(e,i,o){for(const h in this.binders){const m=this.binders[h];(m instanceof yn||m instanceof Mn||m instanceof Tr)&&m.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const h=this.binders[o];h instanceof Vs&&h.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const h=this.binders[o];h instanceof Vs&&h.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,h,m){let g=!1;for(const w in e){const E=i.getPositions(w);for(const z of E){const R=o.feature(z.index);for(const F in this.binders){const Z=this.binders[F];if((Z instanceof yn||Z instanceof Mn||Z instanceof Tr)&&Z.expression.isStateDependent===!0){const q=h.paint.get(F);Z.expression=q.value,Z.updatePaintArray(z.start,z.end,R,e[w],m),g=!0}}}}return g}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Us||o instanceof Vs)&&e.push(...o.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof yn||o instanceof Mn)for(let h=0;h<o.paintVertexAttributes.length;h++)e.push(o.paintVertexAttributes[h].name);else if(o instanceof Tr){const h=o.getVertexAttributes();for(const m of h)e.push(m.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Us||o instanceof Vs||o instanceof Mn)for(const h of o.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Us||m instanceof Vs||m instanceof Mn){for(const g of m.uniformNames)if(i[g]){const w=m.getBinding(e,i[g],g);o.push({name:g,property:h,binding:w})}}}return o}setUniforms(e,i,o,h){for(const{name:m,property:g,binding:w}of i)this.binders[g].setUniform(w,h,o.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof Tr){const h=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof yn||o instanceof Mn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof yn||o instanceof Mn||o instanceof Tr)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof yn||i instanceof Mn||i instanceof Tr)&&i.destroy()}}}class Kl{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Xh(h,i,o);this.needsUpload=!1,this._featureMap=new $r,this._bufferOffset=0}populatePaintArrays(e,i,o,h){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,i,h);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,h){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,i,m,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Of(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Ql(n,e,i){const o={color:{source:Vn,composite:a},number:{source:Dc,composite:Vn}},h=(function(m){return{"line-pattern":{source:Ee,composite:Ee},"fill-pattern":{source:Ee,composite:Ee},"fill-extrusion-pattern":{source:Ee,composite:Ee},"line-dasharray":{source:Le,composite:Le}}[m]})(n);return h&&h[i]||o[e][i]}qt("ConstantBinder",Us),qt("CrossFadedConstantBinder",Vs),qt("SourceExpressionBinder",yn),qt("CrossFadedPatternBinder",zr),qt("CrossFadedDasharrayBinder",$h),qt("CompositeExpressionBinder",Mn),qt("ProgramConfiguration",Xh,{omit:["_buffers"]}),qt("ProgramConfigurationSet",Kl);const Yh=Math.pow(2,14)-1,Al=-Yh-1;function Cl(n){const e=Et/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const h=i[o];for(let m=0;m<h.length;m++){const g=h[m],w=Math.round(g.x*e),E=Math.round(g.y*e);g.x=Lt(w,Al,Yh),g.y=Lt(E,Al,Yh),(w<g.x||w>g.x+1||E<g.y||E>g.y+1)&&Gi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function vo(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Cl(n):[]}}const Wh=-32768;function oh(n,e,i,o,h){n.emplaceBack(Wh+8*e+o,Wh+8*i+h)}class lh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new me,this.indexArray=new Ke,this.segments=new Bt,this.programConfigurations=new Kl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const h=this.layers[0],m=[];let g=null,w=!1,E=h.type==="heatmap";if(h.type==="circle"){const R=h;g=R.layout.get("circle-sort-key"),w=!g.isConstant(),E=E||R.paint.get("circle-pitch-alignment")==="map"}const z=E?i.subdivisionGranularity.circle:1;for(const{feature:R,id:F,index:Z,sourceLayerIndex:q}of e){const Y=this.layers[0]._featureFilter.needGeometry,W=vo(R,Y);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),W,o))continue;const J=w?g.evaluate(W,{},o):void 0,re={id:F,properties:R.properties,type:R.type,sourceLayerIndex:q,index:Z,geometry:Y?W.geometry:Cl(R),patterns:{},sortKey:J};m.push(re)}w&&m.sort(((R,F)=>R.sortKey-F.sortKey));for(const R of m){const{geometry:F,index:Z,sourceLayerIndex:q}=R,Y=e[Z].feature;this.addFeature(R,F,Z,o,z),i.featureIndex.insert(Y,F,Z,q,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,h,m=1){let g;switch(m){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${m}; valid values are 1, 3, 5, 7.`)}const w=g.length;for(const E of i)for(const z of E){const R=z.x,F=z.y;if(R<0||R>=Et||F<0||F>=Et)continue;const Z=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,e.sortKey),q=Z.vertexLength;for(let Y=0;Y<w;Y++)for(let W=0;W<w;W++)oh(this.layoutVertexArray,R,F,g[W],g[Y]);for(let Y=0;Y<w-1;Y++)for(let W=0;W<w-1;W++){const J=q+Y*w+W,re=q+(Y+1)*w+W;this.indexArray.emplaceBack(J,re+1,J+1),this.indexArray.emplaceBack(J,re,re+1)}Z.vertexLength+=w*w,Z.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:h})}}function ch(n,e){for(let i=0;i<n.length;i++)if(Jl(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Jl(n,e[i]))return!0;return!!ua(n,e)}function Bf(n,e,i){return!!Jl(n,e)||!!Ff(e,n,i)}function Nf(n,e){if(n.length===1)return Qp(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let h=0;h<o.length;h++)if(Jl(n,o[h]))return!0}for(let i=0;i<n.length;i++)if(Qp(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ua(n,e[i]))return!0;return!1}function Xr(n,e,i){if(n.length>1){if(ua(n,e))return!0;for(let o=0;o<e.length;o++)if(Ff(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(Ff(n[o],e,i))return!0;return!1}function ua(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],h=n[i+1];for(let m=0;m<e.length-1;m++)if(dg(o,h,e[m],e[m+1]))return!0}return!1}function dg(n,e,i,o){return Fn(n,i,o)!==Fn(e,i,o)&&Fn(n,e,i)!==Fn(n,e,o)}function Ff(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let h=1;h<e.length;h++)if(Kp(n,e[h-1],e[h])<o)return!0;return!1}function Kp(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const h=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Qp(n,e){let i,o,h,m=!1;for(let g=0;g<n.length;g++){i=n[g];for(let w=0,E=i.length-1;w<i.length;E=w++)o=i[w],h=i[E],o.y>e.y!=h.y>e.y&&e.x<(h.x-o.x)*(e.y-o.y)/(h.y-o.y)+o.x&&(m=!m)}return m}function Jl(n,e){let i=!1;for(let o=0,h=n.length-1;o<n.length;h=o++){const m=n[o],g=n[h];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(i=!i)}return i}function fg(n,e,i){const o=i[0],h=i[2];if(n.x<o.x&&e.x<o.x||n.x>h.x&&e.x>h.x||n.y<o.y&&e.y<o.y||n.y>h.y&&e.y>h.y)return!1;const m=Fn(n,e,i[0]);return m!==Fn(n,e,i[1])||m!==Fn(n,e,i[2])||m!==Fn(n,e,i[3])}function Lc(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Rd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function jf(n,e,i,o,h){if(!e[0]&&!e[1])return n;const m=V.convert(e)._mult(h);i==="viewport"&&m._rotate(-o);const g=[];for(let w=0;w<n.length;w++)g.push(n[w].sub(m));return g}function Uf(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],h=e.at(-1);(i===0||h&&!o.equals(h))&&e.push(o)}return e}function Jp({queryGeometry:n,size:e},i){return Bf(n,i,e)}function pg({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:h},m){return Bf(n,m,e*(i.projectTileCoordinates(m.x,m.y,o,h).signedDistanceFromCamera/i.cameraToCenterDistance))}function mg({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:h},m){const g=i.projectTileCoordinates(m.x,m.y,o,h).signedDistanceFromCamera,w=e*(i.cameraToCenterDistance/g);return Bf(n,Od(m,i,o,h),w)}function gg({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:h},m){return Bf(n,Od(m,i,o,h),e)}function Vf({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:h,pitchAlignment:m="map",pitchScale:g="map"},w){const E=m==="map"?g==="map"?Jp:pg:g==="map"?mg:gg,z={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:h};for(const R of w)for(const F of R)if(E(z,F))return!0;return!1}function Od(n,e,i,o){const h=e.projectTileCoordinates(n.x,n.y,i,o).point;return new V((.5*h.x+.5)*e.width,(.5*-h.y+.5)*e.height)}let Zf,em;qt("CircleBucket",lh,{omit:["layers"]});var tm={get paint(){return em=em||new gr({"circle-radius":new ti($e.paint_circle["circle-radius"]),"circle-color":new ti($e.paint_circle["circle-color"]),"circle-blur":new ti($e.paint_circle["circle-blur"]),"circle-opacity":new ti($e.paint_circle["circle-opacity"]),"circle-translate":new Xt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Xt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ti($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ti($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ti($e.paint_circle["circle-stroke-opacity"])})},get layout(){return Zf=Zf||new gr({"circle-sort-key":new ti($e.layout_circle["circle-sort-key"])})}};class qf extends ir{constructor(e,i){super(e,tm,i)}createBucket(e){return new lh(e)}queryRadius(e){const i=e;return Lc("circle-radius",this,i)+Lc("circle-stroke-width",this,i)+Rd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:h,transform:m,pixelsToTileUnits:g,unwrappedTileID:w,getElevation:E}){const z=jf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-m.bearingInRadians,g),R=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),F=this.paint.get("circle-pitch-scale"),Z=this.paint.get("circle-pitch-alignment");let q,Y;return Z==="map"?(q=z,Y=R*g):(q=(function(W,J,re,xe){return W.map((oe=>Od(oe,J,re,xe)))})(z,m,w,E),Y=R),Vf({queryGeometry:q,size:Y,transform:m,unwrappedTileID:w,getElevation:E,pitchAlignment:Z,pitchScale:F},h)}}class Gf extends lh{}let im;qt("HeatmapBucket",Gf,{omit:["layers"]});var nm={get paint(){return im=im||new gr({"heatmap-radius":new ti($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ti($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ih($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xt($e.paint_heatmap["heatmap-opacity"])})}};function Hf(n,{width:e,height:i},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*i*o}`)}else h=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=h,n}function ec(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const h=Hf({},{width:e,height:i},o);Bd(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=h.data}function Bd(n,e,i,o,h,m){if(h.width===0||h.height===0)return e;if(h.width>n.width||h.height>n.height||i.x>n.width-h.width||i.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||o.x>e.width-h.width||o.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,w=e.data;if(g===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<h.height;E++){const z=((i.y+E)*n.width+i.x)*m,R=((o.y+E)*e.width+o.x)*m;for(let F=0;F<h.width*m;F++)w[R+F]=g[z+F]}return e}class Nd{constructor(e,i){Hf(this,e,1,i)}resize(e){ec(this,e,1)}clone(){return new Nd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,m){Bd(e,i,o,h,m,1)}}class Ka{constructor(e,i){Hf(this,e,4,i)}resize(e){ec(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ka({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,h,m){Bd(e,i,o,h,m,4)}setPixel(e,i,o){const h=4*(e*this.width+i);this.data[h+0]=Math.round(255*o.r/o.a),this.data[h+1]=Math.round(255*o.g/o.a),this.data[h+2]=Math.round(255*o.b/o.a),this.data[h+3]=Math.round(255*o.a)}}function tc(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,h=n.image||new Ka({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const m=(g,w,E)=>{e[n.evaluationKey]=E;const z=n.expression.evaluate(e);h.setPixel(g/4/i,w/4,z)};if(n.clips)for(let g=0,w=0;g<o;++g,w+=4*i)for(let E=0,z=0;E<i;E++,z+=4){const R=E/(i-1),{start:F,end:Z}=n.clips[g];m(w,z,F*(1-R)+Z*R)}else for(let g=0,w=0;g<i;g++,w+=4)m(0,w,g/(i-1));return h}qt("AlphaImage",Nd),qt("RGBAImage",Ka);const Fd="big-fb";class _g extends ir{createBucket(e){return new Gf(e)}constructor(e,i){super(e,nm,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Fd)&&this.heatmapFbos.delete(Fd)}queryRadius(e){return Lc("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:h,transform:m,pixelsToTileUnits:g,unwrappedTileID:w,getElevation:E}){return Vf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*g,transform:m,unwrappedTileID:w,getElevation:E},h)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let jd;var Ud={get paint(){return jd=jd||new gr({"hillshade-illumination-direction":new Xt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Xt($e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Xt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xt($e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Xt($e.paint_hillshade["hillshade-method"])})}};class dr extends ir{constructor(e,i){super(e,Ud,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const m=Math.max(e.length,i.length,o.length,h.length);e=e.concat(Array(m-e.length).fill(e.at(-1))),i=i.concat(Array(m-i.length).fill(i.at(-1))),o=o.concat(Array(m-o.length).fill(o.at(-1))),h=h.concat(Array(m-h.length).fill(h.at(-1)));const g=i.map(Ei);return{directionRadians:e.map(Ei),altitudeRadians:g,shadowColor:h,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let yg;var X_={get paint(){return yg=yg||new gr({"color-relief-opacity":new Xt($e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ih($e["paint_color-relief"]["color-relief-color"])})}};class $f{constructor(e,i,o,h){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,h)}update(e,i,o){const{width:h,height:m}=e,g=!(this.size&&this.size[0]===h&&this.size[1]===m||o),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(i&&i.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!i||i.premultiply!==!1)),g)this.size=[h,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Lr(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,h,m,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:z,y:R}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Lr(e)?E.texSubImage2D(E.TEXTURE_2D,0,z,R,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,z,R,h,m,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),o!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Kh{constructor(e,i,o,h=1,m=1,g=1,w=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Gi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const E=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=m,this.blueFactor=g,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<E;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(E,z)]=this.data[this._idx(E-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,E)]=this.data[this._idx(z,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<E;z++)for(let R=0;R<E;R++){const F=this.get(z,R);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(e,i){const o=new Uint8Array(this.data.buffer),h=4*this._idx(e,i);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${i}, dim: ${this.dim}`);return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return kc(e,this.getUnpackVector())}getPixels(){return new Ka({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,m=i*this.dim+this.dim,g=o*this.dim,w=o*this.dim+this.dim;switch(i){case-1:h=m-1;break;case 1:m=h+1}switch(o){case-1:g=w-1;break;case 1:w=g+1}const E=-i*this.dim,z=-o*this.dim;for(let R=g;R<w;R++)for(let F=h;F<m;F++)this.data[this._idx(F,R)]=e.data[this._idx(F+E,R+z)]}}function kc(n,e){const i=e[0],o=e[1],h=e[2],m=e[3],g=Math.min(i,o,h),w=Math.round((n+m)/g);return{r:Math.floor(w*g/i)%256,g:Math.floor(w*g/o)%256,b:Math.floor(w*g/h)%256}}qt("DEMData",Kh);class vg extends ir{constructor(e,i){super(e,X_,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof v&&o._styleExpression.expression instanceof tr){this.colorRampExpression=o;const g=o._styleExpression.expression;i.elevationStops=g.labels,i.colorStops=[];for(const w of i.elevationStops)i.colorStops.push(g.evaluate({globals:{elevation:w}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[bi.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const h={elevationStops:[],colorStops:[]},m=(i.elevationStops.length-1)/(e-1);for(let g=0;g<i.elevationStops.length-.5;g+=m)h.elevationStops.push(i.elevationStops[Math.round(g)]),h.colorStops.push(i.colorStops[Math.round(g)]);return Gi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(i),m=new Ka({width:h.colorStops.length,height:1}),g=new Ka({width:h.colorStops.length,height:1});for(let w=0;w<h.elevationStops.length;w++){const E=kc(h.elevationStops[w],o);g.setPixel(0,w,new bi(E.r/255,E.g/255,E.b/255,1)),m.setPixel(0,w,h.colorStops[w])}return this.colorRampTextures={elevationTexture:new $f(e,g,e.gl.RGBA),colorTexture:new $f(e,m,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const xg=Yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vd}=xg;function xo(n,e,i){const o=i.patternDependencies;let h=!1;for(const m of e){const g=m.paint.get(`${n}-pattern`);g.isConstant()||(h=!0);const w=g.constantOr(null);w&&(h=!0,o[w.to]=!0,o[w.from]=!0)}return h}function Xf(n,e,i,o,h){const{zoom:m}=o,g=h.patternDependencies;for(const w of e){const E=w.paint.get(`${n}-pattern`).value;if(E.kind!=="constant"){let z=E.evaluate({zoom:m-1},i,{},h.availableImages),R=E.evaluate({zoom:m},i,{},h.availableImages),F=E.evaluate({zoom:m+1},i,{},h.availableImages);z=z&&z.name?z.name:z,R=R&&R.name?R.name:R,F=F&&F.name?F.name:F,g[z]=!0,g[R]=!0,g[F]=!0,i.patterns[w.id]={min:z,mid:R,max:F}}}return i}function Yf(n,e,i,o,h){let m;if(h===(function(g,w,E,z){let R=0;for(let F=w,Z=E-z;F<E;F+=z)R+=(g[Z]-g[F])*(g[F+1]+g[Z+1]),Z=F;return R})(n,e,i,o)>0)for(let g=e;g<i;g+=o)m=xs(g/o|0,n[g],n[g+1],m);else for(let g=i-o;g>=e;g-=o)m=xs(g/o|0,n[g],n[g+1],m);return m&&Zs(m,m.next)&&(bs(m),m=m.next),m}function vu(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Zs(o,o.next)&&rn(o.prev,o,o.next)!==0)o=o.next;else{if(bs(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function uh(n,e,i,o,h,m,g){if(!n)return;!g&&m&&(function(E,z,R,F){let Z=E;do Z.z===0&&(Z.z=Wr(Z.x,Z.y,z,R,F)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==E);Z.prevZ.nextZ=null,Z.prevZ=null,(function(q){let Y,W=1;do{let J,re=q;q=null;let xe=null;for(Y=0;re;){Y++;let oe=re,ce=0;for(let Ce=0;Ce<W&&(ce++,oe=oe.nextZ,oe);Ce++);let Se=W;for(;ce>0||Se>0&&oe;)ce!==0&&(Se===0||!oe||re.z<=oe.z)?(J=re,re=re.nextZ,ce--):(J=oe,oe=oe.nextZ,Se--),xe?xe.nextZ=J:q=J,J.prevZ=xe,xe=J;re=oe}xe.nextZ=null,W*=2}while(Y>1)})(Z)})(n,o,h,m);let w=n;for(;n.prev!==n.next;){const E=n.prev,z=n.next;if(m?Wf(n,o,h,m):rm(n))e.push(E.i,n.i,z.i),bs(n),n=z.next,w=z.next;else if((n=z)===w){g?g===1?uh(n=bg(vu(n),e),e,i,o,h,m,2):g===2&&Rc(n,e,i,o,h,m):uh(vu(n),e,i,o,h,m,1);break}}}function rm(n){const e=n.prev,i=n,o=n.next;if(rn(e,i,o)>=0)return!1;const h=e.x,m=i.x,g=o.x,w=e.y,E=i.y,z=o.y,R=Math.min(h,m,g),F=Math.min(w,E,z),Z=Math.max(h,m,g),q=Math.max(w,E,z);let Y=o.next;for(;Y!==e;){if(Y.x>=R&&Y.x<=Z&&Y.y>=F&&Y.y<=q&&Qh(h,w,m,E,g,z,Y.x,Y.y)&&rn(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function Wf(n,e,i,o){const h=n.prev,m=n,g=n.next;if(rn(h,m,g)>=0)return!1;const w=h.x,E=m.x,z=g.x,R=h.y,F=m.y,Z=g.y,q=Math.min(w,E,z),Y=Math.min(R,F,Z),W=Math.max(w,E,z),J=Math.max(R,F,Z),re=Wr(q,Y,e,i,o),xe=Wr(W,J,e,i,o);let oe=n.prevZ,ce=n.nextZ;for(;oe&&oe.z>=re&&ce&&ce.z<=xe;){if(oe.x>=q&&oe.x<=W&&oe.y>=Y&&oe.y<=J&&oe!==h&&oe!==g&&Qh(w,R,E,F,z,Z,oe.x,oe.y)&&rn(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ce.x>=q&&ce.x<=W&&ce.y>=Y&&ce.y<=J&&ce!==h&&ce!==g&&Qh(w,R,E,F,z,Z,ce.x,ce.y)&&rn(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;oe&&oe.z>=re;){if(oe.x>=q&&oe.x<=W&&oe.y>=Y&&oe.y<=J&&oe!==h&&oe!==g&&Qh(w,R,E,F,z,Z,oe.x,oe.y)&&rn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ce&&ce.z<=xe;){if(ce.x>=q&&ce.x<=W&&ce.y>=Y&&ce.y<=J&&ce!==h&&ce!==g&&Qh(w,R,E,F,z,Z,ce.x,ce.y)&&rn(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function bg(n,e){let i=n;do{const o=i.prev,h=i.next.next;!Zs(o,h)&&om(o,i,i.next,h)&&Gd(o,h)&&Gd(h,o)&&(e.push(o.i,i.i,h.i),bs(i),bs(i.next),i=n=h),i=i.next}while(i!==n);return vu(i)}function Rc(n,e,i,o,h,m){let g=n;do{let w=g.next.next;for(;w!==g.prev;){if(g.i!==w.i&&_r(g,w)){let E=Hd(g,w);return g=vu(g,g.next),E=vu(E,E.next),uh(g,e,i,o,h,m,0),void uh(E,e,i,o,h,m,0)}w=w.next}g=g.next}while(g!==n)}function Yr(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function am(n,e){const i=(function(h,m){let g=m;const w=h.x,E=h.y;let z,R=-1/0;if(Zs(h,g))return g;do{if(Zs(h,g.next))return g.next;if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const W=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(W<=w&&W>R&&(R=W,z=g.x<g.next.x?g:g.next,W===w))return z}g=g.next}while(g!==m);if(!z)return null;const F=z,Z=z.x,q=z.y;let Y=1/0;g=z;do{if(w>=g.x&&g.x>=Z&&w!==g.x&&sm(E<q?w:R,E,Z,q,E<q?R:w,E,g.x,g.y)){const W=Math.abs(E-g.y)/(w-g.x);Gd(g,h)&&(W<Y||W===Y&&(g.x>z.x||g.x===z.x&&wg(z,g)))&&(z=g,Y=W)}g=g.next}while(g!==F);return z})(n,e);if(!i)return e;const o=Hd(i,n);return vu(o,o.next),vu(i,i.next)}function wg(n,e){return rn(n.prev,n,e.prev)<0&&rn(e.next,n,n.next)<0}function Wr(n,e,i,o,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Y_(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function sm(n,e,i,o,h,m,g,w){return(h-g)*(e-w)>=(n-g)*(m-w)&&(n-g)*(o-w)>=(i-g)*(e-w)&&(i-g)*(m-w)>=(h-g)*(o-w)}function Qh(n,e,i,o,h,m,g,w){return!(n===g&&e===w)&&sm(n,e,i,o,h,m,g,w)}function _r(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==o.i&&h.next.i!==o.i&&om(h,h.next,i,o))return!0;h=h.next}while(h!==i);return!1})(n,e)&&(Gd(n,e)&&Gd(e,n)&&(function(i,o){let h=i,m=!1;const g=(i.x+o.x)/2,w=(i.y+o.y)/2;do h.y>w!=h.next.y>w&&h.next.y!==h.y&&g<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==i);return m})(n,e)&&(rn(n.prev,n,e.prev)||rn(n,e.prev,e))||Zs(n,e)&&rn(n.prev,n,n.next)>0&&rn(e.prev,e,e.next)>0)}function rn(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Zs(n,e){return n.x===e.x&&n.y===e.y}function om(n,e,i,o){const h=qd(rn(n,e,i)),m=qd(rn(n,e,o)),g=qd(rn(i,o,n)),w=qd(rn(i,o,e));return h!==m&&g!==w||!(h!==0||!Zd(n,i,e))||!(m!==0||!Zd(n,o,e))||!(g!==0||!Zd(i,n,o))||!(w!==0||!Zd(i,e,o))}function Zd(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function qd(n){return n>0?1:n<0?-1:0}function Gd(n,e){return rn(n.prev,n,n.next)<0?rn(n,e,n.next)>=0&&rn(n,n.prev,e)>=0:rn(n,e,n.prev)<0||rn(n,n.next,e)<0}function Hd(n,e){const i=Kf(n.i,n.x,n.y),o=Kf(e.i,e.x,e.y),h=n.next,m=e.prev;return n.next=e,e.prev=n,i.next=h,h.prev=i,o.next=i,i.prev=o,m.next=o,o.prev=m,o}function xs(n,e,i,o){const h=Kf(n,e,i);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function bs(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Kf(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ha{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class $d{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}$d.noSubdivision=new $d({fill:new ha(0,0),line:new ha(0,0),tile:new ha(0,0),stencil:new ha(0,0),circle:1}),qt("SubdivisionGranularityExpression",ha),qt("SubdivisionGranularitySetting",$d);const qs=-32768,Pl=32767;class Oc{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Et/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),h=0|Math.round(i),m=this._getKey(o,h);if(this._vertexDictionary.has(m))return this._vertexDictionary.get(m);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(m,g),this._vertexBuffer.push(o,h),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(h,m){const g=[];for(let w=0;w<m.length;w+=3){const E=m[w],z=m[w+1],R=m[w+2],F=h[2*E],Z=h[2*E+1];(h[2*z]-F)*(h[2*R+1]-Z)-(h[2*z+1]-Z)*(h[2*R]-F)>0?(g.push(E),g.push(R),g.push(z)):(g.push(E),g.push(z),g.push(R))}return g})(this._vertexBuffer,e);const i=[],o=e.length;for(let h=0;h<o;h+=3){const m=[e[h+0],e[h+1],e[h+2]],g=[this._vertexBuffer[2*e[h+0]+0],this._vertexBuffer[2*e[h+0]+1],this._vertexBuffer[2*e[h+1]+0],this._vertexBuffer[2*e[h+1]+1],this._vertexBuffer[2*e[h+2]+0],this._vertexBuffer[2*e[h+2]+1]];let w=1/0,E=1/0,z=-1/0,R=-1/0;for(let W=0;W<3;W++){const J=g[2*W],re=g[2*W+1];w=Math.min(w,J),z=Math.max(z,J),E=Math.min(E,re),R=Math.max(R,re)}if(w===z||E===R)continue;const F=Math.floor(w/this._granularityCellSize),Z=Math.ceil(z/this._granularityCellSize),q=Math.floor(E/this._granularityCellSize),Y=Math.ceil(R/this._granularityCellSize);if(F!==Z||q!==Y)for(let W=q;W<Y;W++){const J=this._scanlineGenerateVertexRingForCellRow(W,g,m);zl(this._vertexBuffer,J,i)}else i.push(...m)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const h=e*this._granularityCellSize,m=h+this._granularityCellSize,g=[];for(let w=0;w<3;w++){const E=i[2*w],z=i[2*w+1],R=i[2*(w+1)%6],F=i[(2*(w+1)+1)%6],Z=i[2*(w+2)%6],q=i[(2*(w+2)+1)%6],Y=R-E,W=F-z,J=Y===0,re=W===0,xe=(h-z)/W,oe=(m-z)/W,ce=Math.min(xe,oe),Se=Math.max(xe,oe);if(!re&&(ce>=1||Se<=0)||re&&(z<h||z>m)){F>=h&&F<=m&&g.push(o[(w+1)%3]);continue}!re&&ce>0&&g.push(this._vertexToIndex(E+Y*ce,z+W*ce));const Ce=E+Y*Math.max(ce,0),Ye=E+Y*Math.min(Se,1);J||this._generateIntraEdgeVertices(g,E,z,R,F,Ce,Ye),!re&&Se<1&&g.push(this._vertexToIndex(E+Y*Se,z+W*Se)),(re||F>=h&&F<=m)&&g.push(o[(w+1)%3]),!re&&(F<=h||F>=m)&&this._generateInterEdgeVertices(g,E,z,R,F,Z,q,Ye,h,m)}return g}_generateIntraEdgeVertices(e,i,o,h,m,g,w){const E=h-i,z=m-o,R=z===0,F=R?Math.min(i,h):Math.min(g,w),Z=R?Math.max(i,h):Math.max(g,w),q=Math.floor(F/this._granularityCellSize)+1,Y=Math.ceil(Z/this._granularityCellSize)-1;if(R?i<h:g<w)for(let W=q;W<=Y;W++){const J=W*this._granularityCellSize;e.push(this._vertexToIndex(J,o+z*(J-i)/E))}else for(let W=Y;W>=q;W--){const J=W*this._granularityCellSize;e.push(this._vertexToIndex(J,o+z*(J-i)/E))}}_generateInterEdgeVertices(e,i,o,h,m,g,w,E,z,R){const F=m-o,Z=g-h,q=w-m,Y=(z-m)/q,W=(R-m)/q,J=Math.min(Y,W),re=Math.max(Y,W),xe=h+Z*J;let oe=Math.floor(Math.min(xe,E)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(xe,E)/this._granularityCellSize)-1,Se=E<xe;const Ce=q===0;if(Ce&&(w===z||w===R))return;if(Ce||J>=1||re<=0){const _t=o-w,ct=g+(i-g)*Math.min((z-w)/_t,(R-w)/_t);oe=Math.floor(Math.min(ct,E)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(ct,E)/this._granularityCellSize)-1,Se=E<ct}const Ye=F>0?R:z;if(Se)for(let _t=oe;_t<=ce;_t++)e.push(this._vertexToIndex(_t*this._granularityCellSize,Ye));else for(let _t=ce;_t>=oe;_t--)e.push(this._vertexToIndex(_t*this._granularityCellSize,Ye))}_generateOutline(e){const i=[];for(const o of e){const h=Bc(o,this._granularity,!0),m=this._pointArrayToIndices(h),g=[];for(let w=1;w<m.length;w++)g.push(m[w-1]),g.push(m[w]);i.push(g)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===qs&&(e[i+1]=-32767),o===Pl&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,h,m,g){h>m!=(g===qs)?(e.push(i),e.push(o),e.push(this._vertexToIndex(h,g)),e.push(o),e.push(this._vertexToIndex(m,g)),e.push(this._vertexToIndex(h,g))):(e.push(o),e.push(i),e.push(this._vertexToIndex(h,g)),e.push(this._vertexToIndex(m,g)),e.push(o),e.push(this._vertexToIndex(h,g)))}_fillPoles(e,i,o){const h=this._vertexBuffer,m=Et,g=e.length;for(let w=2;w<g;w+=3){const E=e[w-2],z=e[w-1],R=e[w],F=h[2*E],Z=h[2*E+1],q=h[2*z],Y=h[2*z+1],W=h[2*R],J=h[2*R+1];i&&(Z===0&&Y===0&&this._generatePoleQuad(e,E,z,F,q,qs),Y===0&&J===0&&this._generatePoleQuad(e,z,R,q,W,qs),J===0&&Z===0&&this._generatePoleQuad(e,R,E,W,F,qs)),o&&(Z===m&&Y===m&&this._generatePoleQuad(e,E,z,F,q,Pl),Y===m&&J===m&&this._generatePoleQuad(e,z,R,q,W,Pl),J===m&&Z===m&&this._generatePoleQuad(e,R,E,W,F,Pl))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:h}=(function(w){const E=[],z=[];for(const R of w)if(R.length!==0){R!==w[0]&&E.push(z.length/2);for(let F=0;F<R.length;F++)z.push(R[F].x),z.push(R[F].y)}return{flattened:z,holeIndices:E}})(e);let m;this._initializeVertices(o);try{const w=(function(z,R,F=2){const Z=R&&R.length,q=Z?R[0]*F:z.length;let Y=Yf(z,0,q,F,!0);const W=[];if(!Y||Y.next===Y.prev)return W;let J,re,xe;if(Z&&(Y=(function(oe,ce,Se,Ce){const Ye=[];for(let _t=0,ct=ce.length;_t<ct;_t++){const bt=Yf(oe,ce[_t]*Ce,_t<ct-1?ce[_t+1]*Ce:oe.length,Ce,!1);bt===bt.next&&(bt.steiner=!0),Ye.push(Y_(bt))}Ye.sort(Yr);for(let _t=0;_t<Ye.length;_t++)Se=am(Ye[_t],Se);return Se})(z,R,Y,F)),z.length>80*F){J=z[0],re=z[1];let oe=J,ce=re;for(let Se=F;Se<q;Se+=F){const Ce=z[Se],Ye=z[Se+1];Ce<J&&(J=Ce),Ye<re&&(re=Ye),Ce>oe&&(oe=Ce),Ye>ce&&(ce=Ye)}xe=Math.max(oe-J,ce-re),xe=xe!==0?32767/xe:0}return uh(Y,W,F,J,re,xe,0),W})(o,h),E=this._convertIndices(o,w);m=this._subdivideTrianglesScanline(E)}catch(w){console.error(w)}let g=[];return i&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(m),{verticesFlattened:this._vertexBuffer,indicesTriangles:m,indicesLineList:g}}_convertIndices(e,i){const o=[];for(let h=0;h<i.length;h++)o.push(this._vertexToIndex(e[2*i[h]],e[2*i[h]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const h=e[o];i.push(this._vertexToIndex(h.x,h.y))}return i}}function Qf(n,e,i,o=!0){return new Oc(i,e).subdividePolygonInternal(n,o)}function Bc(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],h=n[n.length-1],m=i&&(o.x!==h.x||o.y!==h.y);if(e<2)return m?[...n,n[0]]:[...n];const g=Math.floor(Et/e),w=[];w.push(new V(n[0].x,n[0].y));const E=n.length,z=m?E:E-1;for(let R=0;R<z;R++){const F=n[R],Z=R<E-1?n[R+1]:n[0],q=F.x,Y=F.y,W=Z.x,J=Z.y,re=q!==W,xe=Y!==J;if(!re&&!xe)continue;const oe=W-q,ce=J-Y,Se=Math.abs(oe),Ce=Math.abs(ce);let Ye=q,_t=Y;for(;;){const bt=oe>0?(Math.floor(Ye/g)+1)*g:(Math.ceil(Ye/g)-1)*g,Nt=ce>0?(Math.floor(_t/g)+1)*g:(Math.ceil(_t/g)-1)*g,St=Math.abs(Ye-bt),mt=Math.abs(_t-Nt),it=Math.abs(Ye-W),Wt=Math.abs(_t-J),Gt=re?St/Se:Number.POSITIVE_INFINITY,Qt=xe?mt/Ce:Number.POSITIVE_INFINITY;if((it<=St||!re)&&(Wt<=mt||!xe))break;if(Gt<Qt&&re||!xe){Ye=bt,_t+=ce*Gt;const Vt=new V(Ye,Math.round(_t));w[w.length-1].x===Vt.x&&w[w.length-1].y===Vt.y||w.push(Vt)}else{Ye+=oe*Qt,_t=Nt;const Vt=new V(Math.round(Ye),_t);w[w.length-1].x===Vt.x&&w[w.length-1].y===Vt.y||w.push(Vt)}}const ct=new V(W,J);w[w.length-1].x===ct.x&&w[w.length-1].y===ct.y||w.push(ct)}return w}function zl(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,h=n[2*e[0]];for(let E=1;E<e.length;E++){const z=n[2*e[E]];z<h&&(h=z,o=E)}const m=e.length;let g=o,w=(g+1)%m;for(;;){const E=g-1>=0?g-1:m-1,z=(w+1)%m,R=n[2*e[E]],F=n[2*e[z]],Z=n[2*e[g]],q=n[2*e[g]+1],Y=n[2*e[w]+1];let W=!1;if(R<F)W=!0;else if(R>F)W=!1;else{const J=Y-q,re=-(n[2*e[w]]-Z),xe=q<Y?1:-1;((R-Z)*J+(n[2*e[E]+1]-q)*re)*xe>((F-Z)*J+(n[2*e[z]+1]-q)*re)*xe&&(W=!0)}if(W){const J=e[E],re=e[g],xe=e[w];J!==re&&J!==xe&&re!==xe&&i.push(xe,re,J),g--,g<0&&(g=m-1)}else{const J=e[z],re=e[g],xe=e[w];J!==re&&J!==xe&&re!==xe&&i.push(xe,re,J),w++,w>=m&&(w=0)}if(E===z)break}}function lm(n,e,i,o,h,m,g,w,E){const z=h.length/2,R=g&&w&&E;if(z<Bt.MAX_VERTEX_ARRAY_LENGTH){const F=e.prepareSegment(z,i,o),Z=F.vertexLength;for(let W=0;W<m.length;W+=3)o.emplaceBack(Z+m[W],Z+m[W+1],Z+m[W+2]);let q,Y;F.vertexLength+=z,F.primitiveLength+=m.length/3,R&&(Y=g.prepareSegment(z,i,w),q=Y.vertexLength,Y.vertexLength+=z);for(let W=0;W<h.length;W+=2)n(h[W],h[W+1]);if(R)for(let W=0;W<E.length;W++){const J=E[W];for(let re=1;re<J.length;re+=2)w.emplaceBack(q+J[re-1],q+J[re]);Y.primitiveLength+=J.length/2}}else(function(F,Z,q,Y,W,J){const re=[];for(let Ce=0;Ce<Y.length/2;Ce++)re.push(-1);const xe={count:0};let oe=0,ce=F.getOrCreateLatestSegment(Z,q),Se=ce.vertexLength;for(let Ce=2;Ce<W.length;Ce+=3){const Ye=W[Ce-2],_t=W[Ce-1],ct=W[Ce];let bt=re[Ye]<oe,Nt=re[_t]<oe,St=re[ct]<oe;ce.vertexLength+((bt?1:0)+(Nt?1:0)+(St?1:0))>Bt.MAX_VERTEX_ARRAY_LENGTH&&(ce=F.createNewSegment(Z,q),oe=xe.count,bt=!0,Nt=!0,St=!0,Se=0);const mt=ic(re,Y,J,xe,Ye,bt,ce),it=ic(re,Y,J,xe,_t,Nt,ce),Wt=ic(re,Y,J,xe,ct,St,ce);q.emplaceBack(Se+mt-oe,Se+it-oe,Se+Wt-oe),ce.primitiveLength++}})(e,i,o,h,m,n),R&&(function(F,Z,q,Y,W,J){const re=[];for(let Ce=0;Ce<Y.length/2;Ce++)re.push(-1);const xe={count:0};let oe=0,ce=F.getOrCreateLatestSegment(Z,q),Se=ce.vertexLength;for(let Ce=0;Ce<W.length;Ce++){const Ye=W[Ce];for(let _t=1;_t<W[Ce].length;_t+=2){const ct=Ye[_t-1],bt=Ye[_t];let Nt=re[ct]<oe,St=re[bt]<oe;ce.vertexLength+((Nt?1:0)+(St?1:0))>Bt.MAX_VERTEX_ARRAY_LENGTH&&(ce=F.createNewSegment(Z,q),oe=xe.count,Nt=!0,St=!0,Se=0);const mt=ic(re,Y,J,xe,ct,Nt,ce),it=ic(re,Y,J,xe,bt,St,ce);q.emplaceBack(Se+mt-oe,Se+it-oe),ce.primitiveLength++}}})(g,i,w,h,E,n),e.forceNewSegmentOnNextPrepare(),g?.forceNewSegmentOnNextPrepare()}function ic(n,e,i,o,h,m,g){if(m){const w=o.count;return i(e[2*h],e[2*h+1]),n[h]=o.count,o.count++,g.vertexLength++,w}return n[h]}class hh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new pe,this.indexArray=new Ke,this.indexArray2=new zt,this.programConfigurations=new Kl(e.layers,e.zoom),this.segments=new Bt,this.segments2=new Bt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=xo("fill",this.layers,i);const h=this.layers[0].layout.get("fill-sort-key"),m=!h.isConstant(),g=[];for(const{feature:w,id:E,index:z,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,Z=vo(w,F);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),Z,o))continue;const q=m?h.evaluate(Z,{},o,i.availableImages):void 0,Y={id:E,properties:w.properties,type:w.type,sourceLayerIndex:R,index:z,geometry:F?Z.geometry:Cl(w),patterns:{},sortKey:q};g.push(Y)}m&&g.sort(((w,E)=>w.sortKey-E.sortKey));for(const w of g){const{geometry:E,index:z,sourceLayerIndex:R}=w;if(this.hasDependencies){const F=Xf("fill",this.layers,w,{zoom:this.zoom},i);this.patternFeatures.push(F)}else this.addFeature(w,E,z,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[z].feature,E,z,R,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,h,m,g){for(const w of hl(i,500)){const E=Qf(w,h,g.fill.getGranularityForZoomLevel(h.z)),z=this.layoutVertexArray;lm(((R,F)=>{z.emplaceBack(R,F)}),this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:m,canonical:h})}}let Jh,dh;qt("FillBucket",hh,{omit:["layers","patternFeatures"]});var Tg={get paint(){return dh=dh||new gr({"fill-antialias":new Xt($e.paint_fill["fill-antialias"]),"fill-opacity":new ti($e.paint_fill["fill-opacity"]),"fill-color":new ti($e.paint_fill["fill-color"]),"fill-outline-color":new ti($e.paint_fill["fill-outline-color"]),"fill-translate":new Xt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Xt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fs($e.paint_fill["fill-pattern"])})},get layout(){return Jh=Jh||new gr({"fill-sort-key":new ti($e.layout_fill["fill-sort-key"])})}};class Sg extends ir{constructor(e,i){super(e,Tg,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new hh(e)}queryRadius(){return Rd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:h}){return Nf(jf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,h),i)}isTileClipped(){return!0}}const Xd=Yn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Eg=Yn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Jf}=Xd;class ed{constructor(e,i,o,h,m){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=m,e.readFields(W_,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let h,m=1,g=0,w=0,E=0;for(;e.pos<i;){if(g<=0){const z=e.readVarint();m=7&z,g=z>>3}if(g--,m===1||m===2)w+=e.readSVarint(),E+=e.readSVarint(),m===1&&(h&&o.push(h),h=[]),h&&h.push(new V(w,E));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&o.push(h),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,h=0,m=0,g=0,w=1/0,E=-1/0,z=1/0,R=-1/0;for(;e.pos<i;){if(h<=0){const F=e.readVarint();o=7&F,h=F>>3}if(h--,o===1||o===2)m+=e.readSVarint(),g+=e.readSVarint(),m<w&&(w=m),m>E&&(E=m),g<z&&(z=g),g>R&&(R=g);else if(o!==7)throw new Error(`unknown command ${o}`)}return[w,z,E,R]}toGeoJSON(e,i,o){const h=this.extent*Math.pow(2,o),m=this.extent*e,g=this.extent*i,w=this.loadGeometry();function E(Z){return[360*(Z.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(Z.y+g)/h)*Math.PI))-90]}function z(Z){return Z.map(E)}let R;if(this.type===1){const Z=[];for(const Y of w)Z.push(Y[0]);const q=z(Z);R=Z.length===1?{type:"Point",coordinates:q[0]}:{type:"MultiPoint",coordinates:q}}else if(this.type===2){const Z=w.map(z);R=Z.length===1?{type:"LineString",coordinates:Z[0]}:{type:"MultiLineString",coordinates:Z}}else{if(this.type!==3)throw new Error("unknown feature type");{const Z=Mg(w),q=[];for(const Y of Z)q.push(Y.map(z));R=q.length===1?{type:"Polygon",coordinates:q[0]}:{type:"MultiPolygon",coordinates:q}}}const F={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(F.id=this.id),F}}function W_(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,h){const m=o.readVarint()+o.pos;for(;o.pos<m;){const g=h._keys[o.readVarint()],w=h._values[o.readVarint()];h.properties[g]=w}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function Mg(n){const e=n.length;if(e<=1)return[n];const i=[];let o,h;for(let m=0;m<e;m++){const g=An(n[m]);g!==0&&(h===void 0&&(h=g<0),h===g<0?(o&&i.push(o),o=[n[m]]):o&&o.push(n[m]))}return o&&i.push(o),i}function An(n){let e=0;for(let i,o,h=0,m=n.length,g=m-1;h<m;g=h++)i=n[h],o=n[g],e+=(o.x-i.x)*(i.y+o.y);return e}ed.types=["Unknown","Point","LineString","Polygon"];class Kn{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Qi,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new ed(this._pbf,i,this.extent,this._keys,this._values)}}function Qi(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let h=null;const m=o.readVarint()+o.pos;for(;o.pos<m;){const g=o.readVarint()>>3;h=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(i))}class Ji{constructor(e,i){this.layers=e.readFields(Bn,{},i)}}function Bn(n,e,i){if(n===3){const o=new Kn(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const ws=Math.pow(2,13);function Qo(n,e,i,o,h,m,g,w){n.emplaceBack(e,i,2*Math.floor(o*ws)+g,h*ws*2,m*ws*2,Math.round(w))}class xu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ve,this.centroidVertexArray=new he,this.indexArray=new Ke,this.programConfigurations=new Kl(e.layers,e.zoom),this.segments=new Bt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=xo("fill-extrusion",this.layers,i);for(const{feature:h,id:m,index:g,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,z=vo(h,E);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),z,o))continue;const R={id:m,sourceLayerIndex:w,index:g,geometry:E?z.geometry:Cl(h),properties:h.properties,type:h.type,patterns:{}};this.hasDependencies?this.features.push(Xf("fill-extrusion",this.layers,R,{zoom:this.zoom},i)):this.addFeature(R,R.geometry,g,o,{},i.subdivisionGranularity),i.featureIndex.insert(h,R.geometry,g,w,this.index,!0)}}addFeatures(e,i,o){for(const h of this.features){const{geometry:m}=h;this.addFeature(h,m,h.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jf),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Eg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,h,m,g){for(const w of hl(i,500)){const E={x:0,y:0,sampleCount:0},z=this.layoutVertexArray.length;this.processPolygon(E,h,e,w,g);const R=this.layoutVertexArray.length-z,F=Math.floor(E.x/E.sampleCount),Z=Math.floor(E.y/E.sampleCount);for(let q=0;q<R;q++)this.centroidVertexArray.emplaceBack(F,Z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:m,canonical:h})}processPolygon(e,i,o,h,m){if(h.length<1||Sr(h[0]))return;for(const F of h)F.length!==0&&cm(e,F);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=m.fill.getGranularityForZoomLevel(i.z),E=ed.types[o.type]==="Polygon";for(const F of h){if(F.length===0||Sr(F))continue;const Z=Bc(F,w,E);this._generateSideFaces(Z,g)}if(!E)return;const z=Qf(h,i,w,!1),R=this.layoutVertexArray;lm(((F,Z)=>{Qo(R,F,Z,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let h=1;h<e.length;h++){const m=e[h],g=e[h-1];if(Nc(m,g))continue;i.segment.vertexLength+4>Bt.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=m.sub(g)._perp()._unit(),E=g.dist(m);o+E>32768&&(o=0),Qo(this.layoutVertexArray,m.x,m.y,w.x,w.y,0,0,o),Qo(this.layoutVertexArray,m.x,m.y,w.x,w.y,0,1,o),o+=E,Qo(this.layoutVertexArray,g.x,g.y,w.x,w.y,0,0,o),Qo(this.layoutVertexArray,g.x,g.y,w.x,w.y,0,1,o);const z=i.segment.vertexLength;this.indexArray.emplaceBack(z,z+2,z+1),this.indexArray.emplaceBack(z+1,z+2,z+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function cm(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function Nc(n,e){return n.x===e.x&&(n.x<0||n.x>Et)||n.y===e.y&&(n.y<0||n.y>Et)}function Sr(n){return n.every((e=>e.x<0))||n.every((e=>e.x>Et))||n.every((e=>e.y<0))||n.every((e=>e.y>Et))}let Fc;qt("FillExtrusionBucket",xu,{omit:["layers","features"]});var fh={get paint(){return Fc=Fc||new gr({"fill-extrusion-opacity":new Xt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ti($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fs($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ti($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ti($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class um extends ir{constructor(e,i){super(e,fh,i)}createBucket(e){return new xu(e)}queryRadius(){return Rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:h,transform:m,pixelsToTileUnits:g,pixelPosMatrix:w}){const E=jf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-m.bearingInRadians,g),z=this.paint.get("fill-extrusion-height").evaluate(i,o),R=this.paint.get("fill-extrusion-base").evaluate(i,o),F=(function(q,Y){const W=[];for(const J of q){const re=[J.x,J.y,0,1];oi(re,re,Y),W.push(new V(re[0]/re[3],re[1]/re[3]))}return W})(E,w),Z=(function(q,Y,W,J){const re=[],xe=[],oe=J[8]*Y,ce=J[9]*Y,Se=J[10]*Y,Ce=J[11]*Y,Ye=J[8]*W,_t=J[9]*W,ct=J[10]*W,bt=J[11]*W;for(const Nt of q){const St=[],mt=[];for(const it of Nt){const Wt=it.x,Gt=it.y,Qt=J[0]*Wt+J[4]*Gt+J[12],Vt=J[1]*Wt+J[5]*Gt+J[13],ai=J[2]*Wt+J[6]*Gt+J[14],an=J[3]*Wt+J[7]*Gt+J[15],Ui=ai+Se,fr=an+Ce,ts=Qt+Ye,ea=Vt+_t,pr=ai+ct,rr=an+bt,Tn=new V((Qt+oe)/fr,(Vt+ce)/fr);Tn.z=Ui/fr,St.push(Tn);const Er=new V(ts/rr,ea/rr);Er.z=pr/rr,mt.push(Er)}re.push(St),xe.push(mt)}return[re,xe]})(h,R,z,w);return(function(q,Y,W){let J=1/0;Nf(W,Y)&&(J=ph(W,Y[0]));for(let re=0;re<Y.length;re++){const xe=Y[re],oe=q[re];for(let ce=0;ce<xe.length-1;ce++){const Se=xe[ce],Ce=[Se,xe[ce+1],oe[ce+1],oe[ce],Se];ch(W,Ce)&&(J=Math.min(J,ph(W,Ce)))}}return J!==1/0&&J})(Z[0],Z[1],F)}}function Va(n,e){return n.x*e.x+n.y*e.y}function ph(n,e){if(n.length===1){let i=0;const o=e[i++];let h;for(;!h||o.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const m=e[i],g=n[0],w=h.sub(o),E=m.sub(o),z=g.sub(o),R=Va(w,w),F=Va(w,E),Z=Va(E,E),q=Va(z,w),Y=Va(z,E),W=R*Z-F*F,J=(Z*q-F*Y)/W,re=(R*Y-F*q)/W,xe=o.z*(1-J-re)+h.z*J+m.z*re;if(isFinite(xe))return xe}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const Yd=Yn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Gs}=Yd,hm=Yn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ep}=hm,Ag=Math.cos(Math.PI/180*37.5),Wd=Math.pow(2,14)/.5;class td{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new Me,this.layoutVertexArray2=new ye,this.indexArray=new Ke,this.programConfigurations=new Kl(e.layers,e.zoom),this.segments=new Bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=xo("line",this.layers,i)||this.hasLineDasharray(this.layers);const h=this.layers[0].layout.get("line-sort-key"),m=!h.isConstant(),g=[];for(const{feature:w,id:E,index:z,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,Z=vo(w,F);if(!this.layers[0]._featureFilter.filter(new _n(this.zoom),Z,o))continue;const q=m?h.evaluate(Z,{},o):void 0,Y={id:E,properties:w.properties,type:w.type,sourceLayerIndex:R,index:z,geometry:F?Z.geometry:Cl(w),patterns:{},dashes:{},sortKey:q};g.push(Y)}m&&g.sort(((w,E)=>w.sortKey-E.sortKey));for(const w of g){const{geometry:E,index:z,sourceLayerIndex:R}=w;this.hasDependencies?(xo("line",this.layers,i)?Xf("line",this.layers,w,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,w,this.zoom,i),this.patternFeatures.push(w)):this.addFeature(w,E,z,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[z].feature,E,z,R,this.index)}}update(e,i,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:h})}addFeatures(e,i,o,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,o,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ep)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gs),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,h,m,g,w){const E=this.layers[0].layout,z=E.get("line-join").evaluate(e,{}),R=E.get("line-cap"),F=E.get("line-miter-limit"),Z=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const q of i)this.addLine(q,e,z,R,F,Z,h,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:m,dashPositions:g,canonical:h})}addLine(e,i,o,h,m,g,w,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Bc(e,w?E.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<e.length-1;oe++)this.totalDistance+=e[oe].dist(e[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=ed.types[i.type]==="Polygon";let R=e.length;for(;R>=2&&e[R-1].equals(e[R-2]);)R--;let F=0;for(;F<R-1&&e[F].equals(e[F+1]);)F++;if(R<(z?3:2))return;o==="bevel"&&(m=1.05);const Z=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let Y,W,J,re,xe;this.e1=this.e2=-1,z&&(Y=e[R-2],xe=e[F].sub(Y)._unit()._perp());for(let oe=F;oe<R;oe++){if(J=oe===R-1?z?e[F+1]:void 0:e[oe+1],J&&e[oe].equals(J))continue;xe&&(re=xe),Y&&(W=Y),Y=e[oe],xe=J?J.sub(Y)._unit()._perp():re,re=re||xe;let ce=re.add(xe);ce.x===0&&ce.y===0||ce._unit();const Se=re.x*xe.x+re.y*xe.y,Ce=ce.x*xe.x+ce.y*xe.y,Ye=Ce!==0?1/Ce:1/0,_t=2*Math.sqrt(2-2*Ce),ct=Ce<Ag&&W&&J,bt=re.x*xe.y-re.y*xe.x>0;if(ct&&oe>F){const mt=Y.dist(W);if(mt>2*Z){const it=Y.sub(Y.sub(W)._mult(Z/mt)._round());this.updateDistance(W,it),this.addCurrentVertex(it,re,0,0,q),W=it}}const Nt=W&&J;let St=Nt?o:z?"butt":h;if(Nt&&St==="round"&&(Ye<g?St="miter":Ye<=2&&(St="fakeround")),St==="miter"&&Ye>m&&(St="bevel"),St==="bevel"&&(Ye>2&&(St="flipbevel"),Ye<m&&(St="miter")),W&&this.updateDistance(W,Y),St==="miter")ce._mult(Ye),this.addCurrentVertex(Y,ce,0,0,q);else if(St==="flipbevel"){if(Ye>100)ce=xe.mult(-1);else{const mt=Ye*re.add(xe).mag()/re.sub(xe).mag();ce._perp()._mult(mt*(bt?-1:1))}this.addCurrentVertex(Y,ce,0,0,q),this.addCurrentVertex(Y,ce.mult(-1),0,0,q)}else if(St==="bevel"||St==="fakeround"){const mt=-Math.sqrt(Ye*Ye-1),it=bt?mt:0,Wt=bt?0:mt;if(W&&this.addCurrentVertex(Y,re,it,Wt,q),St==="fakeround"){const Gt=Math.round(180*_t/Math.PI/20);for(let Qt=1;Qt<Gt;Qt++){let Vt=Qt/Gt;if(Vt!==.5){const an=Vt-.5;Vt+=Vt*an*(Vt-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*an*an+(.848013+Se*(.215638*Se-1.06021)))}const ai=xe.sub(re)._mult(Vt)._add(re)._unit()._mult(bt?-1:1);this.addHalfVertex(Y,ai.x,ai.y,!1,bt,0,q)}}J&&this.addCurrentVertex(Y,xe,-it,-Wt,q)}else if(St==="butt")this.addCurrentVertex(Y,ce,0,0,q);else if(St==="square"){const mt=W?1:-1;this.addCurrentVertex(Y,ce,mt,mt,q)}else St==="round"&&(W&&(this.addCurrentVertex(Y,re,0,0,q),this.addCurrentVertex(Y,re,1,1,q,!0)),J&&(this.addCurrentVertex(Y,xe,-1,-1,q,!0),this.addCurrentVertex(Y,xe,0,0,q)));if(ct&&oe<R-1){const mt=Y.dist(J);if(mt>2*Z){const it=Y.add(J.sub(Y)._mult(Z/mt)._round());this.updateDistance(Y,it),this.addCurrentVertex(it,xe,0,0,q),Y=it}}}}addCurrentVertex(e,i,o,h,m,g=!1){const w=i.y*h-i.x,E=-i.y-i.x*h;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,g,!1,o,m),this.addHalfVertex(e,w,E,g,!0,-h,m),this.distance>Wd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,h,m,g))}addHalfVertex({x:e,y:i},o,h,m,g,w,E){const z=.5*(this.lineClips?this.scaledDistance*(Wd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(w===0?0:w<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),E.primitiveLength++),g?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,h){for(const m of e){const g=m.paint.get("line-dasharray");if(!g||g.value.kind==="constant")continue;const w=m.layout.get("line-cap")==="round",E={dasharray:g.value.evaluate({zoom:o-1},i,{}),round:w},z={dasharray:g.value.evaluate({zoom:o},i,{}),round:w},R={dasharray:g.value.evaluate({zoom:o+1},i,{}),round:w},F=`${E.dasharray.join(",")},${E.round}`,Z=`${z.dasharray.join(",")},${z.round}`,q=`${R.dasharray.join(",")},${R.round}`;h.dashDependencies[F]=E,h.dashDependencies[Z]=z,h.dashDependencies[q]=R,i.dashes[m.id]={min:F,mid:Z,max:q}}}}let jc,Kr;qt("LineBucket",td,{omit:["layers","patternFeatures"]});var Uc={get paint(){return Kr=Kr||new gr({"line-opacity":new ti($e.paint_line["line-opacity"]),"line-color":new ti($e.paint_line["line-color"]),"line-translate":new Xt($e.paint_line["line-translate"]),"line-translate-anchor":new Xt($e.paint_line["line-translate-anchor"]),"line-width":new ti($e.paint_line["line-width"]),"line-gap-width":new ti($e.paint_line["line-gap-width"]),"line-offset":new ti($e.paint_line["line-offset"]),"line-blur":new ti($e.paint_line["line-blur"]),"line-dasharray":new Fs($e.paint_line["line-dasharray"]),"line-pattern":new Fs($e.paint_line["line-pattern"]),"line-gradient":new ih($e.paint_line["line-gradient"])})},get layout(){return jc=jc||new gr({"line-cap":new Xt($e.layout_line["line-cap"]),"line-join":new ti($e.layout_line["line-join"]),"line-miter-limit":new Xt($e.layout_line["line-miter-limit"]),"line-round-limit":new Xt($e.layout_line["line-round-limit"]),"line-sort-key":new ti($e.layout_line["line-sort-key"])})}};class id extends ti{possiblyEvaluate(e,i){return i=new _n(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,h){return i=ui({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,h)}}let Jo;class dm extends ir{constructor(e,i){super(e,Uc,i),this.gradientVersion=0,Jo||(Jo=new id(Uc.paint.properties["line-width"].specification),Jo.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof Io,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=Jo.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new td(e)}queryRadius(e){const i=e,o=tp(Lc("line-width",this,i),Lc("line-gap-width",this,i)),h=Lc("line-offset",this,i);return o/2+Math.abs(h)+Rd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:h,transform:m,pixelsToTileUnits:g}){const w=jf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-m.bearingInRadians,g),E=g/2*tp(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),z=this.paint.get("line-offset").evaluate(i,o);return z&&(h=(function(R,F){const Z=[];for(let q=0;q<R.length;q++){const Y=Uf(R[q]),W=[];for(let J=0;J<Y.length;J++){const re=Y[J],xe=Y[J-1],oe=Y[J+1],ce=J===0?new V(0,0):re.sub(xe)._unit()._perp(),Se=J===Y.length-1?new V(0,0):oe.sub(re)._unit()._perp(),Ce=ce._add(Se)._unit(),Ye=Ce.x*Se.x+Ce.y*Se.y;Ye!==0&&Ce._mult(1/Ye),W.push(Ce._mult(F)._add(re))}Z.push(W)}return Z})(h,z*g)),(function(R,F,Z){for(let q=0;q<F.length;q++){const Y=F[q];if(R.length>=3){for(let W=0;W<Y.length;W++)if(Jl(R,Y[W]))return!0}if(Xr(R,Y,Z))return!0}return!1})(w,h,E)}isTileClipped(){return!0}}function tp(n,e){return e>0?e+2*n:n}const Cg=Yn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kd=Yn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Yn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fm=Yn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Yn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hs=Yn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pg=Yn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $s(n,e,i){return n.sections.forEach((o=>{o.text=(function(h,m,g){const w=m.layout.get("text-transform").evaluate(g,{});return w==="uppercase"?h=h.toLocaleUpperCase():w==="lowercase"&&(h=h.toLocaleLowerCase()),Ns.applyArabicShaping&&(h=Ns.applyArabicShaping(h)),h})(o.text,e,i)})),n}Yn([{name:"triangle",components:3,type:"Uint16"}]),Yn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Yn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Yn([{type:"Float32",name:"offsetX"}]),Yn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Yn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Zr=24;const nd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},K_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},bu={40:!0};function Qd(n,e,i,o,h,m){if("fontStack"in e){const g=i[e.fontStack],w=g&&g[n];return w?w.metrics.advance*e.scale+h:0}{const g=o[e.imageName];return g?g.displaySize[0]*e.scale*Zr/m+h:0}}function ip(n,e,i,o){const h=Math.pow(n-e,2);return o?n<e?h/2:2*h:h+Math.abs(i)*i}function rd(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function pm(n,e,i,o,h,m){let g=null,w=ip(e,i,h,m);for(const E of o){const z=ip(e-E.x,i,h,m)+E.badness;z<=w&&(g=E,w=z)}return{index:n,x:e,priorBreak:g,badness:w}}function mm(n){return n?mm(n.priorBreak).concat(n.index):[]}class mh{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new mh;for(let h=0;h<e.sections.length;h++){const m=e.sections[h];m.image?o.addImageSection(m):o.addTextSection(m,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const h=e[Symbol.iterator]();let m=h.next();const g=e[Symbol.iterator]();g.next();let w=g.next();for(;!m.done;)i+=!w.done&&$o(w.value.codePointAt(0))&&!nd[w.value]||!o.premature&&$o(o.value.codePointAt(0))&&!nd[o.value]||!nd[m.value]?m.value:nd[m.value],o={value:m.value,premature:!1},m=h.next(),w=g.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),h=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-h),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-h)}substring(e,i){const o=[...this.text].slice(e,i).join(""),h=this.sectionIndex.slice(e,i);return new mh(o,this.sections,h)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let h=0;h<this.length();h++){const m=this.getSection(h);if("imageName"in m){const g=e[m.imageName];if(!g)continue;const w=g.displaySize;i=Math.max(i,w[0]),o=Math.max(o,w[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Gi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):Gi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,h,m){const g=[],w=this.determineAverageLineWidth(e,i,o,h,m),E=this.hasZeroWidthSpaces();let z=0,R=0;const F=this.text[Symbol.iterator]();let Z=F.next();const q=this.text[Symbol.iterator]();q.next();let Y=q.next();const W=this.text[Symbol.iterator]();W.next(),W.next();let J=W.next();for(;!Z.done;){const re=this.getSection(R),xe=Z.value.codePointAt(0);if(Ku(xe)||(z+=Qd(xe,re,o,h,e,m)),!Y.done){const oe=qo(xe),ce=Y.value.codePointAt(0);(K_[xe]||oe||"imageName"in re||!J.done&&bu[ce])&&g.push(pm(R+1,z,w,g,rd(xe,ce,oe&&E),!1))}R++,Z=F.next(),Y=q.next(),J=W.next()}return mm(pm(this.length(),z,w,g,0,!0))}determineAverageLineWidth(e,i,o,h,m){let g=0,w=0;for(const E of this.text){const z=this.getSection(w);g+=Qd(E.codePointAt(0),z,o,h,e,m),w++}return g/Math.max(1,Math.ceil(g/i))}}const np=4294967296,Jd=1/np,rp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class ap{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const h=this.readVarint(),m=h>>3,g=this.pos;this.type=7&h,e(m,i,this),this.pos===g&&this.skip(h)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*np;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*np;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,h;return h=i[this.pos++],o=127&h,h<128?o:(h=i[this.pos++],o|=(127&h)<<7,h<128?o:(h=i[this.pos++],o|=(127&h)<<14,h<128?o:(h=i[this.pos++],o|=(127&h)<<21,h<128?o:(h=i[this.pos],o|=(15&h)<<28,(function(m,g,w){const E=w.buf;let z,R;if(R=E[w.pos++],z=(112&R)>>4,R<128||(R=E[w.pos++],z|=(127&R)<<3,R<128)||(R=E[w.pos++],z|=(127&R)<<10,R<128)||(R=E[w.pos++],z|=(127&R)<<17,R<128)||(R=E[w.pos++],z|=(127&R)<<24,R<128)||(R=E[w.pos++],z|=(1&R)<<31,R<128))return ad(m,z,g);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&rp?rp.decode(this.buf.subarray(i,e)):(function(o,h,m){let g="",w=h;for(;w<m;){const E=o[w];let z,R,F,Z=null,q=E>239?4:E>223?3:E>191?2:1;if(w+q>m)break;q===1?E<128&&(Z=E):q===2?(z=o[w+1],(192&z)==128&&(Z=(31&E)<<6|63&z,Z<=127&&(Z=null))):q===3?(z=o[w+1],R=o[w+2],(192&z)==128&&(192&R)==128&&(Z=(15&E)<<12|(63&z)<<6|63&R,(Z<=2047||Z>=55296&&Z<=57343)&&(Z=null))):q===4&&(z=o[w+1],R=o[w+2],F=o[w+3],(192&z)==128&&(192&R)==128&&(192&F)==128&&(Z=(15&E)<<18|(63&z)<<12|(63&R)<<6|63&F,(Z<=65535||Z>=1114112)&&(Z=null))),Z===null?(Z=65533,q=1):Z>65535&&(Z-=65536,g+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),g+=String.fromCharCode(Z),w+=q}return g})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Jd),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Jd),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let h,m;if(i>=0?(h=i%4294967296|0,m=i/4294967296|0):(h=~(-i%4294967296),m=~(-i/4294967296),4294967295^h?h=h+1|0:(h=0,m=m+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(g,w,E){E.buf[E.pos++]=127&g|128,g>>>=7,E.buf[E.pos++]=127&g|128,g>>>=7,E.buf[E.pos++]=127&g|128,g>>>=7,E.buf[E.pos++]=127&g|128,E.buf[E.pos]=127&(g>>>=7)})(h,0,o),(function(g,w){const E=(7&g)<<4;w.buf[w.pos++]|=E|((g>>>=3)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g)))))})(m,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(h,m,g){for(let w,E,z=0;z<m.length;z++){if(w=m.charCodeAt(z),w>55295&&w<57344){if(!E){w>56319||z+1===m.length?(h[g++]=239,h[g++]=191,h[g++]=189):E=w;continue}if(w<56320){h[g++]=239,h[g++]=191,h[g++]=189,E=w;continue}w=E-55296<<10|w-56320|65536,E=null}else E&&(h[g++]=239,h[g++]=191,h[g++]=189,E=null);w<128?h[g++]=w:(w<2048?h[g++]=w>>6|192:(w<65536?h[g++]=w>>12|224:(h[g++]=w>>18|240,h[g++]=w>>12&63|128),h[g++]=w>>6&63|128),h[g++]=63&w|128)}return g})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&zg(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const h=this.pos-o;h>=128&&zg(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,Dg,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,Ig,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,Lg,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,sd,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,sp,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,kg,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,Rg,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,Og,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,Bg,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function ad(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function zg(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let h=i.pos-1;h>=n;h--)i.buf[h+o]=i.buf[h]}function Dg(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function Ig(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function sd(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function sp(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function Lg(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function kg(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function Rg(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function Og(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function Bg(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function Ng(n,e,i){n===1&&i.readMessage(op,e)}function op(n,e,i){if(n===3){const{id:o,bitmap:h,width:m,height:g,left:w,top:E,advance:z}=i.readMessage(Fg,{});e.push({id:o,bitmap:new Nd({width:m+6,height:g+6},h),metrics:{width:m,height:g,left:w,top:E,advance:z}})}}function Fg(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function gm(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort(((g,w)=>w.h-g.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,m=0;for(const g of n)for(let w=o.length-1;w>=0;w--){const E=o[w];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,m=Math.max(m,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===E.w&&g.h===E.h){const z=o.pop();z&&w<o.length&&(o[w]=z)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(o.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}class Cn{constructor(e,{pixelRatio:i,version:o,stretchX:h,stretchY:m,content:g,textFitWidth:w,textFitHeight:E}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=m,this.content=g,this.version=o,this.textFitWidth=w,this.textFitHeight=E}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class lp{constructor(e,i){const o={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,o,m),this.addImages(i,h,m);const{w:g,h:w}=gm(m),E=new Ka({width:g||1,height:w||1});for(const z in e){const R=e[z],F=o[z].paddedRect;Ka.copy(R.data,E,{x:0,y:0},{x:F.x+1,y:F.y+1},R.data)}for(const z in i){const R=i[z],F=h[z].paddedRect,Z=F.x+1,q=F.y+1,Y=R.data.width,W=R.data.height;Ka.copy(R.data,E,{x:0,y:0},{x:Z,y:q},R.data),Ka.copy(R.data,E,{x:0,y:W-1},{x:Z,y:q-1},{width:Y,height:1}),Ka.copy(R.data,E,{x:0,y:0},{x:Z,y:q+W},{width:Y,height:1}),Ka.copy(R.data,E,{x:Y-1,y:0},{x:Z-1,y:q},{width:1,height:W}),Ka.copy(R.data,E,{x:0,y:0},{x:Z+Y,y:q},{width:1,height:W})}this.image=E,this.iconPositions=o,this.patternPositions=h}addImages(e,i,o){for(const h in e){const m=e[h],g={x:0,y:0,w:m.data.width+2,h:m.data.height+2};o.push(g),i[h]=new Cn(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,m]=e.tl;o.update(i.data,void 0,{x:h,y:m})}}var wu;function ef(n,e,i,o,h,m,g,w,E,z,R,F,Z,q,Y){const W=mh.fromFeature(n,h);let J;F===D.az.vertical&&W.verticalizePunctuation();let re=W.determineLineBreaks(z,m,e,o,q);const{processBidirectionalText:xe,processStyledBidirectionalText:oe}=Ns;if(xe&&W.sections.length===1){J=[],re=re.map((Ye=>W.toCodeUnitIndex(Ye)));const Ce=xe(W.toString(),re);for(const Ye of Ce){const _t=[...Ye].map((()=>0));J.push(new mh(Ye,W.sections,_t))}}else if(oe){J=[],re=re.map((ct=>W.toCodeUnitIndex(ct)));let Ce=0;const Ye=[];for(const ct of W.text)Ye.push(...Array(ct.length).fill(W.sectionIndex[Ce])),Ce++;const _t=oe(W.text,Ye,re);for(const ct of _t){const bt=[];let Nt="";for(const St of ct[0])bt.push(ct[1][Nt.length]),Nt+=St;J.push(new mh(ct[0],W.sections,bt))}}else J=(function(Ce,Ye){const _t=[];let ct=0;for(const bt of Ye)_t.push(Ce.substring(ct,bt)),ct=bt;return ct<Ce.length()&&_t.push(Ce.substring(ct,Ce.length())),_t})(W,re);const ce=[],Se={positionedLines:ce,text:W.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:F,iconsInText:!1,verticalizable:!1};return(function(Ce,Ye,_t,ct,bt,Nt,St,mt,it,Wt,Gt,Qt){let Vt=0,ai=0,an=0,Ui=0;const fr=mt==="right"?1:mt==="left"?0:.5,ts=Zr/Qt;let ea=0;for(const Tn of bt){Tn.trim();const Er=Tn.getMaxScale(),Ir={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[ea]=Ir;const Qn=Ir.positionedGlyphs;let To=0;if(!Tn.length()){ai+=Nt,++ea;continue}const is=Q_(ct,Tn,ts);let So=0;for(const La of Tn.text){const yr=Tn.getSection(So),ta=La.codePointAt(0),Mr=cp(it,Gt,ta),ka={glyph:ta,imageName:null,x:Vt,y:ai+-17,vertical:Mr,scale:1,fontStack:"",sectionIndex:Tn.getSectionIndex(So),metrics:null,rect:null};let vh;if("fontStack"in yr){if(vh=od(yr,ta,Mr,is,Ye,_t),!vh)continue;ka.fontStack=yr.fontStack}else{if(Ce.iconsInText=!0,yr.scale*=ts,vh=ym(yr,Mr,Er,is,ct),!vh)continue;To=Math.max(To,vh.imageOffset),ka.imageName=yr.imageName}const{rect:$c,metrics:Qm,baselineOffset:_d}=vh;ka.y+=_d,ka.scale=yr.scale,ka.metrics=Qm,ka.rect=$c,Qn.push(ka),Mr?(Ce.verticalizable=!0,Vt+=("imageName"in yr?Qm.advance:Zr)*yr.scale+Wt):Vt+=Qm.advance*yr.scale+Wt,So++}Qn.length!==0&&(an=Math.max(Vt-Wt,an),up(Qn,0,Qn.length-1,fr)),Vt=0,Ir.lineOffset=Math.max(To,(Er-1)*Zr);const ac=Nt*Er+To;ai+=ac,Ui=Math.max(ac,Ui),++ea}const{horizontalAlign:pr,verticalAlign:rr}=_m(St);(function(Tn,Er,Ir,Qn,To,is,So,ac,La){const yr=(Er-Ir)*To;let ta=0;ta=is!==So?-ac*Qn- -17:-Qn*La*So+.5*So;for(const Mr of Tn)for(const ka of Mr.positionedGlyphs)ka.x+=yr,ka.y+=ta})(Ce.positionedLines,fr,pr,rr,an,Ui,Nt,ai,bt.length),Ce.top+=-rr*ai,Ce.bottom=Ce.top+ai,Ce.left+=-pr*an,Ce.right=Ce.left+an})(Se,e,i,o,J,g,w,E,F,z,Z,Y),!(function(Ce){for(const Ye of Ce)if(Ye.positionedGlyphs.length!==0)return!1;return!0})(ce)&&Se}function _m(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Q_(n,e,i){const o=e.getMaxScale()*Zr,{maxImageWidth:h,maxImageHeight:m}=e.getMaxImageSize(n),g=Math.max(o,m*i);return{verticalLineContentWidth:Math.max(o,h*i),horizontalLineContentHeight:g}}function jg(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function cp(n,e,i){return!(n===D.az.horizontal||!e&&!Ec(i)||e&&(Ku(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function od(n,e,i,o,h,m){const g=m[n.fontStack],w=(function(z,R,F,Z){if(z&&z.rect)return z;const q=R[F.fontStack],Y=q&&q[Z];return Y?{rect:null,metrics:Y.metrics}:null})(g&&g[e],h,n,e);if(w===null)return null;let E;if(i)E=o.verticalLineContentWidth-n.scale*Zr;else{const z=jg(n.verticalAlign);E=(o.horizontalLineContentHeight-n.scale*Zr)*z}return{rect:w.rect,metrics:w.metrics,baselineOffset:E}}function ym(n,e,i,o,h){const m=h[n.imageName];if(!m)return null;const g=m.paddedRect,w=m.displaySize,E={width:w[0],height:w[1],left:1,top:-3,advance:e?w[1]:w[0]};let z;if(e)z=o.verticalLineContentWidth-w[1]*n.scale;else{const R=jg(n.verticalAlign);z=(o.horizontalLineContentHeight-w[1]*n.scale)*R}return{rect:g,metrics:E,baselineOffset:z,imageOffset:(e?w[0]:w[1])*n.scale-Zr*i}}function up(n,e,i,o){if(o===0)return;const h=n[i],m=(n[i].x+h.metrics.advance*h.scale)*o;for(let g=e;g<=i;g++)n[g].x-=m}function vm(n,e,i){const{horizontalAlign:o,verticalAlign:h}=_m(i),m=e[0]-n.displaySize[0]*o,g=e[1]-n.displaySize[1]*h;return{image:n,top:g,bottom:g+n.displaySize[1],left:m,right:m+n.displaySize[0]}}function Vc(n){var e,i;let o=n.left,h=n.top,m=n.right-o,g=n.bottom-h;const w=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",E=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",z=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(E==="proportional"){if(w==="stretchOnly"&&m/g<z||w==="proportional"){const R=Math.ceil(g*z);o*=R/m,m=R}}else if(w==="proportional"&&E==="stretchOnly"&&z!==0&&m/g>z){const R=Math.ceil(m/z);h*=R/g,g=R}return{x1:o,y1:h,x2:o+m,y2:h+g}}function Dl(n,e,i,o,h,m){const g=n.image;let w;if(g.content){const J=g.content,re=g.pixelRatio||1;w=[J[0]/re,J[1]/re,g.displaySize[0]-J[2]/re,g.displaySize[1]-J[3]/re]}const E=e.left*m,z=e.right*m;let R,F,Z,q;i==="width"||i==="both"?(q=h[0]+E-o[3],F=h[0]+z+o[1]):(q=h[0]+(E+z-g.displaySize[0])/2,F=q+g.displaySize[0]);const Y=e.top*m,W=e.bottom*m;return i==="height"||i==="both"?(R=h[1]+Y-o[0],Z=h[1]+W+o[2]):(R=h[1]+(Y+W-g.displaySize[1])/2,Z=R+g.displaySize[1]),{image:g,top:R,right:F,bottom:Z,left:q,collisionPadding:w}}qt("ImagePosition",Cn),qt("ImageAtlas",lp),D.az=void 0,(wu=D.az||(D.az={}))[wu.none=0]="none",wu[wu.horizontal=1]="horizontal",wu[wu.vertical=2]="vertical",wu[wu.horizontalOnly=3]="horizontalOnly";const bo=128,Tu=32640;function xm(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new _n(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=i;let m=0;for(;m<o.length&&o[m]<=n;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<n+1;)g++;g=Math.min(o.length-1,g);const w=o[m],E=o[g];return i.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:E,minSize:i.evaluate(new _n(w)),maxSize:i.evaluate(new _n(E)),interpolationType:h}}}function hp(n,e,i){let o="never";const h=n.get(e);return h?o=h:n.get(i)&&(o="always"),o}const Ug=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tf(n,e,i,o,h,m,g,w,E,z,R,F,Z){const q=w?Math.min(Tu,Math.round(w[0])):0,Y=w?Math.min(Tu,Math.round(w[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*h),m,g,(q<<1)+(E?1:0),Y,16*z,16*R,256*F,256*Z)}function bm(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function wm(n){for(const e of n.sections)if(wl(e.text))return!0;return!1}class dp{constructor(e){this.layoutVertexArray=new Te,this.indexArray=new Ke,this.programConfigurations=e,this.segments=new Bt,this.dynamicLayoutVertexArray=new Oe,this.opacityVertexArray=new et,this.hasVisibleVertices=!1,this.placedSymbolArray=new S}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Kd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ug,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qt("SymbolBuffers",dp);class fp{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Bt,this.collisionVertexArray=new We}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,fm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qt("CollisionBuffers",fp);class ld{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xm(this.zoom,i["text-size"]),this.iconSizeData=xm(this.zoom,i["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=hp(o,"text-overlap","text-allow-overlap")!=="never"||hp(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((g=>D.az[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID}createArrays(){this.text=new dp(new Kl(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new dp(new Kl(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new N,this.lineVertexArray=new U,this.symbolInstances=new I,this.textAnchorOffsets=new G}calculateGlyphDependencies(e,i,o,h,m){for(const g of e)if(i[g.codePointAt(0)]=!0,(o||h)&&m){const w=nd[g];w&&(i[w.codePointAt(0)]=!0)}}populate(e,i,o){const h=this.layers[0],m=h.layout,g=m.get("text-font"),w=m.get("text-field"),E=m.get("icon-image"),z=(w.value.kind!=="constant"||w.value.value instanceof xr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),R=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,F=m.get("symbol-sort-key");if(this.features=[],!z&&!R)return;const Z=i.iconDependencies,q=i.glyphDependencies,Y=i.availableImages,W=new _n(this.zoom);for(const{feature:J,id:re,index:xe,sourceLayerIndex:oe}of e){const ce=h._featureFilter.needGeometry,Se=vo(J,ce);if(!h._featureFilter.filter(W,Se,o))continue;let Ce,Ye;if(ce||(Se.geometry=Cl(J)),z){const ct=h.getValueAndResolveTokens("text-field",Se,o,Y),bt=xr.factory(ct),Nt=this.hasRTLText=this.hasRTLText||wm(bt);(!Nt||Ns.getRTLTextPluginStatus()==="unavailable"||Nt&&Ns.isParsed())&&(Ce=$s(bt,h,Se))}if(R){const ct=h.getValueAndResolveTokens("icon-image",Se,o,Y);Ye=ct instanceof Or?ct:Or.fromString(ct)}if(!Ce&&!Ye)continue;const _t=this.sortFeaturesByKey?F.evaluate(Se,{},o):void 0;if(this.features.push({id:re,text:Ce,icon:Ye,index:xe,sourceLayerIndex:oe,geometry:Se.geometry,properties:J.properties,type:ed.types[J.type],sortKey:_t}),Ye&&(Z[Ye.name]=!0),Ce){const ct=g.evaluate(Se,{},o).join(","),bt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(D.az.vertical)>=0;for(const Nt of Ce.sections)if(Nt.image)Z[Nt.image.name]=!0;else{const St=Go(Ce.toString()),mt=Nt.fontStack||ct,it=q[mt]=q[mt]||{};this.calculateGlyphDependencies(Nt.text,it,bt,this.allowVerticalPlacement,St)}}}m.get("symbol-placement")==="line"&&(this.features=(function(J){const re={},xe={},oe=[];let ce=0;function Se(ct){oe.push(J[ct]),ce++}function Ce(ct,bt,Nt){const St=xe[ct];return delete xe[ct],xe[bt]=St,oe[St].geometry[0].pop(),oe[St].geometry[0]=oe[St].geometry[0].concat(Nt[0]),St}function Ye(ct,bt,Nt){const St=re[bt];return delete re[bt],re[ct]=St,oe[St].geometry[0].shift(),oe[St].geometry[0]=Nt[0].concat(oe[St].geometry[0]),St}function _t(ct,bt,Nt){const St=Nt?bt[0][bt[0].length-1]:bt[0][0];return`${ct}:${St.x}:${St.y}`}for(let ct=0;ct<J.length;ct++){const bt=J[ct],Nt=bt.geometry,St=bt.text?bt.text.toString():null;if(!St){Se(ct);continue}const mt=_t(St,Nt),it=_t(St,Nt,!0);if(mt in xe&&it in re&&xe[mt]!==re[it]){const Wt=Ye(mt,it,Nt),Gt=Ce(mt,it,oe[Wt].geometry);delete re[mt],delete xe[it],xe[_t(St,oe[Gt].geometry,!0)]=Gt,oe[Wt].geometry=null}else mt in xe?Ce(mt,it,Nt):it in re?Ye(mt,it,Nt):(Se(ct),re[mt]=ce-1,xe[it]=ce-1)}return oe.filter((ct=>ct.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((J,re)=>J.sortKey-re.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(i[e.segment+1]),m=e.dist(i[e.segment]);const g={};for(let w=e.segment+1;w<i.length;w++)g[w]={x:i[w].x,y:i[w].y,tileUnitDistanceFromAnchor:h},w<i.length-1&&(h+=i[w+1].dist(i[w]));for(let w=e.segment||0;w>=0;w--)g[w]={x:i[w].x,y:i[w].y,tileUnitDistanceFromAnchor:m},w>0&&(m+=i[w-1].dist(i[w]));for(let w=0;w<i.length;w++){const E=g[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,h,m,g,w,E,z,R,F,Z){const q=e.indexArray,Y=e.layoutVertexArray,W=e.segments.prepareSegment(4*i.length,Y,q,this.canOverlap?g.sortKey:void 0),J=this.glyphOffsetArray.length,re=W.vertexLength,xe=this.allowVerticalPlacement&&w===D.az.vertical?Math.PI/2:0,oe=g.text&&g.text.sections;for(let ce=0;ce<i.length;ce++){const{tl:Se,tr:Ce,bl:Ye,br:_t,tex:ct,pixelOffsetTL:bt,pixelOffsetBR:Nt,minFontScaleX:St,minFontScaleY:mt,glyphOffset:it,isSDF:Wt,sectionIndex:Gt}=i[ce],Qt=W.vertexLength,Vt=it[1];tf(Y,E.x,E.y,Se.x,Vt+Se.y,ct.x,ct.y,o,Wt,bt.x,bt.y,St,mt),tf(Y,E.x,E.y,Ce.x,Vt+Ce.y,ct.x+ct.w,ct.y,o,Wt,Nt.x,bt.y,St,mt),tf(Y,E.x,E.y,Ye.x,Vt+Ye.y,ct.x,ct.y+ct.h,o,Wt,bt.x,Nt.y,St,mt),tf(Y,E.x,E.y,_t.x,Vt+_t.y,ct.x+ct.w,ct.y+ct.h,o,Wt,Nt.x,Nt.y,St,mt),bm(e.dynamicLayoutVertexArray,E,xe),q.emplaceBack(Qt,Qt+2,Qt+1),q.emplaceBack(Qt+1,Qt+2,Qt+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(it[0]),ce!==i.length-1&&Gt===i[ce+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,g,g.index,{imagePositions:{},canonical:Z,formattedSection:oe&&oe[Gt]})}e.placedSymbolArray.emplaceBack(E.x,E.y,J,this.glyphOffsetArray.length-J,re,z,R,E.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],w,0,!1,0,F)}_addCollisionDebugVertex(e,i,o,h,m,g){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,h,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,i,o,h,m,g,w){const E=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),z=E.vertexLength,R=m.layoutVertexArray,F=m.collisionVertexArray,Z=w.anchorX,q=w.anchorY;this._addCollisionDebugVertex(R,F,g,Z,q,new V(e,i)),this._addCollisionDebugVertex(R,F,g,Z,q,new V(o,i)),this._addCollisionDebugVertex(R,F,g,Z,q,new V(o,h)),this._addCollisionDebugVertex(R,F,g,Z,q,new V(e,h)),E.vertexLength+=4;const Y=m.indexArray;Y.emplaceBack(z,z+1),Y.emplaceBack(z+1,z+2),Y.emplaceBack(z+2,z+3),Y.emplaceBack(z+3,z),E.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,h){for(let m=e;m<i;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,h?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fp(Xe,Hs.members,zt),this.iconCollisionBox=new fp(Xe,Hs.members,zt);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,h,m,g,w,E,z){const R={};for(let F=i;F<o;F++){const Z=e.get(F);R.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.textFeatureIndex=Z.featureIndex;break}for(let F=h;F<m;F++){const Z=e.get(F);R.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.verticalTextFeatureIndex=Z.featureIndex;break}for(let F=g;F<w;F++){const Z=e.get(F);R.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.iconFeatureIndex=Z.featureIndex;break}for(let F=E;F<z;F++){const Z=e.get(F);R.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.verticalIconFeatureIndex=Z.featureIndex;break}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),h=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+2,m+1),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),h=[],m=[],g=[];for(let w=0;w<this.symbolInstances.length;++w){g.push(w);const E=this.symbolInstances.get(w);h.push(0|Math.round(i*E.anchorX+o*E.anchorY)),m.push(E.featureIndex)}return g.sort(((w,E)=>h[w]-h[E]||m[E]-m[w])),g}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((h,m,g)=>{h>=0&&g.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let pp,mp;qt("SymbolBucket",ld,{omit:["layers","collisionBoxArray","features","compareText"]}),ld.MAX_GLYPHS=65535,ld.addDynamicAttributes=bm;var Tm={get paint(){return mp=mp||new gr({"icon-opacity":new ti($e.paint_symbol["icon-opacity"]),"icon-color":new ti($e.paint_symbol["icon-color"]),"icon-halo-color":new ti($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new ti($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ti($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Xt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xt($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new ti($e.paint_symbol["text-opacity"]),"text-color":new ti($e.paint_symbol["text-color"],{runtimeType:ma,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ti($e.paint_symbol["text-halo-color"]),"text-halo-width":new ti($e.paint_symbol["text-halo-width"]),"text-halo-blur":new ti($e.paint_symbol["text-halo-blur"]),"text-translate":new Xt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Xt($e.paint_symbol["text-translate-anchor"])})},get layout(){return pp=pp||new gr({"symbol-placement":new Xt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Xt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ti($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xt($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xt($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xt($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new ti($e.layout_symbol["icon-size"]),"icon-text-fit":new Xt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new ti($e.layout_symbol["icon-image"]),"icon-rotate":new ti($e.layout_symbol["icon-rotate"]),"icon-padding":new ti($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Xt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new ti($e.layout_symbol["icon-offset"]),"icon-anchor":new ti($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xt($e.layout_symbol["text-rotation-alignment"]),"text-field":new ti($e.layout_symbol["text-field"]),"text-font":new ti($e.layout_symbol["text-font"]),"text-size":new ti($e.layout_symbol["text-size"]),"text-max-width":new ti($e.layout_symbol["text-max-width"]),"text-line-height":new Xt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new ti($e.layout_symbol["text-letter-spacing"]),"text-justify":new ti($e.layout_symbol["text-justify"]),"text-radial-offset":new ti($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xt($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ti($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ti($e.layout_symbol["text-anchor"]),"text-max-angle":new Xt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Xt($e.layout_symbol["text-writing-mode"]),"text-rotate":new ti($e.layout_symbol["text-rotate"]),"text-padding":new Xt($e.layout_symbol["text-padding"]),"text-keep-upright":new Xt($e.layout_symbol["text-keep-upright"]),"text-transform":new ti($e.layout_symbol["text-transform"]),"text-offset":new ti($e.layout_symbol["text-offset"]),"text-allow-overlap":new Xt($e.layout_symbol["text-allow-overlap"]),"text-overlap":new Xt($e.layout_symbol["text-overlap"]),"text-ignore-placement":new Xt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Xt($e.layout_symbol["text-optional"])})}};class Vg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt("FormatSectionOverride",Vg,{omit:["defaultValue"]});class Su extends ir{constructor(e,i){super(e,Tm,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const m of o)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,h){const m=this.layout.get(e).evaluate(i,{},o,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Uo(g.value)||!m?m:(function(w,E){return E.replace(/{([^{}]+)}/g,((z,R)=>w&&R in w?String(w[R]):""))})(i.properties,m)}createBucket(e){return new ld(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Tm.paint.overridableProperties){if(!Su.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Vg(i),h=new Tc(o,i.property.specification);let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new v("source",h):new A("composite",h,i.value.zoomStops),this.paint._values[e]=new ys(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Su.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),h=Tm.paint.properties[i];let m=!1;const g=w=>{for(const E of w)if(h.overrides&&h.overrides.hasOverride(E))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof xr)g(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const w=z=>{m||(z instanceof xa&&Pi(z.value)===rs?g(z.value.sections):z instanceof _c?g(z.sections):z.eachChild(w))},E=o.value;E._styleExpression&&w(E._styleExpression.expression)}return m}}let Zg;var qg={get paint(){return Zg=Zg||new gr({"background-color":new Xt($e.paint_background["background-color"]),"background-pattern":new pu($e.paint_background["background-pattern"]),"background-opacity":new Xt($e.paint_background["background-opacity"])})}};class en extends ir{constructor(e,i){super(e,qg,i)}}class Sm extends ir{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class gp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Em={once:!0},_p=63710088e-1;class nc{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new nc(Kt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,h=e.lat*i,m=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return _p*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof nc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new nc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new nc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const cd=2*Math.PI*_p;function nf(n){return cd*Math.cos(n*Math.PI/180)}function Gg(n){return(180+n)/360}function Mm(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Hg(n,e){return n/nf(e)}function $g(n){return 360*n-180}function rf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Am(n,e){return n*nf(rf(e))}class bn{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=nc.convert(e);return new bn(Gg(o.lng),Mm(o.lat),Hg(i,o.lat))}toLngLat(){return new nc($g(this.x),rf(this.y))}toAltitude(){return Am(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/cd*(e=rf(this.y),1/Math.cos(e*Math.PI/180));var e}}function yp(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class da{constructor(e,i,o){if(!(function(h,m,g){return!(h<0||h>25||g<0||g>=Math.pow(2,h)||m<0||m>=Math.pow(2,h))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=ud(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const h=(function(g,w,E){var z=yp(256*g,256*(w=Math.pow(2,E)-w-1),E),R=yp(256*(g+1),256*(w+1),E);return z[0]+","+z[1]+","+R[0]+","+R[1]})(this.x,this.y,this.z),m=(function(g,w,E){let z,R="";for(let F=g;F>0;F--)z=1<<F-1,R+=(w&z?1:0)+(E&z?2:0);return R})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,m).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new V((e.x*i-this.x)*Et,(e.y*i-this.y)*Et)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xg{constructor(e,i){this.wrap=e,this.canonical=i,this.key=ud(e,i.z,i.z,i.x,i.y)}}class Xs{constructor(e,i,o,h,m){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new da(o,+h,+m),this.key=ud(i,e,o,h,m)}clone(){return new Xs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new Xs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?ud(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):ud(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Xs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new Xs(i,this.wrap,i,o,h),new Xs(i,this.wrap,i,o+1,h),new Xs(i,this.wrap,i,o,h+1),new Xs(i,this.wrap,i,o+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Xs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Xs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new bn(e.x-this.wrap,e.y))}}function ud(n,e,i,o,h){(n*=2)<0&&(n=-1*n-1);const m=1<<i;return(m*m*n+m*h+o).toString(36)+i.toString(36)+e.toString(36)}function af(n,e){return e?n.properties[e]:n.id}function Cm(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const h=n.addOrUpdateProperties.findIndex((m=>m.key===o));h>-1&&n.addOrUpdateProperties.splice(h,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function sf(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((h=>[h.id,h]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((h=>[h.id,h]))),o}qt("CanonicalTileID",da),qt("OverscaledTileID",Xs,{omit:["terrainRttPosMatrix32f"]});class Eu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new Eu;return i.extend(e(new V(this.minX,this.minY))),i.extend(e(new V(this.maxX,this.minY))),i.extend(e(new V(this.minX,this.maxY))),i.extend(e(new V(this.maxX,this.maxY))),i}static fromPoints(e){const i=new Eu;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Pm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class vp{constructor(e,i,o,h,m){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=h,this._z=i,this.properties=e.properties,this.id=m}projectPoint(e,i,o,h){return[360*(e.x+i)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/h)*Math.PI))-90]}projectLine(e,i,o,h){return e.map((m=>this.projectPoint(m,i,o,h)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,h=e.extent*this._y,m=e.loadGeometry();switch(e.type){case 1:{const g=[];for(const E of m)g.push(E[0]);const w=this.projectLine(g,o,h,i);this._geometry=g.length===1?{type:"Point",coordinates:w[0]}:{type:"MultiPoint",coordinates:w};break}case 2:{const g=m.map((w=>this.projectLine(w,o,h,i)));this._geometry=g.length===1?{type:"LineString",coordinates:g[0]}:{type:"MultiLineString",coordinates:g};break}case 3:{const g=Mg(m),w=[];for(const E of g)w.push(E.map((z=>this.projectLine(z,o,h,i))));this._geometry=w.length===1?{type:"Polygon",coordinates:w[0]}:{type:"MultiPolygon",coordinates:w};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class Mu{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class xp extends Mu{}class bp extends xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class zm extends xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Dm extends Mu{delta;constructor(e,i,o,h){super(e,i,h),this.delta=o}}class Im extends Dm{constructor(e,i,o,h){super(e,Int32Array.of(i),o,h)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Lm extends Mu{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Au{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,h,m=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=h,this._extent=m}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const h=e?.next().value,m={};for(const g of this.propertyVectors){if(!g)continue;const w=g.name,E=g.getValue(i);E!==null&&(m[w]=E)}i++,yield{id:o,geometry:h,properties:m}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const m={coordinates:i[o],type:this.geometryVector.geometryType(o)},g={};for(const w of this.propertyVectors){if(!w)continue;const E=w.name,z=w.getValue(o);z!==null&&(g[E]=z)}e.push({id:h,geometry:m,properties:g})}return e}containsMaxSaveIntegerValues(e){return e instanceof bp||e instanceof Lm&&e instanceof Im||e instanceof zm}}class Yg{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Oi,Il,Da,Ll,Cu,Qa,Dr,Qr,wo,Ts;function Jr(n,e,i){const o=new Int32Array(i);let h=0,m=e.get();for(let g=0;g<o.length;g++){let w=n[m++],E=127&w;w<128||(w=n[m++],E|=(127&w)<<7,w<128||(w=n[m++],E|=(127&w)<<14,w<128||(w=n[m++],E|=(127&w)<<21,w<128||(w=n[m++],E|=(15&w)<<28)))),o[h++]=E}return e.set(m),o}function of(n,e,i){const o=new BigInt64Array(i);for(let h=0;h<o.length;h++)o[h]=wp(n,e);return o}function Wg(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(h,m,g){let w,E;if(E=m[g.get()],g.increment(),w=(112&E)>>4,E<128||(E=m[g.get()],g.increment(),w|=(127&E)<<3,E<128)||(E=m[g.get()],g.increment(),w|=(127&E)<<10,E<128)||(E=m[g.get()],g.increment(),w|=(127&E)<<17,E<128)||(E=m[g.get()],g.increment(),w|=(127&E)<<24,E<128)||(E=m[g.get()],g.increment(),w|=(1&E)<<31,E<128))return 4294967296*w+(h>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function hd(n,e,i,o){throw new Error("FastPFor is not implemented yet.")}function Ia(n){return n>>>1^-(1&n)}function gh(n){return n>>1n^-(1n&n)}function wp(n,e){let i=0n,o=0,h=e.get();for(;h<n.length;){const m=n[h++];if(i|=BigInt(127&m)<<BigInt(o),!(128&m))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(h),i}function rc(n,e,i){const o=new Int32Array(i);let h=0;for(let m=0;m<e;m++){const g=n[m];o.fill(n[m+e],h,h+g),h+=g}return o}function Kg(n,e,i){const o=new BigInt64Array(i);let h=0;for(let m=0;m<e;m++){const g=Number(n[m]);o.fill(n[m+e],h,h+g),h+=g}return o}function Qg(n,e,i){const o=new Float64Array(i);let h=0;for(let m=0;m<e;m++){const g=n[m];o.fill(n[m+e],h,h+g),h+=g}return o}function Pu(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}function km(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=n[i],h=n[i+1],m=n[i+2],g=n[i+3];n[i]=(o>>>1^-(1&o))+n[i-2],n[i+1]=(h>>>1^-(1&h))+n[i-1],n[i+2]=(m>>>1^-(1&m))+n[i],n[i+3]=(g>>>1^-(1&g))+n[i+1]}for(;i!=n.length;i+=2)n[i]=(n[i]>>>1^-(1&n[i]))+n[i-2],n[i+1]=(n[i+1]>>>1^-(1&n[i+1]))+n[i-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(Oi||(Oi={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(Il||(Il={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(Da||(Da={}));class Rm{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ja(n,e){const i=(function(o,h){const m=o[h.get()],g=Object.values(Da)[m>>4];let w=null;switch(g){case Da.DATA:w=new Rm(Object.values(Ll)[15&m]);break;case Da.OFFSET:w=new Rm(null,Object.values(Cu)[15&m]);break;case Da.LENGTH:w=new Rm(null,null,Object.values(Qa)[15&m])}h.increment();const E=o[h.get()],z=Object.values(Oi)[E>>5],R=Object.values(Oi)[E>>2&7],F=Object.values(Il)[3&E];h.increment();const Z=Jr(o,h,2),q=Z[0];return{physicalStreamType:g,logicalStreamType:w,logicalLevelTechnique1:z,logicalLevelTechnique2:R,physicalLevelTechnique:F,numValues:q,byteLength:Z[1],decompressedCount:q}})(n,e);return i.logicalLevelTechnique1===Oi.MORTON?(function(o,h,m){const g=Jr(h,m,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:g[0],coordinateShift:g[1]}})(i,n,e):Oi.RLE!==i.logicalLevelTechnique1&&Oi.RLE!==i.logicalLevelTechnique2||Il.NONE===i.physicalLevelTechnique?i:(function(o,h,m){const g=Jr(h,m,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:g[1],runs:g[0],numRleValues:g[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(Ll||(Ll={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(Cu||(Cu={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(Qa||(Qa={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Dr||(Dr={}));class kl{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function es(n,e,i,o,h){return(function(m,g,w){switch(g.logicalLevelTechnique1){case Oi.DELTA:return g.logicalLevelTechnique2===Oi.RLE?(function(E,z,R){const F=new Int32Array(R);let Z=0,q=0;for(let Y=0;Y<z;Y++){const W=E[Y],J=Ia(E[Y+z]);for(let re=0;re<W;re++)q+=J,F[Z++]=q}return F})(m,g.runs,g.numRleValues):((function(E){E[0]=E[0]>>>1^-(1&E[0]);const z=E.length/4*4;let R=1;if(z>=4)for(;R<z-4;R+=4){const F=E[R],Z=E[R+1],q=E[R+2],Y=E[R+3];E[R]=(F>>>1^-(1&F))+E[R-1],E[R+1]=(Z>>>1^-(1&Z))+E[R],E[R+2]=(q>>>1^-(1&q))+E[R+1],E[R+3]=(Y>>>1^-(1&Y))+E[R+2]}for(;R!=E.length;++R)E[R]=(E[R]>>>1^-(1&E[R]))+E[R-1]})(m),m);case Oi.RLE:return(function(E,z,R){return R?(function(F,Z,q){const Y=new Int32Array(q);let W=0;for(let J=0;J<Z;J++){const re=F[J];let xe=F[J+Z];xe=xe>>>1^-(1&xe),Y.fill(xe,W,W+re),W+=re}return Y})(E,z.runs,z.numRleValues):rc(E,z.runs,z.numRleValues)})(m,g,w);case Oi.MORTON:return Pu(m),m;case Oi.COMPONENTWISE_DELTA:return km(m),m;case Oi.NONE:return w&&(function(E){for(let z=0;z<E.length;z++){const R=E[z];E[z]=R>>>1^-(1&R)}})(m),m;default:throw new Error(`The specified Logical level technique is not supported: ${g.logicalLevelTechnique1}`)}})(Tp(n,e,i),i,o)}function zu(n,e,i){return(function(o,h){if(h.logicalLevelTechnique1===Oi.DELTA&&h.logicalLevelTechnique2===Oi.NONE)return(function(g){const w=new Int32Array(g.length+1);w[0]=0,w[1]=Ia(g[0]);let E=w[1],z=2;for(;z!=w.length;++z){const R=g[z-1];E+=R>>>1^-(1&R),w[z]=w[z-1]+E}return w})(o);if(h.logicalLevelTechnique1===Oi.RLE&&h.logicalLevelTechnique2===Oi.NONE)return(function(g,w,E){const z=new Int32Array(E+1);z[0]=0;let R=1,F=z[0];for(let Z=0;Z<w;Z++){const q=g[Z],Y=g[Z+w];for(let W=R;W<R+q;W++)z[W]=Y+F,F=z[W];R+=q}return z})(o,h.runs,h.numRleValues);if(h.logicalLevelTechnique1===Oi.NONE&&h.logicalLevelTechnique2===Oi.NONE){(function(g){let w=0;for(let E=0;E<g.length;E++)g[E]+=w,w=g[E]})(o);const m=new Int32Array(h.numValues+1);return m[0]=0,m.set(o,1),m}if(h.logicalLevelTechnique1===Oi.DELTA&&h.logicalLevelTechnique2===Oi.RLE){const m=(function(g,w,E){const z=new Int32Array(E+1);z[0]=0;let R=1,F=z[0];for(let Z=0;Z<w;Z++){const q=g[Z];let Y=g[Z+w];Y=Y>>>1^-(1&Y);for(let W=R;W<R+q;W++)z[W]=Y+F,F=z[W];R+=q}return z})(o,h.runs,h.numRleValues);return Pu(m),m}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Tp(n,e,i),i)}function Tp(n,e,i){const o=i.physicalLevelTechnique;if(o===Il.FAST_PFOR)return hd();if(o===Il.VARINT)return Jr(n,e,i.numValues);if(o===Il.NONE){const h=e.get();e.add(i.byteLength);const m=n.subarray(h,e.get());return new Int32Array(m)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Om(n,e,i,o){const h=Tp(n,e,i);if(h.length===1){const m=h[0];return o?Ia(m):m}return o?(function(m){return Ia(m[1])})(h):(function(m){return m[1]})(h)}function Bm(n,e,i){return(function(o){if(o.length==2){const h=Ia(o[1]);return[h,h]}return[Ia(o[2]),Ia(o[3])]})(Tp(n,e,i))}function _h(n,e,i){return(function(o){if(o.length==2){const h=gh(o[1]);return[h,h]}return[gh(o[2]),gh(o[3])]})(of(n,e,i.numValues))}function dd(n,e,i,o){return(function(h,m,g){switch(m.logicalLevelTechnique1){case Oi.DELTA:return m.logicalLevelTechnique2===Oi.RLE?(function(w,E,z){const R=new BigInt64Array(z);let F=0,Z=0n;for(let q=0;q<E;q++){const Y=Number(w[q]),W=gh(w[q+E]);for(let J=0;J<Y;J++)Z+=W,R[F++]=Z}return R})(h,m.runs,m.numRleValues):((function(w){w[0]=w[0]>>1n^-(1n&w[0]);const E=w.length/4*4;let z=1;if(E>=4)for(;z<E-4;z+=4){const R=w[z],F=w[z+1],Z=w[z+2],q=w[z+3];w[z]=(R>>1n^-(1n&R))+w[z-1],w[z+1]=(F>>1n^-(1n&F))+w[z],w[z+2]=(Z>>1n^-(1n&Z))+w[z+1],w[z+3]=(q>>1n^-(1n&q))+w[z+2]}for(;z!=w.length;++z)w[z]=(w[z]>>1n^-(1n&w[z]))+w[z-1]})(h),h);case Oi.RLE:return(function(w,E,z){return z?(function(R,F,Z){const q=new BigInt64Array(Z);let Y=0;for(let W=0;W<F;W++){const J=Number(R[W]);let re=R[W+F];re=re>>1n^-(1n&re),q.fill(re,Y,Y+J),Y+=J}return q})(w,E.runs,E.numRleValues):Kg(w,E.runs,E.numRleValues)})(h,m,g);case Oi.NONE:return g&&(function(w){for(let E=0;E<w.length;E++){const z=w[E];w[E]=z>>1n^-(1n&z)}})(h),h;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}})(of(n,e,i.numValues),i,o)}function Nm(n,e,i,o){const h=of(n,e,i.numValues);if(h.length===1){const m=h[0];return o?gh(m):m}return o?(function(m){return gh(m[1])})(h):(function(m){return m[1]})(h)}function Fm(n,e,i,o,h){return(function(m,g,w,E){switch(g.logicalLevelTechnique1){case Oi.DELTA:return g.logicalLevelTechnique2===Oi.RLE&&(m=rc(m,g.runs,g.numRleValues)),(function(z,R){const F=new Int32Array(z.size());let Z=0;z.get(0)?(F[0]=z.get(0)?R[0]>>>1^-(1&R[0]):0,Z=1):F[0]=0;let q=1;for(;q!=F.length;++q)F[q]=z.get(q)?F[q-1]+(R[Z]>>>1^-(1&R[Z++])):F[q-1];return F})(E,m);case Oi.RLE:return(function(z,R,F,Z){const q=R;return F?(function(Y,W,J){const re=new Int32Array(Y.size());let xe=0;for(let oe=0;oe<J;oe++){const ce=W[oe];let Se=W[oe+J];Se=Se>>>1^-(1&Se);for(let Ce=xe;Ce<xe+ce;Ce++)Y.get(Ce)?re[Ce]=Se:(re[Ce]=0,xe++);xe+=ce}return re})(Z,z,q.runs):(function(Y,W,J){const re=new Int32Array(Y.size());let xe=0;for(let oe=0;oe<J;oe++){const ce=W[oe],Se=W[oe+J];for(let Ce=xe;Ce<xe+ce;Ce++)Y.get(Ce)?re[Ce]=Se:(re[Ce]=0,xe++);xe+=ce}return re})(Z,z,q.runs)})(m,g,w,E);case Oi.MORTON:return Pu(m),m;case Oi.COMPONENTWISE_DELTA:return km(m),m;case Oi.NONE:return m=w?(function(z,R){const F=new Int32Array(z.size());let Z=0,q=0;for(;q!=F.length;++q)if(z.get(q)){const Y=R[Z++];F[q]=Y>>>1^-(1&Y)}else F[q]=0;return F})(E,m):(function(z,R){const F=new Int32Array(z.size());let Z=0,q=0;for(;q!=F.length;++q)F[q]=z.get(q)?R[Z++]:0;return F})(E,m),m;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===Il.FAST_PFOR?hd():Jr(n,e,i.numValues),i,o,h)}function Zc(n,e,i,o){const h=n.logicalLevelTechnique1;if(h===Oi.RLE)return n.runs===1?Dr.CONST:Dr.FLAT;const m=e instanceof kl?e.size():e;if(h===Oi.DELTA&&n.logicalLevelTechnique2===Oi.RLE){const g=n.runs,w=2;if(n.numRleValues!==m)return Dr.FLAT;if(g===1)return Dr.SEQUENCE;if(g===2){const E=o.get();let z;if(n.physicalLevelTechnique===Il.VARINT)z=Jr(i,o,4);else{const R=o.get();z=new Int32Array(i.buffer,i.byteOffset+R,4)}if(o.set(E),z[2]===w&&z[3]===w)return Dr.SEQUENCE}}return n.numValues===1?Dr.CONST:Dr.FLAT}class fd extends xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class jm extends Dm{constructor(e,i,o,h){super(e,BigInt64Array.of(i),o,h)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class qc{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function lf(n,e,i){return{x:Sp(n,e)-i,y:Sp(n>>1,e)-i}}function Sp(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(Qr||(Qr={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(wo||(wo={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(Ts||(Ts={}));class Ep{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function Um(n){const e=new Array(n.numGeometries);let i=1,o=1,h=1,m=0;const g=new Ep;let w=0,E=0;const z=n.mortonSettings,R=n.topologyVector,F=R.geometryOffsets,Z=R.partOffsets,q=R.ringOffsets,Y=n.vertexOffsets,W=n.containsPolygonGeometry(),J=n.vertexBuffer;for(let re=0;re<n.numGeometries;re++){const xe=n.geometryType(re);if(xe===Qr.POINT){if(Y&&Y.length!==0)if(n.vertexBufferType===Ts.VEC_2){const oe=2*Y[E++],ce=new V(J[oe],J[oe+1]);e[m++]=g.createPoint(ce)}else{const oe=lf(J[Y[E++]],z.numBits,z.coordinateShift),ce=new V(oe.x,oe.y);e[m++]=g.createPoint(ce)}else{const oe=new V(J[w++],J[w++]);e[m++]=g.createPoint(oe)}F&&h++,Z&&i++,q&&o++}else if(xe===Qr.MULTIPOINT){const oe=F[h]-F[h-1];h++;const ce=new Array(oe);if(Y&&Y.length!==0){for(let Se=0;Se<oe;Se++){const Ce=2*Y[E++];ce[Se]=new V(J[Ce],J[Ce+1])}e[m++]=g.createMultiPoint(ce)}else{for(let Se=0;Se<oe;Se++){const Ce=J[w++],Ye=J[w++];ce[Se]=new V(Ce,Ye)}e[m++]=g.createMultiPoint(ce)}}else if(xe===Qr.LINESTRING){let oe,ce=0;W?(ce=q[o]-q[o-1],o++):ce=Z[i]-Z[i-1],i++,Y&&Y.length!==0?(oe=n.vertexBufferType===Ts.VEC_2?hf(J,Y,E,ce,!1):Zm(J,Y,E,ce,!1,z),E+=ce):(oe=Vm(J,w,ce,!1),w+=2*ce),e[m++]=g.createLineString(oe),F&&h++}else if(xe===Qr.POLYGON){const oe=Z[i]-Z[i-1];i++;const ce=new Array(oe-1);let Se=q[o]-q[o-1];if(o++,Y&&Y.length!==0){const Ce=n.vertexBufferType===Ts.VEC_2?Mp(J,Y,E,Se):uf(J,Y,E,Se,0,z);E+=Se;for(let Ye=0;Ye<ce.length;Ye++)Se=q[o]-q[o-1],o++,ce[Ye]=n.vertexBufferType===Ts.VEC_2?Mp(J,Y,E,Se):uf(J,Y,E,Se,0,z),E+=Se;e[m++]=g.createPolygon(Ce,ce)}else{const Ce=cf(J,w,Se);w+=2*Se;for(let Ye=0;Ye<ce.length;Ye++)Se=q[o]-q[o-1],o++,ce[Ye]=cf(J,w,Se),w+=2*Se;e[m++]=g.createPolygon(Ce,ce)}F&&h++}else if(xe===Qr.MULTILINESTRING){const oe=F[h]-F[h-1];h++;const ce=new Array(oe);if(Y&&Y.length!==0){for(let Se=0;Se<oe;Se++){let Ce=0;W?(Ce=q[o]-q[o-1],o++):Ce=Z[i]-Z[i-1],i++;const Ye=n.vertexBufferType===Ts.VEC_2?hf(J,Y,E,Ce,!1):Zm(J,Y,E,Ce,!1,z);ce[Se]=Ye,E+=Ce}e[m++]=g.createMultiLineString(ce)}else{for(let Se=0;Se<oe;Se++){let Ce=0;W?(Ce=q[o]-q[o-1],o++):Ce=Z[i]-Z[i-1],i++,ce[Se]=Vm(J,w,Ce,!1),w+=2*Ce}e[m++]=g.createMultiLineString(ce)}}else{if(xe!==Qr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const oe=F[h]-F[h-1];h++;const ce=new Array(oe);let Se=0;if(Y&&Y.length!==0){for(let Ce=0;Ce<oe;Ce++){const Ye=Z[i]-Z[i-1];i++;const _t=new Array(Ye-1);Se=q[o]-q[o-1],o++;const ct=n.vertexBufferType===Ts.VEC_2?Mp(J,Y,E,Se):uf(J,Y,E,Se,0,z);E+=Se;for(let bt=0;bt<_t.length;bt++)Se=q[o]-q[o-1],o++,_t[bt]=n.vertexBufferType===Ts.VEC_2?Mp(J,Y,E,Se):uf(J,Y,E,Se,0,z),E+=Se;ce[Ce]=g.createPolygon(ct,_t)}e[m++]=g.createMultiPolygon(ce)}else{for(let Ce=0;Ce<oe;Ce++){const Ye=Z[i]-Z[i-1];i++;const _t=new Array(Ye-1);Se=q[o]-q[o-1],o++;const ct=cf(J,w,Se);w+=2*Se;for(let bt=0;bt<_t.length;bt++){const Nt=q[o]-q[o-1];o++,_t[bt]=cf(J,w,Nt),w+=2*Nt}ce[Ce]=g.createPolygon(ct,_t)}e[m++]=g.createMultiPolygon(ce)}}}}return e}function cf(n,e,i){return Vm(n,e,i,!0)}function Mp(n,e,i,o){return hf(n,e,i,o,!0)}function uf(n,e,i,o,h,m){return Zm(n,e,i,o,!0,m)}function Vm(n,e,i,o){const h=new Array(o?i+1:i);for(let m=0;m<2*i;m+=2)h[m/2]=new V(n[e+m],n[e+m+1]);return o&&(h[h.length-1]=h[0]),h}function hf(n,e,i,o,h){const m=new Array(h?o+1:o);for(let g=0;g<2*o;g+=2){const w=2*e[i+g/2];m[g/2]=new V(n[w],n[w+1])}return h&&(m[m.length-1]=m[0]),m}function Zm(n,e,i,o,h,m){const g=new Array(h?o+1:o);for(let w=0;w<o;w++){const E=lf(n[e[i+w]],m.numBits,m.coordinateShift);g[w]=new V(E.x,E.y)}return h&&(g[g.length-1]=g[0]),g}class df{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,h,m){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=h,this._mortonSettings=m}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Um(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=lf(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return Um(this)}get mortonSettings(){return this._mortonSettings}}class ff extends df{_numGeometries;_geometryType;constructor(e,i,o,h,m,g,w){super(o,h,m,g,w),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Qr.POLYGON||this._geometryType===Qr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class pf extends df{_geometryTypes;constructor(e,i,o,h,m,g){super(e,o,h,m,g),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Qr.POLYGON||this.geometryType(e)===Qr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Jg{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,h){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=h}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,h=i.ringOffsets,m=i.geometryOffsets;let g=0,w=1,E=1,z=1;for(let R=0;R<this.numGeometries;R++)switch(this.geometryType(R)){case Qr.POLYGON:{const F=o[w]-o[w-1];w++;const Z=[];for(let q=0;q<F;q++){const Y=h[E]-h[E-1];E++;const W=[];for(let J=0;J<Y;J++){const re=this._vertexBuffer[g++],xe=this._vertexBuffer[g++];W.push(new V(re,xe))}W.length>0&&W.push(W[0]),Z.push(W)}e[R]=Z,m&&z++}break;case Qr.MULTIPOLYGON:{const F=m[z]-m[z-1];z++;const Z=[];for(let q=0;q<F;q++){const Y=o[w]-o[w-1];w++;for(let W=0;W<Y;W++){const J=h[E]-h[E-1];E++;const re=[];for(let xe=0;xe<J;xe++){const oe=this._vertexBuffer[g++],ce=this._vertexBuffer[g++];re.push(new V(oe,ce))}re.length>0&&re.push(re[0]),Z.push(re)}}e[R]=Z}}return e}[Symbol.iterator](){return null}}function pd(n,e,i,o,h,m){return new J_(n,e,i,o,h,m)}class J_ extends Jg{_numGeometries;_geometryType;constructor(e,i,o,h,m,g){super(o,h,m,g),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function qm(n,e,i,o,h){return new e_(n,e,i,o,h)}class e_ extends Jg{_geometryTypes;constructor(e,i,o,h,m){super(i,o,h,m),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function t_(n,e,i,o,h){const m=Ja(n,i);let g=null,w=null,E=null,z=null,R=null,F=null,Z=null,q=null;if(Zc(m,o,n,i)===Dr.CONST){const W=Om(n,i,m,!1);for(let J=0;J<e-1;J++){const re=Ja(n,i);switch(re.physicalStreamType){case Da.LENGTH:switch(re.logicalStreamType.lengthType){case Qa.GEOMETRIES:g=zu(n,i,re);break;case Qa.PARTS:w=zu(n,i,re);break;case Qa.RINGS:E=zu(n,i,re);break;case Qa.TRIANGLES:Z=zu(n,i,re)}break;case Da.OFFSET:switch(re.logicalStreamType.offsetType){case Cu.VERTEX:z=es(n,i,re,!1);break;case Cu.INDEX:q=es(n,i,re,!1)}break;case Da.DATA:Ll.VERTEX===re.logicalStreamType.dictionaryType?R=es(n,i,re,!0):(F={numBits:re.numBits,coordinateShift:re.coordinateShift},R=es(n,i,re,!1))}}return q!==null?g!=null||w!=null?pd(o,W,Z,q,R,new qc(g,w,E)):pd(o,W,Z,q,R):F===null?(function(J,re,xe,oe,ce){return new ff(J,re,Ts.VEC_2,xe,oe,ce)})(o,W,new qc(g,w,E),z,R):(function(J,re,xe,oe,ce,Se){return new ff(J,re,Ts.MORTON,xe,oe,ce,Se)})(o,W,new qc(g,w,E),z,R,F)}const Y=es(n,i,m,!1);for(let W=0;W<e-1;W++){const J=Ja(n,i);switch(J.physicalStreamType){case Da.LENGTH:switch(J.logicalStreamType.lengthType){case Qa.GEOMETRIES:g=es(n,i,J,!1);break;case Qa.PARTS:w=es(n,i,J,!1);break;case Qa.RINGS:E=es(n,i,J,!1);break;case Qa.TRIANGLES:Z=zu(n,i,J)}break;case Da.OFFSET:switch(J.logicalStreamType.offsetType){case Cu.VERTEX:z=es(n,i,J,!1);break;case Cu.INDEX:q=es(n,i,J,!1)}break;case Da.DATA:Ll.VERTEX===J.logicalStreamType.dictionaryType?R=es(n,i,J,!0):(F={numBits:J.numBits,coordinateShift:J.coordinateShift},R=es(n,i,J,!1))}}return q!==null&&w===null?qm(Y,Z,q,R):(g!==null?(g=Ap(Y,g,2),w!==null&&E!==null?(w=Cp(Y,g,w,!1),E=(function(W,J,re,xe){const oe=new Int32Array(re[re.length-1]+1);let ce=0;oe[0]=ce;let Se=1,Ce=1,Ye=0;for(let _t=0;_t<W.length;_t++){const ct=W[_t],bt=J[_t+1]-J[_t];if(ct!==0&&ct!==3)for(let Nt=0;Nt<bt;Nt++){const St=re[Se]-re[Se-1];Se++;for(let mt=0;mt<St;mt++)ce=oe[Ce++]=ce+xe[Ye++]}else for(let Nt=0;Nt<bt;Nt++)oe[Ce++]=++ce,Se++}return oe})(Y,g,w,E)):w!==null&&(w=(function(W,J,re){const xe=new Int32Array(J[J.length-1]+1);let oe=0;xe[0]=oe;let ce=1,Se=0;for(let Ce=0;Ce<W.length;Ce++){const Ye=W[Ce],_t=J[Ce+1]-J[Ce];if(Ye===4||Ye===1)for(let ct=0;ct<_t;ct++)oe=xe[ce++]=oe+re[Se++];else for(let ct=0;ct<_t;ct++)xe[ce++]=++oe}return xe})(Y,g,w))):w!==null&&E!==null?(w=Ap(Y,w,1),E=Cp(Y,w,E,!0)):w!==null&&(w=Ap(Y,w,0)),q!==null?qm(Y,Z,q,R,new qc(g,w,E)):F===null?(function(W,J,re,xe){return new pf(Ts.VEC_2,W,J,re,xe)})(Y,new qc(g,w,E),z,R):(function(W,J,re,xe,oe){return new pf(Ts.MORTON,W,J,re,xe,oe)})(Y,new qc(g,w,E),z,R,F))}function Ap(n,e,i){const o=new Int32Array(n.length+1);let h=0;o[0]=h;let m=0;for(let g=0;g<n.length;g++)h=o[g+1]=h+(n[g]>i?e[m++]:1);return o}function Cp(n,e,i,o){const h=new Int32Array(e[e.length-1]+1);let m=0;h[0]=m;let g=1,w=0;for(let E=0;E<n.length;E++){const z=n[E],R=e[E+1]-e[E];if(z===5||z===2||o&&(z===4||z===1))for(let F=0;F<R;F++)m=h[g++]=m+i[w++];else for(let F=0;F<R;F++)h[g++]=++m}return h}class i_ extends Mu{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class n_ extends xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class mf extends Mu{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function gf(n,e,i){return r_(n,Math.ceil(e/8),i)}function r_(n,e,i){const o=new Uint8Array(e);let h=0;for(;h<e;){const m=n[i.increment()];if(m<=127){const g=m+3,w=n[i.increment()],E=h+g;o.fill(w,h,E),h=E}else{const g=256-m;for(let w=0;w<g;w++)o[h++]=n[i.increment()]}}return o}const Gm=new TextDecoder;function _f(n,e,i){return i-e>=12?Gm.decode(n.subarray(e,i)):(function(o,h,m){let g="",w=h;for(;w<m;){const E=o[w];let z,R,F,Z=null,q=E>239?4:E>223?3:E>191?2:1;if(w+q>m)break;q===1?E<128&&(Z=E):q===2?(z=o[w+1],(192&z)==128&&(Z=(31&E)<<6|63&z,Z<=127&&(Z=null))):q===3?(z=o[w+1],R=o[w+2],(192&z)==128&&(192&R)==128&&(Z=(15&E)<<12|(63&z)<<6|63&R,(Z<=2047||Z>=55296&&Z<=57343)&&(Z=null))):q===4&&(z=o[w+1],R=o[w+2],F=o[w+3],(192&z)==128&&(192&R)==128&&(192&F)==128&&(Z=(15&E)<<18|(63&z)<<12|(63&R)<<6|63&F,(Z<=65535||Z>=1114112)&&(Z=null))),Z===null?(Z=65533,q=1):Z>65535&&(Z-=65536,g+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),g+=String.fromCharCode(Z),w+=q}return g})(n,e,i)}class md extends Mu{offsetBuffer;constructor(e,i,o,h){super(e,o,h),this.offsetBuffer=i}}class Pp extends md{textEncoder;constructor(e,i,o,h){super(e,i,o,h??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return _f(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class yh extends md{indexBuffer;textEncoder;constructor(e,i,o,h,m){super(e,o,h,m??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return _f(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class zp extends md{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,h,m,g,w){super(e,o,h,w),this.indexBuffer=i,this.symbolOffsetBuffer=m,this.symbolTableBuffer=g,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,h,m){const g=[],w=new Array(h.length).fill(0);for(let E=1;E<h.length;E++)w[E]=w[E-1]+h[E-1];for(let E=0;E<m.length;E++)if(m[E]===255)g.push(m[++E]);else{const z=h[m[E]],R=w[m[E]];for(let F=0;F<z;F++)g.push(o[R+F])}return new Uint8Array(g)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return _f(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let h=1;h<e.length;h++){const m=e[h];i[h-1]=m-o,o=m}return i}}function Du(n,e,i,o,h,m){return i.type==="scalarType"?(function(g,w,E,z,R,F){let Z=null,q=0;if(g===0)return null;if(F.nullable){const W=Ja(w,E);q=W.numValues;const J=E.get(),re=gf(w,q,E);E.set(J+W.byteLength),Z=new kl(re,W.numValues)}const Y=Z??z;switch(R.physicalType){case 4:case 3:return(function(W,J,re,xe,oe){const ce=Ja(W,J),Se=Zc(ce,oe,W,J),Ce=xe.physicalType===3;if(Se===Dr.FLAT){const Ye=el(oe)?Fm(W,J,ce,Ce,oe):es(W,J,ce,Ce);return new bp(re.name,Ye,oe)}if(Se===Dr.SEQUENCE){const Ye=Bm(W,J,ce);return new Im(re.name,Ye[0],Ye[1],ce.numRleValues)}{const Ye=Om(W,J,ce,Ce);return new Lm(re.name,Ye,oe)}})(w,E,F,R,Y);case 9:return(function(W,J,re,xe,oe){let ce=null,Se=null,Ce=null,Ye=null,_t=null,ct=null,bt=null,Nt=null;for(let St=0;St<xe;St++){const mt=Ja(J,re);if(mt.byteLength!==0)switch(mt.physicalStreamType){case Da.PRESENT:{const it=gf(J,mt.numValues,re);ct=new kl(it,mt.numValues);break}case Da.OFFSET:Se=oe!=null||ct!=null?Fm(J,re,mt,!1,oe??ct):es(J,re,mt,!1);break;case Da.LENGTH:{const it=zu(J,re,mt);Qa.DICTIONARY===mt.logicalStreamType.lengthType?ce=it:Qa.SYMBOL===mt.logicalStreamType.lengthType?Ye=it:bt=it;break}case Da.DATA:{const it=J.subarray(re.get(),re.get()+mt.byteLength);re.add(mt.byteLength);const Wt=mt.logicalStreamType.dictionaryType;Ll.FSST===Wt?_t=it:Ll.SINGLE===Wt||Ll.SHARED===Wt?Ce=it:Ll.NONE===Wt&&(Nt=it);break}}}return(function(St,mt,it,Wt,Gt,Qt,Vt){return mt?new zp(St,it,Wt,Gt,Qt,mt,Vt):null})(W,_t,Se,ce,Ce,Ye,oe??ct)??(function(St,mt,it,Wt,Gt){return mt?Gt?new yh(St,it,Wt,mt,Gt):new yh(St,it,Wt,mt):null})(W,Ce,Se,ce,oe??ct)??(function(St,mt,it,Wt,Gt){if(!mt||!it)return null;if(Wt)return Gt?new yh(St,Wt,mt,it,Gt):new yh(St,Wt,mt,it);if(Gt&&Gt.size()!==mt.length-1){const Qt=new Int32Array(Gt.size());let Vt=0;for(let ai=0;ai<Gt.size();ai++)Qt[ai]=Gt.get(ai)?Vt++:0;return new yh(St,Qt,mt,it,Gt)}return Gt?new Pp(St,mt,it,Gt):new Pp(St,mt,it)})(W,bt,Nt,Se,oe??ct)})(F.name,w,E,F.nullable?g-1:g,Z);case 0:return(function(W,J,re,xe,oe){const ce=Ja(W,J),Se=ce.numValues,Ce=J.get(),Ye=el(oe)?(function(ct,bt,Nt,St){const mt=r_(ct,Math.ceil(bt/8),Nt),it=new kl(mt,bt),Wt=St.size(),Gt=new kl(new Uint8Array(Wt),Wt);let Qt=0;for(let Vt=0;Vt<St.size();Vt++){const ai=!!St.get(Vt)&&it.get(Qt++);Gt.set(Vt,ai)}return Gt.getBuffer()})(W,Se,J,oe):gf(W,Se,J);J.set(Ce+ce.byteLength);const _t=new kl(Ye,Se);return new i_(re.name,_t,oe)})(w,E,F,0,Y);case 6:case 5:return(function(W,J,re,xe,oe){const ce=Ja(W,J),Se=Zc(ce,xe,W,J),Ce=oe.physicalType===5;if(Se===Dr.FLAT){const Ye=el(xe)?(function(_t,ct,bt,Nt,St){return(function(mt,it,Wt,Gt){switch(it.logicalLevelTechnique1){case Oi.DELTA:return it.logicalLevelTechnique2===Oi.RLE&&(mt=Kg(mt,it.runs,it.numRleValues)),(function(Qt,Vt){const ai=new BigInt64Array(Qt.size());let an=0;Qt.get(0)?(ai[0]=Qt.get(0)?Vt[0]>>1n^-(1n&Vt[0]):0n,an=1):ai[0]=0n;let Ui=1;for(;Ui!=ai.length;++Ui)ai[Ui]=Qt.get(Ui)?ai[Ui-1]+(Vt[an]>>1n^-(1n&Vt[an++])):ai[Ui-1];return ai})(Gt,mt);case Oi.RLE:return(function(Qt,Vt,ai,an){const Ui=Vt;return ai?(function(fr,ts,ea){const pr=new BigInt64Array(fr.size());let rr=0;for(let Tn=0;Tn<ea;Tn++){const Er=Number(ts[Tn]);let Ir=ts[Tn+ea];Ir=Ir>>1n^-(1n&Ir);for(let Qn=rr;Qn<rr+Er;Qn++)fr.get(Qn)?pr[Qn]=Ir:(pr[Qn]=0n,rr++);rr+=Er}return pr})(an,Qt,Ui.runs):(function(fr,ts,ea){const pr=new BigInt64Array(fr.size());let rr=0;for(let Tn=0;Tn<ea;Tn++){const Er=Number(ts[Tn]),Ir=ts[Tn+ea];for(let Qn=rr;Qn<rr+Er;Qn++)fr.get(Qn)?pr[Qn]=Ir:(pr[Qn]=0n,rr++);rr+=Er}return pr})(an,Qt,Ui.runs)})(mt,it,Wt,Gt);case Oi.NONE:return mt=Wt?(function(Qt,Vt){const ai=new BigInt64Array(Qt.size());let an=0,Ui=0;for(;Ui!=ai.length;++Ui)if(Qt.get(Ui)){const fr=Vt[an++];ai[Ui]=fr>>1n^-(1n&fr)}else ai[Ui]=0n;return ai})(Gt,mt):(function(Qt,Vt){const ai=new BigInt64Array(Qt.size());let an=0,Ui=0;for(;Ui!=ai.length;++Ui)ai[Ui]=Qt.get(Ui)?Vt[an++]:0n;return ai})(Gt,mt),mt;default:throw new Error("The specified Logical level technique is not supported")}})(of(_t,ct,bt.numValues),bt,Nt,St)})(W,J,ce,Ce,xe):dd(W,J,ce,Ce);return new fd(re.name,Ye,xe)}if(Se===Dr.SEQUENCE){const Ye=_h(W,J,ce);return new jm(re.name,Ye[0],Ye[1],ce.numRleValues)}{const Ye=Nm(W,J,ce,Ce);return new mf(re.name,Ye,xe)}})(w,E,F,Y,R);case 7:return(function(W,J,re,xe){const oe=Ja(W,J),ce=el(xe)?(function(Se,Ce,Ye,_t){const ct=Ce.get(),bt=ct+_t*Float32Array.BYTES_PER_ELEMENT,Nt=new Uint8Array(Se.subarray(ct,bt)).buffer,St=new Float32Array(Nt);Ce.set(bt);const mt=Ye.size(),it=new Float32Array(mt);let Wt=0;for(let Gt=0;Gt<mt;Gt++)it[Gt]=Ye.get(Gt)?St[Wt++]:0;return it})(W,J,xe,oe.numValues):(function(Se,Ce,Ye){const _t=Ce.get(),ct=_t+Ye*Float32Array.BYTES_PER_ELEMENT,bt=new Uint8Array(Se.subarray(_t,ct)).buffer,Nt=new Float32Array(bt);return Ce.set(ct),Nt})(W,J,oe.numValues);return new n_(re.name,ce,xe)})(w,E,F,Y);case 8:return(function(W,J,re,xe){const oe=Ja(W,J),ce=el(xe)?(function(Se,Ce,Ye,_t){const ct=Ce.get(),bt=ct+_t*Float64Array.BYTES_PER_ELEMENT,Nt=new Uint8Array(Se.subarray(ct,bt)).buffer,St=new Float64Array(Nt);Ce.set(bt);const mt=Ye.size(),it=new Float64Array(mt);let Wt=0;for(let Gt=0;Gt<mt;Gt++)it[Gt]=Ye.get(Gt)?St[Wt++]:0;return it})(W,J,xe,oe.numValues):(function(Se,Ce,Ye){const _t=Ce.get(),ct=_t+Ye*Float64Array.BYTES_PER_ELEMENT,bt=new Uint8Array(Se.subarray(_t,ct)).buffer,Nt=new Float64Array(bt);return Ce.set(ct),Nt})(W,J,oe.numValues);return new zm(re.name,ce,xe)})(w,E,F,Y);default:throw new Error(`The specified data type for the field is currently not supported: ${R}`)}})(o,n,e,h,i.scalarType,i):o!=1?null:(function(g,w,E,z){let R=null,F=null,Z=null,q=null,Y=!1;for(;!Y;){const xe=Ja(g,w);switch(xe.physicalStreamType){case Da.LENGTH:Qa.DICTIONARY===xe.logicalStreamType.lengthType?R=zu(g,w,xe):Z=zu(g,w,xe);break;case Da.DATA:Ll.SINGLE===xe.logicalStreamType.dictionaryType||Ll.SHARED===xe.logicalStreamType.dictionaryType?(F=g.subarray(w.get(),w.get()+xe.byteLength),Y=!0):q=g.subarray(w.get(),w.get()+xe.byteLength),w.add(xe.byteLength)}}const W=E.complexType.children,J=[];let re=0;for(const xe of W){const oe=Jr(g,w,1)[0];if(oe==0)continue;const ce=`${E.name}${xe.name==="default"?"":":"+xe.name}`;if(oe!==2||xe.type!=="scalarField"||xe.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Se=Ja(g,w),Ce=gf(g,Se.numValues,w),Ye=Ja(g,w),_t=Ye.decompressedCount!==z?Fm(g,w,Ye,!1,new kl(Ce,Se.numValues)):es(g,w,Ye,!1);J[re++]=q?new zp(ce,_t,R,F,Z,q,new kl(Ce,Se.numValues)):new yh(ce,_t,R,F,new kl(Ce,Se.numValues))}return J})(n,e,i,h)}function el(n){return n instanceof kl}function Iu(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const yf=new TextDecoder;function gd(n,e){const i=Jr(n,e,1)[0];if(i===0)return"";const o=e.get(),h=n.subarray(o,o+i);return e.add(i),yf.decode(h)}function Gc(n,e){const i=Jr(n,e,1)[0]>>>0,o=!!(4&i),h=!!(2&i),m=Jr(n,e,1)[0]>>>0,g={};if(1&i&&(g.nullable=!0),h){const w={};if(o?(w.type="logicalType",w.logicalType=m):(w.type="physicalType",w.physicalType=m),8&i){const E=Jr(n,e,1)[0]>>>0;w.children=new Array(E);for(let z=0;z<E;z++)w.children[z]=Gc(n,e)}g.type="complexField",g.complexField=w}else{const w={};o?(w.type="logicalType",w.logicalType=m):(w.type="physicalType",w.physicalType=m),g.type="scalarField",g.scalarField=w}return g}function ey(n,e){const i=Jr(n,e,1)[0]>>>0,o=(function(h){switch(h){case 0:case 1:case 2:case 3:{const m={};m.nullable=!!(1&h),m.columnScope=0;const g={};return g.physicalType=h>1?6:4,g.type="physicalType",m.scalarType=g,m.type="scalarType",m}case 4:{const m={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:0};return m.type="complexType",m.complexType=g,m}case 30:{const m={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:1};return m.type="complexType",m.complexType=g,m}default:return(function(m){let g=null;switch(m){case 10:case 11:g=0;break;case 12:case 13:g=1;break;case 14:case 15:g=2;break;case 16:case 17:g=3;break;case 18:case 19:g=4;break;case 20:case 21:g=5;break;case 22:case 23:g=6;break;case 24:case 25:g=7;break;case 26:case 27:g=8;break;case 28:case 29:g=9;break;default:return null}const w={};w.nullable=!!(1&m),w.columnScope=0;const E={type:"physicalType"};return E.physicalType=g,w.type="scalarType",w.scalarType=E,w})(h)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(h){return h>=10})(i)?o.name=gd(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(h){return h===30})(i)){const h=Jr(n,e,1)[0]>>>0,m=o.complexType;m.children=new Array(h);for(let g=0;g<h;g++)m.children[g]=Gc(n,e)}return o}function a_(n,e){const i={featureTables:[]},o={};o.name=gd(n,e);const h=Jr(n,e,1)[0]>>>0,m=Jr(n,e,1)[0]>>>0;o.columns=new Array(m);for(let g=0;g<m;g++)o.columns[g]=ey(n,e);return i.featureTables.push(o),[i,h]}function vf(n,e,i,o,h,m,g=!1){const w=e.scalarType.physicalType,E=Zc(h,m,n,i);if(w===4)switch(E){case Dr.FLAT:{const z=es(n,i,h,!1);return new bp(o,z,m)}case Dr.SEQUENCE:{const z=Bm(n,i,h);return new Im(o,z[0],z[1],h.numRleValues)}case Dr.CONST:{const z=Om(n,i,h,!1);return new Lm(o,z,m)}}else switch(E){case Dr.FLAT:{if(g){const R=(function(F,Z,q,Y){const W=(function(J,re,xe){const oe=new Float64Array(re);for(let ce=0;ce<re;ce++)oe[ce]=Wg(J,xe);return oe})(F,q.numValues,Z);return(function(J,re,xe){switch(re.logicalLevelTechnique1){case Oi.DELTA:return re.logicalLevelTechnique2===Oi.RLE&&(J=Qg(J,re.runs,re.numRleValues)),(function(oe){oe[0]=oe[0]%2==1?(oe[0]+1)/-2:oe[0]/2;const ce=oe.length/4*4;let Se=1;if(ce>=4)for(;Se<ce-4;Se+=4){const Ce=oe[Se],Ye=oe[Se+1],_t=oe[Se+2],ct=oe[Se+3];oe[Se]=(Ce%2==1?(Ce+1)/-2:Ce/2)+oe[Se-1],oe[Se+1]=(Ye%2==1?(Ye+1)/-2:Ye/2)+oe[Se],oe[Se+2]=(_t%2==1?(_t+1)/-2:_t/2)+oe[Se+1],oe[Se+3]=(ct%2==1?(ct+1)/-2:ct/2)+oe[Se+2]}for(;Se!=oe.length;++Se)oe[Se]=(oe[Se]%2==1?(oe[Se]+1)/-2:oe[Se]/2)+oe[Se-1]})(J),J;case Oi.RLE:return(function(oe,ce,Se){return Qg(oe,ce.runs,ce.numRleValues)})(J,re);case Oi.NONE:return J;default:throw new Error(`The specified Logical level technique is not supported: ${re.logicalLevelTechnique1}`)}})(W,q)})(n,i,h);return new zm(o,R,m)}const z=dd(n,i,h,!1);return new fd(o,z,m)}case Dr.SEQUENCE:{const z=_h(n,i,h);return new jm(o,z[0],z[1],h.numRleValues)}case Dr.CONST:{const z=Nm(n,i,h,!1);return new mf(o,z,m)}}throw new Error("Vector type not supported for id column.")}class ty{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Qr.POINT:case Qr.MULTIPOINT:this.type=1;break;case Qr.LINESTRING:case Qr.MULTILINESTRING:this.type=2;break;case Qr.POLYGON:case Qr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const h of i)o.push(new V(h.x,h.y));e.push(o)}return e}}class s_{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new ty(this.features[e],this.extent)}}class xf{constructor(e){this.layers={};const i=(function(o,h,m=!0){const g=new Yg(0),w=[];for(;g.get()<o.length;){const E=Jr(o,g,1)[0]>>>0,z=g.get()+E;if(z>o.length)throw new Error(`Block overruns tile: ${z} > ${o.length}`);if(Jr(o,g,1)[0]>>>0!=1){g.set(z);continue}const R=a_(o,g),F=R[1],Z=R[0].featureTables[0];let q=null,Y=null;const W=[];let J=0;for(const xe of Z.columns){const oe=xe.name;if(oe==="id"){let ce=null;if(xe.nullable){const Ce=Ja(o,g),Ye=g.get(),_t=gf(o,Ce.numValues,g);g.set(Ye+Ce.byteLength),ce=new kl(_t,Ce.numValues)}const Se=Ja(o,g);J=Se.decompressedCount,q=vf(o,xe,g,oe,Se,ce??J,m)}else if(oe==="geometry"){const ce=Jr(o,g,1)[0];if(J===0){const Se=g.get();J=Ja(o,g).decompressedCount,g.set(Se)}Y=t_(o,ce,g,J)}else{const ce=Iu(xe)?Jr(o,g,1)[0]:1;if(ce===0&&xe.type==="scalarType")continue;const Se=Du(o,g,xe,ce,J);if(Se)if(Array.isArray(Se))for(const Ce of Se)W.push(Ce);else W.push(Se)}}const re=new Au(Z.name,Y,q,W,F);w.push(re),g.set(z)}return w})(new Uint8Array(e));this.layers=i.reduce(((o,h)=>Object.assign(Object.assign({},o),{[h.name]:new s_(h)})),{})}}class o_{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const h=[];for(const m of o)h.push(new V(m[0],m[1]));e.push(h)}return e}}const bf="_geojsonTileLayer";function Dp(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let m=0;m<n.length;m++)i.feature=n.feature(m),e.writeMessage(2,Ip,i);const o=i.keys;for(const m of o)e.writeStringField(3,m);const h=i.values;for(const m of h)e.writeMessage(4,Lp,m)}function Ip(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,l_,n),e.writeVarintField(3,i.type),e.writeMessage(4,$m,i)}function l_(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],h=n.keycache[i];if(o==null)continue;h===void 0&&(n.keys.push(i),h=n.keys.length-1,n.keycache[i]=h),e.writeVarint(h),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const m=typeof o+":"+o;let g=n.valuecache[m];g===void 0&&(n.values.push(o),g=n.values.length-1,n.valuecache[m]=g),e.writeVarint(g)}}function Lu(n,e){return(e<<3)+(7&n)}function Hm(n){return n<<1^n>>31}function $m(n,e){const i=n.loadGeometry(),o=n.type;let h=0,m=0;for(const g of i){let w=1;o===1&&(w=g.length),e.writeVarint(Lu(1,w));const E=o===3?g.length-1:g.length;for(let z=0;z<E;z++){z===1&&o!==1&&e.writeVarint(Lu(2,E-1));const R=g[z].x-h,F=g[z].y-m;e.writeVarint(Hm(R)),e.writeVarint(Hm(F)),h+=R,m+=F}n.type===3&&e.writeVarint(Lu(7,1))}}function Lp(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class Xm{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Xl(Et,16,0),this.grid3D=new Xl(Et,16,0),this.featureIndexArray=new ie,this.promoteId=i}insert(e,i,o,h,m,g){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,m);const E=g?this.grid3D:this.grid;for(let z=0;z<i.length;z++){const R=i[z],F=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<R.length;Z++){const q=R[Z];F[0]=Math.min(F[0],q.x),F[1]=Math.min(F[1],q.y),F[2]=Math.max(F[2],q.x),F[3]=Math.max(F[3],q.y)}F[0]<Et&&F[1]<Et&&F[2]>=0&&F[3]>=0&&E.insert(w,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Ji(new ap(this.rawTileData)).layers:new xf(this.rawTileData).layers,this.sourceLayerCoder=new Pm(this.vtLayers?Object.keys(this.vtLayers).sort():[bf])),this.vtLayers}query(e,i,o,h){this.loadVTLayers();const m=e.params,g=Et/e.tileSize/e.scale,w=Zt(m.filter,m.globalState),E=e.queryGeometry,z=e.queryPadding*g,R=Eu.fromPoints(E),F=this.grid.query(R.minX-z,R.minY-z,R.maxX+z,R.maxY+z),Z=Eu.fromPoints(e.cameraQueryGeometry).expandBy(z),q=this.grid3D.query(Z.minX,Z.minY,Z.maxX,Z.maxY,((J,re,xe,oe)=>(function(ce,Se,Ce,Ye,_t){for(const bt of ce)if(Se<=bt.x&&Ce<=bt.y&&Ye>=bt.x&&_t>=bt.y)return!0;const ct=[new V(Se,Ce),new V(Se,_t),new V(Ye,_t),new V(Ye,Ce)];if(ce.length>2){for(const bt of ct)if(Jl(ce,bt))return!0}for(let bt=0;bt<ce.length-1;bt++)if(fg(ce[bt],ce[bt+1],ct))return!0;return!1})(e.cameraQueryGeometry,J-z,re-z,xe+z,oe+z)));for(const J of q)F.push(J);F.sort(kp);const Y={};let W;for(let J=0;J<F.length;J++){const re=F[J];if(re===W)continue;W=re;const xe=this.featureIndexArray.get(re);let oe=null;this.loadMatchingFeature(Y,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,w,m.layers,m.availableImages,i,o,h,((ce,Se,Ce)=>(oe||(oe=Cl(ce)),Se.queryIntersectsFeature({queryGeometry:E,feature:ce,featureState:Ce,geometry:oe,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return Y}loadMatchingFeature(e,i,o,h,m,g,w,E,z,R,F){const Z=this.bucketLayerIDs[i];if(g&&!Z.some((J=>g.has(J))))return;const q=this.sourceLayerCoder.decode(o),Y=this.vtLayers[q].feature(h);if(m.needGeometry){const J=vo(Y,!0);if(!m.filter(new _n(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!m.filter(new _n(this.tileID.overscaledZ),Y))return;const W=this.getId(Y,q);for(let J=0;J<Z.length;J++){const re=Z[J];if(g&&!g.has(re))continue;const xe=E[re];if(!xe)continue;let oe={};W&&R&&(oe=R.getState(xe.sourceLayer||bf,W));const ce=ui({},z[re]);ce.paint=c_(ce.paint,xe.paint,Y,oe,w),ce.layout=c_(ce.layout,xe.layout,Y,oe,w);const Se=!F||F(Y,xe,oe);if(!Se)continue;const Ce=new vp(Y,this.z,this.x,this.y,W);Ce.layer=ce;let Ye=e[re];Ye===void 0&&(Ye=e[re]=[]),Ye.push({featureIndex:h,feature:Ce,intersectionZ:Se})}}lookupSymbolFeatures(e,i,o,h,m,g,w,E){const z={};this.loadVTLayers();const R=Zt(m.filterSpec,m.globalState);for(const F of e)this.loadMatchingFeature(z,o,h,F,R,g,w,E,i);return z}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(h=Number(e.properties.cluster_id))),h}}function c_(n,e,i,o,h){return mn(n,((m,g)=>{const w=e instanceof Ac?e.get(g):null;return w&&w.evaluate?w.evaluate(i,o,h):w}))}function kp(n,e){return e-n}function r(n,e,i,o,h){const m=[];for(let g=0;g<n.length;g++){const w=n[g];let E;for(let z=0;z<w.length-1;z++){let R=w[z],F=w[z+1];R.x<e&&F.x<e||(R.x<e?R=new V(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x<e&&(F=new V(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y<i&&F.y<i||(R.y<i?R=new V(R.x+(i-R.y)/(F.y-R.y)*(F.x-R.x),i)._round():F.y<i&&(F=new V(R.x+(i-R.y)/(F.y-R.y)*(F.x-R.x),i)._round()),R.x>=o&&F.x>=o||(R.x>=o?R=new V(o,R.y+(o-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x>=o&&(F=new V(o,R.y+(o-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y>=h&&F.y>=h||(R.y>=h?R=new V(R.x+(h-R.y)/(F.y-R.y)*(F.x-R.x),h)._round():F.y>=h&&(F=new V(R.x+(h-R.y)/(F.y-R.y)*(F.x-R.x),h)._round()),E&&R.equals(E[E.length-1])||(E=[R],m.push(E)),E.push(F)))))}}return m}function s(n,e,i,o,h){switch(e){case 1:return(function(m,g,w,E){const z=[];for(const R of m)for(const F of R){const Z=E===0?F.x:F.y;Z>=g&&Z<=w&&z.push([F])}return z})(n,i,o,h);case 2:return x(n,i,o,h,!1);case 3:return x(n,i,o,h,!0)}return[]}function d(n,e,i,o,h){const m=o===0?P:k;let g=[];const w=[];for(let R=0;R<n.length-1;R++){const F=n[R],Z=n[R+1],q=o===0?F.x:F.y,Y=o===0?Z.x:Z.y;let W=!1;q<e?Y>e&&g.push(m(F,Z,e)):q>i?Y<i&&g.push(m(F,Z,i)):g.push(F),Y<e&&q>=e&&(g.push(m(F,Z,e)),W=!0),Y>i&&q<=i&&(g.push(m(F,Z,i)),W=!0),!h&&W&&(w.push(g),g=[])}const E=n.length-1,z=o===0?n[E].x:n[E].y;return z>=e&&z<=i&&g.push(n[E]),h&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(new V(g[0].x,g[0].y)),g.length>0&&w.push(g),w}function x(n,e,i,o,h){const m=[];for(const g of n){const w=d(g,e,i,o,h);w.length>0&&m.push(...w)}return m}function P(n,e,i){return new V(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function k(n,e,i){return new V(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}qt("FeatureIndex",Xm,{omit:["rawTileData","sourceLayerCoder"]});class X extends V{constructor(e,i,o,h){super(e,i),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new X(this.x,this.y,this.angle,this.segment)}}function le(n,e,i,o,h){if(e.segment===void 0||i===0)return!0;let m=e,g=e.segment+1,w=0;for(;w>-i/2;){if(g--,g<0)return!1;w-=n[g].dist(m),m=n[g]}w+=n[g].dist(n[g+1]),g++;const E=[];let z=0;for(;w<i/2;){const R=n[g],F=n[g+1];if(!F)return!1;let Z=n[g-1].angleTo(R)-R.angleTo(F);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:Z}),z+=Z;w-E[0].distance>o;)z-=E.shift().angleDelta;if(z>h)return!1;g++,w+=R.dist(F)}return!0}function ke(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function nt(n,e,i){return n?.6*e*i:0}function vt(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function At(n,e,i,o,h,m){const g=nt(i,h,m),w=vt(i,o)*m;let E=0;const z=ke(n)/2;for(let R=0;R<n.length-1;R++){const F=n[R],Z=n[R+1],q=F.dist(Z);if(E+q>z){const Y=(z-E)/q,W=zn.number(F.x,Z.x,Y),J=zn.number(F.y,Z.y,Y),re=new X(W,J,Z.angleTo(F),R);return re._round(),!g||le(n,re,w,g,e)?re:void 0}E+=q}}function ot(n,e,i,o,h,m,g,w,E){const z=nt(o,m,g),R=vt(o,h),F=R*g,Z=n[0].x===0||n[0].x===E||n[0].y===0||n[0].y===E;return e-F<e/4&&(e=F+e/4),pt(n,Z?e/2*w%e:(R/2+2*m)*g*w%e,e,z,i,F,Z,!1,E)}function pt(n,e,i,o,h,m,g,w,E){const z=m/2,R=ke(n);let F=0,Z=e-i,q=[];for(let Y=0;Y<n.length-1;Y++){const W=n[Y],J=n[Y+1],re=W.dist(J),xe=J.angleTo(W);for(;Z+i<F+re;){Z+=i;const oe=(Z-F)/re,ce=zn.number(W.x,J.x,oe),Se=zn.number(W.y,J.y,oe);if(ce>=0&&ce<E&&Se>=0&&Se<E&&Z-z>=0&&Z+z<=R){const Ce=new X(ce,Se,xe,Y);Ce._round(),o&&!le(n,Ce,m,o,h)||q.push(Ce)}}F+=re}return w||q.length||g||(q=pt(n,F/2,i,o,h,m,g,!0,E)),q}function ni(n,e,i,o){const h=[],m=n.image,g=m.pixelRatio,w=m.paddedRect.w-2,E=m.paddedRect.h-2;let z={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const R=m.stretchX||[[0,w]],F=m.stretchY||[[0,E]],Z=(it,Wt)=>it+Wt[1]-Wt[0],q=R.reduce(Z,0),Y=F.reduce(Z,0),W=w-q,J=E-Y;let re=0,xe=q,oe=0,ce=Y,Se=0,Ce=W,Ye=0,_t=J;if(m.content&&o){const it=m.content,Wt=it[2]-it[0],Gt=it[3]-it[1];(m.textFitWidth||m.textFitHeight)&&(z=Vc(n)),re=_i(R,0,it[0]),oe=_i(F,0,it[1]),xe=_i(R,it[0],it[2]),ce=_i(F,it[1],it[3]),Se=it[0]-re,Ye=it[1]-oe,Ce=Wt-xe,_t=Gt-ce}const ct=z.x1,bt=z.y1,Nt=z.x2-ct,St=z.y2-bt,mt=(it,Wt,Gt,Qt)=>{const Vt=Ge(it.stretch-re,xe,Nt,ct),ai=Be(it.fixed-Se,Ce,it.stretch,q),an=Ge(Wt.stretch-oe,ce,St,bt),Ui=Be(Wt.fixed-Ye,_t,Wt.stretch,Y),fr=Ge(Gt.stretch-re,xe,Nt,ct),ts=Be(Gt.fixed-Se,Ce,Gt.stretch,q),ea=Ge(Qt.stretch-oe,ce,St,bt),pr=Be(Qt.fixed-Ye,_t,Qt.stretch,Y),rr=new V(Vt,an),Tn=new V(fr,an),Er=new V(fr,ea),Ir=new V(Vt,ea),Qn=new V(ai/g,Ui/g),To=new V(ts/g,pr/g),is=e*Math.PI/180;if(is){const La=Math.sin(is),yr=Math.cos(is),ta=[yr,-La,La,yr];rr._matMult(ta),Tn._matMult(ta),Ir._matMult(ta),Er._matMult(ta)}const So=it.stretch+it.fixed,ac=Wt.stretch+Wt.fixed;return{tl:rr,tr:Tn,bl:Ir,br:Er,tex:{x:m.paddedRect.x+1+So,y:m.paddedRect.y+1+ac,w:Gt.stretch+Gt.fixed-So,h:Qt.stretch+Qt.fixed-ac},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qn,pixelOffsetBR:To,minFontScaleX:Ce/g/Nt,minFontScaleY:_t/g/St,isSDF:i}};if(o&&(m.stretchX||m.stretchY)){const it=Nn(R,W,q),Wt=Nn(F,J,Y);for(let Gt=0;Gt<it.length-1;Gt++){const Qt=it[Gt],Vt=it[Gt+1];for(let ai=0;ai<Wt.length-1;ai++)h.push(mt(Qt,Wt[ai],Vt,Wt[ai+1]))}}else h.push(mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return h}function _i(n,e,i){let o=0;for(const h of n)o+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return o}function Nn(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[h,m]of n){const g=o[o.length-1];o.push({fixed:h-g.stretch,stretch:g.stretch}),o.push({fixed:h-g.stretch,stretch:g.stretch+(m-h)})}return o.push({fixed:e+1,stretch:i}),o}function Ge(n,e,i,o){return n/e*i+o}function Be(n,e,i,o){return n-e*i/o}qt("Anchor",X);class tt{constructor(e,i,o,h,m,g,w,E,z,R){var F;if(this.boxStartIndex=e.length,z){let Z=g.top,q=g.bottom;const Y=g.collisionPadding;Y&&(Z-=Y[1],q+=Y[3]);let W=q-Z;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const Z=!((F=g.image)===null||F===void 0)&&F.content&&(g.image.textFitWidth||g.image.textFitHeight)?Vc(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};Z.y1=Z.y1*w-E[0],Z.y2=Z.y2*w+E[2],Z.x1=Z.x1*w-E[3],Z.x2=Z.x2*w+E[1];const q=g.collisionPadding;if(q&&(Z.x1-=q[0]*w,Z.y1-=q[1]*w,Z.x2+=q[2]*w,Z.y2+=q[3]*w),R){const Y=new V(Z.x1,Z.y1),W=new V(Z.x2,Z.y1),J=new V(Z.x1,Z.y2),re=new V(Z.x2,Z.y2),xe=R*Math.PI/180;Y._rotate(xe),W._rotate(xe),J._rotate(xe),re._rotate(xe),Z.x1=Math.min(Y.x,W.x,J.x,re.x),Z.x2=Math.max(Y.x,W.x,J.x,re.x),Z.y1=Math.min(Y.y,W.y,J.y,re.y),Z.y2=Math.max(Y.y,W.y,J.y,re.y)}e.emplaceBack(i.x,i.y,Z.x1,Z.y1,Z.x2,Z.y2,o,h,m)}this.boxEndIndex=e.length}}class Tt{constructor(e=[],i=(o,h)=>o<h?-1:o>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,h=i[e];for(;e>0;){const m=e-1>>1,g=i[m];if(o(h,g)>=0)break;i[e]=g,e=m}i[e]=h}_down(e){const{data:i,compare:o}=this,h=this.length>>1,m=i[e];for(;e<h;){let g=1+(e<<1);const w=g+1;if(w<this.length&&o(i[w],i[g])<0&&(g=w),o(i[g],m)>=0)break;i[e]=i[g],e=g}i[e]=m}}function mi(n,e=1,i=!1){const o=Eu.fromPoints(n[0]),h=Math.min(o.width(),o.height());let m=h/2;const g=new Tt([],wn),{minX:w,minY:E,maxX:z,maxY:R}=o;if(h===0)return new V(w,E);for(let q=w;q<z;q+=h)for(let Y=E;Y<R;Y+=h)g.push(new ri(q+m,Y+m,m,n));let F=(function(q){let Y=0,W=0,J=0;const re=q[0];for(let xe=0,oe=re.length,ce=oe-1;xe<oe;ce=xe++){const Se=re[xe],Ce=re[ce],Ye=Se.x*Ce.y-Ce.x*Se.y;W+=(Se.x+Ce.x)*Ye,J+=(Se.y+Ce.y)*Ye,Y+=3*Ye}return new ri(W/Y,J/Y,0,q)})(n),Z=g.length;for(;g.length;){const q=g.pop();(q.d>F.d||!F.d)&&(F=q,i&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,Z)),q.max-F.d<=e||(m=q.h/2,g.push(new ri(q.p.x-m,q.p.y-m,m,n)),g.push(new ri(q.p.x+m,q.p.y-m,m,n)),g.push(new ri(q.p.x-m,q.p.y+m,m,n)),g.push(new ri(q.p.x+m,q.p.y+m,m,n)),Z+=4)}return i&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${F.d}`)),F.p}function wn(n,e){return e.max-n.max}function ri(n,e,i,o){this.p=new V(n,e),this.h=i,this.d=(function(h,m){let g=!1,w=1/0;for(let E=0;E<m.length;E++){const z=m[E];for(let R=0,F=z.length,Z=F-1;R<F;Z=R++){const q=z[R],Y=z[Z];q.y>h.y!=Y.y>h.y&&h.x<(Y.x-q.x)*(h.y-q.y)/(Y.y-q.y)+q.x&&(g=!g),w=Math.min(w,Kp(h,q,Y))}}return(g?1:-1)*Math.sqrt(w)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var di;D.aP=void 0,(di=D.aP||(D.aP={}))[di.center=1]="center",di[di.left=2]="left",di[di.right=3]="right",di[di.top=4]="top",di[di.bottom=5]="bottom",di[di["top-left"]=6]="top-left",di[di["top-right"]=7]="top-right",di[di["bottom-left"]=8]="bottom-left",di[di["bottom-right"]=9]="bottom-right";const Yi=Number.POSITIVE_INFINITY;function vn(n,e){return e[1]!==Yi?(function(i,o,h){let m=0,g=0;switch(o=Math.abs(o),h=Math.abs(h),i){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(i){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]})(n,e[0],e[1]):(function(i,o){let h=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(i){case"top-right":case"top-left":m=g-7;break;case"bottom-right":case"bottom-left":m=7-g;break;case"bottom":m=7-o;break;case"top":m=o-7}switch(i){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=o;break;case"right":h=-o}return[h,m]})(n,e[0])}function Hc(n,e,i){var o;const h=n.layout,m=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(m){const w=m.values,E=[];for(let z=0;z<w.length;z+=2){const R=E[z]=w[z],F=w[z+1].map((Z=>Z*Zr));R.startsWith("top")?F[1]-=7:R.startsWith("bottom")&&(F[1]+=7),E[z+1]=F}return new kn(E)}const g=h.get("text-variable-anchor");if(g){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},i)*Zr,Yi]:h.get("text-offset").evaluate(e,{},i).map((z=>z*Zr));const E=[];for(const z of g)E.push(z,vn(z,w));return new kn(E)}return null}function Ym(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function i1(n,e,i,o,h,m,g,w,E,z,R,F){let Z=m.textMaxSize.evaluate(e,{});Z===void 0&&(Z=g);const q=n.layers[0].layout,Y=q.get("icon-offset").evaluate(e,{},R),W=B0(i.horizontal),J=g/24,re=n.tilePixelRatio*J,xe=n.tilePixelRatio*Z/24,oe=n.tilePixelRatio*w,ce=n.tilePixelRatio*q.get("symbol-spacing"),Se=q.get("text-padding")*n.tilePixelRatio,Ce=(function(Gt,Qt,Vt,ai=1){const an=Gt.get("icon-padding").evaluate(Qt,{},Vt),Ui=an&&an.values;return[Ui[0]*ai,Ui[1]*ai,Ui[2]*ai,Ui[3]*ai]})(q,e,R,n.tilePixelRatio),Ye=q.get("text-max-angle")/180*Math.PI,_t=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",ct=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",bt=q.get("symbol-placement"),Nt=ce/2,St=q.get("icon-text-fit");let mt;o&&St!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(mt=Dl(o,i.vertical,St,q.get("icon-text-fit-padding"),Y,J)),W&&(o=Dl(o,W,St,q.get("icon-text-fit-padding"),Y,J)));const it=R?F.line.getGranularityForZoomLevel(R.z):1,Wt=(Gt,Qt)=>{Qt.x<0||Qt.x>=Et||Qt.y<0||Qt.y>=Et||(function(Vt,ai,an,Ui,fr,ts,ea,pr,rr,Tn,Er,Ir,Qn,To,is,So,ac,La,yr,ta,Mr,ka,vh,$c,Qm){const _d=Vt.addToLineVertexArray(ai,an);let wf,Rp,Op,Bp,U0=0,V0=0,Z0=0,q0=0,cy=-1,uy=-1;const xh={};let G0=hr("");if(Vt.allowVerticalPlacement&&Ui.vertical){const Ss=pr.layout.get("text-rotate").evaluate(Mr,{},$c)+90;Op=new tt(rr,ai,Tn,Er,Ir,Ui.vertical,Qn,To,is,Ss),ea&&(Bp=new tt(rr,ai,Tn,Er,Ir,ea,ac,La,is,Ss))}if(fr){const Ss=pr.layout.get("icon-rotate").evaluate(Mr,{}),Rl=pr.layout.get("icon-text-fit")!=="none",Tf=ni(fr,Ss,vh,Rl),Yc=ea?ni(ea,Ss,vh,Rl):void 0;Rp=new tt(rr,ai,Tn,Er,Ir,fr,ac,La,!1,Ss),U0=4*Tf.length;const Sf=Vt.iconSizeData;let ku=null;Sf.kind==="source"?(ku=[bo*pr.layout.get("icon-size").evaluate(Mr,{})],ku[0]>Tu&&Gi(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Sf.kind==="composite"&&(ku=[bo*ka.compositeIconSizes[0].evaluate(Mr,{},$c),bo*ka.compositeIconSizes[1].evaluate(Mr,{},$c)],(ku[0]>Tu||ku[1]>Tu)&&Gi(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Vt.addSymbols(Vt.icon,Tf,ku,ta,yr,Mr,D.az.none,ai,_d.lineStartIndex,_d.lineLength,-1,$c),cy=Vt.icon.placedSymbolArray.length-1,Yc&&(V0=4*Yc.length,Vt.addSymbols(Vt.icon,Yc,ku,ta,yr,Mr,D.az.vertical,ai,_d.lineStartIndex,_d.lineLength,-1,$c),uy=Vt.icon.placedSymbolArray.length-1)}const H0=Object.keys(Ui.horizontal);for(const Ss of H0){const Rl=Ui.horizontal[Ss];if(!wf){G0=hr(Rl.text);const Yc=pr.layout.get("text-rotate").evaluate(Mr,{},$c);wf=new tt(rr,ai,Tn,Er,Ir,Rl,Qn,To,is,Yc)}const Tf=Rl.positionedLines.length===1;if(Z0+=O0(Vt,ai,Rl,ts,pr,is,Mr,So,_d,Ui.vertical?D.az.horizontal:D.az.horizontalOnly,Tf?H0:[Ss],xh,cy,ka,$c),Tf)break}Ui.vertical&&(q0+=O0(Vt,ai,Ui.vertical,ts,pr,is,Mr,So,_d,D.az.vertical,["vertical"],xh,uy,ka,$c));const a1=wf?wf.boxStartIndex:Vt.collisionBoxArray.length,s1=wf?wf.boxEndIndex:Vt.collisionBoxArray.length,o1=Op?Op.boxStartIndex:Vt.collisionBoxArray.length,l1=Op?Op.boxEndIndex:Vt.collisionBoxArray.length,c1=Rp?Rp.boxStartIndex:Vt.collisionBoxArray.length,u1=Rp?Rp.boxEndIndex:Vt.collisionBoxArray.length,h1=Bp?Bp.boxStartIndex:Vt.collisionBoxArray.length,d1=Bp?Bp.boxEndIndex:Vt.collisionBoxArray.length;let Xc=-1;const h_=(Ss,Rl)=>Ss&&Ss.circleDiameter?Math.max(Ss.circleDiameter,Rl):Rl;Xc=h_(wf,Xc),Xc=h_(Op,Xc),Xc=h_(Rp,Xc),Xc=h_(Bp,Xc);const $0=Xc>-1?1:0;$0&&(Xc*=Qm/Zr),Vt.glyphOffsetArray.length>=ld.MAX_GLYPHS&&Gi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mr.sortKey!==void 0&&Vt.addToSortKeyRanges(Vt.symbolInstances.length,Mr.sortKey);const f1=Hc(pr,Mr,$c),[p1,m1]=(function(Ss,Rl){const Tf=Ss.length,Yc=Rl?.values;if(Yc?.length>0)for(let Sf=0;Sf<Yc.length;Sf+=2){const ku=Yc[Sf+1];Ss.emplaceBack(D.aP[Yc[Sf]],ku[0],ku[1])}return[Tf,Ss.length]})(Vt.textAnchorOffsets,f1);Vt.symbolInstances.emplaceBack(ai.x,ai.y,xh.right>=0?xh.right:-1,xh.center>=0?xh.center:-1,xh.left>=0?xh.left:-1,xh.vertical||-1,cy,uy,G0,a1,s1,o1,l1,c1,u1,h1,d1,Tn,Z0,q0,U0,V0,$0,0,Qn,Xc,p1,m1)})(n,Qt,Gt,i,o,h,mt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,re,[Se,Se,Se,Se],_t,E,oe,Ce,ct,Y,e,m,z,R,g)};if(bt==="line")for(const Gt of r(e.geometry,0,0,Et,Et)){const Qt=Bc(Gt,it),Vt=ot(Qt,ce,Ye,i.vertical||W,o,24,xe,n.overscaling,Et);for(const ai of Vt)W&&n1(n,W.text,Nt,ai)||Wt(Qt,ai)}else if(bt==="line-center"){for(const Gt of e.geometry)if(Gt.length>1){const Qt=Bc(Gt,it),Vt=At(Qt,Ye,i.vertical||W,o,24,xe);Vt&&Wt(Qt,Vt)}}else if(e.type==="Polygon")for(const Gt of hl(e.geometry,0)){const Qt=mi(Gt,16);Wt(Bc(Gt[0],it,!0),new X(Qt.x,Qt.y,0))}else if(e.type==="LineString")for(const Gt of e.geometry){const Qt=Bc(Gt,it);Wt(Qt,new X(Qt[0].x,Qt[0].y,0))}else if(e.type==="Point")for(const Gt of e.geometry)for(const Qt of Gt)Wt([Qt],new X(Qt.x,Qt.y,0))}function O0(n,e,i,o,h,m,g,w,E,z,R,F,Z,q,Y){const W=(function(xe,oe,ce,Se,Ce,Ye,_t,ct){const bt=Se.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,Nt=[];for(const St of oe.positionedLines)for(const mt of St.positionedGlyphs){if(!mt.rect)continue;const it=mt.rect||{};let Wt=4,Gt=!0,Qt=1,Vt=0;const ai=(Ce||ct)&&mt.vertical,an=mt.metrics.advance*mt.scale/2;if(ct&&oe.verticalizable&&(Vt=St.lineOffset/2-(mt.imageName?-(Zr-mt.metrics.width*mt.scale)/2:(mt.scale-1)*Zr)),mt.imageName){const La=_t[mt.imageName];Gt=La.sdf,Qt=La.pixelRatio,Wt=1/Qt}const Ui=Ce?[mt.x+an,mt.y]:[0,0];let fr=Ce?[0,0]:[mt.x+an+ce[0],mt.y+ce[1]-Vt],ts=[0,0];ai&&(ts=fr,fr=[0,0]);const ea=mt.metrics.isDoubleResolution?2:1,pr=(mt.metrics.left-Wt)*mt.scale-an+fr[0],rr=(-mt.metrics.top-Wt)*mt.scale+fr[1],Tn=pr+it.w/ea*mt.scale/Qt,Er=rr+it.h/ea*mt.scale/Qt,Ir=new V(pr,rr),Qn=new V(Tn,rr),To=new V(pr,Er),is=new V(Tn,Er);if(ai){const La=new V(-an,an- -17),yr=-Math.PI/2,ta=12-an,Mr=new V(22-ta,-(mt.imageName?ta:0)),ka=new V(...ts);Ir._rotateAround(yr,La)._add(Mr)._add(ka),Qn._rotateAround(yr,La)._add(Mr)._add(ka),To._rotateAround(yr,La)._add(Mr)._add(ka),is._rotateAround(yr,La)._add(Mr)._add(ka)}if(bt){const La=Math.sin(bt),yr=Math.cos(bt),ta=[yr,-La,La,yr];Ir._matMult(ta),Qn._matMult(ta),To._matMult(ta),is._matMult(ta)}const So=new V(0,0),ac=new V(0,0);Nt.push({tl:Ir,tr:Qn,bl:To,br:is,tex:it,writingMode:oe.writingMode,glyphOffset:Ui,sectionIndex:mt.sectionIndex,isSDF:Gt,pixelOffsetTL:So,pixelOffsetBR:ac,minFontScaleX:0,minFontScaleY:0})}return Nt})(0,i,w,h,m,g,o,n.allowVerticalPlacement),J=n.textSizeData;let re=null;J.kind==="source"?(re=[bo*h.layout.get("text-size").evaluate(g,{})],re[0]>Tu&&Gi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):J.kind==="composite"&&(re=[bo*q.compositeTextSizes[0].evaluate(g,{},Y),bo*q.compositeTextSizes[1].evaluate(g,{},Y)],(re[0]>Tu||re[1]>Tu)&&Gi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,W,re,w,m,g,z,e,E.lineStartIndex,E.lineLength,Z,Y);for(const xe of R)F[xe]=n.text.placedSymbolArray.length-1;return 4*W.length}function B0(n){for(const e in n)return n[e];return null}function n1(n,e,i,o){const h=n.compareText;if(e in h){const m=h[e];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<i)return!0}else h[e]=[];return h[e].push(o),!1}const N0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class iy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=N0[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new iy(w,g,m,e)}constructor(e,i=64,o=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=N0.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+w+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ny(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:w}=this,E=[0,m.length-1,0],z=[];for(;E.length;){const R=E.pop()||0,F=E.pop()||0,Z=E.pop()||0;if(F-Z<=w){for(let J=Z;J<=F;J++){const re=g[2*J],xe=g[2*J+1];re>=e&&re<=o&&xe>=i&&xe<=h&&z.push(m[J])}continue}const q=Z+F>>1,Y=g[2*q],W=g[2*q+1];Y>=e&&Y<=o&&W>=i&&W<=h&&z.push(m[q]),(R===0?e<=Y:i<=W)&&(E.push(Z),E.push(q-1),E.push(1-R)),(R===0?o>=Y:h>=W)&&(E.push(q+1),E.push(F),E.push(1-R))}return z}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:g}=this,w=[0,h.length-1,0],E=[],z=o*o;for(;w.length;){const R=w.pop()||0,F=w.pop()||0,Z=w.pop()||0;if(F-Z<=g){for(let J=Z;J<=F;J++)j0(m[2*J],m[2*J+1],e,i)<=z&&E.push(h[J]);continue}const q=Z+F>>1,Y=m[2*q],W=m[2*q+1];j0(Y,W,e,i)<=z&&E.push(h[q]),(R===0?e-o<=Y:i-o<=W)&&(w.push(Z),w.push(q-1),w.push(1-R)),(R===0?e+o>=Y:i+o>=W)&&(w.push(q+1),w.push(F),w.push(1-R))}return E}}function ny(n,e,i,o,h,m){if(h-o<=i)return;const g=o+h>>1;F0(n,e,g,o,h,m),ny(n,e,i,o,g-1,1-m),ny(n,e,i,g+1,h,1-m)}function F0(n,e,i,o,h,m){for(;h>o;){if(h-o>600){const z=h-o+1,R=i-o+1,F=Math.log(z),Z=.5*Math.exp(2*F/3),q=.5*Math.sqrt(F*Z*(z-Z)/z)*(R-z/2<0?-1:1);F0(n,e,i,Math.max(o,Math.floor(i-R*Z/z+q)),Math.min(h,Math.floor(i+(z-R)*Z/z+q)),m)}const g=e[2*i+m];let w=o,E=h;for(Wm(n,e,o,i),e[2*h+m]>g&&Wm(n,e,o,h);w<E;){for(Wm(n,e,w,E),w++,E--;e[2*w+m]<g;)w++;for(;e[2*E+m]>g;)E--}e[2*o+m]===g?Wm(n,e,o,E):(E++,Wm(n,e,E,h)),E<=i&&(o=E+1),i<=E&&(h=E-1)}}function Wm(n,e,i,o){ry(n,i,o),ry(e,2*i,2*o),ry(e,2*i+1,2*o+1)}function ry(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function j0(n,e,i,o){const h=n-i,m=e-o;return h*h+m*m}var ay;D.cH=void 0,(ay=D.cH||(D.cH={})).create="create",ay.load="load",ay.fullLoad="fullLoad";let u_=null,Km=[];const sy=1e3/60,oy="loadTime",ly="fullLoadTime",r1={mark(n){performance.mark(n)},frame(n){const e=n;u_!=null&&Km.push(e-u_),u_=e},clearMetrics(){u_=null,Km=[],performance.clearMeasures(oy),performance.clearMeasures(ly);for(const n in D.cH)performance.clearMarks(D.cH[n])},getPerformanceMetrics(){performance.measure(oy,D.cH.create,D.cH.load),performance.measure(ly,D.cH.create,D.cH.fullLoad);const n=performance.getEntriesByName(oy)[0].duration,e=performance.getEntriesByName(ly)[0].duration,i=Km.length,o=1/(Km.reduce(((m,g)=>m+g),0)/i/1e3),h=Km.filter((m=>m>sy)).reduce(((m,g)=>m+(g-sy)/sy),0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:h/(i+h)*100,totalFrames:i}}};D.$=de,D.A=Fe,D.B=ho,D.C=Vr,D.D=Xt,D.E=Di,D.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},D.G=zn,D.H=_n,D.I=Cn,D.J=jh,D.K=function(n){if(ln==null){const e=n.navigator?n.navigator.userAgent:null;ln=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ln},D.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new gp((()=>this.process())),this.subscription=Ci(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=Jn(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),m=e?Ci(e.signal,"abort",(()=>{m?.unsubscribe(),delete this.resolveRejects[h];const E={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)}),Em):null;this.resolveRejects[h]={resolve:E=>{m?.unsubscribe(),i(E)},reject:E=>{m?.unsubscribe(),o(E)}};const g=[],w=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:fo(n.data,g)});this.target.postMessage(w,{transfer:g})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(Jn(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return u(this,void 0,void 0,(function*(){if(e.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(e.error?h.reject(fu(e.error)):h.resolve(fu(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=fu(e.data),o=new AbortController;this.abortControllers[n]=o;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?fo(e):null,data:fo(i,o)};this.target.postMessage(h,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},D.M=Ne,D.N=function(){var n=new Fe(16);return Fe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},D.O=function(n,e,i){var o,h,m,g,w,E,z,R,F,Z,q,Y,W=i[0],J=i[1],re=i[2];return e===n?(n[12]=e[0]*W+e[4]*J+e[8]*re+e[12],n[13]=e[1]*W+e[5]*J+e[9]*re+e[13],n[14]=e[2]*W+e[6]*J+e[10]*re+e[14],n[15]=e[3]*W+e[7]*J+e[11]*re+e[15]):(h=e[1],m=e[2],g=e[3],w=e[4],E=e[5],z=e[6],R=e[7],F=e[8],Z=e[9],q=e[10],Y=e[11],n[0]=o=e[0],n[1]=h,n[2]=m,n[3]=g,n[4]=w,n[5]=E,n[6]=z,n[7]=R,n[8]=F,n[9]=Z,n[10]=q,n[11]=Y,n[12]=o*W+w*J+F*re+e[12],n[13]=h*W+E*J+Z*re+e[13],n[14]=m*W+z*J+q*re+e[14],n[15]=g*W+R*J+Y*re+e[15]),n},D.P=V,D.Q=function(n,e,i){var o=i[0],h=i[1],m=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*m,n[9]=e[9]*m,n[10]=e[10]*m,n[11]=e[11]*m,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},D.R=Ka,D.S=function(n,e,i){var o=e[0],h=e[1],m=e[2],g=e[3],w=e[4],E=e[5],z=e[6],R=e[7],F=e[8],Z=e[9],q=e[10],Y=e[11],W=e[12],J=e[13],re=e[14],xe=e[15],oe=i[0],ce=i[1],Se=i[2],Ce=i[3];return n[0]=oe*o+ce*w+Se*F+Ce*W,n[1]=oe*h+ce*E+Se*Z+Ce*J,n[2]=oe*m+ce*z+Se*q+Ce*re,n[3]=oe*g+ce*R+Se*Y+Ce*xe,n[4]=(oe=i[4])*o+(ce=i[5])*w+(Se=i[6])*F+(Ce=i[7])*W,n[5]=oe*h+ce*E+Se*Z+Ce*J,n[6]=oe*m+ce*z+Se*q+Ce*re,n[7]=oe*g+ce*R+Se*Y+Ce*xe,n[8]=(oe=i[8])*o+(ce=i[9])*w+(Se=i[10])*F+(Ce=i[11])*W,n[9]=oe*h+ce*E+Se*Z+Ce*J,n[10]=oe*m+ce*z+Se*q+Ce*re,n[11]=oe*g+ce*R+Se*Y+Ce*xe,n[12]=(oe=i[12])*o+(ce=i[13])*w+(Se=i[14])*F+(Ce=i[15])*W,n[13]=oe*h+ce*E+Se*Z+Ce*J,n[14]=oe*m+ce*z+Se*q+Ce*re,n[15]=oe*g+ce*R+Se*Y+Ce*xe,n},D.T=$f,D.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const h=e[o];h in n&&(i[h]=n[h])}return i},D.V=nc,D.W=Kt,D.X=Mm,D.Y=Gg,D.Z=ge,D._=u,D.a=se,D.a$=Ht,D.a0=He,D.a1=Jt,D.a2=Xs,D.a3=$g,D.a4=rf,D.a5=Et,D.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=sf(n),h=sf(e);(function(g,w){w.removeAll&&(g.add.clear(),g.update.clear(),g.remove.clear(),w.remove.clear());for(const E of w.remove)g.add.delete(E),g.update.delete(E);for(const[E,z]of w.update){const R=g.update.get(E);R&&(w.update.set(E,Cm(R,z)),g.update.delete(E))}})(o,h);const m={};if((o.removeAll||h.removeAll)&&(m.removeAll=!0),m.remove=new Set([...o.remove,...h.remove]),m.add=new Map([...o.add,...h.add]),m.update=new Map([...o.update,...h.update]),m.remove.size&&m.add.size)for(const g of m.add.keys())m.remove.delete(g);return(function(g){const w={};return g.removeAll&&(w.removeAll=g.removeAll),g.remove&&(w.remove=Array.from(g.remove)),g.add&&(w.add=Array.from(g.add.values())),g.update&&(w.update=Array.from(g.update.values())),w})(m)},D.a7=function(n,e){const i=new Map;if(n==null||n.type==null)return i;if(n.type==="Feature"){const o=af(n,e);return o==null?void 0:(i.set(o,n),i)}if(n.type==="FeatureCollection"){const o=new Set;for(const h of n.features){const m=af(h,e);if(m==null||o.has(m))return;o.add(m),i.set(m,h)}return i}},D.a8=function(n,e,i){var o,h;const m=[];if(e.removeAll)n.clear();else if(e.remove)for(const g of e.remove){const w=n.get(g);w&&(m.push(w.geometry),n.delete(g))}if(e.add)for(const g of e.add){const w=af(g,i);if(w==null)continue;const E=n.get(w);E&&m.push(E.geometry),m.push(g.geometry),n.set(w,g)}if(e.update)for(const g of e.update){const w=n.get(g.id);if(!w)continue;const E=!!g.newGeometry,z=g.removeAllProperties||((o=g.removeProperties)===null||o===void 0?void 0:o.length)>0||((h=g.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0;if(!E&&!z)continue;m.push(w.geometry);const R=Object.assign({},w);if(n.set(g.id,R),E&&(m.push(g.newGeometry),R.geometry=g.newGeometry),z){if(R.properties=g.removeAllProperties?{}:Object.assign({},R.properties||{}),g.removeProperties)for(const F of g.removeProperties)delete R.properties[F];if(g.addOrUpdateProperties)for(const{key:F,value:Z}of g.addOrUpdateProperties)R.properties[F]=Z}}return m},D.a9=bn,D.aA=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:h}){return n.kind==="source"?o/bo:n.kind==="composite"?zn.number(o/bo,h/bo,i):e},D.aB=function(n,e){var i=e[0],o=e[1],h=e[2],m=e[3],g=e[4],w=e[5],E=e[6],z=e[7],R=e[8],F=e[9],Z=e[10],q=e[11],Y=e[12],W=e[13],J=e[14],re=e[15],xe=i*w-o*g,oe=i*E-h*g,ce=i*z-m*g,Se=o*E-h*w,Ce=o*z-m*w,Ye=h*z-m*E,_t=R*W-F*Y,ct=R*J-Z*Y,bt=R*re-q*Y,Nt=F*J-Z*W,St=F*re-q*W,mt=Z*re-q*J,it=xe*mt-oe*St+ce*Nt+Se*bt-Ce*ct+Ye*_t;return it?(n[0]=(w*mt-E*St+z*Nt)*(it=1/it),n[1]=(h*St-o*mt-m*Nt)*it,n[2]=(W*Ye-J*Ce+re*Se)*it,n[3]=(Z*Ce-F*Ye-q*Se)*it,n[4]=(E*bt-g*mt-z*ct)*it,n[5]=(i*mt-h*bt+m*ct)*it,n[6]=(J*ce-Y*Ye-re*oe)*it,n[7]=(R*Ye-Z*ce+q*oe)*it,n[8]=(g*St-w*bt+z*_t)*it,n[9]=(o*bt-i*St-m*_t)*it,n[10]=(Y*Ce-W*ce+re*xe)*it,n[11]=(F*ce-R*Ce-q*xe)*it,n[12]=(w*ct-g*Nt-E*_t)*it,n[13]=(i*Nt-o*ct+h*_t)*it,n[14]=(W*oe-Y*Se-J*xe)*it,n[15]=(R*Se-F*oe+Z*xe)*it,n):null},D.aC=Je,D.aD=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},D.aE=function(n){return n[0]=0,n[1]=0,n},D.aF=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},D.aG=bm,D.aH=oi,D.aI=function(n,e,i,o){const h=e.y-n.y,m=e.x-n.x,g=o.y-i.y,w=o.x-i.x,E=g*m-w*h;if(E===0)return null;const z=(w*(n.y-i.y)-g*(n.x-i.x))/E;return new V(n.x+z*m,n.y+z*h)},D.aJ=r,D.aK=ch,D.aL=function(n){let e=1/0,i=1/0,o=-1/0,h=-1/0;for(const m of n)e=Math.min(e,m.x),i=Math.min(i,m.y),o=Math.max(o,m.x),h=Math.max(h,m.y);return[e,i,o,h]},D.aM=Zr,D.aN=lt,D.aO=function(n,e,i,o,h=!1){if(!i[0]&&!i[1])return[0,0];const m=h?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(m){const g=Math.sin(m),w=Math.cos(m);i=[i[0]*w-i[1]*g,i[0]*g+i[1]*w]}return[h?i[0]:lt(e,i[0],n.zoom),h?i[1]:lt(e,i[1],n.zoom)]},D.aQ=hp,D.aR=Ym,D.aS=_m,D.aT=iy,D.aU=Yn,D.aV=$d,D.aW=he,D.aX=Bt,D.aY=Ke,D.aZ=cn,D.a_=Am,D.aa=Eu,D.ab=25,D.ac=da,D.ad=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const h=window.document.createElement("source");ft(o)||(e.crossOrigin="Anonymous"),h.src=o,e.appendChild(h)}}))},D.ae=Qe,D.af=function(){return Ai++},D.ag=p,D.ah=ld,D.ai=bf,D.aj=Zt,D.ak=vo,D.al=vp,D.am=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,h,m)=>{const g=h||m;return e[o]=!g||g.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},D.an=Lt,D.ao=85.051129,D.ap=Ei,D.aq=function(n){return Math.pow(2,n)},D.ar=Rt,D.as=Hg,D.at=function(n){return Math.log(n)/Math.LN2},D.au=function(n){var e=n[0],i=n[1];return e*e+i*i},D.av=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((E=>E.canonical.z)));let i=1/0,o=-1/0,h=1/0,m=-1/0;const g=[];for(const E of n){const{x:z,y:R,z:F}=E.canonical,Z=Math.pow(2,e-F),q=z*Z,Y=R*Z;g.push({id:E,x:q,y:Y}),q<i&&(i=q),q>o&&(o=q),Y<h&&(h=Y),Y>m&&(m=Y)}const w=new Set;for(const E of g)E.x!==i&&E.x!==o&&E.y!==h&&E.y!==m||w.add(E.id);return w},D.aw=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},D.ax=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const h={value:e,timeout:void 0};if(i!==void 0&&(h.timeout=setTimeout((()=>{this.remove(n,h)}),i)),this.data[o].push(h),this.order.push(o),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),h=this.data[i][o];return this.data[i].splice(o,1),h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(h.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},D.ay=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:m,maxZoom:g}=n,w=h?Lt(tr.interpolationFactor(h,e,m,g),0,1):0;n.kind==="camera"?o=zn.number(n.minSize,n.maxSize,w):i=w}return{uSizeT:i,uSize:o}},D.b=Lr,D.b$=yo,D.b0=jt,D.b1=function(n){var e=new Fe(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},D.b2=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},D.b3=function(n,e){var i=e[0],o=e[1],h=e[2],m=i*i+o*o+h*h;return m>0&&(m=1/Math.sqrt(m)),n[0]=e[0]*m,n[1]=e[1]*m,n[2]=e[2]*m,n},D.b4=Ot,D.b5=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},D.b6=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},D.b7=rt,D.b8=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},D.b9=si,D.bA=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},D.bB=ze,D.bC=function(n,e,i){var o=i[0],h=i[1],m=i[2],g=i[3],w=e[0],E=e[1],z=e[2],R=h*z-m*E,F=m*w-o*z,Z=o*E-h*w;return n[0]=w+g*(R+=R)+h*(Z+=Z)-m*(F+=F),n[1]=E+g*F+m*R-o*Z,n[2]=z+g*Z+o*F-h*R,n},D.bD=function(n,e,i){const o=(function(E){var z=E[3],R=E[4],F=E[5],Z=E[6],q=E[7],Y=E[8];return E[0]*(Y*R-F*q)+E[1]*(-Y*z+F*Z)+E[2]*(q*z-R*Z)})([n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const h=Ot([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),m=Ot([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),g=Ot([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),w=Ht([],h,-n[3]);return jt(w,w,Ht([],m,-e[3])),jt(w,w,Ht([],g,-i[3])),Ht(w,w,1/o),w},D.bE=_p,D.bF=function(){return new Float64Array(4)},D.bG=function(n,e,i,o){var h=[],m=[];return h[0]=e[0]-i[0],h[1]=e[1]-i[1],h[2]=e[2]-i[2],m[0]=h[0]*Math.cos(o)-h[1]*Math.sin(o),m[1]=h[0]*Math.sin(o)+h[1]*Math.cos(o),m[2]=h[2],n[0]=m[0]+i[0],n[1]=m[1]+i[1],n[2]=m[2]+i[2],n},D.bH=function(n,e,i,o){var h=[],m=[];return h[0]=e[0]-i[0],h[1]=e[1]-i[1],h[2]=e[2]-i[2],m[0]=h[0],m[1]=h[1]*Math.cos(o)-h[2]*Math.sin(o),m[2]=h[1]*Math.sin(o)+h[2]*Math.cos(o),n[0]=m[0]+i[0],n[1]=m[1]+i[1],n[2]=m[2]+i[2],n},D.bI=function(n,e,i,o){var h=[],m=[];return h[0]=e[0]-i[0],h[1]=e[1]-i[1],h[2]=e[2]-i[2],m[0]=h[2]*Math.sin(o)+h[0]*Math.cos(o),m[1]=h[1],m[2]=h[2]*Math.cos(o)-h[0]*Math.sin(o),n[0]=m[0]+i[0],n[1]=m[1]+i[1],n[2]=m[2]+i[2],n},D.bJ=function(n,e,i){var o=Math.sin(i),h=Math.cos(i),m=e[0],g=e[1],w=e[2],E=e[3],z=e[8],R=e[9],F=e[10],Z=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*h-z*o,n[1]=g*h-R*o,n[2]=w*h-F*o,n[3]=E*h-Z*o,n[8]=m*o+z*h,n[9]=g*o+R*h,n[10]=w*o+F*h,n[11]=E*o+Z*h,n},D.bK=function(n,e){const i=_e(n,360),o=_e(e,360),h=o-i,m=o>i?h-360:h+360;return Math.abs(h)<Math.abs(m)?h:m},D.bL=function(n){return n[0]=0,n[1]=0,n[2]=0,n},D.bM=function(n,e,i,o){const h=Math.sqrt(n*n+e*e),m=Math.sqrt(i*i+o*o);n/=h,e/=h,i/=m,o/=m;const g=Math.acos(n*i+e*o);return-e*i+n*o>0?g:-g},D.bN=function(n,e){const i=_e(n,2*Math.PI),o=_e(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},D.bO=function(){const n={},e=$e.$version;for(const i in $e.$root){const o=$e.$root[i];if(o.required){let h=null;h=i==="version"?e:o.type==="array"?[]:{},h!=null&&(n[i]=h)}}return n},D.bP=qe,D.bQ=Zh,D.bR=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},D.bS=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=er(n[i],e[n[i].ref]));return n},D.bT=function(n,e){if(n.type==="custom")return new Sm(n,e);switch(n.type){case"background":return new en(n,e);case"circle":return new qf(n,e);case"color-relief":return new vg(n,e);case"fill":return new Sg(n,e);case"fill-extrusion":return new um(n,e);case"heatmap":return new _g(n,e);case"hillshade":return new dr(n,e);case"line":return new dm(n,e);case"raster":return new Sl(n,e);case"symbol":return new Su(n,e)}},D.bU=n=>n.type==="raster",D.bV=tn,D.bW=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!pi(n.version,e.version))return[{command:"setStyle",args:[e]}];pi(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),pi(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),pi(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),pi(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),pi(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),pi(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),pi(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),pi(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),pi(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),pi(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),pi(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),pi(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),pi(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),pi(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},h=[];(function(g,w,E,z){let R;for(R in w=w||{},g=g||{})Object.prototype.hasOwnProperty.call(g,R)&&(Object.prototype.hasOwnProperty.call(w,R)||ji(R,E,z));for(R in w)Object.prototype.hasOwnProperty.call(w,R)&&(Object.prototype.hasOwnProperty.call(g,R)?pi(g[R],w[R])||(g[R].type==="geojson"&&w[R].type==="geojson"&&sn(g,w,R)?Ki(E,{command:"setGeoJSONSourceData",args:[R,w[R].data]}):Ln(R,w,E,z)):un(R,w,E))})(n.sources,e.sources,h,o);const m=[];n.layers&&n.layers.forEach((g=>{"source"in g&&o[g.source]?i.push({command:"removeLayer",args:[g.id]}):m.push(g)})),i=i.concat(h),(function(g,w,E){w=w||[];const z=(g=g||[]).map(Ol),R=w.map(Ol),F=g.reduce(qr,{}),Z=w.reduce(qr,{}),q=z.slice(),Y=Object.create(null);let W,J,re,xe,oe;for(let ce=0,Se=0;ce<z.length;ce++)W=z[ce],Object.prototype.hasOwnProperty.call(Z,W)?Se++:(Ki(E,{command:"removeLayer",args:[W]}),q.splice(q.indexOf(W,Se),1));for(let ce=0,Se=0;ce<R.length;ce++)W=R[R.length-1-ce],q[q.length-1-ce]!==W&&(Object.prototype.hasOwnProperty.call(F,W)?(Ki(E,{command:"removeLayer",args:[W]}),q.splice(q.lastIndexOf(W,q.length-Se),1)):Se++,xe=q[q.length-ce],Ki(E,{command:"addLayer",args:[Z[W],xe]}),q.splice(q.length-ce,0,W),Y[W]=!0);for(let ce=0;ce<R.length;ce++)if(W=R[ce],J=F[W],re=Z[W],!Y[W]&&!pi(J,re))if(pi(J.source,re.source)&&pi(J["source-layer"],re["source-layer"])&&pi(J.type,re.type)){for(oe in sr(J.layout,re.layout,E,W,null,"setLayoutProperty"),sr(J.paint,re.paint,E,W,null,"setPaintProperty"),pi(J.filter,re.filter)||Ki(E,{command:"setFilter",args:[W,re.filter]}),pi(J.minzoom,re.minzoom)&&pi(J.maxzoom,re.maxzoom)||Ki(E,{command:"setLayerZoomRange",args:[W,re.minzoom,re.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?sr(J[oe],re[oe],E,W,oe.slice(6),"setPaintProperty"):pi(J[oe],re[oe])||Ki(E,{command:"setLayerProperty",args:[W,oe,re[oe]]}));for(oe in re)Object.prototype.hasOwnProperty.call(re,oe)&&!Object.prototype.hasOwnProperty.call(J,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?sr(J[oe],re[oe],E,W,oe.slice(6),"setPaintProperty"):pi(J[oe],re[oe])||Ki(E,{command:"setLayerProperty",args:[W,oe,re[oe]]}))}else Ki(E,{command:"removeLayer",args:[W]}),xe=q[q.lastIndexOf(W)+1],Ki(E,{command:"addLayer",args:[re,xe]})})(m,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},D.bX=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},D.bY=mn,D.bZ=vr,D.b_=class extends Ya{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},D.ba=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},D.bb=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},D.bc=Xg,D.bd=ud,D.be=function(n,e,i,o,h){var m=1/Math.tan(e/2);if(n[0]=m/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0){var g=1/(o-h);n[10]=(h+o)*g,n[14]=2*h*o*g}else n[10]=-1,n[14]=-2*o;return n},D.bf=function(n){var e=new Fe(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},D.bg=function(n,e,i){var o=Math.sin(i),h=Math.cos(i),m=e[0],g=e[1],w=e[2],E=e[3],z=e[4],R=e[5],F=e[6],Z=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*h+z*o,n[1]=g*h+R*o,n[2]=w*h+F*o,n[3]=E*h+Z*o,n[4]=z*h-m*o,n[5]=R*h-g*o,n[6]=F*h-w*o,n[7]=Z*h-E*o,n},D.bh=function(n,e,i){var o=Math.sin(i),h=Math.cos(i),m=e[4],g=e[5],w=e[6],E=e[7],z=e[8],R=e[9],F=e[10],Z=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=m*h+z*o,n[5]=g*h+R*o,n[6]=w*h+F*o,n[7]=E*h+Z*o,n[8]=z*h-m*o,n[9]=R*h-g*o,n[10]=F*h-w*o,n[11]=Z*h-E*o,n},D.bi=function(){const n=new Float32Array(16);return Rt(n),n},D.bj=function(){const n=new Float64Array(16);return Rt(n),n},D.bk=function(){return new Float64Array(16)},D.bl=function(n,e,i){const o=new Float64Array(4);return ze(o,n,e-90,i),o},D.bm=function(n,e,i,o){var h,m,g,w,E,z=e[0],R=e[1],F=e[2],Z=e[3],q=i[0],Y=i[1],W=i[2],J=i[3];return(m=z*q+R*Y+F*W+Z*J)<0&&(m=-m,q=-q,Y=-Y,W=-W,J=-J),1-m>ut?(h=Math.acos(m),g=Math.sin(h),w=Math.sin((1-o)*h)/g,E=Math.sin(o*h)/g):(w=1-o,E=o),n[0]=w*z+E*q,n[1]=w*R+E*Y,n[2]=w*F+E*W,n[3]=w*Z+E*J,n},D.bn=function(n){const e=new Float64Array(9);(function(m,g){var w=g[0],E=g[1],z=g[2],R=g[3],F=w+w,Z=E+E,q=z+z,Y=w*F,W=E*F,J=E*Z,re=z*F,xe=z*Z,oe=z*q,ce=R*F,Se=R*Z,Ce=R*q;m[0]=1-J-oe,m[3]=W-Ce,m[6]=re+Se,m[1]=W+Ce,m[4]=1-Y-oe,m[7]=xe-ce,m[2]=re-Se,m[5]=xe+ce,m[8]=1-Y-J})(e,n);const i=cn(-Math.asin(Lt(e[2],-1,1)));let o,h;return Math.hypot(e[5],e[8])<.001?(o=0,h=-cn(Math.atan2(e[3],e[4]))):(o=cn(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),h=cn(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:h}},D.bo=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},D.bp=bi,D.bq=Ic,D.br=qs,D.bs=Pl,D.bt=ha,D.bu=Ue,D.bv=yt,D.bw=Rn,D.bx=function(n,e,i,o,h){return Ue(o,h,Lt((n-e)/(i-e),0,1))},D.by=_e,D.bz=function(){return new Float64Array(3)},D.c=we,D.c$=function(n,e,i,o,h){return u(this,void 0,void 0,(function*(){if(He())try{return yield Jt(n,e,i,o,h)}catch{}return(function(m,g,w,E,z){const R=m.width,F=m.height;li&&fi||(li=new OffscreenCanvas(R,F),fi=li.getContext("2d",{willReadFrequently:!0})),li.width=R,li.height=F,fi.drawImage(m,0,0,R,F);const Z=fi.getImageData(g,w,E,z);return fi.clearRect(0,0,R,F),Z.data})(n,e,i,o,h)}))},D.c0=class extends Ya{constructor(n,e){super(n,e),this.current=Wa}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},D.c1=yu,D.c2=class extends Ya{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},D.c3=class extends Ya{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},D.c4=Ut,D.c5=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},D.c6=function(n,e,i){var o=e[0],h=e[1],m=e[2];return n[0]=o*i[0]+h*i[3]+m*i[6],n[1]=o*i[1]+h*i[4]+m*i[7],n[2]=o*i[2]+h*i[5]+m*i[8],n},D.c7=function(n,e,i,o,h,m,g){var w=1/(e-i),E=1/(o-h),z=1/(m-g);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*E,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*z,n[11]=0,n[12]=(e+i)*w,n[13]=(h+o)*E,n[14]=(g+m)*z,n[15]=1,n},D.c8=class extends Ya{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},D.c9=class extends Ya{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},D.cA=function(n,e){return Re[e]&&"touches"in n},D.cB=function(n){return Re[n]||Q[n]},D.cC=function(n,e,i){var o=e[0],h=e[1];return n[0]=i[0]*o+i[4]*h+i[12],n[1]=i[1]*o+i[5]*h+i[13],n},D.cD=function(n,e){const{x:i,y:o}=bn.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},D.cE=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},D.cF=class extends Cc{},D.cG=r1,D.cI=Ie,D.cJ=function(n,e){we.REGISTERED_PROTOCOLS[n]=e},D.cK=function(n){delete we.REGISTERED_PROTOCOLS[n]},D.cL=function(n,e){const i={};for(let h=0;h<n.length;h++){const m=e&&e[n[h].id]||lo(n[h]);e&&(e[n[h].id]=m);let g=i[m];g||(g=i[m]=[]),g.push(n[h])}const o=[];for(const h in i)o.push(i[h]);return o},D.cM=qt,D.cN=Pm,D.cO=Xm,D.cP=lp,D.cQ=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Et/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new _n(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new _n(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new _n(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:R}=n.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new _n(z),n.canonical),o["text-size"].possiblyEvaluate(new _n(R),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:R}=n.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new _n(z),n.canonical),o["icon-size"].possiblyEvaluate(new _n(R),n.canonical)]}const m=i.get("text-line-height")*Zr,g=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",w=i.get("text-keep-upright"),E=i.get("text-size");for(const z of n.bucket.features){const R=i.get("text-font").evaluate(z,{},n.canonical).join(","),F=E.evaluate(z,{},n.canonical),Z=h.layoutTextSize.evaluate(z,{},n.canonical),q=h.layoutIconSize.evaluate(z,{},n.canonical),Y={horizontal:{},vertical:void 0},W=z.text;let J,re=[0,0];if(W){const ce=W.toString(),Se=i.get("text-letter-spacing").evaluate(z,{},n.canonical)*Zr,Ce=qh(ce)?Se:0,Ye=i.get("text-anchor").evaluate(z,{},n.canonical),_t=Hc(e,z,n.canonical);if(!_t){const St=i.get("text-radial-offset").evaluate(z,{},n.canonical);re=St?vn(Ye,[St*Zr,Yi]):i.get("text-offset").evaluate(z,{},n.canonical).map((mt=>mt*Zr))}let ct=g?"center":i.get("text-justify").evaluate(z,{},n.canonical);const bt=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(z,{},n.canonical)*Zr:1/0,Nt=()=>{n.bucket.allowVerticalPlacement&&Go(ce)&&(Y.vertical=ef(W,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,m,Ye,"left",Ce,re,D.az.vertical,!0,Z,F))};if(!g&&_t){const St=new Set;if(ct==="auto")for(let it=0;it<_t.values.length;it+=2)St.add(Ym(_t.values[it]));else St.add(ct);let mt=!1;for(const it of St)if(!Y.horizontal[it])if(mt)Y.horizontal[it]=Y.horizontal[0];else{const Wt=ef(W,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,m,"center",it,Ce,re,D.az.horizontal,!1,Z,F);Wt&&(Y.horizontal[it]=Wt,mt=Wt.positionedLines.length===1)}Nt()}else{ct==="auto"&&(ct=Ym(Ye));const St=ef(W,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,m,Ye,ct,Ce,re,D.az.horizontal,!1,Z,F);St&&(Y.horizontal[ct]=St),Nt(),Go(ce)&&g&&w&&(Y.vertical=ef(W,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,m,Ye,ct,Ce,re,D.az.vertical,!1,Z,F))}}let xe=!1;if(z.icon&&z.icon.name){const ce=n.imageMap[z.icon.name];ce&&(J=vm(n.imagePositions[z.icon.name],i.get("icon-offset").evaluate(z,{},n.canonical),i.get("icon-anchor").evaluate(z,{},n.canonical)),xe=!!ce.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=xe:n.bucket.sdfIcons!==xe&&Gi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const oe=B0(Y.horizontal)||Y.vertical;n.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||J)&&i1(n.bucket,z,Y,J,n.imageMap,h,Z,q,re,xe,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},D.cR=hh,D.cS=xu,D.cT=td,D.cU=function(n){const e=new ap;return(function(i,o){for(const h in i.layers)o.writeMessage(3,Dp,i.layers[h])})(n,e),e.finish()},D.cV=function(n,e,i,o,h,m){let g=s(n,e,i,h,0);return g=s(g,e,o,m,1),g},D.cW=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},D.cX=Ji,D.cY=ap,D.cZ=xf,D.c_=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},D.ca=class extends Ml{},D.cb=Pg,D.cc=class extends Wn{},D.cd=Fd,D.ce=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},D.cf=tc,D.cg=function(n,e,i){var o=e[0],h=e[1],m=e[2],g=i[3]*o+i[7]*h+i[11]*m+i[15];return n[0]=(i[0]*o+i[4]*h+i[8]*m+i[12])/(g=g||1),n[1]=(i[1]*o+i[5]*h+i[9]*m+i[13])/g,n[2]=(i[2]*o+i[6]*h+i[10]*m+i[14])/g,n},D.ch=class extends Pc{},D.ci=class extends t{},D.cj=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},D.ck=function(n,e){var i=n[0],o=n[1],h=n[2],m=n[3],g=n[4],w=n[5],E=n[6],z=n[7],R=n[8],F=n[9],Z=n[10],q=n[11],Y=n[12],W=n[13],J=n[14],re=n[15],xe=e[0],oe=e[1],ce=e[2],Se=e[3],Ce=e[4],Ye=e[5],_t=e[6],ct=e[7],bt=e[8],Nt=e[9],St=e[10],mt=e[11],it=e[12],Wt=e[13],Gt=e[14],Qt=e[15];return Math.abs(i-xe)<=ut*Math.max(1,Math.abs(i),Math.abs(xe))&&Math.abs(o-oe)<=ut*Math.max(1,Math.abs(o),Math.abs(oe))&&Math.abs(h-ce)<=ut*Math.max(1,Math.abs(h),Math.abs(ce))&&Math.abs(m-Se)<=ut*Math.max(1,Math.abs(m),Math.abs(Se))&&Math.abs(g-Ce)<=ut*Math.max(1,Math.abs(g),Math.abs(Ce))&&Math.abs(w-Ye)<=ut*Math.max(1,Math.abs(w),Math.abs(Ye))&&Math.abs(E-_t)<=ut*Math.max(1,Math.abs(E),Math.abs(_t))&&Math.abs(z-ct)<=ut*Math.max(1,Math.abs(z),Math.abs(ct))&&Math.abs(R-bt)<=ut*Math.max(1,Math.abs(R),Math.abs(bt))&&Math.abs(F-Nt)<=ut*Math.max(1,Math.abs(F),Math.abs(Nt))&&Math.abs(Z-St)<=ut*Math.max(1,Math.abs(Z),Math.abs(St))&&Math.abs(q-mt)<=ut*Math.max(1,Math.abs(q),Math.abs(mt))&&Math.abs(Y-it)<=ut*Math.max(1,Math.abs(Y),Math.abs(it))&&Math.abs(W-Wt)<=ut*Math.max(1,Math.abs(W),Math.abs(Wt))&&Math.abs(J-Gt)<=ut*Math.max(1,Math.abs(J),Math.abs(Gt))&&Math.abs(re-Qt)<=ut*Math.max(1,Math.abs(re),Math.abs(Qt))},D.cl=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},D.cm=n=>n.type==="symbol",D.cn=n=>n.type==="circle",D.co=n=>n.type==="heatmap",D.cp=n=>n.type==="line",D.cq=n=>n.type==="fill",D.cr=n=>n.type==="fill-extrusion",D.cs=n=>n.type==="hillshade",D.ct=n=>n.type==="color-relief",D.cu=n=>n.type==="background",D.cv=n=>n.type==="custom",D.cw=Pt,D.cx=function(n,e,i){const o=st(e.x-i.x,e.y-i.y),h=st(n.x-i.x,n.y-i.y),m=Math.atan2(o[0]*h[1]-o[1]*h[0],(function(g,w){return g[0]*w[0]+g[1]*w[1]})(o,h));return cn(m)},D.cy=Dt,D.cz=function(n,e){return Q[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},D.d=ft,D.d0=Kh,D.d1=te,D.d2=class{constructor(n,e){this.layers={[bf]:this},this.name=bf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new o_(this.features[n],this.extent)}},D.d3=l,D.d4=Ns,D.e=ui,D.f=n=>u(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),D.g=Ze,D.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=pa}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(h):pa})),D.i=Jn,D.j=(n,e)=>gt(ui(n,{type:"json"}),e),D.k=Vi,D.l=hi,D.m=gt,D.n=(n,e)=>gt(ui(n,{type:"arrayBuffer"}),e),D.o=function(n){return new ap(n).readFields(Ng,[])},D.p=gm,D.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},D.r=Nd,D.s=Ci,D.t=gr,D.u=$e,D.v=Yu,D.w=Gi,D.x=Hh,D.y=uo,D.z=Tl})),O("worker",["./shared"],(function(D){class u{constructor(Q,ee){this.keyCache={},Q&&this.replace(Q,ee)}replace(Q,ee){this._layerConfigs={},this._layers={},this.update(Q,[],ee)}update(Q,ee,se){for(const we of Q){this._layerConfigs[we.id]=we;const Ze=this._layers[we.id]=D.bT(we,se);Ze._featureFilter=D.aj(Ze.filter,se),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of ee)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ge=D.cL(Object.values(this._layerConfigs),this.keyCache);for(const we of ge){const Ze=we.map((Ft=>this._layers[Ft.id])),Ne=Ze[0];if(Ne.isHidden())continue;const Ie=Ne.source||"";let qe=this.familiesBySource[Ie];qe||(qe=this.familiesBySource[Ie]={});const gt=Ne.sourceLayer||D.ai;let ft=qe[gt];ft||(ft=qe[gt]=[]),ft.push(Ze)}}}class V{constructor(Q){const ee={},se=[];for(const Ne in Q){const Ie=Q[Ne],qe=ee[Ne]={};for(const gt in Ie){const ft=Ie[+gt];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;const Ft={x:0,y:0,w:ft.bitmap.width+2,h:ft.bitmap.height+2};se.push(Ft),qe[gt]={rect:Ft,metrics:ft.metrics}}}const{w:ge,h:we}=D.p(se),Ze=new D.r({width:ge||1,height:we||1});for(const Ne in Q){const Ie=Q[Ne];for(const qe in Ie){const gt=Ie[+qe];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const ft=ee[Ne][qe].rect;D.r.copy(gt.bitmap,Ze,{x:0,y:0},{x:ft.x+1,y:ft.y+1},gt.bitmap)}}this.image=Ze,this.positions=ee}}D.cM("GlyphAtlas",V);class te{constructor(Q){this.tileID=new D.a2(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId,this.inFlightDependencies=[]}parse(Q,ee,se,ge,we){return D._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Q,this.collisionBoxArray=new D.ag;const Ze=new D.cN(Object.keys(Q.layers).sort()),Ne=new D.cO(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];const Ie={},qe={featureIndex:Ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:se,subdivisionGranularity:we},gt=ee.familiesBySource[this.source];for(const sn in gt){const sr=Q.layers[sn];if(!sr)continue;sr.version===1&&D.w(`Vector tile source "${this.source}" layer "${sn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ol=Ze.encode(sn),qr=[];for(let Qe=0;Qe<sr.length;Qe++){const kr=sr.feature(Qe),Rr=Ne.getId(kr,sn);qr.push({feature:kr,id:Rr,index:Qe,sourceLayerIndex:Ol})}for(const Qe of gt[sn]){const kr=Qe[0];kr.source!==this.source&&D.w(`layer.source = ${kr.source} does not equal this.source = ${this.source}`),kr.isHidden(this.zoom,!0)||(fe(Qe,this.zoom,se),(Ie[kr.id]=kr.createBucket({index:Ne.bucketLayerIDs.length,layers:Qe,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ol,sourceID:this.source})).populate(qr,qe,this.tileID.canonical),Ne.bucketLayerIDs.push(Qe.map((Rr=>Rr.id))))}}const ft=D.bY(qe.glyphDependencies,(sn=>Object.keys(sn).map(Number)));this.inFlightDependencies.forEach((sn=>sn?.abort())),this.inFlightDependencies=[];let Ft=Promise.resolve({});if(Object.keys(ft).length){const sn=new AbortController;this.inFlightDependencies.push(sn),Ft=ge.sendAsync({type:"GG",data:{stacks:ft,source:this.source,tileID:this.tileID,type:"glyphs"}},sn)}const ei=Object.keys(qe.iconDependencies);let hi=Promise.resolve({});if(ei.length){const sn=new AbortController;this.inFlightDependencies.push(sn),hi=ge.sendAsync({type:"GI",data:{icons:ei,source:this.source,tileID:this.tileID,type:"icons"}},sn)}const Vi=Object.keys(qe.patternDependencies);let Di=Promise.resolve({});if(Vi.length){const sn=new AbortController;this.inFlightDependencies.push(sn),Di=ge.sendAsync({type:"GI",data:{icons:Vi,source:this.source,tileID:this.tileID,type:"patterns"}},sn)}const $e=qe.dashDependencies;let Wi=Promise.resolve({});if(Object.keys($e).length){const sn=new AbortController;this.inFlightDependencies.push(sn),Wi=ge.sendAsync({type:"GDA",data:{dashes:$e}},sn)}const[er,pi,Ki,un]=yield Promise.all([Ft,hi,Di,Wi]),ji=new V(er),Ln=new D.cP(pi,Ki);for(const sn in Ie){const sr=Ie[sn];sr instanceof D.ah?(fe(sr.layers,this.zoom,se),D.cQ({bucket:sr,glyphMap:er,glyphPositions:ji.positions,imageMap:pi,imagePositions:Ln.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:qe.subdivisionGranularity})):sr.hasDependencies&&(sr instanceof D.cR||sr instanceof D.cS||sr instanceof D.cT)&&(fe(sr.layers,this.zoom,se),sr.addFeatures(qe,this.tileID.canonical,Ln.patternPositions,un))}return this.status="done",{buckets:Object.values(Ie).filter((sn=>!sn.isEmpty())),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ji.image,imageAtlas:Ln,dashPositions:un,glyphMap:this.returnDependencies?er:null,iconMap:this.returnDependencies?pi:null,glyphPositions:this.returnDependencies?ji.positions:null}}))}}function fe(Re,Q,ee){const se=new D.H(Q);for(const ge of Re)ge.recalculate(se,ee)}class ue{constructor(Q,ee,se,ge,we){this.type=Q,this.properties=se||{},this.extent=we,this.pointsArray=ee,this.id=ge}loadGeometry(){return this.pointsArray.map((Q=>Q.map((ee=>new D.P(ee.x,ee.y)))))}}class De{constructor(Q,ee,se){this.version=2,this._myFeatures=Q,this.name=ee,this.length=Q.length,this.extent=se}feature(Q){return this._myFeatures[Q]}}class Pe{constructor(){this.layers={}}addLayer(Q){this.layers[Q.name]=Q}}function je(Re){let Q=D.cU(Re);return Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),{vectorTile:Re,rawData:Q.buffer}}function be(Re,Q,ee){const{extent:se}=Re,ge=Math.pow(2,ee.z-Q.z),we=(ee.x-Q.x*ge)*se,Ze=(ee.y-Q.y*ge)*se,Ne=[];for(let Ie=0;Ie<Re.length;Ie++){const qe=Re.feature(Ie);let gt=qe.loadGeometry();for(const Ft of gt)for(const ei of Ft)ei.x=ei.x*ge-we,ei.y=ei.y*ge-Ze;const ft=128;gt=D.cV(gt,qe.type,-ft,-ft,se+ft,se+ft),gt.length!==0&&Ne.push(new ue(qe.type,gt,qe.properties,qe.id,se))}return new De(Ne,Re.name,se)}class de{constructor(Q,ee,se){this.actor=Q,this.layerIndex=ee,this.availableImages=se,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new D.cW(1e3)}loadVectorTile(Q,ee){return D._(this,void 0,void 0,(function*(){const se=yield D.n(Q.request,ee);try{return{vectorTile:Q.encoding!=="mlt"?new D.cX(new D.cY(se.data)):new D.cZ(se.data),rawData:se.data,cacheControl:se.cacheControl,expires:se.expires}}catch(ge){const we=new Uint8Array(se.data);let Ze=`Unable to parse the tile at ${Q.request.url}, `;throw Ze+=we[0]===31&&we[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ge.message}`,new Error(Ze)}}))}loadTile(Q){return D._(this,void 0,void 0,(function*(){const{uid:ee,overzoomParameters:se}=Q;se&&(Q.request=se.overzoomRequest);const ge=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new D.c_(Q.request),we=new te(Q);this.loading[ee]=we;const Ze=new AbortController;we.abort=Ze;try{const Ne=yield this.loadVectorTile(Q,Ze);if(delete this.loading[ee],!Ne)return null;if(se){const Ft=this._getOverzoomTile(Q,Ne.vectorTile);Ne.rawData=Ft.rawData,Ne.vectorTile=Ft.vectorTile}const Ie=Ne.rawData,qe={};Ne.expires&&(qe.expires=Ne.expires),Ne.cacheControl&&(qe.cacheControl=Ne.cacheControl);const gt={};if(ge){const Ft=ge.finish();Ft&&(gt.resourceTiming=JSON.parse(JSON.stringify(Ft)))}we.vectorTile=Ne.vectorTile;const ft=we.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);this.loaded[ee]=we,this.fetching[ee]={rawTileData:Ie,cacheControl:qe,resourceTiming:gt};try{const Ft=yield ft;return D.e({rawTileData:Ie.slice(0),encoding:Q.encoding},Ft,qe,gt)}finally{delete this.fetching[ee]}}catch(Ne){throw delete this.loading[ee],we.status="done",this.loaded[ee]=we,Ne}}))}_getOverzoomTile(Q,ee){const{tileID:se,source:ge,overzoomParameters:we}=Q,{maxZoomTileID:Ze}=we,Ne=`${Ze.key}_${se.key}`,Ie=this.overzoomedTileResultCache.get(Ne);if(Ie)return Ie;const qe=new Pe,gt=this.layerIndex.familiesBySource[ge];for(const Ft in gt){const ei=ee.layers[Ft];if(!ei)continue;const hi=be(ei,Ze,se.canonical);hi.length>0&&qe.addLayer(hi)}const ft=je(qe);return this.overzoomedTileResultCache.set(Ne,ft),ft}reloadTile(Q){return D._(this,void 0,void 0,(function*(){const ee=Q.uid;if(!this.loaded||!this.loaded[ee])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const se=this.loaded[ee];if(se.showCollisionBoxes=Q.showCollisionBoxes,se.status==="parsing"){const ge=yield se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity);let we;if(this.fetching[ee]){const{rawTileData:Ze,cacheControl:Ne,resourceTiming:Ie}=this.fetching[ee];delete this.fetching[ee],we=D.e({rawTileData:Ze.slice(0),encoding:Q.encoding},ge,Ne,Ie)}else we=ge;return we}if(se.status==="done"&&se.vectorTile)return se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,Q.subdivisionGranularity)}))}abortTile(Q){return D._(this,void 0,void 0,(function*(){const ee=this.loading,se=Q.uid;ee&&ee[se]&&ee[se].abort&&(ee[se].abort.abort(),delete ee[se])}))}removeTile(Q){return D._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Q.uid]&&delete this.loaded[Q.uid]}))}}class He{constructor(){this.loaded={}}loadTile(Q){return D._(this,void 0,void 0,(function*(){const{uid:ee,encoding:se,rawImageData:ge,redFactor:we,greenFactor:Ze,blueFactor:Ne,baseShift:Ie}=Q,qe=ge.width+2,gt=ge.height+2,ft=D.b(ge)?new D.R({width:qe,height:gt},yield D.c$(ge,-1,-1,qe,gt)):ge,Ft=new D.d0(ee,ft,se,we,Ze,Ne,Ie);return this.loaded=this.loaded||{},this.loaded[ee]=Ft,Ft}))}removeTile(Q){const ee=this.loaded,se=Q.uid;ee&&ee[se]&&delete ee[se]}}var ut,Fe,Ut=(function(){if(Fe)return ut;function Re(ee,se){if(ee.length!==0){Q(ee[0],se);for(var ge=1;ge<ee.length;ge++)Q(ee[ge],!se)}}function Q(ee,se){for(var ge=0,we=0,Ze=0,Ne=ee.length,Ie=Ne-1;Ze<Ne;Ie=Ze++){var qe=(ee[Ze][0]-ee[Ie][0])*(ee[Ie][1]+ee[Ze][1]),gt=ge+qe;we+=Math.abs(ge)>=Math.abs(qe)?ge-gt+qe:qe-gt+ge,ge=gt}ge+we>=0!=!!se&&ee.reverse()}return Fe=1,ut=function ee(se,ge){var we,Ze=se&&se.type;if(Ze==="FeatureCollection")for(we=0;we<se.features.length;we++)ee(se.features[we],ge);else if(Ze==="GeometryCollection")for(we=0;we<se.geometries.length;we++)ee(se.geometries[we],ge);else if(Ze==="Feature")ee(se.geometry,ge);else if(Ze==="Polygon")Re(se.coordinates,ge);else if(Ze==="MultiPolygon")for(we=0;we<se.coordinates.length;we++)Re(se.coordinates[we],ge);return se}})(),Rt=D.d1(Ut);const dt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},rt=Math.fround||(Ct=new Float32Array(1),Re=>(Ct[0]=+Re,Ct[0]));var Ct;class jt{constructor(Q){this.options=Object.assign(Object.create(dt),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ee,minZoom:se,maxZoom:ge}=this.options;ee&&console.time("total time");const we=`prepare ${Q.length} points`;ee&&console.time(we),this.points=Q;const Ze=[];for(let Ie=0;Ie<Q.length;Ie++){const qe=Q[Ie];if(!qe.geometry)continue;const[gt,ft]=qe.geometry.coordinates,Ft=rt(Yt(gt)),ei=rt(si(ft));Ze.push(Ft,ei,1/0,Ie,-1,1),this.options.reduce&&Ze.push(0)}let Ne=this.trees[ge+1]=this._createTree(Ze);ee&&console.timeEnd(we);for(let Ie=ge;Ie>=se;Ie--){const qe=+Date.now();Ne=this.trees[Ie]=this._createTree(this._cluster(Ne,Ie)),ee&&console.log("z%d: %d clusters in %dms",Ie,Ne.numItems,+Date.now()-qe)}return ee&&console.timeEnd("total time"),this}getClusters(Q,ee){let se=((Q[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,Q[1]));let we=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)se=-180,we=180;else if(se>we){const ft=this.getClusters([se,ge,180,Ze],ee),Ft=this.getClusters([-180,ge,we,Ze],ee);return ft.concat(Ft)}const Ne=this.trees[this._limitZoom(ee)],Ie=Ne.range(Yt(se),si(Ze),Yt(we),si(ge)),qe=Ne.data,gt=[];for(const ft of Ie){const Ft=this.stride*ft;gt.push(qe[Ft+5]>1?Ht(qe,Ft,this.clusterProps):this.points[qe[Ft+3]])}return gt}getChildren(Q){const ee=this._getOriginId(Q),se=this._getOriginZoom(Q),ge="No cluster with the specified id.",we=this.trees[se];if(!we)throw new Error(ge);const Ze=we.data;if(ee*this.stride>=Ze.length)throw new Error(ge);const Ne=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Ie=we.within(Ze[ee*this.stride],Ze[ee*this.stride+1],Ne),qe=[];for(const gt of Ie){const ft=gt*this.stride;Ze[ft+4]===Q&&qe.push(Ze[ft+5]>1?Ht(Ze,ft,this.clusterProps):this.points[Ze[ft+3]])}if(qe.length===0)throw new Error(ge);return qe}getLeaves(Q,ee,se){const ge=[];return this._appendLeaves(ge,Q,ee=ee||10,se=se||0,0),ge}getTile(Q,ee,se){const ge=this.trees[this._limitZoom(Q)],we=Math.pow(2,Q),{extent:Ze,radius:Ne}=this.options,Ie=Ne/Ze,qe=(se-Ie)/we,gt=(se+1+Ie)/we,ft={features:[]};return this._addTileFeatures(ge.range((ee-Ie)/we,qe,(ee+1+Ie)/we,gt),ge.data,ee,se,we,ft),ee===0&&this._addTileFeatures(ge.range(1-Ie/we,qe,1,gt),ge.data,we,se,we,ft),ee===we-1&&this._addTileFeatures(ge.range(0,qe,Ie/we,gt),ge.data,-1,se,we,ft),ft.features.length?ft:null}getClusterExpansionZoom(Q){let ee=this._getOriginZoom(Q)-1;for(;ee<=this.options.maxZoom;){const se=this.getChildren(Q);if(ee++,se.length!==1)break;Q=se[0].properties.cluster_id}return ee}_appendLeaves(Q,ee,se,ge,we){const Ze=this.getChildren(ee);for(const Ne of Ze){const Ie=Ne.properties;if(Ie&&Ie.cluster?we+Ie.point_count<=ge?we+=Ie.point_count:we=this._appendLeaves(Q,Ie.cluster_id,se,ge,we):we<ge?we++:Q.push(Ne),Q.length===se)break}return we}_createTree(Q){const ee=new D.aT(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<Q.length;se+=this.stride)ee.add(Q[se],Q[se+1]);return ee.finish(),ee.data=Q,ee}_addTileFeatures(Q,ee,se,ge,we,Ze){for(const Ne of Q){const Ie=Ne*this.stride,qe=ee[Ie+5]>1;let gt,ft,Ft;if(qe)gt=Ot(ee,Ie,this.clusterProps),ft=ee[Ie],Ft=ee[Ie+1];else{const Vi=this.points[ee[Ie+3]];gt=Vi.properties;const[Di,$e]=Vi.geometry.coordinates;ft=Yt(Di),Ft=si($e)}const ei={type:1,geometry:[[Math.round(this.options.extent*(ft*we-se)),Math.round(this.options.extent*(Ft*we-ge))]],tags:gt};let hi;hi=qe||this.options.generateId?ee[Ie+3]:this.points[ee[Ie+3]].id,hi!==void 0&&(ei.id=hi),Ze.features.push(ei)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ee){const{radius:se,extent:ge,reduce:we,minPoints:Ze}=this.options,Ne=se/(ge*Math.pow(2,ee)),Ie=Q.data,qe=[],gt=this.stride;for(let ft=0;ft<Ie.length;ft+=gt){if(Ie[ft+2]<=ee)continue;Ie[ft+2]=ee;const Ft=Ie[ft],ei=Ie[ft+1],hi=Q.within(Ie[ft],Ie[ft+1],Ne),Vi=Ie[ft+5];let Di=Vi;for(const $e of hi){const Wi=$e*gt;Ie[Wi+2]>ee&&(Di+=Ie[Wi+5])}if(Di>Vi&&Di>=Ze){let $e,Wi=Ft*Vi,er=ei*Vi,pi=-1;const Ki=(ft/gt<<5)+(ee+1)+this.points.length;for(const un of hi){const ji=un*gt;if(Ie[ji+2]<=ee)continue;Ie[ji+2]=ee;const Ln=Ie[ji+5];Wi+=Ie[ji]*Ln,er+=Ie[ji+1]*Ln,Ie[ji+4]=Ki,we&&($e||($e=this._map(Ie,ft,!0),pi=this.clusterProps.length,this.clusterProps.push($e)),we($e,this._map(Ie,ji)))}Ie[ft+4]=Ki,qe.push(Wi/Di,er/Di,1/0,Ki,-1,Di),we&&qe.push(pi)}else{for(let $e=0;$e<gt;$e++)qe.push(Ie[ft+$e]);if(Di>1)for(const $e of hi){const Wi=$e*gt;if(!(Ie[Wi+2]<=ee)){Ie[Wi+2]=ee;for(let er=0;er<gt;er++)qe.push(Ie[Wi+er])}}}}return qe}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ee,se){if(Q[ee+5]>1){const Ze=this.clusterProps[Q[ee+6]];return se?Object.assign({},Ze):Ze}const ge=this.points[Q[ee+3]].properties,we=this.options.map(ge);return se&&we===ge?Object.assign({},we):we}}function Ht(Re,Q,ee){return{type:"Feature",id:Re[Q+3],properties:Ot(Re,Q,ee),geometry:{type:"Point",coordinates:[(se=Re[Q],360*(se-.5)),oi(Re[Q+1])]}};var se}function Ot(Re,Q,ee){const se=Re[Q+5],ge=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,we=Re[Q+6],Ze=we===-1?{}:Object.assign({},ee[we]);return Object.assign(Ze,{cluster:!0,cluster_id:Re[Q+3],point_count:se,point_count_abbreviated:ge})}function Yt(Re){return Re/360+.5}function si(Re){const Q=Math.sin(Re*Math.PI/180),ee=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ee<0?0:ee>1?1:ee}function oi(Re){const Q=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function wt(Re,Q,ee,se){let ge=se;const we=Q+(ee-Q>>1);let Ze,Ne=ee-Q;const Ie=Re[Q],qe=Re[Q+1],gt=Re[ee],ft=Re[ee+1];for(let Ft=Q+3;Ft<ee;Ft+=3){const ei=ze(Re[Ft],Re[Ft+1],Ie,qe,gt,ft);if(ei>ge)Ze=Ft,ge=ei;else if(ei===ge){const hi=Math.abs(Ft-we);hi<Ne&&(Ze=Ft,Ne=hi)}}ge>se&&(Ze-Q>3&&wt(Re,Q,Ze,se),Re[Ze+2]=ge,ee-Ze>3&&wt(Re,Ze,ee,se))}function ze(Re,Q,ee,se,ge,we){let Ze=ge-ee,Ne=we-se;if(Ze!==0||Ne!==0){const Ie=((Re-ee)*Ze+(Q-se)*Ne)/(Ze*Ze+Ne*Ne);Ie>1?(ee=ge,se=we):Ie>0&&(ee+=Ze*Ie,se+=Ne*Ie)}return Ze=Re-ee,Ne=Q-se,Ze*Ze+Ne*Ne}function Je(Re,Q,ee,se){const ge={id:Re??null,type:Q,geometry:ee,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")st(ge,ee);else if(Q==="Polygon")st(ge,ee[0]);else if(Q==="MultiLineString")for(const we of ee)st(ge,we);else if(Q==="MultiPolygon")for(const we of ee)st(ge,we[0]);return ge}function st(Re,Q){for(let ee=0;ee<Q.length;ee+=3)Re.minX=Math.min(Re.minX,Q[ee]),Re.minY=Math.min(Re.minY,Q[ee+1]),Re.maxX=Math.max(Re.maxX,Q[ee]),Re.maxY=Math.max(Re.maxY,Q[ee+1])}function Et(Re,Q,ee,se){if(!Q.geometry)return;const ge=Q.geometry.coordinates;if(ge&&ge.length===0)return;const we=Q.geometry.type,Ze=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let Ne=[],Ie=Q.id;if(ee.promoteId?Ie=Q.properties[ee.promoteId]:ee.generateId&&(Ie=se||0),we==="Point")lt(ge,Ne);else if(we==="MultiPoint")for(const qe of ge)lt(qe,Ne);else if(we==="LineString")_e(ge,Ne,Ze,!1);else if(we==="MultiLineString"){if(ee.lineMetrics){for(const qe of ge)Ne=[],_e(qe,Ne,Ze,!1),Re.push(Je(Ie,"LineString",Ne,Q.properties));return}Ue(ge,Ne,Ze,!1)}else if(we==="Polygon")Ue(ge,Ne,Ze,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const qe of Q.geometry.geometries)Et(Re,{id:Ie,geometry:qe,properties:Q.properties},ee,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of ge){const gt=[];Ue(qe,gt,Ze,!0),Ne.push(gt)}}Re.push(Je(Ie,we,Ne,Q.properties))}function lt(Re,Q){Q.push(yt(Re[0]),Pt(Re[1]),0)}function _e(Re,Q,ee,se){let ge,we,Ze=0;for(let Ie=0;Ie<Re.length;Ie++){const qe=yt(Re[Ie][0]),gt=Pt(Re[Ie][1]);Q.push(qe,gt,0),Ie>0&&(Ze+=se?(ge*gt-qe*we)/2:Math.sqrt(Math.pow(qe-ge,2)+Math.pow(gt-we,2))),ge=qe,we=gt}const Ne=Q.length-3;Q[2]=1,wt(Q,0,Ne,ee),Q[Ne+2]=1,Q.size=Math.abs(Ze),Q.start=0,Q.end=Q.size}function Ue(Re,Q,ee,se){for(let ge=0;ge<Re.length;ge++){const we=[];_e(Re[ge],we,ee,se),Q.push(we)}}function yt(Re){return Re/360+.5}function Pt(Re){const Q=Math.sin(Re*Math.PI/180),ee=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ee<0?0:ee>1?1:ee}function Dt(Re,Q,ee,se,ge,we,Ze,Ne){if(se/=Q,we>=(ee/=Q)&&Ze<se)return Re;if(Ze<ee||we>=se)return null;const Ie=[];for(const qe of Re){const gt=qe.geometry;let ft=qe.type;const Ft=ge===0?qe.minX:qe.minY,ei=ge===0?qe.maxX:qe.maxY;if(Ft>=ee&&ei<se){Ie.push(qe);continue}if(ei<ee||Ft>=se)continue;let hi=[];if(ft==="Point"||ft==="MultiPoint")Lt(gt,hi,ee,se,ge);else if(ft==="LineString")Kt(gt,hi,ee,se,ge,!1,Ne.lineMetrics);else if(ft==="MultiLineString")Ai(gt,hi,ee,se,ge,!1);else if(ft==="Polygon")Ai(gt,hi,ee,se,ge,!0);else if(ft==="MultiPolygon")for(const Vi of gt){const Di=[];Ai(Vi,Di,ee,se,ge,!0),Di.length&&hi.push(Di)}if(hi.length){if(Ne.lineMetrics&&ft==="LineString"){for(const Vi of hi)Ie.push(Je(qe.id,ft,Vi,qe.tags));continue}ft!=="LineString"&&ft!=="MultiLineString"||(hi.length===1?(ft="LineString",hi=hi[0]):ft="MultiLineString"),ft!=="Point"&&ft!=="MultiPoint"||(ft=hi.length===3?"Point":"MultiPoint"),Ie.push(Je(qe.id,ft,hi,qe.tags))}}return Ie.length?Ie:null}function Lt(Re,Q,ee,se,ge){for(let we=0;we<Re.length;we+=3){const Ze=Re[we+ge];Ze>=ee&&Ze<=se&&mn(Q,Re[we],Re[we+1],Re[we+2])}}function Kt(Re,Q,ee,se,ge,we,Ze){let Ne=ui(Re);const Ie=ge===0?vr:tn;let qe,gt,ft=Re.start;for(let Di=0;Di<Re.length-3;Di+=3){const $e=Re[Di],Wi=Re[Di+1],er=Re[Di+2],pi=Re[Di+3],Ki=Re[Di+4],un=ge===0?$e:Wi,ji=ge===0?pi:Ki;let Ln=!1;Ze&&(qe=Math.sqrt(Math.pow($e-pi,2)+Math.pow(Wi-Ki,2))),un<ee?ji>ee&&(gt=Ie(Ne,$e,Wi,pi,Ki,ee),Ze&&(Ne.start=ft+qe*gt)):un>se?ji<se&&(gt=Ie(Ne,$e,Wi,pi,Ki,se),Ze&&(Ne.start=ft+qe*gt)):mn(Ne,$e,Wi,er),ji<ee&&un>=ee&&(gt=Ie(Ne,$e,Wi,pi,Ki,ee),Ln=!0),ji>se&&un<=se&&(gt=Ie(Ne,$e,Wi,pi,Ki,se),Ln=!0),!we&&Ln&&(Ze&&(Ne.end=ft+qe*gt),Q.push(Ne),Ne=ui(Re)),Ze&&(ft+=qe)}let Ft=Re.length-3;const ei=Re[Ft],hi=Re[Ft+1],Vi=ge===0?ei:hi;Vi>=ee&&Vi<=se&&mn(Ne,ei,hi,Re[Ft+2]),Ft=Ne.length-3,we&&Ft>=3&&(Ne[Ft]!==Ne[0]||Ne[Ft+1]!==Ne[1])&&mn(Ne,Ne[0],Ne[1],Ne[2]),Ne.length&&Q.push(Ne)}function ui(Re){const Q=[];return Q.size=Re.size,Q.start=Re.start,Q.end=Re.end,Q}function Ai(Re,Q,ee,se,ge,we){for(const Ze of Re)Kt(Ze,Q,ee,se,ge,we,!1)}function mn(Re,Q,ee,se){Re.push(Q,ee,se)}function vr(Re,Q,ee,se,ge,we){const Ze=(we-Q)/(se-Q);return mn(Re,we,ee+(ge-ee)*Ze,1),Ze}function tn(Re,Q,ee,se,ge,we){const Ze=(we-ee)/(ge-ee);return mn(Re,Q+(se-Q)*Ze,we,1),Ze}function ar(Re,Q){const ee=[];for(let se=0;se<Re.length;se++){const ge=Re[se],we=ge.type;let Ze;if(we==="Point"||we==="MultiPoint"||we==="LineString")Ze=Gi(ge.geometry,Q);else if(we==="MultiLineString"||we==="Polygon"){Ze=[];for(const Ne of ge.geometry)Ze.push(Gi(Ne,Q))}else if(we==="MultiPolygon"){Ze=[];for(const Ne of ge.geometry){const Ie=[];for(const qe of Ne)Ie.push(Gi(qe,Q));Ze.push(Ie)}}ee.push(Je(ge.id,we,Ze,ge.tags))}return ee}function Gi(Re,Q){const ee=[];ee.size=Re.size,Re.start!==void 0&&(ee.start=Re.start,ee.end=Re.end);for(let se=0;se<Re.length;se+=3)ee.push(Re[se]+Q,Re[se+1],Re[se+2]);return ee}function Fn(Re,Q){if(Re.transformed)return Re;const ee=1<<Re.z,se=Re.x,ge=Re.y;for(const we of Re.features){const Ze=we.geometry,Ne=we.type;if(we.geometry=[],Ne===1)for(let Ie=0;Ie<Ze.length;Ie+=2)we.geometry.push(Jn(Ze[Ie],Ze[Ie+1],Q,ee,se,ge));else for(let Ie=0;Ie<Ze.length;Ie++){const qe=[];for(let gt=0;gt<Ze[Ie].length;gt+=2)qe.push(Jn(Ze[Ie][gt],Ze[Ie][gt+1],Q,ee,se,ge));we.geometry.push(qe)}}return Re.transformed=!0,Re}function Jn(Re,Q,ee,se,ge,we){return[Math.round(ee*(Re*se-ge)),Math.round(ee*(Q*se-we))]}function ln(Re,Q,ee,se,ge){const we=Q===ge.maxZoom?0:ge.tolerance/((1<<Q)*ge.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:ee,y:se,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ne of Re)Lr(Ze,Ne,we,ge);return Ze}function Lr(Re,Q,ee,se){const ge=Q.geometry,we=Q.type,Ze=[];if(Re.minX=Math.min(Re.minX,Q.minX),Re.minY=Math.min(Re.minY,Q.minY),Re.maxX=Math.max(Re.maxX,Q.maxX),Re.maxY=Math.max(Re.maxY,Q.maxY),we==="Point"||we==="MultiPoint")for(let Ne=0;Ne<ge.length;Ne+=3)Ze.push(ge[Ne],ge[Ne+1]),Re.numPoints++,Re.numSimplified++;else if(we==="LineString")pa(Ze,ge,Re,ee,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Ne=0;Ne<ge.length;Ne++)pa(Ze,ge[Ne],Re,ee,we==="Polygon",Ne===0);else if(we==="MultiPolygon")for(let Ne=0;Ne<ge.length;Ne++){const Ie=ge[Ne];for(let qe=0;qe<Ie.length;qe++)pa(Ze,Ie[qe],Re,ee,!0,qe===0)}if(Ze.length){let Ne=Q.tags||null;if(we==="LineString"&&se.lineMetrics){Ne={};for(const qe in Q.tags)Ne[qe]=Q.tags[qe];Ne.mapbox_clip_start=ge.start/ge.size,Ne.mapbox_clip_end=ge.end/ge.size}const Ie={geometry:Ze,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Ne};Q.id!==null&&(Ie.id=Q.id),Re.features.push(Ie)}}function pa(Re,Q,ee,se,ge,we){const Ze=se*se;if(se>0&&Q.size<(ge?Ze:se))return void(ee.numPoints+=Q.length/3);const Ne=[];for(let Ie=0;Ie<Q.length;Ie+=3)(se===0||Q[Ie+2]>Ze)&&(ee.numSimplified++,Ne.push(Q[Ie],Q[Ie+1])),ee.numPoints++;ge&&(function(Ie,qe){let gt=0;for(let ft=0,Ft=Ie.length,ei=Ft-2;ft<Ft;ei=ft,ft+=2)gt+=(Ie[ft]-Ie[ei])*(Ie[ft+1]+Ie[ei+1]);if(gt>0===qe)for(let ft=0,Ft=Ie.length;ft<Ft/2;ft+=2){const ei=Ie[ft],hi=Ie[ft+1];Ie[ft]=Ie[Ft-2-ft],Ie[ft+1]=Ie[Ft-1-ft],Ie[Ft-2-ft]=ei,Ie[Ft-1-ft]=hi}})(Ne,we),Re.push(Ne)}const Jt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class li{constructor(Q,ee){const se=(ee=this.options=(function(we,Ze){for(const Ne in Ze)we[Ne]=Ze[Ne];return we})(Object.create(Jt),ee)).debug;if(se&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let ge=(function(we,Ze){const Ne=[];if(we.type==="FeatureCollection")for(let Ie=0;Ie<we.features.length;Ie++)Et(Ne,we.features[Ie],Ze,Ie);else Et(Ne,we.type==="Feature"?we:{geometry:we},Ze);return Ne})(Q,ee);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=(function(we,Ze){const Ne=Ze.buffer/Ze.extent;let Ie=we;const qe=Dt(we,1,-1-Ne,Ne,0,-1,2,Ze),gt=Dt(we,1,1-Ne,2+Ne,0,-1,2,Ze);return(qe||gt)&&(Ie=Dt(we,1,-Ne,1+Ne,0,-1,2,Ze)||[],qe&&(Ie=ar(qe,1).concat(Ie)),gt&&(Ie=Ie.concat(ar(gt,-1)))),Ie})(ge,ee),ge.length&&this.splitTile(ge,0,0,0),se&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,ee,se,ge,we,Ze,Ne){const Ie=[Q,ee,se,ge],qe=this.options,gt=qe.debug;for(;Ie.length;){ge=Ie.pop(),se=Ie.pop(),ee=Ie.pop(),Q=Ie.pop();const ft=1<<ee,Ft=fi(ee,se,ge);let ei=this.tiles[Ft];if(!ei&&(gt>1&&console.time("creation"),ei=this.tiles[Ft]=ln(Q,ee,se,ge,qe),this.tileCoords.push({z:ee,x:se,y:ge}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,se,ge,ei.numFeatures,ei.numPoints,ei.numSimplified),console.timeEnd("creation"));const Ln=`z${ee}`;this.stats[Ln]=(this.stats[Ln]||0)+1,this.total++}if(ei.source=Q,we==null){if(ee===qe.indexMaxZoom||ei.numPoints<=qe.indexMaxPoints)continue}else{if(ee===qe.maxZoom||ee===we)continue;if(we!=null){const Ln=we-ee;if(se!==Ze>>Ln||ge!==Ne>>Ln)continue}}if(ei.source=null,Q.length===0)continue;gt>1&&console.time("clipping");const hi=.5*qe.buffer/qe.extent,Vi=.5-hi,Di=.5+hi,$e=1+hi;let Wi=null,er=null,pi=null,Ki=null,un=Dt(Q,ft,se-hi,se+Di,0,ei.minX,ei.maxX,qe),ji=Dt(Q,ft,se+Vi,se+$e,0,ei.minX,ei.maxX,qe);Q=null,un&&(Wi=Dt(un,ft,ge-hi,ge+Di,1,ei.minY,ei.maxY,qe),er=Dt(un,ft,ge+Vi,ge+$e,1,ei.minY,ei.maxY,qe),un=null),ji&&(pi=Dt(ji,ft,ge-hi,ge+Di,1,ei.minY,ei.maxY,qe),Ki=Dt(ji,ft,ge+Vi,ge+$e,1,ei.minY,ei.maxY,qe),ji=null),gt>1&&console.timeEnd("clipping"),Ie.push(Wi||[],ee+1,2*se,2*ge),Ie.push(er||[],ee+1,2*se,2*ge+1),Ie.push(pi||[],ee+1,2*se+1,2*ge),Ie.push(Ki||[],ee+1,2*se+1,2*ge+1)}}getTile(Q,ee,se){Q=+Q,ee=+ee,se=+se;const ge=this.options,{extent:we,debug:Ze}=ge;if(Q<0||Q>24)return null;const Ne=1<<Q,Ie=fi(Q,ee=ee+Ne&Ne-1,se);if(this.tiles[Ie])return Fn(this.tiles[Ie],we);Ze>1&&console.log("drilling down to z%d-%d-%d",Q,ee,se);let qe,gt=Q,ft=ee,Ft=se;for(;!qe&&gt>0;)gt--,ft>>=1,Ft>>=1,qe=this.tiles[fi(gt,ft,Ft)];return qe&&qe.source?(Ze>1&&(console.log("found parent tile z%d-%d-%d",gt,ft,Ft),console.time("drilling down")),this.splitTile(qe.source,gt,ft,Ft,Q,ee,se),Ze>1&&console.timeEnd("drilling down"),this.tiles[Ie]?Fn(this.tiles[Ie],we):null):null}}function fi(Re,Q,ee){return 32*((1<<Re)*ee+Q)+Re}class Ci extends de{constructor(Q,ee,se,ge=Ei){super(Q,ee,se),this._dataUpdateable=new Map,this._createGeoJSONIndex=ge}loadVectorTile(Q,ee){return D._(this,void 0,void 0,(function*(){const se=Q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ge=this._geoJSONIndex.getTile(se.z,se.x,se.y);return ge?je(new D.d2(ge.features,{version:2,extent:D.a5})):null}))}loadData(Q){return D._(this,void 0,void 0,(function*(){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.abort();const se=this._startPerformance(Q);this._pendingRequest=new AbortController;try{(!this._pendingData||Q.request||Q.data||Q.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Q,this._pendingRequest));const ge=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ge,Q),this.loaded={};const we={};return Q.request&&(we.data=ge),this._finishPerformance(se,Q,we),we}catch(ge){if(delete this._pendingRequest,D.Z(ge))return{abandoned:!0};throw ge}}))}_startPerformance(Q){var ee;if(!((ee=Q?.request)===null||ee===void 0)&&ee.collectResourceTiming)return new D.c_(Q.request)}_finishPerformance(Q,ee,se){if(!Q)return;const ge=Q.finish();ge&&(se.resourceTiming={},se.resourceTiming[ee.source]=JSON.parse(JSON.stringify(ge)))}getData(){return D._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Q){const ee=this.loaded;return ee&&ee[Q.uid]?super.reloadTile(Q):this.loadTile(Q)}loadAndProcessGeoJSON(Q,ee){return D._(this,void 0,void 0,(function*(){let se;if(Q.request?se=yield this.loadGeoJSONFromUrl(Q.request,Q.promoteId,ee):Q.data?se=this._loadGeoJSONFromObject(Q.data,Q.promoteId):Q.dataDiff&&(se=this._loadGeoJSONFromDiff(Q.dataDiff,Q.promoteId,Q.source)),delete this._pendingRequest,typeof se!="object")throw new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`);return Rt(se,!0),Q.filter&&(se=this._filterGeoJSON(se,Q.filter)),se}))}loadGeoJSONFromUrl(Q,ee,se){return D._(this,void 0,void 0,(function*(){const ge=yield D.j(Q,se);return this._dataUpdateable=D.a7(ge.data,ee),ge.data}))}_loadGeoJSONFromObject(Q,ee){return this._dataUpdateable=D.a7(Q,ee),Q}_loadGeoJSONFromDiff(Q,ee,se){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${se}`);D.a8(this._dataUpdateable,Q,ee);const ge=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ge)}_filterGeoJSON(Q,ee){const se=D.d3(ee,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map((we=>`${we.key}: ${we.message}`)).join(", "));const ge=Q.features.filter((we=>se.value.evaluate({zoom:0},we)));return this._toFeatureCollection(ge)}_toFeatureCollection(Q){return{type:"FeatureCollection",features:Q}}removeSource(Q){return D._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Q){return this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId)}getClusterChildren(Q){return this._geoJSONIndex.getChildren(Q.clusterId)}getClusterLeaves(Q){return this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset)}}function Ei(Re,Q){return Q.cluster?new jt((function({superclusterOptions:ee,clusterProperties:se}){if(!se||!ee)return ee;const ge={},we={},Ze={accumulated:null,zoom:0},Ne={properties:null},Ie=Object.keys(se);for(const qe of Ie){const[gt,ft]=se[qe],Ft=D.d3(ft),ei=D.d3(typeof gt=="string"?[gt,["accumulated"],["get",qe]]:gt);ge[qe]=Ft.value,we[qe]=ei.value}return ee.map=qe=>{Ne.properties=qe;const gt={};for(const ft of Ie)gt[ft]=ge[ft].evaluate(Ze,Ne);return gt},ee.reduce=(qe,gt)=>{Ne.properties=gt;for(const ft of Ie)Ze.accumulated=qe[ft],qe[ft]=we[ft].evaluate(Ze,Ne)},ee})(Q)).load(Re.features):(function(ee,se){return new li(ee,se)})(Re,Q.geojsonVtOptions)}class cn{constructor(Q){this.self=Q,this.actor=new D.L(Q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ee,se)=>{if(this.externalWorkerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.externalWorkerSourceTypes[ee]=se},this.self.addProtocol=D.cJ,this.self.removeProtocol=D.cK,this.self.registerRTLTextPlugin=ee=>{D.d4.setMethods(ee)},this.actor.registerMessageHandler("LDT",((ee,se)=>this._getDEMWorkerSource(ee,se.source).loadTile(se))),this.actor.registerMessageHandler("RDT",((ee,se)=>D._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ee,se.source).removeTile(se)})))),this.actor.registerMessageHandler("GCEZ",((ee,se)=>D._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,se.type,se.source).getClusterExpansionZoom(se)})))),this.actor.registerMessageHandler("GCC",((ee,se)=>D._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,se.type,se.source).getClusterChildren(se)})))),this.actor.registerMessageHandler("GCL",((ee,se)=>D._(this,void 0,void 0,(function*(){return this._getWorkerSource(ee,se.type,se.source).getClusterLeaves(se)})))),this.actor.registerMessageHandler("LD",((ee,se)=>this._getWorkerSource(ee,se.type,se.source).loadData(se))),this.actor.registerMessageHandler("GD",((ee,se)=>this._getWorkerSource(ee,se.type,se.source).getData())),this.actor.registerMessageHandler("LT",((ee,se)=>this._getWorkerSource(ee,se.type,se.source).loadTile(se))),this.actor.registerMessageHandler("RT",((ee,se)=>this._getWorkerSource(ee,se.type,se.source).reloadTile(se))),this.actor.registerMessageHandler("AT",((ee,se)=>this._getWorkerSource(ee,se.type,se.source).abortTile(se))),this.actor.registerMessageHandler("RMT",((ee,se)=>this._getWorkerSource(ee,se.type,se.source).removeTile(se))),this.actor.registerMessageHandler("RS",((ee,se)=>D._(this,void 0,void 0,(function*(){if(!this.workerSources[ee]||!this.workerSources[ee][se.type]||!this.workerSources[ee][se.type][se.source])return;const ge=this.workerSources[ee][se.type][se.source];delete this.workerSources[ee][se.type][se.source],ge.removeSource!==void 0&&ge.removeSource(se)})))),this.actor.registerMessageHandler("RM",(ee=>D._(this,void 0,void 0,(function*(){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee],this.globalStates.delete(ee)})))),this.actor.registerMessageHandler("SR",((ee,se)=>D._(this,void 0,void 0,(function*(){this.referrer=se})))),this.actor.registerMessageHandler("SRPS",((ee,se)=>this._syncRTLPluginState(ee,se))),this.actor.registerMessageHandler("IS",((ee,se)=>D._(this,void 0,void 0,(function*(){this.self.importScripts(se)})))),this.actor.registerMessageHandler("SI",((ee,se)=>this._setImages(ee,se))),this.actor.registerMessageHandler("UL",((ee,se)=>D._(this,void 0,void 0,(function*(){this._getLayerIndex(ee).update(se.layers,se.removedIds,this._getGlobalState(ee))})))),this.actor.registerMessageHandler("UGS",((ee,se)=>D._(this,void 0,void 0,(function*(){const ge=this._getGlobalState(ee);for(const we in se)ge[we]=se[we]})))),this.actor.registerMessageHandler("SL",((ee,se)=>D._(this,void 0,void 0,(function*(){this._getLayerIndex(ee).replace(se,this._getGlobalState(ee))}))))}_getGlobalState(Q){let ee=this.globalStates.get(Q);return ee||(ee={},this.globalStates.set(Q,ee)),ee}_setImages(Q,ee){return D._(this,void 0,void 0,(function*(){this.availableImages[Q]=ee;for(const se in this.workerSources[Q]){const ge=this.workerSources[Q][se];for(const we in ge)ge[we].availableImages=ee}}))}_syncRTLPluginState(Q,ee){return D._(this,void 0,void 0,(function*(){return yield D.d4.syncState(ee,this.self.importScripts)}))}_getAvailableImages(Q){let ee=this.availableImages[Q];return ee||(ee=[]),ee}_getLayerIndex(Q){let ee=this.layerIndexes[Q];return ee||(ee=this.layerIndexes[Q]=new u),ee}_getWorkerSource(Q,ee,se){if(this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ee]||(this.workerSources[Q][ee]={}),!this.workerSources[Q][ee][se]){const ge={sendAsync:(we,Ze)=>(we.targetMapId=Q,this.actor.sendAsync(we,Ze))};switch(ee){case"vector":this.workerSources[Q][ee][se]=new de(ge,this._getLayerIndex(Q),this._getAvailableImages(Q));break;case"geojson":this.workerSources[Q][ee][se]=new Ci(ge,this._getLayerIndex(Q),this._getAvailableImages(Q));break;default:this.workerSources[Q][ee][se]=new this.externalWorkerSourceTypes[ee](ge,this._getLayerIndex(Q),this._getAvailableImages(Q))}}return this.workerSources[Q][ee][se]}_getDEMWorkerSource(Q,ee){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ee]||(this.demWorkerSources[Q][ee]=new He),this.demWorkerSources[Q][ee]}}return D.i(self)&&(self.worker=new cn(self)),cn})),O("index",["exports","./shared"],(function(D,u){var V="5.15.0";function te(){var y=new u.A(4);return u.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let fe,ue,De;const Pe={frame(y,t,a){const c=requestAnimationFrame((b=>{p(),t(b)})),{unsubscribe:p}=u.s(y.signal,"abort",(()=>{p(),cancelAnimationFrame(c),a(new u.a(y.signal.reason))}),!1)},frameAsync(y){return new Promise(((t,a)=>{this.frame(y,t,a)}))},getImageData(y,t=0){return this.getImageCanvasContext(y).getImageData(-t,-t,y.width+2*t,y.height+2*t)},getImageCanvasContext(y){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=y.width,t.height=y.height,a.drawImage(y,0,0,y.width,y.height),a},resolveURL:y=>(fe||(fe=document.createElement("a")),fe.href=y,fe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return De!==void 0?De:!!matchMedia&&(ue==null&&(ue=matchMedia("(prefers-reduced-motion: reduce)")),ue.matches)},set prefersReducedMotion(y){De=y}},je=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(y){this._frozenAt=y}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function be(){return je.getCurrentTime()}class de{static testProp(t){if(!de.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in de.docStyle)return t[a];return t[0]}static create(t,a,c){const p=window.document.createElement(t);return a!==void 0&&(p.className=a),c&&c.appendChild(p),p}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){de.docStyle&&de.selectProp&&(de.userSelect=de.docStyle[de.selectProp],de.docStyle[de.selectProp]="none")}static enableDrag(){de.docStyle&&de.selectProp&&(de.docStyle[de.selectProp]=de.userSelect)}static setTransform(t,a){t.style[de.transformProp]=a}static addEventListener(t,a,c,p={}){t.addEventListener(a,c,"passive"in p?p:p.capture)}static removeEventListener(t,a,c,p={}){t.removeEventListener(a,c,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",de.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",de.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",de.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,c){const p=a.boundingClientRect;return new u.P((c.clientX-p.left)/a.x-t.clientLeft,(c.clientY-p.top)/a.y-t.clientTop)}static mousePos(t,a){const c=de.getScale(t);return de.getPoint(t,c,a)}static touchPos(t,a){const c=[],p=de.getScale(t);for(let b=0;b<a.length;b++)c.push(de.getPoint(t,p,a[b]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(const p of c)p.remove();return de.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const c of a)de.removeAttributes(c),de.clean(c)}static removeAttributes(t){for(const{name:a,value:c}of t.attributes)de.isPossiblyDangerous(a,c)&&t.removeAttribute(a)}}de.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,de.selectProp=de.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),de.transformProp=de.testProp(["transform","WebkitTransform"]);const He={supported:!1,testSupport:function(y){!Ut&&Fe&&(Rt?dt(y):ut=y)}};let ut,Fe,Ut=!1,Rt=!1;function dt(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,Fe),y.isContextLost())return;He.supported=!0}catch{}y.deleteTexture(t),Ut=!0}var rt;typeof document<"u"&&(Fe=document.createElement("img"),Fe.onload=()=>{ut&&dt(ut),ut=null,Rt=!0},Fe.onerror=()=>{Ut=!0,ut=null},Fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(y){let t,a,c,p;y.resetRequestQueue=()=>{t=[],a=0,c=0,p={}},y.addThrottleControl=I=>{const N=c++;return p[N]=I,N},y.removeThrottleControl=I=>{delete p[I],S()},y.getImage=(I,N,U=!0)=>new Promise((($,G)=>{He.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),u.e(I,{type:"image"}),t.push({abortController:N,requestParameters:I,supportImageRefresh:U,state:"queued",onError:K=>{G(K)},onSuccess:K=>{$(K)}}),S()}));const b=I=>u._(this,void 0,void 0,(function*(){I.state="running";const{requestParameters:N,supportImageRefresh:U,onError:$,onSuccess:G,abortController:K}=I,ie=U===!1&&!u.i(self)&&!u.g(N.url)&&(!N.headers||Object.keys(N.headers).reduce(((pe,ve)=>pe&&ve==="accept"),!0));a++;const he=ie?C(N,K):u.m(N,K);try{const pe=yield he;delete I.abortController,I.state="completed",pe.data instanceof HTMLImageElement||u.b(pe.data)?G(pe):pe.data&&G({data:yield(me=pe.data,typeof createImageBitmap=="function"?u.f(me):u.h(me)),cacheControl:pe.cacheControl,expires:pe.expires})}catch(pe){delete I.abortController,$(pe)}finally{a--,S()}var me})),S=()=>{const I=(()=>{for(const N of Object.keys(p))if(p[N]())return!0;return!1})()?u.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let N=a;N<I&&t.length>0;N++){const U=t.shift();U.abortController.signal.aborted?N--:b(U)}},C=(I,N)=>new Promise(((U,$)=>{const G=new Image,K=I.url,ie=I.credentials;ie&&ie==="include"?G.crossOrigin="use-credentials":(ie&&ie==="same-origin"||!u.d(K))&&(G.crossOrigin="anonymous"),N.signal.addEventListener("abort",(()=>{G.src="",$(new u.a(N.signal.reason))})),G.fetchPriority="high",G.onload=()=>{G.onerror=G.onload=null,U({data:G})},G.onerror=()=>{G.onerror=G.onload=null,N.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},G.src=K}))})(rt||(rt={})),rt.resetRequestQueue();class Ct{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function jt(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const a=[];for(const{id:c,url:p}of y){const b=`${c}${p}`;a.indexOf(b)===-1&&(a.push(b),t.push({id:c,url:p}))}}return t}function Ht(y,t,a){try{const c=new URL(y);return c.pathname+=`${t}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Ot(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class Yt extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new u.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const p=a.data||a.spriteData;return this._validateStretch(a.stretchX,p&&p.width)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,p&&p.height)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const p of t){if(p[0]<c||p[1]<p[0]||a<p[1])return!1;c=p[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,p=c&&c.width||a.data.width,b=c&&c.height||a.data.height;return!(t[0]<0||p<t[0]||t[1]<0||b<t[1]||t[2]<0||p<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const p=this.getImage(t);if(c&&(p.data.width!==a.data.width||p.data.height!==a.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=p.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,c)=>{let p=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(p=!1);this.isLoaded()||p?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const c of t){let p=this.getImage(c);p||(this.fire(new u.l("styleimagemissing",{id:c})),p=this.getImage(c)),p?a[c]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:u.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},b=new u.I(p,c);this.patterns[t]={bin:p,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:a,h:c}=u.p(t),p=this.atlasImage;p.resize({width:a||1,height:c||1});for(const b in this.patterns){const{bin:S}=this.patterns[b],C=S.x+1,I=S.y+1,N=this.getImage(b).data,U=N.width,$=N.height;u.R.copy(N,p,{x:0,y:0},{x:C,y:I},{width:U,height:$}),u.R.copy(N,p,{x:0,y:$-1},{x:C,y:I-1},{width:U,height:1}),u.R.copy(N,p,{x:0,y:0},{x:C,y:I+$},{width:U,height:1}),u.R.copy(N,p,{x:U-1,y:0},{x:C-1,y:I},{width:1,height:$}),u.R.copy(N,p,{x:0,y:0},{x:C+U,y:I},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||u.w(`Image with ID: "${a}" was not found`),Ot(c)&&this.updateImage(a,c)}}cloneImages(){const t={};for(const a in this.images){const c=this.images[a];t[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return t}}const si=1e20;function oi(y,t,a,c,p,b,S,C,I){for(let N=t;N<t+c;N++)wt(y,a*b+N,b,p,S,C,I);for(let N=a;N<a+p;N++)wt(y,N*b+t,1,c,S,C,I)}function wt(y,t,a,c,p,b,S){b[0]=0,S[0]=-si,S[1]=si,p[0]=y[t];for(let C=1,I=0,N=0;C<c;C++){p[C]=y[t+C*a];const U=C*C;do{const $=b[I];N=(p[C]-p[$]+U-$*$)/(C-$)/2}while(N<=S[I]&&--I>-1);I++,b[I]=C,S[I]=N,S[I+1]=si}for(let C=0,I=0;C<c;C++){for(;S[I+1]<C;)I++;const N=b[I],U=C-N;y[t+C*a]=p[N]+U*U}}const ze=u.v.layout_symbol["text-font"].default.join(",");class Je{constructor(t,a,c){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(t){this.url=t}getGlyphs(t){return u._(this,void 0,void 0,(function*(){const a=[];for(const b in t)for(const S of t[b])a.push(this._getAndCacheGlyphsPromise(b,S));const c=yield Promise.all(a),p={};for(const{stack:b,id:S,glyph:C}of c)p[b]||(p[b]={}),p[b][S]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return p}))}_getAndCacheGlyphsPromise(t,a){return u._(this,void 0,void 0,(function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let p=c.glyphs[a];return p!==void 0?{stack:t,id:a,glyph:p}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(p=c.glyphs[a]=this._drawGlyph(c,t,a),{stack:t,id:a,glyph:p}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return u._(this,void 0,void 0,(function*(){const c=this.entries[t],p=Math.floor(a/256);if(c.ranges[p])return{stack:t,id:a,glyph:null};if(!c.requests[p]){const b=Je.loadGlyphRange(t,p,this.url,this.requestManager);c.requests[p]=b}try{const b=yield c.requests[p];for(const S in b)c.glyphs[+S]=b[+S];return c.ranges[p]=!0,{stack:t,id:a,glyph:b[a]||null}}catch(b){const S=c.glyphs[a]=this._drawGlyph(c,t,a);return this._warnOnMissingGlyphRange(S,p,a,b),{stack:t,id:a,glyph:S}}}))}_warnOnMissingGlyphRange(t,a,c,p){const b=256*a,S=b+255,C=c.toString(16).padStart(4,"0").toUpperCase();u.w(`Unable to load glyph range ${a}, ${b}-${S}. Rendering codepoint U+${C} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&u.q(t)}_drawGlyph(t,a,c){const p=a===ze&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),b=p?"ideographTinySDF":"tinySDF";t[b]||(t[b]=this._createTinySDF(p?this.localIdeographFontFamily:a));const S=t[b].draw(String.fromCodePoint(c));return{id:c,bitmap:new u.r({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const c=a.map((p=>/[-\w]+/.test(p)?p:`'${CSS.escape(p)}'`)).join(",");return new Je.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[p,b]of Object.entries(a))new RegExp(`\\b${p}\\b`,"i").test(t)&&(c=`${b}`);return c}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}Je.loadGlyphRange=function(y,t,a,c){return u._(this,void 0,void 0,(function*(){const p=256*t,b=p+255,S=c.transformRequest(a.replace("{fontstack}",y).replace("{range}",`${p}-${b}`),"Glyphs"),C=yield u.n(S,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${t}, ${p}-${b}`);const I={};for(const N of u.o(C.data))I[N.id]=N;return I}))},Je.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:b="normal",fontStyle:S="normal",lang:C=null}={}){this.buffer=t,this.cutoff=c,this.radius=a,this.lang=C;const I=this.size=y+4*t,N=this._createCanvas(I),U=this.ctx=N.getContext("2d",{willReadFrequently:!0});U.font=`${S} ${b} ${y}px ${p}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:b}=this.ctx.measureText(y),S=Math.ceil(a),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-p))),I=Math.min(this.size-this.buffer,S+Math.ceil(c)),N=C+2*this.buffer,U=I+2*this.buffer,$=Math.max(N*U,0),G=new Uint8ClampedArray($),K={data:G,width:N,height:U,glyphWidth:C,glyphHeight:I,glyphTop:S,glyphLeft:0,glyphAdvance:t};if(C===0||I===0)return K;const{ctx:ie,buffer:he,gridInner:me,gridOuter:pe}=this;this.lang&&(ie.lang=this.lang),ie.clearRect(he,he,C,I),ie.fillText(y,he,he+S);const ve=ie.getImageData(he,he,C,I);pe.fill(si,0,$),me.fill(0,0,$);for(let Me=0;Me<I;Me++)for(let ye=0;ye<C;ye++){const Ee=ve.data[4*(Me*C+ye)+3]/255;if(Ee===0)continue;const Le=(Me+he)*N+ye+he;if(Ee===1)pe[Le]=0,me[Le]=si;else{const Te=.5-Ee;pe[Le]=Te>0?Te*Te:0,me[Le]=Te<0?Te*Te:0}}oi(pe,0,0,N,U,N,this.f,this.v,this.z),oi(me,he,he,C,I,N,this.f,this.v,this.z);for(let Me=0;Me<$;Me++){const ye=Math.sqrt(pe[Me])-Math.sqrt(me[Me]);G[Me]=Math.round(255-255*(ye/this.radius+this.cutoff))}return K}};class st{constructor(){this.specification=u.u.light.position}possiblyEvaluate(t,a){return u.F(t.expression.evaluate(a))}interpolate(t,a,c){return{x:u.G.number(t.x,a.x,c),y:u.G.number(t.y,a.y,c),z:u.G.number(t.z,a.z,c)}}}let Et;class lt extends u.E{constructor(t){super(),Et=Et||new u.t({anchor:new u.D(u.u.light.anchor),position:new st,color:new u.D(u.u.light.color),intensity:new u.D(u.u.light.intensity)}),this._transitionable=new u.x(Et,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(u.y,t,a))for(const c in t){const p=t[c];c.endsWith(u.z)?this._transitionable.setTransition(c.slice(0,-u.z.length),p):this._transitionable.setValue(c,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&u.B(this,t.call(u.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.u}))}}const _e=new u.t({"sky-color":new u.D(u.u.sky["sky-color"]),"horizon-color":new u.D(u.u.sky["horizon-color"]),"fog-color":new u.D(u.u.sky["fog-color"]),"fog-ground-blend":new u.D(u.u.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.u.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.u.sky["atmosphere-blend"])});class Ue extends u.E{constructor(t){super(),this._transitionable=new u.x(_e,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.H(0))}setSky(t,a={}){if(!this._validate(u.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const p=t[c];c.endsWith(u.z)?this._transitionable.setTransition(c.slice(0,-u.z.length),p):this._transitionable.setValue(c,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c={}){return c?.validate!==!1&&u.B(this,t.call(u.C,u.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class yt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const p=[];let b=t.length%2==1?-t[t.length-1]*c:0,S=t[0]*c,C=!0;p.push({left:b,right:S,isDash:C,zeroLength:t[0]===0});let I=t[0];for(let N=1;N<t.length;N++){C=!C;const U=t[N];b=I*c,I+=U,S=I*c,p.push({left:b,right:S,isDash:C,zeroLength:U===0})}return p}addRoundDash(t,a,c){const p=a/2;for(let b=-c;b<=c;b++){const S=this.width*(this.nextRow+c+b);let C=0,I=t[C];for(let N=0;N<this.width;N++){N/I.right>1&&(I=t[++C]);const U=Math.abs(N-I.left),$=Math.abs(N-I.right),G=Math.min(U,$);let K;const ie=b/c*(p+1);if(I.isDash){const he=p-Math.abs(ie);K=Math.sqrt(G*G+he*he)}else K=p-Math.sqrt(G*G+ie*ie);this.data[S+N]=Math.max(0,Math.min(255,K+128))}}}addRegularDash(t){for(let C=t.length-1;C>=0;--C){const I=t[C],N=t[C+1];I.zeroLength?t.splice(C,1):N&&N.isDash===I.isDash&&(N.left=I.left,t.splice(C,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const p=this.width*this.nextRow;let b=0,S=t[b];for(let C=0;C<this.width;C++){C/S.right>1&&(S=t[++b]);const I=Math.abs(C-S.left),N=Math.abs(C-S.right),U=Math.min(I,N);this.data[p+C]=Math.max(0,Math.min(255,(S.isDash?U:-U)+128))}}addDash(t,a){const c=a?7:0,p=2*c+1;if(this.nextRow+p>this.height)return u.w("LineAtlas out of space"),null;let b=0;for(let C=0;C<t.length;C++)b+=t[C];if(b!==0){const C=this.width/b,I=this.getDashRanges(t,this.width,C);a?this.addRoundDash(I,C,c):this.addRegularDash(I)}const S={y:this.nextRow+c,height:2*c,width:b};return this.nextRow+=p,this.dirty=!0,S}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Worker(u.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const Lt=Math.floor(Pe.hardwareConcurrency/2);let Kt,ui;function Ai(){return Kt||(Kt=new Dt),Kt}Dt.workerCount=u.K(globalThis)?Math.max(Math.min(Lt,3),1):1;class mn{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let p=0;p<c.length;p++){const b=new u.L(c[p],a);b.name=`Worker ${p}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const c=[];for(const p of this.actors)c.push(p.sendAsync({type:t,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const c of this.actors)c.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function vr(){return ui||(ui=new mn(Ai(),u.M),ui.registerMessageHandler("GR",((y,t,a)=>u.m(t,a)))),ui}function tn(y,t){const a=u.N();return u.O(a,a,[1,1,0]),u.Q(a,a,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?u.S(a,a,y.calculatePosMatrix(t.toUnwrapped())):a}function ar(y,t,a,c,p,b,S){var C;const I=(function(G,K,ie){if(G)for(const he of G){const me=K[he];if(me&&me.source===ie&&me.type==="fill-extrusion")return!0}else for(const he in K){const me=K[he];if(me.source===ie&&me.type==="fill-extrusion")return!0}return!1})((C=p?.layers)!==null&&C!==void 0?C:null,t,y.id),N=b.maxPitchScaleFactor(),U=y.tilesIn(c,N,I);U.sort(Gi);const $=[];for(const G of U)$.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(t,a,y.getState(),G.queryGeometry,G.cameraQueryGeometry,G.scale,p,b,N,tn(b,G.tileID),S?(K,ie)=>S(G.tileID,K,ie):void 0)});return(function(G,K){for(const ie in G)for(const he of G[ie])Fn(he,K);return G})((function(G){const K={},ie={};for(const he of G){const me=he.queryResults,pe=he.wrappedTileID,ve=ie[pe]=ie[pe]||{};for(const Me in me){const ye=me[Me],Ee=ve[Me]=ve[Me]||{},Le=K[Me]=K[Me]||[];for(const Te of ye)Ee[Te.featureIndex]||(Ee[Te.featureIndex]=!0,Le.push(Te))}}return K})($),y)}function Gi(y,t){const a=y.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function Fn(y,t){const a=y.feature,c=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Jn(y,t,a){return u._(this,void 0,void 0,(function*(){let c=y;if(y.url?c=(yield u.j(t.transformRequest(y.url,"Source"),a)).data:yield Pe.frameAsync(a),!c)return null;const p=u.U(u.e(c,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(p.vectorLayerIds=c.vector_layers.map((b=>b.id))),p}))}class ln{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof u.V?new u.V(t.lng,t.lat):u.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof u.V?new u.V(t.lng,t.lat):u.V.convert(t),this}extend(t){const a=this._sw,c=this._ne;let p,b;if(t instanceof u.V)p=t,b=t;else{if(!(t instanceof ln))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ln.convert(t)):this.extend(u.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(u.V.convert(t)):this;if(p=t._sw,b=t._ne,!p||!b)return this}return a||c?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),c.lng=Math.max(b.lng,c.lng),c.lat=Math.max(b.lat,c.lat)):(this._sw=new u.V(p.lng,p.lat),this._ne=new u.V(b.lng,b.lat)),this}getCenter(){return new u.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.V(this.getWest(),this.getNorth())}getSouthEast(){return new u.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=u.V.convert(t);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}intersects(t){if(!((t=ln.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),c=Math.abs(t.getEast()-t.getWest());if(a>=360||c>=360)return!0;const p=u.W(this.getWest(),-180,180),b=u.W(this.getEast(),-180,180),S=u.W(t.getWest(),-180,180),C=u.W(t.getEast(),-180,180),I=p>=b,N=S>=C;return!(!I||!N)||(I?C>=p||S<=b:N?b>=S||p<=C:S<=b&&C>=p)}static convert(t){return t instanceof ln?t:t&&new ln(t)}static fromLngLat(t,a=0){const c=360*a/40075017,p=c/Math.cos(Math.PI/180*t.lat);return new ln(new u.V(t.lng-p,t.lat-c),new u.V(t.lng+p,t.lat+c))}adjustAntiMeridian(){const t=new u.V(this._sw.lng,this._sw.lat),a=new u.V(this._ne.lng,this._ne.lat);return new ln(t,t.lng>a.lng?new u.V(a.lng+360,a.lat):a)}}class Lr{constructor(t,a,c){this.bounds=ln.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(u.Y(this.bounds.getWest())*a),p=Math.floor(u.X(this.bounds.getNorth())*a),b=Math.ceil(u.Y(this.bounds.getEast())*a),S=Math.ceil(u.X(this.bounds.getSouth())*a);return t.x>=c&&t.x<b&&t.y>=p&&t.y<S}}class pa extends u.E{constructor(t,a,c,p){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=u.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Jn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(u.e(this,t),t.bounds&&(this.tileBounds=new Lr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,u.Z(t)||this.fire(new u.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};c.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((b,S)=>{t.reloadPromise={resolve:b,reject:S}}))}else t.actor=this.dispatcher.getActor(),p="LT";t.abortController=new AbortController;try{const b=yield t.actor.sendAsync({type:p,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,b)}catch(b){if(delete t.abortController,t.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return u._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Jt extends u.E{constructor(t,a,c,p){super(),this.id=t,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},a),u.e(this,u.U(a,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Jn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(u.e(this,a),a.bounds&&(this.tileBounds=new Lr(a.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,u.Z(a)||this.fire(new u.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return u.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield rt.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const p=this.map.painter.context,b=p.gl,S=c.data;t.texture=this.map.painter.getTileTexture(S.width),t.texture?t.texture.update(S,{useMipmap:!0}):(t.texture=new u.T(p,S,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}abortTile(t){return u._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class li extends Jt{constructor(t,a,c,p){super(t,a,c,p),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const p=yield rt.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){const b=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const S=u.b(b)&&u.$()?b:yield this.readImageNow(b),C={type:this.type,uid:t.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const I=yield t.actor.sendAsync({type:"LDT",data:C});t.dem=I,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}}))}readImageNow(t){return u._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&u.a0()){const a=t.width+2,c=t.height+2;try{return new u.R({width:a,height:c},yield u.a1(t,-1,-1,a,c))}catch{}}return Pe.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),p=(a.x-1+c)%c,b=a.x===0?t.wrap-1:t.wrap,S=(a.x+1+c)%c,C=a.x+1===c?t.wrap+1:t.wrap,I={};return I[new u.a2(t.overscaledZ,b,a.z,p,a.y).key]={backfilled:!1},I[new u.a2(t.overscaledZ,C,a.z,S,a.y).key]={backfilled:!1},a.y>0&&(I[new u.a2(t.overscaledZ,b,a.z,p,a.y-1).key]={backfilled:!1},I[new u.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},I[new u.a2(t.overscaledZ,C,a.z,S,a.y-1).key]={backfilled:!1}),a.y+1<c&&(I[new u.a2(t.overscaledZ,b,a.z,p,a.y+1).key]={backfilled:!1},I[new u.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},I[new u.a2(t.overscaledZ,C,a.z,S,a.y+1).key]={backfilled:!1}),I}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function fi(y){return y.type==="GeometryCollection"?y.geometries.map((t=>t.coordinates)).flat(1/0):y.coordinates.flat(1/0)}function Ci(y){const t=new ln;let a;switch(y.type){case"FeatureCollection":a=y.features.map((c=>fi(c.geometry))).flat(1/0);break;case"Feature":a=fi(y.geometry);break;default:a=fi(y)}if(a.length==0)return t;for(let c=0;c<a.length-1;c+=2)t.extend([a[c],a[c+1]]);return t}class Ei extends u.E{constructor(t,a,c,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(p),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=u.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:u.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(u.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||u.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return u._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const c=this._updateWorkerData();return a?c:this}updateData(t,a){this._pendingWorkerUpdate.diff=u.a6(this._pendingWorkerUpdate.diff,t);const c=this._updateWorkerData();return a?c:this}getData(){return u._(this,void 0,void 0,(function*(){const t=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return u._(this,void 0,void 0,(function*(){return Ci(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:c}})}_updateWorkerData(){return u._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void u.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,c=u.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(c.request=this.map._requestManager.transformRequest(Pe.resolveURL(t),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=t,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new u.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new u.l("dataabort",{dataType:"source"}));p.data&&(this._data={geojson:p.data});const b=this._applyDiffToSource(a),S=this._getShouldReloadTileOptions(b);let C=null;p.resourceTiming&&p.resourceTiming[this.id]&&(C=p.resourceTiming[this.id].slice(0));const I={dataType:"source"};this._collectResourceTiming&&C&&C.length>0&&u.e(I,{resourceTiming:C}),this.fire(new u.l("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new u.l("data",Object.assign(Object.assign({},I),{sourceDataType:"content",shouldReloadTileOptions:S})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new u.l("dataabort",{dataType:"source"}));this.fire(new u.k(p))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const p=u.a7(this._data.geojson,a);if(!p)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:p}}if(!this._data.updateable)return;const c=u.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:c}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>Ci(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:c,extent:p}=this.workerOptions.geojsonVtOptions,b=(function({x:S,y:C,z:I},N=0){const U=u.a3((S-N)/Math.pow(2,I)),$=u.a4((C+1+N)/Math.pow(2,I)),G=u.a3((S+1+N)/Math.pow(2,I)),K=u.a4((C-N)/Math.pow(2,I));return new ln([U,$],[G,K])})(t.tileID.canonical,c/p);for(const S of a)if(b.intersects(S))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return u._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const p=yield this.actor.sendAsync({type:a,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(p,this.map.painter,a==="RT")}))}abortTile(t){return u._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return u._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class cn extends u.E{constructor(t,a,c,p){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=a}load(t){return u._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield rt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,u.Z(a)||this.fire(new u.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(u.a9.fromLngLat);var c;return this.tileID=(function(p){const b=u.aa.fromPoints(p),S=b.width(),C=b.height(),I=Math.max(S,C),N=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),U=Math.pow(2,N);return new u.ac(N,Math.floor((b.minX+b.maxX)/2*U),Math.floor((b.minY+b.maxY)/2*U))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new u.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,c=!0)}c&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return u._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:c,maxX:p,maxY:b}=u.aa.fromPoints(t),S={};for(let C=0;C<=u.ab;C++){const I=Math.pow(2,C),N=Math.floor(a*I),U=Math.floor(c*I),$=Math.floor(p*I),G=Math.floor(b*I);S[C]={minTileX:N,minTileY:U,maxTileX:$,maxTileY:G}}return S}}class Re extends cn{constructor(t,a,c,p){super(t,a,c,p),this.roundZoom=!0,this.type="video",this.options=a}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield u.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new u.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new u.k(new u.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new u.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,c=!0)}c&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Q extends cn{constructor(t,a,c,p){super(t,a,c,p),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((b=>!Array.isArray(b)||b.length!==2||b.some((S=>typeof S!="number"))))||this.fire(new u.k(new u.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.k(new u.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new u.k(new u.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new u.k(new u.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.k(new u.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new u.T(a,this.canvas,c.RGBA,{premultiply:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let p=!1;for(const b in this.tiles){const S=this.tiles[b];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,p=!0)}p&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const ee={},se=y=>{switch(y){case"geojson":return Ei;case"image":return cn;case"raster":return Jt;case"raster-dem":return li;case"vector":return pa;case"video":return Re;case"canvas":return Q}return ee[y]},ge="RTLPluginLoaded";class we extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=vr()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return u._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Pe.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return u._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.l(ge))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ze=null;function Ne(){return Ze||(Ze=new we),Ze}var Ie,qe;(function(y){y[y.Base=0]="Base",y[y.Parent=1]="Parent"})(Ie||(Ie={})),(function(y){y[y.Departing=0]="Departing",y[y.Incoming=1]="Incoming"})(qe||(qe={}));class gt{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=u.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:c,fadeEndTime:p}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=p}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=be(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(p,b){const S={};if(!b)return S;for(const C of p){const I=C.layerIds.map((N=>b.getLayer(N))).filter(Boolean);if(I.length!==0){C.layers=I,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map((N=>I.filter((U=>U.id===N))[0])));for(const N of I)S[N.id]=C}}return S})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const b=this.buckets[p];if(b instanceof u.ah){if(this.hasSymbolBuckets=!0,!c)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const b=this.buckets[p];if(b instanceof u.ah&&b.hasRTLText){this.hasRTLText=!0,Ne().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const b=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(p).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new u.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new u.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new u.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,p,b,S,C,I,N,U,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:b,scale:S,tileSize:this.tileSize,pixelPosMatrix:U,transform:I,params:C,queryPadding:this.queryPadding*N,getElevation:$},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),b=a&&a.sourceLayer?a.sourceLayer:"",S=p[u.ai]||p[b];if(!S)return;const C=u.aj(a?.filter,a?.globalState),{z:I,x:N,y:U}=this.tileID.canonical,$={z:I,x:N,y:U};for(let G=0;G<S.length;G++){const K=S.feature(G);if(C.needGeometry){const me=u.ak(K,!0);if(!C.filter(new u.H(this.tileID.overscaledZ),me,this.tileID.canonical))continue}else if(!C.filter(new u.H(this.tileID.overscaledZ),K))continue;const ie=c.getId(K,b),he=new u.al(K,I,N,U,ie);he.tile=$,t.push(he)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=u.am(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const b=this.expirationTime-a;b?this.expirationTime=c+Math.max(b,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!a.style.hasLayer(p))continue;const b=this.buckets[p],S=b.layers[0].sourceLayer||u.ai,C=c[S],I=t[S];if(!C||!I||Object.keys(I).length===0)continue;b.update(I,C,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const N=a&&a.style&&a.style.getLayer(p);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(b)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<be()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=be()+t}setDependencies(t,a){const c={};for(const p of a)c[p]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const p=this.dependencies[c];if(p){for(const b of a)if(p[b])return!0}}return!1}}class ft{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},u.e(this.stateChanges[t][p],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==p&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const b in this.state[t][p])c[b]||(this.deletedStates[t][p][b]=null)}else for(const b in c)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][b]===null&&delete this.deletedStates[t][p][b]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(c in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][c]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),p=u.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][a];if(b===null)return{};for(const S in b)delete p[S]}return p}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const b={};for(const S in this.stateChanges[p])this.state[p][S]||(this.state[p][S]={}),u.e(this.state[p][S],this.stateChanges[p][S]),b[S]=this.state[p][S];c[p]=b}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const b={};if(this.deletedStates[p]===null)for(const S in this.state[p])b[S]={},this.state[p][S]={};else for(const S in this.deletedStates[p]){if(this.deletedStates[p][S]===null)this.state[p][S]={};else for(const C of Object.keys(this.deletedStates[p][S]))delete this.state[p][S][C];b[S]=this.state[p][S]}c[p]=c[p]||{},u.e(c[p],b)}this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0&&t.setFeatureState(c,a)}}const Ft=89.25;function ei(y,t){const a=u.an(t.lat,-u.ao,u.ao);return new u.P(u.Y(t.lng)*y,u.X(a)*y)}function hi(y,t){return new u.a9(t.x/y,t.y/y).toLngLat()}function Vi(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(u.ap(90-y.pitch)),Math.tan(u.ap(Ft-y.pitch)))}function Di(y,t){const a=y.canonical,c=t/u.aq(a.z),p=a.x+Math.pow(2,a.z)*y.wrap,b=u.ar(new Float64Array(16));return u.O(b,b,[p*c,a.y*c,0]),u.Q(b,b,[c/u.a5,c/u.a5,1]),b}function $e(y,t,a,c,p){const b=u.a9.fromLngLat(y,t),S=p*u.as(1,y.lat),{x:C,y:I,z:N}=Wi(a,c);return new u.a9(b.x+S*-C,b.y+S*-I,b.z+S*-N)}function Wi(y,t){const a=u.ap(y),c=u.ap(t),p=Math.cos(-a),b=Math.sin(a);return{x:b*Math.sin(c),y:-b*Math.cos(c),z:p}}function er(y,t,a){const c=t.intersectsFrustum(y);if(!a||c===0)return c;const p=t.intersectsPlane(a);return p===0?0:c===2&&p===2?2:1}function pi(y,t,a){let c=0;const p=(a-t)/10;for(let b=0;b<10;b++)c+=p*Math.pow(Math.cos(t+(b+.5)/10*(a-t)),y);return c}function Ki(y,t){return function(a,c,p,b,S){const C=2*((y-1)/u.at(Math.cos(u.ap(Ft-S))/Math.cos(u.ap(Ft)))-1),I=Math.acos(p/b),N=2*pi(C-1,0,u.ap(S/2)),U=Math.min(u.ap(Ft),I+u.ap(S/2)),$=pi(C-1,Math.min(U,I-u.ap(S/2)),U),G=Math.atan(c/p),K=Math.hypot(c,p);let ie=a;return ie+=u.at(b/K/Math.max(.5,Math.cos(u.ap(S/2)))),ie+=C*u.at(Math.cos(G))/2,ie-=u.at(Math.max(1,$/N/t))/2,ie}}const un=Ki(9.314,3);function ji(y,t){const a=(t.roundZoom?Math.round:Math.floor)(y.zoom+u.at(y.tileSize/t.tileSize));return Math.max(0,a)}function Ln(y,t){const a=y.getCameraFrustum(),c=y.getClippingPlane(),p=y.screenPointToMercatorCoordinate(y.getCameraPoint()),b=u.a9.fromLngLat(y.center,y.elevation);p.z=b.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const S=y.getCoveringTilesDetailsProvider(),C=S.allowVariableZoom(y,t),I=ji(y,t),N=t.minzoom||0,U=t.maxzoom!==void 0?t.maxzoom:y.maxZoom,$=Math.min(Math.max(0,I),U),G=Math.pow(2,$),K=[G*p.x,G*p.y,0],ie=[G*b.x,G*b.y,0],he=Math.hypot(b.x-p.x,b.y-p.y),me=Math.abs(b.z-p.z),pe=Math.hypot(he,me),ve=Ee=>({zoom:0,x:0,y:0,wrap:Ee,fullyVisible:!1}),Me=[],ye=[];if(y.renderWorldCopies&&S.allowWorldCopies())for(let Ee=1;Ee<=3;Ee++)Me.push(ve(-Ee)),Me.push(ve(Ee));for(Me.push(ve(0));Me.length>0;){const Ee=Me.pop(),Le=Ee.x,Te=Ee.y;let Oe=Ee.fullyVisible;const et={x:Le,y:Te,z:Ee.zoom},Xe=S.getTileBoundingVolume(et,Ee.wrap,y.elevation,t);if(!Oe){const kt=er(a,Xe,c);if(kt===0)continue;Oe=kt===2}const We=S.distanceToTile2d(p.x,p.y,et,Xe);let Ke=I;C&&(Ke=(t.calculateTileZoom||un)(y.zoom+u.at(y.tileSize/t.tileSize),We,me,pe,y.fov)),Ke=(t.roundZoom?Math.round:Math.floor)(Ke),Ke=Math.max(0,Ke);const zt=Math.min(Ke,U);if(Ee.wrap=S.getWrap(b,et,Ee.wrap),Ee.zoom>=zt){if(Ee.zoom<N)continue;const kt=$-Ee.zoom,xt=K[0]-.5-(Le<<kt),Bt=K[1]-.5-(Te<<kt),Ti=t.reparseOverscaled?Math.max(Ee.zoom,Ke):Ee.zoom;ye.push({tileID:new u.a2(Ee.zoom===U?Ti:Ee.zoom,Ee.wrap,Ee.zoom,Le,Te),distanceSq:u.au([ie[0]-.5-Le,ie[1]-.5-Te]),tileDistanceToCamera:Math.sqrt(xt*xt+Bt*Bt)})}else for(let kt=0;kt<4;kt++)Me.push({zoom:Ee.zoom+1,x:(Le<<1)+kt%2,y:(Te<<1)+(kt>>1),wrap:Ee.wrap,fullyVisible:Oe})}return ye.sort(((Ee,Le)=>Ee.distanceSq-Le.distanceSq)).map((Ee=>Ee.tileID))}const sn=u.aa.fromPoints([new u.P(0,0),new u.P(u.a5,u.a5)]);function sr(y){return y==="raster"||y==="image"||y==="video"}function Ol(y,t,a,c,p,b,S){if(!t.hasData())return!1;const{tileID:C,fadingRole:I,fadingDirection:N,fadingParentID:U}=t;if(I===Ie.Base&&N===qe.Incoming&&U)return a[U.key]=U,!0;const $=Math.max(C.overscaledZ-p,b);for(let G=C.overscaledZ-1;G>=$;G--){const K=C.scaledTo(G),ie=y.getLoadedTile(K);if(ie)return t.setCrossFadeLogic({fadingRole:Ie.Base,fadingDirection:qe.Incoming,fadingParentID:ie.tileID,fadeEndTime:c+S}),ie.setCrossFadeLogic({fadingRole:Ie.Parent,fadingDirection:qe.Departing,fadeEndTime:c+S}),a[K.key]=K,!0}return!1}function qr(y,t,a,c,p,b){if(!t.hasData())return!1;const S=t.tileID.children(p);let C=Qe(y,t,S,a,c,p,b);if(C)return!0;for(const I of S)Qe(y,t,I.children(p),a,c,p,b)&&(C=!0);return C}function Qe(y,t,a,c,p,b,S){if(a[0].overscaledZ>=b)return!1;let C=!1;for(const I of a){const N=y.getLoadedTile(I);if(!N)continue;const{fadingRole:U,fadingDirection:$,fadingParentID:G}=N;U===Ie.Base&&$===qe.Departing&&G||(N.setCrossFadeLogic({fadingRole:Ie.Base,fadingDirection:qe.Departing,fadingParentID:t.tileID,fadeEndTime:p+S}),t.setCrossFadeLogic({fadingRole:Ie.Parent,fadingDirection:qe.Incoming,fadeEndTime:p+S})),c[I.key]=I,C=!0}return C}function kr(y,t,a,c){const p=y.tileID;return!!y.selfFading||!y.hasData()&&!!t.has(p)&&(y.setSelfFadeLogic(a+c),!0)}function Rr(y,t){var a;y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let c=t.tileID.canonical.x-y.tileID.canonical.x;const p=t.tileID.canonical.y-y.tileID.canonical.y,b=Math.pow(2,y.tileID.canonical.z),S=t.tileID.key;c===0&&p===0||Math.abs(p)>1||(Math.abs(c)>1&&(Math.abs(c+b)===1?c+=b:Math.abs(c-b)===1&&(c-=b)),t.dem&&y.dem&&(y.dem.backfillBorder(t.dem,c,p),!((a=y.neighboringTiles)===null||a===void 0)&&a[S]&&(y.neighboringTiles[S].backfilled=!0)))}class Za{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+t),a[p.tileID.key]=p}this._tiles=a}setFeatureState(t,a){for(const c in this._tiles)this._tiles[c].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(u.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var c;return(c=this.getTileById(t))===null||c===void 0?void 0:c.isRenderable(a)}getRenderableIds(t=0,a){const c=[];for(const p of this.getAllIds())this.isIdRenderable(p,a)&&c.push(this.getTileById(p));return a?c.sort(((p,b)=>{const S=p.tileID,C=b.tileID,I=new u.P(S.canonical.x,S.canonical.y)._rotate(-t),N=new u.P(C.canonical.x,C.canonical.y)._rotate(-t);return S.overscaledZ-C.overscaledZ||N.y-I.y||N.x-I.x})).map((p=>p.tileID.key)):c.map((p=>p.tileID)).sort(u.aw).map((p=>p.key))}}class gn extends u.E{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,b,S,C)=>{const I=new(se(b.type))(p,b,S,C);if(I.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${I.id}`);return I})(t,a,c,this),this._inViewTiles=new Za,this._outOfViewCache=new u.ax(0,(p=>this._unloadTile(p))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new ft,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Za}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,c){return u._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,c)}catch(p){t.state="errored",p.status!==404?this._source.fire(new u.k(p,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new u.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const c=this.getLoadedTile(t.scaledTo(a));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const p=this._inViewTiles.getTileById(c);a&&!this._source.shouldReloadTile(p,a)||(t?this._reloadTile(c,"expired"):p.state!=="errored"&&this._reloadTile(c,"reloading"))}}}_reloadTile(t,a){return u._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(t);c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,t,a))}))}_tileLoaded(t,a,c){t.timeAdded=be(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(p,b){var S,C;const I=b.getRenderableIds();for(const N of I){if(!p.neighboringTiles||!p.neighboringTiles[N])continue;const U=b.getTileById(N);p.neighboringTiles[N].backfilled||Rr(p,U),!((C=(S=U.neighboringTiles)===null||S===void 0?void 0:S[p.tileID.key])===null||C===void 0)&&C.backfilled||Rr(U,p)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const c=this._getLoadedDescendents(a),p=new Set;for(const b of a){const S=c[b.key];if(!S?.length){p.add(b);continue}const C=b.overscaledZ+gn.maxOverzooming,I=S.filter(($=>$.tileID.overscaledZ<=C));if(!I.length){p.add(b);continue}const N=Math.min(...I.map(($=>$.tileID.overscaledZ))),U=I.filter(($=>$.tileID.overscaledZ===N)).map(($=>$.tileID));for(const $ of U)t[$.key]=$;this._areDescendentsComplete(U,N,b.overscaledZ)||p.add(b)}return p}_getLoadedDescendents(t){var a;const c={};for(const p of this._inViewTiles.getAllTiles().filter((b=>b.hasData())))for(const b of t)p.tileID.isChildOf(b)&&(c[a=b.key]||(c[a]=[])).push(p);return c}_areDescendentsComplete(t,a,c){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-c)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?u.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(b)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((I=>new u.a2(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y))):(c=Ln(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((I=>this._source.hasTile(I))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const p=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new u.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=ji(t,this._source),S=this._updateRetainedTiles(c,b),C=sr(this._source.type);C&&this._rasterFadeDuration>0&&!a&&(function(I,N,U,$,G,K,ie){const he=be(),me=u.av(N);for(const pe of N){const ve=I.getTileById(pe.key);ve.fadingDirection!==qe.Departing&&ve.fadeOpacity!==0||ve.resetFadeLogic(),Ol(I,ve,U,he,$,G,ie)||qr(I,ve,U,he,K,ie)||kr(ve,me,he,ie)||ve.resetFadeLogic()}})(this._inViewTiles,c,S,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),C?this._cleanUpRasterTiles(S):this._cleanUpVectorTiles(S)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);t[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const c of t)if(c.canonical.z>this._source.minzoom){const p=c.scaledTo(c.canonical.z-1);a.push(p);const b=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(b)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var c;const p=new Set;for(const N of t)this._addTile(N).hasData()||p.add(N);const b=t.reduce(((N,U)=>(N[U.key]=U,N)),{}),S=this._retainLoadedChildren(b,p),C={},I=Math.max(a-gn.maxUnderzooming,this._source.minzoom);for(const N of S){let U=this._inViewTiles.getTileById(N.key),$=U?.wasRequested();for(let G=N.overscaledZ-1;G>=I;--G){const K=N.scaledTo(G);if(C[K.key])break;if(C[K.key]=!0,U=this.getTile(K),!U&&$&&(U=this._addTile(K)),U){const ie=U.hasData();if((ie||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||$)&&(b[K.key]=K),$=U.wasRequested(),ie)break}}}return b}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const c=a;return a||(a=new gt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),c||this._source.fire(new u.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||c.state=="errored")&&t.some((p=>p.equals(c.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,c){const p=[],b=this.transform;if(!b)return p;const S=b.getCoveringTilesDetailsProvider().allowWorldCopies(),C=c?b.getCameraQueryGeometry(t):t,I=K=>b.screenPointToMercatorCoordinate(K,this.terrain),N=this.transformBbox(t,I,!S),U=this.transformBbox(C,I,!S),$=this.getIds(),G=u.aa.fromPoints(U);for(let K=0;K<$.length;K++){const ie=this._inViewTiles.getTileById($[K]);if(ie.holdingForSymbolFade())continue;const he=S?[ie.tileID]:[ie.tileID.unwrapTo(-1),ie.tileID.unwrapTo(0)],me=Math.pow(2,b.zoom-ie.tileID.overscaledZ),pe=a*ie.queryPadding*u.a5/ie.tileSize/me;for(const ve of he){const Me=G.map((ye=>ve.getTilePoint(new u.a9(ye.x,ye.y))));if(Me.expandBy(pe),Me.intersects(sn)){const ye=N.map((Le=>ve.getTilePoint(Le))),Ee=U.map((Le=>ve.getTilePoint(Le)));p.push({tile:ie,tileID:S?ve:ve.unwrapTo(0),queryGeometry:ye,cameraQueryGeometry:Ee,scale:me})}}}return p}transformBbox(t,a,c){let p=t.map(a);if(c){const b=u.aa.fromPoints(t);b.shrinkBy(.001*Math.min(b.width(),b.height()));const S=b.map(a);u.aa.fromPoints(p).covers(S)||(p=p.map((C=>C.x>.5?new u.a9(C.x-1,C.y,C.z):C)))}return p}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((c=>this._inViewTiles.getTileById(c).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!sr(this._source.type)||!(function(t,a){if(a<=0)return!1;const c=be();for(const p of t.getAllTiles())if(p.fadeEndTime>=c)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,c){this._state.updateState(t=t||u.ai,a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||u.ai,a,c)}getFeatureState(t,a){return this._state.getState(t=t||u.ai,a)}setDependencies(t,a,c){const p=this._inViewTiles.getTileById(t);p&&p.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(t,a)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}gn.maxUnderzooming=10,gn.maxOverzooming=3;class It{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.an(t,0,1);let a=1,c=this._distances[a];const p=t*this.paddedLength+this.padding;for(;c<p&&a<this._distances.length;)c=this._distances[++a];const b=a-1,S=this._distances[b],C=c-S,I=C>0?(p-S)/C:0;return this.points[b].mult(1-I).add(this.points[a].mult(I))}}function yi(y,t){let a=!0;return y==="always"||y!=="never"&&t!=="never"||(a=!1),a}class gi{constructor(t,a,c){const p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let S=0;S<this.xCellCount*this.yCellCount;S++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,p,b){this._forEachCell(a,c,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(b)}insertCircle(t,a,c,p){this._forEachCell(a-p,c-p,a+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(p)}_insertBoxCell(t,a,c,p,b,S){this.boxCells[b].push(S)}_insertCircleCell(t,a,c,p,b,S){this.circleCells[b].push(S)}_query(t,a,c,p,b,S,C){if(c<0||t>this.width||p<0||a>this.height)return[];const I=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=p){if(b)return[{key:null,x1:t,y1:a,x2:c,y2:p}];for(let N=0;N<this.boxKeys.length;N++)I.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const U=this.circles[3*N],$=this.circles[3*N+1],G=this.circles[3*N+2];I.push({key:this.circleKeys[N],x1:U-G,y1:$-G,x2:U+G,y2:$+G})}}else this._forEachCell(t,a,c,p,this._queryCell,I,{hitTest:b,overlapMode:S,seenUids:{box:{},circle:{}}},C);return I}query(t,a,c,p){return this._query(t,a,c,p,!1,null)}hitTest(t,a,c,p,b,S){return this._query(t,a,c,p,!0,b,S).length>0}hitTestCircle(t,a,c,p,b){const S=t-c,C=t+c,I=a-c,N=a+c;if(C<0||S>this.width||N<0||I>this.height)return!1;const U=[];return this._forEachCell(S,I,C,N,this._queryCellCircle,U,{hitTest:!0,overlapMode:p,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},b),U.length>0}_queryCell(t,a,c,p,b,S,C,I){const{seenUids:N,hitTest:U,overlapMode:$}=C,G=this.boxCells[b];if(G!==null){const ie=this.bboxes;for(const he of G)if(!N.box[he]){N.box[he]=!0;const me=4*he,pe=this.boxKeys[he];if(t<=ie[me+2]&&a<=ie[me+3]&&c>=ie[me+0]&&p>=ie[me+1]&&(!I||I(pe))&&(!U||!yi($,pe.overlapMode))&&(S.push({key:pe,x1:ie[me],y1:ie[me+1],x2:ie[me+2],y2:ie[me+3]}),U))return!0}}const K=this.circleCells[b];if(K!==null){const ie=this.circles;for(const he of K)if(!N.circle[he]){N.circle[he]=!0;const me=3*he,pe=this.circleKeys[he];if(this._circleAndRectCollide(ie[me],ie[me+1],ie[me+2],t,a,c,p)&&(!I||I(pe))&&(!U||!yi($,pe.overlapMode))){const ve=ie[me],Me=ie[me+1],ye=ie[me+2];if(S.push({key:pe,x1:ve-ye,y1:Me-ye,x2:ve+ye,y2:Me+ye}),U)return!0}}}return!1}_queryCellCircle(t,a,c,p,b,S,C,I){const{circle:N,seenUids:U,overlapMode:$}=C,G=this.boxCells[b];if(G!==null){const ie=this.bboxes;for(const he of G)if(!U.box[he]){U.box[he]=!0;const me=4*he,pe=this.boxKeys[he];if(this._circleAndRectCollide(N.x,N.y,N.radius,ie[me+0],ie[me+1],ie[me+2],ie[me+3])&&(!I||I(pe))&&!yi($,pe.overlapMode))return S.push(!0),!0}}const K=this.circleCells[b];if(K!==null){const ie=this.circles;for(const he of K)if(!U.circle[he]){U.circle[he]=!0;const me=3*he,pe=this.circleKeys[he];if(this._circlesCollide(ie[me],ie[me+1],ie[me+2],N.x,N.y,N.radius)&&(!I||I(pe))&&!yi($,pe.overlapMode))return S.push(!0),!0}}}_forEachCell(t,a,c,p,b,S,C,I){const N=this._convertToXCellCoord(t),U=this._convertToYCellCoord(a),$=this._convertToXCellCoord(c),G=this._convertToYCellCoord(p);for(let K=N;K<=$;K++)for(let ie=U;ie<=G;ie++)if(b.call(this,t,a,c,p,this.xCellCount*ie+K,S,C,I))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,p,b,S){const C=p-t,I=b-a,N=c+S;return N*N>C*C+I*I}_circleAndRectCollide(t,a,c,p,b,S,C){const I=(S-p)/2,N=Math.abs(t-(p+I));if(N>I+c)return!1;const U=(C-b)/2,$=Math.abs(a-(b+U));if($>U+c)return!1;if(N<=I||$<=U)return!0;const G=N-I,K=$-U;return G*G+K*K<=c*c}}function ma(y,t,a){const c=u.N();if(!y){const{vecSouth:$,vecEast:G}=Ms(t),K=te();K[0]=G[0],K[1]=G[1],K[2]=$[0],K[3]=$[1],p=K,(U=(S=(b=K)[0])*(N=b[3])-(I=b[2])*(C=b[1]))&&(p[0]=N*(U=1/U),p[1]=-C*U,p[2]=-I*U,p[3]=S*U),c[0]=K[0],c[1]=K[1],c[4]=K[2],c[5]=K[3]}var p,b,S,C,I,N,U;return u.Q(c,c,[1/a,1/a,1]),c}function Qc(y,t,a,c){if(y){const p=u.N();if(!t){const{vecSouth:b,vecEast:S}=Ms(a);p[0]=S[0],p[1]=S[1],p[4]=b[0],p[5]=b[1]}return u.Q(p,p,[c,c,1]),p}return a.pixelsToClipSpaceMatrix}function Ms(y){const t=Math.cos(y.rollInRadians),a=Math.sin(y.rollInRadians),c=Math.cos(y.pitchInRadians),p=Math.cos(y.bearingInRadians),b=Math.sin(y.bearingInRadians),S=u.aC();S[0]=-p*c*a-b*t,S[1]=-b*c*a+p*t;const C=u.aD(S);C<1e-9?u.aE(S):u.aF(S,S,1/C);const I=u.aC();I[0]=p*c*t-b*a,I[1]=b*c*t+p*a;const N=u.aD(I);return N<1e-9?u.aE(I):u.aF(I,I,1/N),{vecEast:I,vecSouth:S}}function vi(y,t,a,c){let p;c?(p=[y,t,c(y,t),1],u.aH(p,p,a)):(p=[y,t,0,1],na(p,p,a));const b=p[3];return{point:new u.P(p[0]/b,p[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function il(y,t){return .5+y/t*.5}function rs(y,t){return y.x>=-t[0]&&y.x<=t[0]&&y.y>=-t[1]&&y.y<=t[1]}function Qs(y,t,a,c,p,b,S,C,I,N,U,$,G){const K=a?y.textSizeData:y.iconSizeData,ie=u.ay(K,t.transform.zoom),he=[256/t.width*2+1,256/t.height*2+1],me=a?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;me.clear();const pe=y.lineVertexArray,ve=a?y.text.placedSymbolArray:y.icon.placedSymbolArray,Me=t.transform.width/t.transform.height;let ye=!1;for(let Ee=0;Ee<ve.length;Ee++){const Le=ve.get(Ee);if(Le.hidden||Le.writingMode===u.az.vertical&&!ye){nn(Le.numGlyphs,me);continue}ye=!1;const Te=new u.P(Le.anchorX,Le.anchorY),Oe={getElevation:G,pitchedLabelPlaneMatrix:c,lineVertexArray:pe,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Te,unwrappedTileID:I,width:N,height:U,translation:$},et=Cs(Le.anchorX,Le.anchorY,Oe);if(!rs(et.point,he)){nn(Le.numGlyphs,me);continue}const Xe=il(t.transform.cameraToCenterDistance,et.signedDistanceFromCamera),We=u.aA(K,ie,Le),Ke=b?We*t.transform.getPitchedTextCorrection(Le.anchorX,Le.anchorY,I)/Xe:We*Xe,zt=Gn({projectionContext:Oe,pitchedLabelPlaneMatrixInverse:p,symbol:Le,fontSize:Ke,flip:!1,keepUpright:S,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:me,aspectRatio:Me,rotateToLine:C});ye=zt.useVertical,(zt.notEnoughRoom||ye||zt.needsFlipping&&Gn({projectionContext:Oe,pitchedLabelPlaneMatrixInverse:p,symbol:Le,fontSize:Ke,flip:!0,keepUpright:S,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:me,aspectRatio:Me,rotateToLine:C}).notEnoughRoom)&&nn(Le.numGlyphs,me)}a?y.text.dynamicLayoutVertexBuffer.updateData(me):y.icon.dynamicLayoutVertexBuffer.updateData(me)}function Oa(y,t,a,c,p,b,S,C){const I=b.glyphStartIndex+b.numGlyphs,N=b.lineStartIndex,U=b.lineStartIndex+b.lineLength,$=t.getoffsetX(b.glyphStartIndex),G=t.getoffsetX(I-1),K=ia(y*$,a,c,p,b.segment,N,U,C,S);if(!K)return null;const ie=ia(y*G,a,c,p,b.segment,N,U,C,S);return ie?C.projectionCache.anyProjectionOccluded?null:{first:K,last:ie}:null}function As(y,t,a,c){return y===u.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(y===u.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Gn(y){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:p,flip:b,keepUpright:S,glyphOffsetArray:C,dynamicLayoutVertexArray:I,aspectRatio:N,rotateToLine:U}=y,$=p/24,G=c.lineOffsetX*$,K=c.lineOffsetY*$;let ie;if(c.numGlyphs>1){const he=c.glyphStartIndex+c.numGlyphs,me=c.lineStartIndex,pe=c.lineStartIndex+c.lineLength,ve=Oa($,C,G,K,b,c,U,t);if(!ve)return{notEnoughRoom:!0};const Me=as(ve.first.point.x,ve.first.point.y,t,a),ye=as(ve.last.point.x,ve.last.point.y,t,a);if(S&&!b){const Ee=As(c.writingMode,Me,ye,N);if(Ee)return Ee}ie=[ve.first];for(let Ee=c.glyphStartIndex+1;Ee<he-1;Ee++){const Le=ia($*C.getoffsetX(Ee),G,K,b,c.segment,me,pe,t,U);if(!Le)return{notEnoughRoom:!0};ie.push(Le)}ie.push(ve.last)}else{if(S&&!b){const me=Zi(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,pe=c.lineStartIndex+c.segment+1,ve=new u.P(t.lineVertexArray.getx(pe),t.lineVertexArray.gety(pe)),Me=Zi(ve.x,ve.y,t),ye=Me.signedDistanceFromCamera>0?Me.point:Bl(t.tileAnchorPoint,ve,me,1,t),Ee=as(me.x,me.y,t,a),Le=as(ye.x,ye.y,t,a),Te=As(c.writingMode,Ee,Le,N);if(Te)return Te}const he=ia($*C.getoffsetX(c.glyphStartIndex),G,K,b,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,U);if(!he||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ie=[he]}for(const he of ie)u.aG(I,he.point,he.angle);return{}}function Bl(y,t,a,c,p){const b=y.add(y.sub(t)._unit()),S=Zi(b.x,b.y,p).point,C=a.sub(S);return a.add(C._mult(c/C.mag()))}function Gr(y,t,a){const c=t.projectionCache;if(c.projections[y])return c.projections[y];const p=new u.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),b=Zi(p.x,p.y,t);if(b.signedDistanceFromCamera>0)return c.projections[y]=b.point,c.anyProjectionOccluded=c.anyProjectionOccluded||b.isOccluded,b.point;const S=y-a.direction;return Bl(a.distanceFromAnchor===0?t.tileAnchorPoint:new u.P(t.lineVertexArray.getx(S),t.lineVertexArray.gety(S)),p,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function Zi(y,t,a){const c=y+a.translation[0],p=t+a.translation[1];let b;return a.pitchWithMap?(b=vi(c,p,a.pitchedLabelPlaneMatrix,a.getElevation),b.isOccluded=!1):(b=a.transform.projectTileCoordinates(c,p,a.unwrappedTileID,a.getElevation),b.point.x=(.5*b.point.x+.5)*a.width,b.point.y=(.5*-b.point.y+.5)*a.height),b}function as(y,t,a,c){if(a.pitchWithMap){const p=[y,t,0,1];return u.aH(p,p,c),a.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],a.unwrappedTileID,a.getElevation).point}return{x:y/a.width*2-1,y:1-t/a.height*2}}function Cs(y,t,a){return a.transform.projectTileCoordinates(y,t,a.unwrappedTileID,a.getElevation)}function nl(y,t,a){return y._unit()._perp()._mult(t*a)}function Js(y,t,a,c,p,b,S,C,I){if(C.projectionCache.offsets[y])return C.projectionCache.offsets[y];const N=a.add(t);if(y+I.direction<c||y+I.direction>=p)return C.projectionCache.offsets[y]=N,N;const U=Gr(y+I.direction,C,I),$=nl(U.sub(a),S,I.direction),G=a.add($),K=U.add($);return C.projectionCache.offsets[y]=u.aI(b,N,G,K)||N,C.projectionCache.offsets[y]}function ia(y,t,a,c,p,b,S,C,I){const N=c?y-t:y+t;let U=N>0?1:-1,$=0;c&&(U*=-1,$=Math.PI),U<0&&($+=Math.PI);let G,K=U>0?b+p:b+p+1;C.projectionCache.cachedAnchorPoint?G=C.projectionCache.cachedAnchorPoint:(G=Zi(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=G);let ie,he,me=G,pe=G,ve=0,Me=0;const ye=Math.abs(N),Ee=[];let Le;for(;ve+Me<=ye;){if(K+=U,K<b||K>=S)return null;ve+=Me,pe=me,he=ie;const et={absOffsetX:ye,direction:U,distanceFromAnchor:ve,previousVertex:pe};if(me=Gr(K,C,et),a===0)Ee.push(pe),Le=me.sub(pe);else{let Xe;const We=me.sub(pe);Xe=We.mag()===0?nl(Gr(K+U,C,et).sub(me),a,U):nl(We,a,U),he||(he=pe.add(Xe)),ie=Js(K,Xe,me,b,S,he,a,C,et),Ee.push(he),Le=ie.sub(he)}Me=Le.mag()}const Te=Le._mult((ye-ve)/Me)._add(he||pe),Oe=$+Math.atan2(me.y-pe.y,me.x-pe.x);return Ee.push(Te),{point:Te,angle:I?Oe:0,path:Ee}}const qi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nn(y,t){for(let a=0;a<y;a++){const c=t.length;t.resize(c+4),t.float32.set(qi,3*c)}}function na(y,t,a){const c=t[0],p=t[1];return y[0]=a[0]*c+a[4]*p+a[12],y[1]=a[1]*c+a[5]*p+a[13],y[3]=a[3]*c+a[7]*p+a[15],y}const Ri=100;class Mo{constructor(t,a=new gi(t.width+200,t.height+200,25),c=new gi(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ri,this.screenBottomBoundary=t.height+Ri,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,p,b,S,C,I,N,U,$,G){const K=this.projectAndGetPerspectiveRatio(t.anchorPointX+I[0],t.anchorPointY+I[1],b,U,G),ie=c*K.perspectiveRatio;let he;if(S||C)he=this._projectCollisionBox(t,ie,p,b,S,C,I,K,U,$,G);else{const Le=K.x+($?$.x*ie:0),Te=K.y+($?$.y*ie:0);he={allPointsOccluded:!1,box:[Le+t.x1*ie,Te+t.y1*ie,Le+t.x2*ie,Te+t.y2*ie]}}const[me,pe,ve,Me]=he.box,ye=S?he.allPointsOccluded:K.isOccluded;let Ee=ye;return Ee||(Ee=K.perspectiveRatio<this.perspectiveRatioCutoff),Ee||(Ee=!this.isInsideGrid(me,pe,ve,Me)),Ee||a!=="always"&&this.grid.hitTest(me,pe,ve,Me,a,N)?{box:[me,pe,ve,Me],placeable:!1,offscreen:!1,occluded:ye}:{box:[me,pe,ve,Me],placeable:!0,offscreen:this.isOffscreen(me,pe,ve,Me),occluded:ye}}placeCollisionCircles(t,a,c,p,b,S,C,I,N,U,$,G,K,ie){const he=[],me=new u.P(a.anchorX,a.anchorY),pe=this.getPerspectiveRatio(me.x,me.y,S,ie),ve=(N?b*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,S)/pe:b*pe)/u.aM,Me={getElevation:ie,pitchedLabelPlaneMatrix:C,lineVertexArray:c,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:me,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:K},ye=Oa(ve,p,a.lineOffsetX*ve,a.lineOffsetY*ve,!1,a,!1,Me);let Ee=!1,Le=!1,Te=!0;if(ye){const Oe=.5*$*pe+G,et=new u.P(-100,-100),Xe=new u.P(this.screenRightBoundary,this.screenBottomBoundary),We=new It,Ke=ye.first,zt=ye.last;let kt=[];for(let Ti=Ke.path.length-1;Ti>=1;Ti--)kt.push(Ke.path[Ti]);for(let Ti=1;Ti<zt.path.length;Ti++)kt.push(zt.path[Ti]);const xt=2.5*Oe;if(N){const Ti=this.projectPathToScreenSpace(kt,Me);kt=Ti.some((pn=>pn.signedDistanceFromCamera<=0))?[]:Ti.map((pn=>pn.point))}let Bt=[];if(kt.length>0){const Ti=kt[0].clone(),pn=kt[0].clone();for(let Dn=1;Dn<kt.length;Dn++)Ti.x=Math.min(Ti.x,kt[Dn].x),Ti.y=Math.min(Ti.y,kt[Dn].y),pn.x=Math.max(pn.x,kt[Dn].x),pn.y=Math.max(pn.y,kt[Dn].y);Bt=Ti.x>=et.x&&pn.x<=Xe.x&&Ti.y>=et.y&&pn.y<=Xe.y?[kt]:pn.x<et.x||Ti.x>Xe.x||pn.y<et.y||Ti.y>Xe.y?[]:u.aJ([kt],et.x,et.y,Xe.x,Xe.y)}for(const Ti of Bt){We.reset(Ti,.25*Oe);let pn=0;pn=We.length<=.5*Oe?1:Math.ceil(We.paddedLength/xt)+1;for(let Dn=0;Dn<pn;Dn++){const En=Dn/Math.max(pn-1,1),Zn=We.lerp(En),xn=Zn.x+Ri,nr=Zn.y+Ri;he.push(xn,nr,Oe,0);const qn=xn-Oe,Hr=nr-Oe,ur=xn+Oe,hr=nr+Oe;if(Te=Te&&this.isOffscreen(qn,Hr,ur,hr),Le=Le||this.isInsideGrid(qn,Hr,ur,hr),t!=="always"&&this.grid.hitTestCircle(xn,nr,Oe,t,U)&&(Ee=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ee}}}}return{circles:!I&&Ee||!Le||pe<this.perspectiveRatioCutoff?[]:he,offscreen:Te,collisionDetected:Ee}}projectPathToScreenSpace(t,a){const c=(function(p,b){const S=u.N();return u.aB(S,b.pitchedLabelPlaneMatrix),p.map((C=>{const I=vi(C.x,C.y,S,b.getElevation),N=b.transform.projectTileCoordinates(I.point.x,I.point.y,b.unwrappedTileID,b.getElevation);return N.point.x=(.5*N.point.x+.5)*b.width,N.point.y=(.5*-N.point.y+.5)*b.height,N}))})(t,a);return(function(p){let b=0,S=0,C=0,I=0;for(let N=0;N<p.length;N++)p[N].isOccluded?(C=N+1,I=0):(I++,I>S&&(S=I,b=C));return p.slice(b,b+S)})(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],c=new u.aa;for(const $ of t){const G=new u.P($.x+Ri,$.y+Ri);c.extend(G),a.push(G)}const{minX:p,minY:b,maxX:S,maxY:C}=c,I=this.grid.query(p,b,S,C).concat(this.ignoredGrid.query(p,b,S,C)),N={},U={};for(const $ of I){const G=$.key;if(N[G.bucketInstanceId]===void 0&&(N[G.bucketInstanceId]={}),N[G.bucketInstanceId][G.featureIndex])continue;const K=[new u.P($.x1,$.y1),new u.P($.x2,$.y1),new u.P($.x2,$.y2),new u.P($.x1,$.y2)];u.aK(a,K)&&(N[G.bucketInstanceId][G.featureIndex]=!0,U[G.bucketInstanceId]===void 0&&(U[G.bucketInstanceId]=[]),U[G.bucketInstanceId].push(G.featureIndex))}return U}insertCollisionBox(t,a,c,p,b,S){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:b,collisionGroupID:S,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,p,b,S){const C=c?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:b,collisionGroupID:S,overlapMode:a};for(let N=0;N<t.length;N+=4)C.insertCircle(I,t[N],t[N+1],t[N+2])}projectAndGetPerspectiveRatio(t,a,c,p,b){if(b){let S;p?(S=[t,a,p(t,a),1],u.aH(S,S,b)):(S=[t,a,0,1],na(S,S,b));const C=S[3];return{x:(S[0]/C+1)/2*this.transform.width+Ri,y:(-S[1]/C+1)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{const S=this.transform.projectTileCoordinates(t,a,c,p);return{x:(S.point.x+1)/2*this.transform.width+Ri,y:(1-S.point.y)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5,isOccluded:S.isOccluded,signedDistanceFromCamera:S.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,c,p){const b=this.transform.projectTileCoordinates(t,a,c,p);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(t,a,c,p){return c<Ri||t>=this.screenRightBoundary||p<Ri||a>this.screenBottomBoundary}isInsideGrid(t,a,c,p){return c>=0&&t<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=u.ar([]);return u.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,c,p,b,S,C,I,N,U,$){let G=1,K=0,ie=0,he=1;const me=t.anchorPointX+C[0],pe=t.anchorPointY+C[1];if(S&&!b){const kt=this.projectAndGetPerspectiveRatio(me+1,pe,p,N,$),xt=kt.x-I.x,Bt=Math.atan((kt.y-I.y)/xt)+(xt<0?Math.PI:0),Ti=Math.sin(Bt),pn=Math.cos(Bt);G=pn,K=Ti,ie=-Ti,he=pn}else if(!S&&b){const kt=Ms(this.transform);G=kt.vecEast[0],K=kt.vecEast[1],ie=kt.vecSouth[0],he=kt.vecSouth[1]}let ve=I.x,Me=I.y,ye=a;b&&(ve=me,Me=pe,ye=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),ye*=this.transform.getPitchedTextCorrection(me,pe,p),U||(ye*=u.an(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(ve+=G*U.x*ye+ie*U.y*ye,Me+=K*U.x*ye+he*U.y*ye);const Ee=t.x1*ye,Le=t.x2*ye,Te=(Ee+Le)/2,Oe=t.y1*ye,et=t.y2*ye,Xe=(Oe+et)/2,We=[{offsetX:Ee,offsetY:Oe},{offsetX:Te,offsetY:Oe},{offsetX:Le,offsetY:Oe},{offsetX:Le,offsetY:Xe},{offsetX:Le,offsetY:et},{offsetX:Te,offsetY:et},{offsetX:Ee,offsetY:et},{offsetX:Ee,offsetY:Xe}];let Ke=[];for(const{offsetX:kt,offsetY:xt}of We)Ke.push(new u.P(ve+G*kt+ie*xt,Me+K*kt+he*xt));let zt=!1;if(b){const kt=Ke.map((xt=>this.projectAndGetPerspectiveRatio(xt.x,xt.y,p,N,$)));zt=kt.some((xt=>!xt.isOccluded)),Ke=kt.map((xt=>new u.P(xt.x,xt.y)))}else zt=!0;return{box:u.aL(Ke),allPointsOccluded:!zt}}}class Jc{constructor(t,a,c,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Si{constructor(t,a,c,p,b){this.text=new Jc(t?t.text:null,a,c,b),this.icon=new Jc(t?t.icon:null,a,p,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hn{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class rl{constructor(t,a,c,p,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=b}}class uc{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function Pn(y,t,a,c,p){const{horizontalAlign:b,verticalAlign:S}=u.aS(y);return new u.P(-(b-.5)*t+c[0]*p,-(S-.5)*a+c[1]*p)}class hc{constructor(t,a,c,p,b){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Mo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new uc(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(c,p)=>a.getElevation(t,c,p):null}getBucketParts(t,a,c,p){const b=c.getBucket(a),S=c.latestFeatureIndex;if(!b||!S||a.id!==b.layerIds[0])return;const C=c.collisionBoxArray,I=b.layers[0].layout,N=b.layers[0].paint,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),$=c.tileSize/u.a5,G=c.tileID.toUnwrapped(),K=I.get("text-rotation-alignment")==="map",ie=u.aN(c,1,this.transform.zoom),he=u.aO(this.collisionIndex.transform,c,N.get("text-translate"),N.get("text-translate-anchor")),me=u.aO(this.collisionIndex.transform,c,N.get("icon-translate"),N.get("icon-translate-anchor")),pe=ma(K,this.transform,ie);this.retainedQueryData[b.bucketInstanceId]=new rl(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,c.tileID);const ve={bucket:b,layout:I,translationText:he,translationIcon:me,unwrappedTileID:G,pitchedLabelPlaneMatrix:pe,scale:U,textPixelRatio:$,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:u.ay(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(const Me of b.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Ee,symbolInstanceEnd:Le}=Me;t.push({sortKey:ye,symbolInstanceStart:Ee,symbolInstanceEnd:Le,parameters:ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(t,a,c,p,b,S,C,I,N,U,$,G,K,ie,he,me,pe,ve,Me,ye){const Ee=u.aP[t.textAnchor],Le=[t.textOffset0,t.textOffset1],Te=Pn(Ee,c,p,Le,b),Oe=this.collisionIndex.placeCollisionBox(a,G,I,N,U,C,S,me,$.predicate,Me,Te,ye);if((!ve||this.collisionIndex.placeCollisionBox(ve,G,I,N,U,C,S,pe,$.predicate,Me,Te,ye).placeable)&&Oe.placeable){let et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(et=this.prevPlacement.variableOffsets[K.crossTileID].anchor),K.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[K.crossTileID]={textOffset:Le,width:c,height:p,anchor:Ee,textBoxScale:b,prevAnchor:et},this.markUsedJustification(ie,Ee,K,he),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,he,K),this.placedOrientations[K.crossTileID]=he),{shift:Te,placedGlyphBoxes:Oe}}}placeLayerBucketPart(t,a,c){const{bucket:p,layout:b,translationText:S,translationIcon:C,unwrappedTileID:I,pitchedLabelPlaneMatrix:N,textPixelRatio:U,holdingForFade:$,collisionBoxArray:G,partiallyEvaluatedTextSize:K,collisionGroup:ie}=t.parameters,he=b.get("text-optional"),me=b.get("icon-optional"),pe=u.aQ(b,"text-overlap","text-allow-overlap"),ve=pe==="always",Me=u.aQ(b,"icon-overlap","icon-allow-overlap"),ye=Me==="always",Ee=b.get("text-rotation-alignment")==="map",Le=b.get("text-pitch-alignment")==="map",Te=b.get("icon-text-fit")!=="none",Oe=b.get("symbol-z-order")==="viewport-y",et=ve&&(ye||!p.hasIconData()||me),Xe=ye&&(ve||!p.hasTextData()||he);!p.collisionArrays&&G&&p.deserializeCollisionBoxes(G);const We=this.retainedQueryData[p.bucketInstanceId].tileID,Ke=this._getTerrainElevationFunc(We),zt=this.transform.getFastPathSimpleProjectionMatrix(We),kt=(xt,Bt,Ti)=>{var pn,Dn;if(a[xt.crossTileID])return;if($)return void(this.placements[xt.crossTileID]=new Hn(!1,!1,!1));let En=!1,Zn=!1,xn=!0,nr=null,qn={box:null,placeable:!1,offscreen:null,occluded:!1},Hr={placeable:!1},ur=null,hr=null,$r=null,Wo=0,Ko=0,_o=0;Bt.textFeatureIndex?Wo=Bt.textFeatureIndex:xt.useRuntimeCollisionCircles&&(Wo=xt.featureIndex),Bt.verticalTextFeatureIndex&&(Ko=Bt.verticalTextFeatureIndex);const Ya=Bt.textBox;if(Ya){const Wa=yn=>{let Mn=u.az.horizontal;if(p.allowVerticalPlacement&&!yn&&this.prevPlacement){const Tr=this.prevPlacement.placedOrientations[xt.crossTileID];Tr&&(this.placedOrientations[xt.crossTileID]=Tr,Mn=Tr,this.markUsedOrientation(p,Mn,xt))}return Mn},vs=(yn,Mn)=>{if(p.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const Tr of p.writingModes)if(Tr===u.az.vertical?(qn=Mn(),Hr=qn):qn=yn(),qn&&qn.placeable)break}else qn=yn()},Us=xt.textAnchorOffsetStartIndex,Vs=xt.textAnchorOffsetEndIndex;if(Vs===Us){const yn=(Mn,Tr)=>{const zr=this.collisionIndex.placeCollisionBox(Mn,pe,U,We,I,Le,Ee,S,ie.predicate,Ke,void 0,zt);return zr&&zr.placeable&&(this.markUsedOrientation(p,Tr,xt),this.placedOrientations[xt.crossTileID]=Tr),zr};vs((()=>yn(Ya,u.az.horizontal)),(()=>{const Mn=Bt.verticalTextBox;return p.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&Mn?yn(Mn,u.az.vertical):{box:null,offscreen:null}})),Wa(qn&&qn.placeable)}else{let yn=u.aP[(Dn=(pn=this.prevPlacement)===null||pn===void 0?void 0:pn.variableOffsets[xt.crossTileID])===null||Dn===void 0?void 0:Dn.anchor];const Mn=(zr,$h,Xh)=>{const Kl=zr.x2-zr.x1,Of=zr.y2-zr.y1,Ql=xt.textBoxScale,Yh=Te&&Me==="never"?$h:null;let Al=null,Cl=pe==="never"?1:2,vo="never";yn&&Cl++;for(let Wh=0;Wh<Cl;Wh++){for(let oh=Us;oh<Vs;oh++){const lh=p.textAnchorOffsets.get(oh);if(yn&&lh.textAnchor!==yn)continue;const ch=this.attemptAnchorPlacement(lh,zr,Kl,Of,Ql,Ee,Le,U,We,I,ie,vo,xt,p,Xh,S,C,Yh,Ke);if(ch&&(Al=ch.placedGlyphBoxes,Al&&Al.placeable))return En=!0,nr=ch.shift,Al}yn?yn=null:vo=pe}return c&&!Al&&(Al={box:this.collisionIndex.placeCollisionBox(Ya,"always",U,We,I,Le,Ee,S,ie.predicate,Ke,void 0,zt).box,offscreen:!1,placeable:!1,occluded:!1}),Al};vs((()=>Mn(Ya,Bt.iconBox,u.az.horizontal)),(()=>{const zr=Bt.verticalTextBox;return p.allowVerticalPlacement&&(!qn||!qn.placeable)&&xt.numVerticalGlyphVertices>0&&zr?Mn(zr,Bt.verticalIconBox,u.az.vertical):{box:null,occluded:!0,offscreen:null}})),qn&&(En=qn.placeable,xn=qn.offscreen);const Tr=Wa(qn&&qn.placeable);if(!En&&this.prevPlacement){const zr=this.prevPlacement.variableOffsets[xt.crossTileID];zr&&(this.variableOffsets[xt.crossTileID]=zr,this.markUsedJustification(p,zr.anchor,xt,Tr))}}}if(ur=qn,En=ur&&ur.placeable,xn=ur&&ur.offscreen,xt.useRuntimeCollisionCircles&&xt.centerJustifiedTextSymbolIndex>=0){const Wa=p.text.placedSymbolArray.get(xt.centerJustifiedTextSymbolIndex),vs=u.aA(p.textSizeData,K,Wa),Us=b.get("text-padding");hr=this.collisionIndex.placeCollisionCircles(pe,Wa,p.lineVertexArray,p.glyphOffsetArray,vs,I,N,c,Le,ie.predicate,xt.collisionCircleDiameter,Us,S,Ke),hr.circles.length&&hr.collisionDetected&&!c&&u.w("Collisions detected, but collision boxes are not shown"),En=ve||hr.circles.length>0&&!hr.collisionDetected,xn=xn&&hr.offscreen}if(Bt.iconFeatureIndex&&(_o=Bt.iconFeatureIndex),Bt.iconBox){const Wa=vs=>this.collisionIndex.placeCollisionBox(vs,Me,U,We,I,Le,Ee,C,ie.predicate,Ke,Te&&nr?nr:void 0,zt);Hr&&Hr.placeable&&Bt.verticalIconBox?($r=Wa(Bt.verticalIconBox),Zn=$r.placeable):($r=Wa(Bt.iconBox),Zn=$r.placeable),xn=xn&&$r.offscreen}const Ic=he||xt.numHorizontalGlyphVertices===0&&xt.numVerticalGlyphVertices===0,yu=me||xt.numIconVertices===0;Ic||yu?yu?Ic||(Zn=Zn&&En):En=Zn&&En:Zn=En=Zn&&En;const yo=Zn&&$r.placeable;if(En&&ur.placeable&&this.collisionIndex.insertCollisionBox(ur.box,pe,b.get("text-ignore-placement"),p.bucketInstanceId,Hr&&Hr.placeable&&Ko?Ko:Wo,ie.ID),yo&&this.collisionIndex.insertCollisionBox($r.box,Me,b.get("icon-ignore-placement"),p.bucketInstanceId,_o,ie.ID),hr&&En&&this.collisionIndex.insertCollisionCircles(hr.circles,pe,b.get("text-ignore-placement"),p.bucketInstanceId,Wo,ie.ID),c&&this.storeCollisionData(p.bucketInstanceId,Ti,Bt,ur,$r,hr),xt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xt.crossTileID]=new Hn((En||et)&&!ur?.occluded,(Zn||Xe)&&!$r?.occluded,xn||p.justReloaded),a[xt.crossTileID]=!0};if(Oe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const xt=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Bt=xt.length-1;Bt>=0;--Bt){const Ti=xt[Bt];kt(p.symbolInstances.get(Ti),p.collisionArrays[Ti],Ti)}}else for(let xt=t.symbolInstanceStart;xt<t.symbolInstanceEnd;xt++)kt(p.symbolInstances.get(xt),p.collisionArrays[xt],xt);p.justReloaded=!1}storeCollisionData(t,a,c,p,b,S){if(c.textBox||c.iconBox){let C,I;this.collisionBoxArrays.has(t)?C=this.collisionBoxArrays.get(t):(C=new Map,this.collisionBoxArrays.set(t,C)),C.has(a)?I=C.get(a):(I={text:null,icon:null},C.set(a,I)),c.textBox&&(I.text=p.box),c.iconBox&&(I.icon=b.box)}if(S){let C=this.collisionCircleArrays[t];C===void 0&&(C=this.collisionCircleArrays[t]=[]);for(let I=0;I<S.circles.length;I+=4)C.push(S.circles[I+0]-Ri),C.push(S.circles[I+1]-Ri),C.push(S.circles[I+2]),C.push(S.collisionDetected?1:0)}}markUsedJustification(t,a,c,p){let b;b=p===u.az.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[u.aR(a)];const S=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const C of S)C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=b>=0&&C!==b?0:c.crossTileID)}markUsedOrientation(t,a,c){const p=a===u.az.horizontal||a===u.az.horizontalOnly?a:0,b=a===u.az.vertical?a:0,S=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const C of S)t.text.placedSymbolArray.get(C).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const p=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},S=a?a.variableOffsets:{},C=a?a.placedOrientations:{};for(const I in this.placements){const N=this.placements[I],U=b[I];U?(this.opacities[I]=new Si(U,p,N.text,N.icon),c=c||N.text!==U.text.placed||N.icon!==U.icon.placed):(this.opacities[I]=new Si(null,p,N.text,N.icon,N.skipFade),c=c||N.text||N.icon)}for(const I in b){const N=b[I];if(!this.opacities[I]){const U=new Si(N,p,!1,!1);U.isHidden()||(this.opacities[I]=U,c=c||N.text.placed||N.icon.placed)}}for(const I in S)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=S[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const p of a){const b=p.getBucket(t);b&&p.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,p.tileID,c,p.collisionBoxArray)}}updateBucketOpacities(t,a,c,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0],S=b.layout,C=new Si(null,0,!1,!1,!0),I=S.get("text-allow-overlap"),N=S.get("icon-allow-overlap"),U=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=S.get("text-rotation-alignment")==="map",G=S.get("text-pitch-alignment")==="map",K=S.get("icon-text-fit")!=="none",ie=new Si(null,0,I&&(N||!t.hasIconData()||S.get("icon-optional")),N&&(I||!t.hasTextData()||S.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const he=(pe,ve,Me)=>{for(let ye=0;ye<ve/4;ye++)pe.opacityVertexArray.emplaceBack(Me);pe.hasVisibleVertices=pe.hasVisibleVertices||Me!==eo},me=this.collisionBoxArrays.get(t.bucketInstanceId);for(let pe=0;pe<t.symbolInstances.length;pe++){const ve=t.symbolInstances.get(pe),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:ye,crossTileID:Ee}=ve;let Le=this.opacities[Ee];c[Ee]?Le=C:Le||(Le=ie,this.opacities[Ee]=Le),c[Ee]=!0;const Te=ve.numIconVertices>0,Oe=this.placedOrientations[ve.crossTileID],et=Oe===u.az.vertical,Xe=Oe===u.az.horizontal||Oe===u.az.horizontalOnly;if(Me>0||ye>0){const Ke=Nl(Le.text);he(t.text,Me,et?eo:Ke),he(t.text,ye,Xe?eo:Ke);const zt=Le.text.isHidden();[ve.rightJustifiedTextSymbolIndex,ve.centerJustifiedTextSymbolIndex,ve.leftJustifiedTextSymbolIndex].forEach((Bt=>{Bt>=0&&(t.text.placedSymbolArray.get(Bt).hidden=zt||et?1:0)})),ve.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ve.verticalPlacedTextSymbolIndex).hidden=zt||Xe?1:0);const kt=this.variableOffsets[ve.crossTileID];kt&&this.markUsedJustification(t,kt.anchor,ve,Oe);const xt=this.placedOrientations[ve.crossTileID];xt&&(this.markUsedJustification(t,"left",ve,xt),this.markUsedOrientation(t,xt,ve))}if(Te){const Ke=Nl(Le.icon),zt=!(K&&ve.verticalPlacedIconSymbolIndex&&et);ve.placedIconSymbolIndex>=0&&(he(t.icon,ve.numIconVertices,zt?Ke:eo),t.icon.placedSymbolArray.get(ve.placedIconSymbolIndex).hidden=Le.icon.isHidden()),ve.verticalPlacedIconSymbolIndex>=0&&(he(t.icon,ve.numVerticalIconVertices,zt?eo:Ke),t.icon.placedSymbolArray.get(ve.verticalPlacedIconSymbolIndex).hidden=Le.icon.isHidden())}const We=me&&me.has(pe)?me.get(pe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ke=t.collisionArrays[pe];if(Ke){let zt=new u.P(0,0);if(Ke.textBox||Ke.verticalTextBox){let kt=!0;if(U){const xt=this.variableOffsets[Ee];xt?(zt=Pn(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textBoxScale),$&&zt._rotate(G?-this.transform.bearingInRadians:this.transform.bearingInRadians)):kt=!1}if(Ke.textBox||Ke.verticalTextBox){let xt;Ke.textBox&&(xt=et),Ke.verticalTextBox&&(xt=Xe),al(t.textCollisionBox.collisionVertexArray,Le.text.placed,!kt||xt,We.text,zt.x,zt.y)}}if(Ke.iconBox||Ke.verticalIconBox){const kt=!!(!Xe&&Ke.verticalIconBox);let xt;Ke.iconBox&&(xt=kt),Ke.verticalIconBox&&(xt=!kt),al(t.iconCollisionBox.collisionVertexArray,Le.icon.placed,xt,We.icon,K?zt.x:0,K?zt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function al(y,t,a,c,p,b){c&&c.length!==0||(c=[0,0,0,0]);const S=c[0]-Ri,C=c[1]-Ri,I=c[2]-Ri,N=c[3]-Ri;y.emplaceBack(t?1:0,a?1:0,p||0,b||0,S,C),y.emplaceBack(t?1:0,a?1:0,p||0,b||0,I,C),y.emplaceBack(t?1:0,a?1:0,p||0,b||0,I,N),y.emplaceBack(t?1:0,a?1:0,p||0,b||0,S,N)}const ss=Math.pow(2,25),Sn=Math.pow(2,24),Ao=Math.pow(2,17),Ps=Math.pow(2,16),Ba=Math.pow(2,9),eu=Math.pow(2,8),os=Math.pow(2,1);function Nl(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,a=Math.floor(127*y.opacity);return a*ss+t*Sn+a*Ao+t*Ps+a*Ba+t*eu+a*os+t}const eo=0;class ls{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,p,b){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(S,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(((C,I)=>C.sortKey-I.sortKey)));this._currentPartIndex<S.length;)if(a.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1}}class Co{constructor(t,a,c,p,b,S,C,I){this.placement=new hc(t,a,S,C,I),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const p=be(),b=()=>!this._forceFullPlacement&&be()-p>2;for(;this._currentPlacementIndex>=0;){const S=a[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=C)&&(!S.maxzoom||S.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new ls(S)),this._inProgressLayer.continuePlacement(c[S.source],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const bi=512/u.a5/2;class ga{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const p=new Map;for(let b=0;b<a.length;b++){const S=a.get(b),C=S.key,I=p.get(C);I?I.push(S):p.set(C,[S])}for(const[b,S]of p){const C={positions:S.map((I=>({x:Math.floor(I.anchorX*bi),y:Math.floor(I.anchorY*bi)}))),crossTileIDs:S.map((I=>I.crossTileID))};if(C.positions.length>128){const I=new u.aT(C.positions.length,16,Uint16Array);for(const{x:N,y:U}of C.positions)I.add(N,U);I.finish(),delete C.positions,C.index=I}this._symbolsByKey[b]=C}}getScaledCoordinates(t,a){const{x:c,y:p,z:b}=this.tileID.canonical,{x:S,y:C,z:I}=a.canonical,N=bi/Math.pow(2,I-b),U=(C*u.a5+t.anchorY)*N,$=p*u.a5*bi;return{x:Math.floor((S*u.a5+t.anchorX)*N-c*u.a5*bi),y:Math.floor(U-$)}}findMatches(t,a,c){const p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let b=0;b<t.length;b++){const S=t.get(b);if(S.crossTileID)continue;const C=this._symbolsByKey[S.key];if(!C)continue;const I=this.getScaledCoordinates(S,a);if(C.index){const N=C.index.range(I.x-p,I.y-p,I.x+p,I.y+p).sort();for(const U of N){const $=C.crossTileIDs[U];if(!c[$]){c[$]=!0,S.crossTileID=$;break}}}else if(C.positions)for(let N=0;N<C.positions.length;N++){const U=C.positions[N],$=C.crossTileIDs[N];if(Math.abs(U.x-I.x)<=p&&Math.abs(U.y-I.y)<=p&&!c[$]){c[$]=!0,S.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class tu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const p=this.indexes[c],b={};for(const S in p){const C=p[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+a),b[C.tileID.key]=C}this.indexes[c]=b}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>t.overscaledZ)for(const C in S){const I=S[C];I.tileID.isChildOf(t)&&I.findMatches(a.symbolInstances,t,p)}else{const C=S[t.scaledTo(Number(b)).key];C&&C.findMatches(a.symbolInstances,t,p)}}for(let b=0;b<a.symbolInstances.length;b++){const S=a.symbolInstances.get(b);S.crossTileID||(S.crossTileID=c.generate(),p[S.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ga(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const p of c)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const p=this.indexes[c];for(const b in p)t[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[b]),delete p[b],a=!0)}return a}}class xr{constructor(){this.layerIndexes={},this.crossTileIDs=new tu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new sl);let b=!1;const S={};p.handleWrapJump(c);for(const C of a){const I=C.getBucket(t);I&&t.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(C.tileID,I,this.crossTileIDs)&&(b=!0),S[I.bucketInstanceId]=!0)}return p.removeStaleBuckets(S)&&(b=!0),b}pruneUnusedLayers(t){const a={};t.forEach((c=>{a[c]=!0}));for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var ii="void main() {fragColor=vec4(1.0);}";const Hi={prelude:$t(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:$t("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:$t("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:$t(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:$t(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:$t(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:$t(ii,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:$t(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:$t(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:$t("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$t("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:$t(ii,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:$t(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:$t(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:$t(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:$t(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:$t(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:$t(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:$t(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:$t(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:$t(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:$t(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:$t(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:$t("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:$t("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:$t("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:$t("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:$t(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:$t("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function $t(y,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),p=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=b?b.concat(p):p,C={};return{fragmentSource:y=y.replace(a,((I,N,U,$,G)=>(C[G]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${U} ${$} ${G};
#else
uniform ${U} ${$} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${U} ${$} ${G} = u_${G};
#endif
`))),vertexSource:t=t.replace(a,((I,N,U,$,G)=>{const K=$==="float"?"vec2":"vec4",ie=G.match(/color/)?"color":K;return C[G]?N==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${U} ${K} a_${G};
out ${U} ${$} ${G};
#else
uniform ${U} ${$} u_${G};
#endif
`:ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${U} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${ie}(a_${G}, u_${G}_t);
#else
    ${U} ${$} ${G} = u_${G};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${U} ${K} a_${G};
#else
uniform ${U} ${$} u_${G};
#endif
`:ie==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${U} ${$} ${G} = a_${G};
#else
    ${U} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${U} ${$} ${G} = unpack_mix_${ie}(a_${G}, u_${G}_t);
#else
    ${U} ${$} ${G} = u_${G};
#endif
`})),staticAttributes:c,staticUniforms:S}}class hn{constructor(t,a,c){this.vertexBuffer=t,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var _a=u.aU([{name:"a_pos",type:"Int16",components:2}]);const kn="#define PROJECTION_MERCATOR",Or="mercator";class Rn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Or}get shaderDefine(){return kn}get shaderPreludeCode(){return Hi.projectionMercator}get vertexShaderPreludeCode(){return Hi.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,c,p,b){if(this._cachedMesh)return this._cachedMesh;const S=new u.aW;S.emplaceBack(0,0),S.emplaceBack(u.a5,0),S.emplaceBack(0,u.a5),S.emplaceBack(u.a5,u.a5);const C=t.createVertexBuffer(S,_a.members),I=u.aX.simpleSegment(0,0,4,2),N=new u.aY;N.emplaceBack(1,0,2),N.emplaceBack(1,2,3);const U=t.createIndexBuffer(N);return this._cachedMesh=new hn(C,U,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ra{constructor(t=0,a=0,c=0,p=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=p}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=u.G.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=u.G.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=u.G.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=u.G.number(t.right,a.right,c)),this}getCenter(t,a){const c=u.an((this.left+t-this.right)/2,0,t),p=u.an((this.top+a-this.bottom)/2,0,a);return new u.P(c,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ra(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ya(y,t){if(!y.renderWorldCopies||y.lngRange)return;const a=t.lng-y.center.lng;t.lng+=a>180?-360:a<-180?360:0}function Pi(y){return Math.max(0,Math.floor(y))}class va{constructor(t,a){var c;this.applyConstrain=(p,b)=>this._constrainOverride!==null?this._constrainOverride(p,b):this._callbacks.defaultConstrain(p,b),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Pi(this._zoom),this._scale=u.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ra,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,c){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Pi(this._zoom),this._scale=u.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ra(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=u.W(t,-180,180)*Math.PI/180;var c,p,b,S,C,I,N,U,$;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=te(),c=this._rotationMatrix,b=-this._bearingInRadians,S=(p=this._rotationMatrix)[0],C=p[1],I=p[2],N=p[3],U=Math.sin(b),$=Math.cos(b),c[0]=S*$+I*U,c[1]=C*$+N*U,c[2]=S*-U+I*$,c[3]=C*-U+N*$)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=u.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aZ(this._fovInRadians)}setFov(t){t=u.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=u.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=u.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this.constrainInternal(),this._calcMatrices()}resize(t,a,c=!0){this._width=t,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ln([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-u.ao,u.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:c,minY:p,maxX:b,maxY:S}=u.aa.fromPoints(a).extend(t);return[new u.P(c,p),new u.P(b,p),new u.P(b,S),new u.P(c,S),new u.P(c,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=u.ar(new Float64Array(16));u.Q(t,t,[this._width/2,-this._height/2,1]),u.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=u.ar(new Float64Array(16)),u.Q(t,t,[1,-1,1]),u.O(t,t,[-1,-1,0]),u.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,c,p){const b=c!==void 0?c:this.bearing,S=p=p!==void 0?p:this.pitch,{distanceToCenter:C,clampedElevation:I}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,S),{x:N,y:U}=Wi(S,b),$=u.a9.fromLngLat(t,a);let G,K,ie=u.a_(1,$.y),he=0;do{if(he+=1,he>10)break;K=C/ie,G=new u.a9($.x+N*K,$.y+U*K),ie=1/G.meterInMercatorCoordinateUnits()}while(Math.abs(C-K*ie)>1e-12);return{center:G.toLngLat(),elevation:I,zoom:u.at(this.height/2/Math.tan(this.fovInRadians/2)/K/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,c=u.as(1,this.center.lat)*this.worldSize,p=u.a9.fromLngLat(this.center,this.elevation),b=p.x/a,S=p.y/a,C=p.z/a,I=this.pitch,N=this.bearing,{x:U,y:$,z:G}=Wi(I,N),K=this.cameraToCenterDistance,ie=b+K*-U,he=S+K*-$,me=C+K*G,{distanceToCenter:pe,clampedElevation:ve}=this._distanceToCenterFromAltElevationPitch(me/c,t,I),Me=pe*c,ye=new u.a9((ie+U*Me)*a,(he+$*Me)*a,0).toLngLat(),Ee=u.as(1,ye.lat),Le=u.at(this.height/2/Math.tan(this.fovInRadians/2)/pe/Ee/this.tileSize);this._elevation=ve,this._center=ye,this.setZoom(Le)}_distanceToCenterFromAltElevationPitch(t,a,c){const p=-Math.cos(u.ap(c)),b=t-a;let S,C=a;return p*b>=0||Math.abs(p)<.1?(S=1e4,C=t+S*p):S=-b/p,{distanceToCenter:S,clampedElevation:C}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=u.as(1,this.center.lat)*this.worldSize;return $e(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/u.a5,1/a/u.a5]}}class xa{constructor(t,a){this.min=t,this.max=a,this.center=u.a$([],u.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],c=u.b1(this.min),p=u.b1(this.max);for(let b=0;b<a.length;b++)c[b]=a[b]?this.min[b]:this.center[b],p[b]=a[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new xa(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let c=0;c<t.planes.length;c++){const p=this.intersectsPlane(t.planes[c]);if(p===0)return 0;p===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],c=t[3];for(let p=0;p<3;p++)t[p]>0?(a+=t[p]*this.min[p],c+=t[p]*this.max[p]):(c+=t[p]*this.min[p],a+=t[p]*this.max[p]);return a>=0?2:c<0?0:1}}class Po{distanceToTile2d(t,a,c,p){const b=p.distanceX([t,a]),S=p.distanceY([t,a]);return Math.hypot(b,S)}getWrap(t,a,c){return c}getTileBoundingVolume(t,a,c,p){var b,S;let C=0,I=0;if(p?.terrain){const U=new u.a2(t.z,a,t.z,t.x,t.y),$=p.terrain.getMinMaxElevation(U);C=(b=$.minElevation)!==null&&b!==void 0?b:Math.min(0,c),I=(S=$.maxElevation)!==null&&S!==void 0?S:Math.max(0,c)}const N=1<<t.z;return new xa([a+t.x/N,t.y/N,C],[a+(t.x+1)/N,(t.y+1)/N,I])}allowVariableZoom(t,a){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,p=u.an(78.5-c/2,0,60);return!!a.terrain||t.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class aa{constructor(t,a,c){this.points=t,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(t,a=1,c=0,p,b){const S=b?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],C=Math.pow(2,c),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((G=>(function(K,ie,he,me){const pe=u.aH([],K,ie),ve=1/pe[3]/he*me;return u.b6(pe,pe,[ve,ve,1/pe[3],ve])})(G,t,a,C)));p&&(function(G,K,ie,he){const me=he?4:0,pe=he?0:4;let ve=0;const Me=[],ye=[];for(let Te=0;Te<4;Te++){const Oe=u.b2([],G[Te+pe],G[Te+me]),et=u.b7(Oe);u.a$(Oe,Oe,1/et),Me.push(et),ye.push(Oe)}for(let Te=0;Te<4;Te++){const Oe=u.b8(G[Te+me],ye[Te],ie);ve=Oe!==null&&Oe>=0?Math.max(ve,Oe):Math.max(ve,Me[Te])}const Ee=(function(Te,Oe){const et=u.b2([],Te[Oe[0]],Te[Oe[1]]),Xe=u.b2([],Te[Oe[2]],Te[Oe[1]]),We=[0,0,0,0];return u.b3(We,u.b4([],et,Xe)),We[3]=-u.b5(We,Te[Oe[0]]),We})(G,K),Le=(function(Te,Oe){const et=u.b9(Te),Xe=u.ba([],Te,1/et),We=u.b2([],Oe,u.a$([],Xe,u.b5(Oe,Xe))),Ke=u.b9(We);if(Ke>0){const zt=Math.sqrt(1-Xe[3]*Xe[3]),kt=u.a$([],Xe,-Xe[3]),xt=u.b0([],kt,u.a$([],We,zt/Ke));return u.bb(Oe,xt)}return null})(ie,Ee);if(Le!==null){const Te=Le/u.b5(ye[0],Ee);ve=Math.min(ve,Te)}for(let Te=0;Te<4;Te++){const Oe=Math.min(ve,Me[Te]);G[Te+pe]=[G[Te+me][0]+ye[Te][0]*Oe,G[Te+me][1]+ye[Te][1]*Oe,G[Te+me][2]+ye[Te][2]*Oe,1]}})(I,S[0],p,b);const N=S.map((G=>{const K=u.b2([],I[G[0]],I[G[1]]),ie=u.b2([],I[G[2]],I[G[1]]),he=u.b3([],u.b4([],K,ie)),me=-u.b5(he,I[G[1]]);return he.concat(me)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],$=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const G of I)for(let K=0;K<3;K++)U[K]=Math.min(U[K],G[K]),$[K]=Math.max($[K],G[K]);return new aa(I,N,new xa(U,$))}}class or{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=u.an(+c,this.minZoom,this.maxZoom);const p={center:new u.V(a.lng,a.lat),zoom:c};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const ye=179.9999999999;b=[-ye,ye]}const S=this.tileSize*u.aq(p.zoom);let C=0,I=S,N=0,U=S,$=0,G=0;const{x:K,y:ie}=this.size;if(this._helper._latRange){const ye=this._helper._latRange;C=u.X(ye[1])*S,I=u.X(ye[0])*S,I-C<ie&&($=ie/(I-C))}b&&(N=u.W(u.Y(b[0])*S,0,S),U=u.W(u.Y(b[1])*S,0,S),U<N&&(U+=S),U-N<K&&(G=K/(U-N)));const{x:he,y:me}=ei(S,a);let pe,ve;const Me=Math.max(G||0,$||0);if(Me){const ye=new u.P(G?(U+N)/2:he,$?(I+C)/2:me);return p.center=hi(S,ye).wrap(),p.zoom+=u.at(Me),p}if(this._helper._latRange){const ye=ie/2;me-ye<C&&(ve=C+ye),me+ye>I&&(ve=I-ye)}if(b){const ye=(N+U)/2;let Ee=he;this._helper._renderWorldCopies&&(Ee=u.W(he,ye-S/2,ye+S/2));const Le=K/2;Ee-Le<N&&(pe=N+Le),Ee+Le>U&&(pe=U-Le)}if(pe!==void 0||ve!==void 0){const ye=new u.P(pe??he,ve??me);p.center=hi(S,ye).wrap()}return p},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new va({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new Po}clone(){const t=new or;return t.apply(this),t}apply(t,a,c){this._helper.apply(t,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new u.bc(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new u.P(0,0)),p=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),S=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),C=Math.floor(Math.min(c.x,p.x,b.x,S.x)),I=Math.floor(Math.max(c.x,p.x,b.x,S.x)),N=1;for(let U=C-N;U<=I+N;U++)U!==0&&a.push(new u.bc(U,t))}return a}getCameraFrustum(){return aa.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,a){const c=u.as(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(a,c),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),S=u.a9.fromLngLat(t),C=new u.a9(S.x-(p.x-b.x),S.y-(p.y-b.y));this.setCenter(C?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(u.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(u.a9.fromLngLat(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const c=a||0,p=[t.x,t.y,0,1],b=[t.x,t.y,1,1];u.aH(p,p,this._pixelMatrixInverse),u.aH(b,b,this._pixelMatrixInverse);const S=p[3],C=b[3],I=p[1]/S,N=b[1]/C,U=p[2]/S,$=b[2]/C,G=U===$?0:(c-U)/($-U);return new u.a9(u.G.number(p[0]/S,b[0]/C,G)/this.worldSize,u.G.number(I,N,G)/this.worldSize,c)}coordinatePoint(t,a=0,c=this._pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,a,1];return u.aH(p,p,c),new u.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Vi(this));return new ln().extend(this.screenPointToLocation(new u.P(0,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-Vi(this)}calculatePosMatrix(t,a=!1,c){var p;const b=(p=t.key)!==null&&p!==void 0?p:u.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),S=a?this._alignedPosMatrixCache:this._posMatrixCache;if(S.has(b)){const N=S.get(b);return c?N.f32:N.f64}const C=Di(t,this.worldSize);u.S(C,a?this._alignedProjMatrix:this._viewProjMatrix,C);const I={f64:C,f32:new Float32Array(C)};return S.set(b,I),c?I.f32:I.f64}calculateFogMatrix(t){const a=t.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);const p=Di(t,this.worldSize);return u.S(p,this._fogMatrix,p),c.set(a,new Float32Array(p)),c.get(a)}calculateCenterFromCameraLngLatAlt(t,a,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,p)}_calculateNearFarZIfNeeded(t,a,c){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=t-p*this._helper._pixelPerMeter/Math.cos(a),S=p<0?b:t,C=Math.PI/2+this.pitchInRadians,I=u.ap(this.fov)*(Math.abs(Math.cos(u.ap(this.roll)))*this.height+Math.abs(Math.sin(u.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),N=Math.sin(I)*S/Math.sin(u.an(Math.PI-C-I,.01,Math.PI-.01)),U=Vi(this),$=Math.atan(U/this._helper.cameraToCenterDistance),G=u.ap(.75),K=$>G?2*$*(.5+c.y/(2*U)):G,ie=Math.sin(K)*S/Math.sin(u.an(Math.PI-C-K,.01,Math.PI-.01)),he=Math.min(N,ie);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*he+S),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=ei(this.worldSize,this.center),c=a.x,p=a.y;this._helper._pixelPerMeter=u.as(1,this.center.lat)*this.worldSize;const b=u.ap(Math.min(this.pitch,Ft)),S=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let C;this._calculateNearFarZIfNeeded(S,b,t),C=new Float64Array(16),u.be(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.aB(this._invProjMatrix,C),C[8]=2*-t.x/this._helper._width,C[9]=2*t.y/this._helper._height,this._projectionMatrix=u.bf(C),u.Q(C,C,[1,-1,1]),u.O(C,C,[0,0,-this._helper.cameraToCenterDistance]),u.bg(C,C,-this.rollInRadians),u.bh(C,C,this.pitchInRadians),u.bg(C,C,-this.bearingInRadians),u.O(C,C,[-c,-p,0]),this._mercatorMatrix=u.Q([],C,[this.worldSize,this.worldSize,this.worldSize]),u.Q(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),u.O(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=u.aB([],C);const I=[0,0,-1,1];u.aH(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),u.be(this._fogMatrix,this.fovInRadians,this.width/this.height,S,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,u.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.O(this._fogMatrix,this._fogMatrix,[-c,-p,0]),u.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);const N=this._helper._width%2/2,U=this._helper._height%2/2,$=Math.cos(this.bearingInRadians),G=Math.sin(-this.bearingInRadians),K=c-Math.round(c)+$*N+G*U,ie=p-Math.round(p)+$*U+G*N,he=new Float64Array(C);if(u.O(he,he,[K>.5?K-1:K,ie>.5?ie-1:ie,0]),this._alignedProjMatrix=he,C=u.aB(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new u.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=u.as(1,this.center.lat)*this.worldSize;return $e(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const c=u.a9.fromLngLat(t),p=[c.x*this.worldSize,c.y*this.worldSize,a,1];return u.aH(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(t){const{overscaledTileID:a,aligned:c,applyTerrainMatrix:p}=t,b=this._helper.getMercatorTileCoordinates(a),S=a?this.calculatePosMatrix(a,c,!0):null;let C;return C=a&&a.terrainRttPosMatrix32f&&p?a.terrainRttPosMatrix32f:S||u.bi(),{mainMatrix:C,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,c){return 1}transformLightDirection(t){return u.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,c,p){const b=this.calculatePosMatrix(c);let S;p?(S=[t,a,p(t,a),1],u.aH(S,S,b)):(S=[t,a,0,1],na(S,S,b));const C=S[3];return{point:new u.P(S[0]/C,S[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const c=u.a9.fromLngLat(t,a),p=c.meterInMercatorCoordinateUnits(),b=u.bj();return u.O(b,b,[c.x,c.y,c.z]),u.bg(b,b,Math.PI),u.bh(b,b,Math.PI/2),u.Q(b,b,[-p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=new u.a2(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),p=Di(a,this.worldSize);u.S(p,this._viewProjMatrix,p),c.tileMercatorCoords=[0,0,1,1];const b=[u.a5,u.a5,this.worldSize/this._helper.pixelsPerMeter],S=u.bk();return u.Q(S,p,b),c.fallbackMatrix=S,c.mainMatrix=S,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Br(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function dc(y){if(y.useSlerp)if(y.k<1){const t=u.bl(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),a=u.bl(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),c=new Float64Array(4);u.bm(c,t,a,y.k);const p=u.bn(c);y.tr.setRoll(p.roll),y.tr.setPitch(p.pitch),y.tr.setBearing(p.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(u.G.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(u.G.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(u.G.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function zo(y,t,a,c,p){const b=p.padding,S=ei(p.worldSize,a.getNorthWest()),C=ei(p.worldSize,a.getNorthEast()),I=ei(p.worldSize,a.getSouthEast()),N=ei(p.worldSize,a.getSouthWest()),U=u.ap(-c),$=S.rotate(U),G=C.rotate(U),K=I.rotate(U),ie=N.rotate(U),he=new u.P(Math.max($.x,G.x,ie.x,K.x),Math.max($.y,G.y,ie.y,K.y)),me=new u.P(Math.min($.x,G.x,ie.x,K.x),Math.min($.y,G.y,ie.y,K.y)),pe=he.sub(me),ve=(p.width-(b.left+b.right+t.left+t.right))/pe.x,Me=(p.height-(b.top+b.bottom+t.top+t.bottom))/pe.y;if(Me<0||ve<0)return void Br();const ye=Math.min(u.at(p.scale*Math.min(ve,Me)),y.maxZoom),Ee=u.P.convert(y.offset),Le=new u.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(u.ap(c)),Te=Ee.add(Le).mult(p.scale/u.aq(ye));return{center:hi(p.worldSize,S.add(I).div(2).sub(Te)),zoom:ye,bearing:c}}class Ii{get useGlobeControls(){return!1}handlePanInertia(t,a){const c=t.mag(),p=Math.abs(Vi(a));return{easingOffset:t.mult(Math.min(.75*p/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,c){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,a,c,p,b){return zo(t,a,c,p,b)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(u.V.convert(a.center))}handleEaseTo(t,a){const c=t.zoom,p=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},S={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},C=a.zoom!==void 0,I=!t.isPaddingEqual(a.padding);let N=!1;const U=C?+a.zoom:t.zoom;let $=t.centerPoint.add(a.offsetAsPoint);const G=t.screenPointToLocation($),{center:K,zoom:ie}=t.applyConstrain(u.V.convert(a.center||G),U??c);ya(t,K);const he=ei(t.worldSize,G),me=ei(t.worldSize,K).sub(he),pe=u.aq(ie-c);return N=ie!==c,{easeFunc:ve=>{if(N&&t.setZoom(u.G.number(c,ie,ve)),u.bo(b,S)||dc({startEulerAngles:b,endEulerAngles:S,tr:t,k:ve,useSlerp:b.roll!=S.roll}),I&&(t.interpolatePadding(p,a.padding,ve),$=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const Me=u.aq(t.zoom-c),ye=ie>c?Math.min(2,pe):Math.max(.5,pe),Ee=Math.pow(ye,1-ve),Le=hi(t.worldSize,he.add(me.mult(ve*Ee)).mult(Me));t.setLocationAtPoint(t.renderWorldCopies?Le.wrap():Le,$)}},isZooming:N,elevationCenter:K}}handleFlyTo(t,a){const c=a.zoom!==void 0,p=t.zoom,b=t.applyConstrain(u.V.convert(a.center||a.locationAtOffset),c?+a.zoom:p),S=b.center,C=b.zoom;ya(t,S);const I=ei(t.worldSize,a.locationAtOffset),N=ei(t.worldSize,S).sub(I),U=N.mag(),$=u.aq(C-p);let G;if(a.minZoom!==void 0){const K=Math.min(+a.minZoom,p,C),ie=t.applyConstrain(S,K).zoom;G=u.aq(ie-p)}return{easeFunc:(K,ie,he,me)=>{t.setZoom(K===1?C:p+u.at(ie));const pe=K===1?S:hi(t.worldSize,I.add(N.mult(he)).mult(ie));t.setLocationAtPoint(t.renderWorldCopies?pe.wrap():pe,me)},scaleOfZoom:$,targetCenter:S,scaleOfMinZoom:G,pixelPathLength:U}}}class dn{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}dn.Replace=[1,0],dn.disabled=new dn(dn.Replace,u.bp.transparent,[!1,!1,!1,!1]),dn.unblended=new dn(dn.Replace,u.bp.transparent,[!0,!0,!0,!0]),dn.alphaBlended=new dn([1,771],u.bp.transparent,[!0,!0,!0,!0]);const Pr=2305;class Mi{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}Mi.disabled=new Mi(!1,1029,Pr),Mi.backCCW=new Mi(!0,1029,Pr),Mi.frontCCW=new Mi(!0,1028,Pr);class xi{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}xi.ReadOnly=!1,xi.ReadWrite=!0,xi.disabled=new xi(519,xi.ReadOnly,[0,1]);const ol=7680;class Bi{constructor(t,a,c,p,b,S){this.test=t,this.ref=a,this.mask=c,this.fail=p,this.depthFail=b,this.pass=S}}Bi.disabled=new Bi({func:519,mask:0},0,0,ol,ol,ol);const fc=new WeakMap;function Na(y){var t;if(fc.has(y))return fc.get(y);{const a=(t=y.getParameter(y.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return fc.set(y,a),a}}class Do{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const p=new u.aW;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const b=new u.aY;b.emplaceBack(0,1,2),this._fullscreenTriangle=new hn(a.createVertexBuffer(p,_a.members),a.createIndexBuffer(b),u.aX.simpleSegment(0,0,p.length,b.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);const S=c.createTexture();c.bindTexture(c.TEXTURE_2D,S),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(S),Na(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const c=this._cachedRenderContext.context,p=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:u.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,p.TRIANGLES,xi.disabled,Bi.disabled,dn.unblended,Mi.disabled,((b,S)=>({u_input:b,u_output_expected:S}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Na(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const b=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Na(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Do._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const Io=u.a5/128;function iu(y,t){const a=y.granularity!==void 0?Math.max(y.granularity,1):1,c=a+(y.generateBorders?2:0),p=a+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),b=c+1,S=p+1,C=y.generateBorders?-1:0,I=y.generateBorders||y.extendToNorthPole?-1:0,N=a+(y.generateBorders?1:0),U=a+(y.generateBorders||y.extendToSouthPole?1:0),$=b*S,G=c*p*6,K=b*S>65536;if(K&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ie=K||t==="32bit",he=new Int16Array(2*$);let me=0;for(let Me=I;Me<=U;Me++)for(let ye=C;ye<=N;ye++){let Ee=ye/a*u.a5;ye===-1&&(Ee=-Io),ye===a+1&&(Ee=u.a5+Io);let Le=Me/a*u.a5;Me===-1&&(Le=y.extendToNorthPole?u.br:-Io),Me===a+1&&(Le=y.extendToSouthPole?u.bs:u.a5+Io),he[me++]=Ee,he[me++]=Le}const pe=ie?new Uint32Array(G):new Uint16Array(G);let ve=0;for(let Me=0;Me<p;Me++)for(let ye=0;ye<c;ye++){const Ee=ye+1+Me*b,Le=ye+(Me+1)*b,Te=ye+1+(Me+1)*b;pe[ve++]=ye+Me*b,pe[ve++]=Le,pe[ve++]=Ee,pe[ve++]=Ee,pe[ve++]=Le,pe[ve++]=Te}return{vertices:he.buffer.slice(0),indices:pe.buffer.slice(0),uses32bitIndices:ie}}const pc=new u.aV({fill:new u.bt(128,2),line:new u.bt(512,0),tile:new u.bt(128,32),stencil:new u.bt(128,1),circle:3});class qa{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Hi.projectionGlobe}get vertexShaderPreludeCode(){return Hi.projectionMercator.vertexSource}get subdivisionGranularity(){return pc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Do(t));const a=u.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(a,c),b=be();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=b);const S=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.bv(S))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,c,p,b){const S=(b==="stencil"?pc.stencil:pc.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:S,generateBorders:c,extendToNorthPole:a.y===0&&p,extendToSouthPole:a.y===(1<<a.z)-1&&p})}_getMesh(t,a){const c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];const p=(function(b,S){const C=iu(S,"16bit"),I=u.aW.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),N=u.aY.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new hn(b.createVertexBuffer(I,_a.members),b.createIndexBuffer(N),u.aX.simpleSegment(0,0,I.length,N.length))})(t,a);return this._tileMeshCache[c]=p,p}recalculate(t){}hasTransition(){const t=be();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Ad=new u.t({type:new u.D(u.u.projection.type)});class nu extends u.E{constructor(t){super(),this._transitionable=new u.x(Ad,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.H(0)),this._mercatorProjection=new Rn,this._verticalPerspectiveProjection=new qa}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof u.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,c,p,b){return this.currentProjection.getMeshFromTileID(t,a,c,p,b)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function tr(y){const t=to(y.worldSize,y.center.lat);return 2*Math.PI*t}function cs(y,t,a,c,p){const b=1/(1<<p),S=t/u.a5*b+c*b,C=u.by((y/u.a5*b+a*b)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI,N=Math.cos(I),U=new Float64Array(3);return U[0]=Math.sin(C)*N,U[1]=Math.sin(I),U[2]=Math.cos(C)*N,U}function zn(y){return(function(t,a){const c=Math.cos(a),p=new Float64Array(3);return p[0]=Math.sin(t)*c,p[1]=Math.sin(a),p[2]=Math.cos(t)*c,p})(y.lng*Math.PI/180,y.lat*Math.PI/180)}function to(y,t){return y/(2*Math.PI)/Math.cos(t*Math.PI/180)}function mc(y){const t=Math.asin(y[1])/Math.PI*180,a=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(a>1e-6){const c=y[0]/a,p=Math.acos(y[2]/a),b=(c>0?p:-p)/Math.PI*180;return new u.V(u.W(b,-180,180),t)}return new u.V(0,t)}function Fl(y){return Math.cos(y*Math.PI/180)}function jn(y,t){const a=Fl(y),c=Fl(t);return u.at(c/a)}function zh(y,t){const a=y.rotate(t.bearingInRadians),c=t.zoom+jn(t.center.lat,0),p=u.bu(1/Fl(t.center.lat),1/Fl(Math.min(Math.abs(t.center.lat),60)),u.bx(c,7,3,0,1)),b=360/tr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new u.V(t.center.lng-a.x*b*p,u.an(t.center.lat+a.y*b,-u.ao,u.ao))}function ru(y){const t=.5*y,a=Math.sin(t),c=Math.cos(t);return Math.log(a+c)-Math.log(c-a)}function au(y,t,a,c){const p=y.lat+a*c;if(Math.abs(a)>1){const b=(Math.sign(y.lat+a)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,S=Math.abs(y.lat+a)*Math.PI/180,C=ru(b+c*(S-b)),I=ru(b),N=ru(S);return new u.V(y.lng+t*((C-I)/(N-I)),p)}return new u.V(y.lng+t*c,p)}class Cd{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,c,p){const b=`${t.z}_${t.x}_${t.y}_${p?.terrain?"t":""}`,S=this._cache.get(b);if(S)return S;const C=this._cachePrevious.get(b);if(C)return this._cache.set(b,C),C;const I=this._boundingVolumeFactory(t,a,c,p);return this._cache.set(b,I),this._hadAnyChanges=!0,I}}class ll{constructor(t,a,c,p){this.min=c,this.max=p,this.points=t,this.planes=a}static fromAabb(t,a){const c=[];for(let p=0;p<8;p++)c.push([1&~p?t[0]:a[0],(p>>1&1)==1?a[1]:t[1],(p>>2&1)==1?a[2]:t[2]]);return new ll(c,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,c){const p=u.bB([],c[0],c[1],c[2]),b=u.bC([],[a[0],0,0],p),S=u.bC([],[0,a[1],0],p),C=u.bC([],[0,0,a[2]],p),I=[...t],N=[...t];for(let $=0;$<8;$++)for(let G=0;G<3;G++){const K=t[G]+b[G]*(1&~$?-1:1)+S[G]*(($>>1&1)==1?1:-1)+C[G]*(($>>2&1)==1?1:-1);I[G]=Math.min(I[G],K),N[G]=Math.max(N[G],K)}const U=[];for(let $=0;$<8;$++){const G=[...t];u.b0(G,G,u.a$([],b,1&~$?-1:1)),u.b0(G,G,u.a$([],S,($>>1&1)==1?1:-1)),u.b0(G,G,u.a$([],C,($>>2&1)==1?1:-1)),U.push(G)}return new ll(U,[[...b,-u.b5(b,U[0])],[...S,-u.b5(S,U[0])],[...C,-u.b5(C,U[0])],[-b[0],-b[1],-b[2],-u.b5(b,U[7])],[-S[0],-S[1],-S[2],-u.b5(S,U[7])],[-C[0],-C[1],-C[2],-u.b5(C,U[7])]],I,N)}intersectsFrustum(t){let a=!0;const c=this.points.length,p=this.planes.length,b=t.planes.length,S=t.points.length;for(let C=0;C<b;C++){const I=t.planes[C];let N=0;for(let U=0;U<c;U++){const $=this.points[U];I[0]*$[0]+I[1]*$[1]+I[2]*$[2]+I[3]>=0&&N++}if(N===0)return 0;N<c&&(a=!1)}if(a)return 2;for(let C=0;C<p;C++){const I=this.planes[C];let N=0;for(let U=0;U<S;U++){const $=t.points[U];I[0]*$[0]+I[1]*$[1]+I[2]*$[2]+I[3]>=0&&N++}if(N===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let c=0;for(let p=0;p<a;p++){const b=this.points[p];t[0]*b[0]+t[1]*b[1]+t[2]*b[2]+t[3]>=0&&c++}return c===a?2:c===0?0:1}}function gc(y,t,a){const c=y-t;return c<0?-c:Math.max(0,c-a)}function io(y,t,a,c,p){const b=y-a;let S;return S=b<0?Math.min(-b,1+b-p):b>1?Math.min(Math.max(b-p,0),1-b):0,Math.max(S,gc(t,c,p))}class no{constructor(){this._boundingVolumeCache=new Cd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,c,p){const b=1<<c.z,S=1/b,C=c.x/b,I=c.y/b;let N=2;return N=Math.min(N,io(t,a,C,I,S)),N=Math.min(N,io(t,a,C+.5,-I-S,S)),N=Math.min(N,io(t,a,C+.5,2-I-S,S)),N}getWrap(t,a,c){const p=1<<a.z,b=1/p,S=a.x/p,C=gc(t.x,S,b),I=gc(t.x,S-1,b),N=gc(t.x,S+1,b),U=Math.min(C,I,N);return U===N?1:U===I?-1:0}allowVariableZoom(t,a){return ji(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,c,p){return this._boundingVolumeCache.getTileBoundingVolume(t,a,c,p)}_computeTileBoundingVolume(t,a,c,p){var b,S;let C=0,I=0;if(p?.terrain){const N=new u.a2(t.z,a,t.z,t.x,t.y),U=p.terrain.getMinMaxElevation(N);C=(b=U.minElevation)!==null&&b!==void 0?b:Math.min(0,c),I=(S=U.maxElevation)!==null&&S!==void 0?S:Math.max(0,c)}if(C/=u.bE,I/=u.bE,C+=1,I+=1,t.z<=0)return ll.fromAabb([-I,-I,-I],[I,I,I]);if(t.z===1)return ll.fromAabb([t.x===0?-I:0,t.y===0?0:-I,-I],[t.x===0?0:I,t.y===0?I:0,I]);{const N=[cs(0,0,t.x,t.y,t.z),cs(u.a5,0,t.x,t.y,t.z),cs(u.a5,u.a5,t.x,t.y,t.z),cs(0,u.a5,t.x,t.y,t.z)],U=[];for(const We of N)U.push(u.a$([],We,I));if(I!==C)for(const We of N)U.push(u.a$([],We,C));t.y===0&&U.push([0,1,0]),t.y===(1<<t.z)-1&&U.push([0,-1,0]);const $=[1,1,1],G=[-1,-1,-1];for(const We of U)for(let Ke=0;Ke<3;Ke++)$[Ke]=Math.min($[Ke],We[Ke]),G[Ke]=Math.max(G[Ke],We[Ke]);const K=cs(u.a5/2,u.a5/2,t.x,t.y,t.z),ie=u.b4([],[0,1,0],K);u.b3(ie,ie);const he=u.b4([],K,ie);u.b3(he,he);const me=u.b4([],N[2],N[1]);u.b3(me,me);const pe=u.b4([],N[0],N[3]);u.b3(pe,pe),U.push(u.a$([],K,I)),t.y>=(1<<t.z)/2&&U.push(u.a$([],cs(u.a5/2,0,t.x,t.y,t.z),I)),t.y<(1<<t.z)/2&&U.push(u.a$([],cs(u.a5/2,u.a5,t.x,t.y,t.z),I));const ve=_c(K,U),Me=_c(he,U),ye=[-K[0],-K[1],-K[2],ve.max],Ee=[K[0],K[1],K[2],-ve.min],Le=[-he[0],-he[1],-he[2],Me.max],Te=[he[0],he[1],he[2],-Me.min],Oe=[...me,0],et=[...pe,0],Xe=[];return t.y===0?Xe.push(u.bD(et,Oe,ye),u.bD(et,Oe,Ee)):Xe.push(u.bD(Le,Oe,ye),u.bD(Le,Oe,Ee),u.bD(Le,et,ye),u.bD(Le,et,Ee)),t.y===(1<<t.z)-1?Xe.push(u.bD(et,Oe,ye),u.bD(et,Oe,Ee)):Xe.push(u.bD(Te,Oe,ye),u.bD(Te,Oe,Ee),u.bD(Te,et,ye),u.bD(Te,et,Ee)),new ll(Xe,[ye,Ee,Le,Te,Oe,et],$,G)}}}function _c(y,t){let a=1/0,c=-1/0;for(const p of t){const b=u.b5(y,p);a=Math.min(a,b),c=Math.max(c,b)}return{min:a,max:c}}class zs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=u.bF(),this._projectionMatrix=u.bj(),this._globeViewProjMatrix32f=u.bi(),this._globeViewProjMatrixNoCorrection=u.bj(),this._globeViewProjMatrixNoCorrectionInverted=u.bj(),this._globeProjMatrixInverted=u.bj(),this._cameraPosition=u.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{const p=u.an(a.lat,-u.ao,u.ao),b=u.an(+c,this.minZoom+jn(0,p),this.maxZoom);return{center:new u.V(a.lng,p),zoom:b}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new va({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new no}clone(){const t=new zs;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=u.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:c}=t,p=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,c=this.cameraToCenterDistance/t,p=Math.sin(a)*c,b=Math.cos(a)*c+1,S=1/Math.sqrt(p*p+b*b)*1;let C=-p,I=b;const N=Math.sqrt(C*C+I*I);C/=N,I/=N;const U=[0,C,I];u.bG(U,U,[0,0,0],-this.bearingInRadians),u.bH(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),u.bI(U,U,[0,0,0],this.center.lng*Math.PI/180);const $=1/u.b7(U);return u.a$(U,U,$),[...U,-S*$]}isLocationOccluded(t){return!this.isSurfacePointVisible(zn(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,p=Math.cos(c),b=[Math.sin(a)*p,Math.sin(c),Math.cos(a)*p],S=[b[2],0,-b[0]],C=[0,0,0];u.b4(C,S,b),u.b3(S,S),u.b3(C,C);const I=[0,0,0];return u.b3(I,[S[0]*t[0]+C[0]*t[1]+b[0]*t[2],S[1]*t[0]+C[1]*t[1]+b[1]*t[2],S[2]*t[0]+C[2]*t[1]+b[2]*t[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,c){const p=(function(C,I,N){const U=1/(1<<N.z);return new u.a9(C/u.a5*U+N.x*U,I/u.a5*U+N.y*U)})(t,a,c.canonical),b=(S=p.y,[u.by(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-S*Math.PI*2))-.5*Math.PI]);var S;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(t,a,c,p){const b=c.canonical,S=cs(t,a,b.x,b.y,b.z),C=1+(p?p(t,a):0)/u.bE,I=[S[0]*C,S[1]*C,S[2]*C,1];u.aH(I,I,this._globeViewProjMatrixNoCorrection);const N=this._cachedClippingPlane,U=N[0]*S[0]+N[1]*S[1]+N[2]*S[2]+N[3]<0;return{point:new u.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=to(this.worldSize,this.center.lat),a=u.bk(),c=u.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),u.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;a[8]=2*-p.x/this._helper._width,a[9]=2*p.y/this._helper._height,this._projectionMatrix=u.bf(a),this._globeProjMatrixInverted=u.bk(),u.aB(this._globeProjMatrixInverted,a),u.O(a,a,[0,0,-this.cameraToCenterDistance]),u.bg(a,a,this.rollInRadians),u.bh(a,a,-this.pitchInRadians),u.bg(a,a,this.bearingInRadians),u.O(a,a,[0,0,-t]);const b=u.bz();b[0]=t,b[1]=t,b[2]=t,u.bh(c,a,this.center.lat*Math.PI/180),u.bJ(c,c,-this.center.lng*Math.PI/180),u.Q(c,c,b),this._globeViewProjMatrixNoCorrection=c,u.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.bJ(a,a,-this.center.lng*Math.PI/180),u.Q(a,a,b),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=u.bk(),u.aB(this._globeViewProjMatrixNoCorrectionInverted,c);const S=u.bz();this._cameraPosition=u.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,u.bG(this._cameraPosition,this._cameraPosition,S,-this.rollInRadians),u.bH(this._cameraPosition,this._cameraPosition,S,this.pitchInRadians),u.bG(this._cameraPosition,this._cameraPosition,S,-this.bearingInRadians),u.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bH(this._cameraPosition,this._cameraPosition,S,-this.center.lat*Math.PI/180),u.bI(this._cameraPosition,this._cameraPosition,S,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const C=u.bf(this._globeViewProjMatrixNoCorrectionInverted);u.Q(C,C,[1,1,-1]),this._cachedFrustum=aa.fromInvProjectionMatrix(C,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){u.w("calculateFogMatrix is not supported on globe projection.");const a=u.bk();return u.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new u.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=zn(t);u.a$(c,c,1+a/u.bE);const p=u.bF();return u.aH(p,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,c=[new u.P(0,0),new u.P(t,0),new u.P(this.width,0),new u.P(this.width,a),new u.P(this.width,this.height),new u.P(t,this.height),new u.P(0,this.height),new u.P(0,a)],p=[];for(const $ of c)p.push(this.unprojectScreenPoint($));let b=0,S=0,C=0,I=0;const N=this.center;for(const $ of p){const G=u.bK(N.lng,$.lng),K=u.bK(N.lat,$.lat);G<S&&(S=G),G>b&&(b=G),K<I&&(I=K),K>C&&(C=K)}const U=[N.lng+S,N.lat+I,N.lng+b,N.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new ln(U)}calculateCenterFromCameraLngLatAlt(t,a,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,p)}setLocationAtPoint(t,a){const c=zn(this.unprojectScreenPoint(a)),p=zn(t),b=u.bz();u.bL(b);const S=u.bz();u.bI(S,c,b,-this.center.lng*Math.PI/180),u.bH(S,S,b,this.center.lat*Math.PI/180);const C=p[0]*p[0]+p[2]*p[2],I=S[0]*S[0];if(C<I)return;const N=Math.sqrt(C-I),U=-N,$=u.bM(p[0],p[2],S[0],N),G=u.bM(p[0],p[2],S[0],U),K=u.bz();u.bI(K,p,b,-$);const ie=u.bM(K[1],K[2],S[1],S[2]),he=u.bz();u.bI(he,p,b,-G);const me=u.bM(he[1],he[2],S[1],S[2]),pe=.5*Math.PI,ve=ie>=-pe&&ie<=pe,Me=me>=-pe&&me<=pe;let ye,Ee;if(ve&&Me){const et=this.center.lng*Math.PI/180,Xe=this.center.lat*Math.PI/180;u.bN($,et)+u.bN(ie,Xe)<u.bN(G,et)+u.bN(me,Xe)?(ye=$,Ee=ie):(ye=G,Ee=me)}else if(ve)ye=$,Ee=ie;else{if(!Me)return;ye=G,Ee=me}const Le=ye/Math.PI*180,Te=Ee/Math.PI*180,Oe=this.center.lat;this.setCenter(new u.V(Le,u.an(Te,-90,90))),this.setZoom(this.zoom+jn(Oe,this.center.lat))}locationToScreenPoint(t,a){const c=zn(t);if(a){const p=a.getElevationForLngLatZoom(t,this._helper._tileZoom);u.a$(c,c,1+p/u.bE)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const a=u.bF();return u.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new u.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c)return c}return u.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,a){const c=this._cameraPosition,p=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,p)}getRayDirectionFromPixel(t){const a=u.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,u.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const c=u.bz();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];const p=u.bz();return u.b3(p,c),p}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=u.bF();return u.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const c=u.b5(t,a),p=u.bz(),b=u.bz();u.a$(b,a,c),u.b2(p,t,b);const S=1-u.b5(p,p);if(S<0)return null;const C=u.b5(t,t)-1,I=-c+(c<0?1:-1)*Math.sqrt(S),N=C/I,U=I;return{tMin:Math.min(N,U),tMax:Math.max(N,U)}}unprojectScreenPoint(t){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t),p=this.rayPlanetIntersection(a,c);if(p){const U=u.bz();u.b0(U,a,[c[0]*p.tMin,c[1]*p.tMin,c[2]*p.tMin]);const $=u.bz();return u.b3($,U),mc($)}const b=this._cachedClippingPlane,S=b[0]*c[0]+b[1]*c[1]+b[2]*c[2],C=-u.bb(b,a)/S,I=u.bz();if(C>0)u.b0(I,a,[c[0]*C,c[1]*C,c[2]*C]);else{const U=u.bz();u.b0(U,a,[2*c[0],2*c[1],2*c[2]]);const $=u.bb(this._cachedClippingPlane,U);u.b2(I,U,[this._cachedClippingPlane[0]*$,this._cachedClippingPlane[1]*$,this._cachedClippingPlane[2]*$])}const N=(function(U){const $=u.bz();return $[0]=U[0]*-U[3],$[1]=U[1]*-U[3],$[2]=U[2]*-U[3],{center:$,radius:Math.sqrt(1-U[3]*U[3])}})(b);return mc((function(U,$,G){const K=u.bz();u.b2(K,G,U);const ie=u.bz();return u.bA(ie,U,K,$/u.b9(K)),ie})(N.center,N.radius,I))}getMatrixForModel(t,a){const c=u.V.convert(t),p=1/u.bE,b=u.bj();return u.bJ(b,b,c.lng/180*Math.PI),u.bh(b,b,-c.lat/180*Math.PI),u.O(b,b,[0,0,1+a/u.bE]),u.bh(b,b,.5*Math.PI),u.Q(b,b,[p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new u.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Nr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new va({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._globeness=1,this._mercatorTransform=new or,this._verticalPerspectiveTransform=new zs}clone(){const t=new Nr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return u.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,c){const p=this._mercatorTransform.getPitchedTextCorrection(t,a,c),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,c);return u.bu(p,b,this._globeness)}projectTileCoordinates(t,a,c,p){return this.currentTransform.projectTileCoordinates(t,a,c,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,p)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class $n{get useGlobeControls(){return!0}handlePanInertia(t,a){const c=zh(t,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const c=t.around,p=a.screenPointToLocation(c);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const b=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const S=a.zoom-b;if(S===0)return;const C=u.bK(a.center.lng,p.lng),I=C/(Math.abs(C/180)+1),N=u.bK(a.center.lat,p.lat),U=a.getRayDirectionFromPixel(c),$=a.cameraPosition,G=-1*u.b5($,U),K=u.bz();u.b0(K,$,[U[0]*G,U[1]*G,U[2]*G]);const ie=u.b7(K)-1,he=Math.exp(.5*-Math.max(ie-.3,0)),me=to(a.worldSize,a.center.lat)/Math.min(a.width,a.height),pe=u.bx(me,.9,.5,1,.25),ve=(1-u.aq(-S))*Math.min(he,pe),Me=a.center.lat,ye=a.zoom,Ee=new u.V(a.center.lng+I*ve,u.an(a.center.lat+N*ve,-u.ao,u.ao));a.setLocationAtPoint(p,c);const Le=a.center,Te=u.bx(Math.abs(C),45,85,0,1),Oe=u.bx(me,.75,.35,0,1),et=Math.pow(Math.max(Te,Oe),.25),Xe=u.bK(Le.lng,Ee.lng),We=u.bK(Le.lat,Ee.lat);a.setCenter(new u.V(Le.lng+Xe*et,Le.lat+We*et).wrap()),a.setZoom(ye+jn(Me,a.center.lat))}handleMapControlsPan(t,a,c){if(!t.panDelta)return;const p=a.center.lat,b=a.zoom;a.setCenter(zh(t.panDelta,a).wrap()),a.setZoom(b+jn(p,a.center.lat))}cameraForBoxAndBearing(t,a,c,p,b){const S=zo(t,a,c,p,b),C=a.left/b.width*2-1,I=(b.width-a.right)/b.width*2-1,N=a.top/b.height*-2+1,U=(b.height-a.bottom)/b.height*-2+1,$=u.bK(c.getWest(),c.getEast())<0,G=$?c.getEast():c.getWest(),K=$?c.getWest():c.getEast(),ie=Math.max(c.getNorth(),c.getSouth()),he=Math.min(c.getNorth(),c.getSouth()),me=G+.5*u.bK(G,K),pe=ie+.5*u.bK(ie,he),ve=b.clone();ve.setCenter(S.center),ve.setBearing(S.bearing),ve.setPitch(0),ve.setRoll(0),ve.setZoom(S.zoom);const Me=ve.modelViewProjectionMatrix,ye=[zn(c.getNorthWest()),zn(c.getNorthEast()),zn(c.getSouthWest()),zn(c.getSouthEast()),zn(new u.V(K,pe)),zn(new u.V(G,pe)),zn(new u.V(me,ie)),zn(new u.V(me,he))],Ee=zn(S.center);let Le=Number.POSITIVE_INFINITY;for(const Te of ye)C<0&&(Le=$n.getLesserNonNegativeNonNull(Le,$n.solveVectorScale(Te,Ee,Me,"x",C))),I>0&&(Le=$n.getLesserNonNegativeNonNull(Le,$n.solveVectorScale(Te,Ee,Me,"x",I))),N>0&&(Le=$n.getLesserNonNegativeNonNull(Le,$n.solveVectorScale(Te,Ee,Me,"y",N))),U<0&&(Le=$n.getLesserNonNegativeNonNull(Le,$n.solveVectorScale(Te,Ee,Me,"y",U)));if(Number.isFinite(Le)&&Le!==0)return S.zoom=ve.zoom+u.at(Le),S;Br()}handleJumpToCenterZoom(t,a){const c=t.center.lat,p=t.applyConstrain(a.center?u.V.convert(a.center):t.center,t.zoom).center;t.setCenter(p.wrap());const b=a.zoom!==void 0?+a.zoom:t.zoom+jn(c,p.lat);t.zoom!==b&&t.setZoom(b)}handleEaseTo(t,a){const c=t.zoom,p=t.center,b=t.padding,S={roll:t.roll,pitch:t.pitch,bearing:t.bearing},C={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},I=a.zoom!==void 0,N=!t.isPaddingEqual(a.padding);let U=!1;const $=a.center?u.V.convert(a.center):p,G=t.applyConstrain($,c).center;ya(t,G);const K=t.clone();K.setCenter(G),K.setZoom(I?+a.zoom:c+jn(p.lat,$.lat)),K.setBearing(a.bearing);const ie=new u.P(u.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),u.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));K.setLocationAtPoint(G,ie);const he=(a.offset&&a.offsetAsPoint.mag())>0?K.center:G,me=I?+a.zoom:c+jn(p.lat,he.lat),pe=c+jn(p.lat,0),ve=me+jn(he.lat,0),Me=u.bK(p.lng,he.lng),ye=u.bK(p.lat,he.lat),Ee=u.aq(ve-pe);return U=me!==c,{easeFunc:Le=>{if(u.bo(S,C)||dc({startEulerAngles:S,endEulerAngles:C,tr:t,k:Le,useSlerp:S.roll!=C.roll}),N&&t.interpolatePadding(b,a.padding,Le),a.around)u.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const Te=ve>pe?Math.min(2,Ee):Math.max(.5,Ee),Oe=Math.pow(Te,1-Le),et=au(p,Me,ye,Le*Oe);t.setCenter(et.wrap())}if(U){const Te=u.G.number(pe,ve,Le)+jn(0,t.center.lat);t.setZoom(Te)}},isZooming:U,elevationCenter:he}}handleFlyTo(t,a){const c=a.zoom!==void 0,p=t.center,b=t.zoom,S=t.padding,C=!t.isPaddingEqual(a.padding),I=t.applyConstrain(u.V.convert(a.center||a.locationAtOffset),b).center,N=c?+a.zoom:t.zoom+jn(t.center.lat,I.lat),U=t.clone();U.setCenter(I),U.setZoom(N),U.setBearing(a.bearing);const $=new u.P(u.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),u.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));U.setLocationAtPoint(I,$);const G=U.center;ya(t,G);const K=(function(ye,Ee,Le){const Te=zn(Ee),Oe=zn(Le),et=u.b5(Te,Oe),Xe=Math.acos(et),We=tr(ye);return Xe/(2*Math.PI)*We})(t,p,G),ie=b+jn(p.lat,0),he=N+jn(G.lat,0),me=u.aq(he-ie);let pe;if(typeof a.minZoom=="number"){const ye=+a.minZoom+jn(G.lat,0),Ee=Math.min(ye,ie,he)+jn(0,G.lat),Le=t.applyConstrain(G,Ee).zoom+jn(G.lat,0);pe=u.aq(Le-ie)}const ve=u.bK(p.lng,G.lng),Me=u.bK(p.lat,G.lat);return{easeFunc:(ye,Ee,Le,Te)=>{const Oe=au(p,ve,Me,Le);C&&t.interpolatePadding(S,a.padding,ye);const et=ye===1?G:Oe;t.setCenter(et.wrap());const Xe=ie+u.at(Ee);t.setZoom(ye===1?N:Xe+jn(0,et.lat))},scaleOfZoom:me,targetCenter:G,scaleOfMinZoom:pe,pixelPathLength:K}}static solveVectorScale(t,a,c,p,b){const S=p==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],C=[c[3],c[7],c[11],c[15]],I=t[0]*S[0]+t[1]*S[1]+t[2]*S[2],N=t[0]*C[0]+t[1]*C[1]+t[2]*C[2],U=a[0]*S[0]+a[1]*S[1]+a[2]*S[2],$=a[0]*C[0]+a[1]*C[1]+a[2]*C[2];return U+b*N===I+b*$||C[3]*(I-U)+S[3]*($-N)+I*$==U*N?null:(U+S[3]-b*$-b*C[3])/(U-I-b*$+b*N)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class cl{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ii,this._verticalPerspectiveCameraHelper=new $n}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,c){this.currentHelper.handleMapControlsPan(t,a,c)}cameraForBoxAndBearing(t,a,c,p,b){return this.currentHelper.cameraForBoxAndBearing(t,a,c,p,b)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const jl=(y,t)=>u.B(y,t&&t.filter((a=>a.identifier!=="source.canvas"))),Lo=u.bO();class Ds extends u.E{constructor(t,a={}){var c,p;super(),this._rtlPluginLoaded=()=>{for(const S in this.tileManagers){const C=this.tileManagers[S].getSource().type;C!=="vector"&&C!=="geojson"||this.tileManagers[S].reload()}},this.map=t,this.dispatcher=new mn(Ai(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((S,C)=>this.getGlyphs(S,C))),this.dispatcher.registerMessageHandler("GI",((S,C)=>this.getImages(S,C))),this.dispatcher.registerMessageHandler("GDA",((S,C)=>this.getDashes(S,C))),this.imageManager=new Yt,this.imageManager.setEventedParent(this);const b=((c=t._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new Je(t._requestManager,a.localIdeographFontFamily,b),this.lineAtlas=new yt(256,512),this.crossTileSymbolIndex=new xr,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",u.bP()),Ne().on(ge,this._rtlPluginLoaded),this.on("data",(S=>{if(S.dataType!=="source"||S.sourceDataType!=="metadata")return;const C=this.tileManagers[S.sourceId];if(!C)return;const I=C.getSource();if(I&&I.vectorLayerIds)for(const N in this._layers){const U=this._layers[N];U.source===I.id&&this._validateLayer(U)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new u.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var c,p,b;this._checkLoaded();const S=a===null?(b=(p=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||p===void 0?void 0:p.default)!==null&&b!==void 0?b:null:a;if(u.bR(S,this._globalState[t]))return this;this._globalState[t]=S,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const c in t)!u.bR(this._globalState[c],t[c].default)&&(a.push(c),this._globalState[c]=t[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,c={};for(const p of t){c[p]=this._globalState[p];for(const b in this._layers){const S=this._layers[b],C=S.getLayoutAffectingGlobalStateRefs(),I=S.getPaintAffectingGlobalStateRefs(),N=S.getVisibilityAffectingGlobalStateRefs();if(C.has(p)&&a.add(S.source),I.has(p))for(const{name:U,value:$}of I.get(p))this._updatePaintProperty(S,U,$);N?.has(p)&&(S.recalculateVisibility(),this._updateLayer(S))}}this.dispatcher.broadcast("UGS",c);for(const p in this.tileManagers)a.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(t,a={},c){this.fire(new u.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const p=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;u.j(p,this._loadStyleRequest).then((S=>{this._loadStyleRequest=null,this._load(S.data,a,c)})).catch((S=>{this._loadStyleRequest=null,S&&!b.signal.aborted&&this.fire(new u.k(S))}))}loadJSON(t,a={},c){this.fire(new u.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Pe.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new u.l("dataloading",{dataType:"style"})),this._load(Lo,{validate:!1})}_load(t,a,c){var p,b;let S=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!jl(this,u.C(S))){S=Object.assign({},S),this._loaded=!0,this.stylesheet=S;for(const C in S.sources)this.addSource(C,S.sources[C],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new lt(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new Ue(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new u.l("data",{dataType:"style"})),this.fire(new u.l("style.load"))}}_createLayers(){var t,a,c;const p=u.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",p),this._order=p.map((b=>b.id)),this._layers={},this._serializedLayers=null;for(const b of p){const S=u.bT(b,this._globalState);if(S.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=S,u.bU(S)&&this.tileManagers[S.source]){const C=(c=(a=b.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:S.paint.get("raster-fade-duration");this.tileManagers[S.source].setRasterFadeDuration(C)}}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let b;this._spriteRequest=p,(function(S,C,I,N){return u._(this,void 0,void 0,(function*(){const U=jt(S),$=I>1?"@2x":"",G={},K={};for(const{id:ie,url:he}of U){const me=C.transformRequest(Ht(he,$,".json"),"SpriteJSON");G[ie]=u.j(me,N);const pe=C.transformRequest(Ht(he,$,".png"),"SpriteImage");K[ie]=rt.getImage(pe,N)}return yield Promise.all([...Object.values(G),...Object.values(K)]),(function(ie,he){return u._(this,void 0,void 0,(function*(){const me={};for(const pe in ie){me[pe]={};const ve=Pe.getImageCanvasContext((yield he[pe]).data),Me=(yield ie[pe]).data;for(const ye in Me){const{width:Ee,height:Le,x:Te,y:Oe,sdf:et,pixelRatio:Xe,stretchX:We,stretchY:Ke,content:zt,textFitWidth:kt,textFitHeight:xt}=Me[ye];me[pe][ye]={data:null,pixelRatio:Xe,sdf:et,stretchX:We,stretchY:Ke,content:zt,textFitWidth:kt,textFitHeight:xt,spriteData:{width:Ee,height:Le,x:Te,y:Oe,context:ve}}}}return me}))})(G,K)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((S=>{if(this._spriteRequest=null,S)for(const C in S){this._spritesImagesIds[C]=[];const I=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter((N=>!(N in S))):[];for(const N of I)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in S[C]){const U=C==="default"?N:`${C}:${N}`;this._spritesImagesIds[C].push(U),U in this.imageManager.images?this.imageManager.updateImage(U,S[C][N],!1):this.imageManager.addImage(U,S[C][N]),a&&(this._changedImages[U]=!0)}}})).catch((S=>{this._spriteRequest=null,b=S,p.signal.aborted||this.fire(new u.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"})),c&&c(b)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const p=a.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new u.k(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?u.bV(c):c);const p=[];for(const b of t)if(c[b]){const S=a?u.bV(c[b]):c[b];p.push(S)}return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const p=this._layers[c];p.type!=="custom"&&(t[c]=p.serialize())}return t}hasTransitions(){var t,a,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const p in this.tileManagers)if(this.tileManagers[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const p=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(p.length||b.length)&&this._updateWorkerLayers(p,b);for(const S in this._updatedSources){const C=this._updatedSources[S];if(C==="reload")this._reloadSource(S);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const p in this.tileManagers){const b=this.tileManagers[p];c[p]=b.used,b.used=!1}for(const p of this._order){const b=this._layers[p];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.tileManagers[b.source].used=!0)}for(const p in c){const b=this.tileManagers[p];!!c[p]!=!!b.used&&b.fire(new u.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new u.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var c;this._checkLoaded();const p=this.serialize();if(t=a.transformStyle?a.transformStyle(p,t):t,((c=a.validate)===null||c===void 0||c)&&jl(this,u.C(t)))return!1;(t=u.bV(t)).layers=u.bS(t.layers);const b=u.bW(p,t),S=this._getOperationsToPerform(b);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const C of S.operations)C();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],c=[];for(const p of t)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(p.command)}return{operations:a,unimplemented:c}}addImage(t,a){if(this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(u.C.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const p=this.tileManagers[t]=new gn(t,a,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t}))),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new u.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new u.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.tileManagers[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new u.k(new Error(`Layer "${p}" already exists on this map.`)));let b;if(t.type==="custom"){if(jl(this,u.bX(t)))return;b=u.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=u.bV(t),t=u.e(t,{source:p})),this._validate(u.C.layer,`layers.${p}`,t,{arrayIndex:-1},c))return;b=u.bT(t,this._globalState),this._validateLayer(b),b.setEventedParent(this,{layer:{id:p}})}const S=a?this._order.indexOf(a):this._order.length;if(a&&S===-1)this.fire(new u.k(new Error(`Cannot add layer "${p}" before non-existing layer "${a}".`)));else{if(this._order.splice(S,0,p),this._layerOrderChanged=!0,this._layers[p]=b,this._removedLayers[p]&&b.source&&b.type!=="custom"){const C=this._removedLayers[p];delete this._removedLayers[p],C.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.tileManagers[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const p=a?this._order.indexOf(a):this._order.length;a&&p===-1?this.fire(new u.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new u.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===a&&p.maxzoom===c||(a!=null&&(p.minzoom=a),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new u.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!u.bR(p.filter,a))return a==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(u.C.filter,`layers.${p.id}.filter`,a,null,c)||(p.setFilter(u.bV(a)),this._updateLayer(p)))}else this.fire(new u.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,c,p={}){this._checkLoaded();const b=this.getLayer(t);b?u.bR(b.getLayoutProperty(a),c)||(b.setLayoutProperty(a,c,p),this._updateLayer(b)):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new u.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,p={}){this._checkLoaded();const b=this.getLayer(t);b?u.bR(b.getPaintProperty(a),c)||this._updatePaintProperty(b,a,c,p):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,c,p={}){t.setPaintProperty(a,c,p)&&this._updateLayer(t),u.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,p=t.sourceLayer,b=this.tileManagers[c];if(b===void 0)return void this.fire(new u.k(new Error(`The source '${c}' does not exist in the map's style.`)));const S=b.getSource().type;S==="geojson"&&p?this.fire(new u.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||p?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(p,t.id,a)):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,p=this.tileManagers[c];if(p===void 0)return void this.fire(new u.k(new Error(`The source '${c}' does not exist in the map's style.`)));const b=p.getSource().type,S=b==="vector"?t.sourceLayer:void 0;b!=="vector"||S?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(S,t.id,a):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,p=this.tileManagers[a];if(p!==void 0)return p.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,t.id)):void this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=u.bY(this.tileManagers,(b=>b.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,p=this.stylesheet;return u.bZ({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:t,layers:a,terrain:c},(b=>b!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=S=>this._layers[S].type==="fill-extrusion",c={},p=[];for(let S=this._order.length-1;S>=0;S--){const C=this._order[S];if(a(C)){c[C]=S;for(const I of t){const N=I[C];if(N)for(const U of N)p.push(U)}}}p.sort(((S,C)=>C.intersectionZ-S.intersectionZ));const b=[];for(let S=this._order.length-1;S>=0;S--){const C=this._order[S];if(a(C))for(let I=p.length-1;I>=0;I--){const N=p[I].feature;if(c[N.layer.id]<S)break;b.push(N),p.pop()}else for(const I of t){const N=I[C];if(N)for(const U of N)b.push(U.feature)}}return b}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(u.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const p={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new u.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const N of a.layers){const U=this._layers[N];if(!U)return this.fire(new u.k(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];p[U.source]=!0}}const b=[];a.availableImages=this._availableImages;const S=this._serializedAllLayers(),C=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,I=Object.assign(Object.assign({},a),{layers:C,globalState:this._globalState});for(const N in this.tileManagers)a.layers&&!p[N]||b.push(ar(this.tileManagers[N],this._layers,S,t,I,c,this.map.terrain?(U,$,G)=>this.map.terrain.getElevation(U,$,G):void 0));return this.placement&&b.push((function(N,U,$,G,K,ie,he){const me={},pe=ie.queryRenderedSymbols(G),ve=[];for(const Me of Object.keys(pe).map(Number))ve.push(he[Me]);ve.sort(Gi);for(const Me of ve){const ye=Me.featureIndex.lookupSymbolFeatures(pe[Me.bucketInstanceId],U,Me.bucketIndex,Me.sourceLayerIndex,{filterSpec:K.filter,globalState:K.globalState},K.layers,K.availableImages,N);for(const Ee in ye){const Le=me[Ee]=me[Ee]||[],Te=ye[Ee];Te.sort(((Oe,et)=>{const Xe=Me.featureSortOrder;if(Xe){const We=Xe.indexOf(Oe.featureIndex);return Xe.indexOf(et.featureIndex)-We}return et.featureIndex-Oe.featureIndex}));for(const Oe of Te)Le.push(Oe)}}return(function(Me,ye,Ee){for(const Le in Me)for(const Te of Me[Le])Fn(Te,Ee[ye[Le].source]);return Me})(me,N,$)})(this._layers,S,this.tileManagers,t,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,a){a?.filter&&this._validate(u.C.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.tileManagers[t];return c?(function(p,b){const S=p.getRenderableIds().map((N=>p.getTileByID(N))),C=[],I={};for(let N=0;N<S.length;N++){const U=S[N],$=U.tileID.canonical.key;I[$]||(I[$]=!0,U.querySourceFeatures(C,b))}return C})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const S in t)if(!u.bR(t[S],c[S])){p=!0;break}if(!p)return;const b={now:be(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(b)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const c=this.getSky();let p=!1;if(!t&&!c)return;if(t&&!c)p=!0;else if(!t&&c)p=!0;else for(const S in t)if(!u.bR(t[S],c[S])){p=!0;break}if(!p)return;const b={now:be(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(b)}_setProjectionInternal(t){const a=(function(c,p){const b={constrainOverride:p};if(Array.isArray(c)){const S=new nu({type:c});return{projection:S,transform:new Nr(b),cameraHelper:new cl(S)}}switch(c){case"mercator":return{projection:new Rn,transform:new or(b),cameraHelper:new Ii};case"globe":{const S=new nu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:S,transform:new Nr(b),cameraHelper:new cl(S)}}case"vertical-perspective":return{projection:new qa,transform:new zs(b),cameraHelper:new $n};default:return u.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new Rn,transform:new or(b),cameraHelper:new Ii}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(t,a,c,p,b={}){return(!b||b.validate!==!1)&&jl(this,t.call(u.C,u.e({key:a,style:this.serialize(),value:c,styleSpec:u.u},p)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ne().off(ge,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,c,p,b=!1){let S=!1,C=!1;const I={};for(const N of this._order){const U=this._layers[N];if(U.type!=="symbol")continue;if(!I[U.source]){const G=this.tileManagers[U.source];I[U.source]=G.getRenderableIds(!0).map((K=>G.getTileByID(K))).sort(((K,ie)=>ie.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(ie.tileID)?-1:1)))}const $=this.crossTileSymbolIndex.addLayer(U,I[U.source],t.center.lng);S=S||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(be(),t.zoom))&&(this.pauseablePlacement=new Co(t,this.map.terrain,this._order,b,a,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(be()),C=!0),S&&this.pauseablePlacement.placement.setStale()),C||S)for(const N of this._order){const U=this._layers[N];U.type==="symbol"&&this.placement.updateLayerOpacities(U,I[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(be())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return u._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(t,a){return u._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(u.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return u._(this,void 0,void 0,(function*(){const c={};for(const[p,b]of Object.entries(a.dashes))c[p]=this.lineAtlas.getDash(b.dasharray,b.round);return c}))}addSprite(t,a,c={},p){this._checkLoaded();const b=[{id:t,url:a}],S=[...jt(this.stylesheet.sprite),...b];this._validate(u.C.sprite,"sprite",S,null,c)||(this.stylesheet.sprite=S,this._loadSprite(b,!0,p))}removeSprite(t){this._checkLoaded();const a=jt(this.stylesheet.sprite);if(a.find((c=>c.id===t))){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}else this.fire(new u.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return jt(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(u.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Dh=u.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class yc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,p,b,S,C,I,N){this.context=t;let U=this.boundPaintVertexBuffers.length!==p.length;for(let $=0;!U&&$<p.length;$++)this.boundPaintVertexBuffers[$]!==p[$]&&(U=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||U||this.boundIndexBuffer!==b||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==N?this.freshBind(a,c,p,b,S,C,I,N):(t.bindVertexArray.set(this.vao),C&&C.bind(),b&&b.dynamicDraw&&b.bind(),I&&I.bind(),N&&N.bind())}freshBind(t,a,c,p,b,S,C,I){const N=t.numAttributes,U=this.context,$=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=I,a.enableAttributes($,t);for(const G of c)G.enableAttributes($,t);S&&S.enableAttributes($,t),C&&C.enableAttributes($,t),I&&I.enableAttributes($,t),a.bind(),a.setVertexAttribPointers($,t,b);for(const G of c)G.bind(),G.setVertexAttribPointers($,t,b);S&&(S.bind(),S.setVertexAttribPointers($,t,b)),p&&p.bind(),C&&(C.bind(),C.setVertexAttribPointers($,t,b)),I&&(I.bind(),I.setVertexAttribPointers($,t,b)),U.currentNumAttributes=N}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Zu=(y,t,a,c,p)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):u.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):u.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),us={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ba(y){const t=[];for(let a=0;a<y.length;a++){if(y[a]===null)continue;const c=y[a].split(" ");t.push(c.pop())}return t}class ul{constructor(t,a,c,p,b,S,C,I,N=[]){const U=t.gl;this.program=U.createProgram();const $=ba(a.staticAttributes),G=c?c.getBinderAttributes():[],K=$.concat(G),ie=Hi.prelude.staticUniforms?ba(Hi.prelude.staticUniforms):[],he=C.staticUniforms?ba(C.staticUniforms):[],me=a.staticUniforms?ba(a.staticUniforms):[],pe=c?c.getBinderUniforms():[],ve=ie.concat(he).concat(me).concat(pe),Me=[];for(const Xe of ve)Me.indexOf(Xe)<0&&Me.push(Xe);const ye=c?c.defines():[];Na(U)&&ye.unshift("#version 300 es"),b&&ye.push("#define OVERDRAW_INSPECTOR;"),S&&ye.push("#define TERRAIN3D;"),I&&ye.push(I),N&&ye.push(...N);let Ee=ye.concat(Hi.prelude.fragmentSource,C.fragmentSource,a.fragmentSource).join(`
`),Le=ye.concat(Hi.prelude.vertexSource,C.vertexSource,a.vertexSource).join(`
`);Na(U)||(Ee=(function(Xe){return Xe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ee),Le=(function(Xe){return Xe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Le));const Te=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Te,Ee),U.compileShader(Te),!U.getShaderParameter(Te,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(Te)}`);U.attachShader(this.program,Te);const Oe=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Oe,Le),U.compileShader(Oe),!U.getShaderParameter(Oe,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(Oe)}`);U.attachShader(this.program,Oe),this.attributes={};const et={};this.numAttributes=K.length;for(let Xe=0;Xe<this.numAttributes;Xe++)K[Xe]&&(U.bindAttribLocation(this.program,Xe,K[Xe]),this.attributes[K[Xe]]=Xe);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(Oe),U.deleteShader(Te);for(let Xe=0;Xe<Me.length;Xe++){const We=Me[Xe];if(We&&!et[We]){const Ke=U.getUniformLocation(this.program,We);Ke&&(et[We]=Ke)}}this.fixedUniforms=p(t,et),this.terrainUniforms=((Xe,We)=>({u_depth:new u.b_(Xe,We.u_depth),u_terrain:new u.b_(Xe,We.u_terrain),u_terrain_dim:new u.bq(Xe,We.u_terrain_dim),u_terrain_matrix:new u.c0(Xe,We.u_terrain_matrix),u_terrain_unpack:new u.c1(Xe,We.u_terrain_unpack),u_terrain_exaggeration:new u.bq(Xe,We.u_terrain_exaggeration)}))(t,et),this.projectionUniforms=((Xe,We)=>({u_projection_matrix:new u.c0(Xe,We.u_projection_matrix),u_projection_tile_mercator_coords:new u.c1(Xe,We.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.c1(Xe,We.u_projection_clipping_plane),u_projection_transition:new u.bq(Xe,We.u_projection_transition),u_projection_fallback_matrix:new u.c0(Xe,We.u_projection_fallback_matrix)}))(t,et),this.binderUniforms=c?c.getUniforms(t,et):[]}draw(t,a,c,p,b,S,C,I,N,U,$,G,K,ie,he,me,pe,ve,Me){const ye=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(p),t.setColorMode(b),t.setCullFace(S),I){t.activeTexture.set(ye.TEXTURE2),ye.bindTexture(ye.TEXTURE_2D,I.depthTexture),t.activeTexture.set(ye.TEXTURE3),ye.bindTexture(ye.TEXTURE_2D,I.texture);for(const Le in this.terrainUniforms)this.terrainUniforms[Le].set(I[Le])}if(N)for(const Le in N)this.projectionUniforms[us[Le]].set(N[Le]);if(C)for(const Le in this.fixedUniforms)this.fixedUniforms[Le].set(C[Le]);me&&me.setUniforms(t,this.binderUniforms,ie,{zoom:he});let Ee=0;switch(a){case ye.LINES:Ee=2;break;case ye.TRIANGLES:Ee=3;break;case ye.LINE_STRIP:Ee=1}for(const Le of K.get()){const Te=Le.vaos||(Le.vaos={});(Te[U]||(Te[U]=new yc)).bind(t,this,$,me?me.getPaintVertexBuffers():[],G,Le.vertexOffset,pe,ve,Me),ye.drawElements(a,Le.primitiveLength*Ee,ye.UNSIGNED_SHORT,Le.primitiveOffset*Ee*2)}}}function Ih(y,t,a){const c=1/u.aN(a,1,t.transform.tileZoom),p=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,t.transform.tileZoom)/p,S=b*(a.tileID.canonical.x+a.tileID.wrap*p),C=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[S>>16,C>>16],u_pixel_coord_lower:[65535&S,65535&C]}}const Ga=(y,t,a,c)=>{const p=y.style.light,b=p.properties.get("position"),S=[b.x,b.y,b.z],C=u.c4();p.properties.get("anchor")==="viewport"&&u.c5(C,y.transform.bearingInRadians),u.c6(S,S,C);const I=y.transform.transformLightDirection(S),N=p.properties.get("color");return{u_lightpos:S,u_lightpos_globe:I,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:c}},su=(y,t,a,c,p,b,S)=>u.e(Ga(y,t,a,c),Ih(b,y,S),{u_height_factor:-Math.pow(2,p.overscaledZ)/S.tileSize/8}),Ha=(y,t,a,c)=>u.e(Ih(t,y,a),{u_fill_translate:c}),Ul=(y,t)=>({u_world:y,u_fill_translate:t}),Vl=(y,t,a,c,p)=>u.e(Ha(y,t,a,p),{u_world:c}),Zl=(y,t,a,c,p)=>{const b=y.transform;let S,C,I=0;if(a.paint.get("circle-pitch-alignment")==="map"){const N=u.aN(t,1,b.zoom);S=!0,C=[N,N],I=N/(u.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*p}else S=!1,C=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+S,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:I,u_translate:c}},hs=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),qu=y=>({u_viewport_size:[y.width,y.height]}),$a=(y,t=1)=>({u_color:y,u_overlay:0,u_overlay_scale:t}),ds=(y,t,a,c)=>{const p=u.aN(y,1,t)/(u.a5*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:u.aN(y,1,t),u_intensity:a,u_globe_extrude_scale:p}},Gu=(y,t,a,c)=>{const p=u.N();u.c7(p,0,y.width,y.height,0,0,1);const b=y.context.gl;return{u_matrix:p,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},hl=(y,t,a)=>{const c=a.paint.get("hillshade-accent-color");let p;switch(a.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const b=a.getIlluminationProperties();for(let S=0;S<b.directionRadians.length;S++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(b.directionRadians[S]+=y.transform.bearingInRadians);return{u_image:0,u_latrange:ro(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:b.altitudeRadians,u_azimuths:b.directionRadians,u_accent:c,u_method:p,u_highlights:b.highlightColor,u_shadows:b.shadowColor}},Lh=(y,t)=>{const a=t.stride,c=u.N();return u.c7(c,0,u.a5,-u.a5,0,0,1),u.O(c,c,[0,-u.a5,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:y.overscaledZ,u_unpack:t.getUnpackVector()}};function ro(y,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new u.a9(0,c/a).toLngLat().lat,new u.a9(0,(c+1)/a).toLngLat().lat]}const kh=(y,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:y.paint.get("color-relief-opacity")}),Is=(y,t,a,c)=>{const p=y.transform;return{u_translation:ko(y,t,a),u_ratio:c/u.aN(t,1,p.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Rh=(y,t,a,c,p)=>u.e(Is(y,t,a,c),{u_image:0,u_image_height:p}),fs=(y,t,a,c,p)=>{const b=y.transform,S=wa(t,b);return{u_translation:ko(y,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:c/u.aN(t,1,b.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[S,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Fr=(y,t,a,c,p)=>{const b=wa(t,y.transform);return u.e(Is(y,t,a,c),{u_tileratio:b,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image:0,u_mix:p.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})},ao=(y,t,a,c,p,b)=>{const S=wa(t,y.transform);return u.e(Is(y,t,a,c),{u_image:0,u_image_height:b,u_tileratio:S,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image_dash:1,u_mix:p.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})};function wa(y,t){return 1/u.aN(y,1,t.tileZoom)}function ko(y,t,a){return u.aO(y.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ql=(y,t,a,c,p)=>{return{u_tl_parent:y,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(S=c.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(b=c.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:dl(c.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var b,S};function dl(y){y*=Math.PI/180;const t=Math.sin(y),a=Math.cos(y);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Ls=(y,t,a,c,p,b,S,C,I,N,U,$,G)=>{const K=S.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_pitch:K.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:K.width/K.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:I,u_is_text:+U,u_pitch_with_map:+c,u_is_along_line:p,u_is_variable_anchor:b,u_texsize:$,u_texture:0,u_translation:N,u_pitched_scale:G}},fl=(y,t,a,c,p,b,S,C,I,N,U,$,G,K)=>{const ie=S.transform;return u.e(Ls(y,t,a,c,p,b,S,C,I,N,U,$,K),{u_gamma_scale:c?Math.cos(ie.pitch*Math.PI/180)*ie.cameraToCenterDistance:1,u_device_pixel_ratio:S.pixelRatio,u_is_halo:1})},Ta=(y,t,a,c,p,b,S,C,I,N,U,$,G)=>u.e(fl(y,t,a,c,p,b,S,C,I,N,!0,U,0,G),{u_texsize_icon:$,u_texture_icon:1}),Gl=(y,t)=>({u_opacity:y,u_color:t}),vc=(y,t,a,c,p)=>u.e((function(b,S,C,I){const N=C.imageManager.getPattern(b.from.toString()),U=C.imageManager.getPattern(b.to.toString()),{width:$,height:G}=C.imageManager.getPixelSize(),K=Math.pow(2,I.tileID.overscaledZ),ie=I.tileSize*Math.pow(2,C.transform.tileZoom)/K,he=ie*(I.tileID.canonical.x+I.tileID.wrap*K),me=ie*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[$,G],u_mix:S.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/u.aN(I,1,C.transform.tileZoom),u_pixel_coord_upper:[he>>16,me>>16],u_pixel_coord_lower:[65535&he,65535&me]}})(a,p,t,c),{u_opacity:y}),pl=(y,t)=>{},Oh={fillExtrusion:(y,t)=>({u_lightpos:new u.c2(y,t.u_lightpos),u_lightpos_globe:new u.c2(y,t.u_lightpos_globe),u_lightintensity:new u.bq(y,t.u_lightintensity),u_lightcolor:new u.c2(y,t.u_lightcolor),u_vertical_gradient:new u.bq(y,t.u_vertical_gradient),u_opacity:new u.bq(y,t.u_opacity),u_fill_translate:new u.c3(y,t.u_fill_translate)}),fillExtrusionPattern:(y,t)=>({u_lightpos:new u.c2(y,t.u_lightpos),u_lightpos_globe:new u.c2(y,t.u_lightpos_globe),u_lightintensity:new u.bq(y,t.u_lightintensity),u_lightcolor:new u.c2(y,t.u_lightcolor),u_vertical_gradient:new u.bq(y,t.u_vertical_gradient),u_height_factor:new u.bq(y,t.u_height_factor),u_opacity:new u.bq(y,t.u_opacity),u_fill_translate:new u.c3(y,t.u_fill_translate),u_image:new u.b_(y,t.u_image),u_texsize:new u.c3(y,t.u_texsize),u_pixel_coord_upper:new u.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(y,t.u_pixel_coord_lower),u_scale:new u.c2(y,t.u_scale),u_fade:new u.bq(y,t.u_fade)}),fill:(y,t)=>({u_fill_translate:new u.c3(y,t.u_fill_translate)}),fillPattern:(y,t)=>({u_image:new u.b_(y,t.u_image),u_texsize:new u.c3(y,t.u_texsize),u_pixel_coord_upper:new u.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(y,t.u_pixel_coord_lower),u_scale:new u.c2(y,t.u_scale),u_fade:new u.bq(y,t.u_fade),u_fill_translate:new u.c3(y,t.u_fill_translate)}),fillOutline:(y,t)=>({u_world:new u.c3(y,t.u_world),u_fill_translate:new u.c3(y,t.u_fill_translate)}),fillOutlinePattern:(y,t)=>({u_world:new u.c3(y,t.u_world),u_image:new u.b_(y,t.u_image),u_texsize:new u.c3(y,t.u_texsize),u_pixel_coord_upper:new u.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(y,t.u_pixel_coord_lower),u_scale:new u.c2(y,t.u_scale),u_fade:new u.bq(y,t.u_fade),u_fill_translate:new u.c3(y,t.u_fill_translate)}),circle:(y,t)=>({u_camera_to_center_distance:new u.bq(y,t.u_camera_to_center_distance),u_scale_with_map:new u.b_(y,t.u_scale_with_map),u_pitch_with_map:new u.b_(y,t.u_pitch_with_map),u_extrude_scale:new u.c3(y,t.u_extrude_scale),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_globe_extrude_scale:new u.bq(y,t.u_globe_extrude_scale),u_translate:new u.c3(y,t.u_translate)}),collisionBox:(y,t)=>({u_pixel_extrude_scale:new u.c3(y,t.u_pixel_extrude_scale)}),collisionCircle:(y,t)=>({u_viewport_size:new u.c3(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new u.b$(y,t.u_color),u_overlay:new u.b_(y,t.u_overlay),u_overlay_scale:new u.bq(y,t.u_overlay_scale)}),depth:pl,clippingMask:pl,heatmap:(y,t)=>({u_extrude_scale:new u.bq(y,t.u_extrude_scale),u_intensity:new u.bq(y,t.u_intensity),u_globe_extrude_scale:new u.bq(y,t.u_globe_extrude_scale)}),heatmapTexture:(y,t)=>({u_matrix:new u.c0(y,t.u_matrix),u_world:new u.c3(y,t.u_world),u_image:new u.b_(y,t.u_image),u_color_ramp:new u.b_(y,t.u_color_ramp),u_opacity:new u.bq(y,t.u_opacity)}),hillshade:(y,t)=>({u_image:new u.b_(y,t.u_image),u_latrange:new u.c3(y,t.u_latrange),u_exaggeration:new u.bq(y,t.u_exaggeration),u_altitudes:new u.c9(y,t.u_altitudes),u_azimuths:new u.c9(y,t.u_azimuths),u_accent:new u.b$(y,t.u_accent),u_method:new u.b_(y,t.u_method),u_shadows:new u.c8(y,t.u_shadows),u_highlights:new u.c8(y,t.u_highlights)}),hillshadePrepare:(y,t)=>({u_matrix:new u.c0(y,t.u_matrix),u_image:new u.b_(y,t.u_image),u_dimension:new u.c3(y,t.u_dimension),u_zoom:new u.bq(y,t.u_zoom),u_unpack:new u.c1(y,t.u_unpack)}),colorRelief:(y,t)=>({u_image:new u.b_(y,t.u_image),u_unpack:new u.c1(y,t.u_unpack),u_dimension:new u.c3(y,t.u_dimension),u_elevation_stops:new u.b_(y,t.u_elevation_stops),u_color_stops:new u.b_(y,t.u_color_stops),u_color_ramp_size:new u.b_(y,t.u_color_ramp_size),u_opacity:new u.bq(y,t.u_opacity)}),line:(y,t)=>({u_translation:new u.c3(y,t.u_translation),u_ratio:new u.bq(y,t.u_ratio),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_translation:new u.c3(y,t.u_translation),u_ratio:new u.bq(y,t.u_ratio),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(y,t.u_units_to_pixels),u_image:new u.b_(y,t.u_image),u_image_height:new u.bq(y,t.u_image_height)}),linePattern:(y,t)=>({u_translation:new u.c3(y,t.u_translation),u_texsize:new u.c3(y,t.u_texsize),u_ratio:new u.bq(y,t.u_ratio),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_image:new u.b_(y,t.u_image),u_units_to_pixels:new u.c3(y,t.u_units_to_pixels),u_scale:new u.c2(y,t.u_scale),u_fade:new u.bq(y,t.u_fade)}),lineSDF:(y,t)=>({u_translation:new u.c3(y,t.u_translation),u_ratio:new u.bq(y,t.u_ratio),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(y,t.u_units_to_pixels),u_image:new u.b_(y,t.u_image),u_mix:new u.bq(y,t.u_mix),u_tileratio:new u.bq(y,t.u_tileratio),u_crossfade_from:new u.bq(y,t.u_crossfade_from),u_crossfade_to:new u.bq(y,t.u_crossfade_to),u_lineatlas_width:new u.bq(y,t.u_lineatlas_width),u_lineatlas_height:new u.bq(y,t.u_lineatlas_height)}),lineGradientSDF:(y,t)=>({u_translation:new u.c3(y,t.u_translation),u_ratio:new u.bq(y,t.u_ratio),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new u.c3(y,t.u_units_to_pixels),u_image:new u.b_(y,t.u_image),u_image_height:new u.bq(y,t.u_image_height),u_tileratio:new u.bq(y,t.u_tileratio),u_crossfade_from:new u.bq(y,t.u_crossfade_from),u_crossfade_to:new u.bq(y,t.u_crossfade_to),u_image_dash:new u.b_(y,t.u_image_dash),u_mix:new u.bq(y,t.u_mix),u_lineatlas_width:new u.bq(y,t.u_lineatlas_width),u_lineatlas_height:new u.bq(y,t.u_lineatlas_height)}),raster:(y,t)=>({u_tl_parent:new u.c3(y,t.u_tl_parent),u_scale_parent:new u.bq(y,t.u_scale_parent),u_buffer_scale:new u.bq(y,t.u_buffer_scale),u_fade_t:new u.bq(y,t.u_fade_t),u_opacity:new u.bq(y,t.u_opacity),u_image0:new u.b_(y,t.u_image0),u_image1:new u.b_(y,t.u_image1),u_brightness_low:new u.bq(y,t.u_brightness_low),u_brightness_high:new u.bq(y,t.u_brightness_high),u_saturation_factor:new u.bq(y,t.u_saturation_factor),u_contrast_factor:new u.bq(y,t.u_contrast_factor),u_spin_weights:new u.c2(y,t.u_spin_weights),u_coords_top:new u.c1(y,t.u_coords_top),u_coords_bottom:new u.c1(y,t.u_coords_bottom)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new u.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.b_(y,t.u_is_size_feature_constant),u_size_t:new u.bq(y,t.u_size_t),u_size:new u.bq(y,t.u_size),u_camera_to_center_distance:new u.bq(y,t.u_camera_to_center_distance),u_pitch:new u.bq(y,t.u_pitch),u_rotate_symbol:new u.b_(y,t.u_rotate_symbol),u_aspect_ratio:new u.bq(y,t.u_aspect_ratio),u_fade_change:new u.bq(y,t.u_fade_change),u_label_plane_matrix:new u.c0(y,t.u_label_plane_matrix),u_coord_matrix:new u.c0(y,t.u_coord_matrix),u_is_text:new u.b_(y,t.u_is_text),u_pitch_with_map:new u.b_(y,t.u_pitch_with_map),u_is_along_line:new u.b_(y,t.u_is_along_line),u_is_variable_anchor:new u.b_(y,t.u_is_variable_anchor),u_texsize:new u.c3(y,t.u_texsize),u_texture:new u.b_(y,t.u_texture),u_translation:new u.c3(y,t.u_translation),u_pitched_scale:new u.bq(y,t.u_pitched_scale)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new u.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.b_(y,t.u_is_size_feature_constant),u_size_t:new u.bq(y,t.u_size_t),u_size:new u.bq(y,t.u_size),u_camera_to_center_distance:new u.bq(y,t.u_camera_to_center_distance),u_pitch:new u.bq(y,t.u_pitch),u_rotate_symbol:new u.b_(y,t.u_rotate_symbol),u_aspect_ratio:new u.bq(y,t.u_aspect_ratio),u_fade_change:new u.bq(y,t.u_fade_change),u_label_plane_matrix:new u.c0(y,t.u_label_plane_matrix),u_coord_matrix:new u.c0(y,t.u_coord_matrix),u_is_text:new u.b_(y,t.u_is_text),u_pitch_with_map:new u.b_(y,t.u_pitch_with_map),u_is_along_line:new u.b_(y,t.u_is_along_line),u_is_variable_anchor:new u.b_(y,t.u_is_variable_anchor),u_texsize:new u.c3(y,t.u_texsize),u_texture:new u.b_(y,t.u_texture),u_gamma_scale:new u.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_is_halo:new u.b_(y,t.u_is_halo),u_translation:new u.c3(y,t.u_translation),u_pitched_scale:new u.bq(y,t.u_pitched_scale)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new u.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.b_(y,t.u_is_size_feature_constant),u_size_t:new u.bq(y,t.u_size_t),u_size:new u.bq(y,t.u_size),u_camera_to_center_distance:new u.bq(y,t.u_camera_to_center_distance),u_pitch:new u.bq(y,t.u_pitch),u_rotate_symbol:new u.b_(y,t.u_rotate_symbol),u_aspect_ratio:new u.bq(y,t.u_aspect_ratio),u_fade_change:new u.bq(y,t.u_fade_change),u_label_plane_matrix:new u.c0(y,t.u_label_plane_matrix),u_coord_matrix:new u.c0(y,t.u_coord_matrix),u_is_text:new u.b_(y,t.u_is_text),u_pitch_with_map:new u.b_(y,t.u_pitch_with_map),u_is_along_line:new u.b_(y,t.u_is_along_line),u_is_variable_anchor:new u.b_(y,t.u_is_variable_anchor),u_texsize:new u.c3(y,t.u_texsize),u_texsize_icon:new u.c3(y,t.u_texsize_icon),u_texture:new u.b_(y,t.u_texture),u_texture_icon:new u.b_(y,t.u_texture_icon),u_gamma_scale:new u.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new u.bq(y,t.u_device_pixel_ratio),u_is_halo:new u.b_(y,t.u_is_halo),u_translation:new u.c3(y,t.u_translation),u_pitched_scale:new u.bq(y,t.u_pitched_scale)}),background:(y,t)=>({u_opacity:new u.bq(y,t.u_opacity),u_color:new u.b$(y,t.u_color)}),backgroundPattern:(y,t)=>({u_opacity:new u.bq(y,t.u_opacity),u_image:new u.b_(y,t.u_image),u_pattern_tl_a:new u.c3(y,t.u_pattern_tl_a),u_pattern_br_a:new u.c3(y,t.u_pattern_br_a),u_pattern_tl_b:new u.c3(y,t.u_pattern_tl_b),u_pattern_br_b:new u.c3(y,t.u_pattern_br_b),u_texsize:new u.c3(y,t.u_texsize),u_mix:new u.bq(y,t.u_mix),u_pattern_size_a:new u.c3(y,t.u_pattern_size_a),u_pattern_size_b:new u.c3(y,t.u_pattern_size_b),u_scale_a:new u.bq(y,t.u_scale_a),u_scale_b:new u.bq(y,t.u_scale_b),u_pixel_coord_upper:new u.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.c3(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.bq(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_texture:new u.b_(y,t.u_texture),u_ele_delta:new u.bq(y,t.u_ele_delta),u_fog_matrix:new u.c0(y,t.u_fog_matrix),u_fog_color:new u.b$(y,t.u_fog_color),u_fog_ground_blend:new u.bq(y,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.bq(y,t.u_fog_ground_blend_opacity),u_horizon_color:new u.b$(y,t.u_horizon_color),u_horizon_fog_blend:new u.bq(y,t.u_horizon_fog_blend),u_is_globe_mode:new u.bq(y,t.u_is_globe_mode)}),terrainDepth:(y,t)=>({u_ele_delta:new u.bq(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_texture:new u.b_(y,t.u_texture),u_terrain_coords_id:new u.bq(y,t.u_terrain_coords_id),u_ele_delta:new u.bq(y,t.u_ele_delta)}),projectionErrorMeasurement:(y,t)=>({u_input:new u.bq(y,t.u_input),u_output_expected:new u.bq(y,t.u_output_expected)}),atmosphere:(y,t)=>({u_sun_pos:new u.c2(y,t.u_sun_pos),u_atmosphere_blend:new u.bq(y,t.u_atmosphere_blend),u_globe_position:new u.c2(y,t.u_globe_position),u_globe_radius:new u.bq(y,t.u_globe_radius),u_inv_proj_matrix:new u.c0(y,t.u_inv_proj_matrix)}),sky:(y,t)=>({u_sky_color:new u.b$(y,t.u_sky_color),u_horizon_color:new u.b$(y,t.u_horizon_color),u_horizon:new u.c3(y,t.u_horizon),u_horizon_normal:new u.c3(y,t.u_horizon_normal),u_sky_horizon_blend:new u.bq(y,t.u_sky_horizon_blend),u_sky_blend:new u.bq(y,t.u_sky_blend)})};class Ro{constructor(t,a,c){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ml={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ou{constructor(t,a,c,p){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const p=a.attributes[this.attributes[c].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,a,c){for(let p=0;p<this.attributes.length;p++){const b=this.attributes[p],S=a.attributes[b.name];S!==void 0&&t.vertexAttribPointer(S,b.components,t[ml[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $i{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class br extends $i{getDefault(){return u.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Oo extends $i{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class xc extends $i{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class gl extends $i{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _l extends $i{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Hl extends $i{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class $l extends $i{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class jr extends $i{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Hu extends $i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class so extends $i{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Sa extends $i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class ps extends $i{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class sa extends $i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Ur extends $i{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Bo extends $i{getDefault(){return u.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class No extends $i{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class oo extends $i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Fo extends $i{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class oa extends $i{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class yl extends $i{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class vl extends $i{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class wi extends $i{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class lu extends $i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ea extends $i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class bc extends $i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ma extends $i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class $u extends $i{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wc extends $i{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Na(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class jo extends $i{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class cu extends $i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Tc extends $i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Uo extends $i{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class l extends Uo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class v extends Uo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class A extends Uo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const B="Framebuffer is not complete";class H{constructor(t,a,c,p,b){this.context=t,this.width=a,this.height=c;const S=t.gl,C=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new l(t,C),p)this.depthAttachment=b?new A(t,C):new v(t,C);else if(b)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error(B)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class ae{constructor(t){var a,c;if(this.gl=t,this.clearColor=new br(this),this.clearDepth=new Oo(this),this.clearStencil=new xc(this),this.colorMask=new gl(this),this.depthMask=new _l(this),this.stencilMask=new Hl(this),this.stencilFunc=new $l(this),this.stencilOp=new jr(this),this.stencilTest=new Hu(this),this.depthRange=new so(this),this.depthTest=new Sa(this),this.depthFunc=new ps(this),this.blend=new sa(this),this.blendFunc=new Ur(this),this.blendColor=new Bo(this),this.blendEquation=new No(this),this.cullFace=new oo(this),this.cullFaceSide=new Fo(this),this.frontFace=new oa(this),this.program=new yl(this),this.activeTexture=new vl(this),this.viewport=new wi(this),this.bindFramebuffer=new lu(this),this.bindRenderbuffer=new Ea(this),this.bindTexture=new bc(this),this.bindVertexBuffer=new Ma(this),this.bindElementBuffer=new $u(this),this.bindVertexArray=new wc(this),this.pixelStoreUnpack=new jo(this),this.pixelStoreUnpackPremultiplyAlpha=new cu(this),this.pixelStoreUnpackFlipY=new Tc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Na(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:p?.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:p?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Ro(this,t,a)}createVertexBuffer(t,a,c){return new ou(this,t,a,c)}createRenderbuffer(t,a,c){const p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,c,p){return new H(this,t,a,c,p)}clear({color:t,depth:a,stencil:c}){const p=this.gl;let b=0;t&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(b|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){u.bR(t.blendFunction,dn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Na(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Na(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ae;function Ve(y,t,a,c,p){const b=y.context,S=y.transform,C=b.gl,I=y.useProgram("collisionBox"),N=[];let U=0,$=0;for(let pe=0;pe<c.length;pe++){const ve=c[pe],Me=t.getTile(ve).getBucket(a);if(!Me)continue;const ye=p?Me.textCollisionBox:Me.iconCollisionBox,Ee=Me.collisionCircleArray;Ee.length>0&&(N.push({circleArray:Ee,circleOffset:$,coord:ve}),U+=Ee.length/4,$=U),ye&&I.draw(b,C.LINES,xi.disabled,Bi.disabled,y.colorModeForRenderPass(),Mi.disabled,hs(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(ve),S.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,y.transform.zoom,null,null,ye.collisionVertexBuffer)}if(!p||!N.length)return;const G=y.useProgram("collisionCircle"),K=new u.ca;K.resize(4*U),K._trim();let ie=0;for(const pe of N)for(let ve=0;ve<pe.circleArray.length/4;ve++){const Me=4*ve,ye=pe.circleArray[Me+0],Ee=pe.circleArray[Me+1],Le=pe.circleArray[Me+2],Te=pe.circleArray[Me+3];K.emplace(ie++,ye,Ee,Le,Te,0),K.emplace(ie++,ye,Ee,Le,Te,1),K.emplace(ie++,ye,Ee,Le,Te,2),K.emplace(ie++,ye,Ee,Le,Te,3)}(!Ae||Ae.length<2*U)&&(Ae=(function(pe){const ve=2*pe,Me=new u.cc;Me.resize(ve),Me._trim();for(let ye=0;ye<ve;ye++){const Ee=6*ye;Me.uint16[Ee+0]=4*ye+0,Me.uint16[Ee+1]=4*ye+1,Me.uint16[Ee+2]=4*ye+2,Me.uint16[Ee+3]=4*ye+2,Me.uint16[Ee+4]=4*ye+3,Me.uint16[Ee+5]=4*ye+0}return Me})(U));const he=b.createIndexBuffer(Ae,!0),me=b.createVertexBuffer(K,u.cb.members,!0);for(const pe of N){const ve=qu(y.transform);G.draw(b,C.TRIANGLES,xi.disabled,Bi.disabled,y.colorModeForRenderPass(),Mi.disabled,ve,y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe.coord),null,a.id,me,he,u.aX.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,y.transform.zoom,null,null,null)}me.destroy(),he.destroy()}const at=u.ar(new Float32Array(16));function Mt(y,t,a,c,p,b){const{horizontalAlign:S,verticalAlign:C}=u.aS(y);return new u.P((-(S-.5)*t/p+c[0])*b,(-(C-.5)*a/p+c[1])*b)}function Zt(y,t,a,c,p,b){const S=t.tileAnchorPoint.add(new u.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let C=c.mult(b);a||(C=C.rotate(-p));const I=S.add(C);return vi(I.x,I.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const C=Zi(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(y),I=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return y.add(c.rotate(I))}return y.add(c)}function ci(y,t,a,c,p,b,S,C,I,N,U,$){const G=y.text.placedSymbolArray,K=y.text.dynamicLayoutVertexArray,ie=y.icon.dynamicLayoutVertexArray,he={};K.clear();for(let me=0;me<G.length;me++){const pe=G.get(me),ve=pe.hidden||!pe.crossTileID||y.allowVerticalPlacement&&!pe.placedOrientation?null:c[pe.crossTileID];if(ve){const Me=new u.P(pe.anchorX,pe.anchorY),ye={getElevation:$,width:p.width,height:p.height,pitchedLabelPlaneMatrix:b,pitchWithMap:a,transform:p,tileAnchorPoint:Me,translation:N,unwrappedTileID:U},Ee=a?Cs(Me.x,Me.y,ye):Zi(Me.x,Me.y,ye),Le=il(p.cameraToCenterDistance,Ee.signedDistanceFromCamera);let Te=u.aA(y.textSizeData,C,pe)*Le/u.aM;a&&(Te*=y.tilePixelRatio/S);const{width:Oe,height:et,anchor:Xe,textOffset:We,textBoxScale:Ke}=ve,zt=Mt(Xe,Oe,et,We,Ke,Te),kt=p.getPitchedTextCorrection(Me.x+N[0],Me.y+N[1],U),xt=Zt(Ee.point,ye,t,zt,-p.bearingInRadians,kt),Bt=y.allowVerticalPlacement&&pe.placedOrientation===u.az.vertical?Math.PI/2:0;for(let Ti=0;Ti<pe.numGlyphs;Ti++)u.aG(K,xt,Bt);I&&pe.associatedIconIndex>=0&&(he[pe.associatedIconIndex]={shiftedAnchor:xt,angle:Bt})}else nn(pe.numGlyphs,K)}if(I){ie.clear();const me=y.icon.placedSymbolArray;for(let pe=0;pe<me.length;pe++){const ve=me.get(pe);if(ve.hidden)nn(ve.numGlyphs,ie);else{const Me=he[pe];if(Me)for(let ye=0;ye<ve.numGlyphs;ye++)u.aG(ie,Me.shiftedAnchor,Me.angle);else nn(ve.numGlyphs,ie)}}y.icon.dynamicLayoutVertexBuffer.updateData(ie)}y.text.dynamicLayoutVertexBuffer.updateData(K)}function Li(y,t,a){return a.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function lr(y,t,a,c,p,b,S,C,I,N,U,$,G){const K=y.context,ie=K.gl,he=y.transform,me=C==="map",pe=I==="map",ve=C!=="viewport"&&a.layout.get("symbol-placement")!=="point",Me=me&&!pe&&!ve,ye=!a.layout.get("symbol-sort-key").isConstant();let Ee=!1;const Le=y.getDepthModeForSublayer(0,xi.ReadOnly),Te=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Oe=[],et=he.getCircleRadiusCorrection();for(const Xe of c){const We=t.getTile(Xe),Ke=We.getBucket(a);if(!Ke)continue;const zt=p?Ke.text:Ke.icon;if(!zt||!zt.segments.get().length||!zt.hasVisibleVertices)continue;const kt=zt.programConfigurations.get(a.id),xt=p||Ke.sdfIcons,Bt=p?Ke.textSizeData:Ke.iconSizeData,Ti=pe||he.pitch!==0,pn=y.useProgram(Li(xt,p,Ke),kt),Dn=u.ay(Bt,he.zoom),En=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Xe);let Zn,xn,nr,qn,Hr=[0,0],ur=null;if(p)xn=We.glyphAtlasTexture,nr=ie.LINEAR,Zn=We.glyphAtlasTexture.size,Ke.iconsInText&&(Hr=We.imageAtlasTexture.size,ur=We.imageAtlasTexture,qn=Ti||y.options.rotating||y.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?ie.LINEAR:ie.NEAREST);else{const yn=a.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;xn=We.imageAtlasTexture,nr=xt||y.options.rotating||y.options.zooming||yn||Ti?ie.LINEAR:ie.NEAREST,Zn=We.imageAtlasTexture.size}const hr=u.aN(We,1,y.transform.zoom),$r=ma(me,y.transform,hr),Wo=u.N();u.aB(Wo,$r);const Ko=Qc(pe,me,y.transform,hr),_o=u.aO(he,We,b,S),Ya=he.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),Ic=Te&&Ke.hasTextData(),yu=a.layout.get("icon-text-fit")!=="none"&&Ic&&Ke.hasIconData();if(ve){const yn=y.style.map.terrain?(Tr,zr)=>y.style.map.terrain.getElevation(Xe,Tr,zr):null,Mn=a.layout.get("text-rotation-alignment")==="map";Qs(Ke,y,p,$r,Wo,pe,N,Mn,Xe.toUnwrapped(),he.width,he.height,_o,yn)}const yo=p&&Te||yu,Wa=ve||yo?at:pe?$r:y.transform.clipSpaceToPixelsMatrix,vs=xt&&a.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Us;Us=xt?Ke.iconsInText?Ta(Bt.kind,Dn,Me,pe,ve,yo,y,Wa,Ko,_o,Zn,Hr,et):fl(Bt.kind,Dn,Me,pe,ve,yo,y,Wa,Ko,_o,p,Zn,0,et):Ls(Bt.kind,Dn,Me,pe,ve,yo,y,Wa,Ko,_o,p,Zn,et);const Vs={program:pn,buffers:zt,uniformValues:Us,projectionData:Ya,atlasTexture:xn,atlasTextureIcon:ur,atlasInterpolation:nr,atlasInterpolationIcon:qn,isSDF:xt,hasHalo:vs};if(ye&&Ke.canOverlap){Ee=!0;const yn=zt.segments.get();for(const Mn of yn)Oe.push({segments:new u.aX([Mn]),sortKey:Mn.sortKey,state:Vs,terrainData:En})}else Oe.push({segments:zt.segments,sortKey:0,state:Vs,terrainData:En})}Ee&&Oe.sort(((Xe,We)=>Xe.sortKey-We.sortKey));for(const Xe of Oe){const We=Xe.state;if(K.activeTexture.set(ie.TEXTURE0),We.atlasTexture.bind(We.atlasInterpolation,ie.CLAMP_TO_EDGE),We.atlasTextureIcon&&(K.activeTexture.set(ie.TEXTURE1),We.atlasTextureIcon&&We.atlasTextureIcon.bind(We.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),We.isSDF){const Ke=We.uniformValues;We.hasHalo&&(Ke.u_is_halo=1,Xn(We.buffers,Xe.segments,a,y,We.program,Le,U,$,Ke,We.projectionData,Xe.terrainData)),Ke.u_is_halo=0}Xn(We.buffers,Xe.segments,a,y,We.program,Le,U,$,We.uniformValues,We.projectionData,Xe.terrainData)}}function Xn(y,t,a,c,p,b,S,C,I,N,U){const $=c.context;p.draw($,$.gl.TRIANGLES,b,S,C,Mi.backCCW,I,U,N,a.id,y.layoutVertexBuffer,y.indexBuffer,t,a.paint,c.transform.zoom,y.programConfigurations.get(a.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Aa(y,t,a,c,p){const b=y.context,S=b.gl,C=Bi.disabled,I=new dn([S.ONE,S.ONE],u.bp.transparent,[!0,!0,!0,!0]),N=t.getBucket(a);if(!N)return;const U=c.key;let $=a.heatmapFbos.get(U);$||($=Xi(b,t.tileSize,t.tileSize),a.heatmapFbos.set(U,$)),b.bindFramebuffer.set($.framebuffer),b.viewport.set([0,0,t.tileSize,t.tileSize]),b.clear({color:u.bp.transparent});const G=N.programConfigurations.get(a.id),K=y.useProgram("heatmap",G,!p),ie=y.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),he=y.style.map.terrain.getTerrainData(c);K.draw(b,S.TRIANGLES,xi.disabled,C,I,Mi.disabled,ds(t,y.transform.zoom,a.paint.get("heatmap-intensity"),1),he,ie,a.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,a.paint,y.transform.zoom,G)}function on(y,t,a,c,p){const b=y.context,S=b.gl,C=y.transform;b.setColorMode(y.colorModeForRenderPass());const I=Ni(b,t),N=a.key,U=t.heatmapFbos.get(N);if(!U)return;b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,U.colorAttachment.get()),b.activeTexture.set(S.TEXTURE1),I.bind(S.LINEAR,S.CLAMP_TO_EDGE);const $=C.getProjectionData({overscaledTileID:a,applyTerrainMatrix:p,applyGlobeMatrix:!c});y.useProgram("heatmapTexture").draw(b,S.TRIANGLES,xi.disabled,Bi.disabled,y.colorModeForRenderPass(),Mi.disabled,Gu(y,t,0,1),null,$,t.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,t.paint,C.zoom),U.destroy(),t.heatmapFbos.delete(N)}function Xi(y,t,a){var c,p;const b=y.gl,S=b.createTexture();b.bindTexture(b.TEXTURE_2D,S),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const C=(c=y.HALF_FLOAT)!==null&&c!==void 0?c:b.UNSIGNED_BYTE,I=(p=y.RGBA16F)!==null&&p!==void 0?p:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,I,t,a,0,b.RGBA,C,null);const N=y.createFramebuffer(t,a,!1,!1);return N.colorAttachment.set(S),N}function Ni(y,t){return t.colorRampTexture||(t.colorRampTexture=new u.T(y,t.colorRamp,y.gl.RGBA)),t.colorRampTexture}function lo(y,t,a,c,p,b,S,C){let I=256;if(p.stepInterpolant){const N=t.getSource().maxzoom,U=S.canonical.z===N?Math.ceil(1<<y.transform.maxZoom-S.canonical.z):1;I=u.an(u.ce(b.maxLineLength/u.a5*1024*U),256,a.maxTextureSize)}return C.gradient=u.cf({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:I,image:C.gradient||void 0,clips:b.lineClipsArray}),C.texture?C.texture.update(C.gradient):C.texture=new u.T(a,C.gradient,c.RGBA),C.version=p.gradientVersion,C.texture}function Fa(y,t,a,c,p){y.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),c.updatePaintBuffers(p)}function On(y,t,a,c,p,b){(p||y.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),y.lineAtlas.bind(t)),c.updatePaintBuffers(b)}function Ca(y,t,a,c,p,b,S){const C=b.gradients[p.id];let I=C.texture;p.gradientVersion!==C.version&&(I=lo(y,t,a,c,p,b,S,C)),a.activeTexture.set(c.TEXTURE0),I.bind(p.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function la(y,t,a,c,p,b,S,C,I){const N=b.gradients[p.id];let U=N.texture;p.gradientVersion!==N.version&&(U=lo(y,t,a,c,p,b,S,N)),a.activeTexture.set(c.TEXTURE0),U.bind(p.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),y.lineAtlas.bind(a),C.updatePaintBuffers(I)}function Un(y,t,a,c,p){if(!a||!c||!c.imageAtlas)return;const b=c.imageAtlas.patternPositions;let S=b[a.to.toString()],C=b[a.from.toString()];if(!S&&C&&(S=C),!C&&S&&(C=S),!S||!C){const I=p.getPaintProperty(t);S=b[I],C=b[I]}S&&C&&y.setConstantPatternPositions(S,C)}function ja(y,t,a,c,p,b,S,C){const I=y.context.gl,N="fill-pattern",U=a.paint.get(N),$=U&&U.constantOr(1),G=a.getCrossfadeParameters();let K,ie,he,me,pe;const ve=y.transform,Me=a.paint.get("fill-translate"),ye=a.paint.get("fill-translate-anchor");S?(ie=$&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",K=I.LINES):(ie=$?"fillPattern":"fill",K=I.TRIANGLES);const Ee=U.constantOr(null);for(const Le of c){const Te=t.getTile(Le);if($&&!Te.patternsLoaded())continue;const Oe=Te.getBucket(a);if(!Oe)continue;const et=Oe.programConfigurations.get(a.id),Xe=y.useProgram(ie,et),We=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Le);$&&(y.context.activeTexture.set(I.TEXTURE0),Te.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),et.updatePaintBuffers(G)),Un(et,N,Ee,Te,a);const Ke=ve.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),zt=u.aO(ve,Te,Me,ye);if(S){me=Oe.indexBuffer2,pe=Oe.segments2;const xt=[I.drawingBufferWidth,I.drawingBufferHeight];he=ie==="fillOutlinePattern"&&$?Vl(y,G,Te,xt,zt):Ul(xt,zt)}else me=Oe.indexBuffer,pe=Oe.segments,he=$?Ha(y,G,Te,zt):{u_fill_translate:zt};const kt=y.stencilModeForClipping(Le);Xe.draw(y.context,K,p,kt,b,Mi.backCCW,he,We,Ke,a.id,Oe.layoutVertexBuffer,me,pe,a.paint,y.transform.zoom,et)}}function ks(y,t,a,c,p,b,S,C){const I=y.context,N=I.gl,U="fill-extrusion-pattern",$=a.paint.get(U),G=$.constantOr(1),K=a.getCrossfadeParameters(),ie=a.paint.get("fill-extrusion-opacity"),he=$.constantOr(null),me=y.transform;for(const pe of c){const ve=t.getTile(pe),Me=ve.getBucket(a);if(!Me)continue;const ye=y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe),Ee=Me.programConfigurations.get(a.id),Le=y.useProgram(G?"fillExtrusionPattern":"fillExtrusion",Ee);G&&(y.context.activeTexture.set(N.TEXTURE0),ve.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ee.updatePaintBuffers(K));const Te=me.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!C,applyTerrainMatrix:!0});Un(Ee,U,he,ve,a);const Oe=u.aO(me,ve,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),et=a.paint.get("fill-extrusion-vertical-gradient"),Xe=G?su(y,et,ie,Oe,pe,K,ve):Ga(y,et,ie,Oe);Le.draw(I,I.gl.TRIANGLES,p,b,S,Mi.backCCW,Xe,ye,Te,a.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,a.paint,y.transform.zoom,Ee,y.style.map.terrain&&Me.centroidVertexBuffer)}}function Rs(y,t,a,c,p,b,S,C,I){var N;const U=y.style.projection,$=y.context,G=y.transform,K=$.gl,ie=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],he=y.useProgram("hillshade",null,!1,ie),me=!y.options.moving;for(const pe of c){const ve=t.getTile(pe),Me=ve.fbo;if(!Me)continue;const ye=U.getMeshFromTileID($,pe.canonical,C,!0,"raster"),Ee=(N=y.style.map.terrain)===null||N===void 0?void 0:N.getTerrainData(pe);$.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,Me.colorAttachment.get());const Le=G.getProjectionData({overscaledTileID:pe,aligned:me,applyGlobeMatrix:!I,applyTerrainMatrix:!0});he.draw($,K.TRIANGLES,b,p[pe.overscaledZ],S,Mi.backCCW,hl(y,ve,a),Ee,Le,a.id,ye.vertexBuffer,ye.indexBuffer,ye.segments)}}function co(y,t,a,c,p,b,S,C,I){var N;const U=y.style.projection,$=y.context,G=y.transform,K=$.gl,ie=y.useProgram("colorRelief"),he=!y.options.moving;let me=!0,pe=0;for(const ve of c){const Me=t.getTile(ve),ye=Me.dem;if(me){const Xe=K.getParameter(K.MAX_TEXTURE_SIZE),{elevationTexture:We,colorTexture:Ke}=a.getColorRampTextures($,Xe,ye.getUnpackVector());$.activeTexture.set(K.TEXTURE1),We.bind(K.NEAREST,K.CLAMP_TO_EDGE),$.activeTexture.set(K.TEXTURE4),Ke.bind(K.LINEAR,K.CLAMP_TO_EDGE),me=!1,pe=We.size[0]}if(!ye||!ye.data)continue;const Ee=ye.stride,Le=ye.getPixels();if($.activeTexture.set(K.TEXTURE0),$.pixelStoreUnpackPremultiplyAlpha.set(!1),Me.demTexture=Me.demTexture||y.getTileTexture(Ee),Me.demTexture){const Xe=Me.demTexture;Xe.update(Le,{premultiply:!1}),Xe.bind(K.LINEAR,K.CLAMP_TO_EDGE)}else Me.demTexture=new u.T($,Le,K.RGBA,{premultiply:!1}),Me.demTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const Te=U.getMeshFromTileID($,ve.canonical,C,!0,"raster"),Oe=(N=y.style.map.terrain)===null||N===void 0?void 0:N.getTerrainData(ve),et=G.getProjectionData({overscaledTileID:ve,aligned:he,applyGlobeMatrix:!I,applyTerrainMatrix:!0});ie.draw($,K.TRIANGLES,b,p[ve.overscaledZ],S,Mi.backCCW,kh(a,Me.dem,pe),Oe,et,a.id,Te.vertexBuffer,Te.indexBuffer,Te.segments)}}const ms=[new u.P(0,0),new u.P(u.a5,0),new u.P(u.a5,u.a5),new u.P(0,u.a5)];function Ua(y,t,a,c,p,b,S,C,I=!1,N=!1){const U=c[c.length-1].overscaledZ,$=y.context,G=$.gl,K=y.useProgram("raster"),ie=y.transform,he=y.style.projection,me=y.colorModeForRenderPass(),pe=!y.options.moving,ve=a.paint.get("raster-opacity"),Me=a.paint.get("raster-resampling"),ye=a.paint.get("raster-fade-duration"),Ee=!!y.style.map.terrain;for(const Le of c){const Te=y.getDepthModeForSublayer(Le.overscaledZ-U,ve===1?xi.ReadWrite:xi.ReadOnly,G.LESS),Oe=t.getTile(Le),et=Me==="nearest"?G.NEAREST:G.LINEAR;$.activeTexture.set(G.TEXTURE0),Oe.texture.bind(et,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),$.activeTexture.set(G.TEXTURE1);const{parentTile:Xe,parentScaleBy:We,parentTopLeft:Ke,fadeValues:zt}=Os(Oe,t,ye,Ee);Oe.fadeOpacity=zt.tileOpacity,Xe?(Xe.fadeOpacity=zt.parentTileOpacity,Xe.texture.bind(et,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST)):Oe.texture.bind(et,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),Oe.texture.useMipmap&&$.extTextureFilterAnisotropic&&y.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Le),xt=ie.getProjectionData({overscaledTileID:Le,aligned:pe,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Bt=ql(Ke,We,zt.fadeMix,a,C),Ti=he.getMeshFromTileID($,Le.canonical,b,S,"raster");K.draw($,G.TRIANGLES,Te,p?p[Le.overscaledZ]:Bi.disabled,me,I?Mi.frontCCW:Mi.backCCW,Bt,kt,xt,a.id,Ti.vertexBuffer,Ti.indexBuffer,Ti.segments)}}function Os(y,t,a,c){const p={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return p;if(y.fadingParentID){const b=t.getLoadedTile(y.fadingParentID);if(!b)return p;const S=Math.pow(2,b.tileID.overscaledZ-y.tileID.overscaledZ),C=[y.tileID.canonical.x*S%1,y.tileID.canonical.y*S%1],I=(function(N,U,$){const G=be(),K=(G-U.timeAdded)/$,ie=N.fadingDirection===qe.Incoming,he=u.an((G-N.timeAdded)/$,0,1),me=u.an(1-K,0,1),pe=ie?he:me;return{tileOpacity:pe,parentTileOpacity:ie?me:he,fadeMix:{opacity:1,mix:1-pe}}})(y,b,a);return{parentTile:b,parentScaleBy:S,parentTopLeft:C,fadeValues:I}}if(y.selfFading){const b=(function(S,C){const I=(be()-S.timeAdded)/C,N=u.an(I,0,1);return{tileOpacity:N,fadeMix:{opacity:N,mix:0}}})(y,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:b}}return p}const xl=new u.bp(1,0,0,1),Vo=new u.bp(0,1,0,1),Bh=new u.bp(0,0,1,1),Nh=new u.bp(1,0,1,1),gs=new u.bp(0,1,1,1);function uu(y,t,a,c){wr(y,0,t+a/2,y.transform.width,a,c)}function bl(y,t,a,c){wr(y,t-a/2,0,a,y.transform.height,c)}function wr(y,t,a,c,p,b){const S=y.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*y.pixelRatio,a*y.pixelRatio,c*y.pixelRatio,p*y.pixelRatio),S.clear({color:b}),C.disable(C.SCISSOR_TEST)}function Xu(y,t,a){const c=y.context,p=c.gl,b=y.useProgram("debug"),S=xi.disabled,C=Bi.disabled,I=y.colorModeForRenderPass(),N="$debug",U=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);c.activeTexture.set(p.TEXTURE0);const $=t.getTileByID(a.key).latestRawTileData,G=Math.floor(($&&$.byteLength||0)/1024),K=t.getTile(a).tileSize,ie=512/Math.min(K,512)*(a.overscaledZ/y.transform.zoom)*.5;let he=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(he+=` => ${a.overscaledZ}`),(function(pe,ve){pe.initDebugOverlayCanvas();const Me=pe.debugOverlayCanvas,ye=pe.context.gl,Ee=pe.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,Me.width,Me.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(ve,5,5),Ee.strokeText(ve,5,5),pe.debugOverlayTexture.update(Me),pe.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)})(y,`${he} ${G}kB`);const me=y.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(c,p.TRIANGLES,S,C,dn.alphaBlended,Mi.disabled,$a(u.bp.transparent,ie),null,me,N,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),b.draw(c,p.LINE_STRIP,S,C,I,Mi.disabled,$a(u.bp.red),U,me,N,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Fh(y,t,a,c){const{isRenderingGlobe:p}=c,b=y.context,S=b.gl,C=y.transform,I=y.colorModeForRenderPass(),N=y.getDepthModeFor3D(),U=y.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,y.width,y.height]);for(const $ of a){const G=t.getTerrainMesh($.tileID),K=y.renderToTexture.getTexture($),ie=t.getTerrainData($.tileID);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,K.texture);const he=t.getMeshFrameDelta(C.zoom),me=C.calculateFogMatrix($.tileID.toUnwrapped()),pe=Zu(he,me,y.style.sky,C.pitch,p),ve=C.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(b,S.TRIANGLES,N,Bi.disabled,I,Mi.backCCW,pe,ie,ve,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}}function Pd(y,t){if(!t.mesh){const a=new u.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const c=new u.aY;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new hn(y.createVertexBuffer(a,_a.members),y.createIndexBuffer(c),u.aX.simpleSegment(0,0,a.length,c.length))}return t.mesh}class kf{constructor(t,a){this.context=new ae(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=gn.maxOverzooming+gn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xr}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,a=new u.aW;a.emplaceBack(0,0),a.emplaceBack(u.a5,0),a.emplaceBack(0,u.a5),a.emplaceBack(u.a5,u.a5),this.tileExtentBuffer=t.createVertexBuffer(a,_a.members),this.tileExtentSegments=u.aX.simpleSegment(0,0,4,2);const c=new u.aW;c.emplaceBack(0,0),c.emplaceBack(u.a5,0),c.emplaceBack(0,u.a5),c.emplaceBack(u.a5,u.a5),this.debugBuffer=t.createVertexBuffer(c,_a.members),this.debugSegments=u.aX.simpleSegment(0,0,4,5);const p=new u.ch;p.emplaceBack(0,0,0,0),p.emplaceBack(u.a5,0,u.a5,0),p.emplaceBack(0,u.a5,0,u.a5),p.emplaceBack(u.a5,u.a5,u.a5,u.a5),this.rasterBoundsBuffer=t.createVertexBuffer(p,Dh.members),this.rasterBoundsSegments=u.aX.simpleSegment(0,0,4,2);const b=new u.aW;b.emplaceBack(0,0),b.emplaceBack(u.a5,0),b.emplaceBack(0,u.a5),b.emplaceBack(u.a5,u.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(b,_a.members),this.rasterBoundsSegmentsPosOnly=u.aX.simpleSegment(0,0,4,5);const S=new u.aW;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(S,_a.members),this.viewportSegments=u.aX.simpleSegment(0,0,4,2);const C=new u.ci;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(C);const I=new u.aY;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(I);const N=this.context.gl;this.stencilClearMode=new Bi({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.tileExtentMesh=new hn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=u.N();u.c7(c,0,this.width,this.height,0,0,1),u.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const p={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,xi.disabled,this.stencilClearMode,dn.disabled,Mi.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const p=this.context;p.setColorMode(dn.disabled),p.setDepthMode(xi.disabled);const b={};for(const S of a)b[S.key]=this.nextStencilID++;this._renderTileMasks(b,a,c,!0),this._renderTileMasks(b,a,c,!1),this._tileClippingMaskIDs=b}_renderTileMasks(t,a,c,p){const b=this.context,S=b.gl,C=this.style.projection,I=this.transform,N=this.useProgram("clippingMask");for(const U of a){const $=t[U.key],G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),K=C.getMeshFromTileID(this.context,U.canonical,p,!0,"stencil"),ie=I.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!c,applyTerrainMatrix:!0});N.draw(b,S.TRIANGLES,xi.disabled,new Bi({func:S.ALWAYS,mask:0},$,255,S.KEEP,S.KEEP,S.REPLACE),dn.disabled,c?Mi.disabled:Mi.backCCW,null,G,ie,"$clipping",K.vertexBuffer,K.indexBuffer,K.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,c=this.style.projection,p=this.transform,b=this.useProgram("depth"),S=this.getDepthModeFor3D(),C=Ln(p,{tileSize:p.tileSize});for(const I of C){const N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),U=c.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),$=p.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(t,a.TRIANGLES,S,Bi.disabled,dn.disabled,Mi.backCCW,null,N,$,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Bi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Bi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,c=t.sort(((S,C)=>C.overscaledZ-S.overscaledZ)),p=c[c.length-1].overscaledZ,b=c[0].overscaledZ-p+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let C=0;C<b;C++)S[C+p]=new Bi({func:a.GEQUAL,mask:255},C+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[S,c]}return[{[p]:Bi.disabled},c]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,c=t.sort(((S,C)=>C.overscaledZ-S.overscaledZ)),p=c[c.length-1].overscaledZ,b=c[0].overscaledZ-p+1;if(this.clearStencil(),b>1){const S={},C={};for(let I=0;I<b;I++)S[I+p]=new Bi({func:a.GREATER,mask:255},b+1+I,255,a.KEEP,a.KEEP,a.REPLACE),C[I+p]=new Bi({func:a.GREATER,mask:255},1+I,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*b+1,[S,C,c]}return this.nextStencilID=3,[{[p]:new Bi({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[p]:new Bi({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new dn([t.CONSTANT_COLOR,t.ONE],new u.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?dn.unblended:dn.alphaBlended}getDepthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return xi.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new xi(c||this.context.gl.LEQUAL,a,[p,p])}getDepthModeFor3D(){return new xi(this.context.gl.LEQUAL,xi.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var c,p;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(be()),this.imageManager.beginFrame();const b=this.style._order,S=this.style.tileManagers,C={},I={},N={},U={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const G in S){const K=S[G];K.used&&K.prepare(this.context),C[G]=K.getVisibleCoordinates(!1),I[G]=C[G].slice().reverse(),N[G]=K.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<b.length;G++)if(this.style._layers[b[G]].is3D()){this.opaquePassCutoff=G;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const G of b){const K=this.style._layers[G];if(!K.hasOffscreenPass()||K.isHidden(this.transform.zoom))continue;const ie=I[K.source];(K.type==="custom"||ie.length)&&this.renderLayer(this,S[K.source],K,ie,U)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:G=>this.useProgram(G)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?u.bp.black:u.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(G,K){const ie=G.context,he=ie.gl,me=((Le,Te,Oe)=>{const et=Math.cos(Te.rollInRadians),Xe=Math.sin(Te.rollInRadians),We=Vi(Te),Ke=Te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Le.properties.get("sky-color"),u_horizon_color:Le.properties.get("horizon-color"),u_horizon:[(Te.width/2-We*Xe)*Oe,(Te.height/2+We*et)*Oe],u_horizon_normal:[-Xe,et],u_sky_horizon_blend:Le.properties.get("sky-horizon-blend")*Te.height/2*Oe,u_sky_blend:Ke}})(K,G.style.map.transform,G.pixelRatio),pe=new xi(he.LEQUAL,xi.ReadWrite,[0,1]),ve=Bi.disabled,Me=G.colorModeForRenderPass(),ye=G.useProgram("sky"),Ee=Pd(ie,K);ye.draw(ie,he.TRIANGLES,pe,ve,Me,Mi.disabled,me,null,void 0,"sky",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[b[this.currentLayer]],K=S[G.source],ie=C[G.source];this._renderTileClippingMasks(G,ie,!1),this.renderLayer(this,K,G,ie,U)}this.renderPass="translucent";let $=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const G=this.style._layers[b[this.currentLayer]],K=S[G.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(G,U))continue;this.opaquePassEnabledForLayer()||$||($=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ie=(G.type==="symbol"?N:I)[G.source];this._renderTileClippingMasks(G,C[G.source],!!this.renderToTexture),this.renderLayer(this,K,G,ie,U)}if(U.isRenderingGlobe&&(function(G,K,ie){const he=G.context,me=he.gl,pe=G.useProgram("atmosphere"),ve=new xi(me.LEQUAL,xi.ReadOnly,[0,1]),Me=G.transform,ye=(function(Ke,zt){const kt=Ke.properties.get("position"),xt=[-kt.x,-kt.y,-kt.z],Bt=u.ar(new Float64Array(16));return Ke.properties.get("anchor")==="map"&&(u.bg(Bt,Bt,zt.rollInRadians),u.bh(Bt,Bt,-zt.pitchInRadians),u.bg(Bt,Bt,zt.bearingInRadians),u.bh(Bt,Bt,zt.center.lat*Math.PI/180),u.bJ(Bt,Bt,-zt.center.lng*Math.PI/180)),u.cg(xt,xt,Bt),xt})(ie,G.transform),Ee=Me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Le=K.properties.get("atmosphere-blend")*Ee.projectionTransition;if(Le===0)return;const Te=to(Me.worldSize,Me.center.lat),Oe=Me.inverseProjectionMatrix,et=new Float64Array(4);et[3]=1,u.aH(et,et,Me.modelViewProjectionMatrix),et[0]/=et[3],et[1]/=et[3],et[2]/=et[3],et[3]=1,u.aH(et,et,Oe),et[0]/=et[3],et[1]/=et[3],et[2]/=et[3],et[3]=1;const Xe=((Ke,zt,kt,xt,Bt)=>({u_sun_pos:Ke,u_atmosphere_blend:zt,u_globe_position:kt,u_globe_radius:xt,u_inv_proj_matrix:Bt}))(ye,Le,[et[0],et[1],et[2]],Te,Oe),We=Pd(he,K);pe.draw(he,me.TRIANGLES,ve,Bi.disabled,dn.alphaBlended,Mi.disabled,Xe,null,null,"atmosphere",We.vertexBuffer,We.indexBuffer,We.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const G=(function(K,ie){let he=null;const me=Object.values(K._layers).flatMap((ye=>ye.source&&!ye.isHidden(ie)?[K.tileManagers[ye.source]]:[])),pe=me.filter((ye=>ye.getSource().type==="vector")),ve=me.filter((ye=>ye.getSource().type!=="vector")),Me=ye=>{(!he||he.getSource().maxzoom<ye.getSource().maxzoom)&&(he=ye)};return pe.forEach((ye=>Me(ye))),he||ve.forEach((ye=>Me(ye))),he})(this.style,this.transform.zoom);G&&(function(K,ie,he){for(let me=0;me<he.length;me++)Xu(K,ie,he[me])})(this,G,G.getVisibleCoordinates())}this.options.showPadding&&(function(G){const K=G.transform.padding;uu(G,G.transform.height-(K.top||0),3,xl),uu(G,K.bottom||0,3,Vo),bl(G,K.left||0,3,Bh),bl(G,G.transform.width-(K.right||0),3,Nh);const ie=G.transform.centerPoint;(function(he,me,pe,ve){wr(he,me-1,pe-10,2,20,ve),wr(he,me-10,pe-1,20,2,ve)})(G,ie.x,G.transform.height-ie.y,gs)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=t?!u.cj(a,c):!u.ck(a,c)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(u.cl(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(b,S){const C=b.context,I=C.gl,N=b.transform,U=dn.unblended,$=new xi(I.LEQUAL,xi.ReadWrite,[0,1]),G=S.tileManager.getRenderableTiles(),K=b.useProgram("terrainDepth");C.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),C.clear({color:u.bp.transparent,depth:1});for(const ie of G){const he=S.getTerrainMesh(ie.tileID),me=S.getTerrainData(ie.tileID),pe=N.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ve={u_ele_delta:S.getMeshFrameDelta(N.zoom)};K.draw(C,I.TRIANGLES,$,Bi.disabled,U,Mi.backCCW,ve,me,pe,"terrain",he.vertexBuffer,he.indexBuffer,he.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain),(function(b,S){const C=b.context,I=C.gl,N=b.transform,U=dn.unblended,$=new xi(I.LEQUAL,xi.ReadWrite,[0,1]),G=S.getCoordsTexture(),K=S.tileManager.getRenderableTiles(),ie=b.useProgram("terrainCoords");C.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),C.clear({color:u.bp.transparent,depth:1}),S.coordsIndex=[];for(const he of K){const me=S.getTerrainMesh(he.tileID),pe=S.getTerrainData(he.tileID);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,G.texture);const ve={u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(N.zoom)},Me=N.getProjectionData({overscaledTileID:he.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ie.draw(C,I.TRIANGLES,$,Bi.disabled,U,Mi.backCCW,ve,pe,Me,"terrain",me.vertexBuffer,me.indexBuffer,me.segments),S.coordsIndex.push(he.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain))}renderLayer(t,a,c,p,b){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(p||[]).length)&&(this.id=c.id,u.cm(c)?(function(S,C,I,N,U,$){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:G}=$,K=Bi.disabled,ie=S.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(he,me,pe,ve,Me,ye,Ee,Le,Te){const Oe=me.transform,et=me.style.map.terrain,Xe=Me==="map",We=ye==="map";for(const Ke of he){const zt=ve.getTile(Ke),kt=zt.getBucket(pe);if(!kt||!kt.text||!kt.text.segments.get().length)continue;const xt=u.ay(kt.textSizeData,Oe.zoom),Bt=u.aN(zt,1,me.transform.zoom),Ti=ma(Xe,me.transform,Bt),pn=pe.layout.get("icon-text-fit")!=="none"&&kt.hasIconData();if(xt){const Dn=Math.pow(2,Oe.zoom-zt.tileID.overscaledZ),En=et?(Zn,xn)=>et.getElevation(Ke,Zn,xn):null;ci(kt,Xe,We,Te,Oe,Ti,Dn,xt,pn,u.aO(Oe,zt,Ee,Le),Ke.toUnwrapped(),En)}}})(N,S,I,C,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),U),I.paint.get("icon-opacity").constantOr(1)!==0&&lr(S,C,I,N,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),K,ie,G),I.paint.get("text-opacity").constantOr(1)!==0&&lr(S,C,I,N,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),K,ie,G),C.map.showCollisionBoxes&&(Ve(S,C,I,N,!0),Ve(S,C,I,N,!1))})(t,a,c,p,this.style.placement.variableOffsets,b):u.cn(c)?(function(S,C,I,N,U){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:$}=U,G=I.paint.get("circle-opacity"),K=I.paint.get("circle-stroke-width"),ie=I.paint.get("circle-stroke-opacity"),he=!I.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(K.constantOr(1)===0||ie.constantOr(1)===0))return;const me=S.context,pe=me.gl,ve=S.transform,Me=S.getDepthModeForSublayer(0,xi.ReadOnly),ye=Bi.disabled,Ee=S.colorModeForRenderPass(),Le=[],Te=ve.getCircleRadiusCorrection();for(let Oe=0;Oe<N.length;Oe++){const et=N[Oe],Xe=C.getTile(et),We=Xe.getBucket(I);if(!We)continue;const Ke=I.paint.get("circle-translate"),zt=I.paint.get("circle-translate-anchor"),kt=u.aO(ve,Xe,Ke,zt),xt=We.programConfigurations.get(I.id),Bt=S.useProgram("circle",xt),Ti=We.layoutVertexBuffer,pn=We.indexBuffer,Dn=S.style.map.terrain&&S.style.map.terrain.getTerrainData(et),En={programConfiguration:xt,program:Bt,layoutVertexBuffer:Ti,indexBuffer:pn,uniformValues:Zl(S,Xe,I,kt,Te),terrainData:Dn,projectionData:ve.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!$,applyTerrainMatrix:!0})};if(he){const Zn=We.segments.get();for(const xn of Zn)Le.push({segments:new u.aX([xn]),sortKey:xn.sortKey,state:En})}else Le.push({segments:We.segments,sortKey:0,state:En})}he&&Le.sort(((Oe,et)=>Oe.sortKey-et.sortKey));for(const Oe of Le){const{programConfiguration:et,program:Xe,layoutVertexBuffer:We,indexBuffer:Ke,uniformValues:zt,terrainData:kt,projectionData:xt}=Oe.state;Xe.draw(me,pe.TRIANGLES,Me,ye,Ee,Mi.backCCW,zt,kt,xt,I.id,We,Ke,Oe.segments,I.paint,S.transform.zoom,et)}})(t,a,c,p,b):u.co(c)?(function(S,C,I,N,U){if(I.paint.get("heatmap-opacity")===0)return;const $=S.context,{isRenderingToTexture:G,isRenderingGlobe:K}=U;if(S.style.map.terrain){for(const ie of N){const he=C.getTile(ie);C.hasRenderableParent(ie)||(S.renderPass==="offscreen"?Aa(S,he,I,ie,K):S.renderPass==="translucent"&&on(S,I,ie,G,K))}$.viewport.set([0,0,S.width,S.height])}else S.renderPass==="offscreen"?(function(ie,he,me,pe){const ve=ie.context,Me=ve.gl,ye=ie.transform,Ee=Bi.disabled,Le=new dn([Me.ONE,Me.ONE],u.bp.transparent,[!0,!0,!0,!0]);(function(Te,Oe,et){const Xe=Te.gl;Te.activeTexture.set(Xe.TEXTURE1),Te.viewport.set([0,0,Oe.width/4,Oe.height/4]);let We=et.heatmapFbos.get(u.cd);We?(Xe.bindTexture(Xe.TEXTURE_2D,We.colorAttachment.get()),Te.bindFramebuffer.set(We.framebuffer)):(We=Xi(Te,Oe.width/4,Oe.height/4),et.heatmapFbos.set(u.cd,We))})(ve,ie,me),ve.clear({color:u.bp.transparent});for(let Te=0;Te<pe.length;Te++){const Oe=pe[Te];if(he.hasRenderableParent(Oe))continue;const et=he.getTile(Oe),Xe=et.getBucket(me);if(!Xe)continue;const We=Xe.programConfigurations.get(me.id),Ke=ie.useProgram("heatmap",We),zt=ye.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),kt=ye.getCircleRadiusCorrection();Ke.draw(ve,Me.TRIANGLES,xi.disabled,Ee,Le,Mi.backCCW,ds(et,ye.zoom,me.paint.get("heatmap-intensity"),kt),null,zt,me.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,me.paint,ye.zoom,We)}ve.viewport.set([0,0,ie.width,ie.height])})(S,C,I,N):S.renderPass==="translucent"&&(function(ie,he){const me=ie.context,pe=me.gl;me.setColorMode(ie.colorModeForRenderPass());const ve=he.heatmapFbos.get(u.cd);ve&&(me.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_2D,ve.colorAttachment.get()),me.activeTexture.set(pe.TEXTURE1),Ni(me,he).bind(pe.LINEAR,pe.CLAMP_TO_EDGE),ie.useProgram("heatmapTexture").draw(me,pe.TRIANGLES,xi.disabled,Bi.disabled,ie.colorModeForRenderPass(),Mi.disabled,Gu(ie,he,0,1),null,null,he.id,ie.viewportBuffer,ie.quadTriangleIndexBuffer,ie.viewportSegments,he.paint,ie.transform.zoom))})(S,I)})(t,a,c,p,b):u.cp(c)?(function(S,C,I,N,U){if(S.renderPass!=="translucent")return;const{isRenderingToTexture:$}=U,G=I.paint.get("line-opacity"),K=I.paint.get("line-width");if(G.constantOr(1)===0||K.constantOr(1)===0)return;const ie=S.getDepthModeForSublayer(0,xi.ReadOnly),he=S.colorModeForRenderPass(),me=I.paint.get("line-dasharray"),pe=me.constantOr(1),ve=I.paint.get("line-pattern"),Me=ve.constantOr(1),ye=I.paint.get("line-gradient"),Ee=I.getCrossfadeParameters();let Le;Le=Me?"linePattern":pe&&ye?"lineGradientSDF":pe?"lineSDF":ye?"lineGradient":"line";const Te=S.context,Oe=Te.gl,et=S.transform;let Xe=!0;for(const We of N){const Ke=C.getTile(We);if(Me&&!Ke.patternsLoaded())continue;const zt=Ke.getBucket(I);if(!zt)continue;const kt=zt.programConfigurations.get(I.id),xt=S.context.program.get(),Bt=S.useProgram(Le,kt),Ti=Xe||Bt.program!==xt,pn=S.style.map.terrain&&S.style.map.terrain.getTerrainData(We),Dn=ve.constantOr(null),En=me&&me.constantOr(null);if(Dn&&Ke.imageAtlas){const Hr=Ke.imageAtlas,ur=Hr.patternPositions[Dn.to.toString()],hr=Hr.patternPositions[Dn.from.toString()];ur&&hr&&kt.setConstantPatternPositions(ur,hr)}else if(En){const Hr=I.layout.get("line-cap")==="round",ur=S.lineAtlas.getDash(En.to,Hr),hr=S.lineAtlas.getDash(En.from,Hr);kt.setConstantDashPositions(ur,hr)}const Zn=et.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),xn=et.getPixelScale();let nr;Me?(nr=fs(S,Ke,I,xn,Ee),Fa(Te,Oe,Ke,kt,Ee)):pe&&ye?(nr=ao(S,Ke,I,xn,Ee,zt.lineClipsArray.length),la(S,C,Te,Oe,I,zt,We,kt,Ee)):pe?(nr=Fr(S,Ke,I,xn,Ee),On(S,Te,Oe,kt,Ti,Ee)):ye?(nr=Rh(S,Ke,I,xn,zt.lineClipsArray.length),Ca(S,C,Te,Oe,I,zt,We)):nr=Is(S,Ke,I,xn);const qn=S.stencilModeForClipping(We);Bt.draw(Te,Oe.TRIANGLES,ie,qn,he,Mi.disabled,nr,pn,Zn,I.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,I.paint,S.transform.zoom,kt,zt.layoutVertexBuffer2),Xe=!1}})(t,a,c,p,b):u.cq(c)?(function(S,C,I,N,U){const $=I.paint.get("fill-color"),G=I.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const{isRenderingToTexture:K}=U,ie=S.colorModeForRenderPass(),he=I.paint.get("fill-pattern"),me=S.opaquePassEnabledForLayer()&&!he.constantOr(1)&&$.constantOr(u.bp.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===me){const pe=S.getDepthModeForSublayer(1,S.renderPass==="opaque"?xi.ReadWrite:xi.ReadOnly);ja(S,C,I,N,pe,ie,!1,K)}if(S.renderPass==="translucent"&&I.paint.get("fill-antialias")){const pe=S.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,xi.ReadOnly);ja(S,C,I,N,pe,ie,!0,K)}})(t,a,c,p,b):u.cr(c)?(function(S,C,I,N,U){const $=I.paint.get("fill-extrusion-opacity");if($===0)return;const{isRenderingToTexture:G}=U;if(S.renderPass==="translucent"){const K=new xi(S.context.gl.LEQUAL,xi.ReadWrite,S.depthRangeFor3D);if($!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))ks(S,C,I,N,K,Bi.disabled,dn.disabled,G),ks(S,C,I,N,K,S.stencilModeFor3D(),S.colorModeForRenderPass(),G);else{const ie=S.colorModeForRenderPass();ks(S,C,I,N,K,Bi.disabled,ie,G)}}})(t,a,c,p,b):u.cs(c)?(function(S,C,I,N,U){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const{isRenderingToTexture:$}=U,G=S.context,K=S.style.projection.useSubdivision,ie=S.getDepthModeForSublayer(0,xi.ReadOnly),he=S.colorModeForRenderPass();if(S.renderPass==="offscreen")(function(me,pe,ve,Me,ye,Ee,Le){const Te=me.context,Oe=Te.gl;for(const et of ve){const Xe=pe.getTile(et),We=Xe.dem;if(!We||!We.data||!Xe.needsHillshadePrepare)continue;const Ke=We.dim,zt=We.stride,kt=We.getPixels();if(Te.activeTexture.set(Oe.TEXTURE1),Te.pixelStoreUnpackPremultiplyAlpha.set(!1),Xe.demTexture=Xe.demTexture||me.getTileTexture(zt),Xe.demTexture){const Bt=Xe.demTexture;Bt.update(kt,{premultiply:!1}),Bt.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE)}else Xe.demTexture=new u.T(Te,kt,Oe.RGBA,{premultiply:!1}),Xe.demTexture.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE);Te.activeTexture.set(Oe.TEXTURE0);let xt=Xe.fbo;if(!xt){const Bt=new u.T(Te,{width:Ke,height:Ke,data:null},Oe.RGBA);Bt.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),xt=Xe.fbo=Te.createFramebuffer(Ke,Ke,!0,!1),xt.colorAttachment.set(Bt.texture)}Te.bindFramebuffer.set(xt.framebuffer),Te.viewport.set([0,0,Ke,Ke]),me.useProgram("hillshadePrepare").draw(Te,Oe.TRIANGLES,ye,Ee,Le,Mi.disabled,Lh(Xe.tileID,We),null,null,Me.id,me.rasterBoundsBuffer,me.quadTriangleIndexBuffer,me.rasterBoundsSegments),Xe.needsHillshadePrepare=!1}})(S,C,N,I,ie,Bi.disabled,he),G.viewport.set([0,0,S.width,S.height]);else if(S.renderPass==="translucent")if(K){const[me,pe,ve]=S.stencilConfigForOverlapTwoPass(N);Rs(S,C,I,ve,me,ie,he,!1,$),Rs(S,C,I,ve,pe,ie,he,!0,$)}else{const[me,pe]=S.getStencilConfigForOverlapAndUpdateStencilID(N);Rs(S,C,I,pe,me,ie,he,!1,$)}})(t,a,c,p,b):u.ct(c)?(function(S,C,I,N,U){if(S.renderPass!=="translucent"||!N.length)return;const{isRenderingToTexture:$}=U,G=S.style.projection.useSubdivision,K=S.getDepthModeForSublayer(0,xi.ReadOnly),ie=S.colorModeForRenderPass();if(G){const[he,me,pe]=S.stencilConfigForOverlapTwoPass(N);co(S,C,I,pe,he,K,ie,!1,$),co(S,C,I,pe,me,K,ie,!0,$)}else{const[he,me]=S.getStencilConfigForOverlapAndUpdateStencilID(N);co(S,C,I,me,he,K,ie,!1,$)}})(t,a,c,p,b):u.bU(c)?(function(S,C,I,N,U){if(S.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!N.length)return;const{isRenderingToTexture:$}=U,G=C.getSource(),K=S.style.projection.useSubdivision;if(G instanceof cn)Ua(S,C,I,N,null,!1,!1,G.tileCoords,G.flippedWindingOrder,$);else if(K){const[ie,he,me]=S.stencilConfigForOverlapTwoPass(N);Ua(S,C,I,me,ie,!1,!0,ms,!1,$),Ua(S,C,I,me,he,!0,!0,ms,!1,$)}else{const[ie,he]=S.getStencilConfigForOverlapAndUpdateStencilID(N);Ua(S,C,I,he,ie,!1,!0,ms,!1,$)}})(t,a,c,p,b):u.cu(c)?(function(S,C,I,N,U){const $=I.paint.get("background-color"),G=I.paint.get("background-opacity");if(G===0)return;const{isRenderingToTexture:K}=U,ie=S.context,he=ie.gl,me=S.style.projection,pe=S.transform,ve=pe.tileSize,Me=I.paint.get("background-pattern");if(S.isPatternMissing(Me))return;const ye=!Me&&$.a===1&&G===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==ye)return;const Ee=Bi.disabled,Le=S.getDepthModeForSublayer(0,ye==="opaque"?xi.ReadWrite:xi.ReadOnly),Te=S.colorModeForRenderPass(),Oe=S.useProgram(Me?"backgroundPattern":"background"),et=N||Ln(pe,{tileSize:ve,terrain:S.style.map.terrain});Me&&(ie.activeTexture.set(he.TEXTURE0),S.imageManager.bind(S.context));const Xe=I.getCrossfadeParameters();for(const We of et){const Ke=pe.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!K,applyTerrainMatrix:!0}),zt=Me?vc(G,S,Me,{tileID:We,tileSize:ve},Xe):Gl(G,$),kt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(We),xt=me.getMeshFromTileID(ie,We.canonical,!1,!0,"raster");Oe.draw(ie,he.TRIANGLES,Le,Ee,Te,Mi.backCCW,zt,kt,Ke,I.id,xt.vertexBuffer,xt.indexBuffer,xt.segments)}})(t,0,c,p,b):u.cv(c)&&(function(S,C,I,N){const{isRenderingGlobe:U}=N,$=S.context,G=I.implementation,K=S.style.projection,ie=S.transform,he=ie.getProjectionDataForCustomLayer(U),me={farZ:ie.farZ,nearZ:ie.nearZ,fov:ie.fov*Math.PI/180,modelViewProjectionMatrix:ie.modelViewProjectionMatrix,projectionMatrix:ie.projectionMatrix,shaderData:{variantName:K.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${K.shaderPreludeCode.vertexSource}`,define:K.shaderDefine},defaultProjectionData:he},pe=G.renderingMode?G.renderingMode:"2d";if(S.renderPass==="offscreen"){const ve=G.prerender;ve&&(S.setCustomLayerDefaults(),$.setColorMode(S.colorModeForRenderPass()),ve.call(G,$.gl,me),$.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),$.setColorMode(S.colorModeForRenderPass()),$.setStencilMode(Bi.disabled);const ve=pe==="3d"?S.getDepthModeFor3D():S.getDepthModeForSublayer(0,xi.ReadOnly);$.setDepthMode(ve),G.render($.gl,me),$.setDirty(),S.setBaseState(),$.bindFramebuffer.set(null)}})(t,0,c,b))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a,c=!1,p=[]){this.cache=this.cache||{};const b=!!this.style.map.terrain,S=this.style.projection,C=c?Hi.projectionMercator:S.shaderPreludeCode,I=c?kn:S.shaderDefine,N=t+(a?a.cacheKey:"")+`/${c?Or:S.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[N]||(this.cache[N]=new ul(this.context,Hi[t],a,Oh[t],this._showOverdrawInspector,b,C,I,p)),this.cache[N]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const c in this._tileTextures){const p=this._tileTextures[c];if(p)for(const b of p)b.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const p=this.cache[c];p&&p.program&&this.context.gl.deleteProgram(p.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function zd(y,t){let a,c=!1,p=null,b=null;const S=()=>{p=null,c&&(y.apply(b,a),p=setTimeout(S,t),c=!1)};return(...C)=>(c=!0,b=this,a=C,p||S(),p)}class mr{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(c=p)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let p=c;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${c}`);let b=window.location.hash.replace(p,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let S=window.location.href.replace(/(#.+)?$/,b);S=S.replace("&&","&"),window.history.replaceState(window.history.state,null,S)},this._updateHash=zd(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),S=Math.round(a.lng*b)/b,C=Math.round(a.lat*b)/b,I=this._map.getBearing(),N=this._map.getPitch();let U="";if(U+=t?`/${S}/${C}/${c}`:`${c}/${C}/${S}`,(I||N)&&(U+="/"+Math.round(10*I)/10),N&&(U+=`/${Math.round(N)}`),this._hashName){const $=this._hashName;let G=!1;const K=window.location.hash.slice(1).split("&").map((ie=>{const he=ie.split("=")[0];return he===$?(G=!0,`${he}=${U}`):ie})).filter((ie=>ie));return G||K.push(`${$}=${U}`),`#${K.join("&")}`}return`#${U}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new u.V(+t[2],+t[1])}catch{return!1}const a=+t[0],c=+(t[3]||0),p=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Zo={linearity:.3,easing:u.cw(0,0,.3,1)},hu=u.e({deceleration:2500,maxSpeed:1400},Zo),Pa=u.e({deceleration:20,maxSpeed:1400},Zo),_s=u.e({deceleration:1e3,maxSpeed:360},Zo),Sc=u.e({deceleration:1e3,maxSpeed:90},Zo),za=u.e({deceleration:1e3,maxSpeed:360},Zo);class Wp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:be(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=be();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,a.roll+=b.rollDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){const b=Yu(a.pan.mag(),c,u.e({},hu,t||{})),S=a.pan.mult(b.amount/a.pan.mag()),C=this._map.cameraHelper.handlePanInertia(S,this._map.transform);p.center=C.easingCenter,p.offset=C.easingOffset,du(p,b)}if(a.zoom){const b=Yu(a.zoom,c,Pa);p.zoom=this._map.transform.zoom+b.amount,du(p,b)}if(a.bearing){const b=Yu(a.bearing,c,_s);p.bearing=this._map.transform.bearing+u.an(b.amount,-179,179),du(p,b)}if(a.pitch){const b=Yu(a.pitch,c,Sc);p.pitch=this._map.transform.pitch+b.amount,du(p,b)}if(a.roll){const b=Yu(a.roll,c,za);p.roll=this._map.transform.roll+u.an(b.amount,-179,179),du(p,b)}if(p.zoom||p.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;p.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),u.e(p,{noMoveStart:!0})}}function du(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function Yu(y,t,a){const{maxSpeed:c,linearity:p,deceleration:b}=a,S=u.an(y*p/(t/1e3),-c,c),C=Math.abs(S)/(b*p);return{easing:a.easing,duration:1e3*C,amount:S*(C/2)}}class Vr extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,p={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const b=de.mousePos(a.getCanvas(),c),S=a.unproject(b);super(t,u.e({point:b,lngLat:S,originalEvent:c},p)),this._defaultPrevented=!1,this.target=a}}class uo extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const p=t==="touchend"?c.changedTouches:c.touches,b=de.touchPos(a.getCanvasContainer(),p),S=b.map((I=>a.unproject(I))),C=b.reduce(((I,N,U,$)=>I.add(N.div($.length))),new u.P(0,0));super(t,{points:b,point:C,lngLats:S,lngLat:a.unproject(C),originalEvent:c}),this._defaultPrevented=!1}}class jh extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class Uh{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new jh(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Vr(t.type,this._map,t))}mouseup(t){this._map.fire(new Vr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Vr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Vr(t.type,this._map,t))}mouseover(t){this._map.fire(new Vr(t.type,this._map,t))}mouseout(t){this._map.fire(new Vr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new uo(t.type,this._map,t))}touchmove(t){this._map.fire(new uo(t.type,this._map,t))}touchend(t){this._map.fire(new uo(t.type,this._map,t))}touchcancel(t){this._map.fire(new uo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Vr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Vr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ho{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(u.P.convert(t),this._map.terrain)}}class Xl{constructor(t,a){this._map=t,this._tr=new ho(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(de.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=de.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(p.x,c.x),S=Math.max(p.x,c.x),C=Math.min(p.y,c.y),I=Math.max(p.y,c.y);de.setTransform(this._box,`translate(${b}px,${C}px)`),this._box.style.width=S-b+"px",this._box.style.height=I-C+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,p=a;if(this.reset(),de.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new u.l("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(c,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(de.remove(this._box),this._box=null),de.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new u.l(t,{originalEvent:a}))}}function Xa(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const a={};for(let c=0;c<y.length;c++)a[y[c].identifier]=t[c];return a}class qt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(p){const b=new u.P(0,0);for(const S of p)b._add(S);return b.div(p.length)})(a),this.touches=Xa(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const p=Xa(c,a);for(const b in this.touches){const S=p[b];(!S||S.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Wu{constructor(t){this.singleTap=new qt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const p=this.singleTap.touchend(t,a,c);if(p){const b=t.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(p)<30;if(b&&S||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Vh{constructor(t){this._tr=new ho(t),this._zoomIn=new Wu({numTouches:1,numTaps:2}),this._zoomOut=new Wu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const p=this._zoomIn.touchend(t,a,c),b=this._zoomOut.touchend(t,a,c),S=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(p)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bs{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=Array.isArray(a)?a[0]:a;return!this._moved&&p.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(c,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&de.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fo=0,fu=2,Zh={[fo]:1,[fu]:2};class qo{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=de.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,c){const p=Zh[c];return a.buttons===void 0||(a.buttons&p)!==p})(t,this._eventButton)}isValidEndEvent(t){return de.mouseButton(t)===this._eventButton}}class Ec{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Ku{constructor(t=new qo({checkCorrectEvent:()=>!0}),a=new Ec){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,c){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Go=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=t=>{t.preventDefault()}};class qh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const p=Xa(c,a),b=new u.P(0,0),S=new u.P(0,0);let C=0;for(const N in p){const U=p[N],$=this._touches[N];$&&(b._add(U),S._add(U.sub($)),C++,p[N]=U)}if(this._touches=p,this._shouldBePrevented(C)||!S.mag())return;const I=S.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[p,b]=this._firstTwoTouches,S=Ho(c,a,p),C=Ho(c,a,b);if(!S||!C)return;const I=this._aroundCenter?null:S.add(C).div(2);return this._move([S,C],I,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[p,b]=this._firstTwoTouches,S=Ho(c,a,p),C=Ho(c,a,b);S&&C||(this._active&&de.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ho(y,t,a){for(let c=0;c<y.length;c++)if(y[c].identifier===a)return t[c]}function Dd(y,t){return Math.log(y/t)/Math.LN2}class $o extends Qu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Dd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Dd(this._distance,c),pinchAround:a}}}function Gh(y,t){return 180*y.angleWith(t)/Math.PI}class Ju extends Qu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,c){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gh(this._vector,p),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=Gh(t,this._startVector);return Math.abs(c)<a}}function Xo(y){return Math.abs(y.y)>Math.abs(y.x)}class wl extends Qu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Xo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,b,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,b=a.mag()>=2;if(!p&&!b)return;if(!p||!b)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const S=t.y>0==a.y>0;return Xo(t)&&Xo(a)&&S}}const Ns={panStep:100,bearingStep:15,pitchStep:10};class _n{constructor(t){this._tr=new ho(t);const a=Ns;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,p=0,b=0,S=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),S=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:C=>{const I=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Id,zoom:a?Math.round(I.zoom)+a*(t.shiftKey?2:1):I.zoom,bearing:I.bearing+c*this._bearingStep,pitch:I.pitch+p*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:I.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Id(y){return y*(2-y)}const Tl=4.000244140625,Yl=1/450;class eh{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new ho(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Yl}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=be(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%Tl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=de.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(u.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const C=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Tl?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&I!==0&&(I=1/I);const N=typeof this._targetZoom!="number"?t.scale:u.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),u.at(N*I)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,p=this._easing;let b,S=!1;if(this._type==="wheel"&&c&&p){const C=be()-this._lastWheelEventTime,I=Math.min((C+5)/200,1),N=p(I);b=u.G.number(c,a,N),I<1?this._frameId||(this._frameId=!0):S=!0}else b=a,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!S,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=u.cy;if(this._prevEase){const c=this._prevEase,p=(be()-c.start)/c.duration,b=c.easing(p+.01)-c.easing(p),S=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-S*S);a=u.cw(S,C,.25,1)}return this._prevEase={start:be(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Hh{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mc{constructor(t){this._tr=new ho(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class th{constructor(){this._tap=new Wu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const p=a[0],b=t.timeStamp-this._tapTime<500,S=this._tapPoint.dist(p)<30;b&&S?c.length>0&&(this._swipePoint=p,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=a[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const p=this._tap.touchend(t,a,c);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ld{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ys{constructor(t,a,c,p){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ac{constructor(t,a,c,p){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Xt{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=de.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=a,this._container.appendChild(p);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=c,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(de.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new u.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ti=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class Fs extends u.l{}function pu(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class ih{constructor(t,a){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,b)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=p.type==="renderFrame"?void 0:p,C={needsRenderFrame:!1},I={},N={};for(const{handlerName:G,handler:K,allowed:ie}of this._handlers){if(!K.isEnabled())continue;let he;if(this._blockedByActive(N,ie,G))K.reset();else if(K[b||p.type]){if(u.cz(p,b||p.type)){const me=de.mousePos(this._map.getCanvas(),p);he=K[b||p.type](p,me)}else if(u.cA(p,b||p.type)){const me=this._getMapTouches(p.touches),pe=de.touchPos(this._map.getCanvas(),me);he=K[b||p.type](p,pe,me)}else u.cB(b||p.type)||(he=K[b||p.type](p));this.mergeHandlerResult(C,I,he,G,S),he&&he.needsRenderFrame&&this._triggerRenderFrame()}(he||K.isActive())&&(N[G]=K)}const U={};for(const G in this._previousActiveHandlers)N[G]||(U[G]=S);this._previousActiveHandlers=N,(Object.keys(U).length||pu(C))&&(this._changes.push([C,I,U]),this._triggerRenderFrame()),(Object.keys(N).length||pu(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=C;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wp(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,b,S]of this._listeners)de.addEventListener(p,b,p===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[t,a,c]of this._listeners)de.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new Uh(a,t));const p=a.boxZoom=new Xl(a,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const b=a.cooperativeGestures=new Xt(a,t.cooperativeGestures);this._add("cooperativeGestures",b),t.cooperativeGestures&&b.enable();const S=new Vh(a),C=new Mc(a);a.doubleClickZoom=new Hh(C,S),this._add("tapZoom",S),this._add("clickZoom",C),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const I=new th;this._add("tapDragZoom",I);const N=a.touchPitch=new wl(a);this._add("touchPitch",N),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const U=()=>a.project(a.getCenter()),$=(function({enable:ye,clickTolerance:Ee,aroundCenter:Le=!0,minPixelCenterThreshold:Te=100,rotateDegreesPerPixelMoved:Oe=.8},et){const Xe=new qo({checkCorrectEvent:We=>de.mouseButton(We)===0&&We.ctrlKey||de.mouseButton(We)===2&&!We.ctrlKey});return new Bs({clickTolerance:Ee,move:(We,Ke)=>{const zt=et();if(Le&&Math.abs(zt.y-We.y)>Te)return{bearingDelta:u.cx(new u.P(We.x,Ke.y),Ke,zt)};let kt=(Ke.x-We.x)*Oe;return Le&&Ke.y<zt.y&&(kt=-kt),{bearingDelta:kt}},moveStateManager:Xe,enable:ye,assignEvents:Go})})(t,U),G=(function({enable:ye,clickTolerance:Ee,pitchDegreesPerPixelMoved:Le=-.5}){const Te=new qo({checkCorrectEvent:Oe=>de.mouseButton(Oe)===0&&Oe.ctrlKey||de.mouseButton(Oe)===2});return new Bs({clickTolerance:Ee,move:(Oe,et)=>({pitchDelta:(et.y-Oe.y)*Le}),moveStateManager:Te,enable:ye,assignEvents:Go})})(t),K=(function({enable:ye,clickTolerance:Ee,rollDegreesPerPixelMoved:Le=.3},Te){const Oe=new qo({checkCorrectEvent:et=>de.mouseButton(et)===2&&et.ctrlKey});return new Bs({clickTolerance:Ee,move:(et,Xe)=>{const We=Te();let Ke=(Xe.x-et.x)*Le;return Xe.y<We.y&&(Ke=-Ke),{rollDelta:Ke}},moveStateManager:Oe,enable:ye,assignEvents:Go})})(t,U);a.dragRotate=new ys(t,$,G,K),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",G,["mouseRotate","mouseRoll"]),this._add("mouseRoll",K,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const ie=(function({enable:ye,clickTolerance:Ee}){const Le=new qo({checkCorrectEvent:Te=>de.mouseButton(Te)===0&&!Te.ctrlKey});return new Bs({clickTolerance:Ee,move:(Te,Oe)=>({around:Oe,panDelta:Oe.sub(Te)}),activateOnStart:!0,moveStateManager:Le,enable:ye,assignEvents:Go})})(t),he=new qh(t,a);a.dragPan=new Ld(c,ie,he),this._add("mousePan",ie),this._add("touchPan",he,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const me=new Ju,pe=new $o;a.touchZoomRotate=new Ac(c,pe,me,I),this._add("touchRotate",me,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Rf(a));const ve=a.scrollZoom=new eh(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ve,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const Me=a.keyboard=new _n(a);this._add("keyboard",Me),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ti(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const p in t)if(p!==c&&(!a||a.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,p,b){if(!c)return;u.e(t,c);const S={handlerName:p,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(a.zoom=S),c.panDelta!==void 0&&(a.drag=S),c.rollDelta!==void 0&&(a.roll=S),c.pitchDelta!==void 0&&(a.pitch=S),c.bearingDelta!==void 0&&(a.rotate=S)}_applyChanges(){const t={},a={},c={};for(const[p,b,S]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new u.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(t.rollDelta=(t.rollDelta||0)+p.rollDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),u.e(a,b),u.e(c,S);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const p=this._map,b=p._getTransformForUpdate(),S=p.terrain;if(!(pu(t)||S&&this._terrainMovement))return this._fireEvents(a,c,!0);p._stop(!0);let{panDelta:C,zoomDelta:I,bearingDelta:N,pitchDelta:U,rollDelta:$,around:G,pinchAround:K}=t;K!==void 0&&(G=K),G=G||p.transform.centerPoint,S&&!b.isPointOnMapSurface(G)&&(G=b.centerPoint);const ie={panDelta:C,zoomDelta:I,rollDelta:$,pitchDelta:U,bearingDelta:N,around:G};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(G)&&(G=b.centerPoint);const he=G.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(C?G.sub(C):G);this._handleMapControls({terrain:S,tr:b,deltasForHelper:ie,preZoomAroundLoc:he,combinedEventsInProgress:a,panDelta:C}),p._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:c,preZoomAroundLoc:p,combinedEventsInProgress:b,panDelta:S}){const C=this._map.cameraHelper;if(C.handleMapControlsRollPitchBearingZoom(c,a),t)return C.useGlobeControls?(this._terrainMovement||!b.drag&&!b.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void C.handleMapControlsPan(c,a,p)):this._terrainMovement||!b.drag&&!b.zoom?void(b.drag&&this._terrainMovement&&S?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(S))):C.handleMapControlsPan(c,a,p)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void C.handleMapControlsPan(c,a,p));C.handleMapControlsPan(c,a,p)}_fireEvents(t,a,c){const p=ti(this._eventsInProgress),b=ti(t),S={};for(const $ in t){const{originalEvent:G}=t[$];this._eventsInProgress[$]||(S[`${$}start`]=G),this._eventsInProgress[$]=t[$]}!p&&b&&this._fireEvent("movestart",b.originalEvent);for(const $ in S)this._fireEvent($,S[$]);b&&this._fireEvent("move",b.originalEvent);for(const $ in t){const{originalEvent:G}=t[$];this._fireEvent($,G)}const C={};let I;for(const $ in this._eventsInProgress){const{handlerName:G,originalEvent:K}=this._eventsInProgress[$];this._handlersById[G].isActive()||(delete this._eventsInProgress[$],I=a[G]||K,C[`${$}end`]=I)}for(const $ in C)this._fireEvent($,C[$]);const N=ti(this._eventsInProgress),U=(p||b)&&!N;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const $=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&$.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform($)}if(c&&U){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;!$||!$.essential&&Pe.prefersReducedMotion?(this._map.fire(new u.l("moveend",{originalEvent:I})),G(this._map.getBearing())&&this._map.resetNorth()):(G($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new u.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Fs("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class gr extends u.E{constructor(t,a,c){super(),this._renderFrameCallback=()=>{const p=Math.min((be()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new u.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,c){return t=u.P.convert(t).mult(-1),this.panTo(this.transform.center,u.e({offset:t},a),c)}panTo(t,a,c){return this.easeTo(u.e({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(u.e({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new u.l("movestart",a)).fire(new u.l("move",a)).fire(new u.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(u.e({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,u.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=ln.convert(t).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,p){const b={top:0,bottom:0,right:0,left:0};if(typeof(p=u.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const N=p.padding;p.padding={top:N,bottom:N,right:N,left:N}}const S=u.e(b,p.padding);p.padding=S;const C=this.transform,I=new ln(t,a);return this.cameraHelper.cameraForBoxAndBearing(p,S,I,c,C)}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,p,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(t)),this.transform.screenPointToLocation(u.P.convert(a)),c,p),p,b)}_fitInternal(t,a,c){return t?(delete(a=u.e(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let p=!1,b=!1,S=!1;const C=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const I=c.zoom!==C;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(p=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(b=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(S=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new u.l("movestart",a)).fire(new u.l("move",a)),I&&this.fire(new u.l("zoomstart",a)).fire(new u.l("zoom",a)).fire(new u.l("zoomend",a)),p&&this.fire(new u.l("rotatestart",a)).fire(new u.l("rotate",a)).fire(new u.l("rotateend",a)),b&&this.fire(new u.l("pitchstart",a)).fire(new u.l("pitch",a)).fire(new u.l("pitchend",a)),S&&this.fire(new u.l("rollstart",a)).fire(new u.l("roll",a)).fire(new u.l("rollend",a)),this.fire(new u.l("moveend",a))}calculateCameraOptionsFromTo(t,a,c,p=0){const b=u.a9.fromLngLat(t,a),S=u.a9.fromLngLat(c,p),C=S.x-b.x,I=S.y-b.y,N=S.z-b.z,U=Math.hypot(C,I,N);if(U===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(C,I),G=u.at(this.transform.cameraToCenterDistance/U/this.transform.tileSize),K=180*Math.atan2(C,-I)/Math.PI;let ie=180*Math.acos($/U)/Math.PI;return ie=N<0?90-ie:90+ie,{center:S.toLngLat(),elevation:p,zoom:G,pitch:ie,bearing:K}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,c,p,b){const S=this.transform.calculateCenterFromCameraLngLatAlt(t,a,c,p);return{center:S.center,elevation:S.elevation,zoom:S.zoom,bearing:c,pitch:p,roll:b}}easeTo(t,a){this._stop(!1,t.easeId),((t=u.e({offset:[0,0],duration:500,easing:u.cy},t)).animate===!1||!t.essential&&Pe.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),p=this.getBearing(),b=c.pitch,S=c.roll,C="bearing"in t?this._normalizeBearing(t.bearing,p):p,I="pitch"in t?+t.pitch:b,N="roll"in t?this._normalizeBearing(t.roll,S):S,U="padding"in t?t.padding:c.padding,$=u.P.convert(t.offset);let G,K;t.around&&(G=u.V.convert(t.around),K=c.locationToScreenPoint(G));const ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},he=this.cameraHelper.handleEaseTo(c,{bearing:C,pitch:I,roll:N,padding:U,around:G,aroundPoint:K,offsetAsPoint:$,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||p!==C,this._pitching=this._pitching||I!==b,this._rolling=this._rolling||N!==S,this._padding=!c.isPaddingEqual(U),this._zooming=this._zooming||he.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ie),this.terrain&&this._prepareElevation(he.elevationCenter),this._ease((me=>{he.easeFunc(me),this.terrain&&!t.freezeElevation&&this._updateElevation(me),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(me=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,me)}),t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new u.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new u.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new u.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new u.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new u.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(u.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),c=t.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(c<p){const b=this.calculateCameraOptionsFromTo(a,p,t.center,t.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&a.push((p=>this.transformCameraUpdate(p))),!a.length)return;const c=t.clone();for(const p of a){const b=c.clone(),{center:S,zoom:C,roll:I,pitch:N,bearing:U,elevation:$}=p(b);S&&b.setCenter(S),$!==void 0&&b.setElevation($),C!==void 0&&b.setZoom(C),I!==void 0&&b.setRoll(I),N!==void 0&&b.setPitch(N),U!==void 0&&b.setBearing(U),c.apply(b)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new u.l("move",t)),this._zooming&&this.fire(new u.l("zoom",t)),this._rotating&&this.fire(new u.l("rotate",t)),this._pitching&&this.fire(new u.l("pitch",t)),this._rolling&&this.fire(new u.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,p=this._rotating,b=this._pitching,S=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new u.l("zoomend",t)),p&&this.fire(new u.l("rotateend",t)),b&&this.fire(new u.l("pitchend",t)),S&&this.fire(new u.l("rollend",t)),this.fire(new u.l("moveend",t))}flyTo(t,a){if(!t.essential&&Pe.prefersReducedMotion){const Ke=u.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ke,a)}this.stop(),t=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.cy},t);const c=this._getTransformForUpdate(),p=c.bearing,b=c.pitch,S=c.roll,C=c.padding,I="bearing"in t?this._normalizeBearing(t.bearing,p):p,N="pitch"in t?+t.pitch:b,U="roll"in t?this._normalizeBearing(t.roll,S):S,$="padding"in t?t.padding:c.padding,G=u.P.convert(t.offset);let K=c.centerPoint.add(G);const ie=c.screenPointToLocation(K),he=this.cameraHelper.handleFlyTo(c,{bearing:I,pitch:N,roll:U,padding:$,locationAtOffset:ie,offsetAsPoint:G,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let me=t.curve;const pe=Math.max(c.width,c.height),ve=pe/he.scaleOfZoom,Me=he.pixelPathLength;typeof he.scaleOfMinZoom=="number"&&(me=Math.sqrt(pe/he.scaleOfMinZoom/Me*2));const ye=me*me;function Ee(Ke){const zt=(ve*ve-pe*pe+(Ke?-1:1)*ye*ye*Me*Me)/(2*(Ke?ve:pe)*ye*Me);return Math.log(Math.sqrt(zt*zt+1)-zt)}function Le(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function Te(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const Oe=Ee(!1);let et=function(Ke){return Te(Oe)/Te(Oe+me*Ke)},Xe=function(Ke){return pe*((Te(Oe)*(Le(zt=Oe+me*Ke)/Te(zt))-Le(Oe))/ye)/Me;var zt},We=(Ee(!0)-Oe)/me;if(Math.abs(Me)<2e-6||!isFinite(We)){if(Math.abs(pe-ve)<1e-6)return this.easeTo(t,a);const Ke=ve<pe?-1:1;We=Math.abs(Math.log(ve/pe))/me,Xe=()=>0,et=zt=>Math.exp(Ke*me*zt)}return t.duration="duration"in t?+t.duration:1e3*We/("screenSpeed"in t?+t.screenSpeed/me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==I,this._pitching=N!==b,this._rolling=U!==S,this._padding=!c.isPaddingEqual($),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(he.targetCenter),this._ease((Ke=>{const zt=Ke*We,kt=1/et(zt),xt=Xe(zt);this._rotating&&c.setBearing(u.G.number(p,I,Ke)),this._pitching&&c.setPitch(u.G.number(b,N,Ke)),this._rolling&&c.setRoll(u.G.number(S,U,Ke)),this._padding&&(c.interpolatePadding(C,$,Ke),K=c.centerPoint.add(G)),he.easeFunc(Ke,kt,xt,K),this.terrain&&!t.freezeElevation&&this._updateElevation(Ke),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,a)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=be(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=u.W(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(u.V.convert(t),this.transform):null}}const ir={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class cr{constructor(t=ir){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=de.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=de.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=de.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){de.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const a=this._map.style.tileManagers;for(const p in a){const b=a[p];if(b.used||b.usedForTerrain){const S=b.getSource();S.attribution&&t.indexOf(S.attribution)<0&&t.push(S.attribution)}}t=t.filter((p=>String(p).trim())),t.sort(((p,b)=>p.length-b.length)),t=t.filter(((p,b)=>{for(let S=b+1;S<t.length;S++)if(t[S].indexOf(p)>=0)return!1;return!0}));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=de.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class nh{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=de.create("div","maplibregl-ctrl");const a=de.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){de.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const p of c)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ki=u.aU([{name:"a_pos3d",type:"Int16",components:3}]);class fn extends u.E{constructor(t){super(),this._lastTilesetChange=be(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const c={};for(const p of Ln(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),u.c7(p.terrainRttPosMatrix32f,0,u.a5,u.a5,0,0,1),this._tiles[p.key]=new gt(p,this.tileSize),this._lastTilesetChange=be());for(const p in this._tiles)c[p]||delete this._tiles[p]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID,b=t.clone(),S=u.bk();if(p.canonical.equals(t.canonical))u.c7(S,0,u.a5,u.a5,0,0,1);else if(p.canonical.isChildOf(t.canonical)){const C=p.canonical.z-t.canonical.z,I=p.canonical.x-(p.canonical.x>>C<<C),N=p.canonical.y-(p.canonical.y>>C<<C),U=u.a5>>C;u.c7(S,0,U,U,0,0,1),u.O(S,S,[-I*U,-N*U,0])}else{if(!t.canonical.isChildOf(p.canonical))continue;{const C=t.canonical.z-p.canonical.z,I=t.canonical.x-(t.canonical.x>>C<<C),N=t.canonical.y-(t.canonical.y>>C<<C),U=u.a5>>C;u.c7(S,0,u.a5,u.a5,0,0,1),u.O(S,S,[I*U,N*U,0]),u.Q(S,S,[1/2**C,1/2**C,0])}}b.terrainRttPosMatrix32f=new Float32Array(S),a[c]=b}return a}_getTerrainCoordsForTileRanges(t,a){const c={};for(const p of this._renderableTilesKeys){const b=this._tiles[p].tileID;if(!this._isWithinTileRanges(b,a))continue;const S=t.clone(),C=u.bk();if(b.canonical.z===t.canonical.z){const I=t.canonical.x-b.canonical.x,N=t.canonical.y-b.canonical.y;u.c7(C,0,u.a5,u.a5,0,0,1),u.O(C,C,[I*u.a5,N*u.a5,0])}else if(b.canonical.z>t.canonical.z){const I=b.canonical.z-t.canonical.z,N=b.canonical.x-(b.canonical.x>>I<<I),U=b.canonical.y-(b.canonical.y>>I<<I),$=t.canonical.x-(b.canonical.x>>I),G=t.canonical.y-(b.canonical.y>>I),K=u.a5>>I;u.c7(C,0,K,K,0,0,1),u.O(C,C,[-N*K+$*u.a5,-U*K+G*u.a5,0])}else{const I=t.canonical.z-b.canonical.z,N=t.canonical.x-(t.canonical.x>>I<<I),U=t.canonical.y-(t.canonical.y>>I<<I),$=(t.canonical.x>>I)-b.canonical.x,G=(t.canonical.y>>I)-b.canonical.y,K=u.a5<<I;u.c7(C,0,K,K,0,0,1),u.O(C,C,[N*u.a5+$*K,U*u.a5+G*K,0])}S.terrainRttPosMatrix32f=new Float32Array(C),c[p]=S}return c}getSourceTile(t,a){const c=this.tileManager._source;let p=t.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let b=this.findTileInCaches(this._sourceTileCache[t.key]);if(!b?.dem&&a)for(;p>=c.minzoom&&!b?.dem;)b=this.findTileInCaches(t.scaledTo(p--).key);return b}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class zi{constructor(t,a,c){this._meshCache={},this.painter=t,this.tileManager=new fn(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,p=u.a5){var b;if(!(a>=0&&a<p&&c>=0&&c<p))return 0;const S=this.getTerrainData(t),C=(b=S.tile)===null||b===void 0?void 0:b.dem;if(!C)return 0;const I=u.cC([],[a/p*u.a5,c/p*u.a5],S.u_terrain_matrix),N=[I[0]*C.dim,I[1]*C.dim],U=Math.floor(N[0]),$=Math.floor(N[1]),G=N[0]-U,K=N[1]-$;return C.get(U,$)*(1-G)*(1-K)+C.get(U+1,$)*G*(1-K)+C.get(U,$+1)*(1-G)*K+C.get(U+1,$+1)*G*K}getElevationForLngLatZoom(t,a){if(!u.cD(a,t.wrap()))return 0;const{tileID:c,mercatorX:p,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,p%u.a5,b%u.a5,u.a5)}getElevationForLngLat(t,a){const c=Ln(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let p=0;for(const b of c)b.canonical.z>p&&(p=Math.min(b.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,p)}getElevation(t,a,c,p=u.a5){return this.getDEMElevation(t,a,c,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,b=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new u.T(p,b,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new u.T(p,new u.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const p=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new u.T(p,a.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),a.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a.toString()+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const p=this.tileManager.getSource().maxzoom;let b=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?b=t.canonical.z-p:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=t.canonical.x-(t.canonical.x>>b<<b),C=t.canonical.y-(t.canonical.y>>b<<b),I=u.cE(new Float64Array(16),[1/(u.a5<<b),1/(u.a5<<b),0]);u.O(I,I,[S*u.a5,C*u.a5,0]),this._demMatrixCache[t.key]={matrix:I,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,p=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new u.T(a.context,{width:c,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new u.T(a.context,{width:c,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,p,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,S=0;b<this._coordsTextureSize;b++)for(let C=0;C<this._coordsTextureSize;C++,S+=4)a[S+0]=255&C,a[S+1]=255&b,a[S+2]=C>>8<<4|b>>8,a[S+3]=0;const c=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),p=new u.T(t,c,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,p=c.gl,b=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(b,C-S-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const I=a[0]+(a[2]>>4<<8),N=a[1]+((15&a[2])<<8),U=this.coordsIndex[255-a[3]],$=U&&this.tileManager.getTileByID(U);if(!$)return null;const G=this._coordsTextureSize,K=(1<<$.tileID.canonical.z)*G;return new u.a9(($.tileID.canonical.x*G+I)/K+$.tileID.wrap,($.tileID.canonical.y*G+N)/K,this.getElevation($.tileID,I,N,G))}depthAtPoint(t){const a=new Uint8Array(4),c=this.painter.context,p=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,p=c&&t.canonical.y===0,b=c&&t.canonical.y===(1<<t.canonical.z)-1,S=`m_${p?"n":""}_${b?"s":""}`;if(this._meshCache[S])return this._meshCache[S];const C=this.painter.context,I=new u.cF,N=new u.aY,U=this.meshSize,$=u.a5/U,G=U*U;for(let Te=0;Te<=U;Te++)for(let Oe=0;Oe<=U;Oe++)I.emplaceBack(Oe*$,Te*$,0);for(let Te=0;Te<G;Te+=U+1)for(let Oe=0;Oe<U;Oe++)N.emplaceBack(Oe+Te,U+Oe+Te+1,U+Oe+Te+2),N.emplaceBack(Oe+Te,U+Oe+Te+2,Oe+Te+1);const K=I.length,ie=K+(U+1),he=(U+1)*U,me=p?u.br:0,pe=p?0:1,ve=b?u.bs:u.a5,Me=b?0:1;for(let Te=0;Te<=U;Te++)I.emplaceBack(Te*$,me,pe);for(let Te=0;Te<=U;Te++)I.emplaceBack(Te*$,ve,Me);for(let Te=0;Te<U;Te++)N.emplaceBack(he+Te,ie+Te,ie+Te+1),N.emplaceBack(he+Te,ie+Te+1,he+Te+1),N.emplaceBack(0+Te,K+Te+1,K+Te),N.emplaceBack(0+Te,0+Te+1,K+Te+1);const ye=I.length,Ee=ye+2*(U+1);for(const Te of[0,1])for(let Oe=0;Oe<=U;Oe++)for(const et of[0,1])I.emplaceBack(Te*u.a5,Oe*$,et);for(let Te=0;Te<2*U;Te+=2)N.emplaceBack(ye+Te,ye+Te+1,ye+Te+3),N.emplaceBack(ye+Te,ye+Te+3,ye+Te+2),N.emplaceBack(Ee+Te,Ee+Te+3,Ee+Te+1),N.emplaceBack(Ee+Te,Ee+Te+2,Ee+Te+3);const Le=new hn(C.createVertexBuffer(I,ki.members),C.createIndexBuffer(N),u.aX.simpleSegment(0,0,I.length,N.length));return this._meshCache[S]=Le,Le}getMeshFrameDelta(t){return 2*Math.PI*u.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var c;if(!u.cD(a,t.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(p).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=u.a9.fromLngLat(t.wrap()),p=(1<<a)*u.a5,b=c.x*p,S=c.y*p,C=Math.floor(b/u.a5),I=Math.floor(S/u.a5);return{tileID:new u.a2(a,0,a,C,I),mercatorX:b,mercatorY:S}}}class Yn{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new u.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const js={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class po{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Yn(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((c=>!t._layers[c].isHidden(a))),this._coordsAscending={};for(const c in t.tileManagers){this._coordsAscending[c]={};const p=t.tileManagers[c].getVisibleCoordinates(),b=t.tileManagers[c].getSource(),S=b instanceof cn?b.terrainTileRanges:null;for(const C of p){const I=this.terrain.tileManager.getTerrainCoords(C,S);for(const N in I)this._coordsAscending[c][N]||(this._coordsAscending[c][N]=[]),this._coordsAscending[c][N].push(I[N])}}this._coordsAscendingStr={};for(const c of t._order){const p=t._layers[c],b=p.source;if(js[p.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const S in this._coordsAscending[b])this._coordsAscendingStr[b][S]=this._coordsAscending[b][S].map((C=>C.key)).sort().join()}}for(const c of this._renderableTiles)for(const p in this._coordsAscendingStr){const b=this._coordsAscendingStr[p][c.tileID.key];b&&b!==c.rttCoords[p]&&(c.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),p=t.type,b=this.painter,S=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(js[p]&&(this._prevType&&js[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(t.id),!S))return!0;if(js[this._prevType]||js[p]&&S){this._prevType=p;const C=this._stacks.length-1,I=this._stacks[C]||[];for(const N of this._renderableTiles){if(this.pool.isFull()&&(Fh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(N),N.rtt[C]){const $=this.pool.getObjectForId(N.rtt[C].id);if($.stamp===N.rtt[C].stamp){this.pool.useObject($);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),N.rtt[C]={id:U.id,stamp:U.stamp},b.context.bindFramebuffer.set(U.fbo.framebuffer),b.context.clear({color:u.bp.transparent,stencil:0}),b.currentStencilSource=void 0;for(let $=0;$<I.length;$++){const G=b.style._layers[I[$]],K=G.source?this._coordsAscending[G.source][N.tileID.key]:[N.tileID];b.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),b._renderTileClippingMasks(G,K,!0),b.renderLayer(b,b.style.tileManagers[G.source],G,K,c),G.source&&(N.rttCoords[G.source]=this._coordsAscendingStr[G.source][N.tileID.key])}}return Fh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),js[p]}return!1}}const Cc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Pc=V,El={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ir,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},kd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Vn{constructor(t,a,c=!1){this.mousedown=b=>{this.startMove(b,de.mousePos(this.element,b)),de.addEventListener(window,"mousemove",this.mousemove),de.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,de.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHandler.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=de.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),de.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),de.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=de.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const p=new Ku;this._rotatePitchHandler=new Bs({clickTolerance:3,move:(b,S)=>{const C=a.getBoundingClientRect(),I=new u.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:u.cx(new u.P(b.x,S.y),S,I),pitchDelta:c?-.5*(S.y-b.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=t,de.addEventListener(a,"mousedown",this.mousedown),de.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),de.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),de.disableDrag()}move(t,a){const c=this.map,{bearingDelta:p,pitchDelta:b}=this._rotatePitchHandler.dragMove(t,a)||{};p&&c.setBearing(c.getBearing()+p),b&&c.setPitch(c.getPitch()+b)}off(){const t=this.element;de.removeEventListener(t,"mousedown",this.mousedown),de.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),de.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),de.removeEventListener(window,"touchend",this.touchend),de.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){de.enableDrag(),de.removeEventListener(window,"mousemove",this.mousemove),de.removeEventListener(window,"mouseup",this.mouseup),de.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),de.removeEventListener(window,"touchend",this.touchend)}}let mo;function mu(y,t,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return y?.wrap();const p=new u.V(y.lng,y.lat);if(y=new u.V(y.lng,y.lat),t){const b=new u.V(y.lng-360,y.lat),S=new u.V(y.lng+360,y.lat),C=a.locationToScreenPoint(y).distSqr(t);a.locationToScreenPoint(b).distSqr(t)<C?y=b:a.locationToScreenPoint(S).distSqr(t)<C&&(y=S)}for(;Math.abs(y.lng-a.center.lng)>180;){const b=a.locationToScreenPoint(y);if(b.x>=0&&b.y>=0&&b.x<=a.width&&b.y<=a.height)break;y.lng>a.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(y))?y:p}const gu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rh(y,t,a){const c=y.classList;for(const p in gu)c.remove(`maplibregl-${a}-anchor-${p}`);c.add(`maplibregl-${a}-anchor-${t}`)}class ah extends u.E{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,p=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=mu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),de.setTransform(this._element,`${gu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${p}`),Pe.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.l("dragstart"))),this.fire(new u.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=u.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=de.create("div");const a=de.createNS("http://www.w3.org/2000/svg","svg"),c=41,p=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${p}px`),a.setAttributeNS(null,"viewBox",`0 0 ${p} ${c}`);const b=de.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const S=de.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const C=de.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pe of I){const ve=de.createNS("http://www.w3.org/2000/svg","ellipse");ve.setAttributeNS(null,"opacity","0.04"),ve.setAttributeNS(null,"cx","10.5"),ve.setAttributeNS(null,"cy","5.80029008"),ve.setAttributeNS(null,"rx",pe.rx),ve.setAttributeNS(null,"ry",pe.ry),C.appendChild(ve)}const N=de.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);const U=de.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(U);const $=de.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const G=de.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(G);const K=de.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(6.0, 7.0)"),K.setAttributeNS(null,"fill","#FFFFFF");const ie=de.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(8.0, 8.0)");const he=de.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#000000"),he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962");const me=de.createNS("http://www.w3.org/2000/svg","circle");me.setAttributeNS(null,"fill","#FFFFFF"),me.setAttributeNS(null,"cx","5.5"),me.setAttributeNS(null,"cy","5.5"),me.setAttributeNS(null,"r","5.4999962"),ie.appendChild(he),ie.appendChild(me),S.appendChild(C),S.appendChild(N),S.appendChild($),S.appendChild(K),S.appendChild(ie),a.appendChild(S),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(a),this._offset=u.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),rh(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),de.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,c;const p=(a=this._map)===null||a===void 0?void 0:a.terrain,b=this._map.transform.isLocationOccluded(this._lngLat);if(!p||b){const K=b?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==K&&(this._element.style.opacity=K))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const S=this._map,C=S.terrain.depthAtPoint(this._pos),I=S.terrain.getElevationForLngLat(this._lngLat,S.transform);if(S.transform.lngLatToCameraDepth(this._lngLat,I)-C<.006)return void(this._element.style.opacity=this._opacity);const N=-this._offset.y/S.transform.pixelsPerMeter,U=Math.sin(S.getPitch()*Math.PI/180)*N,$=S.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),G=S.transform.lngLatToCameraDepth(this._lngLat,I+U)-$>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&G&&this._popup.remove(),this._element.style.opacity=G?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=u.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const sh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wl=0,Ml=!1;const ca={maxWidth:100,unit:"metric"};function Wn(y,t,a){const c=a&&a.maxWidth||100,p=y._container.clientHeight/2,b=y._container.clientWidth/2,S=y.unproject([b-c/2,p]),C=y.unproject([b+c/2,p]),I=Math.round(y.project(C).x-y.project(S).x),N=Math.min(c,I,y._container.clientWidth),U=S.distanceTo(C);if(a&&a.unit==="imperial"){const $=3.2808*U;$>5280?Yo(t,N,$/5280,y._getUIString("ScaleControl.Miles")):Yo(t,N,$,y._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Yo(t,N,U/1852,y._getUIString("ScaleControl.NauticalMiles")):U>=1e3?Yo(t,N,U/1e3,y._getUIString("ScaleControl.Kilometers")):Yo(t,N,U,y._getUIString("ScaleControl.Meters"))}function Yo(y,t,a,c){const p=(function(b){const S=Math.pow(10,`${Math.floor(b)}`.length-1);let C=b/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:(function(I){const N=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*N)/N})(C),S*C})(a);y.style.width=t*(p/a)+"px",y.innerHTML=`${p}&nbsp;${c}`}const zc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Dc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _u(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,y),"top-left":new u.P(t,t),"top-right":new u.P(-t,t),bottom:new u.P(0,-y),"bottom-left":new u.P(t,-t),"bottom-right":new u.P(-t,-t),left:new u.P(y,0),right:new u.P(-y,0)}}if(y instanceof u.P||Array.isArray(y)){const t=u.P.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.P.convert(y.center||[0,0]),top:u.P.convert(y.top||[0,0]),"top-left":u.P.convert(y["top-left"]||[0,0]),"top-right":u.P.convert(y["top-right"]||[0,0]),bottom:u.P.convert(y.bottom||[0,0]),"bottom-left":u.P.convert(y["bottom-left"]||[0,0]),"bottom-right":u.P.convert(y["bottom-right"]||[0,0]),left:u.P.convert(y.left||[0,0]),right:u.P.convert(y.right||[0,0])}}return _u(new u.P(0,0))}const go=V;D.AJAXError=u.cI,D.Event=u.l,D.Evented=u.E,D.LngLat=u.V,D.MercatorCoordinate=u.a9,D.Point=u.P,D.addProtocol=u.cJ,D.config=u.c,D.removeProtocol=u.cK,D.AttributionControl=cr,D.BoxZoomHandler=Xl,D.CanvasSource=Q,D.CooperativeGesturesHandler=Xt,D.DoubleClickZoomHandler=Hh,D.DragPanHandler=Ld,D.DragRotateHandler=ys,D.EdgeInsets=ra,D.FullscreenControl=class extends u.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){de.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=de.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);de.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},D.GeoJSONSource=Ei,D.GeolocateControl=class extends u.E{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new u.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new u.V(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,p=this._map.getBearing(),b=u.e({bearing:p},this.options.fitBoundsOptions),S=ln.fromLngLat(a,c);this._map.fitBounds(S,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new u.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ml)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=de.create("button","maplibregl-ctrl-geolocate",this._container),de.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=de.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ah({element:this._dotElement}),this._circleElement=de.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ah({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.l("trackuserlocationend")),this.fire(new u.l("userlocationlostfocus")))}))}},this.options=u.e({},sh,y)}onAdd(y){return this._map=y,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return u._(this,arguments,void 0,(function*(t=!1){if(mo!==void 0&&!t)return mo;if(window.navigator.permissions===void 0)return mo=!!window.navigator.geolocation,mo;try{mo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{mo=!!window.navigator.geolocation}return mo}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),de.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Wl=0,Ml=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),a=y.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const y=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&y))return;const t=this._map.project(y),a=this._map.unproject([t.x+100,t.y]),c=y.distanceTo(a)/100,p=2*this._accuracy/c;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wl--,Ml=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.l("trackuserlocationstart")),this.fire(new u.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wl++,Wl>1?(y={maximumAge:6e5,timeout:0},Ml=!0):(y=this.options.positionOptions,Ml=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},D.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const t=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=de.create("button","maplibregl-ctrl-globe",this._container),de.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){de.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},D.Hash=mr,D.ImageSource=cn,D.KeyboardHandler=_n,D.LngLatBounds=ln,D.LogoControl=nh,D.Map=class extends gr{constructor(y){var t,a;u.cG.mark(u.cH.create);const c=Object.assign(Object.assign(Object.assign({},El),y),{canvasContextAttributes:Object.assign(Object.assign({},El.canvasContextAttributes),y.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new or,b=new Ii;if(c.minZoom!==void 0&&p.setMinZoom(c.minZoom),c.maxZoom!==void 0&&p.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&p.setMinPitch(c.minPitch),c.maxPitch!==void 0&&p.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&p.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&p.setConstrainOverride(c.transformConstrain),super(p,b,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Sl,this._controls=[],this._mapId=u.af(),this._lostContextStyle={style:null,images:null},this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const I of Object.values(this.style._layers))if(I.type==="custom"&&console.warn(`Custom layer with id '${I.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),I._listeners)for(const[N]of Object.entries(I._listeners))console.warn(`Custom layer with id '${I.id}' had event listeners for event '${N}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new u.l("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new u.l("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Cc),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(Pe.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=rt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ct(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1;const I=zd((N=>{this._trackResize&&!this._removed&&(this.resize(N),this.redraw())}),50);this._resizeObserver=new ResizeObserver((N=>{C?I(N):C=!0})),this._resizeObserver.observe(this._container)}this.handlers=new ih(this,c),this._hash=c.hash&&new mr(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,u.e({},c.fitBoundsOptions,{duration:0}))));const S=typeof c.style=="string"||((a=(t=c.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,S),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new cr(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new nh,c.logoPosition),this.on("style.load",(()=>{if(S||this._resizeTransform(),this.transform.unmodified){const C=u.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}})),this.on("data",(C=>{this._update(C.dataType==="style"),this.fire(new u.l(`${C.dataType}data`,C))})),this.on("dataloading",(C=>{this.fire(new u.l(`${C.dataType}dataloading`,C))})),this.on("dataabort",(C=>{this.fire(new u.l("sourcedataabort",C))}))}_getMapId(){return this._mapId}setGlobalStateProperty(y,t){return this.style.setGlobalStateProperty(y,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new u.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=y.onAdd(this);this._controls.push(y);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new u.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}coveringTiles(y){return Ln(this.transform,y)}calculateCameraOptionsFromTo(y,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(y,t,a,c)}resize(y,t=!0){const[a,c]=this._containerDimensions(),p=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,p),this.painter.resize(a,c,p),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const C=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,C),this.painter.resize(a,c,C)}this._resizeTransform(t);const b=!this._moving;return b&&(this.stop(),this.fire(new u.l("movestart",y)).fire(new u.l("move",y))),this.fire(new u.l("resize",y)),b&&this.fire(new u.l("moveend",y)),this}_resizeTransform(y=!0){var t;const[a,c]=this._containerDimensions();this.transform.resize(a,c,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c,y)}_getClampedPixelRatio(y,t){const{0:a,1:c}=this._maxCanvasSize,p=this.getPixelRatio(),b=y*p,S=t*p;return Math.min(b>a?a/b:1,S>c?c/S:1)*p}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(ln.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.setMinPitch(y),this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch)return this.transform.setMaxPitch(y),this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}setTransformConstrain(y){return this.transform.setConstrainOverride(y),this._update()}project(y){return this.transform.locationToScreenPoint(u.V.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(u.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,a){if(y==="mouseenter"||y==="mouseover"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:b=>{const S=t.filter((I=>this.getLayer(I))),C=S.length!==0?this.queryRenderedFeatures(b.point,{layers:S}):[];C.length?c||(c=!0,a.call(this,new Vr(y,this,b.originalEvent,{features:C}))):c=!1},mouseout:()=>{c=!1}}}}if(y==="mouseleave"||y==="mouseout"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:S=>{const C=t.filter((I=>this.getLayer(I)));(C.length!==0?this.queryRenderedFeatures(S.point,{layers:C}):[]).length?c=!0:c&&(c=!1,a.call(this,new Vr(y,this,S.originalEvent)))},mouseout:S=>{c&&(c=!1,a.call(this,new Vr(y,this,S.originalEvent)))}}}}{const c=p=>{const b=t.filter((C=>this.getLayer(C))),S=b.length!==0?this.queryRenderedFeatures(p.point,{layers:b}):[];S.length&&(p.features=S,a.call(this,p),delete p.features)};return{layers:t,listener:a,delegates:{[y]:c}}}}_saveDelegatedListener(y,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(t)}_removeDelegatedListener(y,t,a){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const c=this._delegatedListeners[y];for(let p=0;p<c.length;p++){const b=c[p];if(b.listener===a&&b.layers.length===t.length&&b.layers.every((S=>t.includes(S)))){for(const S in b.delegates)this.off(S,b.delegates[S]);return void c.splice(p,1)}}}on(y,t,a){if(a===void 0)return super.on(y,t);const c=typeof t=="string"?[t]:t,p=this._createDelegatedListener(y,c,a);this._saveDelegatedListener(y,p);for(const b in p.delegates)this.on(b,p.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(y,c,a)}}}once(y,t,a){if(a===void 0)return super.once(y,t);const c=typeof t=="string"?[t]:t,p=this._createDelegatedListener(y,c,a);for(const b in p.delegates){const S=p.delegates[b];p.delegates[b]=(...C)=>{this._removeDelegatedListener(y,c,a),S(...C)}}this._saveDelegatedListener(y,p);for(const b in p.delegates)this.once(b,p.delegates[b]);return this}off(y,t,a){return a===void 0?super.off(y,t):(this._removeDelegatedListener(y,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let a;const c=y instanceof u.P||Array.isArray(y),p=c?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:y)||{},p instanceof u.P||typeof p[0]=="number")a=[u.P.convert(p)];else{const b=u.P.convert(p[0]),S=u.P.convert(p[1]);a=[b,new u.P(S.x,b.y),S,new u.P(b.x,S.y),b]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){var a,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(y,t)));const p=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Ds(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,p):this.style.loadJSON(y,t,p),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const a=this._requestManager.transformRequest(y,"Style");u.j(a,new AbortController).then((c=>{this._updateDiff(c.data,t)})).catch((c=>{c&&this.fire(new u.k(c))}))}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(a){u.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.tileManagers[y];if(t!==void 0)return t.loaded();this.fire(new u.k(new Error(`There is no tile manager with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.tileManagers[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===y.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===y.source&&u.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zi(this.painter,t,y),this.painter.renderToTexture=new po(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.l("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.tileManagers;for(const t of Object.values(y))if(!t.areTilesLoaded())return!1;return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}setSourceTileLodParams(y,t,a){if(a){const c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=Ki(Math.max(1,y),Math.max(1,t))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=Ki(Math.max(1,y),Math.max(1,t));return this._update(!0),this}refreshTiles(y,t){const a=this.style.tileManagers[y];if(!a)throw new Error(`There is no tile manager with ID "${y}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((c=>new u.ac(c.z,c.x,c.y))))}addImage(y,t,a={}){const{pixelRatio:c=1,sdf:p=!1,stretchX:b,stretchY:S,content:C,textFitWidth:I,textFitHeight:N}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||u.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:$,data:G}=t,K=t;return this.style.addImage(y,{data:new u.R({width:U,height:$},new Uint8Array(G)),pixelRatio:c,stretchX:b,stretchY:S,content:C,textFitWidth:I,textFitHeight:N,sdf:p,version:0,userImage:K}),K.onAdd&&K.onAdd(this,y),this}}{const{width:U,height:$,data:G}=Pe.getImageData(t);this.style.addImage(y,{data:new u.R({width:U,height:$},G),pixelRatio:c,stretchX:b,stretchY:S,content:C,textFitWidth:I,textFitHeight:N,sdf:p,version:0})}}updateImage(y,t){const a=this.style.getImage(y);if(!a)return this.fire(new u.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||u.b(t)?Pe.getImageData(t):t,{width:p,height:b,data:S}=c;if(p===void 0||b===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==a.data.width||b!==a.data.height)return this.fire(new u.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(t instanceof HTMLImageElement||u.b(t));return a.data.replace(S,C),this.style.updateImage(y,a),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new u.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return rt.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,t,a){return this.style.setLayerZoomRange(y,t,a),this._update(!0)}setFilter(y,t,a={}){return this.style.setFilter(y,t,a),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,a,c={}){return this.style.setPaintProperty(y,t,a,c),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,a,c={}){return this.style.setLayoutProperty(y,t,a,c),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,a,(c=>{c||this._update(!0)})),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,(a=>{a||this._update(!0)})),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=de.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=de.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const p=this._controlContainer=de.create("div","maplibregl-control-container",y),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((S=>{b[S]=de.create("div",`maplibregl-ctrl-${S} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,t,a){this._canvas.width=Math.floor(a*y),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{t={requestedAttributes:y},c&&(t.statusMessage=c.statusMessage,t.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new kf(a,this.transform),He.testSupport(a)}migrateProjection(y,t){super.migrateProjection(y,t),this.painter.transform=y,this.fire(new u.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var t,a,c,p,b;const S=this._idleTriggered?this._fadeDuration:0,C=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,G=be();this.style.zoomHistory.update($,G);const K=new u.H($,{now:G,fadeDuration:S,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ie=K.crossFadingFactor();ie===1&&ie===this._crossFadingFactor||(I=!0,this._crossFadingFactor=ie),this.style.update(K)}const N=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==C;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||N)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,N),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,showPadding:this.showPadding}),this.fire(new u.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.cG.mark(u.cH.load),this.fire(new u.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,u.cG.mark(u.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),rt.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),de.remove(this._canvasContainer),de.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.cG.clearMetrics(),this._removed=!0,this.fire(new u.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Pe.frame(this._frameRequest,(y=>{u.cG.frame(y),this._frameRequest=null;try{this._render(y)}catch(t){if(!u.Z(t)&&!(function(a){return a.message===B})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Pc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},D.MapMouseEvent=Vr,D.MapTouchEvent=uo,D.MapWheelEvent=jh,D.Marker=ah,D.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=u.e({},kd,y),this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),de.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),de.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=de.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){de.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const a=de.create("button",y,this._container);return a.type="button",a.addEventListener("click",t),a}},D.Popup=class extends u.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&de.remove(this._content),this._container&&(de.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=de.create("div","maplibregl-popup",this._map.getContainer()),this._tip=de.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=mu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const p=_u(this.options.offset);if(!c){const S=this._container.offsetWidth,C=this._container.offsetHeight;let I;I=a.y+p.bottom.y<C?["top"]:a.y>this._map.transform.height-C?["bottom"]:[],a.x<S/2?I.push("left"):a.x>this._map.transform.width-S/2&&I.push("right"),c=I.length===0?"bottom":I.join("-")}let b=a.add(p[c]);this.options.subpixelPositioning||(b=b.round()),de.setTransform(this._container,`${gu[c]} translate(${b.x}px,${b.y}px)`),rh(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(zc),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=u.V.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=y;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=de.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=de.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Dc);y&&y.focus()}},D.RasterDEMTileSource=li,D.RasterTileSource=Jt,D.ScaleControl=class{constructor(y){this._onMove=()=>{Wn(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Wn(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ca),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){de.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},D.ScrollZoomHandler=eh,D.Style=Ds,D.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=de.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=de.create("button","maplibregl-ctrl-terrain",this._container),de.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){de.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},D.TwoFingersTouchPitchHandler=wl,D.TwoFingersTouchRotateHandler=Ju,D.TwoFingersTouchZoomHandler=$o,D.TwoFingersTouchZoomRotateHandler=Ac,D.VectorTileSource=pa,D.VideoSource=Re,D.addSourceType=(y,t)=>u._(void 0,void 0,void 0,(function*(){if(se(y))throw new Error(`A source type called "${y}" already exists.`);((a,c)=>{ee[a]=c})(y,t)})),D.clearPrewarmedResources=function(){const y=Kt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Pt),Kt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},D.createTileMesh=iu,D.getMaxParallelImageRequests=function(){return u.c.MAX_PARALLEL_IMAGE_REQUESTS},D.getRTLTextPluginStatus=function(){return Ne().getRTLTextPluginStatus()},D.getVersion=function(){return go},D.getWorkerCount=function(){return Dt.workerCount},D.getWorkerUrl=function(){return u.c.WORKER_URL},D.importScriptInWorkers=function(y){return vr().broadcast("IS",y)},D.isTimeFrozen=function(){return je.isFrozen()},D.now=be,D.prewarm=function(){Ai().acquire(Pt)},D.restoreNow=function(){je.restoreNow()},D.setMaxParallelImageRequests=function(y){u.c.MAX_PARALLEL_IMAGE_REQUESTS=y},D.setNow=function(y){je.setNow(y)},D.setRTLTextPlugin=function(y,t){return Ne().setRTLTextPlugin(y,t)},D.setWorkerCount=function(y){Dt.workerCount=y},D.setWorkerUrl=function(y){u.c.WORKER_URL=y}}));var j=T;return j}))})(v_)),v_.exports}var WM=y_.exports,Dv;function KM(){return Dv||(Dv=1,(function(f,_){(function(T,M){f.exports=M(Nb(),YM())})(typeof globalThis<"u"?globalThis:WM||self,function(T,M){T.MaplibreGL=T.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(O){T.setOptions(this,O),this._throttledUpdate=T.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(O){this._container||this._initContainer();var j=this.getPaneName();O.getPane(j).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),O.options.zoomAnimation&&T.DomEvent.on(O._proxy,T.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(O){this._map._proxy&&this._map.options.zoomAnimation&&T.DomEvent.off(this._map._proxy,T.DomUtil.TRANSITION_END,this._transitionEnd,this);var j=this.getPaneName();O.getPane(j).removeChild(this._container),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getAttribution:function(){if(this.options.attributionControl)return this.options.attributionControl.customAttribution;var O=this._glMap;if(O&&this.options.attributionControl!==!1){var j=O.getStyle();if(j&&j.sources)return Object.keys(j.sources).map(function(D){var u=O.getSource(D);return u&&typeof u.attribution=="string"?u.attribution.trim():null}).filter(Boolean).join(", ")}return""},getMaplibreMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){var O=this.getSize().multiplyBy(.5),j=this._map.latLngToContainerPoint(this._map.getCenter());return T.latLngBounds(this._map.containerPointToLatLng(j.subtract(O)),this._map.containerPointToLatLng(j.add(O)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_roundPoint:function(O){return{x:Math.round(O.x),y:Math.round(O.y)}},_initContainer:function(){var O=this._container=T.DomUtil.create("div","leaflet-gl-layer");this._resizeContainer();var j=this._map.getSize().multiplyBy(this.options.padding),D=this._map.containerPointToLayerPoint([0,0]).subtract(j);T.DomUtil.setPosition(O,this._roundPoint(D))},_resizeContainer:function(){var O=this.getSize();this._container.style.width=O.x+"px",this._container.style.height=O.y+"px"},_initGL:function(){var O=this._map.getCenter(),j=T.extend({},this.options,{container:this._container,center:[O.lng,O.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new M.Map(j);var D=this._map,u=this.getAttribution(),V=this.getAttribution.bind(this);this._glMap.on("load",function(){D&&D.attributionControl&&(D.attributionControl.removeAttribution(u),D.attributionControl.addAttribution(V()))});var te=Object.getPrototypeOf(this._glMap.transform),fe=Object.getOwnPropertyDescriptor(te,"latRange");(!fe||fe.set||fe.writable)&&(this._glMap.transform.latRange=null);var ue=Object.getOwnPropertyDescriptor(te,"maxValidLatitude");(!ue||ue.set||ue.writable)&&(this._glMap.transform.maxValidLatitude=1/0),this._glMap.transform._helper&&this._glMap.transform._helper._latRange&&(this._glMap.transform._helper._latRange=[-1/0,1/0]),this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var De=this._glMap._actualCanvas;T.DomUtil.addClass(De,"leaflet-image-layer"),T.DomUtil.addClass(De,"leaflet-zoom-animated"),this.options.interactive&&T.DomUtil.addClass(De,"leaflet-interactive"),this.options.className&&T.DomUtil.addClass(De,this.options.className)},_update:function(O){if(this._map&&(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming)){var j=this._container,D=this._glMap,u=this._map.getSize().multiplyBy(this.options.padding),V=this._map.containerPointToLayerPoint([0,0]).subtract(u);T.DomUtil.setPosition(j,this._roundPoint(V)),this._transformGL(D)}},_transformGL:function(O){var j=this._map.getCenter(),D=O._getTransformForUpdate();D.setCenter?(D.setCenter(M.LngLat.convert([j.lng,j.lat])),D.setZoom(this._map.getZoom()-1),O.transform.apply(D)):(D=O.transform,D.center=M.LngLat.convert([j.lng,j.lat]),D.zoom=this._map.getZoom()-1),O._fireMoveEvents()},_pinchZoom:function(O){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(O){var j=this._map.getZoomScale(O.zoom),D=this._map.getSize().multiplyBy(this.options.padding*j),u=this.getSize()._divideBy(2),V=this._map.project(O.center,O.zoom)._subtract(u)._add(this._map._getMapPanePos().add(D))._round(),te=this._map.project(this._map.getBounds().getNorthWest(),O.zoom)._subtract(V);T.DomUtil.setTransform(this._glMap._actualCanvas,te.subtract(this._offset),j)},_zoomStart:function(O){this._zooming=!0},_zoomEnd:function(){var O=this._map.getZoomScale(this._map.getZoom());T.DomUtil.setTransform(this._glMap._actualCanvas,null,O),this._zooming=!1,this._update()},_transitionEnd:function(O){T.Util.requestAnimFrame(function(){var j=this._map.getZoom(),D=this._map.getCenter(),u=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());this._resizeContainer(),T.DomUtil.setTransform(this._glMap._actualCanvas,u,1),this._glMap.once("moveend",T.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:D,zoom:j-1})},this)},_resize:function(O){this._transitionEnd(O)}}),T.maplibreGL=function(O){return new T.MaplibreGL(O)}})})(y_)),y_.exports}KM();const Iv={light:"https://tiles.openfreemap.org/styles/liberty",dark:"https://tiles.openfreemap.org/styles/dark"},QM=({isDarkMode:f})=>{const _=I0();return ht.useEffect(()=>{const T=f?Iv.dark:Iv.light,M=Vu.maplibreGL({style:T,interactive:!0});return M.addTo(_),()=>{_.removeLayer(M)}},[_,f]),null};function JM(f){return f>=17?8:f>=15?7:f>=13?6:f>=11?5:f>=9?4:3}function Lv(f,_,T=!0){if(!T||f.length<2)return f;const M=JM(_),O=new Map;for(const D of f){const u=_>=15?`${D.lat.toFixed(4)},${D.lon.toFixed(4)}`:A_(D.lat,D.lon,M);if(O.has(u)){const V=O.get(u);V.spots.push(D),V.count++,V.minPrice=Math.min(V.minPrice,D.price),V.maxPrice=Math.max(V.maxPrice,D.price),V.lat=V.spots.reduce((te,fe)=>te+fe.lat,0)/V.count,V.lon=V.spots.reduce((te,fe)=>te+fe.lon,0)/V.count}else O.set(u,{id:`cluster-${u}`,lat:D.lat,lon:D.lon,spots:[D],minPrice:D.price,maxPrice:D.price,currency:D.currency,count:1})}const j=[];for(const D of O.values())D.count===1?j.push(D.spots[0]):j.push(D);return j}function kv(f){return"count"in f&&f.count>1}class zy{q;r;x;p;k;initialized=!1;constructor(_=1e-5,T=.001){this.q=_,this.r=T,this.x=0,this.p=1,this.k=0}filter(_){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(_-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=_,this.initialized=!0,_)}reset(){this.initialized=!1,this.x=0,this.p=1}}class eA{latFilter;lonFilter;bearingFilter;lastBearing=0;constructor(){this.latFilter=new zy(1e-5,1e-4),this.lonFilter=new zy(1e-5,1e-4),this.bearingFilter=new zy(.1,.5)}smoothLocation(_,T){return[this.latFilter.filter(_),this.lonFilter.filter(T)]}smoothBearing(_,T){if(T<2)return null;let M=(_%360+360)%360;if(this.lastBearing!==0){const D=M-this.lastBearing;D>180&&(M-=360),D<-180&&(M+=360)}const j=(this.bearingFilter.filter(M)%360+360)%360;return this.lastBearing=j,j}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.lastBearing=0}}class tA{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(_){const T=(_%360+360)%360;if(!this.initialized)return this.currentRotation=T,this.lastRawBearing=T,this.initialized=!0,this.currentRotation;let M=T-this.lastRawBearing;return M>180?M-=360:M<-180&&(M+=360),this.currentRotation+=M,this.lastRawBearing=T,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(){this.currentRotation=0,this.lastRawBearing=0,this.initialized=!1}}class iA{startLat=0;startLon=0;targetLat=0;targetLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(_){this.onUpdate=_}animateTo(_,T,M=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=_,this.targetLon=T,this.onUpdate&&this.onUpdate(_,T);return}this.startLat=this.targetLat,this.startLon=this.targetLon,this.targetLat=_,this.targetLon=T,this.startTime=performance.now(),this.duration=M,this.animate()}animate=()=>{const T=performance.now()-this.startTime,M=Math.min(T/this.duration,1),O=1-Math.pow(1-M,3),j=this.startLat+(this.targetLat-this.startLat)*O,D=this.startLon+(this.targetLon-this.startLon)*O;this.onUpdate&&this.onUpdate(j,D),M<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class nA{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:15,walking:10,vehicle:5,fast_vehicle:3};pollIntervals={stationary:1e4,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1e3,walking:700,vehicle:400,fast_vehicle:250};haversineDistance(_,T,M,O){const D=(M-_)*Math.PI/180,u=(O-T)*Math.PI/180,V=Math.sin(D/2)*Math.sin(D/2)+Math.cos(_*Math.PI/180)*Math.cos(M*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(V),Math.sqrt(1-V)))}calculateBearing(_,T,M,O){const j=(O-T)*Math.PI/180,D=Math.sin(j)*Math.cos(M*Math.PI/180),u=Math.cos(_*Math.PI/180)*Math.sin(M*Math.PI/180)-Math.sin(_*Math.PI/180)*Math.cos(M*Math.PI/180)*Math.cos(j);return(Math.atan2(D,u)*180/Math.PI+360)%360}updateLocation(_,T){const M=Date.now();if(!this.initialized)return this.anchorLat=_,this.anchorLon=T,this.displayLat=_,this.displayLon=T,this.lastRawLat=_,this.lastRawLon=T,this.lastUpdateTime=M,this.initialized=!0,{displayLat:_,displayLon:T,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0};const O=this.haversineDistance(this.anchorLat,this.anchorLon,_,T),j=(M-this.lastUpdateTime)/1e3,D=this.haversineDistance(this.lastRawLat,this.lastRawLon,_,T),u=j>0?D/j:0;this.speedHistory.push(u),this.speedHistory.length>5&&this.speedHistory.shift();const V=this.speedHistory.reduce((je,be)=>je+be,0)/this.speedHistory.length;let te;V<.5?te="stationary":V<2?te="walking":V<10?te="vehicle":te="fast_vehicle",this.currentSpeedClass=te;const fe=this.bufferZones[te];if(D>1){const je=this.calculateBearing(this.lastRawLat,this.lastRawLon,_,T);this.directionChangeBuffer.push(je),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((be,de)=>be+de,0)/this.directionChangeBuffer.length}this.lastRawLat=_,this.lastRawLon=T,this.lastUpdateTime=M;let ue=!1,De=this.displayLat,Pe=this.displayLon;return O>fe?(this.anchorLat=_,this.anchorLon=T,De=_,Pe=T,ue=!0):O>fe*.7&&(De=this.displayLat+(_-this.displayLat)*.3,Pe=this.displayLon+(T-this.displayLon)*.3,ue=!0),ue&&(this.displayLat=De,this.displayLon=Pe),{displayLat:this.displayLat,displayLon:this.displayLon,speed:V,speedClass:te,shouldUpdate:ue,animationDuration:this.animationDurations[te]}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}const rA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",aA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",sA=Vu.icon({iconUrl:rA,shadowUrl:aA,iconSize:[25,41],iconAnchor:[12,41]});Vu.Marker.prototype.options.icon=sA;const oA=({location:f,bearing:_,isNavigationMode:T})=>{const M=T?1.3:1,O=28,j=`
           <div style="transform: rotate(${_}deg) scale(${M}); transition: transform 0.3s ease-out; display: flex; align-items: center; justify-content: center;">
             <div style="width: ${O}px; height: ${O}px; background: #007AFF; border: 3px solid white; border-radius: 50%; box-shadow: 0 0 0 ${T?3:2}px rgba(0,122,255,${T?.5:.4}), 0 4px 12px rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; position: relative;">
                <svg width="14" height="14" viewBox="0 0 14 14" style="transform: translateY(-1px); filter: drop-shadow(0 1px 1px rgba(0,0,0,0.2));">
                  <path d="M7 0L14 14L7 12L0 14L7 0Z" fill="white" />
                </svg>
             </div>
           </div>`,D=Math.round(40*M),u=Vu.divIcon({className:"user-location-marker",html:j,iconSize:[D,D],iconAnchor:[D/2,D/2]});return ne.jsx(Yp,{position:f,icon:u,zIndexOffset:1e3})},lA=({location:f,vehicleType:_,bearing:T,orientationMode:M})=>{const D=`<div style="font-size: 36px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4)); transform: rotate(${M==="auto"?T:0}deg);">${_==="bicycle"?"":_==="motorcycle"?"":""}</div>`,u=Vu.divIcon({className:"active-session-marker",html:D,iconSize:[40,40],iconAnchor:[20,20]});return ne.jsx(Yp,{position:f,icon:u})},cA=ht.memo(({spot:f,bearing:_,orientationMode:T})=>{const O=`
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 60px; transform: rotate(${T==="auto"?_:0}deg);">
             <div style="font-size: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
                
             </div>
             <div style="background: #34C759; border-radius: 12px; padding: 2px 8px; font-weight: bold; font-size: 11px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transform: translateY(-5px); white-space: nowrap; color: white;">
                ${f.currency==="USD"?"$":f.currency}${Math.round(f.price)}/hr
             </div>
        </div>
    `,j=Vu.divIcon({className:"spot-marker",html:O,iconSize:[60,60],iconAnchor:[30,45]});return ne.jsx(Yp,{position:[f.lat,f.lon],icon:j})}),uA=({spot:f,bearing:_,orientationMode:T})=>{const M=f.decryptedContent;if(!M||!M.lat||!M.lon)return null;const j=`
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 60px; transform: rotate(${T==="auto"?_:0}deg);">
             <div style="font-size: 32px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); opacity: 0.7;">
                
             </div>
             <div style="background: #8E8E93; border-radius: 12px; padding: 2px 8px; font-weight: bold; font-size: 11px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transform: translateY(-5px); white-space: nowrap; color: white;">
                ${Gp(M.currency||"USD")}${M.fee||"0"}
             </div>
        </div>
    `,D=Vu.divIcon({className:"history-marker",html:j,iconSize:[60,60],iconAnchor:[30,45]});return ne.jsx(Yp,{position:[M.lat,M.lon],icon:D})},Rv=({cluster:f,type:_,bearing:T,orientationMode:M})=>{const O=_==="open"?"":"",j=_==="open"?"#34C759":"#8E8E93",D=M==="auto"?T:0,u=f.minPrice===f.maxPrice?`${Gp(f.currency)}${f.minPrice}`:`${Gp(f.currency)}${f.minPrice}-${f.maxPrice}`,V=`
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 70px; transform: rotate(${D}deg);">
             <div style="font-size: 28px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); position: relative;">
                ${O}
                <div style="position: absolute; top: -5px; right: -5px; background: ${j}; color: white; font-size: 10px; font-weight: bold; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; border: 2px solid white;">
                    ${f.count}
                </div>
             </div>
             <div style="background: ${j}; border-radius: 12px; padding: 2px 8px; font-weight: bold; font-size: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transform: translateY(-5px); white-space: nowrap; color: white;">
                ${u}
             </div>
        </div>
    `,te=Vu.divIcon({className:"cluster-marker",html:V,iconSize:[70,60],iconAnchor:[35,45]});return ne.jsx(Yp,{position:[f.lat,f.lon],icon:te})},hA=({onZoomChange:f})=>{const _=L0({zoomend:()=>{f(_.getZoom())}});return ht.useEffect(()=>{f(_.getZoom())},[]),null},dA=({enabled:f,onDropPin:_})=>(L0({click:T=>{f&&_(T.latlng.lat,T.latlng.lng)}}),null),fA=({location:f,bearing:_,cumulativeRotation:T,orientationMode:M,setOrientationMode:O,shouldRecenter:j,setShouldRecenter:D,setNeedsRecenter:u,routeBounds:V,setRouteBounds:te,mapRotation:fe,setMapRotation:ue,setLiveMapRotation:De})=>{const Pe=I0(),je=ht.useRef(!1),be=ht.useRef(!1),de=ht.useRef(null),He=ht.useRef(0);L0({dragstart:()=>{je.current=!0,M!=="fixed"&&O("fixed"),u(!0)},zoomstart:()=>{be.current||(je.current=!0,M!=="fixed"&&O("fixed"),u(!0))},dragend:()=>{je.current=!1},zoomend:()=>{je.current=!1,be.current=!1},moveend:()=>{be.current=!1}}),ht.useEffect(()=>{Pe.invalidateSize();const Fe=[setTimeout(()=>Pe.invalidateSize(),100),setTimeout(()=>Pe.invalidateSize(),300),setTimeout(()=>Pe.invalidateSize(),500),setTimeout(()=>Pe.invalidateSize(),1e3)];return()=>Fe.forEach(Ut=>clearTimeout(Ut))},[Pe]),ht.useEffect(()=>{V&&(Pe.fitBounds(V,{padding:[50,50],animate:!0}),te(null))},[V,Pe,te]),ht.useEffect(()=>{j&&f&&(Pe.setView(f,17,{animate:!0}),D(!1))},[j,f,Pe,D]),ht.useEffect(()=>{const Fe=()=>{window.dispatchEvent(new CustomEvent("map-user-interaction"))};return Pe.on("dragend",Fe),()=>{Pe.off("dragend",Fe)}},[Pe]),ht.useEffect(()=>{const Fe=Pe.getContainer();Fe.style.width="100%",Fe.style.height="100%",Fe.style.top="0",Fe.style.left="0",Fe.style.position="absolute",setTimeout(()=>Pe.invalidateSize(),50)},[M,Pe]),ht.useEffect(()=>{if(M==="auto"){const Fe=Pe.getContainer();requestAnimationFrame(()=>{Fe.style.transition="transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)",Fe.style.transformOrigin="center center",Fe.style.transform=`rotate(${-T}deg)`,document.documentElement.style.setProperty("--map-rotation",`${_}deg`)})}},[T,_,M,Pe]);const ut=ht.useRef(!1);return ht.useEffect(()=>{M==="auto"&&!ut.current&&f?(Pe.getZoom()<15&&(be.current=!0,Pe.flyTo(f,18,{animate:!0,duration:1.2})),ut.current=!0):M!=="auto"&&(ut.current=!1)},[M,Pe,f]),ht.useEffect(()=>{!je.current&&f&&(M==="auto"||M==="recentre")&&(be.current=!0,Pe.panTo(f,{animate:!0,duration:.3}))},[f,M,Pe]),ht.useEffect(()=>{if(M==="fixed"&&j&&f){const Fe=Pe.getZoom();be.current=!0,Pe.panTo(f,{animate:!0,duration:.5}),Math.abs(Fe-17)>1&&setTimeout(()=>{be.current=!0,Pe.setZoom(17,{animate:!0})},600)}},[M,j,f,Pe]),ht.useEffect(()=>{const Fe=()=>{setTimeout(()=>{Pe.invalidateSize()},100)};return window.addEventListener("resize",Fe),window.addEventListener("orientationchange",Fe),window.visualViewport&&window.visualViewport.addEventListener("resize",Fe),()=>{window.removeEventListener("resize",Fe),window.removeEventListener("orientationchange",Fe),window.visualViewport&&window.visualViewport.removeEventListener("resize",Fe)}},[Pe]),ht.useEffect(()=>{const Fe=Pe.getContainer();let Ut=0;const Rt=16,dt=15,rt=.15;let Ct="none",jt=0,Ht=0,Ot=!1,Yt=fe,si={x:0,y:0};const oi=(lt,_e)=>{const Ue=_e.clientX-lt.clientX,yt=_e.clientY-lt.clientY;return Math.atan2(yt,Ue)*(180/Math.PI)},wt=(lt,_e)=>{const Ue=_e.clientX-lt.clientX,yt=_e.clientY-lt.clientY;return Math.sqrt(Ue*Ue+yt*yt)},ze=(lt,_e,Ue)=>{const yt=Ue.getBoundingClientRect(),Pt=(lt.clientX+_e.clientX)/2-yt.left,Dt=(lt.clientY+_e.clientY)/2-yt.top;return{x:Pt,y:Dt}},Je=lt=>{lt.touches.length===2&&(de.current=oi(lt.touches[0],lt.touches[1]),He.current=fe,jt=wt(lt.touches[0],lt.touches[1]),Ht=de.current,si=ze(lt.touches[0],lt.touches[1],Fe),Ct="none",Ot=!1)},st=lt=>{if(lt.touches.length===2&&de.current!==null){const _e=Date.now();if(_e-Ut<Rt)return;Ut=_e;const Ue=oi(lt.touches[0],lt.touches[1]),yt=wt(lt.touches[0],lt.touches[1]),Pt=Ue-Ht,Dt=yt/jt;if(Ct==="none"){const Lt=Math.abs(Pt),Kt=Math.abs(1-Dt);Lt>dt?(Ct="rotate",Fe.style.transformOrigin=`${si.x}px ${si.y}px`,Fe.style.transition="none"):Kt>rt&&(Ct="zoom")}if(Ct==="rotate"){const Lt=ze(lt.touches[0],lt.touches[1],Fe);Fe.style.transformOrigin=`${Lt.x}px ${Lt.y}px`;const Kt=Ue-de.current,ui=He.current-Kt;Fe.style.transform=`rotate(${-ui}deg)`,document.documentElement.style.setProperty("--map-rotation",`${ui}deg`),De(ui),Yt=ui,Ot=!0}}},Et=()=>{Ot&&Ct==="rotate"&&(ue(Yt),Fe.style.transformOrigin="center center",Fe.style.transition="transform 0.3s ease-out"),de.current=null,Ct="none",Ot=!1};return Fe.addEventListener("touchstart",Je,{passive:!0}),Fe.addEventListener("touchmove",st,{passive:!0}),Fe.addEventListener("touchend",Et,{passive:!0}),()=>{Fe.removeEventListener("touchstart",Je),Fe.removeEventListener("touchmove",st),Fe.removeEventListener("touchend",Et)}},[Pe,fe,ue]),ht.useEffect(()=>{const Fe=Pe.getContainer();if(M!=="auto")if(Fe.style.willChange="transform",Fe.style.transformOrigin="center center",Math.abs(fe)>.5){Fe.style.width="400%",Fe.style.height="400%",Fe.style.top="-150%",Fe.style.left="-150%";const Ut=window.matchMedia("(prefers-color-scheme: dark)").matches;Fe.style.backgroundColor=Ut?"#1a1a1a":"#e0e0e0",Fe.style.transition="transform 0.3s ease-out",Fe.style.transform=`rotate(${-fe}deg)`,document.documentElement.style.setProperty("--map-rotation",`${fe}deg`)}else Fe.style.transition="transform 0.4s ease-out, width 0.3s ease-out, height 0.3s ease-out, top 0.3s ease-out, left 0.3s ease-out",Fe.style.transform="rotate(0deg)",Fe.style.width="100%",Fe.style.height="100%",Fe.style.top="0",Fe.style.left="0",document.documentElement.style.setProperty("--map-rotation","0deg"),setTimeout(()=>Pe.invalidateSize(),350)},[fe,M,Pe]),null},pA=()=>{const[f,_]=ht.useState(null),[T,M]=ht.useState(null),[O,j]=ht.useState(0),[D,u]=ht.useState("idle"),[V,te]=ht.useState("fixed"),[fe,ue]=ht.useState(!1),[De,Pe]=ht.useState(()=>{const Q=localStorage.getItem("parlens_vehicle_type");return Q==="bicycle"||Q==="motorcycle"||Q==="car"?Q:"car"}),[je,be]=ht.useState([]),[de,He]=ht.useState([]),[ut,Fe]=ht.useState(null),[Ut,Rt]=ht.useState(!1),[dt,rt]=ht.useState(!1),[Ct,jt]=ht.useState(17),[Ht,Ot]=ht.useState(!1),[Yt,si]=ht.useState(!1),[oi,wt]=ht.useState(null),[ze,Je]=ht.useState(null),[st,Et]=ht.useState(null),[lt,_e]=ht.useState(!1),[Ue,yt]=ht.useState(null),[Pt,Dt]=ht.useState(!1),[Lt,Kt]=ht.useState(null),[ui,Ai]=ht.useState(0),[mn,vr]=ht.useState(0);ht.useEffect(()=>{vr(ui)},[ui]);const tn=(Q,ee,se,ge)=>{if(wt(Q),Je(ee),Et(se),_e(ge),Q&&Q.length>1&&ge){const we=Vu.latLngBounds(Q);yt(we)}};ht.useEffect(()=>{const Q=setInterval(()=>{const ee=Math.floor(Date.now()/1e3);be(se=>{const ge=se.filter(we=>!we.expiresAt||we.expiresAt>ee);return ge.length!==se.length&&console.log("[Parlens] Expired",se.length-ge.length,"spots"),ge.length!==se.length?ge:se})},1e4);return()=>clearInterval(Q)},[]),ht.useEffect(()=>{const Q=()=>rt(!0);return window.addEventListener("map-user-interaction",Q),()=>window.removeEventListener("map-user-interaction",Q)},[]);const[ar,Gi]=ht.useState(!1);ht.useEffect(()=>{const Q=window.matchMedia("(prefers-color-scheme: dark)");Gi(Q.matches);const ee=se=>Gi(se.matches);return Q.addEventListener("change",ee),()=>Q.removeEventListener("change",ee)},[]);const Fn=ht.useRef(null),Jn=ht.useRef(new eA),ln=ht.useRef(new tA),Lr=ht.useRef(new nA),pa=ht.useRef(new iA),[Jt,li]=ht.useState(0);ht.useEffect(()=>{if("geolocation"in navigator){const Q=setTimeout(()=>{f||M("Unable to get location. Please enable location permissions in your browser/device settings.")},1e4);let ee=0,se=0,ge=0;return Fn.current=navigator.geolocation.watchPosition(we=>{const{latitude:Ze,longitude:Ne,heading:Ie,speed:qe,accuracy:gt}=we.coords,ft=Date.now(),Ft=qe||0,[ei,hi]=Jn.current.smoothLocation(Ze,Ne),Vi=Math.abs(Ze-se)*111e3,Di=Math.abs(Ne-ge)*111e3*Math.cos(Ze*(Math.PI/180)),$e=Math.sqrt(Vi*Vi+Di*Di),Wi=Math.min(gt||10,30)/10,pi=(Ft>10?6:Ft>5?4:2)*Wi,Ki=Lr.current.getPollingInterval();if($e>pi||ft-ee>Ki){const un=Lr.current.updateLocation(ei,hi);if(un.shouldUpdate){const ji=un.animationDuration;ji>0?(pa.current.setUpdateCallback((Ln,sn)=>{_([Ln,sn])}),pa.current.animateTo(un.displayLat,un.displayLon,ji)):_([un.displayLat,un.displayLon])}se=Ze,ge=Ne,ee=ft}if(M(null),Ie!==null&&!isNaN(Ie)&&Ft>2){const un=Jn.current.smoothBearing(Ie,Ft);if(un!==null){const ji=ln.current.setBearing(un);li(ji),j(un)}}},we=>{console.error("Location error:",we),we.code===we.PERMISSION_DENIED?M("Location permission denied. Please enable location access in your browser settings."):we.code===we.POSITION_UNAVAILABLE?M("Location unavailable. Please check your device's GPS settings."):we.code===we.TIMEOUT&&M("Location request timed out. Please try again.")},{enableHighAccuracy:!0,maximumAge:500,timeout:15e3}),()=>{clearTimeout(Q),Fn.current!==null&&navigator.geolocation.clearWatch(Fn.current)}}else M("Geolocation is not supported by this browser.")},[f]);const fi=ht.useRef(null),[Ci,Ei]=ht.useState(!1),cn=async()=>{if(typeof DeviceOrientationEvent.requestPermission=="function")try{if(await DeviceOrientationEvent.requestPermission()==="granted")return Ei(!1),fi.current&&window.addEventListener("deviceorientation",fi.current,!0),!0}catch(Q){console.error("Error requesting device orientation permission:",Q)}return!1};ht.useEffect(()=>{let Q=0,ee=0;const se=Ne=>{const Ie=Date.now();let qe=0;Ne.webkitCompassHeading!==void 0?qe=Ne.webkitCompassHeading:Ne.alpha!==null&&(qe=360-Ne.alpha);const gt=Math.abs(qe-ee),ft=Ie-Q;if(gt>3||ft>100){ee=qe,Q=Ie,j(qe);const Ft=ln.current.setBearing(qe);li(Ft)}};fi.current=se;const ge=async()=>{if(typeof DeviceOrientationEvent.requestPermission=="function"){Ei(!0);return}window.addEventListener("deviceorientation",se,!0)},we=async()=>{document.visibilityState==="visible"&&(typeof DeviceOrientationEvent.requestPermission=="function"?Ei(!0):fi.current&&window.addEventListener("deviceorientation",fi.current,!0))};document.addEventListener("visibilitychange",we);const Ze=setTimeout(ge,500);return()=>{clearTimeout(Ze),document.removeEventListener("visibilitychange",we),fi.current&&window.removeEventListener("deviceorientation",fi.current,!0)}},[]);const Re=Q=>{if(D!=="idle"){alert("Please end your current session before changing vehicle type.");return}Pe(Q),localStorage.setItem("parlens_vehicle_type",Q)};return f?ne.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[Pt&&ne.jsx("div",{className:"absolute top-0 left-0 right-0 z-[1000] bg-orange-500 text-white py-3 px-4 text-center font-medium shadow-lg animate-pulse",children:" Tap anywhere on the map to drop a pin"}),ne.jsx("div",{className:"absolute inset-0",children:ne.jsxs(kM,{center:f,zoom:17,zoomControl:!1,className:"absolute inset-0",dragging:!0,scrollWheelZoom:!0,touchZoom:!0,doubleClickZoom:!0,children:[ne.jsx(QM,{isDarkMode:ar}),ne.jsx(hA,{onZoomChange:jt}),ne.jsx(dA,{enabled:Pt,onDropPin:(Q,ee)=>Kt({lat:Q,lon:ee})}),de.length>0&&(()=>{const ee=de.filter(ge=>(ge.decryptedContent?.type||"car")===De).map(ge=>{const we=ge.decryptedContent;return we&&we.lat&&we.lon?{id:ge.id,lat:we.lat,lon:we.lon,price:parseFloat(we.fee)||0,currency:we.currency||"USD",original:ge}:null}).filter(Boolean);return Lv(ee,Ct).map(ge=>kv(ge)?ne.jsx(Rv,{cluster:ge,type:"history",bearing:O,orientationMode:V},ge.id):ne.jsx(uA,{spot:ge.original||ge,bearing:O,orientationMode:V},ge.id))})(),D==="search"&&je.length>0&&(()=>{const ee=je.filter(ge=>(ge.type||"car")===De).map(ge=>({id:ge.id,lat:ge.lat,lon:ge.lon,price:ge.price,currency:ge.currency,original:ge}));return Lv(ee,Ct).map(ge=>kv(ge)?ne.jsx(Rv,{cluster:ge,type:"open",bearing:O,orientationMode:V},ge.id):ne.jsx(cA,{spot:ge.original||ge,bearing:O,orientationMode:V},ge.id))})(),D==="parked"&&ut&&ne.jsx(lA,{location:ut,vehicleType:De,bearing:O,orientationMode:V}),lt&&ze&&ze.length>1&&ne.jsx(Pv,{positions:ze,color:"#007AFF",weight:3,opacity:.4,dashArray:"8, 8"}),lt&&oi&&oi.length>1&&ne.jsx(Pv,{positions:oi,color:"#007AFF",weight:4,opacity:.9}),lt&&st&&st.map((Q,ee)=>ne.jsx(Yp,{position:[Q.lat,Q.lon],icon:Vu.divIcon({className:"waypoint-marker",html:`<div style="width: 20px; height: 20px; background: #007AFF; border: 2px solid white; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold;">${ee+1}</div>`,iconSize:[20,20],iconAnchor:[10,10]})},`waypoint-${ee}`)),ne.jsx(oA,{location:f,bearing:O,isNavigationMode:V==="auto"}),ne.jsx(fA,{location:f,bearing:O,cumulativeRotation:Jt,orientationMode:V,setOrientationMode:te,shouldRecenter:Ut,setShouldRecenter:Rt,setNeedsRecenter:rt,routeBounds:Ue,setRouteBounds:yt,mapRotation:ui,setMapRotation:Ai,setLiveMapRotation:vr})]})}),ne.jsxs("div",{className:"absolute z-[1000] flex flex-col items-start gap-4 animate-in slide-in-from-left-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[ne.jsxs("div",{className:"flex flex-col gap-1 p-1 rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg mb-2",children:[ne.jsx("button",{onClick:()=>Re("bicycle"),className:`p-2.5 rounded-full transition-all ${De==="bicycle"?"bg-zinc-200 dark:bg-zinc-700 text-black dark:text-white shadow-lg scale-110":"text-black/50 dark:text-white/50 hover:text-black hover:bg-black/5 dark:hover:text-white dark:hover:bg-white/10"}`,children:ne.jsx("span",{className:"text-xl",children:""})}),ne.jsx("button",{onClick:()=>Re("motorcycle"),className:`p-2.5 rounded-full transition-all ${De==="motorcycle"?"bg-zinc-200 dark:bg-zinc-700 text-black dark:text-white shadow-lg scale-110":"text-black/50 dark:text-white/50 hover:text-black hover:bg-black/5 dark:hover:text-white dark:hover:bg-white/10"}`,children:ne.jsx("span",{className:"text-xl",children:""})}),ne.jsx("button",{onClick:()=>Re("car"),className:`p-2.5 rounded-full transition-all ${De==="car"?"bg-zinc-200 dark:bg-zinc-700 text-black dark:text-white shadow-lg scale-110":"text-black/50 dark:text-white/50 hover:text-black hover:bg-black/5 dark:hover:text-white dark:hover:bg-white/10"}`,children:ne.jsx("span",{className:"text-xl",children:""})})]}),ne.jsx("button",{onClick:()=>ue(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-xl border border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70 shadow-2xl active:scale-95 transition-all",children:ne.jsx(Av,{size:20})})]}),ne.jsxs("div",{className:"absolute z-[1000] flex flex-col items-end gap-5 animate-in slide-in-from-right-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[(Math.abs(mn)>5||Math.abs(ui)>5)&&V!=="auto"&&ne.jsx("button",{onClick:()=>{Ai(0),vr(0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-red-500/20 border-red-500/50 animate-in fade-in zoom-in-95 duration-200",title:"Reset to true north",children:ne.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-mn}deg)`},children:[ne.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid",borderBottomColor:"rgb(239 68 68)"}}),ne.jsx("span",{className:"text-sm font-bold text-red-500 dark:text-red-400",style:{marginTop:"-2px"},children:"N"})]})}),ne.jsx("button",{onClick:async()=>{if(Ci){await cn();return}dt?(Rt(!0),rt(!1)):(te(Q=>Q==="fixed"?"recentre":Q==="recentre"?"auto":"fixed"),V==="fixed"&&Rt(!0))},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg ${Ci?"bg-orange-500/20 border-orange-500/50 text-orange-500 dark:text-orange-400 animate-pulse":V==="auto"?"bg-blue-500/20 border-blue-500/50 text-blue-500 dark:text-blue-400":V==="recentre"?"bg-green-500/20 border-green-500/50 text-green-500 dark:text-green-400":dt?"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-400 dark:text-white/40":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:V==="auto"?ne.jsx(sM,{size:20}):V==="recentre"?ne.jsx(lg,{size:20}):ne.jsx(XE,{size:20})}),ne.jsx($M,{vehicleType:De,onRouteChange:tn,currentLocation:f,onDropPinModeChange:Dt,pendingDropPin:Lt,onDropPinConsumed:()=>Kt(null),onOpenChange:si}),ne.jsx(HM,{setHistorySpots:He,onOpenChange:Ot}),ne.jsx(qM,{status:D,setStatus:u,location:f,vehicleType:De,setOpenSpots:be,parkLocation:ut,setParkLocation:Fe})]}),fe&&ne.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[ne.jsx("button",{onClick:()=>ue(!1),className:"absolute inset-0 z-0 cursor-default"}),ne.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",children:[ne.jsx("button",{onClick:()=>ue(!1),className:"absolute top-6 right-6 p-2 rounded-full bg-black/5 dark:bg-white/10 hover:bg-black/10 dark:hover:bg-white/20 transition-colors",children:ne.jsx(P0,{size:20,className:"text-black/60 dark:text-white/60"})}),ne.jsxs("div",{className:"text-center space-y-2 pt-4",children:[ne.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:ne.jsx(Av,{size:32})}),ne.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"})]}),ne.jsxs("div",{className:"space-y-3",children:[ne.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),ne.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[ne.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left hover:bg-zinc-200 dark:hover:bg-white/5 text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[ne.jsx("span",{children:"Using Browser Menu (Android)"}),ne.jsx(og,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),ne.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[ne.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),ne.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[ne.jsx("li",{children:"Tap menu button (three dots)"}),ne.jsxs("li",{children:["Tap ",ne.jsx("strong",{children:"Add to Home screen"})]}),ne.jsxs("li",{children:["Tap ",ne.jsx("strong",{children:"Add"})," to confirm"]})]}),ne.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),ne.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[ne.jsx("li",{children:"Tap menu button (three dots)"}),ne.jsxs("li",{children:["Tap ",ne.jsx("strong",{children:"Install"})]})]})]})]}),ne.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[ne.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left hover:bg-zinc-200 dark:hover:bg-white/5 text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[ne.jsx("span",{children:"Using Share Button (iOS)"}),ne.jsx(og,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),ne.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:ne.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[ne.jsxs("li",{children:["Tap the ",ne.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),ne.jsxs("li",{children:["Scroll down and tap ",ne.jsx("strong",{children:"Add to Home Screen"}),"."]}),ne.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),ne.jsxs("div",{className:"space-y-6 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[ne.jsxs("p",{children:[ne.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. Click the location button to re-centre and turn on follow-me mode for route tracking."]}),ne.jsxs("p",{children:[ne.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),ne.jsxs("p",{children:[ne.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking spots"}),"Click the main button once to see open spots reported by others. Click again to mark your location. When leaving, click once more to end the session and report the fee. Use the profile button to see your parking history."]}),ne.jsxs("p",{children:[ne.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys and only accessible by you. Open spot broadcasts are ephemeral and not linked to any personal identifiers."]}),ne.jsxs("p",{children:[ne.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Create your own mirror"}),ne.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the load and share with your friends."]})]})]})]}),D==="search"&&!Ht&&!Yt&&ne.jsx("div",{className:"absolute left-1/2 z-[1000] -translate-x-1/2 animate-in slide-in-from-top-6 duration-500",style:{top:"max(3rem, calc(env(safe-area-inset-top) + 0.75rem))"},children:ne.jsxs("div",{className:"px-6 py-3 rounded-full bg-white text-black font-bold shadow-xl flex items-center gap-3 border border-black/5 whitespace-nowrap min-w-max",children:[ne.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 animate-pulse"}),ne.jsx("span",{className:"text-sm tracking-tight",children:"Searching for spots"})]})}),D==="parked"&&!Ht&&!Yt&&ne.jsx("div",{className:"absolute left-1/2 z-[1000] -translate-x-1/2 animate-in slide-in-from-top-6 duration-500",style:{top:"max(3rem, calc(env(safe-area-inset-top) + 0.75rem))"},children:ne.jsxs("div",{className:"px-6 py-3 rounded-full bg-[#34C759] text-white font-bold shadow-xl flex items-center gap-3",children:[ne.jsx("span",{className:"text-lg",children:De==="bicycle"?"":De==="motorcycle"?"":""}),ne.jsx("span",{className:"text-sm tracking-tight text-white/90",children:"Session Active"})]})})]}):ne.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-gray-50 dark:bg-black",children:ne.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:T?ne.jsxs(ne.Fragment,{children:[ne.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:ne.jsx("span",{className:"text-2xl",children:""})}),ne.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:T}),ne.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-blue-500 text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):ne.jsxs(ne.Fragment,{children:[ne.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),ne.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})})},mA=()=>{const{login:f}=Xp(),[_,T]=ht.useState(""),[M,O]=ht.useState(""),[j,D]=ht.useState(!1),[u,V]=ht.useState("landing"),[te,fe]=ht.useState(""),[ue,De]=ht.useState(null),Pe=async He=>{D(!0),O("");try{await f(He,He==="nsec"?_:void 0)}catch(ut){O(ut.message)}finally{D(!1)}},je=()=>{V("setup")},be=async()=>{if(!te.trim()){O("Please enter a username");return}D(!0);try{const{generateSecretKey:He,getPublicKey:ut}=await C1(async()=>{const{generateSecretKey:Ct,getPublicKey:jt}=await Promise.resolve().then(()=>ZM);return{generateSecretKey:Ct,getPublicKey:jt}},void 0),Fe=Ct=>Array.from(Ct).map(jt=>jt.toString(16).padStart(2,"0")).join(""),Ut=He(),Rt=ut(Ut);localStorage.setItem("parlens_privkey",Fe(Ut)),localStorage.setItem("parlens_pubkey",Rt),localStorage.setItem("parlens_pending_username",te);const dt=Df.npubEncode(Rt),rt=Df.nsecEncode(Ut);De({npub:dt,nsec:rt}),V("backup")}catch(He){O(He.message)}finally{D(!1)}},de=async()=>{D(!0);try{const He=localStorage.getItem("parlens_pending_username");await f("create",void 0,He||te),localStorage.removeItem("parlens_pending_username")}catch(He){O(He.message)}finally{D(!1)}};return ne.jsx("div",{className:"min-h-screen bg-black p-6 text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:ne.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[ne.jsxs("div",{className:"space-y-4",children:[ne.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),ne.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter",children:"Parlens"}),ne.jsx("p",{className:"text-sm font-medium text-white/40 tracking-tight",children:"Decentralised Route and Parking Management"})]}),ne.jsxs("div",{className:"space-y-4",children:[u==="landing"?ne.jsxs(ne.Fragment,{children:[ne.jsx("button",{onClick:je,disabled:j,className:"w-full h-16 rounded-3xl bg-white text-black font-bold text-lg shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3",children:j?"Creating...":ne.jsxs(ne.Fragment,{children:[ne.jsx(xM,{size:20,strokeWidth:3}),"Create a New Account"]})}),ne.jsxs("button",{onClick:()=>V("nsec"),disabled:j,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[ne.jsx(Zy,{size:18}),"Login with Secret Key"]})]}):u==="setup"?ne.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[ne.jsxs("div",{className:"text-center pb-2",children:[ne.jsx("h3",{className:"text-xl font-bold",children:"Pick a Username"}),ne.jsx("p",{className:"text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),ne.jsx("input",{type:"text",placeholder:"Username",value:te,onChange:He=>fe(He.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),ne.jsxs("div",{className:"flex gap-3",children:[ne.jsx("button",{onClick:()=>V("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),ne.jsx("button",{onClick:be,disabled:j||!te,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:j?"Creating...":"Continue"})]})]}):u==="backup"?ne.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[ne.jsxs("div",{className:"text-center pb-2",children:[ne.jsx("h3",{className:"text-xl font-bold",children:" Account Created!"}),ne.jsx("p",{className:"text-white/40 text-sm mt-1",children:"Back up your keys before continuing"})]}),ne.jsxs("div",{className:"space-y-4",children:[ne.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-white/30 ml-2",children:"Your Keys"}),ne.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white/[0.03] border border-white/10",children:[ne.jsxs("div",{className:"p-5 flex items-center justify-between hover:bg-white/5 transition-colors cursor-pointer active:bg-white/10",onClick:()=>{ue&&(navigator.clipboard.writeText(ue.npub),alert("Public Key copied to clipboard"))},children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/20 text-blue-400",children:ne.jsx(Zy,{size:20})}),ne.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Public Key (Npub)"})]}),ne.jsx(M_,{size:18,className:"text-white/20"})]}),ne.jsx("div",{className:"h-[1px] bg-white/5 mx-4"}),ne.jsxs("div",{className:"p-5 flex items-center justify-between hover:bg-white/5 transition-colors cursor-pointer active:bg-white/10",onClick:()=>{ue&&(navigator.clipboard.writeText(ue.nsec),alert("Secret Key copied to clipboard - keep this safe!"))},children:[ne.jsxs("div",{className:"flex items-center gap-3",children:[ne.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/20 text-red-500",children:ne.jsx(Lb,{size:20})}),ne.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Secret Key (Nsec)"})]}),ne.jsx(M_,{size:18,className:"text-white/20"})]})]}),ne.jsx("p",{className:"text-xs text-white/30 mt-2 ml-2 leading-relaxed text-center",children:" Store these keys securely. They cannot be recovered if lost."})]}),ne.jsx("button",{onClick:de,disabled:j,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:j?"Starting...":"Start Using Parlens"})]}):ne.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[ne.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:_,onChange:He=>T(He.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),ne.jsxs("div",{className:"flex gap-3",children:[ne.jsx("button",{onClick:()=>V("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),ne.jsx("button",{onClick:()=>Pe("nsec"),disabled:j||!_,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:j?"Decrypting...":"Login with Key"})]})]}),M&&ne.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:M}),ne.jsxs("div",{className:"space-y-3 pt-6 border-t border-white/10",children:[ne.jsx("h3",{className:"text-center font-bold text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),ne.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[ne.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left hover:bg-white/5 text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[ne.jsx("span",{children:"Using Browser Menu (Android)"}),ne.jsx(og,{size:16,className:"text-white/50"})]}),ne.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:[ne.jsx("p",{className:"font-semibold text-white/80",children:"Chrome & Brave:"}),ne.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[ne.jsx("li",{children:"Tap menu button (three dots)"}),ne.jsxs("li",{children:["Tap ",ne.jsx("strong",{children:"Add to Home screen"})]}),ne.jsxs("li",{children:["Tap ",ne.jsx("strong",{children:"Add"})," to confirm"]})]}),ne.jsx("p",{className:"font-semibold text-white/80 mt-3",children:"Firefox:"}),ne.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[ne.jsx("li",{children:"Tap menu button (three dots)"}),ne.jsxs("li",{children:["Tap ",ne.jsx("strong",{children:"Install"})]})]})]})]}),ne.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[ne.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left hover:bg-white/5 text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[ne.jsx("span",{children:"Using Share Button (iOS)"}),ne.jsx(og,{size:16,className:"text-white/50"})]}),ne.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:ne.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[ne.jsxs("li",{children:["Tap the ",ne.jsx("strong",{className:"text-white/80",children:"Share"})," button in Safari menu bar."]}),ne.jsxs("li",{children:["Scroll down and tap ",ne.jsx("strong",{className:"text-white/80",children:"Add to Home Screen"}),"."]}),ne.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},gA=()=>{const{pubkey:f}=Xp();return Up.useEffect(()=>{let _=0;const T=()=>{if(document.visibilityState==="hidden")_=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&_>0){const O=Date.now()-_;console.log("[App] Foregrounded after",O,"ms"),O>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},M=O=>{O.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",T),window.addEventListener("pageshow",M),()=>{document.removeEventListener("visibilitychange",T),window.removeEventListener("pageshow",M)}},[]),f?ne.jsx(pA,{}):ne.jsx(mA,{})};var H_=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(f){return this.listeners.add(f),this.onSubscribe(),()=>{this.listeners.delete(f),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},_A={setTimeout:(f,_)=>setTimeout(f,_),clearTimeout:f=>clearTimeout(f),setInterval:(f,_)=>setInterval(f,_),clearInterval:f=>clearInterval(f)},yA=class{#e=_A;#t=!1;setTimeoutProvider(f){this.#e=f}setTimeout(f,_){return this.#e.setTimeout(f,_)}clearTimeout(f){this.#e.clearTimeout(f)}setInterval(f,_){return this.#e.setInterval(f,_)}clearInterval(f){this.#e.clearInterval(f)}},Gy=new yA;function vA(f){setTimeout(f,0)}var $_=typeof window>"u"||"Deno"in globalThis;function Wc(){}function xA(f,_){return typeof f=="function"?f(_):f}function bA(f){return typeof f=="number"&&f>=0&&f!==1/0}function wA(f,_){return Math.max(f+(_||0)-Date.now(),0)}function Hy(f,_){return typeof f=="function"?f(_):f}function TA(f,_){return typeof f=="function"?f(_):f}function Ov(f,_){const{type:T="all",exact:M,fetchStatus:O,predicate:j,queryKey:D,stale:u}=f;if(D){if(M){if(_.queryHash!==k0(D,_.options))return!1}else if(!ug(_.queryKey,D))return!1}if(T!=="all"){const V=_.isActive();if(T==="active"&&!V||T==="inactive"&&V)return!1}return!(typeof u=="boolean"&&_.isStale()!==u||O&&O!==_.state.fetchStatus||j&&!j(_))}function Bv(f,_){const{exact:T,status:M,predicate:O,mutationKey:j}=f;if(j){if(!_.options.mutationKey)return!1;if(T){if(cg(_.options.mutationKey)!==cg(j))return!1}else if(!ug(_.options.mutationKey,j))return!1}return!(M&&_.state.status!==M||O&&!O(_))}function k0(f,_){return(_?.queryKeyHashFn||cg)(f)}function cg(f){return JSON.stringify(f,(_,T)=>$y(T)?Object.keys(T).sort().reduce((M,O)=>(M[O]=T[O],M),{}):T)}function ug(f,_){return f===_?!0:typeof f!=typeof _?!1:f&&_&&typeof f=="object"&&typeof _=="object"?Object.keys(_).every(T=>ug(f[T],_[T])):!1}var SA=Object.prototype.hasOwnProperty;function Wb(f,_){if(f===_)return f;const T=Nv(f)&&Nv(_);if(!T&&!($y(f)&&$y(_)))return _;const O=(T?f:Object.keys(f)).length,j=T?_:Object.keys(_),D=j.length,u=T?new Array(D):{};let V=0;for(let te=0;te<D;te++){const fe=T?te:j[te],ue=f[fe],De=_[fe];if(ue===De){u[fe]=ue,(T?te<O:SA.call(f,fe))&&V++;continue}if(ue===null||De===null||typeof ue!="object"||typeof De!="object"){u[fe]=De;continue}const Pe=Wb(ue,De);u[fe]=Pe,Pe===ue&&V++}return O===D&&V===O?f:u}function Nv(f){return Array.isArray(f)&&f.length===Object.keys(f).length}function $y(f){if(!Fv(f))return!1;const _=f.constructor;if(_===void 0)return!0;const T=_.prototype;return!(!Fv(T)||!T.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(f)!==Object.prototype)}function Fv(f){return Object.prototype.toString.call(f)==="[object Object]"}function EA(f){return new Promise(_=>{Gy.setTimeout(_,f)})}function MA(f,_,T){return typeof T.structuralSharing=="function"?T.structuralSharing(f,_):T.structuralSharing!==!1?Wb(f,_):_}function AA(f,_,T=0){const M=[...f,_];return T&&M.length>T?M.slice(1):M}function CA(f,_,T=0){const M=[_,...f];return T&&M.length>T?M.slice(0,-1):M}var R0=Symbol();function Kb(f,_){return!f.queryFn&&_?.initialPromise?()=>_.initialPromise:!f.queryFn||f.queryFn===R0?()=>Promise.reject(new Error(`Missing queryFn: '${f.queryHash}'`)):f.queryFn}var PA=class extends H_{#e;#t;#i;constructor(){super(),this.#i=f=>{if(!$_&&window.addEventListener){const _=()=>f();return window.addEventListener("visibilitychange",_,!1),()=>{window.removeEventListener("visibilitychange",_)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(f){this.#i=f,this.#t?.(),this.#t=f(_=>{typeof _=="boolean"?this.setFocused(_):this.onFocus()})}setFocused(f){this.#e!==f&&(this.#e=f,this.onFocus())}onFocus(){const f=this.isFocused();this.listeners.forEach(_=>{_(f)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Qb=new PA;function zA(){let f,_;const T=new Promise((O,j)=>{f=O,_=j});T.status="pending",T.catch(()=>{});function M(O){Object.assign(T,O),delete T.resolve,delete T.reject}return T.resolve=O=>{M({status:"fulfilled",value:O}),f(O)},T.reject=O=>{M({status:"rejected",reason:O}),_(O)},T}var DA=vA;function IA(){let f=[],_=0,T=u=>{u()},M=u=>{u()},O=DA;const j=u=>{_?f.push(u):O(()=>{T(u)})},D=()=>{const u=f;f=[],u.length&&O(()=>{M(()=>{u.forEach(V=>{T(V)})})})};return{batch:u=>{let V;_++;try{V=u()}finally{_--,_||D()}return V},batchCalls:u=>(...V)=>{j(()=>{u(...V)})},schedule:j,setNotifyFunction:u=>{T=u},setBatchNotifyFunction:u=>{M=u},setScheduler:u=>{O=u}}}var Eo=IA(),LA=class extends H_{#e=!0;#t;#i;constructor(){super(),this.#i=f=>{if(!$_&&window.addEventListener){const _=()=>f(!0),T=()=>f(!1);return window.addEventListener("online",_,!1),window.addEventListener("offline",T,!1),()=>{window.removeEventListener("online",_),window.removeEventListener("offline",T)}}}}onSubscribe(){this.#t||this.setEventListener(this.#i)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(f){this.#i=f,this.#t?.(),this.#t=f(this.setOnline.bind(this))}setOnline(f){this.#e!==f&&(this.#e=f,this.listeners.forEach(T=>{T(f)}))}isOnline(){return this.#e}},P_=new LA;function kA(f){return Math.min(1e3*2**f,3e4)}function Jb(f){return(f??"online")==="online"?P_.isOnline():!0}var Xy=class extends Error{constructor(f){super("CancelledError"),this.revert=f?.revert,this.silent=f?.silent}};function e1(f){let _=!1,T=0,M;const O=zA(),j=()=>O.status!=="pending",D=be=>{if(!j()){const de=new Xy(be);De(de),f.onCancel?.(de)}},u=()=>{_=!0},V=()=>{_=!1},te=()=>Qb.isFocused()&&(f.networkMode==="always"||P_.isOnline())&&f.canRun(),fe=()=>Jb(f.networkMode)&&f.canRun(),ue=be=>{j()||(M?.(),O.resolve(be))},De=be=>{j()||(M?.(),O.reject(be))},Pe=()=>new Promise(be=>{M=de=>{(j()||te())&&be(de)},f.onPause?.()}).then(()=>{M=void 0,j()||f.onContinue?.()}),je=()=>{if(j())return;let be;const de=T===0?f.initialPromise:void 0;try{be=de??f.fn()}catch(He){be=Promise.reject(He)}Promise.resolve(be).then(ue).catch(He=>{if(j())return;const ut=f.retry??($_?0:3),Fe=f.retryDelay??kA,Ut=typeof Fe=="function"?Fe(T,He):Fe,Rt=ut===!0||typeof ut=="number"&&T<ut||typeof ut=="function"&&ut(T,He);if(_||!Rt){De(He);return}T++,f.onFail?.(T,He),EA(Ut).then(()=>te()?void 0:Pe()).then(()=>{_?De(He):je()})})};return{promise:O,status:()=>O.status,cancel:D,continue:()=>(M?.(),O),cancelRetry:u,continueRetry:V,canStart:fe,start:()=>(fe()?je():Pe().then(je),O)}}var t1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),bA(this.gcTime)&&(this.#e=Gy.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(f){this.gcTime=Math.max(this.gcTime||0,f??($_?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Gy.clearTimeout(this.#e),this.#e=void 0)}},RA=class extends t1{#e;#t;#i;#r;#n;#s;#o;constructor(f){super(),this.#o=!1,this.#s=f.defaultOptions,this.setOptions(f.options),this.observers=[],this.#r=f.client,this.#i=this.#r.getQueryCache(),this.queryKey=f.queryKey,this.queryHash=f.queryHash,this.#e=Uv(this.options),this.state=f.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(f){if(this.options={...this.#s,...f},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const _=Uv(this.options);_.data!==void 0&&(this.setState(jv(_.data,_.dataUpdatedAt)),this.#e=_)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#i.remove(this)}setData(f,_){const T=MA(this.state.data,f,this.options);return this.#a({data:T,type:"success",dataUpdatedAt:_?.updatedAt,manual:_?.manual}),T}setState(f,_){this.#a({type:"setState",state:f,setStateOptions:_})}cancel(f){const _=this.#n?.promise;return this.#n?.cancel(f),_?_.then(Wc).catch(Wc):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(f=>TA(f.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===R0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(f=>Hy(f.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(f=>f.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(f=0){return this.state.data===void 0?!0:f==="static"?!1:this.state.isInvalidated?!0:!wA(this.state.dataUpdatedAt,f)}onFocus(){this.observers.find(_=>_.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(_=>_.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(f){this.observers.includes(f)||(this.observers.push(f),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",query:this,observer:f}))}removeObserver(f){this.observers.includes(f)&&(this.observers=this.observers.filter(_=>_!==f),this.observers.length||(this.#n&&(this.#o?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#i.notify({type:"observerRemoved",query:this,observer:f}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(f,_){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&_?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(f&&this.setOptions(f),!this.options.queryFn){const u=this.observers.find(V=>V.options.queryFn);u&&this.setOptions(u.options)}const T=new AbortController,M=u=>{Object.defineProperty(u,"signal",{enumerable:!0,get:()=>(this.#o=!0,T.signal)})},O=()=>{const u=Kb(this.options,_),te=(()=>{const fe={client:this.#r,queryKey:this.queryKey,meta:this.meta};return M(fe),fe})();return this.#o=!1,this.options.persister?this.options.persister(u,te,this):u(te)},D=(()=>{const u={fetchOptions:_,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:O};return M(u),u})();this.options.behavior?.onFetch(D,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==D.fetchOptions?.meta)&&this.#a({type:"fetch",meta:D.fetchOptions?.meta}),this.#n=e1({initialPromise:_?.initialPromise,fn:D.fetchFn,onCancel:u=>{u instanceof Xy&&u.revert&&this.setState({...this.#t,fetchStatus:"idle"}),T.abort()},onFail:(u,V)=>{this.#a({type:"failed",failureCount:u,error:V})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:D.options.retry,retryDelay:D.options.retryDelay,networkMode:D.options.networkMode,canRun:()=>!0});try{const u=await this.#n.start();if(u===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(u),this.#i.config.onSuccess?.(u,this),this.#i.config.onSettled?.(u,this.state.error,this),u}catch(u){if(u instanceof Xy){if(u.silent)return this.#n.promise;if(u.revert){if(this.state.data===void 0)throw u;return this.state.data}}throw this.#a({type:"error",error:u}),this.#i.config.onError?.(u,this),this.#i.config.onSettled?.(this.state.data,u,this),u}finally{this.scheduleGc()}}#a(f){const _=T=>{switch(f.type){case"failed":return{...T,fetchFailureCount:f.failureCount,fetchFailureReason:f.error};case"pause":return{...T,fetchStatus:"paused"};case"continue":return{...T,fetchStatus:"fetching"};case"fetch":return{...T,...OA(T.data,this.options),fetchMeta:f.meta??null};case"success":const M={...T,...jv(f.data,f.dataUpdatedAt),dataUpdateCount:T.dataUpdateCount+1,...!f.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=f.manual?M:void 0,M;case"error":const O=f.error;return{...T,error:O,errorUpdateCount:T.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:T.fetchFailureCount+1,fetchFailureReason:O,fetchStatus:"idle",status:"error"};case"invalidate":return{...T,isInvalidated:!0};case"setState":return{...T,...f.state}}};this.state=_(this.state),Eo.batch(()=>{this.observers.forEach(T=>{T.onQueryUpdate()}),this.#i.notify({query:this,type:"updated",action:f})})}};function OA(f,_){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Jb(_.networkMode)?"fetching":"paused",...f===void 0&&{error:null,status:"pending"}}}function jv(f,_){return{data:f,dataUpdatedAt:_??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Uv(f){const _=typeof f.initialData=="function"?f.initialData():f.initialData,T=_!==void 0,M=T?typeof f.initialDataUpdatedAt=="function"?f.initialDataUpdatedAt():f.initialDataUpdatedAt:0;return{data:_,dataUpdateCount:0,dataUpdatedAt:T?M??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:T?"success":"pending",fetchStatus:"idle"}}function Vv(f){return{onFetch:(_,T)=>{const M=_.options,O=_.fetchOptions?.meta?.fetchMore?.direction,j=_.state.data?.pages||[],D=_.state.data?.pageParams||[];let u={pages:[],pageParams:[]},V=0;const te=async()=>{let fe=!1;const ue=je=>{Object.defineProperty(je,"signal",{enumerable:!0,get:()=>(_.signal.aborted?fe=!0:_.signal.addEventListener("abort",()=>{fe=!0}),_.signal)})},De=Kb(_.options,_.fetchOptions),Pe=async(je,be,de)=>{if(fe)return Promise.reject();if(be==null&&je.pages.length)return Promise.resolve(je);const ut=(()=>{const dt={client:_.client,queryKey:_.queryKey,pageParam:be,direction:de?"backward":"forward",meta:_.options.meta};return ue(dt),dt})(),Fe=await De(ut),{maxPages:Ut}=_.options,Rt=de?CA:AA;return{pages:Rt(je.pages,Fe,Ut),pageParams:Rt(je.pageParams,be,Ut)}};if(O&&j.length){const je=O==="backward",be=je?BA:Zv,de={pages:j,pageParams:D},He=be(M,de);u=await Pe(de,He,je)}else{const je=f??j.length;do{const be=V===0?D[0]??M.initialPageParam:Zv(M,u);if(V>0&&be==null)break;u=await Pe(u,be),V++}while(V<je)}return u};_.options.persister?_.fetchFn=()=>_.options.persister?.(te,{client:_.client,queryKey:_.queryKey,meta:_.options.meta,signal:_.signal},T):_.fetchFn=te}}}function Zv(f,{pages:_,pageParams:T}){const M=_.length-1;return _.length>0?f.getNextPageParam(_[M],_,T[M],T):void 0}function BA(f,{pages:_,pageParams:T}){return _.length>0?f.getPreviousPageParam?.(_[0],_,T[0],T):void 0}var NA=class extends t1{#e;#t;#i;#r;constructor(f){super(),this.#e=f.client,this.mutationId=f.mutationId,this.#i=f.mutationCache,this.#t=[],this.state=f.state||FA(),this.setOptions(f.options),this.scheduleGc()}setOptions(f){this.options=f,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(f){this.#t.includes(f)||(this.#t.push(f),this.clearGcTimeout(),this.#i.notify({type:"observerAdded",mutation:this,observer:f}))}removeObserver(f){this.#t=this.#t.filter(_=>_!==f),this.scheduleGc(),this.#i.notify({type:"observerRemoved",mutation:this,observer:f})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#i.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(f){const _=()=>{this.#n({type:"continue"})},T={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=e1({fn:()=>this.options.mutationFn?this.options.mutationFn(f,T):Promise.reject(new Error("No mutationFn found")),onFail:(j,D)=>{this.#n({type:"failed",failureCount:j,error:D})},onPause:()=>{this.#n({type:"pause"})},onContinue:_,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#i.canRun(this)});const M=this.state.status==="pending",O=!this.#r.canStart();try{if(M)_();else{this.#n({type:"pending",variables:f,isPaused:O}),await this.#i.config.onMutate?.(f,this,T);const D=await this.options.onMutate?.(f,T);D!==this.state.context&&this.#n({type:"pending",context:D,variables:f,isPaused:O})}const j=await this.#r.start();return await this.#i.config.onSuccess?.(j,f,this.state.context,this,T),await this.options.onSuccess?.(j,f,this.state.context,T),await this.#i.config.onSettled?.(j,null,this.state.variables,this.state.context,this,T),await this.options.onSettled?.(j,null,f,this.state.context,T),this.#n({type:"success",data:j}),j}catch(j){try{throw await this.#i.config.onError?.(j,f,this.state.context,this,T),await this.options.onError?.(j,f,this.state.context,T),await this.#i.config.onSettled?.(void 0,j,this.state.variables,this.state.context,this,T),await this.options.onSettled?.(void 0,j,f,this.state.context,T),j}finally{this.#n({type:"error",error:j})}}finally{this.#i.runNext(this)}}#n(f){const _=T=>{switch(f.type){case"failed":return{...T,failureCount:f.failureCount,failureReason:f.error};case"pause":return{...T,isPaused:!0};case"continue":return{...T,isPaused:!1};case"pending":return{...T,context:f.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:f.isPaused,status:"pending",variables:f.variables,submittedAt:Date.now()};case"success":return{...T,data:f.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...T,data:void 0,error:f.error,failureCount:T.failureCount+1,failureReason:f.error,isPaused:!1,status:"error"}}};this.state=_(this.state),Eo.batch(()=>{this.#t.forEach(T=>{T.onMutationUpdate(f)}),this.#i.notify({mutation:this,type:"updated",action:f})})}};function FA(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var jA=class extends H_{constructor(f={}){super(),this.config=f,this.#e=new Set,this.#t=new Map,this.#i=0}#e;#t;#i;build(f,_,T){const M=new NA({client:f,mutationCache:this,mutationId:++this.#i,options:f.defaultMutationOptions(_),state:T});return this.add(M),M}add(f){this.#e.add(f);const _=p_(f);if(typeof _=="string"){const T=this.#t.get(_);T?T.push(f):this.#t.set(_,[f])}this.notify({type:"added",mutation:f})}remove(f){if(this.#e.delete(f)){const _=p_(f);if(typeof _=="string"){const T=this.#t.get(_);if(T)if(T.length>1){const M=T.indexOf(f);M!==-1&&T.splice(M,1)}else T[0]===f&&this.#t.delete(_)}}this.notify({type:"removed",mutation:f})}canRun(f){const _=p_(f);if(typeof _=="string"){const M=this.#t.get(_)?.find(O=>O.state.status==="pending");return!M||M===f}else return!0}runNext(f){const _=p_(f);return typeof _=="string"?this.#t.get(_)?.find(M=>M!==f&&M.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Eo.batch(()=>{this.#e.forEach(f=>{this.notify({type:"removed",mutation:f})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(f){const _={exact:!0,...f};return this.getAll().find(T=>Bv(_,T))}findAll(f={}){return this.getAll().filter(_=>Bv(f,_))}notify(f){Eo.batch(()=>{this.listeners.forEach(_=>{_(f)})})}resumePausedMutations(){const f=this.getAll().filter(_=>_.state.isPaused);return Eo.batch(()=>Promise.all(f.map(_=>_.continue().catch(Wc))))}};function p_(f){return f.options.scope?.id}var UA=class extends H_{constructor(f={}){super(),this.config=f,this.#e=new Map}#e;build(f,_,T){const M=_.queryKey,O=_.queryHash??k0(M,_);let j=this.get(O);return j||(j=new RA({client:f,queryKey:M,queryHash:O,options:f.defaultQueryOptions(_),state:T,defaultOptions:f.getQueryDefaults(M)}),this.add(j)),j}add(f){this.#e.has(f.queryHash)||(this.#e.set(f.queryHash,f),this.notify({type:"added",query:f}))}remove(f){const _=this.#e.get(f.queryHash);_&&(f.destroy(),_===f&&this.#e.delete(f.queryHash),this.notify({type:"removed",query:f}))}clear(){Eo.batch(()=>{this.getAll().forEach(f=>{this.remove(f)})})}get(f){return this.#e.get(f)}getAll(){return[...this.#e.values()]}find(f){const _={exact:!0,...f};return this.getAll().find(T=>Ov(_,T))}findAll(f={}){const _=this.getAll();return Object.keys(f).length>0?_.filter(T=>Ov(f,T)):_}notify(f){Eo.batch(()=>{this.listeners.forEach(_=>{_(f)})})}onFocus(){Eo.batch(()=>{this.getAll().forEach(f=>{f.onFocus()})})}onOnline(){Eo.batch(()=>{this.getAll().forEach(f=>{f.onOnline()})})}},VA=class{#e;#t;#i;#r;#n;#s;#o;#a;constructor(f={}){this.#e=f.queryCache||new UA,this.#t=f.mutationCache||new jA,this.#i=f.defaultOptions||{},this.#r=new Map,this.#n=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#o=Qb.subscribe(async f=>{f&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=P_.subscribe(async f=>{f&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(f){return this.#e.findAll({...f,fetchStatus:"fetching"}).length}isMutating(f){return this.#t.findAll({...f,status:"pending"}).length}getQueryData(f){const _=this.defaultQueryOptions({queryKey:f});return this.#e.get(_.queryHash)?.state.data}ensureQueryData(f){const _=this.defaultQueryOptions(f),T=this.#e.build(this,_),M=T.state.data;return M===void 0?this.fetchQuery(f):(f.revalidateIfStale&&T.isStaleByTime(Hy(_.staleTime,T))&&this.prefetchQuery(_),Promise.resolve(M))}getQueriesData(f){return this.#e.findAll(f).map(({queryKey:_,state:T})=>{const M=T.data;return[_,M]})}setQueryData(f,_,T){const M=this.defaultQueryOptions({queryKey:f}),j=this.#e.get(M.queryHash)?.state.data,D=xA(_,j);if(D!==void 0)return this.#e.build(this,M).setData(D,{...T,manual:!0})}setQueriesData(f,_,T){return Eo.batch(()=>this.#e.findAll(f).map(({queryKey:M})=>[M,this.setQueryData(M,_,T)]))}getQueryState(f){const _=this.defaultQueryOptions({queryKey:f});return this.#e.get(_.queryHash)?.state}removeQueries(f){const _=this.#e;Eo.batch(()=>{_.findAll(f).forEach(T=>{_.remove(T)})})}resetQueries(f,_){const T=this.#e;return Eo.batch(()=>(T.findAll(f).forEach(M=>{M.reset()}),this.refetchQueries({type:"active",...f},_)))}cancelQueries(f,_={}){const T={revert:!0,..._},M=Eo.batch(()=>this.#e.findAll(f).map(O=>O.cancel(T)));return Promise.all(M).then(Wc).catch(Wc)}invalidateQueries(f,_={}){return Eo.batch(()=>(this.#e.findAll(f).forEach(T=>{T.invalidate()}),f?.refetchType==="none"?Promise.resolve():this.refetchQueries({...f,type:f?.refetchType??f?.type??"active"},_)))}refetchQueries(f,_={}){const T={..._,cancelRefetch:_.cancelRefetch??!0},M=Eo.batch(()=>this.#e.findAll(f).filter(O=>!O.isDisabled()&&!O.isStatic()).map(O=>{let j=O.fetch(void 0,T);return T.throwOnError||(j=j.catch(Wc)),O.state.fetchStatus==="paused"?Promise.resolve():j}));return Promise.all(M).then(Wc)}fetchQuery(f){const _=this.defaultQueryOptions(f);_.retry===void 0&&(_.retry=!1);const T=this.#e.build(this,_);return T.isStaleByTime(Hy(_.staleTime,T))?T.fetch(_):Promise.resolve(T.state.data)}prefetchQuery(f){return this.fetchQuery(f).then(Wc).catch(Wc)}fetchInfiniteQuery(f){return f.behavior=Vv(f.pages),this.fetchQuery(f)}prefetchInfiniteQuery(f){return this.fetchInfiniteQuery(f).then(Wc).catch(Wc)}ensureInfiniteQueryData(f){return f.behavior=Vv(f.pages),this.ensureQueryData(f)}resumePausedMutations(){return P_.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#i}setDefaultOptions(f){this.#i=f}setQueryDefaults(f,_){this.#r.set(cg(f),{queryKey:f,defaultOptions:_})}getQueryDefaults(f){const _=[...this.#r.values()],T={};return _.forEach(M=>{ug(f,M.queryKey)&&Object.assign(T,M.defaultOptions)}),T}setMutationDefaults(f,_){this.#n.set(cg(f),{mutationKey:f,defaultOptions:_})}getMutationDefaults(f){const _=[...this.#n.values()],T={};return _.forEach(M=>{ug(f,M.mutationKey)&&Object.assign(T,M.defaultOptions)}),T}defaultQueryOptions(f){if(f._defaulted)return f;const _={...this.#i.queries,...this.getQueryDefaults(f.queryKey),...f,_defaulted:!0};return _.queryHash||(_.queryHash=k0(_.queryKey,_)),_.refetchOnReconnect===void 0&&(_.refetchOnReconnect=_.networkMode!=="always"),_.throwOnError===void 0&&(_.throwOnError=!!_.suspense),!_.networkMode&&_.persister&&(_.networkMode="offlineFirst"),_.queryFn===R0&&(_.enabled=!1),_}defaultMutationOptions(f){return f?._defaulted?f:{...this.#i.mutations,...f?.mutationKey&&this.getMutationDefaults(f.mutationKey),...f,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},ZA=ht.createContext(void 0),qA=({client:f,children:_})=>(ht.useEffect(()=>(f.mount(),()=>{f.unmount()}),[f]),ne.jsx(ZA.Provider,{value:f,children:_}));const GA=new VA;E1.createRoot(document.getElementById("root")).render(ne.jsx(Up.StrictMode,{children:ne.jsx(qA,{client:GA,children:ne.jsx(DE,{children:ne.jsx(gA,{})})})}));
