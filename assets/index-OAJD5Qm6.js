function z1(h,m){for(var b=0;b<m.length;b++){const S=m[b];if(typeof S!="string"&&!Array.isArray(S)){for(const z in S)if(z!=="default"&&!(z in h)){const k=Object.getOwnPropertyDescriptor(S,z);k&&Object.defineProperty(h,z,k.get?k:{enumerable:!0,get:()=>S[z]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const z of document.querySelectorAll('link[rel="modulepreload"]'))S(z);new MutationObserver(z=>{for(const k of z)if(k.type==="childList")for(const A of k.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&S(A)}).observe(document,{childList:!0,subtree:!0});function b(z){const k={};return z.integrity&&(k.integrity=z.integrity),z.referrerPolicy&&(k.referrerPolicy=z.referrerPolicy),z.crossOrigin==="use-credentials"?k.credentials="include":z.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function S(z){if(z.ep)return;z.ep=!0;const k=b(z);fetch(z.href,k)}})();function ky(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var p_={exports:{}},ig={};var K0;function D1(){if(K0)return ig;K0=1;var h=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function b(S,z,k){var A=null;if(k!==void 0&&(A=""+k),z.key!==void 0&&(A=""+z.key),"key"in z){k={};for(var l in z)l!=="key"&&(k[l]=z[l])}else k=z;return z=k.ref,{$$typeof:h,type:S,key:A,ref:z!==void 0?z:null,props:k}}return ig.Fragment=m,ig.jsx=b,ig.jsxs=b,ig}var Q0;function P1(){return Q0||(Q0=1,p_.exports=D1()),p_.exports}var $=P1(),m_={exports:{}},_n={};var J0;function I1(){if(J0)return _n;J0=1;var h=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),A=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),W=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),re=Symbol.for("react.activity"),xe=Symbol.iterator;function Ae(Te){return Te===null||typeof Te!="object"?null:(Te=xe&&Te[xe]||Te["@@iterator"],typeof Te=="function"?Te:null)}var Ie={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pe=Object.assign,ae={};function ke(Te,Ve,bt){this.props=Te,this.context=Ve,this.refs=ae,this.updater=bt||Ie}ke.prototype.isReactComponent={},ke.prototype.setState=function(Te,Ve){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,Ve,"setState")},ke.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function Ke(){}Ke.prototype=ke.prototype;function at(Te,Ve,bt){this.props=Te,this.context=Ve,this.refs=ae,this.updater=bt||Ie}var zt=at.prototype=new Ke;zt.constructor=at,pe(zt,ke.prototype),zt.isPureReactComponent=!0;var wt=Array.isArray;function ut(){}var ot={H:null,A:null,T:null,S:null},Pe=Object.prototype.hasOwnProperty;function rt(Te,Ve,bt){var Dt=bt.ref;return{$$typeof:h,type:Te,key:Ve,ref:Dt!==void 0?Dt:null,props:bt}}function nt(Te,Ve){return rt(Te.type,Ve,Te.props)}function ct(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===h}function Tt(Te){var Ve={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(bt){return Ve[bt]})}var Nt=/\/+/g;function qt(Te,Ve){return typeof Te=="object"&&Te!==null&&Te.key!=null?Tt(""+Te.key):Ve.toString(36)}function ht(Te){switch(Te.status){case"fulfilled":return Te.value;case"rejected":throw Te.reason;default:switch(typeof Te.status=="string"?Te.then(ut,ut):(Te.status="pending",Te.then(function(Ve){Te.status==="pending"&&(Te.status="fulfilled",Te.value=Ve)},function(Ve){Te.status==="pending"&&(Te.status="rejected",Te.reason=Ve)})),Te.status){case"fulfilled":return Te.value;case"rejected":throw Te.reason}}throw Te}function Se(Te,Ve,bt,Dt,jt){var Xt=typeof Te;(Xt==="undefined"||Xt==="boolean")&&(Te=null);var Yt=!1;if(Te===null)Yt=!0;else switch(Xt){case"bigint":case"string":case"number":Yt=!0;break;case"object":switch(Te.$$typeof){case h:case m:Yt=!0;break;case ne:return Yt=Te._init,Se(Yt(Te._payload),Ve,bt,Dt,jt)}}if(Yt)return jt=jt(Te),Yt=Dt===""?"."+qt(Te,0):Dt,wt(jt)?(bt="",Yt!=null&&(bt=Yt.replace(Nt,"$&/")+"/"),Se(jt,Ve,bt,"",function(wn){return wn})):jt!=null&&(ct(jt)&&(jt=nt(jt,bt+(jt.key==null||Te&&Te.key===jt.key?"":(""+jt.key).replace(Nt,"$&/")+"/")+Yt)),Ve.push(jt)),1;Yt=0;var mn=Dt===""?".":Dt+":";if(wt(Te))for(var Kt=0;Kt<Te.length;Kt++)Dt=Te[Kt],Xt=mn+qt(Dt,Kt),Yt+=Se(Dt,Ve,bt,Xt,jt);else if(Kt=Ae(Te),typeof Kt=="function")for(Te=Kt.call(Te),Kt=0;!(Dt=Te.next()).done;)Dt=Dt.value,Xt=mn+qt(Dt,Kt++),Yt+=Se(Dt,Ve,bt,Xt,jt);else if(Xt==="object"){if(typeof Te.then=="function")return Se(ht(Te),Ve,bt,Dt,jt);throw Ve=String(Te),Error("Objects are not valid as a React child (found: "+(Ve==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":Ve)+"). If you meant to render a collection of children, use an array instead.")}return Yt}function Xe(Te,Ve,bt){if(Te==null)return Te;var Dt=[],jt=0;return Se(Te,Dt,"","",function(Xt){return Ve.call(bt,Xt,jt++)}),Dt}function _t(Te){if(Te._status===-1){var Ve=Te._result;Ve=Ve(),Ve.then(function(bt){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=bt)},function(bt){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=bt)}),Te._status===-1&&(Te._status=0,Te._result=Ve)}if(Te._status===1)return Te._result.default;throw Te._result}var xt=typeof reportError=="function"?reportError:function(Te){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ve=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Te=="object"&&Te!==null&&typeof Te.message=="string"?String(Te.message):String(Te),error:Te});if(!window.dispatchEvent(Ve))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Te);return}console.error(Te)},Bt={map:Xe,forEach:function(Te,Ve,bt){Xe(Te,function(){Ve.apply(this,arguments)},bt)},count:function(Te){var Ve=0;return Xe(Te,function(){Ve++}),Ve},toArray:function(Te){return Xe(Te,function(Ve){return Ve})||[]},only:function(Te){if(!ct(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}};return _n.Activity=re,_n.Children=Bt,_n.Component=ke,_n.Fragment=b,_n.Profiler=z,_n.PureComponent=at,_n.StrictMode=S,_n.Suspense=N,_n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ot,_n.__COMPILER_RUNTIME={__proto__:null,c:function(Te){return ot.H.useMemoCache(Te)}},_n.cache=function(Te){return function(){return Te.apply(null,arguments)}},_n.cacheSignal=function(){return null},_n.cloneElement=function(Te,Ve,bt){if(Te==null)throw Error("The argument must be a React element, but you passed "+Te+".");var Dt=pe({},Te.props),jt=Te.key;if(Ve!=null)for(Xt in Ve.key!==void 0&&(jt=""+Ve.key),Ve)!Pe.call(Ve,Xt)||Xt==="key"||Xt==="__self"||Xt==="__source"||Xt==="ref"&&Ve.ref===void 0||(Dt[Xt]=Ve[Xt]);var Xt=arguments.length-2;if(Xt===1)Dt.children=bt;else if(1<Xt){for(var Yt=Array(Xt),mn=0;mn<Xt;mn++)Yt[mn]=arguments[mn+2];Dt.children=Yt}return rt(Te.type,jt,Dt)},_n.createContext=function(Te){return Te={$$typeof:A,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null},Te.Provider=Te,Te.Consumer={$$typeof:k,_context:Te},Te},_n.createElement=function(Te,Ve,bt){var Dt,jt={},Xt=null;if(Ve!=null)for(Dt in Ve.key!==void 0&&(Xt=""+Ve.key),Ve)Pe.call(Ve,Dt)&&Dt!=="key"&&Dt!=="__self"&&Dt!=="__source"&&(jt[Dt]=Ve[Dt]);var Yt=arguments.length-2;if(Yt===1)jt.children=bt;else if(1<Yt){for(var mn=Array(Yt),Kt=0;Kt<Yt;Kt++)mn[Kt]=arguments[Kt+2];jt.children=mn}if(Te&&Te.defaultProps)for(Dt in Yt=Te.defaultProps,Yt)jt[Dt]===void 0&&(jt[Dt]=Yt[Dt]);return rt(Te,Xt,jt)},_n.createRef=function(){return{current:null}},_n.forwardRef=function(Te){return{$$typeof:l,render:Te}},_n.isValidElement=ct,_n.lazy=function(Te){return{$$typeof:ne,_payload:{_status:-1,_result:Te},_init:_t}},_n.memo=function(Te,Ve){return{$$typeof:W,type:Te,compare:Ve===void 0?null:Ve}},_n.startTransition=function(Te){var Ve=ot.T,bt={};ot.T=bt;try{var Dt=Te(),jt=ot.S;jt!==null&&jt(bt,Dt),typeof Dt=="object"&&Dt!==null&&typeof Dt.then=="function"&&Dt.then(ut,xt)}catch(Xt){xt(Xt)}finally{Ve!==null&&bt.types!==null&&(Ve.types=bt.types),ot.T=Ve}},_n.unstable_useCacheRefresh=function(){return ot.H.useCacheRefresh()},_n.use=function(Te){return ot.H.use(Te)},_n.useActionState=function(Te,Ve,bt){return ot.H.useActionState(Te,Ve,bt)},_n.useCallback=function(Te,Ve){return ot.H.useCallback(Te,Ve)},_n.useContext=function(Te){return ot.H.useContext(Te)},_n.useDebugValue=function(){},_n.useDeferredValue=function(Te,Ve){return ot.H.useDeferredValue(Te,Ve)},_n.useEffect=function(Te,Ve){return ot.H.useEffect(Te,Ve)},_n.useEffectEvent=function(Te){return ot.H.useEffectEvent(Te)},_n.useId=function(){return ot.H.useId()},_n.useImperativeHandle=function(Te,Ve,bt){return ot.H.useImperativeHandle(Te,Ve,bt)},_n.useInsertionEffect=function(Te,Ve){return ot.H.useInsertionEffect(Te,Ve)},_n.useLayoutEffect=function(Te,Ve){return ot.H.useLayoutEffect(Te,Ve)},_n.useMemo=function(Te,Ve){return ot.H.useMemo(Te,Ve)},_n.useOptimistic=function(Te,Ve){return ot.H.useOptimistic(Te,Ve)},_n.useReducer=function(Te,Ve,bt){return ot.H.useReducer(Te,Ve,bt)},_n.useRef=function(Te){return ot.H.useRef(Te)},_n.useState=function(Te){return ot.H.useState(Te)},_n.useSyncExternalStore=function(Te,Ve,bt){return ot.H.useSyncExternalStore(Te,Ve,bt)},_n.useTransition=function(){return ot.H.useTransition()},_n.version="19.2.3",_n}var ev;function n0(){return ev||(ev=1,m_.exports=I1()),m_.exports}var ze=n0();const i0=ky(ze);var g_={exports:{}},rg={},y_={exports:{}},__={};var tv;function k1(){return tv||(tv=1,(function(h){function m(Se,Xe){var _t=Se.length;Se.push(Xe);e:for(;0<_t;){var xt=_t-1>>>1,Bt=Se[xt];if(0<z(Bt,Xe))Se[xt]=Xe,Se[_t]=Bt,_t=xt;else break e}}function b(Se){return Se.length===0?null:Se[0]}function S(Se){if(Se.length===0)return null;var Xe=Se[0],_t=Se.pop();if(_t!==Xe){Se[0]=_t;e:for(var xt=0,Bt=Se.length,Te=Bt>>>1;xt<Te;){var Ve=2*(xt+1)-1,bt=Se[Ve],Dt=Ve+1,jt=Se[Dt];if(0>z(bt,_t))Dt<Bt&&0>z(jt,bt)?(Se[xt]=jt,Se[Dt]=_t,xt=Dt):(Se[xt]=bt,Se[Ve]=_t,xt=Ve);else if(Dt<Bt&&0>z(jt,_t))Se[xt]=jt,Se[Dt]=_t,xt=Dt;else break e}}return Xe}function z(Se,Xe){var _t=Se.sortIndex-Xe.sortIndex;return _t!==0?_t:Se.id-Xe.id}if(h.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var k=performance;h.unstable_now=function(){return k.now()}}else{var A=Date,l=A.now();h.unstable_now=function(){return A.now()-l}}var N=[],W=[],ne=1,re=null,xe=3,Ae=!1,Ie=!1,pe=!1,ae=!1,ke=typeof setTimeout=="function"?setTimeout:null,Ke=typeof clearTimeout=="function"?clearTimeout:null,at=typeof setImmediate<"u"?setImmediate:null;function zt(Se){for(var Xe=b(W);Xe!==null;){if(Xe.callback===null)S(W);else if(Xe.startTime<=Se)S(W),Xe.sortIndex=Xe.expirationTime,m(N,Xe);else break;Xe=b(W)}}function wt(Se){if(pe=!1,zt(Se),!Ie)if(b(N)!==null)Ie=!0,ut||(ut=!0,Tt());else{var Xe=b(W);Xe!==null&&ht(wt,Xe.startTime-Se)}}var ut=!1,ot=-1,Pe=5,rt=-1;function nt(){return ae?!0:!(h.unstable_now()-rt<Pe)}function ct(){if(ae=!1,ut){var Se=h.unstable_now();rt=Se;var Xe=!0;try{e:{Ie=!1,pe&&(pe=!1,Ke(ot),ot=-1),Ae=!0;var _t=xe;try{t:{for(zt(Se),re=b(N);re!==null&&!(re.expirationTime>Se&&nt());){var xt=re.callback;if(typeof xt=="function"){re.callback=null,xe=re.priorityLevel;var Bt=xt(re.expirationTime<=Se);if(Se=h.unstable_now(),typeof Bt=="function"){re.callback=Bt,zt(Se),Xe=!0;break t}re===b(N)&&S(N),zt(Se)}else S(N);re=b(N)}if(re!==null)Xe=!0;else{var Te=b(W);Te!==null&&ht(wt,Te.startTime-Se),Xe=!1}}break e}finally{re=null,xe=_t,Ae=!1}Xe=void 0}}finally{Xe?Tt():ut=!1}}}var Tt;if(typeof at=="function")Tt=function(){at(ct)};else if(typeof MessageChannel<"u"){var Nt=new MessageChannel,qt=Nt.port2;Nt.port1.onmessage=ct,Tt=function(){qt.postMessage(null)}}else Tt=function(){ke(ct,0)};function ht(Se,Xe){ot=ke(function(){Se(h.unstable_now())},Xe)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(Se){Se.callback=null},h.unstable_forceFrameRate=function(Se){0>Se||125<Se?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Pe=0<Se?Math.floor(1e3/Se):5},h.unstable_getCurrentPriorityLevel=function(){return xe},h.unstable_next=function(Se){switch(xe){case 1:case 2:case 3:var Xe=3;break;default:Xe=xe}var _t=xe;xe=Xe;try{return Se()}finally{xe=_t}},h.unstable_requestPaint=function(){ae=!0},h.unstable_runWithPriority=function(Se,Xe){switch(Se){case 1:case 2:case 3:case 4:case 5:break;default:Se=3}var _t=xe;xe=Se;try{return Xe()}finally{xe=_t}},h.unstable_scheduleCallback=function(Se,Xe,_t){var xt=h.unstable_now();switch(typeof _t=="object"&&_t!==null?(_t=_t.delay,_t=typeof _t=="number"&&0<_t?xt+_t:xt):_t=xt,Se){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=_t+Bt,Se={id:ne++,callback:Xe,priorityLevel:Se,startTime:_t,expirationTime:Bt,sortIndex:-1},_t>xt?(Se.sortIndex=_t,m(W,Se),b(N)===null&&Se===b(W)&&(pe?(Ke(ot),ot=-1):pe=!0,ht(wt,_t-xt))):(Se.sortIndex=Bt,m(N,Se),Ie||Ae||(Ie=!0,ut||(ut=!0,Tt()))),Se},h.unstable_shouldYield=nt,h.unstable_wrapCallback=function(Se){var Xe=xe;return function(){var _t=xe;xe=Xe;try{return Se.apply(this,arguments)}finally{xe=_t}}}})(__)),__}var nv;function R1(){return nv||(nv=1,y_.exports=k1()),y_.exports}var v_={exports:{}},Ga={};var iv;function L1(){if(iv)return Ga;iv=1;var h=n0();function m(N){var W="https://react.dev/errors/"+N;if(1<arguments.length){W+="?args[]="+encodeURIComponent(arguments[1]);for(var ne=2;ne<arguments.length;ne++)W+="&args[]="+encodeURIComponent(arguments[ne])}return"Minified React error #"+N+"; visit "+W+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(){}var S={d:{f:b,r:function(){throw Error(m(522))},D:b,C:b,L:b,m:b,X:b,S:b,M:b},p:0,findDOMNode:null},z=Symbol.for("react.portal");function k(N,W,ne){var re=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:z,key:re==null?null:""+re,children:N,containerInfo:W,implementation:ne}}var A=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(N,W){if(N==="font")return"";if(typeof W=="string")return W==="use-credentials"?W:""}return Ga.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,Ga.createPortal=function(N,W){var ne=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!W||W.nodeType!==1&&W.nodeType!==9&&W.nodeType!==11)throw Error(m(299));return k(N,W,null,ne)},Ga.flushSync=function(N){var W=A.T,ne=S.p;try{if(A.T=null,S.p=2,N)return N()}finally{A.T=W,S.p=ne,S.d.f()}},Ga.preconnect=function(N,W){typeof N=="string"&&(W?(W=W.crossOrigin,W=typeof W=="string"?W==="use-credentials"?W:"":void 0):W=null,S.d.C(N,W))},Ga.prefetchDNS=function(N){typeof N=="string"&&S.d.D(N)},Ga.preinit=function(N,W){if(typeof N=="string"&&W&&typeof W.as=="string"){var ne=W.as,re=l(ne,W.crossOrigin),xe=typeof W.integrity=="string"?W.integrity:void 0,Ae=typeof W.fetchPriority=="string"?W.fetchPriority:void 0;ne==="style"?S.d.S(N,typeof W.precedence=="string"?W.precedence:void 0,{crossOrigin:re,integrity:xe,fetchPriority:Ae}):ne==="script"&&S.d.X(N,{crossOrigin:re,integrity:xe,fetchPriority:Ae,nonce:typeof W.nonce=="string"?W.nonce:void 0})}},Ga.preinitModule=function(N,W){if(typeof N=="string")if(typeof W=="object"&&W!==null){if(W.as==null||W.as==="script"){var ne=l(W.as,W.crossOrigin);S.d.M(N,{crossOrigin:ne,integrity:typeof W.integrity=="string"?W.integrity:void 0,nonce:typeof W.nonce=="string"?W.nonce:void 0})}}else W==null&&S.d.M(N)},Ga.preload=function(N,W){if(typeof N=="string"&&typeof W=="object"&&W!==null&&typeof W.as=="string"){var ne=W.as,re=l(ne,W.crossOrigin);S.d.L(N,ne,{crossOrigin:re,integrity:typeof W.integrity=="string"?W.integrity:void 0,nonce:typeof W.nonce=="string"?W.nonce:void 0,type:typeof W.type=="string"?W.type:void 0,fetchPriority:typeof W.fetchPriority=="string"?W.fetchPriority:void 0,referrerPolicy:typeof W.referrerPolicy=="string"?W.referrerPolicy:void 0,imageSrcSet:typeof W.imageSrcSet=="string"?W.imageSrcSet:void 0,imageSizes:typeof W.imageSizes=="string"?W.imageSizes:void 0,media:typeof W.media=="string"?W.media:void 0})}},Ga.preloadModule=function(N,W){if(typeof N=="string")if(W){var ne=l(W.as,W.crossOrigin);S.d.m(N,{as:typeof W.as=="string"&&W.as!=="script"?W.as:void 0,crossOrigin:ne,integrity:typeof W.integrity=="string"?W.integrity:void 0})}else S.d.m(N)},Ga.requestFormReset=function(N){S.d.r(N)},Ga.unstable_batchedUpdates=function(N,W){return N(W)},Ga.useFormState=function(N,W,ne){return A.H.useFormState(N,W,ne)},Ga.useFormStatus=function(){return A.H.useHostTransitionStatus()},Ga.version="19.2.3",Ga}var rv;function ix(){if(rv)return v_.exports;rv=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(m){console.error(m)}}return h(),v_.exports=L1(),v_.exports}var av;function O1(){if(av)return rg;av=1;var h=R1(),m=n0(),b=ix();function S(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function z(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function k(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function A(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function l(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function N(r){if(k(r)!==r)throw Error(S(188))}function W(r){var s=r.alternate;if(!s){if(s=k(r),s===null)throw Error(S(188));return s!==r?null:r}for(var d=r,_=s;;){var M=d.return;if(M===null)break;var P=M.alternate;if(P===null){if(_=M.return,_!==null){d=_;continue}break}if(M.child===P.child){for(P=M.child;P;){if(P===d)return N(M),r;if(P===_)return N(M),s;P=P.sibling}throw Error(S(188))}if(d.return!==_.return)d=M,_=P;else{for(var V=!1,te=M.child;te;){if(te===d){V=!0,d=M,_=P;break}if(te===_){V=!0,_=M,d=P;break}te=te.sibling}if(!V){for(te=P.child;te;){if(te===d){V=!0,d=P,_=M;break}if(te===_){V=!0,_=P,d=M;break}te=te.sibling}if(!V)throw Error(S(189))}}if(d.alternate!==_)throw Error(S(190))}if(d.tag!==3)throw Error(S(188));return d.stateNode.current===d?r:s}function ne(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=ne(r),s!==null)return s;r=r.sibling}return null}var re=Object.assign,xe=Symbol.for("react.element"),Ae=Symbol.for("react.transitional.element"),Ie=Symbol.for("react.portal"),pe=Symbol.for("react.fragment"),ae=Symbol.for("react.strict_mode"),ke=Symbol.for("react.profiler"),Ke=Symbol.for("react.consumer"),at=Symbol.for("react.context"),zt=Symbol.for("react.forward_ref"),wt=Symbol.for("react.suspense"),ut=Symbol.for("react.suspense_list"),ot=Symbol.for("react.memo"),Pe=Symbol.for("react.lazy"),rt=Symbol.for("react.activity"),nt=Symbol.for("react.memo_cache_sentinel"),ct=Symbol.iterator;function Tt(r){return r===null||typeof r!="object"?null:(r=ct&&r[ct]||r["@@iterator"],typeof r=="function"?r:null)}var Nt=Symbol.for("react.client.reference");function qt(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===Nt?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case pe:return"Fragment";case ke:return"Profiler";case ae:return"StrictMode";case wt:return"Suspense";case ut:return"SuspenseList";case rt:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Ie:return"Portal";case at:return r.displayName||"Context";case Ke:return(r._context.displayName||"Context")+".Consumer";case zt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case ot:return s=r.displayName||null,s!==null?s:qt(r.type)||"Memo";case Pe:s=r._payload,r=r._init;try{return qt(r(s))}catch{}}return null}var ht=Array.isArray,Se=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Xe=b.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_t={pending:!1,data:null,method:null,action:null},xt=[],Bt=-1;function Te(r){return{current:r}}function Ve(r){0>Bt||(r.current=xt[Bt],xt[Bt]=null,Bt--)}function bt(r,s){Bt++,xt[Bt]=r.current,r.current=s}var Dt=Te(null),jt=Te(null),Xt=Te(null),Yt=Te(null);function mn(r,s){switch(bt(Xt,s),bt(jt,r),bt(Dt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?gc(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=gc(s),r=km(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Ve(Dt),bt(Dt,r)}function Kt(){Ve(Dt),Ve(jt),Ve(Xt)}function wn(r){r.memoizedState!==null&&bt(Yt,r);var s=Dt.current,d=km(s,r.type);s!==d&&(bt(jt,r),bt(Dt,d))}function br(r){jt.current===r&&(Ve(Dt),Ve(jt)),Yt.current===r&&(Ve(Yt),Bh._currentValue=_t)}var Zn,lr;function Dn(r){if(Zn===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);Zn=s&&s[1]||"",lr=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Zn+r+lr}var Bi=!1;function Ni(r,s){if(!r||Bi)return"";Bi=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var _={DetermineComponentFrameRoot:function(){try{if(s){var vt=function(){throw Error()};if(Object.defineProperty(vt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(vt,[])}catch(et){var We=et}Reflect.construct(r,[],vt)}else{try{vt.call()}catch(et){We=et}r.call(vt.prototype)}}else{try{throw Error()}catch(et){We=et}(vt=r())&&typeof vt.catch=="function"&&vt.catch(function(){})}}catch(et){if(et&&We&&typeof et.stack=="string")return[et.stack,We.stack]}return[null,null]}};_.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var M=Object.getOwnPropertyDescriptor(_.DetermineComponentFrameRoot,"name");M&&M.configurable&&Object.defineProperty(_.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var P=_.DetermineComponentFrameRoot(),V=P[0],te=P[1];if(V&&te){var Me=V.split(`
`),Ye=te.split(`
`);for(M=_=0;_<Me.length&&!Me[_].includes("DetermineComponentFrameRoot");)_++;for(;M<Ye.length&&!Ye[M].includes("DetermineComponentFrameRoot");)M++;if(_===Me.length||M===Ye.length)for(_=Me.length-1,M=Ye.length-1;1<=_&&0<=M&&Me[_]!==Ye[M];)M--;for(;1<=_&&0<=M;_--,M--)if(Me[_]!==Ye[M]){if(_!==1||M!==1)do if(_--,M--,0>M||Me[_]!==Ye[M]){var dt=`
`+Me[_].replace(" at new "," at ");return r.displayName&&dt.includes("<anonymous>")&&(dt=dt.replace("<anonymous>",r.displayName)),dt}while(1<=_&&0<=M);break}}}finally{Bi=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?Dn(d):""}function Kn(r,s){switch(r.tag){case 26:case 27:case 5:return Dn(r.type);case 16:return Dn("Lazy");case 13:return r.child!==s&&s!==null?Dn("Suspense Fallback"):Dn("Suspense");case 19:return Dn("SuspenseList");case 0:case 15:return Ni(r.type,!1);case 11:return Ni(r.type.render,!1);case 1:return Ni(r.type,!0);case 31:return Dn("Activity");default:return""}}function aa(r){try{var s="",d=null;do s+=Kn(r,d),d=r,r=r.return;while(r);return s}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}var Gr=Object.prototype.hasOwnProperty,li=h.unstable_scheduleCallback,xn=h.unstable_cancelCallback,Ar=h.unstable_shouldYield,Sa=h.unstable_requestPaint,xi=h.unstable_now,nr=h.unstable_getCurrentPriorityLevel,fe=h.unstable_ImmediatePriority,Z=h.unstable_UserBlockingPriority,X=h.unstable_NormalPriority,Q=h.unstable_LowPriority,de=h.unstable_IdlePriority,we=h.log,Le=h.unstable_setDisableYieldValue,Re=null,ye=null;function Oe(r){if(typeof we=="function"&&Le(r),ye&&typeof ye.setStrictMode=="function")try{ye.setStrictMode(Re,r)}catch{}}var Je=Math.clz32?Math.clz32:Pt,it=Math.log,Mt=Math.LN2;function Pt(r){return r>>>=0,r===0?32:31-(it(r)/Mt|0)|0}var $t=256,hn=262144,dn=4194304;function Fe(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Pn(r,s,d){var _=r.pendingLanes;if(_===0)return 0;var M=0,P=r.suspendedLanes,V=r.pingedLanes;r=r.warmLanes;var te=_&134217727;return te!==0?(_=te&~P,_!==0?M=Fe(_):(V&=te,V!==0?M=Fe(V):d||(d=te&~r,d!==0&&(M=Fe(d))))):(te=_&~P,te!==0?M=Fe(te):V!==0?M=Fe(V):d||(d=_&~r,d!==0&&(M=Fe(d)))),M===0?0:s!==0&&s!==M&&(s&P)===0&&(P=M&-M,d=s&-s,P>=d||P===32&&(d&4194048)!==0)?s:M}function Mi(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function nn(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function In(){var r=dn;return dn<<=1,(dn&62914560)===0&&(dn=4194304),r}function Gi(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function Bn(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function di(r,s,d,_,M,P){var V=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var te=r.entanglements,Me=r.expirationTimes,Ye=r.hiddenUpdates;for(d=V&~d;0<d;){var dt=31-Je(d),vt=1<<dt;te[dt]=0,Me[dt]=-1;var We=Ye[dt];if(We!==null)for(Ye[dt]=null,dt=0;dt<We.length;dt++){var et=We[dt];et!==null&&(et.lane&=-536870913)}d&=~vt}_!==0&&Un(r,_,0),P!==0&&M===0&&r.tag!==0&&(r.suspendedLanes|=P&~(V&~s))}function Un(r,s,d){r.pendingLanes|=s,r.suspendedLanes&=~s;var _=31-Je(s);r.entangledLanes|=s,r.entanglements[_]=r.entanglements[_]|1073741824|d&261930}function Ai(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var _=31-Je(d),M=1<<_;M&s|r[_]&s&&(r[_]|=s),d&=~M}}function ho(r,s){var d=s&-s;return d=(d&42)!==0?1:lt(d),(d&(r.suspendedLanes|s))!==0?0:d}function lt(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Be(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Ut(){var r=Xe.p;return r!==0?r:(r=window.event,r===void 0?32:zu(r.type))}function ln(r,s){var d=Xe.p;try{return Xe.p=r,s()}finally{Xe.p=d}}var Nn=Math.random().toString(36).slice(2),Tn="__reactFiber$"+Nn,ft="__reactProps$"+Nn,Jt="__reactContainer$"+Nn,rn="__reactEvents$"+Nn,sa="__reactListeners$"+Nn,Vu="__reactHandles$"+Nn,hs="__reactResources$"+Nn,sn="__reactMarker$"+Nn;function Ho(r){delete r[Tn],delete r[ft],delete r[rn],delete r[sa],delete r[Vu]}function ds(r){var s=r[Tn];if(s)return s;for(var d=r.parentNode;d;){if(s=d[Jt]||d[Tn]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=Vd(r);r!==null;){if(d=r[Tn])return d;r=Vd(r)}return s}r=d,d=r.parentNode}return null}function Us(r){if(r=r[Tn]||r[Jt]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function fs(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(S(33))}function ps(r){var s=r[hs];return s||(s=r[hs]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Ci(r){r[sn]=!0}var Nl=new Set,Cr={};function Sn(r,s){Vs(r,s),Vs(r+"Capture",s)}function Vs(r,s){for(Cr[r]=s,r=0;r<s.length;r++)Nl.add(s[r])}var Fl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),jl={},fo={};function $a(r){return Gr.call(fo,r)?!0:Gr.call(jl,r)?!1:Fl.test(r)?fo[r]=!0:(jl[r]=!0,!1)}function Rc(r,s,d){if($a(s))if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var _=s.toLowerCase().slice(0,5);if(_!=="data-"&&_!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+d)}}function ms(r,s,d){if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+d)}}function Ea(r,s,d,_){if(_===null)r.removeAttribute(d);else{switch(typeof _){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(s,d,""+_)}}function kn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Wh(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function _f(r,s,d){var _=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof _<"u"&&typeof _.get=="function"&&typeof _.set=="function"){var M=_.get,P=_.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return M.call(this)},set:function(V){d=""+V,P.call(this,V)}}),Object.defineProperty(r,s,{enumerable:_.enumerable}),{getValue:function(){return d},setValue:function(V){d=""+V},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function $o(r){if(!r._valueTracker){var s=Wh(r)?"checked":"value";r._valueTracker=_f(r,s,""+r[s])}}function Kh(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),_="";return r&&(_=Wh(r)?r.checked?"true":"false":r.value),r=_,r!==d?(s.setValue(r),!0):!1}function Lc(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var vf=/[\n"\\]/g;function Or(r){return r.replace(vf,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Oc(r,s,d,_,M,P,V,te){r.name="",V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?r.type=V:r.removeAttribute("type"),s!=null?V==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+kn(s)):r.value!==""+kn(s)&&(r.value=""+kn(s)):V!=="submit"&&V!=="reset"||r.removeAttribute("value"),s!=null?Bc(r,V,kn(s)):d!=null?Bc(r,V,kn(d)):_!=null&&r.removeAttribute("value"),M==null&&P!=null&&(r.defaultChecked=!!P),M!=null&&(r.checked=M&&typeof M!="function"&&typeof M!="symbol"),te!=null&&typeof te!="function"&&typeof te!="symbol"&&typeof te!="boolean"?r.name=""+kn(te):r.removeAttribute("name")}function qu(r,s,d,_,M,P,V,te){if(P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"&&(r.type=P),s!=null||d!=null){if(!(P!=="submit"&&P!=="reset"||s!=null)){$o(r);return}d=d!=null?""+kn(d):"",s=s!=null?""+kn(s):d,te||s===r.value||(r.value=s),r.defaultValue=s}_=_??M,_=typeof _!="function"&&typeof _!="symbol"&&!!_,r.checked=te?r.checked:!!_,r.defaultChecked=!!_,V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(r.name=V),$o(r)}function Bc(r,s,d){s==="number"&&Lc(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function po(r,s,d,_){if(r=r.options,s){s={};for(var M=0;M<d.length;M++)s["$"+d[M]]=!0;for(d=0;d<r.length;d++)M=s.hasOwnProperty("$"+r[d].value),r[d].selected!==M&&(r[d].selected=M),M&&_&&(r[d].defaultSelected=!0)}else{for(d=""+kn(d),s=null,M=0;M<r.length;M++){if(r[M].value===d){r[M].selected=!0,_&&(r[M].defaultSelected=!0);return}s!==null||r[M].disabled||(s=r[M])}s!==null&&(s.selected=!0)}}function xf(r,s,d){if(s!=null&&(s=""+kn(s),s!==r.value&&(r.value=s),d==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=d!=null?""+kn(d):""}function Ul(r,s,d,_){if(s==null){if(_!=null){if(d!=null)throw Error(S(92));if(ht(_)){if(1<_.length)throw Error(S(93));_=_[0]}d=_}d==null&&(d=""),s=d}d=kn(s),r.defaultValue=d,_=r.textContent,_===d&&_!==""&&_!==null&&(r.value=_),$o(r)}function qs(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var bf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Xo(r,s,d){var _=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?_?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":_?r.setProperty(s,d):typeof d!="number"||d===0||bf.has(s)?s==="float"?r.cssFloat=d:r[s]=(""+d).trim():r[s]=d+"px"}function Gu(r,s,d){if(s!=null&&typeof s!="object")throw Error(S(62));if(r=r.style,d!=null){for(var _ in d)!d.hasOwnProperty(_)||s!=null&&s.hasOwnProperty(_)||(_.indexOf("--")===0?r.setProperty(_,""):_==="float"?r.cssFloat="":r[_]="");for(var M in s)_=s[M],s.hasOwnProperty(M)&&d[M]!==_&&Xo(r,M,_)}else for(var P in s)s.hasOwnProperty(P)&&Xo(r,P,s[P])}function Yo(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Vl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function un(r){return Vl.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Xa(){}var Qh=null;function Nc(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ir=null,Zi=null;function fi(r){var s=Us(r);if(s&&(r=s.stateNode)){var d=r[ft]||null;e:switch(r=s.stateNode,s.type){case"input":if(Oc(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Or(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var _=d[s];if(_!==r&&_.form===r.form){var M=_[ft]||null;if(!M)throw Error(S(90));Oc(_,M.value,M.defaultValue,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name)}}for(s=0;s<d.length;s++)_=d[s],_.form===r.form&&Kh(_)}break e;case"textarea":xf(r,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&po(r,!!d.multiple,s,!1)}}}var Qt=!1;function Qn(r,s,d){if(Qt)return r(s,d);Qt=!0;try{var _=r(s);return _}finally{if(Qt=!1,(ir!==null||Zi!==null)&&(Rd(),ir&&(s=ir,r=Zi,Zi=ir=null,fi(s),r)))for(s=0;s<r.length;s++)fi(r[s])}}function Ma(r,s){var d=r.stateNode;if(d===null)return null;var _=d[ft]||null;if(_===null)return null;d=_[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(r=r.type,_=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!_;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(S(231,s,typeof d));return d}var zi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Br=!1;if(zi)try{var rr={};Object.defineProperty(rr,"passive",{get:function(){Br=!0}}),window.addEventListener("test",rr,rr),window.removeEventListener("test",rr,rr)}catch{Br=!1}var oa=null,gs=null,pi=null;function go(){if(pi)return pi;var r,s=gs,d=s.length,_,M="value"in oa?oa.value:oa.textContent,P=M.length;for(r=0;r<d&&s[r]===M[r];r++);var V=d-r;for(_=1;_<=V&&s[d-_]===M[P-_];_++);return pi=M.slice(r,1<_?1-_:void 0)}function la(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Wo(){return!0}function Nr(){return!1}function Qi(r){function s(d,_,M,P,V){this._reactName=d,this._targetInst=M,this.type=_,this.nativeEvent=P,this.target=V,this.currentTarget=null;for(var te in r)r.hasOwnProperty(te)&&(d=r[te],this[te]=d?d(P):P[te]);return this.isDefaultPrevented=(P.defaultPrevented!=null?P.defaultPrevented:P.returnValue===!1)?Wo:Nr,this.isPropagationStopped=Nr,this}return re(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Wo)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Wo)},persist:function(){},isPersistent:Wo}),s}var Fr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fc=Qi(Fr),Ko=re({},Fr,{view:0,detail:0}),Qo=Qi(Ko),Hn,yo,gn,on=re({},Ko,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vc,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==gn&&(gn&&r.type==="mousemove"?(Hn=r.screenX-gn.screenX,yo=r.screenY-gn.screenY):yo=Hn=0,gn=r),Hn)},movementY:function(r){return"movementY"in r?r.movementY:yo}}),Jo=Qi(on),En=re({},on,{dataTransfer:0}),jc=Qi(En),Aa=re({},Ko,{relatedTarget:0}),_o=Qi(Aa),vo=re({},Fr,{animationName:0,elapsedTime:0,pseudoElement:0}),wf=Qi(vo),Uc=re({},Fr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Jh=Qi(Uc),Kp=re({},Fr,{data:0}),ed=Qi(Kp),jr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ys={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function el(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=mi[r])?!!s[r]:!1}function Vc(){return el}var qc=re({},Ko,{key:function(r){if(r.key){var s=jr[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=la(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?ys[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vc,charCode:function(r){return r.type==="keypress"?la(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?la(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Di=Qi(qc),Tf=re({},on,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zu=Qi(Tf),Sf=re({},Ko,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vc}),Qp=Qi(Sf),ql=re({},Fr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hu=Qi(ql),Gl=re({},on,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),td=Qi(Gl),Gc=re({},Fr,{newState:0,oldState:0}),Zl=Qi(Gc),Hl=[9,13,27,32],Fi=zi&&"CompositionEvent"in window,$l=null;zi&&"documentMode"in document&&($l=document.documentMode);var Xl=zi&&"TextEvent"in window&&!$l,Yl=zi&&(!Fi||$l&&8<$l&&11>=$l),xo=" ",Ef=!1;function Zc(r,s){switch(r){case"keyup":return Hl.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mf(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ya=!1;function $u(r,s){switch(r){case"compositionend":return Mf(s);case"keypress":return s.which!==32?null:(Ef=!0,xo);case"textInput":return r=s.data,r===xo&&Ef?null:r;default:return null}}function Af(r,s){if(Ya)return r==="compositionend"||!Fi&&Zc(r,s)?(r=go(),pi=gs=oa=null,Ya=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Yl&&s.locale!=="ko"?null:s.data;default:return null}}var Cf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Cf[r.type]:s==="textarea"}function Yu(r,s,d,_){ir?Zi?Zi.push(_):Zi=[_]:ir=_,s=Nd(s,"onChange"),0<s.length&&(d=new Fc("onChange","change",null,d,_),r.push({event:d,listeners:s}))}var tl=null,Wl=null;function zf(r){Hg(r,0)}function Hc(r){var s=fs(r);if(Kh(s))return r}function bo(r,s){if(r==="change")return s}var nd=!1;if(zi){var $c;if(zi){var wo="oninput"in document;if(!wo){var id=document.createElement("div");id.setAttribute("oninput","return;"),wo=typeof id.oninput=="function"}$c=wo}else $c=!1;nd=$c&&(!document.documentMode||9<document.documentMode)}function Xc(){tl&&(tl.detachEvent("onpropertychange",Df),Wl=tl=null)}function Df(r){if(r.propertyName==="value"&&Hc(Wl)){var s=[];Yu(s,Wl,r,Nc(r)),Qn(zf,s)}}function Jp(r,s,d){r==="focusin"?(Xc(),tl=s,Wl=d,tl.attachEvent("onpropertychange",Df)):r==="focusout"&&Xc()}function Pf(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Hc(Wl)}function Yc(r,s){if(r==="click")return Hc(s)}function If(r,s){if(r==="input"||r==="change")return Hc(s)}function rd(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Zr=typeof Object.is=="function"?Object.is:rd;function To(r,s){if(Zr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),_=Object.keys(s);if(d.length!==_.length)return!1;for(_=0;_<d.length;_++){var M=d[_];if(!Gr.call(s,M)||!Zr(r[M],s[M]))return!1}return!0}function Ca(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Wc(r,s){var d=Ca(r);r=0;for(var _;d;){if(d.nodeType===3){if(_=r+d.textContent.length,r<=s&&_>=s)return{node:d,offset:s-r};r=_}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Ca(d)}}function Wu(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?Wu(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function Ku(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Lc(r.document);s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=Lc(r.document)}return s}function Kc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var Qu=zi&&"documentMode"in document&&11>=document.documentMode,za=null,Qc=null,Jc=null,Ju=!1;function kf(r,s,d){var _=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Ju||za==null||za!==Lc(_)||(_=za,"selectionStart"in _&&Kc(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Jc&&To(Jc,_)||(Jc=_,_=Nd(Qc,"onSelect"),0<_.length&&(s=new Fc("onSelect","select",null,s,d),r.push({event:s,listeners:_}),s.target=za)))}function nl(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var il={animationend:nl("Animation","AnimationEnd"),animationiteration:nl("Animation","AnimationIteration"),animationstart:nl("Animation","AnimationStart"),transitionrun:nl("Transition","TransitionRun"),transitionstart:nl("Transition","TransitionStart"),transitioncancel:nl("Transition","TransitionCancel"),transitionend:nl("Transition","TransitionEnd")},ad={},Rn={};zi&&(Rn=document.createElement("div").style,"AnimationEvent"in window||(delete il.animationend.animation,delete il.animationiteration.animation,delete il.animationstart.animation),"TransitionEvent"in window||delete il.transitionend.transition);function _s(r){if(ad[r])return ad[r];if(!il[r])return r;var s=il[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in Rn)return ad[r]=s[d];return r}var eu=_s("animationend"),tu=_s("animationiteration"),eh=_s("animationstart"),rl=_s("transitionrun"),nu=_s("transitionstart"),Kl=_s("transitioncancel"),ca=_s("transitionend"),sd=new Map,th="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");th.push("scrollEnd");function ua(r,s){sd.set(r,s),Sn(s,[r])}var vs=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Ur=[],Gs=0,al=0;function sl(){for(var r=Gs,s=al=Gs=0;s<r;){var d=Ur[s];Ur[s++]=null;var _=Ur[s];Ur[s++]=null;var M=Ur[s];Ur[s++]=null;var P=Ur[s];if(Ur[s++]=null,_!==null&&M!==null){var V=_.pending;V===null?M.next=M:(M.next=V.next,V.next=M),_.pending=M}P!==0&&od(d,M,P)}}function iu(r,s,d,_){Ur[Gs++]=r,Ur[Gs++]=s,Ur[Gs++]=d,Ur[Gs++]=_,al|=_,r.lanes|=_,r=r.alternate,r!==null&&(r.lanes|=_)}function So(r,s,d,_){return iu(r,s,d,_),Ql(r)}function Da(r,s){return iu(r,null,null,s),Ql(r)}function od(r,s,d){r.lanes|=d;var _=r.alternate;_!==null&&(_.lanes|=d);for(var M=!1,P=r.return;P!==null;)P.childLanes|=d,_=P.alternate,_!==null&&(_.childLanes|=d),P.tag===22&&(r=P.stateNode,r===null||r._visibility&1||(M=!0)),r=P,P=P.return;return r.tag===3?(P=r.stateNode,M&&s!==null&&(M=31-Je(d),r=P.hiddenUpdates,_=r[M],_===null?r[M]=[s]:_.push(s),s.lane=d|536870912),P):null}function Ql(r){if(50<kd)throw kd=0,ym=null,Error(S(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var cn={};function nh(r,s,d,_){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ha(r,s,d,_){return new nh(r,s,d,_)}function ih(r){return r=r.prototype,!(!r||!r.isReactComponent)}function da(r,s){var d=r.alternate;return d===null?(d=ha(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function Rf(r,s){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,s=d.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function rh(r,s,d,_,M,P){var V=0;if(_=r,typeof r=="function")ih(r)&&(V=1);else if(typeof r=="string")V=Ap(r,d,Dt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case rt:return r=ha(31,d,s,M),r.elementType=rt,r.lanes=P,r;case pe:return Eo(d.children,M,P,s);case ae:V=8,M|=24;break;case ke:return r=ha(12,d,s,M|2),r.elementType=ke,r.lanes=P,r;case wt:return r=ha(13,d,s,M),r.elementType=wt,r.lanes=P,r;case ut:return r=ha(19,d,s,M),r.elementType=ut,r.lanes=P,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case at:V=10;break e;case Ke:V=9;break e;case zt:V=11;break e;case ot:V=14;break e;case Pe:V=16,_=null;break e}V=29,d=Error(S(130,r===null?"null":typeof r,"")),_=null}return s=ha(V,d,s,M),s.elementType=r,s.type=_,s.lanes=P,s}function Eo(r,s,d,_){return r=ha(7,r,_,s),r.lanes=d,r}function ld(r,s,d){return r=ha(6,r,null,s),r.lanes=d,r}function ah(r){var s=ha(18,null,null,0);return s.stateNode=r,s}function Mo(r,s,d){return s=ha(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Jl=new WeakMap;function Vr(r,s){if(typeof r=="object"&&r!==null){var d=Jl.get(r);return d!==void 0?d:(s={value:r,source:s,stack:aa(s)},Jl.set(r,s),s)}return{value:r,source:s,stack:aa(s)}}var Ao=[],Co=0,ol=null,zo=0,ar=[],cr=0,xs=null,bs=1,Hr="";function Zs(r,s){Ao[Co++]=zo,Ao[Co++]=ol,ol=r,zo=s}function cd(r,s,d){ar[cr++]=bs,ar[cr++]=Hr,ar[cr++]=xs,xs=r;var _=bs;r=Hr;var M=32-Je(_)-1;_&=~(1<<M),d+=1;var P=32-Je(s)+M;if(30<P){var V=M-M%5;P=(_&(1<<V)-1).toString(32),_>>=V,M-=V,bs=1<<32-Je(s)+M|d<<M|_,Hr=P+r}else bs=1<<P|d<<M|_,Hr=r}function ll(r){r.return!==null&&(Zs(r,1),cd(r,1,0))}function ec(r){for(;r===ol;)ol=Ao[--Co],Ao[Co]=null,zo=Ao[--Co],Ao[Co]=null;for(;r===xs;)xs=ar[--cr],ar[cr]=null,Hr=ar[--cr],ar[cr]=null,bs=ar[--cr],ar[cr]=null}function ud(r,s){ar[cr++]=bs,ar[cr++]=Hr,ar[cr++]=xs,bs=s.id,Hr=s.overflow,xs=r}var ur=null,Jn=null,bn=!1,Hs=null,fa=!1,bi=Error(S(519));function $r(r){var s=Error(S(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw $s(Vr(s,r)),bi}function Xr(r){var s=r.stateNode,d=r.type,_=r.memoizedProps;switch(s[Tn]=r,s[ft]=_,d){case"dialog":zn("cancel",s),zn("close",s);break;case"iframe":case"object":case"embed":zn("load",s);break;case"video":case"audio":for(d=0;d<mc.length;d++)zn(mc[d],s);break;case"source":zn("error",s);break;case"img":case"image":case"link":zn("error",s),zn("load",s);break;case"details":zn("toggle",s);break;case"input":zn("invalid",s),qu(s,_.value,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name,!0);break;case"select":zn("invalid",s);break;case"textarea":zn("invalid",s),Ul(s,_.value,_.defaultValue,_.children)}d=_.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||_.suppressHydrationWarning===!0||Pm(s.textContent,d)?(_.popover!=null&&(zn("beforetoggle",s),zn("toggle",s)),_.onScroll!=null&&zn("scroll",s),_.onScrollEnd!=null&&zn("scrollend",s),_.onClick!=null&&(s.onclick=Xa),s=!0):s=!1,s||$r(r,!0)}function ru(r){for(ur=r.return;ur;)switch(ur.tag){case 5:case 31:case 13:fa=!1;return;case 27:case 3:fa=!0;return;default:ur=ur.return}}function ws(r){if(r!==ur)return!1;if(!bn)return ru(r),bn=!0,!1;var s=r.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||xp(r.type,r.memoizedProps)),d=!d),d&&Jn&&$r(r),ru(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));Jn=_r(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(317));Jn=_r(r)}else s===27?(s=Jn,_c(r.type)?(r=ba,ba=null,Jn=r):Jn=s):Jn=ur?os(r.stateNode.nextSibling):null;return!0}function Ts(){Jn=ur=null,bn=!1}function Ss(){var r=Hs;return r!==null&&(ja===null?ja=r:ja.push.apply(ja,r),Hs=null),r}function $s(r){Hs===null?Hs=[r]:Hs.push(r)}var Xs=Te(null),Pa=null,Es=null;function Ys(r,s,d){bt(Xs,s._currentValue),s._currentValue=d}function Ms(r){r._currentValue=Xs.current,Ve(Xs)}function sh(r,s,d){for(;r!==null;){var _=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,_!==null&&(_.childLanes|=s)):_!==null&&(_.childLanes&s)!==s&&(_.childLanes|=s),r===d)break;r=r.return}}function oh(r,s,d,_){var M=r.child;for(M!==null&&(M.return=r);M!==null;){var P=M.dependencies;if(P!==null){var V=M.child;P=P.firstContext;e:for(;P!==null;){var te=P;P=M;for(var Me=0;Me<s.length;Me++)if(te.context===s[Me]){P.lanes|=d,te=P.alternate,te!==null&&(te.lanes|=d),sh(P.return,d,r),_||(V=null);break e}P=te.next}}else if(M.tag===18){if(V=M.return,V===null)throw Error(S(341));V.lanes|=d,P=V.alternate,P!==null&&(P.lanes|=d),sh(V,d,r),V=null}else V=M.child;if(V!==null)V.return=M;else for(V=M;V!==null;){if(V===r){V=null;break}if(M=V.sibling,M!==null){M.return=V.return,V=M;break}V=V.return}M=V}}function pa(r,s,d,_){r=null;for(var M=s,P=!1;M!==null;){if(!P){if((M.flags&524288)!==0)P=!0;else if((M.flags&262144)!==0)break}if(M.tag===10){var V=M.alternate;if(V===null)throw Error(S(387));if(V=V.memoizedProps,V!==null){var te=M.type;Zr(M.pendingProps.value,V.value)||(r!==null?r.push(te):r=[te])}}else if(M===Yt.current){if(V=M.alternate,V===null)throw Error(S(387));V.memoizedState.memoizedState!==M.memoizedState.memoizedState&&(r!==null?r.push(Bh):r=[Bh])}M=M.return}r!==null&&oh(s,r,d,_),s.flags|=262144}function tc(r){for(r=r.firstContext;r!==null;){if(!Zr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ws(r){Pa=r,Es=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Hi(r){return lh(Pa,r)}function au(r,s){return Pa===null&&Ws(r),lh(r,s)}function lh(r,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},Es===null){if(r===null)throw Error(S(308));Es=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Es=Es.next=s;return d}var hd=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(d,_){r.push(_)}};this.abort=function(){s.aborted=!0,r.forEach(function(d){return d()})}},Lf=h.unstable_scheduleCallback,dd=h.unstable_NormalPriority,ji={$$typeof:at,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function As(){return{controller:new hd,data:new Map,refCount:0}}function nc(r){r.refCount--,r.refCount===0&&Lf(dd,function(){r.controller.abort()})}var zr=null,ma=0,cl=0,Dr=null;function em(r,s){if(zr===null){var d=zr=[];ma=0,cl=Mm(),Dr={status:"pending",value:void 0,then:function(_){d.push(_)}}}return ma++,s.then(ic,ic),s}function ic(){if(--ma===0&&zr!==null){Dr!==null&&(Dr.status="fulfilled");var r=zr;zr=null,cl=0,Dr=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function su(r,s){var d=[],_={status:"pending",value:null,reason:null,then:function(M){d.push(M)}};return r.then(function(){_.status="fulfilled",_.value=s;for(var M=0;M<d.length;M++)(0,d[M])(s)},function(M){for(_.status="rejected",_.reason=M,M=0;M<d.length;M++)(0,d[M])(void 0)}),_}var sr=Se.S;Se.S=function(r,s){zg=xi(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&em(r,s),sr!==null&&sr(r,s)};var Wa=Te(null);function ch(){var r=Wa.current;return r!==null?r:_i.pooledCache}function uh(r,s){s===null?bt(Wa,Wa.current):bt(Wa,s.pool)}function Of(){var r=ch();return r===null?null:{parent:ji._currentValue,pool:r}}var Ka=Error(S(460)),Do=Error(S(474)),Yr=Error(S(542)),kt={then:function(){}};function ou(r){return r=r.status,r==="fulfilled"||r==="rejected"}function hh(r,s,d){switch(d=r[d],d===void 0?r.push(s):d!==s&&(s.then(Xa,Xa),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,dh(r),r;default:if(typeof s.status=="string")s.then(Xa,Xa);else{if(r=_i,r!==null&&100<r.shellSuspendCounter)throw Error(S(482));r=s,r.status="pending",r.then(function(_){if(s.status==="pending"){var M=s;M.status="fulfilled",M.value=_}},function(_){if(s.status==="pending"){var M=s;M.status="rejected",M.reason=_}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,dh(r),r}throw Qa=s,Ka}}function Ia(r){try{var s=r._init;return s(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(Qa=d,Ka):d}}var Qa=null;function rc(){if(Qa===null)throw Error(S(459));var r=Qa;return Qa=null,r}function dh(r){if(r===Ka||r===Yr)throw Error(S(483))}var Cs=null,ul=0;function lu(r){var s=ul;return ul+=1,Cs===null&&(Cs=[]),hh(Cs,r,s)}function zs(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function fh(r,s){throw s.$$typeof===xe?Error(S(525)):(r=Object.prototype.toString.call(s),Error(S(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function cu(r){function s(Ne,De){if(r){var He=Ne.deletions;He===null?(Ne.deletions=[De],Ne.flags|=16):He.push(De)}}function d(Ne,De){if(!r)return null;for(;De!==null;)s(Ne,De),De=De.sibling;return null}function _(Ne){for(var De=new Map;Ne!==null;)Ne.key!==null?De.set(Ne.key,Ne):De.set(Ne.index,Ne),Ne=Ne.sibling;return De}function M(Ne,De){return Ne=da(Ne,De),Ne.index=0,Ne.sibling=null,Ne}function P(Ne,De,He){return Ne.index=He,r?(He=Ne.alternate,He!==null?(He=He.index,He<De?(Ne.flags|=67108866,De):He):(Ne.flags|=67108866,De)):(Ne.flags|=1048576,De)}function V(Ne){return r&&Ne.alternate===null&&(Ne.flags|=67108866),Ne}function te(Ne,De,He,gt){return De===null||De.tag!==6?(De=ld(He,Ne.mode,gt),De.return=Ne,De):(De=M(De,He),De.return=Ne,De)}function Me(Ne,De,He,gt){var en=He.type;return en===pe?dt(Ne,De,He.props.children,gt,He.key):De!==null&&(De.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Pe&&Ia(en)===De.type)?(De=M(De,He.props),zs(De,He),De.return=Ne,De):(De=rh(He.type,He.key,He.props,null,Ne.mode,gt),zs(De,He),De.return=Ne,De)}function Ye(Ne,De,He,gt){return De===null||De.tag!==4||De.stateNode.containerInfo!==He.containerInfo||De.stateNode.implementation!==He.implementation?(De=Mo(He,Ne.mode,gt),De.return=Ne,De):(De=M(De,He.children||[]),De.return=Ne,De)}function dt(Ne,De,He,gt,en){return De===null||De.tag!==7?(De=Eo(He,Ne.mode,gt,en),De.return=Ne,De):(De=M(De,He),De.return=Ne,De)}function vt(Ne,De,He){if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return De=ld(""+De,Ne.mode,He),De.return=Ne,De;if(typeof De=="object"&&De!==null){switch(De.$$typeof){case Ae:return He=rh(De.type,De.key,De.props,null,Ne.mode,He),zs(He,De),He.return=Ne,He;case Ie:return De=Mo(De,Ne.mode,He),De.return=Ne,De;case Pe:return De=Ia(De),vt(Ne,De,He)}if(ht(De)||Tt(De))return De=Eo(De,Ne.mode,He,null),De.return=Ne,De;if(typeof De.then=="function")return vt(Ne,lu(De),He);if(De.$$typeof===at)return vt(Ne,au(Ne,De),He);fh(Ne,De)}return null}function We(Ne,De,He,gt){var en=De!==null?De.key:null;if(typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint")return en!==null?null:te(Ne,De,""+He,gt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case Ae:return He.key===en?Me(Ne,De,He,gt):null;case Ie:return He.key===en?Ye(Ne,De,He,gt):null;case Pe:return He=Ia(He),We(Ne,De,He,gt)}if(ht(He)||Tt(He))return en!==null?null:dt(Ne,De,He,gt,null);if(typeof He.then=="function")return We(Ne,De,lu(He),gt);if(He.$$typeof===at)return We(Ne,De,au(Ne,He),gt);fh(Ne,He)}return null}function et(Ne,De,He,gt,en){if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return Ne=Ne.get(He)||null,te(De,Ne,""+gt,en);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case Ae:return Ne=Ne.get(gt.key===null?He:gt.key)||null,Me(De,Ne,gt,en);case Ie:return Ne=Ne.get(gt.key===null?He:gt.key)||null,Ye(De,Ne,gt,en);case Pe:return gt=Ia(gt),et(Ne,De,He,gt,en)}if(ht(gt)||Tt(gt))return Ne=Ne.get(He)||null,dt(De,Ne,gt,en,null);if(typeof gt.then=="function")return et(Ne,De,He,lu(gt),en);if(gt.$$typeof===at)return et(Ne,De,He,au(De,gt),en);fh(De,gt)}return null}function Gt(Ne,De,He,gt){for(var en=null,Yn=null,Zt=De,Wt=De=0,Mn=null;Zt!==null&&Wt<He.length;Wt++){Zt.index>Wt?(Mn=Zt,Zt=null):Mn=Zt.sibling;var Gn=We(Ne,Zt,He[Wt],gt);if(Gn===null){Zt===null&&(Zt=Mn);break}r&&Zt&&Gn.alternate===null&&s(Ne,Zt),De=P(Gn,De,Wt),Yn===null?en=Gn:Yn.sibling=Gn,Yn=Gn,Zt=Mn}if(Wt===He.length)return d(Ne,Zt),bn&&Zs(Ne,Wt),en;if(Zt===null){for(;Wt<He.length;Wt++)Zt=vt(Ne,He[Wt],gt),Zt!==null&&(De=P(Zt,De,Wt),Yn===null?en=Zt:Yn.sibling=Zt,Yn=Zt);return bn&&Zs(Ne,Wt),en}for(Zt=_(Zt);Wt<He.length;Wt++)Mn=et(Zt,Ne,Wt,He[Wt],gt),Mn!==null&&(r&&Mn.alternate!==null&&Zt.delete(Mn.key===null?Wt:Mn.key),De=P(Mn,De,Wt),Yn===null?en=Mn:Yn.sibling=Mn,Yn=Mn);return r&&Zt.forEach(function(Pl){return s(Ne,Pl)}),bn&&Zs(Ne,Wt),en}function tn(Ne,De,He,gt){if(He==null)throw Error(S(151));for(var en=null,Yn=null,Zt=De,Wt=De=0,Mn=null,Gn=He.next();Zt!==null&&!Gn.done;Wt++,Gn=He.next()){Zt.index>Wt?(Mn=Zt,Zt=null):Mn=Zt.sibling;var Pl=We(Ne,Zt,Gn.value,gt);if(Pl===null){Zt===null&&(Zt=Mn);break}r&&Zt&&Pl.alternate===null&&s(Ne,Zt),De=P(Pl,De,Wt),Yn===null?en=Pl:Yn.sibling=Pl,Yn=Pl,Zt=Mn}if(Gn.done)return d(Ne,Zt),bn&&Zs(Ne,Wt),en;if(Zt===null){for(;!Gn.done;Wt++,Gn=He.next())Gn=vt(Ne,Gn.value,gt),Gn!==null&&(De=P(Gn,De,Wt),Yn===null?en=Gn:Yn.sibling=Gn,Yn=Gn);return bn&&Zs(Ne,Wt),en}for(Zt=_(Zt);!Gn.done;Wt++,Gn=He.next())Gn=et(Zt,Ne,Wt,Gn.value,gt),Gn!==null&&(r&&Gn.alternate!==null&&Zt.delete(Gn.key===null?Wt:Gn.key),De=P(Gn,De,Wt),Yn===null?en=Gn:Yn.sibling=Gn,Yn=Gn);return r&&Zt.forEach(function(Jm){return s(Ne,Jm)}),bn&&Zs(Ne,Wt),en}function oi(Ne,De,He,gt){if(typeof He=="object"&&He!==null&&He.type===pe&&He.key===null&&(He=He.props.children),typeof He=="object"&&He!==null){switch(He.$$typeof){case Ae:e:{for(var en=He.key;De!==null;){if(De.key===en){if(en=He.type,en===pe){if(De.tag===7){d(Ne,De.sibling),gt=M(De,He.props.children),gt.return=Ne,Ne=gt;break e}}else if(De.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===Pe&&Ia(en)===De.type){d(Ne,De.sibling),gt=M(De,He.props),zs(gt,He),gt.return=Ne,Ne=gt;break e}d(Ne,De);break}else s(Ne,De);De=De.sibling}He.type===pe?(gt=Eo(He.props.children,Ne.mode,gt,He.key),gt.return=Ne,Ne=gt):(gt=rh(He.type,He.key,He.props,null,Ne.mode,gt),zs(gt,He),gt.return=Ne,Ne=gt)}return V(Ne);case Ie:e:{for(en=He.key;De!==null;){if(De.key===en)if(De.tag===4&&De.stateNode.containerInfo===He.containerInfo&&De.stateNode.implementation===He.implementation){d(Ne,De.sibling),gt=M(De,He.children||[]),gt.return=Ne,Ne=gt;break e}else{d(Ne,De);break}else s(Ne,De);De=De.sibling}gt=Mo(He,Ne.mode,gt),gt.return=Ne,Ne=gt}return V(Ne);case Pe:return He=Ia(He),oi(Ne,De,He,gt)}if(ht(He))return Gt(Ne,De,He,gt);if(Tt(He)){if(en=Tt(He),typeof en!="function")throw Error(S(150));return He=en.call(He),tn(Ne,De,He,gt)}if(typeof He.then=="function")return oi(Ne,De,lu(He),gt);if(He.$$typeof===at)return oi(Ne,De,au(Ne,He),gt);fh(Ne,He)}return typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint"?(He=""+He,De!==null&&De.tag===6?(d(Ne,De.sibling),gt=M(De,He),gt.return=Ne,Ne=gt):(d(Ne,De),gt=ld(He,Ne.mode,gt),gt.return=Ne,Ne=gt),V(Ne)):d(Ne,De)}return function(Ne,De,He,gt){try{ul=0;var en=oi(Ne,De,He,gt);return Cs=null,en}catch(Zt){if(Zt===Ka||Zt===Yr)throw Zt;var Yn=ha(29,Zt,null,Ne.mode);return Yn.lanes=gt,Yn.return=Ne,Yn}}}var Ds=cu(!0),fd=cu(!1),Ps=!1;function ph(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function uu(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Is(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ks(r,s,d){var _=r.updateQueue;if(_===null)return null;if(_=_.shared,(ni&2)!==0){var M=_.pending;return M===null?s.next=s:(s.next=M.next,M.next=s),_.pending=s,s=Ql(r),od(r,null,d),s}return iu(r,_,s,d),Ql(r)}function ka(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,Ai(r,d)}}function Vn(r,s){var d=r.updateQueue,_=r.alternate;if(_!==null&&(_=_.updateQueue,d===_)){var M=null,P=null;if(d=d.firstBaseUpdate,d!==null){do{var V={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};P===null?M=P=V:P=P.next=V,d=d.next}while(d!==null);P===null?M=P=s:P=P.next=s}else M=P=s;d={baseState:_.baseState,firstBaseUpdate:M,lastBaseUpdate:P,shared:_.shared,callbacks:_.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}var pd=!1;function Qs(){if(pd){var r=Dr;if(r!==null)throw r}}function Po(r,s,d,_){pd=!1;var M=r.updateQueue;Ps=!1;var P=M.firstBaseUpdate,V=M.lastBaseUpdate,te=M.shared.pending;if(te!==null){M.shared.pending=null;var Me=te,Ye=Me.next;Me.next=null,V===null?P=Ye:V.next=Ye,V=Me;var dt=r.alternate;dt!==null&&(dt=dt.updateQueue,te=dt.lastBaseUpdate,te!==V&&(te===null?dt.firstBaseUpdate=Ye:te.next=Ye,dt.lastBaseUpdate=Me))}if(P!==null){var vt=M.baseState;V=0,dt=Ye=Me=null,te=P;do{var We=te.lane&-536870913,et=We!==te.lane;if(et?(Cn&We)===We:(_&We)===We){We!==0&&We===cl&&(pd=!0),dt!==null&&(dt=dt.next={lane:0,tag:te.tag,payload:te.payload,callback:null,next:null});e:{var Gt=r,tn=te;We=s;var oi=d;switch(tn.tag){case 1:if(Gt=tn.payload,typeof Gt=="function"){vt=Gt.call(oi,vt,We);break e}vt=Gt;break e;case 3:Gt.flags=Gt.flags&-65537|128;case 0:if(Gt=tn.payload,We=typeof Gt=="function"?Gt.call(oi,vt,We):Gt,We==null)break e;vt=re({},vt,We);break e;case 2:Ps=!0}}We=te.callback,We!==null&&(r.flags|=64,et&&(r.flags|=8192),et=M.callbacks,et===null?M.callbacks=[We]:et.push(We))}else et={lane:We,tag:te.tag,payload:te.payload,callback:te.callback,next:null},dt===null?(Ye=dt=et,Me=vt):dt=dt.next=et,V|=We;if(te=te.next,te===null){if(te=M.shared.pending,te===null)break;et=te,te=et.next,et.next=null,M.lastBaseUpdate=et,M.shared.pending=null}}while(!0);dt===null&&(Me=vt),M.baseState=Me,M.firstBaseUpdate=Ye,M.lastBaseUpdate=dt,P===null&&(M.shared.lanes=0),Sl|=V,r.lanes=V,r.memoizedState=vt}}function hu(r,s){if(typeof r!="function")throw Error(S(191,r));r.call(s)}function mh(r,s){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)hu(d[r],s)}var hl=Te(null),du=Te(0);function md(r,s){r=Tl,bt(du,r),bt(hl,s),Tl=r|s.baseLanes}function ga(){bt(du,Tl),bt(hl,hl.current)}function dl(){Tl=du.current,Ve(hl),Ve(du)}var Lt=Te(null),Vt=null;function Ra(r){var s=r.alternate;bt(Pi,Pi.current&1),bt(Lt,r),Vt===null&&(s===null||hl.current!==null||s.memoizedState!==null)&&(Vt=r)}function ac(r){bt(Pi,Pi.current),bt(Lt,r),Vt===null&&(Vt=r)}function fu(r){r.tag===22?(bt(Pi,Pi.current),bt(Lt,r),Vt===null&&(Vt=r)):Ui()}function Ui(){bt(Pi,Pi.current),bt(Lt,Lt.current)}function wi(r){Ve(Lt),Vt===r&&(Vt=null),Ve(Pi)}var Pi=Te(0);function pu(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Jr(d)||er(d)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Js=0,pn=null,Fn=null,fn=null,gi=!1,La=!1,Ja=!1,fl=0,pl=0,eo=null,gd=0;function ci(){throw Error(S(321))}function es(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!Zr(r[d],s[d]))return!1;return!0}function sc(r,s,d,_,M,P){return Js=P,pn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Se.H=r===null||r.memoizedState===null?ti:$i,Ja=!1,P=d(_,M),Ja=!1,La&&(P=mu(s,d,_,M)),oc(r),P}function oc(r){Se.H=qn;var s=Fn!==null&&Fn.next!==null;if(Js=0,fn=Fn=pn=null,gi=!1,pl=0,eo=null,s)throw Error(S(300));r===null||fr||(r=r.dependencies,r!==null&&tc(r)&&(fr=!0))}function mu(r,s,d,_){pn=r;var M=0;do{if(La&&(eo=null),pl=0,La=!1,25<=M)throw Error(S(301));if(M+=1,fn=Fn=null,r.updateQueue!=null){var P=r.updateQueue;P.lastEffect=null,P.events=null,P.stores=null,P.memoCache!=null&&(P.memoCache.index=0)}Se.H=Ji,P=s(d,_)}while(La);return P}function gu(){var r=Se.H,s=r.useState()[0];return s=typeof s.then=="function"?ml(s):s,r=r.useState()[0],(Fn!==null?Fn.memoizedState:null)!==r&&(pn.flags|=1024),s}function yu(){var r=fl!==0;return fl=0,r}function Io(r,s,d){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~d}function to(r){if(gi){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}gi=!1}Js=0,fn=Fn=pn=null,La=!1,pl=fl=0,eo=null}function wr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fn===null?pn.memoizedState=fn=r:fn=fn.next=r,fn}function yi(){if(Fn===null){var r=pn.alternate;r=r!==null?r.memoizedState:null}else r=Fn.next;var s=fn===null?pn.memoizedState:fn.next;if(s!==null)fn=s,Fn=r;else{if(r===null)throw pn.alternate===null?Error(S(467)):Error(S(310));Fn=r,r={memoizedState:Fn.memoizedState,baseState:Fn.baseState,baseQueue:Fn.baseQueue,queue:Fn.queue,next:null},fn===null?pn.memoizedState=fn=r:fn=fn.next=r}return fn}function ks(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ml(r){var s=pl;return pl+=1,eo===null&&(eo=[]),r=hh(eo,r,s),s=pn,(fn===null?s.memoizedState:fn.next)===null&&(s=s.alternate,Se.H=s===null||s.memoizedState===null?ti:$i),r}function gl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return ml(r);if(r.$$typeof===at)return Hi(r)}throw Error(S(438,String(r)))}function lc(r){var s=null,d=pn.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var _=pn.alternate;_!==null&&(_=_.updateQueue,_!==null&&(_=_.memoCache,_!=null&&(s={data:_.data.map(function(M){return M.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=ks(),pn.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(r),_=0;_<r;_++)d[_]=nt;return s.index++,d}function ts(r,s){return typeof s=="function"?s(r):s}function y(r){var s=yi();return t(s,Fn,r)}function t(r,s,d){var _=r.queue;if(_===null)throw Error(S(311));_.lastRenderedReducer=d;var M=r.baseQueue,P=_.pending;if(P!==null){if(M!==null){var V=M.next;M.next=P.next,P.next=V}s.baseQueue=M=P,_.pending=null}if(P=r.baseState,M===null)r.memoizedState=P;else{s=M.next;var te=V=null,Me=null,Ye=s,dt=!1;do{var vt=Ye.lane&-536870913;if(vt!==Ye.lane?(Cn&vt)===vt:(Js&vt)===vt){var We=Ye.revertLane;if(We===0)Me!==null&&(Me=Me.next={lane:0,revertLane:0,gesture:null,action:Ye.action,hasEagerState:Ye.hasEagerState,eagerState:Ye.eagerState,next:null}),vt===cl&&(dt=!0);else if((Js&We)===We){Ye=Ye.next,We===cl&&(dt=!0);continue}else vt={lane:0,revertLane:Ye.revertLane,gesture:null,action:Ye.action,hasEagerState:Ye.hasEagerState,eagerState:Ye.eagerState,next:null},Me===null?(te=Me=vt,V=P):Me=Me.next=vt,pn.lanes|=We,Sl|=We;vt=Ye.action,Ja&&d(P,vt),P=Ye.hasEagerState?Ye.eagerState:d(P,vt)}else We={lane:vt,revertLane:Ye.revertLane,gesture:Ye.gesture,action:Ye.action,hasEagerState:Ye.hasEagerState,eagerState:Ye.eagerState,next:null},Me===null?(te=Me=We,V=P):Me=Me.next=We,pn.lanes|=vt,Sl|=vt;Ye=Ye.next}while(Ye!==null&&Ye!==s);if(Me===null?V=P:Me.next=te,!Zr(P,r.memoizedState)&&(fr=!0,dt&&(d=Dr,d!==null)))throw d;r.memoizedState=P,r.baseState=V,r.baseQueue=Me,_.lastRenderedState=P}return M===null&&(_.lanes=0),[r.memoizedState,_.dispatch]}function a(r){var s=yi(),d=s.queue;if(d===null)throw Error(S(311));d.lastRenderedReducer=r;var _=d.dispatch,M=d.pending,P=s.memoizedState;if(M!==null){d.pending=null;var V=M=M.next;do P=r(P,V.action),V=V.next;while(V!==M);Zr(P,s.memoizedState)||(fr=!0),s.memoizedState=P,s.baseQueue===null&&(s.baseState=P),d.lastRenderedState=P}return[P,_]}function c(r,s,d){var _=pn,M=yi(),P=bn;if(P){if(d===void 0)throw Error(S(407));d=d()}else d=s();var V=!Zr((Fn||M).memoizedState,d);if(V&&(M.memoizedState=d,fr=!0),M=M.queue,Ge(w.bind(null,_,M,r),[r]),M.getSnapshot!==s||V||fn!==null&&fn.memoizedState.tag&1){if(_.flags|=2048,me(9,{destroy:void 0},v.bind(null,_,M,d,s),null),_i===null)throw Error(S(349));P||(Js&127)!==0||f(_,s,d)}return d}function f(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=pn.updateQueue,s===null?(s=ks(),pn.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function v(r,s,d,_){s.value=d,s.getSnapshot=_,E(s)&&D(r)}function w(r,s,d){return d(function(){E(s)&&D(r)})}function E(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!Zr(r,d)}catch{return!0}}function D(r){var s=Da(r,2);s!==null&&Va(s,r,2)}function R(r){var s=wr();if(typeof r=="function"){var d=r;if(r=d(),Ja){Oe(!0);try{d()}finally{Oe(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:r},s}function O(r,s,d,_){return r.baseState=d,t(r,Fn,typeof _=="function"?_:ts)}function U(r,s,d,_,M){if(ya(r))throw Error(S(485));if(r=s.action,r!==null){var P={payload:M,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(V){P.listeners.push(V)}};Se.T!==null?d(!0):P.isTransition=!1,_(P),d=s.pending,d===null?(P.next=s.pending=P,j(s,P)):(P.next=d.next,s.pending=d.next=P)}}function j(r,s){var d=s.action,_=s.payload,M=r.state;if(s.isTransition){var P=Se.T,V={};Se.T=V;try{var te=d(M,_),Me=Se.S;Me!==null&&Me(V,te),H(r,s,te)}catch(Ye){se(r,s,Ye)}finally{P!==null&&V.types!==null&&(P.types=V.types),Se.T=P}}else try{P=d(M,_),H(r,s,P)}catch(Ye){se(r,s,Ye)}}function H(r,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(_){K(r,s,_)},function(_){return se(r,s,_)}):K(r,s,d)}function K(r,s,d){s.status="fulfilled",s.value=d,le(s),r.state=d,s=r.pending,s!==null&&(d=s.next,d===s?r.pending=null:(d=d.next,s.next=d,j(r,d)))}function se(r,s,d){var _=r.pending;if(r.pending=null,_!==null){_=_.next;do s.status="rejected",s.reason=d,le(s),s=s.next;while(s!==_)}r.action=null}function le(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function oe(r,s){return s}function ue(r,s){if(bn){var d=_i.formState;if(d!==null){e:{var _=pn;if(bn){if(Jn){t:{for(var M=Jn,P=fa;M.nodeType!==8;){if(!P){M=null;break t}if(M=os(M.nextSibling),M===null){M=null;break t}}P=M.data,M=P==="F!"||P==="F"?M:null}if(M){Jn=os(M.nextSibling),_=M.data==="F!";break e}}$r(_)}_=!1}_&&(s=d[0])}}return d=wr(),d.memoizedState=d.baseState=s,_={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oe,lastRenderedState:s},d.queue=_,d=cc.bind(null,pn,_),_.dispatch=d,_=R(!1),P=Kr.bind(null,pn,!1,_.queue),_=wr(),M={state:s,dispatch:null,action:r,pending:null},_.queue=M,d=U.bind(null,pn,M,P,d),M.dispatch=d,_.memoizedState=r,[s,d,!1]}function ve(r){var s=yi();return ce(s,Fn,r)}function ce(r,s,d){if(s=t(r,s,oe)[0],r=y(ts)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var _=ml(s)}catch(V){throw V===Ka?Yr:V}else _=s;s=yi();var M=s.queue,P=M.dispatch;return d!==s.memoizedState&&(pn.flags|=2048,me(9,{destroy:void 0},_e.bind(null,M,d),null)),[_,P,r]}function _e(r,s){r.action=s}function Ee(r){var s=yi(),d=Fn;if(d!==null)return ce(s,d,r);yi(),s=s.memoizedState,d=yi();var _=d.queue.dispatch;return d.memoizedState=r,[s,_,!1]}function me(r,s,d,_){return r={tag:r,create:d,deps:_,inst:s,next:null},s=pn.updateQueue,s===null&&(s=ks(),pn.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=r.next=r:(_=d.next,d.next=r,r.next=_,s.lastEffect=r),r}function Ce(){return yi().memoizedState}function Ze(r,s,d,_){var M=wr();pn.flags|=r,M.memoizedState=me(1|s,{destroy:void 0},d,_===void 0?null:_)}function je(r,s,d,_){var M=yi();_=_===void 0?null:_;var P=M.memoizedState.inst;Fn!==null&&_!==null&&es(_,Fn.memoizedState.deps)?M.memoizedState=me(s,P,d,_):(pn.flags|=r,M.memoizedState=me(1|s,P,d,_))}function qe(r,s){Ze(8390656,8,r,s)}function Ge(r,s){je(2048,8,r,s)}function St(r){pn.flags|=4;var s=pn.updateQueue;if(s===null)s=ks(),pn.updateQueue=s,s.events=[r];else{var d=s.events;d===null?s.events=[r]:d.push(r)}}function Et(r){var s=yi().memoizedState;return St({ref:s,nextImpl:r}),function(){if((ni&2)!==0)throw Error(S(440));return s.impl.apply(void 0,arguments)}}function pt(r,s){return je(4,2,r,s)}function At(r,s){return je(4,4,r,s)}function an(r,s){if(typeof s=="function"){r=r();var d=s(r);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function jn(r,s,d){d=d!=null?d.concat([r]):null,je(4,4,an.bind(null,s,r),d)}function ri(){}function ei(r,s){var d=yi();s=s===void 0?null:s;var _=d.memoizedState;return s!==null&&es(s,_[1])?_[0]:(d.memoizedState=[r,s],r)}function ui(r,s){var d=yi();s=s===void 0?null:s;var _=d.memoizedState;if(s!==null&&es(s,_[1]))return _[0];if(_=r(),Ja){Oe(!0);try{r()}finally{Oe(!1)}}return d.memoizedState=[_,s],_}function $n(r,s,d){return d===void 0||(Js&1073741824)!==0&&(Cn&261930)===0?r.memoizedState=s:(r.memoizedState=d,r=Pg(),pn.lanes|=r,Sl|=r,d)}function Ti(r,s,d,_){return Zr(d,s)?d:hl.current!==null?(r=$n(r,d,_),Zr(r,s)||(fr=!0),r):(Js&42)===0||(Js&1073741824)!==0&&(Cn&261930)===0?(fr=!0,r.memoizedState=d):(r=Pg(),pn.lanes|=r,Sl|=r,s)}function hi(r,s,d,_,M){var P=Xe.p;Xe.p=P!==0&&8>P?P:8;var V=Se.T,te={};Se.T=te,Kr(r,!1,s,d);try{var Me=M(),Ye=Se.S;if(Ye!==null&&Ye(te,Me),Me!==null&&typeof Me=="object"&&typeof Me.then=="function"){var dt=su(Me,_);is(r,s,dt,Ua(r))}else is(r,s,_,Ua(r))}catch(vt){is(r,s,{then:function(){},status:"rejected",reason:vt},Ua())}finally{Xe.p=P,V!==null&&te.types!==null&&(V.types=te.types),Se.T=V}}function hr(){}function Ii(r,s,d,_){if(r.tag!==5)throw Error(S(476));var M=ki(r).queue;hi(r,M,s,_t,d===null?hr:function(){return dr(r),d(_)})}function ki(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:_t,baseState:_t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:_t},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ts,lastRenderedState:d},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function dr(r){var s=ki(r);s.next===null&&(s=r.alternate.memoizedState),is(r,s.next.queue,{},Ua())}function Rs(){return Hi(Bh)}function Ls(){return yi().memoizedState}function ns(){return yi().memoizedState}function Wr(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var d=Ua();r=Is(d);var _=Ks(s,r,d);_!==null&&(Va(_,s,d),ka(_,s,d)),s={cache:As()},r.payload=s;return}s=s.return}}function yl(r,s,d){var _=Ua();d={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},ya(r)?Oa(s,d):(d=So(r,s,d,_),d!==null&&(Va(d,r,_),Ba(d,s,_)))}function cc(r,s,d){var _=Ua();is(r,s,d,_)}function is(r,s,d,_){var M={lane:_,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(ya(r))Oa(s,M);else{var P=r.alternate;if(r.lanes===0&&(P===null||P.lanes===0)&&(P=s.lastRenderedReducer,P!==null))try{var V=s.lastRenderedState,te=P(V,d);if(M.hasEagerState=!0,M.eagerState=te,Zr(te,V))return iu(r,s,M,0),_i===null&&sl(),!1}catch{}if(d=So(r,s,M,_),d!==null)return Va(d,r,_),Ba(d,s,_),!0}return!1}function Kr(r,s,d,_){if(_={lane:2,revertLane:Mm(),gesture:null,action:_,hasEagerState:!1,eagerState:null,next:null},ya(r)){if(s)throw Error(S(479))}else s=So(r,d,_,2),s!==null&&Va(s,r,2)}function ya(r){var s=r.alternate;return r===pn||s!==null&&s===pn}function Oa(r,s){La=gi=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function Ba(r,s,d){if((d&4194048)!==0){var _=s.lanes;_&=r.pendingLanes,d|=_,s.lanes=d,Ai(r,d)}}var qn={readContext:Hi,use:gl,useCallback:ci,useContext:ci,useEffect:ci,useImperativeHandle:ci,useLayoutEffect:ci,useInsertionEffect:ci,useMemo:ci,useReducer:ci,useRef:ci,useState:ci,useDebugValue:ci,useDeferredValue:ci,useTransition:ci,useSyncExternalStore:ci,useId:ci,useHostTransitionStatus:ci,useFormState:ci,useActionState:ci,useOptimistic:ci,useMemoCache:ci,useCacheRefresh:ci};qn.useEffectEvent=ci;var ti={readContext:Hi,use:gl,useCallback:function(r,s){return wr().memoizedState=[r,s===void 0?null:s],r},useContext:Hi,useEffect:qe,useImperativeHandle:function(r,s,d){d=d!=null?d.concat([r]):null,Ze(4194308,4,an.bind(null,s,r),d)},useLayoutEffect:function(r,s){return Ze(4194308,4,r,s)},useInsertionEffect:function(r,s){Ze(4,2,r,s)},useMemo:function(r,s){var d=wr();s=s===void 0?null:s;var _=r();if(Ja){Oe(!0);try{r()}finally{Oe(!1)}}return d.memoizedState=[_,s],_},useReducer:function(r,s,d){var _=wr();if(d!==void 0){var M=d(s);if(Ja){Oe(!0);try{d(s)}finally{Oe(!1)}}}else M=s;return _.memoizedState=_.baseState=M,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:M},_.queue=r,r=r.dispatch=yl.bind(null,pn,r),[_.memoizedState,r]},useRef:function(r){var s=wr();return r={current:r},s.memoizedState=r},useState:function(r){r=R(r);var s=r.queue,d=cc.bind(null,pn,s);return s.dispatch=d,[r.memoizedState,d]},useDebugValue:ri,useDeferredValue:function(r,s){var d=wr();return $n(d,r,s)},useTransition:function(){var r=R(!1);return r=hi.bind(null,pn,r.queue,!0,!1),wr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,d){var _=pn,M=wr();if(bn){if(d===void 0)throw Error(S(407));d=d()}else{if(d=s(),_i===null)throw Error(S(349));(Cn&127)!==0||f(_,s,d)}M.memoizedState=d;var P={value:d,getSnapshot:s};return M.queue=P,qe(w.bind(null,_,P,r),[r]),_.flags|=2048,me(9,{destroy:void 0},v.bind(null,_,P,d,s),null),d},useId:function(){var r=wr(),s=_i.identifierPrefix;if(bn){var d=Hr,_=bs;d=(_&~(1<<32-Je(_)-1)).toString(32)+d,s="_"+s+"R_"+d,d=fl++,0<d&&(s+="H"+d.toString(32)),s+="_"}else d=gd++,s="_"+s+"r_"+d.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:Rs,useFormState:ue,useActionState:ue,useOptimistic:function(r){var s=wr();s.memoizedState=s.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=Kr.bind(null,pn,!0,d),d.dispatch=s,[r,s]},useMemoCache:lc,useCacheRefresh:function(){return wr().memoizedState=Wr.bind(null,pn)},useEffectEvent:function(r){var s=wr(),d={impl:r};return s.memoizedState=d,function(){if((ni&2)!==0)throw Error(S(440));return d.impl.apply(void 0,arguments)}}},$i={readContext:Hi,use:gl,useCallback:ei,useContext:Hi,useEffect:Ge,useImperativeHandle:jn,useInsertionEffect:pt,useLayoutEffect:At,useMemo:ui,useReducer:y,useRef:Ce,useState:function(){return y(ts)},useDebugValue:ri,useDeferredValue:function(r,s){var d=yi();return Ti(d,Fn.memoizedState,r,s)},useTransition:function(){var r=y(ts)[0],s=yi().memoizedState;return[typeof r=="boolean"?r:ml(r),s]},useSyncExternalStore:c,useId:Ls,useHostTransitionStatus:Rs,useFormState:ve,useActionState:ve,useOptimistic:function(r,s){var d=yi();return O(d,Fn,r,s)},useMemoCache:lc,useCacheRefresh:ns};$i.useEffectEvent=Et;var Ji={readContext:Hi,use:gl,useCallback:ei,useContext:Hi,useEffect:Ge,useImperativeHandle:jn,useInsertionEffect:pt,useLayoutEffect:At,useMemo:ui,useReducer:a,useRef:Ce,useState:function(){return a(ts)},useDebugValue:ri,useDeferredValue:function(r,s){var d=yi();return Fn===null?$n(d,r,s):Ti(d,Fn.memoizedState,r,s)},useTransition:function(){var r=a(ts)[0],s=yi().memoizedState;return[typeof r=="boolean"?r:ml(r),s]},useSyncExternalStore:c,useId:Ls,useHostTransitionStatus:Rs,useFormState:Ee,useActionState:Ee,useOptimistic:function(r,s){var d=yi();return Fn!==null?O(d,Fn,r,s):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:lc,useCacheRefresh:ns};Ji.useEffectEvent=Et;function gh(r,s,d,_){s=r.memoizedState,d=d(_,s),d=d==null?s:re({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var yh={enqueueSetState:function(r,s,d){r=r._reactInternals;var _=Ua(),M=Is(_);M.payload=s,d!=null&&(M.callback=d),s=Ks(r,M,_),s!==null&&(Va(s,r,_),ka(s,r,_))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var _=Ua(),M=Is(_);M.tag=1,M.payload=s,d!=null&&(M.callback=d),s=Ks(r,M,_),s!==null&&(Va(s,r,_),ka(s,r,_))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=Ua(),_=Is(d);_.tag=2,s!=null&&(_.callback=s),s=Ks(r,_,d),s!==null&&(Va(s,r,d),ka(s,r,d))}};function ko(r,s,d,_,M,P,V){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(_,P,V):s.prototype&&s.prototype.isPureReactComponent?!To(d,_)||!To(M,P):!0}function Bf(r,s,d,_){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,_),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,_),s.state!==r&&yh.enqueueReplaceState(s,s.state,null)}function Ro(r,s){var d=s;if("ref"in s){d={};for(var _ in s)_!=="ref"&&(d[_]=s[_])}if(r=r.defaultProps){d===s&&(d=re({},d));for(var M in r)d[M]===void 0&&(d[M]=r[M])}return d}function _h(r){vs(r)}function no(r){console.error(r)}function io(r){vs(r)}function rs(r,s){try{var d=r.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(_){setTimeout(function(){throw _})}}function vh(r,s,d){try{var _=r.onCaughtError;_(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(M){setTimeout(function(){throw M})}}function _u(r,s,d){return d=Is(d),d.tag=3,d.payload={element:null},d.callback=function(){rs(r,s)},d}function vu(r){return r=Is(r),r.tag=3,r}function xu(r,s,d,_){var M=d.type.getDerivedStateFromError;if(typeof M=="function"){var P=_.value;r.payload=function(){return M(P)},r.callback=function(){vh(s,d,_)}}var V=d.stateNode;V!==null&&typeof V.componentDidCatch=="function"&&(r.callback=function(){vh(s,d,_),typeof M!="function"&&(El===null?El=new Set([this]):El.add(this));var te=_.stack;this.componentDidCatch(_.value,{componentStack:te!==null?te:""})})}function Nf(r,s,d,_,M){if(d.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){if(s=d.alternate,s!==null&&pa(s,d,M,!0),d=Lt.current,d!==null){switch(d.tag){case 31:case 13:return Vt===null?Ld():d.alternate===null&&Xi===0&&(Xi=3),d.flags&=-257,d.flags|=65536,d.lanes=M,_===kt?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([_]):s.add(_),cp(r,_,M)),!1;case 22:return d.flags|=65536,_===kt?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([_])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([_]):d.add(_)),cp(r,_,M)),!1}throw Error(S(435,d.tag))}return cp(r,_,M),Ld(),!1}if(bn)return s=Lt.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=M,_!==bi&&(r=Error(S(422),{cause:_}),$s(Vr(r,d)))):(_!==bi&&(s=Error(S(423),{cause:_}),$s(Vr(s,d))),r=r.current.alternate,r.flags|=65536,M&=-M,r.lanes|=M,_=Vr(_,d),M=_u(r.stateNode,_,M),Vn(r,M),Xi!==4&&(Xi=2)),!1;var P=Error(S(520),{cause:_});if(P=Vr(P,d),Pd===null?Pd=[P]:Pd.push(P),Xi!==4&&(Xi=2),s===null)return!0;_=Vr(_,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,r=M&-M,d.lanes|=r,r=_u(d.stateNode,_,r),Vn(d,r),!1;case 1:if(s=d.type,P=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||P!==null&&typeof P.componentDidCatch=="function"&&(El===null||!El.has(P))))return d.flags|=65536,M&=-M,d.lanes|=M,M=vu(M),xu(M,r,d,_),Vn(d,M),!1}d=d.return}while(d!==null);return!1}var Ff=Error(S(461)),fr=!1;function Tr(r,s,d,_){s.child=r===null?fd(s,null,d,_):Ds(s,r.child,d,_)}function pg(r,s,d,_,M){d=d.render;var P=s.ref;if("ref"in _){var V={};for(var te in _)te!=="ref"&&(V[te]=_[te])}else V=_;return Ws(s),_=sc(r,s,d,V,P,M),te=yu(),r!==null&&!fr?(Io(r,s,M),Oo(r,s,M)):(bn&&te&&ll(s),s.flags|=1,Tr(r,s,_,M),s.child)}function jf(r,s,d,_,M){if(r===null){var P=d.type;return typeof P=="function"&&!ih(P)&&P.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=P,tm(r,s,P,_,M)):(r=rh(d.type,null,_,s,s.mode,M),r.ref=s.ref,r.return=s,s.child=r)}if(P=r.child,!vd(r,M)){var V=P.memoizedProps;if(d=d.compare,d=d!==null?d:To,d(V,_)&&r.ref===s.ref)return Oo(r,s,M)}return s.flags|=1,r=da(P,_),r.ref=s.ref,r.return=s,s.child=r}function tm(r,s,d,_,M){if(r!==null){var P=r.memoizedProps;if(To(P,_)&&r.ref===s.ref)if(fr=!1,s.pendingProps=_=P,vd(r,M))(r.flags&131072)!==0&&(fr=!0);else return s.lanes=r.lanes,Oo(r,s,M)}return im(r,s,d,_,M)}function nm(r,s,d,_){var M=_.children,P=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.mode==="hidden"){if((s.flags&128)!==0){if(P=P!==null?P.baseLanes|d:d,r!==null){for(_=s.child=r.child,M=0;_!==null;)M=M|_.lanes|_.childLanes,_=_.sibling;_=M&~P}else _=0,s.child=null;return mg(r,s,P,d,_)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&uh(s,P!==null?P.cachePool:null),P!==null?md(s,P):ga(),fu(s);else return _=s.lanes=536870912,mg(r,s,P!==null?P.baseLanes|d:d,d,_)}else P!==null?(uh(s,P.cachePool),md(s,P),Ui(),s.memoizedState=null):(r!==null&&uh(s,null),ga(),Ui());return Tr(r,s,M,d),s.child}function Lo(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function mg(r,s,d,_,M){var P=ch();return P=P===null?null:{parent:ji._currentValue,pool:P},s.memoizedState={baseLanes:d,cachePool:P},r!==null&&uh(s,null),ga(),fu(s),r!==null&&pa(r,s,_,!0),s.childLanes=M,null}function _l(r,s){return s=Zf({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function yd(r,s,d){return Ds(s,r.child,null,d),r=_l(s,s.pendingProps),r.flags|=2,wi(s),s.memoizedState=null,r}function Uf(r,s,d){var _=s.pendingProps,M=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(bn){if(_.mode==="hidden")return r=_l(s,_),s.lanes=536870912,Lo(null,r);if(ac(s),(r=Jn)?(r=vc(r,fa),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:xs!==null?{id:bs,overflow:Hr}:null,retryLane:536870912,hydrationErrors:null},d=ah(r),d.return=s,s.child=d,ur=s,Jn=null)):r=null,r===null)throw $r(s);return s.lanes=536870912,null}return _l(s,_)}var P=r.memoizedState;if(P!==null){var V=P.dehydrated;if(ac(s),M)if(s.flags&256)s.flags&=-257,s=yd(r,s,d);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(S(558));else if(fr||pa(r,s,d,!1),M=(d&r.childLanes)!==0,fr||M){if(_=_i,_!==null&&(V=ho(_,d),V!==0&&V!==P.retryLane))throw P.retryLane=V,Da(r,V),Va(_,r,V),Ff;Ld(),s=yd(r,s,d)}else r=P.treeContext,Jn=os(V.nextSibling),ur=s,bn=!0,Hs=null,fa=!1,r!==null&&ud(s,r),s=_l(s,_),s.flags|=4096;return s}return r=da(r.child,{mode:_.mode,children:_.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Vf(r,s){var d=s.ref;if(d===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(S(284));(r===null||r.ref!==d)&&(s.flags|=4194816)}}function im(r,s,d,_,M){return Ws(s),d=sc(r,s,d,_,void 0,M),_=yu(),r!==null&&!fr?(Io(r,s,M),Oo(r,s,M)):(bn&&_&&ll(s),s.flags|=1,Tr(r,s,d,M),s.child)}function gg(r,s,d,_,M,P){return Ws(s),s.updateQueue=null,d=mu(s,_,d,M),oc(r),_=yu(),r!==null&&!fr?(Io(r,s,P),Oo(r,s,P)):(bn&&_&&ll(s),s.flags|=1,Tr(r,s,d,P),s.child)}function yg(r,s,d,_,M){if(Ws(s),s.stateNode===null){var P=cn,V=d.contextType;typeof V=="object"&&V!==null&&(P=Hi(V)),P=new d(_,P),s.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,P.updater=yh,s.stateNode=P,P._reactInternals=s,P=s.stateNode,P.props=_,P.state=s.memoizedState,P.refs={},ph(s),V=d.contextType,P.context=typeof V=="object"&&V!==null?Hi(V):cn,P.state=s.memoizedState,V=d.getDerivedStateFromProps,typeof V=="function"&&(gh(s,d,V,_),P.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(V=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),V!==P.state&&yh.enqueueReplaceState(P,P.state,null),Po(s,_,P,M),Qs(),P.state=s.memoizedState),typeof P.componentDidMount=="function"&&(s.flags|=4194308),_=!0}else if(r===null){P=s.stateNode;var te=s.memoizedProps,Me=Ro(d,te);P.props=Me;var Ye=P.context,dt=d.contextType;V=cn,typeof dt=="object"&&dt!==null&&(V=Hi(dt));var vt=d.getDerivedStateFromProps;dt=typeof vt=="function"||typeof P.getSnapshotBeforeUpdate=="function",te=s.pendingProps!==te,dt||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(te||Ye!==V)&&Bf(s,P,_,V),Ps=!1;var We=s.memoizedState;P.state=We,Po(s,_,P,M),Qs(),Ye=s.memoizedState,te||We!==Ye||Ps?(typeof vt=="function"&&(gh(s,d,vt,_),Ye=s.memoizedState),(Me=Ps||ko(s,d,Me,_,We,Ye,V))?(dt||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(s.flags|=4194308)):(typeof P.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=_,s.memoizedState=Ye),P.props=_,P.state=Ye,P.context=V,_=Me):(typeof P.componentDidMount=="function"&&(s.flags|=4194308),_=!1)}else{P=s.stateNode,uu(r,s),V=s.memoizedProps,dt=Ro(d,V),P.props=dt,vt=s.pendingProps,We=P.context,Ye=d.contextType,Me=cn,typeof Ye=="object"&&Ye!==null&&(Me=Hi(Ye)),te=d.getDerivedStateFromProps,(Ye=typeof te=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(V!==vt||We!==Me)&&Bf(s,P,_,Me),Ps=!1,We=s.memoizedState,P.state=We,Po(s,_,P,M),Qs();var et=s.memoizedState;V!==vt||We!==et||Ps||r!==null&&r.dependencies!==null&&tc(r.dependencies)?(typeof te=="function"&&(gh(s,d,te,_),et=s.memoizedState),(dt=Ps||ko(s,d,dt,_,We,et,Me)||r!==null&&r.dependencies!==null&&tc(r.dependencies))?(Ye||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(_,et,Me),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(_,et,Me)),typeof P.componentDidUpdate=="function"&&(s.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&We===r.memoizedState||(s.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&We===r.memoizedState||(s.flags|=1024),s.memoizedProps=_,s.memoizedState=et),P.props=_,P.state=et,P.context=Me,_=dt):(typeof P.componentDidUpdate!="function"||V===r.memoizedProps&&We===r.memoizedState||(s.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||V===r.memoizedProps&&We===r.memoizedState||(s.flags|=1024),_=!1)}return P=_,Vf(r,s),_=(s.flags&128)!==0,P||_?(P=s.stateNode,d=_&&typeof d.getDerivedStateFromError!="function"?null:P.render(),s.flags|=1,r!==null&&_?(s.child=Ds(s,r.child,null,M),s.child=Ds(s,null,d,M)):Tr(r,s,d,M),s.memoizedState=P.state,r=s.child):r=Oo(r,s,M),r}function _g(r,s,d,_){return Ts(),s.flags|=256,Tr(r,s,d,_),s.child}var qf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _d(r){return{baseLanes:r,cachePool:Of()}}function Gf(r,s,d){return r=r!==null?r.childLanes&~d:0,s&&(r|=qr),r}function rm(r,s,d){var _=s.pendingProps,M=!1,P=(s.flags&128)!==0,V;if((V=P)||(V=r!==null&&r.memoizedState===null?!1:(Pi.current&2)!==0),V&&(M=!0,s.flags&=-129),V=(s.flags&32)!==0,s.flags&=-33,r===null){if(bn){if(M?Ra(s):Ui(),(r=Jn)?(r=vc(r,fa),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:xs!==null?{id:bs,overflow:Hr}:null,retryLane:536870912,hydrationErrors:null},d=ah(r),d.return=s,s.child=d,ur=s,Jn=null)):r=null,r===null)throw $r(s);return er(r)?s.lanes=32:s.lanes=536870912,null}var te=_.children;return _=_.fallback,M?(Ui(),M=s.mode,te=Zf({mode:"hidden",children:te},M),_=Eo(_,M,d,null),te.return=s,_.return=s,te.sibling=_,s.child=te,_=s.child,_.memoizedState=_d(d),_.childLanes=Gf(r,V,d),s.memoizedState=qf,Lo(null,_)):(Ra(s),am(s,te))}var Me=r.memoizedState;if(Me!==null&&(te=Me.dehydrated,te!==null)){if(P)s.flags&256?(Ra(s),s.flags&=-257,s=Hf(r,s,d)):s.memoizedState!==null?(Ui(),s.child=r.child,s.flags|=128,s=null):(Ui(),te=_.fallback,M=s.mode,_=Zf({mode:"visible",children:_.children},M),te=Eo(te,M,d,null),te.flags|=2,_.return=s,te.return=s,_.sibling=te,s.child=_,Ds(s,r.child,null,d),_=s.child,_.memoizedState=_d(d),_.childLanes=Gf(r,V,d),s.memoizedState=qf,s=Lo(null,_));else if(Ra(s),er(te)){if(V=te.nextSibling&&te.nextSibling.dataset,V)var Ye=V.dgst;V=Ye,_=Error(S(419)),_.stack="",_.digest=V,$s({value:_,source:null,stack:null}),s=Hf(r,s,d)}else if(fr||pa(r,s,d,!1),V=(d&r.childLanes)!==0,fr||V){if(V=_i,V!==null&&(_=ho(V,d),_!==0&&_!==Me.retryLane))throw Me.retryLane=_,Da(r,_),Va(V,r,_),Ff;Jr(te)||Ld(),s=Hf(r,s,d)}else Jr(te)?(s.flags|=192,s.child=r.child,s=null):(r=Me.treeContext,Jn=os(te.nextSibling),ur=s,bn=!0,Hs=null,fa=!1,r!==null&&ud(s,r),s=am(s,_.children),s.flags|=4096);return s}return M?(Ui(),te=_.fallback,M=s.mode,Me=r.child,Ye=Me.sibling,_=da(Me,{mode:"hidden",children:_.children}),_.subtreeFlags=Me.subtreeFlags&65011712,Ye!==null?te=da(Ye,te):(te=Eo(te,M,d,null),te.flags|=2),te.return=s,_.return=s,_.sibling=te,s.child=_,Lo(null,_),_=s.child,te=r.child.memoizedState,te===null?te=_d(d):(M=te.cachePool,M!==null?(Me=ji._currentValue,M=M.parent!==Me?{parent:Me,pool:Me}:M):M=Of(),te={baseLanes:te.baseLanes|d,cachePool:M}),_.memoizedState=te,_.childLanes=Gf(r,V,d),s.memoizedState=qf,Lo(r.child,_)):(Ra(s),d=r.child,r=d.sibling,d=da(d,{mode:"visible",children:_.children}),d.return=s,d.sibling=null,r!==null&&(V=s.deletions,V===null?(s.deletions=[r],s.flags|=16):V.push(r)),s.child=d,s.memoizedState=null,d)}function am(r,s){return s=Zf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Zf(r,s){return r=ha(22,r,null,s),r.lanes=0,r}function Hf(r,s,d){return Ds(s,r.child,null,d),r=am(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function sm(r,s,d){r.lanes|=s;var _=r.alternate;_!==null&&(_.lanes|=s),sh(r.return,s,d)}function om(r,s,d,_,M,P){var V=r.memoizedState;V===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:_,tail:d,tailMode:M,treeForkCount:P}:(V.isBackwards=s,V.rendering=null,V.renderingStartTime=0,V.last=_,V.tail=d,V.tailMode=M,V.treeForkCount=P)}function $f(r,s,d){var _=s.pendingProps,M=_.revealOrder,P=_.tail;_=_.children;var V=Pi.current,te=(V&2)!==0;if(te?(V=V&1|2,s.flags|=128):V&=1,bt(Pi,V),Tr(r,s,_,d),_=bn?zo:0,!te&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&sm(r,d,s);else if(r.tag===19)sm(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(M){case"forwards":for(d=s.child,M=null;d!==null;)r=d.alternate,r!==null&&pu(r)===null&&(M=d),d=d.sibling;d=M,d===null?(M=s.child,s.child=null):(M=d.sibling,d.sibling=null),om(s,!1,M,d,P,_);break;case"backwards":case"unstable_legacy-backwards":for(d=null,M=s.child,s.child=null;M!==null;){if(r=M.alternate,r!==null&&pu(r)===null){s.child=M;break}r=M.sibling,M.sibling=d,d=M,M=r}om(s,!0,d,null,P,_);break;case"together":om(s,!1,null,null,void 0,_);break;default:s.memoizedState=null}return s.child}function Oo(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),Sl|=s.lanes,(d&s.childLanes)===0)if(r!==null){if(pa(r,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(S(153));if(s.child!==null){for(r=s.child,d=da(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=da(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function vd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&tc(r)))}function xd(r,s,d){switch(s.tag){case 3:mn(s,s.stateNode.containerInfo),Ys(s,ji,r.memoizedState.cache),Ts();break;case 27:case 5:wn(s);break;case 4:mn(s,s.stateNode.containerInfo);break;case 10:Ys(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,ac(s),null;break;case 13:var _=s.memoizedState;if(_!==null)return _.dehydrated!==null?(Ra(s),s.flags|=128,null):(d&s.child.childLanes)!==0?rm(r,s,d):(Ra(s),r=Oo(r,s,d),r!==null?r.sibling:null);Ra(s);break;case 19:var M=(r.flags&128)!==0;if(_=(d&s.childLanes)!==0,_||(pa(r,s,d,!1),_=(d&s.childLanes)!==0),M){if(_)return $f(r,s,d);s.flags|=128}if(M=s.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),bt(Pi,Pi.current),_)break;return null;case 22:return s.lanes=0,nm(r,s,d,s.pendingProps);case 24:Ys(s,ji,r.memoizedState.cache)}return Oo(r,s,d)}function Qr(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps)fr=!0;else{if(!vd(r,d)&&(s.flags&128)===0)return fr=!1,xd(r,s,d);fr=(r.flags&131072)!==0}else fr=!1,bn&&(s.flags&1048576)!==0&&cd(s,zo,s.index);switch(s.lanes=0,s.tag){case 16:e:{var _=s.pendingProps;if(r=Ia(s.elementType),s.type=r,typeof r=="function")ih(r)?(_=Ro(r,_),s.tag=1,s=yg(null,s,r,_,d)):(s.tag=0,s=im(null,s,r,_,d));else{if(r!=null){var M=r.$$typeof;if(M===zt){s.tag=11,s=pg(null,s,r,_,d);break e}else if(M===ot){s.tag=14,s=jf(null,s,r,_,d);break e}}throw s=qt(r)||r,Error(S(306,s,""))}}return s;case 0:return im(r,s,s.type,s.pendingProps,d);case 1:return _=s.type,M=Ro(_,s.pendingProps),yg(r,s,_,M,d);case 3:e:{if(mn(s,s.stateNode.containerInfo),r===null)throw Error(S(387));_=s.pendingProps;var P=s.memoizedState;M=P.element,uu(r,s),Po(s,_,null,d);var V=s.memoizedState;if(_=V.cache,Ys(s,ji,_),_!==P.cache&&oh(s,[ji],d,!0),Qs(),_=V.element,P.isDehydrated)if(P={element:_,isDehydrated:!1,cache:V.cache},s.updateQueue.baseState=P,s.memoizedState=P,s.flags&256){s=_g(r,s,_,d);break e}else if(_!==M){M=Vr(Error(S(424)),s),$s(M),s=_g(r,s,_,d);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Jn=os(r.firstChild),ur=s,bn=!0,Hs=null,fa=!0,d=fd(s,null,_,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ts(),_===M){s=Oo(r,s,d);break e}Tr(r,s,_,d)}s=s.child}return s;case 26:return Vf(r,s),r===null?(d=Um(s.type,null,s.pendingProps,null))?s.memoizedState=d:bn||(d=s.type,r=s.pendingProps,_=Ud(Xt.current).createElement(d),_[Tn]=s,_[ft]=r,Er(_,d,r),Ci(_),s.stateNode=_):s.memoizedState=Um(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return wn(s),r===null&&bn&&(_=s.stateNode=Qg(s.type,s.pendingProps,Xt.current),ur=s,fa=!0,M=Jn,_c(s.type)?(ba=M,Jn=os(_.firstChild)):Jn=M),Tr(r,s,s.pendingProps.children,d),Vf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&bn&&((M=_=Jn)&&(_=Pr(_,s.type,s.pendingProps,fa),_!==null?(s.stateNode=_,ur=s,Jn=os(_.firstChild),fa=!1,M=!0):M=!1),M||$r(s)),wn(s),M=s.type,P=s.pendingProps,V=r!==null?r.memoizedProps:null,_=P.children,xp(M,P)?_=null:V!==null&&xp(M,V)&&(s.flags|=32),s.memoizedState!==null&&(M=sc(r,s,gu,null,null,d),Bh._currentValue=M),Vf(r,s),Tr(r,s,_,d),s.child;case 6:return r===null&&bn&&((r=d=Jn)&&(d=lo(d,s.pendingProps,fa),d!==null?(s.stateNode=d,ur=s,Jn=null,r=!0):r=!1),r||$r(s)),null;case 13:return rm(r,s,d);case 4:return mn(s,s.stateNode.containerInfo),_=s.pendingProps,r===null?s.child=Ds(s,null,_,d):Tr(r,s,_,d),s.child;case 11:return pg(r,s,s.type,s.pendingProps,d);case 7:return Tr(r,s,s.pendingProps,d),s.child;case 8:return Tr(r,s,s.pendingProps.children,d),s.child;case 12:return Tr(r,s,s.pendingProps.children,d),s.child;case 10:return _=s.pendingProps,Ys(s,s.type,_.value),Tr(r,s,_.children,d),s.child;case 9:return M=s.type._context,_=s.pendingProps.children,Ws(s),M=Hi(M),_=_(M),s.flags|=1,Tr(r,s,_,d),s.child;case 14:return jf(r,s,s.type,s.pendingProps,d);case 15:return tm(r,s,s.type,s.pendingProps,d);case 19:return $f(r,s,d);case 31:return Uf(r,s,d);case 22:return nm(r,s,d,s.pendingProps);case 24:return Ws(s),_=Hi(ji),r===null?(M=ch(),M===null&&(M=_i,P=As(),M.pooledCache=P,P.refCount++,P!==null&&(M.pooledCacheLanes|=d),M=P),s.memoizedState={parent:_,cache:M},ph(s),Ys(s,ji,M)):((r.lanes&d)!==0&&(uu(r,s),Po(s,null,null,d),Qs()),M=r.memoizedState,P=s.memoizedState,M.parent!==_?(M={parent:_,cache:_},s.memoizedState=M,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=M),Ys(s,ji,_)):(_=P.cache,Ys(s,ji,_),_!==M.cache&&oh(s,[ji],d,!0))),Tr(r,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(S(156,s.tag))}function Bo(r){r.flags|=4}function bd(r,s,d,_,M){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(M&335544128)===M)if(r.stateNode.complete)r.flags|=8192;else if(vm())r.flags|=8192;else throw Qa=kt,Do}else r.flags&=-16777217}function vg(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Zd(s))if(vm())r.flags|=8192;else throw Qa=kt,Do}function wd(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?In():536870912,r.lanes|=s,Eu|=s)}function Td(r,s){if(!bn)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var _=null;d!==null;)d.alternate!==null&&(_=d),d=d.sibling;_===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:_.sibling=null}}function Ri(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,_=0;if(s)for(var M=r.child;M!==null;)d|=M.lanes|M.childLanes,_|=M.subtreeFlags&65011712,_|=M.flags&65011712,M.return=r,M=M.sibling;else for(M=r.child;M!==null;)d|=M.lanes|M.childLanes,_|=M.subtreeFlags,_|=M.flags,M.return=r,M=M.sibling;return r.subtreeFlags|=_,r.childLanes=d,s}function xg(r,s,d){var _=s.pendingProps;switch(ec(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ri(s),null;case 1:return Ri(s),null;case 3:return d=s.stateNode,_=null,r!==null&&(_=r.memoizedState.cache),s.memoizedState.cache!==_&&(s.flags|=2048),Ms(ji),Kt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(ws(s)?Bo(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ss())),Ri(s),null;case 26:var M=s.type,P=s.memoizedState;return r===null?(Bo(s),P!==null?(Ri(s),vg(s,P)):(Ri(s),bd(s,M,null,_,d))):P?P!==r.memoizedState?(Bo(s),Ri(s),vg(s,P)):(Ri(s),s.flags&=-16777217):(r=r.memoizedProps,r!==_&&Bo(s),Ri(s),bd(s,M,r,_,d)),null;case 27:if(br(s),d=Xt.current,M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&Bo(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Ri(s),null}r=Dt.current,ws(s)?Xr(s):(r=Qg(M,_,d),s.stateNode=r,Bo(s))}return Ri(s),null;case 5:if(br(s),M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==_&&Bo(s);else{if(!_){if(s.stateNode===null)throw Error(S(166));return Ri(s),null}if(P=Dt.current,ws(s))Xr(s);else{var V=Ud(Xt.current);switch(P){case 1:P=V.createElementNS("http://www.w3.org/2000/svg",M);break;case 2:P=V.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;default:switch(M){case"svg":P=V.createElementNS("http://www.w3.org/2000/svg",M);break;case"math":P=V.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;case"script":P=V.createElement("div"),P.innerHTML="<script><\/script>",P=P.removeChild(P.firstChild);break;case"select":P=typeof _.is=="string"?V.createElement("select",{is:_.is}):V.createElement("select"),_.multiple?P.multiple=!0:_.size&&(P.size=_.size);break;default:P=typeof _.is=="string"?V.createElement(M,{is:_.is}):V.createElement(M)}}P[Tn]=s,P[ft]=_;e:for(V=s.child;V!==null;){if(V.tag===5||V.tag===6)P.appendChild(V.stateNode);else if(V.tag!==4&&V.tag!==27&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===s)break e;for(;V.sibling===null;){if(V.return===null||V.return===s)break e;V=V.return}V.sibling.return=V.return,V=V.sibling}s.stateNode=P;e:switch(Er(P,M,_),M){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}_&&Bo(s)}}return Ri(s),bd(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,d),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==_&&Bo(s);else{if(typeof _!="string"&&s.stateNode===null)throw Error(S(166));if(r=Xt.current,ws(s)){if(r=s.stateNode,d=s.memoizedProps,_=null,M=ur,M!==null)switch(M.tag){case 27:case 5:_=M.memoizedProps}r[Tn]=s,r=!!(r.nodeValue===d||_!==null&&_.suppressHydrationWarning===!0||Pm(r.nodeValue,d)),r||$r(s,!0)}else r=Ud(r).createTextNode(_),r[Tn]=s,s.stateNode=r}return Ri(s),null;case 31:if(d=s.memoizedState,r===null||r.memoizedState!==null){if(_=ws(s),d!==null){if(r===null){if(!_)throw Error(S(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(S(557));r[Tn]=s}else Ts(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ri(s),r=!1}else d=Ss(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return s.flags&256?(wi(s),s):(wi(s),null);if((s.flags&128)!==0)throw Error(S(558))}return Ri(s),null;case 13:if(_=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(M=ws(s),_!==null&&_.dehydrated!==null){if(r===null){if(!M)throw Error(S(318));if(M=s.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(S(317));M[Tn]=s}else Ts(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ri(s),M=!1}else M=Ss(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=M),M=!0;if(!M)return s.flags&256?(wi(s),s):(wi(s),null)}return wi(s),(s.flags&128)!==0?(s.lanes=d,s):(d=_!==null,r=r!==null&&r.memoizedState!==null,d&&(_=s.child,M=null,_.alternate!==null&&_.alternate.memoizedState!==null&&_.alternate.memoizedState.cachePool!==null&&(M=_.alternate.memoizedState.cachePool.pool),P=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(P=_.memoizedState.cachePool.pool),P!==M&&(_.flags|=2048)),d!==r&&d&&(s.child.flags|=8192),wd(s,s.updateQueue),Ri(s),null);case 4:return Kt(),r===null&&zm(s.stateNode.containerInfo),Ri(s),null;case 10:return Ms(s.type),Ri(s),null;case 19:if(Ve(Pi),_=s.memoizedState,_===null)return Ri(s),null;if(M=(s.flags&128)!==0,P=_.rendering,P===null)if(M)Td(_,!1);else{if(Xi!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(P=pu(r),P!==null){for(s.flags|=128,Td(_,!1),r=P.updateQueue,s.updateQueue=r,wd(s,r),s.subtreeFlags=0,r=d,d=s.child;d!==null;)Rf(d,r),d=d.sibling;return bt(Pi,Pi.current&1|2),bn&&Zs(s,_.treeForkCount),s.child}r=r.sibling}_.tail!==null&&xi()>Id&&(s.flags|=128,M=!0,Td(_,!1),s.lanes=4194304)}else{if(!M)if(r=pu(P),r!==null){if(s.flags|=128,M=!0,r=r.updateQueue,s.updateQueue=r,wd(s,r),Td(_,!0),_.tail===null&&_.tailMode==="hidden"&&!P.alternate&&!bn)return Ri(s),null}else 2*xi()-_.renderingStartTime>Id&&d!==536870912&&(s.flags|=128,M=!0,Td(_,!1),s.lanes=4194304);_.isBackwards?(P.sibling=s.child,s.child=P):(r=_.last,r!==null?r.sibling=P:s.child=P,_.last=P)}return _.tail!==null?(r=_.tail,_.rendering=r,_.tail=r.sibling,_.renderingStartTime=xi(),r.sibling=null,d=Pi.current,bt(Pi,M?d&1|2:d&1),bn&&Zs(s,_.treeForkCount),r):(Ri(s),null);case 22:case 23:return wi(s),dl(),_=s.memoizedState!==null,r!==null?r.memoizedState!==null!==_&&(s.flags|=8192):_&&(s.flags|=8192),_?(d&536870912)!==0&&(s.flags&128)===0&&(Ri(s),s.subtreeFlags&6&&(s.flags|=8192)):Ri(s),d=s.updateQueue,d!==null&&wd(s,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),_=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(_=s.memoizedState.cachePool.pool),_!==d&&(s.flags|=2048),r!==null&&Ve(Wa),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Ms(ji),Ri(s),null;case 25:return null;case 30:return null}throw Error(S(156,s.tag))}function Ky(r,s){switch(ec(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Ms(ji),Kt(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return br(s),null;case 31:if(s.memoizedState!==null){if(wi(s),s.alternate===null)throw Error(S(340));Ts()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(wi(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(S(340));Ts()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Ve(Pi),null;case 4:return Kt(),null;case 10:return Ms(s.type),null;case 22:case 23:return wi(s),dl(),r!==null&&Ve(Wa),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Ms(ji),null;case 25:return null;default:return null}}function Xf(r,s){switch(ec(s),s.tag){case 3:Ms(ji),Kt();break;case 26:case 27:case 5:br(s);break;case 4:Kt();break;case 31:s.memoizedState!==null&&wi(s);break;case 13:wi(s);break;case 19:Ve(Pi);break;case 10:Ms(s.type);break;case 22:case 23:wi(s),dl(),r!==null&&Ve(Wa);break;case 24:Ms(ji)}}function xh(r,s){try{var d=s.updateQueue,_=d!==null?d.lastEffect:null;if(_!==null){var M=_.next;d=M;do{if((d.tag&r)===r){_=void 0;var P=d.create,V=d.inst;_=P(),V.destroy=_}d=d.next}while(d!==M)}}catch(te){ii(s,s.return,te)}}function vl(r,s,d){try{var _=s.updateQueue,M=_!==null?_.lastEffect:null;if(M!==null){var P=M.next;_=P;do{if((_.tag&r)===r){var V=_.inst,te=V.destroy;if(te!==void 0){V.destroy=void 0,M=s;var Me=d,Ye=te;try{Ye()}catch(dt){ii(M,Me,dt)}}}_=_.next}while(_!==P)}}catch(dt){ii(s,s.return,dt)}}function bg(r){var s=r.updateQueue;if(s!==null){var d=r.stateNode;try{mh(s,d)}catch(_){ii(r,r.return,_)}}}function wg(r,s,d){d.props=Ro(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(_){ii(r,s,_)}}function Sd(r,s){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var _=r.stateNode;break;case 30:_=r.stateNode;break;default:_=r.stateNode}typeof d=="function"?r.refCleanup=d(_):d.current=_}}catch(M){ii(r,s,M)}}function as(r,s){var d=r.ref,_=r.refCleanup;if(d!==null)if(typeof _=="function")try{_()}catch(M){ii(r,s,M)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(M){ii(r,s,M)}else d.current=null}function Yf(r){var s=r.type,d=r.memoizedProps,_=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&_.focus();break e;case"img":d.src?_.src=d.src:d.srcSet&&(_.srcset=d.srcSet)}}catch(M){ii(r,r.return,M)}}function Wf(r,s,d){try{var _=r.stateNode;Wg(_,r.type,d,s),_[ft]=s}catch(M){ii(r,r.return,M)}}function uc(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&_c(r.type)||r.tag===4}function bu(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||uc(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&_c(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function lm(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(r),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Xa));else if(_!==4&&(_===27&&_c(r.type)&&(d=r.stateNode,s=null),r=r.child,r!==null))for(lm(r,s,d),r=r.sibling;r!==null;)lm(r,s,d),r=r.sibling}function Kf(r,s,d){var _=r.tag;if(_===5||_===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(_!==4&&(_===27&&_c(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(Kf(r,s,d),r=r.sibling;r!==null;)Kf(r,s,d),r=r.sibling}function Tg(r){var s=r.stateNode,d=r.memoizedProps;try{for(var _=r.type,M=s.attributes;M.length;)s.removeAttributeNode(M[0]);Er(s,_,d),s[Tn]=r,s[ft]=d}catch(P){ii(r,r.return,P)}}var xl=!1,pr=!1,cm=!1,Sg=typeof WeakSet=="function"?WeakSet:Set,mr=null;function Qy(r,s){if(r=r.containerInfo,jd=Wd,r=Ku(r),Kc(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var _=d.getSelection&&d.getSelection();if(_&&_.rangeCount!==0){d=_.anchorNode;var M=_.anchorOffset,P=_.focusNode;_=_.focusOffset;try{d.nodeType,P.nodeType}catch{d=null;break e}var V=0,te=-1,Me=-1,Ye=0,dt=0,vt=r,We=null;t:for(;;){for(var et;vt!==d||M!==0&&vt.nodeType!==3||(te=V+M),vt!==P||_!==0&&vt.nodeType!==3||(Me=V+_),vt.nodeType===3&&(V+=vt.nodeValue.length),(et=vt.firstChild)!==null;)We=vt,vt=et;for(;;){if(vt===r)break t;if(We===d&&++Ye===M&&(te=V),We===P&&++dt===_&&(Me=V),(et=vt.nextSibling)!==null)break;vt=We,We=vt.parentNode}vt=et}d=te===-1||Me===-1?null:{start:te,end:Me}}else d=null}d=d||{start:0,end:0}}else d=null;for(Im={focusedElem:r,selectionRange:d},Wd=!1,mr=s;mr!==null;)if(s=mr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,mr=r;else for(;mr!==null;){switch(s=mr,P=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)M=r[d],M.ref.impl=M.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&P!==null){r=void 0,d=s,M=P.memoizedProps,P=P.memoizedState,_=d.stateNode;try{var Gt=Ro(d.type,M);r=_.getSnapshotBeforeUpdate(Gt,P),_.__reactInternalSnapshotBeforeUpdate=r}catch(tn){ii(d,d.return,tn)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,d=r.nodeType,d===9)oo(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":oo(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(S(163))}if(r=s.sibling,r!==null){r.return=s.return,mr=r;break}mr=s.return}}function um(r,s,d){var _=d.flags;switch(d.tag){case 0:case 11:case 15:Fa(r,d),_&4&&xh(5,d);break;case 1:if(Fa(r,d),_&4)if(r=d.stateNode,s===null)try{r.componentDidMount()}catch(V){ii(d,d.return,V)}else{var M=Ro(d.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(M,s,r.__reactInternalSnapshotBeforeUpdate)}catch(V){ii(d,d.return,V)}}_&64&&bg(d),_&512&&Sd(d,d.return);break;case 3:if(Fa(r,d),_&64&&(r=d.updateQueue,r!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{mh(r,s)}catch(V){ii(d,d.return,V)}}break;case 27:s===null&&_&4&&Tg(d);case 26:case 5:Fa(r,d),s===null&&_&4&&Yf(d),_&512&&Sd(d,d.return);break;case 12:Fa(r,d);break;case 31:Fa(r,d),_&4&&Ed(r,d);break;case 13:Fa(r,d),_&4&&Md(r,d),_&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=bm.bind(null,d),yr(r,d))));break;case 22:if(_=d.memoizedState!==null||xl,!_){s=s!==null&&s.memoizedState!==null||pr,M=xl;var P=pr;xl=_,(pr=s)&&!P?bl(r,d,(d.subtreeFlags&8772)!==0):Fa(r,d),xl=M,pr=P}break;case 30:break;default:Fa(r,d)}}function bh(r){var s=r.alternate;s!==null&&(r.alternate=null,bh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Ho(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Vi=null,Ln=!1;function Na(r,s,d){for(d=d.child;d!==null;)hm(r,s,d),d=d.sibling}function hm(r,s,d){if(ye&&typeof ye.onCommitFiberUnmount=="function")try{ye.onCommitFiberUnmount(Re,d)}catch{}switch(d.tag){case 26:pr||as(d,s),Na(r,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:pr||as(d,s);var _=Vi,M=Ln;_c(d.type)&&(Vi=d.stateNode,Ln=!1),Na(r,s,d),Rh(d.stateNode),Vi=_,Ln=M;break;case 5:pr||as(d,s);case 6:if(_=Vi,M=Ln,Vi=null,Na(r,s,d),Vi=_,Ln=M,Vi!==null)if(Ln)try{(Vi.nodeType===9?Vi.body:Vi.nodeName==="HTML"?Vi.ownerDocument.body:Vi).removeChild(d.stateNode)}catch(P){ii(d,s,P)}else try{Vi.removeChild(d.stateNode)}catch(P){ii(d,s,P)}break;case 18:Vi!==null&&(Ln?(r=Vi,Kg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),Sc(r)):Kg(Vi,d.stateNode));break;case 4:_=Vi,M=Ln,Vi=d.stateNode.containerInfo,Ln=!0,Na(r,s,d),Vi=_,Ln=M;break;case 0:case 11:case 14:case 15:vl(2,d,s),pr||vl(4,d,s),Na(r,s,d);break;case 1:pr||(as(d,s),_=d.stateNode,typeof _.componentWillUnmount=="function"&&wg(d,s,_)),Na(r,s,d);break;case 21:Na(r,s,d);break;case 22:pr=(_=pr)||d.memoizedState!==null,Na(r,s,d),pr=_;break;default:Na(r,s,d)}}function Ed(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Sc(r)}catch(d){ii(s,s.return,d)}}}function Md(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Sc(r)}catch(d){ii(s,s.return,d)}}function Ad(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Sg),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Sg),s;default:throw Error(S(435,r.tag))}}function Cd(r,s){var d=Ad(r);s.forEach(function(_){if(!d.has(_)){d.add(_);var M=t_.bind(null,r,_);_.then(M,M)}})}function _a(r,s){var d=s.deletions;if(d!==null)for(var _=0;_<d.length;_++){var M=d[_],P=r,V=s,te=V;e:for(;te!==null;){switch(te.tag){case 27:if(_c(te.type)){Vi=te.stateNode,Ln=!1;break e}break;case 5:Vi=te.stateNode,Ln=!1;break e;case 3:case 4:Vi=te.stateNode.containerInfo,Ln=!0;break e}te=te.return}if(Vi===null)throw Error(S(160));hm(P,V,M),Vi=null,Ln=!1,P=M.alternate,P!==null&&(P.return=null),M.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Qf(s,r),s=s.sibling}var va=null;function Qf(r,s){var d=r.alternate,_=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:_a(s,r),Sr(r),_&4&&(vl(3,r,r.return),xh(3,r),vl(5,r,r.return));break;case 1:_a(s,r),Sr(r),_&512&&(pr||d===null||as(d,d.return)),_&64&&xl&&(r=r.updateQueue,r!==null&&(_=r.callbacks,_!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?_:d.concat(_))));break;case 26:var M=va;if(_a(s,r),Sr(r),_&512&&(pr||d===null||as(d,d.return)),_&4){var P=d!==null?d.memoizedState:null;if(_=r.memoizedState,d===null)if(_===null)if(r.stateNode===null){e:{_=r.type,d=r.memoizedProps,M=M.ownerDocument||M;t:switch(_){case"title":P=M.getElementsByTagName("title")[0],(!P||P[sn]||P[Tn]||P.namespaceURI==="http://www.w3.org/2000/svg"||P.hasAttribute("itemprop"))&&(P=M.createElement(_),M.head.insertBefore(P,M.querySelector("head > title"))),Er(P,_,d),P[Tn]=r,Ci(P),_=P;break e;case"link":var V=Zm("link","href",M).get(_+(d.href||""));if(V){for(var te=0;te<V.length;te++)if(P=V[te],P.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&P.getAttribute("rel")===(d.rel==null?null:d.rel)&&P.getAttribute("title")===(d.title==null?null:d.title)&&P.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){V.splice(te,1);break t}}P=M.createElement(_),Er(P,_,d),M.head.appendChild(P);break;case"meta":if(V=Zm("meta","content",M).get(_+(d.content||""))){for(te=0;te<V.length;te++)if(P=V[te],P.getAttribute("content")===(d.content==null?null:""+d.content)&&P.getAttribute("name")===(d.name==null?null:d.name)&&P.getAttribute("property")===(d.property==null?null:d.property)&&P.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&P.getAttribute("charset")===(d.charSet==null?null:d.charSet)){V.splice(te,1);break t}}P=M.createElement(_),Er(P,_,d),M.head.appendChild(P);break;default:throw Error(S(468,_))}P[Tn]=r,Ci(P),_=P}r.stateNode=_}else Gd(M,r.type,r.stateNode);else r.stateNode=Gm(M,_,r.memoizedProps);else P!==_?(P===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):P.count--,_===null?Gd(M,r.type,r.stateNode):Gm(M,_,r.memoizedProps)):_===null&&r.stateNode!==null&&Wf(r,r.memoizedProps,d.memoizedProps)}break;case 27:_a(s,r),Sr(r),_&512&&(pr||d===null||as(d,d.return)),d!==null&&_&4&&Wf(r,r.memoizedProps,d.memoizedProps);break;case 5:if(_a(s,r),Sr(r),_&512&&(pr||d===null||as(d,d.return)),r.flags&32){M=r.stateNode;try{qs(M,"")}catch(Gt){ii(r,r.return,Gt)}}_&4&&r.stateNode!=null&&(M=r.memoizedProps,Wf(r,M,d!==null?d.memoizedProps:M)),_&1024&&(cm=!0);break;case 6:if(_a(s,r),Sr(r),_&4){if(r.stateNode===null)throw Error(S(162));_=r.memoizedProps,d=r.stateNode;try{d.nodeValue=_}catch(Gt){ii(r,r.return,Gt)}}break;case 3:if(Mp=null,M=va,va=Tp(s.containerInfo),_a(s,r),va=M,Sr(r),_&4&&d!==null&&d.memoizedState.isDehydrated)try{Sc(s.containerInfo)}catch(Gt){ii(r,r.return,Gt)}cm&&(cm=!1,zd(r));break;case 4:_=va,va=Tp(r.stateNode.containerInfo),_a(s,r),Sr(r),va=_;break;case 12:_a(s,r),Sr(r);break;case 31:_a(s,r),Sr(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 13:_a(s,r),Sr(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(tp=xi()),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 22:M=r.memoizedState!==null;var Me=d!==null&&d.memoizedState!==null,Ye=xl,dt=pr;if(xl=Ye||M,pr=dt||Me,_a(s,r),pr=dt,xl=Ye,Sr(r),_&8192)e:for(s=r.stateNode,s._visibility=M?s._visibility&-2:s._visibility|1,M&&(d===null||Me||xl||pr||ro(r)),d=null,s=r;;){if(s.tag===5||s.tag===26){if(d===null){Me=d=s;try{if(P=Me.stateNode,M)V=P.style,typeof V.setProperty=="function"?V.setProperty("display","none","important"):V.display="none";else{te=Me.stateNode;var vt=Me.memoizedProps.style,We=vt!=null&&vt.hasOwnProperty("display")?vt.display:null;te.style.display=We==null||typeof We=="boolean"?"":(""+We).trim()}}catch(Gt){ii(Me,Me.return,Gt)}}}else if(s.tag===6){if(d===null){Me=s;try{Me.stateNode.nodeValue=M?"":Me.memoizedProps}catch(Gt){ii(Me,Me.return,Gt)}}}else if(s.tag===18){if(d===null){Me=s;try{var et=Me.stateNode;M?yn(et,!0):yn(Me.stateNode,!1)}catch(Gt){ii(Me,Me.return,Gt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}_&4&&(_=r.updateQueue,_!==null&&(d=_.retryQueue,d!==null&&(_.retryQueue=null,Cd(r,d))));break;case 19:_a(s,r),Sr(r),_&4&&(_=r.updateQueue,_!==null&&(r.updateQueue=null,Cd(r,_)));break;case 30:break;case 21:break;default:_a(s,r),Sr(r)}}function Sr(r){var s=r.flags;if(s&2){try{for(var d,_=r.return;_!==null;){if(uc(_)){d=_;break}_=_.return}if(d==null)throw Error(S(160));switch(d.tag){case 27:var M=d.stateNode,P=bu(r);Kf(r,P,M);break;case 5:var V=d.stateNode;d.flags&32&&(qs(V,""),d.flags&=-33);var te=bu(r);Kf(r,te,V);break;case 3:case 4:var Me=d.stateNode.containerInfo,Ye=bu(r);lm(r,Ye,Me);break;default:throw Error(S(161))}}catch(dt){ii(r,r.return,dt)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function zd(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;zd(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function Fa(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)um(r,s.alternate,s),s=s.sibling}function ro(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:vl(4,s,s.return),ro(s);break;case 1:as(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&wg(s,s.return,d),ro(s);break;case 27:Rh(s.stateNode);case 26:case 5:as(s,s.return),ro(s);break;case 22:s.memoizedState===null&&ro(s);break;case 30:ro(s);break;default:ro(s)}r=r.sibling}}function bl(r,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var _=s.alternate,M=r,P=s,V=P.flags;switch(P.tag){case 0:case 11:case 15:bl(M,P,d),xh(4,P);break;case 1:if(bl(M,P,d),_=P,M=_.stateNode,typeof M.componentDidMount=="function")try{M.componentDidMount()}catch(Ye){ii(_,_.return,Ye)}if(_=P,M=_.updateQueue,M!==null){var te=_.stateNode;try{var Me=M.shared.hiddenCallbacks;if(Me!==null)for(M.shared.hiddenCallbacks=null,M=0;M<Me.length;M++)hu(Me[M],te)}catch(Ye){ii(_,_.return,Ye)}}d&&V&64&&bg(P),Sd(P,P.return);break;case 27:Tg(P);case 26:case 5:bl(M,P,d),d&&_===null&&V&4&&Yf(P),Sd(P,P.return);break;case 12:bl(M,P,d);break;case 31:bl(M,P,d),d&&V&4&&Ed(M,P);break;case 13:bl(M,P,d),d&&V&4&&Md(M,P);break;case 22:P.memoizedState===null&&bl(M,P,d),Sd(P,P.return);break;case 30:break;default:bl(M,P,d)}s=s.sibling}}function Jf(r,s){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&nc(d))}function wl(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&nc(r))}function ao(r,s,d,_){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)dm(r,s,d,_),s=s.sibling}function dm(r,s,d,_){var M=s.flags;switch(s.tag){case 0:case 11:case 15:ao(r,s,d,_),M&2048&&xh(9,s);break;case 1:ao(r,s,d,_);break;case 3:ao(r,s,d,_),M&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&nc(r)));break;case 12:if(M&2048){ao(r,s,d,_),r=s.stateNode;try{var P=s.memoizedProps,V=P.id,te=P.onPostCommit;typeof te=="function"&&te(V,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Me){ii(s,s.return,Me)}}else ao(r,s,d,_);break;case 31:ao(r,s,d,_);break;case 13:ao(r,s,d,_);break;case 23:break;case 22:P=s.stateNode,V=s.alternate,s.memoizedState!==null?P._visibility&2?ao(r,s,d,_):wu(r,s):P._visibility&2?ao(r,s,d,_):(P._visibility|=2,No(r,s,d,_,(s.subtreeFlags&10256)!==0||!1)),M&2048&&Jf(V,s);break;case 24:ao(r,s,d,_),M&2048&&wl(s.alternate,s);break;default:ao(r,s,d,_)}}function No(r,s,d,_,M){for(M=M&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var P=r,V=s,te=d,Me=_,Ye=V.flags;switch(V.tag){case 0:case 11:case 15:No(P,V,te,Me,M),xh(8,V);break;case 23:break;case 22:var dt=V.stateNode;V.memoizedState!==null?dt._visibility&2?No(P,V,te,Me,M):wu(P,V):(dt._visibility|=2,No(P,V,te,Me,M)),M&&Ye&2048&&Jf(V.alternate,V);break;case 24:No(P,V,te,Me,M),M&&Ye&2048&&wl(V.alternate,V);break;default:No(P,V,te,Me,M)}s=s.sibling}}function wu(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=r,_=s,M=_.flags;switch(_.tag){case 22:wu(d,_),M&2048&&Jf(_.alternate,_);break;case 24:wu(d,_),M&2048&&wl(_.alternate,_);break;default:wu(d,_)}s=s.sibling}}var wh=8192;function Tu(r,s,d){if(r.subtreeFlags&wh)for(r=r.child;r!==null;)Eg(r,s,d),r=r.sibling}function Eg(r,s,d){switch(r.tag){case 26:Tu(r,s,d),r.flags&wh&&r.memoizedState!==null&&Hm(d,va,r.memoizedState,r.memoizedProps);break;case 5:Tu(r,s,d);break;case 3:case 4:var _=va;va=Tp(r.stateNode.containerInfo),Tu(r,s,d),va=_;break;case 22:r.memoizedState===null&&(_=r.alternate,_!==null&&_.memoizedState!==null?(_=wh,wh=16777216,Tu(r,s,d),wh=_):Tu(r,s,d));break;default:Tu(r,s,d)}}function Mg(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Dd(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];mr=_,Th(_,r)}Mg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Ag(r),r=r.sibling}function Ag(r){switch(r.tag){case 0:case 11:case 15:Dd(r),r.flags&2048&&vl(9,r,r.return);break;case 3:Dd(r);break;case 12:Dd(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,ep(r)):Dd(r);break;default:Dd(r)}}function ep(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var _=s[d];mr=_,Th(_,r)}Mg(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:vl(8,s,s.return),ep(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,ep(s));break;default:ep(s)}r=r.sibling}}function Th(r,s){for(;mr!==null;){var d=mr;switch(d.tag){case 0:case 11:case 15:vl(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var _=d.memoizedState.cachePool.pool;_!=null&&_.refCount++}break;case 24:nc(d.memoizedState.cache)}if(_=d.child,_!==null)_.return=d,mr=_;else e:for(d=r;mr!==null;){_=mr;var M=_.sibling,P=_.return;if(bh(_),_===d){mr=null;break e}if(M!==null){M.return=P,mr=M;break e}mr=P}}}var Jy={getCacheForType:function(r){var s=Hi(ji),d=s.data.get(r);return d===void 0&&(d=r(),s.data.set(r,d)),d},cacheSignal:function(){return Hi(ji).controller.signal}},Cg=typeof WeakMap=="function"?WeakMap:Map,ni=0,_i=null,An=null,Cn=0,si=0,xa=null,Os=!1,hc=!1,fm=!1,Tl=0,Xi=0,Sl=0,Su=0,pm=0,qr=0,Eu=0,Pd=null,ja=null,mm=!1,tp=0,zg=0,Id=1/0,Sh=null,El=null,gr=0,Ml=null,Eh=null,Bs=0,gm=0,np=null,Dg=null,kd=0,ym=null;function Ua(){return(ni&2)!==0&&Cn!==0?Cn&-Cn:Se.T!==null?Mm():Ut()}function Pg(){if(qr===0)if((Cn&536870912)===0||bn){var r=hn;hn<<=1,(hn&3932160)===0&&(hn=262144),qr=r}else qr=536870912;return r=Lt.current,r!==null&&(r.flags|=32),qr}function Va(r,s,d){(r===_i&&(si===2||si===9)||r.cancelPendingCommit!==null)&&(Ah(r,0),dc(r,Cn,qr,!1)),Bn(r,d),((ni&2)===0||r!==_i)&&(r===_i&&((ni&2)===0&&(Su|=d),Xi===4&&dc(r,Cn,qr,!1)),so(r))}function or(r,s,d){if((ni&6)!==0)throw Error(S(327));var _=!d&&(s&127)===0&&(s&r.expiredLanes)===0||Mi(r,s),M=_?Ch(r,s):ap(r,s,!0),P=_;do{if(M===0){hc&&!_&&dc(r,s,0,!1);break}else{if(d=r.current.alternate,P&&!e_(d)){M=ap(r,s,!1),P=!1;continue}if(M===2){if(P=s,r.errorRecoveryDisabledLanes&P)var V=0;else V=r.pendingLanes&-536870913,V=V!==0?V:V&536870912?536870912:0;if(V!==0){s=V;e:{var te=r;M=Pd;var Me=te.current.memoizedState.isDehydrated;if(Me&&(Ah(te,V).flags|=256),V=ap(te,V,!1),V!==2){if(fm&&!Me){te.errorRecoveryDisabledLanes|=P,Su|=P,M=4;break e}P=ja,ja=M,P!==null&&(ja===null?ja=P:ja.push.apply(ja,P))}M=V}if(P=!1,M!==2)continue}}if(M===1){Ah(r,0),dc(r,s,0,!0);break}e:{switch(_=r,P=M,P){case 0:case 1:throw Error(S(345));case 4:if((s&4194048)!==s)break;case 6:dc(_,s,qr,!Os);break e;case 2:ja=null;break;case 3:case 5:break;default:throw Error(S(329))}if((s&62914560)===s&&(M=tp+300-xi(),10<M)){if(dc(_,s,qr,!Os),Pn(_,0,!0)!==0)break e;Bs=s,_.timeoutHandle=wp(Mh.bind(null,_,d,ja,Sh,mm,s,qr,Su,Eu,Os,P,"Throttled",-0,0),M);break e}Mh(_,d,ja,Sh,mm,s,qr,Su,Eu,Os,P,null,-0,0)}}break}while(!0);so(r)}function Mh(r,s,d,_,M,P,V,te,Me,Ye,dt,vt,We,et){if(r.timeoutHandle=-1,vt=s.subtreeFlags,vt&8192||(vt&16785408)===16785408){vt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Xa},Eg(s,P,vt);var Gt=(P&62914560)===P?tp-xi():(P&4194048)===P?zg-xi():0;if(Gt=$m(vt,Gt),Gt!==null){Bs=P,r.cancelPendingCommit=Gt(Og.bind(null,r,s,P,d,_,M,V,te,Me,dt,vt,null,We,et)),dc(r,P,V,!Ye);return}}Og(r,s,P,d,_,M,V,te,Me)}function e_(r){for(var s=r;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var _=0;_<d.length;_++){var M=d[_],P=M.getSnapshot;M=M.value;try{if(!Zr(P(),M))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function dc(r,s,d,_){s&=~pm,s&=~Su,r.suspendedLanes|=s,r.pingedLanes&=~s,_&&(r.warmLanes|=s),_=r.expirationTimes;for(var M=s;0<M;){var P=31-Je(M),V=1<<P;_[P]=-1,M&=~V}d!==0&&Un(r,d,s)}function Rd(){return(ni&6)===0?(ss(0),!1):!0}function ip(){if(An!==null){if(si===0)var r=An.return;else r=An,Es=Pa=null,to(r),Cs=null,ul=0,r=An;for(;r!==null;)Xf(r.alternate,r),r=r.return;An=null}}function Ah(r,s){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,Rm(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),Bs=0,ip(),_i=r,An=d=da(r.current,null),Cn=s,si=0,xa=null,Os=!1,hc=Mi(r,s),fm=!1,Eu=qr=pm=Su=Sl=Xi=0,ja=Pd=null,mm=!1,(s&8)!==0&&(s|=s&32);var _=r.entangledLanes;if(_!==0)for(r=r.entanglements,_&=s;0<_;){var M=31-Je(_),P=1<<M;s|=r[M],_&=~P}return Tl=s,sl(),d}function _m(r,s){pn=null,Se.H=qn,s===Ka||s===Yr?(s=rc(),si=3):s===Do?(s=rc(),si=4):si=s===Ff?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,xa=s,An===null&&(Xi=1,rs(r,Vr(s,r.current)))}function vm(){var r=Lt.current;return r===null?!0:(Cn&4194048)===Cn?Vt===null:(Cn&62914560)===Cn||(Cn&536870912)!==0?r===Vt:!1}function Mu(){var r=Se.H;return Se.H=qn,r===null?qn:r}function rp(){var r=Se.A;return Se.A=Jy,r}function Ld(){Xi=4,Os||(Cn&4194048)!==Cn&&Lt.current!==null||(hc=!0),(Sl&134217727)===0&&(Su&134217727)===0||_i===null||dc(_i,Cn,qr,!1)}function ap(r,s,d){var _=ni;ni|=2;var M=Mu(),P=rp();(_i!==r||Cn!==s)&&(Sh=null,Ah(r,s)),s=!1;var V=Xi;e:do try{if(si!==0&&An!==null){var te=An,Me=xa;switch(si){case 8:ip(),V=6;break e;case 3:case 2:case 9:case 6:Lt.current===null&&(s=!0);var Ye=si;if(si=0,xa=null,zh(r,te,Me,Ye),d&&hc){V=0;break e}break;default:Ye=si,si=0,xa=null,zh(r,te,Me,Ye)}}sp(),V=Xi;break}catch(dt){_m(r,dt)}while(!0);return s&&r.shellSuspendCounter++,Es=Pa=null,ni=_,Se.H=M,Se.A=P,An===null&&(_i=null,Cn=0,sl()),V}function sp(){for(;An!==null;)kg(An)}function Ch(r,s){var d=ni;ni|=2;var _=Mu(),M=rp();_i!==r||Cn!==s?(Sh=null,Id=xi()+500,Ah(r,s)):hc=Mi(r,s);e:do try{if(si!==0&&An!==null){s=An;var P=xa;t:switch(si){case 1:si=0,xa=null,zh(r,s,P,1);break;case 2:case 9:if(ou(P)){si=0,xa=null,Rg(s);break}s=function(){si!==2&&si!==9||_i!==r||(si=7),so(r)},P.then(s,s);break e;case 3:si=7;break e;case 4:si=5;break e;case 7:ou(P)?(si=0,xa=null,Rg(s)):(si=0,xa=null,zh(r,s,P,7));break;case 5:var V=null;switch(An.tag){case 26:V=An.memoizedState;case 5:case 27:var te=An;if(V?Zd(V):te.stateNode.complete){si=0,xa=null;var Me=te.sibling;if(Me!==null)An=Me;else{var Ye=te.return;Ye!==null?(An=Ye,op(Ye)):An=null}break t}}si=0,xa=null,zh(r,s,P,5);break;case 6:si=0,xa=null,zh(r,s,P,6);break;case 8:ip(),Xi=6;break e;default:throw Error(S(462))}}Ig();break}catch(dt){_m(r,dt)}while(!0);return Es=Pa=null,Se.H=_,Se.A=M,ni=d,An!==null?0:(_i=null,Cn=0,sl(),Xi)}function Ig(){for(;An!==null&&!Ar();)kg(An)}function kg(r){var s=Qr(r.alternate,r,Tl);r.memoizedProps=r.pendingProps,s===null?op(r):An=s}function Rg(r){var s=r,d=s.alternate;switch(s.tag){case 15:case 0:s=gg(d,s,s.pendingProps,s.type,void 0,Cn);break;case 11:s=gg(d,s,s.pendingProps,s.type.render,s.ref,Cn);break;case 5:to(s);default:Xf(d,s),s=An=Rf(s,Tl),s=Qr(d,s,Tl)}r.memoizedProps=r.pendingProps,s===null?op(r):An=s}function zh(r,s,d,_){Es=Pa=null,to(s),Cs=null,ul=0;var M=s.return;try{if(Nf(r,M,s,d,Cn)){Xi=1,rs(r,Vr(d,r.current)),An=null;return}}catch(P){if(M!==null)throw An=M,P;Xi=1,rs(r,Vr(d,r.current)),An=null;return}s.flags&32768?(bn||_===1?r=!0:hc||(Cn&536870912)!==0?r=!1:(Os=r=!0,(_===2||_===9||_===3||_===6)&&(_=Lt.current,_!==null&&_.tag===13&&(_.flags|=16384))),Lg(s,r)):op(s)}function op(r){var s=r;do{if((s.flags&32768)!==0){Lg(s,Os);return}r=s.return;var d=xg(s.alternate,s,Tl);if(d!==null){An=d;return}if(s=s.sibling,s!==null){An=s;return}An=s=r}while(s!==null);Xi===0&&(Xi=5)}function Lg(r,s){do{var d=Ky(r.alternate,r);if(d!==null){d.flags&=32767,An=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(r=r.sibling,r!==null)){An=r;return}An=r=d}while(r!==null);Xi=6,An=null}function Og(r,s,d,_,M,P,V,te,Me){r.cancelPendingCommit=null;do lp();while(gr!==0);if((ni&6)!==0)throw Error(S(327));if(s!==null){if(s===r.current)throw Error(S(177));if(P=s.lanes|s.childLanes,P|=al,di(r,d,P,V,te,Me),r===_i&&(An=_i=null,Cn=0),Eh=s,Ml=r,Bs=d,gm=P,np=M,Dg=_,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Vg(X,function(){return Ug(),null})):(r.callbackNode=null,r.callbackPriority=0),_=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||_){_=Se.T,Se.T=null,M=Xe.p,Xe.p=2,V=ni,ni|=4;try{Qy(r,s,d)}finally{ni=V,Xe.p=M,Se.T=_}}gr=1,Bg(),Ng(),Fg()}}function Bg(){if(gr===1){gr=0;var r=Ml,s=Eh,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=Se.T,Se.T=null;var _=Xe.p;Xe.p=2;var M=ni;ni|=4;try{Qf(s,r);var P=Im,V=Ku(r.containerInfo),te=P.focusedElem,Me=P.selectionRange;if(V!==te&&te&&te.ownerDocument&&Wu(te.ownerDocument.documentElement,te)){if(Me!==null&&Kc(te)){var Ye=Me.start,dt=Me.end;if(dt===void 0&&(dt=Ye),"selectionStart"in te)te.selectionStart=Ye,te.selectionEnd=Math.min(dt,te.value.length);else{var vt=te.ownerDocument||document,We=vt&&vt.defaultView||window;if(We.getSelection){var et=We.getSelection(),Gt=te.textContent.length,tn=Math.min(Me.start,Gt),oi=Me.end===void 0?tn:Math.min(Me.end,Gt);!et.extend&&tn>oi&&(V=oi,oi=tn,tn=V);var Ne=Wc(te,tn),De=Wc(te,oi);if(Ne&&De&&(et.rangeCount!==1||et.anchorNode!==Ne.node||et.anchorOffset!==Ne.offset||et.focusNode!==De.node||et.focusOffset!==De.offset)){var He=vt.createRange();He.setStart(Ne.node,Ne.offset),et.removeAllRanges(),tn>oi?(et.addRange(He),et.extend(De.node,De.offset)):(He.setEnd(De.node,De.offset),et.addRange(He))}}}}for(vt=[],et=te;et=et.parentNode;)et.nodeType===1&&vt.push({element:et,left:et.scrollLeft,top:et.scrollTop});for(typeof te.focus=="function"&&te.focus(),te=0;te<vt.length;te++){var gt=vt[te];gt.element.scrollLeft=gt.left,gt.element.scrollTop=gt.top}}Wd=!!jd,Im=jd=null}finally{ni=M,Xe.p=_,Se.T=d}}r.current=s,gr=2}}function Ng(){if(gr===2){gr=0;var r=Ml,s=Eh,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=Se.T,Se.T=null;var _=Xe.p;Xe.p=2;var M=ni;ni|=4;try{um(r,s.alternate,s)}finally{ni=M,Xe.p=_,Se.T=d}}gr=3}}function Fg(){if(gr===4||gr===3){gr=0,Sa();var r=Ml,s=Eh,d=Bs,_=Dg;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?gr=5:(gr=0,Eh=Ml=null,jg(r,r.pendingLanes));var M=r.pendingLanes;if(M===0&&(El=null),Be(d),s=s.stateNode,ye&&typeof ye.onCommitFiberRoot=="function")try{ye.onCommitFiberRoot(Re,s,void 0,(s.current.flags&128)===128)}catch{}if(_!==null){s=Se.T,M=Xe.p,Xe.p=2,Se.T=null;try{for(var P=r.onRecoverableError,V=0;V<_.length;V++){var te=_[V];P(te.value,{componentStack:te.stack})}}finally{Se.T=s,Xe.p=M}}(Bs&3)!==0&&lp(),so(r),M=r.pendingLanes,(d&261930)!==0&&(M&42)!==0?r===ym?kd++:(kd=0,ym=r):kd=0,ss(0)}}function jg(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,nc(s)))}function lp(){return Bg(),Ng(),Fg(),Ug()}function Ug(){if(gr!==5)return!1;var r=Ml,s=gm;gm=0;var d=Be(Bs),_=Se.T,M=Xe.p;try{Xe.p=32>d?32:d,Se.T=null,d=np,np=null;var P=Ml,V=Bs;if(gr=0,Eh=Ml=null,Bs=0,(ni&6)!==0)throw Error(S(331));var te=ni;if(ni|=4,Ag(P.current),dm(P,P.current,V,d),ni=te,ss(0,!1),ye&&typeof ye.onPostCommitFiberRoot=="function")try{ye.onPostCommitFiberRoot(Re,P)}catch{}return!0}finally{Xe.p=M,Se.T=_,jg(r,s)}}function xm(r,s,d){s=Vr(d,s),s=_u(r.stateNode,s,2),r=Ks(r,s,2),r!==null&&(Bn(r,2),so(r))}function ii(r,s,d){if(r.tag===3)xm(r,r,d);else for(;s!==null;){if(s.tag===3){xm(s,r,d);break}else if(s.tag===1){var _=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(El===null||!El.has(_))){r=Vr(d,r),d=vu(2),_=Ks(s,d,2),_!==null&&(xu(d,_,s,r),Bn(_,2),so(_));break}}s=s.return}}function cp(r,s,d){var _=r.pingCache;if(_===null){_=r.pingCache=new Cg;var M=new Set;_.set(s,M)}else M=_.get(s),M===void 0&&(M=new Set,_.set(s,M));M.has(d)||(fm=!0,M.add(d),r=fc.bind(null,r,s,d),s.then(r,r))}function fc(r,s,d){var _=r.pingCache;_!==null&&_.delete(s),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,_i===r&&(Cn&d)===d&&(Xi===4||Xi===3&&(Cn&62914560)===Cn&&300>xi()-tp?(ni&2)===0&&Ah(r,0):pm|=d,Eu===Cn&&(Eu=0)),so(r)}function Od(r,s){s===0&&(s=In()),r=Da(r,s),r!==null&&(Bn(r,s),so(r))}function bm(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),Od(r,d)}function t_(r,s){var d=0;switch(r.tag){case 31:case 13:var _=r.stateNode,M=r.memoizedState;M!==null&&(d=M.retryLane);break;case 19:_=r.stateNode;break;case 22:_=r.stateNode._retryCache;break;default:throw Error(S(314))}_!==null&&_.delete(s),Od(r,d)}function Vg(r,s){return li(r,s)}var up=null,Dh=null,wm=!1,hp=!1,Tm=!1,Al=0;function so(r){r!==Dh&&r.next===null&&(Dh===null?up=Dh=r:Dh=Dh.next=r),hp=!0,wm||(wm=!0,Em())}function ss(r,s){if(!Tm&&hp){Tm=!0;do for(var d=!1,_=up;_!==null;){if(r!==0){var M=_.pendingLanes;if(M===0)var P=0;else{var V=_.suspendedLanes,te=_.pingedLanes;P=(1<<31-Je(42|r)+1)-1,P&=M&~(V&~te),P=P&201326741?P&201326741|1:P?P|2:0}P!==0&&(d=!0,Bd(_,P))}else P=Cn,P=Pn(_,_===_i?P:0,_.cancelPendingCommit!==null||_.timeoutHandle!==-1),(P&3)===0||Mi(_,P)||(d=!0,Bd(_,P));_=_.next}while(d);Tm=!1}}function pc(){Sm()}function Sm(){hp=wm=!1;var r=0;Al!==0&&bp()&&(r=Al);for(var s=xi(),d=null,_=up;_!==null;){var M=_.next,P=dp(_,s);P===0?(_.next=null,d===null?up=M:d.next=M,M===null&&(Dh=d)):(d=_,(r!==0||(P&3)!==0)&&(hp=!0)),_=M}gr!==0&&gr!==5||ss(r),Al!==0&&(Al=0)}function dp(r,s){for(var d=r.suspendedLanes,_=r.pingedLanes,M=r.expirationTimes,P=r.pendingLanes&-62914561;0<P;){var V=31-Je(P),te=1<<V,Me=M[V];Me===-1?((te&d)===0||(te&_)!==0)&&(M[V]=nn(te,s)):Me<=s&&(r.expiredLanes|=te),P&=~te}if(s=_i,d=Cn,d=Pn(r,r===s?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_=r.callbackNode,d===0||r===s&&(si===2||si===9)||r.cancelPendingCommit!==null)return _!==null&&_!==null&&xn(_),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||Mi(r,d)){if(s=d&-d,s===r.callbackPriority)return s;switch(_!==null&&xn(_),Be(d)){case 2:case 8:d=Z;break;case 32:d=X;break;case 268435456:d=de;break;default:d=X}return _=qg.bind(null,r),d=li(d,_),r.callbackPriority=s,r.callbackNode=d,s}return _!==null&&_!==null&&xn(_),r.callbackPriority=2,r.callbackNode=null,2}function qg(r,s){if(gr!==0&&gr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(lp()&&r.callbackNode!==d)return null;var _=Cn;return _=Pn(r,r===_i?_:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),_===0?null:(or(r,_,s),dp(r,xi()),r.callbackNode!=null&&r.callbackNode===d?qg.bind(null,r):null)}function Bd(r,s){if(lp())return null;or(r,s,!0)}function Em(){Om(function(){(ni&6)!==0?li(fe,pc):Sm()})}function Mm(){if(Al===0){var r=cl;r===0&&(r=$t,$t<<=1,($t&261888)===0&&($t=256)),Al=r}return Al}function fp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:un(""+r)}function pp(r,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,r.id&&d.setAttribute("form",r.id),s.parentNode.insertBefore(d,s),r=new FormData(r),d.parentNode.removeChild(d),r}function Ph(r,s,d,_,M){if(s==="submit"&&d&&d.stateNode===M){var P=fp((M[ft]||null).action),V=_.submitter;V&&(s=(s=V[ft]||null)?fp(s.formAction):V.getAttribute("formAction"),s!==null&&(P=s,V=null));var te=new Fc("action","action",null,_,M);r.push({event:te,listeners:[{instance:null,listener:function(){if(_.defaultPrevented){if(Al!==0){var Me=V?pp(M,V):new FormData(M);Ii(d,{pending:!0,data:Me,method:M.method,action:P},null,Me)}}else typeof P=="function"&&(te.preventDefault(),Me=V?pp(M,V):new FormData(M),Ii(d,{pending:!0,data:Me,method:M.method,action:P},P,Me))},currentTarget:M}]})}}for(var mp=0;mp<th.length;mp++){var gp=th[mp],Am=gp.toLowerCase(),Gg=gp[0].toUpperCase()+gp.slice(1);ua(Am,"on"+Gg)}ua(eu,"onAnimationEnd"),ua(tu,"onAnimationIteration"),ua(eh,"onAnimationStart"),ua("dblclick","onDoubleClick"),ua("focusin","onFocus"),ua("focusout","onBlur"),ua(rl,"onTransitionRun"),ua(nu,"onTransitionStart"),ua(Kl,"onTransitionCancel"),ua(ca,"onTransitionEnd"),Vs("onMouseEnter",["mouseout","mouseover"]),Vs("onMouseLeave",["mouseout","mouseover"]),Vs("onPointerEnter",["pointerout","pointerover"]),Vs("onPointerLeave",["pointerout","pointerover"]),Sn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Sn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Sn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Sn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mc));function Hg(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var _=r[d],M=_.event;_=_.listeners;e:{var P=void 0;if(s)for(var V=_.length-1;0<=V;V--){var te=_[V],Me=te.instance,Ye=te.currentTarget;if(te=te.listener,Me!==P&&M.isPropagationStopped())break e;P=te,M.currentTarget=Ye;try{P(M)}catch(dt){vs(dt)}M.currentTarget=null,P=Me}else for(V=0;V<_.length;V++){if(te=_[V],Me=te.instance,Ye=te.currentTarget,te=te.listener,Me!==P&&M.isPropagationStopped())break e;P=te,M.currentTarget=Ye;try{P(M)}catch(dt){vs(dt)}M.currentTarget=null,P=Me}}}}function zn(r,s){var d=s[rn];d===void 0&&(d=s[rn]=new Set);var _=r+"__bubble";d.has(_)||(_p(s,r,2,!1),d.add(_))}function Cm(r,s,d){var _=0;s&&(_|=4),_p(d,r,_,s)}var yp="_reactListening"+Math.random().toString(36).slice(2);function zm(r){if(!r[yp]){r[yp]=!0,Nl.forEach(function(d){d!=="selectionchange"&&(Zg.has(d)||Cm(d,!1,r),Cm(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[yp]||(s[yp]=!0,Cm("selectionchange",!1,s))}}function _p(r,s,d,_){switch(zu(s)){case 2:var M=Kd;break;case 8:M=sy;break;default:M=Ym}d=M.bind(null,s,d,r),M=void 0,!Br||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(M=!0),_?M!==void 0?r.addEventListener(s,d,{capture:!0,passive:M}):r.addEventListener(s,d,!0):M!==void 0?r.addEventListener(s,d,{passive:M}):r.addEventListener(s,d,!1)}function Fo(r,s,d,_,M){var P=_;if((s&1)===0&&(s&2)===0&&_!==null)e:for(;;){if(_===null)return;var V=_.tag;if(V===3||V===4){var te=_.stateNode.containerInfo;if(te===M)break;if(V===4)for(V=_.return;V!==null;){var Me=V.tag;if((Me===3||Me===4)&&V.stateNode.containerInfo===M)return;V=V.return}for(;te!==null;){if(V=ds(te),V===null)return;if(Me=V.tag,Me===5||Me===6||Me===26||Me===27){_=P=V;continue e}te=te.parentNode}}_=_.return}Qn(function(){var Ye=P,dt=Nc(d),vt=[];e:{var We=sd.get(r);if(We!==void 0){var et=Fc,Gt=r;switch(r){case"keypress":if(la(d)===0)break e;case"keydown":case"keyup":et=Di;break;case"focusin":Gt="focus",et=_o;break;case"focusout":Gt="blur",et=_o;break;case"beforeblur":case"afterblur":et=_o;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":et=Jo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":et=jc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":et=Qp;break;case eu:case tu:case eh:et=wf;break;case ca:et=Hu;break;case"scroll":case"scrollend":et=Qo;break;case"wheel":et=td;break;case"copy":case"cut":case"paste":et=Jh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":et=Zu;break;case"toggle":case"beforetoggle":et=Zl}var tn=(s&4)!==0,oi=!tn&&(r==="scroll"||r==="scrollend"),Ne=tn?We!==null?We+"Capture":null:We;tn=[];for(var De=Ye,He;De!==null;){var gt=De;if(He=gt.stateNode,gt=gt.tag,gt!==5&&gt!==26&&gt!==27||He===null||Ne===null||(gt=Ma(De,Ne),gt!=null&&tn.push(Ih(De,gt,He))),oi)break;De=De.return}0<tn.length&&(We=new et(We,Gt,null,d,dt),vt.push({event:We,listeners:tn}))}}if((s&7)===0){e:{if(We=r==="mouseover"||r==="pointerover",et=r==="mouseout"||r==="pointerout",We&&d!==Qh&&(Gt=d.relatedTarget||d.fromElement)&&(ds(Gt)||Gt[Jt]))break e;if((et||We)&&(We=dt.window===dt?dt:(We=dt.ownerDocument)?We.defaultView||We.parentWindow:window,et?(Gt=d.relatedTarget||d.toElement,et=Ye,Gt=Gt?ds(Gt):null,Gt!==null&&(oi=k(Gt),tn=Gt.tag,Gt!==oi||tn!==5&&tn!==27&&tn!==6)&&(Gt=null)):(et=null,Gt=Ye),et!==Gt)){if(tn=Jo,gt="onMouseLeave",Ne="onMouseEnter",De="mouse",(r==="pointerout"||r==="pointerover")&&(tn=Zu,gt="onPointerLeave",Ne="onPointerEnter",De="pointer"),oi=et==null?We:fs(et),He=Gt==null?We:fs(Gt),We=new tn(gt,De+"leave",et,d,dt),We.target=oi,We.relatedTarget=He,gt=null,ds(dt)===Ye&&(tn=new tn(Ne,De+"enter",Gt,d,dt),tn.target=He,tn.relatedTarget=oi,gt=tn),oi=gt,et&&Gt)t:{for(tn=$g,Ne=et,De=Gt,He=0,gt=Ne;gt;gt=tn(gt))He++;gt=0;for(var en=De;en;en=tn(en))gt++;for(;0<He-gt;)Ne=tn(Ne),He--;for(;0<gt-He;)De=tn(De),gt--;for(;He--;){if(Ne===De||De!==null&&Ne===De.alternate){tn=Ne;break t}Ne=tn(Ne),De=tn(De)}tn=null}else tn=null;et!==null&&Dm(vt,We,et,tn,!1),Gt!==null&&oi!==null&&Dm(vt,oi,Gt,tn,!0)}}e:{if(We=Ye?fs(Ye):window,et=We.nodeName&&We.nodeName.toLowerCase(),et==="select"||et==="input"&&We.type==="file")var Yn=bo;else if(Xu(We))if(nd)Yn=If;else{Yn=Pf;var Zt=Jp}else et=We.nodeName,!et||et.toLowerCase()!=="input"||We.type!=="checkbox"&&We.type!=="radio"?Ye&&Yo(Ye.elementType)&&(Yn=bo):Yn=Yc;if(Yn&&(Yn=Yn(r,Ye))){Yu(vt,Yn,d,dt);break e}Zt&&Zt(r,We,Ye),r==="focusout"&&Ye&&We.type==="number"&&Ye.memoizedProps.value!=null&&Bc(We,"number",We.value)}switch(Zt=Ye?fs(Ye):window,r){case"focusin":(Xu(Zt)||Zt.contentEditable==="true")&&(za=Zt,Qc=Ye,Jc=null);break;case"focusout":Jc=Qc=za=null;break;case"mousedown":Ju=!0;break;case"contextmenu":case"mouseup":case"dragend":Ju=!1,kf(vt,d,dt);break;case"selectionchange":if(Qu)break;case"keydown":case"keyup":kf(vt,d,dt)}var Wt;if(Fi)e:{switch(r){case"compositionstart":var Mn="onCompositionStart";break e;case"compositionend":Mn="onCompositionEnd";break e;case"compositionupdate":Mn="onCompositionUpdate";break e}Mn=void 0}else Ya?Zc(r,d)&&(Mn="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Mn="onCompositionStart");Mn&&(Yl&&d.locale!=="ko"&&(Ya||Mn!=="onCompositionStart"?Mn==="onCompositionEnd"&&Ya&&(Wt=go()):(oa=dt,gs="value"in oa?oa.value:oa.textContent,Ya=!0)),Zt=Nd(Ye,Mn),0<Zt.length&&(Mn=new ed(Mn,r,null,d,dt),vt.push({event:Mn,listeners:Zt}),Wt?Mn.data=Wt:(Wt=Mf(d),Wt!==null&&(Mn.data=Wt)))),(Wt=Xl?$u(r,d):Af(r,d))&&(Mn=Nd(Ye,"onBeforeInput"),0<Mn.length&&(Zt=new ed("onBeforeInput","beforeinput",null,d,dt),vt.push({event:Zt,listeners:Mn}),Zt.data=Wt)),Ph(vt,r,Ye,d,dt)}Hg(vt,s)})}function Ih(r,s,d){return{instance:r,listener:s,currentTarget:d}}function Nd(r,s){for(var d=s+"Capture",_=[];r!==null;){var M=r,P=M.stateNode;if(M=M.tag,M!==5&&M!==26&&M!==27||P===null||(M=Ma(r,d),M!=null&&_.unshift(Ih(r,M,P)),M=Ma(r,s),M!=null&&_.push(Ih(r,M,P))),r.tag===3)return _;r=r.return}return[]}function $g(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Dm(r,s,d,_,M){for(var P=s._reactName,V=[];d!==null&&d!==_;){var te=d,Me=te.alternate,Ye=te.stateNode;if(te=te.tag,Me!==null&&Me===_)break;te!==5&&te!==26&&te!==27||Ye===null||(Me=Ye,M?(Ye=Ma(d,P),Ye!=null&&V.unshift(Ih(d,Ye,Me))):M||(Ye=Ma(d,P),Ye!=null&&V.push(Ih(d,Ye,Me)))),d=d.return}V.length!==0&&r.push({event:s,listeners:V})}var Xg=/\r\n?/g,Yg=/\u0000|\uFFFD/g;function Fd(r){return(typeof r=="string"?r:""+r).replace(Xg,`
`).replace(Yg,"")}function Pm(r,s){return s=Fd(s),Fd(r)===s}function Xn(r,s,d,_,M,P){switch(d){case"children":typeof _=="string"?s==="body"||s==="textarea"&&_===""||qs(r,_):(typeof _=="number"||typeof _=="bigint")&&s!=="body"&&qs(r,""+_);break;case"className":ms(r,"class",_);break;case"tabIndex":ms(r,"tabindex",_);break;case"dir":case"role":case"viewBox":case"width":case"height":ms(r,d,_);break;case"style":Gu(r,_,P);break;case"data":if(s!=="object"){ms(r,"data",_);break}case"src":case"href":if(_===""&&(s!=="a"||d!=="href")){r.removeAttribute(d);break}if(_==null||typeof _=="function"||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=un(""+_),r.setAttribute(d,_);break;case"action":case"formAction":if(typeof _=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof P=="function"&&(d==="formAction"?(s!=="input"&&Xn(r,s,"name",M.name,M,null),Xn(r,s,"formEncType",M.formEncType,M,null),Xn(r,s,"formMethod",M.formMethod,M,null),Xn(r,s,"formTarget",M.formTarget,M,null)):(Xn(r,s,"encType",M.encType,M,null),Xn(r,s,"method",M.method,M,null),Xn(r,s,"target",M.target,M,null)));if(_==null||typeof _=="symbol"||typeof _=="boolean"){r.removeAttribute(d);break}_=un(""+_),r.setAttribute(d,_);break;case"onClick":_!=null&&(r.onclick=Xa);break;case"onScroll":_!=null&&zn("scroll",r);break;case"onScrollEnd":_!=null&&zn("scrollend",r);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(M.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"multiple":r.multiple=_&&typeof _!="function"&&typeof _!="symbol";break;case"muted":r.muted=_&&typeof _!="function"&&typeof _!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(_==null||typeof _=="function"||typeof _=="boolean"||typeof _=="symbol"){r.removeAttribute("xlink:href");break}d=un(""+_),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""+_):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":_&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":_===!0?r.setAttribute(d,""):_!==!1&&_!=null&&typeof _!="function"&&typeof _!="symbol"?r.setAttribute(d,_):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":_!=null&&typeof _!="function"&&typeof _!="symbol"&&!isNaN(_)&&1<=_?r.setAttribute(d,_):r.removeAttribute(d);break;case"rowSpan":case"start":_==null||typeof _=="function"||typeof _=="symbol"||isNaN(_)?r.removeAttribute(d):r.setAttribute(d,_);break;case"popover":zn("beforetoggle",r),zn("toggle",r),Rc(r,"popover",_);break;case"xlinkActuate":Ea(r,"http://www.w3.org/1999/xlink","xlink:actuate",_);break;case"xlinkArcrole":Ea(r,"http://www.w3.org/1999/xlink","xlink:arcrole",_);break;case"xlinkRole":Ea(r,"http://www.w3.org/1999/xlink","xlink:role",_);break;case"xlinkShow":Ea(r,"http://www.w3.org/1999/xlink","xlink:show",_);break;case"xlinkTitle":Ea(r,"http://www.w3.org/1999/xlink","xlink:title",_);break;case"xlinkType":Ea(r,"http://www.w3.org/1999/xlink","xlink:type",_);break;case"xmlBase":Ea(r,"http://www.w3.org/XML/1998/namespace","xml:base",_);break;case"xmlLang":Ea(r,"http://www.w3.org/XML/1998/namespace","xml:lang",_);break;case"xmlSpace":Ea(r,"http://www.w3.org/XML/1998/namespace","xml:space",_);break;case"is":Rc(r,"is",_);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=mo.get(d)||d,Rc(r,d,_))}}function vp(r,s,d,_,M,P){switch(d){case"style":Gu(r,_,P);break;case"dangerouslySetInnerHTML":if(_!=null){if(typeof _!="object"||!("__html"in _))throw Error(S(61));if(d=_.__html,d!=null){if(M.children!=null)throw Error(S(60));r.innerHTML=d}}break;case"children":typeof _=="string"?qs(r,_):(typeof _=="number"||typeof _=="bigint")&&qs(r,""+_);break;case"onScroll":_!=null&&zn("scroll",r);break;case"onScrollEnd":_!=null&&zn("scrollend",r);break;case"onClick":_!=null&&(r.onclick=Xa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Cr.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(M=d.endsWith("Capture"),s=d.slice(2,M?d.length-7:void 0),P=r[ft]||null,P=P!=null?P[d]:null,typeof P=="function"&&r.removeEventListener(s,P,M),typeof _=="function")){typeof P!="function"&&P!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(s,_,M);break e}d in r?r[d]=_:_===!0?r.setAttribute(d,""):Rc(r,d,_)}}}function Er(r,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":zn("error",r),zn("load",r);var _=!1,M=!1,P;for(P in d)if(d.hasOwnProperty(P)){var V=d[P];if(V!=null)switch(P){case"src":_=!0;break;case"srcSet":M=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Xn(r,s,P,V,d,null)}}M&&Xn(r,s,"srcSet",d.srcSet,d,null),_&&Xn(r,s,"src",d.src,d,null);return;case"input":zn("invalid",r);var te=P=V=M=null,Me=null,Ye=null;for(_ in d)if(d.hasOwnProperty(_)){var dt=d[_];if(dt!=null)switch(_){case"name":M=dt;break;case"type":V=dt;break;case"checked":Me=dt;break;case"defaultChecked":Ye=dt;break;case"value":P=dt;break;case"defaultValue":te=dt;break;case"children":case"dangerouslySetInnerHTML":if(dt!=null)throw Error(S(137,s));break;default:Xn(r,s,_,dt,d,null)}}qu(r,P,te,Me,Ye,V,M,!1);return;case"select":zn("invalid",r),_=V=P=null;for(M in d)if(d.hasOwnProperty(M)&&(te=d[M],te!=null))switch(M){case"value":P=te;break;case"defaultValue":V=te;break;case"multiple":_=te;default:Xn(r,s,M,te,d,null)}s=P,d=V,r.multiple=!!_,s!=null?po(r,!!_,s,!1):d!=null&&po(r,!!_,d,!0);return;case"textarea":zn("invalid",r),P=M=_=null;for(V in d)if(d.hasOwnProperty(V)&&(te=d[V],te!=null))switch(V){case"value":_=te;break;case"defaultValue":M=te;break;case"children":P=te;break;case"dangerouslySetInnerHTML":if(te!=null)throw Error(S(91));break;default:Xn(r,s,V,te,d,null)}Ul(r,_,M,P);return;case"option":for(Me in d)d.hasOwnProperty(Me)&&(_=d[Me],_!=null)&&(Me==="selected"?r.selected=_&&typeof _!="function"&&typeof _!="symbol":Xn(r,s,Me,_,d,null));return;case"dialog":zn("beforetoggle",r),zn("toggle",r),zn("cancel",r),zn("close",r);break;case"iframe":case"object":zn("load",r);break;case"video":case"audio":for(_=0;_<mc.length;_++)zn(mc[_],r);break;case"image":zn("error",r),zn("load",r);break;case"details":zn("toggle",r);break;case"embed":case"source":case"link":zn("error",r),zn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ye in d)if(d.hasOwnProperty(Ye)&&(_=d[Ye],_!=null))switch(Ye){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,s));default:Xn(r,s,Ye,_,d,null)}return;default:if(Yo(s)){for(dt in d)d.hasOwnProperty(dt)&&(_=d[dt],_!==void 0&&vp(r,s,dt,_,d,void 0));return}}for(te in d)d.hasOwnProperty(te)&&(_=d[te],_!=null&&Xn(r,s,te,_,d,null))}function Wg(r,s,d,_){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var M=null,P=null,V=null,te=null,Me=null,Ye=null,dt=null;for(et in d){var vt=d[et];if(d.hasOwnProperty(et)&&vt!=null)switch(et){case"checked":break;case"value":break;case"defaultValue":Me=vt;default:_.hasOwnProperty(et)||Xn(r,s,et,null,_,vt)}}for(var We in _){var et=_[We];if(vt=d[We],_.hasOwnProperty(We)&&(et!=null||vt!=null))switch(We){case"type":P=et;break;case"name":M=et;break;case"checked":Ye=et;break;case"defaultChecked":dt=et;break;case"value":V=et;break;case"defaultValue":te=et;break;case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(S(137,s));break;default:et!==vt&&Xn(r,s,We,et,_,vt)}}Oc(r,V,te,Me,Ye,dt,P,M);return;case"select":et=V=te=We=null;for(P in d)if(Me=d[P],d.hasOwnProperty(P)&&Me!=null)switch(P){case"value":break;case"multiple":et=Me;default:_.hasOwnProperty(P)||Xn(r,s,P,null,_,Me)}for(M in _)if(P=_[M],Me=d[M],_.hasOwnProperty(M)&&(P!=null||Me!=null))switch(M){case"value":We=P;break;case"defaultValue":te=P;break;case"multiple":V=P;default:P!==Me&&Xn(r,s,M,P,_,Me)}s=te,d=V,_=et,We!=null?po(r,!!d,We,!1):!!_!=!!d&&(s!=null?po(r,!!d,s,!0):po(r,!!d,d?[]:"",!1));return;case"textarea":et=We=null;for(te in d)if(M=d[te],d.hasOwnProperty(te)&&M!=null&&!_.hasOwnProperty(te))switch(te){case"value":break;case"children":break;default:Xn(r,s,te,null,_,M)}for(V in _)if(M=_[V],P=d[V],_.hasOwnProperty(V)&&(M!=null||P!=null))switch(V){case"value":We=M;break;case"defaultValue":et=M;break;case"children":break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(S(91));break;default:M!==P&&Xn(r,s,V,M,_,P)}xf(r,We,et);return;case"option":for(var Gt in d)We=d[Gt],d.hasOwnProperty(Gt)&&We!=null&&!_.hasOwnProperty(Gt)&&(Gt==="selected"?r.selected=!1:Xn(r,s,Gt,null,_,We));for(Me in _)We=_[Me],et=d[Me],_.hasOwnProperty(Me)&&We!==et&&(We!=null||et!=null)&&(Me==="selected"?r.selected=We&&typeof We!="function"&&typeof We!="symbol":Xn(r,s,Me,We,_,et));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var tn in d)We=d[tn],d.hasOwnProperty(tn)&&We!=null&&!_.hasOwnProperty(tn)&&Xn(r,s,tn,null,_,We);for(Ye in _)if(We=_[Ye],et=d[Ye],_.hasOwnProperty(Ye)&&We!==et&&(We!=null||et!=null))switch(Ye){case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(S(137,s));break;default:Xn(r,s,Ye,We,_,et)}return;default:if(Yo(s)){for(var oi in d)We=d[oi],d.hasOwnProperty(oi)&&We!==void 0&&!_.hasOwnProperty(oi)&&vp(r,s,oi,void 0,_,We);for(dt in _)We=_[dt],et=d[dt],!_.hasOwnProperty(dt)||We===et||We===void 0&&et===void 0||vp(r,s,dt,We,_,et);return}}for(var Ne in d)We=d[Ne],d.hasOwnProperty(Ne)&&We!=null&&!_.hasOwnProperty(Ne)&&Xn(r,s,Ne,null,_,We);for(vt in _)We=_[vt],et=d[vt],!_.hasOwnProperty(vt)||We===et||We==null&&et==null||Xn(r,s,vt,We,_,et)}function qa(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kh(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,d=performance.getEntriesByType("resource"),_=0;_<d.length;_++){var M=d[_],P=M.transferSize,V=M.initiatorType,te=M.duration;if(P&&te&&qa(V)){for(V=0,te=M.responseEnd,_+=1;_<d.length;_++){var Me=d[_],Ye=Me.startTime;if(Ye>te)break;var dt=Me.transferSize,vt=Me.initiatorType;dt&&qa(vt)&&(Me=Me.responseEnd,V+=dt*(Me<te?1:(te-Ye)/(Me-Ye)))}if(--_,s+=8*(P+V)/(M.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var jd=null,Im=null;function Ud(r){return r.nodeType===9?r:r.ownerDocument}function gc(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function km(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function xp(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var yc=null;function bp(){var r=window.event;return r&&r.type==="popstate"?r===yc?!1:(yc=r,!0):(yc=null,!1)}var wp=typeof setTimeout=="function"?setTimeout:void 0,Rm=typeof clearTimeout=="function"?clearTimeout:void 0,Lm=typeof Promise=="function"?Promise:void 0,Om=typeof queueMicrotask=="function"?queueMicrotask:typeof Lm<"u"?function(r){return Lm.resolve(null).then(r).catch(Bm)}:wp;function Bm(r){setTimeout(function(){throw r})}function _c(r){return r==="head"}function Kg(r,s){var d=s,_=0;do{var M=d.nextSibling;if(r.removeChild(d),M&&M.nodeType===8)if(d=M.data,d==="/$"||d==="/&"){if(_===0){r.removeChild(M),Sc(s);return}_--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")_++;else if(d==="html")Rh(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,Rh(d);for(var P=d.firstChild;P;){var V=P.nextSibling,te=P.nodeName;P[sn]||te==="SCRIPT"||te==="STYLE"||te==="LINK"&&P.rel.toLowerCase()==="stylesheet"||d.removeChild(P),P=V}}else d==="body"&&Rh(r.ownerDocument.body);d=M}while(d);Sc(s)}function yn(r,s){var d=r;r=0;do{var _=d.nextSibling;if(d.nodeType===1?s?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(s?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),_&&_.nodeType===8)if(d=_.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=_}while(d)}function oo(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":oo(d),Ho(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function Pr(r,s,d,_){for(;r.nodeType===1;){var M=d;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!_&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(_){if(!r[sn])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(P=r.getAttribute("rel"),P==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(P!==M.rel||r.getAttribute("href")!==(M.href==null||M.href===""?null:M.href)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin)||r.getAttribute("title")!==(M.title==null?null:M.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(P=r.getAttribute("src"),(P!==(M.src==null?null:M.src)||r.getAttribute("type")!==(M.type==null?null:M.type)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin))&&P&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var P=M.name==null?null:""+M.name;if(M.type==="hidden"&&r.getAttribute("name")===P)return r}else return r;if(r=os(r.nextSibling),r===null)break}return null}function lo(r,s,d){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=os(r.nextSibling),r===null))return null;return r}function vc(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=os(r.nextSibling),r===null))return null;return r}function Jr(r){return r.data==="$?"||r.data==="$~"}function er(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function yr(r,s){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||d.readyState!=="loading")s();else{var _=function(){s(),d.removeEventListener("DOMContentLoaded",_)};d.addEventListener("DOMContentLoaded",_),r._reactRetry=_}}function os(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var ba=null;function _r(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(s===0)return os(r.nextSibling);s--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||s++}r=r.nextSibling}return null}function Vd(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(s===0)return r;s--}else d!=="/$"&&d!=="/&"||s++}r=r.previousSibling}return null}function Qg(r,s,d){switch(s=Ud(d),r){case"html":if(r=s.documentElement,!r)throw Error(S(452));return r;case"head":if(r=s.head,!r)throw Error(S(453));return r;case"body":if(r=s.body,!r)throw Error(S(454));return r;default:throw Error(S(451))}}function Rh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Ho(r)}var Ir=new Map,Au=new Set;function Tp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var jo=Xe.d;Xe.d={f:Jg,r:ey,D:Fm,C:ea,L:co,m:ta,X:Sp,S:bc,M:jm};function Jg(){var r=jo.f(),s=Rd();return r||s}function ey(r){var s=Us(r);s!==null&&s.tag===5&&s.type==="form"?dr(s):jo.r(r)}var xc=typeof document>"u"?null:document;function Nm(r,s,d){var _=xc;if(_&&typeof s=="string"&&s){var M=Or(s);M='link[rel="'+r+'"][href="'+M+'"]',typeof d=="string"&&(M+='[crossorigin="'+d+'"]'),Au.has(M)||(Au.add(M),r={rel:r,crossOrigin:d,href:s},_.querySelector(M)===null&&(s=_.createElement("link"),Er(s,"link",r),Ci(s),_.head.appendChild(s)))}}function Fm(r){jo.D(r),Nm("dns-prefetch",r,null)}function ea(r,s){jo.C(r,s),Nm("preconnect",r,s)}function co(r,s,d){jo.L(r,s,d);var _=xc;if(_&&r&&s){var M='link[rel="preload"][as="'+Or(s)+'"]';s==="image"&&d&&d.imageSrcSet?(M+='[imagesrcset="'+Or(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(M+='[imagesizes="'+Or(d.imageSizes)+'"]')):M+='[href="'+Or(r)+'"]';var P=M;switch(s){case"style":P=Cu(r);break;case"script":P=Cl(r)}Ir.has(P)||(r=re({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:r,as:s},d),Ir.set(P,r),_.querySelector(M)!==null||s==="style"&&_.querySelector(Lh(P))||s==="script"&&_.querySelector(Oh(P))||(s=_.createElement("link"),Er(s,"link",r),Ci(s),_.head.appendChild(s)))}}function ta(r,s){jo.m(r,s);var d=xc;if(d&&r){var _=s&&typeof s.as=="string"?s.as:"script",M='link[rel="modulepreload"][as="'+Or(_)+'"][href="'+Or(r)+'"]',P=M;switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":P=Cl(r)}if(!Ir.has(P)&&(r=re({rel:"modulepreload",href:r},s),Ir.set(P,r),d.querySelector(M)===null)){switch(_){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Oh(P)))return}_=d.createElement("link"),Er(_,"link",r),Ci(_),d.head.appendChild(_)}}}function bc(r,s,d){jo.S(r,s,d);var _=xc;if(_&&r){var M=ps(_).hoistableStyles,P=Cu(r);s=s||"default";var V=M.get(P);if(!V){var te={loading:0,preload:null};if(V=_.querySelector(Lh(P)))te.loading=5;else{r=re({rel:"stylesheet",href:r,"data-precedence":s},d),(d=Ir.get(P))&&qd(r,d);var Me=V=_.createElement("link");Ci(Me),Er(Me,"link",r),Me._p=new Promise(function(Ye,dt){Me.onload=Ye,Me.onerror=dt}),Me.addEventListener("load",function(){te.loading|=1}),Me.addEventListener("error",function(){te.loading|=2}),te.loading|=4,zl(V,s,_)}V={type:"stylesheet",instance:V,count:1,state:te},M.set(P,V)}}}function Sp(r,s){jo.X(r,s);var d=xc;if(d&&r){var _=ps(d).hoistableScripts,M=Cl(r),P=_.get(M);P||(P=d.querySelector(Oh(M)),P||(r=re({src:r,async:!0},s),(s=Ir.get(M))&&Ep(r,s),P=d.createElement("script"),Ci(P),Er(P,"link",r),d.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},_.set(M,P))}}function jm(r,s){jo.M(r,s);var d=xc;if(d&&r){var _=ps(d).hoistableScripts,M=Cl(r),P=_.get(M);P||(P=d.querySelector(Oh(M)),P||(r=re({src:r,async:!0,type:"module"},s),(s=Ir.get(M))&&Ep(r,s),P=d.createElement("script"),Ci(P),Er(P,"link",r),d.head.appendChild(P)),P={type:"script",instance:P,count:1,state:null},_.set(M,P))}}function Um(r,s,d,_){var M=(M=Xt.current)?Tp(M):null;if(!M)throw Error(S(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=Cu(d.href),d=ps(M).hoistableStyles,_=d.get(s),_||(_={type:"style",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=Cu(d.href);var P=ps(M).hoistableStyles,V=P.get(r);if(V||(M=M.ownerDocument||M,V={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},P.set(r,V),(P=M.querySelector(Lh(r)))&&!P._p&&(V.instance=P,V.state.loading=5),Ir.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Ir.set(r,d),P||qm(M,r,d,V.state))),s&&_===null)throw Error(S(528,""));return V}if(s&&_!==null)throw Error(S(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Cl(d),d=ps(M).hoistableScripts,_=d.get(s),_||(_={type:"script",instance:null,count:0,state:null},d.set(s,_)),_):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,r))}}function Cu(r){return'href="'+Or(r)+'"'}function Lh(r){return'link[rel="stylesheet"]['+r+"]"}function Vm(r){return re({},r,{"data-precedence":r.precedence,precedence:null})}function qm(r,s,d,_){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?_.loading=1:(s=r.createElement("link"),_.preload=s,s.addEventListener("load",function(){return _.loading|=1}),s.addEventListener("error",function(){return _.loading|=2}),Er(s,"link",d),Ci(s),r.head.appendChild(s))}function Cl(r){return'[src="'+Or(r)+'"]'}function Oh(r){return"script[async]"+r}function Gm(r,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var _=r.querySelector('style[data-href~="'+Or(d.href)+'"]');if(_)return s.instance=_,Ci(_),_;var M=re({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return _=(r.ownerDocument||r).createElement("style"),Ci(_),Er(_,"style",M),zl(_,d.precedence,r),s.instance=_;case"stylesheet":M=Cu(d.href);var P=r.querySelector(Lh(M));if(P)return s.state.loading|=4,s.instance=P,Ci(P),P;_=Vm(d),(M=Ir.get(M))&&qd(_,M),P=(r.ownerDocument||r).createElement("link"),Ci(P);var V=P;return V._p=new Promise(function(te,Me){V.onload=te,V.onerror=Me}),Er(P,"link",_),s.state.loading|=4,zl(P,d.precedence,r),s.instance=P;case"script":return P=Cl(d.src),(M=r.querySelector(Oh(P)))?(s.instance=M,Ci(M),M):(_=d,(M=Ir.get(P))&&(_=re({},d),Ep(_,M)),r=r.ownerDocument||r,M=r.createElement("script"),Ci(M),Er(M,"link",_),r.head.appendChild(M),s.instance=M);case"void":return null;default:throw Error(S(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(_=s.instance,s.state.loading|=4,zl(_,d.precedence,r));return s.instance}function zl(r,s,d){for(var _=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),M=_.length?_[_.length-1]:null,P=M,V=0;V<_.length;V++){var te=_[V];if(te.dataset.precedence===s)P=te;else if(P!==M)break}P?P.parentNode.insertBefore(r,P.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(r,s.firstChild))}function qd(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Ep(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Mp=null;function Zm(r,s,d){if(Mp===null){var _=new Map,M=Mp=new Map;M.set(d,_)}else M=Mp,_=M.get(d),_||(_=new Map,M.set(d,_));if(_.has(r))return _;for(_.set(r,null),d=d.getElementsByTagName(r),M=0;M<d.length;M++){var P=d[M];if(!(P[sn]||P[Tn]||r==="link"&&P.getAttribute("rel")==="stylesheet")&&P.namespaceURI!=="http://www.w3.org/2000/svg"){var V=P.getAttribute(s)||"";V=r+V;var te=_.get(V);te?te.push(P):_.set(V,[P])}}return _}function Gd(r,s,d){r=r.ownerDocument||r,r.head.insertBefore(d,s==="title"?r.querySelector("head > title"):null)}function Ap(r,s,d){if(d===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Zd(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Hm(r,s,d,_){if(d.type==="stylesheet"&&(typeof _.media!="string"||matchMedia(_.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var M=Cu(_.href),P=s.querySelector(Lh(M));if(P){s=P._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=$d.bind(r),s.then(r,r)),d.state.loading|=4,d.instance=P,Ci(P);return}P=s.ownerDocument||s,_=Vm(_),(M=Ir.get(M))&&qd(_,M),P=P.createElement("link"),Ci(P);var V=P;V._p=new Promise(function(te,Me){V.onload=te,V.onerror=Me}),Er(P,"link",_),d.instance=P}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=$d.bind(r),s.addEventListener("load",d),s.addEventListener("error",d))}}var Hd=0;function $m(r,s){return r.stylesheets&&r.count===0&&Yd(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var _=setTimeout(function(){if(r.stylesheets&&Yd(r,r.stylesheets),r.unsuspend){var P=r.unsuspend;r.unsuspend=null,P()}},6e4+s);0<r.imgBytes&&Hd===0&&(Hd=62500*kh());var M=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Yd(r,r.stylesheets),r.unsuspend)){var P=r.unsuspend;r.unsuspend=null,P()}},(r.imgBytes>Hd?50:800)+s);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(_),clearTimeout(M)}}:null}function $d(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Yd(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Xd=null;function Yd(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Xd=new Map,s.forEach(ty,r),Xd=null,$d.call(r))}function ty(r,s){if(!(s.state.loading&4)){var d=Xd.get(r);if(d)var _=d.get(null);else{d=new Map,Xd.set(r,d);for(var M=r.querySelectorAll("link[data-precedence],style[data-precedence]"),P=0;P<M.length;P++){var V=M[P];(V.nodeName==="LINK"||V.getAttribute("media")!=="not all")&&(d.set(V.dataset.precedence,V),_=V)}_&&d.set(null,_)}M=s.instance,V=M.getAttribute("data-precedence"),P=d.get(V)||_,P===_&&d.set(null,M),d.set(V,M),this.count++,_=$d.bind(this),M.addEventListener("load",_),M.addEventListener("error",_),P?P.parentNode.insertBefore(M,P.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(M,r.firstChild)),s.state.loading|=4}}var Bh={$$typeof:at,Provider:null,Consumer:null,_currentValue:_t,_currentValue2:_t,_threadCount:0};function n_(r,s,d,_,M,P,V,te,Me){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Gi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gi(0),this.hiddenUpdates=Gi(null),this.identifierPrefix=_,this.onUncaughtError=M,this.onCaughtError=P,this.onRecoverableError=V,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Me,this.incompleteTransitions=new Map}function Xm(r,s,d,_,M,P,V,te,Me,Ye,dt,vt){return r=new n_(r,s,d,V,Me,Ye,dt,vt,te),s=1,P===!0&&(s|=24),P=ha(3,null,null,s),r.current=P,P.stateNode=r,s=As(),s.refCount++,r.pooledCache=s,s.refCount++,P.memoizedState={element:_,isDehydrated:d,cache:s},ph(P),r}function ny(r){return r?(r=cn,r):cn}function iy(r,s,d,_,M,P){M=ny(M),_.context===null?_.context=M:_.pendingContext=M,_=Is(s),_.payload={element:d},P=P===void 0?null:P,P!==null&&(_.callback=P),d=Ks(r,_,s),d!==null&&(Va(d,r,s),ka(d,r,s))}function Cp(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function zp(r,s){Cp(r,s),(r=r.alternate)&&Cp(r,s)}function ry(r){if(r.tag===13||r.tag===31){var s=Da(r,67108864);s!==null&&Va(s,r,67108864),zp(r,67108864)}}function ay(r){if(r.tag===13||r.tag===31){var s=Ua();s=lt(s);var d=Da(r,s);d!==null&&Va(d,r,s),zp(r,s)}}var Wd=!0;function Kd(r,s,d,_){var M=Se.T;Se.T=null;var P=Xe.p;try{Xe.p=2,Ym(r,s,d,_)}finally{Xe.p=P,Se.T=M}}function sy(r,s,d,_){var M=Se.T;Se.T=null;var P=Xe.p;try{Xe.p=8,Ym(r,s,d,_)}finally{Xe.p=P,Se.T=M}}function Ym(r,s,d,_){if(Wd){var M=Qd(_);if(M===null)Fo(r,s,_,Nh,d),oy(r,_);else if(r_(M,r,s,d,_))_.stopPropagation();else if(oy(r,_),s&4&&-1<i_.indexOf(r)){for(;M!==null;){var P=Us(M);if(P!==null)switch(P.tag){case 3:if(P=P.stateNode,P.current.memoizedState.isDehydrated){var V=Fe(P.pendingLanes);if(V!==0){var te=P;for(te.pendingLanes|=2,te.entangledLanes|=2;V;){var Me=1<<31-Je(V);te.entanglements[1]|=Me,V&=~Me}so(P),(ni&6)===0&&(Id=xi()+500,ss(0))}}break;case 31:case 13:te=Da(P,2),te!==null&&Va(te,P,2),Rd(),zp(P,2)}if(P=Qd(_),P===null&&Fo(r,s,_,Nh,d),P===M)break;M=P}M!==null&&_.stopPropagation()}else Fo(r,s,_,null,d)}}function Qd(r){return r=Nc(r),Dp(r)}var Nh=null;function Dp(r){if(Nh=null,r=ds(r),r!==null){var s=k(r);if(s===null)r=null;else{var d=s.tag;if(d===13){if(r=A(s),r!==null)return r;r=null}else if(d===31){if(r=l(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Nh=r,null}function zu(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(nr()){case fe:return 2;case Z:return 8;case X:case Q:return 32;case de:return 268435456;default:return 32}default:return 32}}var Pp=!1,wc=null,Ns=null,Tc=null,Jd=new Map,Fh=new Map,Dl=[],i_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function oy(r,s){switch(r){case"focusin":case"focusout":wc=null;break;case"dragenter":case"dragleave":Ns=null;break;case"mouseover":case"mouseout":Tc=null;break;case"pointerover":case"pointerout":Jd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fh.delete(s.pointerId)}}function ef(r,s,d,_,M,P){return r===null||r.nativeEvent!==P?(r={blockedOn:s,domEventName:d,eventSystemFlags:_,nativeEvent:P,targetContainers:[M]},s!==null&&(s=Us(s),s!==null&&ry(s)),r):(r.eventSystemFlags|=_,s=r.targetContainers,M!==null&&s.indexOf(M)===-1&&s.push(M),r)}function r_(r,s,d,_,M){switch(s){case"focusin":return wc=ef(wc,r,s,d,_,M),!0;case"dragenter":return Ns=ef(Ns,r,s,d,_,M),!0;case"mouseover":return Tc=ef(Tc,r,s,d,_,M),!0;case"pointerover":var P=M.pointerId;return Jd.set(P,ef(Jd.get(P)||null,r,s,d,_,M)),!0;case"gotpointercapture":return P=M.pointerId,Fh.set(P,ef(Fh.get(P)||null,r,s,d,_,M)),!0}return!1}function ly(r){var s=ds(r.target);if(s!==null){var d=k(s);if(d!==null){if(s=d.tag,s===13){if(s=A(d),s!==null){r.blockedOn=s,ln(r.priority,function(){ay(d)});return}}else if(s===31){if(s=l(d),s!==null){r.blockedOn=s,ln(r.priority,function(){ay(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function tf(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=Qd(r.nativeEvent);if(d===null){d=r.nativeEvent;var _=new d.constructor(d.type,d);Qh=_,d.target.dispatchEvent(_),Qh=null}else return s=Us(d),s!==null&&ry(s),r.blockedOn=d,!1;s.shift()}return!0}function cy(r,s,d){tf(r)&&d.delete(s)}function nf(){Pp=!1,wc!==null&&tf(wc)&&(wc=null),Ns!==null&&tf(Ns)&&(Ns=null),Tc!==null&&tf(Tc)&&(Tc=null),Jd.forEach(cy),Fh.forEach(cy)}function Ip(r,s){r.blockedOn===s&&(r.blockedOn=null,Pp||(Pp=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,nf)))}var kp=null;function uy(r){kp!==r&&(kp=r,h.unstable_scheduleCallback(h.unstable_NormalPriority,function(){kp===r&&(kp=null);for(var s=0;s<r.length;s+=3){var d=r[s],_=r[s+1],M=r[s+2];if(typeof _!="function"){if(Dp(_||d)===null)continue;break}var P=Us(d);P!==null&&(r.splice(s,3),s-=3,Ii(P,{pending:!0,data:M,method:d.method,action:_},_,M))}}))}function Sc(r){function s(Me){return Ip(Me,r)}wc!==null&&Ip(wc,r),Ns!==null&&Ip(Ns,r),Tc!==null&&Ip(Tc,r),Jd.forEach(s),Fh.forEach(s);for(var d=0;d<Dl.length;d++){var _=Dl[d];_.blockedOn===r&&(_.blockedOn=null)}for(;0<Dl.length&&(d=Dl[0],d.blockedOn===null);)ly(d),d.blockedOn===null&&Dl.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(_=0;_<d.length;_+=3){var M=d[_],P=d[_+1],V=M[ft]||null;if(typeof P=="function")V||uy(d);else if(V){var te=null;if(P&&P.hasAttribute("formAction")){if(M=P,V=P[ft]||null)te=V.formAction;else if(Dp(M)!==null)continue}else te=V.action;typeof te=="function"?d[_+1]=te:(d.splice(_,3),_-=3),uy(d)}}}function Wm(){function r(P){P.canIntercept&&P.info==="react-transition"&&P.intercept({handler:function(){return new Promise(function(V){return M=V})},focusReset:"manual",scroll:"manual"})}function s(){M!==null&&(M(),M=null),_||setTimeout(d,20)}function d(){if(!_&&!navigation.transition){var P=navigation.currentEntry;P&&P.url!=null&&navigation.navigate(P.url,{state:P.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var _=!1,M=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(d,100),function(){_=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),M!==null&&(M(),M=null)}}}function Km(r){this._internalRoot=r}Rp.prototype.render=Km.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(S(409));var d=s.current,_=Ua();iy(d,_,r,s,null,null)},Rp.prototype.unmount=Km.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;iy(r.current,2,null,r,null,null),Rd(),s[Jt]=null}};function Rp(r){this._internalRoot=r}Rp.prototype.unstable_scheduleHydration=function(r){if(r){var s=Ut();r={blockedOn:null,target:r,priority:s};for(var d=0;d<Dl.length&&s!==0&&s<Dl[d].priority;d++);Dl.splice(d,0,r),d===0&&ly(r)}};var Qm=m.version;if(Qm!=="19.2.3")throw Error(S(527,Qm,"19.2.3"));Xe.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(S(188)):(r=Object.keys(r).join(","),Error(S(268,r)));return r=W(s),r=r!==null?ne(r):null,r=r===null?null:r.stateNode,r};var hy={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Se,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lp.isDisabled&&Lp.supportsFiber)try{Re=Lp.inject(hy),ye=Lp}catch{}}return rg.createRoot=function(r,s){if(!z(r))throw Error(S(299));var d=!1,_="",M=_h,P=no,V=io;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(_=s.identifierPrefix),s.onUncaughtError!==void 0&&(M=s.onUncaughtError),s.onCaughtError!==void 0&&(P=s.onCaughtError),s.onRecoverableError!==void 0&&(V=s.onRecoverableError)),s=Xm(r,1,!1,null,null,d,_,null,M,P,V,Wm),r[Jt]=s.current,zm(r),new Km(s)},rg.hydrateRoot=function(r,s,d){if(!z(r))throw Error(S(299));var _=!1,M="",P=_h,V=no,te=io,Me=null;return d!=null&&(d.unstable_strictMode===!0&&(_=!0),d.identifierPrefix!==void 0&&(M=d.identifierPrefix),d.onUncaughtError!==void 0&&(P=d.onUncaughtError),d.onCaughtError!==void 0&&(V=d.onCaughtError),d.onRecoverableError!==void 0&&(te=d.onRecoverableError),d.formState!==void 0&&(Me=d.formState)),s=Xm(r,1,!0,s,d??null,_,M,Me,P,V,te,Wm),s.context=ny(null),d=s.current,_=Ua(),_=lt(_),M=Is(_),M.callback=null,Ks(d,M,_),d=_,s.current.lanes=d,Bn(s,d),so(s),r[Jt]=s.current,zm(r),new Rp(s)},rg.version="19.2.3",rg}var sv;function B1(){if(sv)return g_.exports;sv=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(m){console.error(m)}}return h(),g_.exports=O1(),g_.exports}var N1=B1();const F1=ky(N1),j1="modulepreload",U1=function(h){return"/parlens-pwa/"+h},ov={},rx=function(m,b,S){let z=Promise.resolve();if(b&&b.length>0){let W=function(ne){return Promise.all(ne.map(re=>Promise.resolve(re).then(xe=>({status:"fulfilled",value:xe}),xe=>({status:"rejected",reason:xe}))))};var A=W;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),N=l?.nonce||l?.getAttribute("nonce");z=W(b.map(ne=>{if(ne=U1(ne),ne in ov)return;ov[ne]=!0;const re=ne.endsWith(".css"),xe=re?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${ne}"]${xe}`))return;const Ae=document.createElement("link");if(Ae.rel=re?"stylesheet":j1,re||(Ae.as="script"),Ae.crossOrigin="",Ae.href=ne,N&&Ae.setAttribute("nonce",N),document.head.appendChild(Ae),re)return new Promise((Ie,pe)=>{Ae.addEventListener("load",Ie),Ae.addEventListener("error",()=>pe(new Error(`Unable to preload CSS for ${ne}`)))})}))}function k(l){const N=new Event("vite:preloadError",{cancelable:!0});if(N.payload=l,window.dispatchEvent(N),!N.defaultPrevented)throw l}return z.then(l=>{for(const N of l||[])N.status==="rejected"&&k(N.reason);return m().catch(k)})};function lv(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`Wrong positive integer: ${h}`)}function ax(h,...m){if(!(h instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(h.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${h.length}`)}function V1(h){if(typeof h!="function"||typeof h.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");lv(h.outputLen),lv(h.blockLen)}function by(h,m=!0){if(h.destroyed)throw new Error("Hash instance has been destroyed");if(m&&h.finished)throw new Error("Hash#digest() has already been called")}function q1(h,m){ax(h);const b=m.outputLen;if(h.length<b)throw new Error(`digestInto() expects output buffer of length at least ${b}`)}const x_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const sx=h=>h instanceof Uint8Array,b_=h=>new DataView(h.buffer,h.byteOffset,h.byteLength),Mc=(h,m)=>h<<32-m|h>>>m,G1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!G1)throw new Error("Non little-endian hardware is not supported");function Z1(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function r0(h){if(typeof h=="string"&&(h=Z1(h)),!sx(h))throw new Error(`expected Uint8Array, got ${typeof h}`);return h}function H1(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!sx(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}let ox=class{clone(){return this._cloneInto()}};function $1(h){const m=S=>h().update(r0(S)).digest(),b=h();return m.outputLen=b.outputLen,m.blockLen=b.blockLen,m.create=()=>h(),m}function lx(h=32){if(x_&&typeof x_.getRandomValues=="function")return x_.getRandomValues(new Uint8Array(h));throw new Error("crypto.getRandomValues must be defined")}function X1(h,m,b,S){if(typeof h.setBigUint64=="function")return h.setBigUint64(m,b,S);const z=BigInt(32),k=BigInt(4294967295),A=Number(b>>z&k),l=Number(b&k),N=S?4:0,W=S?0:4;h.setUint32(m+N,A,S),h.setUint32(m+W,l,S)}let Y1=class extends ox{constructor(m,b,S,z){super(),this.blockLen=m,this.outputLen=b,this.padOffset=S,this.isLE=z,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=b_(this.buffer)}update(m){by(this);const{view:b,buffer:S,blockLen:z}=this;m=r0(m);const k=m.length;for(let A=0;A<k;){const l=Math.min(z-this.pos,k-A);if(l===z){const N=b_(m);for(;z<=k-A;A+=z)this.process(N,A);continue}S.set(m.subarray(A,A+l),this.pos),this.pos+=l,A+=l,this.pos===z&&(this.process(b,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){by(this),q1(m,this),this.finished=!0;const{buffer:b,view:S,blockLen:z,isLE:k}=this;let{pos:A}=this;b[A++]=128,this.buffer.subarray(A).fill(0),this.padOffset>z-A&&(this.process(S,0),A=0);for(let re=A;re<z;re++)b[re]=0;X1(S,z-8,BigInt(this.length*8),k),this.process(S,0);const l=b_(m),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const W=N/4,ne=this.get();if(W>ne.length)throw new Error("_sha2: outputLen bigger than state");for(let re=0;re<W;re++)l.setUint32(4*re,ne[re],k)}digest(){const{buffer:m,outputLen:b}=this;this.digestInto(m);const S=m.slice(0,b);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:b,buffer:S,length:z,finished:k,destroyed:A,pos:l}=this;return m.length=z,m.pos=l,m.finished=k,m.destroyed=A,z%b&&m.buffer.set(S),m}};const W1=(h,m,b)=>h&m^~h&b,K1=(h,m,b)=>h&m^h&b^m&b,Q1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Uh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vh=new Uint32Array(64);let J1=class extends Y1{constructor(){super(64,32,8,!1),this.A=Uh[0]|0,this.B=Uh[1]|0,this.C=Uh[2]|0,this.D=Uh[3]|0,this.E=Uh[4]|0,this.F=Uh[5]|0,this.G=Uh[6]|0,this.H=Uh[7]|0}get(){const{A:m,B:b,C:S,D:z,E:k,F:A,G:l,H:N}=this;return[m,b,S,z,k,A,l,N]}set(m,b,S,z,k,A,l,N){this.A=m|0,this.B=b|0,this.C=S|0,this.D=z|0,this.E=k|0,this.F=A|0,this.G=l|0,this.H=N|0}process(m,b){for(let re=0;re<16;re++,b+=4)Vh[re]=m.getUint32(b,!1);for(let re=16;re<64;re++){const xe=Vh[re-15],Ae=Vh[re-2],Ie=Mc(xe,7)^Mc(xe,18)^xe>>>3,pe=Mc(Ae,17)^Mc(Ae,19)^Ae>>>10;Vh[re]=pe+Vh[re-7]+Ie+Vh[re-16]|0}let{A:S,B:z,C:k,D:A,E:l,F:N,G:W,H:ne}=this;for(let re=0;re<64;re++){const xe=Mc(l,6)^Mc(l,11)^Mc(l,25),Ae=ne+xe+W1(l,N,W)+Q1[re]+Vh[re]|0,pe=(Mc(S,2)^Mc(S,13)^Mc(S,22))+K1(S,z,k)|0;ne=W,W=N,N=l,l=A+Ae|0,A=k,k=z,z=S,S=Ae+pe|0}S=S+this.A|0,z=z+this.B|0,k=k+this.C|0,A=A+this.D|0,l=l+this.E|0,N=N+this.F|0,W=W+this.G|0,ne=ne+this.H|0,this.set(S,z,k,A,l,N,W,ne)}roundClean(){Vh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const L_=$1(()=>new J1);const cx=BigInt(0),Ry=BigInt(1),ew=BigInt(2),Ly=h=>h instanceof Uint8Array,tw=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function qp(h){if(!Ly(h))throw new Error("Uint8Array expected");let m="";for(let b=0;b<h.length;b++)m+=tw[h[b]];return m}function ux(h){const m=h.toString(16);return m.length&1?`0${m}`:m}function a0(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);return BigInt(h===""?"0":`0x${h}`)}function Gp(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const b=new Uint8Array(m/2);for(let S=0;S<b.length;S++){const z=S*2,k=h.slice(z,z+2),A=Number.parseInt(k,16);if(Number.isNaN(A)||A<0)throw new Error("Invalid byte sequence");b[S]=A}return b}function js(h){return a0(qp(h))}function s0(h){if(!Ly(h))throw new Error("Uint8Array expected");return a0(qp(Uint8Array.from(h).reverse()))}function $h(h,m){return Gp(h.toString(16).padStart(m*2,"0"))}function o0(h,m){return $h(h,m).reverse()}function nw(h){return Gp(ux(h))}function Za(h,m,b){let S;if(typeof m=="string")try{S=Gp(m)}catch(k){throw new Error(`${h} must be valid hex string, got "${m}". Cause: ${k}`)}else if(Ly(m))S=Uint8Array.from(m);else throw new Error(`${h} must be hex string or Uint8Array`);const z=S.length;if(typeof b=="number"&&z!==b)throw new Error(`${h} expected ${b} bytes, got ${z}`);return S}function pf(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!Ly(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}function iw(h,m){if(h.length!==m.length)return!1;for(let b=0;b<h.length;b++)if(h[b]!==m[b])return!1;return!0}function rw(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function aw(h){let m;for(m=0;h>cx;h>>=Ry,m+=1);return m}function sw(h,m){return h>>BigInt(m)&Ry}const ow=(h,m,b)=>h|(b?Ry:cx)<<BigInt(m),l0=h=>(ew<<BigInt(h-1))-Ry,w_=h=>new Uint8Array(h),cv=h=>Uint8Array.from(h);function hx(h,m,b){if(typeof h!="number"||h<2)throw new Error("hashLen must be a number");if(typeof m!="number"||m<2)throw new Error("qByteLen must be a number");if(typeof b!="function")throw new Error("hmacFn must be a function");let S=w_(h),z=w_(h),k=0;const A=()=>{S.fill(1),z.fill(0),k=0},l=(...re)=>b(z,S,...re),N=(re=w_())=>{z=l(cv([0]),re),S=l(),re.length!==0&&(z=l(cv([1]),re),S=l())},W=()=>{if(k++>=1e3)throw new Error("drbg: tried 1000 values");let re=0;const xe=[];for(;re<m;){S=l();const Ae=S.slice();xe.push(Ae),re+=S.length}return pf(...xe)};return(re,xe)=>{A(),N(re);let Ae;for(;!(Ae=xe(W()));)N();return A(),Ae}}const lw={bigint:h=>typeof h=="bigint",function:h=>typeof h=="function",boolean:h=>typeof h=="boolean",string:h=>typeof h=="string",stringOrUint8Array:h=>typeof h=="string"||h instanceof Uint8Array,isSafeInteger:h=>Number.isSafeInteger(h),array:h=>Array.isArray(h),field:(h,m)=>m.Fp.isValid(h),hash:h=>typeof h=="function"&&Number.isSafeInteger(h.outputLen)};function fg(h,m,b={}){const S=(z,k,A)=>{const l=lw[k];if(typeof l!="function")throw new Error(`Invalid validator "${k}", expected function`);const N=h[z];if(!(A&&N===void 0)&&!l(N,h))throw new Error(`Invalid param ${String(z)}=${N} (${typeof N}), expected ${k}`)};for(const[z,k]of Object.entries(m))S(z,k,!1);for(const[z,k]of Object.entries(b))S(z,k,!0);return h}const cw=Object.freeze(Object.defineProperty({__proto__:null,bitGet:sw,bitLen:aw,bitMask:l0,bitSet:ow,bytesToHex:qp,bytesToNumberBE:js,bytesToNumberLE:s0,concatBytes:pf,createHmacDrbg:hx,ensureBytes:Za,equalBytes:iw,hexToBytes:Gp,hexToNumber:a0,numberToBytesBE:$h,numberToBytesLE:o0,numberToHexUnpadded:ux,numberToVarBytesBE:nw,utf8ToBytes:rw,validateObject:fg},Symbol.toStringTag,{value:"Module"}));const ra=BigInt(0),Mr=BigInt(1),uf=BigInt(2),uw=BigInt(3),O_=BigInt(4),uv=BigInt(5),hv=BigInt(8);BigInt(9);BigInt(16);function Ta(h,m){const b=h%m;return b>=ra?b:m+b}function hw(h,m,b){if(b<=ra||m<ra)throw new Error("Expected power/modulo > 0");if(b===Mr)return ra;let S=Mr;for(;m>ra;)m&Mr&&(S=S*h%b),h=h*h%b,m>>=Mr;return S}function Vo(h,m,b){let S=h;for(;m-- >ra;)S*=S,S%=b;return S}function B_(h,m){if(h===ra||m<=ra)throw new Error(`invert: expected positive integers, got n=${h} mod=${m}`);let b=Ta(h,m),S=m,z=ra,k=Mr;for(;b!==ra;){const l=S/b,N=S%b,W=z-k*l;S=b,b=N,z=k,k=W}if(S!==Mr)throw new Error("invert: does not exist");return Ta(z,m)}function dw(h){const m=(h-Mr)/uf;let b,S,z;for(b=h-Mr,S=0;b%uf===ra;b/=uf,S++);for(z=uf;z<h&&hw(z,m,h)!==h-Mr;z++);if(S===1){const A=(h+Mr)/O_;return function(N,W){const ne=N.pow(W,A);if(!N.eql(N.sqr(ne),W))throw new Error("Cannot find square root");return ne}}const k=(b+Mr)/uf;return function(l,N){if(l.pow(N,m)===l.neg(l.ONE))throw new Error("Cannot find square root");let W=S,ne=l.pow(l.mul(l.ONE,z),b),re=l.pow(N,k),xe=l.pow(N,b);for(;!l.eql(xe,l.ONE);){if(l.eql(xe,l.ZERO))return l.ZERO;let Ae=1;for(let pe=l.sqr(xe);Ae<W&&!l.eql(pe,l.ONE);Ae++)pe=l.sqr(pe);const Ie=l.pow(ne,Mr<<BigInt(W-Ae-1));ne=l.sqr(Ie),re=l.mul(re,Ie),xe=l.mul(xe,ne),W=Ae}return re}}function fw(h){if(h%O_===uw){const m=(h+Mr)/O_;return function(S,z){const k=S.pow(z,m);if(!S.eql(S.sqr(k),z))throw new Error("Cannot find square root");return k}}if(h%hv===uv){const m=(h-uv)/hv;return function(S,z){const k=S.mul(z,uf),A=S.pow(k,m),l=S.mul(z,A),N=S.mul(S.mul(l,uf),A),W=S.mul(l,S.sub(N,S.ONE));if(!S.eql(S.sqr(W),z))throw new Error("Cannot find square root");return W}}return dw(h)}const pw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function mw(h){const m={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},b=pw.reduce((S,z)=>(S[z]="function",S),m);return fg(h,b)}function gw(h,m,b){if(b<ra)throw new Error("Expected power > 0");if(b===ra)return h.ONE;if(b===Mr)return m;let S=h.ONE,z=m;for(;b>ra;)b&Mr&&(S=h.mul(S,z)),z=h.sqr(z),b>>=Mr;return S}function yw(h,m){const b=new Array(m.length),S=m.reduce((k,A,l)=>h.is0(A)?k:(b[l]=k,h.mul(k,A)),h.ONE),z=h.inv(S);return m.reduceRight((k,A,l)=>h.is0(A)?k:(b[l]=h.mul(k,b[l]),h.mul(k,A)),z),b}function dx(h,m){const b=m!==void 0?m:h.toString(2).length,S=Math.ceil(b/8);return{nBitLength:b,nByteLength:S}}function _w(h,m,b=!1,S={}){if(h<=ra)throw new Error(`Expected Field ORDER > 0, got ${h}`);const{nBitLength:z,nByteLength:k}=dx(h,m);if(k>2048)throw new Error("Field lengths over 2048 bytes are not supported");const A=fw(h),l=Object.freeze({ORDER:h,BITS:z,BYTES:k,MASK:l0(z),ZERO:ra,ONE:Mr,create:N=>Ta(N,h),isValid:N=>{if(typeof N!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof N}`);return ra<=N&&N<h},is0:N=>N===ra,isOdd:N=>(N&Mr)===Mr,neg:N=>Ta(-N,h),eql:(N,W)=>N===W,sqr:N=>Ta(N*N,h),add:(N,W)=>Ta(N+W,h),sub:(N,W)=>Ta(N-W,h),mul:(N,W)=>Ta(N*W,h),pow:(N,W)=>gw(l,N,W),div:(N,W)=>Ta(N*B_(W,h),h),sqrN:N=>N*N,addN:(N,W)=>N+W,subN:(N,W)=>N-W,mulN:(N,W)=>N*W,inv:N=>B_(N,h),sqrt:S.sqrt||(N=>A(l,N)),invertBatch:N=>yw(l,N),cmov:(N,W,ne)=>ne?W:N,toBytes:N=>b?o0(N,k):$h(N,k),fromBytes:N=>{if(N.length!==k)throw new Error(`Fp.fromBytes: expected ${k}, got ${N.length}`);return b?s0(N):js(N)}});return Object.freeze(l)}function fx(h){if(typeof h!="bigint")throw new Error("field order must be bigint");const m=h.toString(2).length;return Math.ceil(m/8)}function px(h){const m=fx(h);return m+Math.ceil(m/2)}function vw(h,m,b=!1){const S=h.length,z=fx(m),k=px(m);if(S<16||S<k||S>1024)throw new Error(`expected ${k}-1024 bytes of input, got ${S}`);const A=b?js(h):s0(h),l=Ta(A,m-Mr)+Mr;return b?o0(l,z):$h(l,z)}const xw=BigInt(0),T_=BigInt(1);function bw(h,m){const b=(z,k)=>{const A=k.negate();return z?A:k},S=z=>{const k=Math.ceil(m/z)+1,A=2**(z-1);return{windows:k,windowSize:A}};return{constTimeNegate:b,unsafeLadder(z,k){let A=h.ZERO,l=z;for(;k>xw;)k&T_&&(A=A.add(l)),l=l.double(),k>>=T_;return A},precomputeWindow(z,k){const{windows:A,windowSize:l}=S(k),N=[];let W=z,ne=W;for(let re=0;re<A;re++){ne=W,N.push(ne);for(let xe=1;xe<l;xe++)ne=ne.add(W),N.push(ne);W=ne.double()}return N},wNAF(z,k,A){const{windows:l,windowSize:N}=S(z);let W=h.ZERO,ne=h.BASE;const re=BigInt(2**z-1),xe=2**z,Ae=BigInt(z);for(let Ie=0;Ie<l;Ie++){const pe=Ie*N;let ae=Number(A&re);A>>=Ae,ae>N&&(ae-=xe,A+=T_);const ke=pe,Ke=pe+Math.abs(ae)-1,at=Ie%2!==0,zt=ae<0;ae===0?ne=ne.add(b(at,k[ke])):W=W.add(b(zt,k[Ke]))}return{p:W,f:ne}},wNAFCached(z,k,A,l){const N=z._WINDOW_SIZE||1;let W=k.get(z);return W||(W=this.precomputeWindow(z,N),N!==1&&k.set(z,l(W))),this.wNAF(N,W,A)}}}function mx(h){return mw(h.Fp),fg(h,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...dx(h.n,h.nBitLength),...h,p:h.Fp.ORDER})}function ww(h){const m=mx(h);fg(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:b,Fp:S,a:z}=m;if(b){if(!S.eql(z,S.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof b!="object"||typeof b.beta!="bigint"||typeof b.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})}const{bytesToNumberBE:Tw,hexToBytes:Sw}=cw,df={Err:class extends Error{constructor(m=""){super(m)}},_parseInt(h){const{Err:m}=df;if(h.length<2||h[0]!==2)throw new m("Invalid signature integer tag");const b=h[1],S=h.subarray(2,b+2);if(!b||S.length!==b)throw new m("Invalid signature integer: wrong length");if(S[0]&128)throw new m("Invalid signature integer: negative");if(S[0]===0&&!(S[1]&128))throw new m("Invalid signature integer: unnecessary leading zero");return{d:Tw(S),l:h.subarray(b+2)}},toSig(h){const{Err:m}=df,b=typeof h=="string"?Sw(h):h;if(!(b instanceof Uint8Array))throw new Error("ui8a expected");let S=b.length;if(S<2||b[0]!=48)throw new m("Invalid signature tag");if(b[1]!==S-2)throw new m("Invalid signature: incorrect length");const{d:z,l:k}=df._parseInt(b.subarray(2)),{d:A,l}=df._parseInt(k);if(l.length)throw new m("Invalid signature: left bytes after parsing");return{r:z,s:A}},hexFromSig(h){const m=W=>Number.parseInt(W[0],16)&8?"00"+W:W,b=W=>{const ne=W.toString(16);return ne.length&1?`0${ne}`:ne},S=m(b(h.s)),z=m(b(h.r)),k=S.length/2,A=z.length/2,l=b(k),N=b(A);return`30${b(A+k+4)}02${N}${z}02${l}${S}`}},Ru=BigInt(0),qo=BigInt(1);BigInt(2);const dv=BigInt(3);BigInt(4);function Ew(h){const m=ww(h),{Fp:b}=m,S=m.toBytes||((Ie,pe,ae)=>{const ke=pe.toAffine();return pf(Uint8Array.from([4]),b.toBytes(ke.x),b.toBytes(ke.y))}),z=m.fromBytes||(Ie=>{const pe=Ie.subarray(1),ae=b.fromBytes(pe.subarray(0,b.BYTES)),ke=b.fromBytes(pe.subarray(b.BYTES,2*b.BYTES));return{x:ae,y:ke}});function k(Ie){const{a:pe,b:ae}=m,ke=b.sqr(Ie),Ke=b.mul(ke,Ie);return b.add(b.add(Ke,b.mul(Ie,pe)),ae)}if(!b.eql(b.sqr(m.Gy),k(m.Gx)))throw new Error("bad generator point: equation left != right");function A(Ie){return typeof Ie=="bigint"&&Ru<Ie&&Ie<m.n}function l(Ie){if(!A(Ie))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function N(Ie){const{allowedPrivateKeyLengths:pe,nByteLength:ae,wrapPrivateKey:ke,n:Ke}=m;if(pe&&typeof Ie!="bigint"){if(Ie instanceof Uint8Array&&(Ie=qp(Ie)),typeof Ie!="string"||!pe.includes(Ie.length))throw new Error("Invalid key");Ie=Ie.padStart(ae*2,"0")}let at;try{at=typeof Ie=="bigint"?Ie:js(Za("private key",Ie,ae))}catch{throw new Error(`private key must be ${ae} bytes, hex or bigint, not ${typeof Ie}`)}return ke&&(at=Ta(at,Ke)),l(at),at}const W=new Map;function ne(Ie){if(!(Ie instanceof re))throw new Error("ProjectivePoint expected")}class re{constructor(pe,ae,ke){if(this.px=pe,this.py=ae,this.pz=ke,pe==null||!b.isValid(pe))throw new Error("x required");if(ae==null||!b.isValid(ae))throw new Error("y required");if(ke==null||!b.isValid(ke))throw new Error("z required")}static fromAffine(pe){const{x:ae,y:ke}=pe||{};if(!pe||!b.isValid(ae)||!b.isValid(ke))throw new Error("invalid affine point");if(pe instanceof re)throw new Error("projective point not allowed");const Ke=at=>b.eql(at,b.ZERO);return Ke(ae)&&Ke(ke)?re.ZERO:new re(ae,ke,b.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(pe){const ae=b.invertBatch(pe.map(ke=>ke.pz));return pe.map((ke,Ke)=>ke.toAffine(ae[Ke])).map(re.fromAffine)}static fromHex(pe){const ae=re.fromAffine(z(Za("pointHex",pe)));return ae.assertValidity(),ae}static fromPrivateKey(pe){return re.BASE.multiply(N(pe))}_setWindowSize(pe){this._WINDOW_SIZE=pe,W.delete(this)}assertValidity(){if(this.is0()){if(m.allowInfinityPoint&&!b.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:pe,y:ae}=this.toAffine();if(!b.isValid(pe)||!b.isValid(ae))throw new Error("bad point: x or y not FE");const ke=b.sqr(ae),Ke=k(pe);if(!b.eql(ke,Ke))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:pe}=this.toAffine();if(b.isOdd)return!b.isOdd(pe);throw new Error("Field doesn't support isOdd")}equals(pe){ne(pe);const{px:ae,py:ke,pz:Ke}=this,{px:at,py:zt,pz:wt}=pe,ut=b.eql(b.mul(ae,wt),b.mul(at,Ke)),ot=b.eql(b.mul(ke,wt),b.mul(zt,Ke));return ut&&ot}negate(){return new re(this.px,b.neg(this.py),this.pz)}double(){const{a:pe,b:ae}=m,ke=b.mul(ae,dv),{px:Ke,py:at,pz:zt}=this;let wt=b.ZERO,ut=b.ZERO,ot=b.ZERO,Pe=b.mul(Ke,Ke),rt=b.mul(at,at),nt=b.mul(zt,zt),ct=b.mul(Ke,at);return ct=b.add(ct,ct),ot=b.mul(Ke,zt),ot=b.add(ot,ot),wt=b.mul(pe,ot),ut=b.mul(ke,nt),ut=b.add(wt,ut),wt=b.sub(rt,ut),ut=b.add(rt,ut),ut=b.mul(wt,ut),wt=b.mul(ct,wt),ot=b.mul(ke,ot),nt=b.mul(pe,nt),ct=b.sub(Pe,nt),ct=b.mul(pe,ct),ct=b.add(ct,ot),ot=b.add(Pe,Pe),Pe=b.add(ot,Pe),Pe=b.add(Pe,nt),Pe=b.mul(Pe,ct),ut=b.add(ut,Pe),nt=b.mul(at,zt),nt=b.add(nt,nt),Pe=b.mul(nt,ct),wt=b.sub(wt,Pe),ot=b.mul(nt,rt),ot=b.add(ot,ot),ot=b.add(ot,ot),new re(wt,ut,ot)}add(pe){ne(pe);const{px:ae,py:ke,pz:Ke}=this,{px:at,py:zt,pz:wt}=pe;let ut=b.ZERO,ot=b.ZERO,Pe=b.ZERO;const rt=m.a,nt=b.mul(m.b,dv);let ct=b.mul(ae,at),Tt=b.mul(ke,zt),Nt=b.mul(Ke,wt),qt=b.add(ae,ke),ht=b.add(at,zt);qt=b.mul(qt,ht),ht=b.add(ct,Tt),qt=b.sub(qt,ht),ht=b.add(ae,Ke);let Se=b.add(at,wt);return ht=b.mul(ht,Se),Se=b.add(ct,Nt),ht=b.sub(ht,Se),Se=b.add(ke,Ke),ut=b.add(zt,wt),Se=b.mul(Se,ut),ut=b.add(Tt,Nt),Se=b.sub(Se,ut),Pe=b.mul(rt,ht),ut=b.mul(nt,Nt),Pe=b.add(ut,Pe),ut=b.sub(Tt,Pe),Pe=b.add(Tt,Pe),ot=b.mul(ut,Pe),Tt=b.add(ct,ct),Tt=b.add(Tt,ct),Nt=b.mul(rt,Nt),ht=b.mul(nt,ht),Tt=b.add(Tt,Nt),Nt=b.sub(ct,Nt),Nt=b.mul(rt,Nt),ht=b.add(ht,Nt),ct=b.mul(Tt,ht),ot=b.add(ot,ct),ct=b.mul(Se,ht),ut=b.mul(qt,ut),ut=b.sub(ut,ct),ct=b.mul(qt,Tt),Pe=b.mul(Se,Pe),Pe=b.add(Pe,ct),new re(ut,ot,Pe)}subtract(pe){return this.add(pe.negate())}is0(){return this.equals(re.ZERO)}wNAF(pe){return Ae.wNAFCached(this,W,pe,ae=>{const ke=b.invertBatch(ae.map(Ke=>Ke.pz));return ae.map((Ke,at)=>Ke.toAffine(ke[at])).map(re.fromAffine)})}multiplyUnsafe(pe){const ae=re.ZERO;if(pe===Ru)return ae;if(l(pe),pe===qo)return this;const{endo:ke}=m;if(!ke)return Ae.unsafeLadder(this,pe);let{k1neg:Ke,k1:at,k2neg:zt,k2:wt}=ke.splitScalar(pe),ut=ae,ot=ae,Pe=this;for(;at>Ru||wt>Ru;)at&qo&&(ut=ut.add(Pe)),wt&qo&&(ot=ot.add(Pe)),Pe=Pe.double(),at>>=qo,wt>>=qo;return Ke&&(ut=ut.negate()),zt&&(ot=ot.negate()),ot=new re(b.mul(ot.px,ke.beta),ot.py,ot.pz),ut.add(ot)}multiply(pe){l(pe);let ae=pe,ke,Ke;const{endo:at}=m;if(at){const{k1neg:zt,k1:wt,k2neg:ut,k2:ot}=at.splitScalar(ae);let{p:Pe,f:rt}=this.wNAF(wt),{p:nt,f:ct}=this.wNAF(ot);Pe=Ae.constTimeNegate(zt,Pe),nt=Ae.constTimeNegate(ut,nt),nt=new re(b.mul(nt.px,at.beta),nt.py,nt.pz),ke=Pe.add(nt),Ke=rt.add(ct)}else{const{p:zt,f:wt}=this.wNAF(ae);ke=zt,Ke=wt}return re.normalizeZ([ke,Ke])[0]}multiplyAndAddUnsafe(pe,ae,ke){const Ke=re.BASE,at=(wt,ut)=>ut===Ru||ut===qo||!wt.equals(Ke)?wt.multiplyUnsafe(ut):wt.multiply(ut),zt=at(this,ae).add(at(pe,ke));return zt.is0()?void 0:zt}toAffine(pe){const{px:ae,py:ke,pz:Ke}=this,at=this.is0();pe==null&&(pe=at?b.ONE:b.inv(Ke));const zt=b.mul(ae,pe),wt=b.mul(ke,pe),ut=b.mul(Ke,pe);if(at)return{x:b.ZERO,y:b.ZERO};if(!b.eql(ut,b.ONE))throw new Error("invZ was invalid");return{x:zt,y:wt}}isTorsionFree(){const{h:pe,isTorsionFree:ae}=m;if(pe===qo)return!0;if(ae)return ae(re,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:pe,clearCofactor:ae}=m;return pe===qo?this:ae?ae(re,this):this.multiplyUnsafe(m.h)}toRawBytes(pe=!0){return this.assertValidity(),S(re,this,pe)}toHex(pe=!0){return qp(this.toRawBytes(pe))}}re.BASE=new re(m.Gx,m.Gy,b.ONE),re.ZERO=new re(b.ZERO,b.ONE,b.ZERO);const xe=m.nBitLength,Ae=bw(re,m.endo?Math.ceil(xe/2):xe);return{CURVE:m,ProjectivePoint:re,normPrivateKeyToScalar:N,weierstrassEquation:k,isWithinCurveOrder:A}}function Mw(h){const m=mx(h);return fg(m,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...m})}function Aw(h){const m=Mw(h),{Fp:b,n:S}=m,z=b.BYTES+1,k=2*b.BYTES+1;function A(ht){return Ru<ht&&ht<b.ORDER}function l(ht){return Ta(ht,S)}function N(ht){return B_(ht,S)}const{ProjectivePoint:W,normPrivateKeyToScalar:ne,weierstrassEquation:re,isWithinCurveOrder:xe}=Ew({...m,toBytes(ht,Se,Xe){const _t=Se.toAffine(),xt=b.toBytes(_t.x),Bt=pf;return Xe?Bt(Uint8Array.from([Se.hasEvenY()?2:3]),xt):Bt(Uint8Array.from([4]),xt,b.toBytes(_t.y))},fromBytes(ht){const Se=ht.length,Xe=ht[0],_t=ht.subarray(1);if(Se===z&&(Xe===2||Xe===3)){const xt=js(_t);if(!A(xt))throw new Error("Point is not on curve");const Bt=re(xt);let Te=b.sqrt(Bt);const Ve=(Te&qo)===qo;return(Xe&1)===1!==Ve&&(Te=b.neg(Te)),{x:xt,y:Te}}else if(Se===k&&Xe===4){const xt=b.fromBytes(_t.subarray(0,b.BYTES)),Bt=b.fromBytes(_t.subarray(b.BYTES,2*b.BYTES));return{x:xt,y:Bt}}else throw new Error(`Point of length ${Se} was invalid. Expected ${z} compressed bytes or ${k} uncompressed bytes`)}}),Ae=ht=>qp($h(ht,m.nByteLength));function Ie(ht){const Se=S>>qo;return ht>Se}function pe(ht){return Ie(ht)?l(-ht):ht}const ae=(ht,Se,Xe)=>js(ht.slice(Se,Xe));class ke{constructor(Se,Xe,_t){this.r=Se,this.s=Xe,this.recovery=_t,this.assertValidity()}static fromCompact(Se){const Xe=m.nByteLength;return Se=Za("compactSignature",Se,Xe*2),new ke(ae(Se,0,Xe),ae(Se,Xe,2*Xe))}static fromDER(Se){const{r:Xe,s:_t}=df.toSig(Za("DER",Se));return new ke(Xe,_t)}assertValidity(){if(!xe(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!xe(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Se){return new ke(this.r,this.s,Se)}recoverPublicKey(Se){const{r:Xe,s:_t,recovery:xt}=this,Bt=ot(Za("msgHash",Se));if(xt==null||![0,1,2,3].includes(xt))throw new Error("recovery id invalid");const Te=xt===2||xt===3?Xe+m.n:Xe;if(Te>=b.ORDER)throw new Error("recovery id 2 or 3 invalid");const Ve=(xt&1)===0?"02":"03",bt=W.fromHex(Ve+Ae(Te)),Dt=N(Te),jt=l(-Bt*Dt),Xt=l(_t*Dt),Yt=W.BASE.multiplyAndAddUnsafe(bt,jt,Xt);if(!Yt)throw new Error("point at infinify");return Yt.assertValidity(),Yt}hasHighS(){return Ie(this.s)}normalizeS(){return this.hasHighS()?new ke(this.r,l(-this.s),this.recovery):this}toDERRawBytes(){return Gp(this.toDERHex())}toDERHex(){return df.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Gp(this.toCompactHex())}toCompactHex(){return Ae(this.r)+Ae(this.s)}}const Ke={isValidPrivateKey(ht){try{return ne(ht),!0}catch{return!1}},normPrivateKeyToScalar:ne,randomPrivateKey:()=>{const ht=px(m.n);return vw(m.randomBytes(ht),m.n)},precompute(ht=8,Se=W.BASE){return Se._setWindowSize(ht),Se.multiply(BigInt(3)),Se}};function at(ht,Se=!0){return W.fromPrivateKey(ht).toRawBytes(Se)}function zt(ht){const Se=ht instanceof Uint8Array,Xe=typeof ht=="string",_t=(Se||Xe)&&ht.length;return Se?_t===z||_t===k:Xe?_t===2*z||_t===2*k:ht instanceof W}function wt(ht,Se,Xe=!0){if(zt(ht))throw new Error("first arg must be private key");if(!zt(Se))throw new Error("second arg must be public key");return W.fromHex(Se).multiply(ne(ht)).toRawBytes(Xe)}const ut=m.bits2int||function(ht){const Se=js(ht),Xe=ht.length*8-m.nBitLength;return Xe>0?Se>>BigInt(Xe):Se},ot=m.bits2int_modN||function(ht){return l(ut(ht))},Pe=l0(m.nBitLength);function rt(ht){if(typeof ht!="bigint")throw new Error("bigint expected");if(!(Ru<=ht&&ht<Pe))throw new Error(`bigint expected < 2^${m.nBitLength}`);return $h(ht,m.nByteLength)}function nt(ht,Se,Xe=ct){if(["recovered","canonical"].some(Kt=>Kt in Xe))throw new Error("sign() legacy options not supported");const{hash:_t,randomBytes:xt}=m;let{lowS:Bt,prehash:Te,extraEntropy:Ve}=Xe;Bt==null&&(Bt=!0),ht=Za("msgHash",ht),Te&&(ht=Za("prehashed msgHash",_t(ht)));const bt=ot(ht),Dt=ne(Se),jt=[rt(Dt),rt(bt)];if(Ve!=null){const Kt=Ve===!0?xt(b.BYTES):Ve;jt.push(Za("extraEntropy",Kt))}const Xt=pf(...jt),Yt=bt;function mn(Kt){const wn=ut(Kt);if(!xe(wn))return;const br=N(wn),Zn=W.BASE.multiply(wn).toAffine(),lr=l(Zn.x);if(lr===Ru)return;const Dn=l(br*l(Yt+lr*Dt));if(Dn===Ru)return;let Bi=(Zn.x===lr?0:2)|Number(Zn.y&qo),Ni=Dn;return Bt&&Ie(Dn)&&(Ni=pe(Dn),Bi^=1),new ke(lr,Ni,Bi)}return{seed:Xt,k2sig:mn}}const ct={lowS:m.lowS,prehash:!1},Tt={lowS:m.lowS,prehash:!1};function Nt(ht,Se,Xe=ct){const{seed:_t,k2sig:xt}=nt(ht,Se,Xe),Bt=m;return hx(Bt.hash.outputLen,Bt.nByteLength,Bt.hmac)(_t,xt)}W.BASE._setWindowSize(8);function qt(ht,Se,Xe,_t=Tt){const xt=ht;if(Se=Za("msgHash",Se),Xe=Za("publicKey",Xe),"strict"in _t)throw new Error("options.strict was renamed to lowS");const{lowS:Bt,prehash:Te}=_t;let Ve,bt;try{if(typeof xt=="string"||xt instanceof Uint8Array)try{Ve=ke.fromDER(xt)}catch(Zn){if(!(Zn instanceof df.Err))throw Zn;Ve=ke.fromCompact(xt)}else if(typeof xt=="object"&&typeof xt.r=="bigint"&&typeof xt.s=="bigint"){const{r:Zn,s:lr}=xt;Ve=new ke(Zn,lr)}else throw new Error("PARSE");bt=W.fromHex(Xe)}catch(Zn){if(Zn.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Bt&&Ve.hasHighS())return!1;Te&&(Se=m.hash(Se));const{r:Dt,s:jt}=Ve,Xt=ot(Se),Yt=N(jt),mn=l(Xt*Yt),Kt=l(Dt*Yt),wn=W.BASE.multiplyAndAddUnsafe(bt,mn,Kt)?.toAffine();return wn?l(wn.x)===Dt:!1}return{CURVE:m,getPublicKey:at,getSharedSecret:wt,sign:Nt,verify:qt,ProjectivePoint:W,Signature:ke,utils:Ke}}let gx=class extends ox{constructor(m,b){super(),this.finished=!1,this.destroyed=!1,V1(m);const S=r0(b);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const z=this.blockLen,k=new Uint8Array(z);k.set(S.length>z?m.create().update(S).digest():S);for(let A=0;A<k.length;A++)k[A]^=54;this.iHash.update(k),this.oHash=m.create();for(let A=0;A<k.length;A++)k[A]^=106;this.oHash.update(k),k.fill(0)}update(m){return by(this),this.iHash.update(m),this}digestInto(m){by(this),ax(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:b,iHash:S,finished:z,destroyed:k,blockLen:A,outputLen:l}=this;return m=m,m.finished=z,m.destroyed=k,m.blockLen=A,m.outputLen=l,m.oHash=b._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const yx=(h,m,b)=>new gx(h,m).update(b).digest();yx.create=(h,m)=>new gx(h,m);function Cw(h){return{hash:h,hmac:(m,...b)=>yx(h,m,H1(...b)),randomBytes:lx}}function zw(h,m){const b=S=>Aw({...h,...Cw(S)});return Object.freeze({...b(m),create:b})}const Oy=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),wy=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_x=BigInt(1),Ty=BigInt(2),fv=(h,m)=>(h+m/Ty)/m;function vx(h){const m=Oy,b=BigInt(3),S=BigInt(6),z=BigInt(11),k=BigInt(22),A=BigInt(23),l=BigInt(44),N=BigInt(88),W=h*h*h%m,ne=W*W*h%m,re=Vo(ne,b,m)*ne%m,xe=Vo(re,b,m)*ne%m,Ae=Vo(xe,Ty,m)*W%m,Ie=Vo(Ae,z,m)*Ae%m,pe=Vo(Ie,k,m)*Ie%m,ae=Vo(pe,l,m)*pe%m,ke=Vo(ae,N,m)*ae%m,Ke=Vo(ke,l,m)*pe%m,at=Vo(Ke,b,m)*ne%m,zt=Vo(at,A,m)*Ie%m,wt=Vo(zt,S,m)*W%m,ut=Vo(wt,Ty,m);if(!N_.eql(N_.sqr(ut),h))throw new Error("Cannot find square root");return ut}const N_=_w(Oy,void 0,void 0,{sqrt:vx}),$p=zw({a:BigInt(0),b:BigInt(7),Fp:N_,n:wy,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:h=>{const m=wy,b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),S=-_x*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),z=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),k=b,A=BigInt("0x100000000000000000000000000000000"),l=fv(k*h,m),N=fv(-S*h,m);let W=Ta(h-l*b-N*z,m),ne=Ta(-l*S-N*k,m);const re=W>A,xe=ne>A;if(re&&(W=m-W),xe&&(ne=m-ne),W>A||ne>A)throw new Error("splitScalar: Endomorphism failed, k="+h);return{k1neg:re,k1:W,k2neg:xe,k2:ne}}}},L_),By=BigInt(0),xx=h=>typeof h=="bigint"&&By<h&&h<Oy,Dw=h=>typeof h=="bigint"&&By<h&&h<wy,pv={};function Sy(h,...m){let b=pv[h];if(b===void 0){const S=L_(Uint8Array.from(h,z=>z.charCodeAt(0)));b=pf(S,S),pv[h]=b}return L_(pf(b,...m))}const c0=h=>h.toRawBytes(!0).slice(1),F_=h=>$h(h,32),S_=h=>Ta(h,Oy),sg=h=>Ta(h,wy),u0=$p.ProjectivePoint,Pw=(h,m,b)=>u0.BASE.multiplyAndAddUnsafe(h,m,b);function j_(h){let m=$p.utils.normPrivateKeyToScalar(h),b=u0.fromPrivateKey(m);return{scalar:b.hasEvenY()?m:sg(-m),bytes:c0(b)}}function bx(h){if(!xx(h))throw new Error("bad x: need 0 < x < p");const m=S_(h*h),b=S_(m*h+BigInt(7));let S=vx(b);S%Ty!==By&&(S=S_(-S));const z=new u0(h,S,_x);return z.assertValidity(),z}function wx(...h){return sg(js(Sy("BIP0340/challenge",...h)))}function Iw(h){return j_(h).bytes}function kw(h,m,b=lx(32)){const S=Za("message",h),{bytes:z,scalar:k}=j_(m),A=Za("auxRand",b,32),l=F_(k^js(Sy("BIP0340/aux",A))),N=Sy("BIP0340/nonce",l,z,S),W=sg(js(N));if(W===By)throw new Error("sign failed: k is zero");const{bytes:ne,scalar:re}=j_(W),xe=wx(ne,z,S),Ae=new Uint8Array(64);if(Ae.set(ne,0),Ae.set(F_(sg(re+xe*k)),32),!Tx(Ae,S,z))throw new Error("sign: Invalid signature produced");return Ae}function Tx(h,m,b){const S=Za("signature",h,64),z=Za("message",m),k=Za("publicKey",b,32);try{const A=bx(js(k)),l=js(S.subarray(0,32));if(!xx(l))return!1;const N=js(S.subarray(32,64));if(!Dw(N))return!1;const W=wx(F_(l),c0(A),z),ne=Pw(A,N,sg(-W));return!(!ne||!ne.hasEvenY()||ne.toAffine().x!==l)}catch{return!1}}const zc={getPublicKey:Iw,sign:kw,verify:Tx,utils:{randomPrivateKey:$p.utils.randomPrivateKey,lift_x:bx,pointToBytes:c0,numberToBytesBE:$h,bytesToNumberBE:js,taggedHash:Sy,mod:Ta}},E_=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const h0=h=>h instanceof Uint8Array,M_=h=>new DataView(h.buffer,h.byteOffset,h.byteLength),Ac=(h,m)=>h<<32-m|h>>>m,Rw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Rw)throw new Error("Non little-endian hardware is not supported");const Lw=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Lr(h){if(!h0(h))throw new Error("Uint8Array expected");let m="";for(let b=0;b<h.length;b++)m+=Lw[h[b]];return m}function mf(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const b=new Uint8Array(m/2);for(let S=0;S<b.length;S++){const z=S*2,k=h.slice(z,z+2),A=Number.parseInt(k,16);if(Number.isNaN(A)||A<0)throw new Error("Invalid byte sequence");b[S]=A}return b}function Ow(h){if(typeof h!="string")throw new Error(`utf8ToBytes expected string, got ${typeof h}`);return new Uint8Array(new TextEncoder().encode(h))}function og(h){if(typeof h=="string"&&(h=Ow(h)),!h0(h))throw new Error(`expected Uint8Array, got ${typeof h}`);return h}function Ny(...h){const m=new Uint8Array(h.reduce((S,z)=>S+z.length,0));let b=0;return h.forEach(S=>{if(!h0(S))throw new Error("Uint8Array expected");m.set(S,b),b+=S.length}),m}class Sx{clone(){return this._cloneInto()}}function Ex(h){const m=S=>h().update(og(S)).digest(),b=h();return m.outputLen=b.outputLen,m.blockLen=b.blockLen,m.create=()=>h(),m}function Mx(h=32){if(E_&&typeof E_.getRandomValues=="function")return E_.getRandomValues(new Uint8Array(h));throw new Error("crypto.getRandomValues must be defined")}function U_(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`Wrong positive integer: ${h}`)}function Bw(h){if(typeof h!="boolean")throw new Error(`Expected boolean, not ${h}`)}function Ax(h,...m){if(!(h instanceof Uint8Array))throw new Error("Expected Uint8Array");if(m.length>0&&!m.includes(h.length))throw new Error(`Expected Uint8Array of length ${m}, not of length=${h.length}`)}function Nw(h){if(typeof h!="function"||typeof h.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");U_(h.outputLen),U_(h.blockLen)}function Fw(h,m=!0){if(h.destroyed)throw new Error("Hash instance has been destroyed");if(m&&h.finished)throw new Error("Hash#digest() has already been called")}function jw(h,m){Ax(h);const b=m.outputLen;if(h.length<b)throw new Error(`digestInto() expects output buffer of length at least ${b}`)}const Dc={number:U_,bool:Bw,bytes:Ax,hash:Nw,exists:Fw,output:jw};function Uw(h,m,b,S){if(typeof h.setBigUint64=="function")return h.setBigUint64(m,b,S);const z=BigInt(32),k=BigInt(4294967295),A=Number(b>>z&k),l=Number(b&k),N=S?4:0,W=S?0:4;h.setUint32(m+N,A,S),h.setUint32(m+W,l,S)}class Vw extends Sx{constructor(m,b,S,z){super(),this.blockLen=m,this.outputLen=b,this.padOffset=S,this.isLE=z,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=M_(this.buffer)}update(m){Dc.exists(this);const{view:b,buffer:S,blockLen:z}=this;m=og(m);const k=m.length;for(let A=0;A<k;){const l=Math.min(z-this.pos,k-A);if(l===z){const N=M_(m);for(;z<=k-A;A+=z)this.process(N,A);continue}S.set(m.subarray(A,A+l),this.pos),this.pos+=l,A+=l,this.pos===z&&(this.process(b,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){Dc.exists(this),Dc.output(m,this),this.finished=!0;const{buffer:b,view:S,blockLen:z,isLE:k}=this;let{pos:A}=this;b[A++]=128,this.buffer.subarray(A).fill(0),this.padOffset>z-A&&(this.process(S,0),A=0);for(let re=A;re<z;re++)b[re]=0;Uw(S,z-8,BigInt(this.length*8),k),this.process(S,0);const l=M_(m),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const W=N/4,ne=this.get();if(W>ne.length)throw new Error("_sha2: outputLen bigger than state");for(let re=0;re<W;re++)l.setUint32(4*re,ne[re],k)}digest(){const{buffer:m,outputLen:b}=this;this.digestInto(m);const S=m.slice(0,b);return this.destroy(),S}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:b,buffer:S,length:z,finished:k,destroyed:A,pos:l}=this;return m.length=z,m.pos=l,m.finished=k,m.destroyed=A,z%b&&m.buffer.set(S),m}}const qw=(h,m,b)=>h&m^~h&b,Gw=(h,m,b)=>h&m^h&b^m&b,Zw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),qh=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Gh=new Uint32Array(64);class Cx extends Vw{constructor(){super(64,32,8,!1),this.A=qh[0]|0,this.B=qh[1]|0,this.C=qh[2]|0,this.D=qh[3]|0,this.E=qh[4]|0,this.F=qh[5]|0,this.G=qh[6]|0,this.H=qh[7]|0}get(){const{A:m,B:b,C:S,D:z,E:k,F:A,G:l,H:N}=this;return[m,b,S,z,k,A,l,N]}set(m,b,S,z,k,A,l,N){this.A=m|0,this.B=b|0,this.C=S|0,this.D=z|0,this.E=k|0,this.F=A|0,this.G=l|0,this.H=N|0}process(m,b){for(let re=0;re<16;re++,b+=4)Gh[re]=m.getUint32(b,!1);for(let re=16;re<64;re++){const xe=Gh[re-15],Ae=Gh[re-2],Ie=Ac(xe,7)^Ac(xe,18)^xe>>>3,pe=Ac(Ae,17)^Ac(Ae,19)^Ae>>>10;Gh[re]=pe+Gh[re-7]+Ie+Gh[re-16]|0}let{A:S,B:z,C:k,D:A,E:l,F:N,G:W,H:ne}=this;for(let re=0;re<64;re++){const xe=Ac(l,6)^Ac(l,11)^Ac(l,25),Ae=ne+xe+qw(l,N,W)+Zw[re]+Gh[re]|0,pe=(Ac(S,2)^Ac(S,13)^Ac(S,22))+Gw(S,z,k)|0;ne=W,W=N,N=l,l=A+Ae|0,A=k,k=z,z=S,S=Ae+pe|0}S=S+this.A|0,z=z+this.B|0,k=k+this.C|0,A=A+this.D|0,l=l+this.E|0,N=N+this.F|0,W=W+this.G|0,ne=ne+this.H|0,this.set(S,z,k,A,l,N,W,ne)}roundClean(){Gh.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Hw extends Cx{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Xh=Ex(()=>new Cx);Ex(()=>new Hw);function Xp(h){if(!Number.isSafeInteger(h))throw new Error(`Wrong integer: ${h}`)}function Nu(...h){const m=(z,k)=>A=>z(k(A)),b=Array.from(h).reverse().reduce((z,k)=>z?m(z,k.encode):k.encode,void 0),S=h.reduce((z,k)=>z?m(z,k.decode):k.decode,void 0);return{encode:b,decode:S}}function Fu(h){return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return m.map(b=>{if(Xp(b),b<0||b>=h.length)throw new Error(`Digit index outside alphabet: ${b} (alphabet: ${h.length})`);return h[b]})},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("alphabet.decode input should be array of strings");return m.map(b=>{if(typeof b!="string")throw new Error(`alphabet.decode: not string element=${b}`);const S=h.indexOf(b);if(S===-1)throw new Error(`Unknown letter: "${b}". Allowed: ${h}`);return S})}}}function ju(h=""){if(typeof h!="string")throw new Error("join separator should be string");return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("join.encode input should be array of strings");for(let b of m)if(typeof b!="string")throw new Error(`join.encode: non-string input=${b}`);return m.join(h)},decode:m=>{if(typeof m!="string")throw new Error("join.decode input should be string");return m.split(h)}}}function Fy(h,m="="){if(Xp(h),typeof m!="string")throw new Error("padding chr should be string");return{encode(b){if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("padding.encode input should be array of strings");for(let S of b)if(typeof S!="string")throw new Error(`padding.encode: non-string input=${S}`);for(;b.length*h%8;)b.push(m);return b},decode(b){if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("padding.encode input should be array of strings");for(let z of b)if(typeof z!="string")throw new Error(`padding.decode: non-string input=${z}`);let S=b.length;if(S*h%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;S>0&&b[S-1]===m;S--)if(!((S-1)*h%8))throw new Error("Invalid padding: string has too much padding");return b.slice(0,S)}}}function zx(h){if(typeof h!="function")throw new Error("normalize fn should be function");return{encode:m=>m,decode:m=>h(m)}}function mv(h,m,b){if(m<2)throw new Error(`convertRadix: wrong from=${m}, base cannot be less than 2`);if(b<2)throw new Error(`convertRadix: wrong to=${b}, base cannot be less than 2`);if(!Array.isArray(h))throw new Error("convertRadix: data should be array");if(!h.length)return[];let S=0;const z=[],k=Array.from(h);for(k.forEach(A=>{if(Xp(A),A<0||A>=m)throw new Error(`Wrong integer: ${A}`)});;){let A=0,l=!0;for(let N=S;N<k.length;N++){const W=k[N],ne=m*A+W;if(!Number.isSafeInteger(ne)||m*A/m!==A||ne-W!==m*A)throw new Error("convertRadix: carry overflow");if(A=ne%b,k[N]=Math.floor(ne/b),!Number.isSafeInteger(k[N])||k[N]*b+A!==ne)throw new Error("convertRadix: carry overflow");if(l)k[N]?l=!1:S=N;else continue}if(z.push(A),l)break}for(let A=0;A<h.length-1&&h[A]===0;A++)z.push(0);return z.reverse()}const Dx=(h,m)=>m?Dx(m,h%m):h,Ey=(h,m)=>h+(m-Dx(h,m));function V_(h,m,b,S){if(!Array.isArray(h))throw new Error("convertRadix2: data should be array");if(m<=0||m>32)throw new Error(`convertRadix2: wrong from=${m}`);if(b<=0||b>32)throw new Error(`convertRadix2: wrong to=${b}`);if(Ey(m,b)>32)throw new Error(`convertRadix2: carry overflow from=${m} to=${b} carryBits=${Ey(m,b)}`);let z=0,k=0;const A=2**b-1,l=[];for(const N of h){if(Xp(N),N>=2**m)throw new Error(`convertRadix2: invalid data word=${N} from=${m}`);if(z=z<<m|N,k+m>32)throw new Error(`convertRadix2: carry overflow pos=${k} from=${m}`);for(k+=m;k>=b;k-=b)l.push((z>>k-b&A)>>>0);z&=2**k-1}if(z=z<<b-k&A,!S&&k>=m)throw new Error("Excess padding");if(!S&&z)throw new Error(`Non-zero padding: ${z}`);return S&&k>0&&l.push(z>>>0),l}function $w(h){return Xp(h),{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return mv(Array.from(m),2**8,h)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(mv(m,h,2**8))}}}function Yh(h,m=!1){if(Xp(h),h<=0||h>32)throw new Error("radix2: bits should be in (0..32]");if(Ey(8,h)>32||Ey(h,8)>32)throw new Error("radix2: carry overflow");return{encode:b=>{if(!(b instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return V_(Array.from(b),8,h,!m)},decode:b=>{if(!Array.isArray(b)||b.length&&typeof b[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(V_(b,h,8,m))}}}function gv(h){if(typeof h!="function")throw new Error("unsafeWrapper fn should be function");return function(...m){try{return h.apply(null,m)}catch{}}}const Xw=Nu(Yh(4),Fu("0123456789ABCDEF"),ju("")),Yw=Nu(Yh(5),Fu("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Fy(5),ju(""));Nu(Yh(5),Fu("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Fy(5),ju(""));Nu(Yh(5),Fu("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ju(""),zx(h=>h.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Bu=Nu(Yh(6),Fu("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Fy(6),ju("")),Ww=Nu(Yh(6),Fu("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Fy(6),ju("")),d0=h=>Nu($w(58),Fu(h),ju("")),q_=d0("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");d0("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");d0("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const yv=[0,2,3,5,6,7,9,10,11],Kw={encode(h){let m="";for(let b=0;b<h.length;b+=8){const S=h.subarray(b,b+8);m+=q_.encode(S).padStart(yv[S.length],"1")}return m},decode(h){let m=[];for(let b=0;b<h.length;b+=11){const S=h.slice(b,b+11),z=yv.indexOf(S.length),k=q_.decode(S);for(let A=0;A<k.length-z;A++)if(k[A]!==0)throw new Error("base58xmr: wrong padding");m=m.concat(Array.from(k.slice(k.length-z)))}return Uint8Array.from(m)}},G_=Nu(Fu("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ju("")),_v=[996825010,642813549,513874426,1027748829,705979059];function ag(h){const m=h>>25;let b=(h&33554431)<<5;for(let S=0;S<_v.length;S++)(m>>S&1)===1&&(b^=_v[S]);return b}function vv(h,m,b=1){const S=h.length;let z=1;for(let k=0;k<S;k++){const A=h.charCodeAt(k);if(A<33||A>126)throw new Error(`Invalid prefix (${h})`);z=ag(z)^A>>5}z=ag(z);for(let k=0;k<S;k++)z=ag(z)^h.charCodeAt(k)&31;for(let k of m)z=ag(z)^k;for(let k=0;k<6;k++)z=ag(z);return z^=b,G_.encode(V_([z%2**30],30,5,!1))}function Px(h){const m=h==="bech32"?1:734539939,b=Yh(5),S=b.decode,z=b.encode,k=gv(S);function A(ne,re,xe=90){if(typeof ne!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof ne}`);if(!Array.isArray(re)||re.length&&typeof re[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof re}`);const Ae=ne.length+7+re.length;if(xe!==!1&&Ae>xe)throw new TypeError(`Length ${Ae} exceeds limit ${xe}`);return ne=ne.toLowerCase(),`${ne}1${G_.encode(re)}${vv(ne,re,m)}`}function l(ne,re=90){if(typeof ne!="string")throw new Error(`bech32.decode input should be string, not ${typeof ne}`);if(ne.length<8||re!==!1&&ne.length>re)throw new TypeError(`Wrong string length: ${ne.length} (${ne}). Expected (8..${re})`);const xe=ne.toLowerCase();if(ne!==xe&&ne!==ne.toUpperCase())throw new Error("String must be lowercase or uppercase");ne=xe;const Ae=ne.lastIndexOf("1");if(Ae===0||Ae===-1)throw new Error('Letter "1" must be present between prefix and data only');const Ie=ne.slice(0,Ae),pe=ne.slice(Ae+1);if(pe.length<6)throw new Error("Data must be at least 6 characters long");const ae=G_.decode(pe).slice(0,-6),ke=vv(Ie,ae,m);if(!pe.endsWith(ke))throw new Error(`Invalid checksum in ${ne}: expected "${ke}"`);return{prefix:Ie,words:ae}}const N=gv(l);function W(ne){const{prefix:re,words:xe}=l(ne,!1);return{prefix:re,words:xe,bytes:S(xe)}}return{encode:A,decode:l,decodeToBytes:W,decodeUnsafe:N,fromWords:S,fromWordsUnsafe:k,toWords:z}}const Zp=Px("bech32");Px("bech32m");const Qw={encode:h=>new TextDecoder().decode(h),decode:h=>new TextEncoder().encode(h)},Jw=Nu(Yh(4),Fu("0123456789abcdef"),ju(""),zx(h=>{if(typeof h!="string"||h.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof h} with length ${h.length}`);return h.toLowerCase()})),e2={utf8:Qw,hex:Jw,base16:Xw,base32:Yw,base64:Bu,base64url:Ww,base58:q_,base58xmr:Kw};`${Object.keys(e2).join(", ")}`;function A_(h){if(!Number.isSafeInteger(h)||h<0)throw new Error(`positive integer expected, not ${h}`)}function xv(h){if(typeof h!="boolean")throw new Error(`boolean expected, not ${h}`)}function t2(h){return h instanceof Uint8Array||h!=null&&typeof h=="object"&&h.constructor.name==="Uint8Array"}function Pc(h,...m){if(!t2(h))throw new Error("Uint8Array expected");if(m.length>0&&!m.includes(h.length))throw new Error(`Uint8Array expected of length ${m}, not of length=${h.length}`)}const Ha=h=>new Uint32Array(h.buffer,h.byteOffset,Math.floor(h.byteLength/4)),n2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!n2)throw new Error("Non little-endian hardware is not supported");const i2=Array.from({length:256},(h,m)=>m.toString(16).padStart(2,"0"));function Fp(h){Pc(h);let m="";for(let b=0;b<h.length;b++)m+=i2[h[b]];return m}const Iu={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function bv(h){if(h>=Iu._0&&h<=Iu._9)return h-Iu._0;if(h>=Iu._A&&h<=Iu._F)return h-(Iu._A-10);if(h>=Iu._a&&h<=Iu._f)return h-(Iu._a-10)}function Ix(h){if(typeof h!="string")throw new Error("hex string expected, got "+typeof h);const m=h.length,b=m/2;if(m%2)throw new Error("padded hex string expected, got unpadded hex of length "+m);const S=new Uint8Array(b);for(let z=0,k=0;z<b;z++,k+=2){const A=bv(h.charCodeAt(k)),l=bv(h.charCodeAt(k+1));if(A===void 0||l===void 0){const N=h[k]+h[k+1];throw new Error('hex string expected, got non-hex character "'+N+'" at index '+k)}S[z]=A*16+l}return S}function r2(h,m){if(m==null||typeof m!="object")throw new Error("options must be defined");return Object.assign(h,m)}function a2(h,m){if(h.length!==m.length)return!1;let b=0;for(let S=0;S<h.length;S++)b|=h[S]^m[S];return b===0}const s2=(h,m)=>(Object.assign(m,h),m),Hh=16,o2=283;function f0(h){return h<<1^o2&-(h>>7)}function Up(h,m){let b=0;for(;m>0;m>>=1)b^=h&-(m&1),h=f0(h);return b}const Z_=(()=>{let h=new Uint8Array(256);for(let b=0,S=1;b<256;b++,S^=f0(S))h[b]=S;const m=new Uint8Array(256);m[0]=99;for(let b=0;b<255;b++){let S=h[255-b];S|=S<<8,m[h[b]]=(S^S>>4^S>>5^S>>6^S>>7^99)&255}return m})(),l2=Z_.map((h,m)=>Z_.indexOf(m)),c2=h=>h<<24|h>>>8,C_=h=>h<<8|h>>>24;function kx(h,m){if(h.length!==256)throw new Error("Wrong sbox length");const b=new Uint32Array(256).map((W,ne)=>m(h[ne])),S=b.map(C_),z=S.map(C_),k=z.map(C_),A=new Uint32Array(256*256),l=new Uint32Array(256*256),N=new Uint16Array(256*256);for(let W=0;W<256;W++)for(let ne=0;ne<256;ne++){const re=W*256+ne;A[re]=b[W]^S[ne],l[re]=z[W]^k[ne],N[re]=h[W]<<8|h[ne]}return{sbox:h,sbox2:N,T0:b,T1:S,T2:z,T3:k,T01:A,T23:l}}const p0=kx(Z_,h=>Up(h,3)<<24|h<<16|h<<8|Up(h,2)),Rx=kx(l2,h=>Up(h,11)<<24|Up(h,13)<<16|Up(h,9)<<8|Up(h,14)),u2=(()=>{const h=new Uint8Array(16);for(let m=0,b=1;m<16;m++,b=f0(b))h[m]=b;return h})();function Lx(h){Pc(h);const m=h.length;if(![16,24,32].includes(m))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${m}`);const{sbox2:b}=p0,S=Ha(h),z=S.length,k=l=>Ic(b,l,l,l,l),A=new Uint32Array(m+28);A.set(S);for(let l=z;l<A.length;l++){let N=A[l-1];l%z===0?N=k(c2(N))^u2[l/z-1]:z>6&&l%z===4&&(N=k(N)),A[l]=A[l-z]^N}return A}function h2(h){const m=Lx(h),b=m.slice(),S=m.length,{sbox2:z}=p0,{T0:k,T1:A,T2:l,T3:N}=Rx;for(let W=0;W<S;W+=4)for(let ne=0;ne<4;ne++)b[W+ne]=m[S-W-4+ne];m.fill(0);for(let W=4;W<S-4;W++){const ne=b[W],re=Ic(z,ne,ne,ne,ne);b[W]=k[re&255]^A[re>>>8&255]^l[re>>>16&255]^N[re>>>24]}return b}function Zh(h,m,b,S,z,k){return h[b<<8&65280|S>>>8&255]^m[z>>>8&65280|k>>>24&255]}function Ic(h,m,b,S,z){return h[m&255|b&65280]|h[S>>>16&255|z>>>16&65280]<<16}function wv(h,m,b,S,z){const{sbox2:k,T01:A,T23:l}=p0;let N=0;m^=h[N++],b^=h[N++],S^=h[N++],z^=h[N++];const W=h.length/4-2;for(let Ie=0;Ie<W;Ie++){const pe=h[N++]^Zh(A,l,m,b,S,z),ae=h[N++]^Zh(A,l,b,S,z,m),ke=h[N++]^Zh(A,l,S,z,m,b),Ke=h[N++]^Zh(A,l,z,m,b,S);m=pe,b=ae,S=ke,z=Ke}const ne=h[N++]^Ic(k,m,b,S,z),re=h[N++]^Ic(k,b,S,z,m),xe=h[N++]^Ic(k,S,z,m,b),Ae=h[N++]^Ic(k,z,m,b,S);return{s0:ne,s1:re,s2:xe,s3:Ae}}function d2(h,m,b,S,z){const{sbox2:k,T01:A,T23:l}=Rx;let N=0;m^=h[N++],b^=h[N++],S^=h[N++],z^=h[N++];const W=h.length/4-2;for(let Ie=0;Ie<W;Ie++){const pe=h[N++]^Zh(A,l,m,z,S,b),ae=h[N++]^Zh(A,l,b,m,z,S),ke=h[N++]^Zh(A,l,S,b,m,z),Ke=h[N++]^Zh(A,l,z,S,b,m);m=pe,b=ae,S=ke,z=Ke}const ne=h[N++]^Ic(k,m,z,S,b),re=h[N++]^Ic(k,b,m,z,S),xe=h[N++]^Ic(k,S,b,m,z),Ae=h[N++]^Ic(k,z,S,b,m);return{s0:ne,s1:re,s2:xe,s3:Ae}}function Ox(h,m){if(!m)return new Uint8Array(h);if(Pc(m),m.length<h)throw new Error(`aes: wrong destination length, expected at least ${h}, got: ${m.length}`);return m}function f2(h){if(Pc(h),h.length%Hh!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Hh}`)}function p2(h,m,b){let S=h.length;const z=S%Hh;if(!m&&z!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const k=Ha(h);if(m){let N=Hh-z;N||(N=Hh),S=S+N}const A=Ox(S,b),l=Ha(A);return{b:k,o:l,out:A}}function m2(h,m){if(!m)return h;const b=h.length;if(!b)throw new Error("aes/pcks5: empty ciphertext not allowed");const S=h[b-1];if(S<=0||S>16)throw new Error(`aes/pcks5: wrong padding byte: ${S}`);const z=h.subarray(0,-S);for(let k=0;k<S;k++)if(h[b-k-1]!==S)throw new Error("aes/pcks5: wrong padding");return z}function g2(h){const m=new Uint8Array(16),b=Ha(m);m.set(h);const S=Hh-h.length;for(let z=Hh-S;z<Hh;z++)m[z]=S;return b}const Bx=s2({blockSize:16,nonceLength:16},function(m,b,S={}){Pc(m),Pc(b,16);const z=!S.disablePadding;return{encrypt:(k,A)=>{const l=Lx(m),{b:N,o:W,out:ne}=p2(k,z,A),re=Ha(b);let xe=re[0],Ae=re[1],Ie=re[2],pe=re[3],ae=0;for(;ae+4<=N.length;)xe^=N[ae+0],Ae^=N[ae+1],Ie^=N[ae+2],pe^=N[ae+3],{s0:xe,s1:Ae,s2:Ie,s3:pe}=wv(l,xe,Ae,Ie,pe),W[ae++]=xe,W[ae++]=Ae,W[ae++]=Ie,W[ae++]=pe;if(z){const ke=g2(k.subarray(ae*4));xe^=ke[0],Ae^=ke[1],Ie^=ke[2],pe^=ke[3],{s0:xe,s1:Ae,s2:Ie,s3:pe}=wv(l,xe,Ae,Ie,pe),W[ae++]=xe,W[ae++]=Ae,W[ae++]=Ie,W[ae++]=pe}return l.fill(0),ne},decrypt:(k,A)=>{f2(k);const l=h2(m),N=Ha(b),W=Ox(k.length,A),ne=Ha(k),re=Ha(W);let xe=N[0],Ae=N[1],Ie=N[2],pe=N[3];for(let ae=0;ae+4<=ne.length;){const ke=xe,Ke=Ae,at=Ie,zt=pe;xe=ne[ae+0],Ae=ne[ae+1],Ie=ne[ae+2],pe=ne[ae+3];const{s0:wt,s1:ut,s2:ot,s3:Pe}=d2(l,xe,Ae,Ie,pe);re[ae++]=wt^ke,re[ae++]=ut^Ke,re[ae++]=ot^at,re[ae++]=Pe^zt}return l.fill(0),m2(W,z)}}}),Nx=h=>Uint8Array.from(h.split("").map(m=>m.charCodeAt(0))),y2=Nx("expand 16-byte k"),_2=Nx("expand 32-byte k"),v2=Ha(y2),Fx=Ha(_2);Fx.slice();function ai(h,m){return h<<m|h>>>32-m}function H_(h){return h.byteOffset%4===0}const py=64,x2=16,jx=2**32-1,Tv=new Uint32Array;function b2(h,m,b,S,z,k,A,l){const N=z.length,W=new Uint8Array(py),ne=Ha(W),re=H_(z)&&H_(k),xe=re?Ha(z):Tv,Ae=re?Ha(k):Tv;for(let Ie=0;Ie<N;A++){if(h(m,b,S,ne,A,l),A>=jx)throw new Error("arx: counter overflow");const pe=Math.min(py,N-Ie);if(re&&pe===py){const ae=Ie/4;if(Ie%4!==0)throw new Error("arx: invalid block position");for(let ke=0,Ke;ke<x2;ke++)Ke=ae+ke,Ae[Ke]=xe[Ke]^ne[ke];Ie+=py;continue}for(let ae=0,ke;ae<pe;ae++)ke=Ie+ae,k[ke]=z[ke]^W[ae];Ie+=pe}}function w2(h,m){const{allowShortKeys:b,extendNonceFn:S,counterLength:z,counterRight:k,rounds:A}=r2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},m);if(typeof h!="function")throw new Error("core must be a function");return A_(z),A_(A),xv(k),xv(b),(l,N,W,ne,re=0)=>{Pc(l),Pc(N),Pc(W);const xe=W.length;if(ne||(ne=new Uint8Array(xe)),Pc(ne),A_(re),re<0||re>=jx)throw new Error("arx: counter overflow");if(ne.length<xe)throw new Error(`arx: output (${ne.length}) is shorter than data (${xe})`);const Ae=[];let Ie=l.length,pe,ae;if(Ie===32)pe=l.slice(),Ae.push(pe),ae=Fx;else if(Ie===16&&b)pe=new Uint8Array(32),pe.set(l),pe.set(l,16),ae=v2,Ae.push(pe);else throw new Error(`arx: invalid 32-byte key, got length=${Ie}`);H_(N)||(N=N.slice(),Ae.push(N));const ke=Ha(pe);if(S){if(N.length!==24)throw new Error("arx: extended nonce must be 24 bytes");S(ae,ke,Ha(N.subarray(0,16)),ke),N=N.subarray(16)}const Ke=16-z;if(Ke!==N.length)throw new Error(`arx: nonce must be ${Ke} or 16 bytes`);if(Ke!==12){const zt=new Uint8Array(12);zt.set(N,k?0:12-N.length),N=zt,Ae.push(N)}const at=Ha(N);for(b2(h,ae,ke,at,W,ne,re,A);Ae.length>0;)Ae.pop().fill(0);return ne}}function T2(h,m,b,S,z,k=20){let A=h[0],l=h[1],N=h[2],W=h[3],ne=m[0],re=m[1],xe=m[2],Ae=m[3],Ie=m[4],pe=m[5],ae=m[6],ke=m[7],Ke=z,at=b[0],zt=b[1],wt=b[2],ut=A,ot=l,Pe=N,rt=W,nt=ne,ct=re,Tt=xe,Nt=Ae,qt=Ie,ht=pe,Se=ae,Xe=ke,_t=Ke,xt=at,Bt=zt,Te=wt;for(let bt=0;bt<k;bt+=2)ut=ut+nt|0,_t=ai(_t^ut,16),qt=qt+_t|0,nt=ai(nt^qt,12),ut=ut+nt|0,_t=ai(_t^ut,8),qt=qt+_t|0,nt=ai(nt^qt,7),ot=ot+ct|0,xt=ai(xt^ot,16),ht=ht+xt|0,ct=ai(ct^ht,12),ot=ot+ct|0,xt=ai(xt^ot,8),ht=ht+xt|0,ct=ai(ct^ht,7),Pe=Pe+Tt|0,Bt=ai(Bt^Pe,16),Se=Se+Bt|0,Tt=ai(Tt^Se,12),Pe=Pe+Tt|0,Bt=ai(Bt^Pe,8),Se=Se+Bt|0,Tt=ai(Tt^Se,7),rt=rt+Nt|0,Te=ai(Te^rt,16),Xe=Xe+Te|0,Nt=ai(Nt^Xe,12),rt=rt+Nt|0,Te=ai(Te^rt,8),Xe=Xe+Te|0,Nt=ai(Nt^Xe,7),ut=ut+ct|0,Te=ai(Te^ut,16),Se=Se+Te|0,ct=ai(ct^Se,12),ut=ut+ct|0,Te=ai(Te^ut,8),Se=Se+Te|0,ct=ai(ct^Se,7),ot=ot+Tt|0,_t=ai(_t^ot,16),Xe=Xe+_t|0,Tt=ai(Tt^Xe,12),ot=ot+Tt|0,_t=ai(_t^ot,8),Xe=Xe+_t|0,Tt=ai(Tt^Xe,7),Pe=Pe+Nt|0,xt=ai(xt^Pe,16),qt=qt+xt|0,Nt=ai(Nt^qt,12),Pe=Pe+Nt|0,xt=ai(xt^Pe,8),qt=qt+xt|0,Nt=ai(Nt^qt,7),rt=rt+nt|0,Bt=ai(Bt^rt,16),ht=ht+Bt|0,nt=ai(nt^ht,12),rt=rt+nt|0,Bt=ai(Bt^rt,8),ht=ht+Bt|0,nt=ai(nt^ht,7);let Ve=0;S[Ve++]=A+ut|0,S[Ve++]=l+ot|0,S[Ve++]=N+Pe|0,S[Ve++]=W+rt|0,S[Ve++]=ne+nt|0,S[Ve++]=re+ct|0,S[Ve++]=xe+Tt|0,S[Ve++]=Ae+Nt|0,S[Ve++]=Ie+qt|0,S[Ve++]=pe+ht|0,S[Ve++]=ae+Se|0,S[Ve++]=ke+Xe|0,S[Ve++]=Ke+_t|0,S[Ve++]=at+xt|0,S[Ve++]=zt+Bt|0,S[Ve++]=wt+Te|0}const Ux=w2(T2,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Vx extends Sx{constructor(m,b){super(),this.finished=!1,this.destroyed=!1,Dc.hash(m);const S=og(b);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const z=this.blockLen,k=new Uint8Array(z);k.set(S.length>z?m.create().update(S).digest():S);for(let A=0;A<k.length;A++)k[A]^=54;this.iHash.update(k),this.oHash=m.create();for(let A=0;A<k.length;A++)k[A]^=106;this.oHash.update(k),k.fill(0)}update(m){return Dc.exists(this),this.iHash.update(m),this}digestInto(m){Dc.exists(this),Dc.bytes(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:b,iHash:S,finished:z,destroyed:k,blockLen:A,outputLen:l}=this;return m=m,m.finished=z,m.destroyed=k,m.blockLen=A,m.outputLen=l,m.oHash=b._cloneInto(m.oHash),m.iHash=S._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const jy=(h,m,b)=>new Vx(h,m).update(b).digest();jy.create=(h,m)=>new Vx(h,m);function S2(h,m,b){return Dc.hash(h),jy(h,og(b),og(m))}const z_=new Uint8Array([0]),Sv=new Uint8Array;function E2(h,m,b,S=32){if(Dc.hash(h),Dc.number(S),S>255*h.outputLen)throw new Error("Length should be <= 255*HashLen");const z=Math.ceil(S/h.outputLen);b===void 0&&(b=Sv);const k=new Uint8Array(z*h.outputLen),A=jy.create(h,m),l=A._cloneInto(),N=new Uint8Array(A.outputLen);for(let W=0;W<z;W++)z_[0]=W+1,l.update(W===0?Sv:N).update(b).update(z_).digestInto(N),k.set(N,h.outputLen*W),A._cloneInto(l);return A.destroy(),l.destroy(),N.fill(0),z_.fill(0),k.slice(0,S)}var M2=Object.defineProperty,Ki=(h,m)=>{for(var b in m)M2(h,b,{get:m[b],enumerable:!0})},lf=Symbol("verified"),A2=h=>h instanceof Object;function m0(h){if(!A2(h)||typeof h.kind!="number"||typeof h.content!="string"||typeof h.created_at!="number"||typeof h.pubkey!="string"||!h.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(h.tags))return!1;for(let m=0;m<h.tags.length;m++){let b=h.tags[m];if(!Array.isArray(b))return!1;for(let S=0;S<b.length;S++)if(typeof b[S]!="string")return!1}return!0}var C2={};Ki(C2,{Queue:()=>Gx,QueueNode:()=>qx,binarySearch:()=>g0,bytesToHex:()=>Lr,hexToBytes:()=>mf,insertEventIntoAscendingList:()=>D2,insertEventIntoDescendingList:()=>z2,normalizeURL:()=>hf,utf8Decoder:()=>Ou,utf8Encoder:()=>Bl});var Ou=new TextDecoder("utf-8"),Bl=new TextEncoder;function hf(h){try{h.indexOf("://")===-1&&(h="wss://"+h);let m=new URL(h);return m.protocol==="http:"?m.protocol="ws:":m.protocol==="https:"&&(m.protocol="wss:"),m.pathname=m.pathname.replace(/\/+/g,"/"),m.pathname.endsWith("/")&&(m.pathname=m.pathname.slice(0,-1)),(m.port==="80"&&m.protocol==="ws:"||m.port==="443"&&m.protocol==="wss:")&&(m.port=""),m.searchParams.sort(),m.hash="",m.toString()}catch{throw new Error(`Invalid URL: ${h}`)}}function z2(h,m){const[b,S]=g0(h,z=>m.id===z.id?0:m.created_at===z.created_at?-1:z.created_at-m.created_at);return S||h.splice(b,0,m),h}function D2(h,m){const[b,S]=g0(h,z=>m.id===z.id?0:m.created_at===z.created_at?-1:m.created_at-z.created_at);return S||h.splice(b,0,m),h}function g0(h,m){let b=0,S=h.length-1;for(;b<=S;){const z=Math.floor((b+S)/2),k=m(h[z]);if(k===0)return[z,!0];k<0?S=z-1:b=z+1}return[b,!1]}var qx=class{value;next=null;prev=null;constructor(h){this.value=h}},Gx=class{first;last;constructor(){this.first=null,this.last=null}enqueue(h){const m=new qx(h);return this.last?this.last===this.first?(this.last=m,this.last.prev=this.first,this.first.next=m):(m.prev=this.last,this.last.next=m,this.last=m):(this.first=m,this.last=m),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const m=this.first;return this.first=null,this.last=null,m.value}const h=this.first;return this.first=h.next,this.first&&(this.first.prev=null),h.value}},P2=class{generateSecretKey(){return zc.utils.randomPrivateKey()}getPublicKey(m){return Lr(zc.getPublicKey(m))}finalizeEvent(m,b){const S=m;return S.pubkey=Lr(zc.getPublicKey(b)),S.id=yy(S),S.sig=Lr(zc.sign(yy(S),b)),S[lf]=!0,S}verifyEvent(m){if(typeof m[lf]=="boolean")return m[lf];const b=yy(m);if(b!==m.id)return m[lf]=!1,!1;try{const S=zc.verify(m.sig,b,m.pubkey);return m[lf]=S,S}catch{return m[lf]=!1,!1}}};function I2(h){if(!m0(h))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content])}function yy(h){let m=Xh(Bl.encode(I2(h)));return Lr(m)}var Uy=new P2,Zx=Uy.generateSecretKey,lg=Uy.getPublicKey,Zo=Uy.finalizeEvent,Vy=Uy.verifyEvent,k2={};Ki(k2,{Application:()=>ZT,BadgeAward:()=>U2,BadgeDefinition:()=>NT,BlockedRelaysList:()=>xT,BlossomServerList:()=>AT,BookmarkList:()=>yT,Bookmarksets:()=>LT,Calendar:()=>QT,CalendarEventRSVP:()=>JT,ChannelCreation:()=>Kx,ChannelHideMessage:()=>eb,ChannelMessage:()=>Jx,ChannelMetadata:()=>Qx,ChannelMuteUser:()=>tb,ChatMessage:()=>V2,ClassifiedListing:()=>XT,ClientAuth:()=>ib,Comment:()=>K2,CommunitiesList:()=>_T,CommunityDefinition:()=>iS,CommunityPostApproval:()=>aT,Contacts:()=>N2,CreateOrUpdateProduct:()=>UT,CreateOrUpdateStall:()=>jT,Curationsets:()=>OT,Date:()=>WT,DirectMessageRelaysList:()=>ET,DraftClassifiedListing:()=>YT,DraftLong:()=>qT,Emojisets:()=>GT,EncryptedDirectMessage:()=>F2,EventDeletion:()=>j2,FavoriteRelays:()=>wT,FileMessage:()=>G2,FileMetadata:()=>W2,FileServerPreference:()=>MT,Followsets:()=>IT,ForumThread:()=>q2,GenericRepost:()=>b0,Genericlists:()=>kT,GiftWrap:()=>nb,GroupMetadata:()=>rS,HTTPAuth:()=>w0,Handlerinformation:()=>nS,Handlerrecommendation:()=>tS,Highlights:()=>dT,InterestsList:()=>TT,Interestsets:()=>FT,JobFeedback:()=>lT,JobRequest:()=>sT,JobResult:()=>oT,Label:()=>rT,LightningPubRPC:()=>zT,LiveChatMessage:()=>Q2,LiveEvent:()=>HT,LongFormArticle:()=>VT,Metadata:()=>O2,Mutelist:()=>pT,NWCWalletInfo:()=>CT,NWCWalletRequest:()=>rb,NWCWalletResponse:()=>DT,NormalVideo:()=>H2,NostrConnect:()=>PT,OpenTimestamps:()=>X2,Photo:()=>Z2,Pinlist:()=>mT,Poll:()=>Y2,PollResponse:()=>fT,PrivateDirectMessage:()=>Wx,ProblemTracker:()=>tT,ProfileBadges:()=>BT,PublicChatsList:()=>vT,Reaction:()=>x0,RecommendRelay:()=>B2,RelayList:()=>gT,RelayReview:()=>eS,Relaysets:()=>RT,Report:()=>nT,Reporting:()=>iT,Repost:()=>v0,Seal:()=>Yx,SearchRelaysList:()=>bT,ShortTextNote:()=>Xx,ShortVideo:()=>$2,Time:()=>KT,UserEmojiList:()=>ST,UserStatuses:()=>$T,Voice:()=>J2,VoiceComment:()=>eT,Zap:()=>hT,ZapGoal:()=>cT,ZapRequest:()=>uT,classifyKind:()=>R2,isAddressableKind:()=>_0,isEphemeralKind:()=>$x,isKind:()=>L2,isRegularKind:()=>Hx,isReplaceableKind:()=>y0});function Hx(h){return h<1e4&&h!==0&&h!==3}function y0(h){return h===0||h===3||1e4<=h&&h<2e4}function $x(h){return 2e4<=h&&h<3e4}function _0(h){return 3e4<=h&&h<4e4}function R2(h){return Hx(h)?"regular":y0(h)?"replaceable":$x(h)?"ephemeral":_0(h)?"parameterized":"unknown"}function L2(h,m){const b=m instanceof Array?m:[m];return m0(h)&&b.includes(h.kind)||!1}var O2=0,Xx=1,B2=2,N2=3,F2=4,j2=5,v0=6,x0=7,U2=8,V2=9,q2=11,Yx=13,Wx=14,G2=15,b0=16,Z2=20,H2=21,$2=22,Kx=40,Qx=41,Jx=42,eb=43,tb=44,X2=1040,nb=1059,Y2=1068,W2=1063,K2=1111,Q2=1311,J2=1222,eT=1244,tT=1971,nT=1984,iT=1984,rT=1985,aT=4550,sT=5999,oT=6999,lT=7e3,cT=9041,uT=9734,hT=9735,dT=9802,fT=1018,pT=1e4,mT=10001,gT=10002,yT=10003,_T=10004,vT=10005,xT=10006,bT=10007,wT=10012,TT=10015,ST=10030,ET=10050,MT=10096,AT=10063,CT=13194,zT=21e3,ib=22242,rb=23194,DT=23195,PT=24133,w0=27235,IT=3e4,kT=30001,RT=30002,LT=30003,OT=30004,BT=30008,NT=30009,FT=30015,jT=30017,UT=30018,VT=30023,qT=30024,GT=30030,ZT=30078,HT=30311,$T=30315,XT=30402,YT=30403,WT=31922,KT=31923,QT=31924,JT=31925,eS=31987,tS=31989,nS=31990,iS=34550,rS=39e3;function aS(h,m){if(h.ids&&h.ids.indexOf(m.id)===-1||h.kinds&&h.kinds.indexOf(m.kind)===-1||h.authors&&h.authors.indexOf(m.pubkey)===-1)return!1;for(let b in h)if(b[0]==="#"){let S=b.slice(1),z=h[`#${S}`];if(z&&!m.tags.find(([k,A])=>k===b.slice(1)&&z.indexOf(A)!==-1))return!1}return!(h.since&&m.created_at<h.since||h.until&&m.created_at>h.until)}function sS(h,m){for(let b=0;b<h.length;b++)if(aS(h[b],m))return!0;return!1}var oS={};Ki(oS,{getHex64:()=>qy,getInt:()=>ab,getSubscriptionId:()=>sb,matchEventId:()=>lS,matchEventKind:()=>uS,matchEventPubkey:()=>cS});function qy(h,m){let b=m.length+3,S=h.indexOf(`"${m}":`)+b,z=h.slice(S).indexOf('"')+S+1;return h.slice(z,z+64)}function ab(h,m){let b=m.length,S=h.indexOf(`"${m}":`)+b+3,z=h.slice(S),k=Math.min(z.indexOf(","),z.indexOf("}"));return parseInt(z.slice(0,k),10)}function sb(h){let m=h.slice(0,22).indexOf('"EVENT"');if(m===-1)return null;let b=h.slice(m+7+1).indexOf('"');if(b===-1)return null;let S=m+7+1+b,z=h.slice(S+1,80).indexOf('"');if(z===-1)return null;let k=S+1+z;return h.slice(S+1,k)}function lS(h,m){return m===qy(h,"id")}function cS(h,m){return m===qy(h,"pubkey")}function uS(h,m){return m===ab(h,"kind")}var hS={};Ki(hS,{makeAuthEvent:()=>ob});function ob(h,m){return{kind:ib,created_at:Math.floor(Date.now()/1e3),tags:[["relay",h],["challenge",m]],content:""}}async function dS(){return new Promise((h,m)=>{try{if(typeof MessageChannel<"u"){const b=new MessageChannel,S=()=>{b.port1.removeEventListener("message",S),h()};b.port1.addEventListener("message",S),b.port2.postMessage(0),b.port1.start()}else typeof setImmediate<"u"?setImmediate(h):typeof setTimeout<"u"?setTimeout(h,0):h()}catch(b){console.error("during yield: ",b),m(b)}})}var fS=h=>(h[lf]=!0,!0),lb=class extends Error{constructor(h,m){super(`Tried to send message '${h} on a closed connection to ${m}.`),this.name="SendingOnClosedConnection"}},cb=class{url;_connected=!1;onclose=null;onnotice=h=>console.debug(`NOTICE from ${this.url}: ${h}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Gx;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(h,m){this.url=hf(h),this.verifyEvent=m.verifyEvent,this._WebSocket=m.websocketImplementation||WebSocket,this.enablePing=m.enablePing,this.enableReconnect=m.enableReconnect||!1}static async connect(h,m){const b=new cb(h,m);return await b.connect(),b}closeAllSubscriptions(h){for(let[m,b]of this.openSubs)b.close(h);this.openSubs.clear();for(let[m,b]of this.openEventPublishes)b.reject(new Error(h));this.openEventPublishes.clear();for(let[m,b]of this.openCountRequests)b.reject(new Error(h));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const h=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},h)}handleHardClose(h){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const m=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!m?this.reconnect():this.closeAllSubscriptions(h)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((h,m)=>{this.connectionTimeoutHandle=setTimeout(()=>{m("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(b){clearTimeout(this.connectionTimeoutHandle),m(b);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const b=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const S of this.openSubs.values()){if(S.eosed=!1,b)for(let z=0;z<S.filters.length;z++)S.lastEmitted&&(S.filters[z].since=S.lastEmitted+1);S.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),h()},this.ws.onerror=b=>{clearTimeout(this.connectionTimeoutHandle),m(b.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=b=>{clearTimeout(this.connectionTimeoutHandle),m(b.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(h=>{this.ws.once("pong",()=>h(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((h,m)=>{if(!this.connectionPromise)return m(new Error(`no connection to ${this.url}, can't ping`));try{const b=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{h(!0),b.close()},onclose(){h(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(b){m(b)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(m=>setTimeout(()=>m(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await dS();this.queueRunning=!1}handleNext(){const h=this.incomingMessageQueue.dequeue();if(!h)return!1;const m=sb(h);if(m){const b=this.openSubs.get(m);if(!b)return;const S=qy(h,"id"),z=b.alreadyHaveEvent?.(S);if(b.receivedEvent?.(this,S),z)return}try{let b=JSON.parse(h);switch(b[0]){case"EVENT":{const S=this.openSubs.get(b[1]),z=b[2];this.verifyEvent(z)&&sS(S.filters,z)&&S.onevent(z),(!S.lastEmitted||S.lastEmitted<z.created_at)&&(S.lastEmitted=z.created_at);return}case"COUNT":{const S=b[1],z=b[2],k=this.openCountRequests.get(S);k&&(k.resolve(z.count),this.openCountRequests.delete(S));return}case"EOSE":{const S=this.openSubs.get(b[1]);if(!S)return;S.receivedEose();return}case"OK":{const S=b[1],z=b[2],k=b[3],A=this.openEventPublishes.get(S);A&&(clearTimeout(A.timeout),z?A.resolve(k):A.reject(new Error(k)),this.openEventPublishes.delete(S));return}case"CLOSED":{const S=b[1],z=this.openSubs.get(S);if(!z)return;z.closed=!0,z.close(b[2]);return}case"NOTICE":{this.onnotice(b[1]);return}case"AUTH":{this.challenge=b[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(b[1])?.oncustom?.(b);return}}}catch{return}}async send(h){if(!this.connectionPromise)throw new lb(h,this.url);this.connectionPromise.then(()=>{this.ws?.send(h)})}async auth(h){const m=this.challenge;if(!m)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(b,S)=>{try{let z=await h(ob(this.url,m)),k=setTimeout(()=>{let A=this.openEventPublishes.get(z.id);A&&(A.reject(new Error("auth timed out")),this.openEventPublishes.delete(z.id))},this.publishTimeout);this.openEventPublishes.set(z.id,{resolve:b,reject:S,timeout:k}),this.send('["AUTH",'+JSON.stringify(z)+"]")}catch(z){console.warn("subscribe auth function failed:",z)}}),this.authPromise)}async publish(h){const m=new Promise((b,S)=>{const z=setTimeout(()=>{const k=this.openEventPublishes.get(h.id);k&&(k.reject(new Error("publish timed out")),this.openEventPublishes.delete(h.id))},this.publishTimeout);this.openEventPublishes.set(h.id,{resolve:b,reject:S,timeout:z})});return this.send('["EVENT",'+JSON.stringify(h)+"]"),m}async count(h,m){this.serial++;const b=m?.id||"count:"+this.serial,S=new Promise((z,k)=>{this.openCountRequests.set(b,{resolve:z,reject:k})});return this.send('["COUNT","'+b+'",'+JSON.stringify(h).substring(1)),S}subscribe(h,m){const b=this.prepareSubscription(h,m);return b.fire(),b}prepareSubscription(h,m){this.serial++;const b=m.id||(m.label?m.label+":":"sub:")+this.serial,S=new pS(this,b,h,m);return this.openSubs.set(b,S),S}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(h){this.incomingMessageQueue.enqueue(h.data),this.queueRunning||this.runQueue()}},pS=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(h,m,b,S){if(b.length===0)throw new Error("subscription can't be created with zero filters");this.relay=h,this.filters=b,this.id=m,this.alreadyHaveEvent=S.alreadyHaveEvent,this.receivedEvent=S.receivedEvent,this.eoseTimeout=S.eoseTimeout||h.baseEoseTimeout,this.oneose=S.oneose,this.onclose=S.onclose,this.onevent=S.onevent||(z=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,z)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(h="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(m){if(!(m instanceof lb))throw m}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(h)}},mS;try{mS=WebSocket}catch{}var gS=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(h){this.verifyEvent=h.verifyEvent,this._WebSocket=h.websocketImplementation,this.enablePing=h.enablePing,this.enableReconnect=h.enableReconnect||!1,this.automaticallyAuth=h.automaticallyAuth}async ensureRelay(h,m){h=hf(h);let b=this.relays.get(h);if(b||(b=new cb(h,{verifyEvent:this.trustedRelayURLs.has(h)?fS:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),b.onclose=()=>{b&&!b.enableReconnect&&this.relays.delete(h)},m?.connectionTimeout&&(b.connectionTimeout=m.connectionTimeout),this.relays.set(h,b)),this.automaticallyAuth){const S=this.automaticallyAuth(h);S&&(b.onauth=S)}return await b.connect(),b}close(h){h.map(hf).forEach(m=>{this.relays.get(m)?.close(),this.relays.delete(m)})}subscribe(h,m,b){const S=[];for(let z=0;z<h.length;z++){const k=hf(h[z]);S.find(A=>A.url===k)||S.push({url:k,filter:m})}return this.subscribeMap(S,b)}subscribeMany(h,m,b){const S=[],z=[];for(let k=0;k<h.length;k++){const A=hf(h[k]);z.indexOf(A)===-1&&(z.push(A),S.push({url:A,filter:m}))}return this.subscribeMap(S,b)}subscribeMap(h,m){const b=new Map;for(const xe of h){const{url:Ae,filter:Ie}=xe;b.has(Ae)||b.set(Ae,[]),b.get(Ae).push(Ie)}const S=Array.from(b.entries()).map(([xe,Ae])=>({url:xe,filters:Ae}));this.trackRelays&&(m.receivedEvent=(xe,Ae)=>{let Ie=this.seenOn.get(Ae);Ie||(Ie=new Set,this.seenOn.set(Ae,Ie)),Ie.add(xe)});const z=new Set,k=[],A=[];let l=xe=>{A[xe]||(A[xe]=!0,A.filter(Ae=>Ae).length===S.length&&(m.oneose?.(),l=()=>{}))};const N=[];let W=(xe,Ae)=>{N[xe]||(l(xe),N[xe]=Ae,N.filter(Ie=>Ie).length===S.length&&(m.onclose?.(N),W=()=>{}))};const ne=xe=>{if(m.alreadyHaveEvent?.(xe))return!0;const Ae=z.has(xe);return z.add(xe),Ae},re=Promise.all(S.map(async({url:xe,filters:Ae},Ie)=>{let pe;try{pe=await this.ensureRelay(xe,{connectionTimeout:m.maxWait?Math.max(m.maxWait*.8,m.maxWait-1e3):void 0})}catch(ke){W(Ie,ke?.message||String(ke));return}let ae=pe.subscribe(Ae,{...m,oneose:()=>l(Ie),onclose:ke=>{ke.startsWith("auth-required: ")&&m.onauth?pe.auth(m.onauth).then(()=>{pe.subscribe(Ae,{...m,oneose:()=>l(Ie),onclose:Ke=>{W(Ie,Ke)},alreadyHaveEvent:ne,eoseTimeout:m.maxWait})}).catch(Ke=>{W(Ie,`auth was required and attempted, but failed with: ${Ke}`)}):W(Ie,ke)},alreadyHaveEvent:ne,eoseTimeout:m.maxWait});k.push(ae)}));return{async close(xe){await re,k.forEach(Ae=>{Ae.close(xe)})}}}subscribeEose(h,m,b){const S=this.subscribe(h,m,{...b,oneose(){S.close("closed automatically on eose")}});return S}subscribeManyEose(h,m,b){const S=this.subscribeMany(h,m,{...b,oneose(){S.close("closed automatically on eose")}});return S}async querySync(h,m,b){return new Promise(async S=>{const z=[];this.subscribeEose(h,m,{...b,onevent(k){z.push(k)},onclose(k){S(z)}})})}async get(h,m,b){m.limit=1;const S=await this.querySync(h,m,b);return S.sort((z,k)=>k.created_at-z.created_at),S[0]||null}publish(h,m,b){return h.map(hf).map(async(S,z,k)=>{if(k.indexOf(S)!==z)return Promise.reject("duplicate url");let A=await this.ensureRelay(S);return A.publish(m).catch(async l=>{if(l instanceof Error&&l.message.startsWith("auth-required: ")&&b?.onauth)return await A.auth(b.onauth),A.publish(m);throw l}).then(l=>{if(this.trackRelays){let N=this.seenOn.get(m.id);N||(N=new Set,this.seenOn.set(m.id,N)),N.add(A)}return l})})}listConnectionStatus(){const h=new Map;return this.relays.forEach((m,b)=>h.set(b,m.connected)),h}destroy(){this.relays.forEach(h=>h.close()),this.relays=new Map}},ub;try{ub=WebSocket}catch{}var yS=class extends gS{constructor(h){super({verifyEvent:Vy,websocketImplementation:ub,...h})}},ff={};Ki(ff,{BECH32_REGEX:()=>hb,Bech32MaxSize:()=>T0,NostrTypeGuard:()=>_S,decode:()=>Gy,decodeNostrURI:()=>xS,encodeBytes:()=>Hy,naddrEncode:()=>MS,neventEncode:()=>ES,noteEncode:()=>TS,nprofileEncode:()=>SS,npubEncode:()=>wS,nsecEncode:()=>bS});var _S={isNProfile:h=>/^nprofile1[a-z\d]+$/.test(h||""),isNEvent:h=>/^nevent1[a-z\d]+$/.test(h||""),isNAddr:h=>/^naddr1[a-z\d]+$/.test(h||""),isNSec:h=>/^nsec1[a-z\d]{58}$/.test(h||""),isNPub:h=>/^npub1[a-z\d]{58}$/.test(h||""),isNote:h=>/^note1[a-z\d]+$/.test(h||""),isNcryptsec:h=>/^ncryptsec1[a-z\d]+$/.test(h||"")},T0=5e3,hb=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function vS(h){const m=new Uint8Array(4);return m[0]=h>>24&255,m[1]=h>>16&255,m[2]=h>>8&255,m[3]=h&255,m}function xS(h){try{return h.startsWith("nostr:")&&(h=h.substring(6)),Gy(h)}catch{return{type:"invalid",data:null}}}function Gy(h){let{prefix:m,words:b}=Zp.decode(h,T0),S=new Uint8Array(Zp.fromWords(b));switch(m){case"nprofile":{let z=D_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(z[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Lr(z[0][0]),relays:z[1]?z[1].map(k=>Ou.decode(k)):[]}}}case"nevent":{let z=D_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for nevent");if(z[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(z[2]&&z[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(z[3]&&z[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Lr(z[0][0]),relays:z[1]?z[1].map(k=>Ou.decode(k)):[],author:z[2]?.[0]?Lr(z[2][0]):void 0,kind:z[3]?.[0]?parseInt(Lr(z[3][0]),16):void 0}}}case"naddr":{let z=D_(S);if(!z[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!z[2]?.[0])throw new Error("missing TLV 2 for naddr");if(z[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!z[3]?.[0])throw new Error("missing TLV 3 for naddr");if(z[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ou.decode(z[0][0]),pubkey:Lr(z[2][0]),kind:parseInt(Lr(z[3][0]),16),relays:z[1]?z[1].map(k=>Ou.decode(k)):[]}}}case"nsec":return{type:m,data:S};case"npub":case"note":return{type:m,data:Lr(S)};default:throw new Error(`unknown prefix ${m}`)}}function D_(h){let m={},b=h;for(;b.length>0;){let S=b[0],z=b[1],k=b.slice(2,2+z);if(b=b.slice(2+z),k.length<z)throw new Error(`not enough data to read on TLV ${S}`);m[S]=m[S]||[],m[S].push(k)}return m}function bS(h){return Hy("nsec",h)}function wS(h){return Hy("npub",mf(h))}function TS(h){return Hy("note",mf(h))}function Zy(h,m){let b=Zp.toWords(m);return Zp.encode(h,b,T0)}function Hy(h,m){return Zy(h,m)}function SS(h){let m=S0({0:[mf(h.pubkey)],1:(h.relays||[]).map(b=>Bl.encode(b))});return Zy("nprofile",m)}function ES(h){let m;h.kind!==void 0&&(m=vS(h.kind));let b=S0({0:[mf(h.id)],1:(h.relays||[]).map(S=>Bl.encode(S)),2:h.author?[mf(h.author)]:[],3:m?[new Uint8Array(m)]:[]});return Zy("nevent",b)}function MS(h){let m=new ArrayBuffer(4);new DataView(m).setUint32(0,h.kind,!1);let b=S0({0:[Bl.encode(h.identifier)],1:(h.relays||[]).map(S=>Bl.encode(S)),2:[mf(h.pubkey)],3:[new Uint8Array(m)]});return Zy("naddr",b)}function S0(h){let m=[];return Object.entries(h).reverse().forEach(([b,S])=>{S.forEach(z=>{let k=new Uint8Array(z.length+2);k.set([parseInt(b)],0),k.set([z.length],1),k.set(z,2),m.push(k)})}),Ny(...m)}var AS={};Ki(AS,{decrypt:()=>CS,encrypt:()=>db});function db(h,m,b){const S=h instanceof Uint8Array?Lr(h):h,z=$p.getSharedSecret(S,"02"+m),k=fb(z);let A=Uint8Array.from(Mx(16)),l=Bl.encode(b),N=Bx(k,A).encrypt(l),W=Bu.encode(new Uint8Array(N)),ne=Bu.encode(new Uint8Array(A.buffer));return`${W}?iv=${ne}`}function CS(h,m,b){const S=h instanceof Uint8Array?Lr(h):h;let[z,k]=b.split("?iv="),A=$p.getSharedSecret(S,"02"+m),l=fb(A),N=Bu.decode(k),W=Bu.decode(z),ne=Bx(l,N).decrypt(W);return Ou.decode(ne)}function fb(h){return h.slice(1,33)}var zS={};Ki(zS,{NIP05_REGEX:()=>E0,isNip05:()=>DS,isValid:()=>kS,queryProfile:()=>pb,searchDomain:()=>IS,useFetchImplementation:()=>PS});var E0=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,DS=h=>E0.test(h||""),$y;try{$y=fetch}catch{}function PS(h){$y=h}async function IS(h,m=""){try{const b=`https://${h}/.well-known/nostr.json?name=${m}`,S=await $y(b,{redirect:"manual"});if(S.status!==200)throw Error("Wrong response code");return(await S.json()).names}catch{return{}}}async function pb(h){const m=h.match(E0);if(!m)return null;const[,b="_",S]=m;try{const z=`https://${S}/.well-known/nostr.json?name=${b}`,k=await $y(z,{redirect:"manual"});if(k.status!==200)throw Error("Wrong response code");const A=await k.json(),l=A.names[b];return l?{pubkey:l,relays:A.relays?.[l]}:null}catch{return null}}async function kS(h,m){const b=await pb(m);return b?b.pubkey===h:!1}var RS={};Ki(RS,{parse:()=>LS});function LS(h){const m={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let b,S;for(let z=h.tags.length-1;z>=0;z--){const k=h.tags[z];if(k[0]==="e"&&k[1]){const[A,l,N,W,ne]=k,re={id:l,relays:N?[N]:[],author:ne};if(W==="root"){m.root=re;continue}if(W==="reply"){m.reply=re;continue}if(W==="mention"){m.mentions.push(re);continue}b?S=re:b=re,m.mentions.push(re);continue}if(k[0]==="q"&&k[1]){const[A,l,N]=k;m.quotes.push({id:l,relays:N?[N]:[]})}if(k[0]==="p"&&k[1]){m.profiles.push({pubkey:k[1],relays:k[2]?[k[2]]:[]});continue}}return m.root||(m.root=S||b||m.reply),m.reply||(m.reply=b||m.root),[m.reply,m.root].forEach(z=>{if(!z)return;let k=m.mentions.indexOf(z);if(k!==-1&&m.mentions.splice(k,1),z.author){let A=m.profiles.find(l=>l.pubkey===z.author);A&&A.relays&&(z.relays||(z.relays=[]),A.relays.forEach(l=>{z.relays?.indexOf(l)===-1&&z.relays.push(l)}),A.relays=z.relays)}}),m.mentions.forEach(z=>{if(z.author){let k=m.profiles.find(A=>A.pubkey===z.author);k&&k.relays&&(z.relays||(z.relays=[]),k.relays.forEach(A=>{z.relays.indexOf(A)===-1&&z.relays.push(A)}),k.relays=z.relays)}}),m}var OS={};Ki(OS,{fetchRelayInformation:()=>NS,useFetchImplementation:()=>BS});var mb;try{mb=fetch}catch{}function BS(h){mb=h}async function NS(h){return await(await fetch(h.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var FS={};Ki(FS,{fastEventHash:()=>yb,getPow:()=>gb,minePow:()=>jS});function gb(h){let m=0;for(let b=0;b<64;b+=8){const S=parseInt(h.substring(b,b+8),16);if(S===0)m+=32;else{m+=Math.clz32(S);break}}return m}function jS(h,m){let b=0;const S=h,z=["nonce",b.toString(),m.toString()];for(S.tags.push(z);;){const k=Math.floor(new Date().getTime()/1e3);if(k!==S.created_at&&(b=0,S.created_at=k),z[1]=(++b).toString(),S.id=yb(S),gb(S.id)>=m)break}return S}function yb(h){return Lr(Xh(Bl.encode(JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content]))))}var US={};Ki(US,{unwrapEvent:()=>QS,unwrapManyEvents:()=>JS,wrapEvent:()=>Db,wrapManyEvents:()=>KS});var VS={};Ki(VS,{createRumor:()=>Mb,createSeal:()=>Ab,createWrap:()=>Cb,unwrapEvent:()=>D0,unwrapManyEvents:()=>zb,wrapEvent:()=>My,wrapManyEvents:()=>YS});var cg={};Ki(cg,{decrypt:()=>z0,encrypt:()=>C0,getConversationKey:()=>M0,v2:()=>$S});var _b=1,vb=65535;function M0(h,m){const b=$p.getSharedSecret(h,"02"+m).subarray(1,33);return S2(Xh,b,"nip44-v2")}function xb(h,m){const b=E2(Xh,h,m,76);return{chacha_key:b.subarray(0,32),chacha_nonce:b.subarray(32,44),hmac_key:b.subarray(44,76)}}function A0(h){if(!Number.isSafeInteger(h)||h<1)throw new Error("expected positive integer");if(h<=32)return 32;const m=1<<Math.floor(Math.log2(h-1))+1,b=m<=256?32:m/8;return b*(Math.floor((h-1)/b)+1)}function qS(h){if(!Number.isSafeInteger(h)||h<_b||h>vb)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const m=new Uint8Array(2);return new DataView(m.buffer).setUint16(0,h,!1),m}function GS(h){const m=Bl.encode(h),b=m.length,S=qS(b),z=new Uint8Array(A0(b)-b);return Ny(S,m,z)}function ZS(h){const m=new DataView(h.buffer).getUint16(0),b=h.subarray(2,2+m);if(m<_b||m>vb||b.length!==m||h.length!==2+A0(m))throw new Error("invalid padding");return Ou.decode(b)}function bb(h,m,b){if(b.length!==32)throw new Error("AAD associated data must be 32 bytes");const S=Ny(b,m);return jy(Xh,h,S)}function HS(h){if(typeof h!="string")throw new Error("payload must be a valid string");const m=h.length;if(m<132||m>87472)throw new Error("invalid payload length: "+m);if(h[0]==="#")throw new Error("unknown encryption version");let b;try{b=Bu.decode(h)}catch(k){throw new Error("invalid base64: "+k.message)}const S=b.length;if(S<99||S>65603)throw new Error("invalid data length: "+S);const z=b[0];if(z!==2)throw new Error("unknown encryption version "+z);return{nonce:b.subarray(1,33),ciphertext:b.subarray(33,-32),mac:b.subarray(-32)}}function C0(h,m,b=Mx(32)){const{chacha_key:S,chacha_nonce:z,hmac_key:k}=xb(m,b),A=GS(h),l=Ux(S,z,A),N=bb(k,l,b);return Bu.encode(Ny(new Uint8Array([2]),b,l,N))}function z0(h,m){const{nonce:b,ciphertext:S,mac:z}=HS(h),{chacha_key:k,chacha_nonce:A,hmac_key:l}=xb(m,b),N=bb(l,S,b);if(!a2(N,z))throw new Error("invalid MAC");const W=Ux(k,A,S);return ZS(W)}var $S={utils:{getConversationKey:M0,calcPaddedLen:A0},encrypt:C0,decrypt:z0},XS=2880*60,wb=()=>Math.round(Date.now()/1e3),Tb=()=>Math.round(wb()-Math.random()*XS),Sb=(h,m)=>M0(h,m),Eb=(h,m,b)=>C0(JSON.stringify(h),Sb(m,b)),Ev=(h,m)=>JSON.parse(z0(h.content,Sb(m,h.pubkey)));function Mb(h,m){const b={created_at:wb(),content:"",tags:[],...h,pubkey:lg(m)};return b.id=yy(b),b}function Ab(h,m,b){return Zo({kind:Yx,content:Eb(h,m,b),created_at:Tb(),tags:[]},m)}function Cb(h,m){const b=Zx();return Zo({kind:nb,content:Eb(h,b,m),created_at:Tb(),tags:[["p",m]]},b)}function My(h,m,b){const S=Mb(h,m),z=Ab(S,m,b);return Cb(z,b)}function YS(h,m,b){if(!b||b.length===0)throw new Error("At least one recipient is required.");const S=lg(m),z=[My(h,m,S)];return b.forEach(k=>{z.push(My(h,m,k))}),z}function D0(h,m){const b=Ev(h,m);return Ev(b,m)}function zb(h,m){let b=[];return h.forEach(S=>{b.push(D0(S,m))}),b.sort((S,z)=>S.created_at-z.created_at),b}function WS(h,m,b,S){const z={created_at:Math.ceil(Date.now()/1e3),kind:Wx,tags:[],content:m};return(Array.isArray(h)?h:[h]).forEach(({publicKey:A,relayUrl:l})=>{z.tags.push(l?["p",A,l]:["p",A])}),S&&z.tags.push(["e",S.eventId,S.relayUrl||"","reply"]),b&&z.tags.push(["subject",b]),z}function Db(h,m,b,S,z){const k=WS(m,b,S,z);return My(k,h,m.publicKey)}function KS(h,m,b,S,z){if(!m||m.length===0)throw new Error("At least one recipient is required.");return[{publicKey:lg(h)},...m].map(A=>Db(h,A,b,S,z))}var QS=D0,JS=zb,eE={};Ki(eE,{finishRepostEvent:()=>tE,getRepostedEvent:()=>nE,getRepostedEventPointer:()=>Pb});function tE(h,m,b,S){let z;const k=[...h.tags??[],["e",m.id,b],["p",m.pubkey]];return m.kind===Xx?z=v0:(z=b0,k.push(["k",String(m.kind)])),Zo({kind:z,tags:k,content:h.content===""||m.tags?.find(A=>A[0]==="-")?"":JSON.stringify(m),created_at:h.created_at},S)}function Pb(h){if(![v0,b0].includes(h.kind))return;let m,b;for(let S=h.tags.length-1;S>=0&&(m===void 0||b===void 0);S--){const z=h.tags[S];z.length>=2&&(z[0]==="e"&&m===void 0?m=z:z[0]==="p"&&b===void 0&&(b=z))}if(m!==void 0)return{id:m[1],relays:[m[2],b?.[2]].filter(S=>typeof S=="string"),author:b?.[1]}}function nE(h,{skipVerification:m}={}){const b=Pb(h);if(b===void 0||h.content==="")return;let S;try{S=JSON.parse(h.content)}catch{return}if(S.id===b.id&&!(!m&&!Vy(S)))return S}var iE={};Ki(iE,{NOSTR_URI_REGEX:()=>P0,parse:()=>aE,test:()=>rE});var P0=new RegExp(`nostr:(${hb.source})`);function rE(h){return typeof h=="string"&&new RegExp(`^${P0.source}$`).test(h)}function aE(h){const m=h.match(new RegExp(`^${P0.source}$`));if(!m)throw new Error(`Invalid Nostr URI: ${h}`);return{uri:m[0],value:m[1],decoded:Gy(m[1])}}var sE={};Ki(sE,{finishReactionEvent:()=>oE,getReactedEventPointer:()=>lE});function oE(h,m,b){const S=m.tags.filter(z=>z.length>=2&&(z[0]==="e"||z[0]==="p"));return Zo({...h,kind:x0,tags:[...h.tags??[],...S,["e",m.id],["p",m.pubkey]],content:h.content??"+"},b)}function lE(h){if(h.kind!==x0)return;let m,b;for(let S=h.tags.length-1;S>=0&&(m===void 0||b===void 0);S--){const z=h.tags[S];z.length>=2&&(z[0]==="e"&&m===void 0?m=z:z[0]==="p"&&b===void 0&&(b=z))}if(!(m===void 0||b===void 0))return{id:m[1],relays:[m[2],b[2]].filter(S=>S!==void 0),author:b[1]}}var cE={};Ki(cE,{parse:()=>hE});var Mv=/\W/m,Av=/[^\w\/] |[^\w\/]$|$|,| /m,uE=42;function*hE(h){let m=[];if(typeof h!="string"){for(let k=0;k<h.tags.length;k++){const A=h.tags[k];A[0]==="emoji"&&A.length>=3&&m.push({type:"emoji",shortcode:A[1],url:A[2]})}h=h.content}const b=h.length;let S=0,z=0;e:for(;z<b;){const k=h.indexOf(":",z),A=h.indexOf("#",z);if(k===-1&&A===-1)break e;if(k===-1||A>=0&&A<k){if(A===0||h[A-1]===" "){const l=h.slice(A+1,A+uE).match(Mv),N=l?A+1+l.index:b;yield{type:"text",text:h.slice(S,A)},yield{type:"hashtag",value:h.slice(A+1,N)},z=N,S=z;continue e}z=A+1;continue e}if(h.slice(k-5,k)==="nostr"){const l=h.slice(k+60).match(Mv),N=l?k+60+l.index:b;try{let W,{data:ne,type:re}=Gy(h.slice(k+1,N));switch(re){case"npub":W={pubkey:ne};break;case"note":W={id:ne};break;case"nsec":z=N+1;continue;default:W=ne}S!==k-5&&(yield{type:"text",text:h.slice(S,k-5)}),yield{type:"reference",pointer:W},z=N,S=z;continue e}catch{z=k+1;continue e}}else if(h.slice(k-5,k)==="https"||h.slice(k-4,k)==="http"){const l=h.slice(k+4).match(Av),N=l?k+4+l.index:b,W=h[k-1]==="s"?5:4;try{let ne=new URL(h.slice(k-W,N));if(ne.hostname.indexOf(".")===-1)throw new Error("invalid url");if(S!==k-W&&(yield{type:"text",text:h.slice(S,k-W)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(ne.pathname)){yield{type:"image",url:ne.toString()},z=N,S=z;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(ne.pathname)){yield{type:"video",url:ne.toString()},z=N,S=z;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(ne.pathname)){yield{type:"audio",url:ne.toString()},z=N,S=z;continue e}yield{type:"url",url:ne.toString()},z=N,S=z;continue e}catch{z=N+1;continue e}}else if(h.slice(k-3,k)==="wss"||h.slice(k-2,k)==="ws"){const l=h.slice(k+4).match(Av),N=l?k+4+l.index:b,W=h[k-1]==="s"?3:2;try{let ne=new URL(h.slice(k-W,N));if(ne.hostname.indexOf(".")===-1)throw new Error("invalid ws url");S!==k-W&&(yield{type:"text",text:h.slice(S,k-W)}),yield{type:"relay",url:ne.toString()},z=N,S=z;continue e}catch{z=N+1;continue e}}else{for(let l=0;l<m.length;l++){const N=m[l];if(h[k+N.shortcode.length+1]===":"&&h.slice(k+1,k+N.shortcode.length+1)===N.shortcode){S!==k&&(yield{type:"text",text:h.slice(S,k)}),yield N,z=k+N.shortcode.length+2,S=z;continue e}}z=k+1;continue e}}S!==b&&(yield{type:"text",text:h.slice(S)})}var dE={};Ki(dE,{channelCreateEvent:()=>fE,channelHideMessageEvent:()=>gE,channelMessageEvent:()=>mE,channelMetadataEvent:()=>pE,channelMuteUserEvent:()=>yE});var fE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Zo({kind:Kx,tags:[...h.tags??[]],content:b,created_at:h.created_at},m)},pE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Zo({kind:Qx,tags:[["e",h.channel_create_event_id],...h.tags??[]],content:b,created_at:h.created_at},m)},mE=(h,m)=>{const b=[["e",h.channel_create_event_id,h.relay_url,"root"]];return h.reply_to_channel_message_event_id&&b.push(["e",h.reply_to_channel_message_event_id,h.relay_url,"reply"]),Zo({kind:Jx,tags:[...b,...h.tags??[]],content:h.content,created_at:h.created_at},m)},gE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Zo({kind:eb,tags:[["e",h.channel_message_event_id],...h.tags??[]],content:b,created_at:h.created_at},m)},yE=(h,m)=>{let b;if(typeof h.content=="object")b=JSON.stringify(h.content);else if(typeof h.content=="string")b=h.content;else return;return Zo({kind:tb,tags:[["p",h.pubkey_to_mute],...h.tags??[]],content:b,created_at:h.created_at},m)},_E={};Ki(_E,{EMOJI_SHORTCODE_REGEX:()=>Ib,matchAll:()=>vE,regex:()=>I0,replaceAll:()=>xE});var Ib=/:(\w+):/,I0=()=>new RegExp(`\\B${Ib.source}\\B`,"g");function*vE(h){const m=h.matchAll(I0());for(const b of m)try{const[S,z]=b;yield{shortcode:S,name:z,start:b.index,end:b.index+S.length}}catch{}}function xE(h,m){return h.replaceAll(I0(),(b,S)=>m({shortcode:b,name:S}))}var bE={};Ki(bE,{useFetchImplementation:()=>wE,validateGithub:()=>TE});var k0;try{k0=fetch}catch{}function wE(h){k0=h}async function TE(h,m,b){try{return await(await k0(`https://gist.github.com/${m}/${b}/raw`)).text()===`Verifying that I control the following Nostr public key: ${h}`}catch{return!1}}var SE={};Ki(SE,{makeNwcRequestEvent:()=>ME,parseConnectionString:()=>EE});function EE(h){const{host:m,pathname:b,searchParams:S}=new URL(h),z=b||m,k=S.get("relay"),A=S.get("secret");if(!z||!k||!A)throw new Error("invalid connection string");return{pubkey:z,relay:k,secret:A}}async function ME(h,m,b){const z=db(m,h,JSON.stringify({method:"pay_invoice",params:{invoice:b}})),k={kind:rb,created_at:Math.round(Date.now()/1e3),content:z,tags:[["p",h]]};return Zo(k,m)}var AE={};Ki(AE,{normalizeIdentifier:()=>CE});function CE(h){return h=h.trim().toLowerCase(),h=h.normalize("NFKC"),Array.from(h).map(m=>new RegExp("\\p{Letter}","u").test(m)||new RegExp("\\p{Number}","u").test(m)?m:"-").join("")}var zE={};Ki(zE,{getSatoshisAmountFromBolt11:()=>LE,getZapEndpoint:()=>PE,makeZapReceipt:()=>RE,makeZapRequest:()=>IE,useFetchImplementation:()=>DE,validateZapRequest:()=>kE});var R0;try{R0=fetch}catch{}function DE(h){R0=h}async function PE(h){try{let m="",{lud06:b,lud16:S}=JSON.parse(h.content);if(S){let[A,l]=S.split("@");m=new URL(`/.well-known/lnurlp/${A}`,`https://${l}`).toString()}else if(b){let{words:A}=Zp.decode(b,1e3),l=Zp.fromWords(A);m=Ou.decode(l)}else return null;let k=await(await R0(m)).json();if(k.allowsNostr&&k.nostrPubkey)return k.callback}catch{}return null}function IE(h){let m={kind:9734,created_at:Math.round(Date.now()/1e3),content:h.comment||"",tags:[["p","pubkey"in h?h.pubkey:h.event.pubkey],["amount",h.amount.toString()],["relays",...h.relays]]};if("event"in h){if(m.tags.push(["e",h.event.id]),y0(h.event.kind)){const b=["a",`${h.event.kind}:${h.event.pubkey}:`];m.tags.push(b)}else if(_0(h.event.kind)){let b=h.event.tags.find(([z,k])=>z==="d"&&k);if(!b)throw new Error("d tag not found or is empty");const S=["a",`${h.event.kind}:${h.event.pubkey}:${b[1]}`];m.tags.push(S)}m.tags.push(["k",h.event.kind.toString()])}return m}function kE(h){let m;try{m=JSON.parse(h)}catch{return"Invalid zap request JSON."}if(!m0(m))return"Zap request is not a valid Nostr event.";if(!Vy(m))return"Invalid signature on zap request.";let b=m.tags.find(([k,A])=>k==="p"&&A);if(!b)return"Zap request doesn't have a 'p' tag.";if(!b[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let S=m.tags.find(([k,A])=>k==="e"&&A);return S&&!S[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":m.tags.find(([k,A])=>k==="relays"&&A)?null:"Zap request doesn't have a 'relays' tag."}function RE({zapRequest:h,preimage:m,bolt11:b,paidAt:S}){let z=JSON.parse(h),k=z.tags.filter(([l])=>l==="e"||l==="p"||l==="a"),A={kind:9735,created_at:Math.round(S.getTime()/1e3),content:"",tags:[...k,["P",z.pubkey],["bolt11",b],["description",h]]};return m&&A.tags.push(["preimage",m]),A}function LE(h){if(h.length<50)return 0;h=h.substring(0,50);const m=h.lastIndexOf("1");if(m===-1)return 0;const b=h.substring(0,m);if(!b.startsWith("lnbc"))return 0;const S=b.substring(4);if(S.length<1)return 0;const z=S[S.length-1],k=z.charCodeAt(0)-48,A=k>=0&&k<=9;let l=S.length-1;if(A&&l++,l<1)return 0;const N=parseInt(S.substring(0,l));switch(z){case"m":return N*1e5;case"u":return N*100;case"n":return N/10;case"p":return N/1e4;default:return N*1e8}}var OE={};Ki(OE,{Negentropy:()=>Rb,NegentropyStorageVector:()=>FE,NegentropySync:()=>jE});var P_=97,Vp=32,kb=16,of={Skip:0,Fingerprint:1,IdList:2},Lu=class{_raw;length;constructor(h){typeof h=="number"?(this._raw=new Uint8Array(h),this.length=0):h instanceof Uint8Array?(this._raw=new Uint8Array(h),this.length=h.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(h){if(h instanceof Lu&&(h=h.unwrap()),typeof h.length!="number")throw Error("bad length");const m=h.length+this.length;if(this.capacity<m){const b=this._raw,S=Math.max(this.capacity*2,m);this._raw=new Uint8Array(S),this._raw.set(b)}this._raw.set(h,this.length),this.length+=h.length}shift(){const h=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,h}shiftN(h=1){const m=this._raw.subarray(0,h);return this._raw=this._raw.subarray(h),this.length-=h,m}};function my(h){let m=0;for(;;){if(h.length===0)throw Error("parse ends prematurely");let b=h.shift();if(m=m<<7|b&127,(b&128)===0)break}return m}function ku(h){if(h===0)return new Lu(new Uint8Array([0]));let m=[];for(;h!==0;)m.push(h&127),h>>>=7;m.reverse();for(let b=0;b<m.length-1;b++)m[b]|=128;return new Lu(new Uint8Array(m))}function BE(h){return _y(h,1)[0]}function _y(h,m){if(h.length<m)throw Error("parse ends prematurely");return h.shiftN(m)}var NE=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(Vp)}add(h){let m=0,b=0,S=new DataView(this.buf.buffer),z=new DataView(h.buffer);for(let k=0;k<8;k++){let A=k*4,l=S.getUint32(A,!0),N=z.getUint32(A,!0),W=l;W+=m,W+=N,W>4294967295&&(b=1),S.setUint32(A,W&4294967295,!0),m=b,b=0}}negate(){let h=new DataView(this.buf.buffer);for(let b=0;b<8;b++){let S=b*4;h.setUint32(S,~h.getUint32(S,!0))}let m=new Uint8Array(Vp);m[0]=1,this.add(m)}getFingerprint(h){let m=new Lu;return m.extend(this.buf),m.extend(ku(h)),Xh(m.unwrap()).subarray(0,kb)}},FE=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(h,m){if(this.sealed)throw Error("already sealed");const b=Ix(m);if(b.byteLength!==Vp)throw Error("bad id size for added item");this.items.push({timestamp:h,id:b})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(I_);for(let h=1;h<this.items.length;h++)if(I_(this.items[h-1],this.items[h])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(h){if(this._checkSealed(),h>=this.items.length)throw Error("out of range");return this.items[h]}iterate(h,m,b){this._checkSealed(),this._checkBounds(h,m);for(let S=h;S<m&&b(this.items[S],S);++S);}findLowerBound(h,m,b){return this._checkSealed(),this._checkBounds(h,m),this._binarySearch(this.items,h,m,S=>I_(S,b)<0)}fingerprint(h,m){let b=new NE;return b.setToZero(),this.iterate(h,m,S=>(b.add(S.id),!0)),b.getFingerprint(m-h)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(h,m){if(h>m||m>this.items.length)throw Error("bad range")}_binarySearch(h,m,b,S){let z=b-m;for(;z>0;){let k=m,A=Math.floor(z/2);k+=A,S(h[k])?(m=++k,z-=A+1):z=A}return m}},Rb=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(h,m=6e4){if(m<4096)throw Error("frameSizeLimit too small");this.storage=h,this.frameSizeLimit=m,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(h,m){return{timestamp:h,id:m||new Uint8Array(0)}}initiate(){let h=new Lu;return h.extend(new Uint8Array([P_])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),h),Fp(h.unwrap())}reconcile(h,m,b){const S=new Lu(Ix(h));this.lastTimestampIn=this.lastTimestampOut=0;let z=new Lu;z.extend(new Uint8Array([P_]));let k=BE(S);if(k<96||k>111)throw Error("invalid negentropy protocol version byte");if(k!==P_)throw Error("unsupported negentropy protocol version requested: "+(k-96));let A=this.storage.size(),l=this._bound(0),N=0,W=!1;for(;S.length!==0;){let ne=new Lu,re=()=>{W&&(W=!1,ne.extend(this.encodeBound(l)),ne.extend(ku(of.Skip)))},xe=this.decodeBound(S),Ae=my(S),Ie=N,pe=this.storage.findLowerBound(N,A,xe);if(Ae===of.Skip)W=!0;else if(Ae===of.Fingerprint){let ae=_y(S,kb),ke=this.storage.fingerprint(Ie,pe);Lb(ae,ke)!==0?(re(),this.splitRange(Ie,pe,xe,ne)):W=!0}else if(Ae===of.IdList){let ae=my(S),ke={};for(let Ke=0;Ke<ae;Ke++){let at=_y(S,Vp);ke[Fp(at)]=at}if(W=!0,this.storage.iterate(Ie,pe,Ke=>{let at=Ke.id;const zt=Fp(at);return ke[zt]?delete ke[Fp(at)]:m?.(zt),!0}),b)for(let Ke of Object.values(ke))b(Fp(Ke))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(z.length+ne.length)){let ae=this.storage.fingerprint(pe,A);z.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),z.extend(ku(of.Fingerprint)),z.extend(ae);break}else z.extend(ne);N=pe,l=xe}return z.length===1?null:Fp(z.unwrap())}splitRange(h,m,b,S){let z=m-h,k=16;if(z<k*2)S.extend(this.encodeBound(b)),S.extend(ku(of.IdList)),S.extend(ku(z)),this.storage.iterate(h,m,A=>(S.extend(A.id),!0));else{let A=Math.floor(z/k),l=z%k,N=h;for(let W=0;W<k;W++){let ne=A+(W<l?1:0),re=this.storage.fingerprint(N,N+ne);N+=ne;let xe;if(N===m)xe=b;else{let Ae,Ie;this.storage.iterate(N-1,N+1,(pe,ae)=>(ae===N-1?Ae=pe:Ie=pe,!0)),xe=this.getMinimalBound(Ae,Ie)}S.extend(this.encodeBound(xe)),S.extend(ku(of.Fingerprint)),S.extend(re)}}}exceededFrameSizeLimit(h){return h>this.frameSizeLimit-200}decodeTimestampIn(h){let m=my(h);return m=m===0?Number.MAX_VALUE:m-1,this.lastTimestampIn===Number.MAX_VALUE||m===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(m+=this.lastTimestampIn,this.lastTimestampIn=m,m)}decodeBound(h){let m=this.decodeTimestampIn(h),b=my(h);if(b>Vp)throw Error("bound key too long");let S=_y(h,b);return{timestamp:m,id:S}}encodeTimestampOut(h){if(h===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,ku(0);let m=h;return h-=this.lastTimestampOut,this.lastTimestampOut=m,ku(h+1)}encodeBound(h){let m=new Lu;return m.extend(this.encodeTimestampOut(h.timestamp)),m.extend(ku(h.id.length)),m.extend(h.id),m}getMinimalBound(h,m){if(m.timestamp!==h.timestamp)return this._bound(m.timestamp);{let b=0,S=m.id,z=h.id;for(let k=0;k<Vp&&S[k]===z[k];k++)b++;return this._bound(m.timestamp,m.id.subarray(0,b+1))}}};function Lb(h,m){for(let b=0;b<h.byteLength;b++){if(h[b]<m[b])return-1;if(h[b]>m[b])return 1}return h.byteLength>m.byteLength?1:h.byteLength<m.byteLength?-1:0}function I_(h,m){return h.timestamp===m.timestamp?Lb(h.id,m.id):h.timestamp-m.timestamp}var jE=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(h,m,b,S={}){this.relay=h,this.storage=m,this.neg=new Rb(m),this.onhave=S.onhave,this.onneed=S.onneed,this.filter=b,this.subscription=this.relay.prepareSubscription([{}],{label:S.label||"negentropy"}),this.subscription.oncustom=z=>{switch(z[0]){case"NEG-MSG":{z.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${z}`);try{const k=this.neg.reconcile(z[2],this.onhave,this.onneed);k?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${k}"]`):(this.close(),S.onclose?.())}catch(k){console.error("negentropy reconcile error:",k),S?.onclose?.(`reconcile error: ${k}`)}break}case"NEG-CLOSE":{const k=z[2];console.warn("negentropy error:",k),S.onclose?.(k);break}case"NEG-ERR":S.onclose?.()}}}async start(){const h=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${h}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},UE={};Ki(UE,{getToken:()=>VE,hashPayload:()=>L0,unpackEventFromToken:()=>Bb,validateEvent:()=>qb,validateEventKind:()=>Fb,validateEventMethodTag:()=>Ub,validateEventPayloadTag:()=>Vb,validateEventTimestamp:()=>Nb,validateEventUrlTag:()=>jb,validateToken:()=>qE});var Ob="Nostr ";async function VE(h,m,b,S=!1,z){const k={kind:w0,tags:[["u",h],["method",m]],created_at:Math.round(new Date().getTime()/1e3),content:""};z&&k.tags.push(["payload",L0(z)]);const A=await b(k);return(S?Ob:"")+Bu.encode(Bl.encode(JSON.stringify(A)))}async function qE(h,m,b){const S=await Bb(h).catch(k=>{throw k});return await qb(S,m,b).catch(k=>{throw k})}async function Bb(h){if(!h)throw new Error("Missing token");h=h.replace(Ob,"");const m=Ou.decode(Bu.decode(h));if(!m||m.length===0||!m.startsWith("{"))throw new Error("Invalid token");return JSON.parse(m)}function Nb(h){return h.created_at?Math.round(new Date().getTime()/1e3)-h.created_at<60:!1}function Fb(h){return h.kind===w0}function jb(h,m){const b=h.tags.find(S=>S[0]==="u");return b?b.length>0&&b[1]===m:!1}function Ub(h,m){const b=h.tags.find(S=>S[0]==="method");return b?b.length>0&&b[1].toLowerCase()===m.toLowerCase():!1}function L0(h){const m=Xh(Bl.encode(JSON.stringify(h)));return Lr(m)}function Vb(h,m){const b=h.tags.find(z=>z[0]==="payload");if(!b)return!1;const S=L0(m);return b.length>0&&b[1]===S}async function qb(h,m,b,S){if(!Vy(h))throw new Error("Invalid nostr event, signature invalid");if(!Fb(h))throw new Error("Invalid nostr event, kind invalid");if(!Nb(h))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!jb(h,m))throw new Error("Invalid nostr event, url tag invalid");if(!Ub(h,b))throw new Error("Invalid nostr event, method tag invalid");if(S&&typeof S=="object"&&Object.keys(S).length>0&&!Vb(h,S))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Cv=h=>Array.from(h).map(m=>m.toString(16).padStart(2,"0")).join(""),Gb=ze.createContext(null),GE=({children:h})=>{const[m,b]=ze.useState(localStorage.getItem("parlens_pubkey")),[S]=ze.useState(()=>new yS({enablePing:!0,enableReconnect:!0})),z=async(l,N,W)=>{let ne="",re=null;if(l==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");ne=await window.nostr.getPublicKey()}else if(l==="nsec"&&N)try{const xe=ff.decode(N);if(xe.type!=="nsec")throw new Error("Not an nsec");re=xe.data,ne=lg(re),localStorage.setItem("parlens_privkey",Cv(re))}catch{throw new Error("Invalid nsec format")}else l==="create"&&(re=Zx(),ne=lg(re),localStorage.setItem("parlens_privkey",Cv(re)));if(b(ne),localStorage.setItem("parlens_pubkey",ne),l==="create"&&W&&re)try{const xe=Zo({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:W,display_name:W,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${ne}`})},re);await Promise.any([S.publish(["wss://relay.damus.io","wss://nos.lol"],xe)])}catch(xe){console.warn("Failed to publish metadata:",xe)}},k=()=>{b(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},A=async l=>{const N=localStorage.getItem("parlens_privkey");if(N){const W=new Uint8Array(N.match(/.{1,2}/g).map(ne=>parseInt(ne,16)));return Zo(l,W)}if(window.nostr)return await window.nostr.signEvent(l);throw new Error("No signing method available")};return $.jsx(Gb.Provider,{value:{pubkey:m,login:z,logout:k,pool:S,signEvent:A},children:h})},Yp=()=>{const h=ze.useContext(Gb);if(!h)throw new Error("useAuth must be used within AuthProvider");return h};const ZE=h=>h.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),HE=h=>h.replace(/^([A-Z])|[\s-_]+(\w)/g,(m,b,S)=>S?S.toUpperCase():b.toLowerCase()),zv=h=>{const m=HE(h);return m.charAt(0).toUpperCase()+m.slice(1)},Zb=(...h)=>h.filter((m,b,S)=>!!m&&m.trim()!==""&&S.indexOf(m)===b).join(" ").trim(),$E=h=>{for(const m in h)if(m.startsWith("aria-")||m==="role"||m==="title")return!0};var XE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const YE=ze.forwardRef(({color:h="currentColor",size:m=24,strokeWidth:b=2,absoluteStrokeWidth:S,className:z="",children:k,iconNode:A,...l},N)=>ze.createElement("svg",{ref:N,...XE,width:m,height:m,stroke:h,strokeWidth:S?Number(b)*24/Number(m):b,className:Zb("lucide",z),...!k&&!$E(l)&&{"aria-hidden":"true"},...l},[...A.map(([W,ne])=>ze.createElement(W,ne)),...Array.isArray(k)?k:[k]]));const Ei=(h,m)=>{const b=ze.forwardRef(({className:S,...z},k)=>ze.createElement(YE,{ref:k,iconNode:m,className:Zb(`lucide-${ZE(zv(h))}`,`lucide-${h}`,S),...z}));return b.displayName=zv(h),b};const WE=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],KE=Ei("arrow-right",WE);const QE=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],JE=Ei("arrow-up-down",QE);const eM=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],tM=Ei("arrow-up",eM);const nM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],$_=Ei("check",nM);const iM=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],gf=Ei("chevron-down",iM);const rM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ay=Ei("chevron-right",rM);const aM=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],O0=Ei("chevron-up",aM);const sM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Dv=Ei("circle-question-mark",sM);const oM=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Hb=Ei("clock",oM);const lM=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],cM=Ei("eye-off",lM);const uM=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],hM=Ei("eye",uM);const dM=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],fM=Ei("folder-open",dM);const pM=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],X_=Ei("key",pM);const mM=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],gM=Ei("locate",mM);const yM=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],kc=Ei("map-pin",yM);const _M=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],vM=Ei("map-pinned",_M);const xM=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],bM=Ei("navigation",xM);const wM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],$b=Ei("pencil",wM);const TM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],SM=Ei("plus",TM);const EM=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],MM=Ei("route",EM);const AM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],CM=Ei("save",AM);const zM=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],DM=Ei("search",zM);const PM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Xb=Ei("shield",PM);const IM=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Y_=Ei("trash-2",IM);const kM=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],RM=Ei("trash",kM);const LM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],OM=Ei("user-plus",LM);const BM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],NM=Ei("user",BM);const FM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Cy=Ei("x",FM),jM=ze.createContext(null);function UM(h,m){const b=Array.isArray(h)?h[0]:h?h.x:0,S=Array.isArray(h)?h[1]:h?h.y:0,z=Array.isArray(m)?m[0]:m?m.x:0,k=Array.isArray(m)?m[1]:m?m.y:0;return b===z&&S===k}function Fs(h,m){if(h===m)return!0;if(!h||!m)return!1;if(Array.isArray(h)){if(!Array.isArray(m)||h.length!==m.length)return!1;for(let b=0;b<h.length;b++)if(!Fs(h[b],m[b]))return!1;return!0}else if(Array.isArray(m))return!1;if(typeof h=="object"&&typeof m=="object"){const b=Object.keys(h),S=Object.keys(m);if(b.length!==S.length)return!1;for(const z of b)if(!m.hasOwnProperty(z)||!Fs(h[z],m[z]))return!1;return!0}return!1}function Pv(h){return{longitude:h.center.lng,latitude:h.center.lat,zoom:h.zoom,pitch:h.pitch,bearing:h.bearing,padding:h.padding}}function Iv(h,m){const b=m.viewState||m,S={};if("longitude"in b&&"latitude"in b&&(b.longitude!==h.center.lng||b.latitude!==h.center.lat)){const z=h.center.constructor;S.center=new z(b.longitude,b.latitude)}return"zoom"in b&&b.zoom!==h.zoom&&(S.zoom=b.zoom),"bearing"in b&&b.bearing!==h.bearing&&(S.bearing=b.bearing),"pitch"in b&&b.pitch!==h.pitch&&(S.pitch=b.pitch),b.padding&&h.padding&&!Fs(b.padding,h.padding)&&(S.padding=b.padding),S}const VM=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function kv(h){if(!h)return null;if(typeof h=="string"||("toJS"in h&&(h=h.toJS()),!h.layers))return h;const m={};for(const S of h.layers)m[S.id]=S;const b=h.layers.map(S=>{let z=null;"interactive"in S&&(z=Object.assign({},S),delete z.interactive);const k=m[S.ref];if(k){z=z||Object.assign({},S),delete z.ref;for(const A of VM)A in k&&(z[A]=k[A])}return z||S});return{...h,layers:b}}const Rv={version:8,sources:{},layers:[]},Lv={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Ov={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Bv={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},qM=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],GM=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Hp{constructor(m,b,S){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=z=>{const k=this.props[Bv[z.type]];k?k(z):z.type==="error"&&console.error(z.error)},this._onCameraEvent=z=>{if(this._internalUpdate)return;z.viewState=this._propsedCameraUpdate||Pv(this._map.transform);const k=this.props[Ov[z.type]];k&&k(z)},this._onCameraUpdate=z=>this._internalUpdate?z:(this._propsedCameraUpdate=Pv(z),Iv(z,this.props)),this._onPointerEvent=z=>{(z.type==="mousemove"||z.type==="mouseout")&&this._updateHover(z);const k=this.props[Lv[z.type]];k&&(this.props.interactiveLayerIds&&z.type!=="mouseover"&&z.type!=="mouseout"&&(z.features=this._hoveredFeatures||this._queryRenderedFeatures(z.point)),k(z),delete z.features)},this._MapClass=m,this.props=b,this._initialize(S)}get map(){return this._map}setProps(m){const b=this.props;this.props=m;const S=this._updateSettings(m,b),z=this._updateSize(m),k=this._updateViewState(m);this._updateStyle(m,b),this._updateStyleComponents(m),this._updateHandlers(m,b),(S||z||k&&!this._map.isMoving())&&this.redraw()}static reuse(m,b){const S=Hp.savedMaps.pop();if(!S)return null;const z=S.map,k=z.getContainer();for(b.className=k.className;k.childNodes.length>0;)b.appendChild(k.childNodes[0]);z._container=b;const A=z._resizeObserver;A&&(A.disconnect(),A.observe(b)),S.setProps({...m,styleDiffing:!1}),z.resize();const{initialViewState:l}=m;return l&&(l.bounds?z.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):S._updateViewState(l)),z.isStyleLoaded()?z.fire("load"):z.once("style.load",()=>z.fire("load")),z._update(),S}_initialize(m){const{props:b}=this,{mapStyle:S=Rv}=b,z={...b,...b.initialViewState,container:m,style:kv(S)},k=z.initialViewState||z.viewState||z;if(Object.assign(z,{center:[k.longitude||0,k.latitude||0],zoom:k.zoom||0,pitch:k.pitch||0,bearing:k.bearing||0}),b.gl){const l=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=l,b.gl)}const A=new this._MapClass(z);k.padding&&A.setPadding(k.padding),b.cursor&&(A.getCanvas().style.cursor=b.cursor),A.transformCameraUpdate=this._onCameraUpdate,A.on("style.load",()=>{this._styleComponents={light:A.getLight(),sky:A.getSky(),projection:A.getProjection?.(),terrain:A.getTerrain()},this._updateStyleComponents(this.props)}),A.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const l in Lv)A.on(l,this._onPointerEvent);for(const l in Ov)A.on(l,this._onCameraEvent);for(const l in Bv)A.on(l,this._onEvent);this._map=A}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Hp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const m=this._map;m.style&&(m._frame&&(m._frame.cancel(),m._frame=null),m._render())}_updateSize(m){const{viewState:b}=m;if(b){const S=this._map;if(b.width!==S.transform.width||b.height!==S.transform.height)return S.resize(),!0}return!1}_updateViewState(m){const b=this._map,S=b.transform;if(!b.isMoving()){const k=Iv(S,m);if(Object.keys(k).length>0)return this._internalUpdate=!0,b.jumpTo(k),this._internalUpdate=!1,!0}return!1}_updateSettings(m,b){const S=this._map;let z=!1;for(const k of qM)k in m&&!Fs(m[k],b[k])&&(z=!0,S[`set${k[0].toUpperCase()}${k.slice(1)}`]?.call(S,m[k]));return z}_updateStyle(m,b){if(m.cursor!==b.cursor&&(this._map.getCanvas().style.cursor=m.cursor||""),m.mapStyle!==b.mapStyle){const{mapStyle:S=Rv,styleDiffing:z=!0}=m,k={diff:z};"localIdeographFontFamily"in m&&(k.localIdeographFontFamily=m.localIdeographFontFamily),this._map.setStyle(kv(S),k)}}_updateStyleComponents({light:m,projection:b,sky:S,terrain:z}){const k=this._map,A=this._styleComponents;k.style._loaded&&(m&&!Fs(m,A.light)&&(A.light=m,k.setLight(m)),b&&!Fs(b,A.projection)&&b!==A.projection?.type&&(A.projection=typeof b=="string"?{type:b}:b,k.setProjection?.(A.projection)),S&&!Fs(S,A.sky)&&(A.sky=S,k.setSky(S)),z!==void 0&&!Fs(z,A.terrain)&&(!z||k.getSource(z.source))&&(A.terrain=z,k.setTerrain(z)))}_updateHandlers(m,b){const S=this._map;for(const z of GM){const k=m[z]??!0,A=b[z]??!0;Fs(k,A)||(k?S[z].enable(k):S[z].disable())}}_queryRenderedFeatures(m){const b=this._map,{interactiveLayerIds:S=[]}=this.props;try{return b.queryRenderedFeatures(m,{layers:S.filter(b.getLayer.bind(b))})}catch{return[]}}_updateHover(m){const{props:b}=this;if(b.interactiveLayerIds&&(b.onMouseMove||b.onMouseEnter||b.onMouseLeave)){const z=m.type,k=this._hoveredFeatures?.length>0,A=this._queryRenderedFeatures(m.point),l=A.length>0;!l&&k&&(m.type="mouseleave",this._onPointerEvent(m)),this._hoveredFeatures=A,l&&!k&&(m.type="mouseenter",this._onPointerEvent(m)),m.type=z}else this._hoveredFeatures=null}}Hp.savedMaps=[];const ZM=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function HM(h){if(!h)return null;const m=h.map,b={getMap:()=>m};for(const S of $M(m))!(S in b)&&!ZM.includes(S)&&(b[S]=m[S].bind(m));return b}function $M(h){const m=new Set;let b=h;for(;b;){for(const S of Object.getOwnPropertyNames(b))S[0]!=="_"&&typeof h[S]=="function"&&S!=="fire"&&S!=="setEventedParent"&&m.add(S);b=Object.getPrototypeOf(b)}return Array.from(m)}const XM=typeof document<"u"?ze.useLayoutEffect:ze.useEffect;function YM(h,m){const{RTLTextPlugin:b,maxParallelImageRequests:S,workerCount:z,workerUrl:k}=m;if(b&&h.getRTLTextPluginStatus&&h.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:A,lazy:l=!0}=typeof b=="string"?{pluginUrl:b}:b;h.setRTLTextPlugin(A,N=>{N&&console.error(N)},l)}S!==void 0&&h.setMaxParallelImageRequests(S),z!==void 0&&h.setWorkerCount(z),k!==void 0&&h.setWorkerUrl(k)}const Wp=ze.createContext(null);function WM(h,m){const b=ze.useContext(jM),[S,z]=ze.useState(null),k=ze.useRef(),{current:A}=ze.useRef({mapLib:null,map:null});ze.useEffect(()=>{const W=h.mapLib;let ne=!0,re;return Promise.resolve(W||rx(()=>Promise.resolve().then(()=>pA),void 0)).then(xe=>{if(!ne)return;if(!xe)throw new Error("Invalid mapLib");const Ae="Map"in xe?xe:xe.default;if(!Ae.Map)throw new Error("Invalid mapLib");YM(Ae,h),h.reuseMaps&&(re=Hp.reuse(h,k.current)),re||(re=new Hp(Ae.Map,h,k.current)),A.map=HM(re),A.mapLib=Ae,z(re),b?.onMapMount(A.map,h.id)}).catch(xe=>{const{onError:Ae}=h;Ae?Ae({type:"error",target:null,originalEvent:null,error:xe}):console.error(xe)}),()=>{ne=!1,re&&(b?.onMapUnmount(h.id),h.reuseMaps?re.recycle():re.destroy())}},[]),XM(()=>{S&&S.setProps(h)}),ze.useImperativeHandle(m,()=>A.map,[S]);const l=ze.useMemo(()=>({position:"relative",width:"100%",height:"100%",...h.style}),[h.style]),N={height:"100%"};return ze.createElement("div",{id:h.id,ref:k,style:l},S&&ze.createElement(Wp.Provider,{value:A},ze.createElement("div",{"mapboxgl-children":"",style:N},h.children)))}const KM=ze.forwardRef(WM);var Yb=ix();const QM=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Uu(h,m){if(!h||!m)return;const b=h.style;for(const S in m){const z=m[S];Number.isFinite(z)&&!QM.test(S)?b[S]=`${z}px`:b[S]=z}}function Wb(h,m){if(h===m)return null;const b=Nv(h),S=Nv(m),z=[];for(const k of S)b.has(k)||z.push(k);for(const k of b)S.has(k)||z.push(k);return z.length===0?null:z}function Nv(h){return new Set(h?h.trim().split(/\s+/):[])}const jp=ze.memo(ze.forwardRef((h,m)=>{const{map:b,mapLib:S}=ze.useContext(Wp),z=ze.useRef({props:h}),k=ze.useMemo(()=>{let ke=!1;ze.Children.forEach(h.children,zt=>{zt&&(ke=!0)});const Ke={...h,element:ke?document.createElement("div"):void 0},at=new S.Marker(Ke);return at.setLngLat([h.longitude,h.latitude]),at.getElement().addEventListener("click",zt=>{z.current.props.onClick?.({type:"click",target:at,originalEvent:zt})}),at.on("dragstart",zt=>{const wt=zt;wt.lngLat=k.getLngLat(),z.current.props.onDragStart?.(wt)}),at.on("drag",zt=>{const wt=zt;wt.lngLat=k.getLngLat(),z.current.props.onDrag?.(wt)}),at.on("dragend",zt=>{const wt=zt;wt.lngLat=k.getLngLat(),z.current.props.onDragEnd?.(wt)}),at},[]);ze.useEffect(()=>(k.addTo(b.getMap()),()=>{k.remove()}),[]);const{longitude:A,latitude:l,offset:N,style:W,draggable:ne=!1,popup:re=null,rotation:xe=0,rotationAlignment:Ae="auto",pitchAlignment:Ie="auto"}=h;ze.useEffect(()=>{Uu(k.getElement(),W)},[W]),ze.useImperativeHandle(m,()=>k,[]);const pe=z.current.props;(k.getLngLat().lng!==A||k.getLngLat().lat!==l)&&k.setLngLat([A,l]),N&&!UM(k.getOffset(),N)&&k.setOffset(N),k.isDraggable()!==ne&&k.setDraggable(ne),k.getRotation()!==xe&&k.setRotation(xe),k.getRotationAlignment()!==Ae&&k.setRotationAlignment(Ae),k.getPitchAlignment()!==Ie&&k.setPitchAlignment(Ie),k.getPopup()!==re&&k.setPopup(re);const ae=Wb(pe.className,h.className);if(ae)for(const ke of ae)k.toggleClassName(ke);return z.current.props=h,Yb.createPortal(h.children,k.getElement())}));ze.memo(ze.forwardRef((h,m)=>{const{map:b,mapLib:S}=ze.useContext(Wp),z=ze.useMemo(()=>document.createElement("div"),[]),k=ze.useRef({props:h}),A=ze.useMemo(()=>{const l={...h},N=new S.Popup(l);return N.setLngLat([h.longitude,h.latitude]),N.once("open",W=>{k.current.props.onOpen?.(W)}),N},[]);if(ze.useEffect(()=>{const l=N=>{k.current.props.onClose?.(N)};return A.on("close",l),A.setDOMContent(z).addTo(b.getMap()),()=>{A.off("close",l),A.isOpen()&&A.remove()}},[]),ze.useEffect(()=>{Uu(A.getElement(),h.style)},[h.style]),ze.useImperativeHandle(m,()=>A,[]),A.isOpen()){const l=k.current.props;(A.getLngLat().lng!==h.longitude||A.getLngLat().lat!==h.latitude)&&A.setLngLat([h.longitude,h.latitude]),h.offset&&!Fs(l.offset,h.offset)&&A.setOffset(h.offset),(l.anchor!==h.anchor||l.maxWidth!==h.maxWidth)&&(A.options.anchor=h.anchor,A.setMaxWidth(h.maxWidth));const N=Wb(l.className,h.className);if(N)for(const W of N)A.toggleClassName(W);k.current.props=h}return Yb.createPortal(h.children,z)}));function yf(h,m,b,S){const z=ze.useContext(Wp),k=ze.useMemo(()=>h(z),[]);return ze.useEffect(()=>{const A=m,l=null,N=typeof m=="function"?m:null,{map:W}=z;return W.hasControl(k)||(W.addControl(k,A?.position),l&&l(z)),()=>{N&&N(z),W.hasControl(k)&&W.removeControl(k)}},[]),k}function JM(h){const m=yf(({mapLib:b})=>new b.AttributionControl(h),{position:h.position});return ze.useEffect(()=>{Uu(m._container,h.style)},[h.style]),null}ze.memo(JM);function eA(h){const m=yf(({mapLib:b})=>new b.FullscreenControl({container:h.containerId&&document.getElementById(h.containerId)}),{position:h.position});return ze.useEffect(()=>{Uu(m._controlContainer,h.style)},[h.style]),null}ze.memo(eA);function tA(h,m){const b=ze.useRef({props:h}),S=yf(({mapLib:z})=>{const k=new z.GeolocateControl(h),A=k._setupUI;return k._setupUI=()=>{k._container.hasChildNodes()||A()},k.on("geolocate",l=>{b.current.props.onGeolocate?.(l)}),k.on("error",l=>{b.current.props.onError?.(l)}),k.on("outofmaxbounds",l=>{b.current.props.onOutOfMaxBounds?.(l)}),k.on("trackuserlocationstart",l=>{b.current.props.onTrackUserLocationStart?.(l)}),k.on("trackuserlocationend",l=>{b.current.props.onTrackUserLocationEnd?.(l)}),k},{position:h.position});return b.current.props=h,ze.useImperativeHandle(m,()=>S,[]),ze.useEffect(()=>{Uu(S._container,h.style)},[h.style]),null}ze.memo(ze.forwardRef(tA));function nA(h){const m=yf(({mapLib:b})=>new b.NavigationControl(h),{position:h.position});return ze.useEffect(()=>{Uu(m._container,h.style)},[h.style]),null}ze.memo(nA);function iA(h){const m=yf(({mapLib:k})=>new k.ScaleControl(h),{position:h.position}),b=ze.useRef(h),S=b.current;b.current=h;const{style:z}=h;return h.maxWidth!==void 0&&h.maxWidth!==S.maxWidth&&(m.options.maxWidth=h.maxWidth),h.unit!==void 0&&h.unit!==S.unit&&m.setUnit(h.unit),ze.useEffect(()=>{Uu(m._container,z)},[z]),null}ze.memo(iA);function rA(h){const m=yf(({mapLib:b})=>new b.TerrainControl(h),{position:h.position});return ze.useEffect(()=>{Uu(m._container,h.style)},[h.style]),null}ze.memo(rA);function aA(h){const m=yf(({mapLib:b})=>new b.LogoControl(h),{position:h.position});return ze.useEffect(()=>{Uu(m._container,h.style)},[h.style]),null}ze.memo(aA);function zy(h,m){if(!h)throw new Error(m)}let sA=0;function oA(h,m,b){if(h.style&&h.style._loaded){const S={...b};return delete S.id,delete S.children,h.addSource(m,S),h.getSource(m)}return null}function lA(h,m,b){zy(m.id===b.id,"source id changed"),zy(m.type===b.type,"source type changed");let S="",z=0;for(const A in m)A!=="children"&&A!=="id"&&!Fs(b[A],m[A])&&(S=A,z++);if(!z)return;const k=m.type;if(k==="geojson")h.setData(m.data);else if(k==="image")h.updateImage({url:m.url,coordinates:m.coordinates});else switch(S){case"coordinates":h.setCoordinates?.(m.coordinates);break;case"url":h.setUrl?.(m.url);break;case"tiles":h.setTiles?.(m.tiles);break;default:console.warn(`Unable to update <Source> prop: ${S}`)}}function Fv(h){const m=ze.useContext(Wp).map.getMap(),b=ze.useRef(h),[,S]=ze.useState(0),z=ze.useMemo(()=>h.id||`jsx-source-${sA++}`,[]);ze.useEffect(()=>{if(m){const A=()=>setTimeout(()=>S(l=>l+1),0);return m.on("styledata",A),A(),()=>{if(m.off("styledata",A),m.style&&m.style._loaded&&m.getSource(z)){const l=m.getStyle()?.layers;if(l)for(const N of l)N.source===z&&m.removeLayer(N.id);m.removeSource(z)}}}},[m]);let k=m&&m.style&&m.getSource(z);return k?lA(k,h,b.current):k=oA(m,z,h),b.current=h,k&&ze.Children.map(h.children,A=>A&&ze.cloneElement(A,{source:z}))||null}function cA(h,m,b,S){if(zy(b.id===S.id,"layer id changed"),zy(b.type===S.type,"layer type changed"),b.type==="custom"||S.type==="custom")return;const{layout:z={},paint:k={},filter:A,minzoom:l,maxzoom:N,beforeId:W}=b;if(W!==S.beforeId&&h.moveLayer(m,W),z!==S.layout){const ne=S.layout||{};for(const re in z)Fs(z[re],ne[re])||h.setLayoutProperty(m,re,z[re]);for(const re in ne)z.hasOwnProperty(re)||h.setLayoutProperty(m,re,void 0)}if(k!==S.paint){const ne=S.paint||{};for(const re in k)Fs(k[re],ne[re])||h.setPaintProperty(m,re,k[re]);for(const re in ne)k.hasOwnProperty(re)||h.setPaintProperty(m,re,void 0)}Fs(A,S.filter)||h.setFilter(m,A),(l!==S.minzoom||N!==S.maxzoom)&&h.setLayerZoomRange(m,l,N)}function uA(h,m,b){if(h.style&&h.style._loaded&&(!("source"in b)||h.getSource(b.source))){const S={...b,id:m};delete S.beforeId,h.addLayer(S,b.beforeId)}}let hA=0;function jv(h){const m=ze.useContext(Wp).map.getMap(),b=ze.useRef(h),[,S]=ze.useState(0),z=ze.useMemo(()=>h.id||`jsx-layer-${hA++}`,[]);if(ze.useEffect(()=>{if(m){const A=()=>S(l=>l+1);return m.on("styledata",A),A(),()=>{m.off("styledata",A),m.style&&m.style._loaded&&m.getLayer(z)&&m.removeLayer(z)}}},[m]),m&&m.style&&m.getLayer(z))try{cA(m,z,h,b.current)}catch(A){console.warn(A)}else uA(m,z,h);return b.current=h,null}var vy={exports:{}};var dA=vy.exports,Uv;function fA(){return Uv||(Uv=1,(function(h,m){(function(b,S){h.exports=S()})(dA,(function(){var b={},S={};function z(A,l,N){if(S[A]=N,A==="index"){var W="var sharedModule = {}; ("+S.shared+")(sharedModule); ("+S.worker+")(sharedModule);",ne={};return S.shared(ne),S.index(b,ne),typeof window<"u"&&b.setWorkerUrl(window.URL.createObjectURL(new Blob([W],{type:"text/javascript"}))),b}}z("shared",["exports"],(function(A){function l(i,e,n,o){return new(n||(n=Promise))((function(u,p){function g(C){try{T(o.next(C))}catch(I){p(I)}}function x(C){try{T(o.throw(C))}catch(I){p(I)}}function T(C){var I;C.done?u(C.value):(I=C.value,I instanceof n?I:new n((function(L){L(I)}))).then(g,x)}T((o=o.apply(i,e||[])).next())}))}function N(i,e){this.x=i,this.y=e}function W(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ne,re;typeof SuppressedError=="function"&&SuppressedError,N.prototype={clone(){return new N(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround(i,e){const n=Math.cos(i),o=Math.sin(i),u=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:N},N.convert=function(i){if(i instanceof N)return i;if(Array.isArray(i))return new N(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new N(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var xe=(function(){if(re)return ne;function i(e,n,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=u}return re=1,ne=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var x=0,T=1;for(o=e,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));u++)e>p?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},ne})(),Ae=W(xe);let Ie,pe;function ae(){return Ie==null&&(Ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ie}function ke(){if(pe==null&&(pe=!1,ae())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){pe=!0;break}}}return pe||!1}var Ke=1e-6,at=typeof Float32Array<"u"?Float32Array:Array;function zt(){var i=new at(9);return at!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function wt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ut(){var i=new at(3);return at!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function ot(i){var e=i[0],n=i[1],o=i[2];return Math.sqrt(e*e+n*n+o*o)}function Pe(i,e,n){var o=new at(3);return o[0]=i,o[1]=e,o[2]=n,o}function rt(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function nt(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function ct(i,e,n){var o=e[0],u=e[1],p=e[2],g=n[0],x=n[1],T=n[2];return i[0]=u*T-p*x,i[1]=p*g-o*T,i[2]=o*x-u*g,i}var Tt,Nt=ot;function qt(i,e,n){var o=e[0],u=e[1],p=e[2],g=e[3];return i[0]=n[0]*o+n[4]*u+n[8]*p+n[12]*g,i[1]=n[1]*o+n[5]*u+n[9]*p+n[13]*g,i[2]=n[2]*o+n[6]*u+n[10]*p+n[14]*g,i[3]=n[3]*o+n[7]*u+n[11]*p+n[15]*g,i}function ht(){var i=new at(4);return at!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Se(i,e,n,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;e*=p,o*=p,n*=p;var g=Math.sin(e),x=Math.cos(e),T=Math.sin(n),C=Math.cos(n),I=Math.sin(o),L=Math.cos(o);switch(u){case"xyz":i[0]=g*C*L+x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L-g*T*I;break;case"xzy":i[0]=g*C*L-x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L+g*T*I;break;case"yxz":i[0]=g*C*L+x*T*I,i[1]=x*T*L-g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L+g*T*I;break;case"yzx":i[0]=g*C*L+x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L-g*T*I;break;case"zxy":i[0]=g*C*L-x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I+g*T*L,i[3]=x*C*L-g*T*I;break;case"zyx":i[0]=g*C*L-x*T*I,i[1]=x*T*L+g*C*I,i[2]=x*C*I-g*T*L,i[3]=x*C*L+g*T*I;break;default:throw new Error("Unknown angle order "+u)}return i}function Xe(){var i=new at(2);return at!=Float32Array&&(i[0]=0,i[1]=0),i}function _t(i,e){var n=new at(2);return n[0]=i,n[1]=e,n}ut(),Tt=new at(4),at!=Float32Array&&(Tt[0]=0,Tt[1]=0,Tt[2]=0,Tt[3]=0),ut(),Pe(1,0,0),Pe(0,1,0),ht(),ht(),zt(),Xe();const xt=8192;function Bt(i,e,n){return e*(xt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function Te(i,e){return(i%e+e)%e}function Ve(i,e,n){return i*(1-n)+e*n}function bt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Dt(i,e,n,o){const u=new Ae(i,e,n,o);return p=>u.solve(p)}const jt=Dt(.25,.1,.25,1);function Xt(i,e,n){return Math.min(n,Math.max(e,i))}function Yt(i,e,n){const o=n-e,u=((i-e)%o+o)%o+e;return u===e?n:u}function mn(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let Kt=1;function wn(i,e,n){const o={};for(const u in i)o[u]=e.call(this,i[u],u,i);return o}function br(i,e,n){const o={};for(const u in i)e.call(this,i[u],u,i)&&(o[u]=i[u]);return o}function Zn(i){return Array.isArray(i)?i.map(Zn):typeof i=="object"&&i?wn(i,Zn):i}const lr={};function Dn(i){lr[i]||(typeof console<"u"&&console.warn(i),lr[i]=!0)}function Bi(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Ni(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Kn=null;function aa(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Gr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function li(i,e,n,o,u){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const g=p?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const x=g.startsWith("BGR"),T=new Uint8ClampedArray(o*u*4);if(yield p.copyTo(T,(function(C,I,L,B,F){const q=4*Math.max(-I,0),G=(Math.max(0,L)-L)*B*4+q,Y=4*B,J=Math.max(0,I),he=Math.max(0,L);return{rect:{x:J,y:he,width:Math.min(C.width,I+B)-J,height:Math.min(C.height,L+F)-he},layout:[{offset:G,stride:Y}]}})(i,e,n,o,u)),x)for(let C=0;C<T.length;C+=4){const I=T[C];T[C]=T[C+2],T[C+2]=I}return T}finally{p.close()}}))}let xn,Ar;function Sa(i,e,n,o){return i.addEventListener(e,n,o),{unsubscribe:()=>{i.removeEventListener(e,n,o)}}}function xi(i){return i*Math.PI/180}function nr(i){return i/Math.PI*180}const fe={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Z={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},X="AbortError";class Q extends Error{constructor(e=X){super(e instanceof Error?e.message:e),this.name=X,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function de(i){return i.name===X}const we={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Le(i){return we.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Re="global-dispatcher";class ye extends Error{constructor(e,n,o,u){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=u}}const Oe=()=>Ni(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Je=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=Le(i.url);if(o)return o(i,e);if(Ni(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Re},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Oe())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return l(this,void 0,void 0,(function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Oe(),signal:u.signal});let g,x;o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{g=yield fetch(p)}catch(C){throw de(C)?C:new ye(0,C.message,o.url,new Blob)}if(!g.ok){const C=yield g.blob();throw new ye(g.status,g.statusText,o.url,C)}x=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const T=yield x;return u.signal.throwIfAborted(),{data:T,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(i,e);if(Ni(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Re},e)}var n;return(function(o,u){return new Promise(((p,g)=>{var x;const T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(const C in o.headers)T.setRequestHeader(C,o.headers[C]);o.type==="json"&&(T.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{g(new Error(T.statusText))},T.onload=()=>{if(!u.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let C=T.response;if(o.type==="json")try{C=JSON.parse(T.response)}catch(I){return void g(I)}p({data:C,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const C=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});g(new ye(T.status,T.statusText,o.url,C))}},u.signal.addEventListener("abort",(()=>{T.abort(),g(new Q(u.signal.reason))})),T.send(o.body)}))})(i,e)};function it(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Mt(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Pt(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class $t{constructor(e,n={}){mn(this,n),this.type=e}}class hn extends $t{constructor(e,n={}){super("error",mn({error:e},n))}}class dn{on(e,n){return this._listeners=this._listeners||{},Mt(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return Pt(e,n,this._listeners),Pt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Mt(e,n,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,n){typeof e=="string"&&(e=new $t(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of u)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of p)Pt(o,x,this._oneTimeListeners),x.call(this,e);const g=this._eventedParent;g&&(mn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof hn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Pn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Mi(i,e){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return Pn.forEach((o=>{o in e&&(n[o]=e[o])})),n}function nn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!nn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!nn(i[n],e[n]))return!1;return!0}return i===e}function In(i,e){i.push(e)}function Gi(i,e,n){In(n,{command:"addSource",args:[i,e[i]]})}function Bn(i,e,n){In(e,{command:"removeSource",args:[i]}),n[i]=!0}function di(i,e,n,o){Bn(i,n,o),Gi(i,e,n)}function Un(i,e,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!nn(i[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!nn(i[n][o],e[n][o]))return!1;return!0}function Ai(i,e,n,o,u,p){i=i||{},e=e||{};for(const g in i)Object.prototype.hasOwnProperty.call(i,g)&&(nn(i[g],e[g])||n.push({command:p,args:[o,g,e[g],u]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(nn(i[g],e[g])||n.push({command:p,args:[o,g,e[g],u]}))}function ho(i){return i.id}function lt(i,e){return i[e.id]=e,i}class Be{constructor(e,n,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function Ut(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}class ln extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Nn{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(e){return new Nn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Tn={kind:"null"},ft={kind:"number"},Jt={kind:"string"},rn={kind:"boolean"},sa={kind:"color"},Vu={kind:"projectionDefinition"},hs={kind:"object"},sn={kind:"value"},Ho={kind:"collator"},ds={kind:"formatted"},Us={kind:"padding"},fs={kind:"colorArray"},ps={kind:"numberArray"},Ci={kind:"resolvedImage"},Nl={kind:"variableAnchorOffsetCollection"};function Cr(i,e){return{kind:"array",itemType:i,N:e}}function Sn(i){if(i.kind==="array"){const e=Sn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Vs=[Tn,ft,Jt,rn,sa,Vu,ds,hs,Cr(sn),Us,ps,fs,Ci,Nl];function Fl(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Fl(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Vs)if(!Fl(n,e))return null}}return`Expected ${Sn(i)} but found ${Sn(e)} instead.`}function jl(i,e){return e.some((n=>n.kind===i.kind))}function fo(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function $a(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Rc=.96422,ms=.82521,Ea=4/29,kn=6/29,Wh=3*kn*kn,_f=kn*kn*kn,$o=Math.PI/180,Kh=180/Math.PI;function Lc(i){return(i%=360)<0&&(i+=360),i}function vf([i,e,n,o]){let u,p;const g=Oc((.2225045*(i=Or(i))+.7168786*(e=Or(e))+.0606169*(n=Or(n)))/1);i===e&&e===n?u=p=g:(u=Oc((.4360747*i+.3850649*e+.1430804*n)/Rc),p=Oc((.0139322*i+.0971045*e+.7141733*n)/ms));const x=116*g-16;return[x<0?0:x,500*(u-g),200*(g-p),o]}function Or(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Oc(i){return i>_f?Math.pow(i,1/3):i/Wh+Ea}function qu([i,e,n,o]){let u=(i+16)/116,p=isNaN(e)?u:u+e/500,g=isNaN(n)?u:u-n/200;return u=1*po(u),p=Rc*po(p),g=ms*po(g),[Bc(3.1338561*p-1.6168667*u-.4906146*g),Bc(-.9787684*p+1.9161415*u+.033454*g),Bc(.0719453*p-.2289914*u+1.4052427*g),o]}function Bc(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function po(i){return i>kn?i*i*i:Wh*(i-Ea)}const xf=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Ul(i,e){return xf(i,e)?i[e]:void 0}function qs(i){return parseInt(i.padEnd(2,i),16)/255}function bf(i,e){return Xo(e?i/100:i,0,1)}function Xo(i,e,n){return Math.min(Math.max(e,i),n)}function Gu(i){return!i.some(Number.isNaN)}const Yo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function mo(i,e,n){return i+n*(e-i)}function Vl(i,e,n){return i.map(((o,u)=>mo(o,e[u],n)))}class un{constructor(e,n,o,u=1,p=!0){this.r=e,this.g=n,this.b=o,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,n,o,u]))}static parse(e){if(e instanceof un)return e;if(typeof e!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Ul(Yo,o);if(u){const[g,x,T]=u;return[g/255,x/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let x=1;return[qs(o.slice(x,x+=g)),qs(o.slice(x,x+=g)),qs(o.slice(x,x+=g)),qs(o.slice(x,x+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[x,T,C,I,L,B,F,q,G,Y,J,he]=g,ee=[I||" ",F||" ",Y].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ie=[C,B,G].join(""),ge=ie==="%%%"?100:ie===""?255:0;if(ge){const be=[Xo(+T/ge,0,1),Xo(+L/ge,0,1),Xo(+q/ge,0,1),J?bf(+J,he):1];if(Gu(be))return be}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[g,x,T,C,I,L,B,F,q]=p,G=[T||" ",I||" ",B].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const Y=[+x,Xo(+C,0,100),Xo(+L,0,100),F?bf(+F,q):1];if(Gu(Y))return(function([J,he,ee,ie]){function ge(be){const Ue=(be+J/30)%12,st=he*Math.min(ee,1-ee);return ee-st*Math.max(-1,Math.min(Ue-3,9-Ue,1))}return J=Lc(J),he/=100,ee/=100,[ge(0),ge(8),ge(4),ie]})(Y)}}})(e);return n?new un(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[e/p,n/p,o/p,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,o,u,p]=vf(e),g=Math.sqrt(o*o+u*u);return[Math.round(1e4*g)?Lc(Math.atan2(u,o)*Kh):NaN,g,n,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",vf(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,u]=this.rgb;return`rgba(${[e,n,o].map((p=>Math.round(255*p))).join(",")},${u})`}static interpolate(e,n,o,u="rgb"){switch(u){case"rgb":{const[p,g,x,T]=Vl(e.rgb,n.rgb,o);return new un(p,g,x,T,!1)}case"hcl":{const[p,g,x,T]=e.hcl,[C,I,L,B]=n.hcl;let F,q;if(isNaN(p)||isNaN(C))isNaN(p)?isNaN(C)?F=NaN:(F=C,x!==1&&x!==0||(q=I)):(F=p,L!==1&&L!==0||(q=g));else{let ee=C-p;C>p&&ee>180?ee-=360:C<p&&p-C>180&&(ee+=360),F=p+o*ee}const[G,Y,J,he]=(function([ee,ie,ge,be]){return ee=isNaN(ee)?0:ee*$o,qu([ge,Math.cos(ee)*ie,Math.sin(ee)*ie,be])})([F,q??mo(g,I,o),mo(x,L,o),mo(T,B,o)]);return new un(G,Y,J,he,!1)}case"lab":{const[p,g,x,T]=qu(Vl(e.lab,n.lab,o));return new un(p,g,x,T,!1)}}}}un.black=new un(0,0,0,1),un.white=new un(1,1,1,1),un.transparent=new un(0,0,0,0),un.red=new un(1,0,0,1);class Xa{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Qh=["bottom","center","top"];class Nc{constructor(e,n,o,u,p,g){this.text=e,this.image=n,this.scale=o,this.fontStack=u,this.textColor=p,this.verticalAlign=g}}class ir{constructor(e){this.sections=e}static fromString(e){return new ir([new Nc(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof ir?e:ir.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Zi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Zi)return e;if(typeof e=="number")return new Zi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Zi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new Zi(Vl(e.values,n.values,o))}}class fi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof fi)return e;if(typeof e=="number")return new fi([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new fi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){return new fi(Vl(e.values,n.values,o))}}class Qt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qt)return e;if(typeof e=="string"){const o=un.parse(e);return o?new Qt([o]):void 0}if(!Array.isArray(e))return;const n=[];for(const o of e){if(typeof o!="string")return;const u=un.parse(o);if(!u)return;n.push(u)}return new Qt(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o,u="rgb"){const p=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let g=0;g<e.values.length;g++)p.push(un.interpolate(e.values[g],n.values[g],o,u));return new Qt(p)}}class Qn extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ma=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class zi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof zi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],u=e[n+1];if(typeof o!="string"||!Ma.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new zi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,o){const u=e.values,p=n.values;if(u.length!==p.length)throw new Qn(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const g=[];for(let x=0;x<u.length;x+=2){if(u[x]!==p[x])throw new Qn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${u[x]}, to[${x}]: ${p[x]}`);g.push(u[x]);const[T,C]=u[x+1],[I,L]=p[x+1];g.push([mo(T,I,o),mo(C,L,o)])}return new zi(g)}}class Br{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Br({name:e,available:!1}):null}}class rr{constructor(e,n,o){this.from=e,this.to=n,this.transition=o}static interpolate(e,n,o){return new rr(e,n,o)}static parse(e){return e instanceof rr?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new rr(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new rr(e.from,e.to,e.transition):typeof e=="string"?new rr(e,e,1):void 0}}function oa(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof rr||i instanceof un||i instanceof Xa||i instanceof ir||i instanceof Zi||i instanceof fi||i instanceof Qt||i instanceof zi||i instanceof Br)return!0;if(Array.isArray(i)){for(const e of i)if(!gs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!gs(i[e]))return!1;return!0}return!1}function pi(i){if(i===null)return Tn;if(typeof i=="string")return Jt;if(typeof i=="boolean")return rn;if(typeof i=="number")return ft;if(i instanceof un)return sa;if(i instanceof rr)return Vu;if(i instanceof Xa)return Ho;if(i instanceof ir)return ds;if(i instanceof Zi)return Us;if(i instanceof fi)return ps;if(i instanceof Qt)return fs;if(i instanceof zi)return Nl;if(i instanceof Br)return Ci;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const u=pi(o);if(n){if(n===u)continue;n=sn;break}n=u}return Cr(n||sn,e)}return hs}function go(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof un||i instanceof rr||i instanceof ir||i instanceof Zi||i instanceof fi||i instanceof Qt||i instanceof zi||i instanceof Br?i.toString():JSON.stringify(i)}class la{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!gs(e[1]))return n.error("invalid value");const o=e[1];let u=pi(o);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new la(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Wo={string:Jt,number:ft,boolean:rn,object:hs};class Nr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,u=1;const p=e[0];if(p==="array"){let x,T;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Wo)||C==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=Wo[C],u++}else x=sn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],u++}o=Cr(x,T)}else{if(!Wo[p])throw new Error(`Types doesn't contain name = ${p}`);o=Wo[p]}const g=[];for(;u<e.length;u++){const x=n.parse(e[u],u,sn);if(!x)return null;g.push(x)}return new Nr(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!Fl(this.type,pi(o)))return o;if(n===this.args.length-1)throw new Qn(`Expected value to be of type ${Sn(this.type)}, but found ${Sn(pi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Qi={"to-boolean":rn,"to-color":sa,"to-number":ft,"to-string":Jt};class Fr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!Qi[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const u=Qi[o],p=[];for(let g=1;g<e.length;g++){const x=n.parse(e[g],g,sn);if(!x)return null;p.push(x)}return new Fr(u,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(e),o=null,n instanceof un)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:oa(n[0],n[1],n[2],n[3]),!o))return new un(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Qn(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const u=Zi.parse(n);if(u)return u}throw new Qn(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(e);const u=fi.parse(n);if(u)return u}throw new Qn(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(e);const u=Qt.parse(n);if(u)return u}throw new Qn(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const u=zi.parse(n);if(u)return u}throw new Qn(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Qn(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return ir.fromString(go(this.args[0].evaluate(e)));case"resolvedImage":return Br.fromString(go(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return go(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Fc=["Unknown","Point","LineString","Polygon"];class Ko{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=un.parse(e),this._parseColorCache.set(e,n)),n}}class Qo{constructor(e,n,o=[],u,p=new Nn,g=[]){this.registry=e,this.path=o,this.key=o.map((x=>`[${x}]`)).join(""),this.scope=p,this.errors=g,this.expectedType=u,this._isConstant=n}parse(e,n,o,u,p={}){return n?this.concat(n,o,u)._parse(e,p):this._parse(e,p)}_parse(e,n){function o(u,p,g){return g==="assert"?new Nr(p,[u]):g==="coerce"?new Fr(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,T=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||T.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(T.kind)||x.kind==="colorArray"&&["value","string","array"].includes(T.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))g=o(g,x,n.typeAnnotation||"coerce");else if(this.checkSubtype(x,T))return null}else g=o(g,x,n.typeAnnotation||"assert")}if(!(g instanceof la)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const x=new Ko;try{g=new la(g.type,g.evaluate(x))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const u=typeof e=="number"?this.path.concat(e):this.path,p=o?this.scope.concat(o):this.scope;return new Qo(this.registry,this._isConstant,u,n||null,p,this.errors)}error(e,...n){const o=`${this.key}${n.map((u=>`[${u}]`)).join("")}`;this.errors.push(new ln(o,e))}checkSubtype(e,n){const o=Fl(e,n);return o&&this.error(o),o}}class Hn{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=n.parse(e[p+1],p+1);if(!x)return null;o.push([g,x])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return u?new Hn(o,u):null}outputDefined(){return this.result.outputDefined()}}class yo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new yo(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class gn{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,ft),u=n.parse(e[2],2,Cr(n.expectedType||sn));return o&&u?new gn(u.type.itemType,o,u):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Qn(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Qn(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Qn(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class on{constructor(e,n){this.type=rn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,sn),u=n.parse(e[2],2,sn);return o&&u?jl(o.type,[rn,Jt,ft,Tn,sn])?new on(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!fo(n,["boolean","string","number","null"]))throw new Qn(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(pi(n))} instead.`);if(!fo(o,["string","array"]))throw new Qn(`Expected second argument to be of type array or string, but found ${Sn(pi(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Jo{constructor(e,n,o){this.type=ft,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,sn),u=n.parse(e[2],2,sn);if(!o||!u)return null;if(!jl(o.type,[rn,Jt,ft,Tn,sn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,ft);return p?new Jo(o,u,p):null}return new Jo(o,u)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!fo(n,["boolean","string","number","null"]))throw new Qn(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(pi(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),fo(o,["string"])){const p=o.indexOf(n,u);return p===-1?-1:[...o.slice(0,p)].length}if(fo(o,["array"]))return o.indexOf(n,u);throw new Qn(`Expected second argument to be of type array or string, but found ${Sn(pi(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class En{constructor(e,n,o,u,p,g){this.inputType=e,this.type=n,this.input=o,this.cases=u,this.outputs=p,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},g=[];for(let C=2;C<e.length-1;C+=2){let I=e[C];const L=e[C+1];Array.isArray(I)||(I=[I]);const B=n.concat(C);if(I.length===0)return B.error("Expected at least one branch label.");for(const q of I){if(typeof q!="number"&&typeof q!="string")return B.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,pi(q)))return null}else o=pi(q);if(p[String(q)]!==void 0)return B.error("Branch labels must be unique.");p[String(q)]=g.length}const F=n.parse(L,C,u);if(!F)return null;u=u||F.type,g.push(F)}const x=n.parse(e[1],1,sn);if(!x)return null;const T=n.parse(e[e.length-1],e.length-1,u);return T?x.type.kind!=="value"&&n.concat(1).checkSubtype(o,x.type)?null:new En(o,u,x,p,g,T):null}evaluate(e){const n=this.input.evaluate(e);return(pi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class jc{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const x=n.parse(e[g],g,rn);if(!x)return null;const T=n.parse(e[g+1],g+1,o);if(!T)return null;u.push([x,T]),o=o||T.type}const p=n.parse(e[e.length-1],e.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new jc(o,u,p)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Aa{constructor(e,n,o,u){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,sn),u=n.parse(e[2],2,ft);if(!o||!u)return null;if(!jl(o.type,[Cr(sn),Jt,sn]))return n.error(`Expected first argument to be of type array or string, but found ${Sn(o.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,ft);return p?new Aa(o.type,o,u,p):null}return new Aa(o.type,o,u)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),fo(n,["string"]))return[...n].slice(o,u).join("");if(fo(n,["array"]))return n.slice(o,u);throw new Qn(`Expected first argument to be of type array or string, but found ${Sn(pi(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function _o(i,e){const n=i.length-1;let o,u,p=0,g=n,x=0;for(;p<=g;)if(x=Math.floor((p+g)/2),o=i[x],u=i[x+1],o<=e){if(x===n||e<u)return x;p=x+1}else{if(!(o>e))throw new Qn("Input is not a number.");g=x-1}return 0}class vo{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,ft);if(!o)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],T=e[g+1],C=g,I=g+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const L=n.parse(T,I,p);if(!L)return null;p=p||L.type,u.push([x,L])}return new vo(p,o,u)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const p=n.length;return u>=n[p-1]?o[p-1].evaluate(e):o[_o(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function wf(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Uc,Jh,Kp=(function(){if(Jh)return Uc;function i(e,n,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=o,this.p2y=u}return Jh=1,Uc=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var p=this.sampleCurveX(o)-e;if(Math.abs(p)<n)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=p/g}var x=0,T=1;for(o=e,u=0;u<20&&(p=this.sampleCurveX(o),!(Math.abs(p-e)<n));u++)e>p?x=o:T=o,o=.5*(T-x)+x;return o},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Uc})(),ed=wf(Kp);class jr{constructor(e,n,o,u,p){this.type=e,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[g,x]of p)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,n,o,u){let p=0;if(e.name==="exponential")p=ys(n,e.base,o,u);else if(e.name==="linear")p=ys(n,1,o,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new ed(g[0],g[1],g[2],g[3]).solve(ys(n,1,o,u))}return p}static parse(e,n){let[o,u,p,...g]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const C=u[1];if(typeof C!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(C.length!==4||C.some((I=>typeof I!="number"||I<0||I>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,ft),!p)return null;const x=[];let T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==fs?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=sa;for(let C=0;C<g.length;C+=2){const I=g[C],L=g[C+1],B=C+3,F=C+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const q=n.parse(L,F,T);if(!q)return null;T=T||q.type,x.push([I,q])}return $a(T,ft)||$a(T,Vu)||$a(T,sa)||$a(T,Us)||$a(T,ps)||$a(T,fs)||$a(T,Nl)||$a(T,Cr(ft))?new jr(T,o,u,p,x):n.error(`Type ${Sn(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return o[0].evaluate(e);const p=n.length;if(u>=n[p-1])return o[p-1].evaluate(e);const g=_o(n,u),x=jr.interpolationFactor(this.interpolation,u,n[g],n[g+1]),T=o[g].evaluate(e),C=o[g+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return mo(T,C,x);case"color":return un.interpolate(T,C,x);case"padding":return Zi.interpolate(T,C,x);case"colorArray":return Qt.interpolate(T,C,x);case"numberArray":return fi.interpolate(T,C,x);case"variableAnchorOffsetCollection":return zi.interpolate(T,C,x);case"array":return Vl(T,C,x);case"projectionDefinition":return rr.interpolate(T,C,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return un.interpolate(T,C,x,"hcl");case"colorArray":return Qt.interpolate(T,C,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return un.interpolate(T,C,x,"lab");case"colorArray":return Qt.interpolate(T,C,x,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function ys(i,e,n,o){const u=o-n,p=i-n;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}const mi={color:un.interpolate,number:mo,padding:Zi.interpolate,numberArray:fi.interpolate,colorArray:Qt.interpolate,variableAnchorOffsetCollection:zi.interpolate,array:Vl};class el{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const x of e.slice(1)){const T=n.parse(x,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,p.push(T)}if(!o)throw new Error("No output type");const g=u&&p.some((x=>Fl(u,x.type)));return new el(g?sn:o,p)}evaluate(e){let n,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(e),o&&o instanceof Br&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Vc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function qc(i,e,n,o){return o.compare(e,n)===0}function Di(i,e,n){const o=i!=="=="&&i!=="!=";return class Kb{constructor(p,g,x){this.type=rn,this.lhs=p,this.rhs=g,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const x=p[0];let T=g.parse(p[1],1,sn);if(!T)return null;if(!Vc(x,T.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${Sn(T.type)}'.`);let C=g.parse(p[2],2,sn);if(!C)return null;if(!Vc(x,C.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${Sn(C.type)}'.`);if(T.type.kind!==C.type.kind&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${Sn(T.type)}' and '${Sn(C.type)}'.`);o&&(T.type.kind==="value"&&C.type.kind!=="value"?T=new Nr(C.type,[T]):T.type.kind!=="value"&&C.type.kind==="value"&&(C=new Nr(T.type,[C])));let I=null;if(p.length===4){if(T.type.kind!=="string"&&C.type.kind!=="string"&&T.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(p[3],3,Ho),!I)return null}return new Kb(T,C,I)}evaluate(p){const g=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const T=pi(g),C=pi(x);if(T.kind!==C.kind||T.kind!=="string"&&T.kind!=="number")throw new Qn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${C.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=pi(g),C=pi(x);if(T.kind!=="string"||C.kind!=="string")return e(p,g,x)}return this.collator?n(p,g,x,this.collator.evaluate(p)):e(p,g,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Tf=Di("==",(function(i,e,n){return e===n}),qc),Zu=Di("!=",(function(i,e,n){return e!==n}),(function(i,e,n,o){return!qc(0,e,n,o)})),Sf=Di("<",(function(i,e,n){return e<n}),(function(i,e,n,o){return o.compare(e,n)<0})),Qp=Di(">",(function(i,e,n){return e>n}),(function(i,e,n,o){return o.compare(e,n)>0})),ql=Di("<=",(function(i,e,n){return e<=n}),(function(i,e,n,o){return o.compare(e,n)<=0})),Hu=Di(">=",(function(i,e,n){return e>=n}),(function(i,e,n,o){return o.compare(e,n)>=0}));class Gl{constructor(e,n,o){this.type=Ho,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,rn);if(!u)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,rn);if(!p)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,Jt),!g)?null:new Gl(u,p,g)}evaluate(e){return new Xa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class td{constructor(e,n,o,u,p){this.type=Jt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,ft);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parse(u.locale,1,Jt),!p))return null;let g=null;if(u.currency&&(g=n.parse(u.currency,1,Jt),!g))return null;let x=null;if(u["min-fraction-digits"]&&(x=n.parse(u["min-fraction-digits"],1,ft),!x))return null;let T=null;return u["max-fraction-digits"]&&(T=n.parse(u["max-fraction-digits"],1,ft),!T)?null:new td(o,p,g,x,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Gc{constructor(e){this.type=ds,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let T=null;if(x["font-scale"]&&(T=n.parse(x["font-scale"],1,ft),!T))return null;let C=null;if(x["text-font"]&&(C=n.parse(x["text-font"],1,Cr(Jt)),!C))return null;let I=null;if(x["text-color"]&&(I=n.parse(x["text-color"],1,sa),!I))return null;let L=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Qh.includes(x["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(L=n.parse(x["vertical-align"],1,Jt),!L)return null}const B=u[u.length-1];B.scale=T,B.font=C,B.textColor=I,B.verticalAlign=L}else{const T=n.parse(e[g],1,sn);if(!T)return null;const C=T.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Gc(u)}evaluate(e){return new ir(this.sections.map((n=>{const o=n.content.evaluate(e);return pi(o)===Ci?new Nc("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Nc(go(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class Zl{constructor(e){this.type=Ci,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Jt);return o?new Zl(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Br.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Hl{constructor(e){this.type=ft,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Sn(o.type)} instead.`):new Hl(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Qn(`Expected value to be of type string or array, but found ${Sn(pi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Fi=8192;function $l(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Fi),Math.round(o*u*Fi)]}function Xl(i,e){const n=Math.pow(2,e.z);return[(u=(i[0]/Fi+e.x)/n,360*u-180),(o=(i[1]/Fi+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Yl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function xo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ef(i,e,n){const o=i[0]-e[0],u=i[1]-e[1],p=i[0]-n[0],g=i[1]-n[1];return o*g-p*u==0&&o*p<=0&&u*g<=0}function Zc(i,e,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(p=[e[0]-i[0],e[1]-i[1]])[1]-u[1]*p[0]!=0&&!(!Xu(i,e,n,o)||!Xu(n,o,i,e));var u,p}function Mf(i,e,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(Zc(i,e,o[u],o[u+1]))return!0;return!1}function Ya(i,e,n=!1){let o=!1;for(const x of e)for(let T=0;T<x.length-1;T++){if(Ef(i,x[T],x[T+1]))return n;(p=x[T])[1]>(u=i)[1]!=(g=x[T+1])[1]>u[1]&&u[0]<(g[0]-p[0])*(u[1]-p[1])/(g[1]-p[1])+p[0]&&(o=!o)}var u,p,g;return o}function $u(i,e){for(const n of e)if(Ya(i,n))return!0;return!1}function Af(i,e){for(const n of i)if(!Ya(n,e))return!1;for(let n=0;n<i.length-1;++n)if(Mf(i[n],i[n+1],e))return!1;return!0}function Cf(i,e){for(const n of e)if(Af(i,n))return!0;return!1}function Xu(i,e,n,o){const u=o[0]-n[0],p=o[1]-n[1],g=(i[0]-n[0])*p-u*(i[1]-n[1]),x=(e[0]-n[0])*p-u*(e[1]-n[1]);return g>0&&x<0||g<0&&x>0}function Yu(i,e,n){const o=[];for(let u=0;u<i.length;u++){const p=[];for(let g=0;g<i[u].length;g++){const x=$l(i[u][g],n);Yl(e,x),p.push(x)}o.push(p)}return o}function tl(i,e,n){const o=[];for(let u=0;u<i.length;u++){const p=Yu(i[u],e,n);o.push(p)}return o}function Wl(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const u=.5*o;let p=i[0]-n[0]>u?-o:n[0]-i[0]>u?o:0;p===0&&(p=i[0]-n[2]>u?-o:n[2]-i[0]>u?o:0),i[0]+=p}Yl(e,i)}function zf(i,e,n,o){const u=Math.pow(2,o.z)*Fi,p=[o.x*Fi,o.y*Fi],g=[];for(const x of i)for(const T of x){const C=[T.x+p[0],T.y+p[1]];Wl(C,e,n,u),g.push(C)}return g}function Hc(i,e,n,o){const u=Math.pow(2,o.z)*Fi,p=[o.x*Fi,o.y*Fi],g=[];for(const T of i){const C=[];for(const I of T){const L=[I.x+p[0],I.y+p[1]];Yl(e,L),C.push(L)}g.push(C)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of g)for(const C of T)Wl(C,e,n,u)}var x;return g}class bo{constructor(e,n){this.type=rn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gs(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const p of o.features){const{type:g,coordinates:x}=p.geometry;g==="Polygon"&&u.push(x),g==="MultiPolygon"&&u.push(...x)}if(u.length)return new bo(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new bo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new bo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=Yu(o.coordinates,p,g),T=zf(n.geometry(),u,p,g);if(!xo(u,p))return!1;for(const C of T)if(!Ya(C,x))return!1}if(o.type==="MultiPolygon"){const x=tl(o.coordinates,p,g),T=zf(n.geometry(),u,p,g);if(!xo(u,p))return!1;for(const C of T)if(!$u(C,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=Yu(o.coordinates,p,g),T=Hc(n.geometry(),u,p,g);if(!xo(u,p))return!1;for(const C of T)if(!Af(C,x))return!1}if(o.type==="MultiPolygon"){const x=tl(o.coordinates,p,g),T=Hc(n.geometry(),u,p,g);if(!xo(u,p))return!1;for(const C of T)if(!Cf(C,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let nd=class{constructor(i=[],e=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,o=e[i];for(;i>0;){const u=i-1>>1,p=e[u];if(n(o,p)>=0)break;e[i]=p,i=u}e[i]=o}_down(i){const{data:e,compare:n}=this,o=this.length>>1,u=e[i];for(;i<o;){let p=1+(i<<1);const g=p+1;if(g<this.length&&n(e[g],e[p])<0&&(p=g),n(e[p],u)>=0)break;e[i]=e[p],i=p}e[i]=u}};function $c(i,e,n=0,o=i.length-1,u=id){for(;o>n;){if(o-n>600){const T=o-n+1,C=e-n+1,I=Math.log(T),L=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*L*(T-L)/T)*(C-T/2<0?-1:1);$c(i,e,Math.max(n,Math.floor(e-C*L/T+B)),Math.min(o,Math.floor(e+(T-C)*L/T+B)),u)}const p=i[e];let g=n,x=o;for(wo(i,n,e),u(i[o],p)>0&&wo(i,n,o);g<x;){for(wo(i,g,x),g++,x--;u(i[g],p)<0;)g++;for(;u(i[x],p)>0;)x--}u(i[n],p)===0?wo(i,n,x):(x++,wo(i,x,o)),x<=e&&(n=x+1),e<=x&&(o=x-1)}}function wo(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function id(i,e){return i<e?-1:i>e?1:0}function Xc(i,e){if(i.length<=1)return[i];const n=[];let o,u;for(const p of i){const g=Jp(p);g!==0&&(p.area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(o&&n.push(o),o=[p]):o.push(p))}if(o&&n.push(o),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||($c(n[p],e,1,n[p].length-1,Df),n[p]=n[p].slice(0,e));return n}function Df(i,e){return e.area-i.area}function Jp(i){let e=0;for(let n,o,u=0,p=i.length,g=p-1;u<p;g=u++)n=i[u],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}const Pf=1/298.257223563,Yc=Pf*(2-Pf),If=Math.PI/180;class rd{constructor(e){const n=6378.137*If*1e3,o=Math.cos(e*If),u=1/(1-Yc*(1-o*o)),p=Math.sqrt(u);this.kx=n*p*o,this.ky=n*p*u*(1-Yc)}distance(e,n){const o=this.wrap(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,n){let o,u,p,g,x=1/0;for(let T=0;T<e.length-1;T++){let C=e[T][0],I=e[T][1],L=this.wrap(e[T+1][0]-C)*this.kx,B=(e[T+1][1]-I)*this.ky,F=0;L===0&&B===0||(F=(this.wrap(n[0]-C)*this.kx*L+(n[1]-I)*this.ky*B)/(L*L+B*B),F>1?(C=e[T+1][0],I=e[T+1][1]):F>0&&(C+=L/this.kx*F,I+=B/this.ky*F)),L=this.wrap(n[0]-C)*this.kx,B=(n[1]-I)*this.ky;const q=L*L+B*B;q<x&&(x=q,o=C,u=I,p=T,g=F)}return{point:[o,u],index:p,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Zr(i,e){return e[0]-i[0]}function To(i){return i[1]-i[0]+1}function Ca(i,e){return i[1]>=i[0]&&i[1]<e}function Wc(i,e){if(i[0]>i[1])return[null,null];const n=To(i);if(e){if(n===2)return[i,null];const u=Math.floor(n/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function Wu(i,e){if(!Ca(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Yl(n,i[o]);return n}function Ku(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)Yl(e,o);return e}function Kc(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Qu(i,e,n){if(!Kc(i)||!Kc(e))return NaN;let o=0,u=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(u=i[1]-e[3]),i[3]<e[1]&&(u=e[1]-i[3]),n.distance([0,0],[o,u])}function za(i,e,n){const o=n.pointOnLine(e,i);return n.distance(i,o.point)}function Qc(i,e,n,o,u){const p=Math.min(za(i,[n,o],u),za(e,[n,o],u)),g=Math.min(za(n,[i,e],u),za(o,[i,e],u));return Math.min(p,g)}function Jc(i,e,n,o,u){if(!Ca(e,i.length)||!Ca(o,n.length))return 1/0;let p=1/0;for(let g=e[0];g<e[1];++g){const x=i[g],T=i[g+1];for(let C=o[0];C<o[1];++C){const I=n[C],L=n[C+1];if(Zc(x,T,I,L))return 0;p=Math.min(p,Qc(x,T,I,L,u))}}return p}function Ju(i,e,n,o,u){if(!Ca(e,i.length)||!Ca(o,n.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let x=o[0];x<=o[1];++x)if(p=Math.min(p,u.distance(i[g],n[x])),p===0)return p;return p}function kf(i,e,n){if(Ya(i,e,!0))return 0;let o=1/0;for(const u of e){const p=u[0],g=u[u.length-1];if(p!==g&&(o=Math.min(o,za(i,[g,p],n)),o===0))return o;const x=n.pointOnLine(u,i);if(o=Math.min(o,n.distance(i,x.point)),o===0)return o}return o}function nl(i,e,n,o){if(!Ca(e,i.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Ya(i[p],n,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p){const g=i[p],x=i[p+1];for(const T of n)for(let C=0,I=T.length,L=I-1;C<I;L=C++){const B=T[L],F=T[C];if(Zc(g,x,B,F))return 0;u=Math.min(u,Qc(g,x,B,F,o))}}return u}function il(i,e){for(const n of i)for(const o of n)if(Ya(o,e,!0))return!0;return!1}function ad(i,e,n,o=1/0){const u=Ku(i),p=Ku(e);if(o!==1/0&&Qu(u,p,n)>=o)return o;if(xo(u,p)){if(il(i,e))return 0}else if(il(e,i))return 0;let g=1/0;for(const x of i)for(let T=0,C=x.length,I=C-1;T<C;I=T++){const L=x[I],B=x[T];for(const F of e)for(let q=0,G=F.length,Y=G-1;q<G;Y=q++){const J=F[Y],he=F[q];if(Zc(L,B,J,he))return 0;g=Math.min(g,Qc(L,B,J,he,n))}}return g}function Rn(i,e,n,o,u,p){if(!p)return;const g=Qu(Wu(o,p),u,n);g<e&&i.push([g,p,[0,0]])}function _s(i,e,n,o,u,p,g){if(!p||!g)return;const x=Qu(Wu(o,p),Wu(u,g),n);x<e&&i.push([x,p,g])}function eu(i,e,n,o,u=1/0){let p=Math.min(o.distance(i[0],n[0][0]),u);if(p===0)return p;const g=new nd([[0,[0,i.length-1],[0,0]]],Zr),x=Ku(n);for(;g.length>0;){const T=g.pop();if(T[0]>=p)continue;const C=T[1],I=e?50:100;if(To(C)<=I){if(!Ca(C,i.length))return NaN;if(e){const L=nl(i,C,n,o);if(isNaN(L)||L===0)return L;p=Math.min(p,L)}else for(let L=C[0];L<=C[1];++L){const B=kf(i[L],n,o);if(p=Math.min(p,B),p===0)return 0}}else{const L=Wc(C,e);Rn(g,p,o,i,x,L[0]),Rn(g,p,o,i,x,L[1])}}return p}function tu(i,e,n,o,u,p=1/0){let g=Math.min(p,u.distance(i[0],n[0]));if(g===0)return g;const x=new nd([[0,[0,i.length-1],[0,n.length-1]]],Zr);for(;x.length>0;){const T=x.pop();if(T[0]>=g)continue;const C=T[1],I=T[2],L=e?50:100,B=o?50:100;if(To(C)<=L&&To(I)<=B){if(!Ca(C,i.length)&&Ca(I,n.length))return NaN;let F;if(e&&o)F=Jc(i,C,n,I,u),g=Math.min(g,F);else if(e&&!o){const q=i.slice(C[0],C[1]+1);for(let G=I[0];G<=I[1];++G)if(F=za(n[G],q,u),g=Math.min(g,F),g===0)return g}else if(!e&&o){const q=n.slice(I[0],I[1]+1);for(let G=C[0];G<=C[1];++G)if(F=za(i[G],q,u),g=Math.min(g,F),g===0)return g}else F=Ju(i,C,n,I,u),g=Math.min(g,F)}else{const F=Wc(C,e),q=Wc(I,o);_s(x,g,u,i,n,F[0],q[0]),_s(x,g,u,i,n,F[0],q[1]),_s(x,g,u,i,n,F[1],q[0]),_s(x,g,u,i,n,F[1],q[1])}}return g}function eh(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class rl{constructor(e,n){this.type=ft,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gs(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new rl(o,o.features.map((u=>eh(u.geometry))).flat());if(o.type==="Feature")return new rl(o,eh(o.geometry));if("type"in o&&"coordinates"in o)return new rl(o,eh(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,o){const u=n.geometry(),p=u.flat().map((T=>Xl([T.x,T.y],n.canonical)));if(u.length===0)return NaN;const g=new rd(p[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,tu(p,!1,[T.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,tu(p,!1,T.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,eu(p,!1,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,o){const u=n.geometry(),p=u.flat().map((T=>Xl([T.x,T.y],n.canonical)));if(u.length===0)return NaN;const g=new rd(p[0][1]);let x=1/0;for(const T of o){switch(T.type){case"Point":x=Math.min(x,tu(p,!0,[T.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,tu(p,!0,T.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,eu(p,!0,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const p=Xc(u,0).map((T=>T.map((C=>C.map((I=>Xl([I.x,I.y],n.canonical))))))),g=new rd(p[0][0][0][1]);let x=1/0;for(const T of o)for(const C of p){switch(T.type){case"Point":x=Math.min(x,eu([T.coordinates],!1,C,g,x));break;case"LineString":x=Math.min(x,eu(T.coordinates,!0,C,g,x));break;case"Polygon":x=Math.min(x,ad(C,T.coordinates,g,x))}if(x===0)return x}return x})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class nu{constructor(e){this.type=sn,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new nu(o)}evaluate(e){var n;const o=(n=e.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?Ul(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Kl={"==":Tf,"!=":Zu,">":Qp,"<":Sf,">=":Hu,"<=":ql,array:Nr,at:gn,boolean:Nr,case:jc,coalesce:el,collator:Gl,format:Gc,image:Zl,in:on,"index-of":Jo,interpolate:jr,"interpolate-hcl":jr,"interpolate-lab":jr,length:Hl,let:Hn,literal:la,match:En,number:Nr,"number-format":td,object:Nr,slice:Aa,step:vo,string:Nr,"to-boolean":Fr,"to-color":Fr,"to-number":Fr,"to-string":Fr,var:yo,within:bo,distance:rl,"global-state":nu};class ca{constructor(e,n,o,u){this.name=e,this.type=n,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],u=ca.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=g.filter((([C])=>!Array.isArray(C)||C.length===e.length-1));let T=null;for(const[C,I]of x){T=new Qo(n.registry,Ur,n.path,null,n.scope);const L=[];let B=!1;for(let F=1;F<e.length;F++){const q=e[F],G=Array.isArray(C)?C[F-1]:C.type,Y=T.parse(q,1+L.length,G);if(!Y){B=!0;break}L.push(Y)}if(!B)if(Array.isArray(C)&&C.length!==L.length)T.error(`Expected ${C.length} arguments, but found ${L.length} instead.`);else{for(let F=0;F<L.length;F++){const q=Array.isArray(C)?C[F]:C.type,G=L[F];T.concat(F+1).checkSubtype(q,G.type)}if(T.errors.length===0)return new ca(o,p,I,L)}}if(x.length===1)n.errors.push(...T.errors);else{const C=(x.length?x:g).map((([L])=>{return B=L,Array.isArray(B)?`(${B.map(Sn).join(", ")})`:`(${Sn(B.type)}...)`;var B})).join(" | "),I=[];for(let L=1;L<e.length;L++){const B=n.parse(e[L],1+I.length);if(!B)return null;I.push(Sn(B.type))}n.error(`Expected arguments of type ${C}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){ca.definitions=n;for(const o in n)e[o]=ca}}function sd(i,[e,n,o,u]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const p=u?u.evaluate(i):1,g=oa(e,n,o,p);if(g)throw new Qn(g);return new un(e/255,n/255,o/255,p,!1)}function th(i,e){return i in e}function ua(i,e){const n=e[i];return n===void 0?null:n}function vs(i){return{type:i}}function Ur(i){if(i instanceof yo)return Ur(i.boundExpression);if(i instanceof ca&&i.name==="error"||i instanceof Gl||i instanceof bo||i instanceof rl||i instanceof nu)return!1;const e=i instanceof Fr||i instanceof Nr;let n=!0;return i.eachChild((o=>{n=e?n&&Ur(o):n&&o instanceof la})),!!n&&Gs(i)&&sl(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Gs(i){if(i instanceof ca&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof bo||i instanceof rl)return!1;let e=!0;return i.eachChild((n=>{e&&!Gs(n)&&(e=!1)})),e}function al(i){if(i instanceof ca&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!al(n)&&(e=!1)})),e}function sl(i,e){if(i instanceof ca&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((o=>{n&&!sl(o,e)&&(n=!1)})),n}function iu(i){return{result:"success",value:i}}function So(i){return{result:"error",value:i}}function Da(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function od(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ql(i){return!!i.expression&&i.expression.interpolated}function cn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function nh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&pi(i)===hs}function ha(i){return i}function ih(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",o=n||!(n||i.property!==void 0),u=i.type||(Ql(e)?"exponential":"interval"),p=(function(I){switch(I.type){case"color":return un.parse;case"padding":return Zi.parse;case"numberArray":return fi.parse;case"colorArray":return Qt.parse;default:return null}})(e);if(p&&((i=Ut({},i)).stops&&(i.stops=i.stops.map((I=>[I[0],p(I[1])]))),i.default=p(i.default?i.default:e.default)),i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;const x=(function(I){switch(I){case"exponential":return Eo;case"interval":return rh;case"categorical":return Rf;case"identity":return ld;default:throw new Error(`Unknown function type "${I}"`)}})(u);let T,C;if(u==="categorical"){T=Object.create(null);for(const I of i.stops)T[I[0]]=I[1];C=typeof i.stops[0][0]}if(n){const I={},L=[];for(let q=0;q<i.stops.length;q++){const G=i.stops[q],Y=G[0].zoom;I[Y]===void 0&&(I[Y]={zoom:Y,type:i.type,property:i.property,default:i.default,stops:[]},L.push(Y)),I[Y].stops.push([G[0].value,G[1]])}const B=[];for(const q of L)B.push([I[q].zoom,ih(I[q],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:jr.interpolationFactor.bind(void 0,F),zoomStops:B.map((q=>q[0])),evaluate:({zoom:q},G)=>Eo({stops:B,base:i.base},e,q).evaluate(q,G)}}if(o){const I=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:jr.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map((L=>L[0])),evaluate:({zoom:L})=>x(i,e,L,T,C)}}return{kind:"source",evaluate(I,L){const B=L&&L.properties?L.properties[i.property]:void 0;return B===void 0?da(i.default,e.default):x(i,e,B,T,C)}}}function da(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Rf(i,e,n,o,u){return da(typeof n===u?o[n]:void 0,i.default,e.default)}function rh(i,e,n){if(cn(n)!=="number")return da(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const u=_o(i.stops.map((p=>p[0])),n);return i.stops[u][1]}function Eo(i,e,n){const o=i.base!==void 0?i.base:1;if(cn(n)!=="number")return da(i.default,e.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const p=_o(i.stops.map((I=>I[0])),n),g=(function(I,L,B,F){const q=F-B,G=I-B;return q===0?0:L===1?G/q:(Math.pow(L,G)-1)/(Math.pow(L,q)-1)})(n,o,i.stops[p][0],i.stops[p+1][0]),x=i.stops[p][1],T=i.stops[p+1][1],C=mi[e.type]||ha;return typeof x.evaluate=="function"?{evaluate(...I){const L=x.evaluate.apply(void 0,I),B=T.evaluate.apply(void 0,I);if(L!==void 0&&B!==void 0)return C(L,B,g,i.colorSpace)}}:C(x,T,g,i.colorSpace)}function ld(i,e,n){switch(e.type){case"color":n=un.parse(n);break;case"formatted":n=ir.fromString(n.toString());break;case"resolvedImage":n=Br.fromString(n.toString());break;case"padding":n=Zi.parse(n);break;case"colorArray":n=Qt.parse(n);break;case"numberArray":n=fi.parse(n);break;default:cn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return da(n,i.default,e.default)}ca.register(Kl,{error:[{kind:"error"},[Jt],(i,[e])=>{throw new Qn(e.evaluate(i))}],typeof:[Jt,[sn],(i,[e])=>Sn(pi(e.evaluate(i)))],"to-rgba":[Cr(ft,4),[sa],(i,[e])=>{const[n,o,u,p]=e.evaluate(i).rgb;return[255*n,255*o,255*u,p]}],rgb:[sa,[ft,ft,ft],sd],rgba:[sa,[ft,ft,ft,ft],sd],has:{type:rn,overloads:[[[Jt],(i,[e])=>th(e.evaluate(i),i.properties())],[[Jt,hs],(i,[e,n])=>th(e.evaluate(i),n.evaluate(i))]]},get:{type:sn,overloads:[[[Jt],(i,[e])=>ua(e.evaluate(i),i.properties())],[[Jt,hs],(i,[e,n])=>ua(e.evaluate(i),n.evaluate(i))]]},"feature-state":[sn,[Jt],(i,[e])=>ua(e.evaluate(i),i.featureState||{})],properties:[hs,[],i=>i.properties()],"geometry-type":[Jt,[],i=>i.geometryType()],id:[sn,[],i=>i.id()],zoom:[ft,[],i=>i.globals.zoom],"heatmap-density":[ft,[],i=>i.globals.heatmapDensity||0],elevation:[ft,[],i=>i.globals.elevation||0],"line-progress":[ft,[],i=>i.globals.lineProgress||0],accumulated:[sn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ft,vs(ft),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[ft,vs(ft),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:ft,overloads:[[[ft,ft],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[ft],(i,[e])=>-e.evaluate(i)]]},"/":[ft,[ft,ft],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[ft,[ft,ft],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[ft,[ft],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[ft,[ft],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[ft,[ft],(i,[e])=>Math.log(e.evaluate(i))],log2:[ft,[ft],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[ft,[ft],(i,[e])=>Math.sin(e.evaluate(i))],cos:[ft,[ft],(i,[e])=>Math.cos(e.evaluate(i))],tan:[ft,[ft],(i,[e])=>Math.tan(e.evaluate(i))],asin:[ft,[ft],(i,[e])=>Math.asin(e.evaluate(i))],acos:[ft,[ft],(i,[e])=>Math.acos(e.evaluate(i))],atan:[ft,[ft],(i,[e])=>Math.atan(e.evaluate(i))],min:[ft,vs(ft),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[ft,vs(ft),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[ft,[ft],(i,[e])=>Math.abs(e.evaluate(i))],round:[ft,[ft],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[ft,[ft],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[ft,[ft],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[rn,[Jt,sn],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[rn,[sn],(i,[e])=>i.id()===e.value],"filter-type-==":[rn,[Jt],(i,[e])=>i.geometryType()===e.value],"filter-<":[rn,[Jt,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[rn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[rn,[Jt,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[rn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[rn,[Jt,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[rn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[rn,[Jt,sn],(i,[e,n])=>{const o=i.properties()[e.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[rn,[sn],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[rn,[sn],(i,[e])=>e.value in i.properties()],"filter-has-id":[rn,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[rn,[Cr(Jt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[rn,[Cr(sn)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[rn,[Jt,Cr(sn)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[rn,[Jt,Cr(sn)],(i,[e,n])=>(function(o,u,p,g){for(;p<=g;){const x=p+g>>1;if(u[x]===o)return!0;u[x]>o?g=x-1:p=x+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:rn,overloads:[[[rn,rn],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[vs(rn),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:rn,overloads:[[[rn,rn],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[vs(rn),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[rn,[rn],(i,[e])=>!e.evaluate(i)],"is-supported-script":[rn,[Jt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Jt,[Jt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Jt,[Jt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Jt,vs(sn),(i,e)=>e.map((n=>go(n.evaluate(i)))).join("")],"resolved-locale":[Jt,[Ho],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ah{constructor(e,n,o){this.expression=e,this._warningHistory={},this._evaluator=new Ko,this._defaultValue=n?(function(u){if(u.type==="color"&&nh(u.default))return new un(0,0,0,0);switch(u.type){case"color":return un.parse(u.default)||null;case"padding":return Zi.parse(u.default)||null;case"numberArray":return fi.parse(u.default)||null;case"colorArray":return Qt.parse(u.default)||null;case"variableAnchorOffsetCollection":return zi.parse(u.default)||null;case"projectionDefinition":return rr.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=cr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,u,p,g){this._globalState&&(e=cr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Qn(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Mo(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Kl}function Jl(i,e,n){const o=new Qo(Kl,Ur,[],e?(function(p){const g={color:sa,string:Jt,number:ft,enum:Jt,boolean:rn,formatted:ds,padding:Us,numberArray:ps,colorArray:fs,projectionDefinition:Vu,resolvedImage:Ci,variableAnchorOffsetCollection:Nl};return p.type==="array"?Cr(g[p.value]||sn,p.length):g[p.type]})(e):void 0),u=o.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?iu(new ah(u,e,n)):So(o.errors)}class Vr{constructor(e,n,o){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!al(n.expression),this.globalStateRefs=ar(n.expression),this._globalState=o}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=cr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,p,g)}evaluate(e,n,o,u,p,g){return this._globalState&&(e=cr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,u,p,g)}}class Ao{constructor(e,n,o,u,p){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!al(n.expression),this.globalStateRefs=ar(n.expression),this.interpolationType=u,this._globalState=p}evaluateWithoutErrorHandling(e,n,o,u,p,g){return this._globalState&&(e=cr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,o,u,p,g)}evaluate(e,n,o,u,p,g){return this._globalState&&(e=cr(e,this._globalState)),this._styleExpression.evaluate(e,n,o,u,p,g)}interpolationFactor(e,n,o){return this.interpolationType?jr.interpolationFactor(this.interpolationType,e,n,o):0}}function Co(i,e,n){const o=Jl(i,e,n);if(o.result==="error")return o;const u=o.value.expression,p=Gs(u);if(!p&&!Da(e))return So([new ln("","data expressions not supported")]);const g=sl(u,["zoom"]);if(!g&&!od(e))return So([new ln("","zoom expressions not supported")]);const x=zo(u);return x||g?x instanceof ln?So([x]):x instanceof jr&&!Ql(e)?So([new ln("",'"interpolate" expressions cannot be used with this property')]):iu(x?new Ao(p?"camera":"composite",o.value,x.labels,x instanceof jr?x.interpolation:void 0,n):new Vr(p?"constant":"source",o.value,n)):So([new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ol{constructor(e,n){this._parameters=e,this._specification=n,Ut(this,ih(this._parameters,this._specification))}static deserialize(e){return new ol(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zo(i){let e=null;if(i instanceof Hn)e=zo(i.result);else if(i instanceof el){for(const n of i.args)if(e=zo(n),e)break}else(i instanceof vo||i instanceof jr)&&i.input instanceof ca&&i.input.name==="zoom"&&(e=i);return e instanceof ln||i.eachChild((n=>{const o=zo(n);o instanceof ln?e=o:!e&&o?e=new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function ar(i,e=new Set){return i instanceof nu&&e.add(i.key),i.eachChild((n=>{ar(n,e)})),e}function cr(i,e){const{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:g,accumulated:x}=i??{};return{zoom:n,heatmapDensity:o,elevation:u,lineProgress:p,isSupportedScript:g,accumulated:x,globalState:e}}function xs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!xs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const bs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hr(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};xs(i)||(i=ll(i));const n=Jl(i,bs,e);if(n.result==="error")throw new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,p)=>n.value.evaluate(o,u,{},p),needGeometry:cd(i),getGlobalStateRefs:()=>ar(n.value.expression)}}function Zs(i,e){return i<e?-1:i>e?1:0}function cd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(cd(i[e]))return!0;return!1}function ll(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ec(i[1],i[2],"=="):e==="!="?Jn(ec(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ec(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(ll))):e==="all"?["all"].concat(i.slice(1).map(ll)):e==="none"?["all"].concat(i.slice(1).map(ll).map(Jn)):e==="in"?ud(i[1],i.slice(2)):e==="!in"?Jn(ud(i[1],i.slice(2))):e==="has"?ur(i[1]):e!=="!has"||Jn(ur(i[1]));var n}function ec(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function ud(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Zs)]]:["filter-in-small",i,["literal",e]]}}function ur(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Jn(i){return["!",i]}function bn(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const p of i)u+=`${bn(p)},`;return`${u}]`}const n=Object.keys(i).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${bn(i[n[u]])},`;return`${o}}`}function Hs(i){let e="";for(const n of Pn)e+=`/${bn(i[n])}`;return e}function fa(i){const e=i.value;return e?[new Be(i.key,e,"constants have been deprecated as of v8")]:[]}function bi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function $r(i){if(Array.isArray(i))return i.map($r);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=$r(i[n]);return e}return bi(i)}function Xr(i){const e=i.key,n=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,g=i.styleSpec,x=i.validateSpec;let T=[];const C=cn(n);if(C!=="object")return[new Be(e,n,`object expected, ${C} found`)];for(const I in n){const L=I.split(".")[0],B=Ul(o,L)||o["*"];let F;if(Ul(u,L))F=u[L];else if(Ul(o,L)){if(n[I]===void 0)continue;F=x}else if(u["*"])F=u["*"];else{if(!o["*"]){T.push(new Be(e,n[I],`unknown property "${I}"`));continue}F=x}T=T.concat(F({key:(e&&`${e}.`)+I,value:n[I],valueSpec:B,style:p,styleSpec:g,object:n,objectKey:I,validateSpec:x},n))}for(const I in o)u[I]||o[I].required&&o[I].default===void 0&&n[I]===void 0&&T.push(new Be(e,n,`missing required property "${I}"`));return T}function ru(i){const e=i.value,n=i.valueSpec,o=i.style,u=i.styleSpec,p=i.key,g=i.arrayElementValidator||i.validateSpec;if(cn(e)!=="array")return[new Be(p,e,`array expected, ${cn(e)} found`)];if(n.length&&e.length!==n.length)return[new Be(p,e,`array length ${n.length} expected, length ${e.length} found`)];let x={type:n.value,values:n.values};u.$version<7&&(x.function=n.function),cn(n.value)==="object"&&(x=n.value);let T=[];for(let C=0;C<e.length;C++)T=T.concat(g({array:e,arrayIndex:C,value:e[C],valueSpec:x,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${p}[${C}]`}));return T}function ws(i){const e=i.key,n=i.value,o=i.valueSpec;let u=cn(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Be(e,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Be(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Be(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Ts(i){const e=i.valueSpec,n=bi(i.value.type);let o,u,p,g={};const x=n!=="categorical"&&i.value.property===void 0,T=!x,C=cn(i.value.stops)==="array"&&cn(i.value.stops[0])==="array"&&cn(i.value.stops[0][0])==="object",I=Xr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new Be(F.key,F.value,'identity function may not have a "stops" property')];let q=[];const G=F.value;return q=q.concat(ru({key:F.key,value:G,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:L})),cn(G)==="array"&&G.length===0&&q.push(new Be(F.key,G,"array must have at least one stop")),q},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&x&&I.push(new Be(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||I.push(new Be(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Ql(i.valueSpec)&&I.push(new Be(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Da(i.valueSpec)?I.push(new Be(i.key,i.value,"property functions not supported")):x&&!od(i.valueSpec)&&I.push(new Be(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!C||i.value.property!==void 0||I.push(new Be(i.key,i.value,'"property" property is required')),I;function L(F){let q=[];const G=F.value,Y=F.key;if(cn(G)!=="array")return[new Be(Y,G,`array expected, ${cn(G)} found`)];if(G.length!==2)return[new Be(Y,G,`array length 2 expected, length ${G.length} found`)];if(C){if(cn(G[0])!=="object")return[new Be(Y,G,`object expected, ${cn(G[0])} found`)];if(G[0].zoom===void 0)return[new Be(Y,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Be(Y,G,"object stop key must have value")];if(p&&p>bi(G[0].zoom))return[new Be(Y,G[0].zoom,"stop zoom values must appear in ascending order")];bi(G[0].zoom)!==p&&(p=bi(G[0].zoom),u=void 0,g={}),q=q.concat(Xr({key:`${Y}[0]`,value:G[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:ws,value:B}}))}else q=q.concat(B({key:`${Y}[0]`,value:G[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},G));return Mo($r(G[1]))?q.concat([new Be(`${Y}[1]`,G[1],"expressions are not allowed in function stops.")]):q.concat(F.validateSpec({key:`${Y}[1]`,value:G[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function B(F,q){const G=cn(F.value),Y=bi(F.value),J=F.value!==null?F.value:q;if(o){if(G!==o)return[new Be(F.key,J,`${G} stop domain type must match previous stop domain type ${o}`)]}else o=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new Be(F.key,J,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&n!=="categorical"){let he=`number expected, ${G} found`;return Da(e)&&n===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(F.key,J,he)]}return n!=="categorical"||G!=="number"||isFinite(Y)&&Math.floor(Y)===Y?n!=="categorical"&&G==="number"&&u!==void 0&&Y<u?[new Be(F.key,J,"stop domain values must appear in ascending order")]:(u=Y,n==="categorical"&&Y in g?[new Be(F.key,J,"stop domain values must be unique")]:(g[Y]=!0,[])):[new Be(F.key,J,`integer expected, found ${Y}`)]}}function Ss(i){const e=(i.expressionContext==="property"?Co:Jl)($r(i.value),i.valueSpec);if(e.result==="error")return e.value.map((o=>new Be(`${i.key}${o.key}`,i.value,o.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Be(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!al(n))return[new Be(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!al(n))return[new Be(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!sl(n,["zoom","feature-state"]))return[new Be(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Gs(n))return[new Be(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $s(i){const e=i.key,n=i.value,o=cn(n);return o!=="string"?[new Be(e,n,`color expected, ${o} found`)]:un.parse(String(n))?[]:[new Be(e,n,`color expected, "${n}" found`)]}function Xs(i){const e=i.key,n=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(bi(n))===-1&&u.push(new Be(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(bi(n))===-1&&u.push(new Be(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Pa(i){return xs($r(i.value))?Ss(Ut({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Es(i)}function Es(i){const e=i.value,n=i.key;if(cn(e)!=="array")return[new Be(n,e,`array expected, ${cn(e)} found`)];const o=i.styleSpec;let u,p=[];if(e.length<1)return[new Be(n,e,"filter array must have at least 1 element")];switch(p=p.concat(Xs({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),bi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&bi(e[1])==="$type"&&p.push(new Be(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new Be(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=cn(e[1]),u!=="string"&&p.push(new Be(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=cn(e[g]),bi(e[1])==="$type"?p=p.concat(Xs({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new Be(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Es({key:`${n}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=cn(e[1]),e.length!==2?p.push(new Be(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new Be(`${n}[1]`,e[1],`string expected, ${u} found`))}return p}function Ys(i,e){const n=i.key,o=i.validateSpec,u=i.style,p=i.styleSpec,g=i.value,x=i.objectKey,T=p[`${e}_${i.layerType}`];if(!T)return[];const C=x.match(/^(.*)-transition$/);if(e==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return o({key:n,value:g,valueSpec:p.transition,style:u,styleSpec:p});const I=i.valueSpec||T[x];if(!I)return[new Be(n,g,`unknown property "${x}"`)];let L;if(cn(g)==="string"&&Da(I)&&!I.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new Be(n,g,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const B=[];return i.layerType==="symbol"&&x==="text-font"&&nh($r(g))&&bi(g.type)==="identity"&&B.push(new Be(n,g,'"text-font" does not support identity functions')),B.concat(o({key:i.key,value:g,valueSpec:I,style:u,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:x}))}function Ms(i){return Ys(i,"paint")}function sh(i){return Ys(i,"layout")}function oh(i){let e=[];const n=i.value,o=i.key,u=i.style,p=i.styleSpec;if(cn(n)!=="object")return[new Be(o,n,`object expected, ${cn(n)} found`)];n.type||n.ref||e.push(new Be(o,n,'either "type" or "ref" is required'));let g=bi(n.type);const x=bi(n.ref);if(n.id){const T=bi(n.id);for(let C=0;C<i.arrayIndex;C++){const I=u.layers[C];bi(I.id)===T&&e.push(new Be(o,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach((C=>{C in n&&e.push(new Be(o,n[C],`"${C}" is prohibited for ref layers`))})),u.layers.forEach((C=>{bi(C.id)===x&&(T=C)})),T?T.ref?e.push(new Be(o,n.ref,"ref cannot reference another ref layer")):g=bi(T.type):e.push(new Be(o,n.ref,`ref layer "${x}" not found`))}else if(g!=="background")if(n.source){const T=u.sources&&u.sources[n.source],C=T&&bi(T.type);T?C==="vector"&&g==="raster"?e.push(new Be(o,n.source,`layer "${n.id}" requires a raster source`)):C!=="raster-dem"&&g==="hillshade"||C!=="raster-dem"&&g==="color-relief"?e.push(new Be(o,n.source,`layer "${n.id}" requires a raster-dem source`)):C==="raster"&&g!=="raster"?e.push(new Be(o,n.source,`layer "${n.id}" requires a vector source`)):C!=="vector"||n["source-layer"]?C==="raster-dem"&&g!=="hillshade"&&g!=="color-relief"?e.push(new Be(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||C==="geojson"&&T.lineMetrics||e.push(new Be(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Be(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Be(o,n.source,`source "${n.source}" not found`))}else e.push(new Be(o,n,'missing required property "source"'));return e=e.concat(Xr({key:o,value:n,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Pa,layout:T=>Xr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>sh(Ut({layerType:g},C))}}),paint:T=>Xr({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":C=>Ms(Ut({layerType:g},C))}})}})),e}function pa(i){const e=i.value,n=i.key,o=cn(e);return o!=="string"?[new Be(n,e,`string expected, ${o} found`)]:[]}const tc={promoteId:function({key:i,value:e}){if(cn(e)==="string")return pa({key:i,value:e});{const n=[];for(const o in e)n.push(...pa({key:`${i}.${o}`,value:e[o]}));return n}}};function Ws(i){const e=i.value,n=i.key,o=i.styleSpec,u=i.style,p=i.validateSpec;if(!e.type)return[new Be(n,e,'"type" is required')];const g=bi(e.type);let x;switch(g){case"vector":case"raster":return x=Xr({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:tc,validateSpec:p}),x;case"raster-dem":return x=(function(T){var C;const I=(C=T.sourceName)!==null&&C!==void 0?C:"",L=T.value,B=T.styleSpec,F=B.source_raster_dem,q=T.style;let G=[];const Y=cn(L);if(L===void 0)return G;if(Y!=="object")return G.push(new Be("source_raster_dem",L,`object expected, ${Y} found`)),G;const J=bi(L.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],ee=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ie in L)!J&&he.includes(ie)?G.push(new Be(ie,L[ie],`In "${I}": "${ie}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):F[ie]?G=G.concat(T.validateSpec({key:ie,value:L[ie],valueSpec:F[ie],validateSpec:T.validateSpec,style:q,styleSpec:B})):G.push(new Be(ie,L[ie],`unknown property "${ie}"`));return G})({sourceName:n,value:e,style:i.style,styleSpec:o,validateSpec:p}),x;case"geojson":if(x=Xr({key:n,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:p,objectElementValidators:tc}),e.cluster)for(const T in e.clusterProperties){const[C,I]=e.clusterProperties[T],L=typeof C=="string"?[C,["accumulated"],["get",T]]:C;x.push(...Ss({key:`${n}.${T}.map`,value:I,expressionContext:"cluster-map"})),x.push(...Ss({key:`${n}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return Xr({key:n,value:e,valueSpec:o.source_video,style:u,validateSpec:p,styleSpec:o});case"image":return Xr({key:n,value:e,valueSpec:o.source_image,style:u,validateSpec:p,styleSpec:o});case"canvas":return[new Be(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xs({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Hi(i){const e=i.value,n=i.styleSpec,o=n.light,u=i.style;let p=[];const g=cn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new Be("light",e,`object expected, ${g} found`)]),p;for(const x in e){const T=x.match(/^(.*)-transition$/);p=p.concat(T&&o[T[1]]&&o[T[1]].transition?i.validateSpec({key:x,value:e[x],valueSpec:n.transition,validateSpec:i.validateSpec,style:u,styleSpec:n}):o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new Be(x,e[x],`unknown property "${x}"`)])}return p}function au(i){const e=i.value,n=i.styleSpec,o=n.sky,u=i.style,p=cn(e);if(e===void 0)return[];if(p!=="object")return[new Be("sky",e,`object expected, ${p} found`)];let g=[];for(const x in e)g=g.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],style:u,styleSpec:n}):[new Be(x,e[x],`unknown property "${x}"`)]);return g}function lh(i){const e=i.value,n=i.styleSpec,o=n.terrain,u=i.style;let p=[];const g=cn(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new Be("terrain",e,`object expected, ${g} found`)]),p;for(const x in e)p=p.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new Be(x,e[x],`unknown property "${x}"`)]);return p}function hd(i){let e=[];const n=i.value,o=i.key;if(Array.isArray(n)){const u=[],p=[];for(const g in n)n[g].id&&u.includes(n[g].id)&&e.push(new Be(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),u.push(n[g].id),n[g].url&&p.includes(n[g].url)&&e.push(new Be(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),p.push(n[g].url),e=e.concat(Xr({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return pa({key:o,value:n})}function Lf(i){return!!i&&i.constructor===Object}function dd(i){return Lf(i.value)?[]:[new Be(i.key,i.value,`object expected, ${cn(i.value)} found`)]}const ji={"*":()=>[],array:ru,boolean:function(i){const e=i.value,n=i.key,o=cn(e);return o!=="boolean"?[new Be(n,e,`boolean expected, ${o} found`)]:[]},number:ws,color:$s,constants:fa,enum:Xs,filter:Pa,function:Ts,layer:oh,object:Xr,source:Ws,light:Hi,sky:au,terrain:lh,projection:function(i){const e=i.value,n=i.styleSpec,o=n.projection,u=i.style,p=cn(e);if(e===void 0)return[];if(p!=="object")return[new Be("projection",e,`object expected, ${p} found`)];let g=[];for(const x in e)g=g.concat(o[x]?i.validateSpec({key:x,value:e[x],valueSpec:o[x],style:u,styleSpec:n}):[new Be(x,e[x],`unknown property "${x}"`)]);return g},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const o=cn(n);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(n)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(n)?["array","string"].includes(o)?[]:[new Be(e,n,`projection expected, invalid type "${o}" found`)]:[new Be(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:pa,formatted:function(i){return pa(i).length===0?[]:Ss(i)},resolvedImage:function(i){return pa(i).length===0?[]:Ss(i)},padding:function(i){const e=i.key,n=i.value;if(cn(n)==="array"){if(n.length<1||n.length>4)return[new Be(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<n.length;p++)u=u.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return u}return ws({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(cn(n)==="array"){const o={type:"number"};if(n.length<1)return[new Be(e,n,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<n.length;p++)u=u.concat(i.validateSpec({key:`${e}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return u}return ws({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(cn(n)==="array"){if(n.length<1)return[new Be(e,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat($s({key:`${e}[${u}]`,value:n[u]}));return o}return $s({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,o=cn(n),u=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Be(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let g=0;g<n.length;g+=2)p=p.concat(Xs({key:`${e}[${g}]`,value:n[g],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(ru({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return p},sprite:hd,state:dd,fontFaces:function(i){const e=i.key,n=i.value,o=i.validateSpec,u=i.styleSpec,p=i.style;if(!Lf(n))return[new Be(e,n,`object expected, ${cn(n)} found`)];const g=[];for(const x in n){const T=n[x],C=cn(T);if(C==="string")g.push(...pa({key:`${e}.${x}`,value:T}));else if(C==="array"){const I={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[L,B]of T.entries())g.push(...Xr({key:`${e}.${x}[${L}]`,value:B,valueSpec:I,styleSpec:u,style:p,validateSpec:o}))}else g.push(new Be(`${e}.${x}`,T,`string or array expected, ${C} found`))}return g}};function As(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=As,n.expression&&nh(bi(e))?Ts(i):n.expression&&Mo($r(e))?Ss(i):n.type&&ji[n.type]?ji[n.type](i):Xr(Ut({},i,{valueSpec:n.type?o[n.type]:n}))}function nc(i){const e=i.value,n=i.key,o=pa(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Be(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Be(n,e,'"glyphs" url must include a "{range}" token'))),o}function zr(i,e=Fe){let n=[];return n=n.concat(As({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:As,objectElementValidators:{glyphs:nc,"*":()=>[]}})),i.constants&&(n=n.concat(fa({key:"constants",value:i.constants}))),cl(n)}function ma(i){return function(e){return i(Object.assign({},e,{validateSpec:As}))}}function cl(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function Dr(i){return function(...e){return cl(i.apply(this,e))}}zr.source=Dr(ma(Ws)),zr.sprite=Dr(ma(hd)),zr.glyphs=Dr(ma(nc)),zr.light=Dr(ma(Hi)),zr.sky=Dr(ma(au)),zr.terrain=Dr(ma(lh)),zr.state=Dr(ma(dd)),zr.layer=Dr(ma(oh)),zr.filter=Dr(ma(Pa)),zr.paintProperty=Dr(ma(Ms)),zr.layoutProperty=Dr(ma(sh));const em={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class ic{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=Jl(e,em,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=ar(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const su=Fe,sr=zr,Wa=sr.light,ch=sr.sky,uh=sr.paintProperty,Of=sr.layoutProperty;function Ka(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new hn(new Error(o.message))),n=!0;return n}class Do{constructor(e,n,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let T=0;T<this.d*this.d;T++){const C=g[3+T],I=g[3+T+1];u.push(C===I?null:g.subarray(C,I))}const x=g[3+u.length+1];this.keys=g.subarray(g[3+u.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const p=o/n*e;this.min=-p,this.max=e+p}insert(e,n,o,u,p){this._forEachCell(n,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,u,p,g){this.cells[p].push(g)}query(e,n,o,u,p){const g=this.min,x=this.max;if(e<=g&&n<=g&&x<=o&&x<=u&&!p)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,n,o,u,this._queryCell,T,{},p),T}}_queryCell(e,n,o,u,p,g,x,T){const C=this.cells[p];if(C!==null){const I=this.keys,L=this.bboxes;for(let B=0;B<C.length;B++){const F=C[B];if(x[F]===void 0){const q=4*F;(T?T(L[q+0],L[q+1],L[q+2],L[q+3]):e<=L[q+2]&&n<=L[q+3]&&o>=L[q+0]&&u>=L[q+1])?(x[F]=!0,g.push(I[F])):x[F]=!1}}}}_forEachCell(e,n,o,u,p,g,x,T){const C=this._convertToCellCoord(e),I=this._convertToCellCoord(n),L=this._convertToCellCoord(o),B=this._convertToCellCoord(u);for(let F=C;F<=L;F++)for(let q=I;q<=B;q++){const G=this.d*q+F;if((!T||T(this._convertFromCellCoord(F),this._convertFromCellCoord(q),this._convertFromCellCoord(F+1),this._convertFromCellCoord(q+1)))&&p.call(this,e,n,o,u,G,g,x,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=n;for(let g=0;g<e.length;g++){const x=e[g];u[3+g]=p,u.set(x,p),p+=x.length}return u[3+e.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+e.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new Do(e.buffer)}}const Yr={};function kt(i,e,n={}){if(Yr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Yr[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}kt("Object",Object),kt("Set",Set),kt("TransferableGridIndex",Do),kt("Color",un),kt("Error",Error),kt("AJAXError",ye),kt("ResolvedImage",Br),kt("StylePropertyFunction",ol),kt("StyleExpression",ah,{omit:["_evaluator"]}),kt("ZoomDependentExpression",Ao),kt("ZoomConstantExpression",Vr),kt("CompoundExpression",ca,{omit:["_evaluate"]});for(const i in Kl)Kl[i]._classRegistryKey||kt(`Expression_${i}`,Kl[i]);function ou(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function hh(i){return i.$name||i.constructor._classRegistryKey}function Ia(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=hh(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ou(i)||aa(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Qa(i,e){if(Ia(i))return(ou(i)||aa(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const p=[];for(const g of i)p.push(Qa(g,e));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=hh(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Yr[n])throw new Error(`${n} is not registered.`);const{klass:o}=Yr[n],u=o.serialize?o.serialize(i,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||Yr[n].omit.indexOf(p)>=0)continue;const g=i[p];u[p]=Yr[n].shallow.indexOf(p)>=0?g:Qa(g,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function rc(i){if(Ia(i))return i;if(Array.isArray(i))return i.map(rc);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=hh(i)||"Object";if(!Yr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Yr[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const p=i[u];o[u]=Yr[e].shallow.indexOf(u)>=0?p:rc(p)}return o}class dh{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function Cs(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function ul(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function lu(i){return/\s/u.test(String.fromCodePoint(i))}function zs(i){for(const e of i)if(ul(e.codePointAt(0)))return!0;return!1}function fh(i){for(const e of i)if(!fd(e.codePointAt(0)))return!1;return!0}function cu(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const Ds=cu(["Arab","Dupl","Mong","Ougr","Syrc"]);function fd(i){return!Ds.test(String.fromCodePoint(i))}function Ps(i){return!(ul(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const ph=cu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function uu(i){return ph.test(String.fromCodePoint(i))}function Is(i,e){return!(!e&&uu(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Ks(i){for(const e of i)if(uu(e.codePointAt(0)))return!0;return!1}const ka=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(ka.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,o=new Promise((p=>{this.loadScriptResolve=p}));e(n);const u=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:n};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class Vn{constructor(e,n){this.isSupportedScript=pd,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new dh,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function pd(i){return(function(e,n){for(const o of e)if(!Is(o.codePointAt(0),n))return!1;return!0})(i,ka.getRTLTextPluginStatus()==="loaded")}const Qs="-transition";class Po{constructor(e,n,o){this.property=e,this.value=n,this.expression=(function(u,p,g){if(nh(u))return new ol(u,p);if(Mo(u)){const x=Co(u,p,g);if(x.result==="error")throw new Error(x.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return x.value}{let x=u;return p.type==="color"&&typeof u=="string"?x=un.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?p.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?p.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?x=zi.parse(u):p.type==="projectionDefinition"&&typeof u=="string"&&(x=rr.parse(u)):x=Qt.parse(u):x=fi.parse(u):x=Zi.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(n===void 0?e.specification.default:n,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class hu{constructor(e,n){this.property=e,this.value=new Po(e,void 0,n)}transitioned(e,n){return new hl(this.property,this.value,n,mn({},e.transition,this.transition),e.now)}untransitioned(){return new hl(this.property,this.value,null,{},0)}}class mh{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return Zn(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new hu(this._values[e].property,this._globalState)),this._values[e].value=new Po(this._values[e].property,n===null?void 0:Zn(n),this._globalState)}getTransition(e){return Zn(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new hu(this._values[e].property,this._globalState)),this._values[e].transition=Zn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const u=this.getTransition(n);u!==void 0&&(e[`${n}${Qs}`]=u)}return e}transitioned(e,n){const o=new du(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,n._values[u]);return o}untransitioned(){const e=new du(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class hl{constructor(e,n,o,u,p){this.property=e,this.value=n,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const u=e.now||0,p=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return g.possiblyEvaluate(e,n,o);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),p,bt(x))}}return p}}class du{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const u=new dl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,n,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class md{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Zn(this._values[e].value)}setValue(e,n){this._values[e]=new Po(this._values[e].property,n===null?void 0:Zn(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const u=new dl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,n,o);return u}}class ga{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,u){return this.property.evaluate(this.value,this.parameters,e,n,o,u)}}class dl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Lt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const u=mi[this.specification.type];return u?u(e,n,o):e}}class Vt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,u){return new ga(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,u)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new ga(this,{kind:"constant",value:void 0},e.parameters);const u=mi[this.specification.type];if(u){const p=u(e.value.value,n.value.value,o);return new ga(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,n,o,u,p,g){return e.kind==="constant"?e.value:e.evaluate(n,o,u,p,g)}}class Ra extends Vt{possiblyEvaluate(e,n,o,u){if(e.value===void 0)return new ga(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,u),g=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,x=this._calculate(g,g,g,n);return new ga(this,{kind:"constant",value:x},n)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new ga(this,{kind:"constant",value:p},n)}return new ga(this,e.expression,n)}evaluate(e,n,o,u,p,g){if(e.kind==="source"){const x=e.evaluate(n,o,u,p,g);return this._calculate(x,x,x,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,u),e.evaluate({zoom:Math.floor(n.zoom)},o,u),e.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):e.value}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class ac{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(n,null,{},o,u);return this._calculate(p,p,p,n)}return this._calculate(e.expression.evaluate(new Vn(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Vn(Math.floor(n.zoom),n)),e.expression.evaluate(new Vn(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class fu{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,u){return!!e.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class Ui{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Po(o,void 0,void 0),p=this.defaultTransitionablePropertyValues[n]=new hu(o,void 0);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}kt("DataDrivenProperty",Vt),kt("DataConstantProperty",Lt),kt("CrossFadedDataDrivenProperty",Ra),kt("CrossFadedProperty",ac),kt("ColorRampProperty",fu);class wi extends dn{constructor(e,n,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(u,p){return new ic(u,p)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Hr(e.filter,o)),n.layout&&(this._unevaluatedLayout=new md(n.layout,o)),n.paint)){this._transitionablePaint=new mh(n.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new dl(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=Hr(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())e.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const p of u.getGlobalStateRefs()){const g=(e=n.get(p))!==null&&e!==void 0?e:[];g.push({name:o,value:u.value}),n.set(p,g)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,o={}){if(n==null||!this._validate(Of,`layers.${this.id}.layout.${e}`,e,n,o))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith(Qs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(uh,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(Qs))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[e],p=u.property.specification["property-type"]==="cross-faded-data-driven",g=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||g||p||this._handleOverridablePaintPropertyUpdate(e,x,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),br(e,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(e,n,o,u,p={}){return(!p||p.validate!==!1)&&Ka(this,e.call(sr,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ga&&Da(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Pi;var pu={get paint(){return Pi=Pi||new Ui({"raster-opacity":new Lt(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Lt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Lt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Lt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Lt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new Lt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new Lt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Lt(Fe.paint_raster["raster-fade-duration"])})}};class Js extends wi{constructor(e,n){super(e,pu,n)}}const pn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fn{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function gi(i,e=1){let n=0,o=0;return{members:i.map((u=>{const p=pn[u.type].BYTES_PER_ELEMENT,g=n=La(n,Math.max(e,p)),x=u.components||1;return o=Math.max(o,p),n+=p*x,{name:u.name,type:u.type,components:x,offset:g}})),size:La(n,Math.max(o,e)),alignment:e}}function La(i,e){return Math.ceil(i/e)*e}class Ja extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=o,e}}Ja.prototype.bytesPerElement=4,kt("StructArrayLayout2i4",Ja);class fl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=u,e}}fl.prototype.bytesPerElement=6,kt("StructArrayLayout3i6",fl);class pl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,u)}emplace(e,n,o,u,p){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=u,this.int16[g+3]=p,e}}pl.prototype.bytesPerElement=8,kt("StructArrayLayout4i8",pl);class eo extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=u,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=x,e}}eo.prototype.bytesPerElement=12,kt("StructArrayLayout2i4i12",eo);class gd extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=4*e,C=8*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.uint8[C+4]=u,this.uint8[C+5]=p,this.uint8[C+6]=g,this.uint8[C+7]=x,e}}gd.prototype.bytesPerElement=8,kt("StructArrayLayout2i4ub8",gd);class ci extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=o,e}}ci.prototype.bytesPerElement=8,kt("StructArrayLayout2f8",ci);class es extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I){const L=this.length;return this.resize(L+1),this.emplace(L,e,n,o,u,p,g,x,T,C,I)}emplace(e,n,o,u,p,g,x,T,C,I,L){const B=10*e;return this.uint16[B+0]=n,this.uint16[B+1]=o,this.uint16[B+2]=u,this.uint16[B+3]=p,this.uint16[B+4]=g,this.uint16[B+5]=x,this.uint16[B+6]=T,this.uint16[B+7]=C,this.uint16[B+8]=I,this.uint16[B+9]=L,e}}es.prototype.bytesPerElement=20,kt("StructArrayLayout10ui20",es);class sc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,o,u,p,g,x,T)}emplace(e,n,o,u,p,g,x,T,C){const I=8*e;return this.uint16[I+0]=n,this.uint16[I+1]=o,this.uint16[I+2]=u,this.uint16[I+3]=p,this.uint16[I+4]=g,this.uint16[I+5]=x,this.uint16[I+6]=T,this.uint16[I+7]=C,e}}sc.prototype.bytesPerElement=16,kt("StructArrayLayout8ui16",sc);class oc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,u,p,g,x,T,C,I,L,B)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F){const q=12*e;return this.int16[q+0]=n,this.int16[q+1]=o,this.int16[q+2]=u,this.int16[q+3]=p,this.uint16[q+4]=g,this.uint16[q+5]=x,this.uint16[q+6]=T,this.uint16[q+7]=C,this.int16[q+8]=I,this.int16[q+9]=L,this.int16[q+10]=B,this.int16[q+11]=F,e}}oc.prototype.bytesPerElement=24,kt("StructArrayLayout4i4ui4i24",oc);class mu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,e}}mu.prototype.bytesPerElement=12,kt("StructArrayLayout3f12",mu);class gu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}gu.prototype.bytesPerElement=4,kt("StructArrayLayout1ul4",gu);class yu extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,o,u,p,g,x,T,C)}emplace(e,n,o,u,p,g,x,T,C,I){const L=10*e,B=5*e;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=u,this.int16[L+3]=p,this.int16[L+4]=g,this.int16[L+5]=x,this.uint32[B+3]=T,this.uint16[L+8]=C,this.uint16[L+9]=I,e}}yu.prototype.bytesPerElement=20,kt("StructArrayLayout6i1ul2ui20",yu);class Io extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=o,this.int16[T+2]=u,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=x,e}}Io.prototype.bytesPerElement=12,kt("StructArrayLayout2i2i2i12",Io);class to extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,u,p)}emplace(e,n,o,u,p,g){const x=4*e,T=8*e;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=u,this.int16[T+6]=p,this.int16[T+7]=g,e}}to.prototype.bytesPerElement=16,kt("StructArrayLayout2f1f2i16",to);class wr extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,o,u,p,g)}emplace(e,n,o,u,p,g,x){const T=16*e,C=4*e,I=8*e;return this.uint8[T+0]=n,this.uint8[T+1]=o,this.float32[C+1]=u,this.float32[C+2]=p,this.int16[I+6]=g,this.int16[I+7]=x,e}}wr.prototype.bytesPerElement=16,kt("StructArrayLayout2ub2f2i16",wr);class yi extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=u,e}}yi.prototype.bytesPerElement=6,kt("StructArrayLayout3ui6",yi);class ks extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,Y,J){const he=this.length;return this.resize(he+1),this.emplace(he,e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,Y,J)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,Y,J,he){const ee=24*e,ie=12*e,ge=48*e;return this.int16[ee+0]=n,this.int16[ee+1]=o,this.uint16[ee+2]=u,this.uint16[ee+3]=p,this.uint32[ie+2]=g,this.uint32[ie+3]=x,this.uint32[ie+4]=T,this.uint16[ee+10]=C,this.uint16[ee+11]=I,this.uint16[ee+12]=L,this.float32[ie+7]=B,this.float32[ie+8]=F,this.uint8[ge+36]=q,this.uint8[ge+37]=G,this.uint8[ge+38]=Y,this.uint32[ie+10]=J,this.int16[ee+22]=he,e}}ks.prototype.bytesPerElement=48,kt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ks);class ml extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,Y,J,he,ee,ie,ge,be,Ue,st,Qe,mt,Ct,yt){const tt=this.length;return this.resize(tt+1),this.emplace(tt,e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,Y,J,he,ee,ie,ge,be,Ue,st,Qe,mt,Ct,yt)}emplace(e,n,o,u,p,g,x,T,C,I,L,B,F,q,G,Y,J,he,ee,ie,ge,be,Ue,st,Qe,mt,Ct,yt,tt){const $e=32*e,Ot=16*e;return this.int16[$e+0]=n,this.int16[$e+1]=o,this.int16[$e+2]=u,this.int16[$e+3]=p,this.int16[$e+4]=g,this.int16[$e+5]=x,this.int16[$e+6]=T,this.int16[$e+7]=C,this.uint16[$e+8]=I,this.uint16[$e+9]=L,this.uint16[$e+10]=B,this.uint16[$e+11]=F,this.uint16[$e+12]=q,this.uint16[$e+13]=G,this.uint16[$e+14]=Y,this.uint16[$e+15]=J,this.uint16[$e+16]=he,this.uint16[$e+17]=ee,this.uint16[$e+18]=ie,this.uint16[$e+19]=ge,this.uint16[$e+20]=be,this.uint16[$e+21]=Ue,this.uint16[$e+22]=st,this.uint32[Ot+12]=Qe,this.float32[Ot+13]=mt,this.float32[Ot+14]=Ct,this.uint16[$e+30]=yt,this.uint16[$e+31]=tt,e}}ml.prototype.bytesPerElement=64,kt("StructArrayLayout8i15ui1ul2f2ui64",ml);class gl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}gl.prototype.bytesPerElement=4,kt("StructArrayLayout1f4",gl);class lc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=3*e;return this.uint16[6*e+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,e}}lc.prototype.bytesPerElement=12,kt("StructArrayLayout1ui2f12",lc);class ts extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,o)}emplace(e,n,o,u){const p=4*e;return this.uint32[2*e+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=u,e}}ts.prototype.bytesPerElement=8,kt("StructArrayLayout1ul2ui8",ts);class y extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=o,e}}y.prototype.bytesPerElement=4,kt("StructArrayLayout2ui4",y);class t extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,kt("StructArrayLayout1ui2",t);class a extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,u)}emplace(e,n,o,u,p){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=u,this.float32[g+3]=p,e}}a.prototype.bytesPerElement=16,kt("StructArrayLayout4f16",a);class c extends Fn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class f extends yu{get(e){return new c(this,e)}}kt("CollisionBoxArray",f);class v extends Fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}v.prototype.size=48;class w extends ks{get(e){return new v(this,e)}}kt("PlacedSymbolArray",w);class E extends Fn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}E.prototype.size=64;class D extends ml{get(e){return new E(this,e)}}kt("SymbolInstanceArray",D);class R extends gl{getoffsetX(e){return this.float32[1*e+0]}}kt("GlyphOffsetArray",R);class O extends fl{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}kt("SymbolLineVertexArray",O);class U extends Fn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}U.prototype.size=12;class j extends lc{get(e){return new U(this,e)}}kt("TextAnchorOffsetArray",j);class H extends Fn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}H.prototype.size=8;class K extends ts{get(e){return new H(this,e)}}kt("FeatureIndexArray",K);class se extends Ja{}class le extends Ja{}class oe extends Ja{}class ue extends eo{}class ve extends gd{}class ce extends ci{}class _e extends es{}class Ee extends sc{}class me extends oc{}class Ce extends mu{}class Ze extends gu{}class je extends Io{}class qe extends wr{}class Ge extends yi{}class St extends y{}const Et=gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:pt}=Et;class At{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,o,u){const p=this.segments[this.segments.length-1];return e>At.MAX_VERTEX_ARRAY_LENGTH&&Dn(`Max vertices per segment is ${At.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${At.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>At.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u?this.createNewSegment(n,o,u):p}createNewSegment(e,n,o){const u={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,n,o){return this.prepareSegment(0,e,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,u){return new At([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function an(i,e){return 256*(i=Xt(Math.floor(i),0,255))+Xt(Math.floor(e),0,255)}At.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kt("SegmentVector",At);const jn=gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ri=gi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ei,ui,$n,Ti={exports:{}},hi={exports:{}},hr={exports:{}},Ii=(function(){if($n)return Ti.exports;$n=1;var i=(ei||(ei=1,hi.exports=function(n,o){var u,p,g,x,T,C,I,L;for(p=n.length-(u=3&n.length),g=o,T=3432918353,C=461845907,L=0;L<p;)I=255&n.charCodeAt(L)|(255&n.charCodeAt(++L))<<8|(255&n.charCodeAt(++L))<<16|(255&n.charCodeAt(++L))<<24,++L,g=27492+(65535&(x=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&n.charCodeAt(L+2))<<16;case 2:I^=(255&n.charCodeAt(L+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&n.charCodeAt(L)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),hi.exports),e=(ui||(ui=1,hr.exports=function(n,o){for(var u,p=n.length,g=o^p,x=0;p>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(x)|(255&n.charCodeAt(++x))<<8|(255&n.charCodeAt(++x))<<16|(255&n.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:g^=(255&n.charCodeAt(x+2))<<16;case 2:g^=(255&n.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),hr.exports);return Ti.exports=i,Ti.exports.murmur3=i,Ti.exports.murmur2=e,Ti.exports})(),ki=W(Ii);class dr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,u){this.ids.push(Rs(e)),this.positions.push(n,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Rs(e);let o=0,u=this.ids.length-1;for(;o<u;){const g=o+u>>1;this.ids[g]>=n?u=g:o=g+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(e,n){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Ls(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const n=new dr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Rs(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:ki(String(i))}function Ls(i,e,n,o){for(;n<o;){const u=i[n+o>>1];let p=n-1,g=o+1;for(;;){do p++;while(i[p]<u);do g--;while(i[g]>u);if(p>=g)break;ns(i,p,g),ns(e,3*p,3*g),ns(e,3*p+1,3*g+1),ns(e,3*p+2,3*g+2)}g-n<o-g?(Ls(i,e,n,g),n=g+1):(Ls(i,e,g+1,o),o=g)}}function ns(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}kt("FeaturePositionMap",dr);class Wr{constructor(e,n){this.gl=e.gl,this.location=n}}class yl extends Wr{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class cc extends Wr{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class is extends Wr{constructor(e,n){super(e,n),this.current=un.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Kr=new Float32Array(16);function ya(i){return[an(255*i.r,255*i.g),an(255*i.b,255*i.a)]}class Oa{constructor(e,n,o){this.value=e,this.uniformNames=n.map((u=>`u_${u}`)),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new is(e,n):new yl(e,n)}}class Ba{constructor(e,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,o,u){let p=null;u==="u_pattern_to"?p=this.patternTo:u==="u_pattern_from"?p=this.patternFrom:u==="u_dasharray_to"?p=this.dashTo:u==="u_dasharray_from"?p=this.dashFrom:u==="u_pixel_ratio_to"?p=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&e.set(p)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new cc(e,n):new yl(e,n)}}class qn{constructor(e,n,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,n,o){const u=this.paintVertexArray.length,p=this.expression.evaluate(new Vn(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,p)}updatePaintArray(e,n,o,u,p){const g=this.expression.evaluate(new Vn(0,p),o,u);this._setPaintValue(e,n,g)}_setPaintValue(e,n,o){if(this.type==="color"){const u=ya(o);for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ti{constructor(e,n,o,u,p,g){this.expression=e,this.uniformNames=n.map((x=>`u_${x}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map((x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,n,o){const u=this.expression.evaluate(new Vn(this.zoom,o),n,{},o.canonical,[],o.formattedSection),p=this.expression.evaluate(new Vn(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,u,p)}updatePaintArray(e,n,o,u,p){const g=this.expression.evaluate(new Vn(this.zoom,p),o,u),x=this.expression.evaluate(new Vn(this.zoom+1,p),o,u);this._setPaintValue(e,n,g,x)}_setPaintValue(e,n,o,u){if(this.type==="color"){const p=ya(o),g=ya(u);for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,p[0],p[1],g[0],g[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=Xt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,n,o){return new yl(e,n)}}class $i{constructor(e,n,o,u,p,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=g,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(n),o)}updatePaintArray(e,n,o,u,p){this._setPaintValues(e,n,this.getPositionIds(o),p)}_setPaintValues(e,n,o,u){const p=this.getPositions(u);if(!p||!o)return;const g=p[o.min],x=p[o.mid],T=p[o.max];if(g&&x&&T)for(let C=e;C<n;C++)this.emplace(this.zoomInPaintVertexArray,C,x,g),this.emplace(this.zoomOutPaintVertexArray,C,x,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ji extends $i{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return jn.members}emplace(e,n,o,u){e.emplace(n,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class gh extends $i{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return ri.members}emplace(e,n,o,u){e.emplace(n,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class yh{constructor(e,n,o){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!o(p))continue;const g=e.paint.get(p);if(!(g instanceof ga&&Da(g.property.specification)))continue;const x=Bf(p,e.type),T=g.value,C=g.property.specification.type,I=g.property.useIntegerZoom,L=g.property.specification["property-type"],B=L==="cross-faded"||L==="cross-faded-data-driven";if(T.kind==="constant")this.binders[p]=B?new Ba(T.value,x):new Oa(T.value,x,C),u.push(`/u_${p}`);else if(T.kind==="source"||B){const F=Ro(p,C,"source");this.binders[p]=B?p==="line-dasharray"?new gh(T,C,I,n,F,e.id):new Ji(T,C,I,n,F,e.id):new qn(T,x,C,F),u.push(`/a_${p}`)}else{const F=Ro(p,C,"composite");this.binders[p]=new ti(T,x,C,I,n,F),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof qn||n instanceof ti?n.maxValue:0}populatePaintArrays(e,n,o){for(const u in this.binders){const p=this.binders[u];(p instanceof qn||p instanceof ti||p instanceof $i)&&p.populatePaintArray(e,n,o)}}setConstantPatternPositions(e,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ba&&u.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const o in this.binders){const u=this.binders[o];u instanceof Ba&&u.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,o,u,p){let g=!1;for(const x in e){const T=n.getPositions(x);for(const C of T){const I=o.feature(C.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof qn||B instanceof ti||B instanceof $i)&&B.expression.isStateDependent===!0){const F=u.paint.get(L);B.expression=F.value,B.updatePaintArray(C.start,C.end,I,e[x],p),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Oa||o instanceof Ba)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof qn||o instanceof ti)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof $i){const u=o.getVertexAttributes();for(const p of u)e.push(p.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Oa||o instanceof Ba||o instanceof ti)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Oa||p instanceof Ba||p instanceof ti){for(const g of p.uniformNames)if(n[g]){const x=p.getBinding(e,n[g],g);o.push({name:g,property:u,binding:x})}}}return o}setUniforms(e,n,o,u){for(const{name:p,property:g,binding:x}of n)this.binders[g].setUniform(x,u,o.get(g),p)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof $i){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof qn||o instanceof ti)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof qn||o instanceof ti||o instanceof $i)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof qn||n instanceof ti||n instanceof $i)&&n.destroy()}}}class ko{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new yh(u,n,o);this.needsUpload=!1,this._featureMap=new dr,this._bufferOffset=0}populatePaintArrays(e,n,o,u){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,u);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Ro(i,e,n){const o={color:{source:ci,composite:a},number:{source:gl,composite:ci}},u=(function(p){return{"line-pattern":{source:_e,composite:_e},"fill-pattern":{source:_e,composite:_e},"fill-extrusion-pattern":{source:_e,composite:_e},"line-dasharray":{source:Ee,composite:Ee}}[p]})(i);return u&&u[n]||o[e][n]}kt("ConstantBinder",Oa),kt("CrossFadedConstantBinder",Ba),kt("SourceExpressionBinder",qn),kt("CrossFadedPatternBinder",Ji),kt("CrossFadedDasharrayBinder",gh),kt("CompositeExpressionBinder",ti),kt("ProgramConfiguration",yh,{omit:["_buffers"]}),kt("ProgramConfigurationSet",ko);const _h=Math.pow(2,14)-1,no=-_h-1;function io(i){const e=xt/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let p=0;p<u.length;p++){const g=u[p],x=Math.round(g.x*e),T=Math.round(g.y*e);g.x=Xt(x,no,_h),g.y=Xt(T,no,_h),(x<g.x||x>g.x+1||T<g.y||T>g.y+1)&&Dn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function rs(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?io(i):[]}}const vh=-32768;function _u(i,e,n,o,u){i.emplaceBack(vh+8*e+o,vh+8*n+u)}class vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new le,this.indexArray=new Ge,this.segments=new At,this.programConfigurations=new ko(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){const u=this.layers[0],p=[];let g=null,x=!1,T=u.type==="heatmap";if(u.type==="circle"){const I=u;g=I.layout.get("circle-sort-key"),x=!g.isConstant(),T=T||I.paint.get("circle-pitch-alignment")==="map"}const C=T?n.subdivisionGranularity.circle:1;for(const{feature:I,id:L,index:B,sourceLayerIndex:F}of e){const q=this.layers[0]._featureFilter.needGeometry,G=rs(I,q);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),G,o))continue;const Y=x?g.evaluate(G,{},o):void 0,J={id:L,properties:I.properties,type:I.type,sourceLayerIndex:F,index:B,geometry:q?G.geometry:io(I),patterns:{},sortKey:Y};p.push(J)}x&&p.sort(((I,L)=>I.sortKey-L.sortKey));for(const I of p){const{geometry:L,index:B,sourceLayerIndex:F}=I,q=e[B].feature;this.addFeature(I,L,B,o,C),n.featureIndex.insert(q,L,B,F,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,u,p=1){let g;switch(p){case 1:g=[0,7];break;case 3:g=[0,2,5,7];break;case 5:g=[0,1,3,4,6,7];break;case 7:g=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const x=g.length;for(const T of n)for(const C of T){const I=C.x,L=C.y;if(I<0||I>=xt||L<0||L>=xt)continue;const B=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,e.sortKey),F=B.vertexLength;for(let q=0;q<x;q++)for(let G=0;G<x;G++)_u(this.layoutVertexArray,I,L,g[G],g[q]);for(let q=0;q<x-1;q++)for(let G=0;G<x-1;G++){const Y=F+q*x+G,J=F+(q+1)*x+G;this.indexArray.emplaceBack(Y,J+1,Y+1),this.indexArray.emplaceBack(Y,J,J+1)}B.vertexLength+=x*x,B.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function xu(i,e){for(let n=0;n<i.length;n++)if(Lo(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Lo(i,e[n]))return!0;return!!Tr(i,e)}function Nf(i,e,n){return!!Lo(i,e)||!!jf(e,i,n)}function Ff(i,e){if(i.length===1)return nm(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let u=0;u<o.length;u++)if(Lo(i,o[u]))return!0}for(let n=0;n<i.length;n++)if(nm(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Tr(i,e[n]))return!0;return!1}function fr(i,e,n){if(i.length>1){if(Tr(i,e))return!0;for(let o=0;o<e.length;o++)if(jf(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(jf(i[o],e,n))return!0;return!1}function Tr(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],u=i[n+1];for(let p=0;p<e.length-1;p++)if(pg(o,u,e[p],e[p+1]))return!0}return!1}function pg(i,e,n,o){return Bi(i,n,o)!==Bi(e,n,o)&&Bi(i,e,n)!==Bi(i,e,o)}function jf(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(tm(i,e[u-1],e[u])<o)return!0;return!1}function tm(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const u=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function nm(i,e){let n,o,u,p=!1;for(let g=0;g<i.length;g++){n=i[g];for(let x=0,T=n.length-1;x<n.length;T=x++)o=n[x],u=n[T],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function Lo(i,e){let n=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const p=i[o],g=i[u];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(n=!n)}return n}function mg(i,e,n){const o=n[0],u=n[2];if(i.x<o.x&&e.x<o.x||i.x>u.x&&e.x>u.x||i.y<o.y&&e.y<o.y||i.y>u.y&&e.y>u.y)return!1;const p=Bi(i,e,n[0]);return p!==Bi(i,e,n[1])||p!==Bi(i,e,n[2])||p!==Bi(i,e,n[3])}function _l(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function yd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Uf(i,e,n,o,u){if(!e[0]&&!e[1])return i;const p=N.convert(e)._mult(u);n==="viewport"&&p._rotate(-o);const g=[];for(let x=0;x<i.length;x++)g.push(i[x].sub(p));return g}function Vf(i){const e=[];for(let n=0;n<i.length;n++){const o=i[n],u=e.at(-1);(n===0||u&&!o.equals(u))&&e.push(o)}return e}function im({queryGeometry:i,size:e},n){return Nf(i,n,e)}function gg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){return Nf(i,p,e*(n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function yg({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){const g=n.projectTileCoordinates(p.x,p.y,o,u).signedDistanceFromCamera,x=e*(n.cameraToCenterDistance/g);return Nf(i,_d(p,n,o,u),x)}function _g({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u},p){return Nf(i,_d(p,n,o,u),e)}function qf({queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u,pitchAlignment:p="map",pitchScale:g="map"},x){const T=p==="map"?g==="map"?im:gg:g==="map"?yg:_g,C={queryGeometry:i,size:e,transform:n,unwrappedTileID:o,getElevation:u};for(const I of x)for(const L of I)if(T(C,L))return!0;return!1}function _d(i,e,n,o){const u=e.projectTileCoordinates(i.x,i.y,n,o).point;return new N((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let Gf,rm;kt("CircleBucket",vu,{omit:["layers"]});var am={get paint(){return rm=rm||new Ui({"circle-radius":new Vt(Fe.paint_circle["circle-radius"]),"circle-color":new Vt(Fe.paint_circle["circle-color"]),"circle-blur":new Vt(Fe.paint_circle["circle-blur"]),"circle-opacity":new Vt(Fe.paint_circle["circle-opacity"]),"circle-translate":new Lt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Lt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Lt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Lt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(Fe.paint_circle["circle-stroke-opacity"])})},get layout(){return Gf=Gf||new Ui({"circle-sort-key":new Vt(Fe.layout_circle["circle-sort-key"])})}};class Zf extends wi{constructor(e,n){super(e,am,n)}createBucket(e){return new vu(e)}queryRadius(e){const n=e;return _l("circle-radius",this,n)+_l("circle-stroke-width",this,n)+yd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,unwrappedTileID:x,getElevation:T}){const C=Uf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,g),I=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),L=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let F,q;return B==="map"?(F=C,q=I*g):(F=(function(G,Y,J,he){return G.map((ee=>_d(ee,Y,J,he)))})(C,p,x,T),q=I),qf({queryGeometry:F,size:q,transform:p,unwrappedTileID:x,getElevation:T,pitchAlignment:B,pitchScale:L},u)}}class Hf extends vu{}let sm;kt("HeatmapBucket",Hf,{omit:["layers"]});var om={get paint(){return sm=sm||new Ui({"heatmap-radius":new Vt(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Lt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fu(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Lt(Fe.paint_heatmap["heatmap-opacity"])})}};function $f(i,{width:e,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*n*o}`)}else u=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=u,i}function Oo(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const u=$f({},{width:e,height:n},o);vd(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=u.data}function vd(i,e,n,o,u,p){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,x=e.data;if(g===x)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<u.height;T++){const C=((n.y+T)*i.width+n.x)*p,I=((o.y+T)*e.width+o.x)*p;for(let L=0;L<u.width*p;L++)x[I+L]=g[C+L]}return e}class xd{constructor(e,n){$f(this,e,1,n)}resize(e){Oo(this,e,1)}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,p){vd(e,n,o,u,p,1)}}class Qr{constructor(e,n){$f(this,e,4,n)}resize(e){Oo(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,u,p){vd(e,n,o,u,p,4)}setPixel(e,n,o){const u=4*(e*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function Bo(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new Qr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(g,x,T)=>{e[i.evaluationKey]=T;const C=i.expression.evaluate(e);u.setPixel(g/4/n,x/4,C)};if(i.clips)for(let g=0,x=0;g<o;++g,x+=4*n)for(let T=0,C=0;T<n;T++,C+=4){const I=T/(n-1),{start:L,end:B}=i.clips[g];p(x,C,L*(1-I)+B*I)}else for(let g=0,x=0;g<n;g++,x+=4)p(0,x,g/(n-1));return u}kt("AlphaImage",xd),kt("RGBAImage",Qr);const bd="big-fb";class vg extends wi{createBucket(e){return new Hf(e)}constructor(e,n){super(e,om,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(bd)&&this.heatmapFbos.delete(bd)}queryRadius(e){return _l("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,unwrappedTileID:x,getElevation:T}){return qf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,o)*g,transform:p,unwrappedTileID:x,getElevation:T},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let wd;var Td={get paint(){return wd=wd||new Ui({"hillshade-illumination-direction":new Lt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Lt(Fe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Lt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Lt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Lt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Lt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Lt(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Lt(Fe.paint_hillshade["hillshade-method"])})}};class Ri extends wi{constructor(e,n){super(e,Td,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,n.length,o.length,u.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),n=n.concat(Array(p-n.length).fill(n.at(-1))),o=o.concat(Array(p-o.length).fill(o.at(-1))),u=u.concat(Array(p-u.length).fill(u.at(-1)));const g=n.map(xi);return{directionRadians:e.map(xi),altitudeRadians:g,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let xg;var Ky={get paint(){return xg=xg||new Ui({"color-relief-opacity":new Lt(Fe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new fu(Fe["paint_color-relief"]["color-relief-color"])})}};class Xf{constructor(e,n,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,o){const{width:u,height:p}=e,g=!(this.size&&this.size[0]===u&&this.size[1]===p||o),{context:x}=this,{gl:T}=x;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),g)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||aa(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:C,y:I}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||aa(e)?T.texSubImage2D(T.TEXTURE_2D,0,C,I,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,C,I,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),o!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class xh{constructor(e,n,o,u=1,p=1,g=1,x=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Dn(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=g,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let C=0;C<T;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(T,C)]=this.data[this._idx(T-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,T)]=this.data[this._idx(C,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let C=0;C<T;C++)for(let I=0;I<T;I++){const L=this.get(C,I);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(e,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return vl(e,this.getUnpackVector())}getPixels(){return new Qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,g=o*this.dim,x=o*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:g=x-1;break;case 1:x=g+1}const T=-n*this.dim,C=-o*this.dim;for(let I=g;I<x;I++)for(let L=u;L<p;L++)this.data[this._idx(L,I)]=e.data[this._idx(L+T,I+C)]}}function vl(i,e){const n=e[0],o=e[1],u=e[2],p=e[3],g=Math.min(n,o,u),x=Math.round((i+p)/g);return{r:Math.floor(x*g/n)%256,g:Math.floor(x*g/o)%256,b:Math.floor(x*g/u)%256}}kt("DEMData",xh);class bg extends wi{constructor(e,n){super(e,Ky,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Vr&&o._styleExpression.expression instanceof jr){this.colorRampExpression=o;const g=o._styleExpression.expression;n.elevationStops=g.labels,n.colorStops=[];for(const x of n.elevationStops)n.colorStops.push(g.evaluate({globals:{elevation:x}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[un.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const u={elevationStops:[],colorStops:[]},p=(n.elevationStops.length-1)/(e-1);for(let g=0;g<n.elevationStops.length-.5;g+=p)u.elevationStops.push(n.elevationStops[Math.round(g)]),u.colorStops.push(n.colorStops[Math.round(g)]);return Dn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),p=new Qr({width:u.colorStops.length,height:1}),g=new Qr({width:u.colorStops.length,height:1});for(let x=0;x<u.elevationStops.length;x++){const T=vl(u.elevationStops[x],o);g.setPixel(0,x,new un(T.r/255,T.g/255,T.b/255,1)),p.setPixel(0,x,u.colorStops[x])}return this.colorRampTextures={elevationTexture:new Xf(e,g,e.gl.RGBA),colorTexture:new Xf(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const wg=gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sd}=wg;function as(i,e,n){const o=n.patternDependencies;let u=!1;for(const p of e){const g=p.paint.get(`${i}-pattern`);g.isConstant()||(u=!0);const x=g.constantOr(null);x&&(u=!0,o[x.to]=!0,o[x.from]=!0)}return u}function Yf(i,e,n,o,u){const{zoom:p}=o,g=u.patternDependencies;for(const x of e){const T=x.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:p-1},n,{},u.availableImages),I=T.evaluate({zoom:p},n,{},u.availableImages),L=T.evaluate({zoom:p+1},n,{},u.availableImages);C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,g[C]=!0,g[I]=!0,g[L]=!0,n.patterns[x.id]={min:C,mid:I,max:L}}}return n}function Wf(i,e,n,o,u){let p;if(u===(function(g,x,T,C){let I=0;for(let L=x,B=T-C;L<T;L+=C)I+=(g[B]-g[L])*(g[L+1]+g[B+1]),B=L;return I})(i,e,n,o)>0)for(let g=e;g<n;g+=o)p=_a(g/o|0,i[g],i[g+1],p);else for(let g=n-o;g>=e;g-=o)p=_a(g/o|0,i[g],i[g+1],p);return p&&Na(p,p.next)&&(va(p),p=p.next),p}function uc(i,e){if(!i)return i;e||(e=i);let n,o=i;do if(n=!1,o.steiner||!Na(o,o.next)&&Ln(o.prev,o,o.next)!==0)o=o.next;else{if(va(o),o=e=o.prev,o===o.next)break;n=!0}while(n||o!==e);return e}function bu(i,e,n,o,u,p,g){if(!i)return;!g&&p&&(function(T,C,I,L){let B=T;do B.z===0&&(B.z=mr(B.x,B.y,C,I,L)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,(function(F){let q,G=1;do{let Y,J=F;F=null;let he=null;for(q=0;J;){q++;let ee=J,ie=0;for(let be=0;be<G&&(ie++,ee=ee.nextZ,ee);be++);let ge=G;for(;ie>0||ge>0&&ee;)ie!==0&&(ge===0||!ee||J.z<=ee.z)?(Y=J,J=J.nextZ,ie--):(Y=ee,ee=ee.nextZ,ge--),he?he.nextZ=Y:F=Y,Y.prevZ=he,he=Y;J=ee}he.nextZ=null,G*=2}while(q>1)})(B)})(i,o,u,p);let x=i;for(;i.prev!==i.next;){const T=i.prev,C=i.next;if(p?Kf(i,o,u,p):lm(i))e.push(T.i,i.i,C.i),va(i),i=C.next,x=C.next;else if((i=C)===x){g?g===1?bu(i=Tg(uc(i),e),e,n,o,u,p,2):g===2&&xl(i,e,n,o,u,p):bu(uc(i),e,n,o,u,p,1);break}}}function lm(i){const e=i.prev,n=i,o=i.next;if(Ln(e,n,o)>=0)return!1;const u=e.x,p=n.x,g=o.x,x=e.y,T=n.y,C=o.y,I=Math.min(u,p,g),L=Math.min(x,T,C),B=Math.max(u,p,g),F=Math.max(x,T,C);let q=o.next;for(;q!==e;){if(q.x>=I&&q.x<=B&&q.y>=L&&q.y<=F&&bh(u,x,p,T,g,C,q.x,q.y)&&Ln(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function Kf(i,e,n,o){const u=i.prev,p=i,g=i.next;if(Ln(u,p,g)>=0)return!1;const x=u.x,T=p.x,C=g.x,I=u.y,L=p.y,B=g.y,F=Math.min(x,T,C),q=Math.min(I,L,B),G=Math.max(x,T,C),Y=Math.max(I,L,B),J=mr(F,q,e,n,o),he=mr(G,Y,e,n,o);let ee=i.prevZ,ie=i.nextZ;for(;ee&&ee.z>=J&&ie&&ie.z<=he;){if(ee.x>=F&&ee.x<=G&&ee.y>=q&&ee.y<=Y&&ee!==u&&ee!==g&&bh(x,I,T,L,C,B,ee.x,ee.y)&&Ln(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ie.x>=F&&ie.x<=G&&ie.y>=q&&ie.y<=Y&&ie!==u&&ie!==g&&bh(x,I,T,L,C,B,ie.x,ie.y)&&Ln(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;ee&&ee.z>=J;){if(ee.x>=F&&ee.x<=G&&ee.y>=q&&ee.y<=Y&&ee!==u&&ee!==g&&bh(x,I,T,L,C,B,ee.x,ee.y)&&Ln(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ie&&ie.z<=he;){if(ie.x>=F&&ie.x<=G&&ie.y>=q&&ie.y<=Y&&ie!==u&&ie!==g&&bh(x,I,T,L,C,B,ie.x,ie.y)&&Ln(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function Tg(i,e){let n=i;do{const o=n.prev,u=n.next.next;!Na(o,u)&&hm(o,n,n.next,u)&&Ad(o,u)&&Ad(u,o)&&(e.push(o.i,n.i,u.i),va(n),va(n.next),n=i=u),n=n.next}while(n!==i);return uc(n)}function xl(i,e,n,o,u,p){let g=i;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&Vi(g,x)){let T=Cd(g,x);return g=uc(g,g.next),T=uc(T,T.next),bu(g,e,n,o,u,p,0),void bu(T,e,n,o,u,p,0)}x=x.next}g=g.next}while(g!==i)}function pr(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function cm(i,e){const n=(function(u,p){let g=p;const x=u.x,T=u.y;let C,I=-1/0;if(Na(u,g))return g;do{if(Na(u,g.next))return g.next;if(T<=g.y&&T>=g.next.y&&g.next.y!==g.y){const G=g.x+(T-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(G<=x&&G>I&&(I=G,C=g.x<g.next.x?g:g.next,G===x))return C}g=g.next}while(g!==p);if(!C)return null;const L=C,B=C.x,F=C.y;let q=1/0;g=C;do{if(x>=g.x&&g.x>=B&&x!==g.x&&um(T<F?x:I,T,B,F,T<F?I:x,T,g.x,g.y)){const G=Math.abs(T-g.y)/(x-g.x);Ad(g,u)&&(G<q||G===q&&(g.x>C.x||g.x===C.x&&Sg(C,g)))&&(C=g,q=G)}g=g.next}while(g!==L);return C})(i,e);if(!n)return e;const o=Cd(n,i);return uc(o,o.next),uc(n,n.next)}function Sg(i,e){return Ln(i.prev,i,e.prev)<0&&Ln(e.next,i,i.next)<0}function mr(i,e,n,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Qy(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function um(i,e,n,o,u,p,g,x){return(u-g)*(e-x)>=(i-g)*(p-x)&&(i-g)*(o-x)>=(n-g)*(e-x)&&(n-g)*(p-x)>=(u-g)*(o-x)}function bh(i,e,n,o,u,p,g,x){return!(i===g&&e===x)&&um(i,e,n,o,u,p,g,x)}function Vi(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&hm(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1})(i,e)&&(Ad(i,e)&&Ad(e,i)&&(function(n,o){let u=n,p=!1;const g=(n.x+o.x)/2,x=(n.y+o.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&g<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p})(i,e)&&(Ln(i.prev,i,e.prev)||Ln(i,e.prev,e))||Na(i,e)&&Ln(i.prev,i,i.next)>0&&Ln(e.prev,e,e.next)>0)}function Ln(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Na(i,e){return i.x===e.x&&i.y===e.y}function hm(i,e,n,o){const u=Md(Ln(i,e,n)),p=Md(Ln(i,e,o)),g=Md(Ln(n,o,i)),x=Md(Ln(n,o,e));return u!==p&&g!==x||!(u!==0||!Ed(i,n,e))||!(p!==0||!Ed(i,o,e))||!(g!==0||!Ed(n,i,o))||!(x!==0||!Ed(n,e,o))}function Ed(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Md(i){return i>0?1:i<0?-1:0}function Ad(i,e){return Ln(i.prev,i,i.next)<0?Ln(i,e,i.next)>=0&&Ln(i,i.prev,e)>=0:Ln(i,e,i.prev)<0||Ln(i,i.next,e)<0}function Cd(i,e){const n=Qf(i.i,i.x,i.y),o=Qf(e.i,e.x,e.y),u=i.next,p=e.prev;return i.next=e,e.prev=i,n.next=u,u.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function _a(i,e,n,o){const u=Qf(i,e,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function va(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Qf(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Sr{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class zd{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}zd.noSubdivision=new zd({fill:new Sr(0,0),line:new Sr(0,0),tile:new Sr(0,0),stencil:new Sr(0,0),circle:1}),kt("SubdivisionGranularityExpression",Sr),kt("SubdivisionGranularitySetting",zd);const Fa=-32768,ro=32767;class bl{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=xt/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(n),p=this._getKey(o,u);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const g=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,g),this._vertexBuffer.push(o,u),g}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,p){const g=[];for(let x=0;x<p.length;x+=3){const T=p[x],C=p[x+1],I=p[x+2],L=u[2*T],B=u[2*T+1];(u[2*C]-L)*(u[2*I+1]-B)-(u[2*C+1]-B)*(u[2*I]-L)>0?(g.push(T),g.push(I),g.push(C)):(g.push(T),g.push(C),g.push(I))}return g})(this._vertexBuffer,e);const n=[],o=e.length;for(let u=0;u<o;u+=3){const p=[e[u+0],e[u+1],e[u+2]],g=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let x=1/0,T=1/0,C=-1/0,I=-1/0;for(let G=0;G<3;G++){const Y=g[2*G],J=g[2*G+1];x=Math.min(x,Y),C=Math.max(C,Y),T=Math.min(T,J),I=Math.max(I,J)}if(x===C||T===I)continue;const L=Math.floor(x/this._granularityCellSize),B=Math.ceil(C/this._granularityCellSize),F=Math.floor(T/this._granularityCellSize),q=Math.ceil(I/this._granularityCellSize);if(L!==B||F!==q)for(let G=F;G<q;G++){const Y=this._scanlineGenerateVertexRingForCellRow(G,g,p);ao(this._vertexBuffer,Y,n)}else n.push(...p)}return n}_scanlineGenerateVertexRingForCellRow(e,n,o){const u=e*this._granularityCellSize,p=u+this._granularityCellSize,g=[];for(let x=0;x<3;x++){const T=n[2*x],C=n[2*x+1],I=n[2*(x+1)%6],L=n[(2*(x+1)+1)%6],B=n[2*(x+2)%6],F=n[(2*(x+2)+1)%6],q=I-T,G=L-C,Y=q===0,J=G===0,he=(u-C)/G,ee=(p-C)/G,ie=Math.min(he,ee),ge=Math.max(he,ee);if(!J&&(ie>=1||ge<=0)||J&&(C<u||C>p)){L>=u&&L<=p&&g.push(o[(x+1)%3]);continue}!J&&ie>0&&g.push(this._vertexToIndex(T+q*ie,C+G*ie));const be=T+q*Math.max(ie,0),Ue=T+q*Math.min(ge,1);Y||this._generateIntraEdgeVertices(g,T,C,I,L,be,Ue),!J&&ge<1&&g.push(this._vertexToIndex(T+q*ge,C+G*ge)),(J||L>=u&&L<=p)&&g.push(o[(x+1)%3]),!J&&(L<=u||L>=p)&&this._generateInterEdgeVertices(g,T,C,I,L,B,F,Ue,u,p)}return g}_generateIntraEdgeVertices(e,n,o,u,p,g,x){const T=u-n,C=p-o,I=C===0,L=I?Math.min(n,u):Math.min(g,x),B=I?Math.max(n,u):Math.max(g,x),F=Math.floor(L/this._granularityCellSize)+1,q=Math.ceil(B/this._granularityCellSize)-1;if(I?n<u:g<x)for(let G=F;G<=q;G++){const Y=G*this._granularityCellSize;e.push(this._vertexToIndex(Y,o+C*(Y-n)/T))}else for(let G=q;G>=F;G--){const Y=G*this._granularityCellSize;e.push(this._vertexToIndex(Y,o+C*(Y-n)/T))}}_generateInterEdgeVertices(e,n,o,u,p,g,x,T,C,I){const L=p-o,B=g-u,F=x-p,q=(C-p)/F,G=(I-p)/F,Y=Math.min(q,G),J=Math.max(q,G),he=u+B*Y;let ee=Math.floor(Math.min(he,T)/this._granularityCellSize)+1,ie=Math.ceil(Math.max(he,T)/this._granularityCellSize)-1,ge=T<he;const be=F===0;if(be&&(x===C||x===I))return;if(be||Y>=1||J<=0){const st=o-x,Qe=g+(n-g)*Math.min((C-x)/st,(I-x)/st);ee=Math.floor(Math.min(Qe,T)/this._granularityCellSize)+1,ie=Math.ceil(Math.max(Qe,T)/this._granularityCellSize)-1,ge=T<Qe}const Ue=L>0?I:C;if(ge)for(let st=ee;st<=ie;st++)e.push(this._vertexToIndex(st*this._granularityCellSize,Ue));else for(let st=ie;st>=ee;st--)e.push(this._vertexToIndex(st*this._granularityCellSize,Ue))}_generateOutline(e){const n=[];for(const o of e){const u=wl(o,this._granularity,!0),p=this._pointArrayToIndices(u),g=[];for(let x=1;x<p.length;x++)g.push(p[x-1]),g.push(p[x]);n.push(g)}return n}_handlePoles(e){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(e,n,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const o=e[n+1];o===Fa&&(e[n+1]=-32767),o===ro&&(e[n+1]=32766)}}_generatePoleQuad(e,n,o,u,p,g){u>p!=(g===Fa)?(e.push(n),e.push(o),e.push(this._vertexToIndex(u,g)),e.push(o),e.push(this._vertexToIndex(p,g)),e.push(this._vertexToIndex(u,g))):(e.push(o),e.push(n),e.push(this._vertexToIndex(u,g)),e.push(this._vertexToIndex(p,g)),e.push(o),e.push(this._vertexToIndex(u,g)))}_fillPoles(e,n,o){const u=this._vertexBuffer,p=xt,g=e.length;for(let x=2;x<g;x+=3){const T=e[x-2],C=e[x-1],I=e[x],L=u[2*T],B=u[2*T+1],F=u[2*C],q=u[2*C+1],G=u[2*I],Y=u[2*I+1];n&&(B===0&&q===0&&this._generatePoleQuad(e,T,C,L,F,Fa),q===0&&Y===0&&this._generatePoleQuad(e,C,I,F,G,Fa),Y===0&&B===0&&this._generatePoleQuad(e,I,T,G,L,Fa)),o&&(B===p&&q===p&&this._generatePoleQuad(e,T,C,L,F,ro),q===p&&Y===p&&this._generatePoleQuad(e,C,I,F,G,ro),Y===p&&B===p&&this._generatePoleQuad(e,I,T,G,L,ro))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(x){const T=[],C=[];for(const I of x)if(I.length!==0){I!==x[0]&&T.push(C.length/2);for(let L=0;L<I.length;L++)C.push(I[L].x),C.push(I[L].y)}return{flattened:C,holeIndices:T}})(e);let p;this._initializeVertices(o);try{const x=(function(C,I,L=2){const B=I&&I.length,F=B?I[0]*L:C.length;let q=Wf(C,0,F,L,!0);const G=[];if(!q||q.next===q.prev)return G;let Y,J,he;if(B&&(q=(function(ee,ie,ge,be){const Ue=[];for(let st=0,Qe=ie.length;st<Qe;st++){const mt=Wf(ee,ie[st]*be,st<Qe-1?ie[st+1]*be:ee.length,be,!1);mt===mt.next&&(mt.steiner=!0),Ue.push(Qy(mt))}Ue.sort(pr);for(let st=0;st<Ue.length;st++)ge=cm(Ue[st],ge);return ge})(C,I,q,L)),C.length>80*L){Y=C[0],J=C[1];let ee=Y,ie=J;for(let ge=L;ge<F;ge+=L){const be=C[ge],Ue=C[ge+1];be<Y&&(Y=be),Ue<J&&(J=Ue),be>ee&&(ee=be),Ue>ie&&(ie=Ue)}he=Math.max(ee-Y,ie-J),he=he!==0?32767/he:0}return bu(q,G,L,Y,J,he,0),G})(o,u),T=this._convertIndices(o,x);p=this._subdivideTrianglesScanline(T)}catch(x){console.error(x)}let g=[];return n&&(g=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:g}}_convertIndices(e,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(e[2*n[u]],e[2*n[u]+1]));return o}_pointArrayToIndices(e){const n=[];for(let o=0;o<e.length;o++){const u=e[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function Jf(i,e,n,o=!0){return new bl(n,e).subdividePolygonInternal(i,o)}function wl(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const o=i[0],u=i[i.length-1],p=n&&(o.x!==u.x||o.y!==u.y);if(e<2)return p?[...i,i[0]]:[...i];const g=Math.floor(xt/e),x=[];x.push(new N(i[0].x,i[0].y));const T=i.length,C=p?T:T-1;for(let I=0;I<C;I++){const L=i[I],B=I<T-1?i[I+1]:i[0],F=L.x,q=L.y,G=B.x,Y=B.y,J=F!==G,he=q!==Y;if(!J&&!he)continue;const ee=G-F,ie=Y-q,ge=Math.abs(ee),be=Math.abs(ie);let Ue=F,st=q;for(;;){const mt=ee>0?(Math.floor(Ue/g)+1)*g:(Math.ceil(Ue/g)-1)*g,Ct=ie>0?(Math.floor(st/g)+1)*g:(Math.ceil(st/g)-1)*g,yt=Math.abs(Ue-mt),tt=Math.abs(st-Ct),$e=Math.abs(Ue-G),Ot=Math.abs(st-Y),Rt=J?yt/ge:Number.POSITIVE_INFINITY,Ft=he?tt/be:Number.POSITIVE_INFINITY;if(($e<=yt||!J)&&(Ot<=tt||!he))break;if(Rt<Ft&&J||!he){Ue=mt,st+=ie*Rt;const It=new N(Ue,Math.round(st));x[x.length-1].x===It.x&&x[x.length-1].y===It.y||x.push(It)}else{Ue+=ee*Ft,st=Ct;const It=new N(Math.round(Ue),st);x[x.length-1].x===It.x&&x[x.length-1].y===It.y||x.push(It)}}const Qe=new N(G,Y);x[x.length-1].x===Qe.x&&x[x.length-1].y===Qe.y||x.push(Qe)}return x}function ao(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=i[2*e[0]];for(let T=1;T<e.length;T++){const C=i[2*e[T]];C<u&&(u=C,o=T)}const p=e.length;let g=o,x=(g+1)%p;for(;;){const T=g-1>=0?g-1:p-1,C=(x+1)%p,I=i[2*e[T]],L=i[2*e[C]],B=i[2*e[g]],F=i[2*e[g]+1],q=i[2*e[x]+1];let G=!1;if(I<L)G=!0;else if(I>L)G=!1;else{const Y=q-F,J=-(i[2*e[x]]-B),he=F<q?1:-1;((I-B)*Y+(i[2*e[T]+1]-F)*J)*he>((L-B)*Y+(i[2*e[C]+1]-F)*J)*he&&(G=!0)}if(G){const Y=e[T],J=e[g],he=e[x];Y!==J&&Y!==he&&J!==he&&n.push(he,J,Y),g--,g<0&&(g=p-1)}else{const Y=e[C],J=e[g],he=e[x];Y!==J&&Y!==he&&J!==he&&n.push(he,J,Y),x++,x>=p&&(x=0)}if(T===C)break}}function dm(i,e,n,o,u,p,g,x,T){const C=u.length/2,I=g&&x&&T;if(C<At.MAX_VERTEX_ARRAY_LENGTH){const L=e.prepareSegment(C,n,o),B=L.vertexLength;for(let G=0;G<p.length;G+=3)o.emplaceBack(B+p[G],B+p[G+1],B+p[G+2]);let F,q;L.vertexLength+=C,L.primitiveLength+=p.length/3,I&&(q=g.prepareSegment(C,n,x),F=q.vertexLength,q.vertexLength+=C);for(let G=0;G<u.length;G+=2)i(u[G],u[G+1]);if(I)for(let G=0;G<T.length;G++){const Y=T[G];for(let J=1;J<Y.length;J+=2)x.emplaceBack(F+Y[J-1],F+Y[J]);q.primitiveLength+=Y.length/2}}else(function(L,B,F,q,G,Y){const J=[];for(let be=0;be<q.length/2;be++)J.push(-1);const he={count:0};let ee=0,ie=L.getOrCreateLatestSegment(B,F),ge=ie.vertexLength;for(let be=2;be<G.length;be+=3){const Ue=G[be-2],st=G[be-1],Qe=G[be];let mt=J[Ue]<ee,Ct=J[st]<ee,yt=J[Qe]<ee;ie.vertexLength+((mt?1:0)+(Ct?1:0)+(yt?1:0))>At.MAX_VERTEX_ARRAY_LENGTH&&(ie=L.createNewSegment(B,F),ee=he.count,mt=!0,Ct=!0,yt=!0,ge=0);const tt=No(J,q,Y,he,Ue,mt,ie),$e=No(J,q,Y,he,st,Ct,ie),Ot=No(J,q,Y,he,Qe,yt,ie);F.emplaceBack(ge+tt-ee,ge+$e-ee,ge+Ot-ee),ie.primitiveLength++}})(e,n,o,u,p,i),I&&(function(L,B,F,q,G,Y){const J=[];for(let be=0;be<q.length/2;be++)J.push(-1);const he={count:0};let ee=0,ie=L.getOrCreateLatestSegment(B,F),ge=ie.vertexLength;for(let be=0;be<G.length;be++){const Ue=G[be];for(let st=1;st<G[be].length;st+=2){const Qe=Ue[st-1],mt=Ue[st];let Ct=J[Qe]<ee,yt=J[mt]<ee;ie.vertexLength+((Ct?1:0)+(yt?1:0))>At.MAX_VERTEX_ARRAY_LENGTH&&(ie=L.createNewSegment(B,F),ee=he.count,Ct=!0,yt=!0,ge=0);const tt=No(J,q,Y,he,Qe,Ct,ie),$e=No(J,q,Y,he,mt,yt,ie);F.emplaceBack(ge+tt-ee,ge+$e-ee),ie.primitiveLength++}}})(g,n,x,u,T,i),e.forceNewSegmentOnNextPrepare(),g?.forceNewSegmentOnNextPrepare()}function No(i,e,n,o,u,p,g){if(p){const x=o.count;return n(e[2*u],e[2*u+1]),i[u]=o.count,o.count++,g.vertexLength++,x}return i[u]}class wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new oe,this.indexArray=new Ge,this.indexArray2=new St,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new At,this.segments2=new At,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=as("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),g=[];for(const{feature:x,id:T,index:C,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,B=rs(x,L);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),B,o))continue;const F=p?u.evaluate(B,{},o,n.availableImages):void 0,q={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:C,geometry:L?B.geometry:io(x),patterns:{},sortKey:F};g.push(q)}p&&g.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of g){const{geometry:T,index:C,sourceLayerIndex:I}=x;if(this.hasDependencies){const L=Yf("fill",this.layers,x,{zoom:this.zoom},n);this.patternFeatures.push(L)}else this.addFeature(x,T,C,o,{},n.subdivisionGranularity);n.featureIndex.insert(e[C].feature,T,C,I,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,u,p,g){for(const x of Xc(n,500)){const T=Jf(x,u,g.fill.getGranularityForZoomLevel(u.z)),C=this.layoutVertexArray;dm(((I,L)=>{C.emplaceBack(I,L)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:u})}}let wh,Tu;kt("FillBucket",wu,{omit:["layers","patternFeatures"]});var Eg={get paint(){return Tu=Tu||new Ui({"fill-antialias":new Lt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Vt(Fe.paint_fill["fill-opacity"]),"fill-color":new Vt(Fe.paint_fill["fill-color"]),"fill-outline-color":new Vt(Fe.paint_fill["fill-outline-color"]),"fill-translate":new Lt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Lt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ra(Fe.paint_fill["fill-pattern"])})},get layout(){return wh=wh||new Ui({"fill-sort-key":new Vt(Fe.layout_fill["fill-sort-key"])})}};class Mg extends wi{constructor(e,n){super(e,Eg,n)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new wu(e)}queryRadius(){return yd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:o,pixelsToTileUnits:u}){return Ff(Uf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const Dd=gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ag=gi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ep}=Dd;class Th{constructor(e,n,o,u,p){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(Jy,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,o=[];let u,p=1,g=0,x=0,T=0;for(;e.pos<n;){if(g<=0){const C=e.readVarint();p=7&C,g=C>>3}if(g--,p===1||p===2)x+=e.readSVarint(),T+=e.readSVarint(),p===1&&(u&&o.push(u),u=[]),u&&u.push(new N(x,T));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let o=1,u=0,p=0,g=0,x=1/0,T=-1/0,C=1/0,I=-1/0;for(;e.pos<n;){if(u<=0){const L=e.readVarint();o=7&L,u=L>>3}if(u--,o===1||o===2)p+=e.readSVarint(),g+=e.readSVarint(),p<x&&(x=p),p>T&&(T=p),g<C&&(C=g),g>I&&(I=g);else if(o!==7)throw new Error(`unknown command ${o}`)}return[x,C,T,I]}toGeoJSON(e,n,o){const u=this.extent*Math.pow(2,o),p=this.extent*e,g=this.extent*n,x=this.loadGeometry();function T(B){return[360*(B.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+g)/u)*Math.PI))-90]}function C(B){return B.map(T)}let I;if(this.type===1){const B=[];for(const q of x)B.push(q[0]);const F=C(B);I=B.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){const B=x.map(C);I=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=Cg(x),F=[];for(const q of B)F.push(q.map(C));I=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const L={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(L.id=this.id),L}}function Jy(i,e,n){i===1?e.id=n.readVarint():i===2?(function(o,u){const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=u._keys[o.readVarint()],x=u._values[o.readVarint()];u.properties[g]=x}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function Cg(i){const e=i.length;if(e<=1)return[i];const n=[];let o,u;for(let p=0;p<e;p++){const g=ni(i[p]);g!==0&&(u===void 0&&(u=g<0),u===g<0?(o&&n.push(o),o=[i[p]]):o&&o.push(i[p]))}return o&&n.push(o),n}function ni(i){let e=0;for(let n,o,u=0,p=i.length,g=p-1;u<p;g=u++)n=i[u],o=i[g],e+=(o.x-n.x)*(n.y+o.y);return e}Th.types=["Unknown","Point","LineString","Polygon"];class _i{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(An,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Th(this._pbf,n,this.extent,this._keys,this._values)}}function An(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(o){let u=null;const p=o.readVarint()+o.pos;for(;o.pos<p;){const g=o.readVarint()>>3;u=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(n))}class Cn{constructor(e,n){this.layers=e.readFields(si,{},n)}}function si(i,e,n){if(i===3){const o=new _i(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}const xa=Math.pow(2,13);function Os(i,e,n,o,u,p,g,x){i.emplaceBack(e,n,2*Math.floor(o*xa)+g,u*xa*2,p*xa*2,Math.round(x))}class hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ue,this.centroidVertexArray=new se,this.indexArray=new Ge,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new At,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.features=[],this.hasDependencies=as("fill-extrusion",this.layers,n);for(const{feature:u,id:p,index:g,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,C=rs(u,T);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),C,o))continue;const I={id:p,sourceLayerIndex:x,index:g,geometry:T?C.geometry:io(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Yf("fill-extrusion",this.layers,I,{zoom:this.zoom},n)):this.addFeature(I,I.geometry,g,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,I.geometry,g,x,this.index,!0)}}addFeatures(e,n,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,n,o,e.subdivisionGranularity)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ep),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ag.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,u,p,g){for(const x of Xc(n,500)){const T={x:0,y:0,sampleCount:0},C=this.layoutVertexArray.length;this.processPolygon(T,u,e,x,g);const I=this.layoutVertexArray.length-C,L=Math.floor(T.x/T.sampleCount),B=Math.floor(T.y/T.sampleCount);for(let F=0;F<I;F++)this.centroidVertexArray.emplaceBack(L,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,canonical:u})}processPolygon(e,n,o,u,p){if(u.length<1||Xi(u[0]))return;for(const L of u)L.length!==0&&fm(e,L);const g={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=p.fill.getGranularityForZoomLevel(n.z),T=Th.types[o.type]==="Polygon";for(const L of u){if(L.length===0||Xi(L))continue;const B=wl(L,x,T);this._generateSideFaces(B,g)}if(!T)return;const C=Jf(u,n,x,!1),I=this.layoutVertexArray;dm(((L,B)=>{Os(I,L,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles)}_generateSideFaces(e,n){let o=0;for(let u=1;u<e.length;u++){const p=e[u],g=e[u-1];if(Tl(p,g))continue;n.segment.vertexLength+4>At.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=p.sub(g)._perp()._unit(),T=g.dist(p);o+T>32768&&(o=0),Os(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,0,o),Os(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,1,o),o+=T,Os(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,0,o),Os(this.layoutVertexArray,g.x,g.y,x.x,x.y,0,1,o);const C=n.segment.vertexLength;this.indexArray.emplaceBack(C,C+2,C+1),this.indexArray.emplaceBack(C+1,C+2,C+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function fm(i,e){for(let n=0;n<e.length;n++){const o=e[n];n===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(i.x+=o.x,i.y+=o.y,i.sampleCount++)}}function Tl(i,e){return i.x===e.x&&(i.x<0||i.x>xt)||i.y===e.y&&(i.y<0||i.y>xt)}function Xi(i){return i.every((e=>e.x<0))||i.every((e=>e.x>xt))||i.every((e=>e.y<0))||i.every((e=>e.y>xt))}let Sl;kt("FillExtrusionBucket",hc,{omit:["layers","features"]});var Su={get paint(){return Sl=Sl||new Ui({"fill-extrusion-opacity":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ra(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vt(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class pm extends wi{constructor(e,n){super(e,Su,n)}createBucket(e){return new hc(e)}queryRadius(){return yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g,pixelPosMatrix:x}){const T=Uf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,g),C=this.paint.get("fill-extrusion-height").evaluate(n,o),I=this.paint.get("fill-extrusion-base").evaluate(n,o),L=(function(F,q){const G=[];for(const Y of F){const J=[Y.x,Y.y,0,1];qt(J,J,q),G.push(new N(J[0]/J[3],J[1]/J[3]))}return G})(T,x),B=(function(F,q,G,Y){const J=[],he=[],ee=Y[8]*q,ie=Y[9]*q,ge=Y[10]*q,be=Y[11]*q,Ue=Y[8]*G,st=Y[9]*G,Qe=Y[10]*G,mt=Y[11]*G;for(const Ct of F){const yt=[],tt=[];for(const $e of Ct){const Ot=$e.x,Rt=$e.y,Ft=Y[0]*Ot+Y[4]*Rt+Y[12],It=Y[1]*Ot+Y[5]*Rt+Y[13],Ht=Y[2]*Ot+Y[6]*Rt+Y[14],On=Y[3]*Ot+Y[7]*Rt+Y[15],vn=Ht+ge,Li=On+be,na=Ft+Ue,vr=It+st,Oi=Ht+Qe,Si=On+mt,Wn=new N((Ft+ee)/Li,(It+ie)/Li);Wn.z=vn/Li,yt.push(Wn);const Yi=new N(na/Si,vr/Si);Yi.z=Oi/Si,tt.push(Yi)}J.push(yt),he.push(tt)}return[J,he]})(u,I,C,x);return(function(F,q,G){let Y=1/0;Ff(G,q)&&(Y=Eu(G,q[0]));for(let J=0;J<q.length;J++){const he=q[J],ee=F[J];for(let ie=0;ie<he.length-1;ie++){const ge=he[ie],be=[ge,he[ie+1],ee[ie+1],ee[ie],ge];xu(G,be)&&(Y=Math.min(Y,Eu(G,be)))}}return Y!==1/0&&Y})(B[0],B[1],L)}}function qr(i,e){return i.x*e.x+i.y*e.y}function Eu(i,e){if(i.length===1){let n=0;const o=e[n++];let u;for(;!u||o.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const p=e[n],g=i[0],x=u.sub(o),T=p.sub(o),C=g.sub(o),I=qr(x,x),L=qr(x,T),B=qr(T,T),F=qr(C,x),q=qr(C,T),G=I*B-L*L,Y=(B*F-L*q)/G,J=(I*q-L*F)/G,he=o.z*(1-Y-J)+u.z*Y+p.z*J;if(isFinite(he))return he}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const Pd=gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ja}=Pd,mm=gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tp}=mm,zg=Math.cos(Math.PI/180*37.5),Id=Math.pow(2,14)/.5;class Sh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new ve,this.layoutVertexArray2=new ce,this.indexArray=new Ge,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new At,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,o){this.hasDependencies=as("line",this.layers,n)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),g=[];for(const{feature:x,id:T,index:C,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,B=rs(x,L);if(!this.layers[0]._featureFilter.filter(new Vn(this.zoom),B,o))continue;const F=p?u.evaluate(B,{},o):void 0,q={id:T,properties:x.properties,type:x.type,sourceLayerIndex:I,index:C,geometry:L?B.geometry:io(x),patterns:{},dashes:{},sortKey:F};g.push(q)}p&&g.sort(((x,T)=>x.sortKey-T.sortKey));for(const x of g){const{geometry:T,index:C,sourceLayerIndex:I}=x;this.hasDependencies?(as("line",this.layers,n)?Yf("line",this.layers,x,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,n),this.patternFeatures.push(x)):this.addFeature(x,T,C,o,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[C].feature,T,C,I,this.index)}}update(e,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,n,o,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,tp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ja),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,u,p,g,x){const T=this.layers[0].layout,C=T.get("line-join").evaluate(e,{}),I=T.get("line-cap"),L=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of n)this.addLine(F,e,C,I,L,B,u,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:p,dashPositions:g,canonical:u})}addLine(e,n,o,u,p,g,x,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=wl(e,x?T.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=Th.types[n.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let L=0;for(;L<I-1&&e[L].equals(e[L+1]);)L++;if(I<(C?3:2))return;o==="bevel"&&(p=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let q,G,Y,J,he;this.e1=this.e2=-1,C&&(q=e[I-2],he=e[L].sub(q)._unit()._perp());for(let ee=L;ee<I;ee++){if(Y=ee===I-1?C?e[L+1]:void 0:e[ee+1],Y&&e[ee].equals(Y))continue;he&&(J=he),q&&(G=q),q=e[ee],he=Y?Y.sub(q)._unit()._perp():J,J=J||he;let ie=J.add(he);ie.x===0&&ie.y===0||ie._unit();const ge=J.x*he.x+J.y*he.y,be=ie.x*he.x+ie.y*he.y,Ue=be!==0?1/be:1/0,st=2*Math.sqrt(2-2*be),Qe=be<zg&&G&&Y,mt=J.x*he.y-J.y*he.x>0;if(Qe&&ee>L){const tt=q.dist(G);if(tt>2*B){const $e=q.sub(q.sub(G)._mult(B/tt)._round());this.updateDistance(G,$e),this.addCurrentVertex($e,J,0,0,F),G=$e}}const Ct=G&&Y;let yt=Ct?o:C?"butt":u;if(Ct&&yt==="round"&&(Ue<g?yt="miter":Ue<=2&&(yt="fakeround")),yt==="miter"&&Ue>p&&(yt="bevel"),yt==="bevel"&&(Ue>2&&(yt="flipbevel"),Ue<p&&(yt="miter")),G&&this.updateDistance(G,q),yt==="miter")ie._mult(Ue),this.addCurrentVertex(q,ie,0,0,F);else if(yt==="flipbevel"){if(Ue>100)ie=he.mult(-1);else{const tt=Ue*J.add(he).mag()/J.sub(he).mag();ie._perp()._mult(tt*(mt?-1:1))}this.addCurrentVertex(q,ie,0,0,F),this.addCurrentVertex(q,ie.mult(-1),0,0,F)}else if(yt==="bevel"||yt==="fakeround"){const tt=-Math.sqrt(Ue*Ue-1),$e=mt?tt:0,Ot=mt?0:tt;if(G&&this.addCurrentVertex(q,J,$e,Ot,F),yt==="fakeround"){const Rt=Math.round(180*st/Math.PI/20);for(let Ft=1;Ft<Rt;Ft++){let It=Ft/Rt;if(It!==.5){const On=It-.5;It+=It*On*(It-1)*((1.0904+ge*(ge*(3.55645-1.43519*ge)-3.2452))*On*On+(.848013+ge*(.215638*ge-1.06021)))}const Ht=he.sub(J)._mult(It)._add(J)._unit()._mult(mt?-1:1);this.addHalfVertex(q,Ht.x,Ht.y,!1,mt,0,F)}}Y&&this.addCurrentVertex(q,he,-$e,-Ot,F)}else if(yt==="butt")this.addCurrentVertex(q,ie,0,0,F);else if(yt==="square"){const tt=G?1:-1;this.addCurrentVertex(q,ie,tt,tt,F)}else yt==="round"&&(G&&(this.addCurrentVertex(q,J,0,0,F),this.addCurrentVertex(q,J,1,1,F,!0)),Y&&(this.addCurrentVertex(q,he,-1,-1,F,!0),this.addCurrentVertex(q,he,0,0,F)));if(Qe&&ee<I-1){const tt=q.dist(Y);if(tt>2*B){const $e=q.add(Y.sub(q)._mult(B/tt)._round());this.updateDistance(q,$e),this.addCurrentVertex($e,he,0,0,F),q=$e}}}}addCurrentVertex(e,n,o,u,p,g=!1){const x=n.y*u-n.x,T=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,p),this.addHalfVertex(e,x,T,g,!0,-u,p),this.distance>Id/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,u,p,g))}addHalfVertex({x:e,y:n},o,u,p,g,x,T){const C=.5*(this.lineClips?this.scaledDistance*(Id-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),T.primitiveLength++),g?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const o=n.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,n,o,u){for(const p of e){const g=p.paint.get("line-dasharray");if(!g||g.value.kind==="constant")continue;const x=p.layout.get("line-cap")==="round",T={dasharray:g.value.evaluate({zoom:o-1},n,{}),round:x},C={dasharray:g.value.evaluate({zoom:o},n,{}),round:x},I={dasharray:g.value.evaluate({zoom:o+1},n,{}),round:x},L=`${T.dasharray.join(",")},${T.round}`,B=`${C.dasharray.join(",")},${C.round}`,F=`${I.dasharray.join(",")},${I.round}`;u.dashDependencies[L]=T,u.dashDependencies[B]=C,u.dashDependencies[F]=I,n.dashes[p.id]={min:L,mid:B,max:F}}}}let El,gr;kt("LineBucket",Sh,{omit:["layers","patternFeatures"]});var Ml={get paint(){return gr=gr||new Ui({"line-opacity":new Vt(Fe.paint_line["line-opacity"]),"line-color":new Vt(Fe.paint_line["line-color"]),"line-translate":new Lt(Fe.paint_line["line-translate"]),"line-translate-anchor":new Lt(Fe.paint_line["line-translate-anchor"]),"line-width":new Vt(Fe.paint_line["line-width"]),"line-gap-width":new Vt(Fe.paint_line["line-gap-width"]),"line-offset":new Vt(Fe.paint_line["line-offset"]),"line-blur":new Vt(Fe.paint_line["line-blur"]),"line-dasharray":new Ra(Fe.paint_line["line-dasharray"]),"line-pattern":new Ra(Fe.paint_line["line-pattern"]),"line-gradient":new fu(Fe.paint_line["line-gradient"])})},get layout(){return El=El||new Ui({"line-cap":new Lt(Fe.layout_line["line-cap"]),"line-join":new Vt(Fe.layout_line["line-join"]),"line-miter-limit":new Lt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new Lt(Fe.layout_line["line-round-limit"]),"line-sort-key":new Vt(Fe.layout_line["line-sort-key"])})}};class Eh extends Vt{possiblyEvaluate(e,n){return n=new Vn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,u){return n=mn({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,u)}}let Bs;class gm extends wi{constructor(e,n){super(e,Ml,n),this.gradientVersion=0,Bs||(Bs=new Eh(Ml.paint.properties["line-width"].specification),Bs.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof vo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Bs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Sh(e)}queryRadius(e){const n=e,o=np(_l("line-width",this,n),_l("line-gap-width",this,n)),u=_l("line-offset",this,n);return o/2+Math.abs(u)+yd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:o,geometry:u,transform:p,pixelsToTileUnits:g}){const x=Uf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,g),T=g/2*np(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),C=this.paint.get("line-offset").evaluate(n,o);return C&&(u=(function(I,L){const B=[];for(let F=0;F<I.length;F++){const q=Vf(I[F]),G=[];for(let Y=0;Y<q.length;Y++){const J=q[Y],he=q[Y-1],ee=q[Y+1],ie=Y===0?new N(0,0):J.sub(he)._unit()._perp(),ge=Y===q.length-1?new N(0,0):ee.sub(J)._unit()._perp(),be=ie._add(ge)._unit(),Ue=be.x*ge.x+be.y*ge.y;Ue!==0&&be._mult(1/Ue),G.push(be._mult(L)._add(J))}B.push(G)}return B})(u,C*g)),(function(I,L,B){for(let F=0;F<L.length;F++){const q=L[F];if(I.length>=3){for(let G=0;G<q.length;G++)if(Lo(I,q[G]))return!0}if(fr(I,q,B))return!0}return!1})(x,u,T)}isTileClipped(){return!0}}function np(i,e){return e>0?e+2*i:i}const Dg=gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kd=gi([{name:"a_projected_pos",components:3,type:"Float32"}],4);gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ym=gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ua=gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pg=gi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Va(i,e,n){return i.sections.forEach((o=>{o.text=(function(u,p,g){const x=p.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),ka.applyArabicShaping&&(u=ka.applyArabicShaping(u)),u})(o.text,e,n)})),i}gi([{name:"triangle",components:3,type:"Uint16"}]),gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),gi([{type:"Float32",name:"offsetX"}]),gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),gi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var or=24;const Mh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},e_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},dc={40:!0};function Rd(i,e,n,o,u,p){if("fontStack"in e){const g=n[e.fontStack],x=g&&g[i];return x?x.metrics.advance*e.scale+u:0}{const g=o[e.imageName];return g?g.displaySize[0]*e.scale*or/p+u:0}}function ip(i,e,n,o){const u=Math.pow(i-e,2);return o?i<e?u/2:2*u:u+Math.abs(n)*n}function Ah(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function _m(i,e,n,o,u,p){let g=null,x=ip(e,n,u,p);for(const T of o){const C=ip(e-T.x,n,u,p)+T.badness;C<=x&&(g=T,x=C)}return{index:i,x:e,priorBreak:g,badness:x}}function vm(i){return i?vm(i.priorBreak).concat(i.index):[]}class Mu{constructor(e="",n=[],o=[]){this.text=e,this.sections=n,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,n){const o=new Mu;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let p=u.next();const g=e[Symbol.iterator]();g.next();let x=g.next();for(;!p.done;)n+=!x.done&&Ps(x.value.codePointAt(0))&&!Mh[x.value]||!o.premature&&Ps(o.value.codePointAt(0))&&!Mh[o.value]||!Mh[p.value]?p.value:Mh[p.value],o={value:p.value,premature:!1},p=u.next(),x=g.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(n,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-u)}substring(e,n){const o=[...this.text].slice(e,n).join(""),u=this.sectionIndex.slice(e,n);return new Mu(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,o=0;for(let u=0;u<this.length();u++){const p=this.getSection(u);if("imageName"in p){const g=e[p.imageName];if(!g)continue;const x=g.displaySize;n=Math.max(n,x[0]),o=Math.max(o,x[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Dn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):Dn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,o,u,p){const g=[],x=this.determineAverageLineWidth(e,n,o,u,p),T=this.hasZeroWidthSpaces();let C=0,I=0;const L=this.text[Symbol.iterator]();let B=L.next();const F=this.text[Symbol.iterator]();F.next();let q=F.next();const G=this.text[Symbol.iterator]();G.next(),G.next();let Y=G.next();for(;!B.done;){const J=this.getSection(I),he=B.value.codePointAt(0);if(lu(he)||(C+=Rd(he,J,o,u,e,p)),!q.done){const ee=Cs(he),ie=q.value.codePointAt(0);(e_[he]||ee||"imageName"in J||!Y.done&&dc[ie])&&g.push(_m(I+1,C,x,g,Ah(he,ie,ee&&T),!1))}I++,B=L.next(),q=F.next(),Y=G.next()}return vm(_m(this.length(),C,x,g,0,!0))}determineAverageLineWidth(e,n,o,u,p){let g=0,x=0;for(const T of this.text){const C=this.getSection(x);g+=Rd(T.codePointAt(0),C,o,u,e,p),x++}return g/Math.max(1,Math.ceil(g/n))}}const rp=4294967296,Ld=1/rp,ap=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class sp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,o=this.length){for(;this.pos<o;){const u=this.readVarint(),p=u>>3,g=this.pos;this.type=7&u,e(p,n,this),this.pos===g&&this.skip(u)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*rp;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*rp;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let o,u;return u=n[this.pos++],o=127&u,u<128?o:(u=n[this.pos++],o|=(127&u)<<7,u<128?o:(u=n[this.pos++],o|=(127&u)<<14,u<128?o:(u=n[this.pos++],o|=(127&u)<<21,u<128?o:(u=n[this.pos],o|=(15&u)<<28,(function(p,g,x){const T=x.buf;let C,I;if(I=T[x.pos++],C=(112&I)>>4,I<128||(I=T[x.pos++],C|=(127&I)<<3,I<128)||(I=T[x.pos++],C|=(127&I)<<10,I<128)||(I=T[x.pos++],C|=(127&I)<<17,I<128)||(I=T[x.pos++],C|=(127&I)<<24,I<128)||(I=T[x.pos++],C|=(1&I)<<31,I<128))return Ch(p,C,g);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&ap?ap.decode(this.buf.subarray(n,e)):(function(o,u,p){let g="",x=u;for(;x<p;){const T=o[x];let C,I,L,B=null,F=T>239?4:T>223?3:T>191?2:1;if(x+F>p)break;F===1?T<128&&(B=T):F===2?(C=o[x+1],(192&C)==128&&(B=(31&T)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],I=o[x+2],(192&C)==128&&(192&I)==128&&(B=(15&T)<<12|(63&C)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],I=o[x+2],L=o[x+3],(192&C)==128&&(192&I)==128&&(192&L)==128&&(B=(15&T)<<18|(63&C)<<12|(63&I)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),x+=F}return g})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ld),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ld),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,o){let u,p;if(n>=0?(u=n%4294967296|0,p=n/4294967296|0):(u=~(-n%4294967296),p=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(g,x,T){T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,g>>>=7,T.buf[T.pos++]=127&g|128,T.buf[T.pos]=127&(g>>>=7)})(u,0,o),(function(g,x){const T=(7&g)<<4;x.buf[x.pos++]|=T|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))})(p,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(u,p,g){for(let x,T,C=0;C<p.length;C++){if(x=p.charCodeAt(C),x>55295&&x<57344){if(!T){x>56319||C+1===p.length?(u[g++]=239,u[g++]=191,u[g++]=189):T=x;continue}if(x<56320){u[g++]=239,u[g++]=191,u[g++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(u[g++]=239,u[g++]=191,u[g++]=189,T=null);x<128?u[g++]=x:(x<2048?u[g++]=x>>6|192:(x<65536?u[g++]=x>>12|224:(u[g++]=x>>18|240,u[g++]=x>>12&63|128),u[g++]=x>>6&63|128),u[g++]=63&x|128)}return g})(this.buf,e,this.pos);const o=this.pos-n;o>=128&&Ig(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,n){this.pos++;const o=this.pos;e(n,this);const u=this.pos-o;u>=128&&Ig(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,n,o){this.writeTag(e,2),this.writeRawMessage(n,o)}writePackedVarint(e,n){n.length&&this.writeMessage(e,kg,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,Rg,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,Lg,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,zh,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,op,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,Og,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,Bg,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,Ng,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,Fg,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function Ch(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Ig(i,e,n){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(let u=n.pos-1;u>=i;u--)n.buf[u+o]=n.buf[u]}function kg(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function Rg(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function zh(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function op(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function Lg(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function Og(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function Bg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Ng(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function Fg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function jg(i,e,n){i===1&&n.readMessage(lp,e)}function lp(i,e,n){if(i===3){const{id:o,bitmap:u,width:p,height:g,left:x,top:T,advance:C}=n.readMessage(Ug,{});e.push({id:o,bitmap:new xd({width:p+6,height:g+6},u),metrics:{width:p,height:g,left:x,top:T,advance:C}})}}function Ug(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function xm(i){let e=0,n=0;for(const g of i)e+=g.w*g.h,n=Math.max(n,g.w);i.sort(((g,x)=>x.h-g.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,p=0;for(const g of i)for(let x=o.length-1;x>=0;x--){const T=o[x];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===T.w&&g.h===T.h){const C=o.pop();C&&x<o.length&&(o[x]=C)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(o.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}class ii{constructor(e,{pixelRatio:n,version:o,stretchX:u,stretchY:p,content:g,textFitWidth:x,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=p,this.content=g,this.version=o,this.textFitWidth=x,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class cp{constructor(e,n){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,p),this.addImages(n,u,p);const{w:g,h:x}=xm(p),T=new Qr({width:g||1,height:x||1});for(const C in e){const I=e[C],L=o[C].paddedRect;Qr.copy(I.data,T,{x:0,y:0},{x:L.x+1,y:L.y+1},I.data)}for(const C in n){const I=n[C],L=u[C].paddedRect,B=L.x+1,F=L.y+1,q=I.data.width,G=I.data.height;Qr.copy(I.data,T,{x:0,y:0},{x:B,y:F},I.data),Qr.copy(I.data,T,{x:0,y:G-1},{x:B,y:F-1},{width:q,height:1}),Qr.copy(I.data,T,{x:0,y:0},{x:B,y:F+G},{width:q,height:1}),Qr.copy(I.data,T,{x:q-1,y:0},{x:B-1,y:F},{width:1,height:G}),Qr.copy(I.data,T,{x:0,y:0},{x:B+q,y:F},{width:1,height:G})}this.image=T,this.iconPositions=o,this.patternPositions=u}addImages(e,n,o){for(const u in e){const p=e[u],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(g),n[u]=new ii(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,p]=e.tl;o.update(n.data,void 0,{x:u,y:p})}}var fc;function Od(i,e,n,o,u,p,g,x,T,C,I,L,B,F,q){const G=Mu.fromFeature(i,u);let Y;L===A.az.vertical&&G.verticalizePunctuation();let J=G.determineLineBreaks(C,p,e,o,F);const{processBidirectionalText:he,processStyledBidirectionalText:ee}=ka;if(he&&G.sections.length===1){Y=[],J=J.map((Ue=>G.toCodeUnitIndex(Ue)));const be=he(G.toString(),J);for(const Ue of be){const st=[...Ue].map((()=>0));Y.push(new Mu(Ue,G.sections,st))}}else if(ee){Y=[],J=J.map((Qe=>G.toCodeUnitIndex(Qe)));let be=0;const Ue=[];for(const Qe of G.text)Ue.push(...Array(Qe.length).fill(G.sectionIndex[be])),be++;const st=ee(G.text,Ue,J);for(const Qe of st){const mt=[];let Ct="";for(const yt of Qe[0])mt.push(Qe[1][Ct.length]),Ct+=yt;Y.push(new Mu(Qe[0],G.sections,mt))}}else Y=(function(be,Ue){const st=[];let Qe=0;for(const mt of Ue)st.push(be.substring(Qe,mt)),Qe=mt;return Qe<be.length()&&st.push(be.substring(Qe,be.length())),st})(G,J);const ie=[],ge={positionedLines:ie,text:G.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:L,iconsInText:!1,verticalizable:!1};return(function(be,Ue,st,Qe,mt,Ct,yt,tt,$e,Ot,Rt,Ft){let It=0,Ht=0,On=0,vn=0;const Li=tt==="right"?1:tt==="left"?0:.5,na=or/Ft;let vr=0;for(const Wn of mt){Wn.trim();const Yi=Wn.getMaxScale(),tr={positionedGlyphs:[],lineOffset:0};be.positionedLines[vr]=tr;const vi=tr.positionedGlyphs;let ls=0;if(!Wn.length()){Ht+=Ct,++vr;continue}const ia=t_(Qe,Wn,na);let cs=0;for(const kr of Wn.text){const qi=Wn.getSection(cs),xr=kr.codePointAt(0),Wi=up($e,Rt,xr),Rr={glyph:xr,imageName:null,x:It,y:Ht+-17,vertical:Wi,scale:1,fontStack:"",sectionIndex:Wn.getSectionIndex(cs),metrics:null,rect:null};let Du;if("fontStack"in qi){if(Du=Dh(qi,xr,Wi,ia,Ue,st),!Du)continue;Rr.fontStack=qi.fontStack}else{if(be.iconsInText=!0,qi.scale*=na,Du=wm(qi,Wi,Yi,ia,Qe),!Du)continue;ls=Math.max(ls,Du.imageOffset),Rr.imageName=qi.imageName}const{rect:Il,metrics:ng,baselineOffset:jh}=Du;Rr.y+=jh,Rr.scale=qi.scale,Rr.metrics=ng,Rr.rect=Il,vi.push(Rr),Wi?(be.verticalizable=!0,It+=("imageName"in qi?ng.advance:or)*qi.scale+Ot):It+=ng.advance*qi.scale+Ot,cs++}vi.length!==0&&(On=Math.max(It-Ot,On),hp(vi,0,vi.length-1,Li)),It=0,tr.lineOffset=Math.max(ls,(Yi-1)*or);const Uo=Ct*Yi+ls;Ht+=Uo,vn=Math.max(Uo,vn),++vr}const{horizontalAlign:Oi,verticalAlign:Si}=bm(yt);(function(Wn,Yi,tr,vi,ls,ia,cs,Uo,kr){const qi=(Yi-tr)*ls;let xr=0;xr=ia!==cs?-Uo*vi- -17:-vi*kr*cs+.5*cs;for(const Wi of Wn)for(const Rr of Wi.positionedGlyphs)Rr.x+=qi,Rr.y+=xr})(be.positionedLines,Li,Oi,Si,On,vn,Ct,Ht,mt.length),be.top+=-Si*Ht,be.bottom=be.top+Ht,be.left+=-Oi*On,be.right=be.left+On})(ge,e,n,o,Y,g,x,T,L,C,B,q),!(function(be){for(const Ue of be)if(Ue.positionedGlyphs.length!==0)return!1;return!0})(ie)&&ge}function bm(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function t_(i,e,n){const o=e.getMaxScale()*or,{maxImageWidth:u,maxImageHeight:p}=e.getMaxImageSize(i),g=Math.max(o,p*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:g}}function Vg(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function up(i,e,n){return!(i===A.az.horizontal||!e&&!ul(n)||e&&(lu(n)||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Dh(i,e,n,o,u,p){const g=p[i.fontStack],x=(function(C,I,L,B){if(C&&C.rect)return C;const F=I[L.fontStack],q=F&&F[B];return q?{rect:null,metrics:q.metrics}:null})(g&&g[e],u,i,e);if(x===null)return null;let T;if(n)T=o.verticalLineContentWidth-i.scale*or;else{const C=Vg(i.verticalAlign);T=(o.horizontalLineContentHeight-i.scale*or)*C}return{rect:x.rect,metrics:x.metrics,baselineOffset:T}}function wm(i,e,n,o,u){const p=u[i.imageName];if(!p)return null;const g=p.paddedRect,x=p.displaySize,T={width:x[0],height:x[1],left:1,top:-3,advance:e?x[1]:x[0]};let C;if(e)C=o.verticalLineContentWidth-x[1]*i.scale;else{const I=Vg(i.verticalAlign);C=(o.horizontalLineContentHeight-x[1]*i.scale)*I}return{rect:g,metrics:T,baselineOffset:C,imageOffset:(e?x[0]:x[1])*i.scale-or*n}}function hp(i,e,n,o){if(o===0)return;const u=i[n],p=(i[n].x+u.metrics.advance*u.scale)*o;for(let g=e;g<=n;g++)i[g].x-=p}function Tm(i,e,n){const{horizontalAlign:o,verticalAlign:u}=bm(n),p=e[0]-i.displaySize[0]*o,g=e[1]-i.displaySize[1]*u;return{image:i,top:g,bottom:g+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Al(i){var e,n;let o=i.left,u=i.top,p=i.right-o,g=i.bottom-u;const x=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",C=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(T==="proportional"){if(x==="stretchOnly"&&p/g<C||x==="proportional"){const I=Math.ceil(g*C);o*=I/p,p=I}}else if(x==="proportional"&&T==="stretchOnly"&&C!==0&&p/g>C){const I=Math.ceil(p/C);u*=I/g,g=I}return{x1:o,y1:u,x2:o+p,y2:u+g}}function so(i,e,n,o,u,p){const g=i.image;let x;if(g.content){const Y=g.content,J=g.pixelRatio||1;x=[Y[0]/J,Y[1]/J,g.displaySize[0]-Y[2]/J,g.displaySize[1]-Y[3]/J]}const T=e.left*p,C=e.right*p;let I,L,B,F;n==="width"||n==="both"?(F=u[0]+T-o[3],L=u[0]+C+o[1]):(F=u[0]+(T+C-g.displaySize[0])/2,L=F+g.displaySize[0]);const q=e.top*p,G=e.bottom*p;return n==="height"||n==="both"?(I=u[1]+q-o[0],B=u[1]+G+o[2]):(I=u[1]+(q+G-g.displaySize[1])/2,B=I+g.displaySize[1]),{image:g,top:I,right:L,bottom:B,left:F,collisionPadding:x}}kt("ImagePosition",ii),kt("ImageAtlas",cp),A.az=void 0,(fc=A.az||(A.az={}))[fc.none=0]="none",fc[fc.horizontal=1]="horizontal",fc[fc.vertical=2]="vertical",fc[fc.horizontalOnly=3]="horizontalOnly";const ss=128,pc=32640;function Sm(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Vn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let g=p;for(;g<o.length&&o[g]<i+1;)g++;g=Math.min(o.length-1,g);const x=o[p],T=o[g];return n.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:T,minSize:n.evaluate(new Vn(x)),maxSize:n.evaluate(new Vn(T)),interpolationType:u}}}function dp(i,e,n){let o="never";const u=i.get(e);return u?o=u:i.get(n)&&(o="always"),o}const qg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bd(i,e,n,o,u,p,g,x,T,C,I,L,B){const F=x?Math.min(pc,Math.round(x[0])):0,q=x?Math.min(pc,Math.round(x[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*u),p,g,(F<<1)+(T?1:0),q,16*C,16*I,256*L,256*B)}function Em(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Mm(i){for(const e of i.sections)if(Ks(e.text))return!0;return!1}class fp{constructor(e){this.layoutVertexArray=new me,this.indexArray=new Ge,this.programConfigurations=e,this.segments=new At,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new Ze,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,kd.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qg,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}kt("SymbolBuffers",fp);class pp{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new At,this.collisionVertexArray=new qe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ym.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}kt("CollisionBuffers",pp);class Ph{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Sm(this.zoom,n["text-size"]),this.iconSizeData=Sm(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=dp(o,"text-overlap","text-allow-overlap")!=="never"||dp(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((g=>A.az[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID}createArrays(){this.text=new fp(new ko(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new fp(new ko(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new R,this.lineVertexArray=new O,this.symbolInstances=new D,this.textAnchorOffsets=new j}calculateGlyphDependencies(e,n,o,u,p){for(const g of e)if(n[g.codePointAt(0)]=!0,(o||u)&&p){const x=Mh[g];x&&(n[x.codePointAt(0)]=!0)}}populate(e,n,o){const u=this.layers[0],p=u.layout,g=p.get("text-font"),x=p.get("text-field"),T=p.get("icon-image"),C=(x.value.kind!=="constant"||x.value.value instanceof ir&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,L=p.get("symbol-sort-key");if(this.features=[],!C&&!I)return;const B=n.iconDependencies,F=n.glyphDependencies,q=n.availableImages,G=new Vn(this.zoom);for(const{feature:Y,id:J,index:he,sourceLayerIndex:ee}of e){const ie=u._featureFilter.needGeometry,ge=rs(Y,ie);if(!u._featureFilter.filter(G,ge,o))continue;let be,Ue;if(ie||(ge.geometry=io(Y)),C){const Qe=u.getValueAndResolveTokens("text-field",ge,o,q),mt=ir.factory(Qe),Ct=this.hasRTLText=this.hasRTLText||Mm(mt);(!Ct||ka.getRTLTextPluginStatus()==="unavailable"||Ct&&ka.isParsed())&&(be=Va(mt,u,ge))}if(I){const Qe=u.getValueAndResolveTokens("icon-image",ge,o,q);Ue=Qe instanceof Br?Qe:Br.fromString(Qe)}if(!be&&!Ue)continue;const st=this.sortFeaturesByKey?L.evaluate(ge,{},o):void 0;if(this.features.push({id:J,text:be,icon:Ue,index:he,sourceLayerIndex:ee,geometry:ge.geometry,properties:Y.properties,type:Th.types[Y.type],sortKey:st}),Ue&&(B[Ue.name]=!0),be){const Qe=g.evaluate(ge,{},o).join(","),mt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(A.az.vertical)>=0;for(const Ct of be.sections)if(Ct.image)B[Ct.image.name]=!0;else{const yt=zs(be.toString()),tt=Ct.fontStack||Qe,$e=F[tt]=F[tt]||{};this.calculateGlyphDependencies(Ct.text,$e,mt,this.allowVerticalPlacement,yt)}}}p.get("symbol-placement")==="line"&&(this.features=(function(Y){const J={},he={},ee=[];let ie=0;function ge(Qe){ee.push(Y[Qe]),ie++}function be(Qe,mt,Ct){const yt=he[Qe];return delete he[Qe],he[mt]=yt,ee[yt].geometry[0].pop(),ee[yt].geometry[0]=ee[yt].geometry[0].concat(Ct[0]),yt}function Ue(Qe,mt,Ct){const yt=J[mt];return delete J[mt],J[Qe]=yt,ee[yt].geometry[0].shift(),ee[yt].geometry[0]=Ct[0].concat(ee[yt].geometry[0]),yt}function st(Qe,mt,Ct){const yt=Ct?mt[0][mt[0].length-1]:mt[0][0];return`${Qe}:${yt.x}:${yt.y}`}for(let Qe=0;Qe<Y.length;Qe++){const mt=Y[Qe],Ct=mt.geometry,yt=mt.text?mt.text.toString():null;if(!yt){ge(Qe);continue}const tt=st(yt,Ct),$e=st(yt,Ct,!0);if(tt in he&&$e in J&&he[tt]!==J[$e]){const Ot=Ue(tt,$e,Ct),Rt=be(tt,$e,ee[Ot].geometry);delete J[tt],delete he[$e],he[st(yt,ee[Rt].geometry,!0)]=Rt,ee[Ot].geometry=null}else tt in he?be(tt,$e,Ct):$e in J?Ue(tt,$e,Ct):(ge(Qe),J[tt]=ie-1,he[$e]=ie-1)}return ee.filter((Qe=>Qe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Y,J)=>Y.sortKey-J.sortKey))}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(n[e.segment+1]),p=e.dist(n[e.segment]);const g={};for(let x=e.segment+1;x<n.length;x++)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:u},x<n.length-1&&(u+=n[x+1].dist(n[x]));for(let x=e.segment||0;x>=0;x--)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const T=g[x];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,u,p,g,x,T,C,I,L,B){const F=e.indexArray,q=e.layoutVertexArray,G=e.segments.prepareSegment(4*n.length,q,F,this.canOverlap?g.sortKey:void 0),Y=this.glyphOffsetArray.length,J=G.vertexLength,he=this.allowVerticalPlacement&&x===A.az.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let ie=0;ie<n.length;ie++){const{tl:ge,tr:be,bl:Ue,br:st,tex:Qe,pixelOffsetTL:mt,pixelOffsetBR:Ct,minFontScaleX:yt,minFontScaleY:tt,glyphOffset:$e,isSDF:Ot,sectionIndex:Rt}=n[ie],Ft=G.vertexLength,It=$e[1];Bd(q,T.x,T.y,ge.x,It+ge.y,Qe.x,Qe.y,o,Ot,mt.x,mt.y,yt,tt),Bd(q,T.x,T.y,be.x,It+be.y,Qe.x+Qe.w,Qe.y,o,Ot,Ct.x,mt.y,yt,tt),Bd(q,T.x,T.y,Ue.x,It+Ue.y,Qe.x,Qe.y+Qe.h,o,Ot,mt.x,Ct.y,yt,tt),Bd(q,T.x,T.y,st.x,It+st.y,Qe.x+Qe.w,Qe.y+Qe.h,o,Ot,Ct.x,Ct.y,yt,tt),Em(e.dynamicLayoutVertexArray,T,he),F.emplaceBack(Ft,Ft+2,Ft+1),F.emplaceBack(Ft+1,Ft+2,Ft+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),ie!==n.length-1&&Rt===n[ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,g,g.index,{imagePositions:{},canonical:B,formattedSection:ee&&ee[Rt]})}e.placedSymbolArray.emplaceBack(T.x,T.y,Y,this.glyphOffsetArray.length-Y,J,C,I,T.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],x,0,!1,0,L)}_addCollisionDebugVertex(e,n,o,u,p,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,p,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,u,p,g,x){const T=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),C=T.vertexLength,I=p.layoutVertexArray,L=p.collisionVertexArray,B=x.anchorX,F=x.anchorY;this._addCollisionDebugVertex(I,L,g,B,F,new N(e,n)),this._addCollisionDebugVertex(I,L,g,B,F,new N(o,n)),this._addCollisionDebugVertex(I,L,g,B,F,new N(o,u)),this._addCollisionDebugVertex(I,L,g,B,F,new N(e,u)),T.vertexLength+=4;const q=p.indexArray;q.emplaceBack(C,C+1),q.emplaceBack(C+1,C+2),q.emplaceBack(C+2,C+3),q.emplaceBack(C+3,C),T.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,u){for(let p=e;p<n;p++){const g=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,u?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pp(je,Ua.members,St),this.iconCollisionBox=new pp(je,Ua.members,St);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,u,p,g,x,T,C){const I={};for(let L=n;L<o;L++){const B=e.get(L);I.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.textFeatureIndex=B.featureIndex;break}for(let L=u;L<p;L++){const B=e.get(L);I.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalTextFeatureIndex=B.featureIndex;break}for(let L=g;L<x;L++){const B=e.get(L);I.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.iconFeatureIndex=B.featureIndex;break}for(let L=T;L<C;L++){const B=e.get(L);I.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},I.verticalIconFeatureIndex=B.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),u=[],p=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const T=this.symbolInstances.get(x);u.push(0|Math.round(n*T.anchorX+o*T.anchorY)),p.push(T.featureIndex)}return g.sort(((x,T)=>u[x]-u[T]||p[T]-p[x])),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,p,g)=>{u>=0&&g.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mp,gp;kt("SymbolBucket",Ph,{omit:["layers","collisionBoxArray","features","compareText"]}),Ph.MAX_GLYPHS=65535,Ph.addDynamicAttributes=Em;var Am={get paint(){return gp=gp||new Ui({"icon-opacity":new Vt(Fe.paint_symbol["icon-opacity"]),"icon-color":new Vt(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Vt(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Lt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Lt(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Vt(Fe.paint_symbol["text-opacity"]),"text-color":new Vt(Fe.paint_symbol["text-color"],{runtimeType:sa,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Vt(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(Fe.paint_symbol["text-halo-blur"]),"text-translate":new Lt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new Lt(Fe.paint_symbol["text-translate-anchor"])})},get layout(){return mp=mp||new Ui({"symbol-placement":new Lt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Lt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Lt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Lt(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Lt(Fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Lt(Fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Lt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Lt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Lt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(Fe.layout_symbol["icon-size"]),"icon-text-fit":new Lt(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Lt(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(Fe.layout_symbol["icon-image"]),"icon-rotate":new Vt(Fe.layout_symbol["icon-rotate"]),"icon-padding":new Vt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Lt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Vt(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Lt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Lt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Lt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(Fe.layout_symbol["text-field"]),"text-font":new Vt(Fe.layout_symbol["text-font"]),"text-size":new Vt(Fe.layout_symbol["text-size"]),"text-max-width":new Vt(Fe.layout_symbol["text-max-width"]),"text-line-height":new Lt(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Vt(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Lt(Fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Vt(Fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Vt(Fe.layout_symbol["text-anchor"]),"text-max-angle":new Lt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Lt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(Fe.layout_symbol["text-rotate"]),"text-padding":new Lt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new Lt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Vt(Fe.layout_symbol["text-transform"]),"text-offset":new Vt(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new Lt(Fe.layout_symbol["text-allow-overlap"]),"text-overlap":new Lt(Fe.layout_symbol["text-overlap"]),"text-ignore-placement":new Lt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new Lt(Fe.layout_symbol["text-optional"])})}};class Gg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Tn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}kt("FormatSectionOverride",Gg,{omit:["defaultValue"]});class mc extends wi{constructor(e,n){super(e,Am,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,u){const p=this.layout.get(e).evaluate(n,{},o,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Mo(g.value)||!p?p:(function(x,T){return T.replace(/{([^{}]+)}/g,((C,I)=>x&&I in x?String(x[I]):""))})(n.properties,p)}createBucket(e){return new Ph(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Am.paint.overridableProperties){if(!mc.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Gg(n),u=new ah(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Vr("source",u):new Ao("composite",u,n.value.zoomStops),this.paint._values[e]=new ga(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&mc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),u=Am.paint.properties[n];let p=!1;const g=x=>{for(const T of x)if(u.overrides&&u.overrides.hasOverride(T))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ir)g(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const x=C=>{p||(C instanceof la&&pi(C.value)===ds?g(C.value.sections):C instanceof Gc?g(C.sections):C.eachChild(x))},T=o.value;T._styleExpression&&x(T._styleExpression.expression)}return p}}let Zg;var Hg={get paint(){return Zg=Zg||new Ui({"background-color":new Lt(Fe.paint_background["background-color"]),"background-pattern":new ac(Fe.paint_background["background-pattern"]),"background-opacity":new Lt(Fe.paint_background["background-opacity"])})}};class zn extends wi{constructor(e,n){super(e,Hg,n)}}class Cm extends wi{constructor(e,n){super(e,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const zm={once:!0},_p=63710088e-1;class Fo{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fo(Yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,u=e.lat*n,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return _p*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof Fo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Fo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Fo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ih=2*Math.PI*_p;function Nd(i){return Ih*Math.cos(i*Math.PI/180)}function $g(i){return(180+i)/360}function Dm(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Xg(i,e){return i/Nd(e)}function Yg(i){return 360*i-180}function Fd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Pm(i,e){return i*Nd(Fd(e))}class Xn{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=Fo.convert(e);return new Xn($g(o.lng),Dm(o.lat),Xg(n,o.lat))}toLngLat(){return new Fo(Yg(this.x),Fd(this.y))}toAltitude(){return Pm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ih*(e=Fd(this.y),1/Math.cos(e*Math.PI/180));var e}}function vp(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Er{constructor(e,n,o){if(!(function(u,p,g){return!(u<0||u>25||g<0||g>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))})(e,n,o))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=kh(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const u=(function(g,x,T){var C=vp(256*g,256*(x=Math.pow(2,T)-x-1),T),I=vp(256*(g+1),256*(x+1),T);return C[0]+","+C[1]+","+I[0]+","+I[1]})(this.x,this.y,this.z),p=(function(g,x,T){let C,I="";for(let L=g;L>0;L--)C=1<<L-1,I+=(x&C?1:0)+(T&C?2:0);return I})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,p).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new N((e.x*n-this.x)*xt,(e.y*n-this.y)*xt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wg{constructor(e,n){this.wrap=e,this.canonical=n,this.key=kh(e,n.z,n.z,n.x,n.y)}}class qa{constructor(e,n,o,u,p){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Er(o,+u,+p),this.key=kh(n,e,o,u,p)}clone(){return new qa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new qa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qa(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?kh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):kh(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new qa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new qa(n,this.wrap,n,o,u),new qa(n,this.wrap,n,o+1,u),new qa(n,this.wrap,n,o,u+1),new qa(n,this.wrap,n,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new qa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new qa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Xn(e.x-this.wrap,e.y))}}function kh(i,e,n,o,u){(i*=2)<0&&(i=-1*i-1);const p=1<<n;return(p*p*i+p*u+o).toString(36)+n.toString(36)+e.toString(36)}function jd(i,e){return e?i.properties[e]:i.id}function Im(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=i.addOrUpdateProperties.findIndex((p=>p.key===o));u>-1&&i.addOrUpdateProperties.splice(u,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Ud(i){var e,n;if(!i)return{};const o={};return o.removeAll=i.removeAll,o.remove=new Set(i.remove||[]),o.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((u=>[u.id,u]))),o}kt("CanonicalTileID",Er),kt("OverscaledTileID",qa,{omit:["terrainRttPosMatrix32f"]});class gc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new gc;return n.extend(e(new N(this.minX,this.minY))),n.extend(e(new N(this.maxX,this.minY))),n.extend(e(new N(this.minX,this.maxY))),n.extend(e(new N(this.maxX,this.maxY))),n}static fromPoints(e){const n=new gc;for(const o of e)n.extend(o);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class km{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class xp{constructor(e,n,o,u,p){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=n,this.properties=e.properties,this.id=p}projectPoint(e,n,o,u){return[360*(e.x+n)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,n,o,u){return e.map((p=>this.projectPoint(p,n,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const g=[];for(const T of p)g.push(T[0]);const x=this.projectLine(g,o,u,n);this._geometry=g.length===1?{type:"Point",coordinates:x[0]}:{type:"MultiPoint",coordinates:x};break}case 2:{const g=p.map((x=>this.projectLine(x,o,u,n)));this._geometry=g.length===1?{type:"LineString",coordinates:g[0]}:{type:"MultiLineString",coordinates:g};break}case 3:{const g=Cg(p),x=[];for(const T of g)x.push(T.map((C=>this.projectLine(C,o,u,n))));this._geometry=x.length===1?{type:"Polygon",coordinates:x[0]}:{type:"MultiPolygon",coordinates:x};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class yc{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,o){this._name=e,this.dataBuffer=n,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class bp extends yc{}class wp extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Rm extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Lm extends yc{delta;constructor(e,n,o,u){super(e,n,u),this.delta=o}}class Om extends Lm{constructor(e,n,o,u){super(e,Int32Array.of(n),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Bm extends yc{constructor(e,n,o){super(e,Int32Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class _c{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,o,u,p=4096){this._name=e,this._geometryVector=n,this._idVector=o,this._propertyVectors=u,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const u=e?.next().value,p={};for(const g of this.propertyVectors){if(!g)continue;const x=g.name,T=g.getValue(n);T!==null&&(p[x]=T)}n++,yield{id:o,geometry:u,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const p={coordinates:n[o],type:this.geometryVector.geometryType(o)},g={};for(const x of this.propertyVectors){if(!x)continue;const T=x.name,C=x.getValue(o);C!==null&&(g[T]=C)}e.push({id:u,geometry:p,properties:g})}return e}containsMaxSaveIntegerValues(e){return e instanceof wp||e instanceof Bm&&e instanceof Om||e instanceof Rm}}class Kg{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var yn,oo,Pr,lo,vc,Jr,er,yr,os,ba;function _r(i,e,n){const o=new Int32Array(n);let u=0,p=e.get();for(let g=0;g<o.length;g++){let x=i[p++],T=127&x;x<128||(x=i[p++],T|=(127&x)<<7,x<128||(x=i[p++],T|=(127&x)<<14,x<128||(x=i[p++],T|=(127&x)<<21,x<128||(x=i[p++],T|=(15&x)<<28)))),o[u++]=T}return e.set(p),o}function Vd(i,e,n){const o=new BigInt64Array(n);for(let u=0;u<o.length;u++)o[u]=Tp(i,e);return o}function Qg(i,e){let n,o;return o=i[e.get()],e.increment(),n=127&o,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<7,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<14,o<128?n:(o=i[e.get()],e.increment(),n|=(127&o)<<21,o<128?n:(o=i[e.get()],n|=(15&o)<<28,(function(u,p,g){let x,T;if(T=p[g.get()],g.increment(),x=(112&T)>>4,T<128||(T=p[g.get()],g.increment(),x|=(127&T)<<3,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<10,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<17,T<128)||(T=p[g.get()],g.increment(),x|=(127&T)<<24,T<128)||(T=p[g.get()],g.increment(),x|=(1&T)<<31,T<128))return 4294967296*x+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function Rh(i,e,n,o){throw new Error("FastPFor is not implemented yet.")}function Ir(i){return i>>>1^-(1&i)}function Au(i){return i>>1n^-(1n&i)}function Tp(i,e){let n=0n,o=0,u=e.get();for(;u<i.length;){const p=i[u++];if(n|=BigInt(127&p)<<BigInt(o),!(128&p))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),n}function jo(i,e,n){const o=new Int32Array(n);let u=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],u,u+g),u+=g}return o}function Jg(i,e,n){const o=new BigInt64Array(n);let u=0;for(let p=0;p<e;p++){const g=Number(i[p]);o.fill(i[p+e],u,u+g),u+=g}return o}function ey(i,e,n){const o=new Float64Array(n);let u=0;for(let p=0;p<e;p++){const g=i[p];o.fill(i[p+e],u,u+g),u+=g}return o}function xc(i){const e=i.length/4*4;let n=1;if(e>=4)for(let o=i[0];n<e-4;n+=4)o=i[n]+=o,o=i[n+1]+=o,o=i[n+2]+=o,o=i[n+3]+=o;for(;n!=i.length;)i[n]+=i[n-1],++n}function Nm(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const o=i[n],u=i[n+1],p=i[n+2],g=i[n+3];i[n]=(o>>>1^-(1&o))+i[n-2],i[n+1]=(u>>>1^-(1&u))+i[n-1],i[n+2]=(p>>>1^-(1&p))+i[n],i[n+3]=(g>>>1^-(1&g))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(yn||(yn={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(oo||(oo={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(Pr||(Pr={}));class Fm{_dictionaryType;_offsetType;_lengthType;constructor(e,n,o){this._dictionaryType=e,this._offsetType=n,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ea(i,e){const n=(function(o,u){const p=o[u.get()],g=Object.values(Pr)[p>>4];let x=null;switch(g){case Pr.DATA:x=new Fm(Object.values(lo)[15&p]);break;case Pr.OFFSET:x=new Fm(null,Object.values(vc)[15&p]);break;case Pr.LENGTH:x=new Fm(null,null,Object.values(Jr)[15&p])}u.increment();const T=o[u.get()],C=Object.values(yn)[T>>5],I=Object.values(yn)[T>>2&7],L=Object.values(oo)[3&T];u.increment();const B=_r(o,u,2),F=B[0];return{physicalStreamType:g,logicalStreamType:x,logicalLevelTechnique1:C,logicalLevelTechnique2:I,physicalLevelTechnique:L,numValues:F,byteLength:B[1],decompressedCount:F}})(i,e);return n.logicalLevelTechnique1===yn.MORTON?(function(o,u,p){const g=_r(u,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:g[0],coordinateShift:g[1]}})(n,i,e):yn.RLE!==n.logicalLevelTechnique1&&yn.RLE!==n.logicalLevelTechnique2||oo.NONE===n.physicalLevelTechnique?n:(function(o,u,p){const g=_r(u,p,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:g[1],runs:g[0],numRleValues:g[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(lo||(lo={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(vc||(vc={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Jr||(Jr={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(er||(er={}));class co{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const o=Math.floor(e/8);this.values[o]=this.values[o]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function ta(i,e,n,o,u){return(function(p,g,x){switch(g.logicalLevelTechnique1){case yn.DELTA:return g.logicalLevelTechnique2===yn.RLE?(function(T,C,I){const L=new Int32Array(I);let B=0,F=0;for(let q=0;q<C;q++){const G=T[q],Y=Ir(T[q+C]);for(let J=0;J<G;J++)F+=Y,L[B++]=F}return L})(p,g.runs,g.numRleValues):((function(T){T[0]=T[0]>>>1^-(1&T[0]);const C=T.length/4*4;let I=1;if(C>=4)for(;I<C-4;I+=4){const L=T[I],B=T[I+1],F=T[I+2],q=T[I+3];T[I]=(L>>>1^-(1&L))+T[I-1],T[I+1]=(B>>>1^-(1&B))+T[I],T[I+2]=(F>>>1^-(1&F))+T[I+1],T[I+3]=(q>>>1^-(1&q))+T[I+2]}for(;I!=T.length;++I)T[I]=(T[I]>>>1^-(1&T[I]))+T[I-1]})(p),p);case yn.RLE:return(function(T,C,I){return I?(function(L,B,F){const q=new Int32Array(F);let G=0;for(let Y=0;Y<B;Y++){const J=L[Y];let he=L[Y+B];he=he>>>1^-(1&he),q.fill(he,G,G+J),G+=J}return q})(T,C.runs,C.numRleValues):jo(T,C.runs,C.numRleValues)})(p,g,x);case yn.MORTON:return xc(p),p;case yn.COMPONENTWISE_DELTA:return Nm(p),p;case yn.NONE:return x&&(function(T){for(let C=0;C<T.length;C++){const I=T[C];T[C]=I>>>1^-(1&I)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${g.logicalLevelTechnique1}`)}})(Sp(i,e,n),n,o)}function bc(i,e,n){return(function(o,u){if(u.logicalLevelTechnique1===yn.DELTA&&u.logicalLevelTechnique2===yn.NONE)return(function(g){const x=new Int32Array(g.length+1);x[0]=0,x[1]=Ir(g[0]);let T=x[1],C=2;for(;C!=x.length;++C){const I=g[C-1];T+=I>>>1^-(1&I),x[C]=x[C-1]+T}return x})(o);if(u.logicalLevelTechnique1===yn.RLE&&u.logicalLevelTechnique2===yn.NONE)return(function(g,x,T){const C=new Int32Array(T+1);C[0]=0;let I=1,L=C[0];for(let B=0;B<x;B++){const F=g[B],q=g[B+x];for(let G=I;G<I+F;G++)C[G]=q+L,L=C[G];I+=F}return C})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===yn.NONE&&u.logicalLevelTechnique2===yn.NONE){(function(g){let x=0;for(let T=0;T<g.length;T++)g[T]+=x,x=g[T]})(o);const p=new Int32Array(u.numValues+1);return p[0]=0,p.set(o,1),p}if(u.logicalLevelTechnique1===yn.DELTA&&u.logicalLevelTechnique2===yn.RLE){const p=(function(g,x,T){const C=new Int32Array(T+1);C[0]=0;let I=1,L=C[0];for(let B=0;B<x;B++){const F=g[B];let q=g[B+x];q=q>>>1^-(1&q);for(let G=I;G<I+F;G++)C[G]=q+L,L=C[G];I+=F}return C})(o,u.runs,u.numRleValues);return xc(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Sp(i,e,n),n)}function Sp(i,e,n){const o=n.physicalLevelTechnique;if(o===oo.FAST_PFOR)return Rh();if(o===oo.VARINT)return _r(i,e,n.numValues);if(o===oo.NONE){const u=e.get();e.add(n.byteLength);const p=i.subarray(u,e.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function jm(i,e,n,o){const u=Sp(i,e,n);if(u.length===1){const p=u[0];return o?Ir(p):p}return o?(function(p){return Ir(p[1])})(u):(function(p){return p[1]})(u)}function Um(i,e,n){return(function(o){if(o.length==2){const u=Ir(o[1]);return[u,u]}return[Ir(o[2]),Ir(o[3])]})(Sp(i,e,n))}function Cu(i,e,n){return(function(o){if(o.length==2){const u=Au(o[1]);return[u,u]}return[Au(o[2]),Au(o[3])]})(Vd(i,e,n.numValues))}function Lh(i,e,n,o){return(function(u,p,g){switch(p.logicalLevelTechnique1){case yn.DELTA:return p.logicalLevelTechnique2===yn.RLE?(function(x,T,C){const I=new BigInt64Array(C);let L=0,B=0n;for(let F=0;F<T;F++){const q=Number(x[F]),G=Au(x[F+T]);for(let Y=0;Y<q;Y++)B+=G,I[L++]=B}return I})(u,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>1n^-(1n&x[0]);const T=x.length/4*4;let C=1;if(T>=4)for(;C<T-4;C+=4){const I=x[C],L=x[C+1],B=x[C+2],F=x[C+3];x[C]=(I>>1n^-(1n&I))+x[C-1],x[C+1]=(L>>1n^-(1n&L))+x[C],x[C+2]=(B>>1n^-(1n&B))+x[C+1],x[C+3]=(F>>1n^-(1n&F))+x[C+2]}for(;C!=x.length;++C)x[C]=(x[C]>>1n^-(1n&x[C]))+x[C-1]})(u),u);case yn.RLE:return(function(x,T,C){return C?(function(I,L,B){const F=new BigInt64Array(B);let q=0;for(let G=0;G<L;G++){const Y=Number(I[G]);let J=I[G+L];J=J>>1n^-(1n&J),F.fill(J,q,q+Y),q+=Y}return F})(x,T.runs,T.numRleValues):Jg(x,T.runs,T.numRleValues)})(u,p,g);case yn.NONE:return g&&(function(x){for(let T=0;T<x.length;T++){const C=x[T];x[T]=C>>1n^-(1n&C)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(Vd(i,e,n.numValues),n,o)}function Vm(i,e,n,o){const u=Vd(i,e,n.numValues);if(u.length===1){const p=u[0];return o?Au(p):p}return o?(function(p){return Au(p[1])})(u):(function(p){return p[1]})(u)}function qm(i,e,n,o,u){return(function(p,g,x,T){switch(g.logicalLevelTechnique1){case yn.DELTA:return g.logicalLevelTechnique2===yn.RLE&&(p=jo(p,g.runs,g.numRleValues)),(function(C,I){const L=new Int32Array(C.size());let B=0;C.get(0)?(L[0]=C.get(0)?I[0]>>>1^-(1&I[0]):0,B=1):L[0]=0;let F=1;for(;F!=L.length;++F)L[F]=C.get(F)?L[F-1]+(I[B]>>>1^-(1&I[B++])):L[F-1];return L})(T,p);case yn.RLE:return(function(C,I,L,B){const F=I;return L?(function(q,G,Y){const J=new Int32Array(q.size());let he=0;for(let ee=0;ee<Y;ee++){const ie=G[ee];let ge=G[ee+Y];ge=ge>>>1^-(1&ge);for(let be=he;be<he+ie;be++)q.get(be)?J[be]=ge:(J[be]=0,he++);he+=ie}return J})(B,C,F.runs):(function(q,G,Y){const J=new Int32Array(q.size());let he=0;for(let ee=0;ee<Y;ee++){const ie=G[ee],ge=G[ee+Y];for(let be=he;be<he+ie;be++)q.get(be)?J[be]=ge:(J[be]=0,he++);he+=ie}return J})(B,C,F.runs)})(p,g,x,T);case yn.MORTON:return xc(p),p;case yn.COMPONENTWISE_DELTA:return Nm(p),p;case yn.NONE:return p=x?(function(C,I){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)if(C.get(F)){const q=I[B++];L[F]=q>>>1^-(1&q)}else L[F]=0;return L})(T,p):(function(C,I){const L=new Int32Array(C.size());let B=0,F=0;for(;F!=L.length;++F)L[F]=C.get(F)?I[B++]:0;return L})(T,p),p;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===oo.FAST_PFOR?Rh():_r(i,e,n.numValues),n,o,u)}function Cl(i,e,n,o){const u=i.logicalLevelTechnique1;if(u===yn.RLE)return i.runs===1?er.CONST:er.FLAT;const p=e instanceof co?e.size():e;if(u===yn.DELTA&&i.logicalLevelTechnique2===yn.RLE){const g=i.runs,x=2;if(i.numRleValues!==p)return er.FLAT;if(g===1)return er.SEQUENCE;if(g===2){const T=o.get();let C;if(i.physicalLevelTechnique===oo.VARINT)C=_r(n,o,4);else{const I=o.get();C=new Int32Array(n.buffer,n.byteOffset+I,4)}if(o.set(T),C[2]===x&&C[3]===x)return er.SEQUENCE}}return i.numValues===1?er.CONST:er.FLAT}class Oh extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Gm extends Lm{constructor(e,n,o,u){super(e,BigInt64Array.of(n),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class zl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,o){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function qd(i,e,n){return{x:Ep(i,e)-n,y:Ep(i>>1,e)-n}}function Ep(i,e){let n=0;for(let o=0;o<e;o++)n|=(i&1<<2*o)>>o;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(yr||(yr={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(os||(os={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(ba||(ba={}));class Mp{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function Zm(i){const e=new Array(i.numGeometries);let n=1,o=1,u=1,p=0;const g=new Mp;let x=0,T=0;const C=i.mortonSettings,I=i.topologyVector,L=I.geometryOffsets,B=I.partOffsets,F=I.ringOffsets,q=i.vertexOffsets,G=i.containsPolygonGeometry(),Y=i.vertexBuffer;for(let J=0;J<i.numGeometries;J++){const he=i.geometryType(J);if(he===yr.POINT){if(q&&q.length!==0)if(i.vertexBufferType===ba.VEC_2){const ee=2*q[T++],ie=new N(Y[ee],Y[ee+1]);e[p++]=g.createPoint(ie)}else{const ee=qd(Y[q[T++]],C.numBits,C.coordinateShift),ie=new N(ee.x,ee.y);e[p++]=g.createPoint(ie)}else{const ee=new N(Y[x++],Y[x++]);e[p++]=g.createPoint(ee)}L&&u++,B&&n++,F&&o++}else if(he===yr.MULTIPOINT){const ee=L[u]-L[u-1];u++;const ie=new Array(ee);if(q&&q.length!==0){for(let ge=0;ge<ee;ge++){const be=2*q[T++];ie[ge]=new N(Y[be],Y[be+1])}e[p++]=g.createMultiPoint(ie)}else{for(let ge=0;ge<ee;ge++){const be=Y[x++],Ue=Y[x++];ie[ge]=new N(be,Ue)}e[p++]=g.createMultiPoint(ie)}}else if(he===yr.LINESTRING){let ee,ie=0;G?(ie=F[o]-F[o-1],o++):ie=B[n]-B[n-1],n++,q&&q.length!==0?(ee=i.vertexBufferType===ba.VEC_2?Hd(Y,q,T,ie,!1):$m(Y,q,T,ie,!1,C),T+=ie):(ee=Hm(Y,x,ie,!1),x+=2*ie),e[p++]=g.createLineString(ee),L&&u++}else if(he===yr.POLYGON){const ee=B[n]-B[n-1];n++;const ie=new Array(ee-1);let ge=F[o]-F[o-1];if(o++,q&&q.length!==0){const be=i.vertexBufferType===ba.VEC_2?Ap(Y,q,T,ge):Zd(Y,q,T,ge,0,C);T+=ge;for(let Ue=0;Ue<ie.length;Ue++)ge=F[o]-F[o-1],o++,ie[Ue]=i.vertexBufferType===ba.VEC_2?Ap(Y,q,T,ge):Zd(Y,q,T,ge,0,C),T+=ge;e[p++]=g.createPolygon(be,ie)}else{const be=Gd(Y,x,ge);x+=2*ge;for(let Ue=0;Ue<ie.length;Ue++)ge=F[o]-F[o-1],o++,ie[Ue]=Gd(Y,x,ge),x+=2*ge;e[p++]=g.createPolygon(be,ie)}L&&u++}else if(he===yr.MULTILINESTRING){const ee=L[u]-L[u-1];u++;const ie=new Array(ee);if(q&&q.length!==0){for(let ge=0;ge<ee;ge++){let be=0;G?(be=F[o]-F[o-1],o++):be=B[n]-B[n-1],n++;const Ue=i.vertexBufferType===ba.VEC_2?Hd(Y,q,T,be,!1):$m(Y,q,T,be,!1,C);ie[ge]=Ue,T+=be}e[p++]=g.createMultiLineString(ie)}else{for(let ge=0;ge<ee;ge++){let be=0;G?(be=F[o]-F[o-1],o++):be=B[n]-B[n-1],n++,ie[ge]=Hm(Y,x,be,!1),x+=2*be}e[p++]=g.createMultiLineString(ie)}}else{if(he!==yr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ee=L[u]-L[u-1];u++;const ie=new Array(ee);let ge=0;if(q&&q.length!==0){for(let be=0;be<ee;be++){const Ue=B[n]-B[n-1];n++;const st=new Array(Ue-1);ge=F[o]-F[o-1],o++;const Qe=i.vertexBufferType===ba.VEC_2?Ap(Y,q,T,ge):Zd(Y,q,T,ge,0,C);T+=ge;for(let mt=0;mt<st.length;mt++)ge=F[o]-F[o-1],o++,st[mt]=i.vertexBufferType===ba.VEC_2?Ap(Y,q,T,ge):Zd(Y,q,T,ge,0,C),T+=ge;ie[be]=g.createPolygon(Qe,st)}e[p++]=g.createMultiPolygon(ie)}else{for(let be=0;be<ee;be++){const Ue=B[n]-B[n-1];n++;const st=new Array(Ue-1);ge=F[o]-F[o-1],o++;const Qe=Gd(Y,x,ge);x+=2*ge;for(let mt=0;mt<st.length;mt++){const Ct=F[o]-F[o-1];o++,st[mt]=Gd(Y,x,Ct),x+=2*Ct}ie[be]=g.createPolygon(Qe,st)}e[p++]=g.createMultiPolygon(ie)}}}}return e}function Gd(i,e,n){return Hm(i,e,n,!0)}function Ap(i,e,n,o){return Hd(i,e,n,o,!0)}function Zd(i,e,n,o,u,p){return $m(i,e,n,o,!0,p)}function Hm(i,e,n,o){const u=new Array(o?n+1:n);for(let p=0;p<2*n;p+=2)u[p/2]=new N(i[e+p],i[e+p+1]);return o&&(u[u.length-1]=u[0]),u}function Hd(i,e,n,o,u){const p=new Array(u?o+1:o);for(let g=0;g<2*o;g+=2){const x=2*e[n+g/2];p[g/2]=new N(i[x],i[x+1])}return u&&(p[p.length-1]=p[0]),p}function $m(i,e,n,o,u,p){const g=new Array(u?o+1:o);for(let x=0;x<o;x++){const T=qd(i[e[n+x]],p.numBits,p.coordinateShift);g[x]=new N(T.x,T.y)}return u&&(g[g.length-1]=g[0]),g}class $d{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,o,u,p){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Zm(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=qd(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return Zm(this)}get mortonSettings(){return this._mortonSettings}}class Xd extends $d{_numGeometries;_geometryType;constructor(e,n,o,u,p,g,x){super(o,u,p,g,x),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===yr.POLYGON||this._geometryType===yr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Yd extends $d{_geometryTypes;constructor(e,n,o,u,p,g){super(e,o,u,p,g),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===yr.POLYGON||this.geometryType(e)===yr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class ty{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,o,u){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,o=n.partOffsets,u=n.ringOffsets,p=n.geometryOffsets;let g=0,x=1,T=1,C=1;for(let I=0;I<this.numGeometries;I++)switch(this.geometryType(I)){case yr.POLYGON:{const L=o[x]-o[x-1];x++;const B=[];for(let F=0;F<L;F++){const q=u[T]-u[T-1];T++;const G=[];for(let Y=0;Y<q;Y++){const J=this._vertexBuffer[g++],he=this._vertexBuffer[g++];G.push(new N(J,he))}G.length>0&&G.push(G[0]),B.push(G)}e[I]=B,p&&C++}break;case yr.MULTIPOLYGON:{const L=p[C]-p[C-1];C++;const B=[];for(let F=0;F<L;F++){const q=o[x]-o[x-1];x++;for(let G=0;G<q;G++){const Y=u[T]-u[T-1];T++;const J=[];for(let he=0;he<Y;he++){const ee=this._vertexBuffer[g++],ie=this._vertexBuffer[g++];J.push(new N(ee,ie))}J.length>0&&J.push(J[0]),B.push(J)}}e[I]=B}}return e}[Symbol.iterator](){return null}}function Bh(i,e,n,o,u,p){return new n_(i,e,n,o,u,p)}class n_ extends ty{_numGeometries;_geometryType;constructor(e,n,o,u,p,g){super(o,u,p,g),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Xm(i,e,n,o,u){return new ny(i,e,n,o,u)}class ny extends ty{_geometryTypes;constructor(e,n,o,u,p){super(n,o,u,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function iy(i,e,n,o,u){const p=ea(i,n);let g=null,x=null,T=null,C=null,I=null,L=null,B=null,F=null;if(Cl(p,o,i,n)===er.CONST){const G=jm(i,n,p,!1);for(let Y=0;Y<e-1;Y++){const J=ea(i,n);switch(J.physicalStreamType){case Pr.LENGTH:switch(J.logicalStreamType.lengthType){case Jr.GEOMETRIES:g=bc(i,n,J);break;case Jr.PARTS:x=bc(i,n,J);break;case Jr.RINGS:T=bc(i,n,J);break;case Jr.TRIANGLES:B=bc(i,n,J)}break;case Pr.OFFSET:switch(J.logicalStreamType.offsetType){case vc.VERTEX:C=ta(i,n,J,!1);break;case vc.INDEX:F=ta(i,n,J,!1)}break;case Pr.DATA:lo.VERTEX===J.logicalStreamType.dictionaryType?I=ta(i,n,J,!0):(L={numBits:J.numBits,coordinateShift:J.coordinateShift},I=ta(i,n,J,!1))}}return F!==null?g!=null||x!=null?Bh(o,G,B,F,I,new zl(g,x,T)):Bh(o,G,B,F,I):L===null?(function(Y,J,he,ee,ie){return new Xd(Y,J,ba.VEC_2,he,ee,ie)})(o,G,new zl(g,x,T),C,I):(function(Y,J,he,ee,ie,ge){return new Xd(Y,J,ba.MORTON,he,ee,ie,ge)})(o,G,new zl(g,x,T),C,I,L)}const q=ta(i,n,p,!1);for(let G=0;G<e-1;G++){const Y=ea(i,n);switch(Y.physicalStreamType){case Pr.LENGTH:switch(Y.logicalStreamType.lengthType){case Jr.GEOMETRIES:g=ta(i,n,Y,!1);break;case Jr.PARTS:x=ta(i,n,Y,!1);break;case Jr.RINGS:T=ta(i,n,Y,!1);break;case Jr.TRIANGLES:B=bc(i,n,Y)}break;case Pr.OFFSET:switch(Y.logicalStreamType.offsetType){case vc.VERTEX:C=ta(i,n,Y,!1);break;case vc.INDEX:F=ta(i,n,Y,!1)}break;case Pr.DATA:lo.VERTEX===Y.logicalStreamType.dictionaryType?I=ta(i,n,Y,!0):(L={numBits:Y.numBits,coordinateShift:Y.coordinateShift},I=ta(i,n,Y,!1))}}return F!==null&&x===null?Xm(q,B,F,I):(g!==null?(g=Cp(q,g,2),x!==null&&T!==null?(x=zp(q,g,x,!1),T=(function(G,Y,J,he){const ee=new Int32Array(J[J.length-1]+1);let ie=0;ee[0]=ie;let ge=1,be=1,Ue=0;for(let st=0;st<G.length;st++){const Qe=G[st],mt=Y[st+1]-Y[st];if(Qe!==0&&Qe!==3)for(let Ct=0;Ct<mt;Ct++){const yt=J[ge]-J[ge-1];ge++;for(let tt=0;tt<yt;tt++)ie=ee[be++]=ie+he[Ue++]}else for(let Ct=0;Ct<mt;Ct++)ee[be++]=++ie,ge++}return ee})(q,g,x,T)):x!==null&&(x=(function(G,Y,J){const he=new Int32Array(Y[Y.length-1]+1);let ee=0;he[0]=ee;let ie=1,ge=0;for(let be=0;be<G.length;be++){const Ue=G[be],st=Y[be+1]-Y[be];if(Ue===4||Ue===1)for(let Qe=0;Qe<st;Qe++)ee=he[ie++]=ee+J[ge++];else for(let Qe=0;Qe<st;Qe++)he[ie++]=++ee}return he})(q,g,x))):x!==null&&T!==null?(x=Cp(q,x,1),T=zp(q,x,T,!0)):x!==null&&(x=Cp(q,x,0)),F!==null?Xm(q,B,F,I,new zl(g,x,T)):L===null?(function(G,Y,J,he){return new Yd(ba.VEC_2,G,Y,J,he)})(q,new zl(g,x,T),C,I):(function(G,Y,J,he,ee){return new Yd(ba.MORTON,G,Y,J,he,ee)})(q,new zl(g,x,T),C,I,L))}function Cp(i,e,n){const o=new Int32Array(i.length+1);let u=0;o[0]=u;let p=0;for(let g=0;g<i.length;g++)u=o[g+1]=u+(i[g]>n?e[p++]:1);return o}function zp(i,e,n,o){const u=new Int32Array(e[e.length-1]+1);let p=0;u[0]=p;let g=1,x=0;for(let T=0;T<i.length;T++){const C=i[T],I=e[T+1]-e[T];if(C===5||C===2||o&&(C===4||C===1))for(let L=0;L<I;L++)p=u[g++]=p+n[x++];else for(let L=0;L<I;L++)u[g++]=++p}return u}class ry extends yc{dataVector;constructor(e,n,o){super(e,n.getBuffer(),o),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class ay extends bp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Wd extends yc{constructor(e,n,o){super(e,BigInt64Array.of(n),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Kd(i,e,n){return sy(i,Math.ceil(e/8),n)}function sy(i,e,n){const o=new Uint8Array(e);let u=0;for(;u<e;){const p=i[n.increment()];if(p<=127){const g=p+3,x=i[n.increment()],T=u+g;o.fill(x,u,T),u=T}else{const g=256-p;for(let x=0;x<g;x++)o[u++]=i[n.increment()]}}return o}const Ym=new TextDecoder;function Qd(i,e,n){return n-e>=12?Ym.decode(i.subarray(e,n)):(function(o,u,p){let g="",x=u;for(;x<p;){const T=o[x];let C,I,L,B=null,F=T>239?4:T>223?3:T>191?2:1;if(x+F>p)break;F===1?T<128&&(B=T):F===2?(C=o[x+1],(192&C)==128&&(B=(31&T)<<6|63&C,B<=127&&(B=null))):F===3?(C=o[x+1],I=o[x+2],(192&C)==128&&(192&I)==128&&(B=(15&T)<<12|(63&C)<<6|63&I,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(C=o[x+1],I=o[x+2],L=o[x+3],(192&C)==128&&(192&I)==128&&(192&L)==128&&(B=(15&T)<<18|(63&C)<<12|(63&I)<<6|63&L,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),x+=F}return g})(i,e,n)}class Nh extends yc{offsetBuffer;constructor(e,n,o,u){super(e,o,u),this.offsetBuffer=n}}class Dp extends Nh{textEncoder;constructor(e,n,o,u){super(e,n,o,u??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Qd(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class zu extends Nh{indexBuffer;textEncoder;constructor(e,n,o,u,p){super(e,o,u,p??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Qd(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class Pp extends Nh{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,o,u,p,g,x){super(e,o,u,x),this.indexBuffer=n,this.symbolOffsetBuffer=p,this.symbolTableBuffer=g,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,p){const g=[],x=new Array(u.length).fill(0);for(let T=1;T<u.length;T++)x[T]=x[T-1]+u[T-1];for(let T=0;T<p.length;T++)if(p[T]===255)g.push(p[++T]);else{const C=u[p[T]],I=x[p[T]];for(let L=0;L<C;L++)g.push(o[I+L])}return new Uint8Array(g)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Qd(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const p=e[u];n[u-1]=p-o,o=p}return n}}function wc(i,e,n,o,u,p){return n.type==="scalarType"?(function(g,x,T,C,I,L){let B=null,F=0;if(g===0)return null;if(L.nullable){const G=ea(x,T);F=G.numValues;const Y=T.get(),J=Kd(x,F,T);T.set(Y+G.byteLength),B=new co(J,G.numValues)}const q=B??C;switch(I.physicalType){case 4:case 3:return(function(G,Y,J,he,ee){const ie=ea(G,Y),ge=Cl(ie,ee,G,Y),be=he.physicalType===3;if(ge===er.FLAT){const Ue=Ns(ee)?qm(G,Y,ie,be,ee):ta(G,Y,ie,be);return new wp(J.name,Ue,ee)}if(ge===er.SEQUENCE){const Ue=Um(G,Y,ie);return new Om(J.name,Ue[0],Ue[1],ie.numRleValues)}{const Ue=jm(G,Y,ie,be);return new Bm(J.name,Ue,ee)}})(x,T,L,I,q);case 9:return(function(G,Y,J,he,ee){let ie=null,ge=null,be=null,Ue=null,st=null,Qe=null,mt=null,Ct=null;for(let yt=0;yt<he;yt++){const tt=ea(Y,J);if(tt.byteLength!==0)switch(tt.physicalStreamType){case Pr.PRESENT:{const $e=Kd(Y,tt.numValues,J);Qe=new co($e,tt.numValues);break}case Pr.OFFSET:ge=ee!=null||Qe!=null?qm(Y,J,tt,!1,ee??Qe):ta(Y,J,tt,!1);break;case Pr.LENGTH:{const $e=bc(Y,J,tt);Jr.DICTIONARY===tt.logicalStreamType.lengthType?ie=$e:Jr.SYMBOL===tt.logicalStreamType.lengthType?Ue=$e:mt=$e;break}case Pr.DATA:{const $e=Y.subarray(J.get(),J.get()+tt.byteLength);J.add(tt.byteLength);const Ot=tt.logicalStreamType.dictionaryType;lo.FSST===Ot?st=$e:lo.SINGLE===Ot||lo.SHARED===Ot?be=$e:lo.NONE===Ot&&(Ct=$e);break}}}return(function(yt,tt,$e,Ot,Rt,Ft,It){return tt?new Pp(yt,$e,Ot,Rt,Ft,tt,It):null})(G,st,ge,ie,be,Ue,ee??Qe)??(function(yt,tt,$e,Ot,Rt){return tt?Rt?new zu(yt,$e,Ot,tt,Rt):new zu(yt,$e,Ot,tt):null})(G,be,ge,ie,ee??Qe)??(function(yt,tt,$e,Ot,Rt){if(!tt||!$e)return null;if(Ot)return Rt?new zu(yt,Ot,tt,$e,Rt):new zu(yt,Ot,tt,$e);if(Rt&&Rt.size()!==tt.length-1){const Ft=new Int32Array(Rt.size());let It=0;for(let Ht=0;Ht<Rt.size();Ht++)Ft[Ht]=Rt.get(Ht)?It++:0;return new zu(yt,Ft,tt,$e,Rt)}return Rt?new Dp(yt,tt,$e,Rt):new Dp(yt,tt,$e)})(G,mt,Ct,ge,ee??Qe)})(L.name,x,T,L.nullable?g-1:g,B);case 0:return(function(G,Y,J,he,ee){const ie=ea(G,Y),ge=ie.numValues,be=Y.get(),Ue=Ns(ee)?(function(Qe,mt,Ct,yt){const tt=sy(Qe,Math.ceil(mt/8),Ct),$e=new co(tt,mt),Ot=yt.size(),Rt=new co(new Uint8Array(Ot),Ot);let Ft=0;for(let It=0;It<yt.size();It++){const Ht=!!yt.get(It)&&$e.get(Ft++);Rt.set(It,Ht)}return Rt.getBuffer()})(G,ge,Y,ee):Kd(G,ge,Y);Y.set(be+ie.byteLength);const st=new co(Ue,ge);return new ry(J.name,st,ee)})(x,T,L,0,q);case 6:case 5:return(function(G,Y,J,he,ee){const ie=ea(G,Y),ge=Cl(ie,he,G,Y),be=ee.physicalType===5;if(ge===er.FLAT){const Ue=Ns(he)?(function(st,Qe,mt,Ct,yt){return(function(tt,$e,Ot,Rt){switch($e.logicalLevelTechnique1){case yn.DELTA:return $e.logicalLevelTechnique2===yn.RLE&&(tt=Jg(tt,$e.runs,$e.numRleValues)),(function(Ft,It){const Ht=new BigInt64Array(Ft.size());let On=0;Ft.get(0)?(Ht[0]=Ft.get(0)?It[0]>>1n^-(1n&It[0]):0n,On=1):Ht[0]=0n;let vn=1;for(;vn!=Ht.length;++vn)Ht[vn]=Ft.get(vn)?Ht[vn-1]+(It[On]>>1n^-(1n&It[On++])):Ht[vn-1];return Ht})(Rt,tt);case yn.RLE:return(function(Ft,It,Ht,On){const vn=It;return Ht?(function(Li,na,vr){const Oi=new BigInt64Array(Li.size());let Si=0;for(let Wn=0;Wn<vr;Wn++){const Yi=Number(na[Wn]);let tr=na[Wn+vr];tr=tr>>1n^-(1n&tr);for(let vi=Si;vi<Si+Yi;vi++)Li.get(vi)?Oi[vi]=tr:(Oi[vi]=0n,Si++);Si+=Yi}return Oi})(On,Ft,vn.runs):(function(Li,na,vr){const Oi=new BigInt64Array(Li.size());let Si=0;for(let Wn=0;Wn<vr;Wn++){const Yi=Number(na[Wn]),tr=na[Wn+vr];for(let vi=Si;vi<Si+Yi;vi++)Li.get(vi)?Oi[vi]=tr:(Oi[vi]=0n,Si++);Si+=Yi}return Oi})(On,Ft,vn.runs)})(tt,$e,Ot,Rt);case yn.NONE:return tt=Ot?(function(Ft,It){const Ht=new BigInt64Array(Ft.size());let On=0,vn=0;for(;vn!=Ht.length;++vn)if(Ft.get(vn)){const Li=It[On++];Ht[vn]=Li>>1n^-(1n&Li)}else Ht[vn]=0n;return Ht})(Rt,tt):(function(Ft,It){const Ht=new BigInt64Array(Ft.size());let On=0,vn=0;for(;vn!=Ht.length;++vn)Ht[vn]=Ft.get(vn)?It[On++]:0n;return Ht})(Rt,tt),tt;default:throw new Error("The specified Logical level technique is not supported")}})(Vd(st,Qe,mt.numValues),mt,Ct,yt)})(G,Y,ie,be,he):Lh(G,Y,ie,be);return new Oh(J.name,Ue,he)}if(ge===er.SEQUENCE){const Ue=Cu(G,Y,ie);return new Gm(J.name,Ue[0],Ue[1],ie.numRleValues)}{const Ue=Vm(G,Y,ie,be);return new Wd(J.name,Ue,he)}})(x,T,L,q,I);case 7:return(function(G,Y,J,he){const ee=ea(G,Y),ie=Ns(he)?(function(ge,be,Ue,st){const Qe=be.get(),mt=Qe+st*Float32Array.BYTES_PER_ELEMENT,Ct=new Uint8Array(ge.subarray(Qe,mt)).buffer,yt=new Float32Array(Ct);be.set(mt);const tt=Ue.size(),$e=new Float32Array(tt);let Ot=0;for(let Rt=0;Rt<tt;Rt++)$e[Rt]=Ue.get(Rt)?yt[Ot++]:0;return $e})(G,Y,he,ee.numValues):(function(ge,be,Ue){const st=be.get(),Qe=st+Ue*Float32Array.BYTES_PER_ELEMENT,mt=new Uint8Array(ge.subarray(st,Qe)).buffer,Ct=new Float32Array(mt);return be.set(Qe),Ct})(G,Y,ee.numValues);return new ay(J.name,ie,he)})(x,T,L,q);case 8:return(function(G,Y,J,he){const ee=ea(G,Y),ie=Ns(he)?(function(ge,be,Ue,st){const Qe=be.get(),mt=Qe+st*Float64Array.BYTES_PER_ELEMENT,Ct=new Uint8Array(ge.subarray(Qe,mt)).buffer,yt=new Float64Array(Ct);be.set(mt);const tt=Ue.size(),$e=new Float64Array(tt);let Ot=0;for(let Rt=0;Rt<tt;Rt++)$e[Rt]=Ue.get(Rt)?yt[Ot++]:0;return $e})(G,Y,he,ee.numValues):(function(ge,be,Ue){const st=be.get(),Qe=st+Ue*Float64Array.BYTES_PER_ELEMENT,mt=new Uint8Array(ge.subarray(st,Qe)).buffer,Ct=new Float64Array(mt);return be.set(Qe),Ct})(G,Y,ee.numValues);return new Rm(J.name,ie,he)})(x,T,L,q);default:throw new Error(`The specified data type for the field is currently not supported: ${I}`)}})(o,i,e,u,n.scalarType,n):o!=1?null:(function(g,x,T,C){let I=null,L=null,B=null,F=null,q=!1;for(;!q;){const he=ea(g,x);switch(he.physicalStreamType){case Pr.LENGTH:Jr.DICTIONARY===he.logicalStreamType.lengthType?I=bc(g,x,he):B=bc(g,x,he);break;case Pr.DATA:lo.SINGLE===he.logicalStreamType.dictionaryType||lo.SHARED===he.logicalStreamType.dictionaryType?(L=g.subarray(x.get(),x.get()+he.byteLength),q=!0):F=g.subarray(x.get(),x.get()+he.byteLength),x.add(he.byteLength)}}const G=T.complexType.children,Y=[];let J=0;for(const he of G){const ee=_r(g,x,1)[0];if(ee==0)continue;const ie=`${T.name}${he.name==="default"?"":":"+he.name}`;if(ee!==2||he.type!=="scalarField"||he.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ge=ea(g,x),be=Kd(g,ge.numValues,x),Ue=ea(g,x),st=Ue.decompressedCount!==C?qm(g,x,Ue,!1,new co(be,ge.numValues)):ta(g,x,Ue,!1);Y[J++]=F?new Pp(ie,st,I,L,B,F,new co(be,ge.numValues)):new zu(ie,st,I,L,new co(be,ge.numValues))}return Y})(i,e,n,u)}function Ns(i){return i instanceof co}function Tc(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Jd=new TextDecoder;function Fh(i,e){const n=_r(i,e,1)[0];if(n===0)return"";const o=e.get(),u=i.subarray(o,o+n);return e.add(n),Jd.decode(u)}function Dl(i,e){const n=_r(i,e,1)[0]>>>0,o=!!(4&n),u=!!(2&n),p=_r(i,e,1)[0]>>>0,g={};if(1&n&&(g.nullable=!0),u){const x={};if(o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),8&n){const T=_r(i,e,1)[0]>>>0;x.children=new Array(T);for(let C=0;C<T;C++)x.children[C]=Dl(i,e)}g.type="complexField",g.complexField=x}else{const x={};o?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),g.type="scalarField",g.scalarField=x}return g}function i_(i,e){const n=_r(i,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const p={};p.nullable=!!(1&u),p.columnScope=0;const g={};return g.physicalType=u>1?6:4,g.type="physicalType",p.scalarType=g,p.type="scalarType",p}case 4:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:0};return p.type="complexType",p.complexType=g,p}case 30:{const p={nullable:!1,columnScope:0},g={type:"physicalType",physicalType:1};return p.type="complexType",p.complexType=g,p}default:return(function(p){let g=null;switch(p){case 10:case 11:g=0;break;case 12:case 13:g=1;break;case 14:case 15:g=2;break;case 16:case 17:g=3;break;case 18:case 19:g=4;break;case 20:case 21:g=5;break;case 22:case 23:g=6;break;case 24:case 25:g=7;break;case 26:case 27:g=8;break;case 28:case 29:g=9;break;default:return null}const x={};x.nullable=!!(1&p),x.columnScope=0;const T={type:"physicalType"};return T.physicalType=g,x.type="scalarType",x.scalarType=T,x})(u)}})(n);if(!o)throw new Error(`Unsupported column type code: ${n}`);if((function(u){return u>=10})(n)?o.name=Fh(i,e):n>=0&&n<=3?o.name="id":n===4&&(o.name="geometry"),(function(u){return u===30})(n)){const u=_r(i,e,1)[0]>>>0,p=o.complexType;p.children=new Array(u);for(let g=0;g<u;g++)p.children[g]=Dl(i,e)}return o}function oy(i,e){const n={featureTables:[]},o={};o.name=Fh(i,e);const u=_r(i,e,1)[0]>>>0,p=_r(i,e,1)[0]>>>0;o.columns=new Array(p);for(let g=0;g<p;g++)o.columns[g]=i_(i,e);return n.featureTables.push(o),[n,u]}function ef(i,e,n,o,u,p,g=!1){const x=e.scalarType.physicalType,T=Cl(u,p,i,n);if(x===4)switch(T){case er.FLAT:{const C=ta(i,n,u,!1);return new wp(o,C,p)}case er.SEQUENCE:{const C=Um(i,n,u);return new Om(o,C[0],C[1],u.numRleValues)}case er.CONST:{const C=jm(i,n,u,!1);return new Bm(o,C,p)}}else switch(T){case er.FLAT:{if(g){const I=(function(L,B,F,q){const G=(function(Y,J,he){const ee=new Float64Array(J);for(let ie=0;ie<J;ie++)ee[ie]=Qg(Y,he);return ee})(L,F.numValues,B);return(function(Y,J,he){switch(J.logicalLevelTechnique1){case yn.DELTA:return J.logicalLevelTechnique2===yn.RLE&&(Y=ey(Y,J.runs,J.numRleValues)),(function(ee){ee[0]=ee[0]%2==1?(ee[0]+1)/-2:ee[0]/2;const ie=ee.length/4*4;let ge=1;if(ie>=4)for(;ge<ie-4;ge+=4){const be=ee[ge],Ue=ee[ge+1],st=ee[ge+2],Qe=ee[ge+3];ee[ge]=(be%2==1?(be+1)/-2:be/2)+ee[ge-1],ee[ge+1]=(Ue%2==1?(Ue+1)/-2:Ue/2)+ee[ge],ee[ge+2]=(st%2==1?(st+1)/-2:st/2)+ee[ge+1],ee[ge+3]=(Qe%2==1?(Qe+1)/-2:Qe/2)+ee[ge+2]}for(;ge!=ee.length;++ge)ee[ge]=(ee[ge]%2==1?(ee[ge]+1)/-2:ee[ge]/2)+ee[ge-1]})(Y),Y;case yn.RLE:return(function(ee,ie,ge){return ey(ee,ie.runs,ie.numRleValues)})(Y,J);case yn.NONE:return Y;default:throw new Error(`The specified Logical level technique is not supported: ${J.logicalLevelTechnique1}`)}})(G,F)})(i,n,u);return new Rm(o,I,p)}const C=Lh(i,n,u,!1);return new Oh(o,C,p)}case er.SEQUENCE:{const C=Cu(i,n,u);return new Gm(o,C[0],C[1],u.numRleValues)}case er.CONST:{const C=Vm(i,n,u,!1);return new Wd(o,C,p)}}throw new Error("Vector type not supported for id column.")}class r_{constructor(e,n){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case yr.POINT:case yr.MULTIPOINT:this.type=1;break;case yr.LINESTRING:case yr.MULTILINESTRING:this.type=2;break;case yr.POLYGON:case yr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const o=[];for(const u of n)o.push(new N(u.x,u.y));e.push(o)}return e}}class ly{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new r_(this.features[e],this.extent)}}class tf{constructor(e){this.layers={};const n=(function(o,u,p=!0){const g=new Kg(0),x=[];for(;g.get()<o.length;){const T=_r(o,g,1)[0]>>>0,C=g.get()+T;if(C>o.length)throw new Error(`Block overruns tile: ${C} > ${o.length}`);if(_r(o,g,1)[0]>>>0!=1){g.set(C);continue}const I=oy(o,g),L=I[1],B=I[0].featureTables[0];let F=null,q=null;const G=[];let Y=0;for(const he of B.columns){const ee=he.name;if(ee==="id"){let ie=null;if(he.nullable){const be=ea(o,g),Ue=g.get(),st=Kd(o,be.numValues,g);g.set(Ue+be.byteLength),ie=new co(st,be.numValues)}const ge=ea(o,g);Y=ge.decompressedCount,F=ef(o,he,g,ee,ge,ie??Y,p)}else if(ee==="geometry"){const ie=_r(o,g,1)[0];if(Y===0){const ge=g.get();Y=ea(o,g).decompressedCount,g.set(ge)}q=iy(o,ie,g,Y)}else{const ie=Tc(he)?_r(o,g,1)[0]:1;if(ie===0&&he.type==="scalarType")continue;const ge=wc(o,g,he,ie,Y);if(ge)if(Array.isArray(ge))for(const be of ge)G.push(be);else G.push(ge)}}const J=new _c(B.name,q,F,G,L);x.push(J),g.set(C)}return x})(new Uint8Array(e));this.layers=n.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new ly(u)})),{})}}class cy{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of n){const u=[];for(const p of o)u.push(new N(p[0],p[1]));e.push(u)}return e}}const nf="_geojsonTileLayer";function Ip(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<i.length;p++)n.feature=i.feature(p),e.writeMessage(2,kp,n);const o=n.keys;for(const p of o)e.writeStringField(3,p);const u=n.values;for(const p of u)e.writeMessage(4,Rp,p)}function kp(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,uy,i),e.writeVarintField(3,n.type),e.writeMessage(4,Km,n)}function uy(i,e){for(const n in i.feature?.properties){let o=i.feature.properties[n],u=i.keycache[n];if(o==null)continue;u===void 0&&(i.keys.push(n),u=i.keys.length-1,i.keycache[n]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const p=typeof o+":"+o;let g=i.valuecache[p];g===void 0&&(i.values.push(o),g=i.values.length-1,i.valuecache[p]=g),e.writeVarint(g)}}function Sc(i,e){return(e<<3)+(7&i)}function Wm(i){return i<<1^i>>31}function Km(i,e){const n=i.loadGeometry(),o=i.type;let u=0,p=0;for(const g of n){let x=1;o===1&&(x=g.length),e.writeVarint(Sc(1,x));const T=o===3?g.length-1:g.length;for(let C=0;C<T;C++){C===1&&o!==1&&e.writeVarint(Sc(2,T-1));const I=g[C].x-u,L=g[C].y-p;e.writeVarint(Wm(I)),e.writeVarint(Wm(L)),u+=I,p+=L}i.type===3&&e.writeVarint(Sc(7,1))}}function Rp(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Qm{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Do(xt,16,0),this.grid3D=new Do(xt,16,0),this.featureIndexArray=new K,this.promoteId=n}insert(e,n,o,u,p,g){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const T=g?this.grid3D:this.grid;for(let C=0;C<n.length;C++){const I=n[C],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<I.length;B++){const F=I[B];L[0]=Math.min(L[0],F.x),L[1]=Math.min(L[1],F.y),L[2]=Math.max(L[2],F.x),L[3]=Math.max(L[3],F.y)}L[0]<xt&&L[1]<xt&&L[2]>=0&&L[3]>=0&&T.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Cn(new sp(this.rawTileData)).layers:new tf(this.rawTileData).layers,this.sourceLayerCoder=new km(this.vtLayers?Object.keys(this.vtLayers).sort():[nf])),this.vtLayers}query(e,n,o,u){this.loadVTLayers();const p=e.params,g=xt/e.tileSize/e.scale,x=Hr(p.filter,p.globalState),T=e.queryGeometry,C=e.queryPadding*g,I=gc.fromPoints(T),L=this.grid.query(I.minX-C,I.minY-C,I.maxX+C,I.maxY+C),B=gc.fromPoints(e.cameraQueryGeometry).expandBy(C),F=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((Y,J,he,ee)=>(function(ie,ge,be,Ue,st){for(const mt of ie)if(ge<=mt.x&&be<=mt.y&&Ue>=mt.x&&st>=mt.y)return!0;const Qe=[new N(ge,be),new N(ge,st),new N(Ue,st),new N(Ue,be)];if(ie.length>2){for(const mt of Qe)if(Lo(ie,mt))return!0}for(let mt=0;mt<ie.length-1;mt++)if(mg(ie[mt],ie[mt+1],Qe))return!0;return!1})(e.cameraQueryGeometry,Y-C,J-C,he+C,ee+C)));for(const Y of F)L.push(Y);L.sort(Lp);const q={};let G;for(let Y=0;Y<L.length;Y++){const J=L[Y];if(J===G)continue;G=J;const he=this.featureIndexArray.get(J);let ee=null;this.loadMatchingFeature(q,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,x,p.layers,p.availableImages,n,o,u,((ie,ge,be)=>(ee||(ee=io(ie)),ge.queryIntersectsFeature({queryGeometry:T,feature:ie,featureState:be,geometry:ee,zoom:this.z,transform:e.transform,pixelsToTileUnits:g,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return q}loadMatchingFeature(e,n,o,u,p,g,x,T,C,I,L){const B=this.bucketLayerIDs[n];if(g&&!B.some((Y=>g.has(Y))))return;const F=this.sourceLayerCoder.decode(o),q=this.vtLayers[F].feature(u);if(p.needGeometry){const Y=rs(q,!0);if(!p.filter(new Vn(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!p.filter(new Vn(this.tileID.overscaledZ),q))return;const G=this.getId(q,F);for(let Y=0;Y<B.length;Y++){const J=B[Y];if(g&&!g.has(J))continue;const he=T[J];if(!he)continue;let ee={};G&&I&&(ee=I.getState(he.sourceLayer||nf,G));const ie=mn({},C[J]);ie.paint=hy(ie.paint,he.paint,q,ee,x),ie.layout=hy(ie.layout,he.layout,q,ee,x);const ge=!L||L(q,he,ee);if(!ge)continue;const be=new xp(q,this.z,this.x,this.y,G);be.layer=ie;let Ue=e[J];Ue===void 0&&(Ue=e[J]=[]),Ue.push({featureIndex:u,feature:be,intersectionZ:ge})}}lookupSymbolFeatures(e,n,o,u,p,g,x,T){const C={};this.loadVTLayers();const I=Hr(p.filterSpec,p.globalState);for(const L of e)this.loadMatchingFeature(C,o,u,L,I,g,x,T,n);return C}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function hy(i,e,n,o,u){return wn(i,((p,g)=>{const x=e instanceof dl?e.get(g):null;return x&&x.evaluate?x.evaluate(n,o,u):x}))}function Lp(i,e){return e-i}function r(i,e,n,o,u){const p=[];for(let g=0;g<i.length;g++){const x=i[g];let T;for(let C=0;C<x.length-1;C++){let I=x[C],L=x[C+1];I.x<e&&L.x<e||(I.x<e?I=new N(e,I.y+(e-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x<e&&(L=new N(e,I.y+(e-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y<n&&L.y<n||(I.y<n?I=new N(I.x+(n-I.y)/(L.y-I.y)*(L.x-I.x),n)._round():L.y<n&&(L=new N(I.x+(n-I.y)/(L.y-I.y)*(L.x-I.x),n)._round()),I.x>=o&&L.x>=o||(I.x>=o?I=new N(o,I.y+(o-I.x)/(L.x-I.x)*(L.y-I.y))._round():L.x>=o&&(L=new N(o,I.y+(o-I.x)/(L.x-I.x)*(L.y-I.y))._round()),I.y>=u&&L.y>=u||(I.y>=u?I=new N(I.x+(u-I.y)/(L.y-I.y)*(L.x-I.x),u)._round():L.y>=u&&(L=new N(I.x+(u-I.y)/(L.y-I.y)*(L.x-I.x),u)._round()),T&&I.equals(T[T.length-1])||(T=[I],p.push(T)),T.push(L)))))}}return p}function s(i,e,n,o,u){switch(e){case 1:return(function(p,g,x,T){const C=[];for(const I of p)for(const L of I){const B=T===0?L.x:L.y;B>=g&&B<=x&&C.push([L])}return C})(i,n,o,u);case 2:return _(i,n,o,u,!1);case 3:return _(i,n,o,u,!0)}return[]}function d(i,e,n,o,u){const p=o===0?M:P;let g=[];const x=[];for(let I=0;I<i.length-1;I++){const L=i[I],B=i[I+1],F=o===0?L.x:L.y,q=o===0?B.x:B.y;let G=!1;F<e?q>e&&g.push(p(L,B,e)):F>n?q<n&&g.push(p(L,B,n)):g.push(L),q<e&&F>=e&&(g.push(p(L,B,e)),G=!0),q>n&&F<=n&&(g.push(p(L,B,n)),G=!0),!u&&G&&(x.push(g),g=[])}const T=i.length-1,C=o===0?i[T].x:i[T].y;return C>=e&&C<=n&&g.push(i[T]),u&&g.length>0&&!g[0].equals(g[g.length-1])&&g.push(new N(g[0].x,g[0].y)),g.length>0&&x.push(g),x}function _(i,e,n,o,u){const p=[];for(const g of i){const x=d(g,e,n,o,u);x.length>0&&p.push(...x)}return p}function M(i,e,n){return new N(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function P(i,e,n){return new N(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}kt("FeatureIndex",Qm,{omit:["rawTileData","sourceLayerCoder"]});class V extends N{constructor(e,n,o,u){super(e,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new V(this.x,this.y,this.angle,this.segment)}}function te(i,e,n,o,u){if(e.segment===void 0||n===0)return!0;let p=e,g=e.segment+1,x=0;for(;x>-n/2;){if(g--,g<0)return!1;x-=i[g].dist(p),p=i[g]}x+=i[g].dist(i[g+1]),g++;const T=[];let C=0;for(;x<n/2;){const I=i[g],L=i[g+1];if(!L)return!1;let B=i[g-1].angleTo(I)-I.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:B}),C+=B;x-T[0].distance>o;)C-=T.shift().angleDelta;if(C>u)return!1;g++,x+=I.dist(L)}return!0}function Me(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function Ye(i,e,n){return i?.6*e*n:0}function dt(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function vt(i,e,n,o,u,p){const g=Ye(n,u,p),x=dt(n,o)*p;let T=0;const C=Me(i)/2;for(let I=0;I<i.length-1;I++){const L=i[I],B=i[I+1],F=L.dist(B);if(T+F>C){const q=(C-T)/F,G=mi.number(L.x,B.x,q),Y=mi.number(L.y,B.y,q),J=new V(G,Y,B.angleTo(L),I);return J._round(),!g||te(i,J,x,g,e)?J:void 0}T+=F}}function We(i,e,n,o,u,p,g,x,T){const C=Ye(o,p,g),I=dt(o,u),L=I*g,B=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-L<e/4&&(e=L+e/4),et(i,B?e/2*x%e:(I/2+2*p)*g*x%e,e,C,n,L,B,!1,T)}function et(i,e,n,o,u,p,g,x,T){const C=p/2,I=Me(i);let L=0,B=e-n,F=[];for(let q=0;q<i.length-1;q++){const G=i[q],Y=i[q+1],J=G.dist(Y),he=Y.angleTo(G);for(;B+n<L+J;){B+=n;const ee=(B-L)/J,ie=mi.number(G.x,Y.x,ee),ge=mi.number(G.y,Y.y,ee);if(ie>=0&&ie<T&&ge>=0&&ge<T&&B-C>=0&&B+C<=I){const be=new V(ie,ge,he,q);be._round(),o&&!te(i,be,p,o,u)||F.push(be)}}L+=J}return x||F.length||g||(F=et(i,L/2,n,o,u,p,g,!0,T)),F}function Gt(i,e,n,o){const u=[],p=i.image,g=p.pixelRatio,x=p.paddedRect.w-2,T=p.paddedRect.h-2;let C={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const I=p.stretchX||[[0,x]],L=p.stretchY||[[0,T]],B=($e,Ot)=>$e+Ot[1]-Ot[0],F=I.reduce(B,0),q=L.reduce(B,0),G=x-F,Y=T-q;let J=0,he=F,ee=0,ie=q,ge=0,be=G,Ue=0,st=Y;if(p.content&&o){const $e=p.content,Ot=$e[2]-$e[0],Rt=$e[3]-$e[1];(p.textFitWidth||p.textFitHeight)&&(C=Al(i)),J=tn(I,0,$e[0]),ee=tn(L,0,$e[1]),he=tn(I,$e[0],$e[2]),ie=tn(L,$e[1],$e[3]),ge=$e[0]-J,Ue=$e[1]-ee,be=Ot-he,st=Rt-ie}const Qe=C.x1,mt=C.y1,Ct=C.x2-Qe,yt=C.y2-mt,tt=($e,Ot,Rt,Ft)=>{const It=Ne($e.stretch-J,he,Ct,Qe),Ht=De($e.fixed-ge,be,$e.stretch,F),On=Ne(Ot.stretch-ee,ie,yt,mt),vn=De(Ot.fixed-Ue,st,Ot.stretch,q),Li=Ne(Rt.stretch-J,he,Ct,Qe),na=De(Rt.fixed-ge,be,Rt.stretch,F),vr=Ne(Ft.stretch-ee,ie,yt,mt),Oi=De(Ft.fixed-Ue,st,Ft.stretch,q),Si=new N(It,On),Wn=new N(Li,On),Yi=new N(Li,vr),tr=new N(It,vr),vi=new N(Ht/g,vn/g),ls=new N(na/g,Oi/g),ia=e*Math.PI/180;if(ia){const kr=Math.sin(ia),qi=Math.cos(ia),xr=[qi,-kr,kr,qi];Si._matMult(xr),Wn._matMult(xr),tr._matMult(xr),Yi._matMult(xr)}const cs=$e.stretch+$e.fixed,Uo=Ot.stretch+Ot.fixed;return{tl:Si,tr:Wn,bl:tr,br:Yi,tex:{x:p.paddedRect.x+1+cs,y:p.paddedRect.y+1+Uo,w:Rt.stretch+Rt.fixed-cs,h:Ft.stretch+Ft.fixed-Uo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vi,pixelOffsetBR:ls,minFontScaleX:be/g/Ct,minFontScaleY:st/g/yt,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const $e=oi(I,G,F),Ot=oi(L,Y,q);for(let Rt=0;Rt<$e.length-1;Rt++){const Ft=$e[Rt],It=$e[Rt+1];for(let Ht=0;Ht<Ot.length-1;Ht++)u.push(tt(Ft,Ot[Ht],It,Ot[Ht+1]))}}else u.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return u}function tn(i,e,n){let o=0;for(const u of i)o+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return o}function oi(i,e,n){const o=[{fixed:-1,stretch:0}];for(const[u,p]of i){const g=o[o.length-1];o.push({fixed:u-g.stretch,stretch:g.stretch}),o.push({fixed:u-g.stretch,stretch:g.stretch+(p-u)})}return o.push({fixed:e+1,stretch:n}),o}function Ne(i,e,n,o){return i/e*n+o}function De(i,e,n,o){return i-e*n/o}kt("Anchor",V);class He{constructor(e,n,o,u,p,g,x,T,C,I){var L;if(this.boxStartIndex=e.length,C){let B=g.top,F=g.bottom;const q=g.collisionPadding;q&&(B-=q[1],F+=q[3]);let G=F-B;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{const B=!((L=g.image)===null||L===void 0)&&L.content&&(g.image.textFitWidth||g.image.textFitHeight)?Al(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};B.y1=B.y1*x-T[0],B.y2=B.y2*x+T[2],B.x1=B.x1*x-T[3],B.x2=B.x2*x+T[1];const F=g.collisionPadding;if(F&&(B.x1-=F[0]*x,B.y1-=F[1]*x,B.x2+=F[2]*x,B.y2+=F[3]*x),I){const q=new N(B.x1,B.y1),G=new N(B.x2,B.y1),Y=new N(B.x1,B.y2),J=new N(B.x2,B.y2),he=I*Math.PI/180;q._rotate(he),G._rotate(he),Y._rotate(he),J._rotate(he),B.x1=Math.min(q.x,G.x,Y.x,J.x),B.x2=Math.max(q.x,G.x,Y.x,J.x),B.y1=Math.min(q.y,G.y,Y.y,J.y),B.y2=Math.max(q.y,G.y,Y.y,J.y)}e.emplaceBack(n.x,n.y,B.x1,B.y1,B.x2,B.y2,o,u,p)}this.boxEndIndex=e.length}}class gt{constructor(e=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,u=n[e];for(;e>0;){const p=e-1>>1,g=n[p];if(o(u,g)>=0)break;n[e]=g,e=p}n[e]=u}_down(e){const{data:n,compare:o}=this,u=this.length>>1,p=n[e];for(;e<u;){let g=1+(e<<1);const x=g+1;if(x<this.length&&o(n[x],n[g])<0&&(g=x),o(n[g],p)>=0)break;n[e]=n[g],e=g}n[e]=p}}function en(i,e=1,n=!1){const o=gc.fromPoints(i[0]),u=Math.min(o.width(),o.height());let p=u/2;const g=new gt([],Yn),{minX:x,minY:T,maxX:C,maxY:I}=o;if(u===0)return new N(x,T);for(let F=x;F<C;F+=u)for(let q=T;q<I;q+=u)g.push(new Zt(F+p,q+p,p,i));let L=(function(F){let q=0,G=0,Y=0;const J=F[0];for(let he=0,ee=J.length,ie=ee-1;he<ee;ie=he++){const ge=J[he],be=J[ie],Ue=ge.x*be.y-be.x*ge.y;G+=(ge.x+be.x)*Ue,Y+=(ge.y+be.y)*Ue,q+=3*Ue}return new Zt(G/q,Y/q,0,F)})(i),B=g.length;for(;g.length;){const F=g.pop();(F.d>L.d||!L.d)&&(L=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,B)),F.max-L.d<=e||(p=F.h/2,g.push(new Zt(F.p.x-p,F.p.y-p,p,i)),g.push(new Zt(F.p.x+p,F.p.y-p,p,i)),g.push(new Zt(F.p.x-p,F.p.y+p,p,i)),g.push(new Zt(F.p.x+p,F.p.y+p,p,i)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function Yn(i,e){return e.max-i.max}function Zt(i,e,n,o){this.p=new N(i,e),this.h=n,this.d=(function(u,p){let g=!1,x=1/0;for(let T=0;T<p.length;T++){const C=p[T];for(let I=0,L=C.length,B=L-1;I<L;B=I++){const F=C[I],q=C[B];F.y>u.y!=q.y>u.y&&u.x<(q.x-F.x)*(u.y-F.y)/(q.y-F.y)+F.x&&(g=!g),x=Math.min(x,tm(u,F,q))}}return(g?1:-1)*Math.sqrt(x)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Wt;A.aP=void 0,(Wt=A.aP||(A.aP={}))[Wt.center=1]="center",Wt[Wt.left=2]="left",Wt[Wt.right=3]="right",Wt[Wt.top=4]="top",Wt[Wt.bottom=5]="bottom",Wt[Wt["top-left"]=6]="top-left",Wt[Wt["top-right"]=7]="top-right",Wt[Wt["bottom-left"]=8]="bottom-left",Wt[Wt["bottom-right"]=9]="bottom-right";const Mn=Number.POSITIVE_INFINITY;function Gn(i,e){return e[1]!==Mn?(function(n,o,u){let p=0,g=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,g]})(i,e[0],e[1]):(function(n,o){let u=0,p=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":p=g-7;break;case"bottom-right":case"bottom-left":p=7-g;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=o;break;case"right":u=-o}return[u,p]})(i,e[0])}function Pl(i,e,n){var o;const u=i.layout,p=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(p){const x=p.values,T=[];for(let C=0;C<x.length;C+=2){const I=T[C]=x[C],L=x[C+1].map((B=>B*or));I.startsWith("top")?L[1]-=7:I.startsWith("bottom")&&(L[1]+=7),T[C+1]=L}return new zi(T)}const g=u.get("text-variable-anchor");if(g){let x;x=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},n)*or,Mn]:u.get("text-offset").evaluate(e,{},n).map((C=>C*or));const T=[];for(const C of g)T.push(C,Gn(C,x));return new zi(T)}return null}function Jm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function m1(i,e,n,o,u,p,g,x,T,C,I,L){let B=p.textMaxSize.evaluate(e,{});B===void 0&&(B=g);const F=i.layers[0].layout,q=F.get("icon-offset").evaluate(e,{},I),G=j0(n.horizontal),Y=g/24,J=i.tilePixelRatio*Y,he=i.tilePixelRatio*B/24,ee=i.tilePixelRatio*x,ie=i.tilePixelRatio*F.get("symbol-spacing"),ge=F.get("text-padding")*i.tilePixelRatio,be=(function(Rt,Ft,It,Ht=1){const On=Rt.get("icon-padding").evaluate(Ft,{},It),vn=On&&On.values;return[vn[0]*Ht,vn[1]*Ht,vn[2]*Ht,vn[3]*Ht]})(F,e,I,i.tilePixelRatio),Ue=F.get("text-max-angle")/180*Math.PI,st=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Qe=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",mt=F.get("symbol-placement"),Ct=ie/2,yt=F.get("icon-text-fit");let tt;o&&yt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(tt=so(o,n.vertical,yt,F.get("icon-text-fit-padding"),q,Y)),G&&(o=so(o,G,yt,F.get("icon-text-fit-padding"),q,Y)));const $e=I?L.line.getGranularityForZoomLevel(I.z):1,Ot=(Rt,Ft)=>{Ft.x<0||Ft.x>=xt||Ft.y<0||Ft.y>=xt||(function(It,Ht,On,vn,Li,na,vr,Oi,Si,Wn,Yi,tr,vi,ls,ia,cs,Uo,kr,qi,xr,Wi,Rr,Du,Il,ng){const jh=It.addToLineVertexArray(Ht,On);let rf,Op,Bp,Np,G0=0,Z0=0,H0=0,$0=0,d_=-1,f_=-1;const Pu={};let X0=ki("");if(It.allowVerticalPlacement&&vn.vertical){const wa=Oi.layout.get("text-rotate").evaluate(Wi,{},Il)+90;Bp=new He(Si,Ht,Wn,Yi,tr,vn.vertical,vi,ls,ia,wa),vr&&(Np=new He(Si,Ht,Wn,Yi,tr,vr,Uo,kr,ia,wa))}if(Li){const wa=Oi.layout.get("icon-rotate").evaluate(Wi,{}),uo=Oi.layout.get("icon-text-fit")!=="none",af=Gt(Li,wa,Du,uo),Rl=vr?Gt(vr,wa,Du,uo):void 0;Op=new He(Si,Ht,Wn,Yi,tr,Li,Uo,kr,!1,wa),G0=4*af.length;const sf=It.iconSizeData;let Ec=null;sf.kind==="source"?(Ec=[ss*Oi.layout.get("icon-size").evaluate(Wi,{})],Ec[0]>pc&&Dn(`${It.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):sf.kind==="composite"&&(Ec=[ss*Rr.compositeIconSizes[0].evaluate(Wi,{},Il),ss*Rr.compositeIconSizes[1].evaluate(Wi,{},Il)],(Ec[0]>pc||Ec[1]>pc)&&Dn(`${It.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),It.addSymbols(It.icon,af,Ec,xr,qi,Wi,A.az.none,Ht,jh.lineStartIndex,jh.lineLength,-1,Il),d_=It.icon.placedSymbolArray.length-1,Rl&&(Z0=4*Rl.length,It.addSymbols(It.icon,Rl,Ec,xr,qi,Wi,A.az.vertical,Ht,jh.lineStartIndex,jh.lineLength,-1,Il),f_=It.icon.placedSymbolArray.length-1)}const Y0=Object.keys(vn.horizontal);for(const wa of Y0){const uo=vn.horizontal[wa];if(!rf){X0=ki(uo.text);const Rl=Oi.layout.get("text-rotate").evaluate(Wi,{},Il);rf=new He(Si,Ht,Wn,Yi,tr,uo,vi,ls,ia,Rl)}const af=uo.positionedLines.length===1;if(H0+=F0(It,Ht,uo,na,Oi,ia,Wi,cs,jh,vn.vertical?A.az.horizontal:A.az.horizontalOnly,af?Y0:[wa],Pu,d_,Rr,Il),af)break}vn.vertical&&($0+=F0(It,Ht,vn.vertical,na,Oi,ia,Wi,cs,jh,A.az.vertical,["vertical"],Pu,f_,Rr,Il));const _1=rf?rf.boxStartIndex:It.collisionBoxArray.length,v1=rf?rf.boxEndIndex:It.collisionBoxArray.length,x1=Bp?Bp.boxStartIndex:It.collisionBoxArray.length,b1=Bp?Bp.boxEndIndex:It.collisionBoxArray.length,w1=Op?Op.boxStartIndex:It.collisionBoxArray.length,T1=Op?Op.boxEndIndex:It.collisionBoxArray.length,S1=Np?Np.boxStartIndex:It.collisionBoxArray.length,E1=Np?Np.boxEndIndex:It.collisionBoxArray.length;let kl=-1;const fy=(wa,uo)=>wa&&wa.circleDiameter?Math.max(wa.circleDiameter,uo):uo;kl=fy(rf,kl),kl=fy(Bp,kl),kl=fy(Op,kl),kl=fy(Np,kl);const W0=kl>-1?1:0;W0&&(kl*=ng/or),It.glyphOffsetArray.length>=Ph.MAX_GLYPHS&&Dn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Wi.sortKey!==void 0&&It.addToSortKeyRanges(It.symbolInstances.length,Wi.sortKey);const M1=Pl(Oi,Wi,Il),[A1,C1]=(function(wa,uo){const af=wa.length,Rl=uo?.values;if(Rl?.length>0)for(let sf=0;sf<Rl.length;sf+=2){const Ec=Rl[sf+1];wa.emplaceBack(A.aP[Rl[sf]],Ec[0],Ec[1])}return[af,wa.length]})(It.textAnchorOffsets,M1);It.symbolInstances.emplaceBack(Ht.x,Ht.y,Pu.right>=0?Pu.right:-1,Pu.center>=0?Pu.center:-1,Pu.left>=0?Pu.left:-1,Pu.vertical||-1,d_,f_,X0,_1,v1,x1,b1,w1,T1,S1,E1,Wn,H0,$0,G0,Z0,W0,0,vi,kl,A1,C1)})(i,Ft,Rt,n,o,u,tt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,J,[ge,ge,ge,ge],st,T,ee,be,Qe,q,e,p,C,I,g)};if(mt==="line")for(const Rt of r(e.geometry,0,0,xt,xt)){const Ft=wl(Rt,$e),It=We(Ft,ie,Ue,n.vertical||G,o,24,he,i.overscaling,xt);for(const Ht of It)G&&g1(i,G.text,Ct,Ht)||Ot(Ft,Ht)}else if(mt==="line-center"){for(const Rt of e.geometry)if(Rt.length>1){const Ft=wl(Rt,$e),It=vt(Ft,Ue,n.vertical||G,o,24,he);It&&Ot(Ft,It)}}else if(e.type==="Polygon")for(const Rt of Xc(e.geometry,0)){const Ft=en(Rt,16);Ot(wl(Rt[0],$e,!0),new V(Ft.x,Ft.y,0))}else if(e.type==="LineString")for(const Rt of e.geometry){const Ft=wl(Rt,$e);Ot(Ft,new V(Ft[0].x,Ft[0].y,0))}else if(e.type==="Point")for(const Rt of e.geometry)for(const Ft of Rt)Ot([Ft],new V(Ft.x,Ft.y,0))}function F0(i,e,n,o,u,p,g,x,T,C,I,L,B,F,q){const G=(function(he,ee,ie,ge,be,Ue,st,Qe){const mt=ge.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,Ct=[];for(const yt of ee.positionedLines)for(const tt of yt.positionedGlyphs){if(!tt.rect)continue;const $e=tt.rect||{};let Ot=4,Rt=!0,Ft=1,It=0;const Ht=(be||Qe)&&tt.vertical,On=tt.metrics.advance*tt.scale/2;if(Qe&&ee.verticalizable&&(It=yt.lineOffset/2-(tt.imageName?-(or-tt.metrics.width*tt.scale)/2:(tt.scale-1)*or)),tt.imageName){const kr=st[tt.imageName];Rt=kr.sdf,Ft=kr.pixelRatio,Ot=1/Ft}const vn=be?[tt.x+On,tt.y]:[0,0];let Li=be?[0,0]:[tt.x+On+ie[0],tt.y+ie[1]-It],na=[0,0];Ht&&(na=Li,Li=[0,0]);const vr=tt.metrics.isDoubleResolution?2:1,Oi=(tt.metrics.left-Ot)*tt.scale-On+Li[0],Si=(-tt.metrics.top-Ot)*tt.scale+Li[1],Wn=Oi+$e.w/vr*tt.scale/Ft,Yi=Si+$e.h/vr*tt.scale/Ft,tr=new N(Oi,Si),vi=new N(Wn,Si),ls=new N(Oi,Yi),ia=new N(Wn,Yi);if(Ht){const kr=new N(-On,On- -17),qi=-Math.PI/2,xr=12-On,Wi=new N(22-xr,-(tt.imageName?xr:0)),Rr=new N(...na);tr._rotateAround(qi,kr)._add(Wi)._add(Rr),vi._rotateAround(qi,kr)._add(Wi)._add(Rr),ls._rotateAround(qi,kr)._add(Wi)._add(Rr),ia._rotateAround(qi,kr)._add(Wi)._add(Rr)}if(mt){const kr=Math.sin(mt),qi=Math.cos(mt),xr=[qi,-kr,kr,qi];tr._matMult(xr),vi._matMult(xr),ls._matMult(xr),ia._matMult(xr)}const cs=new N(0,0),Uo=new N(0,0);Ct.push({tl:tr,tr:vi,bl:ls,br:ia,tex:$e,writingMode:ee.writingMode,glyphOffset:vn,sectionIndex:tt.sectionIndex,isSDF:Rt,pixelOffsetTL:cs,pixelOffsetBR:Uo,minFontScaleX:0,minFontScaleY:0})}return Ct})(0,n,x,u,p,g,o,i.allowVerticalPlacement),Y=i.textSizeData;let J=null;Y.kind==="source"?(J=[ss*u.layout.get("text-size").evaluate(g,{})],J[0]>pc&&Dn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Y.kind==="composite"&&(J=[ss*F.compositeTextSizes[0].evaluate(g,{},q),ss*F.compositeTextSizes[1].evaluate(g,{},q)],(J[0]>pc||J[1]>pc)&&Dn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,G,J,x,p,g,C,e,T.lineStartIndex,T.lineLength,B,q);for(const he of I)L[he]=i.text.placedSymbolArray.length-1;return 4*G.length}function j0(i){for(const e in i)return i[e];return null}function g1(i,e,n,o){const u=i.compareText;if(e in u){const p=u[e];for(let g=p.length-1;g>=0;g--)if(o.dist(p[g])<n)return!0}else u[e]=[];return u[e].push(o),!1}const U0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class a_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=U0[15&o];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new a_(x,g,p,e)}constructor(e,n=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=U0.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return s_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:x}=this,T=[0,p.length-1,0],C=[];for(;T.length;){const I=T.pop()||0,L=T.pop()||0,B=T.pop()||0;if(L-B<=x){for(let Y=B;Y<=L;Y++){const J=g[2*Y],he=g[2*Y+1];J>=e&&J<=o&&he>=n&&he<=u&&C.push(p[Y])}continue}const F=B+L>>1,q=g[2*F],G=g[2*F+1];q>=e&&q<=o&&G>=n&&G<=u&&C.push(p[F]),(I===0?e<=q:n<=G)&&(T.push(B),T.push(F-1),T.push(1-I)),(I===0?o>=q:u>=G)&&(T.push(F+1),T.push(L),T.push(1-I))}return C}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:g}=this,x=[0,u.length-1,0],T=[],C=o*o;for(;x.length;){const I=x.pop()||0,L=x.pop()||0,B=x.pop()||0;if(L-B<=g){for(let Y=B;Y<=L;Y++)q0(p[2*Y],p[2*Y+1],e,n)<=C&&T.push(u[Y]);continue}const F=B+L>>1,q=p[2*F],G=p[2*F+1];q0(q,G,e,n)<=C&&T.push(u[F]),(I===0?e-o<=q:n-o<=G)&&(x.push(B),x.push(F-1),x.push(1-I)),(I===0?e+o>=q:n+o>=G)&&(x.push(F+1),x.push(L),x.push(1-I))}return T}}function s_(i,e,n,o,u,p){if(u-o<=n)return;const g=o+u>>1;V0(i,e,g,o,u,p),s_(i,e,n,o,g-1,1-p),s_(i,e,n,g+1,u,1-p)}function V0(i,e,n,o,u,p){for(;u>o;){if(u-o>600){const C=u-o+1,I=n-o+1,L=Math.log(C),B=.5*Math.exp(2*L/3),F=.5*Math.sqrt(L*B*(C-B)/C)*(I-C/2<0?-1:1);V0(i,e,n,Math.max(o,Math.floor(n-I*B/C+F)),Math.min(u,Math.floor(n+(C-I)*B/C+F)),p)}const g=e[2*n+p];let x=o,T=u;for(eg(i,e,o,n),e[2*u+p]>g&&eg(i,e,o,u);x<T;){for(eg(i,e,x,T),x++,T--;e[2*x+p]<g;)x++;for(;e[2*T+p]>g;)T--}e[2*o+p]===g?eg(i,e,o,T):(T++,eg(i,e,T,u)),T<=n&&(o=T+1),n<=T&&(u=T-1)}}function eg(i,e,n,o){o_(i,n,o),o_(e,2*n,2*o),o_(e,2*n+1,2*o+1)}function o_(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function q0(i,e,n,o){const u=i-n,p=e-o;return u*u+p*p}var l_;A.cH=void 0,(l_=A.cH||(A.cH={})).create="create",l_.load="load",l_.fullLoad="fullLoad";let dy=null,tg=[];const c_=1e3/60,u_="loadTime",h_="fullLoadTime",y1={mark(i){performance.mark(i)},frame(i){const e=i;dy!=null&&tg.push(e-dy),dy=e},clearMetrics(){dy=null,tg=[],performance.clearMeasures(u_),performance.clearMeasures(h_);for(const i in A.cH)performance.clearMarks(A.cH[i])},getPerformanceMetrics(){performance.measure(u_,A.cH.create,A.cH.load),performance.measure(h_,A.cH.create,A.cH.fullLoad);const i=performance.getEntriesByName(u_)[0].duration,e=performance.getEntriesByName(h_)[0].duration,n=tg.length,o=1/(tg.reduce(((p,g)=>p+g),0)/n/1e3),u=tg.filter((p=>p>c_)).reduce(((p,g)=>p+(g-c_)/c_),0);return{loadTime:i,fullLoadTime:e,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};A.$=ae,A.A=at,A.B=Ka,A.C=sr,A.D=Lt,A.E=dn,A.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},A.G=mi,A.H=Vn,A.I=ii,A.J=ch,A.K=function(i){if(Kn==null){const e=i.navigator?i.navigator.userAgent:null;Kn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Kn},A.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yp((()=>this.process())),this.subscription=Sa(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Ni(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=e?Sa(e.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[u];const T={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),zm):null;this.resolveRejects[u]={resolve:T=>{p?.unsubscribe(),n(T)},reject:T=>{p?.unsubscribe(),o(T)}};const g=[],x=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Qa(i.data,g)});this.target.postMessage(x,{transfer:g})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Ni(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return l(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(rc(e.error)):u.resolve(rc(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=rc(e.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,n,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}}))}completeTask(i,e,n){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Qa(e):null,data:Qa(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},A.M=Re,A.N=function(){var i=new at(16);return at!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},A.O=function(i,e,n){var o,u,p,g,x,T,C,I,L,B,F,q,G=n[0],Y=n[1],J=n[2];return e===i?(i[12]=e[0]*G+e[4]*Y+e[8]*J+e[12],i[13]=e[1]*G+e[5]*Y+e[9]*J+e[13],i[14]=e[2]*G+e[6]*Y+e[10]*J+e[14],i[15]=e[3]*G+e[7]*Y+e[11]*J+e[15]):(u=e[1],p=e[2],g=e[3],x=e[4],T=e[5],C=e[6],I=e[7],L=e[8],B=e[9],F=e[10],q=e[11],i[0]=o=e[0],i[1]=u,i[2]=p,i[3]=g,i[4]=x,i[5]=T,i[6]=C,i[7]=I,i[8]=L,i[9]=B,i[10]=F,i[11]=q,i[12]=o*G+x*Y+L*J+e[12],i[13]=u*G+T*Y+B*J+e[13],i[14]=p*G+C*Y+F*J+e[14],i[15]=g*G+I*Y+q*J+e[15]),i},A.P=N,A.Q=function(i,e,n){var o=n[0],u=n[1],p=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},A.R=Qr,A.S=function(i,e,n){var o=e[0],u=e[1],p=e[2],g=e[3],x=e[4],T=e[5],C=e[6],I=e[7],L=e[8],B=e[9],F=e[10],q=e[11],G=e[12],Y=e[13],J=e[14],he=e[15],ee=n[0],ie=n[1],ge=n[2],be=n[3];return i[0]=ee*o+ie*x+ge*L+be*G,i[1]=ee*u+ie*T+ge*B+be*Y,i[2]=ee*p+ie*C+ge*F+be*J,i[3]=ee*g+ie*I+ge*q+be*he,i[4]=(ee=n[4])*o+(ie=n[5])*x+(ge=n[6])*L+(be=n[7])*G,i[5]=ee*u+ie*T+ge*B+be*Y,i[6]=ee*p+ie*C+ge*F+be*J,i[7]=ee*g+ie*I+ge*q+be*he,i[8]=(ee=n[8])*o+(ie=n[9])*x+(ge=n[10])*L+(be=n[11])*G,i[9]=ee*u+ie*T+ge*B+be*Y,i[10]=ee*p+ie*C+ge*F+be*J,i[11]=ee*g+ie*I+ge*q+be*he,i[12]=(ee=n[12])*o+(ie=n[13])*x+(ge=n[14])*L+(be=n[15])*G,i[13]=ee*u+ie*T+ge*B+be*Y,i[14]=ee*p+ie*C+ge*F+be*J,i[15]=ee*g+ie*I+ge*q+be*he,i},A.T=Xf,A.U=function(i,e){const n={};for(let o=0;o<e.length;o++){const u=e[o];u in i&&(n[u]=i[u])}return n},A.V=Fo,A.W=Yt,A.X=Dm,A.Y=$g,A.Z=de,A._=l,A.a=Q,A.a$=nt,A.a0=ke,A.a1=li,A.a2=qa,A.a3=Yg,A.a4=Fd,A.a5=xt,A.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const o=Ud(i),u=Ud(e);(function(g,x){x.removeAll&&(g.add.clear(),g.update.clear(),g.remove.clear(),x.remove.clear());for(const T of x.remove)g.add.delete(T),g.update.delete(T);for(const[T,C]of x.update){const I=g.update.get(T);I&&(x.update.set(T,Im(I,C)),g.update.delete(T))}})(o,u);const p={};if((o.removeAll||u.removeAll)&&(p.removeAll=!0),p.remove=new Set([...o.remove,...u.remove]),p.add=new Map([...o.add,...u.add]),p.update=new Map([...o.update,...u.update]),p.remove.size&&p.add.size)for(const g of p.add.keys())p.remove.delete(g);return(function(g){const x={};return g.removeAll&&(x.removeAll=g.removeAll),g.remove&&(x.remove=Array.from(g.remove)),g.add&&(x.add=Array.from(g.add.values())),g.update&&(x.update=Array.from(g.update.values())),x})(p)},A.a7=function(i,e){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const o=jd(i,e);return o==null?void 0:(n.set(o,i),n)}if(i.type==="FeatureCollection"){const o=new Set;for(const u of i.features){const p=jd(u,e);if(p==null||o.has(p))return;o.add(p),n.set(p,u)}return n}},A.a8=function(i,e,n){var o,u;const p=[];if(e.removeAll)i.clear();else if(e.remove)for(const g of e.remove){const x=i.get(g);x&&(p.push(x.geometry),i.delete(g))}if(e.add)for(const g of e.add){const x=jd(g,n);if(x==null)continue;const T=i.get(x);T&&p.push(T.geometry),p.push(g.geometry),i.set(x,g)}if(e.update)for(const g of e.update){const x=i.get(g.id);if(!x)continue;const T=!!g.newGeometry,C=g.removeAllProperties||((o=g.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=g.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!T&&!C)continue;p.push(x.geometry);const I=Object.assign({},x);if(i.set(g.id,I),T&&(p.push(g.newGeometry),I.geometry=g.newGeometry),C){if(I.properties=g.removeAllProperties?{}:Object.assign({},I.properties||{}),g.removeProperties)for(const L of g.removeProperties)delete I.properties[L];if(g.addOrUpdateProperties)for(const{key:L,value:B}of g.addOrUpdateProperties)I.properties[L]=B}}return p},A.a9=Xn,A.aA=function(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/ss:i.kind==="composite"?mi.number(o/ss,u/ss,n):e},A.aB=function(i,e){var n=e[0],o=e[1],u=e[2],p=e[3],g=e[4],x=e[5],T=e[6],C=e[7],I=e[8],L=e[9],B=e[10],F=e[11],q=e[12],G=e[13],Y=e[14],J=e[15],he=n*x-o*g,ee=n*T-u*g,ie=n*C-p*g,ge=o*T-u*x,be=o*C-p*x,Ue=u*C-p*T,st=I*G-L*q,Qe=I*Y-B*q,mt=I*J-F*q,Ct=L*Y-B*G,yt=L*J-F*G,tt=B*J-F*Y,$e=he*tt-ee*yt+ie*Ct+ge*mt-be*Qe+Ue*st;return $e?(i[0]=(x*tt-T*yt+C*Ct)*($e=1/$e),i[1]=(u*yt-o*tt-p*Ct)*$e,i[2]=(G*Ue-Y*be+J*ge)*$e,i[3]=(B*be-L*Ue-F*ge)*$e,i[4]=(T*mt-g*tt-C*Qe)*$e,i[5]=(n*tt-u*mt+p*Qe)*$e,i[6]=(Y*ie-q*Ue-J*ee)*$e,i[7]=(I*Ue-B*ie+F*ee)*$e,i[8]=(g*yt-x*mt+C*st)*$e,i[9]=(o*mt-n*yt-p*st)*$e,i[10]=(q*be-G*ie+J*he)*$e,i[11]=(L*ie-I*be-F*he)*$e,i[12]=(x*Qe-g*Ct-T*st)*$e,i[13]=(n*Ct-o*Qe+u*st)*$e,i[14]=(G*ee-q*ge-Y*he)*$e,i[15]=(I*ge-L*ee+B*he)*$e,i):null},A.aC=Xe,A.aD=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},A.aE=function(i){return i[0]=0,i[1]=0,i},A.aF=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},A.aG=Em,A.aH=qt,A.aI=function(i,e,n,o){const u=e.y-i.y,p=e.x-i.x,g=o.y-n.y,x=o.x-n.x,T=g*p-x*u;if(T===0)return null;const C=(x*(i.y-n.y)-g*(i.x-n.x))/T;return new N(i.x+C*p,i.y+C*u)},A.aJ=r,A.aK=xu,A.aL=function(i){let e=1/0,n=1/0,o=-1/0,u=-1/0;for(const p of i)e=Math.min(e,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return[e,n,o,u]},A.aM=or,A.aN=Bt,A.aO=function(i,e,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const p=u?o==="map"?-i.bearingInRadians:0:o==="viewport"?i.bearingInRadians:0;if(p){const g=Math.sin(p),x=Math.cos(p);n=[n[0]*x-n[1]*g,n[0]*g+n[1]*x]}return[u?n[0]:Bt(e,n[0],i.zoom),u?n[1]:Bt(e,n[1],i.zoom)]},A.aQ=dp,A.aR=Jm,A.aS=bm,A.aT=a_,A.aU=gi,A.aV=zd,A.aW=se,A.aX=At,A.aY=Ge,A.aZ=nr,A.a_=Pm,A.aa=gc,A.ab=25,A.ac=Er,A.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const o of i){const u=window.document.createElement("source");it(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},A.ae=Be,A.af=function(){return Kt++},A.ag=f,A.ah=Ph,A.ai=nf,A.aj=Hr,A.ak=rs,A.al=xp,A.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,u,p)=>{const g=u||p;return e[o]=!g||g.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},A.an=Xt,A.ao=85.051129,A.ap=xi,A.aq=function(i){return Math.pow(2,i)},A.ar=wt,A.as=Xg,A.at=function(i){return Math.log(i)/Math.LN2},A.au=function(i){var e=i[0],n=i[1];return e*e+n*n},A.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((T=>T.canonical.z)));let n=1/0,o=-1/0,u=1/0,p=-1/0;const g=[];for(const T of i){const{x:C,y:I,z:L}=T.canonical,B=Math.pow(2,e-L),F=C*B,q=I*B;g.push({id:T,x:F,y:q}),F<n&&(n=F),F>o&&(o=F),q<u&&(u=q),q>p&&(p=q)}const x=new Set;for(const T of g)T.x!==n&&T.x!==o&&T.y!==u&&T.y!==p||x.add(T.id);return x},A.aw=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},A.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const o=i.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout((()=>{this.remove(i,u)}),n)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,o=e===void 0?0:this.data[n].indexOf(e),u=this.data[n][o];return this.data[n].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const o of this.data[n])i(o.value)||e.push(o);for(const n of e)this.remove(n.value.tileID,n)}},A.ay=function(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:g}=i,x=u?Xt(jr.interpolationFactor(u,e,p,g),0,1):0;i.kind==="camera"?o=mi.number(i.minSize,i.maxSize,x):n=x}return{uSizeT:n,uSize:o}},A.b=aa,A.b$=is,A.b0=rt,A.b1=function(i){var e=new at(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},A.b2=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},A.b3=function(i,e){var n=e[0],o=e[1],u=e[2],p=n*n+o*o+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i},A.b4=ct,A.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},A.b6=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},A.b7=ot,A.b8=function(i,e,n){const o=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return o===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/o},A.b9=Nt,A.bA=function(i,e,n,o){return i[0]=e[0]+n[0]*o,i[1]=e[1]+n[1]*o,i[2]=e[2]+n[2]*o,i},A.bB=Se,A.bC=function(i,e,n){var o=n[0],u=n[1],p=n[2],g=n[3],x=e[0],T=e[1],C=e[2],I=u*C-p*T,L=p*x-o*C,B=o*T-u*x;return i[0]=x+g*(I+=I)+u*(B+=B)-p*(L+=L),i[1]=T+g*L+p*I-o*B,i[2]=C+g*B+o*L-u*I,i},A.bD=function(i,e,n){const o=(function(T){var C=T[3],I=T[4],L=T[5],B=T[6],F=T[7],q=T[8];return T[0]*(q*I-L*F)+T[1]*(-q*C+L*B)+T[2]*(F*C-I*B)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(o===0)return null;const u=ct([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),p=ct([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),g=ct([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),x=nt([],u,-i[3]);return rt(x,x,nt([],p,-e[3])),rt(x,x,nt([],g,-n[3])),nt(x,x,1/o),x},A.bE=_p,A.bF=function(){return new Float64Array(4)},A.bG=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),p[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),p[2]=u[2],i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bH=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[0],p[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),p[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bI=function(i,e,n,o){var u=[],p=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],p[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),p[1]=u[1],p[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),i[0]=p[0]+n[0],i[1]=p[1]+n[1],i[2]=p[2]+n[2],i},A.bJ=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[0],g=e[1],x=e[2],T=e[3],C=e[8],I=e[9],L=e[10],B=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u-C*o,i[1]=g*u-I*o,i[2]=x*u-L*o,i[3]=T*u-B*o,i[8]=p*o+C*u,i[9]=g*o+I*u,i[10]=x*o+L*u,i[11]=T*o+B*u,i},A.bK=function(i,e){const n=Te(i,360),o=Te(e,360),u=o-n,p=o>n?u-360:u+360;return Math.abs(u)<Math.abs(p)?u:p},A.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},A.bM=function(i,e,n,o){const u=Math.sqrt(i*i+e*e),p=Math.sqrt(n*n+o*o);i/=u,e/=u,n/=p,o/=p;const g=Math.acos(i*n+e*o);return-e*n+i*o>0?g:-g},A.bN=function(i,e){const n=Te(i,2*Math.PI),o=Te(e,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},A.bO=function(){const i={},e=Fe.$version;for(const n in Fe.$root){const o=Fe.$root[n];if(o.required){let u=null;u=n==="version"?e:o.type==="array"?[]:{},u!=null&&(i[n]=u)}}return i},A.bP=Oe,A.bQ=dh,A.bR=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!i(e[o],n[o]))return!1;return!0}return e===n},A.bS=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Mi(i[n],e[i[n].ref]));return i},A.bT=function(i,e){if(i.type==="custom")return new Cm(i,e);switch(i.type){case"background":return new zn(i,e);case"circle":return new Zf(i,e);case"color-relief":return new bg(i,e);case"fill":return new Mg(i,e);case"fill-extrusion":return new pm(i,e);case"heatmap":return new vg(i,e);case"hillshade":return new Ri(i,e);case"line":return new gm(i,e);case"raster":return new Js(i,e);case"symbol":return new mc(i,e)}},A.bU=i=>i.type==="raster",A.bV=Zn,A.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!nn(i.version,e.version))return[{command:"setStyle",args:[e]}];nn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),nn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),nn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),nn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),nn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),nn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),nn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),nn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),nn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),nn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),nn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),nn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),nn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),nn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(g,x,T,C){let I;for(I in x=x||{},g=g||{})Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(x,I)||Bn(I,T,C));for(I in x)Object.prototype.hasOwnProperty.call(x,I)&&(Object.prototype.hasOwnProperty.call(g,I)?nn(g[I],x[I])||(g[I].type==="geojson"&&x[I].type==="geojson"&&Un(g,x,I)?In(T,{command:"setGeoJSONSourceData",args:[I,x[I].data]}):di(I,x,T,C)):Gi(I,x,T))})(i.sources,e.sources,u,o);const p=[];i.layers&&i.layers.forEach((g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):p.push(g)})),n=n.concat(u),(function(g,x,T){x=x||[];const C=(g=g||[]).map(ho),I=x.map(ho),L=g.reduce(lt,{}),B=x.reduce(lt,{}),F=C.slice(),q=Object.create(null);let G,Y,J,he,ee;for(let ie=0,ge=0;ie<C.length;ie++)G=C[ie],Object.prototype.hasOwnProperty.call(B,G)?ge++:(In(T,{command:"removeLayer",args:[G]}),F.splice(F.indexOf(G,ge),1));for(let ie=0,ge=0;ie<I.length;ie++)G=I[I.length-1-ie],F[F.length-1-ie]!==G&&(Object.prototype.hasOwnProperty.call(L,G)?(In(T,{command:"removeLayer",args:[G]}),F.splice(F.lastIndexOf(G,F.length-ge),1)):ge++,he=F[F.length-ie],In(T,{command:"addLayer",args:[B[G],he]}),F.splice(F.length-ie,0,G),q[G]=!0);for(let ie=0;ie<I.length;ie++)if(G=I[ie],Y=L[G],J=B[G],!q[G]&&!nn(Y,J))if(nn(Y.source,J.source)&&nn(Y["source-layer"],J["source-layer"])&&nn(Y.type,J.type)){for(ee in Ai(Y.layout,J.layout,T,G,null,"setLayoutProperty"),Ai(Y.paint,J.paint,T,G,null,"setPaintProperty"),nn(Y.filter,J.filter)||In(T,{command:"setFilter",args:[G,J.filter]}),nn(Y.minzoom,J.minzoom)&&nn(Y.maxzoom,J.maxzoom)||In(T,{command:"setLayerZoomRange",args:[G,J.minzoom,J.maxzoom]}),Y)Object.prototype.hasOwnProperty.call(Y,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ai(Y[ee],J[ee],T,G,ee.slice(6),"setPaintProperty"):nn(Y[ee],J[ee])||In(T,{command:"setLayerProperty",args:[G,ee,J[ee]]}));for(ee in J)Object.prototype.hasOwnProperty.call(J,ee)&&!Object.prototype.hasOwnProperty.call(Y,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ai(Y[ee],J[ee],T,G,ee.slice(6),"setPaintProperty"):nn(Y[ee],J[ee])||In(T,{command:"setLayerProperty",args:[G,ee,J[ee]]}))}else In(T,{command:"removeLayer",args:[G]}),he=F[F.lastIndexOf(G)+1],In(T,{command:"addLayer",args:[J,he]})})(p,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[e]}]}return n},A.bX=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},A.bY=wn,A.bZ=br,A.b_=class extends Wr{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},A.ba=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},A.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},A.bc=Wg,A.bd=kh,A.be=function(i,e,n,o,u){var p=1/Math.tan(e/2);if(i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0){var g=1/(o-u);i[10]=(u+o)*g,i[14]=2*u*o*g}else i[10]=-1,i[14]=-2*o;return i},A.bf=function(i){var e=new at(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},A.bg=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[0],g=e[1],x=e[2],T=e[3],C=e[4],I=e[5],L=e[6],B=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u+C*o,i[1]=g*u+I*o,i[2]=x*u+L*o,i[3]=T*u+B*o,i[4]=C*u-p*o,i[5]=I*u-g*o,i[6]=L*u-x*o,i[7]=B*u-T*o,i},A.bh=function(i,e,n){var o=Math.sin(n),u=Math.cos(n),p=e[4],g=e[5],x=e[6],T=e[7],C=e[8],I=e[9],L=e[10],B=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*u+C*o,i[5]=g*u+I*o,i[6]=x*u+L*o,i[7]=T*u+B*o,i[8]=C*u-p*o,i[9]=I*u-g*o,i[10]=L*u-x*o,i[11]=B*u-T*o,i},A.bi=function(){const i=new Float32Array(16);return wt(i),i},A.bj=function(){const i=new Float64Array(16);return wt(i),i},A.bk=function(){return new Float64Array(16)},A.bl=function(i,e,n){const o=new Float64Array(4);return Se(o,i,e-90,n),o},A.bm=function(i,e,n,o){var u,p,g,x,T,C=e[0],I=e[1],L=e[2],B=e[3],F=n[0],q=n[1],G=n[2],Y=n[3];return(p=C*F+I*q+L*G+B*Y)<0&&(p=-p,F=-F,q=-q,G=-G,Y=-Y),1-p>Ke?(u=Math.acos(p),g=Math.sin(u),x=Math.sin((1-o)*u)/g,T=Math.sin(o*u)/g):(x=1-o,T=o),i[0]=x*C+T*F,i[1]=x*I+T*q,i[2]=x*L+T*G,i[3]=x*B+T*Y,i},A.bn=function(i){const e=new Float64Array(9);(function(p,g){var x=g[0],T=g[1],C=g[2],I=g[3],L=x+x,B=T+T,F=C+C,q=x*L,G=T*L,Y=T*B,J=C*L,he=C*B,ee=C*F,ie=I*L,ge=I*B,be=I*F;p[0]=1-Y-ee,p[3]=G-be,p[6]=J+ge,p[1]=G+be,p[4]=1-q-ee,p[7]=he-ie,p[2]=J-ge,p[5]=he+ie,p[8]=1-q-Y})(e,i);const n=nr(-Math.asin(Xt(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-nr(Math.atan2(e[3],e[4]))):(o=nr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=nr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:n+90,bearing:u}},A.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},A.bp=un,A.bq=yl,A.br=Fa,A.bs=ro,A.bt=Sr,A.bu=Ve,A.bv=bt,A.bw=rr,A.bx=function(i,e,n,o,u){return Ve(o,u,Xt((i-e)/(n-e),0,1))},A.by=Te,A.bz=function(){return new Float64Array(3)},A.c=we,A.c$=function(i,e,n,o,u){return l(this,void 0,void 0,(function*(){if(ke())try{return yield li(i,e,n,o,u)}catch{}return(function(p,g,x,T,C){const I=p.width,L=p.height;xn&&Ar||(xn=new OffscreenCanvas(I,L),Ar=xn.getContext("2d",{willReadFrequently:!0})),xn.width=I,xn.height=L,Ar.drawImage(p,0,0,I,L);const B=Ar.getImageData(g,x,T,C);return Ar.clearRect(0,0,I,L),B.data})(i,e,n,o,u)}))},A.c0=class extends Wr{constructor(i,e){super(i,e),this.current=Kr}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},A.c1=cc,A.c2=class extends Wr{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},A.c3=class extends Wr{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},A.c4=zt,A.c5=function(i,e){var n=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},A.c6=function(i,e,n){var o=e[0],u=e[1],p=e[2];return i[0]=o*n[0]+u*n[3]+p*n[6],i[1]=o*n[1]+u*n[4]+p*n[7],i[2]=o*n[2]+u*n[5]+p*n[8],i},A.c7=function(i,e,n,o,u,p,g){var x=1/(e-n),T=1/(o-u),C=1/(p-g);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*C,i[11]=0,i[12]=(e+n)*x,i[13]=(u+o)*T,i[14]=(g+p)*C,i[15]=1,i},A.c8=class extends Wr{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},A.c9=class extends Wr{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},A.cA=function(i,e){return fe[e]&&"touches"in i},A.cB=function(i){return fe[i]||Z[i]},A.cC=function(i,e,n){var o=e[0],u=e[1];return i[0]=n[0]*o+n[4]*u+n[12],i[1]=n[1]*o+n[5]*u+n[13],i},A.cD=function(i,e){const{x:n,y:o}=Xn.fromLngLat(e);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},A.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},A.cF=class extends fl{},A.cG=y1,A.cI=ye,A.cJ=function(i,e){we.REGISTERED_PROTOCOLS[i]=e},A.cK=function(i){delete we.REGISTERED_PROTOCOLS[i]},A.cL=function(i,e){const n={};for(let u=0;u<i.length;u++){const p=e&&e[i[u].id]||Hs(i[u]);e&&(e[i[u].id]=p);let g=n[p];g||(g=n[p]=[]),g.push(i[u])}const o=[];for(const u in n)o.push(n[u]);return o},A.cM=kt,A.cN=km,A.cO=Qm,A.cP=cp,A.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=xt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Vn(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Vn(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Vn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Vn(C),i.canonical),o["text-size"].possiblyEvaluate(new Vn(I),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:I}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Vn(C),i.canonical),o["icon-size"].possiblyEvaluate(new Vn(I),i.canonical)]}const p=n.get("text-line-height")*or,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),T=n.get("text-size");for(const C of i.bucket.features){const I=n.get("text-font").evaluate(C,{},i.canonical).join(","),L=T.evaluate(C,{},i.canonical),B=u.layoutTextSize.evaluate(C,{},i.canonical),F=u.layoutIconSize.evaluate(C,{},i.canonical),q={horizontal:{},vertical:void 0},G=C.text;let Y,J=[0,0];if(G){const ie=G.toString(),ge=n.get("text-letter-spacing").evaluate(C,{},i.canonical)*or,be=fh(ie)?ge:0,Ue=n.get("text-anchor").evaluate(C,{},i.canonical),st=Pl(e,C,i.canonical);if(!st){const yt=n.get("text-radial-offset").evaluate(C,{},i.canonical);J=yt?Gn(Ue,[yt*or,Mn]):n.get("text-offset").evaluate(C,{},i.canonical).map((tt=>tt*or))}let Qe=g?"center":n.get("text-justify").evaluate(C,{},i.canonical);const mt=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(C,{},i.canonical)*or:1/0,Ct=()=>{i.bucket.allowVerticalPlacement&&zs(ie)&&(q.vertical=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,mt,p,Ue,"left",be,J,A.az.vertical,!0,B,L))};if(!g&&st){const yt=new Set;if(Qe==="auto")for(let $e=0;$e<st.values.length;$e+=2)yt.add(Jm(st.values[$e]));else yt.add(Qe);let tt=!1;for(const $e of yt)if(!q.horizontal[$e])if(tt)q.horizontal[$e]=q.horizontal[0];else{const Ot=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,mt,p,"center",$e,be,J,A.az.horizontal,!1,B,L);Ot&&(q.horizontal[$e]=Ot,tt=Ot.positionedLines.length===1)}Ct()}else{Qe==="auto"&&(Qe=Jm(Ue));const yt=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,mt,p,Ue,Qe,be,J,A.az.horizontal,!1,B,L);yt&&(q.horizontal[Qe]=yt),Ct(),zs(ie)&&g&&x&&(q.vertical=Od(G,i.glyphMap,i.glyphPositions,i.imagePositions,I,mt,p,Ue,Qe,be,J,A.az.vertical,!1,B,L))}}let he=!1;if(C.icon&&C.icon.name){const ie=i.imageMap[C.icon.name];ie&&(Y=Tm(i.imagePositions[C.icon.name],n.get("icon-offset").evaluate(C,{},i.canonical),n.get("icon-anchor").evaluate(C,{},i.canonical)),he=!!ie.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=he:i.bucket.sdfIcons!==he&&Dn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ie.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ee=j0(q.horizontal)||q.vertical;i.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||Y)&&m1(i.bucket,C,q,Y,i.imageMap,u,B,F,J,he,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},A.cR=wu,A.cS=hc,A.cT=Sh,A.cU=function(i){const e=new sp;return(function(n,o){for(const u in n.layers)o.writeMessage(3,Ip,n.layers[u])})(i,e),e.finish()},A.cV=function(i,e,n,o,u,p){let g=s(i,e,n,u,0);return g=s(g,e,o,p,1),g},A.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},A.cX=Cn,A.cY=sp,A.cZ=tf,A.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},A.ca=class extends to{},A.cb=Pg,A.cc=class extends yi{},A.cd=bd,A.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},A.cf=Bo,A.cg=function(i,e,n){var o=e[0],u=e[1],p=e[2],g=n[3]*o+n[7]*u+n[11]*p+n[15];return i[0]=(n[0]*o+n[4]*u+n[8]*p+n[12])/(g=g||1),i[1]=(n[1]*o+n[5]*u+n[9]*p+n[13])/g,i[2]=(n[2]*o+n[6]*u+n[10]*p+n[14])/g,i},A.ch=class extends pl{},A.ci=class extends t{},A.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},A.ck=function(i,e){var n=i[0],o=i[1],u=i[2],p=i[3],g=i[4],x=i[5],T=i[6],C=i[7],I=i[8],L=i[9],B=i[10],F=i[11],q=i[12],G=i[13],Y=i[14],J=i[15],he=e[0],ee=e[1],ie=e[2],ge=e[3],be=e[4],Ue=e[5],st=e[6],Qe=e[7],mt=e[8],Ct=e[9],yt=e[10],tt=e[11],$e=e[12],Ot=e[13],Rt=e[14],Ft=e[15];return Math.abs(n-he)<=Ke*Math.max(1,Math.abs(n),Math.abs(he))&&Math.abs(o-ee)<=Ke*Math.max(1,Math.abs(o),Math.abs(ee))&&Math.abs(u-ie)<=Ke*Math.max(1,Math.abs(u),Math.abs(ie))&&Math.abs(p-ge)<=Ke*Math.max(1,Math.abs(p),Math.abs(ge))&&Math.abs(g-be)<=Ke*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(x-Ue)<=Ke*Math.max(1,Math.abs(x),Math.abs(Ue))&&Math.abs(T-st)<=Ke*Math.max(1,Math.abs(T),Math.abs(st))&&Math.abs(C-Qe)<=Ke*Math.max(1,Math.abs(C),Math.abs(Qe))&&Math.abs(I-mt)<=Ke*Math.max(1,Math.abs(I),Math.abs(mt))&&Math.abs(L-Ct)<=Ke*Math.max(1,Math.abs(L),Math.abs(Ct))&&Math.abs(B-yt)<=Ke*Math.max(1,Math.abs(B),Math.abs(yt))&&Math.abs(F-tt)<=Ke*Math.max(1,Math.abs(F),Math.abs(tt))&&Math.abs(q-$e)<=Ke*Math.max(1,Math.abs(q),Math.abs($e))&&Math.abs(G-Ot)<=Ke*Math.max(1,Math.abs(G),Math.abs(Ot))&&Math.abs(Y-Rt)<=Ke*Math.max(1,Math.abs(Y),Math.abs(Rt))&&Math.abs(J-Ft)<=Ke*Math.max(1,Math.abs(J),Math.abs(Ft))},A.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},A.cm=i=>i.type==="symbol",A.cn=i=>i.type==="circle",A.co=i=>i.type==="heatmap",A.cp=i=>i.type==="line",A.cq=i=>i.type==="fill",A.cr=i=>i.type==="fill-extrusion",A.cs=i=>i.type==="hillshade",A.ct=i=>i.type==="color-relief",A.cu=i=>i.type==="background",A.cv=i=>i.type==="custom",A.cw=Dt,A.cx=function(i,e,n){const o=_t(e.x-n.x,e.y-n.y),u=_t(i.x-n.x,i.y-n.y),p=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(g,x){return g[0]*x[0]+g[1]*x[1]})(o,u));return nr(p)},A.cy=jt,A.cz=function(i,e){return Z[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},A.d=it,A.d0=xh,A.d1=W,A.d2=class{constructor(i,e){this.layers={[nf]:this},this.name=nf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new cy(this.features[i],this.extent)}},A.d3=Jl,A.d4=ka,A.e=mn,A.f=i=>l(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),A.g=Le,A.h=i=>new Promise(((e,n)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=Gr}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):Gr})),A.i=Ni,A.j=(i,e)=>Je(mn(i,{type:"json"}),e),A.k=hn,A.l=$t,A.m=Je,A.n=(i,e)=>Je(mn(i,{type:"arrayBuffer"}),e),A.o=function(i){return new sp(i).readFields(jg,[])},A.p=xm,A.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},A.r=xd,A.s=Sa,A.t=Ui,A.u=Fe,A.v=su,A.w=Dn,A.x=mh,A.y=Wa,A.z=Qs})),z("worker",["./shared"],(function(A){class l{constructor(Z,X){this.keyCache={},Z&&this.replace(Z,X)}replace(Z,X){this._layerConfigs={},this._layers={},this.update(Z,[],X)}update(Z,X,Q){for(const we of Z){this._layerConfigs[we.id]=we;const Le=this._layers[we.id]=A.bT(we,Q);Le._featureFilter=A.aj(Le.filter,Q),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of X)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const de=A.cL(Object.values(this._layerConfigs),this.keyCache);for(const we of de){const Le=we.map((Mt=>this._layers[Mt.id])),Re=Le[0];if(Re.isHidden())continue;const ye=Re.source||"";let Oe=this.familiesBySource[ye];Oe||(Oe=this.familiesBySource[ye]={});const Je=Re.sourceLayer||A.ai;let it=Oe[Je];it||(it=Oe[Je]=[]),it.push(Le)}}}class N{constructor(Z){const X={},Q=[];for(const Re in Z){const ye=Z[Re],Oe=X[Re]={};for(const Je in ye){const it=ye[+Je];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;const Mt={x:0,y:0,w:it.bitmap.width+2,h:it.bitmap.height+2};Q.push(Mt),Oe[Je]={rect:Mt,metrics:it.metrics}}}const{w:de,h:we}=A.p(Q),Le=new A.r({width:de||1,height:we||1});for(const Re in Z){const ye=Z[Re];for(const Oe in ye){const Je=ye[+Oe];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const it=X[Re][Oe].rect;A.r.copy(Je.bitmap,Le,{x:0,y:0},{x:it.x+1,y:it.y+1},Je.bitmap)}}this.image=Le,this.positions=X}}A.cM("GlyphAtlas",N);class W{constructor(Z){this.tileID=new A.a2(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[]}parse(Z,X,Q,de,we){return A._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new A.ag;const Le=new A.cN(Object.keys(Z.layers).sort()),Re=new A.cO(this.tileID,this.promoteId);Re.bucketLayerIDs=[];const ye={},Oe={featureIndex:Re,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:Q,subdivisionGranularity:we},Je=X.familiesBySource[this.source];for(const Un in Je){const Ai=Z.layers[Un];if(!Ai)continue;Ai.version===1&&A.w(`Vector tile source "${this.source}" layer "${Un}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ho=Le.encode(Un),lt=[];for(let Be=0;Be<Ai.length;Be++){const Ut=Ai.feature(Be),ln=Re.getId(Ut,Un);lt.push({feature:Ut,id:ln,index:Be,sourceLayerIndex:ho})}for(const Be of Je[Un]){const Ut=Be[0];Ut.source!==this.source&&A.w(`layer.source = ${Ut.source} does not equal this.source = ${this.source}`),Ut.isHidden(this.zoom,!0)||(ne(Be,this.zoom,Q),(ye[Ut.id]=Ut.createBucket({index:Re.bucketLayerIDs.length,layers:Be,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ho,sourceID:this.source})).populate(lt,Oe,this.tileID.canonical),Re.bucketLayerIDs.push(Be.map((ln=>ln.id))))}}const it=A.bY(Oe.glyphDependencies,(Un=>Object.keys(Un).map(Number)));this.inFlightDependencies.forEach((Un=>Un?.abort())),this.inFlightDependencies=[];let Mt=Promise.resolve({});if(Object.keys(it).length){const Un=new AbortController;this.inFlightDependencies.push(Un),Mt=de.sendAsync({type:"GG",data:{stacks:it,source:this.source,tileID:this.tileID,type:"glyphs"}},Un)}const Pt=Object.keys(Oe.iconDependencies);let $t=Promise.resolve({});if(Pt.length){const Un=new AbortController;this.inFlightDependencies.push(Un),$t=de.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"icons"}},Un)}const hn=Object.keys(Oe.patternDependencies);let dn=Promise.resolve({});if(hn.length){const Un=new AbortController;this.inFlightDependencies.push(Un),dn=de.sendAsync({type:"GI",data:{icons:hn,source:this.source,tileID:this.tileID,type:"patterns"}},Un)}const Fe=Oe.dashDependencies;let Pn=Promise.resolve({});if(Object.keys(Fe).length){const Un=new AbortController;this.inFlightDependencies.push(Un),Pn=de.sendAsync({type:"GDA",data:{dashes:Fe}},Un)}const[Mi,nn,In,Gi]=yield Promise.all([Mt,$t,dn,Pn]),Bn=new N(Mi),di=new A.cP(nn,In);for(const Un in ye){const Ai=ye[Un];Ai instanceof A.ah?(ne(Ai.layers,this.zoom,Q),A.cQ({bucket:Ai,glyphMap:Mi,glyphPositions:Bn.positions,imageMap:nn,imagePositions:di.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Oe.subdivisionGranularity})):Ai.hasDependencies&&(Ai instanceof A.cR||Ai instanceof A.cS||Ai instanceof A.cT)&&(ne(Ai.layers,this.zoom,Q),Ai.addFeatures(Oe,this.tileID.canonical,di.patternPositions,Gi))}return this.status="done",{buckets:Object.values(ye).filter((Un=>!Un.isEmpty())),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bn.image,imageAtlas:di,dashPositions:Gi,glyphMap:this.returnDependencies?Mi:null,iconMap:this.returnDependencies?nn:null,glyphPositions:this.returnDependencies?Bn.positions:null}}))}}function ne(fe,Z,X){const Q=new A.H(Z);for(const de of fe)de.recalculate(Q,X)}class re{constructor(Z,X,Q,de,we){this.type=Z,this.properties=Q||{},this.extent=we,this.pointsArray=X,this.id=de}loadGeometry(){return this.pointsArray.map((Z=>Z.map((X=>new A.P(X.x,X.y)))))}}class xe{constructor(Z,X,Q){this.version=2,this._myFeatures=Z,this.name=X,this.length=Z.length,this.extent=Q}feature(Z){return this._myFeatures[Z]}}class Ae{constructor(){this.layers={}}addLayer(Z){this.layers[Z.name]=Z}}function Ie(fe){let Z=A.cU(fe);return Z.byteOffset===0&&Z.byteLength===Z.buffer.byteLength||(Z=new Uint8Array(Z)),{vectorTile:fe,rawData:Z.buffer}}function pe(fe,Z,X){const{extent:Q}=fe,de=Math.pow(2,X.z-Z.z),we=(X.x-Z.x*de)*Q,Le=(X.y-Z.y*de)*Q,Re=[];for(let ye=0;ye<fe.length;ye++){const Oe=fe.feature(ye);let Je=Oe.loadGeometry();for(const Mt of Je)for(const Pt of Mt)Pt.x=Pt.x*de-we,Pt.y=Pt.y*de-Le;const it=128;Je=A.cV(Je,Oe.type,-it,-it,Q+it,Q+it),Je.length!==0&&Re.push(new re(Oe.type,Je,Oe.properties,Oe.id,Q))}return new xe(Re,fe.name,Q)}class ae{constructor(Z,X,Q){this.actor=Z,this.layerIndex=X,this.availableImages=Q,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new A.cW(1e3)}loadVectorTile(Z,X){return A._(this,void 0,void 0,(function*(){const Q=yield A.n(Z.request,X);try{return{vectorTile:Z.encoding!=="mlt"?new A.cX(new A.cY(Q.data)):new A.cZ(Q.data),rawData:Q.data,cacheControl:Q.cacheControl,expires:Q.expires}}catch(de){const we=new Uint8Array(Q.data);let Le=`Unable to parse the tile at ${Z.request.url}, `;throw Le+=we[0]===31&&we[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.message}`,new Error(Le)}}))}loadTile(Z){return A._(this,void 0,void 0,(function*(){const{uid:X,overzoomParameters:Q}=Z;Q&&(Z.request=Q.overzoomRequest);const de=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new A.c_(Z.request),we=new W(Z);this.loading[X]=we;const Le=new AbortController;we.abort=Le;try{const Re=yield this.loadVectorTile(Z,Le);if(delete this.loading[X],!Re)return null;if(Q){const Mt=this._getOverzoomTile(Z,Re.vectorTile);Re.rawData=Mt.rawData,Re.vectorTile=Mt.vectorTile}const ye=Re.rawData,Oe={};Re.expires&&(Oe.expires=Re.expires),Re.cacheControl&&(Oe.cacheControl=Re.cacheControl);const Je={};if(de){const Mt=de.finish();Mt&&(Je.resourceTiming=JSON.parse(JSON.stringify(Mt)))}we.vectorTile=Re.vectorTile;const it=we.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);this.loaded[X]=we,this.fetching[X]={rawTileData:ye,cacheControl:Oe,resourceTiming:Je};try{const Mt=yield it;return A.e({rawTileData:ye.slice(0),encoding:Z.encoding},Mt,Oe,Je)}finally{delete this.fetching[X]}}catch(Re){throw delete this.loading[X],we.status="done",this.loaded[X]=we,Re}}))}_getOverzoomTile(Z,X){const{tileID:Q,source:de,overzoomParameters:we}=Z,{maxZoomTileID:Le}=we,Re=`${Le.key}_${Q.key}`,ye=this.overzoomedTileResultCache.get(Re);if(ye)return ye;const Oe=new Ae,Je=this.layerIndex.familiesBySource[de];for(const Mt in Je){const Pt=X.layers[Mt];if(!Pt)continue;const $t=pe(Pt,Le,Q.canonical);$t.length>0&&Oe.addLayer($t)}const it=Ie(Oe);return this.overzoomedTileResultCache.set(Re,it),it}reloadTile(Z){return A._(this,void 0,void 0,(function*(){const X=Z.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Q=this.loaded[X];if(Q.showCollisionBoxes=Z.showCollisionBoxes,Q.status==="parsing"){const de=yield Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);let we;if(this.fetching[X]){const{rawTileData:Le,cacheControl:Re,resourceTiming:ye}=this.fetching[X];delete this.fetching[X],we=A.e({rawTileData:Le.slice(0),encoding:Z.encoding},de,Re,ye)}else we=de;return we}if(Q.status==="done"&&Q.vectorTile)return Q.parse(Q.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity)}))}abortTile(Z){return A._(this,void 0,void 0,(function*(){const X=this.loading,Q=Z.uid;X&&X[Q]&&X[Q].abort&&(X[Q].abort.abort(),delete X[Q])}))}removeTile(Z){return A._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]}))}}class ke{constructor(){this.loaded={}}loadTile(Z){return A._(this,void 0,void 0,(function*(){const{uid:X,encoding:Q,rawImageData:de,redFactor:we,greenFactor:Le,blueFactor:Re,baseShift:ye}=Z,Oe=de.width+2,Je=de.height+2,it=A.b(de)?new A.R({width:Oe,height:Je},yield A.c$(de,-1,-1,Oe,Je)):de,Mt=new A.d0(X,it,Q,we,Le,Re,ye);return this.loaded=this.loaded||{},this.loaded[X]=Mt,Mt}))}removeTile(Z){const X=this.loaded,Q=Z.uid;X&&X[Q]&&delete X[Q]}}var Ke,at,zt=(function(){if(at)return Ke;function fe(X,Q){if(X.length!==0){Z(X[0],Q);for(var de=1;de<X.length;de++)Z(X[de],!Q)}}function Z(X,Q){for(var de=0,we=0,Le=0,Re=X.length,ye=Re-1;Le<Re;ye=Le++){var Oe=(X[Le][0]-X[ye][0])*(X[ye][1]+X[Le][1]),Je=de+Oe;we+=Math.abs(de)>=Math.abs(Oe)?de-Je+Oe:Oe-Je+de,de=Je}de+we>=0!=!!Q&&X.reverse()}return at=1,Ke=function X(Q,de){var we,Le=Q&&Q.type;if(Le==="FeatureCollection")for(we=0;we<Q.features.length;we++)X(Q.features[we],de);else if(Le==="GeometryCollection")for(we=0;we<Q.geometries.length;we++)X(Q.geometries[we],de);else if(Le==="Feature")X(Q.geometry,de);else if(Le==="Polygon")fe(Q.coordinates,de);else if(Le==="MultiPolygon")for(we=0;we<Q.coordinates.length;we++)fe(Q.coordinates[we],de);return Q}})(),wt=A.d1(zt);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},ot=Math.fround||(Pe=new Float32Array(1),fe=>(Pe[0]=+fe,Pe[0]));var Pe;class rt{constructor(Z){this.options=Object.assign(Object.create(ut),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:X,minZoom:Q,maxZoom:de}=this.options;X&&console.time("total time");const we=`prepare ${Z.length} points`;X&&console.time(we),this.points=Z;const Le=[];for(let ye=0;ye<Z.length;ye++){const Oe=Z[ye];if(!Oe.geometry)continue;const[Je,it]=Oe.geometry.coordinates,Mt=ot(Tt(Je)),Pt=ot(Nt(it));Le.push(Mt,Pt,1/0,ye,-1,1),this.options.reduce&&Le.push(0)}let Re=this.trees[de+1]=this._createTree(Le);X&&console.timeEnd(we);for(let ye=de;ye>=Q;ye--){const Oe=+Date.now();Re=this.trees[ye]=this._createTree(this._cluster(Re,ye)),X&&console.log("z%d: %d clusters in %dms",ye,Re.numItems,+Date.now()-Oe)}return X&&console.timeEnd("total time"),this}getClusters(Z,X){let Q=((Z[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,Z[1]));let we=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)Q=-180,we=180;else if(Q>we){const it=this.getClusters([Q,de,180,Le],X),Mt=this.getClusters([-180,de,we,Le],X);return it.concat(Mt)}const Re=this.trees[this._limitZoom(X)],ye=Re.range(Tt(Q),Nt(Le),Tt(we),Nt(de)),Oe=Re.data,Je=[];for(const it of ye){const Mt=this.stride*it;Je.push(Oe[Mt+5]>1?nt(Oe,Mt,this.clusterProps):this.points[Oe[Mt+3]])}return Je}getChildren(Z){const X=this._getOriginId(Z),Q=this._getOriginZoom(Z),de="No cluster with the specified id.",we=this.trees[Q];if(!we)throw new Error(de);const Le=we.data;if(X*this.stride>=Le.length)throw new Error(de);const Re=this.options.radius/(this.options.extent*Math.pow(2,Q-1)),ye=we.within(Le[X*this.stride],Le[X*this.stride+1],Re),Oe=[];for(const Je of ye){const it=Je*this.stride;Le[it+4]===Z&&Oe.push(Le[it+5]>1?nt(Le,it,this.clusterProps):this.points[Le[it+3]])}if(Oe.length===0)throw new Error(de);return Oe}getLeaves(Z,X,Q){const de=[];return this._appendLeaves(de,Z,X=X||10,Q=Q||0,0),de}getTile(Z,X,Q){const de=this.trees[this._limitZoom(Z)],we=Math.pow(2,Z),{extent:Le,radius:Re}=this.options,ye=Re/Le,Oe=(Q-ye)/we,Je=(Q+1+ye)/we,it={features:[]};return this._addTileFeatures(de.range((X-ye)/we,Oe,(X+1+ye)/we,Je),de.data,X,Q,we,it),X===0&&this._addTileFeatures(de.range(1-ye/we,Oe,1,Je),de.data,we,Q,we,it),X===we-1&&this._addTileFeatures(de.range(0,Oe,ye/we,Je),de.data,-1,Q,we,it),it.features.length?it:null}getClusterExpansionZoom(Z){let X=this._getOriginZoom(Z)-1;for(;X<=this.options.maxZoom;){const Q=this.getChildren(Z);if(X++,Q.length!==1)break;Z=Q[0].properties.cluster_id}return X}_appendLeaves(Z,X,Q,de,we){const Le=this.getChildren(X);for(const Re of Le){const ye=Re.properties;if(ye&&ye.cluster?we+ye.point_count<=de?we+=ye.point_count:we=this._appendLeaves(Z,ye.cluster_id,Q,de,we):we<de?we++:Z.push(Re),Z.length===Q)break}return we}_createTree(Z){const X=new A.aT(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Q=0;Q<Z.length;Q+=this.stride)X.add(Z[Q],Z[Q+1]);return X.finish(),X.data=Z,X}_addTileFeatures(Z,X,Q,de,we,Le){for(const Re of Z){const ye=Re*this.stride,Oe=X[ye+5]>1;let Je,it,Mt;if(Oe)Je=ct(X,ye,this.clusterProps),it=X[ye],Mt=X[ye+1];else{const hn=this.points[X[ye+3]];Je=hn.properties;const[dn,Fe]=hn.geometry.coordinates;it=Tt(dn),Mt=Nt(Fe)}const Pt={type:1,geometry:[[Math.round(this.options.extent*(it*we-Q)),Math.round(this.options.extent*(Mt*we-de))]],tags:Je};let $t;$t=Oe||this.options.generateId?X[ye+3]:this.points[X[ye+3]].id,$t!==void 0&&(Pt.id=$t),Le.features.push(Pt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,X){const{radius:Q,extent:de,reduce:we,minPoints:Le}=this.options,Re=Q/(de*Math.pow(2,X)),ye=Z.data,Oe=[],Je=this.stride;for(let it=0;it<ye.length;it+=Je){if(ye[it+2]<=X)continue;ye[it+2]=X;const Mt=ye[it],Pt=ye[it+1],$t=Z.within(ye[it],ye[it+1],Re),hn=ye[it+5];let dn=hn;for(const Fe of $t){const Pn=Fe*Je;ye[Pn+2]>X&&(dn+=ye[Pn+5])}if(dn>hn&&dn>=Le){let Fe,Pn=Mt*hn,Mi=Pt*hn,nn=-1;const In=(it/Je<<5)+(X+1)+this.points.length;for(const Gi of $t){const Bn=Gi*Je;if(ye[Bn+2]<=X)continue;ye[Bn+2]=X;const di=ye[Bn+5];Pn+=ye[Bn]*di,Mi+=ye[Bn+1]*di,ye[Bn+4]=In,we&&(Fe||(Fe=this._map(ye,it,!0),nn=this.clusterProps.length,this.clusterProps.push(Fe)),we(Fe,this._map(ye,Bn)))}ye[it+4]=In,Oe.push(Pn/dn,Mi/dn,1/0,In,-1,dn),we&&Oe.push(nn)}else{for(let Fe=0;Fe<Je;Fe++)Oe.push(ye[it+Fe]);if(dn>1)for(const Fe of $t){const Pn=Fe*Je;if(!(ye[Pn+2]<=X)){ye[Pn+2]=X;for(let Mi=0;Mi<Je;Mi++)Oe.push(ye[Pn+Mi])}}}}return Oe}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,X,Q){if(Z[X+5]>1){const Le=this.clusterProps[Z[X+6]];return Q?Object.assign({},Le):Le}const de=this.points[Z[X+3]].properties,we=this.options.map(de);return Q&&we===de?Object.assign({},we):we}}function nt(fe,Z,X){return{type:"Feature",id:fe[Z+3],properties:ct(fe,Z,X),geometry:{type:"Point",coordinates:[(Q=fe[Z],360*(Q-.5)),qt(fe[Z+1])]}};var Q}function ct(fe,Z,X){const Q=fe[Z+5],de=Q>=1e4?`${Math.round(Q/1e3)}k`:Q>=1e3?Math.round(Q/100)/10+"k":Q,we=fe[Z+6],Le=we===-1?{}:Object.assign({},X[we]);return Object.assign(Le,{cluster:!0,cluster_id:fe[Z+3],point_count:Q,point_count_abbreviated:de})}function Tt(fe){return fe/360+.5}function Nt(fe){const Z=Math.sin(fe*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function qt(fe){const Z=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function ht(fe,Z,X,Q){let de=Q;const we=Z+(X-Z>>1);let Le,Re=X-Z;const ye=fe[Z],Oe=fe[Z+1],Je=fe[X],it=fe[X+1];for(let Mt=Z+3;Mt<X;Mt+=3){const Pt=Se(fe[Mt],fe[Mt+1],ye,Oe,Je,it);if(Pt>de)Le=Mt,de=Pt;else if(Pt===de){const $t=Math.abs(Mt-we);$t<Re&&(Le=Mt,Re=$t)}}de>Q&&(Le-Z>3&&ht(fe,Z,Le,Q),fe[Le+2]=de,X-Le>3&&ht(fe,Le,X,Q))}function Se(fe,Z,X,Q,de,we){let Le=de-X,Re=we-Q;if(Le!==0||Re!==0){const ye=((fe-X)*Le+(Z-Q)*Re)/(Le*Le+Re*Re);ye>1?(X=de,Q=we):ye>0&&(X+=Le*ye,Q+=Re*ye)}return Le=fe-X,Re=Z-Q,Le*Le+Re*Re}function Xe(fe,Z,X,Q){const de={id:fe??null,type:Z,geometry:X,tags:Q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")_t(de,X);else if(Z==="Polygon")_t(de,X[0]);else if(Z==="MultiLineString")for(const we of X)_t(de,we);else if(Z==="MultiPolygon")for(const we of X)_t(de,we[0]);return de}function _t(fe,Z){for(let X=0;X<Z.length;X+=3)fe.minX=Math.min(fe.minX,Z[X]),fe.minY=Math.min(fe.minY,Z[X+1]),fe.maxX=Math.max(fe.maxX,Z[X]),fe.maxY=Math.max(fe.maxY,Z[X+1])}function xt(fe,Z,X,Q){if(!Z.geometry)return;const de=Z.geometry.coordinates;if(de&&de.length===0)return;const we=Z.geometry.type,Le=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Re=[],ye=Z.id;if(X.promoteId?ye=Z.properties[X.promoteId]:X.generateId&&(ye=Q||0),we==="Point")Bt(de,Re);else if(we==="MultiPoint")for(const Oe of de)Bt(Oe,Re);else if(we==="LineString")Te(de,Re,Le,!1);else if(we==="MultiLineString"){if(X.lineMetrics){for(const Oe of de)Re=[],Te(Oe,Re,Le,!1),fe.push(Xe(ye,"LineString",Re,Z.properties));return}Ve(de,Re,Le,!1)}else if(we==="Polygon")Ve(de,Re,Le,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const Oe of Z.geometry.geometries)xt(fe,{id:ye,geometry:Oe,properties:Z.properties},X,Q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Oe of de){const Je=[];Ve(Oe,Je,Le,!0),Re.push(Je)}}fe.push(Xe(ye,we,Re,Z.properties))}function Bt(fe,Z){Z.push(bt(fe[0]),Dt(fe[1]),0)}function Te(fe,Z,X,Q){let de,we,Le=0;for(let ye=0;ye<fe.length;ye++){const Oe=bt(fe[ye][0]),Je=Dt(fe[ye][1]);Z.push(Oe,Je,0),ye>0&&(Le+=Q?(de*Je-Oe*we)/2:Math.sqrt(Math.pow(Oe-de,2)+Math.pow(Je-we,2))),de=Oe,we=Je}const Re=Z.length-3;Z[2]=1,ht(Z,0,Re,X),Z[Re+2]=1,Z.size=Math.abs(Le),Z.start=0,Z.end=Z.size}function Ve(fe,Z,X,Q){for(let de=0;de<fe.length;de++){const we=[];Te(fe[de],we,X,Q),Z.push(we)}}function bt(fe){return fe/360+.5}function Dt(fe){const Z=Math.sin(fe*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function jt(fe,Z,X,Q,de,we,Le,Re){if(Q/=Z,we>=(X/=Z)&&Le<Q)return fe;if(Le<X||we>=Q)return null;const ye=[];for(const Oe of fe){const Je=Oe.geometry;let it=Oe.type;const Mt=de===0?Oe.minX:Oe.minY,Pt=de===0?Oe.maxX:Oe.maxY;if(Mt>=X&&Pt<Q){ye.push(Oe);continue}if(Pt<X||Mt>=Q)continue;let $t=[];if(it==="Point"||it==="MultiPoint")Xt(Je,$t,X,Q,de);else if(it==="LineString")Yt(Je,$t,X,Q,de,!1,Re.lineMetrics);else if(it==="MultiLineString")Kt(Je,$t,X,Q,de,!1);else if(it==="Polygon")Kt(Je,$t,X,Q,de,!0);else if(it==="MultiPolygon")for(const hn of Je){const dn=[];Kt(hn,dn,X,Q,de,!0),dn.length&&$t.push(dn)}if($t.length){if(Re.lineMetrics&&it==="LineString"){for(const hn of $t)ye.push(Xe(Oe.id,it,hn,Oe.tags));continue}it!=="LineString"&&it!=="MultiLineString"||($t.length===1?(it="LineString",$t=$t[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=$t.length===3?"Point":"MultiPoint"),ye.push(Xe(Oe.id,it,$t,Oe.tags))}}return ye.length?ye:null}function Xt(fe,Z,X,Q,de){for(let we=0;we<fe.length;we+=3){const Le=fe[we+de];Le>=X&&Le<=Q&&wn(Z,fe[we],fe[we+1],fe[we+2])}}function Yt(fe,Z,X,Q,de,we,Le){let Re=mn(fe);const ye=de===0?br:Zn;let Oe,Je,it=fe.start;for(let dn=0;dn<fe.length-3;dn+=3){const Fe=fe[dn],Pn=fe[dn+1],Mi=fe[dn+2],nn=fe[dn+3],In=fe[dn+4],Gi=de===0?Fe:Pn,Bn=de===0?nn:In;let di=!1;Le&&(Oe=Math.sqrt(Math.pow(Fe-nn,2)+Math.pow(Pn-In,2))),Gi<X?Bn>X&&(Je=ye(Re,Fe,Pn,nn,In,X),Le&&(Re.start=it+Oe*Je)):Gi>Q?Bn<Q&&(Je=ye(Re,Fe,Pn,nn,In,Q),Le&&(Re.start=it+Oe*Je)):wn(Re,Fe,Pn,Mi),Bn<X&&Gi>=X&&(Je=ye(Re,Fe,Pn,nn,In,X),di=!0),Bn>Q&&Gi<=Q&&(Je=ye(Re,Fe,Pn,nn,In,Q),di=!0),!we&&di&&(Le&&(Re.end=it+Oe*Je),Z.push(Re),Re=mn(fe)),Le&&(it+=Oe)}let Mt=fe.length-3;const Pt=fe[Mt],$t=fe[Mt+1],hn=de===0?Pt:$t;hn>=X&&hn<=Q&&wn(Re,Pt,$t,fe[Mt+2]),Mt=Re.length-3,we&&Mt>=3&&(Re[Mt]!==Re[0]||Re[Mt+1]!==Re[1])&&wn(Re,Re[0],Re[1],Re[2]),Re.length&&Z.push(Re)}function mn(fe){const Z=[];return Z.size=fe.size,Z.start=fe.start,Z.end=fe.end,Z}function Kt(fe,Z,X,Q,de,we){for(const Le of fe)Yt(Le,Z,X,Q,de,we,!1)}function wn(fe,Z,X,Q){fe.push(Z,X,Q)}function br(fe,Z,X,Q,de,we){const Le=(we-Z)/(Q-Z);return wn(fe,we,X+(de-X)*Le,1),Le}function Zn(fe,Z,X,Q,de,we){const Le=(we-X)/(de-X);return wn(fe,Z+(Q-Z)*Le,we,1),Le}function lr(fe,Z){const X=[];for(let Q=0;Q<fe.length;Q++){const de=fe[Q],we=de.type;let Le;if(we==="Point"||we==="MultiPoint"||we==="LineString")Le=Dn(de.geometry,Z);else if(we==="MultiLineString"||we==="Polygon"){Le=[];for(const Re of de.geometry)Le.push(Dn(Re,Z))}else if(we==="MultiPolygon"){Le=[];for(const Re of de.geometry){const ye=[];for(const Oe of Re)ye.push(Dn(Oe,Z));Le.push(ye)}}X.push(Xe(de.id,we,Le,de.tags))}return X}function Dn(fe,Z){const X=[];X.size=fe.size,fe.start!==void 0&&(X.start=fe.start,X.end=fe.end);for(let Q=0;Q<fe.length;Q+=3)X.push(fe[Q]+Z,fe[Q+1],fe[Q+2]);return X}function Bi(fe,Z){if(fe.transformed)return fe;const X=1<<fe.z,Q=fe.x,de=fe.y;for(const we of fe.features){const Le=we.geometry,Re=we.type;if(we.geometry=[],Re===1)for(let ye=0;ye<Le.length;ye+=2)we.geometry.push(Ni(Le[ye],Le[ye+1],Z,X,Q,de));else for(let ye=0;ye<Le.length;ye++){const Oe=[];for(let Je=0;Je<Le[ye].length;Je+=2)Oe.push(Ni(Le[ye][Je],Le[ye][Je+1],Z,X,Q,de));we.geometry.push(Oe)}}return fe.transformed=!0,fe}function Ni(fe,Z,X,Q,de,we){return[Math.round(X*(fe*Q-de)),Math.round(X*(Z*Q-we))]}function Kn(fe,Z,X,Q,de){const we=Z===de.maxZoom?0:de.tolerance/((1<<Z)*de.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:fe.length,source:null,x:X,y:Q,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Re of fe)aa(Le,Re,we,de);return Le}function aa(fe,Z,X,Q){const de=Z.geometry,we=Z.type,Le=[];if(fe.minX=Math.min(fe.minX,Z.minX),fe.minY=Math.min(fe.minY,Z.minY),fe.maxX=Math.max(fe.maxX,Z.maxX),fe.maxY=Math.max(fe.maxY,Z.maxY),we==="Point"||we==="MultiPoint")for(let Re=0;Re<de.length;Re+=3)Le.push(de[Re],de[Re+1]),fe.numPoints++,fe.numSimplified++;else if(we==="LineString")Gr(Le,de,fe,X,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Re=0;Re<de.length;Re++)Gr(Le,de[Re],fe,X,we==="Polygon",Re===0);else if(we==="MultiPolygon")for(let Re=0;Re<de.length;Re++){const ye=de[Re];for(let Oe=0;Oe<ye.length;Oe++)Gr(Le,ye[Oe],fe,X,!0,Oe===0)}if(Le.length){let Re=Z.tags||null;if(we==="LineString"&&Q.lineMetrics){Re={};for(const Oe in Z.tags)Re[Oe]=Z.tags[Oe];Re.mapbox_clip_start=de.start/de.size,Re.mapbox_clip_end=de.end/de.size}const ye={geometry:Le,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Re};Z.id!==null&&(ye.id=Z.id),fe.features.push(ye)}}function Gr(fe,Z,X,Q,de,we){const Le=Q*Q;if(Q>0&&Z.size<(de?Le:Q))return void(X.numPoints+=Z.length/3);const Re=[];for(let ye=0;ye<Z.length;ye+=3)(Q===0||Z[ye+2]>Le)&&(X.numSimplified++,Re.push(Z[ye],Z[ye+1])),X.numPoints++;de&&(function(ye,Oe){let Je=0;for(let it=0,Mt=ye.length,Pt=Mt-2;it<Mt;Pt=it,it+=2)Je+=(ye[it]-ye[Pt])*(ye[it+1]+ye[Pt+1]);if(Je>0===Oe)for(let it=0,Mt=ye.length;it<Mt/2;it+=2){const Pt=ye[it],$t=ye[it+1];ye[it]=ye[Mt-2-it],ye[it+1]=ye[Mt-1-it],ye[Mt-2-it]=Pt,ye[Mt-1-it]=$t}})(Re,we),fe.push(Re)}const li={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xn{constructor(Z,X){const Q=(X=this.options=(function(we,Le){for(const Re in Le)we[Re]=Le[Re];return we})(Object.create(li),X)).debug;if(Q&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=(function(we,Le){const Re=[];if(we.type==="FeatureCollection")for(let ye=0;ye<we.features.length;ye++)xt(Re,we.features[ye],Le,ye);else xt(Re,we.type==="Feature"?we:{geometry:we},Le);return Re})(Z,X);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=(function(we,Le){const Re=Le.buffer/Le.extent;let ye=we;const Oe=jt(we,1,-1-Re,Re,0,-1,2,Le),Je=jt(we,1,1-Re,2+Re,0,-1,2,Le);return(Oe||Je)&&(ye=jt(we,1,-Re,1+Re,0,-1,2,Le)||[],Oe&&(ye=lr(Oe,1).concat(ye)),Je&&(ye=ye.concat(lr(Je,-1)))),ye})(de,X),de.length&&this.splitTile(de,0,0,0),Q&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,X,Q,de,we,Le,Re){const ye=[Z,X,Q,de],Oe=this.options,Je=Oe.debug;for(;ye.length;){de=ye.pop(),Q=ye.pop(),X=ye.pop(),Z=ye.pop();const it=1<<X,Mt=Ar(X,Q,de);let Pt=this.tiles[Mt];if(!Pt&&(Je>1&&console.time("creation"),Pt=this.tiles[Mt]=Kn(Z,X,Q,de,Oe),this.tileCoords.push({z:X,x:Q,y:de}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Q,de,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));const di=`z${X}`;this.stats[di]=(this.stats[di]||0)+1,this.total++}if(Pt.source=Z,we==null){if(X===Oe.indexMaxZoom||Pt.numPoints<=Oe.indexMaxPoints)continue}else{if(X===Oe.maxZoom||X===we)continue;if(we!=null){const di=we-X;if(Q!==Le>>di||de!==Re>>di)continue}}if(Pt.source=null,Z.length===0)continue;Je>1&&console.time("clipping");const $t=.5*Oe.buffer/Oe.extent,hn=.5-$t,dn=.5+$t,Fe=1+$t;let Pn=null,Mi=null,nn=null,In=null,Gi=jt(Z,it,Q-$t,Q+dn,0,Pt.minX,Pt.maxX,Oe),Bn=jt(Z,it,Q+hn,Q+Fe,0,Pt.minX,Pt.maxX,Oe);Z=null,Gi&&(Pn=jt(Gi,it,de-$t,de+dn,1,Pt.minY,Pt.maxY,Oe),Mi=jt(Gi,it,de+hn,de+Fe,1,Pt.minY,Pt.maxY,Oe),Gi=null),Bn&&(nn=jt(Bn,it,de-$t,de+dn,1,Pt.minY,Pt.maxY,Oe),In=jt(Bn,it,de+hn,de+Fe,1,Pt.minY,Pt.maxY,Oe),Bn=null),Je>1&&console.timeEnd("clipping"),ye.push(Pn||[],X+1,2*Q,2*de),ye.push(Mi||[],X+1,2*Q,2*de+1),ye.push(nn||[],X+1,2*Q+1,2*de),ye.push(In||[],X+1,2*Q+1,2*de+1)}}getTile(Z,X,Q){Z=+Z,X=+X,Q=+Q;const de=this.options,{extent:we,debug:Le}=de;if(Z<0||Z>24)return null;const Re=1<<Z,ye=Ar(Z,X=X+Re&Re-1,Q);if(this.tiles[ye])return Bi(this.tiles[ye],we);Le>1&&console.log("drilling down to z%d-%d-%d",Z,X,Q);let Oe,Je=Z,it=X,Mt=Q;for(;!Oe&&Je>0;)Je--,it>>=1,Mt>>=1,Oe=this.tiles[Ar(Je,it,Mt)];return Oe&&Oe.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",Je,it,Mt),console.time("drilling down")),this.splitTile(Oe.source,Je,it,Mt,Z,X,Q),Le>1&&console.timeEnd("drilling down"),this.tiles[ye]?Bi(this.tiles[ye],we):null):null}}function Ar(fe,Z,X){return 32*((1<<fe)*X+Z)+fe}class Sa extends ae{constructor(Z,X,Q,de=xi){super(Z,X,Q),this._dataUpdateable=new Map,this._createGeoJSONIndex=de}loadVectorTile(Z,X){return A._(this,void 0,void 0,(function*(){const Q=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);return de?Ie(new A.d2(de.features,{version:2,extent:A.a5})):null}))}loadData(Z){return A._(this,void 0,void 0,(function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const Q=this._startPerformance(Z);this._pendingRequest=new AbortController;try{(!this._pendingData||Z.request||Z.data||Z.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Z,this._pendingRequest));const de=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(de,Z),this.loaded={};const we={};return Z.request&&(we.data=de),this._finishPerformance(Q,Z,we),we}catch(de){if(delete this._pendingRequest,A.Z(de))return{abandoned:!0};throw de}}))}_startPerformance(Z){var X;if(!((X=Z?.request)===null||X===void 0)&&X.collectResourceTiming)return new A.c_(Z.request)}_finishPerformance(Z,X,Q){if(!Z)return;const de=Z.finish();de&&(Q.resourceTiming={},Q.resourceTiming[X.source]=JSON.parse(JSON.stringify(de)))}getData(){return A._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Z){const X=this.loaded;return X&&X[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadAndProcessGeoJSON(Z,X){return A._(this,void 0,void 0,(function*(){let Q;if(Z.request?Q=yield this.loadGeoJSONFromUrl(Z.request,Z.promoteId,X):Z.data?Q=this._loadGeoJSONFromObject(Z.data,Z.promoteId):Z.dataDiff&&(Q=this._loadGeoJSONFromDiff(Z.dataDiff,Z.promoteId,Z.source)),delete this._pendingRequest,typeof Q!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);return wt(Q,!0),Z.filter&&(Q=this._filterGeoJSON(Q,Z.filter)),Q}))}loadGeoJSONFromUrl(Z,X,Q){return A._(this,void 0,void 0,(function*(){const de=yield A.j(Z,Q);return this._dataUpdateable=A.a7(de.data,X),de.data}))}_loadGeoJSONFromObject(Z,X){return this._dataUpdateable=A.a7(Z,X),Z}_loadGeoJSONFromDiff(Z,X,Q){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Q}`);A.a8(this._dataUpdateable,Z,X);const de=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(de)}_filterGeoJSON(Z,X){const Q=A.d3(X,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map((we=>`${we.key}: ${we.message}`)).join(", "));const de=Z.features.filter((we=>Q.value.evaluate({zoom:0},we)));return this._toFeatureCollection(de)}_toFeatureCollection(Z){return{type:"FeatureCollection",features:Z}}removeSource(Z){return A._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}function xi(fe,Z){return Z.cluster?new rt((function({superclusterOptions:X,clusterProperties:Q}){if(!Q||!X)return X;const de={},we={},Le={accumulated:null,zoom:0},Re={properties:null},ye=Object.keys(Q);for(const Oe of ye){const[Je,it]=Q[Oe],Mt=A.d3(it),Pt=A.d3(typeof Je=="string"?[Je,["accumulated"],["get",Oe]]:Je);de[Oe]=Mt.value,we[Oe]=Pt.value}return X.map=Oe=>{Re.properties=Oe;const Je={};for(const it of ye)Je[it]=de[it].evaluate(Le,Re);return Je},X.reduce=(Oe,Je)=>{Re.properties=Je;for(const it of ye)Le.accumulated=Oe[it],Oe[it]=we[it].evaluate(Le,Re)},X})(Z)).load(fe.features):(function(X,Q){return new xn(X,Q)})(fe,Z.geojsonVtOptions)}class nr{constructor(Z){this.self=Z,this.actor=new A.L(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(X,Q)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=Q},this.self.addProtocol=A.cJ,this.self.removeProtocol=A.cK,this.self.registerRTLTextPlugin=X=>{A.d4.setMethods(X)},this.actor.registerMessageHandler("LDT",((X,Q)=>this._getDEMWorkerSource(X,Q.source).loadTile(Q))),this.actor.registerMessageHandler("RDT",((X,Q)=>A._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(X,Q.source).removeTile(Q)})))),this.actor.registerMessageHandler("GCEZ",((X,Q)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,Q.type,Q.source).getClusterExpansionZoom(Q)})))),this.actor.registerMessageHandler("GCC",((X,Q)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,Q.type,Q.source).getClusterChildren(Q)})))),this.actor.registerMessageHandler("GCL",((X,Q)=>A._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,Q.type,Q.source).getClusterLeaves(Q)})))),this.actor.registerMessageHandler("LD",((X,Q)=>this._getWorkerSource(X,Q.type,Q.source).loadData(Q))),this.actor.registerMessageHandler("GD",((X,Q)=>this._getWorkerSource(X,Q.type,Q.source).getData())),this.actor.registerMessageHandler("LT",((X,Q)=>this._getWorkerSource(X,Q.type,Q.source).loadTile(Q))),this.actor.registerMessageHandler("RT",((X,Q)=>this._getWorkerSource(X,Q.type,Q.source).reloadTile(Q))),this.actor.registerMessageHandler("AT",((X,Q)=>this._getWorkerSource(X,Q.type,Q.source).abortTile(Q))),this.actor.registerMessageHandler("RMT",((X,Q)=>this._getWorkerSource(X,Q.type,Q.source).removeTile(Q))),this.actor.registerMessageHandler("RS",((X,Q)=>A._(this,void 0,void 0,(function*(){if(!this.workerSources[X]||!this.workerSources[X][Q.type]||!this.workerSources[X][Q.type][Q.source])return;const de=this.workerSources[X][Q.type][Q.source];delete this.workerSources[X][Q.type][Q.source],de.removeSource!==void 0&&de.removeSource(Q)})))),this.actor.registerMessageHandler("RM",(X=>A._(this,void 0,void 0,(function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],this.globalStates.delete(X)})))),this.actor.registerMessageHandler("SR",((X,Q)=>A._(this,void 0,void 0,(function*(){this.referrer=Q})))),this.actor.registerMessageHandler("SRPS",((X,Q)=>this._syncRTLPluginState(X,Q))),this.actor.registerMessageHandler("IS",((X,Q)=>A._(this,void 0,void 0,(function*(){this.self.importScripts(Q)})))),this.actor.registerMessageHandler("SI",((X,Q)=>this._setImages(X,Q))),this.actor.registerMessageHandler("UL",((X,Q)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex(X).update(Q.layers,Q.removedIds,this._getGlobalState(X))})))),this.actor.registerMessageHandler("UGS",((X,Q)=>A._(this,void 0,void 0,(function*(){const de=this._getGlobalState(X);for(const we in Q)de[we]=Q[we]})))),this.actor.registerMessageHandler("SL",((X,Q)=>A._(this,void 0,void 0,(function*(){this._getLayerIndex(X).replace(Q,this._getGlobalState(X))}))))}_getGlobalState(Z){let X=this.globalStates.get(Z);return X||(X={},this.globalStates.set(Z,X)),X}_setImages(Z,X){return A._(this,void 0,void 0,(function*(){this.availableImages[Z]=X;for(const Q in this.workerSources[Z]){const de=this.workerSources[Z][Q];for(const we in de)de[we].availableImages=X}}))}_syncRTLPluginState(Z,X){return A._(this,void 0,void 0,(function*(){return yield A.d4.syncState(X,this.self.importScripts)}))}_getAvailableImages(Z){let X=this.availableImages[Z];return X||(X=[]),X}_getLayerIndex(Z){let X=this.layerIndexes[Z];return X||(X=this.layerIndexes[Z]=new l),X}_getWorkerSource(Z,X,Q){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][X]||(this.workerSources[Z][X]={}),!this.workerSources[Z][X][Q]){const de={sendAsync:(we,Le)=>(we.targetMapId=Z,this.actor.sendAsync(we,Le))};switch(X){case"vector":this.workerSources[Z][X][Q]=new ae(de,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][X][Q]=new Sa(de,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][X][Q]=new this.externalWorkerSourceTypes[X](de,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][X][Q]}_getDEMWorkerSource(Z,X){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][X]||(this.demWorkerSources[Z][X]=new ke),this.demWorkerSources[Z][X]}}return A.i(self)&&(self.worker=new nr(self)),nr})),z("index",["exports","./shared"],(function(A,l){var N="5.15.0";function W(){var y=new l.A(4);return l.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let ne,re,xe;const Ae={frame(y,t,a){const c=requestAnimationFrame((v=>{f(),t(v)})),{unsubscribe:f}=l.s(y.signal,"abort",(()=>{f(),cancelAnimationFrame(c),a(new l.a(y.signal.reason))}),!1)},frameAsync(y){return new Promise(((t,a)=>{this.frame(y,t,a)}))},getImageData(y,t=0){return this.getImageCanvasContext(y).getImageData(-t,-t,y.width+2*t,y.height+2*t)},getImageCanvasContext(y){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=y.width,t.height=y.height,a.drawImage(y,0,0,y.width,y.height),a},resolveURL:y=>(ne||(ne=document.createElement("a")),ne.href=y,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return xe!==void 0?xe:!!matchMedia&&(re==null&&(re=matchMedia("(prefers-reduced-motion: reduce)")),re.matches)},set prefersReducedMotion(y){xe=y}},Ie=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(y){this._frozenAt=y}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function pe(){return Ie.getCurrentTime()}class ae{static testProp(t){if(!ae.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in ae.docStyle)return t[a];return t[0]}static create(t,a,c){const f=window.document.createElement(t);return a!==void 0&&(f.className=a),c&&c.appendChild(f),f}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){ae.docStyle&&ae.selectProp&&(ae.userSelect=ae.docStyle[ae.selectProp],ae.docStyle[ae.selectProp]="none")}static enableDrag(){ae.docStyle&&ae.selectProp&&(ae.docStyle[ae.selectProp]=ae.userSelect)}static setTransform(t,a){t.style[ae.transformProp]=a}static addEventListener(t,a,c,f={}){t.addEventListener(a,c,"passive"in f?f:f.capture)}static removeEventListener(t,a,c,f={}){t.removeEventListener(a,c,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",ae.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ae.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ae.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,c){const f=a.boundingClientRect;return new l.P((c.clientX-f.left)/a.x-t.clientLeft,(c.clientY-f.top)/a.y-t.clientTop)}static mousePos(t,a){const c=ae.getScale(t);return ae.getPoint(t,c,a)}static touchPos(t,a){const c=[],f=ae.getScale(t);for(let v=0;v<a.length;v++)c.push(ae.getPoint(t,f,a[v]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(const f of c)f.remove();return ae.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const c of a)ae.removeAttributes(c),ae.clean(c)}static removeAttributes(t){for(const{name:a,value:c}of t.attributes)ae.isPossiblyDangerous(a,c)&&t.removeAttribute(a)}}ae.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ae.selectProp=ae.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ae.transformProp=ae.testProp(["transform","WebkitTransform"]);const ke={supported:!1,testSupport:function(y){!zt&&at&&(wt?ut(y):Ke=y)}};let Ke,at,zt=!1,wt=!1;function ut(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,at),y.isContextLost())return;ke.supported=!0}catch{}y.deleteTexture(t),zt=!0}var ot;typeof document<"u"&&(at=document.createElement("img"),at.onload=()=>{Ke&&ut(Ke),Ke=null,wt=!0},at.onerror=()=>{zt=!0,Ke=null},at.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(y){let t,a,c,f;y.resetRequestQueue=()=>{t=[],a=0,c=0,f={}},y.addThrottleControl=D=>{const R=c++;return f[R]=D,R},y.removeThrottleControl=D=>{delete f[D],w()},y.getImage=(D,R,O=!0)=>new Promise(((U,j)=>{ke.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),l.e(D,{type:"image"}),t.push({abortController:R,requestParameters:D,supportImageRefresh:O,state:"queued",onError:H=>{j(H)},onSuccess:H=>{U(H)}}),w()}));const v=D=>l._(this,void 0,void 0,(function*(){D.state="running";const{requestParameters:R,supportImageRefresh:O,onError:U,onSuccess:j,abortController:H}=D,K=O===!1&&!l.i(self)&&!l.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce(((oe,ue)=>oe&&ue==="accept"),!0));a++;const se=K?E(R,H):l.m(R,H);try{const oe=yield se;delete D.abortController,D.state="completed",oe.data instanceof HTMLImageElement||l.b(oe.data)?j(oe):oe.data&&j({data:yield(le=oe.data,typeof createImageBitmap=="function"?l.f(le):l.h(le)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete D.abortController,U(oe)}finally{a--,w()}var le})),w=()=>{const D=(()=>{for(const R of Object.keys(f))if(f[R]())return!0;return!1})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=a;R<D&&t.length>0;R++){const O=t.shift();O.abortController.signal.aborted?R--:v(O)}},E=(D,R)=>new Promise(((O,U)=>{const j=new Image,H=D.url,K=D.credentials;K&&K==="include"?j.crossOrigin="use-credentials":(K&&K==="same-origin"||!l.d(H))&&(j.crossOrigin="anonymous"),R.signal.addEventListener("abort",(()=>{j.src="",U(new l.a(R.signal.reason))})),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,O({data:j})},j.onerror=()=>{j.onerror=j.onload=null,R.signal.aborted||U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=H}))})(ot||(ot={})),ot.resetRequestQueue();class Pe{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function rt(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const a=[];for(const{id:c,url:f}of y){const v=`${c}${f}`;a.indexOf(v)===-1&&(a.push(v),t.push({id:c,url:f}))}}return t}function nt(y,t,a){try{const c=new URL(y);return c.pathname+=`${t}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ct(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class Tt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new l.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new l.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const f of t){if(f[0]<c||f[1]<f[0]||a<f[1])return!1;c=f[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,f=c&&c.width||a.data.width,v=c&&c.height||a.data.height;return!(t[0]<0||f<t[0]||t[1]<0||v<t[1]||t[2]<0||f<t[2]||t[3]<0||v<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const f=this.getImage(t);if(c&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,c)=>{let f=!0;if(!this.isLoaded())for(const v of t)this.images[v]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const c of t){let f=this.getImage(c);f||(this.fire(new l.l("styleimagemissing",{id:c})),f=this.getImage(c)),f?a[c]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},v=new l.I(f,c);this.patterns[t]={bin:f,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:a,h:c}=l.p(t),f=this.atlasImage;f.resize({width:a||1,height:c||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],E=w.x+1,D=w.y+1,R=this.getImage(v).data,O=R.width,U=R.height;l.R.copy(R,f,{x:0,y:0},{x:E,y:D},{width:O,height:U}),l.R.copy(R,f,{x:0,y:U-1},{x:E,y:D-1},{width:O,height:1}),l.R.copy(R,f,{x:0,y:0},{x:E,y:D+U},{width:O,height:1}),l.R.copy(R,f,{x:O-1,y:0},{x:E-1,y:D},{width:1,height:U}),l.R.copy(R,f,{x:0,y:0},{x:E+O,y:D},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||l.w(`Image with ID: "${a}" was not found`),ct(c)&&this.updateImage(a,c)}}cloneImages(){const t={};for(const a in this.images){const c=this.images[a];t[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return t}}const Nt=1e20;function qt(y,t,a,c,f,v,w,E,D){for(let R=t;R<t+c;R++)ht(y,a*v+R,v,f,w,E,D);for(let R=a;R<a+f;R++)ht(y,R*v+t,1,c,w,E,D)}function ht(y,t,a,c,f,v,w){v[0]=0,w[0]=-Nt,w[1]=Nt,f[0]=y[t];for(let E=1,D=0,R=0;E<c;E++){f[E]=y[t+E*a];const O=E*E;do{const U=v[D];R=(f[E]-f[U]+O-U*U)/(E-U)/2}while(R<=w[D]&&--D>-1);D++,v[D]=E,w[D]=R,w[D+1]=Nt}for(let E=0,D=0;E<c;E++){for(;w[D+1]<E;)D++;const R=v[D],O=E-R;y[t+E*a]=f[R]+O*O}}const Se=l.v.layout_symbol["text-font"].default.join(",");class Xe{constructor(t,a,c){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,(function*(){const a=[];for(const v in t)for(const w of t[v])a.push(this._getAndCacheGlyphsPromise(v,w));const c=yield Promise.all(a),f={};for(const{stack:v,id:w,glyph:E}of c)f[v]||(f[v]={}),f[v][w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return f}))}_getAndCacheGlyphsPromise(t,a){return l._(this,void 0,void 0,(function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let f=c.glyphs[a];return f!==void 0?{stack:t,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=c.glyphs[a]=this._drawGlyph(c,t,a),{stack:t,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return l._(this,void 0,void 0,(function*(){const c=this.entries[t],f=Math.floor(a/256);if(c.ranges[f])return{stack:t,id:a,glyph:null};if(!c.requests[f]){const v=Xe.loadGlyphRange(t,f,this.url,this.requestManager);c.requests[f]=v}try{const v=yield c.requests[f];for(const w in v)c.glyphs[+w]=v[+w];return c.ranges[f]=!0,{stack:t,id:a,glyph:v[a]||null}}catch(v){const w=c.glyphs[a]=this._drawGlyph(c,t,a);return this._warnOnMissingGlyphRange(w,f,a,v),{stack:t,id:a,glyph:w}}}))}_warnOnMissingGlyphRange(t,a,c,f){const v=256*a,w=v+255,E=c.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${a}, ${v}-${w}. Rendering codepoint U+${E} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&l.q(t)}_drawGlyph(t,a,c){const f=a===Se&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),v=f?"ideographTinySDF":"tinySDF";t[v]||(t[v]=this._createTinySDF(f?this.localIdeographFontFamily:a));const w=t[v].draw(String.fromCodePoint(c));return{id:c,bitmap:new l.r({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const c=a.map((f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`)).join(",");return new Xe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[f,v]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(t)&&(c=`${v}`);return c}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}Xe.loadGlyphRange=function(y,t,a,c){return l._(this,void 0,void 0,(function*(){const f=256*t,v=f+255,w=c.transformRequest(a.replace("{fontstack}",y).replace("{range}",`${f}-${v}`),"Glyphs"),E=yield l.n(w,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${t}, ${f}-${v}`);const D={};for(const R of l.o(E.data))D[R.id]=R;return D}))},Xe.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:v="normal",fontStyle:w="normal",lang:E=null}={}){this.buffer=t,this.cutoff=c,this.radius=a,this.lang=E;const D=this.size=y+4*t,R=this._createCanvas(D),O=this.ctx=R.getContext("2d",{willReadFrequently:!0});O.font=`${w} ${v} ${y}px ${f}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:v}=this.ctx.measureText(y),w=Math.ceil(a),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-f))),D=Math.min(this.size-this.buffer,w+Math.ceil(c)),R=E+2*this.buffer,O=D+2*this.buffer,U=Math.max(R*O,0),j=new Uint8ClampedArray(U),H={data:j,width:R,height:O,glyphWidth:E,glyphHeight:D,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(E===0||D===0)return H;const{ctx:K,buffer:se,gridInner:le,gridOuter:oe}=this;this.lang&&(K.lang=this.lang),K.clearRect(se,se,E,D),K.fillText(y,se,se+w);const ue=K.getImageData(se,se,E,D);oe.fill(Nt,0,U),le.fill(0,0,U);for(let ve=0;ve<D;ve++)for(let ce=0;ce<E;ce++){const _e=ue.data[4*(ve*E+ce)+3]/255;if(_e===0)continue;const Ee=(ve+se)*R+ce+se;if(_e===1)oe[Ee]=0,le[Ee]=Nt;else{const me=.5-_e;oe[Ee]=me>0?me*me:0,le[Ee]=me<0?me*me:0}}qt(oe,0,0,R,O,R,this.f,this.v,this.z),qt(le,se,se,E,D,R,this.f,this.v,this.z);for(let ve=0;ve<U;ve++){const ce=Math.sqrt(oe[ve])-Math.sqrt(le[ve]);j[ve]=Math.round(255-255*(ce/this.radius+this.cutoff))}return H}};class _t{constructor(){this.specification=l.u.light.position}possiblyEvaluate(t,a){return l.F(t.expression.evaluate(a))}interpolate(t,a,c){return{x:l.G.number(t.x,a.x,c),y:l.G.number(t.y,a.y,c),z:l.G.number(t.z,a.z,c)}}}let xt;class Bt extends l.E{constructor(t){super(),xt=xt||new l.t({anchor:new l.D(l.u.light.anchor),position:new _t,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(xt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(l.y,t,a))for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&l.B(this,t.call(l.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const Te=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class Ve extends l.E{constructor(t){super(),this._transitionable=new l.x(Te,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0))}setSky(t,a={}){if(!this._validate(l.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const f=t[c];c.endsWith(l.z)?this._transitionable.setTransition(c.slice(0,-l.z.length),f):this._transitionable.setValue(c,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c={}){return c?.validate!==!1&&l.B(this,t.call(l.C,l.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class bt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const f=[];let v=t.length%2==1?-t[t.length-1]*c:0,w=t[0]*c,E=!0;f.push({left:v,right:w,isDash:E,zeroLength:t[0]===0});let D=t[0];for(let R=1;R<t.length;R++){E=!E;const O=t[R];v=D*c,D+=O,w=D*c,f.push({left:v,right:w,isDash:E,zeroLength:O===0})}return f}addRoundDash(t,a,c){const f=a/2;for(let v=-c;v<=c;v++){const w=this.width*(this.nextRow+c+v);let E=0,D=t[E];for(let R=0;R<this.width;R++){R/D.right>1&&(D=t[++E]);const O=Math.abs(R-D.left),U=Math.abs(R-D.right),j=Math.min(O,U);let H;const K=v/c*(f+1);if(D.isDash){const se=f-Math.abs(K);H=Math.sqrt(j*j+se*se)}else H=f-Math.sqrt(j*j+K*K);this.data[w+R]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const D=t[E],R=t[E+1];D.zeroLength?t.splice(E,1):R&&R.isDash===D.isDash&&(R.left=D.left,t.splice(E,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const f=this.width*this.nextRow;let v=0,w=t[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++v]);const D=Math.abs(E-w.left),R=Math.abs(E-w.right),O=Math.min(D,R);this.data[f+E]=Math.max(0,Math.min(255,(w.isDash?O:-O)+128))}}addDash(t,a){const c=a?7:0,f=2*c+1;if(this.nextRow+f>this.height)return l.w("LineAtlas out of space"),null;let v=0;for(let E=0;E<t.length;E++)v+=t[E];if(v!==0){const E=this.width/v,D=this.getDashRanges(t,this.width,E);a?this.addRoundDash(D,E,c):this.addRegularDash(D)}const w={y:this.nextRow+c,height:2*c,width:v};return this.nextRow+=f,this.dirty=!0,w}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Dt="maplibre_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<jt.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Dt]}numActive(){return Object.keys(this.active).length}}const Xt=Math.floor(Ae.hardwareConcurrency/2);let Yt,mn;function Kt(){return Yt||(Yt=new jt),Yt}jt.workerCount=l.K(globalThis)?Math.max(Math.min(Xt,3),1):1;class wn{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let f=0;f<c.length;f++){const v=new l.L(c[f],a);v.name=`Worker ${f}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const c=[];for(const f of this.actors)c.push(f.sendAsync({type:t,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const c of this.actors)c.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function br(){return mn||(mn=new wn(Kt(),l.M),mn.registerMessageHandler("GR",((y,t,a)=>l.m(t,a)))),mn}function Zn(y,t){const a=l.N();return l.O(a,a,[1,1,0]),l.Q(a,a,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?l.S(a,a,y.calculatePosMatrix(t.toUnwrapped())):a}function lr(y,t,a,c,f,v,w){var E;const D=(function(j,H,K){if(j)for(const se of j){const le=H[se];if(le&&le.source===K&&le.type==="fill-extrusion")return!0}else for(const se in H){const le=H[se];if(le.source===K&&le.type==="fill-extrusion")return!0}return!1})((E=f?.layers)!==null&&E!==void 0?E:null,t,y.id),R=v.maxPitchScaleFactor(),O=y.tilesIn(c,R,D);O.sort(Dn);const U=[];for(const j of O)U.push({wrappedTileID:j.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(t,a,y.getState(),j.queryGeometry,j.cameraQueryGeometry,j.scale,f,v,R,Zn(v,j.tileID),w?(H,K)=>w(j.tileID,H,K):void 0)});return(function(j,H){for(const K in j)for(const se of j[K])Bi(se,H);return j})((function(j){const H={},K={};for(const se of j){const le=se.queryResults,oe=se.wrappedTileID,ue=K[oe]=K[oe]||{};for(const ve in le){const ce=le[ve],_e=ue[ve]=ue[ve]||{},Ee=H[ve]=H[ve]||[];for(const me of ce)_e[me.featureIndex]||(_e[me.featureIndex]=!0,Ee.push(me))}}return H})(U),y)}function Dn(y,t){const a=y.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function Bi(y,t){const a=y.feature,c=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Ni(y,t,a){return l._(this,void 0,void 0,(function*(){let c=y;if(y.url?c=(yield l.j(t.transformRequest(y.url,"Source"),a)).data:yield Ae.frameAsync(a),!c)return null;const f=l.U(l.e(c,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(f.vectorLayerIds=c.vector_layers.map((v=>v.id))),f}))}class Kn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.V?new l.V(t.lng,t.lat):l.V.convert(t),this}extend(t){const a=this._sw,c=this._ne;let f,v;if(t instanceof l.V)f=t,v=t;else{if(!(t instanceof Kn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Kn.convert(t)):this.extend(l.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.V.convert(t)):this;if(f=t._sw,v=t._ne,!f||!v)return this}return a||c?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),c.lng=Math.max(v.lng,c.lng),c.lat=Math.max(v.lat,c.lat)):(this._sw=new l.V(f.lng,f.lat),this._ne=new l.V(v.lng,v.lat)),this}getCenter(){return new l.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.V(this.getWest(),this.getNorth())}getSouthEast(){return new l.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=l.V.convert(t);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}intersects(t){if(!((t=Kn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=Math.abs(this.getEast()-this.getWest()),c=Math.abs(t.getEast()-t.getWest());if(a>=360||c>=360)return!0;const f=l.W(this.getWest(),-180,180),v=l.W(this.getEast(),-180,180),w=l.W(t.getWest(),-180,180),E=l.W(t.getEast(),-180,180),D=f>=v,R=w>=E;return!(!D||!R)||(D?E>=f||w<=v:R?v>=w||f<=E:w<=v&&E>=f)}static convert(t){return t instanceof Kn?t:t&&new Kn(t)}static fromLngLat(t,a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*t.lat);return new Kn(new l.V(t.lng-f,t.lat-c),new l.V(t.lng+f,t.lat+c))}adjustAntiMeridian(){const t=new l.V(this._sw.lng,this._sw.lat),a=new l.V(this._ne.lng,this._ne.lat);return new Kn(t,t.lng>a.lng?new l.V(a.lng+360,a.lat):a)}}class aa{constructor(t,a,c){this.bounds=Kn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(l.Y(this.bounds.getWest())*a),f=Math.floor(l.X(this.bounds.getNorth())*a),v=Math.ceil(l.Y(this.bounds.getEast())*a),w=Math.ceil(l.X(this.bounds.getSouth())*a);return t.x>=c&&t.x<v&&t.y>=f&&t.y<w}}class Gr extends l.E{constructor(t,a,c,f){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new aa(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,l.Z(t)||this.fire(new l.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};c.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((v,w)=>{t.reloadPromise={resolve:v,reject:w}}))}else t.actor=this.dispatcher.getActor(),f="LT";t.abortController=new AbortController;try{const v=yield t.actor.sendAsync({type:f,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,v)}catch(v){if(delete t.abortController,t.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class li extends l.E{constructor(t,a,c,f){super(),this.id=t,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},a),l.e(this,l.U(a,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ni(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new aa(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield ot.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const f=this.map.painter.context,v=f.gl,w=c.data;t.texture=this.map.painter.getTileTexture(w.width),t.texture?t.texture.update(w,{useMipmap:!0}):(t.texture=new l.T(f,w,v.RGBA,{useMipmap:!0}),t.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class xn extends li{constructor(t,a,c,f){super(t,a,c,f),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const f=yield ot.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){const v=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const w=l.b(v)&&l.$()?v:yield this.readImageNow(v),E={type:this.type,uid:t.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const D=yield t.actor.sendAsync({type:"LDT",data:E});t.dem=D,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}readImageNow(t){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.a0()){const a=t.width+2,c=t.height+2;try{return new l.R({width:a,height:c},yield l.a1(t,-1,-1,a,c))}catch{}}return Ae.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),f=(a.x-1+c)%c,v=a.x===0?t.wrap-1:t.wrap,w=(a.x+1+c)%c,E=a.x+1===c?t.wrap+1:t.wrap,D={};return D[new l.a2(t.overscaledZ,v,a.z,f,a.y).key]={backfilled:!1},D[new l.a2(t.overscaledZ,E,a.z,w,a.y).key]={backfilled:!1},a.y>0&&(D[new l.a2(t.overscaledZ,v,a.z,f,a.y-1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,E,a.z,w,a.y-1).key]={backfilled:!1}),a.y+1<c&&(D[new l.a2(t.overscaledZ,v,a.z,f,a.y+1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},D[new l.a2(t.overscaledZ,E,a.z,w,a.y+1).key]={backfilled:!1}),D}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Ar(y){return y.type==="GeometryCollection"?y.geometries.map((t=>t.coordinates)).flat(1/0):y.coordinates.flat(1/0)}function Sa(y){const t=new Kn;let a;switch(y.type){case"FeatureCollection":a=y.features.map((c=>Ar(c.geometry))).flat(1/0);break;case"Feature":a=Ar(y.geometry);break;default:a=Ar(y)}if(a.length==0)return t;for(let c=0;c<a.length-1;c+=2)t.extend([a[c],a[c+1]]);return t}class xi extends l.E{constructor(t,a,c,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(f),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=l.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:l.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:l.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(l.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const c=this._updateWorkerData();return a?c:this}updateData(t,a){this._pendingWorkerUpdate.diff=l.a6(this._pendingWorkerUpdate.diff,t);const c=this._updateWorkerData();return a?c:this}getData(){return l._(this,void 0,void 0,(function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return Sa(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:c}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,c=l.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(c.request=this.map._requestManager.transformRequest(Ae.resolveURL(t),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=t,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));f.data&&(this._data={geojson:f.data});const v=this._applyDiffToSource(a),w=this._getShouldReloadTileOptions(v);let E=null;f.resourceTiming&&f.resourceTiming[this.id]&&(E=f.resourceTiming[this.id].slice(0));const D={dataType:"source"};this._collectResourceTiming&&E&&E.length>0&&l.e(D,{resourceTiming:E}),this.fire(new l.l("data",Object.assign(Object.assign({},D),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},D),{sourceDataType:"content",shouldReloadTileOptions:w})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const f=l.a7(this._data.geojson,a);if(!f)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f}}if(!this._data.updateable)return;const c=l.a8(this._data.updateable,t,a);return t.removeAll||this._options.cluster?void 0:c}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((a=>Sa(a)))}}shouldReloadTile(t,{affectedBounds:a}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:c,extent:f}=this.workerOptions.geojsonVtOptions,v=(function({x:w,y:E,z:D},R=0){const O=l.a3((w-R)/Math.pow(2,D)),U=l.a4((E+1+R)/Math.pow(2,D)),j=l.a3((w+1+R)/Math.pow(2,D)),H=l.a4((E-R)/Math.pow(2,D));return new Kn([O,U],[j,H])})(t.tileID.canonical,c/f);for(const w of a)if(v.intersects(w))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return l._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(f,this.map.painter,a==="RT")}))}abortTile(t){return l._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return l._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class nr extends l.E{constructor(t,a,c,f){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(t){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield ot.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,l.Z(a)||this.fire(new l.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(l.a9.fromLngLat);var c;return this.tileID=(function(f){const v=l.aa.fromPoints(f),w=v.width(),E=v.height(),D=Math.max(w,E),R=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),O=Math.pow(2,R);return new l.ac(R,Math.floor((v.minX+v.maxX)/2*O),Math.floor((v.minY+v.maxY)/2*O))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new l.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:c,maxX:f,maxY:v}=l.aa.fromPoints(t),w={};for(let E=0;E<=l.ab;E++){const D=Math.pow(2,E),R=Math.floor(a*D),O=Math.floor(c*D),U=Math.floor(f*D),j=Math.floor(v*D);w[E]={minTileX:R,minTileY:O,maxTileX:U,maxTileY:j}}return w}}class fe extends nr{constructor(t,a,c,f){super(t,a,c,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield l.ad(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new l.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new l.k(new l.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Z extends nr{constructor(t,a,c,f){super(t,a,c,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((v=>!Array.isArray(v)||v.length!==2||v.some((w=>typeof w!="number"))))||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new l.k(new l.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new l.T(a,this.canvas,c.RGBA,{premultiply:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const X={},Q=y=>{switch(y){case"geojson":return xi;case"image":return nr;case"raster":return li;case"raster-dem":return xn;case"vector":return Gr;case"video":return fe;case"canvas":return Z}return X[y]},de="RTLPluginLoaded";class we extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=br()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ae.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(de))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Le=null;function Re(){return Le||(Le=new we),Le}var ye,Oe;(function(y){y[y.Base=0]="Base",y[y.Parent=1]="Parent"})(ye||(ye={})),(function(y){y[y.Departing=0]="Departing",y[y.Incoming=1]="Incoming"})(Oe||(Oe={}));class Je{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=l.af(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:c,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=f}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=pe(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(f,v){const w={};if(!v)return w;for(const E of f){const D=E.layerIds.map((R=>v.getLayer(R))).filter(Boolean);if(D.length!==0){E.layers=D,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map((R=>D.filter((O=>O.id===R))[0])));for(const R of D)w[R.id]=E}}return w})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const v=this.buckets[f];if(v instanceof l.ah){if(this.hasSymbolBuckets=!0,!c)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const v=this.buckets[f];if(v instanceof l.ah&&v.hasRTLText){this.hasRTLText=!0,Re().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const v=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(v))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new l.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,f,v,w,E,D,R,O,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:O,transform:D,params:E,queryPadding:this.queryPadding*R,getElevation:U},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),v=a&&a.sourceLayer?a.sourceLayer:"",w=f[l.ai]||f[v];if(!w)return;const E=l.aj(a?.filter,a?.globalState),{z:D,x:R,y:O}=this.tileID.canonical,U={z:D,x:R,y:O};for(let j=0;j<w.length;j++){const H=w.feature(j);if(E.needGeometry){const le=l.ak(H,!0);if(!E.filter(new l.H(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!E.filter(new l.H(this.tileID.overscaledZ),H))continue;const K=c.getId(H,v),se=new l.al(H,D,R,O,K);se.tile=U,t.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=l.am(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const v=this.expirationTime-a;v?this.expirationTime=c+Math.max(v,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const v=this.buckets[f],w=v.layers[0].sourceLayer||l.ai,E=c[w],D=t[w];if(!E||!D||Object.keys(D).length===0)continue;v.update(D,E,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const R=a&&a.style&&a.style.getLayer(f);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pe()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=pe()+t}setDependencies(t,a){const c={};for(const f of a)c[f]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const f=this.dependencies[c];if(f){for(const v of a)if(f[v])return!0}}return!1}}class it{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const f=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},l.e(this.stateChanges[t][f],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==f&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const v in this.state[t][f])c[v]||(this.deletedStates[t][f][v]=null)}else for(const v in c)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][v]===null&&delete this.deletedStates[t][f][v]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const f=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(c in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][c]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),f=l.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const v=this.deletedStates[t][a];if(v===null)return{};for(const w in v)delete f[w]}return f}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const v={};for(const w in this.stateChanges[f])this.state[f][w]||(this.state[f][w]={}),l.e(this.state[f][w],this.stateChanges[f][w]),v[w]=this.state[f][w];c[f]=v}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const v={};if(this.deletedStates[f]===null)for(const w in this.state[f])v[w]={},this.state[f][w]={};else for(const w in this.deletedStates[f]){if(this.deletedStates[f][w]===null)this.state[f][w]={};else for(const E of Object.keys(this.deletedStates[f][w]))delete this.state[f][w][E];v[w]=this.state[f][w]}c[f]=c[f]||{},l.e(c[f],v)}this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0&&t.setFeatureState(c,a)}}const Mt=89.25;function Pt(y,t){const a=l.an(t.lat,-l.ao,l.ao);return new l.P(l.Y(t.lng)*y,l.X(a)*y)}function $t(y,t){return new l.a9(t.x/y,t.y/y).toLngLat()}function hn(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(l.ap(90-y.pitch)),Math.tan(l.ap(Mt-y.pitch)))}function dn(y,t){const a=y.canonical,c=t/l.aq(a.z),f=a.x+Math.pow(2,a.z)*y.wrap,v=l.ar(new Float64Array(16));return l.O(v,v,[f*c,a.y*c,0]),l.Q(v,v,[c/l.a5,c/l.a5,1]),v}function Fe(y,t,a,c,f){const v=l.a9.fromLngLat(y,t),w=f*l.as(1,y.lat),{x:E,y:D,z:R}=Pn(a,c);return new l.a9(v.x+w*-E,v.y+w*-D,v.z+w*-R)}function Pn(y,t){const a=l.ap(y),c=l.ap(t),f=Math.cos(-a),v=Math.sin(a);return{x:v*Math.sin(c),y:-v*Math.cos(c),z:f}}function Mi(y,t,a){const c=t.intersectsFrustum(y);if(!a||c===0)return c;const f=t.intersectsPlane(a);return f===0?0:c===2&&f===2?2:1}function nn(y,t,a){let c=0;const f=(a-t)/10;for(let v=0;v<10;v++)c+=f*Math.pow(Math.cos(t+(v+.5)/10*(a-t)),y);return c}function In(y,t){return function(a,c,f,v,w){const E=2*((y-1)/l.at(Math.cos(l.ap(Mt-w))/Math.cos(l.ap(Mt)))-1),D=Math.acos(f/v),R=2*nn(E-1,0,l.ap(w/2)),O=Math.min(l.ap(Mt),D+l.ap(w/2)),U=nn(E-1,Math.min(O,D-l.ap(w/2)),O),j=Math.atan(c/f),H=Math.hypot(c,f);let K=a;return K+=l.at(v/H/Math.max(.5,Math.cos(l.ap(w/2)))),K+=E*l.at(Math.cos(j))/2,K-=l.at(Math.max(1,U/R/t))/2,K}}const Gi=In(9.314,3);function Bn(y,t){const a=(t.roundZoom?Math.round:Math.floor)(y.zoom+l.at(y.tileSize/t.tileSize));return Math.max(0,a)}function di(y,t){const a=y.getCameraFrustum(),c=y.getClippingPlane(),f=y.screenPointToMercatorCoordinate(y.getCameraPoint()),v=l.a9.fromLngLat(y.center,y.elevation);f.z=v.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const w=y.getCoveringTilesDetailsProvider(),E=w.allowVariableZoom(y,t),D=Bn(y,t),R=t.minzoom||0,O=t.maxzoom!==void 0?t.maxzoom:y.maxZoom,U=Math.min(Math.max(0,D),O),j=Math.pow(2,U),H=[j*f.x,j*f.y,0],K=[j*v.x,j*v.y,0],se=Math.hypot(v.x-f.x,v.y-f.y),le=Math.abs(v.z-f.z),oe=Math.hypot(se,le),ue=_e=>({zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),ve=[],ce=[];if(y.renderWorldCopies&&w.allowWorldCopies())for(let _e=1;_e<=3;_e++)ve.push(ue(-_e)),ve.push(ue(_e));for(ve.push(ue(0));ve.length>0;){const _e=ve.pop(),Ee=_e.x,me=_e.y;let Ce=_e.fullyVisible;const Ze={x:Ee,y:me,z:_e.zoom},je=w.getTileBoundingVolume(Ze,_e.wrap,y.elevation,t);if(!Ce){const Et=Mi(a,je,c);if(Et===0)continue;Ce=Et===2}const qe=w.distanceToTile2d(f.x,f.y,Ze,je);let Ge=D;E&&(Ge=(t.calculateTileZoom||Gi)(y.zoom+l.at(y.tileSize/t.tileSize),qe,le,oe,y.fov)),Ge=(t.roundZoom?Math.round:Math.floor)(Ge),Ge=Math.max(0,Ge);const St=Math.min(Ge,O);if(_e.wrap=w.getWrap(v,Ze,_e.wrap),_e.zoom>=St){if(_e.zoom<R)continue;const Et=U-_e.zoom,pt=H[0]-.5-(Ee<<Et),At=H[1]-.5-(me<<Et),an=t.reparseOverscaled?Math.max(_e.zoom,Ge):_e.zoom;ce.push({tileID:new l.a2(_e.zoom===O?an:_e.zoom,_e.wrap,_e.zoom,Ee,me),distanceSq:l.au([K[0]-.5-Ee,K[1]-.5-me]),tileDistanceToCamera:Math.sqrt(pt*pt+At*At)})}else for(let Et=0;Et<4;Et++)ve.push({zoom:_e.zoom+1,x:(Ee<<1)+Et%2,y:(me<<1)+(Et>>1),wrap:_e.wrap,fullyVisible:Ce})}return ce.sort(((_e,Ee)=>_e.distanceSq-Ee.distanceSq)).map((_e=>_e.tileID))}const Un=l.aa.fromPoints([new l.P(0,0),new l.P(l.a5,l.a5)]);function Ai(y){return y==="raster"||y==="image"||y==="video"}function ho(y,t,a,c,f,v,w){if(!t.hasData())return!1;const{tileID:E,fadingRole:D,fadingDirection:R,fadingParentID:O}=t;if(D===ye.Base&&R===Oe.Incoming&&O)return a[O.key]=O,!0;const U=Math.max(E.overscaledZ-f,v);for(let j=E.overscaledZ-1;j>=U;j--){const H=E.scaledTo(j),K=y.getLoadedTile(H);if(K)return t.setCrossFadeLogic({fadingRole:ye.Base,fadingDirection:Oe.Incoming,fadingParentID:K.tileID,fadeEndTime:c+w}),K.setCrossFadeLogic({fadingRole:ye.Parent,fadingDirection:Oe.Departing,fadeEndTime:c+w}),a[H.key]=H,!0}return!1}function lt(y,t,a,c,f,v){if(!t.hasData())return!1;const w=t.tileID.children(f);let E=Be(y,t,w,a,c,f,v);if(E)return!0;for(const D of w)Be(y,t,D.children(f),a,c,f,v)&&(E=!0);return E}function Be(y,t,a,c,f,v,w){if(a[0].overscaledZ>=v)return!1;let E=!1;for(const D of a){const R=y.getLoadedTile(D);if(!R)continue;const{fadingRole:O,fadingDirection:U,fadingParentID:j}=R;O===ye.Base&&U===Oe.Departing&&j||(R.setCrossFadeLogic({fadingRole:ye.Base,fadingDirection:Oe.Departing,fadingParentID:t.tileID,fadeEndTime:f+w}),t.setCrossFadeLogic({fadingRole:ye.Parent,fadingDirection:Oe.Incoming,fadeEndTime:f+w})),c[D.key]=D,E=!0}return E}function Ut(y,t,a,c){const f=y.tileID;return!!y.selfFading||!y.hasData()&&!!t.has(f)&&(y.setSelfFadeLogic(a+c),!0)}function ln(y,t){var a;y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let c=t.tileID.canonical.x-y.tileID.canonical.x;const f=t.tileID.canonical.y-y.tileID.canonical.y,v=Math.pow(2,y.tileID.canonical.z),w=t.tileID.key;c===0&&f===0||Math.abs(f)>1||(Math.abs(c)>1&&(Math.abs(c+v)===1?c+=v:Math.abs(c-v)===1&&(c-=v)),t.dem&&y.dem&&(y.dem.backfillBorder(t.dem,c,f),!((a=y.neighboringTiles)===null||a===void 0)&&a[w]&&(y.neighboringTiles[w].backfilled=!0)))}class Nn{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),a[f.tileID.key]=f}this._tiles=a}setFeatureState(t,a){for(const c in this._tiles)this._tiles[c].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(l.aw).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var c;return(c=this.getTileById(t))===null||c===void 0?void 0:c.isRenderable(a)}getRenderableIds(t=0,a){const c=[];for(const f of this.getAllIds())this.isIdRenderable(f,a)&&c.push(this.getTileById(f));return a?c.sort(((f,v)=>{const w=f.tileID,E=v.tileID,D=new l.P(w.canonical.x,w.canonical.y)._rotate(-t),R=new l.P(E.canonical.x,E.canonical.y)._rotate(-t);return w.overscaledZ-E.overscaledZ||R.y-D.y||R.x-D.x})).map((f=>f.tileID.key)):c.map((f=>f.tileID)).sort(l.aw).map((f=>f.key))}}class Tn extends l.E{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,v,w,E)=>{const D=new(Q(v.type))(f,v,w,E);if(D.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${D.id}`);return D})(t,a,c,this),this._inViewTiles=new Nn,this._outOfViewCache=new l.ax(0,(f=>this._unloadTile(f))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new it,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Nn}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,c){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,c)}catch(f){t.state="errored",f.status!==404?this._source.fire(new l.k(f,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const c=this.getLoadedTile(t.scaledTo(a));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(c);a&&!this._source.shouldReloadTile(f,a)||(t?this._reloadTile(c,"expired"):f.state!=="errored"&&this._reloadTile(c,"reloading"))}}}_reloadTile(t,a){return l._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(t);c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,t,a))}))}_tileLoaded(t,a,c){t.timeAdded=pe(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(f,v){var w,E;const D=v.getRenderableIds();for(const R of D){if(!f.neighboringTiles||!f.neighboringTiles[R])continue;const O=v.getTileById(R);f.neighboringTiles[R].backfilled||ln(f,O),!((E=(w=O.neighboringTiles)===null||w===void 0?void 0:w[f.tileID.key])===null||E===void 0)&&E.backfilled||ln(O,f)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const c=this._getLoadedDescendents(a),f=new Set;for(const v of a){const w=c[v.key];if(!w?.length){f.add(v);continue}const E=v.overscaledZ+Tn.maxOverzooming,D=w.filter((U=>U.tileID.overscaledZ<=E));if(!D.length){f.add(v);continue}const R=Math.min(...D.map((U=>U.tileID.overscaledZ))),O=D.filter((U=>U.tileID.overscaledZ===R)).map((U=>U.tileID));for(const U of O)t[U.key]=U;this._areDescendentsComplete(O,R,v.overscaledZ)||f.add(v)}return f}_getLoadedDescendents(t){var a;const c={};for(const f of this._inViewTiles.getAllTiles().filter((v=>v.hasData())))for(const v of t)f.tileID.isChildOf(v)&&(c[a=v.key]||(c[a]=[])).push(f);return c}_areDescendentsComplete(t,a,c){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-c)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._outOfViewCache.setMaxSize(v)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((D=>new l.a2(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y))):(c=di(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((D=>this._source.hasTile(D))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const f=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const v=Bn(t,this._source),w=this._updateRetainedTiles(c,v),E=Ai(this._source.type);E&&this._rasterFadeDuration>0&&!a&&(function(D,R,O,U,j,H,K){const se=pe(),le=l.av(R);for(const oe of R){const ue=D.getTileById(oe.key);ue.fadingDirection!==Oe.Departing&&ue.fadeOpacity!==0||ue.resetFadeLogic(),ho(D,ue,O,se,U,j,K)||lt(D,ue,O,se,H,K)||Ut(ue,le,se,K)||ue.resetFadeLogic()}})(this._inViewTiles,c,w,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),E?this._cleanUpRasterTiles(w):this._cleanUpVectorTiles(w)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);t[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const c of t)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);a.push(f);const v=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(v)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var c;const f=new Set;for(const R of t)this._addTile(R).hasData()||f.add(R);const v=t.reduce(((R,O)=>(R[O.key]=O,R)),{}),w=this._retainLoadedChildren(v,f),E={},D=Math.max(a-Tn.maxUnderzooming,this._source.minzoom);for(const R of w){let O=this._inViewTiles.getTileById(R.key),U=O?.wasRequested();for(let j=R.overscaledZ-1;j>=D;--j){const H=R.scaledTo(j);if(E[H.key])break;if(E[H.key]=!0,O=this.getTile(H),!O&&U&&(O=this._addTile(H)),O){const K=O.hasData();if((K||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||U)&&(v[H.key]=H),U=O.wasRequested(),K)break}}}return v}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const c=a;return a||(a=new Je(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),c||this._source.fire(new l.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||c.state=="errored")&&t.some((f=>f.equals(c.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,c){const f=[],v=this.transform;if(!v)return f;const w=v.getCoveringTilesDetailsProvider().allowWorldCopies(),E=c?v.getCameraQueryGeometry(t):t,D=H=>v.screenPointToMercatorCoordinate(H,this.terrain),R=this.transformBbox(t,D,!w),O=this.transformBbox(E,D,!w),U=this.getIds(),j=l.aa.fromPoints(O);for(let H=0;H<U.length;H++){const K=this._inViewTiles.getTileById(U[H]);if(K.holdingForSymbolFade())continue;const se=w?[K.tileID]:[K.tileID.unwrapTo(-1),K.tileID.unwrapTo(0)],le=Math.pow(2,v.zoom-K.tileID.overscaledZ),oe=a*K.queryPadding*l.a5/K.tileSize/le;for(const ue of se){const ve=j.map((ce=>ue.getTilePoint(new l.a9(ce.x,ce.y))));if(ve.expandBy(oe),ve.intersects(Un)){const ce=R.map((Ee=>ue.getTilePoint(Ee))),_e=O.map((Ee=>ue.getTilePoint(Ee)));f.push({tile:K,tileID:w?ue:ue.unwrapTo(0),queryGeometry:ce,cameraQueryGeometry:_e,scale:le})}}}return f}transformBbox(t,a,c){let f=t.map(a);if(c){const v=l.aa.fromPoints(t);v.shrinkBy(.001*Math.min(v.width(),v.height()));const w=v.map(a);l.aa.fromPoints(f).covers(w)||(f=f.map((E=>E.x>.5?new l.a9(E.x-1,E.y,E.z):E)))}return f}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((c=>this._inViewTiles.getTileById(c).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!Ai(this._source.type)||!(function(t,a){if(a<=0)return!1;const c=pe();for(const f of t.getAllTiles())if(f.fadeEndTime>=c)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,c){this._state.updateState(t=t||l.ai,a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||l.ai,a,c)}getFeatureState(t,a){return this._state.getState(t=t||l.ai,a)}setDependencies(t,a,c){const f=this._inViewTiles.getTileById(t);f&&f.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(t,a)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Tn.maxUnderzooming=10,Tn.maxOverzooming=3;class ft{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.an(t,0,1);let a=1,c=this._distances[a];const f=t*this.paddedLength+this.padding;for(;c<f&&a<this._distances.length;)c=this._distances[++a];const v=a-1,w=this._distances[v],E=c-w,D=E>0?(f-w)/E:0;return this.points[v].mult(1-D).add(this.points[a].mult(D))}}function Jt(y,t){let a=!0;return y==="always"||y!=="never"&&t!=="never"||(a=!1),a}class rn{constructor(t,a,c){const f=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let w=0;w<this.xCellCount*this.yCellCount;w++)f.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,f,v){this._forEachCell(a,c,f,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(v)}insertCircle(t,a,c,f){this._forEachCell(a-f,c-f,a+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(f)}_insertBoxCell(t,a,c,f,v,w){this.boxCells[v].push(w)}_insertCircleCell(t,a,c,f,v,w){this.circleCells[v].push(w)}_query(t,a,c,f,v,w,E){if(c<0||t>this.width||f<0||a>this.height)return[];const D=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=f){if(v)return[{key:null,x1:t,y1:a,x2:c,y2:f}];for(let R=0;R<this.boxKeys.length;R++)D.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const O=this.circles[3*R],U=this.circles[3*R+1],j=this.circles[3*R+2];D.push({key:this.circleKeys[R],x1:O-j,y1:U-j,x2:O+j,y2:U+j})}}else this._forEachCell(t,a,c,f,this._queryCell,D,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},E);return D}query(t,a,c,f){return this._query(t,a,c,f,!1,null)}hitTest(t,a,c,f,v,w){return this._query(t,a,c,f,!0,v,w).length>0}hitTestCircle(t,a,c,f,v){const w=t-c,E=t+c,D=a-c,R=a+c;if(E<0||w>this.width||R<0||D>this.height)return!1;const O=[];return this._forEachCell(w,D,E,R,this._queryCellCircle,O,{hitTest:!0,overlapMode:f,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},v),O.length>0}_queryCell(t,a,c,f,v,w,E,D){const{seenUids:R,hitTest:O,overlapMode:U}=E,j=this.boxCells[v];if(j!==null){const K=this.bboxes;for(const se of j)if(!R.box[se]){R.box[se]=!0;const le=4*se,oe=this.boxKeys[se];if(t<=K[le+2]&&a<=K[le+3]&&c>=K[le+0]&&f>=K[le+1]&&(!D||D(oe))&&(!O||!Jt(U,oe.overlapMode))&&(w.push({key:oe,x1:K[le],y1:K[le+1],x2:K[le+2],y2:K[le+3]}),O))return!0}}const H=this.circleCells[v];if(H!==null){const K=this.circles;for(const se of H)if(!R.circle[se]){R.circle[se]=!0;const le=3*se,oe=this.circleKeys[se];if(this._circleAndRectCollide(K[le],K[le+1],K[le+2],t,a,c,f)&&(!D||D(oe))&&(!O||!Jt(U,oe.overlapMode))){const ue=K[le],ve=K[le+1],ce=K[le+2];if(w.push({key:oe,x1:ue-ce,y1:ve-ce,x2:ue+ce,y2:ve+ce}),O)return!0}}}return!1}_queryCellCircle(t,a,c,f,v,w,E,D){const{circle:R,seenUids:O,overlapMode:U}=E,j=this.boxCells[v];if(j!==null){const K=this.bboxes;for(const se of j)if(!O.box[se]){O.box[se]=!0;const le=4*se,oe=this.boxKeys[se];if(this._circleAndRectCollide(R.x,R.y,R.radius,K[le+0],K[le+1],K[le+2],K[le+3])&&(!D||D(oe))&&!Jt(U,oe.overlapMode))return w.push(!0),!0}}const H=this.circleCells[v];if(H!==null){const K=this.circles;for(const se of H)if(!O.circle[se]){O.circle[se]=!0;const le=3*se,oe=this.circleKeys[se];if(this._circlesCollide(K[le],K[le+1],K[le+2],R.x,R.y,R.radius)&&(!D||D(oe))&&!Jt(U,oe.overlapMode))return w.push(!0),!0}}}_forEachCell(t,a,c,f,v,w,E,D){const R=this._convertToXCellCoord(t),O=this._convertToYCellCoord(a),U=this._convertToXCellCoord(c),j=this._convertToYCellCoord(f);for(let H=R;H<=U;H++)for(let K=O;K<=j;K++)if(v.call(this,t,a,c,f,this.xCellCount*K+H,w,E,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,f,v,w){const E=f-t,D=v-a,R=c+w;return R*R>E*E+D*D}_circleAndRectCollide(t,a,c,f,v,w,E){const D=(w-f)/2,R=Math.abs(t-(f+D));if(R>D+c)return!1;const O=(E-v)/2,U=Math.abs(a-(v+O));if(U>O+c)return!1;if(R<=D||U<=O)return!0;const j=R-D,H=U-O;return j*j+H*H<=c*c}}function sa(y,t,a){const c=l.N();if(!y){const{vecSouth:U,vecEast:j}=hs(t),H=W();H[0]=j[0],H[1]=j[1],H[2]=U[0],H[3]=U[1],f=H,(O=(w=(v=H)[0])*(R=v[3])-(D=v[2])*(E=v[1]))&&(f[0]=R*(O=1/O),f[1]=-E*O,f[2]=-D*O,f[3]=w*O),c[0]=H[0],c[1]=H[1],c[4]=H[2],c[5]=H[3]}var f,v,w,E,D,R,O;return l.Q(c,c,[1/a,1/a,1]),c}function Vu(y,t,a,c){if(y){const f=l.N();if(!t){const{vecSouth:v,vecEast:w}=hs(a);f[0]=w[0],f[1]=w[1],f[4]=v[0],f[5]=v[1]}return l.Q(f,f,[c,c,1]),f}return a.pixelsToClipSpaceMatrix}function hs(y){const t=Math.cos(y.rollInRadians),a=Math.sin(y.rollInRadians),c=Math.cos(y.pitchInRadians),f=Math.cos(y.bearingInRadians),v=Math.sin(y.bearingInRadians),w=l.aC();w[0]=-f*c*a-v*t,w[1]=-v*c*a+f*t;const E=l.aD(w);E<1e-9?l.aE(w):l.aF(w,w,1/E);const D=l.aC();D[0]=f*c*t-v*a,D[1]=v*c*t+f*a;const R=l.aD(D);return R<1e-9?l.aE(D):l.aF(D,D,1/R),{vecEast:D,vecSouth:w}}function sn(y,t,a,c){let f;c?(f=[y,t,c(y,t),1],l.aH(f,f,a)):(f=[y,t,0,1],Ea(f,f,a));const v=f[3];return{point:new l.P(f[0]/v,f[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}function Ho(y,t){return .5+y/t*.5}function ds(y,t){return y.x>=-t[0]&&y.x<=t[0]&&y.y>=-t[1]&&y.y<=t[1]}function Us(y,t,a,c,f,v,w,E,D,R,O,U,j){const H=a?y.textSizeData:y.iconSizeData,K=l.ay(H,t.transform.zoom),se=[256/t.width*2+1,256/t.height*2+1],le=a?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;le.clear();const oe=y.lineVertexArray,ue=a?y.text.placedSymbolArray:y.icon.placedSymbolArray,ve=t.transform.width/t.transform.height;let ce=!1;for(let _e=0;_e<ue.length;_e++){const Ee=ue.get(_e);if(Ee.hidden||Ee.writingMode===l.az.vertical&&!ce){ms(Ee.numGlyphs,le);continue}ce=!1;const me=new l.P(Ee.anchorX,Ee.anchorY),Ce={getElevation:j,pitchedLabelPlaneMatrix:c,lineVertexArray:oe,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:me,unwrappedTileID:D,width:R,height:O,translation:U},Ze=Fl(Ee.anchorX,Ee.anchorY,Ce);if(!ds(Ze.point,se)){ms(Ee.numGlyphs,le);continue}const je=Ho(t.transform.cameraToCenterDistance,Ze.signedDistanceFromCamera),qe=l.aA(H,K,Ee),Ge=v?qe*t.transform.getPitchedTextCorrection(Ee.anchorX,Ee.anchorY,D)/je:qe*je,St=Ci({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Ee,fontSize:Ge,flip:!1,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:ve,rotateToLine:E});ce=St.useVertical,(St.notEnoughRoom||ce||St.needsFlipping&&Ci({projectionContext:Ce,pitchedLabelPlaneMatrixInverse:f,symbol:Ee,fontSize:Ge,flip:!0,keepUpright:w,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:le,aspectRatio:ve,rotateToLine:E}).notEnoughRoom)&&ms(Ee.numGlyphs,le)}a?y.text.dynamicLayoutVertexBuffer.updateData(le):y.icon.dynamicLayoutVertexBuffer.updateData(le)}function fs(y,t,a,c,f,v,w,E){const D=v.glyphStartIndex+v.numGlyphs,R=v.lineStartIndex,O=v.lineStartIndex+v.lineLength,U=t.getoffsetX(v.glyphStartIndex),j=t.getoffsetX(D-1),H=$a(y*U,a,c,f,v.segment,R,O,E,w);if(!H)return null;const K=$a(y*j,a,c,f,v.segment,R,O,E,w);return K?E.projectionCache.anyProjectionOccluded?null:{first:H,last:K}:null}function ps(y,t,a,c){return y===l.az.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(y===l.az.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Ci(y){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:f,flip:v,keepUpright:w,glyphOffsetArray:E,dynamicLayoutVertexArray:D,aspectRatio:R,rotateToLine:O}=y,U=f/24,j=c.lineOffsetX*U,H=c.lineOffsetY*U;let K;if(c.numGlyphs>1){const se=c.glyphStartIndex+c.numGlyphs,le=c.lineStartIndex,oe=c.lineStartIndex+c.lineLength,ue=fs(U,E,j,H,v,c,O,t);if(!ue)return{notEnoughRoom:!0};const ve=Vs(ue.first.point.x,ue.first.point.y,t,a),ce=Vs(ue.last.point.x,ue.last.point.y,t,a);if(w&&!v){const _e=ps(c.writingMode,ve,ce,R);if(_e)return _e}K=[ue.first];for(let _e=c.glyphStartIndex+1;_e<se-1;_e++){const Ee=$a(U*E.getoffsetX(_e),j,H,v,c.segment,le,oe,t,O);if(!Ee)return{notEnoughRoom:!0};K.push(Ee)}K.push(ue.last)}else{if(w&&!v){const le=Sn(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,oe=c.lineStartIndex+c.segment+1,ue=new l.P(t.lineVertexArray.getx(oe),t.lineVertexArray.gety(oe)),ve=Sn(ue.x,ue.y,t),ce=ve.signedDistanceFromCamera>0?ve.point:Nl(t.tileAnchorPoint,ue,le,1,t),_e=Vs(le.x,le.y,t,a),Ee=Vs(ce.x,ce.y,t,a),me=ps(c.writingMode,_e,Ee,R);if(me)return me}const se=$a(U*E.getoffsetX(c.glyphStartIndex),j,H,v,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,O);if(!se||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};K=[se]}for(const se of K)l.aG(D,se.point,se.angle);return{}}function Nl(y,t,a,c,f){const v=y.add(y.sub(t)._unit()),w=Sn(v.x,v.y,f).point,E=a.sub(w);return a.add(E._mult(c/E.mag()))}function Cr(y,t,a){const c=t.projectionCache;if(c.projections[y])return c.projections[y];const f=new l.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),v=Sn(f.x,f.y,t);if(v.signedDistanceFromCamera>0)return c.projections[y]=v.point,c.anyProjectionOccluded=c.anyProjectionOccluded||v.isOccluded,v.point;const w=y-a.direction;return Nl(a.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(w),t.lineVertexArray.gety(w)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function Sn(y,t,a){const c=y+a.translation[0],f=t+a.translation[1];let v;return a.pitchWithMap?(v=sn(c,f,a.pitchedLabelPlaneMatrix,a.getElevation),v.isOccluded=!1):(v=a.transform.projectTileCoordinates(c,f,a.unwrappedTileID,a.getElevation),v.point.x=(.5*v.point.x+.5)*a.width,v.point.y=(.5*-v.point.y+.5)*a.height),v}function Vs(y,t,a,c){if(a.pitchWithMap){const f=[y,t,0,1];return l.aH(f,f,c),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:y/a.width*2-1,y:1-t/a.height*2}}function Fl(y,t,a){return a.transform.projectTileCoordinates(y,t,a.unwrappedTileID,a.getElevation)}function jl(y,t,a){return y._unit()._perp()._mult(t*a)}function fo(y,t,a,c,f,v,w,E,D){if(E.projectionCache.offsets[y])return E.projectionCache.offsets[y];const R=a.add(t);if(y+D.direction<c||y+D.direction>=f)return E.projectionCache.offsets[y]=R,R;const O=Cr(y+D.direction,E,D),U=jl(O.sub(a),w,D.direction),j=a.add(U),H=O.add(U);return E.projectionCache.offsets[y]=l.aI(v,R,j,H)||R,E.projectionCache.offsets[y]}function $a(y,t,a,c,f,v,w,E,D){const R=c?y-t:y+t;let O=R>0?1:-1,U=0;c&&(O*=-1,U=Math.PI),O<0&&(U+=Math.PI);let j,H=O>0?v+f:v+f+1;E.projectionCache.cachedAnchorPoint?j=E.projectionCache.cachedAnchorPoint:(j=Sn(E.tileAnchorPoint.x,E.tileAnchorPoint.y,E).point,E.projectionCache.cachedAnchorPoint=j);let K,se,le=j,oe=j,ue=0,ve=0;const ce=Math.abs(R),_e=[];let Ee;for(;ue+ve<=ce;){if(H+=O,H<v||H>=w)return null;ue+=ve,oe=le,se=K;const Ze={absOffsetX:ce,direction:O,distanceFromAnchor:ue,previousVertex:oe};if(le=Cr(H,E,Ze),a===0)_e.push(oe),Ee=le.sub(oe);else{let je;const qe=le.sub(oe);je=qe.mag()===0?jl(Cr(H+O,E,Ze).sub(le),a,O):jl(qe,a,O),se||(se=oe.add(je)),K=fo(H,je,le,v,w,se,a,E,Ze),_e.push(se),Ee=K.sub(se)}ve=Ee.mag()}const me=Ee._mult((ce-ue)/ve)._add(se||oe),Ce=U+Math.atan2(le.y-oe.y,le.x-oe.x);return _e.push(me),{point:me,angle:D?Ce:0,path:_e}}const Rc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ms(y,t){for(let a=0;a<y;a++){const c=t.length;t.resize(c+4),t.float32.set(Rc,3*c)}}function Ea(y,t,a){const c=t[0],f=t[1];return y[0]=a[0]*c+a[4]*f+a[12],y[1]=a[1]*c+a[5]*f+a[13],y[3]=a[3]*c+a[7]*f+a[15],y}const kn=100;class Wh{constructor(t,a=new rn(t.width+200,t.height+200,25),c=new rn(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+kn,this.screenBottomBoundary=t.height+kn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,f,v,w,E,D,R,O,U,j){const H=this.projectAndGetPerspectiveRatio(t.anchorPointX+D[0],t.anchorPointY+D[1],v,O,j),K=c*H.perspectiveRatio;let se;if(w||E)se=this._projectCollisionBox(t,K,f,v,w,E,D,H,O,U,j);else{const Ee=H.x+(U?U.x*K:0),me=H.y+(U?U.y*K:0);se={allPointsOccluded:!1,box:[Ee+t.x1*K,me+t.y1*K,Ee+t.x2*K,me+t.y2*K]}}const[le,oe,ue,ve]=se.box,ce=w?se.allPointsOccluded:H.isOccluded;let _e=ce;return _e||(_e=H.perspectiveRatio<this.perspectiveRatioCutoff),_e||(_e=!this.isInsideGrid(le,oe,ue,ve)),_e||a!=="always"&&this.grid.hitTest(le,oe,ue,ve,a,R)?{box:[le,oe,ue,ve],placeable:!1,offscreen:!1,occluded:ce}:{box:[le,oe,ue,ve],placeable:!0,offscreen:this.isOffscreen(le,oe,ue,ve),occluded:ce}}placeCollisionCircles(t,a,c,f,v,w,E,D,R,O,U,j,H,K){const se=[],le=new l.P(a.anchorX,a.anchorY),oe=this.getPerspectiveRatio(le.x,le.y,w,K),ue=(R?v*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,w)/oe:v*oe)/l.aM,ve={getElevation:K,pitchedLabelPlaneMatrix:E,lineVertexArray:c,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:le,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:H},ce=fs(ue,f,a.lineOffsetX*ue,a.lineOffsetY*ue,!1,a,!1,ve);let _e=!1,Ee=!1,me=!0;if(ce){const Ce=.5*U*oe+j,Ze=new l.P(-100,-100),je=new l.P(this.screenRightBoundary,this.screenBottomBoundary),qe=new ft,Ge=ce.first,St=ce.last;let Et=[];for(let an=Ge.path.length-1;an>=1;an--)Et.push(Ge.path[an]);for(let an=1;an<St.path.length;an++)Et.push(St.path[an]);const pt=2.5*Ce;if(R){const an=this.projectPathToScreenSpace(Et,ve);Et=an.some((jn=>jn.signedDistanceFromCamera<=0))?[]:an.map((jn=>jn.point))}let At=[];if(Et.length>0){const an=Et[0].clone(),jn=Et[0].clone();for(let ri=1;ri<Et.length;ri++)an.x=Math.min(an.x,Et[ri].x),an.y=Math.min(an.y,Et[ri].y),jn.x=Math.max(jn.x,Et[ri].x),jn.y=Math.max(jn.y,Et[ri].y);At=an.x>=Ze.x&&jn.x<=je.x&&an.y>=Ze.y&&jn.y<=je.y?[Et]:jn.x<Ze.x||an.x>je.x||jn.y<Ze.y||an.y>je.y?[]:l.aJ([Et],Ze.x,Ze.y,je.x,je.y)}for(const an of At){qe.reset(an,.25*Ce);let jn=0;jn=qe.length<=.5*Ce?1:Math.ceil(qe.paddedLength/pt)+1;for(let ri=0;ri<jn;ri++){const ei=ri/Math.max(jn-1,1),ui=qe.lerp(ei),$n=ui.x+kn,Ti=ui.y+kn;se.push($n,Ti,Ce,0);const hi=$n-Ce,hr=Ti-Ce,Ii=$n+Ce,ki=Ti+Ce;if(me=me&&this.isOffscreen(hi,hr,Ii,ki),Ee=Ee||this.isInsideGrid(hi,hr,Ii,ki),t!=="always"&&this.grid.hitTestCircle($n,Ti,Ce,t,O)&&(_e=!0,!D))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!D&&_e||!Ee||oe<this.perspectiveRatioCutoff?[]:se,offscreen:me,collisionDetected:_e}}projectPathToScreenSpace(t,a){const c=(function(f,v){const w=l.N();return l.aB(w,v.pitchedLabelPlaneMatrix),f.map((E=>{const D=sn(E.x,E.y,w,v.getElevation),R=v.transform.projectTileCoordinates(D.point.x,D.point.y,v.unwrappedTileID,v.getElevation);return R.point.x=(.5*R.point.x+.5)*v.width,R.point.y=(.5*-R.point.y+.5)*v.height,R}))})(t,a);return(function(f){let v=0,w=0,E=0,D=0;for(let R=0;R<f.length;R++)f[R].isOccluded?(E=R+1,D=0):(D++,D>w&&(w=D,v=E));return f.slice(v,v+w)})(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],c=new l.aa;for(const U of t){const j=new l.P(U.x+kn,U.y+kn);c.extend(j),a.push(j)}const{minX:f,minY:v,maxX:w,maxY:E}=c,D=this.grid.query(f,v,w,E).concat(this.ignoredGrid.query(f,v,w,E)),R={},O={};for(const U of D){const j=U.key;if(R[j.bucketInstanceId]===void 0&&(R[j.bucketInstanceId]={}),R[j.bucketInstanceId][j.featureIndex])continue;const H=[new l.P(U.x1,U.y1),new l.P(U.x2,U.y1),new l.P(U.x2,U.y2),new l.P(U.x1,U.y2)];l.aK(a,H)&&(R[j.bucketInstanceId][j.featureIndex]=!0,O[j.bucketInstanceId]===void 0&&(O[j.bucketInstanceId]=[]),O[j.bucketInstanceId].push(j.featureIndex))}return O}insertCollisionBox(t,a,c,f,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:v,collisionGroupID:w,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,f,v,w){const E=c?this.ignoredGrid:this.grid,D={bucketInstanceId:f,featureIndex:v,collisionGroupID:w,overlapMode:a};for(let R=0;R<t.length;R+=4)E.insertCircle(D,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,a,c,f,v){if(v){let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,v)):(w=[t,a,0,1],Ea(w,w,v));const E=w[3];return{x:(w[0]/E+1)/2*this.transform.width+kn,y:(-w[1]/E+1)/2*this.transform.height+kn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E*.5,isOccluded:!1,signedDistanceFromCamera:E}}{const w=this.transform.projectTileCoordinates(t,a,c,f);return{x:(w.point.x+1)/2*this.transform.width+kn,y:(1-w.point.y)/2*this.transform.height+kn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5,isOccluded:w.isOccluded,signedDistanceFromCamera:w.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,c,f){const v=this.transform.projectTileCoordinates(t,a,c,f);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(t,a,c,f){return c<kn||t>=this.screenRightBoundary||f<kn||a>this.screenBottomBoundary}isInsideGrid(t,a,c,f){return c>=0&&t<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=l.ar([]);return l.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,c,f,v,w,E,D,R,O,U){let j=1,H=0,K=0,se=1;const le=t.anchorPointX+E[0],oe=t.anchorPointY+E[1];if(w&&!v){const Et=this.projectAndGetPerspectiveRatio(le+1,oe,f,R,U),pt=Et.x-D.x,At=Math.atan((Et.y-D.y)/pt)+(pt<0?Math.PI:0),an=Math.sin(At),jn=Math.cos(At);j=jn,H=an,K=-an,se=jn}else if(!w&&v){const Et=hs(this.transform);j=Et.vecEast[0],H=Et.vecEast[1],K=Et.vecSouth[0],se=Et.vecSouth[1]}let ue=D.x,ve=D.y,ce=a;v&&(ue=le,ve=oe,ce=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),ce*=this.transform.getPitchedTextCorrection(le,oe,f),O||(ce*=l.an(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),O&&(ue+=j*O.x*ce+K*O.y*ce,ve+=H*O.x*ce+se*O.y*ce);const _e=t.x1*ce,Ee=t.x2*ce,me=(_e+Ee)/2,Ce=t.y1*ce,Ze=t.y2*ce,je=(Ce+Ze)/2,qe=[{offsetX:_e,offsetY:Ce},{offsetX:me,offsetY:Ce},{offsetX:Ee,offsetY:Ce},{offsetX:Ee,offsetY:je},{offsetX:Ee,offsetY:Ze},{offsetX:me,offsetY:Ze},{offsetX:_e,offsetY:Ze},{offsetX:_e,offsetY:je}];let Ge=[];for(const{offsetX:Et,offsetY:pt}of qe)Ge.push(new l.P(ue+j*Et+K*pt,ve+H*Et+se*pt));let St=!1;if(v){const Et=Ge.map((pt=>this.projectAndGetPerspectiveRatio(pt.x,pt.y,f,R,U)));St=Et.some((pt=>!pt.isOccluded)),Ge=Et.map((pt=>new l.P(pt.x,pt.y)))}else St=!0;return{box:l.aL(Ge),allPointsOccluded:!St}}}class _f{constructor(t,a,c,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class $o{constructor(t,a,c,f,v){this.text=new _f(t?t.text:null,a,c,v),this.icon=new _f(t?t.icon:null,a,f,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kh{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class Lc{constructor(t,a,c,f,v){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=v}}class vf{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function Or(y,t,a,c,f){const{horizontalAlign:v,verticalAlign:w}=l.aS(y);return new l.P(-(v-.5)*t+c[0]*f,-(w-.5)*a+c[1]*f)}class Oc{constructor(t,a,c,f,v){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Wh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new vf(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(c,f)=>a.getElevation(t,c,f):null}getBucketParts(t,a,c,f){const v=c.getBucket(a),w=c.latestFeatureIndex;if(!v||!w||a.id!==v.layerIds[0])return;const E=c.collisionBoxArray,D=v.layers[0].layout,R=v.layers[0].paint,O=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),U=c.tileSize/l.a5,j=c.tileID.toUnwrapped(),H=D.get("text-rotation-alignment")==="map",K=l.aN(c,1,this.transform.zoom),se=l.aO(this.collisionIndex.transform,c,R.get("text-translate"),R.get("text-translate-anchor")),le=l.aO(this.collisionIndex.transform,c,R.get("icon-translate"),R.get("icon-translate-anchor")),oe=sa(H,this.transform,K);this.retainedQueryData[v.bucketInstanceId]=new Lc(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,c.tileID);const ue={bucket:v,layout:D,translationText:se,translationIcon:le,unwrappedTileID:j,pitchedLabelPlaneMatrix:oe,scale:O,textPixelRatio:U,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:l.ay(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(f)for(const ve of v.sortKeyRanges){const{sortKey:ce,symbolInstanceStart:_e,symbolInstanceEnd:Ee}=ve;t.push({sortKey:ce,symbolInstanceStart:_e,symbolInstanceEnd:Ee,parameters:ue})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(t,a,c,f,v,w,E,D,R,O,U,j,H,K,se,le,oe,ue,ve,ce){const _e=l.aP[t.textAnchor],Ee=[t.textOffset0,t.textOffset1],me=Or(_e,c,f,Ee,v),Ce=this.collisionIndex.placeCollisionBox(a,j,D,R,O,E,w,le,U.predicate,ve,me,ce);if((!ue||this.collisionIndex.placeCollisionBox(ue,j,D,R,O,E,w,oe,U.predicate,ve,me,ce).placeable)&&Ce.placeable){let Ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Ze=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Ee,width:c,height:f,anchor:_e,textBoxScale:v,prevAnchor:Ze},this.markUsedJustification(K,_e,H,se),K.allowVerticalPlacement&&(this.markUsedOrientation(K,se,H),this.placedOrientations[H.crossTileID]=se),{shift:me,placedGlyphBoxes:Ce}}}placeLayerBucketPart(t,a,c){const{bucket:f,layout:v,translationText:w,translationIcon:E,unwrappedTileID:D,pitchedLabelPlaneMatrix:R,textPixelRatio:O,holdingForFade:U,collisionBoxArray:j,partiallyEvaluatedTextSize:H,collisionGroup:K}=t.parameters,se=v.get("text-optional"),le=v.get("icon-optional"),oe=l.aQ(v,"text-overlap","text-allow-overlap"),ue=oe==="always",ve=l.aQ(v,"icon-overlap","icon-allow-overlap"),ce=ve==="always",_e=v.get("text-rotation-alignment")==="map",Ee=v.get("text-pitch-alignment")==="map",me=v.get("icon-text-fit")!=="none",Ce=v.get("symbol-z-order")==="viewport-y",Ze=ue&&(ce||!f.hasIconData()||le),je=ce&&(ue||!f.hasTextData()||se);!f.collisionArrays&&j&&f.deserializeCollisionBoxes(j);const qe=this.retainedQueryData[f.bucketInstanceId].tileID,Ge=this._getTerrainElevationFunc(qe),St=this.transform.getFastPathSimpleProjectionMatrix(qe),Et=(pt,At,an)=>{var jn,ri;if(a[pt.crossTileID])return;if(U)return void(this.placements[pt.crossTileID]=new Kh(!1,!1,!1));let ei=!1,ui=!1,$n=!0,Ti=null,hi={box:null,placeable:!1,offscreen:null,occluded:!1},hr={placeable:!1},Ii=null,ki=null,dr=null,Rs=0,Ls=0,ns=0;At.textFeatureIndex?Rs=At.textFeatureIndex:pt.useRuntimeCollisionCircles&&(Rs=pt.featureIndex),At.verticalTextFeatureIndex&&(Ls=At.verticalTextFeatureIndex);const Wr=At.textBox;if(Wr){const Kr=qn=>{let ti=l.az.horizontal;if(f.allowVerticalPlacement&&!qn&&this.prevPlacement){const $i=this.prevPlacement.placedOrientations[pt.crossTileID];$i&&(this.placedOrientations[pt.crossTileID]=$i,ti=$i,this.markUsedOrientation(f,ti,pt))}return ti},ya=(qn,ti)=>{if(f.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&At.verticalTextBox){for(const $i of f.writingModes)if($i===l.az.vertical?(hi=ti(),hr=hi):hi=qn(),hi&&hi.placeable)break}else hi=qn()},Oa=pt.textAnchorOffsetStartIndex,Ba=pt.textAnchorOffsetEndIndex;if(Ba===Oa){const qn=(ti,$i)=>{const Ji=this.collisionIndex.placeCollisionBox(ti,oe,O,qe,D,Ee,_e,w,K.predicate,Ge,void 0,St);return Ji&&Ji.placeable&&(this.markUsedOrientation(f,$i,pt),this.placedOrientations[pt.crossTileID]=$i),Ji};ya((()=>qn(Wr,l.az.horizontal)),(()=>{const ti=At.verticalTextBox;return f.allowVerticalPlacement&&pt.numVerticalGlyphVertices>0&&ti?qn(ti,l.az.vertical):{box:null,offscreen:null}})),Kr(hi&&hi.placeable)}else{let qn=l.aP[(ri=(jn=this.prevPlacement)===null||jn===void 0?void 0:jn.variableOffsets[pt.crossTileID])===null||ri===void 0?void 0:ri.anchor];const ti=(Ji,gh,yh)=>{const ko=Ji.x2-Ji.x1,Bf=Ji.y2-Ji.y1,Ro=pt.textBoxScale,_h=me&&ve==="never"?gh:null;let no=null,io=oe==="never"?1:2,rs="never";qn&&io++;for(let vh=0;vh<io;vh++){for(let _u=Oa;_u<Ba;_u++){const vu=f.textAnchorOffsets.get(_u);if(qn&&vu.textAnchor!==qn)continue;const xu=this.attemptAnchorPlacement(vu,Ji,ko,Bf,Ro,_e,Ee,O,qe,D,K,rs,pt,f,yh,w,E,_h,Ge);if(xu&&(no=xu.placedGlyphBoxes,no&&no.placeable))return ei=!0,Ti=xu.shift,no}qn?qn=null:rs=oe}return c&&!no&&(no={box:this.collisionIndex.placeCollisionBox(Wr,"always",O,qe,D,Ee,_e,w,K.predicate,Ge,void 0,St).box,offscreen:!1,placeable:!1,occluded:!1}),no};ya((()=>ti(Wr,At.iconBox,l.az.horizontal)),(()=>{const Ji=At.verticalTextBox;return f.allowVerticalPlacement&&(!hi||!hi.placeable)&&pt.numVerticalGlyphVertices>0&&Ji?ti(Ji,At.verticalIconBox,l.az.vertical):{box:null,occluded:!0,offscreen:null}})),hi&&(ei=hi.placeable,$n=hi.offscreen);const $i=Kr(hi&&hi.placeable);if(!ei&&this.prevPlacement){const Ji=this.prevPlacement.variableOffsets[pt.crossTileID];Ji&&(this.variableOffsets[pt.crossTileID]=Ji,this.markUsedJustification(f,Ji.anchor,pt,$i))}}}if(Ii=hi,ei=Ii&&Ii.placeable,$n=Ii&&Ii.offscreen,pt.useRuntimeCollisionCircles&&pt.centerJustifiedTextSymbolIndex>=0){const Kr=f.text.placedSymbolArray.get(pt.centerJustifiedTextSymbolIndex),ya=l.aA(f.textSizeData,H,Kr),Oa=v.get("text-padding");ki=this.collisionIndex.placeCollisionCircles(oe,Kr,f.lineVertexArray,f.glyphOffsetArray,ya,D,R,c,Ee,K.predicate,pt.collisionCircleDiameter,Oa,w,Ge),ki.circles.length&&ki.collisionDetected&&!c&&l.w("Collisions detected, but collision boxes are not shown"),ei=ue||ki.circles.length>0&&!ki.collisionDetected,$n=$n&&ki.offscreen}if(At.iconFeatureIndex&&(ns=At.iconFeatureIndex),At.iconBox){const Kr=ya=>this.collisionIndex.placeCollisionBox(ya,ve,O,qe,D,Ee,_e,E,K.predicate,Ge,me&&Ti?Ti:void 0,St);hr&&hr.placeable&&At.verticalIconBox?(dr=Kr(At.verticalIconBox),ui=dr.placeable):(dr=Kr(At.iconBox),ui=dr.placeable),$n=$n&&dr.offscreen}const yl=se||pt.numHorizontalGlyphVertices===0&&pt.numVerticalGlyphVertices===0,cc=le||pt.numIconVertices===0;yl||cc?cc?yl||(ui=ui&&ei):ei=ui&&ei:ui=ei=ui&&ei;const is=ui&&dr.placeable;if(ei&&Ii.placeable&&this.collisionIndex.insertCollisionBox(Ii.box,oe,v.get("text-ignore-placement"),f.bucketInstanceId,hr&&hr.placeable&&Ls?Ls:Rs,K.ID),is&&this.collisionIndex.insertCollisionBox(dr.box,ve,v.get("icon-ignore-placement"),f.bucketInstanceId,ns,K.ID),ki&&ei&&this.collisionIndex.insertCollisionCircles(ki.circles,oe,v.get("text-ignore-placement"),f.bucketInstanceId,Rs,K.ID),c&&this.storeCollisionData(f.bucketInstanceId,an,At,Ii,dr,ki),pt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[pt.crossTileID]=new Kh((ei||Ze)&&!Ii?.occluded,(ui||je)&&!dr?.occluded,$n||f.justReloaded),a[pt.crossTileID]=!0};if(Ce){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const pt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let At=pt.length-1;At>=0;--At){const an=pt[At];Et(f.symbolInstances.get(an),f.collisionArrays[an],an)}}else for(let pt=t.symbolInstanceStart;pt<t.symbolInstanceEnd;pt++)Et(f.symbolInstances.get(pt),f.collisionArrays[pt],pt);f.justReloaded=!1}storeCollisionData(t,a,c,f,v,w){if(c.textBox||c.iconBox){let E,D;this.collisionBoxArrays.has(t)?E=this.collisionBoxArrays.get(t):(E=new Map,this.collisionBoxArrays.set(t,E)),E.has(a)?D=E.get(a):(D={text:null,icon:null},E.set(a,D)),c.textBox&&(D.text=f.box),c.iconBox&&(D.icon=v.box)}if(w){let E=this.collisionCircleArrays[t];E===void 0&&(E=this.collisionCircleArrays[t]=[]);for(let D=0;D<w.circles.length;D+=4)E.push(w.circles[D+0]-kn),E.push(w.circles[D+1]-kn),E.push(w.circles[D+2]),E.push(w.collisionDetected?1:0)}}markUsedJustification(t,a,c,f){let v;v=f===l.az.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.aR(a)];const w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const E of w)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=v>=0&&E!==v?0:c.crossTileID)}markUsedOrientation(t,a,c){const f=a===l.az.horizontal||a===l.az.horizontalOnly?a:0,v=a===l.az.vertical?a:0,w=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const E of w)t.text.placedSymbolArray.get(E).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(t):1,v=a?a.opacities:{},w=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const D in this.placements){const R=this.placements[D],O=v[D];O?(this.opacities[D]=new $o(O,f,R.text,R.icon),c=c||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[D]=new $o(null,f,R.text,R.icon,R.skipFade),c=c||R.text||R.icon)}for(const D in v){const R=v[D];if(!this.opacities[D]){const O=new $o(R,f,!1,!1);O.isHidden()||(this.opacities[D]=O,c=c||R.text.placed||R.icon.placed)}}for(const D in w)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=w[D]);for(const D in E)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=E[D]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const f of a){const v=f.getBucket(t);v&&f.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,f.tileID,c,f.collisionBoxArray)}}updateBucketOpacities(t,a,c,f){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const v=t.layers[0],w=v.layout,E=new $o(null,0,!1,!1,!0),D=w.get("text-allow-overlap"),R=w.get("icon-allow-overlap"),O=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=w.get("text-rotation-alignment")==="map",j=w.get("text-pitch-alignment")==="map",H=w.get("icon-text-fit")!=="none",K=new $o(null,0,D&&(R||!t.hasIconData()||w.get("icon-optional")),R&&(D||!t.hasTextData()||w.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const se=(oe,ue,ve)=>{for(let ce=0;ce<ue/4;ce++)oe.opacityVertexArray.emplaceBack(ve);oe.hasVisibleVertices=oe.hasVisibleVertices||ve!==Yo},le=this.collisionBoxArrays.get(t.bucketInstanceId);for(let oe=0;oe<t.symbolInstances.length;oe++){const ue=t.symbolInstances.get(oe),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:ce,crossTileID:_e}=ue;let Ee=this.opacities[_e];c[_e]?Ee=E:Ee||(Ee=K,this.opacities[_e]=Ee),c[_e]=!0;const me=ue.numIconVertices>0,Ce=this.placedOrientations[ue.crossTileID],Ze=Ce===l.az.vertical,je=Ce===l.az.horizontal||Ce===l.az.horizontalOnly;if(ve>0||ce>0){const Ge=Gu(Ee.text);se(t.text,ve,Ze?Yo:Ge),se(t.text,ce,je?Yo:Ge);const St=Ee.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach((At=>{At>=0&&(t.text.placedSymbolArray.get(At).hidden=St||Ze?1:0)})),ue.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=St||je?1:0);const Et=this.variableOffsets[ue.crossTileID];Et&&this.markUsedJustification(t,Et.anchor,ue,Ce);const pt=this.placedOrientations[ue.crossTileID];pt&&(this.markUsedJustification(t,"left",ue,pt),this.markUsedOrientation(t,pt,ue))}if(me){const Ge=Gu(Ee.icon),St=!(H&&ue.verticalPlacedIconSymbolIndex&&Ze);ue.placedIconSymbolIndex>=0&&(se(t.icon,ue.numIconVertices,St?Ge:Yo),t.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Ee.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(se(t.icon,ue.numVerticalIconVertices,St?Yo:Ge),t.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Ee.icon.isHidden())}const qe=le&&le.has(oe)?le.get(oe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ge=t.collisionArrays[oe];if(Ge){let St=new l.P(0,0);if(Ge.textBox||Ge.verticalTextBox){let Et=!0;if(O){const pt=this.variableOffsets[_e];pt?(St=Or(pt.anchor,pt.width,pt.height,pt.textOffset,pt.textBoxScale),U&&St._rotate(j?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Et=!1}if(Ge.textBox||Ge.verticalTextBox){let pt;Ge.textBox&&(pt=Ze),Ge.verticalTextBox&&(pt=je),qu(t.textCollisionBox.collisionVertexArray,Ee.text.placed,!Et||pt,qe.text,St.x,St.y)}}if(Ge.iconBox||Ge.verticalIconBox){const Et=!!(!je&&Ge.verticalIconBox);let pt;Ge.iconBox&&(pt=Et),Ge.verticalIconBox&&(pt=!Et),qu(t.iconCollisionBox.collisionVertexArray,Ee.icon.placed,pt,qe.icon,H?St.x:0,H?St.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function qu(y,t,a,c,f,v){c&&c.length!==0||(c=[0,0,0,0]);const w=c[0]-kn,E=c[1]-kn,D=c[2]-kn,R=c[3]-kn;y.emplaceBack(t?1:0,a?1:0,f||0,v||0,w,E),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,D,E),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,D,R),y.emplaceBack(t?1:0,a?1:0,f||0,v||0,w,R)}const Bc=Math.pow(2,25),po=Math.pow(2,24),xf=Math.pow(2,17),Ul=Math.pow(2,16),qs=Math.pow(2,9),bf=Math.pow(2,8),Xo=Math.pow(2,1);function Gu(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,a=Math.floor(127*y.opacity);return a*Bc+t*po+a*xf+t*Ul+a*qs+t*bf+a*Xo+t}const Yo=0;class mo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,f,v){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((E,D)=>E.sortKey-D.sortKey)));this._currentPartIndex<w.length;)if(a.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,v())return!0;return!1}}class Vl{constructor(t,a,c,f,v,w,E,D){this.placement=new Oc(t,a,w,E,D),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const f=pe(),v=()=>!this._forceFullPlacement&&pe()-f>2;for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new mo(w)),this._inProgressLayer.continuePlacement(c[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const un=512/l.a5/2;class Xa{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let v=0;v<a.length;v++){const w=a.get(v),E=w.key,D=f.get(E);D?D.push(w):f.set(E,[w])}for(const[v,w]of f){const E={positions:w.map((D=>({x:Math.floor(D.anchorX*un),y:Math.floor(D.anchorY*un)}))),crossTileIDs:w.map((D=>D.crossTileID))};if(E.positions.length>128){const D=new l.aT(E.positions.length,16,Uint16Array);for(const{x:R,y:O}of E.positions)D.add(R,O);D.finish(),delete E.positions,E.index=D}this._symbolsByKey[v]=E}}getScaledCoordinates(t,a){const{x:c,y:f,z:v}=this.tileID.canonical,{x:w,y:E,z:D}=a.canonical,R=un/Math.pow(2,D-v),O=(E*l.a5+t.anchorY)*R,U=f*l.a5*un;return{x:Math.floor((w*l.a5+t.anchorX)*R-c*l.a5*un),y:Math.floor(O-U)}}findMatches(t,a,c){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let v=0;v<t.length;v++){const w=t.get(v);if(w.crossTileID)continue;const E=this._symbolsByKey[w.key];if(!E)continue;const D=this.getScaledCoordinates(w,a);if(E.index){const R=E.index.range(D.x-f,D.y-f,D.x+f,D.y+f).sort();for(const O of R){const U=E.crossTileIDs[O];if(!c[U]){c[U]=!0,w.crossTileID=U;break}}}else if(E.positions)for(let R=0;R<E.positions.length;R++){const O=E.positions[R],U=E.crossTileIDs[R];if(Math.abs(O.x-D.x)<=f&&Math.abs(O.y-D.y)<=f&&!c[U]){c[U]=!0,w.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Qh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Nc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const f=this.indexes[c],v={};for(const w in f){const E=f[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),v[E.tileID.key]=E}this.indexes[c]=v}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>t.overscaledZ)for(const E in w){const D=w[E];D.tileID.isChildOf(t)&&D.findMatches(a.symbolInstances,t,f)}else{const E=w[t.scaledTo(Number(v)).key];E&&E.findMatches(a.symbolInstances,t,f)}}for(let v=0;v<a.symbolInstances.length;v++){const w=a.symbolInstances.get(v);w.crossTileID||(w.crossTileID=c.generate(),f[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Xa(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[t][f]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const f=this.indexes[c];for(const v in f)t[f[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[v]),delete f[v],a=!0)}return a}}class ir{constructor(){this.layerIndexes={},this.crossTileIDs=new Qh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Nc);let v=!1;const w={};f.handleWrapJump(c);for(const E of a){const D=E.getBucket(t);D&&t.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,D,this.crossTileIDs)&&(v=!0),w[D.bucketInstanceId]=!0)}return f.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(t){const a={};t.forEach((c=>{a[c]=!0}));for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var Zi="void main() {fragColor=vec4(1.0);}";const fi={prelude:Qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Qt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Qt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Qt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Qt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Qt(Zi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Qt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Qt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Qt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Qt(Zi,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Qt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Qt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Qt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Qt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Qt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Qt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Qt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Qt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Qt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Qt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Qt(y,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),f=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(f):f,E={};return{fragmentSource:y=y.replace(a,((D,R,O,U,j)=>(E[j]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${O} ${U} ${j};
#else
uniform ${O} ${U} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${O} ${U} ${j} = u_${j};
#endif
`))),vertexSource:t=t.replace(a,((D,R,O,U,j)=>{const H=U==="float"?"vec2":"vec4",K=j.match(/color/)?"color":H;return E[j]?R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${O} ${H} a_${j};
out ${O} ${U} ${j};
#else
uniform ${O} ${U} u_${j};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${O} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${K}(a_${j}, u_${j}_t);
#else
    ${O} ${U} ${j} = u_${j};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${O} ${H} a_${j};
#else
uniform ${O} ${U} u_${j};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${O} ${U} ${j} = a_${j};
#else
    ${O} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${O} ${U} ${j} = unpack_mix_${K}(a_${j}, u_${j}_t);
#else
    ${O} ${U} ${j} = u_${j};
#endif
`})),staticAttributes:c,staticUniforms:w}}class Qn{constructor(t,a,c){this.vertexBuffer=t,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ma=l.aU([{name:"a_pos",type:"Int16",components:2}]);const zi="#define PROJECTION_MERCATOR",Br="mercator";class rr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Br}get shaderDefine(){return zi}get shaderPreludeCode(){return fi.projectionMercator}get vertexShaderPreludeCode(){return fi.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,c,f,v){if(this._cachedMesh)return this._cachedMesh;const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(l.a5,0),w.emplaceBack(0,l.a5),w.emplaceBack(l.a5,l.a5);const E=t.createVertexBuffer(w,Ma.members),D=l.aX.simpleSegment(0,0,4,2),R=new l.aY;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3);const O=t.createIndexBuffer(R);return this._cachedMesh=new Qn(E,O,D),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class oa{constructor(t=0,a=0,c=0,f=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=f}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=l.G.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=l.G.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=l.G.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=l.G.number(t.right,a.right,c)),this}getCenter(t,a){const c=l.an((this.left+t-this.right)/2,0,t),f=l.an((this.top+a-this.bottom)/2,0,a);return new l.P(c,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new oa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gs(y,t){if(!y.renderWorldCopies||y.lngRange)return;const a=t.lng-y.center.lng;t.lng+=a>180?-360:a<-180?360:0}function pi(y){return Math.max(0,Math.floor(y))}class go{constructor(t,a){var c;this.applyConstrain=(f,v)=>this._constrainOverride!==null?this._constrainOverride(f,v):this._callbacks.defaultConstrain(f,v),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=pi(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new oa,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,c){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=pi(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new oa(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=l.W(t,-180,180)*Math.PI/180;var c,f,v,w,E,D,R,O,U;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=W(),c=this._rotationMatrix,v=-this._bearingInRadians,w=(f=this._rotationMatrix)[0],E=f[1],D=f[2],R=f[3],O=Math.sin(v),U=Math.cos(v),c[0]=w*U+D*O,c[1]=E*U+R*O,c[2]=w*-O+D*U,c[3]=E*-O+R*U)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=l.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aZ(this._fovInRadians)}setFov(t){t=l.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=l.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=l.aq(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this.constrainInternal(),this._calcMatrices()}resize(t,a,c=!0){this._width=t,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Kn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.ao,l.ao])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:c,minY:f,maxX:v,maxY:w}=l.aa.fromPoints(a).extend(t);return[new l.P(c,f),new l.P(v,f),new l.P(v,w),new l.P(c,w),new l.P(c,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=l.ar(new Float64Array(16));l.Q(t,t,[this._width/2,-this._height/2,1]),l.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=l.ar(new Float64Array(16)),l.Q(t,t,[1,-1,1]),l.O(t,t,[-1,-1,0]),l.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,c,f){const v=c!==void 0?c:this.bearing,w=f=f!==void 0?f:this.pitch,{distanceToCenter:E,clampedElevation:D}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,w),{x:R,y:O}=Pn(w,v),U=l.a9.fromLngLat(t,a);let j,H,K=l.a_(1,U.y),se=0;do{if(se+=1,se>10)break;H=E/K,j=new l.a9(U.x+R*H,U.y+O*H),K=1/j.meterInMercatorCoordinateUnits()}while(Math.abs(E-H*K)>1e-12);return{center:j.toLngLat(),elevation:D,zoom:l.at(this.height/2/Math.tan(this.fovInRadians/2)/H/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,c=l.as(1,this.center.lat)*this.worldSize,f=l.a9.fromLngLat(this.center,this.elevation),v=f.x/a,w=f.y/a,E=f.z/a,D=this.pitch,R=this.bearing,{x:O,y:U,z:j}=Pn(D,R),H=this.cameraToCenterDistance,K=v+H*-O,se=w+H*-U,le=E+H*j,{distanceToCenter:oe,clampedElevation:ue}=this._distanceToCenterFromAltElevationPitch(le/c,t,D),ve=oe*c,ce=new l.a9((K+O*ve)*a,(se+U*ve)*a,0).toLngLat(),_e=l.as(1,ce.lat),Ee=l.at(this.height/2/Math.tan(this.fovInRadians/2)/oe/_e/this.tileSize);this._elevation=ue,this._center=ce,this.setZoom(Ee)}_distanceToCenterFromAltElevationPitch(t,a,c){const f=-Math.cos(l.ap(c)),v=t-a;let w,E=a;return f*v>=0||Math.abs(f)<.1?(w=1e4,E=t+w*f):w=-v/f,{distanceToCenter:w,clampedElevation:E}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/l.a5,1/a/l.a5]}}class la{constructor(t,a){this.min=t,this.max=a,this.center=l.a$([],l.b0([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],c=l.b1(this.min),f=l.b1(this.max);for(let v=0;v<a.length;v++)c[v]=a[v]?this.min[v]:this.center[v],f[v]=a[v]?this.center[v]:this.max[v];return f[2]=this.max[2],new la(c,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let c=0;c<t.planes.length;c++){const f=this.intersectsPlane(t.planes[c]);if(f===0)return 0;f===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],c=t[3];for(let f=0;f<3;f++)t[f]>0?(a+=t[f]*this.min[f],c+=t[f]*this.max[f]):(c+=t[f]*this.min[f],a+=t[f]*this.max[f]);return a>=0?2:c<0?0:1}}class Wo{distanceToTile2d(t,a,c,f){const v=f.distanceX([t,a]),w=f.distanceY([t,a]);return Math.hypot(v,w)}getWrap(t,a,c){return c}getTileBoundingVolume(t,a,c,f){var v,w;let E=0,D=0;if(f?.terrain){const O=new l.a2(t.z,a,t.z,t.x,t.y),U=f.terrain.getMinMaxElevation(O);E=(v=U.minElevation)!==null&&v!==void 0?v:Math.min(0,c),D=(w=U.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}const R=1<<t.z;return new la([a+t.x/R,t.y/R,E],[a+(t.x+1)/R,(t.y+1)/R,D])}allowVariableZoom(t,a){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,f=l.an(78.5-c/2,0,60);return!!a.terrain||t.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class Nr{constructor(t,a,c){this.points=t,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(t,a=1,c=0,f,v){const w=v?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],E=Math.pow(2,c),D=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((j=>(function(H,K,se,le){const oe=l.aH([],H,K),ue=1/oe[3]/se*le;return l.b6(oe,oe,[ue,ue,1/oe[3],ue])})(j,t,a,E)));f&&(function(j,H,K,se){const le=se?4:0,oe=se?0:4;let ue=0;const ve=[],ce=[];for(let me=0;me<4;me++){const Ce=l.b2([],j[me+oe],j[me+le]),Ze=l.b7(Ce);l.a$(Ce,Ce,1/Ze),ve.push(Ze),ce.push(Ce)}for(let me=0;me<4;me++){const Ce=l.b8(j[me+le],ce[me],K);ue=Ce!==null&&Ce>=0?Math.max(ue,Ce):Math.max(ue,ve[me])}const _e=(function(me,Ce){const Ze=l.b2([],me[Ce[0]],me[Ce[1]]),je=l.b2([],me[Ce[2]],me[Ce[1]]),qe=[0,0,0,0];return l.b3(qe,l.b4([],Ze,je)),qe[3]=-l.b5(qe,me[Ce[0]]),qe})(j,H),Ee=(function(me,Ce){const Ze=l.b9(me),je=l.ba([],me,1/Ze),qe=l.b2([],Ce,l.a$([],je,l.b5(Ce,je))),Ge=l.b9(qe);if(Ge>0){const St=Math.sqrt(1-je[3]*je[3]),Et=l.a$([],je,-je[3]),pt=l.b0([],Et,l.a$([],qe,St/Ge));return l.bb(Ce,pt)}return null})(K,_e);if(Ee!==null){const me=Ee/l.b5(ce[0],_e);ue=Math.min(ue,me)}for(let me=0;me<4;me++){const Ce=Math.min(ue,ve[me]);j[me+oe]=[j[me+le][0]+ce[me][0]*Ce,j[me+le][1]+ce[me][1]*Ce,j[me+le][2]+ce[me][2]*Ce,1]}})(D,w[0],f,v);const R=w.map((j=>{const H=l.b2([],D[j[0]],D[j[1]]),K=l.b2([],D[j[2]],D[j[1]]),se=l.b3([],l.b4([],H,K)),le=-l.b5(se,D[j[1]]);return se.concat(le)})),O=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],U=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const j of D)for(let H=0;H<3;H++)O[H]=Math.min(O[H],j[H]),U[H]=Math.max(U[H],j[H]);return new Nr(D,R,new la(O,U))}}class Qi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=l.an(+c,this.minZoom,this.maxZoom);const f={center:new l.V(a.lng,a.lat),zoom:c};let v=this._helper._lngRange;if(!this._helper._renderWorldCopies&&v===null){const ce=179.9999999999;v=[-ce,ce]}const w=this.tileSize*l.aq(f.zoom);let E=0,D=w,R=0,O=w,U=0,j=0;const{x:H,y:K}=this.size;if(this._helper._latRange){const ce=this._helper._latRange;E=l.X(ce[1])*w,D=l.X(ce[0])*w,D-E<K&&(U=K/(D-E))}v&&(R=l.W(l.Y(v[0])*w,0,w),O=l.W(l.Y(v[1])*w,0,w),O<R&&(O+=w),O-R<H&&(j=H/(O-R)));const{x:se,y:le}=Pt(w,a);let oe,ue;const ve=Math.max(j||0,U||0);if(ve){const ce=new l.P(j?(O+R)/2:se,U?(D+E)/2:le);return f.center=$t(w,ce).wrap(),f.zoom+=l.at(ve),f}if(this._helper._latRange){const ce=K/2;le-ce<E&&(ue=E+ce),le+ce>D&&(ue=D-ce)}if(v){const ce=(R+O)/2;let _e=se;this._helper._renderWorldCopies&&(_e=l.W(se,ce-w/2,ce+w/2));const Ee=H/2;_e-Ee<R&&(oe=R+Ee),_e+Ee>O&&(oe=O-Ee)}if(oe!==void 0||ue!==void 0){const ce=new l.P(oe??se,ue??le);f.center=$t(w,ce).wrap()}return f},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new go({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new Wo}clone(){const t=new Qi;return t.apply(this),t}apply(t,a,c){this._helper.apply(t,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new l.bc(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new l.P(0,0)),f=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),v=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),w=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),E=Math.floor(Math.min(c.x,f.x,v.x,w.x)),D=Math.floor(Math.max(c.x,f.x,v.x,w.x)),R=1;for(let O=E-R;O<=D+R;O++)O!==0&&a.push(new l.bc(O,t))}return a}getCameraFrustum(){return Nr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,a){const c=l.as(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,c),v=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),w=l.a9.fromLngLat(t),E=new l.a9(w.x-(f.x-v.x),w.y-(f.y-v.y));this.setCenter(E?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(l.a9.fromLngLat(t),a.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(l.a9.fromLngLat(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const c=a||0,f=[t.x,t.y,0,1],v=[t.x,t.y,1,1];l.aH(f,f,this._pixelMatrixInverse),l.aH(v,v,this._pixelMatrixInverse);const w=f[3],E=v[3],D=f[1]/w,R=v[1]/E,O=f[2]/w,U=v[2]/E,j=O===U?0:(c-O)/(U-O);return new l.a9(l.G.number(f[0]/w,v[0]/E,j)/this.worldSize,l.G.number(D,R,j)/this.worldSize,c)}coordinatePoint(t,a=0,c=this._pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,a,1];return l.aH(f,f,c),new l.P(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this._helper._height/2-hn(this));return new Kn().extend(this.screenPointToLocation(new l.P(0,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,t))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-hn(this)}calculatePosMatrix(t,a=!1,c){var f;const v=(f=t.key)!==null&&f!==void 0?f:l.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),w=a?this._alignedPosMatrixCache:this._posMatrixCache;if(w.has(v)){const R=w.get(v);return c?R.f32:R.f64}const E=dn(t,this.worldSize);l.S(E,a?this._alignedProjMatrix:this._viewProjMatrix,E);const D={f64:E,f32:new Float32Array(E)};return w.set(v,D),c?D.f32:D.f64}calculateFogMatrix(t){const a=t.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);const f=dn(t,this.worldSize);return l.S(f,this._fogMatrix,f),c.set(a,new Float32Array(f)),c.get(a)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}_calculateNearFarZIfNeeded(t,a,c){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),v=t-f*this._helper._pixelPerMeter/Math.cos(a),w=f<0?v:t,E=Math.PI/2+this.pitchInRadians,D=l.ap(this.fov)*(Math.abs(Math.cos(l.ap(this.roll)))*this.height+Math.abs(Math.sin(l.ap(this.roll)))*this.width)/this.height*(.5+c.y/this.height),R=Math.sin(D)*w/Math.sin(l.an(Math.PI-E-D,.01,Math.PI-.01)),O=hn(this),U=Math.atan(O/this._helper.cameraToCenterDistance),j=l.ap(.75),H=U>j?2*U*(.5+c.y/(2*O)):j,K=Math.sin(H)*w/Math.sin(l.an(Math.PI-E-H,.01,Math.PI-.01)),se=Math.min(R,K);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*se+w),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Pt(this.worldSize,this.center),c=a.x,f=a.y;this._helper._pixelPerMeter=l.as(1,this.center.lat)*this.worldSize;const v=l.ap(Math.min(this.pitch,Mt)),w=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(v));let E;this._calculateNearFarZIfNeeded(w,v,t),E=new Float64Array(16),l.be(E,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aB(this._invProjMatrix,E),E[8]=2*-t.x/this._helper._width,E[9]=2*t.y/this._helper._height,this._projectionMatrix=l.bf(E),l.Q(E,E,[1,-1,1]),l.O(E,E,[0,0,-this._helper.cameraToCenterDistance]),l.bg(E,E,-this.rollInRadians),l.bh(E,E,this.pitchInRadians),l.bg(E,E,-this.bearingInRadians),l.O(E,E,[-c,-f,0]),this._mercatorMatrix=l.Q([],E,[this.worldSize,this.worldSize,this.worldSize]),l.Q(E,E,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E),l.O(E,E,[0,0,-this.elevation]),this._viewProjMatrix=E,this._invViewProjMatrix=l.aB([],E);const D=[0,0,-1,1];l.aH(D,D,this._invViewProjMatrix),this._cameraPosition=[D[0]/D[3],D[1]/D[3],D[2]/D[3]],this._fogMatrix=new Float64Array(16),l.be(this._fogMatrix,this.fovInRadians,this.width/this.height,w,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,l.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.O(this._fogMatrix,this._fogMatrix,[-c,-f,0]),l.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,E);const R=this._helper._width%2/2,O=this._helper._height%2/2,U=Math.cos(this.bearingInRadians),j=Math.sin(-this.bearingInRadians),H=c-Math.round(c)+U*R+j*O,K=f-Math.round(f)+U*O+j*R,se=new Float64Array(E);if(l.O(se,se,[H>.5?H-1:H,K>.5?K-1:K,0]),this._alignedProjMatrix=se,E=l.aB(new Float64Array(16),this._pixelMatrix),!E)throw new Error("failed to invert matrix");this._pixelMatrixInverse=E,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new l.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.aH(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=l.as(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const c=l.a9.fromLngLat(t),f=[c.x*this.worldSize,c.y*this.worldSize,a,1];return l.aH(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(t){const{overscaledTileID:a,aligned:c,applyTerrainMatrix:f}=t,v=this._helper.getMercatorTileCoordinates(a),w=a?this.calculatePosMatrix(a,c,!0):null;let E;return E=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:w||l.bi(),{mainMatrix:E,tileMercatorCoords:v,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:E}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,c){return 1}transformLightDirection(t){return l.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,c,f){const v=this.calculatePosMatrix(c);let w;f?(w=[t,a,f(t,a),1],l.aH(w,w,v)):(w=[t,a,0,1],Ea(w,w,v));const E=w[3];return{point:new l.P(w[0]/E,w[1]/E),signedDistanceFromCamera:E,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const c=l.a9.fromLngLat(t,a),f=c.meterInMercatorCoordinateUnits(),v=l.bj();return l.O(v,v,[c.x,c.y,c.z]),l.bg(v,v,Math.PI),l.bh(v,v,Math.PI/2),l.Q(v,v,[-f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=new l.a2(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),f=dn(a,this.worldSize);l.S(f,this._viewProjMatrix,f),c.tileMercatorCoords=[0,0,1,1];const v=[l.a5,l.a5,this.worldSize/this._helper.pixelsPerMeter],w=l.bk();return l.Q(w,f,v),c.fallbackMatrix=w,c.mainMatrix=w,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Fr(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Fc(y){if(y.useSlerp)if(y.k<1){const t=l.bl(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),a=l.bl(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),c=new Float64Array(4);l.bm(c,t,a,y.k);const f=l.bn(c);y.tr.setRoll(f.roll),y.tr.setPitch(f.pitch),y.tr.setBearing(f.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(l.G.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(l.G.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(l.G.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function Ko(y,t,a,c,f){const v=f.padding,w=Pt(f.worldSize,a.getNorthWest()),E=Pt(f.worldSize,a.getNorthEast()),D=Pt(f.worldSize,a.getSouthEast()),R=Pt(f.worldSize,a.getSouthWest()),O=l.ap(-c),U=w.rotate(O),j=E.rotate(O),H=D.rotate(O),K=R.rotate(O),se=new l.P(Math.max(U.x,j.x,K.x,H.x),Math.max(U.y,j.y,K.y,H.y)),le=new l.P(Math.min(U.x,j.x,K.x,H.x),Math.min(U.y,j.y,K.y,H.y)),oe=se.sub(le),ue=(f.width-(v.left+v.right+t.left+t.right))/oe.x,ve=(f.height-(v.top+v.bottom+t.top+t.bottom))/oe.y;if(ve<0||ue<0)return void Fr();const ce=Math.min(l.at(f.scale*Math.min(ue,ve)),y.maxZoom),_e=l.P.convert(y.offset),Ee=new l.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(l.ap(c)),me=_e.add(Ee).mult(f.scale/l.aq(ce));return{center:$t(f.worldSize,w.add(D).div(2).sub(me)),zoom:ce,bearing:c}}class Qo{get useGlobeControls(){return!1}handlePanInertia(t,a){const c=t.mag(),f=Math.abs(hn(a));return{easingOffset:t.mult(Math.min(.75*f/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,c){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,a,c,f,v){return Ko(t,a,c,f,v)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(l.V.convert(a.center))}handleEaseTo(t,a){const c=t.zoom,f=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},E=a.zoom!==void 0,D=!t.isPaddingEqual(a.padding);let R=!1;const O=E?+a.zoom:t.zoom;let U=t.centerPoint.add(a.offsetAsPoint);const j=t.screenPointToLocation(U),{center:H,zoom:K}=t.applyConstrain(l.V.convert(a.center||j),O??c);gs(t,H);const se=Pt(t.worldSize,j),le=Pt(t.worldSize,H).sub(se),oe=l.aq(K-c);return R=K!==c,{easeFunc:ue=>{if(R&&t.setZoom(l.G.number(c,K,ue)),l.bo(v,w)||Fc({startEulerAngles:v,endEulerAngles:w,tr:t,k:ue,useSlerp:v.roll!=w.roll}),D&&(t.interpolatePadding(f,a.padding,ue),U=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const ve=l.aq(t.zoom-c),ce=K>c?Math.min(2,oe):Math.max(.5,oe),_e=Math.pow(ce,1-ue),Ee=$t(t.worldSize,se.add(le.mult(ue*_e)).mult(ve));t.setLocationAtPoint(t.renderWorldCopies?Ee.wrap():Ee,U)}},isZooming:R,elevationCenter:H}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.zoom,v=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),c?+a.zoom:f),w=v.center,E=v.zoom;gs(t,w);const D=Pt(t.worldSize,a.locationAtOffset),R=Pt(t.worldSize,w).sub(D),O=R.mag(),U=l.aq(E-f);let j;if(a.minZoom!==void 0){const H=Math.min(+a.minZoom,f,E),K=t.applyConstrain(w,H).zoom;j=l.aq(K-f)}return{easeFunc:(H,K,se,le)=>{t.setZoom(H===1?E:f+l.at(K));const oe=H===1?w:$t(t.worldSize,D.add(R.mult(se)).mult(K));t.setLocationAtPoint(t.renderWorldCopies?oe.wrap():oe,le)},scaleOfZoom:U,targetCenter:w,scaleOfMinZoom:j,pixelPathLength:O}}}class Hn{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}Hn.Replace=[1,0],Hn.disabled=new Hn(Hn.Replace,l.bp.transparent,[!1,!1,!1,!1]),Hn.unblended=new Hn(Hn.Replace,l.bp.transparent,[!0,!0,!0,!0]),Hn.alphaBlended=new Hn([1,771],l.bp.transparent,[!0,!0,!0,!0]);const yo=2305;class gn{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}gn.disabled=new gn(!1,1029,yo),gn.backCCW=new gn(!0,1029,yo),gn.frontCCW=new gn(!0,1028,yo);class on{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}on.ReadOnly=!1,on.ReadWrite=!0,on.disabled=new on(519,on.ReadOnly,[0,1]);const Jo=7680;class En{constructor(t,a,c,f,v,w){this.test=t,this.ref=a,this.mask=c,this.fail=f,this.depthFail=v,this.pass=w}}En.disabled=new En({func:519,mask:0},0,0,Jo,Jo,Jo);const jc=new WeakMap;function Aa(y){var t;if(jc.has(y))return jc.get(y);{const a=(t=y.getParameter(y.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return jc.set(y,a),a}}class _o{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const f=new l.aW;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const v=new l.aY;v.emplaceBack(0,1,2),this._fullscreenTriangle=new Qn(a.createVertexBuffer(f,Ma.members),a.createIndexBuffer(v),l.aX.simpleSegment(0,0,f.length,v.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);const w=c.createTexture();c.bindTexture(c.TEXTURE_2D,w),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(w),Aa(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const c=this._cachedRenderContext.context,f=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:l.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,f.TRIANGLES,on.disabled,En.disabled,Hn.unblended,gn.disabled,((v,w)=>({u_input:v,u_output_expected:w}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Aa(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const v=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:v}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Aa(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=_o._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const vo=l.a5/128;function wf(y,t){const a=y.granularity!==void 0?Math.max(y.granularity,1):1,c=a+(y.generateBorders?2:0),f=a+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),v=c+1,w=f+1,E=y.generateBorders?-1:0,D=y.generateBorders||y.extendToNorthPole?-1:0,R=a+(y.generateBorders?1:0),O=a+(y.generateBorders||y.extendToSouthPole?1:0),U=v*w,j=c*f*6,H=v*w>65536;if(H&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const K=H||t==="32bit",se=new Int16Array(2*U);let le=0;for(let ve=D;ve<=O;ve++)for(let ce=E;ce<=R;ce++){let _e=ce/a*l.a5;ce===-1&&(_e=-vo),ce===a+1&&(_e=l.a5+vo);let Ee=ve/a*l.a5;ve===-1&&(Ee=y.extendToNorthPole?l.br:-vo),ve===a+1&&(Ee=y.extendToSouthPole?l.bs:l.a5+vo),se[le++]=_e,se[le++]=Ee}const oe=K?new Uint32Array(j):new Uint16Array(j);let ue=0;for(let ve=0;ve<f;ve++)for(let ce=0;ce<c;ce++){const _e=ce+1+ve*v,Ee=ce+(ve+1)*v,me=ce+1+(ve+1)*v;oe[ue++]=ce+ve*v,oe[ue++]=Ee,oe[ue++]=_e,oe[ue++]=_e,oe[ue++]=Ee,oe[ue++]=me}return{vertices:se.buffer.slice(0),indices:oe.buffer.slice(0),uses32bitIndices:K}}const Uc=new l.aV({fill:new l.bt(128,2),line:new l.bt(512,0),tile:new l.bt(128,32),stencil:new l.bt(128,1),circle:3});class Jh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return fi.projectionGlobe}get vertexShaderPreludeCode(){return fi.projectionMercator.vertexSource}get subdivisionGranularity(){return Uc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new _o(t));const a=l.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,c),v=pe();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=v);const w=Math.min(Math.max((v-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bv(w))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,c,f,v){const w=(v==="stencil"?Uc.stencil:Uc.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:w,generateBorders:c,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(t,a){const c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];const f=(function(v,w){const E=wf(w,"16bit"),D=l.aW.deserialize({arrayBuffer:E.vertices,length:E.vertices.byteLength/2/2}),R=l.aY.deserialize({arrayBuffer:E.indices,length:E.indices.byteLength/2/3});return new Qn(v.createVertexBuffer(D,Ma.members),v.createIndexBuffer(R),l.aX.simpleSegment(0,0,D.length,R.length))})(t,a);return this._tileMeshCache[c]=f,f}recalculate(t){}hasTransition(){const t=pe();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Kp=new l.t({type:new l.D(l.u.projection.type)});class ed extends l.E{constructor(t){super(),this._transitionable=new l.x(Kp,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0)),this._mercatorProjection=new rr,this._verticalPerspectiveProjection=new Jh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof l.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,c,f,v){return this.currentProjection.getMeshFromTileID(t,a,c,f,v)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function jr(y){const t=el(y.worldSize,y.center.lat);return 2*Math.PI*t}function ys(y,t,a,c,f){const v=1/(1<<f),w=t/l.a5*v+c*v,E=l.by((y/l.a5*v+a*v)*Math.PI*2+Math.PI,2*Math.PI),D=2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI,R=Math.cos(D),O=new Float64Array(3);return O[0]=Math.sin(E)*R,O[1]=Math.sin(D),O[2]=Math.cos(E)*R,O}function mi(y){return(function(t,a){const c=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(t)*c,f[1]=Math.sin(a),f[2]=Math.cos(t)*c,f})(y.lng*Math.PI/180,y.lat*Math.PI/180)}function el(y,t){return y/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Vc(y){const t=Math.asin(y[1])/Math.PI*180,a=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(a>1e-6){const c=y[0]/a,f=Math.acos(y[2]/a),v=(c>0?f:-f)/Math.PI*180;return new l.V(l.W(v,-180,180),t)}return new l.V(0,t)}function qc(y){return Math.cos(y*Math.PI/180)}function Di(y,t){const a=qc(y),c=qc(t);return l.at(c/a)}function Tf(y,t){const a=y.rotate(t.bearingInRadians),c=t.zoom+Di(t.center.lat,0),f=l.bu(1/qc(t.center.lat),1/qc(Math.min(Math.abs(t.center.lat),60)),l.bx(c,7,3,0,1)),v=360/jr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new l.V(t.center.lng-a.x*v*f,l.an(t.center.lat+a.y*v,-l.ao,l.ao))}function Zu(y){const t=.5*y,a=Math.sin(t),c=Math.cos(t);return Math.log(a+c)-Math.log(c-a)}function Sf(y,t,a,c){const f=y.lat+a*c;if(Math.abs(a)>1){const v=(Math.sign(y.lat+a)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,w=Math.abs(y.lat+a)*Math.PI/180,E=Zu(v+c*(w-v)),D=Zu(v),R=Zu(w);return new l.V(y.lng+t*((E-D)/(R-D)),f)}return new l.V(y.lng+t*c,f)}class Qp{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,c,f){const v=`${t.z}_${t.x}_${t.y}_${f?.terrain?"t":""}`,w=this._cache.get(v);if(w)return w;const E=this._cachePrevious.get(v);if(E)return this._cache.set(v,E),E;const D=this._boundingVolumeFactory(t,a,c,f);return this._cache.set(v,D),this._hadAnyChanges=!0,D}}class ql{constructor(t,a,c,f){this.min=c,this.max=f,this.points=t,this.planes=a}static fromAabb(t,a){const c=[];for(let f=0;f<8;f++)c.push([1&~f?t[0]:a[0],(f>>1&1)==1?a[1]:t[1],(f>>2&1)==1?a[2]:t[2]]);return new ql(c,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,c){const f=l.bB([],c[0],c[1],c[2]),v=l.bC([],[a[0],0,0],f),w=l.bC([],[0,a[1],0],f),E=l.bC([],[0,0,a[2]],f),D=[...t],R=[...t];for(let U=0;U<8;U++)for(let j=0;j<3;j++){const H=t[j]+v[j]*(1&~U?-1:1)+w[j]*((U>>1&1)==1?1:-1)+E[j]*((U>>2&1)==1?1:-1);D[j]=Math.min(D[j],H),R[j]=Math.max(R[j],H)}const O=[];for(let U=0;U<8;U++){const j=[...t];l.b0(j,j,l.a$([],v,1&~U?-1:1)),l.b0(j,j,l.a$([],w,(U>>1&1)==1?1:-1)),l.b0(j,j,l.a$([],E,(U>>2&1)==1?1:-1)),O.push(j)}return new ql(O,[[...v,-l.b5(v,O[0])],[...w,-l.b5(w,O[0])],[...E,-l.b5(E,O[0])],[-v[0],-v[1],-v[2],-l.b5(v,O[7])],[-w[0],-w[1],-w[2],-l.b5(w,O[7])],[-E[0],-E[1],-E[2],-l.b5(E,O[7])]],D,R)}intersectsFrustum(t){let a=!0;const c=this.points.length,f=this.planes.length,v=t.planes.length,w=t.points.length;for(let E=0;E<v;E++){const D=t.planes[E];let R=0;for(let O=0;O<c;O++){const U=this.points[O];D[0]*U[0]+D[1]*U[1]+D[2]*U[2]+D[3]>=0&&R++}if(R===0)return 0;R<c&&(a=!1)}if(a)return 2;for(let E=0;E<f;E++){const D=this.planes[E];let R=0;for(let O=0;O<w;O++){const U=t.points[O];D[0]*U[0]+D[1]*U[1]+D[2]*U[2]+D[3]>=0&&R++}if(R===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let c=0;for(let f=0;f<a;f++){const v=this.points[f];t[0]*v[0]+t[1]*v[1]+t[2]*v[2]+t[3]>=0&&c++}return c===a?2:c===0?0:1}}function Hu(y,t,a){const c=y-t;return c<0?-c:Math.max(0,c-a)}function Gl(y,t,a,c,f){const v=y-a;let w;return w=v<0?Math.min(-v,1+v-f):v>1?Math.min(Math.max(v-f,0),1-v):0,Math.max(w,Hu(t,c,f))}class td{constructor(){this._boundingVolumeCache=new Qp(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,c,f){const v=1<<c.z,w=1/v,E=c.x/v,D=c.y/v;let R=2;return R=Math.min(R,Gl(t,a,E,D,w)),R=Math.min(R,Gl(t,a,E+.5,-D-w,w)),R=Math.min(R,Gl(t,a,E+.5,2-D-w,w)),R}getWrap(t,a,c){const f=1<<a.z,v=1/f,w=a.x/f,E=Hu(t.x,w,v),D=Hu(t.x,w-1,v),R=Hu(t.x,w+1,v),O=Math.min(E,D,R);return O===R?1:O===D?-1:0}allowVariableZoom(t,a){return Bn(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,c,f){return this._boundingVolumeCache.getTileBoundingVolume(t,a,c,f)}_computeTileBoundingVolume(t,a,c,f){var v,w;let E=0,D=0;if(f?.terrain){const R=new l.a2(t.z,a,t.z,t.x,t.y),O=f.terrain.getMinMaxElevation(R);E=(v=O.minElevation)!==null&&v!==void 0?v:Math.min(0,c),D=(w=O.maxElevation)!==null&&w!==void 0?w:Math.max(0,c)}if(E/=l.bE,D/=l.bE,E+=1,D+=1,t.z<=0)return ql.fromAabb([-D,-D,-D],[D,D,D]);if(t.z===1)return ql.fromAabb([t.x===0?-D:0,t.y===0?0:-D,-D],[t.x===0?0:D,t.y===0?D:0,D]);{const R=[ys(0,0,t.x,t.y,t.z),ys(l.a5,0,t.x,t.y,t.z),ys(l.a5,l.a5,t.x,t.y,t.z),ys(0,l.a5,t.x,t.y,t.z)],O=[];for(const qe of R)O.push(l.a$([],qe,D));if(D!==E)for(const qe of R)O.push(l.a$([],qe,E));t.y===0&&O.push([0,1,0]),t.y===(1<<t.z)-1&&O.push([0,-1,0]);const U=[1,1,1],j=[-1,-1,-1];for(const qe of O)for(let Ge=0;Ge<3;Ge++)U[Ge]=Math.min(U[Ge],qe[Ge]),j[Ge]=Math.max(j[Ge],qe[Ge]);const H=ys(l.a5/2,l.a5/2,t.x,t.y,t.z),K=l.b4([],[0,1,0],H);l.b3(K,K);const se=l.b4([],H,K);l.b3(se,se);const le=l.b4([],R[2],R[1]);l.b3(le,le);const oe=l.b4([],R[0],R[3]);l.b3(oe,oe),O.push(l.a$([],H,D)),t.y>=(1<<t.z)/2&&O.push(l.a$([],ys(l.a5/2,0,t.x,t.y,t.z),D)),t.y<(1<<t.z)/2&&O.push(l.a$([],ys(l.a5/2,l.a5,t.x,t.y,t.z),D));const ue=Gc(H,O),ve=Gc(se,O),ce=[-H[0],-H[1],-H[2],ue.max],_e=[H[0],H[1],H[2],-ue.min],Ee=[-se[0],-se[1],-se[2],ve.max],me=[se[0],se[1],se[2],-ve.min],Ce=[...le,0],Ze=[...oe,0],je=[];return t.y===0?je.push(l.bD(Ze,Ce,ce),l.bD(Ze,Ce,_e)):je.push(l.bD(Ee,Ce,ce),l.bD(Ee,Ce,_e),l.bD(Ee,Ze,ce),l.bD(Ee,Ze,_e)),t.y===(1<<t.z)-1?je.push(l.bD(Ze,Ce,ce),l.bD(Ze,Ce,_e)):je.push(l.bD(me,Ce,ce),l.bD(me,Ce,_e),l.bD(me,Ze,ce),l.bD(me,Ze,_e)),new ql(je,[ce,_e,Ee,me,Ce,Ze],U,j)}}}function Gc(y,t){let a=1/0,c=-1/0;for(const f of t){const v=l.b5(y,f);a=Math.min(a,v),c=Math.max(c,v)}return{min:a,max:c}}class Zl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=l.bF(),this._projectionMatrix=l.bj(),this._globeViewProjMatrix32f=l.bi(),this._globeViewProjMatrixNoCorrection=l.bj(),this._globeViewProjMatrixNoCorrectionInverted=l.bj(),this._globeProjMatrixInverted=l.bj(),this._cameraPosition=l.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{const f=l.an(a.lat,-l.ao,l.ao),v=l.an(+c,this.minZoom+Di(0,f),this.maxZoom);return{center:new l.V(a.lng,f),zoom:v}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new go({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new td}clone(){const t=new Zl;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=l.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:c}=t,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,c=this.cameraToCenterDistance/t,f=Math.sin(a)*c,v=Math.cos(a)*c+1,w=1/Math.sqrt(f*f+v*v)*1;let E=-f,D=v;const R=Math.sqrt(E*E+D*D);E/=R,D/=R;const O=[0,E,D];l.bG(O,O,[0,0,0],-this.bearingInRadians),l.bH(O,O,[0,0,0],-1*this.center.lat*Math.PI/180),l.bI(O,O,[0,0,0],this.center.lng*Math.PI/180);const U=1/l.b7(O);return l.a$(O,O,U),[...O,-w*U]}isLocationOccluded(t){return!this.isSurfacePointVisible(mi(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,f=Math.cos(c),v=[Math.sin(a)*f,Math.sin(c),Math.cos(a)*f],w=[v[2],0,-v[0]],E=[0,0,0];l.b4(E,w,v),l.b3(w,w),l.b3(E,E);const D=[0,0,0];return l.b3(D,[w[0]*t[0]+E[0]*t[1]+v[0]*t[2],w[1]*t[0]+E[1]*t[1]+v[1]*t[2],w[2]*t[0]+E[2]*t[1]+v[2]*t[2]]),D}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,c){const f=(function(E,D,R){const O=1/(1<<R.z);return new l.a9(E/l.a5*O+R.x*O,D/l.a5*O+R.y*O)})(t,a,c.canonical),v=(w=f.y,[l.by(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-w*Math.PI*2))-.5*Math.PI]);var w;return this.getCircleRadiusCorrection()/Math.cos(v[1])}projectTileCoordinates(t,a,c,f){const v=c.canonical,w=ys(t,a,v.x,v.y,v.z),E=1+(f?f(t,a):0)/l.bE,D=[w[0]*E,w[1]*E,w[2]*E,1];l.aH(D,D,this._globeViewProjMatrixNoCorrection);const R=this._cachedClippingPlane,O=R[0]*w[0]+R[1]*w[1]+R[2]*w[2]+R[3]<0;return{point:new l.P(D[0]/D[3],D[1]/D[3]),signedDistanceFromCamera:D[3],isOccluded:O}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=el(this.worldSize,this.center.lat),a=l.bk(),c=l.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),l.be(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=l.bf(a),this._globeProjMatrixInverted=l.bk(),l.aB(this._globeProjMatrixInverted,a),l.O(a,a,[0,0,-this.cameraToCenterDistance]),l.bg(a,a,this.rollInRadians),l.bh(a,a,-this.pitchInRadians),l.bg(a,a,this.bearingInRadians),l.O(a,a,[0,0,-t]);const v=l.bz();v[0]=t,v[1]=t,v[2]=t,l.bh(c,a,this.center.lat*Math.PI/180),l.bJ(c,c,-this.center.lng*Math.PI/180),l.Q(c,c,v),this._globeViewProjMatrixNoCorrection=c,l.bh(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bJ(a,a,-this.center.lng*Math.PI/180),l.Q(a,a,v),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=l.bk(),l.aB(this._globeViewProjMatrixNoCorrectionInverted,c);const w=l.bz();this._cameraPosition=l.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,l.bG(this._cameraPosition,this._cameraPosition,w,-this.rollInRadians),l.bH(this._cameraPosition,this._cameraPosition,w,this.pitchInRadians),l.bG(this._cameraPosition,this._cameraPosition,w,-this.bearingInRadians),l.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bH(this._cameraPosition,this._cameraPosition,w,-this.center.lat*Math.PI/180),l.bI(this._cameraPosition,this._cameraPosition,w,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const E=l.bf(this._globeViewProjMatrixNoCorrectionInverted);l.Q(E,E,[1,1,-1]),this._cachedFrustum=Nr.fromInvProjectionMatrix(E,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){l.w("calculateFogMatrix is not supported on globe projection.");const a=l.bk();return l.ar(a),a}getVisibleUnwrappedCoordinates(t){return[new l.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=mi(t);l.a$(c,c,1+a/l.bE);const f=l.bF();return l.aH(f,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,c=[new l.P(0,0),new l.P(t,0),new l.P(this.width,0),new l.P(this.width,a),new l.P(this.width,this.height),new l.P(t,this.height),new l.P(0,this.height),new l.P(0,a)],f=[];for(const U of c)f.push(this.unprojectScreenPoint(U));let v=0,w=0,E=0,D=0;const R=this.center;for(const U of f){const j=l.bK(R.lng,U.lng),H=l.bK(R.lat,U.lat);j<w&&(w=j),j>v&&(v=j),H<D&&(D=H),H>E&&(E=H)}const O=[R.lng+w,R.lat+D,R.lng+v,R.lat+E];return this.isSurfacePointOnScreen([0,1,0])&&(O[3]=90,O[0]=-180,O[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(O[1]=-90,O[0]=-180,O[2]=180),new Kn(O)}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){const c=mi(this.unprojectScreenPoint(a)),f=mi(t),v=l.bz();l.bL(v);const w=l.bz();l.bI(w,c,v,-this.center.lng*Math.PI/180),l.bH(w,w,v,this.center.lat*Math.PI/180);const E=f[0]*f[0]+f[2]*f[2],D=w[0]*w[0];if(E<D)return;const R=Math.sqrt(E-D),O=-R,U=l.bM(f[0],f[2],w[0],R),j=l.bM(f[0],f[2],w[0],O),H=l.bz();l.bI(H,f,v,-U);const K=l.bM(H[1],H[2],w[1],w[2]),se=l.bz();l.bI(se,f,v,-j);const le=l.bM(se[1],se[2],w[1],w[2]),oe=.5*Math.PI,ue=K>=-oe&&K<=oe,ve=le>=-oe&&le<=oe;let ce,_e;if(ue&&ve){const Ze=this.center.lng*Math.PI/180,je=this.center.lat*Math.PI/180;l.bN(U,Ze)+l.bN(K,je)<l.bN(j,Ze)+l.bN(le,je)?(ce=U,_e=K):(ce=j,_e=le)}else if(ue)ce=U,_e=K;else{if(!ve)return;ce=j,_e=le}const Ee=ce/Math.PI*180,me=_e/Math.PI*180,Ce=this.center.lat;this.setCenter(new l.V(Ee,l.an(me,-90,90))),this.setZoom(this.zoom+Di(Ce,this.center.lat))}locationToScreenPoint(t,a){const c=mi(t);if(a){const f=a.getElevationForLngLatZoom(t,this._helper._tileZoom);l.a$(c,c,1+f/l.bE)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new l.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c)return c}return l.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,a){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,f)}getRayDirectionFromPixel(t){const a=l.bF();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,l.aH(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const c=l.bz();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];const f=l.bz();return l.b3(f,c),f}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=l.bF();return l.aH(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const c=l.b5(t,a),f=l.bz(),v=l.bz();l.a$(v,a,c),l.b2(f,t,v);const w=1-l.b5(f,f);if(w<0)return null;const E=l.b5(t,t)-1,D=-c+(c<0?1:-1)*Math.sqrt(w),R=E/D,O=D;return{tMin:Math.min(R,O),tMax:Math.max(R,O)}}unprojectScreenPoint(t){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t),f=this.rayPlanetIntersection(a,c);if(f){const O=l.bz();l.b0(O,a,[c[0]*f.tMin,c[1]*f.tMin,c[2]*f.tMin]);const U=l.bz();return l.b3(U,O),Vc(U)}const v=this._cachedClippingPlane,w=v[0]*c[0]+v[1]*c[1]+v[2]*c[2],E=-l.bb(v,a)/w,D=l.bz();if(E>0)l.b0(D,a,[c[0]*E,c[1]*E,c[2]*E]);else{const O=l.bz();l.b0(O,a,[2*c[0],2*c[1],2*c[2]]);const U=l.bb(this._cachedClippingPlane,O);l.b2(D,O,[this._cachedClippingPlane[0]*U,this._cachedClippingPlane[1]*U,this._cachedClippingPlane[2]*U])}const R=(function(O){const U=l.bz();return U[0]=O[0]*-O[3],U[1]=O[1]*-O[3],U[2]=O[2]*-O[3],{center:U,radius:Math.sqrt(1-O[3]*O[3])}})(v);return Vc((function(O,U,j){const H=l.bz();l.b2(H,j,O);const K=l.bz();return l.bA(K,O,H,U/l.b9(H)),K})(R.center,R.radius,D))}getMatrixForModel(t,a){const c=l.V.convert(t),f=1/l.bE,v=l.bj();return l.bJ(v,v,c.lng/180*Math.PI),l.bh(v,v,-c.lat/180*Math.PI),l.O(v,v,[0,0,1+a/l.bE]),l.bh(v,v,.5*Math.PI),l.Q(v,v,[f,f,f]),v}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new l.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new go({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._globeness=1,this._mercatorTransform=new Qi,this._verticalPerspectiveTransform=new Zl}clone(){const t=new Hl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return l.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,c){const f=this._mercatorTransform.getPitchedTextCorrection(t,a,c),v=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,c);return l.bu(f,v,this._globeness)}projectTileCoordinates(t,a,c,f){return this.currentTransform.projectTileCoordinates(t,a,c,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,f)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Fi{get useGlobeControls(){return!0}handlePanInertia(t,a){const c=Tf(t,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const c=t.around,f=a.screenPointToLocation(c);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const v=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const w=a.zoom-v;if(w===0)return;const E=l.bK(a.center.lng,f.lng),D=E/(Math.abs(E/180)+1),R=l.bK(a.center.lat,f.lat),O=a.getRayDirectionFromPixel(c),U=a.cameraPosition,j=-1*l.b5(U,O),H=l.bz();l.b0(H,U,[O[0]*j,O[1]*j,O[2]*j]);const K=l.b7(H)-1,se=Math.exp(.5*-Math.max(K-.3,0)),le=el(a.worldSize,a.center.lat)/Math.min(a.width,a.height),oe=l.bx(le,.9,.5,1,.25),ue=(1-l.aq(-w))*Math.min(se,oe),ve=a.center.lat,ce=a.zoom,_e=new l.V(a.center.lng+D*ue,l.an(a.center.lat+R*ue,-l.ao,l.ao));a.setLocationAtPoint(f,c);const Ee=a.center,me=l.bx(Math.abs(E),45,85,0,1),Ce=l.bx(le,.75,.35,0,1),Ze=Math.pow(Math.max(me,Ce),.25),je=l.bK(Ee.lng,_e.lng),qe=l.bK(Ee.lat,_e.lat);a.setCenter(new l.V(Ee.lng+je*Ze,Ee.lat+qe*Ze).wrap()),a.setZoom(ce+Di(ve,a.center.lat))}handleMapControlsPan(t,a,c){if(!t.panDelta)return;const f=a.center.lat,v=a.zoom;a.setCenter(Tf(t.panDelta,a).wrap()),a.setZoom(v+Di(f,a.center.lat))}cameraForBoxAndBearing(t,a,c,f,v){const w=Ko(t,a,c,f,v),E=a.left/v.width*2-1,D=(v.width-a.right)/v.width*2-1,R=a.top/v.height*-2+1,O=(v.height-a.bottom)/v.height*-2+1,U=l.bK(c.getWest(),c.getEast())<0,j=U?c.getEast():c.getWest(),H=U?c.getWest():c.getEast(),K=Math.max(c.getNorth(),c.getSouth()),se=Math.min(c.getNorth(),c.getSouth()),le=j+.5*l.bK(j,H),oe=K+.5*l.bK(K,se),ue=v.clone();ue.setCenter(w.center),ue.setBearing(w.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(w.zoom);const ve=ue.modelViewProjectionMatrix,ce=[mi(c.getNorthWest()),mi(c.getNorthEast()),mi(c.getSouthWest()),mi(c.getSouthEast()),mi(new l.V(H,oe)),mi(new l.V(j,oe)),mi(new l.V(le,K)),mi(new l.V(le,se))],_e=mi(w.center);let Ee=Number.POSITIVE_INFINITY;for(const me of ce)E<0&&(Ee=Fi.getLesserNonNegativeNonNull(Ee,Fi.solveVectorScale(me,_e,ve,"x",E))),D>0&&(Ee=Fi.getLesserNonNegativeNonNull(Ee,Fi.solveVectorScale(me,_e,ve,"x",D))),R>0&&(Ee=Fi.getLesserNonNegativeNonNull(Ee,Fi.solveVectorScale(me,_e,ve,"y",R))),O<0&&(Ee=Fi.getLesserNonNegativeNonNull(Ee,Fi.solveVectorScale(me,_e,ve,"y",O)));if(Number.isFinite(Ee)&&Ee!==0)return w.zoom=ue.zoom+l.at(Ee),w;Fr()}handleJumpToCenterZoom(t,a){const c=t.center.lat,f=t.applyConstrain(a.center?l.V.convert(a.center):t.center,t.zoom).center;t.setCenter(f.wrap());const v=a.zoom!==void 0?+a.zoom:t.zoom+Di(c,f.lat);t.zoom!==v&&t.setZoom(v)}handleEaseTo(t,a){const c=t.zoom,f=t.center,v=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},E={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},D=a.zoom!==void 0,R=!t.isPaddingEqual(a.padding);let O=!1;const U=a.center?l.V.convert(a.center):f,j=t.applyConstrain(U,c).center;gs(t,j);const H=t.clone();H.setCenter(j),H.setZoom(D?+a.zoom:c+Di(f.lat,U.lat)),H.setBearing(a.bearing);const K=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));H.setLocationAtPoint(j,K);const se=(a.offset&&a.offsetAsPoint.mag())>0?H.center:j,le=D?+a.zoom:c+Di(f.lat,se.lat),oe=c+Di(f.lat,0),ue=le+Di(se.lat,0),ve=l.bK(f.lng,se.lng),ce=l.bK(f.lat,se.lat),_e=l.aq(ue-oe);return O=le!==c,{easeFunc:Ee=>{if(l.bo(w,E)||Fc({startEulerAngles:w,endEulerAngles:E,tr:t,k:Ee,useSlerp:w.roll!=E.roll}),R&&t.interpolatePadding(v,a.padding,Ee),a.around)l.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const me=ue>oe?Math.min(2,_e):Math.max(.5,_e),Ce=Math.pow(me,1-Ee),Ze=Sf(f,ve,ce,Ee*Ce);t.setCenter(Ze.wrap())}if(O){const me=l.G.number(oe,ue,Ee)+Di(0,t.center.lat);t.setZoom(me)}},isZooming:O,elevationCenter:se}}handleFlyTo(t,a){const c=a.zoom!==void 0,f=t.center,v=t.zoom,w=t.padding,E=!t.isPaddingEqual(a.padding),D=t.applyConstrain(l.V.convert(a.center||a.locationAtOffset),v).center,R=c?+a.zoom:t.zoom+Di(t.center.lat,D.lat),O=t.clone();O.setCenter(D),O.setZoom(R),O.setBearing(a.bearing);const U=new l.P(l.an(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),l.an(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));O.setLocationAtPoint(D,U);const j=O.center;gs(t,j);const H=(function(ce,_e,Ee){const me=mi(_e),Ce=mi(Ee),Ze=l.b5(me,Ce),je=Math.acos(Ze),qe=jr(ce);return je/(2*Math.PI)*qe})(t,f,j),K=v+Di(f.lat,0),se=R+Di(j.lat,0),le=l.aq(se-K);let oe;if(typeof a.minZoom=="number"){const ce=+a.minZoom+Di(j.lat,0),_e=Math.min(ce,K,se)+Di(0,j.lat),Ee=t.applyConstrain(j,_e).zoom+Di(j.lat,0);oe=l.aq(Ee-K)}const ue=l.bK(f.lng,j.lng),ve=l.bK(f.lat,j.lat);return{easeFunc:(ce,_e,Ee,me)=>{const Ce=Sf(f,ue,ve,Ee);E&&t.interpolatePadding(w,a.padding,ce);const Ze=ce===1?j:Ce;t.setCenter(Ze.wrap());const je=K+l.at(_e);t.setZoom(ce===1?R:je+Di(0,Ze.lat))},scaleOfZoom:le,targetCenter:j,scaleOfMinZoom:oe,pixelPathLength:H}}static solveVectorScale(t,a,c,f,v){const w=f==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],E=[c[3],c[7],c[11],c[15]],D=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],R=t[0]*E[0]+t[1]*E[1]+t[2]*E[2],O=a[0]*w[0]+a[1]*w[1]+a[2]*w[2],U=a[0]*E[0]+a[1]*E[1]+a[2]*E[2];return O+v*R===D+v*U||E[3]*(D-O)+w[3]*(U-R)+D*U==O*R?null:(O+w[3]-v*U-v*E[3])/(O-D-v*U+v*R)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class $l{constructor(t){this._globe=t,this._mercatorCameraHelper=new Qo,this._verticalPerspectiveCameraHelper=new Fi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,c){this.currentHelper.handleMapControlsPan(t,a,c)}cameraForBoxAndBearing(t,a,c,f,v){return this.currentHelper.cameraForBoxAndBearing(t,a,c,f,v)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const Xl=(y,t)=>l.B(y,t&&t.filter((a=>a.identifier!=="source.canvas"))),Yl=l.bO();class xo extends l.E{constructor(t,a={}){var c,f;super(),this._rtlPluginLoaded=()=>{for(const w in this.tileManagers){const E=this.tileManagers[w].getSource().type;E!=="vector"&&E!=="geojson"||this.tileManagers[w].reload()}},this.map=t,this.dispatcher=new wn(Kt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((w,E)=>this.getGlyphs(w,E))),this.dispatcher.registerMessageHandler("GI",((w,E)=>this.getImages(w,E))),this.dispatcher.registerMessageHandler("GDA",((w,E)=>this.getDashes(w,E))),this.imageManager=new Tt,this.imageManager.setEventedParent(this);const v=((c=t._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new Xe(t._requestManager,a.localIdeographFontFamily,v),this.lineAtlas=new bt(256,512),this.crossTileSymbolIndex=new ir,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bP()),Re().on(de,this._rtlPluginLoaded),this.on("data",(w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const E=this.tileManagers[w.sourceId];if(!E)return;const D=E.getSource();if(D&&D.vectorLayerIds)for(const R in this._layers){const O=this._layers[R];O.source===D.id&&this._validateLayer(O)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var c,f,v;this._checkLoaded();const w=a===null?(v=(f=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||f===void 0?void 0:f.default)!==null&&v!==void 0?v:null:a;if(l.bR(w,this._globalState[t]))return this;this._globalState[t]=w,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const c in t)!l.bR(this._globalState[c],t[c].default)&&(a.push(c),this._globalState[c]=t[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,c={};for(const f of t){c[f]=this._globalState[f];for(const v in this._layers){const w=this._layers[v],E=w.getLayoutAffectingGlobalStateRefs(),D=w.getPaintAffectingGlobalStateRefs(),R=w.getVisibilityAffectingGlobalStateRefs();if(E.has(f)&&a.add(w.source),D.has(f))for(const{name:O,value:U}of D.get(f))this._updatePaintProperty(w,O,U);R?.has(f)&&(w.recalculateVisibility(),this._updateLayer(w))}}this.dispatcher.broadcast("UGS",c);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const v=this._loadStyleRequest;l.j(f,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,a,c)})).catch((w=>{this._loadStyleRequest=null,w&&!v.signal.aborted&&this.fire(new l.k(w))}))}loadJSON(t,a={},c){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ae.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(Yl,{validate:!1})}_load(t,a,c){var f,v;let w=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!Xl(this,l.C(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(const E in w.sources)this.addSource(E,w.sources[E],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Bt(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new Ve(this.stylesheet.sky),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var t,a,c;const f=l.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",f),this._order=f.map((v=>v.id)),this._layers={},this._serializedLayers=null;for(const v of f){const w=l.bT(v,this._globalState);if(w.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=w,l.bU(w)&&this.tileManagers[w.source]){const E=(c=(a=v.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:w.paint.get("raster-fade-duration");this.tileManagers[w.source].setRasterFadeDuration(E)}}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1);const f=new AbortController;let v;this._spriteRequest=f,(function(w,E,D,R){return l._(this,void 0,void 0,(function*(){const O=rt(w),U=D>1?"@2x":"",j={},H={};for(const{id:K,url:se}of O){const le=E.transformRequest(nt(se,U,".json"),"SpriteJSON");j[K]=l.j(le,R);const oe=E.transformRequest(nt(se,U,".png"),"SpriteImage");H[K]=ot.getImage(oe,R)}return yield Promise.all([...Object.values(j),...Object.values(H)]),(function(K,se){return l._(this,void 0,void 0,(function*(){const le={};for(const oe in K){le[oe]={};const ue=Ae.getImageCanvasContext((yield se[oe]).data),ve=(yield K[oe]).data;for(const ce in ve){const{width:_e,height:Ee,x:me,y:Ce,sdf:Ze,pixelRatio:je,stretchX:qe,stretchY:Ge,content:St,textFitWidth:Et,textFitHeight:pt}=ve[ce];le[oe][ce]={data:null,pixelRatio:je,sdf:Ze,stretchX:qe,stretchY:Ge,content:St,textFitWidth:Et,textFitHeight:pt,spriteData:{width:_e,height:Ee,x:me,y:Ce,context:ue}}}}return le}))})(j,H)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((w=>{if(this._spriteRequest=null,w)for(const E in w){this._spritesImagesIds[E]=[];const D=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter((R=>!(R in w))):[];for(const R of D)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in w[E]){const O=E==="default"?R:`${E}:${R}`;this._spritesImagesIds[E].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,w[E][R],!1):this.imageManager.addImage(O,w[E][R]),a&&(this._changedImages[O]=!0)}}})).catch((w=>{this._spriteRequest=null,v=w,f.signal.aborted||this.fire(new l.k(v))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),c&&c(v)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.k(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?l.bV(c):c);const f=[];for(const v of t)if(c[v]){const w=a?l.bV(c[v]):c[v];f.push(w)}return f}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const f=this._layers[c];f.type!=="custom"&&(t[c]=f.serialize())}return t}hasTransitions(){var t,a,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(f.length||v.length)&&this._updateWorkerLayers(f,v);for(const w in this._updatedSources){const E=this._updatedSources[w];if(E==="reload")this._reloadSource(w);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const f in this.tileManagers){const v=this.tileManagers[f];c[f]=v.used,v.used=!1}for(const f of this._order){const v=this._layers[f];v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)&&v.source&&(this.tileManagers[v.source].used=!0)}for(const f in c){const v=this.tileManagers[f];!!c[f]!=!!v.used&&v.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var c;this._checkLoaded();const f=this.serialize();if(t=a.transformStyle?a.transformStyle(f,t):t,((c=a.validate)===null||c===void 0||c)&&Xl(this,l.C(t)))return!1;(t=l.bV(t)).layers=l.bS(t.layers);const v=l.bW(f,t),w=this._getOperationsToPerform(v);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const E of w.operations)E();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],c=[];for(const f of t)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(f.command)}return{operations:a,unimplemented:c}}addImage(t,a){if(this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(l.C.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[t]=new Tn(t,a,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:t}))),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.tileManagers[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new l.k(new Error(`Layer "${f}" already exists on this map.`)));let v;if(t.type==="custom"){if(Xl(this,l.bX(t)))return;v=l.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(f,t.source),t=l.bV(t),t=l.e(t,{source:f})),this._validate(l.C.layer,`layers.${f}`,t,{arrayIndex:-1},c))return;v=l.bT(t,this._globalState),this._validateLayer(v),v.setEventedParent(this,{layer:{id:f}})}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)this.fire(new l.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(w,0,f),this._layerOrderChanged=!0,this._layers[f]=v,this._removedLayers[f]&&v.source&&v.type!=="custom"){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.tileManagers[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new l.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===a&&f.maxzoom===c||(a!=null&&(f.minzoom=a),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!l.bR(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(l.C.filter,`layers.${f.id}.filter`,a,null,c)||(f.setFilter(l.bV(a)),this._updateLayer(f)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.bV(this.getLayer(t).filter)}setLayoutProperty(t,a,c,f={}){this._checkLoaded();const v=this.getLayer(t);v?l.bR(v.getLayoutProperty(a),c)||(v.setLayoutProperty(a,c,f),this._updateLayer(v)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,f={}){this._checkLoaded();const v=this.getLayer(t);v?l.bR(v.getPaintProperty(a),c)||this._updatePaintProperty(v,a,c,f):this.fire(new l.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,c,f={}){t.setPaintProperty(a,c,f)&&this._updateLayer(t),l.bU(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,f=t.sourceLayer,v=this.tileManagers[c];if(v===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&f?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||f?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),v.setFeatureState(f,t.id,a)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,f=this.tileManagers[c];if(f===void 0)return void this.fire(new l.k(new Error(`The source '${c}' does not exist in the map's style.`)));const v=f.getSource().type,w=v==="vector"?t.sourceLayer:void 0;v!=="vector"||w?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(w,t.id,a):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,t.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.bY(this.tileManagers,(v=>v.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,f=this.stylesheet;return l.bZ({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:t,layers:a,terrain:c},(v=>v!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",c={},f=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E)){c[E]=w;for(const D of t){const R=D[E];if(R)for(const O of R)f.push(O)}}}f.sort(((w,E)=>E.intersectionZ-w.intersectionZ));const v=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E))for(let D=f.length-1;D>=0;D--){const R=f[D].feature;if(c[R.layer.id]<w)break;v.push(R),f.pop()}else for(const D of t){const R=D[E];if(R)for(const O of R)v.push(O.feature)}}return v}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(l.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const R of a.layers){const O=this._layers[R];if(!O)return this.fire(new l.k(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];f[O.source]=!0}}const v=[];a.availableImages=this._availableImages;const w=this._serializedAllLayers(),E=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,D=Object.assign(Object.assign({},a),{layers:E,globalState:this._globalState});for(const R in this.tileManagers)a.layers&&!f[R]||v.push(lr(this.tileManagers[R],this._layers,w,t,D,c,this.map.terrain?(O,U,j)=>this.map.terrain.getElevation(O,U,j):void 0));return this.placement&&v.push((function(R,O,U,j,H,K,se){const le={},oe=K.queryRenderedSymbols(j),ue=[];for(const ve of Object.keys(oe).map(Number))ue.push(se[ve]);ue.sort(Dn);for(const ve of ue){const ce=ve.featureIndex.lookupSymbolFeatures(oe[ve.bucketInstanceId],O,ve.bucketIndex,ve.sourceLayerIndex,{filterSpec:H.filter,globalState:H.globalState},H.layers,H.availableImages,R);for(const _e in ce){const Ee=le[_e]=le[_e]||[],me=ce[_e];me.sort(((Ce,Ze)=>{const je=ve.featureSortOrder;if(je){const qe=je.indexOf(Ce.featureIndex);return je.indexOf(Ze.featureIndex)-qe}return Ze.featureIndex-Ce.featureIndex}));for(const Ce of me)Ee.push(Ce)}}return(function(ve,ce,_e){for(const Ee in ve)for(const me of ve[Ee])Bi(me,_e[ce[Ee].source]);return ve})(le,R,U)})(this._layers,w,this.tileManagers,t,D,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,a){a?.filter&&this._validate(l.C.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.tileManagers[t];return c?(function(f,v){const w=f.getRenderableIds().map((R=>f.getTileByID(R))),E=[],D={};for(let R=0;R<w.length;R++){const O=w[R],U=O.tileID.canonical.key;D[U]||(D[U]=!0,O.querySourceFeatures(E,v))}return E})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const v={now:pe(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(v)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const c=this.getSky();let f=!1;if(!t&&!c)return;if(t&&!c)f=!0;else if(!t&&c)f=!0;else for(const w in t)if(!l.bR(t[w],c[w])){f=!0;break}if(!f)return;const v={now:pe(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(v)}_setProjectionInternal(t){const a=(function(c,f){const v={constrainOverride:f};if(Array.isArray(c)){const w=new ed({type:c});return{projection:w,transform:new Hl(v),cameraHelper:new $l(w)}}switch(c){case"mercator":return{projection:new rr,transform:new Qi(v),cameraHelper:new Qo};case"globe":{const w=new ed({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:w,transform:new Hl(v),cameraHelper:new $l(w)}}case"vertical-perspective":return{projection:new Jh,transform:new Zl(v),cameraHelper:new Fi};default:return l.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new rr,transform:new Qi(v),cameraHelper:new Qo}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(t,a,c,f,v={}){return(!v||v.validate!==!1)&&Xl(this,t.call(l.C,l.e({key:a,style:this.serialize(),value:c,styleSpec:l.u},f)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Re().off(de,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,c,f,v=!1){let w=!1,E=!1;const D={};for(const R of this._order){const O=this._layers[R];if(O.type!=="symbol")continue;if(!D[O.source]){const j=this.tileManagers[O.source];D[O.source]=j.getRenderableIds(!0).map((H=>j.getTileByID(H))).sort(((H,K)=>K.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(K.tileID)?-1:1)))}const U=this.crossTileSymbolIndex.addLayer(O,D[O.source],t.center.lng);w=w||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(pe(),t.zoom))&&(this.pauseablePlacement=new Vl(t,this.map.terrain,this._order,v,a,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(pe()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w)for(const R of this._order){const O=this._layers[R];O.type==="symbol"&&this.placement.updateLayerOpacities(O,D[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(pe())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(t,a){return l._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(l.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return l._(this,void 0,void 0,(function*(){const c={};for(const[f,v]of Object.entries(a.dashes))c[f]=this.lineAtlas.getDash(v.dasharray,v.round);return c}))}addSprite(t,a,c={},f){this._checkLoaded();const v=[{id:t,url:a}],w=[...rt(this.stylesheet.sprite),...v];this._validate(l.C.sprite,"sprite",w,null,c)||(this.stylesheet.sprite=w,this._loadSprite(v,!0,f))}removeSprite(t){this._checkLoaded();const a=rt(this.stylesheet.sprite);if(a.find((c=>c.id===t))){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return rt(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(l.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Ef=l.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Zc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,f,v,w,E,D,R){this.context=t;let O=this.boundPaintVertexBuffers.length!==f.length;for(let U=0;!O&&U<f.length;U++)this.boundPaintVertexBuffers[U]!==f[U]&&(O=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||O||this.boundIndexBuffer!==v||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==R?this.freshBind(a,c,f,v,w,E,D,R):(t.bindVertexArray.set(this.vao),E&&E.bind(),v&&v.dynamicDraw&&v.bind(),D&&D.bind(),R&&R.bind())}freshBind(t,a,c,f,v,w,E,D){const R=t.numAttributes,O=this.context,U=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=D,a.enableAttributes(U,t);for(const j of c)j.enableAttributes(U,t);w&&w.enableAttributes(U,t),E&&E.enableAttributes(U,t),D&&D.enableAttributes(U,t),a.bind(),a.setVertexAttribPointers(U,t,v);for(const j of c)j.bind(),j.setVertexAttribPointers(U,t,v);w&&(w.bind(),w.setVertexAttribPointers(U,t,v)),f&&f.bind(),E&&(E.bind(),E.setVertexAttribPointers(U,t,v)),D&&(D.bind(),D.setVertexAttribPointers(U,t,v)),O.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Mf=(y,t,a,c,f)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):l.bp.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):l.bp.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),Ya={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function $u(y){const t=[];for(let a=0;a<y.length;a++){if(y[a]===null)continue;const c=y[a].split(" ");t.push(c.pop())}return t}class Af{constructor(t,a,c,f,v,w,E,D,R=[]){const O=t.gl;this.program=O.createProgram();const U=$u(a.staticAttributes),j=c?c.getBinderAttributes():[],H=U.concat(j),K=fi.prelude.staticUniforms?$u(fi.prelude.staticUniforms):[],se=E.staticUniforms?$u(E.staticUniforms):[],le=a.staticUniforms?$u(a.staticUniforms):[],oe=c?c.getBinderUniforms():[],ue=K.concat(se).concat(le).concat(oe),ve=[];for(const je of ue)ve.indexOf(je)<0&&ve.push(je);const ce=c?c.defines():[];Aa(O)&&ce.unshift("#version 300 es"),v&&ce.push("#define OVERDRAW_INSPECTOR;"),w&&ce.push("#define TERRAIN3D;"),D&&ce.push(D),R&&ce.push(...R);let _e=ce.concat(fi.prelude.fragmentSource,E.fragmentSource,a.fragmentSource).join(`
`),Ee=ce.concat(fi.prelude.vertexSource,E.vertexSource,a.vertexSource).join(`
`);Aa(O)||(_e=(function(je){return je.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(_e),Ee=(function(je){return je.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ee));const me=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(me,_e),O.compileShader(me),!O.getShaderParameter(me,O.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${O.getShaderInfoLog(me)}`);O.attachShader(this.program,me);const Ce=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);if(O.shaderSource(Ce,Ee),O.compileShader(Ce),!O.getShaderParameter(Ce,O.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${O.getShaderInfoLog(Ce)}`);O.attachShader(this.program,Ce),this.attributes={};const Ze={};this.numAttributes=H.length;for(let je=0;je<this.numAttributes;je++)H[je]&&(O.bindAttribLocation(this.program,je,H[je]),this.attributes[H[je]]=je);if(O.linkProgram(this.program),!O.getProgramParameter(this.program,O.LINK_STATUS))throw new Error(`Program failed to link: ${O.getProgramInfoLog(this.program)}`);O.deleteShader(Ce),O.deleteShader(me);for(let je=0;je<ve.length;je++){const qe=ve[je];if(qe&&!Ze[qe]){const Ge=O.getUniformLocation(this.program,qe);Ge&&(Ze[qe]=Ge)}}this.fixedUniforms=f(t,Ze),this.terrainUniforms=((je,qe)=>({u_depth:new l.b_(je,qe.u_depth),u_terrain:new l.b_(je,qe.u_terrain),u_terrain_dim:new l.bq(je,qe.u_terrain_dim),u_terrain_matrix:new l.c0(je,qe.u_terrain_matrix),u_terrain_unpack:new l.c1(je,qe.u_terrain_unpack),u_terrain_exaggeration:new l.bq(je,qe.u_terrain_exaggeration)}))(t,Ze),this.projectionUniforms=((je,qe)=>({u_projection_matrix:new l.c0(je,qe.u_projection_matrix),u_projection_tile_mercator_coords:new l.c1(je,qe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.c1(je,qe.u_projection_clipping_plane),u_projection_transition:new l.bq(je,qe.u_projection_transition),u_projection_fallback_matrix:new l.c0(je,qe.u_projection_fallback_matrix)}))(t,Ze),this.binderUniforms=c?c.getUniforms(t,Ze):[]}draw(t,a,c,f,v,w,E,D,R,O,U,j,H,K,se,le,oe,ue,ve){const ce=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(f),t.setColorMode(v),t.setCullFace(w),D){t.activeTexture.set(ce.TEXTURE2),ce.bindTexture(ce.TEXTURE_2D,D.depthTexture),t.activeTexture.set(ce.TEXTURE3),ce.bindTexture(ce.TEXTURE_2D,D.texture);for(const Ee in this.terrainUniforms)this.terrainUniforms[Ee].set(D[Ee])}if(R)for(const Ee in R)this.projectionUniforms[Ya[Ee]].set(R[Ee]);if(E)for(const Ee in this.fixedUniforms)this.fixedUniforms[Ee].set(E[Ee]);le&&le.setUniforms(t,this.binderUniforms,K,{zoom:se});let _e=0;switch(a){case ce.LINES:_e=2;break;case ce.TRIANGLES:_e=3;break;case ce.LINE_STRIP:_e=1}for(const Ee of H.get()){const me=Ee.vaos||(Ee.vaos={});(me[O]||(me[O]=new Zc)).bind(t,this,U,le?le.getPaintVertexBuffers():[],j,Ee.vertexOffset,oe,ue,ve),ce.drawElements(a,Ee.primitiveLength*_e,ce.UNSIGNED_SHORT,Ee.primitiveOffset*_e*2)}}}function Cf(y,t,a){const c=1/l.aN(a,1,t.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),v=a.tileSize*Math.pow(2,t.transform.tileZoom)/f,w=v*(a.tileID.canonical.x+a.tileID.wrap*f),E=v*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const Xu=(y,t,a,c)=>{const f=y.style.light,v=f.properties.get("position"),w=[v.x,v.y,v.z],E=l.c4();f.properties.get("anchor")==="viewport"&&l.c5(E,y.transform.bearingInRadians),l.c6(w,w,E);const D=y.transform.transformLightDirection(w),R=f.properties.get("color");return{u_lightpos:w,u_lightpos_globe:D,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:c}},Yu=(y,t,a,c,f,v,w)=>l.e(Xu(y,t,a,c),Cf(v,y,w),{u_height_factor:-Math.pow(2,f.overscaledZ)/w.tileSize/8}),tl=(y,t,a,c)=>l.e(Cf(t,y,a),{u_fill_translate:c}),Wl=(y,t)=>({u_world:y,u_fill_translate:t}),zf=(y,t,a,c,f)=>l.e(tl(y,t,a,f),{u_world:c}),Hc=(y,t,a,c,f)=>{const v=y.transform;let w,E,D=0;if(a.paint.get("circle-pitch-alignment")==="map"){const R=l.aN(t,1,v.zoom);w=!0,E=[R,R],D=R/(l.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*f}else w=!1,E=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+w,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E,u_globe_extrude_scale:D,u_translate:c}},bo=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),nd=y=>({u_viewport_size:[y.width,y.height]}),$c=(y,t=1)=>({u_color:y,u_overlay:0,u_overlay_scale:t}),wo=(y,t,a,c)=>{const f=l.aN(y,1,t)/(l.a5*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:l.aN(y,1,t),u_intensity:a,u_globe_extrude_scale:f}},id=(y,t,a,c)=>{const f=l.N();l.c7(f,0,y.width,y.height,0,0,1);const v=y.context.gl;return{u_matrix:f,u_world:[v.drawingBufferWidth,v.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},Xc=(y,t,a)=>{const c=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const v=a.getIlluminationProperties();for(let w=0;w<v.directionRadians.length;w++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(v.directionRadians[w]+=y.transform.bearingInRadians);return{u_image:0,u_latrange:Jp(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:v.altitudeRadians,u_azimuths:v.directionRadians,u_accent:c,u_method:f,u_highlights:v.highlightColor,u_shadows:v.shadowColor}},Df=(y,t)=>{const a=t.stride,c=l.N();return l.c7(c,0,l.a5,-l.a5,0,0,1),l.O(c,c,[0,-l.a5,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:y.overscaledZ,u_unpack:t.getUnpackVector()}};function Jp(y,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.a9(0,c/a).toLngLat().lat,new l.a9(0,(c+1)/a).toLngLat().lat]}const Pf=(y,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:y.paint.get("color-relief-opacity")}),Yc=(y,t,a,c)=>{const f=y.transform;return{u_translation:Wc(y,t,a),u_ratio:c/l.aN(t,1,f.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},If=(y,t,a,c,f)=>l.e(Yc(y,t,a,c),{u_image:0,u_image_height:f}),rd=(y,t,a,c,f)=>{const v=y.transform,w=Ca(t,v);return{u_translation:Wc(y,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:c/l.aN(t,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[w,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Zr=(y,t,a,c,f)=>{const v=Ca(t,y.transform);return l.e(Yc(y,t,a,c),{u_tileratio:v,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})},To=(y,t,a,c,f,v)=>{const w=Ca(t,y.transform);return l.e(Yc(y,t,a,c),{u_image:0,u_image_height:v,u_tileratio:w,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:y.lineAtlas.width,u_lineatlas_height:y.lineAtlas.height})};function Ca(y,t){return 1/l.aN(y,1,t.tileZoom)}function Wc(y,t,a){return l.aO(y.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Wu=(y,t,a,c,f)=>{return{u_tl_parent:y,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(w=c.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=c.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ku(c.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var v,w};function Ku(y){y*=Math.PI/180;const t=Math.sin(y),a=Math.cos(y);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Kc=(y,t,a,c,f,v,w,E,D,R,O,U,j)=>{const H=w.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:H.width/H.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_label_plane_matrix:E,u_coord_matrix:D,u_is_text:+O,u_pitch_with_map:+c,u_is_along_line:f,u_is_variable_anchor:v,u_texsize:U,u_texture:0,u_translation:R,u_pitched_scale:j}},Qu=(y,t,a,c,f,v,w,E,D,R,O,U,j,H)=>{const K=w.transform;return l.e(Kc(y,t,a,c,f,v,w,E,D,R,O,U,H),{u_gamma_scale:c?Math.cos(K.pitch*Math.PI/180)*K.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},za=(y,t,a,c,f,v,w,E,D,R,O,U,j)=>l.e(Qu(y,t,a,c,f,v,w,E,D,R,!0,O,0,j),{u_texsize_icon:U,u_texture_icon:1}),Qc=(y,t)=>({u_opacity:y,u_color:t}),Jc=(y,t,a,c,f)=>l.e((function(v,w,E,D){const R=E.imageManager.getPattern(v.from.toString()),O=E.imageManager.getPattern(v.to.toString()),{width:U,height:j}=E.imageManager.getPixelSize(),H=Math.pow(2,D.tileID.overscaledZ),K=D.tileSize*Math.pow(2,E.transform.tileZoom)/H,se=K*(D.tileID.canonical.x+D.tileID.wrap*H),le=K*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[U,j],u_mix:w.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/l.aN(D,1,E.transform.tileZoom),u_pixel_coord_upper:[se>>16,le>>16],u_pixel_coord_lower:[65535&se,65535&le]}})(a,f,t,c),{u_opacity:y}),Ju=(y,t)=>{},kf={fillExtrusion:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillExtrusionPattern:(y,t)=>({u_lightpos:new l.c2(y,t.u_lightpos),u_lightpos_globe:new l.c2(y,t.u_lightpos_globe),u_lightintensity:new l.bq(y,t.u_lightintensity),u_lightcolor:new l.c2(y,t.u_lightcolor),u_vertical_gradient:new l.bq(y,t.u_vertical_gradient),u_height_factor:new l.bq(y,t.u_height_factor),u_opacity:new l.bq(y,t.u_opacity),u_fill_translate:new l.c3(y,t.u_fill_translate),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),fill:(y,t)=>({u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillPattern:(y,t)=>({u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutline:(y,t)=>({u_world:new l.c3(y,t.u_world),u_fill_translate:new l.c3(y,t.u_fill_translate)}),fillOutlinePattern:(y,t)=>({u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_texsize:new l.c3(y,t.u_texsize),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade),u_fill_translate:new l.c3(y,t.u_fill_translate)}),circle:(y,t)=>({u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_scale_with_map:new l.b_(y,t.u_scale_with_map),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_extrude_scale:new l.c3(y,t.u_extrude_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale),u_translate:new l.c3(y,t.u_translate)}),collisionBox:(y,t)=>({u_pixel_extrude_scale:new l.c3(y,t.u_pixel_extrude_scale)}),collisionCircle:(y,t)=>({u_viewport_size:new l.c3(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new l.b$(y,t.u_color),u_overlay:new l.b_(y,t.u_overlay),u_overlay_scale:new l.bq(y,t.u_overlay_scale)}),depth:Ju,clippingMask:Ju,heatmap:(y,t)=>({u_extrude_scale:new l.bq(y,t.u_extrude_scale),u_intensity:new l.bq(y,t.u_intensity),u_globe_extrude_scale:new l.bq(y,t.u_globe_extrude_scale)}),heatmapTexture:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_world:new l.c3(y,t.u_world),u_image:new l.b_(y,t.u_image),u_color_ramp:new l.b_(y,t.u_color_ramp),u_opacity:new l.bq(y,t.u_opacity)}),hillshade:(y,t)=>({u_image:new l.b_(y,t.u_image),u_latrange:new l.c3(y,t.u_latrange),u_exaggeration:new l.bq(y,t.u_exaggeration),u_altitudes:new l.c9(y,t.u_altitudes),u_azimuths:new l.c9(y,t.u_azimuths),u_accent:new l.b$(y,t.u_accent),u_method:new l.b_(y,t.u_method),u_shadows:new l.c8(y,t.u_shadows),u_highlights:new l.c8(y,t.u_highlights)}),hillshadePrepare:(y,t)=>({u_matrix:new l.c0(y,t.u_matrix),u_image:new l.b_(y,t.u_image),u_dimension:new l.c3(y,t.u_dimension),u_zoom:new l.bq(y,t.u_zoom),u_unpack:new l.c1(y,t.u_unpack)}),colorRelief:(y,t)=>({u_image:new l.b_(y,t.u_image),u_unpack:new l.c1(y,t.u_unpack),u_dimension:new l.c3(y,t.u_dimension),u_elevation_stops:new l.b_(y,t.u_elevation_stops),u_color_stops:new l.b_(y,t.u_color_stops),u_color_ramp_size:new l.b_(y,t.u_color_ramp_size),u_opacity:new l.bq(y,t.u_opacity)}),line:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height)}),linePattern:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_texsize:new l.c3(y,t.u_texsize),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_image:new l.b_(y,t.u_image),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_scale:new l.c2(y,t.u_scale),u_fade:new l.bq(y,t.u_fade)}),lineSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_mix:new l.bq(y,t.u_mix),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),lineGradientSDF:(y,t)=>({u_translation:new l.c3(y,t.u_translation),u_ratio:new l.bq(y,t.u_ratio),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_units_to_pixels:new l.c3(y,t.u_units_to_pixels),u_image:new l.b_(y,t.u_image),u_image_height:new l.bq(y,t.u_image_height),u_tileratio:new l.bq(y,t.u_tileratio),u_crossfade_from:new l.bq(y,t.u_crossfade_from),u_crossfade_to:new l.bq(y,t.u_crossfade_to),u_image_dash:new l.b_(y,t.u_image_dash),u_mix:new l.bq(y,t.u_mix),u_lineatlas_width:new l.bq(y,t.u_lineatlas_width),u_lineatlas_height:new l.bq(y,t.u_lineatlas_height)}),raster:(y,t)=>({u_tl_parent:new l.c3(y,t.u_tl_parent),u_scale_parent:new l.bq(y,t.u_scale_parent),u_buffer_scale:new l.bq(y,t.u_buffer_scale),u_fade_t:new l.bq(y,t.u_fade_t),u_opacity:new l.bq(y,t.u_opacity),u_image0:new l.b_(y,t.u_image0),u_image1:new l.b_(y,t.u_image1),u_brightness_low:new l.bq(y,t.u_brightness_low),u_brightness_high:new l.bq(y,t.u_brightness_high),u_saturation_factor:new l.bq(y,t.u_saturation_factor),u_contrast_factor:new l.bq(y,t.u_contrast_factor),u_spin_weights:new l.c2(y,t.u_spin_weights),u_coords_top:new l.c1(y,t.u_coords_top),u_coords_bottom:new l.c1(y,t.u_coords_bottom)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texture:new l.b_(y,t.u_texture),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new l.b_(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(y,t.u_is_size_feature_constant),u_size_t:new l.bq(y,t.u_size_t),u_size:new l.bq(y,t.u_size),u_camera_to_center_distance:new l.bq(y,t.u_camera_to_center_distance),u_pitch:new l.bq(y,t.u_pitch),u_rotate_symbol:new l.b_(y,t.u_rotate_symbol),u_aspect_ratio:new l.bq(y,t.u_aspect_ratio),u_fade_change:new l.bq(y,t.u_fade_change),u_label_plane_matrix:new l.c0(y,t.u_label_plane_matrix),u_coord_matrix:new l.c0(y,t.u_coord_matrix),u_is_text:new l.b_(y,t.u_is_text),u_pitch_with_map:new l.b_(y,t.u_pitch_with_map),u_is_along_line:new l.b_(y,t.u_is_along_line),u_is_variable_anchor:new l.b_(y,t.u_is_variable_anchor),u_texsize:new l.c3(y,t.u_texsize),u_texsize_icon:new l.c3(y,t.u_texsize_icon),u_texture:new l.b_(y,t.u_texture),u_texture_icon:new l.b_(y,t.u_texture_icon),u_gamma_scale:new l.bq(y,t.u_gamma_scale),u_device_pixel_ratio:new l.bq(y,t.u_device_pixel_ratio),u_is_halo:new l.b_(y,t.u_is_halo),u_translation:new l.c3(y,t.u_translation),u_pitched_scale:new l.bq(y,t.u_pitched_scale)}),background:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_color:new l.b$(y,t.u_color)}),backgroundPattern:(y,t)=>({u_opacity:new l.bq(y,t.u_opacity),u_image:new l.b_(y,t.u_image),u_pattern_tl_a:new l.c3(y,t.u_pattern_tl_a),u_pattern_br_a:new l.c3(y,t.u_pattern_br_a),u_pattern_tl_b:new l.c3(y,t.u_pattern_tl_b),u_pattern_br_b:new l.c3(y,t.u_pattern_br_b),u_texsize:new l.c3(y,t.u_texsize),u_mix:new l.bq(y,t.u_mix),u_pattern_size_a:new l.c3(y,t.u_pattern_size_a),u_pattern_size_b:new l.c3(y,t.u_pattern_size_b),u_scale_a:new l.bq(y,t.u_scale_a),u_scale_b:new l.bq(y,t.u_scale_b),u_pixel_coord_upper:new l.c3(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bq(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_ele_delta:new l.bq(y,t.u_ele_delta),u_fog_matrix:new l.c0(y,t.u_fog_matrix),u_fog_color:new l.b$(y,t.u_fog_color),u_fog_ground_blend:new l.bq(y,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bq(y,t.u_fog_ground_blend_opacity),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon_fog_blend:new l.bq(y,t.u_horizon_fog_blend),u_is_globe_mode:new l.bq(y,t.u_is_globe_mode)}),terrainDepth:(y,t)=>({u_ele_delta:new l.bq(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_texture:new l.b_(y,t.u_texture),u_terrain_coords_id:new l.bq(y,t.u_terrain_coords_id),u_ele_delta:new l.bq(y,t.u_ele_delta)}),projectionErrorMeasurement:(y,t)=>({u_input:new l.bq(y,t.u_input),u_output_expected:new l.bq(y,t.u_output_expected)}),atmosphere:(y,t)=>({u_sun_pos:new l.c2(y,t.u_sun_pos),u_atmosphere_blend:new l.bq(y,t.u_atmosphere_blend),u_globe_position:new l.c2(y,t.u_globe_position),u_globe_radius:new l.bq(y,t.u_globe_radius),u_inv_proj_matrix:new l.c0(y,t.u_inv_proj_matrix)}),sky:(y,t)=>({u_sky_color:new l.b$(y,t.u_sky_color),u_horizon_color:new l.b$(y,t.u_horizon_color),u_horizon:new l.c3(y,t.u_horizon),u_horizon_normal:new l.c3(y,t.u_horizon_normal),u_sky_horizon_blend:new l.bq(y,t.u_sky_horizon_blend),u_sky_blend:new l.bq(y,t.u_sky_blend)})};class nl{constructor(t,a,c){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const il={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ad{constructor(t,a,c,f){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const f=a.attributes[this.attributes[c].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,a,c){for(let f=0;f<this.attributes.length;f++){const v=this.attributes[f],w=a.attributes[v.name];w!==void 0&&t.vertexAttribPointer(w,v.components,t[il[v.type]],!1,this.itemSize,v.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Rn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _s extends Rn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class eu extends Rn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class tu extends Rn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class eh extends Rn{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class rl extends Rn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class nu extends Rn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Kl extends Rn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ca extends Rn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class sd extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class th extends Rn{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ua extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class vs extends Rn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ur extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Gs extends Rn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class al extends Rn{getDefault(){return l.bp.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sl extends Rn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class iu extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class So extends Rn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Da extends Rn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class od extends Rn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ql extends Rn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class cn extends Rn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class nh extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ha extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ih extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class da extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rf extends Rn{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class rh extends Rn{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Aa(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Eo extends Rn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ld extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ah extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Mo extends Rn{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Jl extends Mo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Vr extends Mo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ao extends Mo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Co="Framebuffer is not complete";class ol{constructor(t,a,c,f,v){this.context=t,this.width=a,this.height=c;const w=t.gl,E=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Jl(t,E),f)this.depthAttachment=v?new Ao(t,E):new Vr(t,E);else if(v)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error(Co)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class zo{constructor(t){var a,c;if(this.gl=t,this.clearColor=new _s(this),this.clearDepth=new eu(this),this.clearStencil=new tu(this),this.colorMask=new eh(this),this.depthMask=new rl(this),this.stencilMask=new nu(this),this.stencilFunc=new Kl(this),this.stencilOp=new ca(this),this.stencilTest=new sd(this),this.depthRange=new th(this),this.depthTest=new ua(this),this.depthFunc=new vs(this),this.blend=new Ur(this),this.blendFunc=new Gs(this),this.blendColor=new al(this),this.blendEquation=new sl(this),this.cullFace=new iu(this),this.cullFaceSide=new So(this),this.frontFace=new Da(this),this.program=new od(this),this.activeTexture=new Ql(this),this.viewport=new cn(this),this.bindFramebuffer=new nh(this),this.bindRenderbuffer=new ha(this),this.bindTexture=new ih(this),this.bindVertexBuffer=new da(this),this.bindElementBuffer=new Rf(this),this.bindVertexArray=new rh(this),this.pixelStoreUnpack=new Eo(this),this.pixelStoreUnpackPremultiplyAlpha=new ld(this),this.pixelStoreUnpackFlipY=new ah(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Aa(t)){this.HALF_FLOAT=t.HALF_FLOAT;const f=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:f?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const f=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new nl(this,t,a)}createVertexBuffer(t,a,c){return new ad(this,t,a,c)}createRenderbuffer(t,a,c){const f=this.gl,v=f.createRenderbuffer();return this.bindRenderbuffer.set(v),f.renderbufferStorage(f.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),v}createFramebuffer(t,a,c,f){return new ol(this,t,a,c,f)}clear({color:t,depth:a,stencil:c}){const f=this.gl;let v=0;t&&(v|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(v|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(v|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.bR(t.blendFunction,Hn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Aa(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Aa(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let ar;function cr(y,t,a,c,f){const v=y.context,w=y.transform,E=v.gl,D=y.useProgram("collisionBox"),R=[];let O=0,U=0;for(let oe=0;oe<c.length;oe++){const ue=c[oe],ve=t.getTile(ue).getBucket(a);if(!ve)continue;const ce=f?ve.textCollisionBox:ve.iconCollisionBox,_e=ve.collisionCircleArray;_e.length>0&&(R.push({circleArray:_e,circleOffset:U,coord:ue}),O+=_e.length/4,U=O),ce&&D.draw(v,E.LINES,on.disabled,En.disabled,y.colorModeForRenderPass(),gn.disabled,bo(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(ue),w.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,null,y.transform.zoom,null,null,ce.collisionVertexBuffer)}if(!f||!R.length)return;const j=y.useProgram("collisionCircle"),H=new l.ca;H.resize(4*O),H._trim();let K=0;for(const oe of R)for(let ue=0;ue<oe.circleArray.length/4;ue++){const ve=4*ue,ce=oe.circleArray[ve+0],_e=oe.circleArray[ve+1],Ee=oe.circleArray[ve+2],me=oe.circleArray[ve+3];H.emplace(K++,ce,_e,Ee,me,0),H.emplace(K++,ce,_e,Ee,me,1),H.emplace(K++,ce,_e,Ee,me,2),H.emplace(K++,ce,_e,Ee,me,3)}(!ar||ar.length<2*O)&&(ar=(function(oe){const ue=2*oe,ve=new l.cc;ve.resize(ue),ve._trim();for(let ce=0;ce<ue;ce++){const _e=6*ce;ve.uint16[_e+0]=4*ce+0,ve.uint16[_e+1]=4*ce+1,ve.uint16[_e+2]=4*ce+2,ve.uint16[_e+3]=4*ce+2,ve.uint16[_e+4]=4*ce+3,ve.uint16[_e+5]=4*ce+0}return ve})(O));const se=v.createIndexBuffer(ar,!0),le=v.createVertexBuffer(H,l.cb.members,!0);for(const oe of R){const ue=nd(y.transform);j.draw(v,E.TRIANGLES,on.disabled,En.disabled,y.colorModeForRenderPass(),gn.disabled,ue,y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe.coord),null,a.id,le,se,l.aX.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,y.transform.zoom,null,null,null)}le.destroy(),se.destroy()}const xs=l.ar(new Float32Array(16));function bs(y,t,a,c,f,v){const{horizontalAlign:w,verticalAlign:E}=l.aS(y);return new l.P((-(w-.5)*t/f+c[0])*v,(-(E-.5)*a/f+c[1])*v)}function Hr(y,t,a,c,f,v){const w=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let E=c.mult(v);a||(E=E.rotate(-f));const D=w.add(E);return sn(D.x,D.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const E=Sn(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(y),D=Math.atan(E.y/E.x)+(E.x<0?Math.PI:0);return y.add(c.rotate(D))}return y.add(c)}function Zs(y,t,a,c,f,v,w,E,D,R,O,U){const j=y.text.placedSymbolArray,H=y.text.dynamicLayoutVertexArray,K=y.icon.dynamicLayoutVertexArray,se={};H.clear();for(let le=0;le<j.length;le++){const oe=j.get(le),ue=oe.hidden||!oe.crossTileID||y.allowVerticalPlacement&&!oe.placedOrientation?null:c[oe.crossTileID];if(ue){const ve=new l.P(oe.anchorX,oe.anchorY),ce={getElevation:U,width:f.width,height:f.height,pitchedLabelPlaneMatrix:v,pitchWithMap:a,transform:f,tileAnchorPoint:ve,translation:R,unwrappedTileID:O},_e=a?Fl(ve.x,ve.y,ce):Sn(ve.x,ve.y,ce),Ee=Ho(f.cameraToCenterDistance,_e.signedDistanceFromCamera);let me=l.aA(y.textSizeData,E,oe)*Ee/l.aM;a&&(me*=y.tilePixelRatio/w);const{width:Ce,height:Ze,anchor:je,textOffset:qe,textBoxScale:Ge}=ue,St=bs(je,Ce,Ze,qe,Ge,me),Et=f.getPitchedTextCorrection(ve.x+R[0],ve.y+R[1],O),pt=Hr(_e.point,ce,t,St,-f.bearingInRadians,Et),At=y.allowVerticalPlacement&&oe.placedOrientation===l.az.vertical?Math.PI/2:0;for(let an=0;an<oe.numGlyphs;an++)l.aG(H,pt,At);D&&oe.associatedIconIndex>=0&&(se[oe.associatedIconIndex]={shiftedAnchor:pt,angle:At})}else ms(oe.numGlyphs,H)}if(D){K.clear();const le=y.icon.placedSymbolArray;for(let oe=0;oe<le.length;oe++){const ue=le.get(oe);if(ue.hidden)ms(ue.numGlyphs,K);else{const ve=se[oe];if(ve)for(let ce=0;ce<ue.numGlyphs;ce++)l.aG(K,ve.shiftedAnchor,ve.angle);else ms(ue.numGlyphs,K)}}y.icon.dynamicLayoutVertexBuffer.updateData(K)}y.text.dynamicLayoutVertexBuffer.updateData(H)}function cd(y,t,a){return a.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function ll(y,t,a,c,f,v,w,E,D,R,O,U,j){const H=y.context,K=H.gl,se=y.transform,le=E==="map",oe=D==="map",ue=E!=="viewport"&&a.layout.get("symbol-placement")!=="point",ve=le&&!oe&&!ue,ce=!a.layout.get("symbol-sort-key").isConstant();let _e=!1;const Ee=y.getDepthModeForSublayer(0,on.ReadOnly),me=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ce=[],Ze=se.getCircleRadiusCorrection();for(const je of c){const qe=t.getTile(je),Ge=qe.getBucket(a);if(!Ge)continue;const St=f?Ge.text:Ge.icon;if(!St||!St.segments.get().length||!St.hasVisibleVertices)continue;const Et=St.programConfigurations.get(a.id),pt=f||Ge.sdfIcons,At=f?Ge.textSizeData:Ge.iconSizeData,an=oe||se.pitch!==0,jn=y.useProgram(cd(pt,f,Ge),Et),ri=l.ay(At,se.zoom),ei=y.style.map.terrain&&y.style.map.terrain.getTerrainData(je);let ui,$n,Ti,hi,hr=[0,0],Ii=null;if(f)$n=qe.glyphAtlasTexture,Ti=K.LINEAR,ui=qe.glyphAtlasTexture.size,Ge.iconsInText&&(hr=qe.imageAtlasTexture.size,Ii=qe.imageAtlasTexture,hi=an||y.options.rotating||y.options.zooming||At.kind==="composite"||At.kind==="camera"?K.LINEAR:K.NEAREST);else{const qn=a.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear;$n=qe.imageAtlasTexture,Ti=pt||y.options.rotating||y.options.zooming||qn||an?K.LINEAR:K.NEAREST,ui=qe.imageAtlasTexture.size}const ki=l.aN(qe,1,y.transform.zoom),dr=sa(le,y.transform,ki),Rs=l.N();l.aB(Rs,dr);const Ls=Vu(oe,le,y.transform,ki),ns=l.aO(se,qe,v,w),Wr=se.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),yl=me&&Ge.hasTextData(),cc=a.layout.get("icon-text-fit")!=="none"&&yl&&Ge.hasIconData();if(ue){const qn=y.style.map.terrain?($i,Ji)=>y.style.map.terrain.getElevation(je,$i,Ji):null,ti=a.layout.get("text-rotation-alignment")==="map";Us(Ge,y,f,dr,Rs,oe,R,ti,je.toUnwrapped(),se.width,se.height,ns,qn)}const is=f&&me||cc,Kr=ue||is?xs:oe?dr:y.transform.clipSpaceToPixelsMatrix,ya=pt&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Oa;Oa=pt?Ge.iconsInText?za(At.kind,ri,ve,oe,ue,is,y,Kr,Ls,ns,ui,hr,Ze):Qu(At.kind,ri,ve,oe,ue,is,y,Kr,Ls,ns,f,ui,0,Ze):Kc(At.kind,ri,ve,oe,ue,is,y,Kr,Ls,ns,f,ui,Ze);const Ba={program:jn,buffers:St,uniformValues:Oa,projectionData:Wr,atlasTexture:$n,atlasTextureIcon:Ii,atlasInterpolation:Ti,atlasInterpolationIcon:hi,isSDF:pt,hasHalo:ya};if(ce&&Ge.canOverlap){_e=!0;const qn=St.segments.get();for(const ti of qn)Ce.push({segments:new l.aX([ti]),sortKey:ti.sortKey,state:Ba,terrainData:ei})}else Ce.push({segments:St.segments,sortKey:0,state:Ba,terrainData:ei})}_e&&Ce.sort(((je,qe)=>je.sortKey-qe.sortKey));for(const je of Ce){const qe=je.state;if(H.activeTexture.set(K.TEXTURE0),qe.atlasTexture.bind(qe.atlasInterpolation,K.CLAMP_TO_EDGE),qe.atlasTextureIcon&&(H.activeTexture.set(K.TEXTURE1),qe.atlasTextureIcon&&qe.atlasTextureIcon.bind(qe.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),qe.isSDF){const Ge=qe.uniformValues;qe.hasHalo&&(Ge.u_is_halo=1,ec(qe.buffers,je.segments,a,y,qe.program,Ee,O,U,Ge,qe.projectionData,je.terrainData)),Ge.u_is_halo=0}ec(qe.buffers,je.segments,a,y,qe.program,Ee,O,U,qe.uniformValues,qe.projectionData,je.terrainData)}}function ec(y,t,a,c,f,v,w,E,D,R,O){const U=c.context;f.draw(U,U.gl.TRIANGLES,v,w,E,gn.backCCW,D,O,R,a.id,y.layoutVertexBuffer,y.indexBuffer,t,a.paint,c.transform.zoom,y.programConfigurations.get(a.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function ud(y,t,a,c,f){const v=y.context,w=v.gl,E=En.disabled,D=new Hn([w.ONE,w.ONE],l.bp.transparent,[!0,!0,!0,!0]),R=t.getBucket(a);if(!R)return;const O=c.key;let U=a.heatmapFbos.get(O);U||(U=Jn(v,t.tileSize,t.tileSize),a.heatmapFbos.set(O,U)),v.bindFramebuffer.set(U.framebuffer),v.viewport.set([0,0,t.tileSize,t.tileSize]),v.clear({color:l.bp.transparent});const j=R.programConfigurations.get(a.id),H=y.useProgram("heatmap",j,!f),K=y.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=y.style.map.terrain.getTerrainData(c);H.draw(v,w.TRIANGLES,on.disabled,E,D,gn.disabled,wo(t,y.transform.zoom,a.paint.get("heatmap-intensity"),1),se,K,a.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,a.paint,y.transform.zoom,j)}function ur(y,t,a,c,f){const v=y.context,w=v.gl,E=y.transform;v.setColorMode(y.colorModeForRenderPass());const D=bn(v,t),R=a.key,O=t.heatmapFbos.get(R);if(!O)return;v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,O.colorAttachment.get()),v.activeTexture.set(w.TEXTURE1),D.bind(w.LINEAR,w.CLAMP_TO_EDGE);const U=E.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!c});y.useProgram("heatmapTexture").draw(v,w.TRIANGLES,on.disabled,En.disabled,y.colorModeForRenderPass(),gn.disabled,id(y,t,0,1),null,U,t.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,t.paint,E.zoom),O.destroy(),t.heatmapFbos.delete(R)}function Jn(y,t,a){var c,f;const v=y.gl,w=v.createTexture();v.bindTexture(v.TEXTURE_2D,w),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR);const E=(c=y.HALF_FLOAT)!==null&&c!==void 0?c:v.UNSIGNED_BYTE,D=(f=y.RGBA16F)!==null&&f!==void 0?f:v.RGBA;v.texImage2D(v.TEXTURE_2D,0,D,t,a,0,v.RGBA,E,null);const R=y.createFramebuffer(t,a,!1,!1);return R.colorAttachment.set(w),R}function bn(y,t){return t.colorRampTexture||(t.colorRampTexture=new l.T(y,t.colorRamp,y.gl.RGBA)),t.colorRampTexture}function Hs(y,t,a,c,f,v,w,E){let D=256;if(f.stepInterpolant){const R=t.getSource().maxzoom,O=w.canonical.z===R?Math.ceil(1<<y.transform.maxZoom-w.canonical.z):1;D=l.an(l.ce(v.maxLineLength/l.a5*1024*O),256,a.maxTextureSize)}return E.gradient=l.cf({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:D,image:E.gradient||void 0,clips:v.lineClipsArray}),E.texture?E.texture.update(E.gradient):E.texture=new l.T(a,E.gradient,c.RGBA),E.version=f.gradientVersion,E.texture}function fa(y,t,a,c,f){y.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),c.updatePaintBuffers(f)}function bi(y,t,a,c,f,v){(f||y.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),y.lineAtlas.bind(t)),c.updatePaintBuffers(v)}function $r(y,t,a,c,f,v,w){const E=v.gradients[f.id];let D=E.texture;f.gradientVersion!==E.version&&(D=Hs(y,t,a,c,f,v,w,E)),a.activeTexture.set(c.TEXTURE0),D.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function Xr(y,t,a,c,f,v,w,E,D){const R=v.gradients[f.id];let O=R.texture;f.gradientVersion!==R.version&&(O=Hs(y,t,a,c,f,v,w,R)),a.activeTexture.set(c.TEXTURE0),O.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),y.lineAtlas.bind(a),E.updatePaintBuffers(D)}function ru(y,t,a,c,f){if(!a||!c||!c.imageAtlas)return;const v=c.imageAtlas.patternPositions;let w=v[a.to.toString()],E=v[a.from.toString()];if(!w&&E&&(w=E),!E&&w&&(E=w),!w||!E){const D=f.getPaintProperty(t);w=v[D],E=v[D]}w&&E&&y.setConstantPatternPositions(w,E)}function ws(y,t,a,c,f,v,w,E){const D=y.context.gl,R="fill-pattern",O=a.paint.get(R),U=O&&O.constantOr(1),j=a.getCrossfadeParameters();let H,K,se,le,oe;const ue=y.transform,ve=a.paint.get("fill-translate"),ce=a.paint.get("fill-translate-anchor");w?(K=U&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=D.LINES):(K=U?"fillPattern":"fill",H=D.TRIANGLES);const _e=O.constantOr(null);for(const Ee of c){const me=t.getTile(Ee);if(U&&!me.patternsLoaded())continue;const Ce=me.getBucket(a);if(!Ce)continue;const Ze=Ce.programConfigurations.get(a.id),je=y.useProgram(K,Ze),qe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ee);U&&(y.context.activeTexture.set(D.TEXTURE0),me.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ze.updatePaintBuffers(j)),ru(Ze,R,_e,me,a);const Ge=ue.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),St=l.aO(ue,me,ve,ce);if(w){le=Ce.indexBuffer2,oe=Ce.segments2;const pt=[D.drawingBufferWidth,D.drawingBufferHeight];se=K==="fillOutlinePattern"&&U?zf(y,j,me,pt,St):Wl(pt,St)}else le=Ce.indexBuffer,oe=Ce.segments,se=U?tl(y,j,me,St):{u_fill_translate:St};const Et=y.stencilModeForClipping(Ee);je.draw(y.context,H,f,Et,v,gn.backCCW,se,qe,Ge,a.id,Ce.layoutVertexBuffer,le,oe,a.paint,y.transform.zoom,Ze)}}function Ts(y,t,a,c,f,v,w,E){const D=y.context,R=D.gl,O="fill-extrusion-pattern",U=a.paint.get(O),j=U.constantOr(1),H=a.getCrossfadeParameters(),K=a.paint.get("fill-extrusion-opacity"),se=U.constantOr(null),le=y.transform;for(const oe of c){const ue=t.getTile(oe),ve=ue.getBucket(a);if(!ve)continue;const ce=y.style.map.terrain&&y.style.map.terrain.getTerrainData(oe),_e=ve.programConfigurations.get(a.id),Ee=y.useProgram(j?"fillExtrusionPattern":"fillExtrusion",_e);j&&(y.context.activeTexture.set(R.TEXTURE0),ue.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),_e.updatePaintBuffers(H));const me=le.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!E,applyTerrainMatrix:!0});ru(_e,O,se,ue,a);const Ce=l.aO(le,ue,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ze=a.paint.get("fill-extrusion-vertical-gradient"),je=j?Yu(y,Ze,K,Ce,oe,H,ue):Xu(y,Ze,K,Ce);Ee.draw(D,D.gl.TRIANGLES,f,v,w,gn.backCCW,je,ce,me,a.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,a.paint,y.transform.zoom,_e,y.style.map.terrain&&ve.centroidVertexBuffer)}}function Ss(y,t,a,c,f,v,w,E,D){var R;const O=y.style.projection,U=y.context,j=y.transform,H=U.gl,K=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],se=y.useProgram("hillshade",null,!1,K),le=!y.options.moving;for(const oe of c){const ue=t.getTile(oe),ve=ue.fbo;if(!ve)continue;const ce=O.getMeshFromTileID(U,oe.canonical,E,!0,"raster"),_e=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(oe);U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,ve.colorAttachment.get());const Ee=j.getProjectionData({overscaledTileID:oe,aligned:le,applyGlobeMatrix:!D,applyTerrainMatrix:!0});se.draw(U,H.TRIANGLES,v,f[oe.overscaledZ],w,gn.backCCW,Xc(y,ue,a),_e,Ee,a.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}}function $s(y,t,a,c,f,v,w,E,D){var R;const O=y.style.projection,U=y.context,j=y.transform,H=U.gl,K=y.useProgram("colorRelief"),se=!y.options.moving;let le=!0,oe=0;for(const ue of c){const ve=t.getTile(ue),ce=ve.dem;if(le){const je=H.getParameter(H.MAX_TEXTURE_SIZE),{elevationTexture:qe,colorTexture:Ge}=a.getColorRampTextures(U,je,ce.getUnpackVector());U.activeTexture.set(H.TEXTURE1),qe.bind(H.NEAREST,H.CLAMP_TO_EDGE),U.activeTexture.set(H.TEXTURE4),Ge.bind(H.LINEAR,H.CLAMP_TO_EDGE),le=!1,oe=qe.size[0]}if(!ce||!ce.data)continue;const _e=ce.stride,Ee=ce.getPixels();if(U.activeTexture.set(H.TEXTURE0),U.pixelStoreUnpackPremultiplyAlpha.set(!1),ve.demTexture=ve.demTexture||y.getTileTexture(_e),ve.demTexture){const je=ve.demTexture;je.update(Ee,{premultiply:!1}),je.bind(H.LINEAR,H.CLAMP_TO_EDGE)}else ve.demTexture=new l.T(U,Ee,H.RGBA,{premultiply:!1}),ve.demTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const me=O.getMeshFromTileID(U,ue.canonical,E,!0,"raster"),Ce=(R=y.style.map.terrain)===null||R===void 0?void 0:R.getTerrainData(ue),Ze=j.getProjectionData({overscaledTileID:ue,aligned:se,applyGlobeMatrix:!D,applyTerrainMatrix:!0});K.draw(U,H.TRIANGLES,v,f[ue.overscaledZ],w,gn.backCCW,Pf(a,ve.dem,oe),Ce,Ze,a.id,me.vertexBuffer,me.indexBuffer,me.segments)}}const Xs=[new l.P(0,0),new l.P(l.a5,0),new l.P(l.a5,l.a5),new l.P(0,l.a5)];function Pa(y,t,a,c,f,v,w,E,D=!1,R=!1){const O=c[c.length-1].overscaledZ,U=y.context,j=U.gl,H=y.useProgram("raster"),K=y.transform,se=y.style.projection,le=y.colorModeForRenderPass(),oe=!y.options.moving,ue=a.paint.get("raster-opacity"),ve=a.paint.get("raster-resampling"),ce=a.paint.get("raster-fade-duration"),_e=!!y.style.map.terrain;for(const Ee of c){const me=y.getDepthModeForSublayer(Ee.overscaledZ-O,ue===1?on.ReadWrite:on.ReadOnly,j.LESS),Ce=t.getTile(Ee),Ze=ve==="nearest"?j.NEAREST:j.LINEAR;U.activeTexture.set(j.TEXTURE0),Ce.texture.bind(Ze,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),U.activeTexture.set(j.TEXTURE1);const{parentTile:je,parentScaleBy:qe,parentTopLeft:Ge,fadeValues:St}=Es(Ce,t,ce,_e);Ce.fadeOpacity=St.tileOpacity,je?(je.fadeOpacity=St.parentTileOpacity,je.texture.bind(Ze,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST)):Ce.texture.bind(Ze,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),Ce.texture.useMipmap&&U.extTextureFilterAnisotropic&&y.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const Et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ee),pt=K.getProjectionData({overscaledTileID:Ee,aligned:oe,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),At=Wu(Ge,qe,St.fadeMix,a,E),an=se.getMeshFromTileID(U,Ee.canonical,v,w,"raster");H.draw(U,j.TRIANGLES,me,f?f[Ee.overscaledZ]:En.disabled,le,D?gn.frontCCW:gn.backCCW,At,Et,pt,a.id,an.vertexBuffer,an.indexBuffer,an.segments)}}function Es(y,t,a,c){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return f;if(y.fadingParentID){const v=t.getLoadedTile(y.fadingParentID);if(!v)return f;const w=Math.pow(2,v.tileID.overscaledZ-y.tileID.overscaledZ),E=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1],D=(function(R,O,U){const j=pe(),H=(j-O.timeAdded)/U,K=R.fadingDirection===Oe.Incoming,se=l.an((j-R.timeAdded)/U,0,1),le=l.an(1-H,0,1),oe=K?se:le;return{tileOpacity:oe,parentTileOpacity:K?le:se,fadeMix:{opacity:1,mix:1-oe}}})(y,v,a);return{parentTile:v,parentScaleBy:w,parentTopLeft:E,fadeValues:D}}if(y.selfFading){const v=(function(w,E){const D=(pe()-w.timeAdded)/E,R=l.an(D,0,1);return{tileOpacity:R,fadeMix:{opacity:R,mix:0}}})(y,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:v}}return f}const Ys=new l.bp(1,0,0,1),Ms=new l.bp(0,1,0,1),sh=new l.bp(0,0,1,1),oh=new l.bp(1,0,1,1),pa=new l.bp(0,1,1,1);function tc(y,t,a,c){Hi(y,0,t+a/2,y.transform.width,a,c)}function Ws(y,t,a,c){Hi(y,t-a/2,0,a,y.transform.height,c)}function Hi(y,t,a,c,f,v){const w=y.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*y.pixelRatio,a*y.pixelRatio,c*y.pixelRatio,f*y.pixelRatio),w.clear({color:v}),E.disable(E.SCISSOR_TEST)}function au(y,t,a){const c=y.context,f=c.gl,v=y.useProgram("debug"),w=on.disabled,E=En.disabled,D=y.colorModeForRenderPass(),R="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);c.activeTexture.set(f.TEXTURE0);const U=t.getTileByID(a.key).latestRawTileData,j=Math.floor((U&&U.byteLength||0)/1024),H=t.getTile(a).tileSize,K=512/Math.min(H,512)*(a.overscaledZ/y.transform.zoom)*.5;let se=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(se+=` => ${a.overscaledZ}`),(function(oe,ue){oe.initDebugOverlayCanvas();const ve=oe.debugOverlayCanvas,ce=oe.context.gl,_e=oe.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,ve.width,ve.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(ue,5,5),_e.strokeText(ue,5,5),oe.debugOverlayTexture.update(ve),oe.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)})(y,`${se} ${j}kB`);const le=y.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(c,f.TRIANGLES,w,E,Hn.alphaBlended,gn.disabled,$c(l.bp.transparent,K),null,le,R,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),v.draw(c,f.LINE_STRIP,w,E,D,gn.disabled,$c(l.bp.red),O,le,R,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function lh(y,t,a,c){const{isRenderingGlobe:f}=c,v=y.context,w=v.gl,E=y.transform,D=y.colorModeForRenderPass(),R=y.getDepthModeFor3D(),O=y.useProgram("terrain");v.bindFramebuffer.set(null),v.viewport.set([0,0,y.width,y.height]);for(const U of a){const j=t.getTerrainMesh(U.tileID),H=y.renderToTexture.getTexture(U),K=t.getTerrainData(U.tileID);v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,H.texture);const se=t.getMeshFrameDelta(E.zoom),le=E.calculateFogMatrix(U.tileID.toUnwrapped()),oe=Mf(se,le,y.style.sky,E.pitch,f),ue=E.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(v,w.TRIANGLES,R,En.disabled,D,gn.backCCW,oe,K,ue,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}}function hd(y,t){if(!t.mesh){const a=new l.aW;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const c=new l.aY;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new Qn(y.createVertexBuffer(a,Ma.members),y.createIndexBuffer(c),l.aX.simpleSegment(0,0,a.length,c.length))}return t.mesh}class Lf{constructor(t,a){this.context=new zo(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Tn.maxOverzooming+Tn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ir}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,a=new l.aW;a.emplaceBack(0,0),a.emplaceBack(l.a5,0),a.emplaceBack(0,l.a5),a.emplaceBack(l.a5,l.a5),this.tileExtentBuffer=t.createVertexBuffer(a,Ma.members),this.tileExtentSegments=l.aX.simpleSegment(0,0,4,2);const c=new l.aW;c.emplaceBack(0,0),c.emplaceBack(l.a5,0),c.emplaceBack(0,l.a5),c.emplaceBack(l.a5,l.a5),this.debugBuffer=t.createVertexBuffer(c,Ma.members),this.debugSegments=l.aX.simpleSegment(0,0,4,5);const f=new l.ch;f.emplaceBack(0,0,0,0),f.emplaceBack(l.a5,0,l.a5,0),f.emplaceBack(0,l.a5,0,l.a5),f.emplaceBack(l.a5,l.a5,l.a5,l.a5),this.rasterBoundsBuffer=t.createVertexBuffer(f,Ef.members),this.rasterBoundsSegments=l.aX.simpleSegment(0,0,4,2);const v=new l.aW;v.emplaceBack(0,0),v.emplaceBack(l.a5,0),v.emplaceBack(0,l.a5),v.emplaceBack(l.a5,l.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(v,Ma.members),this.rasterBoundsSegmentsPosOnly=l.aX.simpleSegment(0,0,4,5);const w=new l.aW;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,Ma.members),this.viewportSegments=l.aX.simpleSegment(0,0,4,2);const E=new l.ci;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(E);const D=new l.aY;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const R=this.context.gl;this.stencilClearMode=new En({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.tileExtentMesh=new Qn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.N();l.c7(c,0,this.width,this.height,0,0,1),l.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,on.disabled,this.stencilClearMode,Hn.disabled,gn.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(Hn.disabled),f.setDepthMode(on.disabled);const v={};for(const w of a)v[w.key]=this.nextStencilID++;this._renderTileMasks(v,a,c,!0),this._renderTileMasks(v,a,c,!1),this._tileClippingMaskIDs=v}_renderTileMasks(t,a,c,f){const v=this.context,w=v.gl,E=this.style.projection,D=this.transform,R=this.useProgram("clippingMask");for(const O of a){const U=t[O.key],j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),H=E.getMeshFromTileID(this.context,O.canonical,f,!0,"stencil"),K=D.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!c,applyTerrainMatrix:!0});R.draw(v,w.TRIANGLES,on.disabled,new En({func:w.ALWAYS,mask:0},U,255,w.KEEP,w.KEEP,w.REPLACE),Hn.disabled,c?gn.disabled:gn.backCCW,null,j,K,"$clipping",H.vertexBuffer,H.indexBuffer,H.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,c=this.style.projection,f=this.transform,v=this.useProgram("depth"),w=this.getDepthModeFor3D(),E=di(f,{tileSize:f.tileSize});for(const D of E){const R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),O=c.getMeshFromTileID(this.context,D.canonical,!0,!0,"raster"),U=f.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!0,applyTerrainMatrix:!0});v.draw(t,a.TRIANGLES,w,En.disabled,Hn.disabled,gn.backCCW,null,R,U,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new En({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new En({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,c=t.sort(((w,E)=>E.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,v=c[0].overscaledZ-f+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let E=0;E<v;E++)w[E+f]=new En({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[w,c]}return[{[f]:En.disabled},c]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,c=t.sort(((w,E)=>E.overscaledZ-w.overscaledZ)),f=c[c.length-1].overscaledZ,v=c[0].overscaledZ-f+1;if(this.clearStencil(),v>1){const w={},E={};for(let D=0;D<v;D++)w[D+f]=new En({func:a.GREATER,mask:255},v+1+D,255,a.KEEP,a.KEEP,a.REPLACE),E[D+f]=new En({func:a.GREATER,mask:255},1+D,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*v+1,[w,E,c]}return this.nextStencilID=3,[{[f]:new En({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new En({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Hn([t.CONSTANT_COLOR,t.ONE],new l.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Hn.unblended:Hn.alphaBlended}getDepthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return on.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new on(c||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new on(this.context.gl.LEQUAL,on.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var c,f;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(pe()),this.imageManager.beginFrame();const v=this.style._order,w=this.style.tileManagers,E={},D={},R={},O={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const j in w){const H=w[j];H.used&&H.prepare(this.context),E[j]=H.getVisibleCoordinates(!1),D[j]=E[j].slice().reverse(),R[j]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<v.length;j++)if(this.style._layers[v[j]].is3D()){this.opaquePassCutoff=j;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const j of v){const H=this.style._layers[j];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const K=D[H.source];(H.type==="custom"||K.length)&&this.renderLayer(this,w[H.source],H,K,O)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:j=>this.useProgram(j)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?l.bp.black:l.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(j,H){const K=j.context,se=K.gl,le=((Ee,me,Ce)=>{const Ze=Math.cos(me.rollInRadians),je=Math.sin(me.rollInRadians),qe=hn(me),Ge=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ee.properties.get("sky-color"),u_horizon_color:Ee.properties.get("horizon-color"),u_horizon:[(me.width/2-qe*je)*Ce,(me.height/2+qe*Ze)*Ce],u_horizon_normal:[-je,Ze],u_sky_horizon_blend:Ee.properties.get("sky-horizon-blend")*me.height/2*Ce,u_sky_blend:Ge}})(H,j.style.map.transform,j.pixelRatio),oe=new on(se.LEQUAL,on.ReadWrite,[0,1]),ue=En.disabled,ve=j.colorModeForRenderPass(),ce=j.useProgram("sky"),_e=hd(K,H);ce.draw(K,se.TRIANGLES,oe,ue,ve,gn.disabled,le,null,void 0,"sky",_e.vertexBuffer,_e.indexBuffer,_e.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[v[this.currentLayer]],H=w[j.source],K=E[j.source];this._renderTileClippingMasks(j,K,!1),this.renderLayer(this,H,j,K,O)}this.renderPass="translucent";let U=!1;for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const j=this.style._layers[v[this.currentLayer]],H=w[j.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(j,O))continue;this.opaquePassEnabledForLayer()||U||(U=!0,O.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const K=(j.type==="symbol"?R:D)[j.source];this._renderTileClippingMasks(j,E[j.source],!!this.renderToTexture),this.renderLayer(this,H,j,K,O)}if(O.isRenderingGlobe&&(function(j,H,K){const se=j.context,le=se.gl,oe=j.useProgram("atmosphere"),ue=new on(le.LEQUAL,on.ReadOnly,[0,1]),ve=j.transform,ce=(function(Ge,St){const Et=Ge.properties.get("position"),pt=[-Et.x,-Et.y,-Et.z],At=l.ar(new Float64Array(16));return Ge.properties.get("anchor")==="map"&&(l.bg(At,At,St.rollInRadians),l.bh(At,At,-St.pitchInRadians),l.bg(At,At,St.bearingInRadians),l.bh(At,At,St.center.lat*Math.PI/180),l.bJ(At,At,-St.center.lng*Math.PI/180)),l.cg(pt,pt,At),pt})(K,j.transform),_e=ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ee=H.properties.get("atmosphere-blend")*_e.projectionTransition;if(Ee===0)return;const me=el(ve.worldSize,ve.center.lat),Ce=ve.inverseProjectionMatrix,Ze=new Float64Array(4);Ze[3]=1,l.aH(Ze,Ze,ve.modelViewProjectionMatrix),Ze[0]/=Ze[3],Ze[1]/=Ze[3],Ze[2]/=Ze[3],Ze[3]=1,l.aH(Ze,Ze,Ce),Ze[0]/=Ze[3],Ze[1]/=Ze[3],Ze[2]/=Ze[3],Ze[3]=1;const je=((Ge,St,Et,pt,At)=>({u_sun_pos:Ge,u_atmosphere_blend:St,u_globe_position:Et,u_globe_radius:pt,u_inv_proj_matrix:At}))(ce,Ee,[Ze[0],Ze[1],Ze[2]],me,Ce),qe=hd(se,H);oe.draw(se,le.TRIANGLES,ue,En.disabled,Hn.alphaBlended,gn.disabled,je,null,null,"atmosphere",qe.vertexBuffer,qe.indexBuffer,qe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const j=(function(H,K){let se=null;const le=Object.values(H._layers).flatMap((ce=>ce.source&&!ce.isHidden(K)?[H.tileManagers[ce.source]]:[])),oe=le.filter((ce=>ce.getSource().type==="vector")),ue=le.filter((ce=>ce.getSource().type!=="vector")),ve=ce=>{(!se||se.getSource().maxzoom<ce.getSource().maxzoom)&&(se=ce)};return oe.forEach((ce=>ve(ce))),se||ue.forEach((ce=>ve(ce))),se})(this.style,this.transform.zoom);j&&(function(H,K,se){for(let le=0;le<se.length;le++)au(H,K,se[le])})(this,j,j.getVisibleCoordinates())}this.options.showPadding&&(function(j){const H=j.transform.padding;tc(j,j.transform.height-(H.top||0),3,Ys),tc(j,H.bottom||0,3,Ms),Ws(j,H.left||0,3,sh),Ws(j,j.transform.width-(H.right||0),3,oh);const K=j.transform.centerPoint;(function(se,le,oe,ue){Hi(se,le-1,oe-10,2,20,ue),Hi(se,le-10,oe-1,20,2,ue)})(j,K.x,j.transform.height-K.y,pa)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=t?!l.cj(a,c):!l.ck(a,c)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(l.cl(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(v,w){const E=v.context,D=E.gl,R=v.transform,O=Hn.unblended,U=new on(D.LEQUAL,on.ReadWrite,[0,1]),j=w.tileManager.getRenderableTiles(),H=v.useProgram("terrainDepth");E.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:l.bp.transparent,depth:1});for(const K of j){const se=w.getTerrainMesh(K.tileID),le=w.getTerrainData(K.tileID),oe=R.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:w.getMeshFrameDelta(R.zoom)};H.draw(E,D.TRIANGLES,U,En.disabled,O,gn.backCCW,ue,le,oe,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain),(function(v,w){const E=v.context,D=E.gl,R=v.transform,O=Hn.unblended,U=new on(D.LEQUAL,on.ReadWrite,[0,1]),j=w.getCoordsTexture(),H=w.tileManager.getRenderableTiles(),K=v.useProgram("terrainCoords");E.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),E.clear({color:l.bp.transparent,depth:1}),w.coordsIndex=[];for(const se of H){const le=w.getTerrainMesh(se.tileID),oe=w.getTerrainData(se.tileID);E.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,j.texture);const ue={u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(R.zoom)},ve=R.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(E,D.TRIANGLES,U,En.disabled,O,gn.backCCW,ue,oe,ve,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),w.coordsIndex.push(se.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,v.width,v.height])})(this,this.style.map.terrain))}renderLayer(t,a,c,f,v){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(f||[]).length)&&(this.id=c.id,l.cm(c)?(function(w,E,D,R,O,U){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:j}=U,H=En.disabled,K=w.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(se,le,oe,ue,ve,ce,_e,Ee,me){const Ce=le.transform,Ze=le.style.map.terrain,je=ve==="map",qe=ce==="map";for(const Ge of se){const St=ue.getTile(Ge),Et=St.getBucket(oe);if(!Et||!Et.text||!Et.text.segments.get().length)continue;const pt=l.ay(Et.textSizeData,Ce.zoom),At=l.aN(St,1,le.transform.zoom),an=sa(je,le.transform,At),jn=oe.layout.get("icon-text-fit")!=="none"&&Et.hasIconData();if(pt){const ri=Math.pow(2,Ce.zoom-St.tileID.overscaledZ),ei=Ze?(ui,$n)=>Ze.getElevation(Ge,ui,$n):null;Zs(Et,je,qe,me,Ce,an,ri,pt,jn,l.aO(Ce,St,_e,Ee),Ge.toUnwrapped(),ei)}}})(R,w,D,E,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),O),D.paint.get("icon-opacity").constantOr(1)!==0&&ll(w,E,D,R,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),H,K,j),D.paint.get("text-opacity").constantOr(1)!==0&&ll(w,E,D,R,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),H,K,j),E.map.showCollisionBoxes&&(cr(w,E,D,R,!0),cr(w,E,D,R,!1))})(t,a,c,f,this.style.placement.variableOffsets,v):l.cn(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,j=D.paint.get("circle-opacity"),H=D.paint.get("circle-stroke-width"),K=D.paint.get("circle-stroke-opacity"),se=!D.layout.get("circle-sort-key").isConstant();if(j.constantOr(1)===0&&(H.constantOr(1)===0||K.constantOr(1)===0))return;const le=w.context,oe=le.gl,ue=w.transform,ve=w.getDepthModeForSublayer(0,on.ReadOnly),ce=En.disabled,_e=w.colorModeForRenderPass(),Ee=[],me=ue.getCircleRadiusCorrection();for(let Ce=0;Ce<R.length;Ce++){const Ze=R[Ce],je=E.getTile(Ze),qe=je.getBucket(D);if(!qe)continue;const Ge=D.paint.get("circle-translate"),St=D.paint.get("circle-translate-anchor"),Et=l.aO(ue,je,Ge,St),pt=qe.programConfigurations.get(D.id),At=w.useProgram("circle",pt),an=qe.layoutVertexBuffer,jn=qe.indexBuffer,ri=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ze),ei={programConfiguration:pt,program:At,layoutVertexBuffer:an,indexBuffer:jn,uniformValues:Hc(w,je,D,Et,me),terrainData:ri,projectionData:ue.getProjectionData({overscaledTileID:Ze,applyGlobeMatrix:!U,applyTerrainMatrix:!0})};if(se){const ui=qe.segments.get();for(const $n of ui)Ee.push({segments:new l.aX([$n]),sortKey:$n.sortKey,state:ei})}else Ee.push({segments:qe.segments,sortKey:0,state:ei})}se&&Ee.sort(((Ce,Ze)=>Ce.sortKey-Ze.sortKey));for(const Ce of Ee){const{programConfiguration:Ze,program:je,layoutVertexBuffer:qe,indexBuffer:Ge,uniformValues:St,terrainData:Et,projectionData:pt}=Ce.state;je.draw(le,oe.TRIANGLES,ve,ce,_e,gn.backCCW,St,Et,pt,D.id,qe,Ge,Ce.segments,D.paint,w.transform.zoom,Ze)}})(t,a,c,f,v):l.co(c)?(function(w,E,D,R,O){if(D.paint.get("heatmap-opacity")===0)return;const U=w.context,{isRenderingToTexture:j,isRenderingGlobe:H}=O;if(w.style.map.terrain){for(const K of R){const se=E.getTile(K);E.hasRenderableParent(K)||(w.renderPass==="offscreen"?ud(w,se,D,K,H):w.renderPass==="translucent"&&ur(w,D,K,j,H))}U.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?(function(K,se,le,oe){const ue=K.context,ve=ue.gl,ce=K.transform,_e=En.disabled,Ee=new Hn([ve.ONE,ve.ONE],l.bp.transparent,[!0,!0,!0,!0]);(function(me,Ce,Ze){const je=me.gl;me.activeTexture.set(je.TEXTURE1),me.viewport.set([0,0,Ce.width/4,Ce.height/4]);let qe=Ze.heatmapFbos.get(l.cd);qe?(je.bindTexture(je.TEXTURE_2D,qe.colorAttachment.get()),me.bindFramebuffer.set(qe.framebuffer)):(qe=Jn(me,Ce.width/4,Ce.height/4),Ze.heatmapFbos.set(l.cd,qe))})(ue,K,le),ue.clear({color:l.bp.transparent});for(let me=0;me<oe.length;me++){const Ce=oe[me];if(se.hasRenderableParent(Ce))continue;const Ze=se.getTile(Ce),je=Ze.getBucket(le);if(!je)continue;const qe=je.programConfigurations.get(le.id),Ge=K.useProgram("heatmap",qe),St=ce.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Et=ce.getCircleRadiusCorrection();Ge.draw(ue,ve.TRIANGLES,on.disabled,_e,Ee,gn.backCCW,wo(Ze,ce.zoom,le.paint.get("heatmap-intensity"),Et),null,St,le.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,le.paint,ce.zoom,qe)}ue.viewport.set([0,0,K.width,K.height])})(w,E,D,R):w.renderPass==="translucent"&&(function(K,se){const le=K.context,oe=le.gl;le.setColorMode(K.colorModeForRenderPass());const ue=se.heatmapFbos.get(l.cd);ue&&(le.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,ue.colorAttachment.get()),le.activeTexture.set(oe.TEXTURE1),bn(le,se).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(le,oe.TRIANGLES,on.disabled,En.disabled,K.colorModeForRenderPass(),gn.disabled,id(K,se,0,1),null,null,se.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,se.paint,K.transform.zoom))})(w,D)})(t,a,c,f,v):l.cp(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,j=D.paint.get("line-opacity"),H=D.paint.get("line-width");if(j.constantOr(1)===0||H.constantOr(1)===0)return;const K=w.getDepthModeForSublayer(0,on.ReadOnly),se=w.colorModeForRenderPass(),le=D.paint.get("line-dasharray"),oe=le.constantOr(1),ue=D.paint.get("line-pattern"),ve=ue.constantOr(1),ce=D.paint.get("line-gradient"),_e=D.getCrossfadeParameters();let Ee;Ee=ve?"linePattern":oe&&ce?"lineGradientSDF":oe?"lineSDF":ce?"lineGradient":"line";const me=w.context,Ce=me.gl,Ze=w.transform;let je=!0;for(const qe of R){const Ge=E.getTile(qe);if(ve&&!Ge.patternsLoaded())continue;const St=Ge.getBucket(D);if(!St)continue;const Et=St.programConfigurations.get(D.id),pt=w.context.program.get(),At=w.useProgram(Ee,Et),an=je||At.program!==pt,jn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(qe),ri=ue.constantOr(null),ei=le&&le.constantOr(null);if(ri&&Ge.imageAtlas){const hr=Ge.imageAtlas,Ii=hr.patternPositions[ri.to.toString()],ki=hr.patternPositions[ri.from.toString()];Ii&&ki&&Et.setConstantPatternPositions(Ii,ki)}else if(ei){const hr=D.layout.get("line-cap")==="round",Ii=w.lineAtlas.getDash(ei.to,hr),ki=w.lineAtlas.getDash(ei.from,hr);Et.setConstantDashPositions(Ii,ki)}const ui=Ze.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),$n=Ze.getPixelScale();let Ti;ve?(Ti=rd(w,Ge,D,$n,_e),fa(me,Ce,Ge,Et,_e)):oe&&ce?(Ti=To(w,Ge,D,$n,_e,St.lineClipsArray.length),Xr(w,E,me,Ce,D,St,qe,Et,_e)):oe?(Ti=Zr(w,Ge,D,$n,_e),bi(w,me,Ce,Et,an,_e)):ce?(Ti=If(w,Ge,D,$n,St.lineClipsArray.length),$r(w,E,me,Ce,D,St,qe)):Ti=Yc(w,Ge,D,$n);const hi=w.stencilModeForClipping(qe);At.draw(me,Ce.TRIANGLES,K,hi,se,gn.disabled,Ti,jn,ui,D.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,D.paint,w.transform.zoom,Et,St.layoutVertexBuffer2),je=!1}})(t,a,c,f,v):l.cq(c)?(function(w,E,D,R,O){const U=D.paint.get("fill-color"),j=D.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const{isRenderingToTexture:H}=O,K=w.colorModeForRenderPass(),se=D.paint.get("fill-pattern"),le=w.opaquePassEnabledForLayer()&&!se.constantOr(1)&&U.constantOr(l.bp.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===le){const oe=w.getDepthModeForSublayer(1,w.renderPass==="opaque"?on.ReadWrite:on.ReadOnly);ws(w,E,D,R,oe,K,!1,H)}if(w.renderPass==="translucent"&&D.paint.get("fill-antialias")){const oe=w.getDepthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,on.ReadOnly);ws(w,E,D,R,oe,K,!0,H)}})(t,a,c,f,v):l.cr(c)?(function(w,E,D,R,O){const U=D.paint.get("fill-extrusion-opacity");if(U===0)return;const{isRenderingToTexture:j}=O;if(w.renderPass==="translucent"){const H=new on(w.context.gl.LEQUAL,on.ReadWrite,w.depthRangeFor3D);if(U!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Ts(w,E,D,R,H,En.disabled,Hn.disabled,j),Ts(w,E,D,R,H,w.stencilModeFor3D(),w.colorModeForRenderPass(),j);else{const K=w.colorModeForRenderPass();Ts(w,E,D,R,H,En.disabled,K,j)}}})(t,a,c,f,v):l.cs(c)?(function(w,E,D,R,O){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const{isRenderingToTexture:U}=O,j=w.context,H=w.style.projection.useSubdivision,K=w.getDepthModeForSublayer(0,on.ReadOnly),se=w.colorModeForRenderPass();if(w.renderPass==="offscreen")(function(le,oe,ue,ve,ce,_e,Ee){const me=le.context,Ce=me.gl;for(const Ze of ue){const je=oe.getTile(Ze),qe=je.dem;if(!qe||!qe.data||!je.needsHillshadePrepare)continue;const Ge=qe.dim,St=qe.stride,Et=qe.getPixels();if(me.activeTexture.set(Ce.TEXTURE1),me.pixelStoreUnpackPremultiplyAlpha.set(!1),je.demTexture=je.demTexture||le.getTileTexture(St),je.demTexture){const At=je.demTexture;At.update(Et,{premultiply:!1}),At.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE)}else je.demTexture=new l.T(me,Et,Ce.RGBA,{premultiply:!1}),je.demTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);me.activeTexture.set(Ce.TEXTURE0);let pt=je.fbo;if(!pt){const At=new l.T(me,{width:Ge,height:Ge,data:null},Ce.RGBA);At.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),pt=je.fbo=me.createFramebuffer(Ge,Ge,!0,!1),pt.colorAttachment.set(At.texture)}me.bindFramebuffer.set(pt.framebuffer),me.viewport.set([0,0,Ge,Ge]),le.useProgram("hillshadePrepare").draw(me,Ce.TRIANGLES,ce,_e,Ee,gn.disabled,Df(je.tileID,qe),null,null,ve.id,le.rasterBoundsBuffer,le.quadTriangleIndexBuffer,le.rasterBoundsSegments),je.needsHillshadePrepare=!1}})(w,E,R,D,K,En.disabled,se),j.viewport.set([0,0,w.width,w.height]);else if(w.renderPass==="translucent")if(H){const[le,oe,ue]=w.stencilConfigForOverlapTwoPass(R);Ss(w,E,D,ue,le,K,se,!1,U),Ss(w,E,D,ue,oe,K,se,!0,U)}else{const[le,oe]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Ss(w,E,D,oe,le,K,se,!1,U)}})(t,a,c,f,v):l.ct(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent"||!R.length)return;const{isRenderingToTexture:U}=O,j=w.style.projection.useSubdivision,H=w.getDepthModeForSublayer(0,on.ReadOnly),K=w.colorModeForRenderPass();if(j){const[se,le,oe]=w.stencilConfigForOverlapTwoPass(R);$s(w,E,D,oe,se,H,K,!1,U),$s(w,E,D,oe,le,H,K,!0,U)}else{const[se,le]=w.getStencilConfigForOverlapAndUpdateStencilID(R);$s(w,E,D,le,se,H,K,!1,U)}})(t,a,c,f,v):l.bU(c)?(function(w,E,D,R,O){if(w.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!R.length)return;const{isRenderingToTexture:U}=O,j=E.getSource(),H=w.style.projection.useSubdivision;if(j instanceof nr)Pa(w,E,D,R,null,!1,!1,j.tileCoords,j.flippedWindingOrder,U);else if(H){const[K,se,le]=w.stencilConfigForOverlapTwoPass(R);Pa(w,E,D,le,K,!1,!0,Xs,!1,U),Pa(w,E,D,le,se,!0,!0,Xs,!1,U)}else{const[K,se]=w.getStencilConfigForOverlapAndUpdateStencilID(R);Pa(w,E,D,se,K,!1,!0,Xs,!1,U)}})(t,a,c,f,v):l.cu(c)?(function(w,E,D,R,O){const U=D.paint.get("background-color"),j=D.paint.get("background-opacity");if(j===0)return;const{isRenderingToTexture:H}=O,K=w.context,se=K.gl,le=w.style.projection,oe=w.transform,ue=oe.tileSize,ve=D.paint.get("background-pattern");if(w.isPatternMissing(ve))return;const ce=!ve&&U.a===1&&j===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==ce)return;const _e=En.disabled,Ee=w.getDepthModeForSublayer(0,ce==="opaque"?on.ReadWrite:on.ReadOnly),me=w.colorModeForRenderPass(),Ce=w.useProgram(ve?"backgroundPattern":"background"),Ze=R||di(oe,{tileSize:ue,terrain:w.style.map.terrain});ve&&(K.activeTexture.set(se.TEXTURE0),w.imageManager.bind(w.context));const je=D.getCrossfadeParameters();for(const qe of Ze){const Ge=oe.getProjectionData({overscaledTileID:qe,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),St=ve?Jc(j,w,ve,{tileID:qe,tileSize:ue},je):Qc(j,U),Et=w.style.map.terrain&&w.style.map.terrain.getTerrainData(qe),pt=le.getMeshFromTileID(K,qe.canonical,!1,!0,"raster");Ce.draw(K,se.TRIANGLES,Ee,_e,me,gn.backCCW,St,Et,Ge,D.id,pt.vertexBuffer,pt.indexBuffer,pt.segments)}})(t,0,c,f,v):l.cv(c)&&(function(w,E,D,R){const{isRenderingGlobe:O}=R,U=w.context,j=D.implementation,H=w.style.projection,K=w.transform,se=K.getProjectionDataForCustomLayer(O),le={farZ:K.farZ,nearZ:K.nearZ,fov:K.fov*Math.PI/180,modelViewProjectionMatrix:K.modelViewProjectionMatrix,projectionMatrix:K.projectionMatrix,shaderData:{variantName:H.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${H.shaderPreludeCode.vertexSource}`,define:H.shaderDefine},defaultProjectionData:se},oe=j.renderingMode?j.renderingMode:"2d";if(w.renderPass==="offscreen"){const ue=j.prerender;ue&&(w.setCustomLayerDefaults(),U.setColorMode(w.colorModeForRenderPass()),ue.call(j,U.gl,le),U.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),U.setColorMode(w.colorModeForRenderPass()),U.setStencilMode(En.disabled);const ue=oe==="3d"?w.getDepthModeFor3D():w.getDepthModeForSublayer(0,on.ReadOnly);U.setDepthMode(ue),j.render(U.gl,le),U.setDirty(),w.setBaseState(),U.bindFramebuffer.set(null)}})(t,0,c,v))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a,c=!1,f=[]){this.cache=this.cache||{};const v=!!this.style.map.terrain,w=this.style.projection,E=c?fi.projectionMercator:w.shaderPreludeCode,D=c?zi:w.shaderDefine,R=t+(a?a.cacheKey:"")+`/${c?Br:w.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[R]||(this.cache[R]=new Af(this.context,fi[t],a,kf[t],this._showOverdrawInspector,v,E,D,f)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const c in this._tileTextures){const f=this._tileTextures[c];if(f)for(const v of f)v.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const f=this.cache[c];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function dd(y,t){let a,c=!1,f=null,v=null;const w=()=>{f=null,c&&(y.apply(v,a),f=setTimeout(w,t),c=!1)};return(...E)=>(c=!0,v=this,a=E,f||w(),f)}class ji{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let f=c;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${c}`);let v=window.location.hash.replace(f,"");v.startsWith("#&")?v=v.slice(0,1)+v.slice(2):v==="#"&&(v="");let w=window.location.href.replace(/(#.+)?$/,v);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=dd(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,f),w=Math.round(a.lng*v)/v,E=Math.round(a.lat*v)/v,D=this._map.getBearing(),R=this._map.getPitch();let O="";if(O+=t?`/${w}/${E}/${c}`:`${c}/${E}/${w}`,(D||R)&&(O+="/"+Math.round(10*D)/10),R&&(O+=`/${Math.round(R)}`),this._hashName){const U=this._hashName;let j=!1;const H=window.location.hash.slice(1).split("&").map((K=>{const se=K.split("=")[0];return se===U?(j=!0,`${se}=${O}`):K})).filter((K=>K));return j||H.push(`${U}=${O}`),`#${H.join("&")}`}return`#${O}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new l.V(+t[2],+t[1])}catch{return!1}const a=+t[0],c=+(t[3]||0),f=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const As={linearity:.3,easing:l.cw(0,0,.3,1)},nc=l.e({deceleration:2500,maxSpeed:1400},As),zr=l.e({deceleration:20,maxSpeed:1400},As),ma=l.e({deceleration:1e3,maxSpeed:360},As),cl=l.e({deceleration:1e3,maxSpeed:90},As),Dr=l.e({deceleration:1e3,maxSpeed:360},As);class em{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:pe(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=pe();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,a.roll+=v.rollDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const v=su(a.pan.mag(),c,l.e({},nc,t||{})),w=a.pan.mult(v.amount/a.pan.mag()),E=this._map.cameraHelper.handlePanInertia(w,this._map.transform);f.center=E.easingCenter,f.offset=E.easingOffset,ic(f,v)}if(a.zoom){const v=su(a.zoom,c,zr);f.zoom=this._map.transform.zoom+v.amount,ic(f,v)}if(a.bearing){const v=su(a.bearing,c,ma);f.bearing=this._map.transform.bearing+l.an(v.amount,-179,179),ic(f,v)}if(a.pitch){const v=su(a.pitch,c,cl);f.pitch=this._map.transform.pitch+v.amount,ic(f,v)}if(a.roll){const v=su(a.roll,c,Dr);f.roll=this._map.transform.roll+l.an(v.amount,-179,179),ic(f,v)}if(f.zoom||f.bearing){const v=a.pinchAround===void 0?a.around:a.pinchAround;f.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),l.e(f,{noMoveStart:!0})}}function ic(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function su(y,t,a){const{maxSpeed:c,linearity:f,deceleration:v}=a,w=l.an(y*f/(t/1e3),-c,c),E=Math.abs(w)/(v*f);return{easing:a.easing,duration:1e3*E,amount:w*(E/2)}}class sr extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,f={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const v=ae.mousePos(a.getCanvas(),c),w=a.unproject(v);super(t,l.e({point:v,lngLat:w,originalEvent:c},f)),this._defaultPrevented=!1,this.target=a}}class Wa extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const f=t==="touchend"?c.changedTouches:c.touches,v=ae.touchPos(a.getCanvasContainer(),f),w=v.map((D=>a.unproject(D))),E=v.reduce(((D,R,O,U)=>D.add(R.div(U.length))),new l.P(0,0));super(t,{points:v,point:E,lngLats:w,lngLat:a.unproject(E),originalEvent:c}),this._defaultPrevented=!1}}class ch extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class uh{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ch(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new sr(t.type,this._map,t))}mouseup(t){this._map.fire(new sr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new sr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new sr(t.type,this._map,t))}mouseover(t){this._map.fire(new sr(t.type,this._map,t))}mouseout(t){this._map.fire(new sr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Wa(t.type,this._map,t))}touchmove(t){this._map.fire(new Wa(t.type,this._map,t))}touchend(t){this._map.fire(new Wa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Wa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Of{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new sr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new sr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new sr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ka{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(l.P.convert(t),this._map.terrain)}}class Do{constructor(t,a){this._map=t,this._tr=new Ka(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(ae.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=ae.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(f.x,c.x),w=Math.max(f.x,c.x),E=Math.min(f.y,c.y),D=Math.max(f.y,c.y);ae.setTransform(this._box,`translate(${v}px,${E}px)`),this._box.style.width=w-v+"px",this._box.style.height=D-E+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,f=a;if(this.reset(),ae.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ae.remove(this._box),this._box=null),ae.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new l.l(t,{originalEvent:a}))}}function Yr(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const a={};for(let c=0;c<y.length;c++)a[y[c].identifier]=t[c];return a}class kt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const v=new l.P(0,0);for(const w of f)v._add(w);return v.div(f.length)})(a),this.touches=Yr(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const f=Yr(c,a);for(const v in this.touches){const w=f[v];(!w||w.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class ou{constructor(t){this.singleTap=new kt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const f=this.singleTap.touchend(t,a,c);if(f){const v=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(f)<30;if(v&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class hh{constructor(t){this._tr=new Ka(t),this._zoomIn=new ou({numTouches:1,numTaps:2}),this._zoomOut=new ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const f=this._zoomIn.touchend(t,a,c),v=this._zoomOut.touchend(t,a,c),w=this._tr;return f?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(f)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ia{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&ae.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qa=0,rc=2,dh={[Qa]:1,[rc]:2};class Cs{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=ae.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,c){const f=dh[c];return a.buttons===void 0||(a.buttons&f)!==f})(t,this._eventButton)}isValidEndEvent(t){return ae.mouseButton(t)===this._eventButton}}class ul{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class lu{constructor(t=new Cs({checkCorrectEvent:()=>!0}),a=new ul){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,c){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const zs=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=t=>{t.preventDefault()}};class fh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const f=Yr(c,a),v=new l.P(0,0),w=new l.P(0,0);let E=0;for(const R in f){const O=f[R],U=this._touches[R];U&&(v._add(O),w._add(O.sub(U)),E++,f[R]=O)}if(this._touches=f,this._shouldBePrevented(E)||!w.mag())return;const D=w.div(E);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[f,v]=this._firstTwoTouches,w=Ds(c,a,f),E=Ds(c,a,v);if(!w||!E)return;const D=this._aroundCenter?null:w.add(E).div(2);return this._move([w,E],D,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[f,v]=this._firstTwoTouches,w=Ds(c,a,f),E=Ds(c,a,v);w&&E||(this._active&&ae.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ds(y,t,a){for(let c=0;c<y.length;c++)if(y[c].identifier===a)return t[c]}function fd(y,t){return Math.log(y/t)/Math.LN2}class Ps extends cu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(fd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fd(this._distance,c),pinchAround:a}}}function ph(y,t){return 180*y.angleWith(t)/Math.PI}class uu extends cu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,c){const f=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ph(this._vector,f),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=ph(t,this._startVector);return Math.abs(c)<a}}function Is(y){return Math.abs(y.y)>Math.abs(y.x)}class Ks extends cu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Is(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,v,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,v=a.mag()>=2;if(!f&&!v)return;if(!f||!v)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return Is(t)&&Is(a)&&w}}const ka={panStep:100,bearingStep:15,pitchStep:10};class Vn{constructor(t){this._tr=new Ka(t);const a=ka;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,f=0,v=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:E=>{const D=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:pd,zoom:a?Math.round(D.zoom)+a*(t.shiftKey?2:1):D.zoom,bearing:D.bearing+c*this._bearingStep,pitch:D.pitch+f*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:D.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pd(y){return y*(2-y)}const Qs=4.000244140625,Po=1/450;class hu{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new Ka(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Po}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=pe(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%Qs==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ae.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(l.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const E=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=E),typeof this._targetZoom=="number"&&(this._targetZoom+=E)}if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Qs?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&D!==0&&(D=1/D);const R=typeof this._targetZoom!="number"?t.scale:l.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),l.at(R*D)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,f=this._easing;let v,w=!1;if(this._type==="wheel"&&c&&f){const E=pe()-this._lastWheelEventTime,D=Math.min((E+5)/200,1),R=f(D);v=l.G.number(c,a,R),D<1?this._frameId||(this._frameId=!0):w=!0}else v=a,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=v,{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=l.cy;if(this._prevEase){const c=this._prevEase,f=(pe()-c.start)/c.duration,v=c.easing(f+.01)-c.easing(f),w=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-w*w);a=l.cw(w,E,.25,1)}return this._prevEase={start:pe(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class mh{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hl{constructor(t){this._tr=new Ka(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class du{constructor(){this._tap=new ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const f=a[0],v=t.timeStamp-this._tapTime<500,w=this._tapPoint.dist(f)<30;v&&w?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=a[0],v=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(t,a,c);f&&(this._tapTime=t.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class md{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ga{constructor(t,a,c,f){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class dl{constructor(t,a,c,f){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Lt{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=ae.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=c,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ae.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Vt=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class Ra extends l.l{}function ac(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class fu{constructor(t,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,v)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=f.type==="renderFrame"?void 0:f,E={needsRenderFrame:!1},D={},R={};for(const{handlerName:j,handler:H,allowed:K}of this._handlers){if(!H.isEnabled())continue;let se;if(this._blockedByActive(R,K,j))H.reset();else if(H[v||f.type]){if(l.cz(f,v||f.type)){const le=ae.mousePos(this._map.getCanvas(),f);se=H[v||f.type](f,le)}else if(l.cA(f,v||f.type)){const le=this._getMapTouches(f.touches),oe=ae.touchPos(this._map.getCanvas(),le);se=H[v||f.type](f,oe,le)}else l.cB(v||f.type)||(se=H[v||f.type](f));this.mergeHandlerResult(E,D,se,j,w),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||H.isActive())&&(R[j]=H)}const O={};for(const j in this._previousActiveHandlers)R[j]||(O[j]=w);this._previousActiveHandlers=R,(Object.keys(O).length||ac(E))&&(this._changes.push([E,D,O]),this._triggerRenderFrame()),(Object.keys(R).length||ac(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=E;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new em(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,v,w]of this._listeners)ae.addEventListener(f,v,f===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,c]of this._listeners)ae.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new uh(a,t));const f=a.boxZoom=new Do(a,t);this._add("boxZoom",f),t.interactive&&t.boxZoom&&f.enable();const v=a.cooperativeGestures=new Lt(a,t.cooperativeGestures);this._add("cooperativeGestures",v),t.cooperativeGestures&&v.enable();const w=new hh(a),E=new hl(a);a.doubleClickZoom=new mh(E,w),this._add("tapZoom",w),this._add("clickZoom",E),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const D=new du;this._add("tapDragZoom",D);const R=a.touchPitch=new Ks(a);this._add("touchPitch",R),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const O=()=>a.project(a.getCenter()),U=(function({enable:ce,clickTolerance:_e,aroundCenter:Ee=!0,minPixelCenterThreshold:me=100,rotateDegreesPerPixelMoved:Ce=.8},Ze){const je=new Cs({checkCorrectEvent:qe=>ae.mouseButton(qe)===0&&qe.ctrlKey||ae.mouseButton(qe)===2&&!qe.ctrlKey});return new Ia({clickTolerance:_e,move:(qe,Ge)=>{const St=Ze();if(Ee&&Math.abs(St.y-qe.y)>me)return{bearingDelta:l.cx(new l.P(qe.x,Ge.y),Ge,St)};let Et=(Ge.x-qe.x)*Ce;return Ee&&Ge.y<St.y&&(Et=-Et),{bearingDelta:Et}},moveStateManager:je,enable:ce,assignEvents:zs})})(t,O),j=(function({enable:ce,clickTolerance:_e,pitchDegreesPerPixelMoved:Ee=-.5}){const me=new Cs({checkCorrectEvent:Ce=>ae.mouseButton(Ce)===0&&Ce.ctrlKey||ae.mouseButton(Ce)===2});return new Ia({clickTolerance:_e,move:(Ce,Ze)=>({pitchDelta:(Ze.y-Ce.y)*Ee}),moveStateManager:me,enable:ce,assignEvents:zs})})(t),H=(function({enable:ce,clickTolerance:_e,rollDegreesPerPixelMoved:Ee=.3},me){const Ce=new Cs({checkCorrectEvent:Ze=>ae.mouseButton(Ze)===2&&Ze.ctrlKey});return new Ia({clickTolerance:_e,move:(Ze,je)=>{const qe=me();let Ge=(je.x-Ze.x)*Ee;return je.y<qe.y&&(Ge=-Ge),{rollDelta:Ge}},moveStateManager:Ce,enable:ce,assignEvents:zs})})(t,O);a.dragRotate=new ga(t,U,j,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",j,["mouseRotate","mouseRoll"]),this._add("mouseRoll",H,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const K=(function({enable:ce,clickTolerance:_e}){const Ee=new Cs({checkCorrectEvent:me=>ae.mouseButton(me)===0&&!me.ctrlKey});return new Ia({clickTolerance:_e,move:(me,Ce)=>({around:Ce,panDelta:Ce.sub(me)}),activateOnStart:!0,moveStateManager:Ee,enable:ce,assignEvents:zs})})(t),se=new fh(t,a);a.dragPan=new md(c,K,se),this._add("mousePan",K),this._add("touchPan",se,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const le=new uu,oe=new Ps;a.touchZoomRotate=new dl(c,oe,le,D),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Of(a));const ue=a.scrollZoom=new hu(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ue,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const ve=a.keyboard=new Vn(a);this._add("keyboard",ve),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const f in t)if(f!==c&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,f,v){if(!c)return;l.e(t,c);const w={handlerName:f,originalEvent:c.originalEvent||v};c.zoomDelta!==void 0&&(a.zoom=w),c.panDelta!==void 0&&(a.drag=w),c.rollDelta!==void 0&&(a.roll=w),c.pitchDelta!==void 0&&(a.pitch=w),c.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},c={};for(const[f,v,w]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(t.rollDelta=(t.rollDelta||0)+f.rollDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),l.e(a,v),l.e(c,w);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const f=this._map,v=f._getTransformForUpdate(),w=f.terrain;if(!(ac(t)||w&&this._terrainMovement))return this._fireEvents(a,c,!0);f._stop(!0);let{panDelta:E,zoomDelta:D,bearingDelta:R,pitchDelta:O,rollDelta:U,around:j,pinchAround:H}=t;H!==void 0&&(j=H),j=j||f.transform.centerPoint,w&&!v.isPointOnMapSurface(j)&&(j=v.centerPoint);const K={panDelta:E,zoomDelta:D,rollDelta:U,pitchDelta:O,bearingDelta:R,around:j};this._map.cameraHelper.useGlobeControls&&!v.isPointOnMapSurface(j)&&(j=v.centerPoint);const se=j.distSqr(v.centerPoint)<.01?v.center:v.screenPointToLocation(E?j.sub(E):j);this._handleMapControls({terrain:w,tr:v,deltasForHelper:K,preZoomAroundLoc:se,combinedEventsInProgress:a,panDelta:E}),f._applyUpdatedTransform(v),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:c,preZoomAroundLoc:f,combinedEventsInProgress:v,panDelta:w}){const E=this._map.cameraHelper;if(E.handleMapControlsRollPitchBearingZoom(c,a),t)return E.useGlobeControls?(this._terrainMovement||!v.drag&&!v.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void E.handleMapControlsPan(c,a,f)):this._terrainMovement||!v.drag&&!v.zoom?void(v.drag&&this._terrainMovement&&w?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(w))):E.handleMapControlsPan(c,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void E.handleMapControlsPan(c,a,f));E.handleMapControlsPan(c,a,f)}_fireEvents(t,a,c){const f=Vt(this._eventsInProgress),v=Vt(t),w={};for(const U in t){const{originalEvent:j}=t[U];this._eventsInProgress[U]||(w[`${U}start`]=j),this._eventsInProgress[U]=t[U]}!f&&v&&this._fireEvent("movestart",v.originalEvent);for(const U in w)this._fireEvent(U,w[U]);v&&this._fireEvent("move",v.originalEvent);for(const U in t){const{originalEvent:j}=t[U];this._fireEvent(U,j)}const E={};let D;for(const U in this._eventsInProgress){const{handlerName:j,originalEvent:H}=this._eventsInProgress[U];this._handlersById[j].isActive()||(delete this._eventsInProgress[U],D=a[j]||H,E[`${U}end`]=D)}for(const U in E)this._fireEvent(U,E[U]);const R=Vt(this._eventsInProgress),O=(f||v)&&!R;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const U=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&U.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(U)}if(c&&O){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!U||!U.essential&&Ae.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:D})),j(this._map.getBearing())&&this._map.resetNorth()):(j(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new l.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Ra("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ui extends l.E{constructor(t,a,c){super(),this._renderFrameCallback=()=>{const f=Math.min((pe()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new l.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,c){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},a),c)}panTo(t,a,c){return this.easeTo(l.e({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(l.e({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)).fire(new l.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(l.e({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,l.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=Kn.convert(t).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,f){const v={top:0,bottom:0,right:0,left:0};if(typeof(f=l.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const R=f.padding;f.padding={top:R,bottom:R,right:R,left:R}}const w=l.e(v,f.padding);f.padding=w;const E=this.transform,D=new Kn(t,a);return this.cameraHelper.cameraForBoxAndBearing(f,w,D,c,E)}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,f,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(t)),this.transform.screenPointToLocation(l.P.convert(a)),c,f),f,v)}_fitInternal(t,a,c){return t?(delete(a=l.e(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let f=!1,v=!1,w=!1;const E=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const D=c.zoom!==E;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(f=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(v=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(w=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new l.l("movestart",a)).fire(new l.l("move",a)),D&&this.fire(new l.l("zoomstart",a)).fire(new l.l("zoom",a)).fire(new l.l("zoomend",a)),f&&this.fire(new l.l("rotatestart",a)).fire(new l.l("rotate",a)).fire(new l.l("rotateend",a)),v&&this.fire(new l.l("pitchstart",a)).fire(new l.l("pitch",a)).fire(new l.l("pitchend",a)),w&&this.fire(new l.l("rollstart",a)).fire(new l.l("roll",a)).fire(new l.l("rollend",a)),this.fire(new l.l("moveend",a))}calculateCameraOptionsFromTo(t,a,c,f=0){const v=l.a9.fromLngLat(t,a),w=l.a9.fromLngLat(c,f),E=w.x-v.x,D=w.y-v.y,R=w.z-v.z,O=Math.hypot(E,D,R);if(O===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(E,D),j=l.at(this.transform.cameraToCenterDistance/O/this.transform.tileSize),H=180*Math.atan2(E,-D)/Math.PI;let K=180*Math.acos(U/O)/Math.PI;return K=R<0?90-K:90+K,{center:w.toLngLat(),elevation:f,zoom:j,pitch:K,bearing:H}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,c,f,v){const w=this.transform.calculateCenterFromCameraLngLatAlt(t,a,c,f);return{center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:c,pitch:f,roll:v}}easeTo(t,a){this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.cy},t)).animate===!1||!t.essential&&Ae.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getBearing(),v=c.pitch,w=c.roll,E="bearing"in t?this._normalizeBearing(t.bearing,f):f,D="pitch"in t?+t.pitch:v,R="roll"in t?this._normalizeBearing(t.roll,w):w,O="padding"in t?t.padding:c.padding,U=l.P.convert(t.offset);let j,H;t.around&&(j=l.V.convert(t.around),H=c.locationToScreenPoint(j));const K={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(c,{bearing:E,pitch:D,roll:R,padding:O,around:j,aroundPoint:H,offsetAsPoint:U,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||f!==E,this._pitching=this._pitching||D!==v,this._rolling=this._rolling||R!==w,this._padding=!c.isPaddingEqual(O),this._zooming=this._zooming||se.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,K),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease((le=>{se.easeFunc(le),this.terrain&&!t.freezeElevation&&this._updateElevation(le),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(le=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,le)}),t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new l.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new l.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(l.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),c=t.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(c<f){const v=this.calculateCameraOptionsFromTo(a,f,t.center,t.elevation);return{pitch:v.pitch,zoom:v.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&a.push((f=>this.transformCameraUpdate(f))),!a.length)return;const c=t.clone();for(const f of a){const v=c.clone(),{center:w,zoom:E,roll:D,pitch:R,bearing:O,elevation:U}=f(v);w&&v.setCenter(w),U!==void 0&&v.setElevation(U),E!==void 0&&v.setZoom(E),D!==void 0&&v.setRoll(D),R!==void 0&&v.setPitch(R),O!==void 0&&v.setBearing(O),c.apply(v)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new l.l("move",t)),this._zooming&&this.fire(new l.l("zoom",t)),this._rotating&&this.fire(new l.l("rotate",t)),this._pitching&&this.fire(new l.l("pitch",t)),this._rolling&&this.fire(new l.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,f=this._rotating,v=this._pitching,w=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new l.l("zoomend",t)),f&&this.fire(new l.l("rotateend",t)),v&&this.fire(new l.l("pitchend",t)),w&&this.fire(new l.l("rollend",t)),this.fire(new l.l("moveend",t))}flyTo(t,a){if(!t.essential&&Ae.prefersReducedMotion){const Ge=l.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ge,a)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cy},t);const c=this._getTransformForUpdate(),f=c.bearing,v=c.pitch,w=c.roll,E=c.padding,D="bearing"in t?this._normalizeBearing(t.bearing,f):f,R="pitch"in t?+t.pitch:v,O="roll"in t?this._normalizeBearing(t.roll,w):w,U="padding"in t?t.padding:c.padding,j=l.P.convert(t.offset);let H=c.centerPoint.add(j);const K=c.screenPointToLocation(H),se=this.cameraHelper.handleFlyTo(c,{bearing:D,pitch:R,roll:O,padding:U,locationAtOffset:K,offsetAsPoint:j,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let le=t.curve;const oe=Math.max(c.width,c.height),ue=oe/se.scaleOfZoom,ve=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(le=Math.sqrt(oe/se.scaleOfMinZoom/ve*2));const ce=le*le;function _e(Ge){const St=(ue*ue-oe*oe+(Ge?-1:1)*ce*ce*ve*ve)/(2*(Ge?ue:oe)*ce*ve);return Math.log(Math.sqrt(St*St+1)-St)}function Ee(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function me(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Ce=_e(!1);let Ze=function(Ge){return me(Ce)/me(Ce+le*Ge)},je=function(Ge){return oe*((me(Ce)*(Ee(St=Ce+le*Ge)/me(St))-Ee(Ce))/ce)/ve;var St},qe=(_e(!0)-Ce)/le;if(Math.abs(ve)<2e-6||!isFinite(qe)){if(Math.abs(oe-ue)<1e-6)return this.easeTo(t,a);const Ge=ue<oe?-1:1;qe=Math.abs(Math.log(ue/oe))/le,je=()=>0,Ze=St=>Math.exp(Ge*le*St)}return t.duration="duration"in t?+t.duration:1e3*qe/("screenSpeed"in t?+t.screenSpeed/le:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==D,this._pitching=R!==v,this._rolling=O!==w,this._padding=!c.isPaddingEqual(U),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease((Ge=>{const St=Ge*qe,Et=1/Ze(St),pt=je(St);this._rotating&&c.setBearing(l.G.number(f,D,Ge)),this._pitching&&c.setPitch(l.G.number(v,R,Ge)),this._rolling&&c.setRoll(l.G.number(w,O,Ge)),this._padding&&(c.interpolatePadding(E,U,Ge),H=c.centerPoint.add(j)),se.easeFunc(Ge,Et,pt,H),this.terrain&&!t.freezeElevation&&this._updateElevation(Ge),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=pe(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=l.W(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(l.V.convert(t),this.transform):null}}const wi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Pi{constructor(t=wi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=ae.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ae.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ae.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ae.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const v=a[f];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter((f=>String(f).trim())),t.sort(((f,v)=>f.length-v.length)),t=t.filter(((f,v)=>{for(let w=v+1;w<t.length;w++)if(t[w].indexOf(f)>=0)return!1;return!0}));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=ae.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pu{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=ae.create("div","maplibregl-ctrl");const a=ae.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ae.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Js{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const f of c)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var pn=l.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Fn extends l.E{constructor(t){super(),this._lastTilesetChange=pe(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const c={};for(const f of di(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),l.c7(f.terrainRttPosMatrix32f,0,l.a5,l.a5,0,0,1),this._tiles[f.key]=new Je(f,this.tileSize),this._lastTilesetChange=pe());for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID,v=t.clone(),w=l.bk();if(f.canonical.equals(t.canonical))l.c7(w,0,l.a5,l.a5,0,0,1);else if(f.canonical.isChildOf(t.canonical)){const E=f.canonical.z-t.canonical.z,D=f.canonical.x-(f.canonical.x>>E<<E),R=f.canonical.y-(f.canonical.y>>E<<E),O=l.a5>>E;l.c7(w,0,O,O,0,0,1),l.O(w,w,[-D*O,-R*O,0])}else{if(!t.canonical.isChildOf(f.canonical))continue;{const E=t.canonical.z-f.canonical.z,D=t.canonical.x-(t.canonical.x>>E<<E),R=t.canonical.y-(t.canonical.y>>E<<E),O=l.a5>>E;l.c7(w,0,l.a5,l.a5,0,0,1),l.O(w,w,[D*O,R*O,0]),l.Q(w,w,[1/2**E,1/2**E,0])}}v.terrainRttPosMatrix32f=new Float32Array(w),a[c]=v}return a}_getTerrainCoordsForTileRanges(t,a){const c={};for(const f of this._renderableTilesKeys){const v=this._tiles[f].tileID;if(!this._isWithinTileRanges(v,a))continue;const w=t.clone(),E=l.bk();if(v.canonical.z===t.canonical.z){const D=t.canonical.x-v.canonical.x,R=t.canonical.y-v.canonical.y;l.c7(E,0,l.a5,l.a5,0,0,1),l.O(E,E,[D*l.a5,R*l.a5,0])}else if(v.canonical.z>t.canonical.z){const D=v.canonical.z-t.canonical.z,R=v.canonical.x-(v.canonical.x>>D<<D),O=v.canonical.y-(v.canonical.y>>D<<D),U=t.canonical.x-(v.canonical.x>>D),j=t.canonical.y-(v.canonical.y>>D),H=l.a5>>D;l.c7(E,0,H,H,0,0,1),l.O(E,E,[-R*H+U*l.a5,-O*H+j*l.a5,0])}else{const D=t.canonical.z-v.canonical.z,R=t.canonical.x-(t.canonical.x>>D<<D),O=t.canonical.y-(t.canonical.y>>D<<D),U=(t.canonical.x>>D)-v.canonical.x,j=(t.canonical.y>>D)-v.canonical.y,H=l.a5<<D;l.c7(E,0,H,H,0,0,1),l.O(E,E,[R*l.a5+U*H,O*l.a5+j*H,0])}w.terrainRttPosMatrix32f=new Float32Array(E),c[f]=w}return c}getSourceTile(t,a){const c=this.tileManager._source;let f=t.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let v=this.findTileInCaches(this._sourceTileCache[t.key]);if(!v?.dem&&a)for(;f>=c.minzoom&&!v?.dem;)v=this.findTileInCaches(t.scaledTo(f--).key);return v}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class fn{constructor(t,a,c){this._meshCache={},this.painter=t,this.tileManager=new Fn(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,f=l.a5){var v;if(!(a>=0&&a<f&&c>=0&&c<f))return 0;const w=this.getTerrainData(t),E=(v=w.tile)===null||v===void 0?void 0:v.dem;if(!E)return 0;const D=l.cC([],[a/f*l.a5,c/f*l.a5],w.u_terrain_matrix),R=[D[0]*E.dim,D[1]*E.dim],O=Math.floor(R[0]),U=Math.floor(R[1]),j=R[0]-O,H=R[1]-U;return E.get(O,U)*(1-j)*(1-H)+E.get(O+1,U)*j*(1-H)+E.get(O,U+1)*(1-j)*H+E.get(O+1,U+1)*j*H}getElevationForLngLatZoom(t,a){if(!l.cD(a,t.wrap()))return 0;const{tileID:c,mercatorX:f,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,f%l.a5,v%l.a5,l.a5)}getElevationForLngLat(t,a){const c=di(a,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let f=0;for(const v of c)v.canonical.z>f&&(f=Math.min(v.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,f)}getElevation(t,a,c,f=l.a5){return this.getDEMElevation(t,a,c,f)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.painter.context,v=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(f,v,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(f,new l.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ar([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new l.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a.toString()+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const f=this.tileManager.getSource().maxzoom;let v=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?v=t.canonical.z-f:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>v<<v),E=t.canonical.y-(t.canonical.y>>v<<v),D=l.cE(new Float64Array(16),[1/(l.a5<<v),1/(l.a5<<v),0]);l.O(D,D,[w*l.a5,E*l.a5,0]),this._demMatrixCache[t.key]={matrix:D,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(a.context,{width:c,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let E=0;E<this._coordsTextureSize;E++,w+=4)a[w+0]=255&E,a[w+1]=255&v,a[w+2]=E>>8<<4|v>>8,a[w+3]=0;const c=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new l.T(t,c,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,f=c.gl,v=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(v,E-w-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const D=a[0]+(a[2]>>4<<8),R=a[1]+((15&a[2])<<8),O=this.coordsIndex[255-a[3]],U=O&&this.tileManager.getTileByID(O);if(!U)return null;const j=this._coordsTextureSize,H=(1<<U.tileID.canonical.z)*j;return new l.a9((U.tileID.canonical.x*j+D)/H+U.tileID.wrap,(U.tileID.canonical.y*j+R)/H,this.getElevation(U.tileID,D,R,j))}depthAtPoint(t){const a=new Uint8Array(4),c=this.painter.context,f=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=c&&t.canonical.y===0,v=c&&t.canonical.y===(1<<t.canonical.z)-1,w=`m_${f?"n":""}_${v?"s":""}`;if(this._meshCache[w])return this._meshCache[w];const E=this.painter.context,D=new l.cF,R=new l.aY,O=this.meshSize,U=l.a5/O,j=O*O;for(let me=0;me<=O;me++)for(let Ce=0;Ce<=O;Ce++)D.emplaceBack(Ce*U,me*U,0);for(let me=0;me<j;me+=O+1)for(let Ce=0;Ce<O;Ce++)R.emplaceBack(Ce+me,O+Ce+me+1,O+Ce+me+2),R.emplaceBack(Ce+me,O+Ce+me+2,Ce+me+1);const H=D.length,K=H+(O+1),se=(O+1)*O,le=f?l.br:0,oe=f?0:1,ue=v?l.bs:l.a5,ve=v?0:1;for(let me=0;me<=O;me++)D.emplaceBack(me*U,le,oe);for(let me=0;me<=O;me++)D.emplaceBack(me*U,ue,ve);for(let me=0;me<O;me++)R.emplaceBack(se+me,K+me,K+me+1),R.emplaceBack(se+me,K+me+1,se+me+1),R.emplaceBack(0+me,H+me+1,H+me),R.emplaceBack(0+me,0+me+1,H+me+1);const ce=D.length,_e=ce+2*(O+1);for(const me of[0,1])for(let Ce=0;Ce<=O;Ce++)for(const Ze of[0,1])D.emplaceBack(me*l.a5,Ce*U,Ze);for(let me=0;me<2*O;me+=2)R.emplaceBack(ce+me,ce+me+1,ce+me+3),R.emplaceBack(ce+me,ce+me+3,ce+me+2),R.emplaceBack(_e+me,_e+me+3,_e+me+1),R.emplaceBack(_e+me,_e+me+2,_e+me+3);const Ee=new Qn(E.createVertexBuffer(D,pn.members),E.createIndexBuffer(R),l.aX.simpleSegment(0,0,D.length,R.length));return this._meshCache[w]=Ee,Ee}getMeshFrameDelta(t){return 2*Math.PI*l.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var c;if(!l.cD(a,t.wrap()))return 0;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=l.a9.fromLngLat(t.wrap()),f=(1<<a)*l.a5,v=c.x*f,w=c.y*f,E=Math.floor(v/l.a5),D=Math.floor(w/l.a5);return{tileID:new l.a2(a,0,a,E,D),mercatorX:v,mercatorY:w}}}class gi{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const La={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ja{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new gi(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((c=>!t._layers[c].isHidden(a))),this._coordsAscending={};for(const c in t.tileManagers){this._coordsAscending[c]={};const f=t.tileManagers[c].getVisibleCoordinates(),v=t.tileManagers[c].getSource(),w=v instanceof nr?v.terrainTileRanges:null;for(const E of f){const D=this.terrain.tileManager.getTerrainCoords(E,w);for(const R in D)this._coordsAscending[c][R]||(this._coordsAscending[c][R]=[]),this._coordsAscending[c][R].push(D[R])}}this._coordsAscendingStr={};for(const c of t._order){const f=t._layers[c],v=f.source;if(La[f.type]&&!this._coordsAscendingStr[v]){this._coordsAscendingStr[v]={};for(const w in this._coordsAscending[v])this._coordsAscendingStr[v][w]=this._coordsAscending[v][w].map((E=>E.key)).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsAscendingStr){const v=this._coordsAscendingStr[f][c.tileID.key];v&&v!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=t.type,v=this.painter,w=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(La[f]&&(this._prevType&&La[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!w))return!0;if(La[this._prevType]||La[f]&&w){this._prevType=f;const E=this._stacks.length-1,D=this._stacks[E]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(lh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[E]){const U=this.pool.getObjectForId(R.rtt[E].id);if(U.stamp===R.rtt[E].stamp){this.pool.useObject(U);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),R.rtt[E]={id:O.id,stamp:O.stamp},v.context.bindFramebuffer.set(O.fbo.framebuffer),v.context.clear({color:l.bp.transparent,stencil:0}),v.currentStencilSource=void 0;for(let U=0;U<D.length;U++){const j=v.style._layers[D[U]],H=j.source?this._coordsAscending[j.source][R.tileID.key]:[R.tileID];v.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),v._renderTileClippingMasks(j,H,!0),v.renderLayer(v,v.style.tileManagers[j.source],j,H,c),j.source&&(R.rttCoords[j.source]=this._coordsAscendingStr[j.source][R.tileID.key])}}return lh(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),La[f]}return!1}}const fl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pl=N,eo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:wi,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},gd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ci{constructor(t,a,c=!1){this.mousedown=v=>{this.startMove(v,ae.mousePos(this.element,v)),ae.addEventListener(window,"mousemove",this.mousemove),ae.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.move(v,ae.mousePos(this.element,v))},this.mouseup=v=>{this._rotatePitchHandler.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ae.touchPos(this.element,v.targetTouches)[0],this.startMove(v,this._startPos),ae.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ae.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=ae.touchPos(this.element,v.targetTouches)[0],this.move(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new lu;this._rotatePitchHandler=new Ia({clickTolerance:3,move:(v,w)=>{const E=a.getBoundingClientRect(),D=new l.P((E.bottom-E.top)/2,(E.right-E.left)/2);return{bearingDelta:l.cx(new l.P(v.x,w.y),w,D),pitchDelta:c?-.5*(w.y-v.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=t,ae.addEventListener(a,"mousedown",this.mousedown),ae.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ae.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),ae.disableDrag()}move(t,a){const c=this.map,{bearingDelta:f,pitchDelta:v}=this._rotatePitchHandler.dragMove(t,a)||{};f&&c.setBearing(c.getBearing()+f),v&&c.setPitch(c.getPitch()+v)}off(){const t=this.element;ae.removeEventListener(t,"mousedown",this.mousedown),ae.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ae.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ae.removeEventListener(window,"touchend",this.touchend),ae.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ae.enableDrag(),ae.removeEventListener(window,"mousemove",this.mousemove),ae.removeEventListener(window,"mouseup",this.mouseup),ae.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ae.removeEventListener(window,"touchend",this.touchend)}}let es;function sc(y,t,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return y?.wrap();const f=new l.V(y.lng,y.lat);if(y=new l.V(y.lng,y.lat),t){const v=new l.V(y.lng-360,y.lat),w=new l.V(y.lng+360,y.lat),E=a.locationToScreenPoint(y).distSqr(t);a.locationToScreenPoint(v).distSqr(t)<E?y=v:a.locationToScreenPoint(w).distSqr(t)<E&&(y=w)}for(;Math.abs(y.lng-a.center.lng)>180;){const v=a.locationToScreenPoint(y);if(v.x>=0&&v.y>=0&&v.x<=a.width&&v.y<=a.height)break;y.lng>a.center.lng?y.lng-=360:y.lng+=360}return y.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(y))?y:f}const oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mu(y,t,a){const c=y.classList;for(const f in oc)c.remove(`maplibregl-${a}-anchor-${f}`);c.add(`maplibregl-${a}-anchor-${t}`)}class gu extends l.E{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,f=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=sc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),ae.setTransform(this._element,`${oc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${f}`),Ae.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ae.create("div");const a=ae.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const v=ae.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const w=ae.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const E=ae.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of D){const ue=ae.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",oe.rx),ue.setAttributeNS(null,"ry",oe.ry),E.appendChild(ue)}const R=ae.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const O=ae.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(O);const U=ae.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const j=ae.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(j);const H=ae.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const K=ae.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=ae.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const le=ae.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),K.appendChild(se),K.appendChild(le),w.appendChild(E),w.appendChild(R),w.appendChild(U),w.appendChild(H),w.appendChild(K),a.appendChild(w),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),mu(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ae.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,c;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,v=this._map.transform.isLocationOccluded(this._lngLat);if(!f||v){const H=v?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==H&&(this._element.style.opacity=H))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const w=this._map,E=w.terrain.depthAtPoint(this._pos),D=w.terrain.getElevationForLngLat(this._lngLat,w.transform);if(w.transform.lngLatToCameraDepth(this._lngLat,D)-E<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/w.transform.pixelsPerMeter,O=Math.sin(w.getPitch()*Math.PI/180)*R,U=w.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),j=w.transform.lngLatToCameraDepth(this._lngLat,D+O)-U>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&j&&this._popup.remove(),this._element.style.opacity=j?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const yu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Io=0,to=!1;const wr={maxWidth:100,unit:"metric"};function yi(y,t,a){const c=a&&a.maxWidth||100,f=y._container.clientHeight/2,v=y._container.clientWidth/2,w=y.unproject([v-c/2,f]),E=y.unproject([v+c/2,f]),D=Math.round(y.project(E).x-y.project(w).x),R=Math.min(c,D,y._container.clientWidth),O=w.distanceTo(E);if(a&&a.unit==="imperial"){const U=3.2808*O;U>5280?ks(t,R,U/5280,y._getUIString("ScaleControl.Miles")):ks(t,R,U,y._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?ks(t,R,O/1852,y._getUIString("ScaleControl.NauticalMiles")):O>=1e3?ks(t,R,O/1e3,y._getUIString("ScaleControl.Kilometers")):ks(t,R,O,y._getUIString("ScaleControl.Meters"))}function ks(y,t,a,c){const f=(function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let E=v/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(D){const R=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*R)/R})(E),w*E})(a);y.style.width=t*(f/a)+"px",y.innerHTML=`${f}&nbsp;${c}`}const ml={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lc(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-y),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const t=l.P.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return lc(new l.P(0,0))}const ts=N;A.AJAXError=l.cI,A.Event=l.l,A.Evented=l.E,A.LngLat=l.V,A.MercatorCoordinate=l.a9,A.Point=l.P,A.addProtocol=l.cJ,A.config=l.c,A.removeProtocol=l.cK,A.AttributionControl=Pi,A.BoxZoomHandler=Do,A.CanvasSource=Z,A.CooperativeGesturesHandler=Lt,A.DoubleClickZoomHandler=mh,A.DragPanHandler=md,A.DragRotateHandler=ga,A.EdgeInsets=oa,A.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ae.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=ae.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ae.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},A.GeoJSONSource=xi,A.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new l.V(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,f=this._map.getBearing(),v=l.e({bearing:f},this.options.fitBoundsOptions),w=Kn.fromLngLat(a,c);this._map.fitBounds(w,v,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new l.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&to)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=ae.create("button","maplibregl-ctrl-geolocate",this._container),ae.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ae.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gu({element:this._dotElement}),this._circleElement=ae.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},yu,y)}onAdd(y){return this._map=y,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(t=!1){if(es!==void 0&&!t)return es;if(window.navigator.permissions===void 0)return es=!!window.navigator.geolocation,es;try{es=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{es=!!window.navigator.geolocation}return es}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ae.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Io=0,to=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),a=y.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const y=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&y))return;const t=this._map.project(y),a=this._map.unproject([t.x+100,t.y]),c=y.distanceTo(a)/100,f=2*this._accuracy/c;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Io--,to=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Io++,Io>1?(y={maximumAge:6e5,timeout:0},to=!0):(y=this.options.positionOptions,to=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},A.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const t=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ae.create("button","maplibregl-ctrl-globe",this._container),ae.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ae.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},A.Hash=ji,A.ImageSource=nr,A.KeyboardHandler=Vn,A.LngLatBounds=Kn,A.LogoControl=pu,A.Map=class extends Ui{constructor(y){var t,a;l.cG.mark(l.cH.create);const c=Object.assign(Object.assign(Object.assign({},eo),y),{canvasContextAttributes:Object.assign(Object.assign({},eo.canvasContextAttributes),y.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new Qi,v=new Qo;if(c.minZoom!==void 0&&f.setMinZoom(c.minZoom),c.maxZoom!==void 0&&f.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&f.setMinPitch(c.minPitch),c.maxPitch!==void 0&&f.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&f.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&f.setConstrainOverride(c.transformConstrain),super(f,v,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Js,this._controls=[],this._mapId=l.af(),this._lostContextStyle={style:null,images:null},this._contextLost=E=>{E.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const D of Object.values(this.style._layers))if(D.type==="custom"&&console.warn(`Custom layer with id '${D.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),D._listeners)for(const[R]of Object.entries(D._listeners))console.warn(`Custom layer with id '${D.id}' had event listeners for event '${R}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:E}))},this._contextRestored=E=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:E}))},this._onMapScroll=E=>{if(E.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},fl),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(Ae.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=ot.addThrottleControl((()=>this.isMoving())),this._requestManager=new Pe(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let E=!1;const D=dd((R=>{this._trackResize&&!this._removed&&(this.resize(R),this.redraw())}),50);this._resizeObserver=new ResizeObserver((R=>{E?D(R):E=!0})),this._resizeObserver.observe(this._container)}this.handlers=new fu(this,c),this._hash=c.hash&&new ji(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,l.e({},c.fitBoundsOptions,{duration:0}))));const w=typeof c.style=="string"||((a=(t=c.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,w),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Pi(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new pu,c.logoPosition),this.on("style.load",(()=>{if(w||this._resizeTransform(),this.transform.unmodified){const E=l.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(E)}})),this.on("data",(E=>{this._update(E.dataType==="style"),this.fire(new l.l(`${E.dataType}data`,E))})),this.on("dataloading",(E=>{this.fire(new l.l(`${E.dataType}dataloading`,E))})),this.on("dataabort",(E=>{this.fire(new l.l("sourcedataabort",E))}))}_getMapId(){return this._mapId}setGlobalStateProperty(y,t){return this.style.setGlobalStateProperty(y,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=y.onAdd(this);this._controls.push(y);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}coveringTiles(y){return di(this.transform,y)}calculateCameraOptionsFromTo(y,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLat(a,this.transform)),super.calculateCameraOptionsFromTo(y,t,a,c)}resize(y,t=!0){const[a,c]=this._containerDimensions(),f=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,f),this.painter.resize(a,c,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const E=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,E),this.painter.resize(a,c,E)}this._resizeTransform(t);const v=!this._moving;return v&&(this.stop(),this.fire(new l.l("movestart",y)).fire(new l.l("move",y))),this.fire(new l.l("resize",y)),v&&this.fire(new l.l("moveend",y)),this}_resizeTransform(y=!0){var t;const[a,c]=this._containerDimensions();this.transform.resize(a,c,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c,y)}_getClampedPixelRatio(y,t){const{0:a,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),v=y*f,w=t*f;return Math.min(v>a?a/v:1,w>c?c/w:1)*f}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Kn.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(y),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.setMinPitch(y),this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch)return this.transform.setMaxPitch(y),this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}setTransformConstrain(y){return this.transform.setConstrainOverride(y),this._update()}project(y){return this.transform.locationToScreenPoint(l.V.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,a){if(y==="mouseenter"||y==="mouseover"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:v=>{const w=t.filter((D=>this.getLayer(D))),E=w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[];E.length?c||(c=!0,a.call(this,new sr(y,this,v.originalEvent,{features:E}))):c=!1},mouseout:()=>{c=!1}}}}if(y==="mouseleave"||y==="mouseout"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:w=>{const E=t.filter((D=>this.getLayer(D)));(E.length!==0?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?c=!0:c&&(c=!1,a.call(this,new sr(y,this,w.originalEvent)))},mouseout:w=>{c&&(c=!1,a.call(this,new sr(y,this,w.originalEvent)))}}}}{const c=f=>{const v=t.filter((E=>this.getLayer(E))),w=v.length!==0?this.queryRenderedFeatures(f.point,{layers:v}):[];w.length&&(f.features=w,a.call(this,f),delete f.features)};return{layers:t,listener:a,delegates:{[y]:c}}}}_saveDelegatedListener(y,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(t)}_removeDelegatedListener(y,t,a){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const c=this._delegatedListeners[y];for(let f=0;f<c.length;f++){const v=c[f];if(v.listener===a&&v.layers.length===t.length&&v.layers.every((w=>t.includes(w)))){for(const w in v.delegates)this.off(w,v.delegates[w]);return void c.splice(f,1)}}}on(y,t,a){if(a===void 0)return super.on(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);this._saveDelegatedListener(y,f);for(const v in f.delegates)this.on(v,f.delegates[v]);return{unsubscribe:()=>{this._removeDelegatedListener(y,c,a)}}}once(y,t,a){if(a===void 0)return super.once(y,t);const c=typeof t=="string"?[t]:t,f=this._createDelegatedListener(y,c,a);for(const v in f.delegates){const w=f.delegates[v];f.delegates[v]=(...E)=>{this._removeDelegatedListener(y,c,a),w(...E)}}this._saveDelegatedListener(y,f);for(const v in f.delegates)this.once(v,f.delegates[v]);return this}off(y,t,a){return a===void 0?super.off(y,t):(this._removeDelegatedListener(y,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let a;const c=y instanceof l.P||Array.isArray(y),f=c?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:y)||{},f instanceof l.P||typeof f[0]=="number")a=[l.P.convert(f)];else{const v=l.P.convert(f[0]),w=l.P.convert(f[1]);a=[v,new l.P(w.x,v.y),w,new l.P(v.x,w.y),v]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){var a,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(y,t)));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new xo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,f):this.style.loadJSON(y,t,f),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const a=this._requestManager.transformRequest(y,"Style");l.j(a,new AbortController).then((c=>{this._updateDiff(c.data,t)})).catch((c=>{c&&this.fire(new l.k(c))}))}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(a){l.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.tileManagers[y];if(t!==void 0)return t.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.tileManagers[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===y.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fn(this.painter,t,y),this.painter.renderToTexture=new Ja(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.tileManagers;for(const t of Object.values(y))if(!t.areTilesLoaded())return!1;return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}setSourceTileLodParams(y,t,a){if(a){const c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=In(Math.max(1,y),Math.max(1,t))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=In(Math.max(1,y),Math.max(1,t));return this._update(!0),this}refreshTiles(y,t){const a=this.style.tileManagers[y];if(!a)throw new Error(`There is no tile manager with ID "${y}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((c=>new l.ac(c.z,c.x,c.y))))}addImage(y,t,a={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:v,stretchY:w,content:E,textFitWidth:D,textFitHeight:R}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:U,data:j}=t,H=t;return this.style.addImage(y,{data:new l.R({width:O,height:U},new Uint8Array(j)),pixelRatio:c,stretchX:v,stretchY:w,content:E,textFitWidth:D,textFitHeight:R,sdf:f,version:0,userImage:H}),H.onAdd&&H.onAdd(this,y),this}}{const{width:O,height:U,data:j}=Ae.getImageData(t);this.style.addImage(y,{data:new l.R({width:O,height:U},j),pixelRatio:c,stretchX:v,stretchY:w,content:E,textFitWidth:D,textFitHeight:R,sdf:f,version:0})}}updateImage(y,t){const a=this.style.getImage(y);if(!a)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.b(t)?Ae.getImageData(t):t,{width:f,height:v,data:w}=c;if(f===void 0||v===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||v!==a.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||l.b(t));return a.data.replace(w,E),this.style.updateImage(y,a),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return ot.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,t,a){return this.style.setLayerZoomRange(y,t,a),this._update(!0)}setFilter(y,t,a={}){return this.style.setFilter(y,t,a),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,a,c={}){return this.style.setPaintProperty(y,t,a,c),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,a,c={}){return this.style.setLayoutProperty(y,t,a,c),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,a,(c=>{c||this._update(!0)})),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,(a=>{a||this._update(!0)})),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=ae.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=ae.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const f=this._controlContainer=ae.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{v[w]=ae.create("div",`maplibregl-ctrl-${w} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,t,a){this._canvas.width=Math.floor(a*y),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{t={requestedAttributes:y},c&&(t.statusMessage=c.statusMessage,t.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new Lf(a,this.transform),ke.testSupport(a)}migrateProjection(y,t){super.migrateProjection(y,t),this.painter.transform=y,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var t,a,c,f,v;const w=this._idleTriggered?this._fadeDuration:0,E=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,j=pe();this.style.zoomHistory.update(U,j);const H=new l.H(U,{now:j,fadeDuration:w,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=H.crossFadingFactor();K===1&&K===this._crossFadingFactor||(D=!0,this._crossFadingFactor=K),this.style.update(H)}const R=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==E;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(v=this.style.projection)===null||v===void 0?void 0:v.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||R)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,R),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cG.mark(l.cH.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const O=this._sourcesDirty||this._styleDirty||this._placementDirty;return O||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,l.cG.mark(l.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ot.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ae.remove(this._canvasContainer),ae.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cG.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ae.frame(this._frameRequest,(y=>{l.cG.frame(y),this._frameRequest=null;try{this._render(y)}catch(t){if(!l.Z(t)&&!(function(a){return a.message===Co})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return pl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},A.MapMouseEvent=sr,A.MapTouchEvent=Wa,A.MapWheelEvent=ch,A.Marker=gu,A.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=l.e({},gd,y),this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),ae.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),ae.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=ae.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ci(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ae.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const a=ae.create("button",y,this._container);return a.type="button",a.addEventListener("click",t),a}},A.Popup=class extends l.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ae.remove(this._content),this._container&&(ae.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ae.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ae.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=sc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const f=lc(this.options.offset);if(!c){const w=this._container.offsetWidth,E=this._container.offsetHeight;let D;D=a.y+f.bottom.y<E?["top"]:a.y>this._map.transform.height-E?["bottom"]:[],a.x<w/2?D.push("left"):a.x>this._map.transform.width-w/2&&D.push("right"),c=D.length===0?"bottom":D.join("-")}let v=a.add(f[c]);this.options.subpixelPositioning||(v=v.round()),ae.setTransform(this._container,`${oc[c]} translate(${v.x}px,${v.y}px)`),mu(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(ml),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.V.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=y;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ae.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=ae.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(gl);y&&y.focus()}},A.RasterDEMTileSource=xn,A.RasterTileSource=li,A.ScaleControl=class{constructor(y){this._onMove=()=>{yi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,yi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wr),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ae.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},A.ScrollZoomHandler=hu,A.Style=xo,A.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ae.create("button","maplibregl-ctrl-terrain",this._container),ae.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ae.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},A.TwoFingersTouchPitchHandler=Ks,A.TwoFingersTouchRotateHandler=uu,A.TwoFingersTouchZoomHandler=Ps,A.TwoFingersTouchZoomRotateHandler=dl,A.VectorTileSource=Gr,A.VideoSource=fe,A.addSourceType=(y,t)=>l._(void 0,void 0,void 0,(function*(){if(Q(y))throw new Error(`A source type called "${y}" already exists.`);((a,c)=>{X[a]=c})(y,t)})),A.clearPrewarmedResources=function(){const y=Yt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Dt),Yt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},A.createTileMesh=wf,A.getMaxParallelImageRequests=function(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS},A.getRTLTextPluginStatus=function(){return Re().getRTLTextPluginStatus()},A.getVersion=function(){return ts},A.getWorkerCount=function(){return jt.workerCount},A.getWorkerUrl=function(){return l.c.WORKER_URL},A.importScriptInWorkers=function(y){return br().broadcast("IS",y)},A.isTimeFrozen=function(){return Ie.isFrozen()},A.now=pe,A.prewarm=function(){Kt().acquire(Dt)},A.restoreNow=function(){Ie.restoreNow()},A.setMaxParallelImageRequests=function(y){l.c.MAX_PARALLEL_IMAGE_REQUESTS=y},A.setNow=function(y){Ie.setNow(y)},A.setRTLTextPlugin=function(y,t){return Re().setRTLTextPlugin(y,t)},A.setWorkerCount=function(y){jt.workerCount=y},A.setWorkerUrl=function(y){l.c.WORKER_URL=y}}));var k=b;return k}))})(vy)),vy.exports}var Qb=fA();const Jb=ky(Qb),pA=z1({__proto__:null,default:Jb},[Qb]),Ol={PARKING_LOG:31417,OPEN_SPOT_BROADCAST:31714,ROUTE_LOG:34171},Go=["wss://relay.damus.io","wss://nos.lol","wss://relay.primal.net","wss://relay.snort.social"];var k_={},Vv;function mA(){if(Vv)return k_;Vv=1;var h=function(){},m="+",b=8,S="0",z="23456789CFGHJMPQRVWX",k=z.length,A=90,l=180,N=10,W=[20,1,.05,.0025,125e-6],ne=4,re=5,xe=125e-6,Ae=6;h.prototype.isValid=function(Pe){if(!Pe||Pe.indexOf(m)==-1||Pe.indexOf(m)!=Pe.lastIndexOf(m)||Pe.length==1||Pe.indexOf(m)>b||Pe.indexOf(m)%2==1)return!1;if(Pe.indexOf(S)>-1){if(Pe.indexOf(S)==0)return!1;var rt=Pe.match(new RegExp("("+S+"+)","g"));if(rt.length>1||rt[0].length%2==1||rt[0].length>b-2||Pe.charAt(Pe.length-1)!=m)return!1}if(Pe.length-Pe.indexOf(m)-1==1)return!1;Pe=Pe.replace(new RegExp("\\"+m+"+"),"").replace(new RegExp(S+"+"),"");for(var nt=0,ct=Pe.length;nt<ct;nt++){var Tt=Pe.charAt(nt).toUpperCase();if(Tt!=m&&z.indexOf(Tt)==-1)return!1}return!0},h.prototype.isShort=function(Pe){return this.isValid(Pe)?Pe.indexOf(m)>=0&&Pe.indexOf(m)<b:!1},h.prototype.isFull=function(Pe){if(!this.isValid(Pe)||this.isShort(Pe))return!1;var rt=z.indexOf(Pe.charAt(0).toUpperCase())*k;if(rt>=A*2)return!1;if(Pe.length>1){var nt=z.indexOf(Pe.charAt(1).toUpperCase())*k;if(nt>=l*2)return!1}return!0},h.prototype.encode=function(Pe,rt,nt){if(typeof nt>"u"&&(nt=N),nt<2||nt<b&&nt%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";Pe=Ie(Pe),rt=ae(rt),Pe==90&&(Pe=Pe-pe(nt));var ct=ke(Pe,rt,Math.min(nt,N));return nt>N&&(ct+=Ke(Pe,rt,nt-N)),ct},h.prototype.decode=function(Pe){if(!this.isFull(Pe))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+Pe;Pe=Pe.replace(m,""),Pe=Pe.replace(new RegExp(S+"+"),""),Pe=Pe.toUpperCase();var rt=at(Pe.substring(0,N));if(Pe.length<=N)return rt;var nt=wt(Pe.substring(N));return ut(rt.latitudeLo+nt.latitudeLo,rt.longitudeLo+nt.longitudeLo,rt.latitudeLo+nt.latitudeHi,rt.longitudeLo+nt.longitudeHi,rt.codeLength+nt.codeLength)},h.prototype.recoverNearest=function(Pe,rt,nt){if(!this.isShort(Pe)){if(this.isFull(Pe))return Pe;throw"ValueError: Passed short code is not valid: "+Pe}rt=Ie(rt),nt=ae(nt),Pe=Pe.toUpperCase();var ct=b-Pe.indexOf(m),Tt=Math.pow(20,2-ct/2),Nt=Tt/2,qt=Math.floor(rt/Tt)*Tt,ht=Math.floor(nt/Tt)*Tt,Se=this.decode(this.encode(qt,ht).substr(0,ct)+Pe),Xe=Se.latitudeCenter-rt;return Xe>Nt?Se.latitudeCenter-=Tt:Xe<-Nt&&(Se.latitudeCenter+=Tt),Xe=Se.longitudeCenter-nt,Xe>Nt?Se.longitudeCenter-=Tt:Xe<-Nt&&(Se.longitudeCenter+=Tt),this.encode(Se.latitudeCenter,Se.longitudeCenter,Se.codeLength)},h.prototype.shorten=function(ct,rt,nt){if(!this.isFull(ct))throw"ValueError: Passed code is not valid and full: "+ct;if(ct.indexOf(S)!=-1)throw"ValueError: Cannot shorten padded codes: "+ct;var ct=ct.toUpperCase(),Tt=this.decode(ct);if(Tt.codeLength<Ae)throw"ValueError: Code length must be at least "+Ae;rt=Ie(rt),nt=ae(nt);for(var Nt=Math.max(Math.abs(Tt.latitudeCenter-rt),Math.abs(Tt.longitudeCenter-nt)),qt=W.length-2;qt>=1;qt--)if(Nt<W[qt]*.3)return ct.substring((qt+1)*2);return ct};var Ie=function(Pe){return Math.min(90,Math.max(-90,Pe))},pe=function(Pe){return Pe<=10?Math.pow(20,Math.floor(Pe/-2+2)):Math.pow(20,-3)/Math.pow(re,Pe-10)},ae=function(Pe){for(;Pe<-180;)Pe=Pe+360;for(;Pe>=180;)Pe=Pe-360;return Pe},ke=function(Pe,rt,nt){for(var ct="",Tt=Pe+A,Nt=rt+l,qt=0;qt<nt;){var ht=W[Math.floor(qt/2)],Se=Math.floor(Tt/ht);Tt-=Se*ht,ct+=z.charAt(Se),qt+=1,Se=Math.floor(Nt/ht),Nt-=Se*ht,ct+=z.charAt(Se),qt+=1,qt==b&&qt<nt&&(ct+=m)}return ct.length<b&&(ct=ct+Array(b-ct.length+1).join(S)),ct.length==b&&(ct=ct+m),ct},Ke=function(Pe,rt,nt){for(var ct="",Tt=xe,Nt=xe,qt=(Pe+A)%Tt,ht=(rt+l)%Nt,Se=0;Se<nt;Se++){var Xe=Math.floor(qt/(Tt/re)),_t=Math.floor(ht/(Nt/ne));Tt/=re,Nt/=ne,qt-=Xe*Tt,ht-=_t*Nt,ct+=z.charAt(Xe*ne+_t)}return ct},at=function(Pe){var rt=zt(Pe,0),nt=zt(Pe,1);return new ut(rt[0]-A,nt[0]-l,rt[1]-A,nt[1]-l,Pe.length)},zt=function(Pe,rt){for(var nt=0,ct=0;nt*2+rt<Pe.length;)ct+=z.indexOf(Pe.charAt(nt*2+rt))*W[nt],nt+=1;return[ct,ct+W[nt-1]]},wt=function(Pe){for(var rt=0,nt=0,ct=xe,Tt=xe,Nt=0;Nt<Pe.length;){var qt=z.indexOf(Pe.charAt(Nt)),ht=Math.floor(qt/ne),Se=qt%ne;ct/=re,Tt/=ne,rt+=ht*ct,nt+=Se*Tt,Nt+=1}return ut(rt,nt,rt+ct,nt+Tt,Pe.length)},ut=h.prototype.CodeArea=function(Pe,rt,nt,ct,Tt){return new ot.init(Pe,rt,nt,ct,Tt)},ot={init:function(Pe,rt,nt,ct,Tt){this.latitudeLo=Pe,this.longitudeLo=rt,this.latitudeHi=nt,this.longitudeHi=ct,this.codeLength=Tt,this.latitudeCenter=Math.min(Pe+(nt-Pe)/2,A),this.longitudeCenter=Math.min(rt+(ct-rt)/2,l)}};return k_.OpenLocationCode=h,k_}var gA=mA();const yA=ky(gA);function Dy(h,m,b=10){const S=[16,8,4,2,1],z="0123456789bcdefghjkmnpqrstuvwxyz";let k=!0,A=-90,l=90,N=-180,W=180,ne="",re=0,xe=0;for(;ne.length<b;){if(k){const Ae=(N+W)/2;m>Ae?(xe|=S[re],N=Ae):W=Ae}else{const Ae=(A+l)/2;h>Ae?(xe|=S[re],A=Ae):l=Ae}k=!k,re<4?re++:(ne+=z[xe],re=0,xe=0)}return ne}function _A(h,m){return`${h.toFixed(6)}, ${m.toFixed(6)}`}function vA(h,m,b=5){const S=Dy(h,m,b),z=b===5?.02:b===6?.005:.001,k=b===5?.04:b===6?.01:.002,A=new Set;A.add(S);const l=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[N,W]of l){const ne=h+N*z,re=m+W*k;A.add(Dy(ne,re,b))}return Array.from(A)}const qv=yA,Cc=qv.default||qv;function Gv(h){const m=h.trim();if(m.replace(//g,"").replace(/,/g," ").split(/\s+/).filter(z=>z.length>0).length>=2){let z=null,k=null;const A=m.match(/^(-?\d+(\.\d+)?)[,\s]+(-?\d+(\.\d+)?)$/);if(A)z=parseFloat(A[1]),k=parseFloat(A[3]);else{const l=m.matchAll(/([0-9.-]+)\s*?\s*([NSEWnsew])?/g),N=Array.from(l);if(N.length===2){const W=parseFloat(N[0][1]),ne=N[0][2]?.toUpperCase(),re=parseFloat(N[1][1]),xe=N[1][2]?.toUpperCase(),Ae=(ae,ke)=>{let Ke=ae;return(ke==="S"||ke==="W")&&(Ke=-ae),ke==="N"||ke==="S"?{type:"lat",val:Ke}:ke==="E"||ke==="W"?{type:"lon",val:Ke}:{type:"unknown",val:Ke}},Ie=Ae(W,ne),pe=Ae(re,xe);Ie.type==="lat"&&pe.type==="lon"?(z=Ie.val,k=pe.val):Ie.type==="lon"&&pe.type==="lat"?(k=Ie.val,z=pe.val):Ie.type==="unknown"&&pe.type==="unknown"&&(z=Ie.val,k=pe.val)}}if(z!==null&&k!==null&&!isNaN(z)&&!isNaN(k)&&z>=-90&&z<=90&&k>=-180&&k<=180)return{lat:z,lon:k,type:"coordinate"}}try{if(Cc&&Cc.isValid&&Cc.isValid(m)&&Cc.isFull(m)){const k=Cc.decode(m);return{lat:k.latitudeCenter,lon:k.longitudeCenter,type:"plus_code"}}const z=m.toUpperCase().replace(/\s+/g,"+");if(z!==m&&Cc&&Cc.isValid&&Cc.isValid(z)&&Cc.isFull(z)){const k=Cc.decode(z);return{lat:k.latitudeCenter,lon:k.longitudeCenter,type:"plus_code"}}}catch{}return null}async function e1(h,m,b){const S=JSON.stringify(h);if(b){const z=cg.getConversationKey(b,m);return cg.encrypt(S,z)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(m,S);throw new Error("No encryption method available")}async function t1(h,m,b){let S;if(b){const z=cg.getConversationKey(b,m);S=cg.decrypt(h,z)}else if(window.nostr?.nip44?.decrypt)S=await window.nostr.nip44.decrypt(m,h);else throw new Error("No decryption method available");return JSON.parse(S)}const Py={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function xA(h,m){try{const b=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${h}&lon=${m}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!b.ok)throw new Error("Geocoding failed");const z=(await b.json()).address?.country_code?.toUpperCase();return z&&Py[z]?Py[z]:"USD"}catch(b){return console.warn("Currency detection failed, using locale fallback:",b),n1()}}function n1(){try{const m=window.navigator.language.split("-")[1]?.toUpperCase();return m&&Py[m]?Py[m]:"USD"}catch{return"USD"}}function ug(h){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:h,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[h]||"$"}}const bA={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function wA(h){return(bA[h]||"US").toUpperCase().replace(/./g,b=>String.fromCodePoint(b.charCodeAt(0)+127397))}var cf=Symbol("verified"),TA=h=>h instanceof Object;function i1(h){if(!TA(h)||typeof h.kind!="number"||typeof h.content!="string"||typeof h.created_at!="number"||typeof h.pubkey!="string"||!h.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(h.tags))return!1;for(let m=0;m<h.tags.length;m++){let b=h.tags[m];if(!Array.isArray(b))return!1;for(let S=0;S<b.length;S++)if(typeof b[S]!="string")return!1}return!0}new TextDecoder("utf-8");var SA=new TextEncoder,EA=class{generateSecretKey(){return zc.utils.randomPrivateKey()}getPublicKey(h){return Lr(zc.getPublicKey(h))}finalizeEvent(h,m){const b=h;return b.pubkey=Lr(zc.getPublicKey(m)),b.id=xy(b),b.sig=Lr(zc.sign(xy(b),m)),b[cf]=!0,b}verifyEvent(h){if(typeof h[cf]=="boolean")return h[cf];const m=xy(h);if(m!==h.id)return h[cf]=!1,!1;try{const b=zc.verify(h.sig,m,h.pubkey);return h[cf]=b,b}catch{return h[cf]=!1,!1}}};function r1(h){if(!i1(h))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,h.pubkey,h.created_at,h.kind,h.tags,h.content])}function xy(h){let m=Xh(SA.encode(r1(h)));return Lr(m)}var Xy=new EA,a1=Xy.generateSecretKey,MA=Xy.getPublicKey,s1=Xy.finalizeEvent;Xy.verifyEvent;const AA=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:s1,generateSecretKey:a1,getEventHash:xy,getPublicKey:MA,serializeEvent:r1,validateEvent:i1,verifiedSymbol:cf},Symbol.toStringTag,{value:"Module"})),CA=({status:h,setStatus:m,searchLocation:b,vehicleType:S,setOpenSpots:z,parkLocation:k,setParkLocation:A,sessionStart:l,setSessionStart:N})=>{const{pubkey:W,pool:ne,signEvent:re}=Yp(),[xe,Ae]=ze.useState(!1),[Ie,pe]=ze.useState("0"),[ae,ke]=ze.useState("USD"),[Ke,at]=ze.useState("$"),[zt,wt]=ze.useState("00:00:00");ze.useEffect(()=>{if(h==="parked"&&l){const Pe=()=>{const ct=Math.floor(Date.now()/1e3)-l,Tt=Math.floor(ct/3600),Nt=Math.floor(ct%3600/60),qt=ct%60;wt(`${Tt.toString().padStart(2,"0")}:${Nt.toString().padStart(2,"0")}:${qt.toString().padStart(2,"0")}`)},rt=setInterval(Pe,1e3);return Pe(),()=>clearInterval(rt)}},[h,l]),ze.useEffect(()=>{if(h==="search"&&b){const Pe=vA(b[0],b[1],5);console.log("[Parlens] Starting spot search with polling in geohashes:",Pe);const rt=async()=>{try{const Tt=Math.floor(Date.now()/1e3),Nt=await ne.querySync(Go,{kinds:[Ol.OPEN_SPOT_BROADCAST],"#g":Pe,since:Tt-600}),qt=Math.floor(Date.now()/1e3),ht=[];for(const Se of Nt){const Xe=Se.tags.find(_t=>_t[0]==="expiration");if(!(Xe&&parseInt(Xe[1])<qt))try{const _t=Se.tags,xt=_t.find(bt=>bt[0]==="location"),Bt=_t.find(bt=>bt[0]==="hourly_rate"),Te=_t.find(bt=>bt[0]==="currency"),Ve=_t.find(bt=>bt[0]==="type");if(xt){const[bt,Dt]=xt[1].split(",").map(Number),jt=Ve?Ve[1]:"car";ht.push({id:Se.id,lat:bt,lon:Dt,price:Bt?parseFloat(Bt[1]):0,currency:Te?Te[1]:"USD",type:jt})}}catch(_t){console.warn("[Parlens] Error parsing spot:",_t)}}console.log("[Parlens] Found",ht.length,"valid spots"),z(ht)}catch(Tt){console.error("[Parlens] Spot query error:",Tt)}};rt();const nt=setInterval(rt,1e4),ct=()=>{console.log("[Parlens] Visibility refresh triggered, searching spots..."),rt()};return window.addEventListener("visibility-refresh",ct),()=>{console.log("[Parlens] Stopping spot search"),clearInterval(nt),window.removeEventListener("visibility-refresh",ct)}}else z([])},[h,S,ne,b]),ze.useEffect(()=>{(async()=>{const rt=n1();if(ke(rt),at(ug(rt)),b)try{const nt=await xA(b[0],b[1]);ke(nt),at(ug(nt))}catch{console.warn("GPS currency detection failed")}})()},[b]);const ut=async()=>{h==="idle"?m("search"):h==="search"?(N(Math.floor(Date.now()/1e3)),A(b?[b[0],b[1]]:null),m("parked")):h==="parked"&&(pe("0"),Ae(!0))},ot=async()=>{m("idle"),Ae(!1);const Pe=k?k[0]:b?b[0]:0,rt=k?k[1]:b?b[1]:0,nt=Dy(Pe,rt,5),ct=Math.floor(Date.now()/1e3),Tt=l||ct;try{const Nt={status:"vacated",lat:Pe,lon:rt,geohash:nt,fee:Ie,currency:ae,type:S,started_at:Tt,finished_at:ct},qt=localStorage.getItem("parlens_privkey"),ht=qt?new Uint8Array(qt.match(/.{1,2}/g).map(Kt=>parseInt(Kt,16))):void 0,Se=await e1(Nt,W,ht),Xe={kind:Ol.PARKING_LOG,content:Se,tags:[["d",`session_${Tt}`],["client","parlens"]],created_at:ct,pubkey:W},_t=await re(Xe);console.log("Publishing log:",_t.id,"to",Go);const xt=await Promise.allSettled(ne.publish(Go,_t)),Bt=xt.filter(Kt=>Kt.status==="fulfilled").length,Te=xt.filter(Kt=>Kt.status==="rejected").length;console.log(`[Parlens] Publish results: ${Bt}/${xt.length} succeeded, ${Te} failed`),xt.forEach((Kt,wn)=>{Kt.status==="rejected"&&console.warn(`[Parlens] Relay ${Go[wn]} failed:`,Kt.reason)}),Bt===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(Kt=>setTimeout(Kt,300)),window.dispatchEvent(new Event("parking-log-updated"));const Ve=a1(),bt=ct-Tt,Dt=Math.max(Math.ceil(bt/3600),1),jt=String(Math.round(parseFloat(Ie)/Dt)),Xt=ct+300,Yt={kind:Ol.OPEN_SPOT_BROADCAST,content:"",tags:[["d",`spot_${nt}_${ct}`],["g",nt],["location",`${Pe},${rt}`],["hourly_rate",jt],["currency",ae],["type",S],["expiration",String(Xt)],["client","parlens"]],created_at:ct},mn=s1(Yt,Ve);console.log("[Parlens] *** BROADCASTING OPEN SPOT ***"),console.log("[Parlens] Geohash:",nt),console.log("[Parlens] Location:",`${Pe},${rt}`),console.log("[Parlens] Event ID:",mn.id),console.log("[Parlens] Pubkey:",mn.pubkey.substring(0,20)+"..."),ne.publish(Go,mn),N(null),A(null)}catch(Nt){console.error("Persistence error:",Nt),alert("Could not save to Nostr. Check relay connections.")}};return $.jsxs("div",{className:"relative flex flex-col items-end gap-4",children:[$.jsxs("div",{className:"flex items-center gap-4",children:[h==="search"&&$.jsx("button",{onClick:()=>m("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8",children:"CANCEL"}),h==="parked"&&$.jsx("div",{className:"h-14 px-6 rounded-full bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-2xl flex items-center justify-center animate-in slide-in-from-left-8 pointer-events-none",children:$.jsx("span",{className:"font-mono text-xl font-bold tabular-nums text-zinc-900 dark:text-white",children:zt})}),$.jsxs("button",{onClick:ut,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 ${h==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":h==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[h==="idle"&&$.jsx(DM,{size:32,strokeWidth:2.5}),h==="search"&&$.jsx(kc,{size:32,strokeWidth:2.5,className:"animate-pulse"}),h==="parked"&&(S==="bicycle"?$.jsx("span",{className:"text-3xl",children:""}):S==="motorcycle"?$.jsx("span",{className:"text-3xl",children:""}):$.jsx("span",{className:"text-3xl",children:""}))]})]}),xe&&$.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:$.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[$.jsxs("div",{className:"text-center space-y-1",children:[$.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),$.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),$.jsxs("div",{className:"flex items-center gap-4",children:[$.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[$.jsx("span",{className:"text-2xl font-bold text-blue-500",children:Ke}),$.jsx("input",{type:"number",value:Ie,onChange:Pe=>pe(Pe.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),$.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:ae})]}),$.jsxs("div",{className:"flex flex-col gap-1.5",children:[$.jsx("button",{onClick:()=>pe(String(Math.max(0,parseFloat(Ie||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:$.jsx(O0,{size:22,className:"text-zinc-600 dark:text-white/70"})}),$.jsx("button",{onClick:()=>pe(String(Math.max(0,parseFloat(Ie||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:$.jsx(gf,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),$.jsxs("div",{className:"w-full space-y-3",children:[$.jsxs("button",{onClick:ot,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",$.jsx(KE,{size:20})]}),$.jsx("button",{onClick:()=>Ae(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};function zA(){const{pool:h,pubkey:m}=Yp(),[b,S]=ze.useState([]),[z,k]=ze.useState(!0),A=ze.useRef(new Set),l=ze.useCallback(async()=>{if(!(!m||!h)){k(!0),console.log("[useParkingLogs] Fetching logs for",m);try{const W=await h.querySync(Go,{kinds:[Ol.PARKING_LOG,5],authors:[m],limit:100});console.log("[useParkingLogs] Fetched",W.length,"events");const ne=new Set,re=W.filter(pe=>pe.kind===5);for(const pe of re)for(const ae of pe.tags)ae[0]==="a"&&ne.add(ae[1]);const Ae=W.filter(pe=>pe.kind===Ol.PARKING_LOG).filter(pe=>{const ae=pe.tags?.find(Ke=>Ke[0]==="d")?.[1];if(!ae)return!0;if(A.current.has(ae))return!1;const ke=`${pe.kind}:${pe.pubkey}:${ae}`;return!ne.has(ke)});console.log("[useParkingLogs] Valid logs after filtering:",Ae.length);const Ie=Ae.sort((pe,ae)=>ae.created_at-pe.created_at);S(Ie)}catch(W){console.error("[useParkingLogs] Fetch error:",W)}finally{k(!1)}}},[h,m]),N=ze.useCallback(W=>{console.log("[useParkingLogs] Marking deleted:",W),A.current.add(W)},[]);return ze.useEffect(()=>{m&&l()},[m,l]),ze.useEffect(()=>{const W=()=>{console.log("[useParkingLogs] Received update event, refetching..."),l()};return window.addEventListener("parking-log-updated",W),window.addEventListener("visibility-refresh",W),()=>{window.removeEventListener("parking-log-updated",W),window.removeEventListener("visibility-refresh",W)}},[l]),{logs:b,loading:z,refetch:l,markDeleted:N}}const DA=({setHistorySpots:h,onOpenChange:m})=>{const{pubkey:b,logout:S,pool:z,signEvent:k}=Yp(),{logs:A,refetch:l,markDeleted:N}=zA(),[W,ne]=ze.useState(!1),[re,xe]=ze.useState(!1);ze.useEffect(()=>{m?.(W)},[W,m]);const[Ae,Ie]=ze.useState(null),[pe,ae]=ze.useState([]),[ke,Ke]=ze.useState(!1),at=async wt=>{if(!(!b||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){xe(!0);try{const ut=wt.tags?.find(rt=>rt[0]==="d")?.[1];if(!ut)throw new Error("Missing d tag on event");const ot={kind:5,content:"Deleted by user",tags:[["a",`${Ol.PARKING_LOG}:${b}:${ut}`],["k",String(Ol.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:b},Pe=await k(ot);await Promise.allSettled(z.publish(Go,Pe)),N(ut),ae(rt=>rt.filter(nt=>nt.id!==wt.id))}catch(ut){console.error("Failed to delete parking log:",ut),alert("Failed to delete. Please try again.")}finally{xe(!1)}}};ze.useEffect(()=>{b&&(async()=>{const ut=await z.get(Go,{kinds:[0],authors:[b]});if(ut)try{const ot=JSON.parse(ut.content);Ie({name:ot.name||ot.display_name||"Nostr User",npub:ff.npubEncode(b),picture:ot.picture})}catch(ot){console.error("Error parsing profile:",ot)}else Ie({name:"Nostr User",npub:ff.npubEncode(b),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${b}`})})()},[b,z]),ze.useEffect(()=>{(async()=>{if(!b||!A.length)return;const ut=localStorage.getItem("parlens_privkey"),ot=ut?new Uint8Array(ut.match(/.{1,2}/g).map(rt=>parseInt(rt,16))):void 0,Pe=await Promise.all(A.map(async rt=>{try{const nt=await t1(rt.content,b,ot);return{...rt,decryptedContent:nt}}catch{return{...rt,decryptedContent:null}}}));ae(Pe.filter(rt=>rt.decryptedContent))})()},[A,b]),ze.useEffect(()=>{h&&h(ke?pe:[])},[ke,pe,h]);const zt=()=>{const wt=localStorage.getItem("parlens_privkey");if(wt){const ut=ff.nsecEncode(new Uint8Array(wt.match(/.{1,2}/g).map(ot=>parseInt(ot,16))));navigator.clipboard.writeText(ut),alert("Copied to clipboard")}};return $.jsxs($.Fragment,{children:[$.jsx("button",{onClick:()=>{l(),ne(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:$.jsx(NM,{size:20})}),W&&$.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[$.jsx("button",{onClick:()=>ne(!1),className:"absolute inset-0 z-0 cursor-default"}),re&&$.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:$.jsxs("div",{className:"flex flex-col items-center gap-3",children:[$.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),$.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),$.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent",children:Ae?.name||"Nostr User"}),$.jsx("button",{onClick:()=>ne(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:$.jsx(Cy,{size:20,className:"text-black/60 dark:text-white/60"})})]}),$.jsxs("div",{className:"space-y-4",children:[$.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Keys"}),$.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[$.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText(Ae?.npub),alert("Copied to clipboard")},children:[$.jsxs("div",{className:"flex items-center gap-3",children:[$.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:$.jsx(X_,{size:20})}),$.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),$.jsx(Ay,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&$.jsxs($.Fragment,{children:[$.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),$.jsxs("div",{onClick:zt,className:"flex items-center justify-between p-4 cursor-pointer transition-colors active:bg-black/10 dark:active:bg-white/10",children:[$.jsxs("div",{className:"flex items-center gap-3",children:[$.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:$.jsx(Xb,{size:20})}),$.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),$.jsx(Ay,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),$.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:" Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost."})]}),$.jsxs("div",{className:"space-y-4",children:[$.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),h&&$.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5 mb-4",children:[$.jsxs("div",{className:"flex items-center gap-3",children:[$.jsx("div",{className:"p-2.5 rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:$.jsx(kc,{size:20})}),$.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),$.jsx("button",{onClick:()=>Ke(!ke),className:`w-12 h-7 rounded-full transition-colors relative ${ke?"bg-blue-500":"bg-zinc-200 dark:bg-white/20"}`,children:$.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${ke?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),$.jsx("div",{className:"space-y-2",children:pe.length>0?pe.map(wt=>{const ut=wt.decryptedContent,ot=ug(ut.currency||"USD"),Pe=ut.started_at?new Date(ut.started_at*1e3):null,rt=ut.finished_at?new Date(ut.finished_at*1e3):new Date(wt.created_at*1e3),nt=ut.lat&&ut.lon?`${ut.lat.toFixed(5)}, ${ut.lon.toFixed(5)}`:null,ct=ut.type||"car",Tt=ct==="bicycle"?"":ct==="motorcycle"?"":"";return $.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsxs("div",{className:"flex items-center gap-3",children:[$.jsx("span",{className:"text-2xl",children:Tt}),$.jsx("p",{className:"font-bold text-xl",children:`${ot}${ut.fee||"0"}`})]}),$.jsxs("div",{className:"flex items-center gap-2",children:[$.jsx("span",{className:"text-2xl",children:wA(ut.currency||"USD")}),$.jsx("button",{onClick:()=>at(wt),className:"p-1.5 text-zinc-400 dark:text-white/30 transition-colors",title:"Delete entry",children:$.jsx(Y_,{size:16})})]})]}),nt&&$.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[$.jsx(kc,{size:12,className:"text-blue-500 dark:text-blue-400"}),$.jsx("span",{className:"font-mono",children:nt})]}),$.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/30",children:[$.jsx(Hb,{size:12,className:"text-green-500 dark:text-green-400"}),$.jsxs("div",{className:"space-x-1",children:[Pe&&$.jsxs("span",{children:["Start: ",Pe.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",Pe.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),$.jsx("span",{className:"text-black/10 dark:text-white/10",children:""}),$.jsxs("span",{children:["End: ",rt.toLocaleDateString(void 0,{month:"short",day:"numeric"})," ",rt.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]})]},wt.id)}):$.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:$.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:"No recent activity"})})})]}),$.jsx("button",{onClick:()=>{S(),ne(!1)},className:"w-full py-5 rounded-[2rem] bg-zinc-100 dark:bg-zinc-800 text-red-500 font-bold tracking-wide border border-black/5 dark:border-white/5 transition-all active:scale-95 text-center mt-4",children:"Logout"})]})]})]})},PA=({query:h,onSelect:m,countryCode:b,currentLocation:S})=>{const[z,k]=ze.useState(null),[A,l]=ze.useState(!1);return ze.useEffect(()=>{const W=setTimeout(async()=>{if(!(!h||h.length<4)){l(!0);try{let ne=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(h)}&format=json&limit=1`;if(b&&(ne+=`&countrycodes=${b}`),S){const[Ae,Ie]=S,pe=`${Ie-1},${Ae+1},${Ie+1},${Ae-1}`;ne+=`&viewbox=${pe}`}const xe=await(await fetch(ne)).json();xe&&xe.length>0?k(xe[0]):k(null)}catch(ne){console.error(ne),k(null)}finally{l(!1)}}},2e3);return()=>clearTimeout(W)},[h,b,S]),A?$.jsxs("div",{className:"mb-2 p-3 text-xs text-zinc-400 dark:text-white/40 italic flex items-center gap-2",children:[$.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-zinc-300 border-t-zinc-600 animate-spin"}),"Searching..."]}):z?$.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-purple-50 dark:bg-purple-500/10 border border-purple-500/20",children:[$.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-purple-700 dark:text-purple-400 bg-purple-100/50 dark:bg-purple-500/5",children:" Global Search Result"}),$.jsxs("button",{onClick:()=>m(z),className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[$.jsx(kc,{size:16,className:"text-purple-600 dark:text-purple-400 shrink-0"}),$.jsxs("div",{className:"flex-1 truncate",children:[$.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white truncate",children:z.display_name.split(",")[0]}),$.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:z.display_name})]})]})]}):null},IA=({vehicleType:h,onRouteChange:m,currentLocation:b,onDropPinModeChange:S,pendingWaypoints:z,onDropPinConsumed:k,onOpenChange:A})=>{const{pool:l,pubkey:N,signEvent:W}=Yp(),[ne,re]=ze.useState(!1);ze.useEffect(()=>{A?.(ne)},[ne,A]);const[xe,Ae]=ze.useState([]),[Ie,pe]=ze.useState(""),[ae,ke]=ze.useState(!1),[Ke,at]=ze.useState(null),[zt,wt]=ze.useState(null),[ut,ot]=ze.useState(!1),Pe=ze.useRef(null),[rt,nt]=ze.useState([]),[ct,Tt]=ze.useState(""),[Nt,qt]=ze.useState(!1),[ht,Se]=ze.useState(!1),[Xe,_t]=ze.useState(!1),[xt,Bt]=ze.useState(!1),[Te,Ve]=ze.useState(null),[bt,Dt]=ze.useState(""),[jt,Xt]=ze.useState(!1),[Yt,mn]=ze.useState(null),[Kt,wn]=ze.useState({}),br=ze.useRef(new Set);ze.useEffect(()=>{(async()=>{if(!(!b||Yt))try{const X=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${b[0]}&lon=${b[1]}&format=json`)).json();X&&X.address&&X.address.country_code&&(console.log("[Parlens] Detected Country:",X.address.country_code),mn(X.address.country_code))}catch(Z){console.error("[Parlens] Failed to detect country:",Z)}})()},[b,Yt]);const Zn=i0.useMemo(()=>{if(!Ie||Ie.length<2)return[];const fe=Ie.toLowerCase(),Z=[];for(const X of rt)for(const Q of X.decryptedContent.waypoints)Q.name.toLowerCase().includes(fe)&&(Z.find(de=>de.name.toLowerCase()===Q.name.toLowerCase())||Z.push({name:Q.name,lat:Q.lat,lon:Q.lon}));return Z.slice(0,5)},[Ie,rt]),lr=fe=>{Ae(Z=>Z.filter(X=>X.id!==fe)),at(null),wt(null),ke(!1),m(null,null,null,!1)},Dn=()=>{Ae([]),at(null),wt(null),ke(!1),m(null,null,null,!1)},Bi=(fe,Z)=>{if(fe+Z<0||fe+Z>=xe.length)return;const X=[...xe];[X[fe],X[fe+Z]]=[X[fe+Z],X[fe]],Ae(X),at(null),wt(null),ke(!1),m(null,null,null,!1)},Ni=()=>{Ae(fe=>[...fe].reverse()),at(null),wt(null),ke(!1),m(null,null,null,!1)},Kn=async()=>{if(xe.length<2){alert("Add at least 2 waypoints to create a route");return}ot(!0);try{const Z={bicycle:"bike",motorcycle:"driving",car:"driving"}[h],X=[],Q=[],de={};for(let ye=0;ye<xe.length-1;ye++){const Oe=xe[ye],Je=xe[ye+1],it=`${Oe.lon},${Oe.lat};${Je.lon},${Je.lat}`;console.log(`[Parlens] Fetching segment ${ye+1}: ${Oe.name}  ${Je.name}`);const Mt=await fetch(`https://router.project-osrm.org/route/v1/${Z}/${it}?overview=full&geometries=geojson&alternatives=true`);if(!Mt.ok)throw new Error(`OSRM error: ${Mt.status}`);const Pt=await Mt.json();if(Pt.code==="Ok"&&Pt.routes&&Pt.routes[0]){if(Pt.waypoints&&Pt.waypoints.length>=2){const hn=Pt.waypoints[0].location,dn=Pt.waypoints[1].location;de[ye]||(de[ye]={lat:hn[1],lon:hn[0]}),de[ye+1]={lat:dn[1],lon:dn[0]}}const $t=Pt.routes[0].geometry.coordinates.map(hn=>[hn[1],hn[0]]);if(X.push($t),Pt.routes.length>1){const hn=Pt.routes[1].geometry.coordinates.map(dn=>[dn[1],dn[0]]);Q.push(hn),console.log(`[Parlens] Segment ${ye+1} has alternate route`)}else Q.push($t),console.log(`[Parlens] Segment ${ye+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${ye+1}`)}const we=[],Le=[];for(let ye=0;ye<X.length;ye++){const Oe=ye===0?0:1;we.push(...X[ye].slice(Oe)),Le.push(...Q[ye].slice(Oe))}console.log("[Parlens] Combined primary route:",we.length,"points"),console.log("[Parlens] Combined alternate route:",Le.length,"points"),at(we),wt(Le),wn(de),ke(!0);const Re=Object.keys(de).length===xe.length?xe.map((ye,Oe)=>({...ye,...de[Oe]})):xe;m(we,Le,Re.map(ye=>({lat:ye.lat,lon:ye.lon})),!0),re(!1)}catch(fe){console.error("Route creation error:",fe);const Z=xe.map(X=>[X.lat,X.lon]);at(Z),wt(null),wn({}),ke(!0),m(Z,null,xe.map(X=>({lat:X.lat,lon:X.lon})),!0),re(!1)}finally{ot(!1)}},aa=()=>{const fe=!ae;ke(fe);const Z=Object.keys(Kt).length===xe.length?xe.map((X,Q)=>({...X,...Kt[Q]})):xe;m(Ke,zt,Z.map(X=>({lat:X.lat,lon:X.lon})),fe)},Gr=ze.useCallback(async()=>{if(!(!l||!N)){Se(!0);try{const fe=await l.querySync(Go,{kinds:[Ol.ROUTE_LOG],authors:[N]});console.log("[Parlens] Fetched route events:",fe.length);const Z=localStorage.getItem("parlens_privkey"),X=Z?new Uint8Array(Z.match(/.{1,2}/g).map(de=>parseInt(de,16))):void 0,Q=[];for(const de of fe){if(de.tags.find(Le=>Le[0]==="deleted"))continue;const we=de.tags.find(Le=>Le[0]==="d")?.[1]||"";if(!(we&&br.current.has(we))&&de.content)try{const Le=await t1(de.content,N,X);if(Le){const Re=de.tags.find(ye=>ye[0]==="d")?.[1]||"";Q.push({id:de.id,dTag:Re,decryptedContent:Le,created_at:de.created_at})}}catch(Le){console.warn("[Parlens] Failed to decrypt route:",Le)}}Q.sort((de,we)=>we.created_at-de.created_at);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Q))}catch(de){console.warn("[Parlens] Failed to cache routes:",de)}nt(Q)}catch(fe){console.error("Error fetching saved routes:",fe)}finally{Se(!1)}}},[l,N]);ze.useEffect(()=>{if(ne&&N){try{const fe=localStorage.getItem("parlens_route_cache_v1");if(fe){const Z=JSON.parse(fe);nt(Z)}}catch(fe){console.warn("[Parlens] Failed to load cached routes:",fe)}Gr()}},[ne,N,Gr]);const li=()=>{const fe=!xt;Bt(fe),S?.(fe),fe&&re(!1)};ze.useEffect(()=>{if(z){if(z.length>0){const fe=z.map((Z,X)=>({id:crypto.randomUUID(),name:Z.name||`Pin ${xe.length+X+1}`,lat:Z.lat,lon:Z.lon}));Ae(Z=>[...Z,...fe]),at(null),wt(null),ke(!1),m(null,null,null,!1),wn({})}k?.(),re(!0),S?.(!1)}},[z,k,S,m]);const xn=async()=>{if(!l||!N||!W||!Ke||xe.length<2){alert("Please create a route first");return}const fe=ct.trim()||`Route ${new Date().toLocaleDateString()}`;qt(!0);try{const Z=Object.keys(Kt).length===xe.length?xe.map((Mt,Pt)=>({name:Mt.name,lat:Kt[Pt].lat,lon:Kt[Pt].lon})):xe.map(Mt=>({name:Mt.name,lat:Mt.lat,lon:Mt.lon})),X={name:fe,waypoints:Z,routeCoords:Ke,alternateRouteCoords:zt||void 0,vehicleType:h,created_at:Math.floor(Date.now()/1e3)},Q=localStorage.getItem("parlens_privkey"),de=Q?new Uint8Array(Q.match(/.{1,2}/g).map(Mt=>parseInt(Mt,16))):void 0,we=await e1(X,N,de),Le=`route_${Date.now()}`,Re={kind:Ol.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Le],["client","parlens"]],content:we},ye=await W(Re);console.log("[Parlens] Signed route event:",ye);const Oe=await Promise.allSettled(l.publish(Go,ye)),Je=Oe.filter(Mt=>Mt.status==="fulfilled").length;console.log("[Parlens] Route published:",Je,"of",Oe.length,"relays"),Je===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)");const it={id:ye.id,dTag:Le,decryptedContent:X,created_at:ye.created_at};nt(Mt=>{const Pt=[it,...Mt];try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Pt))}catch($t){console.warn("Cache update failed",$t)}return Pt}),Tt("")}catch(Z){console.error("[Parlens] Error saving route:",Z),alert("Failed to save route, try again later")}finally{qt(!1)}},Ar=(fe,Z)=>{Ae(X=>X.map(Q=>Q.id===fe?{...Q,name:Z}:Q)),Ve(null),Dt("")},Sa=fe=>{Ve(fe.id),Dt(fe.name)},xi=async fe=>{const Z=fe.decryptedContent,X=Z.waypoints.map(Q=>({id:crypto.randomUUID(),name:Q.name,lat:Q.lat,lon:Q.lon}));Ae(X),at(Z.routeCoords),wt(Z.alternateRouteCoords||null),wn({}),ke(!0),_t(!1),m(Z.routeCoords,Z.alternateRouteCoords||null,Z.waypoints.map(Q=>({lat:Q.lat,lon:Q.lon})),!0),re(!1)},nr=async fe=>{if(!(!l||!N||!W)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){Xt(!0);try{const Z={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",fe.id],["a",`${Ol.ROUTE_LOG}:${N}:${fe.dTag}`]],content:"Deleted by user"},X=await W(Z);await Promise.allSettled(l.publish(Go,X));const Q={kind:Ol.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",fe.dTag],["deleted","true"]],content:""},de=await W(Q);await Promise.allSettled(l.publish(Go,de)),br.current.add(fe.dTag),nt(we=>{const Le=we.filter(Re=>Re.id!==fe.id);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Le))}catch(Re){console.warn("Cache update failed",Re)}return Le})}catch(Z){console.error("Error deleting route:",Z),alert("Failed to delete route")}finally{Xt(!1)}}};return $.jsxs($.Fragment,{children:[$.jsx("button",{onClick:()=>re(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:$.jsx(MM,{size:20})}),ne&&$.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[$.jsx("button",{onClick:()=>re(!1),className:"absolute inset-0 z-0 cursor-default"}),jt&&$.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:$.jsxs("div",{className:"flex flex-col items-center gap-3",children:[$.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),$.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),Nt&&$.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:$.jsxs("div",{className:"flex flex-col items-center gap-3",children:[$.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),$.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),$.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[$.jsxs("div",{className:"flex items-center justify-between",children:[$.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),$.jsx("button",{onClick:()=>re(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:$.jsx(Cy,{size:20,className:"text-black/60 dark:text-white/60"})})]}),$.jsxs("div",{className:"space-y-2",children:[$.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30 ml-2",children:"Add Waypoint"}),$.jsx("div",{className:"relative",children:$.jsx("input",{ref:Pe,type:"text",placeholder:"Search waypoint or coordinate",value:Ie,onChange:fe=>pe(fe.target.value),className:"w-full h-14 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(()=>{const fe=Gv(Ie);return fe?$.jsxs("div",{className:"mb-2 rounded-2xl overflow-hidden bg-blue-50 dark:bg-blue-500/10 border border-blue-500/20",children:[$.jsxs("div",{className:"px-3 py-1.5 text-xs font-medium text-blue-700 dark:text-blue-400 bg-blue-100/50 dark:bg-blue-500/5",children:[" ",fe.type==="plus_code"?"Plus Code Location":"Coordinate"]}),$.jsxs("button",{onClick:()=>{const Z={id:crypto.randomUUID(),name:fe.type==="plus_code"?`Plus Code: ${Ie}`:`Loc: ${_A(fe.lat,fe.lon)}`,lat:fe.lat,lon:fe.lon};Ae(X=>[...X,Z]),pe(""),at(null),wt(null),ke(!1),m(null,null,null,!1),wn({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left",children:[$.jsx(kc,{size:16,className:"text-blue-600 dark:text-blue-400 shrink-0"}),$.jsxs("div",{className:"flex-1 truncate",children:[$.jsx("div",{className:"text-sm font-bold text-zinc-900 dark:text-white",children:"Add Location"}),$.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/60",children:[fe.lat.toFixed(6),", ",fe.lon.toFixed(6)]})]})]})]}):null})(),Ie.length>3&&!Gv(Ie)&&Zn.length===0&&$.jsx(PA,{query:Ie,countryCode:Yt,currentLocation:b,onSelect:fe=>{const Z={id:crypto.randomUUID(),name:fe.display_name.split(",")[0],lat:parseFloat(fe.lat),lon:parseFloat(fe.lon)};Ae(X=>[...X,Z]),pe(""),at(null),wt(null),ke(!1),m(null,null,null,!1),wn({})}}),Zn.length>0&&$.jsxs("div",{className:"rounded-2xl overflow-hidden bg-green-50 dark:bg-green-500/10 border border-green-500/20",children:[$.jsx("div",{className:"px-3 py-1.5 text-xs font-medium text-green-700 dark:text-green-400 bg-green-100/50 dark:bg-green-500/5",children:" From your saved routes"}),Zn.map((fe,Z)=>$.jsxs("button",{onClick:()=>{const X={id:crypto.randomUUID(),name:fe.name,lat:fe.lat,lon:fe.lon};Ae(Q=>[...Q,X]),pe(""),at(null),wt(null),ke(!1),m(null,null,null,!1),wn({})},className:"w-full p-3 flex items-center gap-3 transition-colors text-left border-b border-green-500/10 last:border-0",children:[$.jsx(kc,{size:16,className:"text-green-600 dark:text-green-400 shrink-0"}),$.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white/80 truncate",children:fe.name})]},`saved-${Z}`))]}),b&&$.jsxs("button",{onClick:()=>{const fe={id:crypto.randomUUID(),name:"Current Location",lat:b[0],lon:b[1]};Ae(Z=>[...Z,fe]),at(null),wt(null),ke(!1),m(null,null,null,!1),wn({})},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors",children:[$.jsx(bM,{size:16,className:"text-blue-500"}),$.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),$.jsxs("button",{onClick:li,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 transition-colors",children:[$.jsx(vM,{size:16,className:"text-orange-500"}),$.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),$.jsxs("div",{className:"space-y-2 flex-1",children:[$.jsxs("div",{className:"flex items-center justify-between ml-2 mr-2",children:[$.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30",children:["Waypoints (",xe.length,")"]}),xe.length>1&&$.jsx("button",{onClick:Ni,className:"p-1 rounded-md transition-colors",title:"Reverse Order",children:$.jsx(JE,{size:14,className:"text-zinc-400 dark:text-white/30"})})]}),xe.length===0?$.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):$.jsx("div",{className:"space-y-2",children:xe.map((fe,Z)=>$.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[$.jsxs("div",{className:"flex flex-col gap-0.5 -ml-1 mr-1",children:[$.jsx("button",{onClick:()=>Bi(Z,-1),disabled:Z===0,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:$.jsx(O0,{size:12})}),$.jsx("button",{onClick:()=>Bi(Z,1),disabled:Z===xe.length-1,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:$.jsx(gf,{size:12})})]}),$.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-500 text-white text-xs font-bold flex items-center justify-center shrink-0",children:Z+1}),Te===fe.id?$.jsxs($.Fragment,{children:[$.jsx("input",{type:"text",value:bt,onChange:X=>Dt(X.target.value),className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onFocus:X=>X.currentTarget.select(),onKeyDown:X=>{X.key==="Enter"&&Ar(fe.id,bt),X.key==="Escape"&&Ve(null)}}),$.jsx("button",{onClick:()=>Ar(fe.id,bt),className:"p-2 rounded-xl text-green-500 hover:bg-green-500/10 transition-colors",children:$.jsx($_,{size:16})})]}):$.jsxs($.Fragment,{children:[$.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:fe.name}),$.jsx("button",{onClick:()=>Sa(fe),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:$.jsx($b,{size:14})})]}),$.jsx("button",{onClick:()=>lr(fe.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:$.jsx(Y_,{size:16})})]},fe.id))})]}),Ke&&$.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[$.jsxs("div",{className:"flex items-center gap-3",children:[ae?$.jsx(hM,{size:20,className:"text-blue-500"}):$.jsx(cM,{size:20,className:"text-zinc-400"}),$.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),$.jsx("button",{onClick:aa,className:`w-14 h-8 rounded-full transition-colors ${ae?"bg-blue-500":"bg-zinc-300 dark:bg-white/20"}`,children:$.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${ae?"translate-x-7":"translate-x-1"}`})})]}),Ke&&N&&$.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[$.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[$.jsx(CM,{size:14}),"Save Route"]}),$.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[$.jsx("input",{type:"text",value:ct,onChange:fe=>Tt(fe.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),$.jsx("button",{onClick:xn,disabled:Nt,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:Nt?"...":"Save"})]})]}),$.jsxs("div",{className:"flex gap-3",children:[$.jsx("button",{onClick:Dn,disabled:xe.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),$.jsx("button",{onClick:Kn,disabled:xe.length<2||ut,className:"flex-1 h-14 rounded-2xl bg-blue-500 text-white font-bold shadow-lg shadow-blue-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:ut?"Creating...":"Create Route"})]}),!Ke&&xe.length>=2&&N&&$.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),N&&$.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[$.jsxs("button",{onClick:()=>_t(!Xe),className:"w-full flex items-center justify-between",children:[$.jsxs("div",{className:"flex items-center gap-2",children:[$.jsx(fM,{size:18,className:"text-zinc-500 dark:text-white/50"}),$.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/30",children:["Saved Routes (",rt.length,")"]})]}),$.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:Xe?"Hide":"Show"})]}),Xe&&$.jsx("div",{className:"space-y-2",children:ht?$.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):rt.length===0?$.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):rt.map(fe=>$.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[$.jsxs("button",{onClick:()=>xi(fe),className:"flex-1 text-left",children:[$.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:fe.decryptedContent.name}),$.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[$.jsxs("span",{children:[fe.decryptedContent.waypoints.length," stops"]}),$.jsx("span",{children:""}),$.jsx(Hb,{size:12}),$.jsx("span",{children:new Date(fe.created_at*1e3).toLocaleDateString()})]})]}),$.jsx("button",{onClick:()=>nr(fe),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:$.jsx(Y_,{size:16})})]},fe.id))})]}),$.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:$.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[$.jsx("strong",{children:"Tip:"})," Use ",$.jsx("strong",{children:"Drop Pin on Map"})," and",$.jsx("strong",{children:" edit waypoint names"})," to label locations. When you ",$.jsx("strong",{children:"save routes"}),", waypoint names become searchable  building your personal offline map over time! "]})})]})]})]})};function kA(h){return h>=17?8:h>=15?7:h>=13?6:h>=11?5:h>=9?4:3}function Zv(h,m,b=!0){if(!b||h.length<2)return h;const S=kA(m),z=new Map;for(const A of h){const l=m>=15?`${A.lat.toFixed(4)},${A.lon.toFixed(4)}`:Dy(A.lat,A.lon,S);if(z.has(l)){const N=z.get(l);N.spots.push(A),N.count++,N.minPrice=Math.min(N.minPrice,A.price),N.maxPrice=Math.max(N.maxPrice,A.price),N.lat=N.spots.reduce((W,ne)=>W+ne.lat,0)/N.count,N.lon=N.spots.reduce((W,ne)=>W+ne.lon,0)/N.count}else z.set(l,{id:`cluster-${l}`,lat:A.lat,lon:A.lon,spots:[A],minPrice:A.price,maxPrice:A.price,currency:A.currency,count:1})}const k=[];for(const A of z.values())A.count===1?k.push(A.spots[0]):k.push(A);return k}function Hv(h){return"count"in h&&h.count>1}class R_{q;r;x;p;k;initialized=!1;constructor(m=1e-5,b=.001){this.q=m,this.r=b,this.x=0,this.p=1,this.k=0}filter(m){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(m-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=m,this.initialized=!0,m)}reset(){this.initialized=!1,this.x=0,this.p=1}}class RA{latFilter;lonFilter;bearingFilter;hasLastBearing=!1;constructor(){this.latFilter=new R_(1e-5,.005),this.lonFilter=new R_(1e-5,.005),this.bearingFilter=new R_(.005,.8)}cumulativeBearing=0;lastInputBearing=0;smoothLocation(m,b){return[this.latFilter.filter(m),this.lonFilter.filter(b)]}smoothBearing(m,b,S=!1){if(!S&&b<2)return null;const z=(m%360+360)%360;if(!this.hasLastBearing)return this.lastInputBearing=z,this.cumulativeBearing=z,this.hasLastBearing=!0,this.bearingFilter.reset(),this.bearingFilter.filter(z),z;let k=z-this.lastInputBearing;return k>180?k-=360:k<-180&&(k+=360),this.cumulativeBearing+=k,this.lastInputBearing=z,(this.bearingFilter.filter(this.cumulativeBearing)%360+360)%360}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.cumulativeBearing=0,this.lastInputBearing=0,this.hasLastBearing=!1}}class LA{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(m){const b=(m%360+360)%360;if(!this.initialized)return this.currentRotation=b,this.lastRawBearing=b,this.initialized=!0,this.currentRotation;let S=b-this.lastRawBearing;return S>180?S-=360:S<-180&&(S+=360),this.currentRotation+=S,this.lastRawBearing=b,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(m=0){this.currentRotation=m,this.lastRawBearing=(m%360+360)%360,this.initialized=!0}}class OA{startLat=0;startLon=0;targetLat=0;targetLon=0;currentLat=0;currentLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(m){this.onUpdate=m}animateTo(m,b,S=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=m,this.targetLon=b,this.currentLat=m,this.currentLon=b,this.onUpdate&&this.onUpdate(m,b);return}this.startLat=this.currentLat||this.targetLat,this.startLon=this.currentLon||this.targetLon,this.targetLat=m,this.targetLon=b,this.startTime=performance.now(),this.duration=S,this.animate()}animate=()=>{const b=performance.now()-this.startTime,S=Math.min(b/this.duration,1),z=1-Math.pow(1-S,3),k=this.startLat+(this.targetLat-this.startLat)*z,A=this.startLon+(this.targetLon-this.startLon)*z;this.currentLat=k,this.currentLon=A,this.onUpdate&&this.onUpdate(k,A),S<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class BA{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:20,walking:12,vehicle:6,fast_vehicle:4};pollIntervals={stationary:15e3,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1200,walking:800,vehicle:400,fast_vehicle:200};haversineDistance(m,b,S,z){const A=(S-m)*Math.PI/180,l=(z-b)*Math.PI/180,N=Math.sin(A/2)*Math.sin(A/2)+Math.cos(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371e3*(2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N)))}calculateBearing(m,b,S,z){const k=(z-b)*Math.PI/180,A=Math.sin(k)*Math.cos(S*Math.PI/180),l=Math.cos(m*Math.PI/180)*Math.sin(S*Math.PI/180)-Math.sin(m*Math.PI/180)*Math.cos(S*Math.PI/180)*Math.cos(k);return(Math.atan2(A,l)*180/Math.PI+360)%360}updateLocation(m,b){const S=Date.now();if(!this.initialized)return this.anchorLat=m,this.anchorLon=b,this.displayLat=m,this.displayLon=b,this.lastRawLat=m,this.lastRawLon=b,this.lastUpdateTime=S,this.initialized=!0,{displayLat:m,displayLon:b,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0,bearing:null};const z=this.haversineDistance(this.anchorLat,this.anchorLon,m,b),k=(S-this.lastUpdateTime)/1e3,A=this.haversineDistance(this.lastRawLat,this.lastRawLon,m,b),l=k>0?A/k:0;this.speedHistory.push(l),this.speedHistory.length>5&&this.speedHistory.shift();const N=this.speedHistory.reduce((Ie,pe)=>Ie+pe,0)/this.speedHistory.length;let W;N<.5?W="stationary":N<2?W="walking":N<10?W="vehicle":W="fast_vehicle",this.currentSpeedClass=W;const ne=this.bufferZones[W];if(A>1){const Ie=this.calculateBearing(this.lastRawLat,this.lastRawLon,m,b);this.directionChangeBuffer.push(Ie),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((pe,ae)=>pe+ae,0)/this.directionChangeBuffer.length}this.lastRawLat=m,this.lastRawLon=b,this.lastUpdateTime=S;let re=!1,xe=this.displayLat,Ae=this.displayLon;return z>ne?(this.anchorLat=m,this.anchorLon=b,xe=m,Ae=b,re=!0):(xe=this.anchorLat,Ae=this.anchorLon,re=!1),re&&(this.displayLat=xe,this.displayLon=Ae),{displayLat:this.displayLat,displayLon:this.displayLon,speed:N,speedClass:W,shouldUpdate:re,animationDuration:this.animationDurations[W],bearing:this.predictedBearing}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}getSpeedHistoryAverage(){return this.speedHistory.length===0?0:this.speedHistory.reduce((m,b)=>m+b,0)/this.speedHistory.length}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}const NA=()=>{const h=ze.useRef(null),[m,b]=ze.useState(!1),S=ze.useCallback(async()=>{if("wakeLock"in navigator)try{const k=await navigator.wakeLock.request("screen");h.current=k,b(!0),k.addEventListener("release",()=>{b(!1),h.current=null}),console.log("[Parlens] Screen Wake Lock acquired")}catch(k){console.warn("[Parlens] Failed to acquire Wake Lock:",k),b(!1)}else console.warn("[Parlens] Wake Lock API not supported")},[]),z=ze.useCallback(async()=>{if(h.current)try{await h.current.release(),h.current=null,b(!1),console.log("[Parlens] Screen Wake Lock released")}catch(k){console.warn("[Parlens] Failed to release Wake Lock:",k)}},[]);return ze.useEffect(()=>{const k=async()=>{document.visibilityState==="visible"&&m&&await S()};return document.addEventListener("visibilitychange",k),()=>{document.removeEventListener("visibilitychange",k)}},[m,S]),{requestLock:S,releaseLock:z,isLocked:m}},$v={light:"https://tiles.openfreemap.org/styles/positron",dark:"https://tiles.openfreemap.org/styles/dark"},Xv=ze.memo(({price:h,emoji:m,currency:b,isHistory:S=!1})=>{const z=ug(b);return $.jsxs("div",{className:"flex flex-col items-center justify-center cursor-pointer transition-transform active:scale-95",children:[$.jsx("div",{className:"text-[32px] leading-none drop-shadow-md z-10 filter",children:m}),$.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${S?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[z,Math.round(h),"/hr"]})]})}),W_=ze.memo(({bearing:h,mapBearing:m,isNavigationMode:b})=>{const S=h-m,z=ze.useRef(0),k=ze.useRef(0),A=S-k.current;Math.abs(A)>180&&(A>0?z.current-=360:z.current+=360),k.current=S;const l=S+z.current;return $.jsx("div",{style:{transform:`rotate(${l}deg) scale(1)`,transition:"transform 0.2s ease-out",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:$.jsx("div",{style:{width:28,height:28,background:"#007AFF",border:"3px solid white",borderRadius:"50%",boxShadow:`0 0 0 ${b?3:2}px rgba(0,122,255,${b?.5:.4}), 0 4px 12px rgba(0,0,0,0.4)`,display:"flex",alignItems:"center",justifyContent:"center"},children:$.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"translateY(-1px)"},children:$.jsx("path",{d:"M7 0L14 14L7 12L0 14L7 0Z",fill:"white"})})})})});W_.displayName="UserLocationMarker";const K_=ze.memo(({count:h,minPrice:m,maxPrice:b,currency:S,type:z})=>{const k=z==="open"?"":"",A=z==="history",l=ug(S),N=m===b?`${l}${m}`:`${l}${m}-${b}`;return $.jsxs("div",{className:"flex flex-col items-center justify-center cursor-pointer transition-transform active:scale-95 pointer-events-none",children:[$.jsxs("div",{className:"relative text-[32px] leading-none drop-shadow-md z-10 filter",children:[k,$.jsx("div",{className:`
                    absolute -top-1 -right-1 flex items-center justify-center min-w-[18px] h-[18px] px-1
                    text-[10px] font-bold text-white rounded-full border-2 border-white shadow-sm
                    ${A?"bg-zinc-500":"bg-[#34C759]"}
                `,children:h})]}),$.jsxs("div",{className:`
                    px-2 py-0.5 rounded-full text-[11px] font-bold text-white shadow-md border-[1.5px] border-white -mt-1.5 z-0 whitespace-nowrap
                    ${A?"bg-zinc-500":"bg-[#34C759]"}
                `,children:[N,"/hr"]})]})});K_.displayName="ClusterMarkerContent";const o1=ze.memo(({vehicleType:h})=>{const m=h==="bicycle"?"":h==="motorcycle"?"":"";return $.jsx("div",{style:{fontSize:36,filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.4))",pointerEvents:"none"},children:m})});o1.displayName="ActiveSessionMarkerContent";const l1=ze.memo(({vehicleType:h,onVehicleChange:m,disabled:b})=>{const[S,z]=ze.useState(!1),k=["bicycle","motorcycle","car"],A={bicycle:"",motorcycle:"",car:""};return $.jsx("div",{className:"flex flex-col rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg mb-2 overflow-hidden transition-all duration-300",children:S?$.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[k.map(l=>$.jsx("button",{onClick:()=>{b?b&&alert("Please end your current session before changing vehicle type."):(m(l),z(!1))},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${h===l?"bg-blue-500/20 shadow-inner":"transition-colors"}`,children:$.jsx("span",{className:`text-lg ${h===l?"":"opacity-50"}`,children:A[l]})},l)),$.jsx("button",{onClick:()=>z(!1),className:"w-10 h-6 flex items-center justify-center text-zinc-400 dark:text-white/40 transition-colors",children:$.jsx(O0,{size:16})})]}):$.jsxs("button",{onClick:()=>z(!0),className:"flex flex-col items-center p-1 transition-all",children:[$.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-500/20",children:$.jsx("span",{className:"text-lg",children:A[h]})}),$.jsx(gf,{size:14,className:"text-zinc-400 dark:text-white/40 mt-0.5"})]})})});l1.displayName="VehicleToggle";const FA=()=>{const h=ze.useRef(null),[m,b]=ze.useState(null),S=ze.useRef(new RA),z=ze.useRef(new LA),k=ze.useRef(new OA),[A,l]=ze.useState({longitude:77.5946,latitude:12.9716,zoom:17,bearing:0,pitch:0}),[N,W]=ze.useState(null),[ne,re]=ze.useState("idle"),[xe,Ae]=ze.useState("fixed"),[Ie,pe]=ze.useState(!1),[ae,ke]=ze.useState(!1),[Ke,at]=ze.useState(()=>{const lt=localStorage.getItem("parlens_vehicle_type");return lt==="bicycle"||lt==="motorcycle"||lt==="car"?lt:"car"}),[zt,wt]=ze.useState([]),[ut,ot]=ze.useState([]),[Pe,rt]=ze.useState(null),[nt,ct]=ze.useState(!1),[Tt,Nt]=ze.useState(17),[qt,ht]=ze.useState(null),[Se,Xe]=ze.useState(null),[_t,xt]=ze.useState(null),[Bt,Te]=ze.useState(!1),[Ve,bt]=ze.useState(!1),[Dt,jt]=ze.useState([]),[Xt,Yt]=ze.useState(null),[mn,Kt]=ze.useState(null),[wn,br]=ze.useState(""),Zn=ze.useCallback(()=>{const lt=A,Be={id:crypto.randomUUID(),lat:lt.latitude,lon:lt.longitude,name:`Stop ${Dt.length+1}`};jt(Ut=>[...Ut,Be])},[A,Dt.length]),lr=(lt,Be)=>{jt(Ut=>Ut.map(ln=>ln.id===lt?{...ln,name:Be}:ln)),Kt(null)},Dn=lt=>{jt(Be=>Be.filter(ln=>ln.id!==lt).map((ln,Nn)=>({...ln,name:ln.name.startsWith("Stop ")?`Stop ${Nn+1}`:ln.name})))},Bi=()=>{Yt(Dt.map(lt=>({lat:lt.lat,lon:lt.lon,name:lt.name}))),bt(!1),jt([])};ze.useEffect(()=>{Ve&&(Ae("fixed"),h.current?.stop(),l(lt=>({...lt,pitch:0,bearing:0})))},[Ve]);const[Ni,Kn]=ze.useState(null),[aa,Gr]=ze.useState(!1),li=ze.useRef(!1),xn=ze.useRef(!1),Ar=window.matchMedia("(prefers-color-scheme: dark)").matches,[Sa,xi]=ze.useState(!1),[nr,fe]=ze.useState(0),[Z,X]=ze.useState(0),{requestLock:Q,releaseLock:de}=NA(),we=ze.useRef(new BA),[Le,Re]=ze.useState(0),ye=ze.useRef(!1),Oe=ze.useRef(0),Je=ze.useRef(0);ze.useEffect(()=>{ne==="parked"&&(Ae("fixed"),l(lt=>({...lt,bearing:0,pitch:0})),h.current?.rotateTo(0,{duration:800}))},[ne]),ze.useEffect(()=>{if(!navigator.geolocation){W("Geolocation is not supported by your browser");return}const lt=navigator.geolocation.watchPosition(Be=>{const{latitude:Ut,longitude:ln}=Be.coords,[Nn,Tn]=S.current.smoothLocation(Ut,ln),ft=we.current.updateLocation(Nn,Tn);ft.shouldUpdate&&k.current.animateTo(ft.displayLat,ft.displayLon,ft.animationDuration),Re(ft.speed),Oe.current=ft.speed,ye.current||(ye.current=!0,b([ft.displayLat,ft.displayLon]),l(Jt=>({...Jt,latitude:ft.displayLat,longitude:ft.displayLon})))},Be=>{let Ut="Unable to get your location";Be.code===1?Ut="Location access denied. Please enable location services.":Be.code===2?Ut="Location unavailable. Check your GPS settings.":Be.code===3&&(Ut="Location request timed out."),W(Ut)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return k.current.setUpdateCallback((Be,Ut)=>{b([Be,Ut]),Ae(ln=>{if((ln==="auto"||ln==="recentre")&&!li.current){if(Oe.current<.3&&ln!=="recentre")return ln;l(Nn=>{const Tn=h.current?.getZoom()??Nn.zoom,ft=.1,Jt=Nn.latitude+(Be-Nn.latitude)*ft,rn=Nn.longitude+(Ut-Nn.longitude)*ft;return{...Nn,latitude:Jt,longitude:rn,zoom:Tn}})}return ln})}),()=>{navigator.geolocation.clearWatch(lt),k.current.stop()}},[]),ze.useEffect(()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&xi(!0);const lt=Be=>{if(li.current)return;let Ut=null;if(Be.webkitCompassHeading?Ut=Be.webkitCompassHeading:Be.alpha!==null&&(Ut=360-Be.alpha),Ut!==null){const ln=window.screen.orientation?.angle??window.orientation??0;Ut=(Ut+ln)%360}if(Ut!==null){Je.current=Ut,X(Nn=>{let ft=Ut-Nn;return ft>180&&(ft-=360),ft<-180&&(ft+=360),Math.abs(ft)<2?Nn:Nn+ft*.1});const ln=S.current.smoothBearing(Ut,0,!0);if(ln!==null){const Nn=z.current.setBearing(ln);fe(Nn)}}};return window.addEventListener("deviceorientation",lt,!0),()=>{window.removeEventListener("deviceorientation",lt,!0)}},[]);const it=async()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission()==="granted"&&xi(!1)};ze.useEffect(()=>{!li.current&&!xn.current&&m&&(xe==="auto"||xe==="recentre")&&l(lt=>{const Be=h.current?.getZoom()??lt.zoom,Ut={...lt,longitude:m[1],latitude:m[0],zoom:Be,pitch:0};return xe==="auto"&&(Ut.bearing=nr,Ut.transitionDuration=100),Ut})},[m,nr,xe,Bt]),ze.useEffect(()=>(Q(),()=>{de()}),[Q,de]),ze.useEffect(()=>{const lt=localStorage.getItem("parlens_session");if(lt)try{const Be=JSON.parse(lt);Be.status==="parked"&&Be.parkLocation&&Be.sessionStart?(console.log("[Parlens] Restoring parked session:",Be),Kn(Be.sessionStart),rt(Be.parkLocation),re("parked")):Be.status==="search"&&(console.log("[Parlens] Restoring search session"),re("search"))}catch(Be){console.warn("[Parlens] Failed to restore session:",Be),localStorage.removeItem("parlens_session")}},[]),ze.useEffect(()=>{ne==="parked"&&Ni&&Pe?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Ni,parkLocation:Pe})):ne==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):ne==="idle"&&(localStorage.removeItem("parlens_session"),Kn(null))},[ne,Ni,Pe]);const Mt=ze.useCallback(lt=>{l(lt.viewState);let Be=!1;if(h.current&&(hn.current&&(Be=!0),h.current.isZooming()&&(Be=!0),lt&&lt.originalEvent&&lt.originalEvent.touches&&lt.originalEvent.touches.length>1&&(Be=!0)),li.current&&(xe==="auto"||xe==="recentre")&&!Be){let Ut=1;m&&(Ut=Math.sqrt(Math.pow(lt.viewState.longitude-m[1],2)+Math.pow(lt.viewState.latitude-m[0],2))),Ut>1e-4&&Ae("fixed")}},[m,xe,nt]),Pt=ze.useCallback(lt=>{lt.originalEvent&&(li.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1))},[]),$t=ze.useCallback(()=>{setTimeout(()=>{li.current=!1},1e3),Nt(A.zoom)},[A.zoom]),hn=ze.useRef(!1),dn=ze.useCallback(()=>{hn.current=!0,li.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1)},[]),Fe=ze.useCallback(()=>{hn.current=!1,setTimeout(()=>{hn.current||(li.current=!1)},1e3)},[]),Pn=ze.useCallback(lt=>{},[]),Mi=lt=>{if(ne!=="idle"){alert("Please end your current session before changing vehicle type.");return}at(lt),localStorage.setItem("parlens_vehicle_type",lt)},nn=ze.useCallback((lt,Be,Ut,ln)=>{if(ht(lt),Xe(Be),xt(Ut),Te(ln),lt&&lt.length>1&&h.current&&ln){const Nn=[...lt];Be&&Be.length>0&&Nn.push(...Be);const Tn=Nn.map(rn=>rn[1]),ft=Nn.map(rn=>rn[0]),Jt=new Jb.LngLatBounds([Math.min(...Tn),Math.min(...ft)],[Math.max(...Tn),Math.max(...ft)]);xn.current=!0,h.current.fitBounds(Jt,{padding:50,duration:1e3}),Ae("fixed"),setTimeout(()=>{xn.current=!1,typeof DeviceOrientationEvent.requestPermission=="function"&&xi(!0)},1200)}},[]),In=ze.useMemo(()=>ut.filter(Be=>(Be.decryptedContent?.type||"car")===Ke).map(Be=>{const Ut=Be.decryptedContent;return Ut&&Ut.lat&&Ut.lon?{id:Be.id,lat:Ut.lat,lon:Ut.lon,price:parseFloat(Ut.fee)||0,currency:Ut.currency||"USD",original:Be}:null}).filter(Boolean),[ut,Ke]),Gi=ze.useMemo(()=>Zv(In,Tt),[In,Tt]),Bn=ze.useMemo(()=>ne!=="search"?[]:zt.filter(lt=>(lt.type||"car")===Ke).map(lt=>({id:lt.id,lat:lt.lat,lon:lt.lon,price:lt.price,currency:lt.currency,original:lt})),[zt,Ke,ne]),di=ze.useMemo(()=>Zv(Bn,Tt),[Bn,Tt]),Un=Ar?$v.dark:$v.light,Ai={id:"route",type:"line",paint:{"line-color":"#007AFF","line-width":5,"line-opacity":.9}},ho={id:"alternate-route",type:"line",paint:{"line-color":"#007AFF","line-width":3,"line-opacity":.4,"line-dasharray":[2,2]}};return $.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[(!m&&!N||!aa)&&$.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:$.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:N?$.jsxs($.Fragment,{children:[$.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:$.jsx("span",{className:"text-2xl",children:""})}),$.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:N}),$.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-blue-500 text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):$.jsxs($.Fragment,{children:[$.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),$.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})}),Ve&&$.jsxs($.Fragment,{children:[$.jsx("div",{className:"absolute top-4 right-4 z-[2000] animate-in slide-in-from-top-4 fade-in",children:$.jsxs("button",{onClick:Bi,className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2.5 rounded-full font-bold shadow-lg flex items-center gap-2 transition-transform active:scale-95",children:[$.jsx($_,{size:18,strokeWidth:3}),"Done"]})}),$.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[1500] pointer-events-none opacity-80",children:$.jsxs("div",{className:"relative",children:[$.jsx(SM,{size:32,className:"text-black/50 drop-shadow-sm",strokeWidth:1,style:{position:"absolute",top:-16,left:-16}}),$.jsx("div",{className:"w-1.5 h-1.5 bg-black rounded-full absolute top-[-3px] left-[-3px]"})]})}),$.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-8 z-[1500]",children:$.jsxs("button",{onClick:Zn,className:"bg-zinc-900/90 dark:bg-zinc-100/90 text-white dark:text-zinc-900 px-4 py-2 rounded-xl font-bold text-sm shadow-xl backdrop-blur-md active:scale-95 transition-all flex items-center gap-2 border border-white/10 dark:border-black/5",children:[$.jsx(kc,{size:14,className:"fill-current"}),"Drop Pin Here"]})})]}),ne==="parked"&&$.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-[#34C759] rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[$.jsx("div",{className:"text-xl",children:Ke==="bicycle"?"":Ke==="motorcycle"?"":""}),$.jsx("span",{className:"font-bold text-white whitespace-nowrap",children:"Session Active"})]}),ne==="search"&&$.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[1000] h-12 px-6 bg-white dark:bg-zinc-800 rounded-full shadow-lg flex items-center gap-3 animate-in slide-in-from-top-4 pointer-events-none",children:[$.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#FF9500] animate-pulse"}),$.jsx("span",{className:"font-bold text-zinc-900 dark:text-white whitespace-nowrap",children:"Searching for spots"})]}),xe==="auto"&&m&&$.jsx("div",{className:"absolute top-1/2 left-1/2 z-[900] pointer-events-none flex items-center justify-center",style:{transform:"translate(-50%, -50%)",width:"40px",height:"40px"},children:$.jsx(W_,{bearing:Z,mapBearing:A.bearing,isNavigationMode:!0})}),$.jsx("div",{className:"absolute inset-0",onPointerDownCapture:()=>{li.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1)},onTouchStartCapture:()=>{li.current=!0,k.current.stop(),xn.current&&(h.current?.stop(),xn.current=!1)},onWheelCapture:()=>{li.current=!0,xn.current&&(h.current?.stop(),xn.current=!1),window.wheelDebounce&&clearTimeout(window.wheelDebounce),window.wheelDebounce=setTimeout(()=>{li.current=!1},1e3)},style:{touchAction:"none"},children:$.jsxs(KM,{ref:h,...A,onLoad:lt=>{Gr(!0);const Be=lt.target;Be&&Be.getStyle().layers?.forEach(ln=>{(ln.id.includes("oneway")||ln.id.includes("arrow")||ln.id.includes("direction"))&&Be.setLayoutProperty(ln.id,"visibility","none")})},onMove:Mt,onMoveStart:Pt,onMoveEnd:$t,onZoomStart:dn,onZoomEnd:Fe,onRotateStart:()=>{li.current=!0,k.current.stop()},onRotateEnd:$t,onPitchStart:()=>{li.current=!0,k.current.stop()},onPitchEnd:$t,onClick:lt=>{!li.current&&!Ve&&Pn(lt)},style:{width:"100%",height:"100%"},mapStyle:Un,attributionControl:!1,dragPan:!xn.current,minZoom:3,maxZoom:20,renderWorldCopies:!1,children:[Bt&&Se&&Se.length>1&&$.jsx(Fv,{id:"alternate-route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Se.map(lt=>[lt[1],lt[0]])}},children:$.jsx(jv,{...ho})}),Bt&&qt&&qt.length>1&&$.jsx(Fv,{id:"route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:qt.map(lt=>[lt[1],lt[0]])}},children:$.jsx(jv,{...Ai})}),ne==="search"&&di.map(lt=>{const Be=Hv(lt);return $.jsx(jp,{longitude:lt.lon,latitude:lt.lat,anchor:"center",style:{willChange:"transform"},onClick:Ut=>{Ut.originalEvent.stopPropagation(),Be?h.current?.flyTo({center:[lt.lon,lt.lat],zoom:A.zoom+2}):Pn({lngLat:{lng:lt.lon,lat:lt.lat}})},children:Be?$.jsx(K_,{count:lt.count,minPrice:lt.minPrice,maxPrice:lt.maxPrice,currency:lt.currency,type:"open"}):$.jsx(Xv,{price:lt.price,currency:lt.currency,emoji:""})},`open-${lt.id}`)}),Gi.map(lt=>{const Be=Hv(lt);return $.jsx(jp,{longitude:lt.lon,latitude:lt.lat,anchor:"center",style:{willChange:"transform"},onClick:Ut=>{Ut.originalEvent.stopPropagation(),Be&&h.current?.flyTo({center:[lt.lon,lt.lat],zoom:A.zoom+2})},children:Be?$.jsx(K_,{count:lt.count,minPrice:lt.minPrice,maxPrice:lt.maxPrice,currency:lt.currency,type:"history"}):$.jsx(Xv,{price:lt.price,currency:lt.currency,emoji:"",isHistory:!0})},`history-${lt.id}`)}),Bt&&_t?.map((lt,Be)=>$.jsx(jp,{longitude:lt.lon,latitude:lt.lat,anchor:"center",children:$.jsx("div",{style:{width:20,height:20,background:"#007AFF",border:"2px solid white",borderRadius:"50%",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:10,fontWeight:"bold"},children:Be+1})},`waypoint-${Be}`)),ne==="parked"&&Pe&&$.jsx(jp,{longitude:Pe[1],latitude:Pe[0],anchor:"center",children:$.jsx(o1,{vehicleType:Ke})}),m&&xe!=="auto"&&$.jsx(jp,{longitude:m[1],latitude:m[0],anchor:"center",style:{zIndex:1e3},children:$.jsx(W_,{bearing:Z,mapBearing:A.bearing,isNavigationMode:!1})}),Ve&&Dt.map(lt=>$.jsx(jp,{longitude:lt.lon,latitude:lt.lat,anchor:"bottom",children:$.jsxs("div",{className:"flex flex-col items-center",children:[$.jsx("div",{className:"mb-1",children:mn===lt.id?$.jsxs("div",{className:"flex items-center gap-1 bg-white dark:bg-zinc-800 p-1.5 rounded-lg shadow-lg border border-blue-500 animate-in fade-in zoom-in duration-200",children:[$.jsx("input",{type:"text",value:wn,onChange:Be=>br(Be.target.value),onKeyDown:Be=>{Be.key==="Enter"&&lr(lt.id,wn)},className:"w-24 text-xs font-bold bg-transparent border-none outline-none text-zinc-900 dark:text-white",autoFocus:!0}),$.jsx("button",{onClick:()=>lr(lt.id,wn),className:"p-1 hover:bg-green-500/10 rounded-full text-green-600 dark:text-green-400",children:$.jsx($_,{size:12,strokeWidth:3})}),$.jsx("button",{onClick:()=>Dn(lt.id),className:"p-1 hover:bg-red-500/10 rounded-full text-red-500",children:$.jsx(Cy,{size:12,strokeWidth:3})})]}):$.jsxs("div",{className:"flex items-center bg-white dark:bg-zinc-800 px-2 py-1 rounded-md shadow-md gap-2 border border-black/5 dark:border-white/10",children:[$.jsx("span",{className:"text-xs font-bold text-zinc-700 dark:text-zinc-200",children:lt.name}),$.jsxs("div",{className:"flex gap-1 border-l border-zinc-200 dark:border-white/10 pl-2",children:[$.jsx("button",{onClick:Be=>{Be.stopPropagation(),Kt(lt.id),br(lt.name)},className:"text-blue-500",children:$.jsx($b,{size:10})}),$.jsx("button",{onClick:Be=>{Be.stopPropagation(),Dn(lt.id)},className:"text-red-500",children:$.jsx(RM,{size:10})})]})]})}),$.jsx(kc,{size:32,className:"text-blue-500 drop-shadow-md fill-blue-500/20"})]})},lt.id))]})}),$.jsxs("div",{className:"absolute z-[1000] flex flex-col items-start gap-3 animate-in slide-in-from-left-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[$.jsx(l1,{vehicleType:Ke,onVehicleChange:Mi,disabled:ne!=="idle"||Ve===!0}),!Ve&&$.jsx("button",{onClick:()=>ke(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95",children:$.jsx(Dv,{size:20})})]}),$.jsxs("div",{className:"absolute z-[1000] flex flex-col items-end gap-3 animate-in slide-in-from-right-6",style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[Math.abs(A.bearing)>5&&xe!=="auto"&&$.jsx("button",{onClick:()=>{h.current?.rotateTo(0,{duration:400}),l(lt=>({...lt,bearing:0,pitch:0}))},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10",title:"Reset to true north",children:$.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-A.bearing}deg)`},children:[$.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid rgb(239 68 68)"}}),$.jsx("span",{className:"text-sm font-bold text-zinc-600 dark:text-white/70",style:{marginTop:"-2px"},children:"N"})]})}),$.jsx("button",{onClick:async()=>{if(Sa){await it();return}h.current?.stop(),xn.current=!1;const lt=A.zoom,Be=17;if(nt){if(m){const Ut=lt<Be?Be:lt;xn.current=!0,h.current?.flyTo({center:[m[1],m[0]],zoom:Ut,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1})}Ae("recentre"),ct(!1);return}if((xe==="fixed"||xe==="recentre")&&m&&(xn.current=!0,h.current?.flyTo({center:[m[1],m[0]],zoom:lt<Be?Be:lt,bearing:0,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1,xe==="fixed"&&Ae("recentre")})),xe==="recentre"){if(ne==="parked"){xn.current=!0,h.current?.flyTo({bearing:0,pitch:0,zoom:16.5,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1}),Ae("fixed");return}const Ut=Z||0;xn.current=!0,pe(!0),h.current?.rotateTo(Ut,{duration:800}),h.current?.once("moveend",()=>{xn.current=!1,pe(!1),z.current.reset(Ut),Ae("auto")});return}Ae(Ut=>Ut==="auto"?(xn.current=!0,h.current?.flyTo({bearing:0,pitch:0,zoom:16.5,duration:800,essential:!0}),h.current?.once("moveend",()=>{xn.current=!1}),pe(!1),"fixed"):"recentre")},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg ${Sa?"bg-orange-500/20 border-orange-500/50 text-orange-500 animate-pulse":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:Sa?$.jsx(kc,{size:20}):xe==="auto"||Ie?$.jsx(tM,{size:20,className:"text-blue-500"}):xe==="recentre"?$.jsx(gM,{size:20,fill:"currentColor",className:"text-green-500"}):$.jsx(kc,{size:20})}),$.jsx(IA,{vehicleType:Ke,onRouteChange:nn,currentLocation:m,onDropPinModeChange:bt,pendingWaypoints:Xt,onDropPinConsumed:()=>Yt(null)}),!Ve&&$.jsx("div",{className:"relative z-[1010]",children:$.jsx(DA,{setHistorySpots:ot})}),!Ve&&$.jsx(CA,{status:ne,setStatus:re,searchLocation:m,vehicleType:Ke,setOpenSpots:wt,parkLocation:Pe,setParkLocation:rt,sessionStart:Ni,setSessionStart:Kn})]}),ae&&$.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[$.jsx("button",{onClick:()=>ke(!1),className:"absolute inset-0 z-0 cursor-default"}),$.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",style:{overscrollBehaviorY:"contain"},children:[$.jsx("button",{onClick:()=>ke(!1),className:"absolute top-6 right-6 p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:$.jsx(Cy,{size:20,className:"text-black/60 dark:text-white/60"})}),$.jsxs("div",{className:"text-center space-y-2 pt-4",children:[$.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:$.jsx(Dv,{size:32})}),$.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"}),$.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Decentralized Route & Parking Management"})]}),$.jsxs("div",{className:"space-y-3",children:[$.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),$.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[$.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[$.jsx("span",{children:"Using Browser Menu (Android)"}),$.jsx(gf,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),$.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[$.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),$.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[$.jsx("li",{children:"Tap menu button (three dots)"}),$.jsxs("li",{children:["Tap ",$.jsx("strong",{children:"Add to Home screen"})]}),$.jsxs("li",{children:["Tap ",$.jsx("strong",{children:"Add"})," to confirm"]})]}),$.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),$.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[$.jsx("li",{children:"Tap menu button (three dots)"}),$.jsxs("li",{children:["Tap ",$.jsx("strong",{children:"Install"})]})]})]})]}),$.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[$.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[$.jsx("span",{children:"Using Share Button (iOS)"}),$.jsx(gf,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),$.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:$.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[$.jsxs("li",{children:["Tap the ",$.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),$.jsxs("li",{children:["Scroll down and tap ",$.jsx("strong",{children:"Add to Home Screen"}),"."]}),$.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),$.jsxs("div",{className:"space-y-6 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[$.jsxs("p",{children:[$.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select vehicle type"}),"Use the vertical toggle on the bottom-left to switch between Bicycle , Motorcycle , or Car ."]}),$.jsxs("p",{children:[$.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Plan your route (optional)"}),"Tap the route button to add waypoints and create a route. If the system generated route(s) between your start and end points are not to your liking, add additional waypoints in locations you would prefer travelling through. Click the location button to re-centre and turn on follow-me or navigation mode for route tracking."]}),$.jsxs("p",{children:[$.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Find and log parking"}),"Click the main button once to see open spots reported by others live or within the last 5 minutes. Click again to mark your location. When leaving, click once more to end the session and report the fee. Use the profile button to see your parking history."]}),$.jsxs("p",{children:[$.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Create your own mirror (optional)"}),$.jsx("a",{href:"https://github.com/prasannawarrier/parlens-pwa/blob/main/MIRROR_CREATION.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 dark:text-blue-400 underline",children:"Follow these steps"})," to create your own mirror of the Parlens app to distribute the bandwidth load while sharing with your friends."]}),$.jsxs("p",{children:[$.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. User privacy"}),"Parlens does not collect or share any user data. Your log and route data is encrypted by your keys and only accessible by you. Open spot broadcasts are ephemeral and not linked to any personal identifiers."]}),$.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20 mt-6",children:$.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[$.jsx("span",{className:"font-bold",children:"Tip: "}),"Use Parlens over your cellular internet connection to prevent personal IP address(es) from being associated with your data."]})})]})]})]})]})},jA=()=>{const{login:h}=Yp(),[m,b]=ze.useState(""),[S,z]=ze.useState(""),[k,A]=ze.useState(!1),[l,N]=ze.useState("landing"),[W,ne]=ze.useState(""),[re,xe]=ze.useState(null),Ae=async ke=>{A(!0),z("");try{await h(ke,ke==="nsec"?m:void 0)}catch(Ke){z(Ke.message)}finally{A(!1)}},Ie=()=>{N("setup")},pe=async()=>{if(!W.trim()){z("Please enter a username");return}A(!0);try{const{generateSecretKey:ke,getPublicKey:Ke}=await rx(async()=>{const{generateSecretKey:Pe,getPublicKey:rt}=await Promise.resolve().then(()=>AA);return{generateSecretKey:Pe,getPublicKey:rt}},void 0),at=Pe=>Array.from(Pe).map(rt=>rt.toString(16).padStart(2,"0")).join(""),zt=ke(),wt=Ke(zt);localStorage.setItem("parlens_privkey",at(zt)),localStorage.setItem("parlens_pubkey",wt),localStorage.setItem("parlens_pending_username",W);const ut=ff.npubEncode(wt),ot=ff.nsecEncode(zt);xe({npub:ut,nsec:ot}),N("backup")}catch(ke){z(ke.message)}finally{A(!1)}},ae=async()=>{A(!0);try{const ke=localStorage.getItem("parlens_pending_username");await h("create",void 0,ke||W),localStorage.removeItem("parlens_pending_username")}catch(ke){z(ke.message)}finally{A(!1)}};return $.jsx("div",{className:"min-h-screen bg-black p-6 text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:$.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[$.jsxs("div",{className:"space-y-4",children:[$.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),$.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter",children:"Parlens"}),$.jsx("p",{className:"text-sm font-medium text-white/40 tracking-tight",children:"Decentralized Route & Parking Management"})]}),$.jsxs("div",{className:"space-y-4",children:[l==="landing"?$.jsxs($.Fragment,{children:[$.jsx("button",{onClick:Ie,disabled:k,className:"w-full h-16 rounded-3xl bg-white text-black font-bold text-lg shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3",children:k?"Creating...":$.jsxs($.Fragment,{children:[$.jsx(OM,{size:20,strokeWidth:3}),"Create a New Account"]})}),$.jsxs("button",{onClick:()=>N("nsec"),disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[$.jsx(X_,{size:18}),"Login with Secret Key"]})]}):l==="setup"?$.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[$.jsxs("div",{className:"text-center pb-2",children:[$.jsx("h3",{className:"text-xl font-bold",children:"Pick a Username"}),$.jsx("p",{className:"text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),$.jsx("input",{type:"text",placeholder:"Username",value:W,onChange:ke=>ne(ke.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),$.jsxs("div",{className:"flex gap-3",children:[$.jsx("button",{onClick:()=>N("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),$.jsx("button",{onClick:pe,disabled:k||!W,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Creating...":"Continue"})]})]}):l==="backup"?$.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[$.jsxs("div",{className:"text-center pb-2",children:[$.jsx("h3",{className:"text-xl font-bold",children:" Account Created!"}),$.jsx("p",{className:"text-white/40 text-sm mt-1",children:"Back up your keys before continuing"})]}),$.jsxs("div",{className:"space-y-4",children:[$.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-white/30 ml-2",children:"Your Keys"}),$.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white/[0.03] border border-white/10",children:[$.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-white/10",onClick:()=>{re&&(navigator.clipboard.writeText(re.npub),alert("Public Key copied to clipboard"))},children:[$.jsxs("div",{className:"flex items-center gap-3",children:[$.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/20 text-blue-400",children:$.jsx(X_,{size:20})}),$.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Public Key (Npub)"})]}),$.jsx(Ay,{size:18,className:"text-white/20"})]}),$.jsx("div",{className:"h-[1px] bg-white/5 mx-4"}),$.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-white/10",onClick:()=>{re&&(navigator.clipboard.writeText(re.nsec),alert("Secret Key copied to clipboard - keep this safe!"))},children:[$.jsxs("div",{className:"flex items-center gap-3",children:[$.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/20 text-red-500",children:$.jsx(Xb,{size:20})}),$.jsx("span",{className:"font-semibold text-sm text-white",children:"Copy Secret Key (Nsec)"})]}),$.jsx(Ay,{size:18,className:"text-white/20"})]})]}),$.jsx("p",{className:"text-xs text-white/30 mt-2 ml-2 leading-relaxed text-center",children:" Store these keys securely. They cannot be recovered if lost."})]}),$.jsx("button",{onClick:ae,disabled:k,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:k?"Starting...":"Start Using Parlens"})]}):$.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[$.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:m,onChange:ke=>b(ke.target.value),className:"w-full h-16 rounded-3xl bg-zinc-900 border border-white/10 px-6 text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-white/20",autoFocus:!0}),$.jsxs("div",{className:"flex gap-3",children:[$.jsx("button",{onClick:()=>N("landing"),className:"h-16 px-6 rounded-3xl bg-zinc-900 text-white font-bold",children:"Back"}),$.jsx("button",{onClick:()=>Ae("nsec"),disabled:k||!m,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:k?"Decrypting...":"Login with Key"})]})]}),S&&$.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:S}),$.jsxs("div",{className:"space-y-3 pt-6 border-t border-white/10",children:[$.jsx("h3",{className:"text-center font-bold text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),$.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[$.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[$.jsx("span",{children:"Using Browser Menu (Android)"}),$.jsx(gf,{size:16,className:"text-white/50"})]}),$.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:[$.jsx("p",{className:"font-semibold text-white/80",children:"Chrome & Brave:"}),$.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[$.jsx("li",{children:"Tap menu button (three dots)"}),$.jsxs("li",{children:["Tap ",$.jsx("strong",{children:"Add to Home screen"})]}),$.jsxs("li",{children:["Tap ",$.jsx("strong",{children:"Add"})," to confirm"]})]}),$.jsx("p",{className:"font-semibold text-white/80 mt-3",children:"Firefox:"}),$.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[$.jsx("li",{children:"Tap menu button (three dots)"}),$.jsxs("li",{children:["Tap ",$.jsx("strong",{children:"Install"})]})]})]})]}),$.jsxs("div",{className:"rounded-2xl bg-white/5 overflow-hidden",children:[$.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[$.jsx("span",{children:"Using Share Button (iOS)"}),$.jsx(gf,{size:16,className:"text-white/50"})]}),$.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-white/60 space-y-2 text-left",children:$.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[$.jsxs("li",{children:["Tap the ",$.jsx("strong",{className:"text-white/80",children:"Share"})," button in Safari menu bar."]}),$.jsxs("li",{children:["Scroll down and tap ",$.jsx("strong",{className:"text-white/80",children:"Add to Home Screen"}),"."]}),$.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},UA=()=>{const{pubkey:h}=Yp();return i0.useEffect(()=>{let m=0;const b=()=>{if(document.visibilityState==="hidden")m=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&m>0){const z=Date.now()-m;console.log("[App] Foregrounded after",z,"ms"),z>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},S=z=>{z.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",b),window.addEventListener("pageshow",S),()=>{document.removeEventListener("visibilitychange",b),window.removeEventListener("pageshow",S)}},[]),h?$.jsx(FA,{}):$.jsx(jA,{})};var Yy=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(h){return this.listeners.add(h),this.onSubscribe(),()=>{this.listeners.delete(h),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},VA={setTimeout:(h,m)=>setTimeout(h,m),clearTimeout:h=>clearTimeout(h),setInterval:(h,m)=>setInterval(h,m),clearInterval:h=>clearInterval(h)},qA=class{#e=VA;#t=!1;setTimeoutProvider(h){this.#e=h}setTimeout(h,m){return this.#e.setTimeout(h,m)}clearTimeout(h){this.#e.clearTimeout(h)}setInterval(h,m){return this.#e.setInterval(h,m)}clearInterval(h){this.#e.clearInterval(h)}},Q_=new qA;function GA(h){setTimeout(h,0)}var Wy=typeof window>"u"||"Deno"in globalThis;function Ll(){}function ZA(h,m){return typeof h=="function"?h(m):h}function HA(h){return typeof h=="number"&&h>=0&&h!==1/0}function $A(h,m){return Math.max(h+(m||0)-Date.now(),0)}function J_(h,m){return typeof h=="function"?h(m):h}function XA(h,m){return typeof h=="function"?h(m):h}function Yv(h,m){const{type:b="all",exact:S,fetchStatus:z,predicate:k,queryKey:A,stale:l}=h;if(A){if(S){if(m.queryHash!==B0(A,m.options))return!1}else if(!dg(m.queryKey,A))return!1}if(b!=="all"){const N=m.isActive();if(b==="active"&&!N||b==="inactive"&&N)return!1}return!(typeof l=="boolean"&&m.isStale()!==l||z&&z!==m.state.fetchStatus||k&&!k(m))}function Wv(h,m){const{exact:b,status:S,predicate:z,mutationKey:k}=h;if(k){if(!m.options.mutationKey)return!1;if(b){if(hg(m.options.mutationKey)!==hg(k))return!1}else if(!dg(m.options.mutationKey,k))return!1}return!(S&&m.state.status!==S||z&&!z(m))}function B0(h,m){return(m?.queryKeyHashFn||hg)(h)}function hg(h){return JSON.stringify(h,(m,b)=>e0(b)?Object.keys(b).sort().reduce((S,z)=>(S[z]=b[z],S),{}):b)}function dg(h,m){return h===m?!0:typeof h!=typeof m?!1:h&&m&&typeof h=="object"&&typeof m=="object"?Object.keys(m).every(b=>dg(h[b],m[b])):!1}var YA=Object.prototype.hasOwnProperty;function c1(h,m){if(h===m)return h;const b=Kv(h)&&Kv(m);if(!b&&!(e0(h)&&e0(m)))return m;const z=(b?h:Object.keys(h)).length,k=b?m:Object.keys(m),A=k.length,l=b?new Array(A):{};let N=0;for(let W=0;W<A;W++){const ne=b?W:k[W],re=h[ne],xe=m[ne];if(re===xe){l[ne]=re,(b?W<z:YA.call(h,ne))&&N++;continue}if(re===null||xe===null||typeof re!="object"||typeof xe!="object"){l[ne]=xe;continue}const Ae=c1(re,xe);l[ne]=Ae,Ae===re&&N++}return z===A&&N===z?h:l}function Kv(h){return Array.isArray(h)&&h.length===Object.keys(h).length}function e0(h){if(!Qv(h))return!1;const m=h.constructor;if(m===void 0)return!0;const b=m.prototype;return!(!Qv(b)||!b.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(h)!==Object.prototype)}function Qv(h){return Object.prototype.toString.call(h)==="[object Object]"}function WA(h){return new Promise(m=>{Q_.setTimeout(m,h)})}function KA(h,m,b){return typeof b.structuralSharing=="function"?b.structuralSharing(h,m):b.structuralSharing!==!1?c1(h,m):m}function QA(h,m,b=0){const S=[...h,m];return b&&S.length>b?S.slice(1):S}function JA(h,m,b=0){const S=[m,...h];return b&&S.length>b?S.slice(0,-1):S}var N0=Symbol();function u1(h,m){return!h.queryFn&&m?.initialPromise?()=>m.initialPromise:!h.queryFn||h.queryFn===N0?()=>Promise.reject(new Error(`Missing queryFn: '${h.queryHash}'`)):h.queryFn}var eC=class extends Yy{#e;#t;#n;constructor(){super(),this.#n=h=>{if(!Wy&&window.addEventListener){const m=()=>h();return window.addEventListener("visibilitychange",m,!1),()=>{window.removeEventListener("visibilitychange",m)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(h){this.#n=h,this.#t?.(),this.#t=h(m=>{typeof m=="boolean"?this.setFocused(m):this.onFocus()})}setFocused(h){this.#e!==h&&(this.#e=h,this.onFocus())}onFocus(){const h=this.isFocused();this.listeners.forEach(m=>{m(h)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},h1=new eC;function tC(){let h,m;const b=new Promise((z,k)=>{h=z,m=k});b.status="pending",b.catch(()=>{});function S(z){Object.assign(b,z),delete b.resolve,delete b.reject}return b.resolve=z=>{S({status:"fulfilled",value:z}),h(z)},b.reject=z=>{S({status:"rejected",reason:z}),m(z)},b}var nC=GA;function iC(){let h=[],m=0,b=l=>{l()},S=l=>{l()},z=nC;const k=l=>{m?h.push(l):z(()=>{b(l)})},A=()=>{const l=h;h=[],l.length&&z(()=>{S(()=>{l.forEach(N=>{b(N)})})})};return{batch:l=>{let N;m++;try{N=l()}finally{m--,m||A()}return N},batchCalls:l=>(...N)=>{k(()=>{l(...N)})},schedule:k,setNotifyFunction:l=>{b=l},setBatchNotifyFunction:l=>{S=l},setScheduler:l=>{z=l}}}var us=iC(),rC=class extends Yy{#e=!0;#t;#n;constructor(){super(),this.#n=h=>{if(!Wy&&window.addEventListener){const m=()=>h(!0),b=()=>h(!1);return window.addEventListener("online",m,!1),window.addEventListener("offline",b,!1),()=>{window.removeEventListener("online",m),window.removeEventListener("offline",b)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(h){this.#n=h,this.#t?.(),this.#t=h(this.setOnline.bind(this))}setOnline(h){this.#e!==h&&(this.#e=h,this.listeners.forEach(b=>{b(h)}))}isOnline(){return this.#e}},Iy=new rC;function aC(h){return Math.min(1e3*2**h,3e4)}function d1(h){return(h??"online")==="online"?Iy.isOnline():!0}var t0=class extends Error{constructor(h){super("CancelledError"),this.revert=h?.revert,this.silent=h?.silent}};function f1(h){let m=!1,b=0,S;const z=tC(),k=()=>z.status!=="pending",A=pe=>{if(!k()){const ae=new t0(pe);xe(ae),h.onCancel?.(ae)}},l=()=>{m=!0},N=()=>{m=!1},W=()=>h1.isFocused()&&(h.networkMode==="always"||Iy.isOnline())&&h.canRun(),ne=()=>d1(h.networkMode)&&h.canRun(),re=pe=>{k()||(S?.(),z.resolve(pe))},xe=pe=>{k()||(S?.(),z.reject(pe))},Ae=()=>new Promise(pe=>{S=ae=>{(k()||W())&&pe(ae)},h.onPause?.()}).then(()=>{S=void 0,k()||h.onContinue?.()}),Ie=()=>{if(k())return;let pe;const ae=b===0?h.initialPromise:void 0;try{pe=ae??h.fn()}catch(ke){pe=Promise.reject(ke)}Promise.resolve(pe).then(re).catch(ke=>{if(k())return;const Ke=h.retry??(Wy?0:3),at=h.retryDelay??aC,zt=typeof at=="function"?at(b,ke):at,wt=Ke===!0||typeof Ke=="number"&&b<Ke||typeof Ke=="function"&&Ke(b,ke);if(m||!wt){xe(ke);return}b++,h.onFail?.(b,ke),WA(zt).then(()=>W()?void 0:Ae()).then(()=>{m?xe(ke):Ie()})})};return{promise:z,status:()=>z.status,cancel:A,continue:()=>(S?.(),z),cancelRetry:l,continueRetry:N,canStart:ne,start:()=>(ne()?Ie():Ae().then(Ie),z)}}var p1=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),HA(this.gcTime)&&(this.#e=Q_.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(h){this.gcTime=Math.max(this.gcTime||0,h??(Wy?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Q_.clearTimeout(this.#e),this.#e=void 0)}},sC=class extends p1{#e;#t;#n;#r;#i;#s;#o;constructor(h){super(),this.#o=!1,this.#s=h.defaultOptions,this.setOptions(h.options),this.observers=[],this.#r=h.client,this.#n=this.#r.getQueryCache(),this.queryKey=h.queryKey,this.queryHash=h.queryHash,this.#e=ex(this.options),this.state=h.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(h){if(this.options={...this.#s,...h},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const m=ex(this.options);m.data!==void 0&&(this.setState(Jv(m.data,m.dataUpdatedAt)),this.#e=m)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(h,m){const b=KA(this.state.data,h,this.options);return this.#a({data:b,type:"success",dataUpdatedAt:m?.updatedAt,manual:m?.manual}),b}setState(h,m){this.#a({type:"setState",state:h,setStateOptions:m})}cancel(h){const m=this.#i?.promise;return this.#i?.cancel(h),m?m.then(Ll).catch(Ll):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(h=>XA(h.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===N0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(h=>J_(h.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(h=>h.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(h=0){return this.state.data===void 0?!0:h==="static"?!1:this.state.isInvalidated?!0:!$A(this.state.dataUpdatedAt,h)}onFocus(){this.observers.find(m=>m.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(m=>m.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(h){this.observers.includes(h)||(this.observers.push(h),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:h}))}removeObserver(h){this.observers.includes(h)&&(this.observers=this.observers.filter(m=>m!==h),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:h}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(h,m){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&m?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(h&&this.setOptions(h),!this.options.queryFn){const l=this.observers.find(N=>N.options.queryFn);l&&this.setOptions(l.options)}const b=new AbortController,S=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#o=!0,b.signal)})},z=()=>{const l=u1(this.options,m),W=(()=>{const ne={client:this.#r,queryKey:this.queryKey,meta:this.meta};return S(ne),ne})();return this.#o=!1,this.options.persister?this.options.persister(l,W,this):l(W)},A=(()=>{const l={fetchOptions:m,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:z};return S(l),l})();this.options.behavior?.onFetch(A,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==A.fetchOptions?.meta)&&this.#a({type:"fetch",meta:A.fetchOptions?.meta}),this.#i=f1({initialPromise:m?.initialPromise,fn:A.fetchFn,onCancel:l=>{l instanceof t0&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),b.abort()},onFail:(l,N)=>{this.#a({type:"failed",failureCount:l,error:N})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:A.options.retry,retryDelay:A.options.retryDelay,networkMode:A.options.networkMode,canRun:()=>!0});try{const l=await this.#i.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#n.config.onSuccess?.(l,this),this.#n.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof t0){if(l.silent)return this.#i.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#a({type:"error",error:l}),this.#n.config.onError?.(l,this),this.#n.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#a(h){const m=b=>{switch(h.type){case"failed":return{...b,fetchFailureCount:h.failureCount,fetchFailureReason:h.error};case"pause":return{...b,fetchStatus:"paused"};case"continue":return{...b,fetchStatus:"fetching"};case"fetch":return{...b,...oC(b.data,this.options),fetchMeta:h.meta??null};case"success":const S={...b,...Jv(h.data,h.dataUpdatedAt),dataUpdateCount:b.dataUpdateCount+1,...!h.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=h.manual?S:void 0,S;case"error":const z=h.error;return{...b,error:z,errorUpdateCount:b.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:b.fetchFailureCount+1,fetchFailureReason:z,fetchStatus:"idle",status:"error"};case"invalidate":return{...b,isInvalidated:!0};case"setState":return{...b,...h.state}}};this.state=m(this.state),us.batch(()=>{this.observers.forEach(b=>{b.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:h})})}};function oC(h,m){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:d1(m.networkMode)?"fetching":"paused",...h===void 0&&{error:null,status:"pending"}}}function Jv(h,m){return{data:h,dataUpdatedAt:m??Date.now(),error:null,isInvalidated:!1,status:"success"}}function ex(h){const m=typeof h.initialData=="function"?h.initialData():h.initialData,b=m!==void 0,S=b?typeof h.initialDataUpdatedAt=="function"?h.initialDataUpdatedAt():h.initialDataUpdatedAt:0;return{data:m,dataUpdateCount:0,dataUpdatedAt:b?S??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:b?"success":"pending",fetchStatus:"idle"}}function tx(h){return{onFetch:(m,b)=>{const S=m.options,z=m.fetchOptions?.meta?.fetchMore?.direction,k=m.state.data?.pages||[],A=m.state.data?.pageParams||[];let l={pages:[],pageParams:[]},N=0;const W=async()=>{let ne=!1;const re=Ie=>{Object.defineProperty(Ie,"signal",{enumerable:!0,get:()=>(m.signal.aborted?ne=!0:m.signal.addEventListener("abort",()=>{ne=!0}),m.signal)})},xe=u1(m.options,m.fetchOptions),Ae=async(Ie,pe,ae)=>{if(ne)return Promise.reject();if(pe==null&&Ie.pages.length)return Promise.resolve(Ie);const Ke=(()=>{const ut={client:m.client,queryKey:m.queryKey,pageParam:pe,direction:ae?"backward":"forward",meta:m.options.meta};return re(ut),ut})(),at=await xe(Ke),{maxPages:zt}=m.options,wt=ae?JA:QA;return{pages:wt(Ie.pages,at,zt),pageParams:wt(Ie.pageParams,pe,zt)}};if(z&&k.length){const Ie=z==="backward",pe=Ie?lC:nx,ae={pages:k,pageParams:A},ke=pe(S,ae);l=await Ae(ae,ke,Ie)}else{const Ie=h??k.length;do{const pe=N===0?A[0]??S.initialPageParam:nx(S,l);if(N>0&&pe==null)break;l=await Ae(l,pe),N++}while(N<Ie)}return l};m.options.persister?m.fetchFn=()=>m.options.persister?.(W,{client:m.client,queryKey:m.queryKey,meta:m.options.meta,signal:m.signal},b):m.fetchFn=W}}}function nx(h,{pages:m,pageParams:b}){const S=m.length-1;return m.length>0?h.getNextPageParam(m[S],m,b[S],b):void 0}function lC(h,{pages:m,pageParams:b}){return m.length>0?h.getPreviousPageParam?.(m[0],m,b[0],b):void 0}var cC=class extends p1{#e;#t;#n;#r;constructor(h){super(),this.#e=h.client,this.mutationId=h.mutationId,this.#n=h.mutationCache,this.#t=[],this.state=h.state||uC(),this.setOptions(h.options),this.scheduleGc()}setOptions(h){this.options=h,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(h){this.#t.includes(h)||(this.#t.push(h),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:h}))}removeObserver(h){this.#t=this.#t.filter(m=>m!==h),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:h})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(h){const m=()=>{this.#i({type:"continue"})},b={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=f1({fn:()=>this.options.mutationFn?this.options.mutationFn(h,b):Promise.reject(new Error("No mutationFn found")),onFail:(k,A)=>{this.#i({type:"failed",failureCount:k,error:A})},onPause:()=>{this.#i({type:"pause"})},onContinue:m,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const S=this.state.status==="pending",z=!this.#r.canStart();try{if(S)m();else{this.#i({type:"pending",variables:h,isPaused:z}),await this.#n.config.onMutate?.(h,this,b);const A=await this.options.onMutate?.(h,b);A!==this.state.context&&this.#i({type:"pending",context:A,variables:h,isPaused:z})}const k=await this.#r.start();return await this.#n.config.onSuccess?.(k,h,this.state.context,this,b),await this.options.onSuccess?.(k,h,this.state.context,b),await this.#n.config.onSettled?.(k,null,this.state.variables,this.state.context,this,b),await this.options.onSettled?.(k,null,h,this.state.context,b),this.#i({type:"success",data:k}),k}catch(k){try{throw await this.#n.config.onError?.(k,h,this.state.context,this,b),await this.options.onError?.(k,h,this.state.context,b),await this.#n.config.onSettled?.(void 0,k,this.state.variables,this.state.context,this,b),await this.options.onSettled?.(void 0,k,h,this.state.context,b),k}finally{this.#i({type:"error",error:k})}}finally{this.#n.runNext(this)}}#i(h){const m=b=>{switch(h.type){case"failed":return{...b,failureCount:h.failureCount,failureReason:h.error};case"pause":return{...b,isPaused:!0};case"continue":return{...b,isPaused:!1};case"pending":return{...b,context:h.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:h.isPaused,status:"pending",variables:h.variables,submittedAt:Date.now()};case"success":return{...b,data:h.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...b,data:void 0,error:h.error,failureCount:b.failureCount+1,failureReason:h.error,isPaused:!1,status:"error"}}};this.state=m(this.state),us.batch(()=>{this.#t.forEach(b=>{b.onMutationUpdate(h)}),this.#n.notify({mutation:this,type:"updated",action:h})})}};function uC(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var hC=class extends Yy{constructor(h={}){super(),this.config=h,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(h,m,b){const S=new cC({client:h,mutationCache:this,mutationId:++this.#n,options:h.defaultMutationOptions(m),state:b});return this.add(S),S}add(h){this.#e.add(h);const m=gy(h);if(typeof m=="string"){const b=this.#t.get(m);b?b.push(h):this.#t.set(m,[h])}this.notify({type:"added",mutation:h})}remove(h){if(this.#e.delete(h)){const m=gy(h);if(typeof m=="string"){const b=this.#t.get(m);if(b)if(b.length>1){const S=b.indexOf(h);S!==-1&&b.splice(S,1)}else b[0]===h&&this.#t.delete(m)}}this.notify({type:"removed",mutation:h})}canRun(h){const m=gy(h);if(typeof m=="string"){const S=this.#t.get(m)?.find(z=>z.state.status==="pending");return!S||S===h}else return!0}runNext(h){const m=gy(h);return typeof m=="string"?this.#t.get(m)?.find(S=>S!==h&&S.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){us.batch(()=>{this.#e.forEach(h=>{this.notify({type:"removed",mutation:h})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(h){const m={exact:!0,...h};return this.getAll().find(b=>Wv(m,b))}findAll(h={}){return this.getAll().filter(m=>Wv(h,m))}notify(h){us.batch(()=>{this.listeners.forEach(m=>{m(h)})})}resumePausedMutations(){const h=this.getAll().filter(m=>m.state.isPaused);return us.batch(()=>Promise.all(h.map(m=>m.continue().catch(Ll))))}};function gy(h){return h.options.scope?.id}var dC=class extends Yy{constructor(h={}){super(),this.config=h,this.#e=new Map}#e;build(h,m,b){const S=m.queryKey,z=m.queryHash??B0(S,m);let k=this.get(z);return k||(k=new sC({client:h,queryKey:S,queryHash:z,options:h.defaultQueryOptions(m),state:b,defaultOptions:h.getQueryDefaults(S)}),this.add(k)),k}add(h){this.#e.has(h.queryHash)||(this.#e.set(h.queryHash,h),this.notify({type:"added",query:h}))}remove(h){const m=this.#e.get(h.queryHash);m&&(h.destroy(),m===h&&this.#e.delete(h.queryHash),this.notify({type:"removed",query:h}))}clear(){us.batch(()=>{this.getAll().forEach(h=>{this.remove(h)})})}get(h){return this.#e.get(h)}getAll(){return[...this.#e.values()]}find(h){const m={exact:!0,...h};return this.getAll().find(b=>Yv(m,b))}findAll(h={}){const m=this.getAll();return Object.keys(h).length>0?m.filter(b=>Yv(h,b)):m}notify(h){us.batch(()=>{this.listeners.forEach(m=>{m(h)})})}onFocus(){us.batch(()=>{this.getAll().forEach(h=>{h.onFocus()})})}onOnline(){us.batch(()=>{this.getAll().forEach(h=>{h.onOnline()})})}},fC=class{#e;#t;#n;#r;#i;#s;#o;#a;constructor(h={}){this.#e=h.queryCache||new dC,this.#t=h.mutationCache||new hC,this.#n=h.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#o=h1.subscribe(async h=>{h&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=Iy.subscribe(async h=>{h&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#o?.(),this.#o=void 0,this.#a?.(),this.#a=void 0)}isFetching(h){return this.#e.findAll({...h,fetchStatus:"fetching"}).length}isMutating(h){return this.#t.findAll({...h,status:"pending"}).length}getQueryData(h){const m=this.defaultQueryOptions({queryKey:h});return this.#e.get(m.queryHash)?.state.data}ensureQueryData(h){const m=this.defaultQueryOptions(h),b=this.#e.build(this,m),S=b.state.data;return S===void 0?this.fetchQuery(h):(h.revalidateIfStale&&b.isStaleByTime(J_(m.staleTime,b))&&this.prefetchQuery(m),Promise.resolve(S))}getQueriesData(h){return this.#e.findAll(h).map(({queryKey:m,state:b})=>{const S=b.data;return[m,S]})}setQueryData(h,m,b){const S=this.defaultQueryOptions({queryKey:h}),k=this.#e.get(S.queryHash)?.state.data,A=ZA(m,k);if(A!==void 0)return this.#e.build(this,S).setData(A,{...b,manual:!0})}setQueriesData(h,m,b){return us.batch(()=>this.#e.findAll(h).map(({queryKey:S})=>[S,this.setQueryData(S,m,b)]))}getQueryState(h){const m=this.defaultQueryOptions({queryKey:h});return this.#e.get(m.queryHash)?.state}removeQueries(h){const m=this.#e;us.batch(()=>{m.findAll(h).forEach(b=>{m.remove(b)})})}resetQueries(h,m){const b=this.#e;return us.batch(()=>(b.findAll(h).forEach(S=>{S.reset()}),this.refetchQueries({type:"active",...h},m)))}cancelQueries(h,m={}){const b={revert:!0,...m},S=us.batch(()=>this.#e.findAll(h).map(z=>z.cancel(b)));return Promise.all(S).then(Ll).catch(Ll)}invalidateQueries(h,m={}){return us.batch(()=>(this.#e.findAll(h).forEach(b=>{b.invalidate()}),h?.refetchType==="none"?Promise.resolve():this.refetchQueries({...h,type:h?.refetchType??h?.type??"active"},m)))}refetchQueries(h,m={}){const b={...m,cancelRefetch:m.cancelRefetch??!0},S=us.batch(()=>this.#e.findAll(h).filter(z=>!z.isDisabled()&&!z.isStatic()).map(z=>{let k=z.fetch(void 0,b);return b.throwOnError||(k=k.catch(Ll)),z.state.fetchStatus==="paused"?Promise.resolve():k}));return Promise.all(S).then(Ll)}fetchQuery(h){const m=this.defaultQueryOptions(h);m.retry===void 0&&(m.retry=!1);const b=this.#e.build(this,m);return b.isStaleByTime(J_(m.staleTime,b))?b.fetch(m):Promise.resolve(b.state.data)}prefetchQuery(h){return this.fetchQuery(h).then(Ll).catch(Ll)}fetchInfiniteQuery(h){return h.behavior=tx(h.pages),this.fetchQuery(h)}prefetchInfiniteQuery(h){return this.fetchInfiniteQuery(h).then(Ll).catch(Ll)}ensureInfiniteQueryData(h){return h.behavior=tx(h.pages),this.ensureQueryData(h)}resumePausedMutations(){return Iy.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(h){this.#n=h}setQueryDefaults(h,m){this.#r.set(hg(h),{queryKey:h,defaultOptions:m})}getQueryDefaults(h){const m=[...this.#r.values()],b={};return m.forEach(S=>{dg(h,S.queryKey)&&Object.assign(b,S.defaultOptions)}),b}setMutationDefaults(h,m){this.#i.set(hg(h),{mutationKey:h,defaultOptions:m})}getMutationDefaults(h){const m=[...this.#i.values()],b={};return m.forEach(S=>{dg(h,S.mutationKey)&&Object.assign(b,S.defaultOptions)}),b}defaultQueryOptions(h){if(h._defaulted)return h;const m={...this.#n.queries,...this.getQueryDefaults(h.queryKey),...h,_defaulted:!0};return m.queryHash||(m.queryHash=B0(m.queryKey,m)),m.refetchOnReconnect===void 0&&(m.refetchOnReconnect=m.networkMode!=="always"),m.throwOnError===void 0&&(m.throwOnError=!!m.suspense),!m.networkMode&&m.persister&&(m.networkMode="offlineFirst"),m.queryFn===N0&&(m.enabled=!1),m}defaultMutationOptions(h){return h?._defaulted?h:{...this.#n.mutations,...h?.mutationKey&&this.getMutationDefaults(h.mutationKey),...h,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},pC=ze.createContext(void 0),mC=({client:h,children:m})=>(ze.useEffect(()=>(h.mount(),()=>{h.unmount()}),[h]),$.jsx(pC.Provider,{value:h,children:m}));const gC=new fC;F1.createRoot(document.getElementById("root")).render($.jsx(i0.StrictMode,{children:$.jsx(mC,{client:gC,children:$.jsx(GE,{children:$.jsx(UA,{})})})}));
