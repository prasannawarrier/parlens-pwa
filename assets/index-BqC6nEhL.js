function hb(c,d){for(var y=0;y<d.length;y++){const C=d[y];if(typeof C!="string"&&!Array.isArray(C)){for(const D in C)if(D!=="default"&&!(D in c)){const P=Object.getOwnPropertyDescriptor(C,D);P&&Object.defineProperty(c,D,P.get?P:{enumerable:!0,get:()=>C[D]})}}}return Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))C(D);new MutationObserver(D=>{for(const P of D)if(P.type==="childList")for(const N of P.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&C(N)}).observe(document,{childList:!0,subtree:!0});function y(D){const P={};return D.integrity&&(P.integrity=D.integrity),D.referrerPolicy&&(P.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?P.credentials="include":D.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function C(D){if(D.ep)return;D.ep=!0;const P=y(D);fetch(D.href,P)}})();var jm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var $1={exports:{}},Cg={};var Gx;function nw(){if(Gx)return Cg;Gx=1;var c=Symbol.for("react.transitional.element"),d=Symbol.for("react.fragment");function y(C,D,P){var N=null;if(P!==void 0&&(N=""+P),D.key!==void 0&&(N=""+D.key),"key"in D){P={};for(var h in D)h!=="key"&&(P[h]=D[h])}else P=D;return D=P.ref,{$$typeof:c,type:C,key:N,ref:D!==void 0?D:null,props:P}}return Cg.Fragment=d,Cg.jsx=y,Cg.jsxs=y,Cg}var Hx;function iw(){return Hx||(Hx=1,$1.exports=nw()),$1.exports}var k=iw(),K1={exports:{}},Qi={};var qx;function rw(){if(qx)return Qi;qx=1;var c=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),P=Symbol.for("react.consumer"),N=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),H=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),_e=Symbol.iterator;function we(Re){return Re===null||typeof Re!="object"?null:(Re=_e&&Re[_e]||Re["@@iterator"],typeof Re=="function"?Re:null)}var ve={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pe=Object.assign,he={};function De(Re,ct,kt){this.props=Re,this.context=ct,this.refs=he,this.updater=kt||ve}De.prototype.isReactComponent={},De.prototype.setState=function(Re,ct){if(typeof Re!="object"&&typeof Re!="function"&&Re!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Re,ct,"setState")},De.prototype.forceUpdate=function(Re){this.updater.enqueueForceUpdate(this,Re,"forceUpdate")};function Je(){}Je.prototype=De.prototype;function Xe(Re,ct,kt){this.props=Re,this.context=ct,this.refs=he,this.updater=kt||ve}var mt=Xe.prototype=new Je;mt.constructor=Xe,pe(mt,De.prototype),mt.isPureReactComponent=!0;var Wt=Array.isArray;function Et(){}var rt={H:null,A:null,T:null,S:null},at=Object.prototype.hasOwnProperty;function He(Re,ct,kt){var bt=kt.ref;return{$$typeof:c,type:Re,key:ct,ref:bt!==void 0?bt:null,props:kt}}function _t(Re,ct){return He(Re.type,ct,Re.props)}function Pe(Re){return typeof Re=="object"&&Re!==null&&Re.$$typeof===c}function ht(Re){var ct={"=":"=0",":":"=2"};return"$"+Re.replace(/[=:]/g,function(kt){return ct[kt]})}var vt=/\/+/g;function qt(Re,ct){return typeof Re=="object"&&Re!==null&&Re.key!=null?ht(""+Re.key):ct.toString(36)}function ke(Re){switch(Re.status){case"fulfilled":return Re.value;case"rejected":throw Re.reason;default:switch(typeof Re.status=="string"?Re.then(Et,Et):(Re.status="pending",Re.then(function(ct){Re.status==="pending"&&(Re.status="fulfilled",Re.value=ct)},function(ct){Re.status==="pending"&&(Re.status="rejected",Re.reason=ct)})),Re.status){case"fulfilled":return Re.value;case"rejected":throw Re.reason}}throw Re}function Te(Re,ct,kt,bt,an){var Bt=typeof Re;(Bt==="undefined"||Bt==="boolean")&&(Re=null);var Qt=!1;if(Re===null)Qt=!0;else switch(Bt){case"bigint":case"string":case"number":Qt=!0;break;case"object":switch(Re.$$typeof){case c:case d:Qt=!0;break;case Y:return Qt=Re._init,Te(Qt(Re._payload),ct,kt,bt,an)}}if(Qt)return an=an(Re),Qt=bt===""?"."+qt(Re,0):bt,Wt(an)?(kt="",Qt!=null&&(kt=Qt.replace(vt,"$&/")+"/"),Te(an,ct,kt,"",function(kn){return kn})):an!=null&&(Pe(an)&&(an=_t(an,kt+(an.key==null||Re&&Re.key===an.key?"":(""+an.key).replace(vt,"$&/")+"/")+Qt)),ct.push(an)),1;Qt=0;var un=bt===""?".":bt+":";if(Wt(Re))for(var nn=0;nn<Re.length;nn++)bt=Re[nn],Bt=un+qt(bt,nn),Qt+=Te(bt,ct,kt,Bt,an);else if(nn=we(Re),typeof nn=="function")for(Re=nn.call(Re),nn=0;!(bt=Re.next()).done;)bt=bt.value,Bt=un+qt(bt,nn++),Qt+=Te(bt,ct,kt,Bt,an);else if(Bt==="object"){if(typeof Re.then=="function")return Te(ke(Re),ct,kt,bt,an);throw ct=String(Re),Error("Objects are not valid as a React child (found: "+(ct==="[object Object]"?"object with keys {"+Object.keys(Re).join(", ")+"}":ct)+"). If you meant to render a collection of children, use an array instead.")}return Qt}function Ze(Re,ct,kt){if(Re==null)return Re;var bt=[],an=0;return Te(Re,bt,"","",function(Bt){return ct.call(kt,Bt,an++)}),bt}function ut(Re){if(Re._status===-1){var ct=Re._result;ct=ct(),ct.then(function(kt){(Re._status===0||Re._status===-1)&&(Re._status=1,Re._result=kt)},function(kt){(Re._status===0||Re._status===-1)&&(Re._status=2,Re._result=kt)}),Re._status===-1&&(Re._status=0,Re._result=ct)}if(Re._status===1)return Re._result.default;throw Re._result}var Tt=typeof reportError=="function"?reportError:function(Re){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ct=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Re=="object"&&Re!==null&&typeof Re.message=="string"?String(Re.message):String(Re),error:Re});if(!window.dispatchEvent(ct))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Re);return}console.error(Re)},sn={map:Ze,forEach:function(Re,ct,kt){Ze(Re,function(){ct.apply(this,arguments)},kt)},count:function(Re){var ct=0;return Ze(Re,function(){ct++}),ct},toArray:function(Re){return Ze(Re,function(ct){return ct})||[]},only:function(Re){if(!Pe(Re))throw Error("React.Children.only expected to receive a single React element child.");return Re}};return Qi.Activity=K,Qi.Children=sn,Qi.Component=De,Qi.Fragment=y,Qi.Profiler=D,Qi.PureComponent=Xe,Qi.StrictMode=C,Qi.Suspense=U,Qi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=rt,Qi.__COMPILER_RUNTIME={__proto__:null,c:function(Re){return rt.H.useMemoCache(Re)}},Qi.cache=function(Re){return function(){return Re.apply(null,arguments)}},Qi.cacheSignal=function(){return null},Qi.cloneElement=function(Re,ct,kt){if(Re==null)throw Error("The argument must be a React element, but you passed "+Re+".");var bt=pe({},Re.props),an=Re.key;if(ct!=null)for(Bt in ct.key!==void 0&&(an=""+ct.key),ct)!at.call(ct,Bt)||Bt==="key"||Bt==="__self"||Bt==="__source"||Bt==="ref"&&ct.ref===void 0||(bt[Bt]=ct[Bt]);var Bt=arguments.length-2;if(Bt===1)bt.children=kt;else if(1<Bt){for(var Qt=Array(Bt),un=0;un<Bt;un++)Qt[un]=arguments[un+2];bt.children=Qt}return He(Re.type,an,bt)},Qi.createContext=function(Re){return Re={$$typeof:N,_currentValue:Re,_currentValue2:Re,_threadCount:0,Provider:null,Consumer:null},Re.Provider=Re,Re.Consumer={$$typeof:P,_context:Re},Re},Qi.createElement=function(Re,ct,kt){var bt,an={},Bt=null;if(ct!=null)for(bt in ct.key!==void 0&&(Bt=""+ct.key),ct)at.call(ct,bt)&&bt!=="key"&&bt!=="__self"&&bt!=="__source"&&(an[bt]=ct[bt]);var Qt=arguments.length-2;if(Qt===1)an.children=kt;else if(1<Qt){for(var un=Array(Qt),nn=0;nn<Qt;nn++)un[nn]=arguments[nn+2];an.children=un}if(Re&&Re.defaultProps)for(bt in Qt=Re.defaultProps,Qt)an[bt]===void 0&&(an[bt]=Qt[bt]);return He(Re,Bt,an)},Qi.createRef=function(){return{current:null}},Qi.forwardRef=function(Re){return{$$typeof:h,render:Re}},Qi.isValidElement=Pe,Qi.lazy=function(Re){return{$$typeof:Y,_payload:{_status:-1,_result:Re},_init:ut}},Qi.memo=function(Re,ct){return{$$typeof:H,type:Re,compare:ct===void 0?null:ct}},Qi.startTransition=function(Re){var ct=rt.T,kt={};rt.T=kt;try{var bt=Re(),an=rt.S;an!==null&&an(kt,bt),typeof bt=="object"&&bt!==null&&typeof bt.then=="function"&&bt.then(Et,Tt)}catch(Bt){Tt(Bt)}finally{ct!==null&&kt.types!==null&&(ct.types=kt.types),rt.T=ct}},Qi.unstable_useCacheRefresh=function(){return rt.H.useCacheRefresh()},Qi.use=function(Re){return rt.H.use(Re)},Qi.useActionState=function(Re,ct,kt){return rt.H.useActionState(Re,ct,kt)},Qi.useCallback=function(Re,ct){return rt.H.useCallback(Re,ct)},Qi.useContext=function(Re){return rt.H.useContext(Re)},Qi.useDebugValue=function(){},Qi.useDeferredValue=function(Re,ct){return rt.H.useDeferredValue(Re,ct)},Qi.useEffect=function(Re,ct){return rt.H.useEffect(Re,ct)},Qi.useEffectEvent=function(Re){return rt.H.useEffectEvent(Re)},Qi.useId=function(){return rt.H.useId()},Qi.useImperativeHandle=function(Re,ct,kt){return rt.H.useImperativeHandle(Re,ct,kt)},Qi.useInsertionEffect=function(Re,ct){return rt.H.useInsertionEffect(Re,ct)},Qi.useLayoutEffect=function(Re,ct){return rt.H.useLayoutEffect(Re,ct)},Qi.useMemo=function(Re,ct){return rt.H.useMemo(Re,ct)},Qi.useOptimistic=function(Re,ct){return rt.H.useOptimistic(Re,ct)},Qi.useReducer=function(Re,ct,kt){return rt.H.useReducer(Re,ct,kt)},Qi.useRef=function(Re){return rt.H.useRef(Re)},Qi.useState=function(Re){return rt.H.useState(Re)},Qi.useSyncExternalStore=function(Re,ct,kt){return rt.H.useSyncExternalStore(Re,ct,kt)},Qi.useTransition=function(){return rt.H.useTransition()},Qi.version="19.2.3",Qi}var Zx;function Hy(){return Zx||(Zx=1,K1.exports=rw()),K1.exports}var me=Hy();const Qs=rp(me);var Q1={exports:{}},Tg={},J1={exports:{}},ey={};var Xx;function sw(){return Xx||(Xx=1,(function(c){function d(Te,Ze){var ut=Te.length;Te.push(Ze);e:for(;0<ut;){var Tt=ut-1>>>1,sn=Te[Tt];if(0<D(sn,Ze))Te[Tt]=Ze,Te[ut]=sn,ut=Tt;else break e}}function y(Te){return Te.length===0?null:Te[0]}function C(Te){if(Te.length===0)return null;var Ze=Te[0],ut=Te.pop();if(ut!==Ze){Te[0]=ut;e:for(var Tt=0,sn=Te.length,Re=sn>>>1;Tt<Re;){var ct=2*(Tt+1)-1,kt=Te[ct],bt=ct+1,an=Te[bt];if(0>D(kt,ut))bt<sn&&0>D(an,kt)?(Te[Tt]=an,Te[bt]=ut,Tt=bt):(Te[Tt]=kt,Te[ct]=ut,Tt=ct);else if(bt<sn&&0>D(an,ut))Te[Tt]=an,Te[bt]=ut,Tt=bt;else break e}}return Ze}function D(Te,Ze){var ut=Te.sortIndex-Ze.sortIndex;return ut!==0?ut:Te.id-Ze.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var P=performance;c.unstable_now=function(){return P.now()}}else{var N=Date,h=N.now();c.unstable_now=function(){return N.now()-h}}var U=[],H=[],Y=1,K=null,_e=3,we=!1,ve=!1,pe=!1,he=!1,De=typeof setTimeout=="function"?setTimeout:null,Je=typeof clearTimeout=="function"?clearTimeout:null,Xe=typeof setImmediate<"u"?setImmediate:null;function mt(Te){for(var Ze=y(H);Ze!==null;){if(Ze.callback===null)C(H);else if(Ze.startTime<=Te)C(H),Ze.sortIndex=Ze.expirationTime,d(U,Ze);else break;Ze=y(H)}}function Wt(Te){if(pe=!1,mt(Te),!ve)if(y(U)!==null)ve=!0,Et||(Et=!0,ht());else{var Ze=y(H);Ze!==null&&ke(Wt,Ze.startTime-Te)}}var Et=!1,rt=-1,at=5,He=-1;function _t(){return he?!0:!(c.unstable_now()-He<at)}function Pe(){if(he=!1,Et){var Te=c.unstable_now();He=Te;var Ze=!0;try{e:{ve=!1,pe&&(pe=!1,Je(rt),rt=-1),we=!0;var ut=_e;try{t:{for(mt(Te),K=y(U);K!==null&&!(K.expirationTime>Te&&_t());){var Tt=K.callback;if(typeof Tt=="function"){K.callback=null,_e=K.priorityLevel;var sn=Tt(K.expirationTime<=Te);if(Te=c.unstable_now(),typeof sn=="function"){K.callback=sn,mt(Te),Ze=!0;break t}K===y(U)&&C(U),mt(Te)}else C(U);K=y(U)}if(K!==null)Ze=!0;else{var Re=y(H);Re!==null&&ke(Wt,Re.startTime-Te),Ze=!1}}break e}finally{K=null,_e=ut,we=!1}Ze=void 0}}finally{Ze?ht():Et=!1}}}var ht;if(typeof Xe=="function")ht=function(){Xe(Pe)};else if(typeof MessageChannel<"u"){var vt=new MessageChannel,qt=vt.port2;vt.port1.onmessage=Pe,ht=function(){qt.postMessage(null)}}else ht=function(){De(Pe,0)};function ke(Te,Ze){rt=De(function(){Te(c.unstable_now())},Ze)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(Te){Te.callback=null},c.unstable_forceFrameRate=function(Te){0>Te||125<Te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):at=0<Te?Math.floor(1e3/Te):5},c.unstable_getCurrentPriorityLevel=function(){return _e},c.unstable_next=function(Te){switch(_e){case 1:case 2:case 3:var Ze=3;break;default:Ze=_e}var ut=_e;_e=Ze;try{return Te()}finally{_e=ut}},c.unstable_requestPaint=function(){he=!0},c.unstable_runWithPriority=function(Te,Ze){switch(Te){case 1:case 2:case 3:case 4:case 5:break;default:Te=3}var ut=_e;_e=Te;try{return Ze()}finally{_e=ut}},c.unstable_scheduleCallback=function(Te,Ze,ut){var Tt=c.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?Tt+ut:Tt):ut=Tt,Te){case 1:var sn=-1;break;case 2:sn=250;break;case 5:sn=1073741823;break;case 4:sn=1e4;break;default:sn=5e3}return sn=ut+sn,Te={id:Y++,callback:Ze,priorityLevel:Te,startTime:ut,expirationTime:sn,sortIndex:-1},ut>Tt?(Te.sortIndex=ut,d(H,Te),y(U)===null&&Te===y(H)&&(pe?(Je(rt),rt=-1):pe=!0,ke(Wt,ut-Tt))):(Te.sortIndex=sn,d(U,Te),ve||we||(ve=!0,Et||(Et=!0,ht()))),Te},c.unstable_shouldYield=_t,c.unstable_wrapCallback=function(Te){var Ze=_e;return function(){var ut=_e;_e=Ze;try{return Te.apply(this,arguments)}finally{_e=ut}}}})(ey)),ey}var Wx;function aw(){return Wx||(Wx=1,J1.exports=sw()),J1.exports}var ty={exports:{}},Fo={};var Yx;function ow(){if(Yx)return Fo;Yx=1;var c=Hy();function d(U){var H="https://react.dev/errors/"+U;if(1<arguments.length){H+="?args[]="+encodeURIComponent(arguments[1]);for(var Y=2;Y<arguments.length;Y++)H+="&args[]="+encodeURIComponent(arguments[Y])}return"Minified React error #"+U+"; visit "+H+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function y(){}var C={d:{f:y,r:function(){throw Error(d(522))},D:y,C:y,L:y,m:y,X:y,S:y,M:y},p:0,findDOMNode:null},D=Symbol.for("react.portal");function P(U,H,Y){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:K==null?null:""+K,children:U,containerInfo:H,implementation:Y}}var N=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(U,H){if(U==="font")return"";if(typeof H=="string")return H==="use-credentials"?H:""}return Fo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Fo.createPortal=function(U,H){var Y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!H||H.nodeType!==1&&H.nodeType!==9&&H.nodeType!==11)throw Error(d(299));return P(U,H,null,Y)},Fo.flushSync=function(U){var H=N.T,Y=C.p;try{if(N.T=null,C.p=2,U)return U()}finally{N.T=H,C.p=Y,C.d.f()}},Fo.preconnect=function(U,H){typeof U=="string"&&(H?(H=H.crossOrigin,H=typeof H=="string"?H==="use-credentials"?H:"":void 0):H=null,C.d.C(U,H))},Fo.prefetchDNS=function(U){typeof U=="string"&&C.d.D(U)},Fo.preinit=function(U,H){if(typeof U=="string"&&H&&typeof H.as=="string"){var Y=H.as,K=h(Y,H.crossOrigin),_e=typeof H.integrity=="string"?H.integrity:void 0,we=typeof H.fetchPriority=="string"?H.fetchPriority:void 0;Y==="style"?C.d.S(U,typeof H.precedence=="string"?H.precedence:void 0,{crossOrigin:K,integrity:_e,fetchPriority:we}):Y==="script"&&C.d.X(U,{crossOrigin:K,integrity:_e,fetchPriority:we,nonce:typeof H.nonce=="string"?H.nonce:void 0})}},Fo.preinitModule=function(U,H){if(typeof U=="string")if(typeof H=="object"&&H!==null){if(H.as==null||H.as==="script"){var Y=h(H.as,H.crossOrigin);C.d.M(U,{crossOrigin:Y,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0})}}else H==null&&C.d.M(U)},Fo.preload=function(U,H){if(typeof U=="string"&&typeof H=="object"&&H!==null&&typeof H.as=="string"){var Y=H.as,K=h(Y,H.crossOrigin);C.d.L(U,Y,{crossOrigin:K,integrity:typeof H.integrity=="string"?H.integrity:void 0,nonce:typeof H.nonce=="string"?H.nonce:void 0,type:typeof H.type=="string"?H.type:void 0,fetchPriority:typeof H.fetchPriority=="string"?H.fetchPriority:void 0,referrerPolicy:typeof H.referrerPolicy=="string"?H.referrerPolicy:void 0,imageSrcSet:typeof H.imageSrcSet=="string"?H.imageSrcSet:void 0,imageSizes:typeof H.imageSizes=="string"?H.imageSizes:void 0,media:typeof H.media=="string"?H.media:void 0})}},Fo.preloadModule=function(U,H){if(typeof U=="string")if(H){var Y=h(H.as,H.crossOrigin);C.d.m(U,{as:typeof H.as=="string"&&H.as!=="script"?H.as:void 0,crossOrigin:Y,integrity:typeof H.integrity=="string"?H.integrity:void 0})}else C.d.m(U)},Fo.requestFormReset=function(U){C.d.r(U)},Fo.unstable_batchedUpdates=function(U,H){return U(H)},Fo.useFormState=function(U,H,Y){return N.H.useFormState(U,H,Y)},Fo.useFormStatus=function(){return N.H.useHostTransitionStatus()},Fo.version="19.2.3",Fo}var $x;function db(){if($x)return ty.exports;$x=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(d){console.error(d)}}return c(),ty.exports=ow(),ty.exports}var Kx;function lw(){if(Kx)return Tg;Kx=1;var c=aw(),d=Hy(),y=db();function C(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)o+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function D(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function P(r){var o=r,m=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(m=o.return),r=o.return;while(r)}return o.tag===3?m:null}function N(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function h(r){if(r.tag===31){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function U(r){if(P(r)!==r)throw Error(C(188))}function H(r){var o=r.alternate;if(!o){if(o=P(r),o===null)throw Error(C(188));return o!==r?null:r}for(var m=r,E=o;;){var L=m.return;if(L===null)break;var V=L.alternate;if(V===null){if(E=L.return,E!==null){m=E;continue}break}if(L.child===V.child){for(V=L.child;V;){if(V===m)return U(L),r;if(V===E)return U(L),o;V=V.sibling}throw Error(C(188))}if(m.return!==E.return)m=L,E=V;else{for(var ne=!1,Ae=L.child;Ae;){if(Ae===m){ne=!0,m=L,E=V;break}if(Ae===E){ne=!0,E=L,m=V;break}Ae=Ae.sibling}if(!ne){for(Ae=V.child;Ae;){if(Ae===m){ne=!0,m=V,E=L;break}if(Ae===E){ne=!0,E=V,m=L;break}Ae=Ae.sibling}if(!ne)throw Error(C(189))}}if(m.alternate!==E)throw Error(C(190))}if(m.tag!==3)throw Error(C(188));return m.stateNode.current===m?r:o}function Y(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=Y(r),o!==null)return o;r=r.sibling}return null}var K=Object.assign,_e=Symbol.for("react.element"),we=Symbol.for("react.transitional.element"),ve=Symbol.for("react.portal"),pe=Symbol.for("react.fragment"),he=Symbol.for("react.strict_mode"),De=Symbol.for("react.profiler"),Je=Symbol.for("react.consumer"),Xe=Symbol.for("react.context"),mt=Symbol.for("react.forward_ref"),Wt=Symbol.for("react.suspense"),Et=Symbol.for("react.suspense_list"),rt=Symbol.for("react.memo"),at=Symbol.for("react.lazy"),He=Symbol.for("react.activity"),_t=Symbol.for("react.memo_cache_sentinel"),Pe=Symbol.iterator;function ht(r){return r===null||typeof r!="object"?null:(r=Pe&&r[Pe]||r["@@iterator"],typeof r=="function"?r:null)}var vt=Symbol.for("react.client.reference");function qt(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===vt?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case pe:return"Fragment";case De:return"Profiler";case he:return"StrictMode";case Wt:return"Suspense";case Et:return"SuspenseList";case He:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case ve:return"Portal";case Xe:return r.displayName||"Context";case Je:return(r._context.displayName||"Context")+".Consumer";case mt:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case rt:return o=r.displayName||null,o!==null?o:qt(r.type)||"Memo";case at:o=r._payload,r=r._init;try{return qt(r(o))}catch{}}return null}var ke=Array.isArray,Te=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ze=y.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ut={pending:!1,data:null,method:null,action:null},Tt=[],sn=-1;function Re(r){return{current:r}}function ct(r){0>sn||(r.current=Tt[sn],Tt[sn]=null,sn--)}function kt(r,o){sn++,Tt[sn]=r.current,r.current=o}var bt=Re(null),an=Re(null),Bt=Re(null),Qt=Re(null);function un(r,o){switch(kt(Bt,o),kt(an,r),kt(bt,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?Fu(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=Fu(o),r=ng(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ct(bt),kt(bt,r)}function nn(){ct(bt),ct(an),ct(Bt)}function kn(r){r.memoizedState!==null&&kt(Qt,r);var o=bt.current,m=ng(o,r.type);o!==m&&(kt(an,r),kt(bt,m))}function Nn(r){an.current===r&&(ct(bt),ct(an)),Qt.current===r&&(ct(Qt),Id._currentValue=ut)}var ii,En;function si(r){if(ii===void 0)try{throw Error()}catch(m){var o=m.stack.trim().match(/\n( *(at )?)/);ii=o&&o[1]||"",En=-1<m.stack.indexOf(`
    at`)?" (<anonymous>)":-1<m.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ii+r+En}var wi=!1;function Oi(r,o){if(!r||wi)return"";wi=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var E={DetermineComponentFrameRoot:function(){try{if(o){var pn=function(){throw Error()};if(Object.defineProperty(pn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pn,[])}catch($t){var Gt=$t}Reflect.construct(r,[],pn)}else{try{pn.call()}catch($t){Gt=$t}r.call(pn.prototype)}}else{try{throw Error()}catch($t){Gt=$t}(pn=r())&&typeof pn.catch=="function"&&pn.catch(function(){})}}catch($t){if($t&&Gt&&typeof $t.stack=="string")return[$t.stack,Gt.stack]}return[null,null]}};E.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var L=Object.getOwnPropertyDescriptor(E.DetermineComponentFrameRoot,"name");L&&L.configurable&&Object.defineProperty(E.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var V=E.DetermineComponentFrameRoot(),ne=V[0],Ae=V[1];if(ne&&Ae){var lt=ne.split(`
`),Vt=Ae.split(`
`);for(L=E=0;E<lt.length&&!lt[E].includes("DetermineComponentFrameRoot");)E++;for(;L<Vt.length&&!Vt[L].includes("DetermineComponentFrameRoot");)L++;if(E===lt.length||L===Vt.length)for(E=lt.length-1,L=Vt.length-1;1<=E&&0<=L&&lt[E]!==Vt[L];)L--;for(;1<=E&&0<=L;E--,L--)if(lt[E]!==Vt[L]){if(E!==1||L!==1)do if(E--,L--,0>L||lt[E]!==Vt[L]){var rn=`
`+lt[E].replace(" at new "," at ");return r.displayName&&rn.includes("<anonymous>")&&(rn=rn.replace("<anonymous>",r.displayName)),rn}while(1<=E&&0<=L);break}}}finally{wi=!1,Error.prepareStackTrace=m}return(m=r?r.displayName||r.name:"")?si(m):""}function Yn(r,o){switch(r.tag){case 26:case 27:case 5:return si(r.type);case 16:return si("Lazy");case 13:return r.child!==o&&o!==null?si("Suspense Fallback"):si("Suspense");case 19:return si("SuspenseList");case 0:case 15:return Oi(r.type,!1);case 11:return Oi(r.type.render,!1);case 1:return Oi(r.type,!0);case 31:return si("Activity");default:return""}}function Gn(r){try{var o="",m=null;do o+=Yn(r,m),m=r,r=r.return;while(r);return o}catch(E){return`
Error generating stack: `+E.message+`
`+E.stack}}var Rn=Object.prototype.hasOwnProperty,Ei=c.unstable_scheduleCallback,on=c.unstable_cancelCallback,Li=c.unstable_shouldYield,tr=c.unstable_requestPaint,Di=c.unstable_now,yr=c.unstable_getCurrentPriorityLevel,yt=c.unstable_ImmediatePriority,oe=c.unstable_UserBlockingPriority,le=c.unstable_NormalPriority,ge=c.unstable_LowPriority,Ue=c.unstable_IdlePriority,Ye=c.log,At=c.unstable_setDisableYieldValue,it=null,de=null;function qe(r){if(typeof Ye=="function"&&At(r),de&&typeof de.setStrictMode=="function")try{de.setStrictMode(it,r)}catch{}}var xt=Math.clz32?Math.clz32:Lt,Fe=Math.log,St=Math.LN2;function Lt(r){return r>>>=0,r===0?32:31-(Fe(r)/St|0)|0}var bn=256,yn=262144,$n=4194304;function dt(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function ai(r,o,m){var E=r.pendingLanes;if(E===0)return 0;var L=0,V=r.suspendedLanes,ne=r.pingedLanes;r=r.warmLanes;var Ae=E&134217727;return Ae!==0?(E=Ae&~V,E!==0?L=dt(E):(ne&=Ae,ne!==0?L=dt(ne):m||(m=Ae&~r,m!==0&&(L=dt(m))))):(Ae=E&~V,Ae!==0?L=dt(Ae):ne!==0?L=dt(ne):m||(m=E&~r,m!==0&&(L=dt(m)))),L===0?0:o!==0&&o!==L&&(o&V)===0&&(V=L&-L,m=o&-o,V>=m||V===32&&(m&4194048)!==0)?o:L}function Fn(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function Jn(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pi(){var r=$n;return $n<<=1,($n&62914560)===0&&($n=4194304),r}function ur(r){for(var o=[],m=0;31>m;m++)o.push(r);return o}function Ti(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function jn(r,o,m,E,L,V){var ne=r.pendingLanes;r.pendingLanes=m,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=m,r.entangledLanes&=m,r.errorRecoveryDisabledLanes&=m,r.shellSuspendCounter=0;var Ae=r.entanglements,lt=r.expirationTimes,Vt=r.hiddenUpdates;for(m=ne&~m;0<m;){var rn=31-xt(m),pn=1<<rn;Ae[rn]=0,lt[rn]=-1;var Gt=Vt[rn];if(Gt!==null)for(Vt[rn]=null,rn=0;rn<Gt.length;rn++){var $t=Gt[rn];$t!==null&&($t.lane&=-536870913)}m&=~pn}E!==0&&Ni(r,E,0),V!==0&&L===0&&r.tag!==0&&(r.suspendedLanes|=V&~(ne&~o))}function Ni(r,o,m){r.pendingLanes|=o,r.suspendedLanes&=~o;var E=31-xt(o);r.entangledLanes|=o,r.entanglements[E]=r.entanglements[E]|1073741824|m&261930}function Ri(r,o){var m=r.entangledLanes|=o;for(r=r.entanglements;m;){var E=31-xt(m),L=1<<E;L&o|r[E]&o&&(r[E]|=o),m&=~L}}function ji(r,o){var m=o&-o;return m=(m&42)!==0?1:Nr(m),(m&(r.suspendedLanes|o))!==0?0:m}function Nr(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Jt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function gi(){var r=Ze.p;return r!==0?r:(r=window.event,r===void 0?32:Dh(r.type))}function Sn(r,o){var m=Ze.p;try{return Ze.p=r,o()}finally{Ze.p=m}}var lr=Math.random().toString(36).slice(2),Ke="__reactFiber$"+lr,je="__reactProps$"+lr,Mt="__reactContainer$"+lr,Yt="__reactEvents$"+lr,tn="__reactListeners$"+lr,Un="__reactHandles$"+lr,Hn="__reactResources$"+lr,vn="__reactMarker$"+lr;function ri(r){delete r[Ke],delete r[je],delete r[Yt],delete r[tn],delete r[Un]}function ni(r){var o=r[Ke];if(o)return o;for(var m=r.parentNode;m;){if(o=m[Mt]||m[Ke]){if(m=o.alternate,o.child!==null||m!==null&&m.child!==null)for(r=Tf(r);r!==null;){if(m=r[Ke])return m;r=Tf(r)}return o}r=m,m=r.parentNode}return null}function Xn(r){if(r=r[Ke]||r[Mt]){var o=r.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return r}return null}function Zi(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(C(33))}function Cn(r){var o=r[Hn];return o||(o=r[Hn]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function Dn(r){r[vn]=!0}var Zt=new Set,ki={};function ln(r,o){yi(r,o),yi(r+"Capture",o)}function yi(r,o){for(ki[r]=o,r=0;r<o.length;r++)Zt.add(o[r])}var Bi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_i={},bi={};function mi(r){return Rn.call(bi,r)?!0:Rn.call(_i,r)?!1:Bi.test(r)?bi[r]=!0:(_i[r]=!0,!1)}function li(r,o,m){if(mi(o))if(m===null)r.removeAttribute(o);else{switch(typeof m){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var E=o.toLowerCase().slice(0,5);if(E!=="data-"&&E!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+m)}}function Hi(r,o,m){if(m===null)r.removeAttribute(o);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+m)}}function Tr(r,o,m,E){if(E===null)r.removeAttribute(m);else{switch(typeof E){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(m);return}r.setAttributeNS(o,m,""+E)}}function Qn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function es(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ts(r,o,m){var E=Object.getOwnPropertyDescriptor(r.constructor.prototype,o);if(!r.hasOwnProperty(o)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var L=E.get,V=E.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return L.call(this)},set:function(ne){m=""+ne,V.call(this,ne)}}),Object.defineProperty(r,o,{enumerable:E.enumerable}),{getValue:function(){return m},setValue:function(ne){m=""+ne},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function zi(r){if(!r._valueTracker){var o=es(r)?"checked":"value";r._valueTracker=Ts(r,o,""+r[o])}}function Ba(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var m=o.getValue(),E="";return r&&(E=es(r)?r.checked?"true":"false":r.value),r=E,r!==m?(o.setValue(r),!0):!1}function sl(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Vo=/[\n"\\]/g;function Fi(r){return r.replace(Vo,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Wr(r,o,m,E,L,V,ne,Ae){r.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?r.type=ne:r.removeAttribute("type"),o!=null?ne==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+Qn(o)):r.value!==""+Qn(o)&&(r.value=""+Qn(o)):ne!=="submit"&&ne!=="reset"||r.removeAttribute("value"),o!=null?Ne(r,ne,Qn(o)):m!=null?Ne(r,ne,Qn(m)):E!=null&&r.removeAttribute("value"),L==null&&V!=null&&(r.defaultChecked=!!V),L!=null&&(r.checked=L&&typeof L!="function"&&typeof L!="symbol"),Ae!=null&&typeof Ae!="function"&&typeof Ae!="symbol"&&typeof Ae!="boolean"?r.name=""+Qn(Ae):r.removeAttribute("name")}function Pt(r,o,m,E,L,V,ne,Ae){if(V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(r.type=V),o!=null||m!=null){if(!(V!=="submit"&&V!=="reset"||o!=null)){zi(r);return}m=m!=null?""+Qn(m):"",o=o!=null?""+Qn(o):m,Ae||o===r.value||(r.value=o),r.defaultValue=o}E=E??L,E=typeof E!="function"&&typeof E!="symbol"&&!!E,r.checked=Ae?r.checked:!!E,r.defaultChecked=!!E,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(r.name=ne),zi(r)}function Ne(r,o,m){o==="number"&&sl(r.ownerDocument)===r||r.defaultValue===""+m||(r.defaultValue=""+m)}function ti(r,o,m,E){if(r=r.options,o){o={};for(var L=0;L<m.length;L++)o["$"+m[L]]=!0;for(m=0;m<r.length;m++)L=o.hasOwnProperty("$"+r[m].value),r[m].selected!==L&&(r[m].selected=L),L&&E&&(r[m].defaultSelected=!0)}else{for(m=""+Qn(m),o=null,L=0;L<r.length;L++){if(r[L].value===m){r[L].selected=!0,E&&(r[L].defaultSelected=!0);return}o!==null||r[L].disabled||(o=r[L])}o!==null&&(o.selected=!0)}}function cs(r,o,m){if(o!=null&&(o=""+Qn(o),o!==r.value&&(r.value=o),m==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=m!=null?""+Qn(m):""}function Is(r,o,m,E){if(o==null){if(E!=null){if(m!=null)throw Error(C(92));if(ke(E)){if(1<E.length)throw Error(C(93));E=E[0]}m=E}m==null&&(m=""),o=m}m=Qn(o),r.defaultValue=m,E=r.textContent,E===m&&E!==""&&E!==null&&(r.value=E),zi(r)}function Ma(r,o){if(o){var m=r.firstChild;if(m&&m===r.lastChild&&m.nodeType===3){m.nodeValue=o;return}}r.textContent=o}var uc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ts(r,o,m){var E=o.indexOf("--")===0;m==null||typeof m=="boolean"||m===""?E?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":E?r.setProperty(o,m):typeof m!="number"||m===0||uc.has(o)?o==="float"?r.cssFloat=m:r[o]=(""+m).trim():r[o]=m+"px"}function di(r,o,m){if(o!=null&&typeof o!="object")throw Error(C(62));if(r=r.style,m!=null){for(var E in m)!m.hasOwnProperty(E)||o!=null&&o.hasOwnProperty(E)||(E.indexOf("--")===0?r.setProperty(E,""):E==="float"?r.cssFloat="":r[E]="");for(var L in o)E=o[L],o.hasOwnProperty(L)&&m[L]!==E&&ts(r,L,E)}else for(var V in o)o.hasOwnProperty(V)&&ts(r,V,o[V])}function xr(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),al=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Si(r){return al.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Hs(){}var zl=null;function ol(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Yi=null,Br=null;function nr(r){var o=Xn(r);if(o&&(r=o.stateNode)){var m=r[je]||null;e:switch(r=o.stateNode,o.type){case"input":if(Wr(r,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name),o=m.name,m.type==="radio"&&o!=null){for(m=r;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll('input[name="'+Fi(""+o)+'"][type="radio"]'),o=0;o<m.length;o++){var E=m[o];if(E!==r&&E.form===r.form){var L=E[je]||null;if(!L)throw Error(C(90));Wr(E,L.value,L.defaultValue,L.defaultValue,L.checked,L.defaultChecked,L.type,L.name)}}for(o=0;o<m.length;o++)E=m[o],E.form===r.form&&Ba(E)}break e;case"textarea":cs(r,m.value,m.defaultValue);break e;case"select":o=m.value,o!=null&&ti(r,!!m.multiple,o,!1)}}}var gn=!1;function _r(r,o,m){if(gn)return r(o,m);gn=!0;try{var E=r(o);return E}finally{if(gn=!1,(Yi!==null||Br!==null)&&(_f(),Yi&&(o=Yi,r=Br,Br=Yi=null,nr(o),r)))for(o=0;o<r.length;o++)nr(r[o])}}function Ai(r,o){var m=r.stateNode;if(m===null)return null;var E=m[je]||null;if(E===null)return null;m=E[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(E=!E.disabled)||(r=r.type,E=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!E;break e;default:r=!1}if(r)return null;if(m&&typeof m!="function")throw Error(C(231,o,typeof m));return m}var Ui=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qs=!1;if(Ui)try{var Yr={};Object.defineProperty(Yr,"passive",{get:function(){qs=!0}}),window.addEventListener("test",Yr,Yr),window.removeEventListener("test",Yr,Yr)}catch{qs=!1}var Zs=null,Bs=null,Dr=null;function fa(){if(Dr)return Dr;var r,o=Bs,m=o.length,E,L="value"in Zs?Zs.value:Zs.textContent,V=L.length;for(r=0;r<m&&o[r]===L[r];r++);var ne=m-r;for(E=1;E<=ne&&o[m-E]===L[V-E];E++);return Dr=L.slice(r,1<E?1-E:void 0)}function ps(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function va(){return!0}function Ms(){return!1}function Rr(r){function o(m,E,L,V,ne){this._reactName=m,this._targetInst=L,this.type=E,this.nativeEvent=V,this.target=ne,this.currentTarget=null;for(var Ae in r)r.hasOwnProperty(Ae)&&(m=r[Ae],this[Ae]=m?m(V):V[Ae]);return this.isDefaultPrevented=(V.defaultPrevented!=null?V.defaultPrevented:V.returnValue===!1)?va:Ms,this.isPropagationStopped=Ms,this}return K(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=va)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=va)},persist:function(){},isPersistent:va}),o}var ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rr=Rr(ns),Ao=K({},ns,{view:0,detail:0}),Eo=Rr(Ao),hr,Se,et,nt=K({},Ao,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ka,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==et&&(et&&r.type==="mousemove"?(hr=r.screenX-et.screenX,Se=r.screenY-et.screenY):Se=hr=0,et=r),hr)},movementY:function(r){return"movementY"in r?r.movementY:Se}}),tt=Rr(nt),wt=K({},nt,{dataTransfer:0}),Mn=Rr(wt),qn=K({},Ao,{relatedTarget:0}),Vi=Rr(qn),It=K({},ns,{animationName:0,elapsedTime:0,pseudoElement:0}),oi=Rr(It),Xi=K({},ns,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),pa=Rr(Xi),hc=K({},ns,{data:0}),ll=Rr(hc),ks={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ws={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ar(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=sr[r])?!!o[r]:!1}function ka(){return Ar}var br=K({},Ao,{key:function(r){if(r.key){var o=ks[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=ps(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?ws[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ka,charCode:function(r){return r.type==="keypress"?ps(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ps(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),vr=Rr(br),Fa=K({},nt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$i=Rr(Fa),xi=K({},Ao,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ka}),xu=Rr(xi),Ji=K({},ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),ja=Rr(Ji),Na=K({},nt,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ih=Rr(Na),wa=K({},ns,{newState:0,oldState:0}),cl=Rr(wa),Ll=[9,13,27,32],$r=Ui&&"CompositionEvent"in window,Bl=null;Ui&&"documentMode"in document&&(Bl=document.documentMode);var Fl=Ui&&"TextEvent"in window&&!Bl,dc=Ui&&(!$r||Bl&&8<Bl&&11>=Bl),Da=" ",_u=!1;function Lc(r,o){switch(r){case"keyup":return Ll.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fc(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var no=!1;function io(r,o){switch(r){case"compositionend":return fc(o);case"keypress":return o.which!==32?null:(_u=!0,Da);case"textInput":return r=o.data,r===Da&&_u?null:r;default:return null}}function Bc(r,o){if(no)return r==="compositionend"||!$r&&Lc(r,o)?(r=fa(),Dr=Bs=Zs=null,no=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return dc&&o.locale!=="ko"?null:o.data;default:return null}}var Ra={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fc(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!Ra[r.type]:o==="textarea"}function Pa(r,o,m,E){Yi?Br?Br.push(E):Br=[E]:Yi=E,o=Af(o,"onChange"),0<o.length&&(m=new rr("onChange","change",null,m,E),r.push({event:m,listeners:o}))}var jl=null,ul=null;function Zh(r){xm(r,0)}function pc(r){var o=Zi(r);if(Ba(o))return r}function Xs(r,o){if(r==="change")return o}var rh=!1;if(Ui){var Ul;if(Ui){var Ua="oninput"in document;if(!Ua){var ar=document.createElement("div");ar.setAttribute("oninput","return;"),Ua=typeof ar.oninput=="function"}Ul=Ua}else Ul=!1;rh=Ul&&(!document.documentMode||9<document.documentMode)}function hl(){jl&&(jl.detachEvent("onpropertychange",ce),ul=jl=null)}function ce(r){if(r.propertyName==="value"&&pc(ul)){var o=[];Pa(o,ul,r,ol(r)),_r(Zh,o)}}function a(r,o,m){r==="focusin"?(hl(),jl=o,ul=m,jl.attachEvent("onpropertychange",ce)):r==="focusout"&&hl()}function u(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return pc(ul)}function g(r,o){if(r==="click")return pc(o)}function v(r,o){if(r==="input"||r==="change")return pc(o)}function w(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var I=typeof Object.is=="function"?Object.is:w;function O(r,o){if(I(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var m=Object.keys(r),E=Object.keys(o);if(m.length!==E.length)return!1;for(E=0;E<m.length;E++){var L=m[E];if(!Rn.call(o,L)||!I(r[L],o[L]))return!1}return!0}function F(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function q(r,o){var m=F(r);r=0;for(var E;m;){if(m.nodeType===3){if(E=r+m.textContent.length,r<=o&&E>=o)return{node:m,offset:o-r};r=E}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=F(m)}}function te(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?te(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function ue(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=sl(r.document);o instanceof r.HTMLIFrameElement;){try{var m=typeof o.contentWindow.location.href=="string"}catch{m=!1}if(m)r=o.contentWindow;else break;o=sl(r.document)}return o}function xe(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var Oe=Ui&&"documentMode"in document&&11>=document.documentMode,ot=null,ft=null,Rt=null,Ht=!1;function An(r,o,m){var E=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;Ht||ot==null||ot!==sl(E)||(E=ot,"selectionStart"in E&&xe(E)?E={start:E.selectionStart,end:E.selectionEnd}:(E=(E.ownerDocument&&E.ownerDocument.defaultView||window).getSelection(),E={anchorNode:E.anchorNode,anchorOffset:E.anchorOffset,focusNode:E.focusNode,focusOffset:E.focusOffset}),Rt&&O(Rt,E)||(Rt=E,E=Af(ft,"onSelect"),0<E.length&&(o=new rr("onSelect","select",null,o,m),r.push({event:o,listeners:E}),o.target=ot)))}function wn(r,o){var m={};return m[r.toLowerCase()]=o.toLowerCase(),m["Webkit"+r]="webkit"+o,m["Moz"+r]="moz"+o,m}var mn={animationend:wn("Animation","AnimationEnd"),animationiteration:wn("Animation","AnimationIteration"),animationstart:wn("Animation","AnimationStart"),transitionrun:wn("Transition","TransitionRun"),transitionstart:wn("Transition","TransitionStart"),transitioncancel:wn("Transition","TransitionCancel"),transitionend:wn("Transition","TransitionEnd")},Ki={},Zn={};Ui&&(Zn=document.createElement("div").style,"AnimationEvent"in window||(delete mn.animationend.animation,delete mn.animationiteration.animation,delete mn.animationstart.animation),"TransitionEvent"in window||delete mn.transitionend.transition);function is(r){if(Ki[r])return Ki[r];if(!mn[r])return r;var o=mn[r],m;for(m in o)if(o.hasOwnProperty(m)&&m in Zn)return Ki[r]=o[m];return r}var ga=is("animationend"),Fs=is("animationiteration"),Er=is("animationstart"),rs=is("transitionrun"),Ws=is("transitionstart"),ro=is("transitioncancel"),js=is("transitionend"),sh=new Map,bu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bu.push("scrollEnd");function so(r,o){sh.set(r,o),ln(o,[r])}var dl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Oa=[],Vl=0,jc=0;function Uc(){for(var r=Vl,o=jc=Vl=0;o<r;){var m=Oa[o];Oa[o++]=null;var E=Oa[o];Oa[o++]=null;var L=Oa[o];Oa[o++]=null;var V=Oa[o];if(Oa[o++]=null,E!==null&&L!==null){var ne=E.pending;ne===null?L.next=L:(L.next=ne.next,ne.next=L),E.pending=L}V!==0&&qd(m,L,V)}}function ah(r,o,m,E){Oa[Vl++]=r,Oa[Vl++]=o,Oa[Vl++]=m,Oa[Vl++]=E,jc|=E,r.lanes|=E,r=r.alternate,r!==null&&(r.lanes|=E)}function gc(r,o,m,E){return ah(r,o,m,E),vu(r)}function So(r,o){return ah(r,null,null,o),vu(r)}function qd(r,o,m){r.lanes|=m;var E=r.alternate;E!==null&&(E.lanes|=m);for(var L=!1,V=r.return;V!==null;)V.childLanes|=m,E=V.alternate,E!==null&&(E.childLanes|=m),V.tag===22&&(r=V.stateNode,r===null||r._visibility&1||(L=!0)),r=V,V=V.return;return r.tag===3?(V=r.stateNode,L&&o!==null&&(L=31-xt(m),r=V.hiddenUpdates,E=r[L],E===null?r[L]=[o]:E.push(o),o.lane=m|536870912),V):null}function vu(r){if(50<xf)throw xf=0,j0=null,Error(C(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var Pi={};function Xh(r,o,m,E){this.tag=r,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ao(r,o,m,E){return new Xh(r,o,m,E)}function Wh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function oo(r,o){var m=r.alternate;return m===null?(m=ao(r.tag,o,r.key,r.mode),m.elementType=r.elementType,m.type=r.type,m.stateNode=r.stateNode,m.alternate=r,r.alternate=m):(m.pendingProps=o,m.type=r.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=r.flags&65011712,m.childLanes=r.childLanes,m.lanes=r.lanes,m.child=r.child,m.memoizedProps=r.memoizedProps,m.memoizedState=r.memoizedState,m.updateQueue=r.updateQueue,o=r.dependencies,m.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},m.sibling=r.sibling,m.index=r.index,m.ref=r.ref,m.refCleanup=r.refCleanup,m}function ap(r,o){r.flags&=65011714;var m=r.alternate;return m===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=m.childLanes,r.lanes=m.lanes,r.child=m.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=m.memoizedProps,r.memoizedState=m.memoizedState,r.updateQueue=m.updateQueue,r.type=m.type,o=m.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function Yh(r,o,m,E,L,V){var ne=0;if(E=r,typeof r=="function")Wh(r)&&(ne=1);else if(typeof r=="string")ne=Jp(r,m,bt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case He:return r=ao(31,m,o,L),r.elementType=He,r.lanes=V,r;case pe:return mc(m.children,L,V,o);case he:ne=8,L|=24;break;case De:return r=ao(12,m,o,L|2),r.elementType=De,r.lanes=V,r;case Wt:return r=ao(13,m,o,L),r.elementType=Wt,r.lanes=V,r;case Et:return r=ao(19,m,o,L),r.elementType=Et,r.lanes=V,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Xe:ne=10;break e;case Je:ne=9;break e;case mt:ne=11;break e;case rt:ne=14;break e;case at:ne=16,E=null;break e}ne=29,m=Error(C(130,r===null?"null":typeof r,"")),E=null}return o=ao(ne,m,o,L),o.elementType=r,o.type=E,o.lanes=V,o}function mc(r,o,m,E){return r=ao(7,r,E,o),r.lanes=m,r}function Zd(r,o,m){return r=ao(6,r,null,o),r.lanes=m,r}function $h(r){var o=ao(18,null,null,0);return o.stateNode=r,o}function yc(r,o,m){return o=ao(4,r.children!==null?r.children:[],r.key,o),o.lanes=m,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var wu=new WeakMap;function za(r,o){if(typeof r=="object"&&r!==null){var m=wu.get(r);return m!==void 0?m:(o={value:r,source:o,stack:Gn(o)},wu.set(r,o),o)}return{value:r,source:o,stack:Gn(o)}}var xc=[],_c=0,Vc=null,bc=0,Ys=[],Js=0,fl=null,pl=1,Va="";function Gl(r,o){xc[_c++]=bc,xc[_c++]=Vc,Vc=r,bc=o}function Xd(r,o,m){Ys[Js++]=pl,Ys[Js++]=Va,Ys[Js++]=fl,fl=r;var E=pl;r=Va;var L=32-xt(E)-1;E&=~(1<<L),m+=1;var V=32-xt(o)+L;if(30<V){var ne=L-L%5;V=(E&(1<<ne)-1).toString(32),E>>=ne,L-=ne,pl=1<<32-xt(o)+L|m<<L|E,Va=V+r}else pl=1<<V|m<<L|E,Va=r}function Gc(r){r.return!==null&&(Gl(r,1),Xd(r,1,0))}function Au(r){for(;r===Vc;)Vc=xc[--_c],xc[_c]=null,bc=xc[--_c],xc[_c]=null;for(;r===fl;)fl=Ys[--Js],Ys[Js]=null,Va=Ys[--Js],Ys[Js]=null,pl=Ys[--Js],Ys[Js]=null}function Wd(r,o){Ys[Js++]=pl,Ys[Js++]=Va,Ys[Js++]=fl,pl=o.id,Va=o.overflow,fl=r}var ea=null,Fr=null,ir=!1,Hl=null,lo=!1,us=Error(C(519));function Ga(r){var o=Error(C(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ql(za(o,r)),us}function Ha(r){var o=r.stateNode,m=r.type,E=r.memoizedProps;switch(o[Ke]=r,o[je]=E,m){case"dialog":pr("cancel",o),pr("close",o);break;case"iframe":case"object":case"embed":pr("load",o);break;case"video":case"audio":for(m=0;m<Bu.length;m++)pr(Bu[m],o);break;case"source":pr("error",o);break;case"img":case"image":case"link":pr("error",o),pr("load",o);break;case"details":pr("toggle",o);break;case"input":pr("invalid",o),Pt(o,E.value,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name,!0);break;case"select":pr("invalid",o);break;case"textarea":pr("invalid",o),Is(o,E.value,E.defaultValue,E.children)}m=E.children,typeof m!="string"&&typeof m!="number"&&typeof m!="bigint"||o.textContent===""+m||E.suppressHydrationWarning===!0||eg(o.textContent,m)?(E.popover!=null&&(pr("beforetoggle",o),pr("toggle",o)),E.onScroll!=null&&pr("scroll",o),E.onScrollEnd!=null&&pr("scrollend",o),E.onClick!=null&&(o.onclick=Hs),o=!0):o=!1,o||Ga(r,!0)}function oh(r){for(ea=r.return;ea;)switch(ea.tag){case 5:case 31:case 13:lo=!1;return;case 27:case 3:lo=!0;return;default:ea=ea.return}}function gl(r){if(r!==ea)return!1;if(!ir)return oh(r),ir=!0,!1;var o=r.tag,m;if((m=o!==3&&o!==27)&&((m=o===5)&&(m=r.type,m=!(m!=="form"&&m!=="button")||Zp(r.type,r.memoizedProps)),m=!m),m&&Fr&&Ga(r),oh(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(317));Fr=la(r)}else if(o===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(317));Fr=la(r)}else o===27?(o=Fr,Uu(r.type)?(r=yo,yo=null,Fr=r):Fr=o):Fr=ea?el(r.stateNode.nextSibling):null;return!0}function ml(){Fr=ea=null,ir=!1}function yl(){var r=Hl;return r!==null&&(Oo===null?Oo=r:Oo.push.apply(Oo,r),Hl=null),r}function ql(r){Hl===null?Hl=[r]:Hl.push(r)}var Zl=Re(null),Co=null,xl=null;function Xl(r,o,m){kt(Zl,o._currentValue),o._currentValue=m}function _l(r){r._currentValue=Zl.current,ct(Zl)}function Kh(r,o,m){for(;r!==null;){var E=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,E!==null&&(E.childLanes|=o)):E!==null&&(E.childLanes&o)!==o&&(E.childLanes|=o),r===m)break;r=r.return}}function Qh(r,o,m,E){var L=r.child;for(L!==null&&(L.return=r);L!==null;){var V=L.dependencies;if(V!==null){var ne=L.child;V=V.firstContext;e:for(;V!==null;){var Ae=V;V=L;for(var lt=0;lt<o.length;lt++)if(Ae.context===o[lt]){V.lanes|=m,Ae=V.alternate,Ae!==null&&(Ae.lanes|=m),Kh(V.return,m,r),E||(ne=null);break e}V=Ae.next}}else if(L.tag===18){if(ne=L.return,ne===null)throw Error(C(341));ne.lanes|=m,V=ne.alternate,V!==null&&(V.lanes|=m),Kh(ne,m,r),ne=null}else ne=L.child;if(ne!==null)ne.return=L;else for(ne=L;ne!==null;){if(ne===r){ne=null;break}if(L=ne.sibling,L!==null){L.return=ne.return,ne=L;break}ne=ne.return}L=ne}}function co(r,o,m,E){r=null;for(var L=o,V=!1;L!==null;){if(!V){if((L.flags&524288)!==0)V=!0;else if((L.flags&262144)!==0)break}if(L.tag===10){var ne=L.alternate;if(ne===null)throw Error(C(387));if(ne=ne.memoizedProps,ne!==null){var Ae=L.type;I(L.pendingProps.value,ne.value)||(r!==null?r.push(Ae):r=[Ae])}}else if(L===Qt.current){if(ne=L.alternate,ne===null)throw Error(C(387));ne.memoizedState.memoizedState!==L.memoizedState.memoizedState&&(r!==null?r.push(Id):r=[Id])}L=L.return}r!==null&&Qh(o,r,m,E),o.flags|=262144}function Eu(r){for(r=r.firstContext;r!==null;){if(!I(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Wl(r){Co=r,xl=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Ns(r){return Jh(Co,r)}function lh(r,o){return Co===null&&Wl(r),Jh(r,o)}function Jh(r,o){var m=o._currentValue;if(o={context:o,memoizedValue:m,next:null},xl===null){if(r===null)throw Error(C(308));xl=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else xl=xl.next=o;return m}var Yd=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(m,E){r.push(E)}};this.abort=function(){o.aborted=!0,r.forEach(function(m){return m()})}},op=c.unstable_scheduleCallback,$d=c.unstable_NormalPriority,As={$$typeof:Xe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function bl(){return{controller:new Yd,data:new Map,refCount:0}}function Su(r){r.refCount--,r.refCount===0&&op($d,function(){r.controller.abort()})}var Aa=null,uo=0,Hc=0,Ea=null;function A0(r,o){if(Aa===null){var m=Aa=[];uo=0,Hc=Y0(),Ea={status:"pending",value:void 0,then:function(E){m.push(E)}}}return uo++,o.then(Cu,Cu),o}function Cu(){if(--uo===0&&Aa!==null){Ea!==null&&(Ea.status="fulfilled");var r=Aa;Aa=null,Hc=0,Ea=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function ch(r,o){var m=[],E={status:"pending",value:null,reason:null,then:function(L){m.push(L)}};return r.then(function(){E.status="fulfilled",E.value=o;for(var L=0;L<m.length;L++)(0,m[L])(o)},function(L){for(E.status="rejected",E.reason=L,L=0;L<m.length;L++)(0,m[L])(void 0)}),E}var $s=Te.S;Te.S=function(r,o){tm=Di(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&A0(r,o),$s!==null&&$s(r,o)};var Go=Re(null);function ed(){var r=Go.current;return r!==null?r:os.pooledCache}function td(r,o){o===null?kt(Go,Go.current):kt(Go,o.pool)}function lp(){var r=ed();return r===null?null:{parent:As._currentValue,pool:r}}var Ho=Error(C(460)),vc=Error(C(474)),qa=Error(C(542)),On={then:function(){}};function uh(r){return r=r.status,r==="fulfilled"||r==="rejected"}function nd(r,o,m){switch(m=r[m],m===void 0?r.push(o):m!==o&&(o.then(Hs,Hs),o=m),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,id(r),r;default:if(typeof o.status=="string")o.then(Hs,Hs);else{if(r=os,r!==null&&100<r.shellSuspendCounter)throw Error(C(482));r=o,r.status="pending",r.then(function(E){if(o.status==="pending"){var L=o;L.status="fulfilled",L.value=E}},function(E){if(o.status==="pending"){var L=o;L.status="rejected",L.reason=E}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,id(r),r}throw qo=o,Ho}}function To(r){try{var o=r._init;return o(r._payload)}catch(m){throw m!==null&&typeof m=="object"&&typeof m.then=="function"?(qo=m,Ho):m}}var qo=null;function Tu(){if(qo===null)throw Error(C(459));var r=qo;return qo=null,r}function id(r){if(r===Ho||r===qa)throw Error(C(483))}var vl=null,qc=0;function hh(r){var o=qc;return qc+=1,vl===null&&(vl=[]),nd(vl,r,o)}function wl(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function rd(r,o){throw o.$$typeof===_e?Error(C(525)):(r=Object.prototype.toString.call(o),Error(C(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function dh(r){function o(Ct,gt){if(r){var jt=Ct.deletions;jt===null?(Ct.deletions=[gt],Ct.flags|=16):jt.push(gt)}}function m(Ct,gt){if(!r)return null;for(;gt!==null;)o(Ct,gt),gt=gt.sibling;return null}function E(Ct){for(var gt=new Map;Ct!==null;)Ct.key!==null?gt.set(Ct.key,Ct):gt.set(Ct.index,Ct),Ct=Ct.sibling;return gt}function L(Ct,gt){return Ct=oo(Ct,gt),Ct.index=0,Ct.sibling=null,Ct}function V(Ct,gt,jt){return Ct.index=jt,r?(jt=Ct.alternate,jt!==null?(jt=jt.index,jt<gt?(Ct.flags|=67108866,gt):jt):(Ct.flags|=67108866,gt)):(Ct.flags|=1048576,gt)}function ne(Ct){return r&&Ct.alternate===null&&(Ct.flags|=67108866),Ct}function Ae(Ct,gt,jt,dn){return gt===null||gt.tag!==6?(gt=Zd(jt,Ct.mode,dn),gt.return=Ct,gt):(gt=L(gt,jt),gt.return=Ct,gt)}function lt(Ct,gt,jt,dn){var Ci=jt.type;return Ci===pe?rn(Ct,gt,jt.props.children,dn,jt.key):gt!==null&&(gt.elementType===Ci||typeof Ci=="object"&&Ci!==null&&Ci.$$typeof===at&&To(Ci)===gt.type)?(gt=L(gt,jt.props),wl(gt,jt),gt.return=Ct,gt):(gt=Yh(jt.type,jt.key,jt.props,null,Ct.mode,dn),wl(gt,jt),gt.return=Ct,gt)}function Vt(Ct,gt,jt,dn){return gt===null||gt.tag!==4||gt.stateNode.containerInfo!==jt.containerInfo||gt.stateNode.implementation!==jt.implementation?(gt=yc(jt,Ct.mode,dn),gt.return=Ct,gt):(gt=L(gt,jt.children||[]),gt.return=Ct,gt)}function rn(Ct,gt,jt,dn,Ci){return gt===null||gt.tag!==7?(gt=mc(jt,Ct.mode,dn,Ci),gt.return=Ct,gt):(gt=L(gt,jt),gt.return=Ct,gt)}function pn(Ct,gt,jt){if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return gt=Zd(""+gt,Ct.mode,jt),gt.return=Ct,gt;if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case we:return jt=Yh(gt.type,gt.key,gt.props,null,Ct.mode,jt),wl(jt,gt),jt.return=Ct,jt;case ve:return gt=yc(gt,Ct.mode,jt),gt.return=Ct,gt;case at:return gt=To(gt),pn(Ct,gt,jt)}if(ke(gt)||ht(gt))return gt=mc(gt,Ct.mode,jt,null),gt.return=Ct,gt;if(typeof gt.then=="function")return pn(Ct,hh(gt),jt);if(gt.$$typeof===Xe)return pn(Ct,lh(Ct,gt),jt);rd(Ct,gt)}return null}function Gt(Ct,gt,jt,dn){var Ci=gt!==null?gt.key:null;if(typeof jt=="string"&&jt!==""||typeof jt=="number"||typeof jt=="bigint")return Ci!==null?null:Ae(Ct,gt,""+jt,dn);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case we:return jt.key===Ci?lt(Ct,gt,jt,dn):null;case ve:return jt.key===Ci?Vt(Ct,gt,jt,dn):null;case at:return jt=To(jt),Gt(Ct,gt,jt,dn)}if(ke(jt)||ht(jt))return Ci!==null?null:rn(Ct,gt,jt,dn,null);if(typeof jt.then=="function")return Gt(Ct,gt,hh(jt),dn);if(jt.$$typeof===Xe)return Gt(Ct,gt,lh(Ct,jt),dn);rd(Ct,jt)}return null}function $t(Ct,gt,jt,dn,Ci){if(typeof dn=="string"&&dn!==""||typeof dn=="number"||typeof dn=="bigint")return Ct=Ct.get(jt)||null,Ae(gt,Ct,""+dn,Ci);if(typeof dn=="object"&&dn!==null){switch(dn.$$typeof){case we:return Ct=Ct.get(dn.key===null?jt:dn.key)||null,lt(gt,Ct,dn,Ci);case ve:return Ct=Ct.get(dn.key===null?jt:dn.key)||null,Vt(gt,Ct,dn,Ci);case at:return dn=To(dn),$t(Ct,gt,jt,dn,Ci)}if(ke(dn)||ht(dn))return Ct=Ct.get(jt)||null,rn(gt,Ct,dn,Ci,null);if(typeof dn.then=="function")return $t(Ct,gt,jt,hh(dn),Ci);if(dn.$$typeof===Xe)return $t(Ct,gt,jt,lh(gt,dn),Ci);rd(gt,dn)}return null}function ci(Ct,gt,jt,dn){for(var Ci=null,zr=null,ui=gt,vi=gt=0,cr=null;ui!==null&&vi<jt.length;vi++){ui.index>vi?(cr=ui,ui=null):cr=ui.sibling;var kr=Gt(Ct,ui,jt[vi],dn);if(kr===null){ui===null&&(ui=cr);break}r&&ui&&kr.alternate===null&&o(Ct,ui),gt=V(kr,gt,vi),zr===null?Ci=kr:zr.sibling=kr,zr=kr,ui=cr}if(vi===jt.length)return m(Ct,ui),ir&&Gl(Ct,vi),Ci;if(ui===null){for(;vi<jt.length;vi++)ui=pn(Ct,jt[vi],dn),ui!==null&&(gt=V(ui,gt,vi),zr===null?Ci=ui:zr.sibling=ui,zr=ui);return ir&&Gl(Ct,vi),Ci}for(ui=E(ui);vi<jt.length;vi++)cr=$t(ui,Ct,vi,jt[vi],dn),cr!==null&&(r&&cr.alternate!==null&&ui.delete(cr.key===null?vi:cr.key),gt=V(cr,gt,vi),zr===null?Ci=cr:zr.sibling=cr,zr=cr);return r&&ui.forEach(function(du){return o(Ct,du)}),ir&&Gl(Ct,vi),Ci}function Ii(Ct,gt,jt,dn){if(jt==null)throw Error(C(151));for(var Ci=null,zr=null,ui=gt,vi=gt=0,cr=null,kr=jt.next();ui!==null&&!kr.done;vi++,kr=jt.next()){ui.index>vi?(cr=ui,ui=null):cr=ui.sibling;var du=Gt(Ct,ui,kr.value,dn);if(du===null){ui===null&&(ui=cr);break}r&&ui&&du.alternate===null&&o(Ct,ui),gt=V(du,gt,vi),zr===null?Ci=du:zr.sibling=du,zr=du,ui=cr}if(kr.done)return m(Ct,ui),ir&&Gl(Ct,vi),Ci;if(ui===null){for(;!kr.done;vi++,kr=jt.next())kr=pn(Ct,kr.value,dn),kr!==null&&(gt=V(kr,gt,vi),zr===null?Ci=kr:zr.sibling=kr,zr=kr);return ir&&Gl(Ct,vi),Ci}for(ui=E(ui);!kr.done;vi++,kr=jt.next())kr=$t(ui,Ct,vi,kr.value,dn),kr!==null&&(r&&kr.alternate!==null&&ui.delete(kr.key===null?vi:kr.key),gt=V(kr,gt,vi),zr===null?Ci=kr:zr.sibling=kr,zr=kr);return r&&ui.forEach(function(wg){return o(Ct,wg)}),ir&&Gl(Ct,vi),Ci}function Xr(Ct,gt,jt,dn){if(typeof jt=="object"&&jt!==null&&jt.type===pe&&jt.key===null&&(jt=jt.props.children),typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case we:e:{for(var Ci=jt.key;gt!==null;){if(gt.key===Ci){if(Ci=jt.type,Ci===pe){if(gt.tag===7){m(Ct,gt.sibling),dn=L(gt,jt.props.children),dn.return=Ct,Ct=dn;break e}}else if(gt.elementType===Ci||typeof Ci=="object"&&Ci!==null&&Ci.$$typeof===at&&To(Ci)===gt.type){m(Ct,gt.sibling),dn=L(gt,jt.props),wl(dn,jt),dn.return=Ct,Ct=dn;break e}m(Ct,gt);break}else o(Ct,gt);gt=gt.sibling}jt.type===pe?(dn=mc(jt.props.children,Ct.mode,dn,jt.key),dn.return=Ct,Ct=dn):(dn=Yh(jt.type,jt.key,jt.props,null,Ct.mode,dn),wl(dn,jt),dn.return=Ct,Ct=dn)}return ne(Ct);case ve:e:{for(Ci=jt.key;gt!==null;){if(gt.key===Ci)if(gt.tag===4&&gt.stateNode.containerInfo===jt.containerInfo&&gt.stateNode.implementation===jt.implementation){m(Ct,gt.sibling),dn=L(gt,jt.children||[]),dn.return=Ct,Ct=dn;break e}else{m(Ct,gt);break}else o(Ct,gt);gt=gt.sibling}dn=yc(jt,Ct.mode,dn),dn.return=Ct,Ct=dn}return ne(Ct);case at:return jt=To(jt),Xr(Ct,gt,jt,dn)}if(ke(jt))return ci(Ct,gt,jt,dn);if(ht(jt)){if(Ci=ht(jt),typeof Ci!="function")throw Error(C(150));return jt=Ci.call(jt),Ii(Ct,gt,jt,dn)}if(typeof jt.then=="function")return Xr(Ct,gt,hh(jt),dn);if(jt.$$typeof===Xe)return Xr(Ct,gt,lh(Ct,jt),dn);rd(Ct,jt)}return typeof jt=="string"&&jt!==""||typeof jt=="number"||typeof jt=="bigint"?(jt=""+jt,gt!==null&&gt.tag===6?(m(Ct,gt.sibling),dn=L(gt,jt),dn.return=Ct,Ct=dn):(m(Ct,gt),dn=Zd(jt,Ct.mode,dn),dn.return=Ct,Ct=dn),ne(Ct)):m(Ct,gt)}return function(Ct,gt,jt,dn){try{qc=0;var Ci=Xr(Ct,gt,jt,dn);return vl=null,Ci}catch(ui){if(ui===Ho||ui===qa)throw ui;var zr=ao(29,ui,null,Ct.mode);return zr.lanes=dn,zr.return=Ct,zr}}}var Al=dh(!0),Kd=dh(!1),El=!1;function sd(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function fh(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Sl(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Yl(r,o,m){var E=r.updateQueue;if(E===null)return null;if(E=E.shared,(Vr&2)!==0){var L=E.pending;return L===null?o.next=o:(o.next=L.next,L.next=o),E.pending=o,o=vu(r),qd(r,null,m),o}return ah(r,E,o,m),vu(r)}function Io(r,o,m){if(o=o.updateQueue,o!==null&&(o=o.shared,(m&4194048)!==0)){var E=o.lanes;E&=r.pendingLanes,m|=E,o.lanes=m,Ri(r,m)}}function Ir(r,o){var m=r.updateQueue,E=r.alternate;if(E!==null&&(E=E.updateQueue,m===E)){var L=null,V=null;if(m=m.firstBaseUpdate,m!==null){do{var ne={lane:m.lane,tag:m.tag,payload:m.payload,callback:null,next:null};V===null?L=V=ne:V=V.next=ne,m=m.next}while(m!==null);V===null?L=V=o:V=V.next=o}else L=V=o;m={baseState:E.baseState,firstBaseUpdate:L,lastBaseUpdate:V,shared:E.shared,callbacks:E.callbacks},r.updateQueue=m;return}r=m.lastBaseUpdate,r===null?m.firstBaseUpdate=o:r.next=o,m.lastBaseUpdate=o}var Qd=!1;function $l(){if(Qd){var r=Ea;if(r!==null)throw r}}function wc(r,o,m,E){Qd=!1;var L=r.updateQueue;El=!1;var V=L.firstBaseUpdate,ne=L.lastBaseUpdate,Ae=L.shared.pending;if(Ae!==null){L.shared.pending=null;var lt=Ae,Vt=lt.next;lt.next=null,ne===null?V=Vt:ne.next=Vt,ne=lt;var rn=r.alternate;rn!==null&&(rn=rn.updateQueue,Ae=rn.lastBaseUpdate,Ae!==ne&&(Ae===null?rn.firstBaseUpdate=Vt:Ae.next=Vt,rn.lastBaseUpdate=lt))}if(V!==null){var pn=L.baseState;ne=0,rn=Vt=lt=null,Ae=V;do{var Gt=Ae.lane&-536870913,$t=Gt!==Ae.lane;if($t?(fr&Gt)===Gt:(E&Gt)===Gt){Gt!==0&&Gt===Hc&&(Qd=!0),rn!==null&&(rn=rn.next={lane:0,tag:Ae.tag,payload:Ae.payload,callback:null,next:null});e:{var ci=r,Ii=Ae;Gt=o;var Xr=m;switch(Ii.tag){case 1:if(ci=Ii.payload,typeof ci=="function"){pn=ci.call(Xr,pn,Gt);break e}pn=ci;break e;case 3:ci.flags=ci.flags&-65537|128;case 0:if(ci=Ii.payload,Gt=typeof ci=="function"?ci.call(Xr,pn,Gt):ci,Gt==null)break e;pn=K({},pn,Gt);break e;case 2:El=!0}}Gt=Ae.callback,Gt!==null&&(r.flags|=64,$t&&(r.flags|=8192),$t=L.callbacks,$t===null?L.callbacks=[Gt]:$t.push(Gt))}else $t={lane:Gt,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},rn===null?(Vt=rn=$t,lt=pn):rn=rn.next=$t,ne|=Gt;if(Ae=Ae.next,Ae===null){if(Ae=L.shared.pending,Ae===null)break;$t=Ae,Ae=$t.next,$t.next=null,L.lastBaseUpdate=$t,L.shared.pending=null}}while(!0);rn===null&&(lt=pn),L.baseState=lt,L.firstBaseUpdate=Vt,L.lastBaseUpdate=rn,V===null&&(L.shared.lanes=0),su|=ne,r.lanes=ne,r.memoizedState=pn}}function ph(r,o){if(typeof r!="function")throw Error(C(191,r));r.call(o)}function ad(r,o){var m=r.callbacks;if(m!==null)for(r.callbacks=null,r=0;r<m.length;r++)ph(m[r],o)}var Zc=Re(null),gh=Re(0);function Jd(r,o){r=ru,kt(gh,r),kt(Zc,o),ru=r|o.baseLanes}function ho(){kt(gh,ru),kt(Zc,Zc.current)}function Xc(){ru=gh.current,ct(Zc),ct(gh)}var Bn=Re(null),ei=null;function Mo(r){var o=r.alternate;kt(gs,gs.current&1),kt(Bn,r),ei===null&&(o===null||Zc.current!==null||o.memoizedState!==null)&&(ei=r)}function Iu(r){kt(gs,gs.current),kt(Bn,r),ei===null&&(ei=r)}function mh(r){r.tag===22?(kt(gs,gs.current),kt(Bn,r),ei===null&&(ei=r)):Es()}function Es(){kt(gs,gs.current),kt(Bn,Bn.current)}function hs(r){ct(Bn),ei===r&&(ei=null),ct(gs)}var gs=Re(0);function yh(r){for(var o=r;o!==null;){if(o.tag===13){var m=o.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||Ya(m)||Vs(m)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Kl=0,qi=null,Sr=null,Gi=null,ss=!1,ko=!1,Zo=!1,Wc=0,Yc=0,Ql=null,ef=0;function Kr(){throw Error(C(321))}function Xo(r,o){if(o===null)return!1;for(var m=0;m<o.length&&m<r.length;m++)if(!I(r[m],o[m]))return!1;return!0}function Mu(r,o,m,E,L,V){return Kl=V,qi=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Te.H=r===null||r.memoizedState===null?Ur:Ds,Zo=!1,V=m(E,L),Zo=!1,ko&&(V=xh(o,m,E,L)),ku(r),V}function ku(r){Te.H=Mr;var o=Sr!==null&&Sr.next!==null;if(Kl=0,Gi=Sr=qi=null,ss=!1,Yc=0,Ql=null,o)throw Error(C(300));r===null||ia||(r=r.dependencies,r!==null&&Eu(r)&&(ia=!0))}function xh(r,o,m,E){qi=r;var L=0;do{if(ko&&(Ql=null),Yc=0,ko=!1,25<=L)throw Error(C(301));if(L+=1,Gi=Sr=null,r.updateQueue!=null){var V=r.updateQueue;V.lastEffect=null,V.events=null,V.stores=null,V.memoCache!=null&&(V.memoCache.index=0)}Te.H=Us,V=o(m,E)}while(ko);return V}function _h(){var r=Te.H,o=r.useState()[0];return o=typeof o.then=="function"?$c(o):o,r=r.useState()[0],(Sr!==null?Sr.memoizedState:null)!==r&&(qi.flags|=1024),o}function bh(){var r=Wc!==0;return Wc=0,r}function Ac(r,o,m){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~m}function Jl(r){if(ss){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}ss=!1}Kl=0,Gi=Sr=qi=null,ko=!1,Yc=Wc=0,Ql=null}function ma(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gi===null?qi.memoizedState=Gi=r:Gi=Gi.next=r,Gi}function as(){if(Sr===null){var r=qi.alternate;r=r!==null?r.memoizedState:null}else r=Sr.next;var o=Gi===null?qi.memoizedState:Gi.next;if(o!==null)Gi=o,Sr=r;else{if(r===null)throw qi.alternate===null?Error(C(467)):Error(C(310));Sr=r,r={memoizedState:Sr.memoizedState,baseState:Sr.baseState,baseQueue:Sr.baseQueue,queue:Sr.queue,next:null},Gi===null?qi.memoizedState=Gi=r:Gi=Gi.next=r}return Gi}function Cl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $c(r){var o=Yc;return Yc+=1,Ql===null&&(Ql=[]),r=nd(Ql,r,o),o=qi,(Gi===null?o.memoizedState:Gi.next)===null&&(o=o.alternate,Te.H=o===null||o.memoizedState===null?Ur:Ds),r}function Kc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return $c(r);if(r.$$typeof===Xe)return Ns(r)}throw Error(C(438,String(r)))}function Nu(r){var o=null,m=qi.updateQueue;if(m!==null&&(o=m.memoCache),o==null){var E=qi.alternate;E!==null&&(E=E.updateQueue,E!==null&&(E=E.memoCache,E!=null&&(o={data:E.data.map(function(L){return L.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),m===null&&(m=Cl(),qi.updateQueue=m),m.memoCache=o,m=o.data[o.index],m===void 0)for(m=o.data[o.index]=Array(r),E=0;E<r;E++)m[E]=_t;return o.index++,m}function Wo(r,o){return typeof o=="function"?o(r):o}function A(r){var o=as();return t(o,Sr,r)}function t(r,o,m){var E=r.queue;if(E===null)throw Error(C(311));E.lastRenderedReducer=m;var L=r.baseQueue,V=E.pending;if(V!==null){if(L!==null){var ne=L.next;L.next=V.next,V.next=ne}o.baseQueue=L=V,E.pending=null}if(V=r.baseState,L===null)r.memoizedState=V;else{o=L.next;var Ae=ne=null,lt=null,Vt=o,rn=!1;do{var pn=Vt.lane&-536870913;if(pn!==Vt.lane?(fr&pn)===pn:(Kl&pn)===pn){var Gt=Vt.revertLane;if(Gt===0)lt!==null&&(lt=lt.next={lane:0,revertLane:0,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null}),pn===Hc&&(rn=!0);else if((Kl&Gt)===Gt){Vt=Vt.next,Gt===Hc&&(rn=!0);continue}else pn={lane:0,revertLane:Vt.revertLane,gesture:null,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},lt===null?(Ae=lt=pn,ne=V):lt=lt.next=pn,qi.lanes|=Gt,su|=Gt;pn=Vt.action,Zo&&m(V,pn),V=Vt.hasEagerState?Vt.eagerState:m(V,pn)}else Gt={lane:pn,revertLane:Vt.revertLane,gesture:Vt.gesture,action:Vt.action,hasEagerState:Vt.hasEagerState,eagerState:Vt.eagerState,next:null},lt===null?(Ae=lt=Gt,ne=V):lt=lt.next=Gt,qi.lanes|=pn,su|=pn;Vt=Vt.next}while(Vt!==null&&Vt!==o);if(lt===null?ne=V:lt.next=Ae,!I(V,r.memoizedState)&&(ia=!0,rn&&(m=Ea,m!==null)))throw m;r.memoizedState=V,r.baseState=ne,r.baseQueue=lt,E.lastRenderedState=V}return L===null&&(E.lanes=0),[r.memoizedState,E.dispatch]}function s(r){var o=as(),m=o.queue;if(m===null)throw Error(C(311));m.lastRenderedReducer=r;var E=m.dispatch,L=m.pending,V=o.memoizedState;if(L!==null){m.pending=null;var ne=L=L.next;do V=r(V,ne.action),ne=ne.next;while(ne!==L);I(V,o.memoizedState)||(ia=!0),o.memoizedState=V,o.baseQueue===null&&(o.baseState=V),m.lastRenderedState=V}return[V,E]}function f(r,o,m){var E=qi,L=as(),V=ir;if(V){if(m===void 0)throw Error(C(407));m=m()}else m=o();var ne=!I((Sr||L).memoizedState,m);if(ne&&(L.memoizedState=m,ia=!0),L=L.queue,zt(M.bind(null,E,L,r),[r]),L.getSnapshot!==o||ne||Gi!==null&&Gi.memoizedState.tag&1){if(E.flags|=2048,Ve(9,{destroy:void 0},S.bind(null,E,L,m,o),null),os===null)throw Error(C(349));V||(Kl&127)!==0||x(E,o,m)}return m}function x(r,o,m){r.flags|=16384,r={getSnapshot:o,value:m},o=qi.updateQueue,o===null?(o=Cl(),qi.updateQueue=o,o.stores=[r]):(m=o.stores,m===null?o.stores=[r]:m.push(r))}function S(r,o,m,E){o.value=m,o.getSnapshot=E,z(o)&&j(r)}function M(r,o,m){return m(function(){z(o)&&j(r)})}function z(r){var o=r.getSnapshot;r=r.value;try{var m=o();return!I(r,m)}catch{return!0}}function j(r){var o=So(r,2);o!==null&&Lo(o,r,2)}function Z(r){var o=ma();if(typeof r=="function"){var m=r;if(r=m(),Zo){qe(!0);try{m()}finally{qe(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:r},o}function W(r,o,m,E){return r.baseState=m,t(r,Sr,typeof E=="function"?E:Wo)}function ee(r,o,m,E,L){if(fo(r))throw Error(C(485));if(r=o.action,r!==null){var V={payload:L,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){V.listeners.push(ne)}};Te.T!==null?m(!0):V.isTransition=!1,E(V),m=o.pending,m===null?(V.next=o.pending=V,J(o,V)):(V.next=m.next,o.pending=m.next=V)}}function J(r,o){var m=o.action,E=o.payload,L=r.state;if(o.isTransition){var V=Te.T,ne={};Te.T=ne;try{var Ae=m(L,E),lt=Te.S;lt!==null&&lt(ne,Ae),se(r,o,Ae)}catch(Vt){Ce(r,o,Vt)}finally{V!==null&&ne.types!==null&&(V.types=ne.types),Te.T=V}}else try{V=m(L,E),se(r,o,V)}catch(Vt){Ce(r,o,Vt)}}function se(r,o,m){m!==null&&typeof m=="object"&&typeof m.then=="function"?m.then(function(E){fe(r,o,E)},function(E){return Ce(r,o,E)}):fe(r,o,m)}function fe(r,o,m){o.status="fulfilled",o.value=m,Me(o),r.state=m,o=r.pending,o!==null&&(m=o.next,m===o?r.pending=null:(m=m.next,o.next=m,J(r,m)))}function Ce(r,o,m){var E=r.pending;if(r.pending=null,E!==null){E=E.next;do o.status="rejected",o.reason=m,Me(o),o=o.next;while(o!==E)}r.action=null}function Me(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function Ie(r,o){return o}function Le(r,o){if(ir){var m=os.formState;if(m!==null){e:{var E=qi;if(ir){if(Fr){t:{for(var L=Fr,V=lo;L.nodeType!==8;){if(!V){L=null;break t}if(L=el(L.nextSibling),L===null){L=null;break t}}V=L.data,L=V==="F!"||V==="F"?L:null}if(L){Fr=el(L.nextSibling),E=L.data==="F!";break e}}Ga(E)}E=!1}E&&(o=m[0])}}return m=ma(),m.memoizedState=m.baseState=o,E={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ie,lastRenderedState:o},m.queue=E,m=Du.bind(null,qi,E),E.dispatch=m,E=Z(!1),V=Xa.bind(null,qi,!1,E.queue),E=ma(),L={state:o,dispatch:null,action:r,pending:null},E.queue=L,m=ee.bind(null,qi,L,V,m),L.dispatch=m,E.memoizedState=r,[o,m,!1]}function $e(r){var o=as();return ze(o,Sr,r)}function ze(r,o,m){if(o=t(r,o,Ie)[0],r=A(Wo)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var E=$c(o)}catch(ne){throw ne===Ho?qa:ne}else E=o;o=as();var L=o.queue,V=L.dispatch;return m!==o.memoizedState&&(qi.flags|=2048,Ve(9,{destroy:void 0},We.bind(null,L,m),null)),[E,V,r]}function We(r,o){r.action=o}function st(r){var o=as(),m=Sr;if(m!==null)return ze(o,m,r);as(),o=o.memoizedState,m=as();var E=m.queue.dispatch;return m.memoizedState=r,[o,E,!1]}function Ve(r,o,m,E){return r={tag:r,create:m,deps:E,inst:o,next:null},o=qi.updateQueue,o===null&&(o=Cl(),qi.updateQueue=o),m=o.lastEffect,m===null?o.lastEffect=r.next=r:(E=m.next,m.next=r,r.next=E,o.lastEffect=r),r}function pt(){return as().memoizedState}function Ft(r,o,m,E){var L=ma();qi.flags|=r,L.memoizedState=Ve(1|o,{destroy:void 0},m,E===void 0?null:E)}function Nt(r,o,m,E){var L=as();E=E===void 0?null:E;var V=L.memoizedState.inst;Sr!==null&&E!==null&&Xo(E,Sr.memoizedState.deps)?L.memoizedState=Ve(o,V,m,E):(qi.flags|=r,L.memoizedState=Ve(1|o,V,m,E))}function Ot(r,o){Ft(8390656,8,r,o)}function zt(r,o){Nt(2048,8,r,o)}function xn(r){qi.flags|=4;var o=qi.updateQueue;if(o===null)o=Cl(),qi.updateQueue=o,o.events=[r];else{var m=o.events;m===null?o.events=[r]:m.push(r)}}function _n(r){var o=as().memoizedState;return xn({ref:o,nextImpl:r}),function(){if((Vr&2)!==0)throw Error(C(440));return o.impl.apply(void 0,arguments)}}function cn(r,o){return Nt(4,2,r,o)}function Tn(r,o){return Nt(4,4,r,o)}function Mi(r,o){if(typeof o=="function"){r=r();var m=o(r);return function(){typeof m=="function"?m():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function Cr(r,o,m){m=m!=null?m.concat([r]):null,Nt(4,4,Mi.bind(null,o,r),m)}function Hr(){}function jr(r,o){var m=as();o=o===void 0?null:o;var E=m.memoizedState;return o!==null&&Xo(o,E[1])?E[0]:(m.memoizedState=[r,o],r)}function Qr(r,o){var m=as();o=o===void 0?null:o;var E=m.memoizedState;if(o!==null&&Xo(o,E[1]))return E[0];if(E=r(),Zo){qe(!0);try{r()}finally{qe(!1)}}return m.memoizedState=[E,o],E}function Pr(r,o,m){return m===void 0||(Kl&1073741824)!==0&&(fr&261930)===0?r.memoizedState=o:(r.memoizedState=m,r=im(),qi.lanes|=r,su|=r,m)}function ds(r,o,m,E){return I(m,o)?m:Zc.current!==null?(r=Pr(r,m,E),I(r,o)||(ia=!0),r):(Kl&42)===0||(Kl&1073741824)!==0&&(fr&261930)===0?(ia=!0,r.memoizedState=m):(r=im(),qi.lanes|=r,su|=r,o)}function Jr(r,o,m,E,L){var V=Ze.p;Ze.p=V!==0&&8>V?V:8;var ne=Te.T,Ae={};Te.T=Ae,Xa(r,!1,o,m);try{var lt=L(),Vt=Te.S;if(Vt!==null&&Vt(Ae,lt),lt!==null&&typeof lt=="object"&&typeof lt.then=="function"){var rn=ch(lt,E);$o(r,o,rn,zo(r))}else $o(r,o,E,zo(r))}catch(pn){$o(r,o,{then:function(){},status:"rejected",reason:pn},zo())}finally{Ze.p=V,ne!==null&&Ae.types!==null&&(ne.types=Ae.types),Te.T=ne}}function ta(){}function ms(r,o,m,E){if(r.tag!==5)throw Error(C(476));var L=ys(r).queue;Jr(r,L,o,ut,m===null?ta:function(){return na(r),m(E)})}function ys(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:ut,baseState:ut,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:ut},next:null};var m={};return o.next={memoizedState:m,baseState:m,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:m},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function na(r){var o=ys(r);o.next===null&&(o=r.alternate.memoizedState),$o(r,o.next.queue,{},zo())}function Tl(){return Ns(Id)}function Il(){return as().memoizedState}function Yo(){return as().memoizedState}function Za(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var m=zo();r=Sl(m);var E=Yl(o,r,m);E!==null&&(Lo(E,o,m),Io(E,o,m)),o={cache:bl()},r.payload=o;return}o=o.return}}function Qc(r,o,m){var E=zo();m={lane:E,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},fo(r)?No(o,m):(m=gc(r,o,m,E),m!==null&&(Lo(m,r,E),Do(m,o,E)))}function Du(r,o,m){var E=zo();$o(r,o,m,E)}function $o(r,o,m,E){var L={lane:E,revertLane:0,gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null};if(fo(r))No(o,L);else{var V=r.alternate;if(r.lanes===0&&(V===null||V.lanes===0)&&(V=o.lastRenderedReducer,V!==null))try{var ne=o.lastRenderedState,Ae=V(ne,m);if(L.hasEagerState=!0,L.eagerState=Ae,I(Ae,ne))return ah(r,o,L,0),os===null&&Uc(),!1}catch{}if(m=gc(r,o,L,E),m!==null)return Lo(m,r,E),Do(m,o,E),!0}return!1}function Xa(r,o,m,E){if(E={lane:2,revertLane:Y0(),gesture:null,action:E,hasEagerState:!1,eagerState:null,next:null},fo(r)){if(o)throw Error(C(479))}else o=gc(r,m,E,2),o!==null&&Lo(o,r,2)}function fo(r){var o=r.alternate;return r===qi||o!==null&&o===qi}function No(r,o){ko=ss=!0;var m=r.pending;m===null?o.next=o:(o.next=m.next,m.next=o),r.pending=o}function Do(r,o,m){if((m&4194048)!==0){var E=o.lanes;E&=r.pendingLanes,m|=E,o.lanes=m,Ri(r,m)}}var Mr={readContext:Ns,use:Kc,useCallback:Kr,useContext:Kr,useEffect:Kr,useImperativeHandle:Kr,useLayoutEffect:Kr,useInsertionEffect:Kr,useMemo:Kr,useReducer:Kr,useRef:Kr,useState:Kr,useDebugValue:Kr,useDeferredValue:Kr,useTransition:Kr,useSyncExternalStore:Kr,useId:Kr,useHostTransitionStatus:Kr,useFormState:Kr,useActionState:Kr,useOptimistic:Kr,useMemoCache:Kr,useCacheRefresh:Kr};Mr.useEffectEvent=Kr;var Ur={readContext:Ns,use:Kc,useCallback:function(r,o){return ma().memoizedState=[r,o===void 0?null:o],r},useContext:Ns,useEffect:Ot,useImperativeHandle:function(r,o,m){m=m!=null?m.concat([r]):null,Ft(4194308,4,Mi.bind(null,o,r),m)},useLayoutEffect:function(r,o){return Ft(4194308,4,r,o)},useInsertionEffect:function(r,o){Ft(4,2,r,o)},useMemo:function(r,o){var m=ma();o=o===void 0?null:o;var E=r();if(Zo){qe(!0);try{r()}finally{qe(!1)}}return m.memoizedState=[E,o],E},useReducer:function(r,o,m){var E=ma();if(m!==void 0){var L=m(o);if(Zo){qe(!0);try{m(o)}finally{qe(!1)}}}else L=o;return E.memoizedState=E.baseState=L,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:L},E.queue=r,r=r.dispatch=Qc.bind(null,qi,r),[E.memoizedState,r]},useRef:function(r){var o=ma();return r={current:r},o.memoizedState=r},useState:function(r){r=Z(r);var o=r.queue,m=Du.bind(null,qi,o);return o.dispatch=m,[r.memoizedState,m]},useDebugValue:Hr,useDeferredValue:function(r,o){var m=ma();return Pr(m,r,o)},useTransition:function(){var r=Z(!1);return r=Jr.bind(null,qi,r.queue,!0,!1),ma().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,m){var E=qi,L=ma();if(ir){if(m===void 0)throw Error(C(407));m=m()}else{if(m=o(),os===null)throw Error(C(349));(fr&127)!==0||x(E,o,m)}L.memoizedState=m;var V={value:m,getSnapshot:o};return L.queue=V,Ot(M.bind(null,E,V,r),[r]),E.flags|=2048,Ve(9,{destroy:void 0},S.bind(null,E,V,m,o),null),m},useId:function(){var r=ma(),o=os.identifierPrefix;if(ir){var m=Va,E=pl;m=(E&~(1<<32-xt(E)-1)).toString(32)+m,o="_"+o+"R_"+m,m=Wc++,0<m&&(o+="H"+m.toString(32)),o+="_"}else m=ef++,o="_"+o+"r_"+m.toString(32)+"_";return r.memoizedState=o},useHostTransitionStatus:Tl,useFormState:Le,useActionState:Le,useOptimistic:function(r){var o=ma();o.memoizedState=o.baseState=r;var m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=m,o=Xa.bind(null,qi,!0,m),m.dispatch=o,[r,o]},useMemoCache:Nu,useCacheRefresh:function(){return ma().memoizedState=Za.bind(null,qi)},useEffectEvent:function(r){var o=ma(),m={impl:r};return o.memoizedState=m,function(){if((Vr&2)!==0)throw Error(C(440));return m.impl.apply(void 0,arguments)}}},Ds={readContext:Ns,use:Kc,useCallback:jr,useContext:Ns,useEffect:zt,useImperativeHandle:Cr,useInsertionEffect:cn,useLayoutEffect:Tn,useMemo:Qr,useReducer:A,useRef:pt,useState:function(){return A(Wo)},useDebugValue:Hr,useDeferredValue:function(r,o){var m=as();return ds(m,Sr.memoizedState,r,o)},useTransition:function(){var r=A(Wo)[0],o=as().memoizedState;return[typeof r=="boolean"?r:$c(r),o]},useSyncExternalStore:f,useId:Il,useHostTransitionStatus:Tl,useFormState:$e,useActionState:$e,useOptimistic:function(r,o){var m=as();return W(m,Sr,r,o)},useMemoCache:Nu,useCacheRefresh:Yo};Ds.useEffectEvent=_n;var Us={readContext:Ns,use:Kc,useCallback:jr,useContext:Ns,useEffect:zt,useImperativeHandle:Cr,useInsertionEffect:cn,useLayoutEffect:Tn,useMemo:Qr,useReducer:s,useRef:pt,useState:function(){return s(Wo)},useDebugValue:Hr,useDeferredValue:function(r,o){var m=as();return Sr===null?Pr(m,r,o):ds(m,Sr.memoizedState,r,o)},useTransition:function(){var r=s(Wo)[0],o=as().memoizedState;return[typeof r=="boolean"?r:$c(r),o]},useSyncExternalStore:f,useId:Il,useHostTransitionStatus:Tl,useFormState:st,useActionState:st,useOptimistic:function(r,o){var m=as();return Sr!==null?W(m,Sr,r,o):(m.baseState=r,[r,m.queue.dispatch])},useMemoCache:Nu,useCacheRefresh:Yo};Us.useEffectEvent=_n;function od(r,o,m,E){o=r.memoizedState,m=m(E,o),m=m==null?o:K({},o,m),r.memoizedState=m,r.lanes===0&&(r.updateQueue.baseState=m)}var ld={enqueueSetState:function(r,o,m){r=r._reactInternals;var E=zo(),L=Sl(E);L.payload=o,m!=null&&(L.callback=m),o=Yl(r,L,E),o!==null&&(Lo(o,r,E),Io(o,r,E))},enqueueReplaceState:function(r,o,m){r=r._reactInternals;var E=zo(),L=Sl(E);L.tag=1,L.payload=o,m!=null&&(L.callback=m),o=Yl(r,L,E),o!==null&&(Lo(o,r,E),Io(o,r,E))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var m=zo(),E=Sl(m);E.tag=2,o!=null&&(E.callback=o),o=Yl(r,E,m),o!==null&&(Lo(o,r,m),Io(o,r,m))}};function Ec(r,o,m,E,L,V,ne){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(E,V,ne):o.prototype&&o.prototype.isPureReactComponent?!O(m,E)||!O(L,V):!0}function cp(r,o,m,E){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(m,E),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(m,E),o.state!==r&&ld.enqueueReplaceState(o,o.state,null)}function Sc(r,o){var m=o;if("ref"in o){m={};for(var E in o)E!=="ref"&&(m[E]=o[E])}if(r=r.defaultProps){m===o&&(m=K({},m));for(var L in r)m[L]===void 0&&(m[L]=r[L])}return m}function cd(r){dl(r)}function ec(r){console.error(r)}function tc(r){dl(r)}function Ko(r,o){try{var m=r.onUncaughtError;m(o.value,{componentStack:o.stack})}catch(E){setTimeout(function(){throw E})}}function ud(r,o,m){try{var E=r.onCaughtError;E(m.value,{componentStack:m.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(L){setTimeout(function(){throw L})}}function vh(r,o,m){return m=Sl(m),m.tag=3,m.payload={element:null},m.callback=function(){Ko(r,o)},m}function wh(r){return r=Sl(r),r.tag=3,r}function Ah(r,o,m,E){var L=m.type.getDerivedStateFromError;if(typeof L=="function"){var V=E.value;r.payload=function(){return L(V)},r.callback=function(){ud(o,m,E)}}var ne=m.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(r.callback=function(){ud(o,m,E),typeof L!="function"&&(au===null?au=new Set([this]):au.add(this));var Ae=E.stack;this.componentDidCatch(E.value,{componentStack:Ae!==null?Ae:""})})}function up(r,o,m,E,L){if(m.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){if(o=m.alternate,o!==null&&co(o,m,L,!0),m=Bn.current,m!==null){switch(m.tag){case 31:case 13:return ei===null?bf():m.alternate===null&&Rs===0&&(Rs=3),m.flags&=-257,m.flags|=65536,m.lanes=L,E===On?m.flags|=16384:(o=m.updateQueue,o===null?m.updateQueue=new Set([E]):o.add(E),Op(r,E,L)),!1;case 22:return m.flags|=65536,E===On?m.flags|=16384:(o=m.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([E])},m.updateQueue=o):(m=o.retryQueue,m===null?o.retryQueue=new Set([E]):m.add(E)),Op(r,E,L)),!1}throw Error(C(435,m.tag))}return Op(r,E,L),bf(),!1}if(ir)return o=Bn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=L,E!==us&&(r=Error(C(422),{cause:E}),ql(za(r,m)))):(E!==us&&(o=Error(C(423),{cause:E}),ql(za(o,m))),r=r.current.alternate,r.flags|=65536,L&=-L,r.lanes|=L,E=za(E,m),L=vh(r.stateNode,E,L),Ir(r,L),Rs!==4&&(Rs=2)),!1;var V=Error(C(520),{cause:E});if(V=za(V,m),mf===null?mf=[V]:mf.push(V),Rs!==4&&(Rs=2),o===null)return!0;E=za(E,m),m=o;do{switch(m.tag){case 3:return m.flags|=65536,r=L&-L,m.lanes|=r,r=vh(m.stateNode,E,r),Ir(m,r),!1;case 1:if(o=m.type,V=m.stateNode,(m.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(au===null||!au.has(V))))return m.flags|=65536,L&=-L,m.lanes|=L,L=wh(L),Ah(L,r,m,E),Ir(m,L),!1}m=m.return}while(m!==null);return!1}var hp=Error(C(461)),ia=!1;function ya(r,o,m,E){o.child=r===null?Kd(o,null,m,E):Al(o,r.child,m,E)}function jg(r,o,m,E,L){m=m.render;var V=o.ref;if("ref"in E){var ne={};for(var Ae in E)Ae!=="ref"&&(ne[Ae]=E[Ae])}else ne=E;return Wl(o),E=Mu(r,o,m,ne,V,L),Ae=bh(),r!==null&&!ia?(Ac(r,o,L),Tc(r,o,L)):(ir&&Ae&&Gc(o),o.flags|=1,ya(r,o,E,L),o.child)}function dp(r,o,m,E,L){if(r===null){var V=m.type;return typeof V=="function"&&!Wh(V)&&V.defaultProps===void 0&&m.compare===null?(o.tag=15,o.type=V,E0(r,o,V,E,L)):(r=Yh(m.type,null,E,o,o.mode,L),r.ref=o.ref,r.return=o,o.child=r)}if(V=r.child,!rf(r,L)){var ne=V.memoizedProps;if(m=m.compare,m=m!==null?m:O,m(ne,E)&&r.ref===o.ref)return Tc(r,o,L)}return o.flags|=1,r=oo(V,E),r.ref=o.ref,r.return=o,o.child=r}function E0(r,o,m,E,L){if(r!==null){var V=r.memoizedProps;if(O(V,E)&&r.ref===o.ref)if(ia=!1,o.pendingProps=E=V,rf(r,L))(r.flags&131072)!==0&&(ia=!0);else return o.lanes=r.lanes,Tc(r,o,L)}return C0(r,o,m,E,L)}function S0(r,o,m,E){var L=E.children,V=r!==null?r.memoizedState:null;if(r===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),E.mode==="hidden"){if((o.flags&128)!==0){if(V=V!==null?V.baseLanes|m:m,r!==null){for(E=o.child=r.child,L=0;E!==null;)L=L|E.lanes|E.childLanes,E=E.sibling;E=L&~V}else E=0,o.child=null;return Ug(r,o,V,m,E)}if((m&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&td(o,V!==null?V.cachePool:null),V!==null?Jd(o,V):ho(),mh(o);else return E=o.lanes=536870912,Ug(r,o,V!==null?V.baseLanes|m:m,m,E)}else V!==null?(td(o,V.cachePool),Jd(o,V),Es(),o.memoizedState=null):(r!==null&&td(o,null),ho(),Es());return ya(r,o,L,m),o.child}function Cc(r,o){return r!==null&&r.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Ug(r,o,m,E,L){var V=ed();return V=V===null?null:{parent:As._currentValue,pool:V},o.memoizedState={baseLanes:m,cachePool:V},r!==null&&td(o,null),ho(),mh(o),r!==null&&co(r,o,E,!0),o.childLanes=L,null}function Jc(r,o){return o=yp({mode:o.mode,children:o.children},r.mode),o.ref=r.ref,r.child=o,o.return=r,o}function tf(r,o,m){return Al(o,r.child,null,m),r=Jc(o,o.pendingProps),r.flags|=2,hs(o),o.memoizedState=null,r}function fp(r,o,m){var E=o.pendingProps,L=(o.flags&128)!==0;if(o.flags&=-129,r===null){if(ir){if(E.mode==="hidden")return r=Jc(o,E),o.lanes=536870912,Cc(null,r);if(Iu(o),(r=Fr)?(r=Vu(r,lo),r=r!==null&&r.data==="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:fl!==null?{id:pl,overflow:Va}:null,retryLane:536870912,hydrationErrors:null},m=$h(r),m.return=o,o.child=m,ea=o,Fr=null)):r=null,r===null)throw Ga(o);return o.lanes=536870912,null}return Jc(o,E)}var V=r.memoizedState;if(V!==null){var ne=V.dehydrated;if(Iu(o),L)if(o.flags&256)o.flags&=-257,o=tf(r,o,m);else if(o.memoizedState!==null)o.child=r.child,o.flags|=128,o=null;else throw Error(C(558));else if(ia||co(r,o,m,!1),L=(m&r.childLanes)!==0,ia||L){if(E=os,E!==null&&(ne=ji(E,m),ne!==0&&ne!==V.retryLane))throw V.retryLane=ne,So(r,ne),Lo(E,r,ne),hp;bf(),o=tf(r,o,m)}else r=V.treeContext,Fr=el(ne.nextSibling),ea=o,ir=!0,Hl=null,lo=!1,r!==null&&Wd(o,r),o=Jc(o,E),o.flags|=4096;return o}return r=oo(r.child,{mode:E.mode,children:E.children}),r.ref=o.ref,o.child=r,r.return=o,r}function pp(r,o){var m=o.ref;if(m===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof m!="function"&&typeof m!="object")throw Error(C(284));(r===null||r.ref!==m)&&(o.flags|=4194816)}}function C0(r,o,m,E,L){return Wl(o),m=Mu(r,o,m,E,void 0,L),E=bh(),r!==null&&!ia?(Ac(r,o,L),Tc(r,o,L)):(ir&&E&&Gc(o),o.flags|=1,ya(r,o,m,L),o.child)}function Vg(r,o,m,E,L,V){return Wl(o),o.updateQueue=null,m=xh(o,E,m,L),ku(r),E=bh(),r!==null&&!ia?(Ac(r,o,V),Tc(r,o,V)):(ir&&E&&Gc(o),o.flags|=1,ya(r,o,m,V),o.child)}function Gg(r,o,m,E,L){if(Wl(o),o.stateNode===null){var V=Pi,ne=m.contextType;typeof ne=="object"&&ne!==null&&(V=Ns(ne)),V=new m(E,V),o.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,V.updater=ld,o.stateNode=V,V._reactInternals=o,V=o.stateNode,V.props=E,V.state=o.memoizedState,V.refs={},sd(o),ne=m.contextType,V.context=typeof ne=="object"&&ne!==null?Ns(ne):Pi,V.state=o.memoizedState,ne=m.getDerivedStateFromProps,typeof ne=="function"&&(od(o,m,ne,E),V.state=o.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(ne=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),ne!==V.state&&ld.enqueueReplaceState(V,V.state,null),wc(o,E,V,L),$l(),V.state=o.memoizedState),typeof V.componentDidMount=="function"&&(o.flags|=4194308),E=!0}else if(r===null){V=o.stateNode;var Ae=o.memoizedProps,lt=Sc(m,Ae);V.props=lt;var Vt=V.context,rn=m.contextType;ne=Pi,typeof rn=="object"&&rn!==null&&(ne=Ns(rn));var pn=m.getDerivedStateFromProps;rn=typeof pn=="function"||typeof V.getSnapshotBeforeUpdate=="function",Ae=o.pendingProps!==Ae,rn||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(Ae||Vt!==ne)&&cp(o,V,E,ne),El=!1;var Gt=o.memoizedState;V.state=Gt,wc(o,E,V,L),$l(),Vt=o.memoizedState,Ae||Gt!==Vt||El?(typeof pn=="function"&&(od(o,m,pn,E),Vt=o.memoizedState),(lt=El||Ec(o,m,lt,E,Gt,Vt,ne))?(rn||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount()),typeof V.componentDidMount=="function"&&(o.flags|=4194308)):(typeof V.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=E,o.memoizedState=Vt),V.props=E,V.state=Vt,V.context=ne,E=lt):(typeof V.componentDidMount=="function"&&(o.flags|=4194308),E=!1)}else{V=o.stateNode,fh(r,o),ne=o.memoizedProps,rn=Sc(m,ne),V.props=rn,pn=o.pendingProps,Gt=V.context,Vt=m.contextType,lt=Pi,typeof Vt=="object"&&Vt!==null&&(lt=Ns(Vt)),Ae=m.getDerivedStateFromProps,(Vt=typeof Ae=="function"||typeof V.getSnapshotBeforeUpdate=="function")||typeof V.UNSAFE_componentWillReceiveProps!="function"&&typeof V.componentWillReceiveProps!="function"||(ne!==pn||Gt!==lt)&&cp(o,V,E,lt),El=!1,Gt=o.memoizedState,V.state=Gt,wc(o,E,V,L),$l();var $t=o.memoizedState;ne!==pn||Gt!==$t||El||r!==null&&r.dependencies!==null&&Eu(r.dependencies)?(typeof Ae=="function"&&(od(o,m,Ae,E),$t=o.memoizedState),(rn=El||Ec(o,m,rn,E,Gt,$t,lt)||r!==null&&r.dependencies!==null&&Eu(r.dependencies))?(Vt||typeof V.UNSAFE_componentWillUpdate!="function"&&typeof V.componentWillUpdate!="function"||(typeof V.componentWillUpdate=="function"&&V.componentWillUpdate(E,$t,lt),typeof V.UNSAFE_componentWillUpdate=="function"&&V.UNSAFE_componentWillUpdate(E,$t,lt)),typeof V.componentDidUpdate=="function"&&(o.flags|=4),typeof V.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof V.componentDidUpdate!="function"||ne===r.memoizedProps&&Gt===r.memoizedState||(o.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||ne===r.memoizedProps&&Gt===r.memoizedState||(o.flags|=1024),o.memoizedProps=E,o.memoizedState=$t),V.props=E,V.state=$t,V.context=lt,E=rn):(typeof V.componentDidUpdate!="function"||ne===r.memoizedProps&&Gt===r.memoizedState||(o.flags|=4),typeof V.getSnapshotBeforeUpdate!="function"||ne===r.memoizedProps&&Gt===r.memoizedState||(o.flags|=1024),E=!1)}return V=E,pp(r,o),E=(o.flags&128)!==0,V||E?(V=o.stateNode,m=E&&typeof m.getDerivedStateFromError!="function"?null:V.render(),o.flags|=1,r!==null&&E?(o.child=Al(o,r.child,null,L),o.child=Al(o,null,m,L)):ya(r,o,m,L),o.memoizedState=V.state,r=o.child):r=Tc(r,o,L),r}function Hg(r,o,m,E){return ml(),o.flags|=256,ya(r,o,m,E),o.child}var gp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function nf(r){return{baseLanes:r,cachePool:lp()}}function mp(r,o,m){return r=r!==null?r.childLanes&~m:0,o&&(r|=La),r}function T0(r,o,m){var E=o.pendingProps,L=!1,V=(o.flags&128)!==0,ne;if((ne=V)||(ne=r!==null&&r.memoizedState===null?!1:(gs.current&2)!==0),ne&&(L=!0,o.flags&=-129),ne=(o.flags&32)!==0,o.flags&=-33,r===null){if(ir){if(L?Mo(o):Es(),(r=Fr)?(r=Vu(r,lo),r=r!==null&&r.data!=="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:fl!==null?{id:pl,overflow:Va}:null,retryLane:536870912,hydrationErrors:null},m=$h(r),m.return=o,o.child=m,ea=o,Fr=null)):r=null,r===null)throw Ga(o);return Vs(r)?o.lanes=32:o.lanes=536870912,null}var Ae=E.children;return E=E.fallback,L?(Es(),L=o.mode,Ae=yp({mode:"hidden",children:Ae},L),E=mc(E,L,m,null),Ae.return=o,E.return=o,Ae.sibling=E,o.child=Ae,E=o.child,E.memoizedState=nf(m),E.childLanes=mp(r,ne,m),o.memoizedState=gp,Cc(null,E)):(Mo(o),I0(o,Ae))}var lt=r.memoizedState;if(lt!==null&&(Ae=lt.dehydrated,Ae!==null)){if(V)o.flags&256?(Mo(o),o.flags&=-257,o=xp(r,o,m)):o.memoizedState!==null?(Es(),o.child=r.child,o.flags|=128,o=null):(Es(),Ae=E.fallback,L=o.mode,E=yp({mode:"visible",children:E.children},L),Ae=mc(Ae,L,m,null),Ae.flags|=2,E.return=o,Ae.return=o,E.sibling=Ae,o.child=E,Al(o,r.child,null,m),E=o.child,E.memoizedState=nf(m),E.childLanes=mp(r,ne,m),o.memoizedState=gp,o=Cc(null,E));else if(Mo(o),Vs(Ae)){if(ne=Ae.nextSibling&&Ae.nextSibling.dataset,ne)var Vt=ne.dgst;ne=Vt,E=Error(C(419)),E.stack="",E.digest=ne,ql({value:E,source:null,stack:null}),o=xp(r,o,m)}else if(ia||co(r,o,m,!1),ne=(m&r.childLanes)!==0,ia||ne){if(ne=os,ne!==null&&(E=ji(ne,m),E!==0&&E!==lt.retryLane))throw lt.retryLane=E,So(r,E),Lo(ne,r,E),hp;Ya(Ae)||bf(),o=xp(r,o,m)}else Ya(Ae)?(o.flags|=192,o.child=r.child,o=null):(r=lt.treeContext,Fr=el(Ae.nextSibling),ea=o,ir=!0,Hl=null,lo=!1,r!==null&&Wd(o,r),o=I0(o,E.children),o.flags|=4096);return o}return L?(Es(),Ae=E.fallback,L=o.mode,lt=r.child,Vt=lt.sibling,E=oo(lt,{mode:"hidden",children:E.children}),E.subtreeFlags=lt.subtreeFlags&65011712,Vt!==null?Ae=oo(Vt,Ae):(Ae=mc(Ae,L,m,null),Ae.flags|=2),Ae.return=o,E.return=o,E.sibling=Ae,o.child=E,Cc(null,E),E=o.child,Ae=r.child.memoizedState,Ae===null?Ae=nf(m):(L=Ae.cachePool,L!==null?(lt=As._currentValue,L=L.parent!==lt?{parent:lt,pool:lt}:L):L=lp(),Ae={baseLanes:Ae.baseLanes|m,cachePool:L}),E.memoizedState=Ae,E.childLanes=mp(r,ne,m),o.memoizedState=gp,Cc(r.child,E)):(Mo(o),m=r.child,r=m.sibling,m=oo(m,{mode:"visible",children:E.children}),m.return=o,m.sibling=null,r!==null&&(ne=o.deletions,ne===null?(o.deletions=[r],o.flags|=16):ne.push(r)),o.child=m,o.memoizedState=null,m)}function I0(r,o){return o=yp({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function yp(r,o){return r=ao(22,r,null,o),r.lanes=0,r}function xp(r,o,m){return Al(o,r.child,null,m),r=I0(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function M0(r,o,m){r.lanes|=o;var E=r.alternate;E!==null&&(E.lanes|=o),Kh(r.return,o,m)}function k0(r,o,m,E,L,V){var ne=r.memoizedState;ne===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:E,tail:m,tailMode:L,treeForkCount:V}:(ne.isBackwards=o,ne.rendering=null,ne.renderingStartTime=0,ne.last=E,ne.tail=m,ne.tailMode=L,ne.treeForkCount=V)}function _p(r,o,m){var E=o.pendingProps,L=E.revealOrder,V=E.tail;E=E.children;var ne=gs.current,Ae=(ne&2)!==0;if(Ae?(ne=ne&1|2,o.flags|=128):ne&=1,kt(gs,ne),ya(r,o,E,m),E=ir?bc:0,!Ae&&r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&M0(r,m,o);else if(r.tag===19)M0(r,m,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(L){case"forwards":for(m=o.child,L=null;m!==null;)r=m.alternate,r!==null&&yh(r)===null&&(L=m),m=m.sibling;m=L,m===null?(L=o.child,o.child=null):(L=m.sibling,m.sibling=null),k0(o,!1,L,m,V,E);break;case"backwards":case"unstable_legacy-backwards":for(m=null,L=o.child,o.child=null;L!==null;){if(r=L.alternate,r!==null&&yh(r)===null){o.child=L;break}r=L.sibling,L.sibling=m,m=L,L=r}k0(o,!0,m,null,V,E);break;case"together":k0(o,!1,null,null,void 0,E);break;default:o.memoizedState=null}return o.child}function Tc(r,o,m){if(r!==null&&(o.dependencies=r.dependencies),su|=o.lanes,(m&o.childLanes)===0)if(r!==null){if(co(r,o,m,!1),(m&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(C(153));if(o.child!==null){for(r=o.child,m=oo(r,r.pendingProps),o.child=m,m.return=o;r.sibling!==null;)r=r.sibling,m=m.sibling=oo(r,r.pendingProps),m.return=o;m.sibling=null}return o.child}function rf(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&Eu(r)))}function sf(r,o,m){switch(o.tag){case 3:un(o,o.stateNode.containerInfo),Xl(o,As,r.memoizedState.cache),ml();break;case 27:case 5:kn(o);break;case 4:un(o,o.stateNode.containerInfo);break;case 10:Xl(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Iu(o),null;break;case 13:var E=o.memoizedState;if(E!==null)return E.dehydrated!==null?(Mo(o),o.flags|=128,null):(m&o.child.childLanes)!==0?T0(r,o,m):(Mo(o),r=Tc(r,o,m),r!==null?r.sibling:null);Mo(o);break;case 19:var L=(r.flags&128)!==0;if(E=(m&o.childLanes)!==0,E||(co(r,o,m,!1),E=(m&o.childLanes)!==0),L){if(E)return _p(r,o,m);o.flags|=128}if(L=o.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),kt(gs,gs.current),E)break;return null;case 22:return o.lanes=0,S0(r,o,m,o.pendingProps);case 24:Xl(o,As,r.memoizedState.cache)}return Tc(r,o,m)}function Wa(r,o,m){if(r!==null)if(r.memoizedProps!==o.pendingProps)ia=!0;else{if(!rf(r,m)&&(o.flags&128)===0)return ia=!1,sf(r,o,m);ia=(r.flags&131072)!==0}else ia=!1,ir&&(o.flags&1048576)!==0&&Xd(o,bc,o.index);switch(o.lanes=0,o.tag){case 16:e:{var E=o.pendingProps;if(r=To(o.elementType),o.type=r,typeof r=="function")Wh(r)?(E=Sc(r,E),o.tag=1,o=Gg(null,o,r,E,m)):(o.tag=0,o=C0(null,o,r,E,m));else{if(r!=null){var L=r.$$typeof;if(L===mt){o.tag=11,o=jg(null,o,r,E,m);break e}else if(L===rt){o.tag=14,o=dp(null,o,r,E,m);break e}}throw o=qt(r)||r,Error(C(306,o,""))}}return o;case 0:return C0(r,o,o.type,o.pendingProps,m);case 1:return E=o.type,L=Sc(E,o.pendingProps),Gg(r,o,E,L,m);case 3:e:{if(un(o,o.stateNode.containerInfo),r===null)throw Error(C(387));E=o.pendingProps;var V=o.memoizedState;L=V.element,fh(r,o),wc(o,E,null,m);var ne=o.memoizedState;if(E=ne.cache,Xl(o,As,E),E!==V.cache&&Qh(o,[As],m,!0),$l(),E=ne.element,V.isDehydrated)if(V={element:E,isDehydrated:!1,cache:ne.cache},o.updateQueue.baseState=V,o.memoizedState=V,o.flags&256){o=Hg(r,o,E,m);break e}else if(E!==L){L=za(Error(C(424)),o),ql(L),o=Hg(r,o,E,m);break e}else for(r=o.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Fr=el(r.firstChild),ea=o,ir=!0,Hl=null,lo=!0,m=Kd(o,null,E,m),o.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(ml(),E===L){o=Tc(r,o,m);break e}ya(r,o,E,m)}o=o.child}return o;case 26:return pp(r,o),r===null?(m=ug(o.type,null,o.pendingProps,null))?o.memoizedState=m:ir||(m=o.type,r=o.pendingProps,E=Cf(Bt.current).createElement(m),E[Ke]=o,E[je]=r,_a(E,m,r),Dn(E),o.stateNode=E):o.memoizedState=ug(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return kn(o),r===null&&ir&&(E=o.stateNode=Em(o.type,o.pendingProps,Bt.current),ea=o,lo=!0,L=Fr,Uu(o.type)?(yo=L,Fr=el(E.firstChild)):Fr=L),ya(r,o,o.pendingProps.children,m),pp(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&ir&&((L=E=Fr)&&(E=Sa(E,o.type,o.pendingProps,lo),E!==null?(o.stateNode=E,ea=o,Fr=el(E.firstChild),lo=!1,L=!0):L=!1),L||Ga(o)),kn(o),L=o.type,V=o.pendingProps,ne=r!==null?r.memoizedProps:null,E=V.children,Zp(L,V)?E=null:ne!==null&&Zp(L,ne)&&(o.flags|=32),o.memoizedState!==null&&(L=Mu(r,o,_h,null,null,m),Id._currentValue=L),pp(r,o),ya(r,o,E,m),o.child;case 6:return r===null&&ir&&((r=m=Fr)&&(m=ac(m,o.pendingProps,lo),m!==null?(o.stateNode=m,ea=o,Fr=null,r=!0):r=!1),r||Ga(o)),null;case 13:return T0(r,o,m);case 4:return un(o,o.stateNode.containerInfo),E=o.pendingProps,r===null?o.child=Al(o,null,E,m):ya(r,o,E,m),o.child;case 11:return jg(r,o,o.type,o.pendingProps,m);case 7:return ya(r,o,o.pendingProps,m),o.child;case 8:return ya(r,o,o.pendingProps.children,m),o.child;case 12:return ya(r,o,o.pendingProps.children,m),o.child;case 10:return E=o.pendingProps,Xl(o,o.type,E.value),ya(r,o,E.children,m),o.child;case 9:return L=o.type._context,E=o.pendingProps.children,Wl(o),L=Ns(L),E=E(L),o.flags|=1,ya(r,o,E,m),o.child;case 14:return dp(r,o,o.type,o.pendingProps,m);case 15:return E0(r,o,o.type,o.pendingProps,m);case 19:return _p(r,o,m);case 31:return fp(r,o,m);case 22:return S0(r,o,m,o.pendingProps);case 24:return Wl(o),E=Ns(As),r===null?(L=ed(),L===null&&(L=os,V=bl(),L.pooledCache=V,V.refCount++,V!==null&&(L.pooledCacheLanes|=m),L=V),o.memoizedState={parent:E,cache:L},sd(o),Xl(o,As,L)):((r.lanes&m)!==0&&(fh(r,o),wc(o,null,null,m),$l()),L=r.memoizedState,V=o.memoizedState,L.parent!==E?(L={parent:E,cache:E},o.memoizedState=L,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=L),Xl(o,As,E)):(E=V.cache,Xl(o,As,E),E!==L.cache&&Qh(o,[As],m,!0))),ya(r,o,o.pendingProps.children,m),o.child;case 29:throw o.pendingProps}throw Error(C(156,o.tag))}function Ic(r){r.flags|=4}function af(r,o,m,E,L){if((o=(r.mode&32)!==0)&&(o=!1),o){if(r.flags|=16777216,(L&335544128)===L)if(r.stateNode.complete)r.flags|=8192;else if(V0())r.flags|=8192;else throw qo=On,vc}else r.flags&=-16777217}function qg(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!kf(o))if(V0())r.flags|=8192;else throw qo=On,vc}function of(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?pi():536870912,r.lanes|=o,Ih|=o)}function lf(r,o){if(!ir)switch(r.tailMode){case"hidden":o=r.tail;for(var m=null;o!==null;)o.alternate!==null&&(m=o),o=o.sibling;m===null?r.tail=null:m.sibling=null;break;case"collapsed":m=r.tail;for(var E=null;m!==null;)m.alternate!==null&&(E=m),m=m.sibling;E===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:E.sibling=null}}function xs(r){var o=r.alternate!==null&&r.alternate.child===r.child,m=0,E=0;if(o)for(var L=r.child;L!==null;)m|=L.lanes|L.childLanes,E|=L.subtreeFlags&65011712,E|=L.flags&65011712,L.return=r,L=L.sibling;else for(L=r.child;L!==null;)m|=L.lanes|L.childLanes,E|=L.subtreeFlags,E|=L.flags,L.return=r,L=L.sibling;return r.subtreeFlags|=E,r.childLanes=m,o}function Zg(r,o,m){var E=o.pendingProps;switch(Au(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xs(o),null;case 1:return xs(o),null;case 3:return m=o.stateNode,E=null,r!==null&&(E=r.memoizedState.cache),o.memoizedState.cache!==E&&(o.flags|=2048),_l(As),nn(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(r===null||r.child===null)&&(gl(o)?Ic(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,yl())),xs(o),null;case 26:var L=o.type,V=o.memoizedState;return r===null?(Ic(o),V!==null?(xs(o),qg(o,V)):(xs(o),af(o,L,null,E,m))):V?V!==r.memoizedState?(Ic(o),xs(o),qg(o,V)):(xs(o),o.flags&=-16777217):(r=r.memoizedProps,r!==E&&Ic(o),xs(o),af(o,L,r,E,m)),null;case 27:if(Nn(o),m=Bt.current,L=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==E&&Ic(o);else{if(!E){if(o.stateNode===null)throw Error(C(166));return xs(o),null}r=bt.current,gl(o)?Ha(o):(r=Em(L,E,m),o.stateNode=r,Ic(o))}return xs(o),null;case 5:if(Nn(o),L=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==E&&Ic(o);else{if(!E){if(o.stateNode===null)throw Error(C(166));return xs(o),null}if(V=bt.current,gl(o))Ha(o);else{var ne=Cf(Bt.current);switch(V){case 1:V=ne.createElementNS("http://www.w3.org/2000/svg",L);break;case 2:V=ne.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;default:switch(L){case"svg":V=ne.createElementNS("http://www.w3.org/2000/svg",L);break;case"math":V=ne.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;case"script":V=ne.createElement("div"),V.innerHTML="<script><\/script>",V=V.removeChild(V.firstChild);break;case"select":V=typeof E.is=="string"?ne.createElement("select",{is:E.is}):ne.createElement("select"),E.multiple?V.multiple=!0:E.size&&(V.size=E.size);break;default:V=typeof E.is=="string"?ne.createElement(L,{is:E.is}):ne.createElement(L)}}V[Ke]=o,V[je]=E;e:for(ne=o.child;ne!==null;){if(ne.tag===5||ne.tag===6)V.appendChild(ne.stateNode);else if(ne.tag!==4&&ne.tag!==27&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===o)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===o)break e;ne=ne.return}ne.sibling.return=ne.return,ne=ne.sibling}o.stateNode=V;e:switch(_a(V,L,E),L){case"button":case"input":case"select":case"textarea":E=!!E.autoFocus;break e;case"img":E=!0;break e;default:E=!1}E&&Ic(o)}}return xs(o),af(o,o.type,r===null?null:r.memoizedProps,o.pendingProps,m),null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==E&&Ic(o);else{if(typeof E!="string"&&o.stateNode===null)throw Error(C(166));if(r=Bt.current,gl(o)){if(r=o.stateNode,m=o.memoizedProps,E=null,L=ea,L!==null)switch(L.tag){case 27:case 5:E=L.memoizedProps}r[Ke]=o,r=!!(r.nodeValue===m||E!==null&&E.suppressHydrationWarning===!0||eg(r.nodeValue,m)),r||Ga(o,!0)}else r=Cf(r).createTextNode(E),r[Ke]=o,o.stateNode=r}return xs(o),null;case 31:if(m=o.memoizedState,r===null||r.memoizedState!==null){if(E=gl(o),m!==null){if(r===null){if(!E)throw Error(C(318));if(r=o.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(C(557));r[Ke]=o}else ml(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;xs(o),r=!1}else m=yl(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=m),r=!0;if(!r)return o.flags&256?(hs(o),o):(hs(o),null);if((o.flags&128)!==0)throw Error(C(558))}return xs(o),null;case 13:if(E=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(L=gl(o),E!==null&&E.dehydrated!==null){if(r===null){if(!L)throw Error(C(318));if(L=o.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(C(317));L[Ke]=o}else ml(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;xs(o),L=!1}else L=yl(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=L),L=!0;if(!L)return o.flags&256?(hs(o),o):(hs(o),null)}return hs(o),(o.flags&128)!==0?(o.lanes=m,o):(m=E!==null,r=r!==null&&r.memoizedState!==null,m&&(E=o.child,L=null,E.alternate!==null&&E.alternate.memoizedState!==null&&E.alternate.memoizedState.cachePool!==null&&(L=E.alternate.memoizedState.cachePool.pool),V=null,E.memoizedState!==null&&E.memoizedState.cachePool!==null&&(V=E.memoizedState.cachePool.pool),V!==L&&(E.flags|=2048)),m!==r&&m&&(o.child.flags|=8192),of(o,o.updateQueue),xs(o),null);case 4:return nn(),r===null&&Q0(o.stateNode.containerInfo),xs(o),null;case 10:return _l(o.type),xs(o),null;case 19:if(ct(gs),E=o.memoizedState,E===null)return xs(o),null;if(L=(o.flags&128)!==0,V=E.rendering,V===null)if(L)lf(E,!1);else{if(Rs!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(V=yh(r),V!==null){for(o.flags|=128,lf(E,!1),r=V.updateQueue,o.updateQueue=r,of(o,r),o.subtreeFlags=0,r=m,m=o.child;m!==null;)ap(m,r),m=m.sibling;return kt(gs,gs.current&1|2),ir&&Gl(o,E.treeForkCount),o.child}r=r.sibling}E.tail!==null&&Di()>yf&&(o.flags|=128,L=!0,lf(E,!1),o.lanes=4194304)}else{if(!L)if(r=yh(V),r!==null){if(o.flags|=128,L=!0,r=r.updateQueue,o.updateQueue=r,of(o,r),lf(E,!0),E.tail===null&&E.tailMode==="hidden"&&!V.alternate&&!ir)return xs(o),null}else 2*Di()-E.renderingStartTime>yf&&m!==536870912&&(o.flags|=128,L=!0,lf(E,!1),o.lanes=4194304);E.isBackwards?(V.sibling=o.child,o.child=V):(r=E.last,r!==null?r.sibling=V:o.child=V,E.last=V)}return E.tail!==null?(r=E.tail,E.rendering=r,E.tail=r.sibling,E.renderingStartTime=Di(),r.sibling=null,m=gs.current,kt(gs,L?m&1|2:m&1),ir&&Gl(o,E.treeForkCount),r):(xs(o),null);case 22:case 23:return hs(o),Xc(),E=o.memoizedState!==null,r!==null?r.memoizedState!==null!==E&&(o.flags|=8192):E&&(o.flags|=8192),E?(m&536870912)!==0&&(o.flags&128)===0&&(xs(o),o.subtreeFlags&6&&(o.flags|=8192)):xs(o),m=o.updateQueue,m!==null&&of(o,m.retryQueue),m=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),E=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(E=o.memoizedState.cachePool.pool),E!==m&&(o.flags|=2048),r!==null&&ct(Go),null;case 24:return m=null,r!==null&&(m=r.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),_l(As),xs(o),null;case 25:return null;case 30:return null}throw Error(C(156,o.tag))}function R1(r,o){switch(Au(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return _l(As),nn(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return Nn(o),null;case 31:if(o.memoizedState!==null){if(hs(o),o.alternate===null)throw Error(C(340));ml()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 13:if(hs(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(C(340));ml()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return ct(gs),null;case 4:return nn(),null;case 10:return _l(o.type),null;case 22:case 23:return hs(o),Xc(),r!==null&&ct(Go),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return _l(As),null;case 25:return null;default:return null}}function bp(r,o){switch(Au(o),o.tag){case 3:_l(As),nn();break;case 26:case 27:case 5:Nn(o);break;case 4:nn();break;case 31:o.memoizedState!==null&&hs(o);break;case 13:hs(o);break;case 19:ct(gs);break;case 10:_l(o.type);break;case 22:case 23:hs(o),Xc(),r!==null&&ct(Go);break;case 24:_l(As)}}function hd(r,o){try{var m=o.updateQueue,E=m!==null?m.lastEffect:null;if(E!==null){var L=E.next;m=L;do{if((m.tag&r)===r){E=void 0;var V=m.create,ne=m.inst;E=V(),ne.destroy=E}m=m.next}while(m!==L)}}catch(Ae){Gr(o,o.return,Ae)}}function eu(r,o,m){try{var E=o.updateQueue,L=E!==null?E.lastEffect:null;if(L!==null){var V=L.next;E=V;do{if((E.tag&r)===r){var ne=E.inst,Ae=ne.destroy;if(Ae!==void 0){ne.destroy=void 0,L=o;var lt=m,Vt=Ae;try{Vt()}catch(rn){Gr(L,lt,rn)}}}E=E.next}while(E!==V)}}catch(rn){Gr(o,o.return,rn)}}function Xg(r){var o=r.updateQueue;if(o!==null){var m=r.stateNode;try{ad(o,m)}catch(E){Gr(r,r.return,E)}}}function Wg(r,o,m){m.props=Sc(r.type,r.memoizedProps),m.state=r.memoizedState;try{m.componentWillUnmount()}catch(E){Gr(r,o,E)}}function cf(r,o){try{var m=r.ref;if(m!==null){switch(r.tag){case 26:case 27:case 5:var E=r.stateNode;break;case 30:E=r.stateNode;break;default:E=r.stateNode}typeof m=="function"?r.refCleanup=m(E):m.current=E}}catch(L){Gr(r,o,L)}}function Qo(r,o){var m=r.ref,E=r.refCleanup;if(m!==null)if(typeof E=="function")try{E()}catch(L){Gr(r,o,L)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof m=="function")try{m(null)}catch(L){Gr(r,o,L)}else m.current=null}function vp(r){var o=r.type,m=r.memoizedProps,E=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":m.autoFocus&&E.focus();break e;case"img":m.src?E.src=m.src:m.srcSet&&(E.srcset=m.srcSet)}}catch(L){Gr(r,r.return,L)}}function wp(r,o,m){try{var E=r.stateNode;wm(E,r.type,m,o),E[je]=o}catch(L){Gr(r,r.return,L)}}function Ru(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Uu(r.type)||r.tag===4}function Eh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Ru(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Uu(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function N0(r,o,m){var E=r.tag;if(E===5||E===6)r=r.stateNode,o?(m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m).insertBefore(r,o):(o=m.nodeType===9?m.body:m.nodeName==="HTML"?m.ownerDocument.body:m,o.appendChild(r),m=m._reactRootContainer,m!=null||o.onclick!==null||(o.onclick=Hs));else if(E!==4&&(E===27&&Uu(r.type)&&(m=r.stateNode,o=null),r=r.child,r!==null))for(N0(r,o,m),r=r.sibling;r!==null;)N0(r,o,m),r=r.sibling}function Ap(r,o,m){var E=r.tag;if(E===5||E===6)r=r.stateNode,o?m.insertBefore(r,o):m.appendChild(r);else if(E!==4&&(E===27&&Uu(r.type)&&(m=r.stateNode),r=r.child,r!==null))for(Ap(r,o,m),r=r.sibling;r!==null;)Ap(r,o,m),r=r.sibling}function Yg(r){var o=r.stateNode,m=r.memoizedProps;try{for(var E=r.type,L=o.attributes;L.length;)o.removeAttributeNode(L[0]);_a(o,E,m),o[Ke]=r,o[je]=m}catch(V){Gr(r,r.return,V)}}var tu=!1,ra=!1,D0=!1,$g=typeof WeakSet=="function"?WeakSet:Set,sa=null;function P1(r,o){if(r=r.containerInfo,Sf=Of,r=ue(r),xe(r)){if("selectionStart"in r)var m={start:r.selectionStart,end:r.selectionEnd};else e:{m=(m=r.ownerDocument)&&m.defaultView||window;var E=m.getSelection&&m.getSelection();if(E&&E.rangeCount!==0){m=E.anchorNode;var L=E.anchorOffset,V=E.focusNode;E=E.focusOffset;try{m.nodeType,V.nodeType}catch{m=null;break e}var ne=0,Ae=-1,lt=-1,Vt=0,rn=0,pn=r,Gt=null;t:for(;;){for(var $t;pn!==m||L!==0&&pn.nodeType!==3||(Ae=ne+L),pn!==V||E!==0&&pn.nodeType!==3||(lt=ne+E),pn.nodeType===3&&(ne+=pn.nodeValue.length),($t=pn.firstChild)!==null;)Gt=pn,pn=$t;for(;;){if(pn===r)break t;if(Gt===m&&++Vt===L&&(Ae=ne),Gt===V&&++rn===E&&(lt=ne),($t=pn.nextSibling)!==null)break;pn=Gt,Gt=pn.parentNode}pn=$t}m=Ae===-1||lt===-1?null:{start:Ae,end:lt}}else m=null}m=m||{start:0,end:0}}else m=null;for(tg={focusedElem:r,selectionRange:m},Of=!1,sa=o;sa!==null;)if(o=sa,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,sa=r;else for(;sa!==null;){switch(o=sa,V=o.alternate,r=o.flags,o.tag){case 0:if((r&4)!==0&&(r=o.updateQueue,r=r!==null?r.events:null,r!==null))for(m=0;m<r.length;m++)L=r[m],L.ref.impl=L.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&V!==null){r=void 0,m=o,L=V.memoizedProps,V=V.memoizedState,E=m.stateNode;try{var ci=Sc(m.type,L);r=E.getSnapshotBeforeUpdate(ci,V),E.__reactInternalSnapshotBeforeUpdate=r}catch(Ii){Gr(m,m.return,Ii)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,m=r.nodeType,m===9)sc(r);else if(m===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":sc(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(C(163))}if(r=o.sibling,r!==null){r.return=o.return,sa=r;break}sa=o.return}}function R0(r,o,m){var E=m.flags;switch(m.tag){case 0:case 11:case 15:Po(r,m),E&4&&hd(5,m);break;case 1:if(Po(r,m),E&4)if(r=m.stateNode,o===null)try{r.componentDidMount()}catch(ne){Gr(m,m.return,ne)}else{var L=Sc(m.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(L,o,r.__reactInternalSnapshotBeforeUpdate)}catch(ne){Gr(m,m.return,ne)}}E&64&&Xg(m),E&512&&cf(m,m.return);break;case 3:if(Po(r,m),E&64&&(r=m.updateQueue,r!==null)){if(o=null,m.child!==null)switch(m.child.tag){case 27:case 5:o=m.child.stateNode;break;case 1:o=m.child.stateNode}try{ad(r,o)}catch(ne){Gr(m,m.return,ne)}}break;case 27:o===null&&E&4&&Yg(m);case 26:case 5:Po(r,m),o===null&&E&4&&vp(m),E&512&&cf(m,m.return);break;case 12:Po(r,m);break;case 31:Po(r,m),E&4&&uf(r,m);break;case 13:Po(r,m),E&4&&hf(r,m),E&64&&(r=m.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(m=H0.bind(null,m),oa(r,m))));break;case 22:if(E=m.memoizedState!==null||tu,!E){o=o!==null&&o.memoizedState!==null||ra,L=tu;var V=ra;tu=E,(ra=o)&&!V?nu(r,m,(m.subtreeFlags&8772)!==0):Po(r,m),tu=L,ra=V}break;case 30:break;default:Po(r,m)}}function dd(r){var o=r.alternate;o!==null&&(r.alternate=null,dd(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&ri(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Ss=null,gr=!1;function Ro(r,o,m){for(m=m.child;m!==null;)P0(r,o,m),m=m.sibling}function P0(r,o,m){if(de&&typeof de.onCommitFiberUnmount=="function")try{de.onCommitFiberUnmount(it,m)}catch{}switch(m.tag){case 26:ra||Qo(m,o),Ro(r,o,m),m.memoizedState?m.memoizedState.count--:m.stateNode&&(m=m.stateNode,m.parentNode.removeChild(m));break;case 27:ra||Qo(m,o);var E=Ss,L=gr;Uu(m.type)&&(Ss=m.stateNode,gr=!1),Ro(r,o,m),Sd(m.stateNode),Ss=E,gr=L;break;case 5:ra||Qo(m,o);case 6:if(E=Ss,L=gr,Ss=null,Ro(r,o,m),Ss=E,gr=L,Ss!==null)if(gr)try{(Ss.nodeType===9?Ss.body:Ss.nodeName==="HTML"?Ss.ownerDocument.body:Ss).removeChild(m.stateNode)}catch(V){Gr(m,o,V)}else try{Ss.removeChild(m.stateNode)}catch(V){Gr(m,o,V)}break;case 18:Ss!==null&&(gr?(r=Ss,Am(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,m.stateNode),Xu(r)):Am(Ss,m.stateNode));break;case 4:E=Ss,L=gr,Ss=m.stateNode.containerInfo,gr=!0,Ro(r,o,m),Ss=E,gr=L;break;case 0:case 11:case 14:case 15:eu(2,m,o),ra||eu(4,m,o),Ro(r,o,m);break;case 1:ra||(Qo(m,o),E=m.stateNode,typeof E.componentWillUnmount=="function"&&Wg(m,o,E)),Ro(r,o,m);break;case 21:Ro(r,o,m);break;case 22:ra=(E=ra)||m.memoizedState!==null,Ro(r,o,m),ra=E;break;default:Ro(r,o,m)}}function uf(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Xu(r)}catch(m){Gr(o,o.return,m)}}}function hf(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Xu(r)}catch(m){Gr(o,o.return,m)}}function df(r){switch(r.tag){case 31:case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new $g),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new $g),o;default:throw Error(C(435,r.tag))}}function ff(r,o){var m=df(r);o.forEach(function(E){if(!m.has(E)){m.add(E);var L=L1.bind(null,r,E);E.then(L,L)}})}function po(r,o){var m=o.deletions;if(m!==null)for(var E=0;E<m.length;E++){var L=m[E],V=r,ne=o,Ae=ne;e:for(;Ae!==null;){switch(Ae.tag){case 27:if(Uu(Ae.type)){Ss=Ae.stateNode,gr=!1;break e}break;case 5:Ss=Ae.stateNode,gr=!1;break e;case 3:case 4:Ss=Ae.stateNode.containerInfo,gr=!0;break e}Ae=Ae.return}if(Ss===null)throw Error(C(160));P0(V,ne,L),Ss=null,gr=!1,V=L.alternate,V!==null&&(V.return=null),L.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Ep(o,r),o=o.sibling}var go=null;function Ep(r,o){var m=r.alternate,E=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:po(o,r),xa(r),E&4&&(eu(3,r,r.return),hd(3,r),eu(5,r,r.return));break;case 1:po(o,r),xa(r),E&512&&(ra||m===null||Qo(m,m.return)),E&64&&tu&&(r=r.updateQueue,r!==null&&(E=r.callbacks,E!==null&&(m=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=m===null?E:m.concat(E))));break;case 26:var L=go;if(po(o,r),xa(r),E&512&&(ra||m===null||Qo(m,m.return)),E&4){var V=m!==null?m.memoizedState:null;if(E=r.memoizedState,m===null)if(E===null)if(r.stateNode===null){e:{E=r.type,m=r.memoizedProps,L=L.ownerDocument||L;t:switch(E){case"title":V=L.getElementsByTagName("title")[0],(!V||V[vn]||V[Ke]||V.namespaceURI==="http://www.w3.org/2000/svg"||V.hasAttribute("itemprop"))&&(V=L.createElement(E),L.head.insertBefore(V,L.querySelector("head > title"))),_a(V,E,m),V[Ke]=r,Dn(V),E=V;break e;case"link":var ne=pg("link","href",L).get(E+(m.href||""));if(ne){for(var Ae=0;Ae<ne.length;Ae++)if(V=ne[Ae],V.getAttribute("href")===(m.href==null||m.href===""?null:m.href)&&V.getAttribute("rel")===(m.rel==null?null:m.rel)&&V.getAttribute("title")===(m.title==null?null:m.title)&&V.getAttribute("crossorigin")===(m.crossOrigin==null?null:m.crossOrigin)){ne.splice(Ae,1);break t}}V=L.createElement(E),_a(V,E,m),L.head.appendChild(V);break;case"meta":if(ne=pg("meta","content",L).get(E+(m.content||""))){for(Ae=0;Ae<ne.length;Ae++)if(V=ne[Ae],V.getAttribute("content")===(m.content==null?null:""+m.content)&&V.getAttribute("name")===(m.name==null?null:m.name)&&V.getAttribute("property")===(m.property==null?null:m.property)&&V.getAttribute("http-equiv")===(m.httpEquiv==null?null:m.httpEquiv)&&V.getAttribute("charset")===(m.charSet==null?null:m.charSet)){ne.splice(Ae,1);break t}}V=L.createElement(E),_a(V,E,m),L.head.appendChild(V);break;default:throw Error(C(468,E))}V[Ke]=r,Dn(V),E=V}r.stateNode=E}else Mf(L,r.type,r.stateNode);else r.stateNode=fg(L,E,r.memoizedProps);else V!==E?(V===null?m.stateNode!==null&&(m=m.stateNode,m.parentNode.removeChild(m)):V.count--,E===null?Mf(L,r.type,r.stateNode):fg(L,E,r.memoizedProps)):E===null&&r.stateNode!==null&&wp(r,r.memoizedProps,m.memoizedProps)}break;case 27:po(o,r),xa(r),E&512&&(ra||m===null||Qo(m,m.return)),m!==null&&E&4&&wp(r,r.memoizedProps,m.memoizedProps);break;case 5:if(po(o,r),xa(r),E&512&&(ra||m===null||Qo(m,m.return)),r.flags&32){L=r.stateNode;try{Ma(L,"")}catch(ci){Gr(r,r.return,ci)}}E&4&&r.stateNode!=null&&(L=r.memoizedProps,wp(r,L,m!==null?m.memoizedProps:L)),E&1024&&(D0=!0);break;case 6:if(po(o,r),xa(r),E&4){if(r.stateNode===null)throw Error(C(162));E=r.memoizedProps,m=r.stateNode;try{m.nodeValue=E}catch(ci){Gr(r,r.return,ci)}}break;case 3:if(Qp=null,L=go,go=Yp(o.containerInfo),po(o,r),go=L,xa(r),E&4&&m!==null&&m.memoizedState.isDehydrated)try{Xu(o.containerInfo)}catch(ci){Gr(r,r.return,ci)}D0&&(D0=!1,pf(r));break;case 4:E=go,go=Yp(r.stateNode.containerInfo),po(o,r),xa(r),go=E;break;case 12:po(o,r),xa(r);break;case 31:po(o,r),xa(r),E&4&&(E=r.updateQueue,E!==null&&(r.updateQueue=null,ff(r,E)));break;case 13:po(o,r),xa(r),r.child.flags&8192&&r.memoizedState!==null!=(m!==null&&m.memoizedState!==null)&&(Tp=Di()),E&4&&(E=r.updateQueue,E!==null&&(r.updateQueue=null,ff(r,E)));break;case 22:L=r.memoizedState!==null;var lt=m!==null&&m.memoizedState!==null,Vt=tu,rn=ra;if(tu=Vt||L,ra=rn||lt,po(o,r),ra=rn,tu=Vt,xa(r),E&8192)e:for(o=r.stateNode,o._visibility=L?o._visibility&-2:o._visibility|1,L&&(m===null||lt||tu||ra||nc(r)),m=null,o=r;;){if(o.tag===5||o.tag===26){if(m===null){lt=m=o;try{if(V=lt.stateNode,L)ne=V.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{Ae=lt.stateNode;var pn=lt.memoizedProps.style,Gt=pn!=null&&pn.hasOwnProperty("display")?pn.display:null;Ae.style.display=Gt==null||typeof Gt=="boolean"?"":(""+Gt).trim()}}catch(ci){Gr(lt,lt.return,ci)}}}else if(o.tag===6){if(m===null){lt=o;try{lt.stateNode.nodeValue=L?"":lt.memoizedProps}catch(ci){Gr(lt,lt.return,ci)}}}else if(o.tag===18){if(m===null){lt=o;try{var $t=lt.stateNode;L?Wi($t,!0):Wi(lt.stateNode,!1)}catch(ci){Gr(lt,lt.return,ci)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;m===o&&(m=null),o=o.return}m===o&&(m=null),o.sibling.return=o.return,o=o.sibling}E&4&&(E=r.updateQueue,E!==null&&(m=E.retryQueue,m!==null&&(E.retryQueue=null,ff(r,m))));break;case 19:po(o,r),xa(r),E&4&&(E=r.updateQueue,E!==null&&(r.updateQueue=null,ff(r,E)));break;case 30:break;case 21:break;default:po(o,r),xa(r)}}function xa(r){var o=r.flags;if(o&2){try{for(var m,E=r.return;E!==null;){if(Ru(E)){m=E;break}E=E.return}if(m==null)throw Error(C(160));switch(m.tag){case 27:var L=m.stateNode,V=Eh(r);Ap(r,V,L);break;case 5:var ne=m.stateNode;m.flags&32&&(Ma(ne,""),m.flags&=-33);var Ae=Eh(r);Ap(r,Ae,ne);break;case 3:case 4:var lt=m.stateNode.containerInfo,Vt=Eh(r);N0(r,Vt,lt);break;default:throw Error(C(161))}}catch(rn){Gr(r,r.return,rn)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function pf(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;pf(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function Po(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)R0(r,o.alternate,o),o=o.sibling}function nc(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:eu(4,o,o.return),nc(o);break;case 1:Qo(o,o.return);var m=o.stateNode;typeof m.componentWillUnmount=="function"&&Wg(o,o.return,m),nc(o);break;case 27:Sd(o.stateNode);case 26:case 5:Qo(o,o.return),nc(o);break;case 22:o.memoizedState===null&&nc(o);break;case 30:nc(o);break;default:nc(o)}r=r.sibling}}function nu(r,o,m){for(m=m&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var E=o.alternate,L=r,V=o,ne=V.flags;switch(V.tag){case 0:case 11:case 15:nu(L,V,m),hd(4,V);break;case 1:if(nu(L,V,m),E=V,L=E.stateNode,typeof L.componentDidMount=="function")try{L.componentDidMount()}catch(Vt){Gr(E,E.return,Vt)}if(E=V,L=E.updateQueue,L!==null){var Ae=E.stateNode;try{var lt=L.shared.hiddenCallbacks;if(lt!==null)for(L.shared.hiddenCallbacks=null,L=0;L<lt.length;L++)ph(lt[L],Ae)}catch(Vt){Gr(E,E.return,Vt)}}m&&ne&64&&Xg(V),cf(V,V.return);break;case 27:Yg(V);case 26:case 5:nu(L,V,m),m&&E===null&&ne&4&&vp(V),cf(V,V.return);break;case 12:nu(L,V,m);break;case 31:nu(L,V,m),m&&ne&4&&uf(L,V);break;case 13:nu(L,V,m),m&&ne&4&&hf(L,V);break;case 22:V.memoizedState===null&&nu(L,V,m),cf(V,V.return);break;case 30:break;default:nu(L,V,m)}o=o.sibling}}function Sp(r,o){var m=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(m=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==m&&(r!=null&&r.refCount++,m!=null&&Su(m))}function iu(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Su(r))}function ic(r,o,m,E){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)O0(r,o,m,E),o=o.sibling}function O0(r,o,m,E){var L=o.flags;switch(o.tag){case 0:case 11:case 15:ic(r,o,m,E),L&2048&&hd(9,o);break;case 1:ic(r,o,m,E);break;case 3:ic(r,o,m,E),L&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Su(r)));break;case 12:if(L&2048){ic(r,o,m,E),r=o.stateNode;try{var V=o.memoizedProps,ne=V.id,Ae=V.onPostCommit;typeof Ae=="function"&&Ae(ne,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(lt){Gr(o,o.return,lt)}}else ic(r,o,m,E);break;case 31:ic(r,o,m,E);break;case 13:ic(r,o,m,E);break;case 23:break;case 22:V=o.stateNode,ne=o.alternate,o.memoizedState!==null?V._visibility&2?ic(r,o,m,E):Sh(r,o):V._visibility&2?ic(r,o,m,E):(V._visibility|=2,Mc(r,o,m,E,(o.subtreeFlags&10256)!==0||!1)),L&2048&&Sp(ne,o);break;case 24:ic(r,o,m,E),L&2048&&iu(o.alternate,o);break;default:ic(r,o,m,E)}}function Mc(r,o,m,E,L){for(L=L&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var V=r,ne=o,Ae=m,lt=E,Vt=ne.flags;switch(ne.tag){case 0:case 11:case 15:Mc(V,ne,Ae,lt,L),hd(8,ne);break;case 23:break;case 22:var rn=ne.stateNode;ne.memoizedState!==null?rn._visibility&2?Mc(V,ne,Ae,lt,L):Sh(V,ne):(rn._visibility|=2,Mc(V,ne,Ae,lt,L)),L&&Vt&2048&&Sp(ne.alternate,ne);break;case 24:Mc(V,ne,Ae,lt,L),L&&Vt&2048&&iu(ne.alternate,ne);break;default:Mc(V,ne,Ae,lt,L)}o=o.sibling}}function Sh(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var m=r,E=o,L=E.flags;switch(E.tag){case 22:Sh(m,E),L&2048&&Sp(E.alternate,E);break;case 24:Sh(m,E),L&2048&&iu(E.alternate,E);break;default:Sh(m,E)}o=o.sibling}}var fd=8192;function Ch(r,o,m){if(r.subtreeFlags&fd)for(r=r.child;r!==null;)Kg(r,o,m),r=r.sibling}function Kg(r,o,m){switch(r.tag){case 26:Ch(r,o,m),r.flags&fd&&r.memoizedState!==null&&gg(m,go,r.memoizedState,r.memoizedProps);break;case 5:Ch(r,o,m);break;case 3:case 4:var E=go;go=Yp(r.stateNode.containerInfo),Ch(r,o,m),go=E;break;case 22:r.memoizedState===null&&(E=r.alternate,E!==null&&E.memoizedState!==null?(E=fd,fd=16777216,Ch(r,o,m),fd=E):Ch(r,o,m));break;default:Ch(r,o,m)}}function Qg(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function gf(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var m=0;m<o.length;m++){var E=o[m];sa=E,pd(E,r)}Qg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Jg(r),r=r.sibling}function Jg(r){switch(r.tag){case 0:case 11:case 15:gf(r),r.flags&2048&&eu(9,r,r.return);break;case 3:gf(r);break;case 12:gf(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,Cp(r)):gf(r);break;default:gf(r)}}function Cp(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var m=0;m<o.length;m++){var E=o[m];sa=E,pd(E,r)}Qg(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:eu(8,o,o.return),Cp(o);break;case 22:m=o.stateNode,m._visibility&2&&(m._visibility&=-3,Cp(o));break;default:Cp(o)}r=r.sibling}}function pd(r,o){for(;sa!==null;){var m=sa;switch(m.tag){case 0:case 11:case 15:eu(8,m,o);break;case 23:case 22:if(m.memoizedState!==null&&m.memoizedState.cachePool!==null){var E=m.memoizedState.cachePool.pool;E!=null&&E.refCount++}break;case 24:Su(m.memoizedState.cache)}if(E=m.child,E!==null)E.return=m,sa=E;else e:for(m=r;sa!==null;){E=sa;var L=E.sibling,V=E.return;if(dd(E),E===m){sa=null;break e}if(L!==null){L.return=V,sa=L;break e}sa=V}}}var O1={getCacheForType:function(r){var o=Ns(As),m=o.data.get(r);return m===void 0&&(m=r(),o.data.set(r,m)),m},cacheSignal:function(){return Ns(As).controller.signal}},em=typeof WeakMap=="function"?WeakMap:Map,Vr=0,os=null,dr=null,fr=0,Zr=0,mo=null,Ml=!1,Pu=!1,z0=!1,ru=0,Rs=0,su=0,Th=0,L0=0,La=0,Ih=0,mf=null,Oo=null,B0=!1,Tp=0,tm=0,yf=1/0,gd=null,au=null,aa=0,ou=null,md=null,kl=0,F0=0,Ip=null,nm=null,xf=0,j0=null;function zo(){return(Vr&2)!==0&&fr!==0?fr&-fr:Te.T!==null?Y0():gi()}function im(){if(La===0)if((fr&536870912)===0||ir){var r=yn;yn<<=1,(yn&3932160)===0&&(yn=262144),La=r}else La=536870912;return r=Bn.current,r!==null&&(r.flags|=32),La}function Lo(r,o,m){(r===os&&(Zr===2||Zr===9)||r.cancelPendingCommit!==null)&&(xd(r,0),Ou(r,fr,La,!1)),Ti(r,m),((Vr&2)===0||r!==os)&&(r===os&&((Vr&2)===0&&(Th|=m),Rs===4&&Ou(r,fr,La,!1)),rc(r))}function Ks(r,o,m){if((Vr&6)!==0)throw Error(C(327));var E=!m&&(o&127)===0&&(o&r.expiredLanes)===0||Fn(r,o),L=E?_d(r,o):Np(r,o,!0),V=E;do{if(L===0){Pu&&!E&&Ou(r,o,0,!1);break}else{if(m=r.current.alternate,V&&!z1(m)){L=Np(r,o,!1),V=!1;continue}if(L===2){if(V=o,r.errorRecoveryDisabledLanes&V)var ne=0;else ne=r.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){o=ne;e:{var Ae=r;L=mf;var lt=Ae.current.memoizedState.isDehydrated;if(lt&&(xd(Ae,ne).flags|=256),ne=Np(Ae,ne,!1),ne!==2){if(z0&&!lt){Ae.errorRecoveryDisabledLanes|=V,Th|=V,L=4;break e}V=Oo,Oo=L,V!==null&&(Oo===null?Oo=V:Oo.push.apply(Oo,V))}L=ne}if(V=!1,L!==2)continue}}if(L===1){xd(r,0),Ou(r,o,0,!0);break}e:{switch(E=r,V=L,V){case 0:case 1:throw Error(C(345));case 4:if((o&4194048)!==o)break;case 6:Ou(E,o,La,!Ml);break e;case 2:Oo=null;break;case 3:case 5:break;default:throw Error(C(329))}if((o&62914560)===o&&(L=Tp+300-Di(),10<L)){if(Ou(E,o,La,!Ml),ai(E,0,!0)!==0)break e;kl=o,E.timeoutHandle=Wp(yd.bind(null,E,m,Oo,gd,B0,o,La,Th,Ih,Ml,V,"Throttled",-0,0),L);break e}yd(E,m,Oo,gd,B0,o,La,Th,Ih,Ml,V,null,-0,0)}}break}while(!0);rc(r)}function yd(r,o,m,E,L,V,ne,Ae,lt,Vt,rn,pn,Gt,$t){if(r.timeoutHandle=-1,pn=o.subtreeFlags,pn&8192||(pn&16785408)===16785408){pn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Hs},Kg(o,V,pn);var ci=(V&62914560)===V?Tp-Di():(V&4194048)===V?tm-Di():0;if(ci=mg(pn,ci),ci!==null){kl=V,r.cancelPendingCommit=ci(lm.bind(null,r,o,V,m,E,L,ne,Ae,lt,rn,pn,null,Gt,$t)),Ou(r,V,ne,!Vt);return}}lm(r,o,V,m,E,L,ne,Ae,lt)}function z1(r){for(var o=r;;){var m=o.tag;if((m===0||m===11||m===15)&&o.flags&16384&&(m=o.updateQueue,m!==null&&(m=m.stores,m!==null)))for(var E=0;E<m.length;E++){var L=m[E],V=L.getSnapshot;L=L.value;try{if(!I(V(),L))return!1}catch{return!1}}if(m=o.child,o.subtreeFlags&16384&&m!==null)m.return=o,o=m;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ou(r,o,m,E){o&=~L0,o&=~Th,r.suspendedLanes|=o,r.pingedLanes&=~o,E&&(r.warmLanes|=o),E=r.expirationTimes;for(var L=o;0<L;){var V=31-xt(L),ne=1<<V;E[V]=-1,L&=~ne}m!==0&&Ni(r,m,o)}function _f(){return(Vr&6)===0?(Jo(0),!1):!0}function Mp(){if(dr!==null){if(Zr===0)var r=dr.return;else r=dr,xl=Co=null,Jl(r),vl=null,qc=0,r=dr;for(;r!==null;)bp(r.alternate,r),r=r.return;dr=null}}function xd(r,o){var m=r.timeoutHandle;m!==-1&&(r.timeoutHandle=-1,ig(m)),m=r.cancelPendingCommit,m!==null&&(r.cancelPendingCommit=null,m()),kl=0,Mp(),os=r,dr=m=oo(r.current,null),fr=o,Zr=0,mo=null,Ml=!1,Pu=Fn(r,o),z0=!1,Ih=La=L0=Th=su=Rs=0,Oo=mf=null,B0=!1,(o&8)!==0&&(o|=o&32);var E=r.entangledLanes;if(E!==0)for(r=r.entanglements,E&=o;0<E;){var L=31-xt(E),V=1<<L;o|=r[L],E&=~V}return ru=o,Uc(),m}function U0(r,o){qi=null,Te.H=Mr,o===Ho||o===qa?(o=Tu(),Zr=3):o===vc?(o=Tu(),Zr=4):Zr=o===hp?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,mo=o,dr===null&&(Rs=1,Ko(r,za(o,r.current)))}function V0(){var r=Bn.current;return r===null?!0:(fr&4194048)===fr?ei===null:(fr&62914560)===fr||(fr&536870912)!==0?r===ei:!1}function Mh(){var r=Te.H;return Te.H=Mr,r===null?Mr:r}function kp(){var r=Te.A;return Te.A=O1,r}function bf(){Rs=4,Ml||(fr&4194048)!==fr&&Bn.current!==null||(Pu=!0),(su&134217727)===0&&(Th&134217727)===0||os===null||Ou(os,fr,La,!1)}function Np(r,o,m){var E=Vr;Vr|=2;var L=Mh(),V=kp();(os!==r||fr!==o)&&(gd=null,xd(r,o)),o=!1;var ne=Rs;e:do try{if(Zr!==0&&dr!==null){var Ae=dr,lt=mo;switch(Zr){case 8:Mp(),ne=6;break e;case 3:case 2:case 9:case 6:Bn.current===null&&(o=!0);var Vt=Zr;if(Zr=0,mo=null,bd(r,Ae,lt,Vt),m&&Pu){ne=0;break e}break;default:Vt=Zr,Zr=0,mo=null,bd(r,Ae,lt,Vt)}}Dp(),ne=Rs;break}catch(rn){U0(r,rn)}while(!0);return o&&r.shellSuspendCounter++,xl=Co=null,Vr=E,Te.H=L,Te.A=V,dr===null&&(os=null,fr=0,Uc()),ne}function Dp(){for(;dr!==null;)sm(dr)}function _d(r,o){var m=Vr;Vr|=2;var E=Mh(),L=kp();os!==r||fr!==o?(gd=null,yf=Di()+500,xd(r,o)):Pu=Fn(r,o);e:do try{if(Zr!==0&&dr!==null){o=dr;var V=mo;t:switch(Zr){case 1:Zr=0,mo=null,bd(r,o,V,1);break;case 2:case 9:if(uh(V)){Zr=0,mo=null,am(o);break}o=function(){Zr!==2&&Zr!==9||os!==r||(Zr=7),rc(r)},V.then(o,o);break e;case 3:Zr=7;break e;case 4:Zr=5;break e;case 7:uh(V)?(Zr=0,mo=null,am(o)):(Zr=0,mo=null,bd(r,o,V,7));break;case 5:var ne=null;switch(dr.tag){case 26:ne=dr.memoizedState;case 5:case 27:var Ae=dr;if(ne?kf(ne):Ae.stateNode.complete){Zr=0,mo=null;var lt=Ae.sibling;if(lt!==null)dr=lt;else{var Vt=Ae.return;Vt!==null?(dr=Vt,Rp(Vt)):dr=null}break t}}Zr=0,mo=null,bd(r,o,V,5);break;case 6:Zr=0,mo=null,bd(r,o,V,6);break;case 8:Mp(),Rs=6;break e;default:throw Error(C(462))}}rm();break}catch(rn){U0(r,rn)}while(!0);return xl=Co=null,Te.H=E,Te.A=L,Vr=m,dr!==null?0:(os=null,fr=0,Uc(),Rs)}function rm(){for(;dr!==null&&!Li();)sm(dr)}function sm(r){var o=Wa(r.alternate,r,ru);r.memoizedProps=r.pendingProps,o===null?Rp(r):dr=o}function am(r){var o=r,m=o.alternate;switch(o.tag){case 15:case 0:o=Vg(m,o,o.pendingProps,o.type,void 0,fr);break;case 11:o=Vg(m,o,o.pendingProps,o.type.render,o.ref,fr);break;case 5:Jl(o);default:bp(m,o),o=dr=ap(o,ru),o=Wa(m,o,ru)}r.memoizedProps=r.pendingProps,o===null?Rp(r):dr=o}function bd(r,o,m,E){xl=Co=null,Jl(o),vl=null,qc=0;var L=o.return;try{if(up(r,L,o,m,fr)){Rs=1,Ko(r,za(m,r.current)),dr=null;return}}catch(V){if(L!==null)throw dr=L,V;Rs=1,Ko(r,za(m,r.current)),dr=null;return}o.flags&32768?(ir||E===1?r=!0:Pu||(fr&536870912)!==0?r=!1:(Ml=r=!0,(E===2||E===9||E===3||E===6)&&(E=Bn.current,E!==null&&E.tag===13&&(E.flags|=16384))),om(o,r)):Rp(o)}function Rp(r){var o=r;do{if((o.flags&32768)!==0){om(o,Ml);return}r=o.return;var m=Zg(o.alternate,o,ru);if(m!==null){dr=m;return}if(o=o.sibling,o!==null){dr=o;return}dr=o=r}while(o!==null);Rs===0&&(Rs=5)}function om(r,o){do{var m=R1(r.alternate,r);if(m!==null){m.flags&=32767,dr=m;return}if(m=r.return,m!==null&&(m.flags|=32768,m.subtreeFlags=0,m.deletions=null),!o&&(r=r.sibling,r!==null)){dr=r;return}dr=r=m}while(r!==null);Rs=6,dr=null}function lm(r,o,m,E,L,V,ne,Ae,lt){r.cancelPendingCommit=null;do Pp();while(aa!==0);if((Vr&6)!==0)throw Error(C(327));if(o!==null){if(o===r.current)throw Error(C(177));if(V=o.lanes|o.childLanes,V|=jc,jn(r,m,V,ne,Ae,lt),r===os&&(dr=os=null,fr=0),md=o,ou=r,kl=m,F0=V,Ip=L,nm=E,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,pm(le,function(){return fm(),null})):(r.callbackNode=null,r.callbackPriority=0),E=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||E){E=Te.T,Te.T=null,L=Ze.p,Ze.p=2,ne=Vr,Vr|=4;try{P1(r,o,m)}finally{Vr=ne,Ze.p=L,Te.T=E}}aa=1,cm(),um(),hm()}}function cm(){if(aa===1){aa=0;var r=ou,o=md,m=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||m){m=Te.T,Te.T=null;var E=Ze.p;Ze.p=2;var L=Vr;Vr|=4;try{Ep(o,r);var V=tg,ne=ue(r.containerInfo),Ae=V.focusedElem,lt=V.selectionRange;if(ne!==Ae&&Ae&&Ae.ownerDocument&&te(Ae.ownerDocument.documentElement,Ae)){if(lt!==null&&xe(Ae)){var Vt=lt.start,rn=lt.end;if(rn===void 0&&(rn=Vt),"selectionStart"in Ae)Ae.selectionStart=Vt,Ae.selectionEnd=Math.min(rn,Ae.value.length);else{var pn=Ae.ownerDocument||document,Gt=pn&&pn.defaultView||window;if(Gt.getSelection){var $t=Gt.getSelection(),ci=Ae.textContent.length,Ii=Math.min(lt.start,ci),Xr=lt.end===void 0?Ii:Math.min(lt.end,ci);!$t.extend&&Ii>Xr&&(ne=Xr,Xr=Ii,Ii=ne);var Ct=q(Ae,Ii),gt=q(Ae,Xr);if(Ct&&gt&&($t.rangeCount!==1||$t.anchorNode!==Ct.node||$t.anchorOffset!==Ct.offset||$t.focusNode!==gt.node||$t.focusOffset!==gt.offset)){var jt=pn.createRange();jt.setStart(Ct.node,Ct.offset),$t.removeAllRanges(),Ii>Xr?($t.addRange(jt),$t.extend(gt.node,gt.offset)):(jt.setEnd(gt.node,gt.offset),$t.addRange(jt))}}}}for(pn=[],$t=Ae;$t=$t.parentNode;)$t.nodeType===1&&pn.push({element:$t,left:$t.scrollLeft,top:$t.scrollTop});for(typeof Ae.focus=="function"&&Ae.focus(),Ae=0;Ae<pn.length;Ae++){var dn=pn[Ae];dn.element.scrollLeft=dn.left,dn.element.scrollTop=dn.top}}Of=!!Sf,tg=Sf=null}finally{Vr=L,Ze.p=E,Te.T=m}}r.current=o,aa=2}}function um(){if(aa===2){aa=0;var r=ou,o=md,m=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||m){m=Te.T,Te.T=null;var E=Ze.p;Ze.p=2;var L=Vr;Vr|=4;try{R0(r,o.alternate,o)}finally{Vr=L,Ze.p=E,Te.T=m}}aa=3}}function hm(){if(aa===4||aa===3){aa=0,tr();var r=ou,o=md,m=kl,E=nm;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?aa=5:(aa=0,md=ou=null,dm(r,r.pendingLanes));var L=r.pendingLanes;if(L===0&&(au=null),Jt(m),o=o.stateNode,de&&typeof de.onCommitFiberRoot=="function")try{de.onCommitFiberRoot(it,o,void 0,(o.current.flags&128)===128)}catch{}if(E!==null){o=Te.T,L=Ze.p,Ze.p=2,Te.T=null;try{for(var V=r.onRecoverableError,ne=0;ne<E.length;ne++){var Ae=E[ne];V(Ae.value,{componentStack:Ae.stack})}}finally{Te.T=o,Ze.p=L}}(kl&3)!==0&&Pp(),rc(r),L=r.pendingLanes,(m&261930)!==0&&(L&42)!==0?r===j0?xf++:(xf=0,j0=r):xf=0,Jo(0)}}function dm(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Su(o)))}function Pp(){return cm(),um(),hm(),fm()}function fm(){if(aa!==5)return!1;var r=ou,o=F0;F0=0;var m=Jt(kl),E=Te.T,L=Ze.p;try{Ze.p=32>m?32:m,Te.T=null,m=Ip,Ip=null;var V=ou,ne=kl;if(aa=0,md=ou=null,kl=0,(Vr&6)!==0)throw Error(C(331));var Ae=Vr;if(Vr|=4,Jg(V.current),O0(V,V.current,ne,m),Vr=Ae,Jo(0,!1),de&&typeof de.onPostCommitFiberRoot=="function")try{de.onPostCommitFiberRoot(it,V)}catch{}return!0}finally{Ze.p=L,Te.T=E,dm(r,o)}}function G0(r,o,m){o=za(m,o),o=vh(r.stateNode,o,2),r=Yl(r,o,2),r!==null&&(Ti(r,2),rc(r))}function Gr(r,o,m){if(r.tag===3)G0(r,r,m);else for(;o!==null;){if(o.tag===3){G0(o,r,m);break}else if(o.tag===1){var E=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&(au===null||!au.has(E))){r=za(m,r),m=wh(2),E=Yl(o,m,2),E!==null&&(Ah(m,E,o,r),Ti(E,2),rc(E));break}}o=o.return}}function Op(r,o,m){var E=r.pingCache;if(E===null){E=r.pingCache=new em;var L=new Set;E.set(o,L)}else L=E.get(o),L===void 0&&(L=new Set,E.set(o,L));L.has(m)||(z0=!0,L.add(m),r=zu.bind(null,r,o,m),o.then(r,r))}function zu(r,o,m){var E=r.pingCache;E!==null&&E.delete(o),r.pingedLanes|=r.suspendedLanes&m,r.warmLanes&=~m,os===r&&(fr&m)===m&&(Rs===4||Rs===3&&(fr&62914560)===fr&&300>Di()-Tp?(Vr&2)===0&&xd(r,0):L0|=m,Ih===fr&&(Ih=0)),rc(r)}function vf(r,o){o===0&&(o=pi()),r=So(r,o),r!==null&&(Ti(r,o),rc(r))}function H0(r){var o=r.memoizedState,m=0;o!==null&&(m=o.retryLane),vf(r,m)}function L1(r,o){var m=0;switch(r.tag){case 31:case 13:var E=r.stateNode,L=r.memoizedState;L!==null&&(m=L.retryLane);break;case 19:E=r.stateNode;break;case 22:E=r.stateNode._retryCache;break;default:throw Error(C(314))}E!==null&&E.delete(o),vf(r,m)}function pm(r,o){return Ei(r,o)}var zp=null,vd=null,q0=!1,Lp=!1,Z0=!1,lu=0;function rc(r){r!==vd&&r.next===null&&(vd===null?zp=vd=r:vd=vd.next=r),Lp=!0,q0||(q0=!0,W0())}function Jo(r,o){if(!Z0&&Lp){Z0=!0;do for(var m=!1,E=zp;E!==null;){if(r!==0){var L=E.pendingLanes;if(L===0)var V=0;else{var ne=E.suspendedLanes,Ae=E.pingedLanes;V=(1<<31-xt(42|r)+1)-1,V&=L&~(ne&~Ae),V=V&201326741?V&201326741|1:V?V|2:0}V!==0&&(m=!0,wf(E,V))}else V=fr,V=ai(E,E===os?V:0,E.cancelPendingCommit!==null||E.timeoutHandle!==-1),(V&3)===0||Fn(E,V)||(m=!0,wf(E,V));E=E.next}while(m);Z0=!1}}function Lu(){X0()}function X0(){Lp=q0=!1;var r=0;lu!==0&&Xp()&&(r=lu);for(var o=Di(),m=null,E=zp;E!==null;){var L=E.next,V=Bp(E,o);V===0?(E.next=null,m===null?zp=L:m.next=L,L===null&&(vd=m)):(m=E,(r!==0||(V&3)!==0)&&(Lp=!0)),E=L}aa!==0&&aa!==5||Jo(r),lu!==0&&(lu=0)}function Bp(r,o){for(var m=r.suspendedLanes,E=r.pingedLanes,L=r.expirationTimes,V=r.pendingLanes&-62914561;0<V;){var ne=31-xt(V),Ae=1<<ne,lt=L[ne];lt===-1?((Ae&m)===0||(Ae&E)!==0)&&(L[ne]=Jn(Ae,o)):lt<=o&&(r.expiredLanes|=Ae),V&=~Ae}if(o=os,m=fr,m=ai(r,r===o?m:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),E=r.callbackNode,m===0||r===o&&(Zr===2||Zr===9)||r.cancelPendingCommit!==null)return E!==null&&E!==null&&on(E),r.callbackNode=null,r.callbackPriority=0;if((m&3)===0||Fn(r,m)){if(o=m&-m,o===r.callbackPriority)return o;switch(E!==null&&on(E),Jt(m)){case 2:case 8:m=oe;break;case 32:m=le;break;case 268435456:m=Ue;break;default:m=le}return E=gm.bind(null,r),m=Ei(m,E),r.callbackPriority=o,r.callbackNode=m,o}return E!==null&&E!==null&&on(E),r.callbackPriority=2,r.callbackNode=null,2}function gm(r,o){if(aa!==0&&aa!==5)return r.callbackNode=null,r.callbackPriority=0,null;var m=r.callbackNode;if(Pp()&&r.callbackNode!==m)return null;var E=fr;return E=ai(r,r===os?E:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),E===0?null:(Ks(r,E,o),Bp(r,Di()),r.callbackNode!=null&&r.callbackNode===m?gm.bind(null,r):null)}function wf(r,o){if(Pp())return null;Ks(r,o,!0)}function W0(){sg(function(){(Vr&6)!==0?Ei(yt,Lu):X0()})}function Y0(){if(lu===0){var r=Hc;r===0&&(r=bn,bn<<=1,(bn&261888)===0&&(bn=256)),lu=r}return lu}function Fp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Si(""+r)}function jp(r,o){var m=o.ownerDocument.createElement("input");return m.name=o.name,m.value=o.value,r.id&&m.setAttribute("form",r.id),o.parentNode.insertBefore(m,o),r=new FormData(r),m.parentNode.removeChild(m),r}function wd(r,o,m,E,L){if(o==="submit"&&m&&m.stateNode===L){var V=Fp((L[je]||null).action),ne=E.submitter;ne&&(o=(o=ne[je]||null)?Fp(o.formAction):ne.getAttribute("formAction"),o!==null&&(V=o,ne=null));var Ae=new rr("action","action",null,E,L);r.push({event:Ae,listeners:[{instance:null,listener:function(){if(E.defaultPrevented){if(lu!==0){var lt=ne?jp(L,ne):new FormData(L);ms(m,{pending:!0,data:lt,method:L.method,action:V},null,lt)}}else typeof V=="function"&&(Ae.preventDefault(),lt=ne?jp(L,ne):new FormData(L),ms(m,{pending:!0,data:lt,method:L.method,action:V},V,lt))},currentTarget:L}]})}}for(var Up=0;Up<bu.length;Up++){var Vp=bu[Up],$0=Vp.toLowerCase(),mm=Vp[0].toUpperCase()+Vp.slice(1);so($0,"on"+mm)}so(ga,"onAnimationEnd"),so(Fs,"onAnimationIteration"),so(Er,"onAnimationStart"),so("dblclick","onDoubleClick"),so("focusin","onFocus"),so("focusout","onBlur"),so(rs,"onTransitionRun"),so(Ws,"onTransitionStart"),so(ro,"onTransitionCancel"),so(js,"onTransitionEnd"),yi("onMouseEnter",["mouseout","mouseover"]),yi("onMouseLeave",["mouseout","mouseover"]),yi("onPointerEnter",["pointerout","pointerover"]),yi("onPointerLeave",["pointerout","pointerover"]),ln("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ln("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ln("onBeforeInput",["compositionend","keypress","textInput","paste"]),ln("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ln("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ln("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ym=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Bu));function xm(r,o){o=(o&4)!==0;for(var m=0;m<r.length;m++){var E=r[m],L=E.event;E=E.listeners;e:{var V=void 0;if(o)for(var ne=E.length-1;0<=ne;ne--){var Ae=E[ne],lt=Ae.instance,Vt=Ae.currentTarget;if(Ae=Ae.listener,lt!==V&&L.isPropagationStopped())break e;V=Ae,L.currentTarget=Vt;try{V(L)}catch(rn){dl(rn)}L.currentTarget=null,V=lt}else for(ne=0;ne<E.length;ne++){if(Ae=E[ne],lt=Ae.instance,Vt=Ae.currentTarget,Ae=Ae.listener,lt!==V&&L.isPropagationStopped())break e;V=Ae,L.currentTarget=Vt;try{V(L)}catch(rn){dl(rn)}L.currentTarget=null,V=lt}}}}function pr(r,o){var m=o[Yt];m===void 0&&(m=o[Yt]=new Set);var E=r+"__bubble";m.has(E)||(Hp(o,r,2,!1),m.add(E))}function K0(r,o,m){var E=0;o&&(E|=4),Hp(m,r,E,o)}var Gp="_reactListening"+Math.random().toString(36).slice(2);function Q0(r){if(!r[Gp]){r[Gp]=!0,Zt.forEach(function(m){m!=="selectionchange"&&(ym.has(m)||K0(m,!1,r),K0(m,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[Gp]||(o[Gp]=!0,K0("selectionchange",!1,o))}}function Hp(r,o,m,E){switch(Dh(o)){case 2:var L=zf;break;case 8:L=Dm;break;default:L=xg}m=L.bind(null,o,m,r),L=void 0,!qs||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(L=!0),E?L!==void 0?r.addEventListener(o,m,{capture:!0,passive:L}):r.addEventListener(o,m,!0):L!==void 0?r.addEventListener(o,m,{passive:L}):r.addEventListener(o,m,!1)}function kc(r,o,m,E,L){var V=E;if((o&1)===0&&(o&2)===0&&E!==null)e:for(;;){if(E===null)return;var ne=E.tag;if(ne===3||ne===4){var Ae=E.stateNode.containerInfo;if(Ae===L)break;if(ne===4)for(ne=E.return;ne!==null;){var lt=ne.tag;if((lt===3||lt===4)&&ne.stateNode.containerInfo===L)return;ne=ne.return}for(;Ae!==null;){if(ne=ni(Ae),ne===null)return;if(lt=ne.tag,lt===5||lt===6||lt===26||lt===27){E=V=ne;continue e}Ae=Ae.parentNode}}E=E.return}_r(function(){var Vt=V,rn=ol(m),pn=[];e:{var Gt=sh.get(r);if(Gt!==void 0){var $t=rr,ci=r;switch(r){case"keypress":if(ps(m)===0)break e;case"keydown":case"keyup":$t=vr;break;case"focusin":ci="focus",$t=Vi;break;case"focusout":ci="blur",$t=Vi;break;case"beforeblur":case"afterblur":$t=Vi;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$t=tt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$t=Mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$t=xu;break;case ga:case Fs:case Er:$t=oi;break;case js:$t=ja;break;case"scroll":case"scrollend":$t=Eo;break;case"wheel":$t=ih;break;case"copy":case"cut":case"paste":$t=pa;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$t=$i;break;case"toggle":case"beforetoggle":$t=cl}var Ii=(o&4)!==0,Xr=!Ii&&(r==="scroll"||r==="scrollend"),Ct=Ii?Gt!==null?Gt+"Capture":null:Gt;Ii=[];for(var gt=Vt,jt;gt!==null;){var dn=gt;if(jt=dn.stateNode,dn=dn.tag,dn!==5&&dn!==26&&dn!==27||jt===null||Ct===null||(dn=Ai(gt,Ct),dn!=null&&Ii.push(Ad(gt,dn,jt))),Xr)break;gt=gt.return}0<Ii.length&&(Gt=new $t(Gt,ci,null,m,rn),pn.push({event:Gt,listeners:Ii}))}}if((o&7)===0){e:{if(Gt=r==="mouseover"||r==="pointerover",$t=r==="mouseout"||r==="pointerout",Gt&&m!==zl&&(ci=m.relatedTarget||m.fromElement)&&(ni(ci)||ci[Mt]))break e;if(($t||Gt)&&(Gt=rn.window===rn?rn:(Gt=rn.ownerDocument)?Gt.defaultView||Gt.parentWindow:window,$t?(ci=m.relatedTarget||m.toElement,$t=Vt,ci=ci?ni(ci):null,ci!==null&&(Xr=P(ci),Ii=ci.tag,ci!==Xr||Ii!==5&&Ii!==27&&Ii!==6)&&(ci=null)):($t=null,ci=Vt),$t!==ci)){if(Ii=tt,dn="onMouseLeave",Ct="onMouseEnter",gt="mouse",(r==="pointerout"||r==="pointerover")&&(Ii=$i,dn="onPointerLeave",Ct="onPointerEnter",gt="pointer"),Xr=$t==null?Gt:Zi($t),jt=ci==null?Gt:Zi(ci),Gt=new Ii(dn,gt+"leave",$t,m,rn),Gt.target=Xr,Gt.relatedTarget=jt,dn=null,ni(rn)===Vt&&(Ii=new Ii(Ct,gt+"enter",ci,m,rn),Ii.target=jt,Ii.relatedTarget=Xr,dn=Ii),Xr=dn,$t&&ci)t:{for(Ii=_m,Ct=$t,gt=ci,jt=0,dn=Ct;dn;dn=Ii(dn))jt++;dn=0;for(var Ci=gt;Ci;Ci=Ii(Ci))dn++;for(;0<jt-dn;)Ct=Ii(Ct),jt--;for(;0<dn-jt;)gt=Ii(gt),dn--;for(;jt--;){if(Ct===gt||gt!==null&&Ct===gt.alternate){Ii=Ct;break t}Ct=Ii(Ct),gt=Ii(gt)}Ii=null}else Ii=null;$t!==null&&J0(pn,Gt,$t,Ii,!1),ci!==null&&Xr!==null&&J0(pn,Xr,ci,Ii,!0)}}e:{if(Gt=Vt?Zi(Vt):window,$t=Gt.nodeName&&Gt.nodeName.toLowerCase(),$t==="select"||$t==="input"&&Gt.type==="file")var zr=Xs;else if(Fc(Gt))if(rh)zr=v;else{zr=u;var ui=a}else $t=Gt.nodeName,!$t||$t.toLowerCase()!=="input"||Gt.type!=="checkbox"&&Gt.type!=="radio"?Vt&&xr(Vt.elementType)&&(zr=Xs):zr=g;if(zr&&(zr=zr(r,Vt))){Pa(pn,zr,m,rn);break e}ui&&ui(r,Gt,Vt),r==="focusout"&&Vt&&Gt.type==="number"&&Vt.memoizedProps.value!=null&&Ne(Gt,"number",Gt.value)}switch(ui=Vt?Zi(Vt):window,r){case"focusin":(Fc(ui)||ui.contentEditable==="true")&&(ot=ui,ft=Vt,Rt=null);break;case"focusout":Rt=ft=ot=null;break;case"mousedown":Ht=!0;break;case"contextmenu":case"mouseup":case"dragend":Ht=!1,An(pn,m,rn);break;case"selectionchange":if(Oe)break;case"keydown":case"keyup":An(pn,m,rn)}var vi;if($r)e:{switch(r){case"compositionstart":var cr="onCompositionStart";break e;case"compositionend":cr="onCompositionEnd";break e;case"compositionupdate":cr="onCompositionUpdate";break e}cr=void 0}else no?Lc(r,m)&&(cr="onCompositionEnd"):r==="keydown"&&m.keyCode===229&&(cr="onCompositionStart");cr&&(dc&&m.locale!=="ko"&&(no||cr!=="onCompositionStart"?cr==="onCompositionEnd"&&no&&(vi=fa()):(Zs=rn,Bs="value"in Zs?Zs.value:Zs.textContent,no=!0)),ui=Af(Vt,cr),0<ui.length&&(cr=new ll(cr,r,null,m,rn),pn.push({event:cr,listeners:ui}),vi?cr.data=vi:(vi=fc(m),vi!==null&&(cr.data=vi)))),(vi=Fl?io(r,m):Bc(r,m))&&(cr=Af(Vt,"onBeforeInput"),0<cr.length&&(ui=new ll("onBeforeInput","beforeinput",null,m,rn),pn.push({event:ui,listeners:cr}),ui.data=vi)),wd(pn,r,Vt,m,rn)}xm(pn,o)})}function Ad(r,o,m){return{instance:r,listener:o,currentTarget:m}}function Af(r,o){for(var m=o+"Capture",E=[];r!==null;){var L=r,V=L.stateNode;if(L=L.tag,L!==5&&L!==26&&L!==27||V===null||(L=Ai(r,m),L!=null&&E.unshift(Ad(r,L,V)),L=Ai(r,o),L!=null&&E.push(Ad(r,L,V))),r.tag===3)return E;r=r.return}return[]}function _m(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function J0(r,o,m,E,L){for(var V=o._reactName,ne=[];m!==null&&m!==E;){var Ae=m,lt=Ae.alternate,Vt=Ae.stateNode;if(Ae=Ae.tag,lt!==null&&lt===E)break;Ae!==5&&Ae!==26&&Ae!==27||Vt===null||(lt=Vt,L?(Vt=Ai(m,V),Vt!=null&&ne.unshift(Ad(m,Vt,lt))):L||(Vt=Ai(m,V),Vt!=null&&ne.push(Ad(m,Vt,lt)))),m=m.return}ne.length!==0&&r.push({event:o,listeners:ne})}var bm=/\r\n?/g,vm=/\u0000|\uFFFD/g;function Ef(r){return(typeof r=="string"?r:""+r).replace(bm,`
`).replace(vm,"")}function eg(r,o){return o=Ef(o),Ef(r)===o}function Or(r,o,m,E,L,V){switch(m){case"children":typeof E=="string"?o==="body"||o==="textarea"&&E===""||Ma(r,E):(typeof E=="number"||typeof E=="bigint")&&o!=="body"&&Ma(r,""+E);break;case"className":Hi(r,"class",E);break;case"tabIndex":Hi(r,"tabindex",E);break;case"dir":case"role":case"viewBox":case"width":case"height":Hi(r,m,E);break;case"style":di(r,E,V);break;case"data":if(o!=="object"){Hi(r,"data",E);break}case"src":case"href":if(E===""&&(o!=="a"||m!=="href")){r.removeAttribute(m);break}if(E==null||typeof E=="function"||typeof E=="symbol"||typeof E=="boolean"){r.removeAttribute(m);break}E=Si(""+E),r.setAttribute(m,E);break;case"action":case"formAction":if(typeof E=="function"){r.setAttribute(m,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof V=="function"&&(m==="formAction"?(o!=="input"&&Or(r,o,"name",L.name,L,null),Or(r,o,"formEncType",L.formEncType,L,null),Or(r,o,"formMethod",L.formMethod,L,null),Or(r,o,"formTarget",L.formTarget,L,null)):(Or(r,o,"encType",L.encType,L,null),Or(r,o,"method",L.method,L,null),Or(r,o,"target",L.target,L,null)));if(E==null||typeof E=="symbol"||typeof E=="boolean"){r.removeAttribute(m);break}E=Si(""+E),r.setAttribute(m,E);break;case"onClick":E!=null&&(r.onclick=Hs);break;case"onScroll":E!=null&&pr("scroll",r);break;case"onScrollEnd":E!=null&&pr("scrollend",r);break;case"dangerouslySetInnerHTML":if(E!=null){if(typeof E!="object"||!("__html"in E))throw Error(C(61));if(m=E.__html,m!=null){if(L.children!=null)throw Error(C(60));r.innerHTML=m}}break;case"multiple":r.multiple=E&&typeof E!="function"&&typeof E!="symbol";break;case"muted":r.muted=E&&typeof E!="function"&&typeof E!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(E==null||typeof E=="function"||typeof E=="boolean"||typeof E=="symbol"){r.removeAttribute("xlink:href");break}m=Si(""+E),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":E!=null&&typeof E!="function"&&typeof E!="symbol"?r.setAttribute(m,""+E):r.removeAttribute(m);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":E&&typeof E!="function"&&typeof E!="symbol"?r.setAttribute(m,""):r.removeAttribute(m);break;case"capture":case"download":E===!0?r.setAttribute(m,""):E!==!1&&E!=null&&typeof E!="function"&&typeof E!="symbol"?r.setAttribute(m,E):r.removeAttribute(m);break;case"cols":case"rows":case"size":case"span":E!=null&&typeof E!="function"&&typeof E!="symbol"&&!isNaN(E)&&1<=E?r.setAttribute(m,E):r.removeAttribute(m);break;case"rowSpan":case"start":E==null||typeof E=="function"||typeof E=="symbol"||isNaN(E)?r.removeAttribute(m):r.setAttribute(m,E);break;case"popover":pr("beforetoggle",r),pr("toggle",r),li(r,"popover",E);break;case"xlinkActuate":Tr(r,"http://www.w3.org/1999/xlink","xlink:actuate",E);break;case"xlinkArcrole":Tr(r,"http://www.w3.org/1999/xlink","xlink:arcrole",E);break;case"xlinkRole":Tr(r,"http://www.w3.org/1999/xlink","xlink:role",E);break;case"xlinkShow":Tr(r,"http://www.w3.org/1999/xlink","xlink:show",E);break;case"xlinkTitle":Tr(r,"http://www.w3.org/1999/xlink","xlink:title",E);break;case"xlinkType":Tr(r,"http://www.w3.org/1999/xlink","xlink:type",E);break;case"xmlBase":Tr(r,"http://www.w3.org/XML/1998/namespace","xml:base",E);break;case"xmlLang":Tr(r,"http://www.w3.org/XML/1998/namespace","xml:lang",E);break;case"xmlSpace":Tr(r,"http://www.w3.org/XML/1998/namespace","xml:space",E);break;case"is":li(r,"is",E);break;case"innerText":case"textContent":break;default:(!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(m=wo.get(m)||m,li(r,m,E))}}function qp(r,o,m,E,L,V){switch(m){case"style":di(r,E,V);break;case"dangerouslySetInnerHTML":if(E!=null){if(typeof E!="object"||!("__html"in E))throw Error(C(61));if(m=E.__html,m!=null){if(L.children!=null)throw Error(C(60));r.innerHTML=m}}break;case"children":typeof E=="string"?Ma(r,E):(typeof E=="number"||typeof E=="bigint")&&Ma(r,""+E);break;case"onScroll":E!=null&&pr("scroll",r);break;case"onScrollEnd":E!=null&&pr("scrollend",r);break;case"onClick":E!=null&&(r.onclick=Hs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ki.hasOwnProperty(m))e:{if(m[0]==="o"&&m[1]==="n"&&(L=m.endsWith("Capture"),o=m.slice(2,L?m.length-7:void 0),V=r[je]||null,V=V!=null?V[m]:null,typeof V=="function"&&r.removeEventListener(o,V,L),typeof E=="function")){typeof V!="function"&&V!==null&&(m in r?r[m]=null:r.hasAttribute(m)&&r.removeAttribute(m)),r.addEventListener(o,E,L);break e}m in r?r[m]=E:E===!0?r.setAttribute(m,""):li(r,m,E)}}}function _a(r,o,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":pr("error",r),pr("load",r);var E=!1,L=!1,V;for(V in m)if(m.hasOwnProperty(V)){var ne=m[V];if(ne!=null)switch(V){case"src":E=!0;break;case"srcSet":L=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(C(137,o));default:Or(r,o,V,ne,m,null)}}L&&Or(r,o,"srcSet",m.srcSet,m,null),E&&Or(r,o,"src",m.src,m,null);return;case"input":pr("invalid",r);var Ae=V=ne=L=null,lt=null,Vt=null;for(E in m)if(m.hasOwnProperty(E)){var rn=m[E];if(rn!=null)switch(E){case"name":L=rn;break;case"type":ne=rn;break;case"checked":lt=rn;break;case"defaultChecked":Vt=rn;break;case"value":V=rn;break;case"defaultValue":Ae=rn;break;case"children":case"dangerouslySetInnerHTML":if(rn!=null)throw Error(C(137,o));break;default:Or(r,o,E,rn,m,null)}}Pt(r,V,Ae,lt,Vt,ne,L,!1);return;case"select":pr("invalid",r),E=ne=V=null;for(L in m)if(m.hasOwnProperty(L)&&(Ae=m[L],Ae!=null))switch(L){case"value":V=Ae;break;case"defaultValue":ne=Ae;break;case"multiple":E=Ae;default:Or(r,o,L,Ae,m,null)}o=V,m=ne,r.multiple=!!E,o!=null?ti(r,!!E,o,!1):m!=null&&ti(r,!!E,m,!0);return;case"textarea":pr("invalid",r),V=L=E=null;for(ne in m)if(m.hasOwnProperty(ne)&&(Ae=m[ne],Ae!=null))switch(ne){case"value":E=Ae;break;case"defaultValue":L=Ae;break;case"children":V=Ae;break;case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(C(91));break;default:Or(r,o,ne,Ae,m,null)}Is(r,E,L,V);return;case"option":for(lt in m)m.hasOwnProperty(lt)&&(E=m[lt],E!=null)&&(lt==="selected"?r.selected=E&&typeof E!="function"&&typeof E!="symbol":Or(r,o,lt,E,m,null));return;case"dialog":pr("beforetoggle",r),pr("toggle",r),pr("cancel",r),pr("close",r);break;case"iframe":case"object":pr("load",r);break;case"video":case"audio":for(E=0;E<Bu.length;E++)pr(Bu[E],r);break;case"image":pr("error",r),pr("load",r);break;case"details":pr("toggle",r);break;case"embed":case"source":case"link":pr("error",r),pr("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Vt in m)if(m.hasOwnProperty(Vt)&&(E=m[Vt],E!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":throw Error(C(137,o));default:Or(r,o,Vt,E,m,null)}return;default:if(xr(o)){for(rn in m)m.hasOwnProperty(rn)&&(E=m[rn],E!==void 0&&qp(r,o,rn,E,m,void 0));return}}for(Ae in m)m.hasOwnProperty(Ae)&&(E=m[Ae],E!=null&&Or(r,o,Ae,E,m,null))}function wm(r,o,m,E){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var L=null,V=null,ne=null,Ae=null,lt=null,Vt=null,rn=null;for($t in m){var pn=m[$t];if(m.hasOwnProperty($t)&&pn!=null)switch($t){case"checked":break;case"value":break;case"defaultValue":lt=pn;default:E.hasOwnProperty($t)||Or(r,o,$t,null,E,pn)}}for(var Gt in E){var $t=E[Gt];if(pn=m[Gt],E.hasOwnProperty(Gt)&&($t!=null||pn!=null))switch(Gt){case"type":V=$t;break;case"name":L=$t;break;case"checked":Vt=$t;break;case"defaultChecked":rn=$t;break;case"value":ne=$t;break;case"defaultValue":Ae=$t;break;case"children":case"dangerouslySetInnerHTML":if($t!=null)throw Error(C(137,o));break;default:$t!==pn&&Or(r,o,Gt,$t,E,pn)}}Wr(r,ne,Ae,lt,Vt,rn,V,L);return;case"select":$t=ne=Ae=Gt=null;for(V in m)if(lt=m[V],m.hasOwnProperty(V)&&lt!=null)switch(V){case"value":break;case"multiple":$t=lt;default:E.hasOwnProperty(V)||Or(r,o,V,null,E,lt)}for(L in E)if(V=E[L],lt=m[L],E.hasOwnProperty(L)&&(V!=null||lt!=null))switch(L){case"value":Gt=V;break;case"defaultValue":Ae=V;break;case"multiple":ne=V;default:V!==lt&&Or(r,o,L,V,E,lt)}o=Ae,m=ne,E=$t,Gt!=null?ti(r,!!m,Gt,!1):!!E!=!!m&&(o!=null?ti(r,!!m,o,!0):ti(r,!!m,m?[]:"",!1));return;case"textarea":$t=Gt=null;for(Ae in m)if(L=m[Ae],m.hasOwnProperty(Ae)&&L!=null&&!E.hasOwnProperty(Ae))switch(Ae){case"value":break;case"children":break;default:Or(r,o,Ae,null,E,L)}for(ne in E)if(L=E[ne],V=m[ne],E.hasOwnProperty(ne)&&(L!=null||V!=null))switch(ne){case"value":Gt=L;break;case"defaultValue":$t=L;break;case"children":break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(C(91));break;default:L!==V&&Or(r,o,ne,L,E,V)}cs(r,Gt,$t);return;case"option":for(var ci in m)Gt=m[ci],m.hasOwnProperty(ci)&&Gt!=null&&!E.hasOwnProperty(ci)&&(ci==="selected"?r.selected=!1:Or(r,o,ci,null,E,Gt));for(lt in E)Gt=E[lt],$t=m[lt],E.hasOwnProperty(lt)&&Gt!==$t&&(Gt!=null||$t!=null)&&(lt==="selected"?r.selected=Gt&&typeof Gt!="function"&&typeof Gt!="symbol":Or(r,o,lt,Gt,E,$t));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ii in m)Gt=m[Ii],m.hasOwnProperty(Ii)&&Gt!=null&&!E.hasOwnProperty(Ii)&&Or(r,o,Ii,null,E,Gt);for(Vt in E)if(Gt=E[Vt],$t=m[Vt],E.hasOwnProperty(Vt)&&Gt!==$t&&(Gt!=null||$t!=null))switch(Vt){case"children":case"dangerouslySetInnerHTML":if(Gt!=null)throw Error(C(137,o));break;default:Or(r,o,Vt,Gt,E,$t)}return;default:if(xr(o)){for(var Xr in m)Gt=m[Xr],m.hasOwnProperty(Xr)&&Gt!==void 0&&!E.hasOwnProperty(Xr)&&qp(r,o,Xr,void 0,E,Gt);for(rn in E)Gt=E[rn],$t=m[rn],!E.hasOwnProperty(rn)||Gt===$t||Gt===void 0&&$t===void 0||qp(r,o,rn,Gt,E,$t);return}}for(var Ct in m)Gt=m[Ct],m.hasOwnProperty(Ct)&&Gt!=null&&!E.hasOwnProperty(Ct)&&Or(r,o,Ct,null,E,Gt);for(pn in E)Gt=E[pn],$t=m[pn],!E.hasOwnProperty(pn)||Gt===$t||Gt==null&&$t==null||Or(r,o,pn,Gt,E,$t)}function Bo(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Ed(){if(typeof performance.getEntriesByType=="function"){for(var r=0,o=0,m=performance.getEntriesByType("resource"),E=0;E<m.length;E++){var L=m[E],V=L.transferSize,ne=L.initiatorType,Ae=L.duration;if(V&&Ae&&Bo(ne)){for(ne=0,Ae=L.responseEnd,E+=1;E<m.length;E++){var lt=m[E],Vt=lt.startTime;if(Vt>Ae)break;var rn=lt.transferSize,pn=lt.initiatorType;rn&&Bo(pn)&&(lt=lt.responseEnd,ne+=rn*(lt<Ae?1:(Ae-Vt)/(lt-Vt)))}if(--E,o+=8*(V+ne)/(L.duration/1e3),r++,10<r)break}}if(0<r)return o/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Sf=null,tg=null;function Cf(r){return r.nodeType===9?r:r.ownerDocument}function Fu(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ng(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function Zp(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var ju=null;function Xp(){var r=window.event;return r&&r.type==="popstate"?r===ju?!1:(ju=r,!0):(ju=null,!1)}var Wp=typeof setTimeout=="function"?setTimeout:void 0,ig=typeof clearTimeout=="function"?clearTimeout:void 0,rg=typeof Promise=="function"?Promise:void 0,sg=typeof queueMicrotask=="function"?queueMicrotask:typeof rg<"u"?function(r){return rg.resolve(null).then(r).catch(ag)}:Wp;function ag(r){setTimeout(function(){throw r})}function Uu(r){return r==="head"}function Am(r,o){var m=o,E=0;do{var L=m.nextSibling;if(r.removeChild(m),L&&L.nodeType===8)if(m=L.data,m==="/$"||m==="/&"){if(E===0){r.removeChild(L),Xu(o);return}E--}else if(m==="$"||m==="$?"||m==="$~"||m==="$!"||m==="&")E++;else if(m==="html")Sd(r.ownerDocument.documentElement);else if(m==="head"){m=r.ownerDocument.head,Sd(m);for(var V=m.firstChild;V;){var ne=V.nextSibling,Ae=V.nodeName;V[vn]||Ae==="SCRIPT"||Ae==="STYLE"||Ae==="LINK"&&V.rel.toLowerCase()==="stylesheet"||m.removeChild(V),V=ne}}else m==="body"&&Sd(r.ownerDocument.body);m=L}while(m);Xu(o)}function Wi(r,o){var m=r;r=0;do{var E=m.nextSibling;if(m.nodeType===1?o?(m._stashedDisplay=m.style.display,m.style.display="none"):(m.style.display=m._stashedDisplay||"",m.getAttribute("style")===""&&m.removeAttribute("style")):m.nodeType===3&&(o?(m._stashedText=m.nodeValue,m.nodeValue=""):m.nodeValue=m._stashedText||""),E&&E.nodeType===8)if(m=E.data,m==="/$"){if(r===0)break;r--}else m!=="$"&&m!=="$?"&&m!=="$~"&&m!=="$!"||r++;m=E}while(m)}function sc(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var m=o;switch(o=o.nextSibling,m.nodeName){case"HTML":case"HEAD":case"BODY":sc(m),ri(m);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(m.rel.toLowerCase()==="stylesheet")continue}r.removeChild(m)}}function Sa(r,o,m,E){for(;r.nodeType===1;){var L=m;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!E&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(E){if(!r[vn])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(V=r.getAttribute("rel"),V==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(V!==L.rel||r.getAttribute("href")!==(L.href==null||L.href===""?null:L.href)||r.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin)||r.getAttribute("title")!==(L.title==null?null:L.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(V=r.getAttribute("src"),(V!==(L.src==null?null:L.src)||r.getAttribute("type")!==(L.type==null?null:L.type)||r.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin))&&V&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var V=L.name==null?null:""+L.name;if(L.type==="hidden"&&r.getAttribute("name")===V)return r}else return r;if(r=el(r.nextSibling),r===null)break}return null}function ac(r,o,m){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!m||(r=el(r.nextSibling),r===null))return null;return r}function Vu(r,o){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=el(r.nextSibling),r===null))return null;return r}function Ya(r){return r.data==="$?"||r.data==="$~"}function Vs(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function oa(r,o){var m=r.ownerDocument;if(r.data==="$~")r._reactRetry=o;else if(r.data!=="$?"||m.readyState!=="loading")o();else{var E=function(){o(),m.removeEventListener("DOMContentLoaded",E)};m.addEventListener("DOMContentLoaded",E),r._reactRetry=E}}function el(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return r}var yo=null;function la(r){r=r.nextSibling;for(var o=0;r;){if(r.nodeType===8){var m=r.data;if(m==="/$"||m==="/&"){if(o===0)return el(r.nextSibling);o--}else m!=="$"&&m!=="$!"&&m!=="$?"&&m!=="$~"&&m!=="&"||o++}r=r.nextSibling}return null}function Tf(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var m=r.data;if(m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"){if(o===0)return r;o--}else m!=="/$"&&m!=="/&"||o++}r=r.previousSibling}return null}function Em(r,o,m){switch(o=Cf(m),r){case"html":if(r=o.documentElement,!r)throw Error(C(452));return r;case"head":if(r=o.head,!r)throw Error(C(453));return r;case"body":if(r=o.body,!r)throw Error(C(454));return r;default:throw Error(C(451))}}function Sd(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);ri(r)}var Ca=new Map,kh=new Set;function Yp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Nc=Ze.d;Ze.d={f:Sm,r:Cm,D:lg,C:$a,L:oc,m:Ka,X:$p,S:Hu,M:cg};function Sm(){var r=Nc.f(),o=_f();return r||o}function Cm(r){var o=Xn(r);o!==null&&o.tag===5&&o.type==="form"?na(o):Nc.r(r)}var Gu=typeof document>"u"?null:document;function og(r,o,m){var E=Gu;if(E&&typeof o=="string"&&o){var L=Fi(o);L='link[rel="'+r+'"][href="'+L+'"]',typeof m=="string"&&(L+='[crossorigin="'+m+'"]'),kh.has(L)||(kh.add(L),r={rel:r,crossOrigin:m,href:o},E.querySelector(L)===null&&(o=E.createElement("link"),_a(o,"link",r),Dn(o),E.head.appendChild(o)))}}function lg(r){Nc.D(r),og("dns-prefetch",r,null)}function $a(r,o){Nc.C(r,o),og("preconnect",r,o)}function oc(r,o,m){Nc.L(r,o,m);var E=Gu;if(E&&r&&o){var L='link[rel="preload"][as="'+Fi(o)+'"]';o==="image"&&m&&m.imageSrcSet?(L+='[imagesrcset="'+Fi(m.imageSrcSet)+'"]',typeof m.imageSizes=="string"&&(L+='[imagesizes="'+Fi(m.imageSizes)+'"]')):L+='[href="'+Fi(r)+'"]';var V=L;switch(o){case"style":V=Nh(r);break;case"script":V=cu(r)}Ca.has(V)||(r=K({rel:"preload",href:o==="image"&&m&&m.imageSrcSet?void 0:r,as:o},m),Ca.set(V,r),E.querySelector(L)!==null||o==="style"&&E.querySelector(Cd(V))||o==="script"&&E.querySelector(Td(V))||(o=E.createElement("link"),_a(o,"link",r),Dn(o),E.head.appendChild(o)))}}function Ka(r,o){Nc.m(r,o);var m=Gu;if(m&&r){var E=o&&typeof o.as=="string"?o.as:"script",L='link[rel="modulepreload"][as="'+Fi(E)+'"][href="'+Fi(r)+'"]',V=L;switch(E){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":V=cu(r)}if(!Ca.has(V)&&(r=K({rel:"modulepreload",href:r},o),Ca.set(V,r),m.querySelector(L)===null)){switch(E){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(m.querySelector(Td(V)))return}E=m.createElement("link"),_a(E,"link",r),Dn(E),m.head.appendChild(E)}}}function Hu(r,o,m){Nc.S(r,o,m);var E=Gu;if(E&&r){var L=Cn(E).hoistableStyles,V=Nh(r);o=o||"default";var ne=L.get(V);if(!ne){var Ae={loading:0,preload:null};if(ne=E.querySelector(Cd(V)))Ae.loading=5;else{r=K({rel:"stylesheet",href:r,"data-precedence":o},m),(m=Ca.get(V))&&If(r,m);var lt=ne=E.createElement("link");Dn(lt),_a(lt,"link",r),lt._p=new Promise(function(Vt,rn){lt.onload=Vt,lt.onerror=rn}),lt.addEventListener("load",function(){Ae.loading|=1}),lt.addEventListener("error",function(){Ae.loading|=2}),Ae.loading|=4,uu(ne,o,E)}ne={type:"stylesheet",instance:ne,count:1,state:Ae},L.set(V,ne)}}}function $p(r,o){Nc.X(r,o);var m=Gu;if(m&&r){var E=Cn(m).hoistableScripts,L=cu(r),V=E.get(L);V||(V=m.querySelector(Td(L)),V||(r=K({src:r,async:!0},o),(o=Ca.get(L))&&Kp(r,o),V=m.createElement("script"),Dn(V),_a(V,"link",r),m.head.appendChild(V)),V={type:"script",instance:V,count:1,state:null},E.set(L,V))}}function cg(r,o){Nc.M(r,o);var m=Gu;if(m&&r){var E=Cn(m).hoistableScripts,L=cu(r),V=E.get(L);V||(V=m.querySelector(Td(L)),V||(r=K({src:r,async:!0,type:"module"},o),(o=Ca.get(L))&&Kp(r,o),V=m.createElement("script"),Dn(V),_a(V,"link",r),m.head.appendChild(V)),V={type:"script",instance:V,count:1,state:null},E.set(L,V))}}function ug(r,o,m,E){var L=(L=Bt.current)?Yp(L):null;if(!L)throw Error(C(446));switch(r){case"meta":case"title":return null;case"style":return typeof m.precedence=="string"&&typeof m.href=="string"?(o=Nh(m.href),m=Cn(L).hoistableStyles,E=m.get(o),E||(E={type:"style",instance:null,count:0,state:null},m.set(o,E)),E):{type:"void",instance:null,count:0,state:null};case"link":if(m.rel==="stylesheet"&&typeof m.href=="string"&&typeof m.precedence=="string"){r=Nh(m.href);var V=Cn(L).hoistableStyles,ne=V.get(r);if(ne||(L=L.ownerDocument||L,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},V.set(r,ne),(V=L.querySelector(Cd(r)))&&!V._p&&(ne.instance=V,ne.state.loading=5),Ca.has(r)||(m={rel:"preload",as:"style",href:m.href,crossOrigin:m.crossOrigin,integrity:m.integrity,media:m.media,hrefLang:m.hrefLang,referrerPolicy:m.referrerPolicy},Ca.set(r,m),V||dg(L,r,m,ne.state))),o&&E===null)throw Error(C(528,""));return ne}if(o&&E!==null)throw Error(C(529,""));return null;case"script":return o=m.async,m=m.src,typeof m=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=cu(m),m=Cn(L).hoistableScripts,E=m.get(o),E||(E={type:"script",instance:null,count:0,state:null},m.set(o,E)),E):{type:"void",instance:null,count:0,state:null};default:throw Error(C(444,r))}}function Nh(r){return'href="'+Fi(r)+'"'}function Cd(r){return'link[rel="stylesheet"]['+r+"]"}function hg(r){return K({},r,{"data-precedence":r.precedence,precedence:null})}function dg(r,o,m,E){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?E.loading=1:(o=r.createElement("link"),E.preload=o,o.addEventListener("load",function(){return E.loading|=1}),o.addEventListener("error",function(){return E.loading|=2}),_a(o,"link",m),Dn(o),r.head.appendChild(o))}function cu(r){return'[src="'+Fi(r)+'"]'}function Td(r){return"script[async]"+r}function fg(r,o,m){if(o.count++,o.instance===null)switch(o.type){case"style":var E=r.querySelector('style[data-href~="'+Fi(m.href)+'"]');if(E)return o.instance=E,Dn(E),E;var L=K({},m,{"data-href":m.href,"data-precedence":m.precedence,href:null,precedence:null});return E=(r.ownerDocument||r).createElement("style"),Dn(E),_a(E,"style",L),uu(E,m.precedence,r),o.instance=E;case"stylesheet":L=Nh(m.href);var V=r.querySelector(Cd(L));if(V)return o.state.loading|=4,o.instance=V,Dn(V),V;E=hg(m),(L=Ca.get(L))&&If(E,L),V=(r.ownerDocument||r).createElement("link"),Dn(V);var ne=V;return ne._p=new Promise(function(Ae,lt){ne.onload=Ae,ne.onerror=lt}),_a(V,"link",E),o.state.loading|=4,uu(V,m.precedence,r),o.instance=V;case"script":return V=cu(m.src),(L=r.querySelector(Td(V)))?(o.instance=L,Dn(L),L):(E=m,(L=Ca.get(V))&&(E=K({},m),Kp(E,L)),r=r.ownerDocument||r,L=r.createElement("script"),Dn(L),_a(L,"link",E),r.head.appendChild(L),o.instance=L);case"void":return null;default:throw Error(C(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(E=o.instance,o.state.loading|=4,uu(E,m.precedence,r));return o.instance}function uu(r,o,m){for(var E=m.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),L=E.length?E[E.length-1]:null,V=L,ne=0;ne<E.length;ne++){var Ae=E[ne];if(Ae.dataset.precedence===o)V=Ae;else if(V!==L)break}V?V.parentNode.insertBefore(r,V.nextSibling):(o=m.nodeType===9?m.head:m,o.insertBefore(r,o.firstChild))}function If(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function Kp(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var Qp=null;function pg(r,o,m){if(Qp===null){var E=new Map,L=Qp=new Map;L.set(m,E)}else L=Qp,E=L.get(m),E||(E=new Map,L.set(m,E));if(E.has(r))return E;for(E.set(r,null),m=m.getElementsByTagName(r),L=0;L<m.length;L++){var V=m[L];if(!(V[vn]||V[Ke]||r==="link"&&V.getAttribute("rel")==="stylesheet")&&V.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=V.getAttribute(o)||"";ne=r+ne;var Ae=E.get(ne);Ae?Ae.push(V):E.set(ne,[V])}}return E}function Mf(r,o,m){r=r.ownerDocument||r,r.head.insertBefore(m,o==="title"?r.querySelector("head > title"):null)}function Jp(r,o,m){if(m===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(r=o.disabled,typeof o.precedence=="string"&&r==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function kf(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function gg(r,o,m,E){if(m.type==="stylesheet"&&(typeof E.media!="string"||matchMedia(E.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var L=Nh(E.href),V=o.querySelector(Cd(L));if(V){o=V._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(r.count++,r=Df.bind(r),o.then(r,r)),m.state.loading|=4,m.instance=V,Dn(V);return}V=o.ownerDocument||o,E=hg(E),(L=Ca.get(L))&&If(E,L),V=V.createElement("link"),Dn(V);var ne=V;ne._p=new Promise(function(Ae,lt){ne.onload=Ae,ne.onerror=lt}),_a(V,"link",E),m.instance=V}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(m,o),(o=m.state.preload)&&(m.state.loading&3)===0&&(r.count++,m=Df.bind(r),o.addEventListener("load",m),o.addEventListener("error",m))}}var Nf=0;function mg(r,o){return r.stylesheets&&r.count===0&&Pf(r,r.stylesheets),0<r.count||0<r.imgCount?function(m){var E=setTimeout(function(){if(r.stylesheets&&Pf(r,r.stylesheets),r.unsuspend){var V=r.unsuspend;r.unsuspend=null,V()}},6e4+o);0<r.imgBytes&&Nf===0&&(Nf=62500*Ed());var L=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Pf(r,r.stylesheets),r.unsuspend)){var V=r.unsuspend;r.unsuspend=null,V()}},(r.imgBytes>Nf?50:800)+o);return r.unsuspend=m,function(){r.unsuspend=null,clearTimeout(E),clearTimeout(L)}}:null}function Df(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Pf(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Rf=null;function Pf(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Rf=new Map,o.forEach(Tm,r),Rf=null,Df.call(r))}function Tm(r,o){if(!(o.state.loading&4)){var m=Rf.get(r);if(m)var E=m.get(null);else{m=new Map,Rf.set(r,m);for(var L=r.querySelectorAll("link[data-precedence],style[data-precedence]"),V=0;V<L.length;V++){var ne=L[V];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(m.set(ne.dataset.precedence,ne),E=ne)}E&&m.set(null,E)}L=o.instance,ne=L.getAttribute("data-precedence"),V=m.get(ne)||E,V===E&&m.set(null,L),m.set(ne,L),this.count++,E=Df.bind(this),L.addEventListener("load",E),L.addEventListener("error",E),V?V.parentNode.insertBefore(L,V.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(L,r.firstChild)),o.state.loading|=4}}var Id={$$typeof:Xe,Provider:null,Consumer:null,_currentValue:ut,_currentValue2:ut,_threadCount:0};function B1(r,o,m,E,L,V,ne,Ae,lt){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ur(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ur(0),this.hiddenUpdates=ur(null),this.identifierPrefix=E,this.onUncaughtError=L,this.onCaughtError=V,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=lt,this.incompleteTransitions=new Map}function yg(r,o,m,E,L,V,ne,Ae,lt,Vt,rn,pn){return r=new B1(r,o,m,ne,lt,Vt,rn,pn,Ae),o=1,V===!0&&(o|=24),V=ao(3,null,null,o),r.current=V,V.stateNode=r,o=bl(),o.refCount++,r.pooledCache=o,o.refCount++,V.memoizedState={element:E,isDehydrated:m,cache:o},sd(V),r}function Im(r){return r?(r=Pi,r):Pi}function Mm(r,o,m,E,L,V){L=Im(L),E.context===null?E.context=L:E.pendingContext=L,E=Sl(o),E.payload={element:m},V=V===void 0?null:V,V!==null&&(E.callback=V),m=Yl(r,E,o),m!==null&&(Lo(m,r,o),Io(m,r,o))}function e0(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var m=r.retryLane;r.retryLane=m!==0&&m<o?m:o}}function t0(r,o){e0(r,o),(r=r.alternate)&&e0(r,o)}function km(r){if(r.tag===13||r.tag===31){var o=So(r,67108864);o!==null&&Lo(o,r,67108864),t0(r,67108864)}}function Nm(r){if(r.tag===13||r.tag===31){var o=zo();o=Nr(o);var m=So(r,o);m!==null&&Lo(m,r,o),t0(r,o)}}var Of=!0;function zf(r,o,m,E){var L=Te.T;Te.T=null;var V=Ze.p;try{Ze.p=2,xg(r,o,m,E)}finally{Ze.p=V,Te.T=L}}function Dm(r,o,m,E){var L=Te.T;Te.T=null;var V=Ze.p;try{Ze.p=8,xg(r,o,m,E)}finally{Ze.p=V,Te.T=L}}function xg(r,o,m,E){if(Of){var L=Lf(E);if(L===null)kc(r,o,E,Md,m),Rm(r,E);else if(j1(L,r,o,m,E))E.stopPropagation();else if(Rm(r,E),o&4&&-1<F1.indexOf(r)){for(;L!==null;){var V=Xn(L);if(V!==null)switch(V.tag){case 3:if(V=V.stateNode,V.current.memoizedState.isDehydrated){var ne=dt(V.pendingLanes);if(ne!==0){var Ae=V;for(Ae.pendingLanes|=2,Ae.entangledLanes|=2;ne;){var lt=1<<31-xt(ne);Ae.entanglements[1]|=lt,ne&=~lt}rc(V),(Vr&6)===0&&(yf=Di()+500,Jo(0))}}break;case 31:case 13:Ae=So(V,2),Ae!==null&&Lo(Ae,V,2),_f(),t0(V,2)}if(V=Lf(E),V===null&&kc(r,o,E,Md,m),V===L)break;L=V}L!==null&&E.stopPropagation()}else kc(r,o,E,null,m)}}function Lf(r){return r=ol(r),n0(r)}var Md=null;function n0(r){if(Md=null,r=ni(r),r!==null){var o=P(r);if(o===null)r=null;else{var m=o.tag;if(m===13){if(r=N(o),r!==null)return r;r=null}else if(m===31){if(r=h(o),r!==null)return r;r=null}else if(m===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return Md=r,null}function Dh(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(yr()){case yt:return 2;case oe:return 8;case le:case ge:return 32;case Ue:return 268435456;default:return 32}default:return 32}}var i0=!1,qu=null,Nl=null,Zu=null,Bf=new Map,kd=new Map,hu=[],F1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rm(r,o){switch(r){case"focusin":case"focusout":qu=null;break;case"dragenter":case"dragleave":Nl=null;break;case"mouseover":case"mouseout":Zu=null;break;case"pointerover":case"pointerout":Bf.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":kd.delete(o.pointerId)}}function Ff(r,o,m,E,L,V){return r===null||r.nativeEvent!==V?(r={blockedOn:o,domEventName:m,eventSystemFlags:E,nativeEvent:V,targetContainers:[L]},o!==null&&(o=Xn(o),o!==null&&km(o)),r):(r.eventSystemFlags|=E,o=r.targetContainers,L!==null&&o.indexOf(L)===-1&&o.push(L),r)}function j1(r,o,m,E,L){switch(o){case"focusin":return qu=Ff(qu,r,o,m,E,L),!0;case"dragenter":return Nl=Ff(Nl,r,o,m,E,L),!0;case"mouseover":return Zu=Ff(Zu,r,o,m,E,L),!0;case"pointerover":var V=L.pointerId;return Bf.set(V,Ff(Bf.get(V)||null,r,o,m,E,L)),!0;case"gotpointercapture":return V=L.pointerId,kd.set(V,Ff(kd.get(V)||null,r,o,m,E,L)),!0}return!1}function Pm(r){var o=ni(r.target);if(o!==null){var m=P(o);if(m!==null){if(o=m.tag,o===13){if(o=N(m),o!==null){r.blockedOn=o,Sn(r.priority,function(){Nm(m)});return}}else if(o===31){if(o=h(m),o!==null){r.blockedOn=o,Sn(r.priority,function(){Nm(m)});return}}else if(o===3&&m.stateNode.current.memoizedState.isDehydrated){r.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}r.blockedOn=null}function jf(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var m=Lf(r.nativeEvent);if(m===null){m=r.nativeEvent;var E=new m.constructor(m.type,m);zl=E,m.target.dispatchEvent(E),zl=null}else return o=Xn(m),o!==null&&km(o),r.blockedOn=m,!1;o.shift()}return!0}function Om(r,o,m){jf(r)&&m.delete(o)}function Uf(){i0=!1,qu!==null&&jf(qu)&&(qu=null),Nl!==null&&jf(Nl)&&(Nl=null),Zu!==null&&jf(Zu)&&(Zu=null),Bf.forEach(Om),kd.forEach(Om)}function r0(r,o){r.blockedOn===o&&(r.blockedOn=null,i0||(i0=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,Uf)))}var s0=null;function zm(r){s0!==r&&(s0=r,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){s0===r&&(s0=null);for(var o=0;o<r.length;o+=3){var m=r[o],E=r[o+1],L=r[o+2];if(typeof E!="function"){if(n0(E||m)===null)continue;break}var V=Xn(m);V!==null&&(r.splice(o,3),o-=3,ms(V,{pending:!0,data:L,method:m.method,action:E},E,L))}}))}function Xu(r){function o(lt){return r0(lt,r)}qu!==null&&r0(qu,r),Nl!==null&&r0(Nl,r),Zu!==null&&r0(Zu,r),Bf.forEach(o),kd.forEach(o);for(var m=0;m<hu.length;m++){var E=hu[m];E.blockedOn===r&&(E.blockedOn=null)}for(;0<hu.length&&(m=hu[0],m.blockedOn===null);)Pm(m),m.blockedOn===null&&hu.shift();if(m=(r.ownerDocument||r).$$reactFormReplay,m!=null)for(E=0;E<m.length;E+=3){var L=m[E],V=m[E+1],ne=L[je]||null;if(typeof V=="function")ne||zm(m);else if(ne){var Ae=null;if(V&&V.hasAttribute("formAction")){if(L=V,ne=V[je]||null)Ae=ne.formAction;else if(n0(L)!==null)continue}else Ae=ne.action;typeof Ae=="function"?m[E+1]=Ae:(m.splice(E,3),E-=3),zm(m)}}}function _g(){function r(V){V.canIntercept&&V.info==="react-transition"&&V.intercept({handler:function(){return new Promise(function(ne){return L=ne})},focusReset:"manual",scroll:"manual"})}function o(){L!==null&&(L(),L=null),E||setTimeout(m,20)}function m(){if(!E&&!navigation.transition){var V=navigation.currentEntry;V&&V.url!=null&&navigation.navigate(V.url,{state:V.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var E=!1,L=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(m,100),function(){E=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),L!==null&&(L(),L=null)}}}function bg(r){this._internalRoot=r}a0.prototype.render=bg.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(C(409));var m=o.current,E=zo();Mm(m,E,r,o,null,null)},a0.prototype.unmount=bg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;Mm(r.current,2,null,r,null,null),_f(),o[Mt]=null}};function a0(r){this._internalRoot=r}a0.prototype.unstable_scheduleHydration=function(r){if(r){var o=gi();r={blockedOn:null,target:r,priority:o};for(var m=0;m<hu.length&&o!==0&&o<hu[m].priority;m++);hu.splice(m,0,r),m===0&&Pm(r)}};var vg=d.version;if(vg!=="19.2.3")throw Error(C(527,vg,"19.2.3"));Ze.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(C(188)):(r=Object.keys(r).join(","),Error(C(268,r)));return r=H(o),r=r!==null?Y(r):null,r=r===null?null:r.stateNode,r};var Lm={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Te,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var o0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!o0.isDisabled&&o0.supportsFiber)try{it=o0.inject(Lm),de=o0}catch{}}return Tg.createRoot=function(r,o){if(!D(r))throw Error(C(299));var m=!1,E="",L=cd,V=ec,ne=tc;return o!=null&&(o.unstable_strictMode===!0&&(m=!0),o.identifierPrefix!==void 0&&(E=o.identifierPrefix),o.onUncaughtError!==void 0&&(L=o.onUncaughtError),o.onCaughtError!==void 0&&(V=o.onCaughtError),o.onRecoverableError!==void 0&&(ne=o.onRecoverableError)),o=yg(r,1,!1,null,null,m,E,null,L,V,ne,_g),r[Mt]=o.current,Q0(r),new bg(o)},Tg.hydrateRoot=function(r,o,m){if(!D(r))throw Error(C(299));var E=!1,L="",V=cd,ne=ec,Ae=tc,lt=null;return m!=null&&(m.unstable_strictMode===!0&&(E=!0),m.identifierPrefix!==void 0&&(L=m.identifierPrefix),m.onUncaughtError!==void 0&&(V=m.onUncaughtError),m.onCaughtError!==void 0&&(ne=m.onCaughtError),m.onRecoverableError!==void 0&&(Ae=m.onRecoverableError),m.formState!==void 0&&(lt=m.formState)),o=yg(r,1,!0,o,m??null,E,L,lt,V,ne,Ae,_g),o.context=Im(null),m=o.current,E=zo(),E=Nr(E),L=Sl(E),L.callback=null,Yl(m,L,E),m=E,o.current.lanes=m,Ti(o,m),rc(o),r[Mt]=o.current,Q0(r),new a0(o)},Tg.version="19.2.3",Tg}var Qx;function cw(){if(Qx)return Q1.exports;Qx=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(d){console.error(d)}}return c(),Q1.exports=lw(),Q1.exports}var uw=cw();const hw=rp(uw),dw="modulepreload",fw=function(c){return"/parlens-pwa/"+c},Jx={},Qm=function(d,y,C){let D=Promise.resolve();if(y&&y.length>0){let H=function(Y){return Promise.all(Y.map(K=>Promise.resolve(K).then(_e=>({status:"fulfilled",value:_e}),_e=>({status:"rejected",reason:_e}))))};var N=H;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),U=h?.nonce||h?.getAttribute("nonce");D=H(y.map(Y=>{if(Y=fw(Y),Y in Jx)return;Jx[Y]=!0;const K=Y.endsWith(".css"),_e=K?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Y}"]${_e}`))return;const we=document.createElement("link");if(we.rel=K?"stylesheet":dw,K||(we.as="script"),we.crossOrigin="",we.href=Y,U&&we.setAttribute("nonce",U),document.head.appendChild(we),K)return new Promise((ve,pe)=>{we.addEventListener("load",ve),we.addEventListener("error",()=>pe(new Error(`Unable to preload CSS for ${Y}`)))})}))}function P(h){const U=new Event("vite:preloadError",{cancelable:!0});if(U.payload=h,window.dispatchEvent(U),!U.defaultPrevented)throw h}return D.then(h=>{for(const U of h||[])U.status==="rejected"&&P(U.reason);return d().catch(P)})};function e_(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`Wrong positive integer: ${c}`)}function fb(c,...d){if(!(c instanceof Uint8Array))throw new Error("Expected Uint8Array");if(d.length>0&&!d.includes(c.length))throw new Error(`Expected Uint8Array of length ${d}, not of length=${c.length}`)}function pw(c){if(typeof c!="function"||typeof c.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");e_(c.outputLen),e_(c.blockLen)}function Jm(c,d=!0){if(c.destroyed)throw new Error("Hash instance has been destroyed");if(d&&c.finished)throw new Error("Hash#digest() has already been called")}function gw(c,d){fb(c);const y=d.outputLen;if(c.length<y)throw new Error(`digestInto() expects output buffer of length at least ${y}`)}const ny=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const pb=c=>c instanceof Uint8Array,iy=c=>new DataView(c.buffer,c.byteOffset,c.byteLength),Yu=(c,d)=>c<<32-d|c>>>d,mw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mw)throw new Error("Non little-endian hardware is not supported");function yw(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function qy(c){if(typeof c=="string"&&(c=yw(c)),!pb(c))throw new Error(`expected Uint8Array, got ${typeof c}`);return c}function xw(...c){const d=new Uint8Array(c.reduce((C,D)=>C+D.length,0));let y=0;return c.forEach(C=>{if(!pb(C))throw new Error("Uint8Array expected");d.set(C,y),y+=C.length}),d}let gb=class{clone(){return this._cloneInto()}};function _w(c){const d=C=>c().update(qy(C)).digest(),y=c();return d.outputLen=y.outputLen,d.blockLen=y.blockLen,d.create=()=>c(),d}function mb(c=32){if(ny&&typeof ny.getRandomValues=="function")return ny.getRandomValues(new Uint8Array(c));throw new Error("crypto.getRandomValues must be defined")}function bw(c,d,y,C){if(typeof c.setBigUint64=="function")return c.setBigUint64(d,y,C);const D=BigInt(32),P=BigInt(4294967295),N=Number(y>>D&P),h=Number(y&P),U=C?4:0,H=C?0:4;c.setUint32(d+U,N,C),c.setUint32(d+H,h,C)}let vw=class extends gb{constructor(d,y,C,D){super(),this.blockLen=d,this.outputLen=y,this.padOffset=C,this.isLE=D,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(d),this.view=iy(this.buffer)}update(d){Jm(this);const{view:y,buffer:C,blockLen:D}=this;d=qy(d);const P=d.length;for(let N=0;N<P;){const h=Math.min(D-this.pos,P-N);if(h===D){const U=iy(d);for(;D<=P-N;N+=D)this.process(U,N);continue}C.set(d.subarray(N,N+h),this.pos),this.pos+=h,N+=h,this.pos===D&&(this.process(y,0),this.pos=0)}return this.length+=d.length,this.roundClean(),this}digestInto(d){Jm(this),gw(d,this),this.finished=!0;const{buffer:y,view:C,blockLen:D,isLE:P}=this;let{pos:N}=this;y[N++]=128,this.buffer.subarray(N).fill(0),this.padOffset>D-N&&(this.process(C,0),N=0);for(let K=N;K<D;K++)y[K]=0;bw(C,D-8,BigInt(this.length*8),P),this.process(C,0);const h=iy(d),U=this.outputLen;if(U%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const H=U/4,Y=this.get();if(H>Y.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<H;K++)h.setUint32(4*K,Y[K],P)}digest(){const{buffer:d,outputLen:y}=this;this.digestInto(d);const C=d.slice(0,y);return this.destroy(),C}_cloneInto(d){d||(d=new this.constructor),d.set(...this.get());const{blockLen:y,buffer:C,length:D,finished:P,destroyed:N,pos:h}=this;return d.length=D,d.pos=h,d.finished=P,d.destroyed=N,D%y&&d.buffer.set(C),d}};const ww=(c,d,y)=>c&d^~c&y,Aw=(c,d,y)=>c&d^c&y^d&y,Ew=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Dd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Rd=new Uint32Array(64);let Sw=class extends vw{constructor(){super(64,32,8,!1),this.A=Dd[0]|0,this.B=Dd[1]|0,this.C=Dd[2]|0,this.D=Dd[3]|0,this.E=Dd[4]|0,this.F=Dd[5]|0,this.G=Dd[6]|0,this.H=Dd[7]|0}get(){const{A:d,B:y,C,D,E:P,F:N,G:h,H:U}=this;return[d,y,C,D,P,N,h,U]}set(d,y,C,D,P,N,h,U){this.A=d|0,this.B=y|0,this.C=C|0,this.D=D|0,this.E=P|0,this.F=N|0,this.G=h|0,this.H=U|0}process(d,y){for(let K=0;K<16;K++,y+=4)Rd[K]=d.getUint32(y,!1);for(let K=16;K<64;K++){const _e=Rd[K-15],we=Rd[K-2],ve=Yu(_e,7)^Yu(_e,18)^_e>>>3,pe=Yu(we,17)^Yu(we,19)^we>>>10;Rd[K]=pe+Rd[K-7]+ve+Rd[K-16]|0}let{A:C,B:D,C:P,D:N,E:h,F:U,G:H,H:Y}=this;for(let K=0;K<64;K++){const _e=Yu(h,6)^Yu(h,11)^Yu(h,25),we=Y+_e+ww(h,U,H)+Ew[K]+Rd[K]|0,pe=(Yu(C,2)^Yu(C,13)^Yu(C,22))+Aw(C,D,P)|0;Y=H,H=U,U=h,h=N+we|0,N=P,P=D,D=C,C=we+pe|0}C=C+this.A|0,D=D+this.B|0,P=P+this.C|0,N=N+this.D|0,h=h+this.E|0,U=U+this.F|0,H=H+this.G|0,Y=Y+this.H|0,this.set(C,D,P,N,h,U,H,Y)}roundClean(){Rd.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const wy=_w(()=>new Sw);const yb=BigInt(0),f1=BigInt(1),Cw=BigInt(2),p1=c=>c instanceof Uint8Array,Tw=Array.from({length:256},(c,d)=>d.toString(16).padStart(2,"0"));function y0(c){if(!p1(c))throw new Error("Uint8Array expected");let d="";for(let y=0;y<c.length;y++)d+=Tw[c[y]];return d}function xb(c){const d=c.toString(16);return d.length&1?`0${d}`:d}function Zy(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);return BigInt(c===""?"0":`0x${c}`)}function x0(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const d=c.length;if(d%2)throw new Error("padded hex string expected, got unpadded hex of length "+d);const y=new Uint8Array(d/2);for(let C=0;C<y.length;C++){const D=C*2,P=c.slice(D,D+2),N=Number.parseInt(P,16);if(Number.isNaN(N)||N<0)throw new Error("Invalid byte sequence");y[C]=N}return y}function Ol(c){return Zy(y0(c))}function Xy(c){if(!p1(c))throw new Error("Uint8Array expected");return Zy(y0(Uint8Array.from(c).reverse()))}function jd(c,d){return x0(c.toString(16).padStart(d*2,"0"))}function Wy(c,d){return jd(c,d).reverse()}function Iw(c){return x0(xb(c))}function jo(c,d,y){let C;if(typeof d=="string")try{C=x0(d)}catch(P){throw new Error(`${c} must be valid hex string, got "${d}". Cause: ${P}`)}else if(p1(d))C=Uint8Array.from(d);else throw new Error(`${c} must be hex string or Uint8Array`);const D=C.length;if(typeof y=="number"&&D!==y)throw new Error(`${c} expected ${y} bytes, got ${D}`);return C}function ep(...c){const d=new Uint8Array(c.reduce((C,D)=>C+D.length,0));let y=0;return c.forEach(C=>{if(!p1(C))throw new Error("Uint8Array expected");d.set(C,y),y+=C.length}),d}function Mw(c,d){if(c.length!==d.length)return!1;for(let y=0;y<c.length;y++)if(c[y]!==d[y])return!1;return!0}function kw(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function Nw(c){let d;for(d=0;c>yb;c>>=f1,d+=1);return d}function Dw(c,d){return c>>BigInt(d)&f1}const Rw=(c,d,y)=>c|(y?f1:yb)<<BigInt(d),Yy=c=>(Cw<<BigInt(c-1))-f1,ry=c=>new Uint8Array(c),t_=c=>Uint8Array.from(c);function _b(c,d,y){if(typeof c!="number"||c<2)throw new Error("hashLen must be a number");if(typeof d!="number"||d<2)throw new Error("qByteLen must be a number");if(typeof y!="function")throw new Error("hmacFn must be a function");let C=ry(c),D=ry(c),P=0;const N=()=>{C.fill(1),D.fill(0),P=0},h=(...K)=>y(D,C,...K),U=(K=ry())=>{D=h(t_([0]),K),C=h(),K.length!==0&&(D=h(t_([1]),K),C=h())},H=()=>{if(P++>=1e3)throw new Error("drbg: tried 1000 values");let K=0;const _e=[];for(;K<d;){C=h();const we=C.slice();_e.push(we),K+=C.length}return ep(..._e)};return(K,_e)=>{N(),U(K);let we;for(;!(we=_e(H()));)U();return N(),we}}const Pw={bigint:c=>typeof c=="bigint",function:c=>typeof c=="function",boolean:c=>typeof c=="boolean",string:c=>typeof c=="string",stringOrUint8Array:c=>typeof c=="string"||c instanceof Uint8Array,isSafeInteger:c=>Number.isSafeInteger(c),array:c=>Array.isArray(c),field:(c,d)=>d.Fp.isValid(c),hash:c=>typeof c=="function"&&Number.isSafeInteger(c.outputLen)};function Fg(c,d,y={}){const C=(D,P,N)=>{const h=Pw[P];if(typeof h!="function")throw new Error(`Invalid validator "${P}", expected function`);const U=c[D];if(!(N&&U===void 0)&&!h(U,c))throw new Error(`Invalid param ${String(D)}=${U} (${typeof U}), expected ${P}`)};for(const[D,P]of Object.entries(d))C(D,P,!1);for(const[D,P]of Object.entries(y))C(D,P,!0);return c}const Ow=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Dw,bitLen:Nw,bitMask:Yy,bitSet:Rw,bytesToHex:y0,bytesToNumberBE:Ol,bytesToNumberLE:Xy,concatBytes:ep,createHmacDrbg:_b,ensureBytes:jo,equalBytes:Mw,hexToBytes:x0,hexToNumber:Zy,numberToBytesBE:jd,numberToBytesLE:Wy,numberToHexUnpadded:xb,numberToVarBytesBE:Iw,utf8ToBytes:kw,validateObject:Fg},Symbol.toStringTag,{value:"Module"}));const to=BigInt(0),ba=BigInt(1),Yf=BigInt(2),zw=BigInt(3),Ay=BigInt(4),n_=BigInt(5),i_=BigInt(8);BigInt(9);BigInt(16);function bo(c,d){const y=c%d;return y>=to?y:d+y}function Lw(c,d,y){if(y<=to||d<to)throw new Error("Expected power/modulo > 0");if(y===ba)return to;let C=ba;for(;d>to;)d&ba&&(C=C*c%y),c=c*c%y,d>>=ba;return C}function Rc(c,d,y){let C=c;for(;d-- >to;)C*=C,C%=y;return C}function Ey(c,d){if(c===to||d<=to)throw new Error(`invert: expected positive integers, got n=${c} mod=${d}`);let y=bo(c,d),C=d,D=to,P=ba;for(;y!==to;){const h=C/y,U=C%y,H=D-P*h;C=y,y=U,D=P,P=H}if(C!==ba)throw new Error("invert: does not exist");return bo(D,d)}function Bw(c){const d=(c-ba)/Yf;let y,C,D;for(y=c-ba,C=0;y%Yf===to;y/=Yf,C++);for(D=Yf;D<c&&Lw(D,d,c)!==c-ba;D++);if(C===1){const N=(c+ba)/Ay;return function(U,H){const Y=U.pow(H,N);if(!U.eql(U.sqr(Y),H))throw new Error("Cannot find square root");return Y}}const P=(y+ba)/Yf;return function(h,U){if(h.pow(U,d)===h.neg(h.ONE))throw new Error("Cannot find square root");let H=C,Y=h.pow(h.mul(h.ONE,D),y),K=h.pow(U,P),_e=h.pow(U,y);for(;!h.eql(_e,h.ONE);){if(h.eql(_e,h.ZERO))return h.ZERO;let we=1;for(let pe=h.sqr(_e);we<H&&!h.eql(pe,h.ONE);we++)pe=h.sqr(pe);const ve=h.pow(Y,ba<<BigInt(H-we-1));Y=h.sqr(ve),K=h.mul(K,ve),_e=h.mul(_e,Y),H=we}return K}}function Fw(c){if(c%Ay===zw){const d=(c+ba)/Ay;return function(C,D){const P=C.pow(D,d);if(!C.eql(C.sqr(P),D))throw new Error("Cannot find square root");return P}}if(c%i_===n_){const d=(c-n_)/i_;return function(C,D){const P=C.mul(D,Yf),N=C.pow(P,d),h=C.mul(D,N),U=C.mul(C.mul(h,Yf),N),H=C.mul(h,C.sub(U,C.ONE));if(!C.eql(C.sqr(H),D))throw new Error("Cannot find square root");return H}}return Bw(c)}const jw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Uw(c){const d={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},y=jw.reduce((C,D)=>(C[D]="function",C),d);return Fg(c,y)}function Vw(c,d,y){if(y<to)throw new Error("Expected power > 0");if(y===to)return c.ONE;if(y===ba)return d;let C=c.ONE,D=d;for(;y>to;)y&ba&&(C=c.mul(C,D)),D=c.sqr(D),y>>=ba;return C}function Gw(c,d){const y=new Array(d.length),C=d.reduce((P,N,h)=>c.is0(N)?P:(y[h]=P,c.mul(P,N)),c.ONE),D=c.inv(C);return d.reduceRight((P,N,h)=>c.is0(N)?P:(y[h]=c.mul(P,y[h]),c.mul(P,N)),D),y}function bb(c,d){const y=d!==void 0?d:c.toString(2).length,C=Math.ceil(y/8);return{nBitLength:y,nByteLength:C}}function Hw(c,d,y=!1,C={}){if(c<=to)throw new Error(`Expected Field ORDER > 0, got ${c}`);const{nBitLength:D,nByteLength:P}=bb(c,d);if(P>2048)throw new Error("Field lengths over 2048 bytes are not supported");const N=Fw(c),h=Object.freeze({ORDER:c,BITS:D,BYTES:P,MASK:Yy(D),ZERO:to,ONE:ba,create:U=>bo(U,c),isValid:U=>{if(typeof U!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof U}`);return to<=U&&U<c},is0:U=>U===to,isOdd:U=>(U&ba)===ba,neg:U=>bo(-U,c),eql:(U,H)=>U===H,sqr:U=>bo(U*U,c),add:(U,H)=>bo(U+H,c),sub:(U,H)=>bo(U-H,c),mul:(U,H)=>bo(U*H,c),pow:(U,H)=>Vw(h,U,H),div:(U,H)=>bo(U*Ey(H,c),c),sqrN:U=>U*U,addN:(U,H)=>U+H,subN:(U,H)=>U-H,mulN:(U,H)=>U*H,inv:U=>Ey(U,c),sqrt:C.sqrt||(U=>N(h,U)),invertBatch:U=>Gw(h,U),cmov:(U,H,Y)=>Y?H:U,toBytes:U=>y?Wy(U,P):jd(U,P),fromBytes:U=>{if(U.length!==P)throw new Error(`Fp.fromBytes: expected ${P}, got ${U.length}`);return y?Xy(U):Ol(U)}});return Object.freeze(h)}function vb(c){if(typeof c!="bigint")throw new Error("field order must be bigint");const d=c.toString(2).length;return Math.ceil(d/8)}function wb(c){const d=vb(c);return d+Math.ceil(d/2)}function qw(c,d,y=!1){const C=c.length,D=vb(d),P=wb(d);if(C<16||C<P||C>1024)throw new Error(`expected ${P}-1024 bytes of input, got ${C}`);const N=y?Ol(c):Xy(c),h=bo(N,d-ba)+ba;return y?Wy(h,D):jd(h,D)}const Zw=BigInt(0),sy=BigInt(1);function Xw(c,d){const y=(D,P)=>{const N=P.negate();return D?N:P},C=D=>{const P=Math.ceil(d/D)+1,N=2**(D-1);return{windows:P,windowSize:N}};return{constTimeNegate:y,unsafeLadder(D,P){let N=c.ZERO,h=D;for(;P>Zw;)P&sy&&(N=N.add(h)),h=h.double(),P>>=sy;return N},precomputeWindow(D,P){const{windows:N,windowSize:h}=C(P),U=[];let H=D,Y=H;for(let K=0;K<N;K++){Y=H,U.push(Y);for(let _e=1;_e<h;_e++)Y=Y.add(H),U.push(Y);H=Y.double()}return U},wNAF(D,P,N){const{windows:h,windowSize:U}=C(D);let H=c.ZERO,Y=c.BASE;const K=BigInt(2**D-1),_e=2**D,we=BigInt(D);for(let ve=0;ve<h;ve++){const pe=ve*U;let he=Number(N&K);N>>=we,he>U&&(he-=_e,N+=sy);const De=pe,Je=pe+Math.abs(he)-1,Xe=ve%2!==0,mt=he<0;he===0?Y=Y.add(y(Xe,P[De])):H=H.add(y(mt,P[Je]))}return{p:H,f:Y}},wNAFCached(D,P,N,h){const U=D._WINDOW_SIZE||1;let H=P.get(D);return H||(H=this.precomputeWindow(D,U),U!==1&&P.set(D,h(H))),this.wNAF(U,H,N)}}}function Ab(c){return Uw(c.Fp),Fg(c,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bb(c.n,c.nBitLength),...c,p:c.Fp.ORDER})}function Ww(c){const d=Ab(c);Fg(d,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:y,Fp:C,a:D}=d;if(y){if(!C.eql(D,C.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof y!="object"||typeof y.beta!="bigint"||typeof y.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...d})}const{bytesToNumberBE:Yw,hexToBytes:$w}=Ow,Kf={Err:class extends Error{constructor(d=""){super(d)}},_parseInt(c){const{Err:d}=Kf;if(c.length<2||c[0]!==2)throw new d("Invalid signature integer tag");const y=c[1],C=c.subarray(2,y+2);if(!y||C.length!==y)throw new d("Invalid signature integer: wrong length");if(C[0]&128)throw new d("Invalid signature integer: negative");if(C[0]===0&&!(C[1]&128))throw new d("Invalid signature integer: unnecessary leading zero");return{d:Yw(C),l:c.subarray(y+2)}},toSig(c){const{Err:d}=Kf,y=typeof c=="string"?$w(c):c;if(!(y instanceof Uint8Array))throw new Error("ui8a expected");let C=y.length;if(C<2||y[0]!=48)throw new d("Invalid signature tag");if(y[1]!==C-2)throw new d("Invalid signature: incorrect length");const{d:D,l:P}=Kf._parseInt(y.subarray(2)),{d:N,l:h}=Kf._parseInt(P);if(h.length)throw new d("Invalid signature: left bytes after parsing");return{r:D,s:N}},hexFromSig(c){const d=H=>Number.parseInt(H[0],16)&8?"00"+H:H,y=H=>{const Y=H.toString(16);return Y.length&1?`0${Y}`:Y},C=d(y(c.s)),D=d(y(c.r)),P=C.length/2,N=D.length/2,h=y(P),U=y(N);return`30${y(N+P+4)}02${U}${D}02${h}${C}`}},Bh=BigInt(0),Oc=BigInt(1);BigInt(2);const r_=BigInt(3);BigInt(4);function Kw(c){const d=Ww(c),{Fp:y}=d,C=d.toBytes||((ve,pe,he)=>{const De=pe.toAffine();return ep(Uint8Array.from([4]),y.toBytes(De.x),y.toBytes(De.y))}),D=d.fromBytes||(ve=>{const pe=ve.subarray(1),he=y.fromBytes(pe.subarray(0,y.BYTES)),De=y.fromBytes(pe.subarray(y.BYTES,2*y.BYTES));return{x:he,y:De}});function P(ve){const{a:pe,b:he}=d,De=y.sqr(ve),Je=y.mul(De,ve);return y.add(y.add(Je,y.mul(ve,pe)),he)}if(!y.eql(y.sqr(d.Gy),P(d.Gx)))throw new Error("bad generator point: equation left != right");function N(ve){return typeof ve=="bigint"&&Bh<ve&&ve<d.n}function h(ve){if(!N(ve))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function U(ve){const{allowedPrivateKeyLengths:pe,nByteLength:he,wrapPrivateKey:De,n:Je}=d;if(pe&&typeof ve!="bigint"){if(ve instanceof Uint8Array&&(ve=y0(ve)),typeof ve!="string"||!pe.includes(ve.length))throw new Error("Invalid key");ve=ve.padStart(he*2,"0")}let Xe;try{Xe=typeof ve=="bigint"?ve:Ol(jo("private key",ve,he))}catch{throw new Error(`private key must be ${he} bytes, hex or bigint, not ${typeof ve}`)}return De&&(Xe=bo(Xe,Je)),h(Xe),Xe}const H=new Map;function Y(ve){if(!(ve instanceof K))throw new Error("ProjectivePoint expected")}class K{constructor(pe,he,De){if(this.px=pe,this.py=he,this.pz=De,pe==null||!y.isValid(pe))throw new Error("x required");if(he==null||!y.isValid(he))throw new Error("y required");if(De==null||!y.isValid(De))throw new Error("z required")}static fromAffine(pe){const{x:he,y:De}=pe||{};if(!pe||!y.isValid(he)||!y.isValid(De))throw new Error("invalid affine point");if(pe instanceof K)throw new Error("projective point not allowed");const Je=Xe=>y.eql(Xe,y.ZERO);return Je(he)&&Je(De)?K.ZERO:new K(he,De,y.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(pe){const he=y.invertBatch(pe.map(De=>De.pz));return pe.map((De,Je)=>De.toAffine(he[Je])).map(K.fromAffine)}static fromHex(pe){const he=K.fromAffine(D(jo("pointHex",pe)));return he.assertValidity(),he}static fromPrivateKey(pe){return K.BASE.multiply(U(pe))}_setWindowSize(pe){this._WINDOW_SIZE=pe,H.delete(this)}assertValidity(){if(this.is0()){if(d.allowInfinityPoint&&!y.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:pe,y:he}=this.toAffine();if(!y.isValid(pe)||!y.isValid(he))throw new Error("bad point: x or y not FE");const De=y.sqr(he),Je=P(pe);if(!y.eql(De,Je))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:pe}=this.toAffine();if(y.isOdd)return!y.isOdd(pe);throw new Error("Field doesn't support isOdd")}equals(pe){Y(pe);const{px:he,py:De,pz:Je}=this,{px:Xe,py:mt,pz:Wt}=pe,Et=y.eql(y.mul(he,Wt),y.mul(Xe,Je)),rt=y.eql(y.mul(De,Wt),y.mul(mt,Je));return Et&&rt}negate(){return new K(this.px,y.neg(this.py),this.pz)}double(){const{a:pe,b:he}=d,De=y.mul(he,r_),{px:Je,py:Xe,pz:mt}=this;let Wt=y.ZERO,Et=y.ZERO,rt=y.ZERO,at=y.mul(Je,Je),He=y.mul(Xe,Xe),_t=y.mul(mt,mt),Pe=y.mul(Je,Xe);return Pe=y.add(Pe,Pe),rt=y.mul(Je,mt),rt=y.add(rt,rt),Wt=y.mul(pe,rt),Et=y.mul(De,_t),Et=y.add(Wt,Et),Wt=y.sub(He,Et),Et=y.add(He,Et),Et=y.mul(Wt,Et),Wt=y.mul(Pe,Wt),rt=y.mul(De,rt),_t=y.mul(pe,_t),Pe=y.sub(at,_t),Pe=y.mul(pe,Pe),Pe=y.add(Pe,rt),rt=y.add(at,at),at=y.add(rt,at),at=y.add(at,_t),at=y.mul(at,Pe),Et=y.add(Et,at),_t=y.mul(Xe,mt),_t=y.add(_t,_t),at=y.mul(_t,Pe),Wt=y.sub(Wt,at),rt=y.mul(_t,He),rt=y.add(rt,rt),rt=y.add(rt,rt),new K(Wt,Et,rt)}add(pe){Y(pe);const{px:he,py:De,pz:Je}=this,{px:Xe,py:mt,pz:Wt}=pe;let Et=y.ZERO,rt=y.ZERO,at=y.ZERO;const He=d.a,_t=y.mul(d.b,r_);let Pe=y.mul(he,Xe),ht=y.mul(De,mt),vt=y.mul(Je,Wt),qt=y.add(he,De),ke=y.add(Xe,mt);qt=y.mul(qt,ke),ke=y.add(Pe,ht),qt=y.sub(qt,ke),ke=y.add(he,Je);let Te=y.add(Xe,Wt);return ke=y.mul(ke,Te),Te=y.add(Pe,vt),ke=y.sub(ke,Te),Te=y.add(De,Je),Et=y.add(mt,Wt),Te=y.mul(Te,Et),Et=y.add(ht,vt),Te=y.sub(Te,Et),at=y.mul(He,ke),Et=y.mul(_t,vt),at=y.add(Et,at),Et=y.sub(ht,at),at=y.add(ht,at),rt=y.mul(Et,at),ht=y.add(Pe,Pe),ht=y.add(ht,Pe),vt=y.mul(He,vt),ke=y.mul(_t,ke),ht=y.add(ht,vt),vt=y.sub(Pe,vt),vt=y.mul(He,vt),ke=y.add(ke,vt),Pe=y.mul(ht,ke),rt=y.add(rt,Pe),Pe=y.mul(Te,ke),Et=y.mul(qt,Et),Et=y.sub(Et,Pe),Pe=y.mul(qt,ht),at=y.mul(Te,at),at=y.add(at,Pe),new K(Et,rt,at)}subtract(pe){return this.add(pe.negate())}is0(){return this.equals(K.ZERO)}wNAF(pe){return we.wNAFCached(this,H,pe,he=>{const De=y.invertBatch(he.map(Je=>Je.pz));return he.map((Je,Xe)=>Je.toAffine(De[Xe])).map(K.fromAffine)})}multiplyUnsafe(pe){const he=K.ZERO;if(pe===Bh)return he;if(h(pe),pe===Oc)return this;const{endo:De}=d;if(!De)return we.unsafeLadder(this,pe);let{k1neg:Je,k1:Xe,k2neg:mt,k2:Wt}=De.splitScalar(pe),Et=he,rt=he,at=this;for(;Xe>Bh||Wt>Bh;)Xe&Oc&&(Et=Et.add(at)),Wt&Oc&&(rt=rt.add(at)),at=at.double(),Xe>>=Oc,Wt>>=Oc;return Je&&(Et=Et.negate()),mt&&(rt=rt.negate()),rt=new K(y.mul(rt.px,De.beta),rt.py,rt.pz),Et.add(rt)}multiply(pe){h(pe);let he=pe,De,Je;const{endo:Xe}=d;if(Xe){const{k1neg:mt,k1:Wt,k2neg:Et,k2:rt}=Xe.splitScalar(he);let{p:at,f:He}=this.wNAF(Wt),{p:_t,f:Pe}=this.wNAF(rt);at=we.constTimeNegate(mt,at),_t=we.constTimeNegate(Et,_t),_t=new K(y.mul(_t.px,Xe.beta),_t.py,_t.pz),De=at.add(_t),Je=He.add(Pe)}else{const{p:mt,f:Wt}=this.wNAF(he);De=mt,Je=Wt}return K.normalizeZ([De,Je])[0]}multiplyAndAddUnsafe(pe,he,De){const Je=K.BASE,Xe=(Wt,Et)=>Et===Bh||Et===Oc||!Wt.equals(Je)?Wt.multiplyUnsafe(Et):Wt.multiply(Et),mt=Xe(this,he).add(Xe(pe,De));return mt.is0()?void 0:mt}toAffine(pe){const{px:he,py:De,pz:Je}=this,Xe=this.is0();pe==null&&(pe=Xe?y.ONE:y.inv(Je));const mt=y.mul(he,pe),Wt=y.mul(De,pe),Et=y.mul(Je,pe);if(Xe)return{x:y.ZERO,y:y.ZERO};if(!y.eql(Et,y.ONE))throw new Error("invZ was invalid");return{x:mt,y:Wt}}isTorsionFree(){const{h:pe,isTorsionFree:he}=d;if(pe===Oc)return!0;if(he)return he(K,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:pe,clearCofactor:he}=d;return pe===Oc?this:he?he(K,this):this.multiplyUnsafe(d.h)}toRawBytes(pe=!0){return this.assertValidity(),C(K,this,pe)}toHex(pe=!0){return y0(this.toRawBytes(pe))}}K.BASE=new K(d.Gx,d.Gy,y.ONE),K.ZERO=new K(y.ZERO,y.ONE,y.ZERO);const _e=d.nBitLength,we=Xw(K,d.endo?Math.ceil(_e/2):_e);return{CURVE:d,ProjectivePoint:K,normPrivateKeyToScalar:U,weierstrassEquation:P,isWithinCurveOrder:N}}function Qw(c){const d=Ab(c);return Fg(d,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...d})}function Jw(c){const d=Qw(c),{Fp:y,n:C}=d,D=y.BYTES+1,P=2*y.BYTES+1;function N(ke){return Bh<ke&&ke<y.ORDER}function h(ke){return bo(ke,C)}function U(ke){return Ey(ke,C)}const{ProjectivePoint:H,normPrivateKeyToScalar:Y,weierstrassEquation:K,isWithinCurveOrder:_e}=Kw({...d,toBytes(ke,Te,Ze){const ut=Te.toAffine(),Tt=y.toBytes(ut.x),sn=ep;return Ze?sn(Uint8Array.from([Te.hasEvenY()?2:3]),Tt):sn(Uint8Array.from([4]),Tt,y.toBytes(ut.y))},fromBytes(ke){const Te=ke.length,Ze=ke[0],ut=ke.subarray(1);if(Te===D&&(Ze===2||Ze===3)){const Tt=Ol(ut);if(!N(Tt))throw new Error("Point is not on curve");const sn=K(Tt);let Re=y.sqrt(sn);const ct=(Re&Oc)===Oc;return(Ze&1)===1!==ct&&(Re=y.neg(Re)),{x:Tt,y:Re}}else if(Te===P&&Ze===4){const Tt=y.fromBytes(ut.subarray(0,y.BYTES)),sn=y.fromBytes(ut.subarray(y.BYTES,2*y.BYTES));return{x:Tt,y:sn}}else throw new Error(`Point of length ${Te} was invalid. Expected ${D} compressed bytes or ${P} uncompressed bytes`)}}),we=ke=>y0(jd(ke,d.nByteLength));function ve(ke){const Te=C>>Oc;return ke>Te}function pe(ke){return ve(ke)?h(-ke):ke}const he=(ke,Te,Ze)=>Ol(ke.slice(Te,Ze));class De{constructor(Te,Ze,ut){this.r=Te,this.s=Ze,this.recovery=ut,this.assertValidity()}static fromCompact(Te){const Ze=d.nByteLength;return Te=jo("compactSignature",Te,Ze*2),new De(he(Te,0,Ze),he(Te,Ze,2*Ze))}static fromDER(Te){const{r:Ze,s:ut}=Kf.toSig(jo("DER",Te));return new De(Ze,ut)}assertValidity(){if(!_e(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!_e(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Te){return new De(this.r,this.s,Te)}recoverPublicKey(Te){const{r:Ze,s:ut,recovery:Tt}=this,sn=rt(jo("msgHash",Te));if(Tt==null||![0,1,2,3].includes(Tt))throw new Error("recovery id invalid");const Re=Tt===2||Tt===3?Ze+d.n:Ze;if(Re>=y.ORDER)throw new Error("recovery id 2 or 3 invalid");const ct=(Tt&1)===0?"02":"03",kt=H.fromHex(ct+we(Re)),bt=U(Re),an=h(-sn*bt),Bt=h(ut*bt),Qt=H.BASE.multiplyAndAddUnsafe(kt,an,Bt);if(!Qt)throw new Error("point at infinify");return Qt.assertValidity(),Qt}hasHighS(){return ve(this.s)}normalizeS(){return this.hasHighS()?new De(this.r,h(-this.s),this.recovery):this}toDERRawBytes(){return x0(this.toDERHex())}toDERHex(){return Kf.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return x0(this.toCompactHex())}toCompactHex(){return we(this.r)+we(this.s)}}const Je={isValidPrivateKey(ke){try{return Y(ke),!0}catch{return!1}},normPrivateKeyToScalar:Y,randomPrivateKey:()=>{const ke=wb(d.n);return qw(d.randomBytes(ke),d.n)},precompute(ke=8,Te=H.BASE){return Te._setWindowSize(ke),Te.multiply(BigInt(3)),Te}};function Xe(ke,Te=!0){return H.fromPrivateKey(ke).toRawBytes(Te)}function mt(ke){const Te=ke instanceof Uint8Array,Ze=typeof ke=="string",ut=(Te||Ze)&&ke.length;return Te?ut===D||ut===P:Ze?ut===2*D||ut===2*P:ke instanceof H}function Wt(ke,Te,Ze=!0){if(mt(ke))throw new Error("first arg must be private key");if(!mt(Te))throw new Error("second arg must be public key");return H.fromHex(Te).multiply(Y(ke)).toRawBytes(Ze)}const Et=d.bits2int||function(ke){const Te=Ol(ke),Ze=ke.length*8-d.nBitLength;return Ze>0?Te>>BigInt(Ze):Te},rt=d.bits2int_modN||function(ke){return h(Et(ke))},at=Yy(d.nBitLength);function He(ke){if(typeof ke!="bigint")throw new Error("bigint expected");if(!(Bh<=ke&&ke<at))throw new Error(`bigint expected < 2^${d.nBitLength}`);return jd(ke,d.nByteLength)}function _t(ke,Te,Ze=Pe){if(["recovered","canonical"].some(nn=>nn in Ze))throw new Error("sign() legacy options not supported");const{hash:ut,randomBytes:Tt}=d;let{lowS:sn,prehash:Re,extraEntropy:ct}=Ze;sn==null&&(sn=!0),ke=jo("msgHash",ke),Re&&(ke=jo("prehashed msgHash",ut(ke)));const kt=rt(ke),bt=Y(Te),an=[He(bt),He(kt)];if(ct!=null){const nn=ct===!0?Tt(y.BYTES):ct;an.push(jo("extraEntropy",nn))}const Bt=ep(...an),Qt=kt;function un(nn){const kn=Et(nn);if(!_e(kn))return;const Nn=U(kn),ii=H.BASE.multiply(kn).toAffine(),En=h(ii.x);if(En===Bh)return;const si=h(Nn*h(Qt+En*bt));if(si===Bh)return;let wi=(ii.x===En?0:2)|Number(ii.y&Oc),Oi=si;return sn&&ve(si)&&(Oi=pe(si),wi^=1),new De(En,Oi,wi)}return{seed:Bt,k2sig:un}}const Pe={lowS:d.lowS,prehash:!1},ht={lowS:d.lowS,prehash:!1};function vt(ke,Te,Ze=Pe){const{seed:ut,k2sig:Tt}=_t(ke,Te,Ze),sn=d;return _b(sn.hash.outputLen,sn.nByteLength,sn.hmac)(ut,Tt)}H.BASE._setWindowSize(8);function qt(ke,Te,Ze,ut=ht){const Tt=ke;if(Te=jo("msgHash",Te),Ze=jo("publicKey",Ze),"strict"in ut)throw new Error("options.strict was renamed to lowS");const{lowS:sn,prehash:Re}=ut;let ct,kt;try{if(typeof Tt=="string"||Tt instanceof Uint8Array)try{ct=De.fromDER(Tt)}catch(ii){if(!(ii instanceof Kf.Err))throw ii;ct=De.fromCompact(Tt)}else if(typeof Tt=="object"&&typeof Tt.r=="bigint"&&typeof Tt.s=="bigint"){const{r:ii,s:En}=Tt;ct=new De(ii,En)}else throw new Error("PARSE");kt=H.fromHex(Ze)}catch(ii){if(ii.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(sn&&ct.hasHighS())return!1;Re&&(Te=d.hash(Te));const{r:bt,s:an}=ct,Bt=rt(Te),Qt=U(an),un=h(Bt*Qt),nn=h(bt*Qt),kn=H.BASE.multiplyAndAddUnsafe(kt,un,nn)?.toAffine();return kn?h(kn.x)===bt:!1}return{CURVE:d,getPublicKey:Xe,getSharedSecret:Wt,sign:vt,verify:qt,ProjectivePoint:H,Signature:De,utils:Je}}let Eb=class extends gb{constructor(d,y){super(),this.finished=!1,this.destroyed=!1,pw(d);const C=qy(y);if(this.iHash=d.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const D=this.blockLen,P=new Uint8Array(D);P.set(C.length>D?d.create().update(C).digest():C);for(let N=0;N<P.length;N++)P[N]^=54;this.iHash.update(P),this.oHash=d.create();for(let N=0;N<P.length;N++)P[N]^=106;this.oHash.update(P),P.fill(0)}update(d){return Jm(this),this.iHash.update(d),this}digestInto(d){Jm(this),fb(d,this.outputLen),this.finished=!0,this.iHash.digestInto(d),this.oHash.update(d),this.oHash.digestInto(d),this.destroy()}digest(){const d=new Uint8Array(this.oHash.outputLen);return this.digestInto(d),d}_cloneInto(d){d||(d=Object.create(Object.getPrototypeOf(this),{}));const{oHash:y,iHash:C,finished:D,destroyed:P,blockLen:N,outputLen:h}=this;return d=d,d.finished=D,d.destroyed=P,d.blockLen=N,d.outputLen=h,d.oHash=y._cloneInto(d.oHash),d.iHash=C._cloneInto(d.iHash),d}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Sb=(c,d,y)=>new Eb(c,d).update(y).digest();Sb.create=(c,d)=>new Eb(c,d);function eA(c){return{hash:c,hmac:(d,...y)=>Sb(c,d,xw(...y)),randomBytes:mb}}function tA(c,d){const y=C=>Jw({...c,...eA(C)});return Object.freeze({...y(d),create:y})}const g1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),e1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Cb=BigInt(1),t1=BigInt(2),s_=(c,d)=>(c+d/t1)/d;function Tb(c){const d=g1,y=BigInt(3),C=BigInt(6),D=BigInt(11),P=BigInt(22),N=BigInt(23),h=BigInt(44),U=BigInt(88),H=c*c*c%d,Y=H*H*c%d,K=Rc(Y,y,d)*Y%d,_e=Rc(K,y,d)*Y%d,we=Rc(_e,t1,d)*H%d,ve=Rc(we,D,d)*we%d,pe=Rc(ve,P,d)*ve%d,he=Rc(pe,h,d)*pe%d,De=Rc(he,U,d)*he%d,Je=Rc(De,h,d)*pe%d,Xe=Rc(Je,y,d)*Y%d,mt=Rc(Xe,N,d)*ve%d,Wt=Rc(mt,C,d)*H%d,Et=Rc(Wt,t1,d);if(!Sy.eql(Sy.sqr(Et),c))throw new Error("Cannot find square root");return Et}const Sy=Hw(g1,void 0,void 0,{sqrt:Tb}),b0=tA({a:BigInt(0),b:BigInt(7),Fp:Sy,n:e1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:c=>{const d=e1,y=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),C=-Cb*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),D=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),P=y,N=BigInt("0x100000000000000000000000000000000"),h=s_(P*c,d),U=s_(-C*c,d);let H=bo(c-h*y-U*D,d),Y=bo(-h*C-U*P,d);const K=H>N,_e=Y>N;if(K&&(H=d-H),_e&&(Y=d-Y),H>N||Y>N)throw new Error("splitScalar: Endomorphism failed, k="+c);return{k1neg:K,k1:H,k2neg:_e,k2:Y}}}},wy),m1=BigInt(0),Ib=c=>typeof c=="bigint"&&m1<c&&c<g1,nA=c=>typeof c=="bigint"&&m1<c&&c<e1,a_={};function n1(c,...d){let y=a_[c];if(y===void 0){const C=wy(Uint8Array.from(c,D=>D.charCodeAt(0)));y=ep(C,C),a_[c]=y}return wy(ep(y,...d))}const $y=c=>c.toRawBytes(!0).slice(1),Cy=c=>jd(c,32),ay=c=>bo(c,g1),Rg=c=>bo(c,e1),Ky=b0.ProjectivePoint,iA=(c,d,y)=>Ky.BASE.multiplyAndAddUnsafe(c,d,y);function Ty(c){let d=b0.utils.normPrivateKeyToScalar(c),y=Ky.fromPrivateKey(d);return{scalar:y.hasEvenY()?d:Rg(-d),bytes:$y(y)}}function Mb(c){if(!Ib(c))throw new Error("bad x: need 0 < x < p");const d=ay(c*c),y=ay(d*c+BigInt(7));let C=Tb(y);C%t1!==m1&&(C=ay(-C));const D=new Ky(c,C,Cb);return D.assertValidity(),D}function kb(...c){return Rg(Ol(n1("BIP0340/challenge",...c)))}function rA(c){return Ty(c).bytes}function sA(c,d,y=mb(32)){const C=jo("message",c),{bytes:D,scalar:P}=Ty(d),N=jo("auxRand",y,32),h=Cy(P^Ol(n1("BIP0340/aux",N))),U=n1("BIP0340/nonce",h,D,C),H=Rg(Ol(U));if(H===m1)throw new Error("sign failed: k is zero");const{bytes:Y,scalar:K}=Ty(H),_e=kb(Y,D,C),we=new Uint8Array(64);if(we.set(Y,0),we.set(Cy(Rg(K+_e*P)),32),!Nb(we,C,D))throw new Error("sign: Invalid signature produced");return we}function Nb(c,d,y){const C=jo("signature",c,64),D=jo("message",d),P=jo("publicKey",y,32);try{const N=Mb(Ol(P)),h=Ol(C.subarray(0,32));if(!Ib(h))return!1;const U=Ol(C.subarray(32,64));if(!nA(U))return!1;const H=kb(Cy(h),$y(N),D),Y=iA(N,U,Rg(-H));return!(!Y||!Y.hasEvenY()||Y.toAffine().x!==h)}catch{return!1}}const Ku={getPublicKey:rA,sign:sA,verify:Nb,utils:{randomPrivateKey:b0.utils.randomPrivateKey,lift_x:Mb,pointToBytes:$y,numberToBytesBE:jd,bytesToNumberBE:Ol,taggedHash:n1,mod:bo}},oy=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Qy=c=>c instanceof Uint8Array,ly=c=>new DataView(c.buffer,c.byteOffset,c.byteLength),$u=(c,d)=>c<<32-d|c>>>d,aA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!aA)throw new Error("Non little-endian hardware is not supported");const oA=Array.from({length:256},(c,d)=>d.toString(16).padStart(2,"0"));function vs(c){if(!Qy(c))throw new Error("Uint8Array expected");let d="";for(let y=0;y<c.length;y++)d+=oA[c[y]];return d}function Ud(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const d=c.length;if(d%2)throw new Error("padded hex string expected, got unpadded hex of length "+d);const y=new Uint8Array(d/2);for(let C=0;C<y.length;C++){const D=C*2,P=c.slice(D,D+2),N=Number.parseInt(P,16);if(Number.isNaN(N)||N<0)throw new Error("Invalid byte sequence");y[C]=N}return y}function lA(c){if(typeof c!="string")throw new Error(`utf8ToBytes expected string, got ${typeof c}`);return new Uint8Array(new TextEncoder().encode(c))}function Pg(c){if(typeof c=="string"&&(c=lA(c)),!Qy(c))throw new Error(`expected Uint8Array, got ${typeof c}`);return c}function y1(...c){const d=new Uint8Array(c.reduce((C,D)=>C+D.length,0));let y=0;return c.forEach(C=>{if(!Qy(C))throw new Error("Uint8Array expected");d.set(C,y),y+=C.length}),d}class Db{clone(){return this._cloneInto()}}function Rb(c){const d=C=>c().update(Pg(C)).digest(),y=c();return d.outputLen=y.outputLen,d.blockLen=y.blockLen,d.create=()=>c(),d}function Pb(c=32){if(oy&&typeof oy.getRandomValues=="function")return oy.getRandomValues(new Uint8Array(c));throw new Error("crypto.getRandomValues must be defined")}function Iy(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`Wrong positive integer: ${c}`)}function cA(c){if(typeof c!="boolean")throw new Error(`Expected boolean, not ${c}`)}function Ob(c,...d){if(!(c instanceof Uint8Array))throw new Error("Expected Uint8Array");if(d.length>0&&!d.includes(c.length))throw new Error(`Expected Uint8Array of length ${d}, not of length=${c.length}`)}function uA(c){if(typeof c!="function"||typeof c.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Iy(c.outputLen),Iy(c.blockLen)}function hA(c,d=!0){if(c.destroyed)throw new Error("Hash instance has been destroyed");if(d&&c.finished)throw new Error("Hash#digest() has already been called")}function dA(c,d){Ob(c);const y=d.outputLen;if(c.length<y)throw new Error(`digestInto() expects output buffer of length at least ${y}`)}const Qu={number:Iy,bool:cA,bytes:Ob,hash:uA,exists:hA,output:dA};function fA(c,d,y,C){if(typeof c.setBigUint64=="function")return c.setBigUint64(d,y,C);const D=BigInt(32),P=BigInt(4294967295),N=Number(y>>D&P),h=Number(y&P),U=C?4:0,H=C?0:4;c.setUint32(d+U,N,C),c.setUint32(d+H,h,C)}class pA extends Db{constructor(d,y,C,D){super(),this.blockLen=d,this.outputLen=y,this.padOffset=C,this.isLE=D,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(d),this.view=ly(this.buffer)}update(d){Qu.exists(this);const{view:y,buffer:C,blockLen:D}=this;d=Pg(d);const P=d.length;for(let N=0;N<P;){const h=Math.min(D-this.pos,P-N);if(h===D){const U=ly(d);for(;D<=P-N;N+=D)this.process(U,N);continue}C.set(d.subarray(N,N+h),this.pos),this.pos+=h,N+=h,this.pos===D&&(this.process(y,0),this.pos=0)}return this.length+=d.length,this.roundClean(),this}digestInto(d){Qu.exists(this),Qu.output(d,this),this.finished=!0;const{buffer:y,view:C,blockLen:D,isLE:P}=this;let{pos:N}=this;y[N++]=128,this.buffer.subarray(N).fill(0),this.padOffset>D-N&&(this.process(C,0),N=0);for(let K=N;K<D;K++)y[K]=0;fA(C,D-8,BigInt(this.length*8),P),this.process(C,0);const h=ly(d),U=this.outputLen;if(U%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const H=U/4,Y=this.get();if(H>Y.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<H;K++)h.setUint32(4*K,Y[K],P)}digest(){const{buffer:d,outputLen:y}=this;this.digestInto(d);const C=d.slice(0,y);return this.destroy(),C}_cloneInto(d){d||(d=new this.constructor),d.set(...this.get());const{blockLen:y,buffer:C,length:D,finished:P,destroyed:N,pos:h}=this;return d.length=D,d.pos=h,d.finished=P,d.destroyed=N,D%y&&d.buffer.set(C),d}}const gA=(c,d,y)=>c&d^~c&y,mA=(c,d,y)=>c&d^c&y^d&y,yA=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Pd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Od=new Uint32Array(64);class zb extends pA{constructor(){super(64,32,8,!1),this.A=Pd[0]|0,this.B=Pd[1]|0,this.C=Pd[2]|0,this.D=Pd[3]|0,this.E=Pd[4]|0,this.F=Pd[5]|0,this.G=Pd[6]|0,this.H=Pd[7]|0}get(){const{A:d,B:y,C,D,E:P,F:N,G:h,H:U}=this;return[d,y,C,D,P,N,h,U]}set(d,y,C,D,P,N,h,U){this.A=d|0,this.B=y|0,this.C=C|0,this.D=D|0,this.E=P|0,this.F=N|0,this.G=h|0,this.H=U|0}process(d,y){for(let K=0;K<16;K++,y+=4)Od[K]=d.getUint32(y,!1);for(let K=16;K<64;K++){const _e=Od[K-15],we=Od[K-2],ve=$u(_e,7)^$u(_e,18)^_e>>>3,pe=$u(we,17)^$u(we,19)^we>>>10;Od[K]=pe+Od[K-7]+ve+Od[K-16]|0}let{A:C,B:D,C:P,D:N,E:h,F:U,G:H,H:Y}=this;for(let K=0;K<64;K++){const _e=$u(h,6)^$u(h,11)^$u(h,25),we=Y+_e+gA(h,U,H)+yA[K]+Od[K]|0,pe=($u(C,2)^$u(C,13)^$u(C,22))+mA(C,D,P)|0;Y=H,H=U,U=h,h=N+we|0,N=P,P=D,D=C,C=we+pe|0}C=C+this.A|0,D=D+this.B|0,P=P+this.C|0,N=N+this.D|0,h=h+this.E|0,U=U+this.F|0,H=H+this.G|0,Y=Y+this.H|0,this.set(C,D,P,N,h,U,H,Y)}roundClean(){Od.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class xA extends zb{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Gd=Rb(()=>new zb);Rb(()=>new xA);function v0(c){if(!Number.isSafeInteger(c))throw new Error(`Wrong integer: ${c}`)}function Vh(...c){const d=(D,P)=>N=>D(P(N)),y=Array.from(c).reverse().reduce((D,P)=>D?d(D,P.encode):P.encode,void 0),C=c.reduce((D,P)=>D?d(D,P.decode):P.decode,void 0);return{encode:y,decode:C}}function Gh(c){return{encode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return d.map(y=>{if(v0(y),y<0||y>=c.length)throw new Error(`Digit index outside alphabet: ${y} (alphabet: ${c.length})`);return c[y]})},decode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="string")throw new Error("alphabet.decode input should be array of strings");return d.map(y=>{if(typeof y!="string")throw new Error(`alphabet.decode: not string element=${y}`);const C=c.indexOf(y);if(C===-1)throw new Error(`Unknown letter: "${y}". Allowed: ${c}`);return C})}}}function Hh(c=""){if(typeof c!="string")throw new Error("join separator should be string");return{encode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="string")throw new Error("join.encode input should be array of strings");for(let y of d)if(typeof y!="string")throw new Error(`join.encode: non-string input=${y}`);return d.join(c)},decode:d=>{if(typeof d!="string")throw new Error("join.decode input should be string");return d.split(c)}}}function x1(c,d="="){if(v0(c),typeof d!="string")throw new Error("padding chr should be string");return{encode(y){if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("padding.encode input should be array of strings");for(let C of y)if(typeof C!="string")throw new Error(`padding.encode: non-string input=${C}`);for(;y.length*c%8;)y.push(d);return y},decode(y){if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of y)if(typeof D!="string")throw new Error(`padding.decode: non-string input=${D}`);let C=y.length;if(C*c%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;C>0&&y[C-1]===d;C--)if(!((C-1)*c%8))throw new Error("Invalid padding: string has too much padding");return y.slice(0,C)}}}function Lb(c){if(typeof c!="function")throw new Error("normalize fn should be function");return{encode:d=>d,decode:d=>c(d)}}function o_(c,d,y){if(d<2)throw new Error(`convertRadix: wrong from=${d}, base cannot be less than 2`);if(y<2)throw new Error(`convertRadix: wrong to=${y}, base cannot be less than 2`);if(!Array.isArray(c))throw new Error("convertRadix: data should be array");if(!c.length)return[];let C=0;const D=[],P=Array.from(c);for(P.forEach(N=>{if(v0(N),N<0||N>=d)throw new Error(`Wrong integer: ${N}`)});;){let N=0,h=!0;for(let U=C;U<P.length;U++){const H=P[U],Y=d*N+H;if(!Number.isSafeInteger(Y)||d*N/d!==N||Y-H!==d*N)throw new Error("convertRadix: carry overflow");if(N=Y%y,P[U]=Math.floor(Y/y),!Number.isSafeInteger(P[U])||P[U]*y+N!==Y)throw new Error("convertRadix: carry overflow");if(h)P[U]?h=!1:C=U;else continue}if(D.push(N),h)break}for(let N=0;N<c.length-1&&c[N]===0;N++)D.push(0);return D.reverse()}const Bb=(c,d)=>d?Bb(d,c%d):c,i1=(c,d)=>c+(d-Bb(c,d));function My(c,d,y,C){if(!Array.isArray(c))throw new Error("convertRadix2: data should be array");if(d<=0||d>32)throw new Error(`convertRadix2: wrong from=${d}`);if(y<=0||y>32)throw new Error(`convertRadix2: wrong to=${y}`);if(i1(d,y)>32)throw new Error(`convertRadix2: carry overflow from=${d} to=${y} carryBits=${i1(d,y)}`);let D=0,P=0;const N=2**y-1,h=[];for(const U of c){if(v0(U),U>=2**d)throw new Error(`convertRadix2: invalid data word=${U} from=${d}`);if(D=D<<d|U,P+d>32)throw new Error(`convertRadix2: carry overflow pos=${P} from=${d}`);for(P+=d;P>=y;P-=y)h.push((D>>P-y&N)>>>0);D&=2**P-1}if(D=D<<y-P&N,!C&&P>=d)throw new Error("Excess padding");if(!C&&D)throw new Error(`Non-zero padding: ${D}`);return C&&P>0&&h.push(D>>>0),h}function _A(c){return v0(c),{encode:d=>{if(!(d instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return o_(Array.from(d),2**8,c)},decode:d=>{if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(o_(d,c,2**8))}}}function Hd(c,d=!1){if(v0(c),c<=0||c>32)throw new Error("radix2: bits should be in (0..32]");if(i1(8,c)>32||i1(c,8)>32)throw new Error("radix2: carry overflow");return{encode:y=>{if(!(y instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return My(Array.from(y),8,c,!d)},decode:y=>{if(!Array.isArray(y)||y.length&&typeof y[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(My(y,c,8,d))}}}function l_(c){if(typeof c!="function")throw new Error("unsafeWrapper fn should be function");return function(...d){try{return c.apply(null,d)}catch{}}}const bA=Vh(Hd(4),Gh("0123456789ABCDEF"),Hh("")),vA=Vh(Hd(5),Gh("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),x1(5),Hh(""));Vh(Hd(5),Gh("0123456789ABCDEFGHIJKLMNOPQRSTUV"),x1(5),Hh(""));Vh(Hd(5),Gh("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Hh(""),Lb(c=>c.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Uh=Vh(Hd(6),Gh("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),x1(6),Hh("")),wA=Vh(Hd(6),Gh("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),x1(6),Hh("")),Jy=c=>Vh(_A(58),Gh(c),Hh("")),ky=Jy("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Jy("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Jy("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const c_=[0,2,3,5,6,7,9,10,11],AA={encode(c){let d="";for(let y=0;y<c.length;y+=8){const C=c.subarray(y,y+8);d+=ky.encode(C).padStart(c_[C.length],"1")}return d},decode(c){let d=[];for(let y=0;y<c.length;y+=11){const C=c.slice(y,y+11),D=c_.indexOf(C.length),P=ky.decode(C);for(let N=0;N<P.length-D;N++)if(P[N]!==0)throw new Error("base58xmr: wrong padding");d=d.concat(Array.from(P.slice(P.length-D)))}return Uint8Array.from(d)}},Ny=Vh(Gh("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Hh("")),u_=[996825010,642813549,513874426,1027748829,705979059];function Ig(c){const d=c>>25;let y=(c&33554431)<<5;for(let C=0;C<u_.length;C++)(d>>C&1)===1&&(y^=u_[C]);return y}function h_(c,d,y=1){const C=c.length;let D=1;for(let P=0;P<C;P++){const N=c.charCodeAt(P);if(N<33||N>126)throw new Error(`Invalid prefix (${c})`);D=Ig(D)^N>>5}D=Ig(D);for(let P=0;P<C;P++)D=Ig(D)^c.charCodeAt(P)&31;for(let P of d)D=Ig(D)^P;for(let P=0;P<6;P++)D=Ig(D);return D^=y,Ny.encode(My([D%2**30],30,5,!1))}function Fb(c){const d=c==="bech32"?1:734539939,y=Hd(5),C=y.decode,D=y.encode,P=l_(C);function N(Y,K,_e=90){if(typeof Y!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof Y}`);if(!Array.isArray(K)||K.length&&typeof K[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof K}`);const we=Y.length+7+K.length;if(_e!==!1&&we>_e)throw new TypeError(`Length ${we} exceeds limit ${_e}`);return Y=Y.toLowerCase(),`${Y}1${Ny.encode(K)}${h_(Y,K,d)}`}function h(Y,K=90){if(typeof Y!="string")throw new Error(`bech32.decode input should be string, not ${typeof Y}`);if(Y.length<8||K!==!1&&Y.length>K)throw new TypeError(`Wrong string length: ${Y.length} (${Y}). Expected (8..${K})`);const _e=Y.toLowerCase();if(Y!==_e&&Y!==Y.toUpperCase())throw new Error("String must be lowercase or uppercase");Y=_e;const we=Y.lastIndexOf("1");if(we===0||we===-1)throw new Error('Letter "1" must be present between prefix and data only');const ve=Y.slice(0,we),pe=Y.slice(we+1);if(pe.length<6)throw new Error("Data must be at least 6 characters long");const he=Ny.decode(pe).slice(0,-6),De=h_(ve,he,d);if(!pe.endsWith(De))throw new Error(`Invalid checksum in ${Y}: expected "${De}"`);return{prefix:ve,words:he}}const U=l_(h);function H(Y){const{prefix:K,words:_e}=h(Y,!1);return{prefix:K,words:_e,bytes:C(_e)}}return{encode:N,decode:h,decodeToBytes:H,decodeUnsafe:U,fromWords:C,fromWordsUnsafe:P,toWords:D}}const th=Fb("bech32");Fb("bech32m");const EA={encode:c=>new TextDecoder().decode(c),decode:c=>new TextEncoder().encode(c)},SA=Vh(Hd(4),Gh("0123456789abcdef"),Hh(""),Lb(c=>{if(typeof c!="string"||c.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof c} with length ${c.length}`);return c.toLowerCase()})),CA={utf8:EA,hex:SA,base16:bA,base32:vA,base64:Uh,base64url:wA,base58:ky,base58xmr:AA};`${Object.keys(CA).join(", ")}`;function cy(c){if(!Number.isSafeInteger(c)||c<0)throw new Error(`positive integer expected, not ${c}`)}function d_(c){if(typeof c!="boolean")throw new Error(`boolean expected, not ${c}`)}function TA(c){return c instanceof Uint8Array||c!=null&&typeof c=="object"&&c.constructor.name==="Uint8Array"}function Ju(c,...d){if(!TA(c))throw new Error("Uint8Array expected");if(d.length>0&&!d.includes(c.length))throw new Error(`Uint8Array expected of length ${d}, not of length=${c.length}`)}const Uo=c=>new Uint32Array(c.buffer,c.byteOffset,Math.floor(c.byteLength/4)),IA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!IA)throw new Error("Non little-endian hardware is not supported");const MA=Array.from({length:256},(c,d)=>d.toString(16).padStart(2,"0"));function h0(c){Ju(c);let d="";for(let y=0;y<c.length;y++)d+=MA[c[y]];return d}const Oh={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function f_(c){if(c>=Oh._0&&c<=Oh._9)return c-Oh._0;if(c>=Oh._A&&c<=Oh._F)return c-(Oh._A-10);if(c>=Oh._a&&c<=Oh._f)return c-(Oh._a-10)}function jb(c){if(typeof c!="string")throw new Error("hex string expected, got "+typeof c);const d=c.length,y=d/2;if(d%2)throw new Error("padded hex string expected, got unpadded hex of length "+d);const C=new Uint8Array(y);for(let D=0,P=0;D<y;D++,P+=2){const N=f_(c.charCodeAt(P)),h=f_(c.charCodeAt(P+1));if(N===void 0||h===void 0){const U=c[P]+c[P+1];throw new Error('hex string expected, got non-hex character "'+U+'" at index '+P)}C[D]=N*16+h}return C}function kA(c,d){if(d==null||typeof d!="object")throw new Error("options must be defined");return Object.assign(c,d)}function NA(c,d){if(c.length!==d.length)return!1;let y=0;for(let C=0;C<c.length;C++)y|=c[C]^d[C];return y===0}const DA=(c,d)=>(Object.assign(d,c),d),Bd=16,RA=283;function ex(c){return c<<1^RA&-(c>>7)}function d0(c,d){let y=0;for(;d>0;d>>=1)y^=c&-(d&1),c=ex(c);return y}const Dy=(()=>{let c=new Uint8Array(256);for(let y=0,C=1;y<256;y++,C^=ex(C))c[y]=C;const d=new Uint8Array(256);d[0]=99;for(let y=0;y<255;y++){let C=c[255-y];C|=C<<8,d[c[y]]=(C^C>>4^C>>5^C>>6^C>>7^99)&255}return d})(),PA=Dy.map((c,d)=>Dy.indexOf(d)),OA=c=>c<<24|c>>>8,uy=c=>c<<8|c>>>24;function Ub(c,d){if(c.length!==256)throw new Error("Wrong sbox length");const y=new Uint32Array(256).map((H,Y)=>d(c[Y])),C=y.map(uy),D=C.map(uy),P=D.map(uy),N=new Uint32Array(256*256),h=new Uint32Array(256*256),U=new Uint16Array(256*256);for(let H=0;H<256;H++)for(let Y=0;Y<256;Y++){const K=H*256+Y;N[K]=y[H]^C[Y],h[K]=D[H]^P[Y],U[K]=c[H]<<8|c[Y]}return{sbox:c,sbox2:U,T0:y,T1:C,T2:D,T3:P,T01:N,T23:h}}const tx=Ub(Dy,c=>d0(c,3)<<24|c<<16|c<<8|d0(c,2)),Vb=Ub(PA,c=>d0(c,11)<<24|d0(c,13)<<16|d0(c,9)<<8|d0(c,14)),zA=(()=>{const c=new Uint8Array(16);for(let d=0,y=1;d<16;d++,y=ex(y))c[d]=y;return c})();function Gb(c){Ju(c);const d=c.length;if(![16,24,32].includes(d))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${d}`);const{sbox2:y}=tx,C=Uo(c),D=C.length,P=h=>eh(y,h,h,h,h),N=new Uint32Array(d+28);N.set(C);for(let h=D;h<N.length;h++){let U=N[h-1];h%D===0?U=P(OA(U))^zA[h/D-1]:D>6&&h%D===4&&(U=P(U)),N[h]=N[h-D]^U}return N}function LA(c){const d=Gb(c),y=d.slice(),C=d.length,{sbox2:D}=tx,{T0:P,T1:N,T2:h,T3:U}=Vb;for(let H=0;H<C;H+=4)for(let Y=0;Y<4;Y++)y[H+Y]=d[C-H-4+Y];d.fill(0);for(let H=4;H<C-4;H++){const Y=y[H],K=eh(D,Y,Y,Y,Y);y[H]=P[K&255]^N[K>>>8&255]^h[K>>>16&255]^U[K>>>24]}return y}function Ld(c,d,y,C,D,P){return c[y<<8&65280|C>>>8&255]^d[D>>>8&65280|P>>>24&255]}function eh(c,d,y,C,D){return c[d&255|y&65280]|c[C>>>16&255|D>>>16&65280]<<16}function p_(c,d,y,C,D){const{sbox2:P,T01:N,T23:h}=tx;let U=0;d^=c[U++],y^=c[U++],C^=c[U++],D^=c[U++];const H=c.length/4-2;for(let ve=0;ve<H;ve++){const pe=c[U++]^Ld(N,h,d,y,C,D),he=c[U++]^Ld(N,h,y,C,D,d),De=c[U++]^Ld(N,h,C,D,d,y),Je=c[U++]^Ld(N,h,D,d,y,C);d=pe,y=he,C=De,D=Je}const Y=c[U++]^eh(P,d,y,C,D),K=c[U++]^eh(P,y,C,D,d),_e=c[U++]^eh(P,C,D,d,y),we=c[U++]^eh(P,D,d,y,C);return{s0:Y,s1:K,s2:_e,s3:we}}function BA(c,d,y,C,D){const{sbox2:P,T01:N,T23:h}=Vb;let U=0;d^=c[U++],y^=c[U++],C^=c[U++],D^=c[U++];const H=c.length/4-2;for(let ve=0;ve<H;ve++){const pe=c[U++]^Ld(N,h,d,D,C,y),he=c[U++]^Ld(N,h,y,d,D,C),De=c[U++]^Ld(N,h,C,y,d,D),Je=c[U++]^Ld(N,h,D,C,y,d);d=pe,y=he,C=De,D=Je}const Y=c[U++]^eh(P,d,D,C,y),K=c[U++]^eh(P,y,d,D,C),_e=c[U++]^eh(P,C,y,d,D),we=c[U++]^eh(P,D,C,y,d);return{s0:Y,s1:K,s2:_e,s3:we}}function Hb(c,d){if(!d)return new Uint8Array(c);if(Ju(d),d.length<c)throw new Error(`aes: wrong destination length, expected at least ${c}, got: ${d.length}`);return d}function FA(c){if(Ju(c),c.length%Bd!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Bd}`)}function jA(c,d,y){let C=c.length;const D=C%Bd;if(!d&&D!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const P=Uo(c);if(d){let U=Bd-D;U||(U=Bd),C=C+U}const N=Hb(C,y),h=Uo(N);return{b:P,o:h,out:N}}function UA(c,d){if(!d)return c;const y=c.length;if(!y)throw new Error("aes/pcks5: empty ciphertext not allowed");const C=c[y-1];if(C<=0||C>16)throw new Error(`aes/pcks5: wrong padding byte: ${C}`);const D=c.subarray(0,-C);for(let P=0;P<C;P++)if(c[y-P-1]!==C)throw new Error("aes/pcks5: wrong padding");return D}function VA(c){const d=new Uint8Array(16),y=Uo(d);d.set(c);const C=Bd-c.length;for(let D=Bd-C;D<Bd;D++)d[D]=C;return y}const qb=DA({blockSize:16,nonceLength:16},function(d,y,C={}){Ju(d),Ju(y,16);const D=!C.disablePadding;return{encrypt:(P,N)=>{const h=Gb(d),{b:U,o:H,out:Y}=jA(P,D,N),K=Uo(y);let _e=K[0],we=K[1],ve=K[2],pe=K[3],he=0;for(;he+4<=U.length;)_e^=U[he+0],we^=U[he+1],ve^=U[he+2],pe^=U[he+3],{s0:_e,s1:we,s2:ve,s3:pe}=p_(h,_e,we,ve,pe),H[he++]=_e,H[he++]=we,H[he++]=ve,H[he++]=pe;if(D){const De=VA(P.subarray(he*4));_e^=De[0],we^=De[1],ve^=De[2],pe^=De[3],{s0:_e,s1:we,s2:ve,s3:pe}=p_(h,_e,we,ve,pe),H[he++]=_e,H[he++]=we,H[he++]=ve,H[he++]=pe}return h.fill(0),Y},decrypt:(P,N)=>{FA(P);const h=LA(d),U=Uo(y),H=Hb(P.length,N),Y=Uo(P),K=Uo(H);let _e=U[0],we=U[1],ve=U[2],pe=U[3];for(let he=0;he+4<=Y.length;){const De=_e,Je=we,Xe=ve,mt=pe;_e=Y[he+0],we=Y[he+1],ve=Y[he+2],pe=Y[he+3];const{s0:Wt,s1:Et,s2:rt,s3:at}=BA(h,_e,we,ve,pe);K[he++]=Wt^De,K[he++]=Et^Je,K[he++]=rt^Xe,K[he++]=at^mt}return h.fill(0),UA(H,D)}}}),Zb=c=>Uint8Array.from(c.split("").map(d=>d.charCodeAt(0))),GA=Zb("expand 16-byte k"),HA=Zb("expand 32-byte k"),qA=Uo(GA),Xb=Uo(HA);Xb.slice();function qr(c,d){return c<<d|c>>>32-d}function Ry(c){return c.byteOffset%4===0}const Um=64,ZA=16,Wb=2**32-1,g_=new Uint32Array;function XA(c,d,y,C,D,P,N,h){const U=D.length,H=new Uint8Array(Um),Y=Uo(H),K=Ry(D)&&Ry(P),_e=K?Uo(D):g_,we=K?Uo(P):g_;for(let ve=0;ve<U;N++){if(c(d,y,C,Y,N,h),N>=Wb)throw new Error("arx: counter overflow");const pe=Math.min(Um,U-ve);if(K&&pe===Um){const he=ve/4;if(ve%4!==0)throw new Error("arx: invalid block position");for(let De=0,Je;De<ZA;De++)Je=he+De,we[Je]=_e[Je]^Y[De];ve+=Um;continue}for(let he=0,De;he<pe;he++)De=ve+he,P[De]=D[De]^H[he];ve+=pe}}function WA(c,d){const{allowShortKeys:y,extendNonceFn:C,counterLength:D,counterRight:P,rounds:N}=kA({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},d);if(typeof c!="function")throw new Error("core must be a function");return cy(D),cy(N),d_(P),d_(y),(h,U,H,Y,K=0)=>{Ju(h),Ju(U),Ju(H);const _e=H.length;if(Y||(Y=new Uint8Array(_e)),Ju(Y),cy(K),K<0||K>=Wb)throw new Error("arx: counter overflow");if(Y.length<_e)throw new Error(`arx: output (${Y.length}) is shorter than data (${_e})`);const we=[];let ve=h.length,pe,he;if(ve===32)pe=h.slice(),we.push(pe),he=Xb;else if(ve===16&&y)pe=new Uint8Array(32),pe.set(h),pe.set(h,16),he=qA,we.push(pe);else throw new Error(`arx: invalid 32-byte key, got length=${ve}`);Ry(U)||(U=U.slice(),we.push(U));const De=Uo(pe);if(C){if(U.length!==24)throw new Error("arx: extended nonce must be 24 bytes");C(he,De,Uo(U.subarray(0,16)),De),U=U.subarray(16)}const Je=16-D;if(Je!==U.length)throw new Error(`arx: nonce must be ${Je} or 16 bytes`);if(Je!==12){const mt=new Uint8Array(12);mt.set(U,P?0:12-U.length),U=mt,we.push(U)}const Xe=Uo(U);for(XA(c,he,De,Xe,H,Y,K,N);we.length>0;)we.pop().fill(0);return Y}}function YA(c,d,y,C,D,P=20){let N=c[0],h=c[1],U=c[2],H=c[3],Y=d[0],K=d[1],_e=d[2],we=d[3],ve=d[4],pe=d[5],he=d[6],De=d[7],Je=D,Xe=y[0],mt=y[1],Wt=y[2],Et=N,rt=h,at=U,He=H,_t=Y,Pe=K,ht=_e,vt=we,qt=ve,ke=pe,Te=he,Ze=De,ut=Je,Tt=Xe,sn=mt,Re=Wt;for(let kt=0;kt<P;kt+=2)Et=Et+_t|0,ut=qr(ut^Et,16),qt=qt+ut|0,_t=qr(_t^qt,12),Et=Et+_t|0,ut=qr(ut^Et,8),qt=qt+ut|0,_t=qr(_t^qt,7),rt=rt+Pe|0,Tt=qr(Tt^rt,16),ke=ke+Tt|0,Pe=qr(Pe^ke,12),rt=rt+Pe|0,Tt=qr(Tt^rt,8),ke=ke+Tt|0,Pe=qr(Pe^ke,7),at=at+ht|0,sn=qr(sn^at,16),Te=Te+sn|0,ht=qr(ht^Te,12),at=at+ht|0,sn=qr(sn^at,8),Te=Te+sn|0,ht=qr(ht^Te,7),He=He+vt|0,Re=qr(Re^He,16),Ze=Ze+Re|0,vt=qr(vt^Ze,12),He=He+vt|0,Re=qr(Re^He,8),Ze=Ze+Re|0,vt=qr(vt^Ze,7),Et=Et+Pe|0,Re=qr(Re^Et,16),Te=Te+Re|0,Pe=qr(Pe^Te,12),Et=Et+Pe|0,Re=qr(Re^Et,8),Te=Te+Re|0,Pe=qr(Pe^Te,7),rt=rt+ht|0,ut=qr(ut^rt,16),Ze=Ze+ut|0,ht=qr(ht^Ze,12),rt=rt+ht|0,ut=qr(ut^rt,8),Ze=Ze+ut|0,ht=qr(ht^Ze,7),at=at+vt|0,Tt=qr(Tt^at,16),qt=qt+Tt|0,vt=qr(vt^qt,12),at=at+vt|0,Tt=qr(Tt^at,8),qt=qt+Tt|0,vt=qr(vt^qt,7),He=He+_t|0,sn=qr(sn^He,16),ke=ke+sn|0,_t=qr(_t^ke,12),He=He+_t|0,sn=qr(sn^He,8),ke=ke+sn|0,_t=qr(_t^ke,7);let ct=0;C[ct++]=N+Et|0,C[ct++]=h+rt|0,C[ct++]=U+at|0,C[ct++]=H+He|0,C[ct++]=Y+_t|0,C[ct++]=K+Pe|0,C[ct++]=_e+ht|0,C[ct++]=we+vt|0,C[ct++]=ve+qt|0,C[ct++]=pe+ke|0,C[ct++]=he+Te|0,C[ct++]=De+Ze|0,C[ct++]=Je+ut|0,C[ct++]=Xe+Tt|0,C[ct++]=mt+sn|0,C[ct++]=Wt+Re|0}const Yb=WA(YA,{counterRight:!1,counterLength:4,allowShortKeys:!1});class $b extends Db{constructor(d,y){super(),this.finished=!1,this.destroyed=!1,Qu.hash(d);const C=Pg(y);if(this.iHash=d.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const D=this.blockLen,P=new Uint8Array(D);P.set(C.length>D?d.create().update(C).digest():C);for(let N=0;N<P.length;N++)P[N]^=54;this.iHash.update(P),this.oHash=d.create();for(let N=0;N<P.length;N++)P[N]^=106;this.oHash.update(P),P.fill(0)}update(d){return Qu.exists(this),this.iHash.update(d),this}digestInto(d){Qu.exists(this),Qu.bytes(d,this.outputLen),this.finished=!0,this.iHash.digestInto(d),this.oHash.update(d),this.oHash.digestInto(d),this.destroy()}digest(){const d=new Uint8Array(this.oHash.outputLen);return this.digestInto(d),d}_cloneInto(d){d||(d=Object.create(Object.getPrototypeOf(this),{}));const{oHash:y,iHash:C,finished:D,destroyed:P,blockLen:N,outputLen:h}=this;return d=d,d.finished=D,d.destroyed=P,d.blockLen=N,d.outputLen=h,d.oHash=y._cloneInto(d.oHash),d.iHash=C._cloneInto(d.iHash),d}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const _1=(c,d,y)=>new $b(c,d).update(y).digest();_1.create=(c,d)=>new $b(c,d);function $A(c,d,y){return Qu.hash(c),_1(c,Pg(y),Pg(d))}const hy=new Uint8Array([0]),m_=new Uint8Array;function KA(c,d,y,C=32){if(Qu.hash(c),Qu.number(C),C>255*c.outputLen)throw new Error("Length should be <= 255*HashLen");const D=Math.ceil(C/c.outputLen);y===void 0&&(y=m_);const P=new Uint8Array(D*c.outputLen),N=_1.create(c,d),h=N._cloneInto(),U=new Uint8Array(N.outputLen);for(let H=0;H<D;H++)hy[0]=H+1,h.update(H===0?m_:U).update(y).update(hy).digestInto(U),P.set(U,c.outputLen*H),N._cloneInto(h);return N.destroy(),h.destroy(),U.fill(0),hy.fill(0),P.slice(0,C)}var QA=Object.defineProperty,Ls=(c,d)=>{for(var y in d)QA(c,y,{get:d[y],enumerable:!0})},Xf=Symbol("verified"),JA=c=>c instanceof Object;function nx(c){if(!JA(c)||typeof c.kind!="number"||typeof c.content!="string"||typeof c.created_at!="number"||typeof c.pubkey!="string"||!c.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(c.tags))return!1;for(let d=0;d<c.tags.length;d++){let y=c.tags[d];if(!Array.isArray(y))return!1;for(let C=0;C<y.length;C++)if(typeof y[C]!="string")return!1}return!0}var eE={};Ls(eE,{Queue:()=>Qb,QueueNode:()=>Kb,binarySearch:()=>ix,bytesToHex:()=>vs,hexToBytes:()=>Ud,insertEventIntoAscendingList:()=>nE,insertEventIntoDescendingList:()=>tE,normalizeURL:()=>$f,utf8Decoder:()=>jh,utf8Encoder:()=>yu});var jh=new TextDecoder("utf-8"),yu=new TextEncoder;function $f(c){try{c.indexOf("://")===-1&&(c="wss://"+c);let d=new URL(c);return d.protocol==="http:"?d.protocol="ws:":d.protocol==="https:"&&(d.protocol="wss:"),d.pathname=d.pathname.replace(/\/+/g,"/"),d.pathname.endsWith("/")&&(d.pathname=d.pathname.slice(0,-1)),(d.port==="80"&&d.protocol==="ws:"||d.port==="443"&&d.protocol==="wss:")&&(d.port=""),d.searchParams.sort(),d.hash="",d.toString()}catch{throw new Error(`Invalid URL: ${c}`)}}function tE(c,d){const[y,C]=ix(c,D=>d.id===D.id?0:d.created_at===D.created_at?-1:D.created_at-d.created_at);return C||c.splice(y,0,d),c}function nE(c,d){const[y,C]=ix(c,D=>d.id===D.id?0:d.created_at===D.created_at?-1:d.created_at-D.created_at);return C||c.splice(y,0,d),c}function ix(c,d){let y=0,C=c.length-1;for(;y<=C;){const D=Math.floor((y+C)/2),P=d(c[D]);if(P===0)return[D,!0];P<0?C=D-1:y=D+1}return[y,!1]}var Kb=class{value;next=null;prev=null;constructor(c){this.value=c}},Qb=class{first;last;constructor(){this.first=null,this.last=null}enqueue(c){const d=new Kb(c);return this.last?this.last===this.first?(this.last=d,this.last.prev=this.first,this.first.next=d):(d.prev=this.last,this.last.next=d,this.last=d):(this.first=d,this.last=d),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const d=this.first;return this.first=null,this.last=null,d.value}const c=this.first;return this.first=c.next,this.first&&(this.first.prev=null),c.value}},iE=class{generateSecretKey(){return Ku.utils.randomPrivateKey()}getPublicKey(d){return vs(Ku.getPublicKey(d))}finalizeEvent(d,y){const C=d;return C.pubkey=vs(Ku.getPublicKey(y)),C.id=Wm(C),C.sig=vs(Ku.sign(Wm(C),y)),C[Xf]=!0,C}verifyEvent(d){if(typeof d[Xf]=="boolean")return d[Xf];const y=Wm(d);if(y!==d.id)return d[Xf]=!1,!1;try{const C=Ku.verify(d.sig,y,d.pubkey);return d[Xf]=C,C}catch{return d[Xf]=!1,!1}}};function rE(c){if(!nx(c))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content])}function Wm(c){let d=Gd(yu.encode(rE(c)));return vs(d)}var b1=new iE,Jb=b1.generateSecretKey,Og=b1.getPublicKey,zc=b1.finalizeEvent,v1=b1.verifyEvent,sE={};Ls(sE,{Application:()=>yS,BadgeAward:()=>fE,BadgeDefinition:()=>uS,BlockedRelaysList:()=>ZE,BlossomServerList:()=>JE,BookmarkList:()=>GE,Bookmarksets:()=>oS,Calendar:()=>ES,CalendarEventRSVP:()=>SS,ChannelCreation:()=>sv,ChannelHideMessage:()=>lv,ChannelMessage:()=>ov,ChannelMetadata:()=>av,ChannelMuteUser:()=>cv,ChatMessage:()=>pE,ClassifiedListing:()=>bS,ClientAuth:()=>hv,Comment:()=>AE,CommunitiesList:()=>HE,CommunityDefinition:()=>MS,CommunityPostApproval:()=>NE,Contacts:()=>uE,CreateOrUpdateProduct:()=>fS,CreateOrUpdateStall:()=>dS,Curationsets:()=>lS,Date:()=>wS,DirectMessageRelaysList:()=>KE,DraftClassifiedListing:()=>vS,DraftLong:()=>gS,Emojisets:()=>mS,EncryptedDirectMessage:()=>hE,EventDeletion:()=>dE,FavoriteRelays:()=>WE,FileMessage:()=>mE,FileMetadata:()=>wE,FileServerPreference:()=>QE,Followsets:()=>rS,ForumThread:()=>gE,GenericRepost:()=>lx,Genericlists:()=>sS,GiftWrap:()=>uv,GroupMetadata:()=>kS,HTTPAuth:()=>cx,Handlerinformation:()=>IS,Handlerrecommendation:()=>TS,Highlights:()=>BE,InterestsList:()=>YE,Interestsets:()=>hS,JobFeedback:()=>PE,JobRequest:()=>DE,JobResult:()=>RE,Label:()=>kE,LightningPubRPC:()=>tS,LiveChatMessage:()=>EE,LiveEvent:()=>xS,LongFormArticle:()=>pS,Metadata:()=>lE,Mutelist:()=>jE,NWCWalletInfo:()=>eS,NWCWalletRequest:()=>dv,NWCWalletResponse:()=>nS,NormalVideo:()=>xE,NostrConnect:()=>iS,OpenTimestamps:()=>bE,Photo:()=>yE,Pinlist:()=>UE,Poll:()=>vE,PollResponse:()=>FE,PrivateDirectMessage:()=>rv,ProblemTracker:()=>TE,ProfileBadges:()=>cS,PublicChatsList:()=>qE,Reaction:()=>ox,RecommendRelay:()=>cE,RelayList:()=>VE,RelayReview:()=>CS,Relaysets:()=>aS,Report:()=>IE,Reporting:()=>ME,Repost:()=>ax,Seal:()=>iv,SearchRelaysList:()=>XE,ShortTextNote:()=>nv,ShortVideo:()=>_E,Time:()=>AS,UserEmojiList:()=>$E,UserStatuses:()=>_S,Voice:()=>SE,VoiceComment:()=>CE,Zap:()=>LE,ZapGoal:()=>OE,ZapRequest:()=>zE,classifyKind:()=>aE,isAddressableKind:()=>sx,isEphemeralKind:()=>tv,isKind:()=>oE,isRegularKind:()=>ev,isReplaceableKind:()=>rx});function ev(c){return c<1e4&&c!==0&&c!==3}function rx(c){return c===0||c===3||1e4<=c&&c<2e4}function tv(c){return 2e4<=c&&c<3e4}function sx(c){return 3e4<=c&&c<4e4}function aE(c){return ev(c)?"regular":rx(c)?"replaceable":tv(c)?"ephemeral":sx(c)?"parameterized":"unknown"}function oE(c,d){const y=d instanceof Array?d:[d];return nx(c)&&y.includes(c.kind)||!1}var lE=0,nv=1,cE=2,uE=3,hE=4,dE=5,ax=6,ox=7,fE=8,pE=9,gE=11,iv=13,rv=14,mE=15,lx=16,yE=20,xE=21,_E=22,sv=40,av=41,ov=42,lv=43,cv=44,bE=1040,uv=1059,vE=1068,wE=1063,AE=1111,EE=1311,SE=1222,CE=1244,TE=1971,IE=1984,ME=1984,kE=1985,NE=4550,DE=5999,RE=6999,PE=7e3,OE=9041,zE=9734,LE=9735,BE=9802,FE=1018,jE=1e4,UE=10001,VE=10002,GE=10003,HE=10004,qE=10005,ZE=10006,XE=10007,WE=10012,YE=10015,$E=10030,KE=10050,QE=10096,JE=10063,eS=13194,tS=21e3,hv=22242,dv=23194,nS=23195,iS=24133,cx=27235,rS=3e4,sS=30001,aS=30002,oS=30003,lS=30004,cS=30008,uS=30009,hS=30015,dS=30017,fS=30018,pS=30023,gS=30024,mS=30030,yS=30078,xS=30311,_S=30315,bS=30402,vS=30403,wS=31922,AS=31923,ES=31924,SS=31925,CS=31987,TS=31989,IS=31990,MS=34550,kS=39e3;function NS(c,d){if(c.ids&&c.ids.indexOf(d.id)===-1||c.kinds&&c.kinds.indexOf(d.kind)===-1||c.authors&&c.authors.indexOf(d.pubkey)===-1)return!1;for(let y in c)if(y[0]==="#"){let C=y.slice(1),D=c[`#${C}`];if(D&&!d.tags.find(([P,N])=>P===y.slice(1)&&D.indexOf(N)!==-1))return!1}return!(c.since&&d.created_at<c.since||c.until&&d.created_at>c.until)}function DS(c,d){for(let y=0;y<c.length;y++)if(NS(c[y],d))return!0;return!1}var RS={};Ls(RS,{getHex64:()=>w1,getInt:()=>fv,getSubscriptionId:()=>pv,matchEventId:()=>PS,matchEventKind:()=>zS,matchEventPubkey:()=>OS});function w1(c,d){let y=d.length+3,C=c.indexOf(`"${d}":`)+y,D=c.slice(C).indexOf('"')+C+1;return c.slice(D,D+64)}function fv(c,d){let y=d.length,C=c.indexOf(`"${d}":`)+y+3,D=c.slice(C),P=Math.min(D.indexOf(","),D.indexOf("}"));return parseInt(D.slice(0,P),10)}function pv(c){let d=c.slice(0,22).indexOf('"EVENT"');if(d===-1)return null;let y=c.slice(d+7+1).indexOf('"');if(y===-1)return null;let C=d+7+1+y,D=c.slice(C+1,80).indexOf('"');if(D===-1)return null;let P=C+1+D;return c.slice(C+1,P)}function PS(c,d){return d===w1(c,"id")}function OS(c,d){return d===w1(c,"pubkey")}function zS(c,d){return d===fv(c,"kind")}var LS={};Ls(LS,{makeAuthEvent:()=>gv});function gv(c,d){return{kind:hv,created_at:Math.floor(Date.now()/1e3),tags:[["relay",c],["challenge",d]],content:""}}async function BS(){return new Promise((c,d)=>{try{if(typeof MessageChannel<"u"){const y=new MessageChannel,C=()=>{y.port1.removeEventListener("message",C),c()};y.port1.addEventListener("message",C),y.port2.postMessage(0),y.port1.start()}else typeof setImmediate<"u"?setImmediate(c):typeof setTimeout<"u"?setTimeout(c,0):c()}catch(y){console.error("during yield: ",y),d(y)}})}var FS=c=>(c[Xf]=!0,!0),mv=class extends Error{constructor(c,d){super(`Tried to send message '${c} on a closed connection to ${d}.`),this.name="SendingOnClosedConnection"}},yv=class{url;_connected=!1;onclose=null;onnotice=c=>console.debug(`NOTICE from ${this.url}: ${c}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Qb;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(c,d){this.url=$f(c),this.verifyEvent=d.verifyEvent,this._WebSocket=d.websocketImplementation||WebSocket,this.enablePing=d.enablePing,this.enableReconnect=d.enableReconnect||!1}static async connect(c,d){const y=new yv(c,d);return await y.connect(),y}closeAllSubscriptions(c){for(let[d,y]of this.openSubs)y.close(c);this.openSubs.clear();for(let[d,y]of this.openEventPublishes)y.reject(new Error(c));this.openEventPublishes.clear();for(let[d,y]of this.openCountRequests)y.reject(new Error(c));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const c=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},c)}handleHardClose(c){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const d=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!d?this.reconnect():this.closeAllSubscriptions(c)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((c,d)=>{this.connectionTimeoutHandle=setTimeout(()=>{d("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(y){clearTimeout(this.connectionTimeoutHandle),d(y);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const y=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const C of this.openSubs.values()){if(C.eosed=!1,y)for(let D=0;D<C.filters.length;D++)C.lastEmitted&&(C.filters[D].since=C.lastEmitted+1);C.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),c()},this.ws.onerror=y=>{clearTimeout(this.connectionTimeoutHandle),d(y.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=y=>{clearTimeout(this.connectionTimeoutHandle),d(y.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(c=>{this.ws.once("pong",()=>c(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((c,d)=>{if(!this.connectionPromise)return d(new Error(`no connection to ${this.url}, can't ping`));try{const y=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{c(!0),y.close()},onclose(){c(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(y){d(y)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(d=>setTimeout(()=>d(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await BS();this.queueRunning=!1}handleNext(){const c=this.incomingMessageQueue.dequeue();if(!c)return!1;const d=pv(c);if(d){const y=this.openSubs.get(d);if(!y)return;const C=w1(c,"id"),D=y.alreadyHaveEvent?.(C);if(y.receivedEvent?.(this,C),D)return}try{let y=JSON.parse(c);switch(y[0]){case"EVENT":{const C=this.openSubs.get(y[1]),D=y[2];this.verifyEvent(D)&&DS(C.filters,D)&&C.onevent(D),(!C.lastEmitted||C.lastEmitted<D.created_at)&&(C.lastEmitted=D.created_at);return}case"COUNT":{const C=y[1],D=y[2],P=this.openCountRequests.get(C);P&&(P.resolve(D.count),this.openCountRequests.delete(C));return}case"EOSE":{const C=this.openSubs.get(y[1]);if(!C)return;C.receivedEose();return}case"OK":{const C=y[1],D=y[2],P=y[3],N=this.openEventPublishes.get(C);N&&(clearTimeout(N.timeout),D?N.resolve(P):N.reject(new Error(P)),this.openEventPublishes.delete(C));return}case"CLOSED":{const C=y[1],D=this.openSubs.get(C);if(!D)return;D.closed=!0,D.close(y[2]);return}case"NOTICE":{this.onnotice(y[1]);return}case"AUTH":{this.challenge=y[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(y[1])?.oncustom?.(y);return}}}catch{return}}async send(c){if(!this.connectionPromise)throw new mv(c,this.url);this.connectionPromise.then(()=>{this.ws?.send(c)})}async auth(c){const d=this.challenge;if(!d)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(y,C)=>{try{let D=await c(gv(this.url,d)),P=setTimeout(()=>{let N=this.openEventPublishes.get(D.id);N&&(N.reject(new Error("auth timed out")),this.openEventPublishes.delete(D.id))},this.publishTimeout);this.openEventPublishes.set(D.id,{resolve:y,reject:C,timeout:P}),this.send('["AUTH",'+JSON.stringify(D)+"]")}catch(D){console.warn("subscribe auth function failed:",D)}}),this.authPromise)}async publish(c){const d=new Promise((y,C)=>{const D=setTimeout(()=>{const P=this.openEventPublishes.get(c.id);P&&(P.reject(new Error("publish timed out")),this.openEventPublishes.delete(c.id))},this.publishTimeout);this.openEventPublishes.set(c.id,{resolve:y,reject:C,timeout:D})});return this.send('["EVENT",'+JSON.stringify(c)+"]"),d}async count(c,d){this.serial++;const y=d?.id||"count:"+this.serial,C=new Promise((D,P)=>{this.openCountRequests.set(y,{resolve:D,reject:P})});return this.send('["COUNT","'+y+'",'+JSON.stringify(c).substring(1)),C}subscribe(c,d){const y=this.prepareSubscription(c,d);return y.fire(),y}prepareSubscription(c,d){this.serial++;const y=d.id||(d.label?d.label+":":"sub:")+this.serial,C=new jS(this,y,c,d);return this.openSubs.set(y,C),C}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(c){this.incomingMessageQueue.enqueue(c.data),this.queueRunning||this.runQueue()}},jS=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(c,d,y,C){if(y.length===0)throw new Error("subscription can't be created with zero filters");this.relay=c,this.filters=y,this.id=d,this.alreadyHaveEvent=C.alreadyHaveEvent,this.receivedEvent=C.receivedEvent,this.eoseTimeout=C.eoseTimeout||c.baseEoseTimeout,this.oneose=C.oneose,this.onclose=C.onclose,this.onevent=C.onevent||(D=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,D)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(c="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(d){if(!(d instanceof mv))throw d}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(c)}},US;try{US=WebSocket}catch{}var VS=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(c){this.verifyEvent=c.verifyEvent,this._WebSocket=c.websocketImplementation,this.enablePing=c.enablePing,this.enableReconnect=c.enableReconnect||!1,this.automaticallyAuth=c.automaticallyAuth}async ensureRelay(c,d){c=$f(c);let y=this.relays.get(c);if(y||(y=new yv(c,{verifyEvent:this.trustedRelayURLs.has(c)?FS:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),y.onclose=()=>{y&&!y.enableReconnect&&this.relays.delete(c)},d?.connectionTimeout&&(y.connectionTimeout=d.connectionTimeout),this.relays.set(c,y)),this.automaticallyAuth){const C=this.automaticallyAuth(c);C&&(y.onauth=C)}return await y.connect(),y}close(c){c.map($f).forEach(d=>{this.relays.get(d)?.close(),this.relays.delete(d)})}subscribe(c,d,y){const C=[];for(let D=0;D<c.length;D++){const P=$f(c[D]);C.find(N=>N.url===P)||C.push({url:P,filter:d})}return this.subscribeMap(C,y)}subscribeMany(c,d,y){const C=[],D=[];for(let P=0;P<c.length;P++){const N=$f(c[P]);D.indexOf(N)===-1&&(D.push(N),C.push({url:N,filter:d}))}return this.subscribeMap(C,y)}subscribeMap(c,d){const y=new Map;for(const _e of c){const{url:we,filter:ve}=_e;y.has(we)||y.set(we,[]),y.get(we).push(ve)}const C=Array.from(y.entries()).map(([_e,we])=>({url:_e,filters:we}));this.trackRelays&&(d.receivedEvent=(_e,we)=>{let ve=this.seenOn.get(we);ve||(ve=new Set,this.seenOn.set(we,ve)),ve.add(_e)});const D=new Set,P=[],N=[];let h=_e=>{N[_e]||(N[_e]=!0,N.filter(we=>we).length===C.length&&(d.oneose?.(),h=()=>{}))};const U=[];let H=(_e,we)=>{U[_e]||(h(_e),U[_e]=we,U.filter(ve=>ve).length===C.length&&(d.onclose?.(U),H=()=>{}))};const Y=_e=>{if(d.alreadyHaveEvent?.(_e))return!0;const we=D.has(_e);return D.add(_e),we},K=Promise.all(C.map(async({url:_e,filters:we},ve)=>{let pe;try{pe=await this.ensureRelay(_e,{connectionTimeout:d.maxWait?Math.max(d.maxWait*.8,d.maxWait-1e3):void 0})}catch(De){H(ve,De?.message||String(De));return}let he=pe.subscribe(we,{...d,oneose:()=>h(ve),onclose:De=>{De.startsWith("auth-required: ")&&d.onauth?pe.auth(d.onauth).then(()=>{pe.subscribe(we,{...d,oneose:()=>h(ve),onclose:Je=>{H(ve,Je)},alreadyHaveEvent:Y,eoseTimeout:d.maxWait})}).catch(Je=>{H(ve,`auth was required and attempted, but failed with: ${Je}`)}):H(ve,De)},alreadyHaveEvent:Y,eoseTimeout:d.maxWait});P.push(he)}));return{async close(_e){await K,P.forEach(we=>{we.close(_e)})}}}subscribeEose(c,d,y){const C=this.subscribe(c,d,{...y,oneose(){C.close("closed automatically on eose")}});return C}subscribeManyEose(c,d,y){const C=this.subscribeMany(c,d,{...y,oneose(){C.close("closed automatically on eose")}});return C}async querySync(c,d,y){return new Promise(async C=>{const D=[];this.subscribeEose(c,d,{...y,onevent(P){D.push(P)},onclose(P){C(D)}})})}async get(c,d,y){d.limit=1;const C=await this.querySync(c,d,y);return C.sort((D,P)=>P.created_at-D.created_at),C[0]||null}publish(c,d,y){return c.map($f).map(async(C,D,P)=>{if(P.indexOf(C)!==D)return Promise.reject("duplicate url");let N=await this.ensureRelay(C);return N.publish(d).catch(async h=>{if(h instanceof Error&&h.message.startsWith("auth-required: ")&&y?.onauth)return await N.auth(y.onauth),N.publish(d);throw h}).then(h=>{if(this.trackRelays){let U=this.seenOn.get(d.id);U||(U=new Set,this.seenOn.set(d.id,U)),U.add(N)}return h})})}listConnectionStatus(){const c=new Map;return this.relays.forEach((d,y)=>c.set(y,d.connected)),c}destroy(){this.relays.forEach(c=>c.close()),this.relays=new Map}},xv;try{xv=WebSocket}catch{}var y_=class extends VS{constructor(c){super({verifyEvent:v1,websocketImplementation:xv,...c})}},Qf={};Ls(Qf,{BECH32_REGEX:()=>_v,Bech32MaxSize:()=>ux,NostrTypeGuard:()=>GS,decode:()=>A1,decodeNostrURI:()=>qS,encodeBytes:()=>S1,naddrEncode:()=>KS,neventEncode:()=>$S,noteEncode:()=>WS,nprofileEncode:()=>YS,npubEncode:()=>XS,nsecEncode:()=>ZS});var GS={isNProfile:c=>/^nprofile1[a-z\d]+$/.test(c||""),isNEvent:c=>/^nevent1[a-z\d]+$/.test(c||""),isNAddr:c=>/^naddr1[a-z\d]+$/.test(c||""),isNSec:c=>/^nsec1[a-z\d]{58}$/.test(c||""),isNPub:c=>/^npub1[a-z\d]{58}$/.test(c||""),isNote:c=>/^note1[a-z\d]+$/.test(c||""),isNcryptsec:c=>/^ncryptsec1[a-z\d]+$/.test(c||"")},ux=5e3,_v=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function HS(c){const d=new Uint8Array(4);return d[0]=c>>24&255,d[1]=c>>16&255,d[2]=c>>8&255,d[3]=c&255,d}function qS(c){try{return c.startsWith("nostr:")&&(c=c.substring(6)),A1(c)}catch{return{type:"invalid",data:null}}}function A1(c){let{prefix:d,words:y}=th.decode(c,ux),C=new Uint8Array(th.fromWords(y));switch(d){case"nprofile":{let D=dy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:vs(D[0][0]),relays:D[1]?D[1].map(P=>jh.decode(P)):[]}}}case"nevent":{let D=dy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nevent");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(D[2]&&D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(D[3]&&D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:vs(D[0][0]),relays:D[1]?D[1].map(P=>jh.decode(P)):[],author:D[2]?.[0]?vs(D[2][0]):void 0,kind:D[3]?.[0]?parseInt(vs(D[3][0]),16):void 0}}}case"naddr":{let D=dy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!D[2]?.[0])throw new Error("missing TLV 2 for naddr");if(D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!D[3]?.[0])throw new Error("missing TLV 3 for naddr");if(D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:jh.decode(D[0][0]),pubkey:vs(D[2][0]),kind:parseInt(vs(D[3][0]),16),relays:D[1]?D[1].map(P=>jh.decode(P)):[]}}}case"nsec":return{type:d,data:C};case"npub":case"note":return{type:d,data:vs(C)};default:throw new Error(`unknown prefix ${d}`)}}function dy(c){let d={},y=c;for(;y.length>0;){let C=y[0],D=y[1],P=y.slice(2,2+D);if(y=y.slice(2+D),P.length<D)throw new Error(`not enough data to read on TLV ${C}`);d[C]=d[C]||[],d[C].push(P)}return d}function ZS(c){return S1("nsec",c)}function XS(c){return S1("npub",Ud(c))}function WS(c){return S1("note",Ud(c))}function E1(c,d){let y=th.toWords(d);return th.encode(c,y,ux)}function S1(c,d){return E1(c,d)}function YS(c){let d=hx({0:[Ud(c.pubkey)],1:(c.relays||[]).map(y=>yu.encode(y))});return E1("nprofile",d)}function $S(c){let d;c.kind!==void 0&&(d=HS(c.kind));let y=hx({0:[Ud(c.id)],1:(c.relays||[]).map(C=>yu.encode(C)),2:c.author?[Ud(c.author)]:[],3:d?[new Uint8Array(d)]:[]});return E1("nevent",y)}function KS(c){let d=new ArrayBuffer(4);new DataView(d).setUint32(0,c.kind,!1);let y=hx({0:[yu.encode(c.identifier)],1:(c.relays||[]).map(C=>yu.encode(C)),2:[Ud(c.pubkey)],3:[new Uint8Array(d)]});return E1("naddr",y)}function hx(c){let d=[];return Object.entries(c).reverse().forEach(([y,C])=>{C.forEach(D=>{let P=new Uint8Array(D.length+2);P.set([parseInt(y)],0),P.set([D.length],1),P.set(D,2),d.push(P)})}),y1(...d)}var QS={};Ls(QS,{decrypt:()=>JS,encrypt:()=>bv});function bv(c,d,y){const C=c instanceof Uint8Array?vs(c):c,D=b0.getSharedSecret(C,"02"+d),P=vv(D);let N=Uint8Array.from(Pb(16)),h=yu.encode(y),U=qb(P,N).encrypt(h),H=Uh.encode(new Uint8Array(U)),Y=Uh.encode(new Uint8Array(N.buffer));return`${H}?iv=${Y}`}function JS(c,d,y){const C=c instanceof Uint8Array?vs(c):c;let[D,P]=y.split("?iv="),N=b0.getSharedSecret(C,"02"+d),h=vv(N),U=Uh.decode(P),H=Uh.decode(D),Y=qb(h,U).decrypt(H);return jh.decode(Y)}function vv(c){return c.slice(1,33)}var eC={};Ls(eC,{NIP05_REGEX:()=>dx,isNip05:()=>tC,isValid:()=>rC,queryProfile:()=>wv,searchDomain:()=>iC,useFetchImplementation:()=>nC});var dx=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,tC=c=>dx.test(c||""),C1;try{C1=fetch}catch{}function nC(c){C1=c}async function iC(c,d=""){try{const y=`https://${c}/.well-known/nostr.json?name=${d}`,C=await C1(y,{redirect:"manual"});if(C.status!==200)throw Error("Wrong response code");return(await C.json()).names}catch{return{}}}async function wv(c){const d=c.match(dx);if(!d)return null;const[,y="_",C]=d;try{const D=`https://${C}/.well-known/nostr.json?name=${y}`,P=await C1(D,{redirect:"manual"});if(P.status!==200)throw Error("Wrong response code");const N=await P.json(),h=N.names[y];return h?{pubkey:h,relays:N.relays?.[h]}:null}catch{return null}}async function rC(c,d){const y=await wv(d);return y?y.pubkey===c:!1}var sC={};Ls(sC,{parse:()=>aC});function aC(c){const d={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let y,C;for(let D=c.tags.length-1;D>=0;D--){const P=c.tags[D];if(P[0]==="e"&&P[1]){const[N,h,U,H,Y]=P,K={id:h,relays:U?[U]:[],author:Y};if(H==="root"){d.root=K;continue}if(H==="reply"){d.reply=K;continue}if(H==="mention"){d.mentions.push(K);continue}y?C=K:y=K,d.mentions.push(K);continue}if(P[0]==="q"&&P[1]){const[N,h,U]=P;d.quotes.push({id:h,relays:U?[U]:[]})}if(P[0]==="p"&&P[1]){d.profiles.push({pubkey:P[1],relays:P[2]?[P[2]]:[]});continue}}return d.root||(d.root=C||y||d.reply),d.reply||(d.reply=y||d.root),[d.reply,d.root].forEach(D=>{if(!D)return;let P=d.mentions.indexOf(D);if(P!==-1&&d.mentions.splice(P,1),D.author){let N=d.profiles.find(h=>h.pubkey===D.author);N&&N.relays&&(D.relays||(D.relays=[]),N.relays.forEach(h=>{D.relays?.indexOf(h)===-1&&D.relays.push(h)}),N.relays=D.relays)}}),d.mentions.forEach(D=>{if(D.author){let P=d.profiles.find(N=>N.pubkey===D.author);P&&P.relays&&(D.relays||(D.relays=[]),P.relays.forEach(N=>{D.relays.indexOf(N)===-1&&D.relays.push(N)}),P.relays=D.relays)}}),d}var oC={};Ls(oC,{fetchRelayInformation:()=>cC,useFetchImplementation:()=>lC});var Av;try{Av=fetch}catch{}function lC(c){Av=c}async function cC(c){return await(await fetch(c.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var uC={};Ls(uC,{fastEventHash:()=>Sv,getPow:()=>Ev,minePow:()=>hC});function Ev(c){let d=0;for(let y=0;y<64;y+=8){const C=parseInt(c.substring(y,y+8),16);if(C===0)d+=32;else{d+=Math.clz32(C);break}}return d}function hC(c,d){let y=0;const C=c,D=["nonce",y.toString(),d.toString()];for(C.tags.push(D);;){const P=Math.floor(new Date().getTime()/1e3);if(P!==C.created_at&&(y=0,C.created_at=P),D[1]=(++y).toString(),C.id=Sv(C),Ev(C.id)>=d)break}return C}function Sv(c){return vs(Gd(yu.encode(JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content]))))}var dC={};Ls(dC,{unwrapEvent:()=>AC,unwrapManyEvents:()=>EC,wrapEvent:()=>Bv,wrapManyEvents:()=>wC});var fC={};Ls(fC,{createRumor:()=>Pv,createSeal:()=>Ov,createWrap:()=>zv,unwrapEvent:()=>yx,unwrapManyEvents:()=>Lv,wrapEvent:()=>r1,wrapManyEvents:()=>bC});var zg={};Ls(zg,{decrypt:()=>mx,encrypt:()=>gx,getConversationKey:()=>fx,v2:()=>xC});var Cv=1,Tv=65535;function fx(c,d){const y=b0.getSharedSecret(c,"02"+d).subarray(1,33);return $A(Gd,y,"nip44-v2")}function Iv(c,d){const y=KA(Gd,c,d,76);return{chacha_key:y.subarray(0,32),chacha_nonce:y.subarray(32,44),hmac_key:y.subarray(44,76)}}function px(c){if(!Number.isSafeInteger(c)||c<1)throw new Error("expected positive integer");if(c<=32)return 32;const d=1<<Math.floor(Math.log2(c-1))+1,y=d<=256?32:d/8;return y*(Math.floor((c-1)/y)+1)}function pC(c){if(!Number.isSafeInteger(c)||c<Cv||c>Tv)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const d=new Uint8Array(2);return new DataView(d.buffer).setUint16(0,c,!1),d}function gC(c){const d=yu.encode(c),y=d.length,C=pC(y),D=new Uint8Array(px(y)-y);return y1(C,d,D)}function mC(c){const d=new DataView(c.buffer).getUint16(0),y=c.subarray(2,2+d);if(d<Cv||d>Tv||y.length!==d||c.length!==2+px(d))throw new Error("invalid padding");return jh.decode(y)}function Mv(c,d,y){if(y.length!==32)throw new Error("AAD associated data must be 32 bytes");const C=y1(y,d);return _1(Gd,c,C)}function yC(c){if(typeof c!="string")throw new Error("payload must be a valid string");const d=c.length;if(d<132||d>87472)throw new Error("invalid payload length: "+d);if(c[0]==="#")throw new Error("unknown encryption version");let y;try{y=Uh.decode(c)}catch(P){throw new Error("invalid base64: "+P.message)}const C=y.length;if(C<99||C>65603)throw new Error("invalid data length: "+C);const D=y[0];if(D!==2)throw new Error("unknown encryption version "+D);return{nonce:y.subarray(1,33),ciphertext:y.subarray(33,-32),mac:y.subarray(-32)}}function gx(c,d,y=Pb(32)){const{chacha_key:C,chacha_nonce:D,hmac_key:P}=Iv(d,y),N=gC(c),h=Yb(C,D,N),U=Mv(P,h,y);return Uh.encode(y1(new Uint8Array([2]),y,h,U))}function mx(c,d){const{nonce:y,ciphertext:C,mac:D}=yC(c),{chacha_key:P,chacha_nonce:N,hmac_key:h}=Iv(d,y),U=Mv(h,C,y);if(!NA(U,D))throw new Error("invalid MAC");const H=Yb(P,N,C);return mC(H)}var xC={utils:{getConversationKey:fx,calcPaddedLen:px},encrypt:gx,decrypt:mx},_C=2880*60,kv=()=>Math.round(Date.now()/1e3),Nv=()=>Math.round(kv()-Math.random()*_C),Dv=(c,d)=>fx(c,d),Rv=(c,d,y)=>gx(JSON.stringify(c),Dv(d,y)),x_=(c,d)=>JSON.parse(mx(c.content,Dv(d,c.pubkey)));function Pv(c,d){const y={created_at:kv(),content:"",tags:[],...c,pubkey:Og(d)};return y.id=Wm(y),y}function Ov(c,d,y){return zc({kind:iv,content:Rv(c,d,y),created_at:Nv(),tags:[]},d)}function zv(c,d){const y=Jb();return zc({kind:uv,content:Rv(c,y,d),created_at:Nv(),tags:[["p",d]]},y)}function r1(c,d,y){const C=Pv(c,d),D=Ov(C,d,y);return zv(D,y)}function bC(c,d,y){if(!y||y.length===0)throw new Error("At least one recipient is required.");const C=Og(d),D=[r1(c,d,C)];return y.forEach(P=>{D.push(r1(c,d,P))}),D}function yx(c,d){const y=x_(c,d);return x_(y,d)}function Lv(c,d){let y=[];return c.forEach(C=>{y.push(yx(C,d))}),y.sort((C,D)=>C.created_at-D.created_at),y}function vC(c,d,y,C){const D={created_at:Math.ceil(Date.now()/1e3),kind:rv,tags:[],content:d};return(Array.isArray(c)?c:[c]).forEach(({publicKey:N,relayUrl:h})=>{D.tags.push(h?["p",N,h]:["p",N])}),C&&D.tags.push(["e",C.eventId,C.relayUrl||"","reply"]),y&&D.tags.push(["subject",y]),D}function Bv(c,d,y,C,D){const P=vC(d,y,C,D);return r1(P,c,d.publicKey)}function wC(c,d,y,C,D){if(!d||d.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Og(c)},...d].map(N=>Bv(c,N,y,C,D))}var AC=yx,EC=Lv,SC={};Ls(SC,{finishRepostEvent:()=>CC,getRepostedEvent:()=>TC,getRepostedEventPointer:()=>Fv});function CC(c,d,y,C){let D;const P=[...c.tags??[],["e",d.id,y],["p",d.pubkey]];return d.kind===nv?D=ax:(D=lx,P.push(["k",String(d.kind)])),zc({kind:D,tags:P,content:c.content===""||d.tags?.find(N=>N[0]==="-")?"":JSON.stringify(d),created_at:c.created_at},C)}function Fv(c){if(![ax,lx].includes(c.kind))return;let d,y;for(let C=c.tags.length-1;C>=0&&(d===void 0||y===void 0);C--){const D=c.tags[C];D.length>=2&&(D[0]==="e"&&d===void 0?d=D:D[0]==="p"&&y===void 0&&(y=D))}if(d!==void 0)return{id:d[1],relays:[d[2],y?.[2]].filter(C=>typeof C=="string"),author:y?.[1]}}function TC(c,{skipVerification:d}={}){const y=Fv(c);if(y===void 0||c.content==="")return;let C;try{C=JSON.parse(c.content)}catch{return}if(C.id===y.id&&!(!d&&!v1(C)))return C}var IC={};Ls(IC,{NOSTR_URI_REGEX:()=>xx,parse:()=>kC,test:()=>MC});var xx=new RegExp(`nostr:(${_v.source})`);function MC(c){return typeof c=="string"&&new RegExp(`^${xx.source}$`).test(c)}function kC(c){const d=c.match(new RegExp(`^${xx.source}$`));if(!d)throw new Error(`Invalid Nostr URI: ${c}`);return{uri:d[0],value:d[1],decoded:A1(d[1])}}var NC={};Ls(NC,{finishReactionEvent:()=>DC,getReactedEventPointer:()=>RC});function DC(c,d,y){const C=d.tags.filter(D=>D.length>=2&&(D[0]==="e"||D[0]==="p"));return zc({...c,kind:ox,tags:[...c.tags??[],...C,["e",d.id],["p",d.pubkey]],content:c.content??"+"},y)}function RC(c){if(c.kind!==ox)return;let d,y;for(let C=c.tags.length-1;C>=0&&(d===void 0||y===void 0);C--){const D=c.tags[C];D.length>=2&&(D[0]==="e"&&d===void 0?d=D:D[0]==="p"&&y===void 0&&(y=D))}if(!(d===void 0||y===void 0))return{id:d[1],relays:[d[2],y[2]].filter(C=>C!==void 0),author:y[1]}}var PC={};Ls(PC,{parse:()=>zC});var __=/\W/m,b_=/[^\w\/] |[^\w\/]$|$|,| /m,OC=42;function*zC(c){let d=[];if(typeof c!="string"){for(let P=0;P<c.tags.length;P++){const N=c.tags[P];N[0]==="emoji"&&N.length>=3&&d.push({type:"emoji",shortcode:N[1],url:N[2]})}c=c.content}const y=c.length;let C=0,D=0;e:for(;D<y;){const P=c.indexOf(":",D),N=c.indexOf("#",D);if(P===-1&&N===-1)break e;if(P===-1||N>=0&&N<P){if(N===0||c[N-1]===" "){const h=c.slice(N+1,N+OC).match(__),U=h?N+1+h.index:y;yield{type:"text",text:c.slice(C,N)},yield{type:"hashtag",value:c.slice(N+1,U)},D=U,C=D;continue e}D=N+1;continue e}if(c.slice(P-5,P)==="nostr"){const h=c.slice(P+60).match(__),U=h?P+60+h.index:y;try{let H,{data:Y,type:K}=A1(c.slice(P+1,U));switch(K){case"npub":H={pubkey:Y};break;case"note":H={id:Y};break;case"nsec":D=U+1;continue;default:H=Y}C!==P-5&&(yield{type:"text",text:c.slice(C,P-5)}),yield{type:"reference",pointer:H},D=U,C=D;continue e}catch{D=P+1;continue e}}else if(c.slice(P-5,P)==="https"||c.slice(P-4,P)==="http"){const h=c.slice(P+4).match(b_),U=h?P+4+h.index:y,H=c[P-1]==="s"?5:4;try{let Y=new URL(c.slice(P-H,U));if(Y.hostname.indexOf(".")===-1)throw new Error("invalid url");if(C!==P-H&&(yield{type:"text",text:c.slice(C,P-H)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(Y.pathname)){yield{type:"image",url:Y.toString()},D=U,C=D;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(Y.pathname)){yield{type:"video",url:Y.toString()},D=U,C=D;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(Y.pathname)){yield{type:"audio",url:Y.toString()},D=U,C=D;continue e}yield{type:"url",url:Y.toString()},D=U,C=D;continue e}catch{D=U+1;continue e}}else if(c.slice(P-3,P)==="wss"||c.slice(P-2,P)==="ws"){const h=c.slice(P+4).match(b_),U=h?P+4+h.index:y,H=c[P-1]==="s"?3:2;try{let Y=new URL(c.slice(P-H,U));if(Y.hostname.indexOf(".")===-1)throw new Error("invalid ws url");C!==P-H&&(yield{type:"text",text:c.slice(C,P-H)}),yield{type:"relay",url:Y.toString()},D=U,C=D;continue e}catch{D=U+1;continue e}}else{for(let h=0;h<d.length;h++){const U=d[h];if(c[P+U.shortcode.length+1]===":"&&c.slice(P+1,P+U.shortcode.length+1)===U.shortcode){C!==P&&(yield{type:"text",text:c.slice(C,P)}),yield U,D=P+U.shortcode.length+2,C=D;continue e}}D=P+1;continue e}}C!==y&&(yield{type:"text",text:c.slice(C)})}var LC={};Ls(LC,{channelCreateEvent:()=>BC,channelHideMessageEvent:()=>UC,channelMessageEvent:()=>jC,channelMetadataEvent:()=>FC,channelMuteUserEvent:()=>VC});var BC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return zc({kind:sv,tags:[...c.tags??[]],content:y,created_at:c.created_at},d)},FC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return zc({kind:av,tags:[["e",c.channel_create_event_id],...c.tags??[]],content:y,created_at:c.created_at},d)},jC=(c,d)=>{const y=[["e",c.channel_create_event_id,c.relay_url,"root"]];return c.reply_to_channel_message_event_id&&y.push(["e",c.reply_to_channel_message_event_id,c.relay_url,"reply"]),zc({kind:ov,tags:[...y,...c.tags??[]],content:c.content,created_at:c.created_at},d)},UC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return zc({kind:lv,tags:[["e",c.channel_message_event_id],...c.tags??[]],content:y,created_at:c.created_at},d)},VC=(c,d)=>{let y;if(typeof c.content=="object")y=JSON.stringify(c.content);else if(typeof c.content=="string")y=c.content;else return;return zc({kind:cv,tags:[["p",c.pubkey_to_mute],...c.tags??[]],content:y,created_at:c.created_at},d)},GC={};Ls(GC,{EMOJI_SHORTCODE_REGEX:()=>jv,matchAll:()=>HC,regex:()=>_x,replaceAll:()=>qC});var jv=/:(\w+):/,_x=()=>new RegExp(`\\B${jv.source}\\B`,"g");function*HC(c){const d=c.matchAll(_x());for(const y of d)try{const[C,D]=y;yield{shortcode:C,name:D,start:y.index,end:y.index+C.length}}catch{}}function qC(c,d){return c.replaceAll(_x(),(y,C)=>d({shortcode:y,name:C}))}var ZC={};Ls(ZC,{useFetchImplementation:()=>XC,validateGithub:()=>WC});var bx;try{bx=fetch}catch{}function XC(c){bx=c}async function WC(c,d,y){try{return await(await bx(`https://gist.github.com/${d}/${y}/raw`)).text()===`Verifying that I control the following Nostr public key: ${c}`}catch{return!1}}var YC={};Ls(YC,{makeNwcRequestEvent:()=>KC,parseConnectionString:()=>$C});function $C(c){const{host:d,pathname:y,searchParams:C}=new URL(c),D=y||d,P=C.get("relay"),N=C.get("secret");if(!D||!P||!N)throw new Error("invalid connection string");return{pubkey:D,relay:P,secret:N}}async function KC(c,d,y){const D=bv(d,c,JSON.stringify({method:"pay_invoice",params:{invoice:y}})),P={kind:dv,created_at:Math.round(Date.now()/1e3),content:D,tags:[["p",c]]};return zc(P,d)}var QC={};Ls(QC,{normalizeIdentifier:()=>JC});function JC(c){return c=c.trim().toLowerCase(),c=c.normalize("NFKC"),Array.from(c).map(d=>new RegExp("\\p{Letter}","u").test(d)||new RegExp("\\p{Number}","u").test(d)?d:"-").join("")}var e3={};Ls(e3,{getSatoshisAmountFromBolt11:()=>a3,getZapEndpoint:()=>n3,makeZapReceipt:()=>s3,makeZapRequest:()=>i3,useFetchImplementation:()=>t3,validateZapRequest:()=>r3});var vx;try{vx=fetch}catch{}function t3(c){vx=c}async function n3(c){try{let d="",{lud06:y,lud16:C}=JSON.parse(c.content);if(C){let[N,h]=C.split("@");d=new URL(`/.well-known/lnurlp/${N}`,`https://${h}`).toString()}else if(y){let{words:N}=th.decode(y,1e3),h=th.fromWords(N);d=jh.decode(h)}else return null;let P=await(await vx(d)).json();if(P.allowsNostr&&P.nostrPubkey)return P.callback}catch{}return null}function i3(c){let d={kind:9734,created_at:Math.round(Date.now()/1e3),content:c.comment||"",tags:[["p","pubkey"in c?c.pubkey:c.event.pubkey],["amount",c.amount.toString()],["relays",...c.relays]]};if("event"in c){if(d.tags.push(["e",c.event.id]),rx(c.event.kind)){const y=["a",`${c.event.kind}:${c.event.pubkey}:`];d.tags.push(y)}else if(sx(c.event.kind)){let y=c.event.tags.find(([D,P])=>D==="d"&&P);if(!y)throw new Error("d tag not found or is empty");const C=["a",`${c.event.kind}:${c.event.pubkey}:${y[1]}`];d.tags.push(C)}d.tags.push(["k",c.event.kind.toString()])}return d}function r3(c){let d;try{d=JSON.parse(c)}catch{return"Invalid zap request JSON."}if(!nx(d))return"Zap request is not a valid Nostr event.";if(!v1(d))return"Invalid signature on zap request.";let y=d.tags.find(([P,N])=>P==="p"&&N);if(!y)return"Zap request doesn't have a 'p' tag.";if(!y[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let C=d.tags.find(([P,N])=>P==="e"&&N);return C&&!C[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":d.tags.find(([P,N])=>P==="relays"&&N)?null:"Zap request doesn't have a 'relays' tag."}function s3({zapRequest:c,preimage:d,bolt11:y,paidAt:C}){let D=JSON.parse(c),P=D.tags.filter(([h])=>h==="e"||h==="p"||h==="a"),N={kind:9735,created_at:Math.round(C.getTime()/1e3),content:"",tags:[...P,["P",D.pubkey],["bolt11",y],["description",c]]};return d&&N.tags.push(["preimage",d]),N}function a3(c){if(c.length<50)return 0;c=c.substring(0,50);const d=c.lastIndexOf("1");if(d===-1)return 0;const y=c.substring(0,d);if(!y.startsWith("lnbc"))return 0;const C=y.substring(4);if(C.length<1)return 0;const D=C[C.length-1],P=D.charCodeAt(0)-48,N=P>=0&&P<=9;let h=C.length-1;if(N&&h++,h<1)return 0;const U=parseInt(C.substring(0,h));switch(D){case"m":return U*1e5;case"u":return U*100;case"n":return U/10;case"p":return U/1e4;default:return U*1e8}}var o3={};Ls(o3,{Negentropy:()=>Vv,NegentropyStorageVector:()=>u3,NegentropySync:()=>h3});var fy=97,g0=32,Uv=16,qf={Skip:0,Fingerprint:1,IdList:2},Fh=class{_raw;length;constructor(c){typeof c=="number"?(this._raw=new Uint8Array(c),this.length=0):c instanceof Uint8Array?(this._raw=new Uint8Array(c),this.length=c.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(c){if(c instanceof Fh&&(c=c.unwrap()),typeof c.length!="number")throw Error("bad length");const d=c.length+this.length;if(this.capacity<d){const y=this._raw,C=Math.max(this.capacity*2,d);this._raw=new Uint8Array(C),this._raw.set(y)}this._raw.set(c,this.length),this.length+=c.length}shift(){const c=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,c}shiftN(c=1){const d=this._raw.subarray(0,c);return this._raw=this._raw.subarray(c),this.length-=c,d}};function Vm(c){let d=0;for(;;){if(c.length===0)throw Error("parse ends prematurely");let y=c.shift();if(d=d<<7|y&127,(y&128)===0)break}return d}function zh(c){if(c===0)return new Fh(new Uint8Array([0]));let d=[];for(;c!==0;)d.push(c&127),c>>>=7;d.reverse();for(let y=0;y<d.length-1;y++)d[y]|=128;return new Fh(new Uint8Array(d))}function l3(c){return Ym(c,1)[0]}function Ym(c,d){if(c.length<d)throw Error("parse ends prematurely");return c.shiftN(d)}var c3=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(g0)}add(c){let d=0,y=0,C=new DataView(this.buf.buffer),D=new DataView(c.buffer);for(let P=0;P<8;P++){let N=P*4,h=C.getUint32(N,!0),U=D.getUint32(N,!0),H=h;H+=d,H+=U,H>4294967295&&(y=1),C.setUint32(N,H&4294967295,!0),d=y,y=0}}negate(){let c=new DataView(this.buf.buffer);for(let y=0;y<8;y++){let C=y*4;c.setUint32(C,~c.getUint32(C,!0))}let d=new Uint8Array(g0);d[0]=1,this.add(d)}getFingerprint(c){let d=new Fh;return d.extend(this.buf),d.extend(zh(c)),Gd(d.unwrap()).subarray(0,Uv)}},u3=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(c,d){if(this.sealed)throw Error("already sealed");const y=jb(d);if(y.byteLength!==g0)throw Error("bad id size for added item");this.items.push({timestamp:c,id:y})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(py);for(let c=1;c<this.items.length;c++)if(py(this.items[c-1],this.items[c])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(c){if(this._checkSealed(),c>=this.items.length)throw Error("out of range");return this.items[c]}iterate(c,d,y){this._checkSealed(),this._checkBounds(c,d);for(let C=c;C<d&&y(this.items[C],C);++C);}findLowerBound(c,d,y){return this._checkSealed(),this._checkBounds(c,d),this._binarySearch(this.items,c,d,C=>py(C,y)<0)}fingerprint(c,d){let y=new c3;return y.setToZero(),this.iterate(c,d,C=>(y.add(C.id),!0)),y.getFingerprint(d-c)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(c,d){if(c>d||d>this.items.length)throw Error("bad range")}_binarySearch(c,d,y,C){let D=y-d;for(;D>0;){let P=d,N=Math.floor(D/2);P+=N,C(c[P])?(d=++P,D-=N+1):D=N}return d}},Vv=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(c,d=6e4){if(d<4096)throw Error("frameSizeLimit too small");this.storage=c,this.frameSizeLimit=d,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(c,d){return{timestamp:c,id:d||new Uint8Array(0)}}initiate(){let c=new Fh;return c.extend(new Uint8Array([fy])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),c),h0(c.unwrap())}reconcile(c,d,y){const C=new Fh(jb(c));this.lastTimestampIn=this.lastTimestampOut=0;let D=new Fh;D.extend(new Uint8Array([fy]));let P=l3(C);if(P<96||P>111)throw Error("invalid negentropy protocol version byte");if(P!==fy)throw Error("unsupported negentropy protocol version requested: "+(P-96));let N=this.storage.size(),h=this._bound(0),U=0,H=!1;for(;C.length!==0;){let Y=new Fh,K=()=>{H&&(H=!1,Y.extend(this.encodeBound(h)),Y.extend(zh(qf.Skip)))},_e=this.decodeBound(C),we=Vm(C),ve=U,pe=this.storage.findLowerBound(U,N,_e);if(we===qf.Skip)H=!0;else if(we===qf.Fingerprint){let he=Ym(C,Uv),De=this.storage.fingerprint(ve,pe);Gv(he,De)!==0?(K(),this.splitRange(ve,pe,_e,Y)):H=!0}else if(we===qf.IdList){let he=Vm(C),De={};for(let Je=0;Je<he;Je++){let Xe=Ym(C,g0);De[h0(Xe)]=Xe}if(H=!0,this.storage.iterate(ve,pe,Je=>{let Xe=Je.id;const mt=h0(Xe);return De[mt]?delete De[h0(Xe)]:d?.(mt),!0}),y)for(let Je of Object.values(De))y(h0(Je))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(D.length+Y.length)){let he=this.storage.fingerprint(pe,N);D.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),D.extend(zh(qf.Fingerprint)),D.extend(he);break}else D.extend(Y);U=pe,h=_e}return D.length===1?null:h0(D.unwrap())}splitRange(c,d,y,C){let D=d-c,P=16;if(D<P*2)C.extend(this.encodeBound(y)),C.extend(zh(qf.IdList)),C.extend(zh(D)),this.storage.iterate(c,d,N=>(C.extend(N.id),!0));else{let N=Math.floor(D/P),h=D%P,U=c;for(let H=0;H<P;H++){let Y=N+(H<h?1:0),K=this.storage.fingerprint(U,U+Y);U+=Y;let _e;if(U===d)_e=y;else{let we,ve;this.storage.iterate(U-1,U+1,(pe,he)=>(he===U-1?we=pe:ve=pe,!0)),_e=this.getMinimalBound(we,ve)}C.extend(this.encodeBound(_e)),C.extend(zh(qf.Fingerprint)),C.extend(K)}}}exceededFrameSizeLimit(c){return c>this.frameSizeLimit-200}decodeTimestampIn(c){let d=Vm(c);return d=d===0?Number.MAX_VALUE:d-1,this.lastTimestampIn===Number.MAX_VALUE||d===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(d+=this.lastTimestampIn,this.lastTimestampIn=d,d)}decodeBound(c){let d=this.decodeTimestampIn(c),y=Vm(c);if(y>g0)throw Error("bound key too long");let C=Ym(c,y);return{timestamp:d,id:C}}encodeTimestampOut(c){if(c===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,zh(0);let d=c;return c-=this.lastTimestampOut,this.lastTimestampOut=d,zh(c+1)}encodeBound(c){let d=new Fh;return d.extend(this.encodeTimestampOut(c.timestamp)),d.extend(zh(c.id.length)),d.extend(c.id),d}getMinimalBound(c,d){if(d.timestamp!==c.timestamp)return this._bound(d.timestamp);{let y=0,C=d.id,D=c.id;for(let P=0;P<g0&&C[P]===D[P];P++)y++;return this._bound(d.timestamp,d.id.subarray(0,y+1))}}};function Gv(c,d){for(let y=0;y<c.byteLength;y++){if(c[y]<d[y])return-1;if(c[y]>d[y])return 1}return c.byteLength>d.byteLength?1:c.byteLength<d.byteLength?-1:0}function py(c,d){return c.timestamp===d.timestamp?Gv(c.id,d.id):c.timestamp-d.timestamp}var h3=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(c,d,y,C={}){this.relay=c,this.storage=d,this.neg=new Vv(d),this.onhave=C.onhave,this.onneed=C.onneed,this.filter=y,this.subscription=this.relay.prepareSubscription([{}],{label:C.label||"negentropy"}),this.subscription.oncustom=D=>{switch(D[0]){case"NEG-MSG":{D.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${D}`);try{const P=this.neg.reconcile(D[2],this.onhave,this.onneed);P?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${P}"]`):(this.close(),C.onclose?.())}catch(P){console.error("negentropy reconcile error:",P),C?.onclose?.(`reconcile error: ${P}`)}break}case"NEG-CLOSE":{const P=D[2];console.warn("negentropy error:",P),C.onclose?.(P);break}case"NEG-ERR":C.onclose?.()}}}async start(){const c=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${c}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},d3={};Ls(d3,{getToken:()=>f3,hashPayload:()=>wx,unpackEventFromToken:()=>qv,validateEvent:()=>Kv,validateEventKind:()=>Xv,validateEventMethodTag:()=>Yv,validateEventPayloadTag:()=>$v,validateEventTimestamp:()=>Zv,validateEventUrlTag:()=>Wv,validateToken:()=>p3});var Hv="Nostr ";async function f3(c,d,y,C=!1,D){const P={kind:cx,tags:[["u",c],["method",d]],created_at:Math.round(new Date().getTime()/1e3),content:""};D&&P.tags.push(["payload",wx(D)]);const N=await y(P);return(C?Hv:"")+Uh.encode(yu.encode(JSON.stringify(N)))}async function p3(c,d,y){const C=await qv(c).catch(P=>{throw P});return await Kv(C,d,y).catch(P=>{throw P})}async function qv(c){if(!c)throw new Error("Missing token");c=c.replace(Hv,"");const d=jh.decode(Uh.decode(c));if(!d||d.length===0||!d.startsWith("{"))throw new Error("Invalid token");return JSON.parse(d)}function Zv(c){return c.created_at?Math.round(new Date().getTime()/1e3)-c.created_at<60:!1}function Xv(c){return c.kind===cx}function Wv(c,d){const y=c.tags.find(C=>C[0]==="u");return y?y.length>0&&y[1]===d:!1}function Yv(c,d){const y=c.tags.find(C=>C[0]==="method");return y?y.length>0&&y[1].toLowerCase()===d.toLowerCase():!1}function wx(c){const d=Gd(yu.encode(JSON.stringify(c)));return vs(d)}function $v(c,d){const y=c.tags.find(D=>D[0]==="payload");if(!y)return!1;const C=wx(d);return y.length>0&&y[1]===C}async function Kv(c,d,y,C){if(!v1(c))throw new Error("Invalid nostr event, signature invalid");if(!Xv(c))throw new Error("Invalid nostr event, kind invalid");if(!Zv(c))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Wv(c,d))throw new Error("Invalid nostr event, url tag invalid");if(!Yv(c,y))throw new Error("Invalid nostr event, method tag invalid");if(C&&typeof C=="object"&&Object.keys(C).length>0&&!$v(c,C))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Ln={PARKING_LOG:31417,PARKING_AREA_INDICATOR:31714,ROUTE_LOG:34171,RELAY_LIST:10002,LISTED_PARKING_METADATA:31147,PARKING_SPOT_LISTING:37141,LISTED_SPOT_LOG:1714,PRIVATE_LOG_NOTE:1417,LABEL:1985},zd="f8ecf5df652f567970ec6d00538cc15c4cec9d0c88760cd8b4c86acd43542e5a",Kn=["wss://relay.primal.net","wss://nos.lol","wss://relay.snort.social"];class g3{relayHealth=new Map;listeners=new Set;subscribe(d){return this.listeners.add(d),d(this.relayHealth),()=>this.listeners.delete(d)}notifyListeners(){this.listeners.forEach(d=>d(this.relayHealth))}initialize(d){d.forEach(y=>{this.relayHealth.has(y)||this.relayHealth.set(y,{url:y,connected:!0,lastSuccess:Date.now(),lastFailure:0,avgLatency:0,failureCount:0,successCount:0})})}recordSuccess(d,y){const C=this.relayHealth.get(d);C&&(C.connected=!0,C.lastSuccess=Date.now(),C.successCount++,C.avgLatency=C.avgLatency===0?y:C.avgLatency*.8+y*.2,this.notifyListeners())}recordFailure(d){const y=this.relayHealth.get(d);y&&(y.lastFailure=Date.now(),y.failureCount++,y.failureCount>=3&&Date.now()-y.lastSuccess>3e4&&(y.connected=!1,console.warn(`[Parlens] Relay ${d} marked unhealthy after ${y.failureCount} failures`)),this.notifyListeners())}getHealthyRelays(d){const y=d.filter(C=>{const D=this.relayHealth.get(C);return D?D.connected:!0});return y.length===0&&d.length>0?(this.resetAll(),d):y}getSortedByLatency(d){return[...d].sort((y,C)=>{const D=this.relayHealth.get(y),P=this.relayHealth.get(C),N=D?.avgLatency||0,h=P?.avgLatency||0;return N-h})}markConnected(d){const y=this.relayHealth.get(d);y&&(y.connected=!0,y.failureCount=0)}resetAll(){this.relayHealth.forEach(d=>{d.connected=!0,d.failureCount=0}),this.notifyListeners(),console.log("[Parlens] Relay health monitor reset")}getStats(){return Array.from(this.relayHealth.values())}}const _o=new g3,v_=c=>Array.from(c).map(d=>d.toString(16).padStart(2,"0")).join(""),Qv=me.createContext(null),m3=({children:c})=>{const[d,y]=me.useState(localStorage.getItem("parlens_pubkey")),[C,D]=me.useState(()=>new y_({enablePing:!0,enableReconnect:!0}));me.useEffect(()=>{_o.initialize(Kn),console.log("[Parlens] Relay health monitor initialized for:",Kn)},[]);const P=async()=>{console.log("[Parlens] Refreshing relay connections...");try{C.close(Kn)}catch(K){console.warn("[Parlens] Error closing connections:",K)}_o.resetAll();const Y=new y_({enablePing:!0,enableReconnect:!0});await Promise.allSettled(Kn.map(K=>Y.ensureRelay(K))),D(Y),console.log("[Parlens] Connections refreshed. New pool instance created.")};me.useEffect(()=>{let Y=0;const K=()=>{if(document.visibilityState==="hidden")Y=Date.now();else if(document.visibilityState==="visible"&&Y>0){const _e=Date.now()-Y;_e>5e3&&(console.log("[Parlens] App resumed after",_e,"ms - refreshing connections"),P())}};return document.addEventListener("visibilitychange",K),()=>document.removeEventListener("visibilitychange",K)},[C]);const N=async(Y,K,_e)=>{let we="",ve=null;if(Y==="extension"){if(!window.nostr)throw new Error("Nostr extension not found");we=await window.nostr.getPublicKey()}else if(Y==="nsec"&&K)try{const pe=Qf.decode(K);if(pe.type!=="nsec")throw new Error("Not an nsec");ve=pe.data,we=Og(ve),localStorage.setItem("parlens_privkey",v_(ve))}catch{throw new Error("Invalid nsec format")}else Y==="create"&&(ve=Jb(),we=Og(ve),localStorage.setItem("parlens_privkey",v_(ve)));if(y(we),localStorage.setItem("parlens_pubkey",we),Y==="create"&&_e&&ve)try{const pe=zc({kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:_e,display_name:_e,picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${we}`})},ve);await Promise.any([C.publish(["wss://relay.damus.io","wss://nos.lol"],pe)])}catch(pe){console.warn("Failed to publish metadata:",pe)}},h=()=>{y(null),localStorage.removeItem("parlens_pubkey"),localStorage.removeItem("parlens_privkey")},U=async()=>{if(d){try{const Y={kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:"Deleted User",about:"This account has been deleted by the user.",picture:"",deleted:!0})},K=await H(Y);await Promise.allSettled(C.publish(Kn,K))}catch(Y){console.error("Failed to publish deletion metadata:",Y)}h()}},H=async Y=>{const K=localStorage.getItem("parlens_privkey");if(K){const _e=new Uint8Array(K.match(/.{1,2}/g).map(we=>parseInt(we,16)));return zc(Y,_e)}if(window.nostr)return await window.nostr.signEvent(Y);throw new Error("No signing method available")};return k.jsx(Qv.Provider,{value:{pubkey:d,login:N,logout:h,deleteAccount:U,pool:C,signEvent:H,refreshConnections:P},children:c})},nh=()=>{const c=me.useContext(Qv);if(!c)throw new Error("useAuth must be used within AuthProvider");return c};const y3=c=>c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),x3=c=>c.replace(/^([A-Z])|[\s-_]+(\w)/g,(d,y,C)=>C?C.toUpperCase():y.toLowerCase()),w_=c=>{const d=x3(c);return d.charAt(0).toUpperCase()+d.slice(1)},Jv=(...c)=>c.filter((d,y,C)=>!!d&&d.trim()!==""&&C.indexOf(d)===y).join(" ").trim(),_3=c=>{for(const d in c)if(d.startsWith("aria-")||d==="role"||d==="title")return!0};var b3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const v3=me.forwardRef(({color:c="currentColor",size:d=24,strokeWidth:y=2,absoluteStrokeWidth:C,className:D="",children:P,iconNode:N,...h},U)=>me.createElement("svg",{ref:U,...b3,width:d,height:d,stroke:c,strokeWidth:C?Number(y)*24/Number(d):y,className:Jv("lucide",D),...!P&&!_3(h)&&{"aria-hidden":"true"},...h},[...N.map(([H,Y])=>me.createElement(H,Y)),...Array.isArray(P)?P:[P]]));const or=(c,d)=>{const y=me.forwardRef(({className:C,...D},P)=>me.createElement(v3,{ref:P,iconNode:d,className:Jv(`lucide-${y3(w_(c))}`,`lucide-${c}`,C),...D}));return y.displayName=w_(c),y};const w3=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ax=or("arrow-left",w3);const A3=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],e2=or("arrow-right",A3);const E3=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],S3=or("arrow-up-down",E3);const C3=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],T3=or("arrow-up",C3);const I3=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ex=or("ban",I3);const M3=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Jf=or("check",M3);const k3=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Fd=or("chevron-down",k3);const N3=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],tp=or("chevron-right",N3);const D3=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],T1=or("chevron-up",D3);const R3=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],t2=or("clock",R3);const P3=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],n2=or("copy",P3);const O3=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],z3=or("ellipsis-vertical",O3);const L3=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Sx=or("eye-off",L3);const B3=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],F3=or("eye",B3);const j3=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],U3=or("folder-open",j3);const V3=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Py=or("key",V3);const G3=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],H3=or("locate-fixed",G3);const q3=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}]],Gm=or("locate",q3);const Z3=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],eo=or("map-pin",Z3);const X3=[["path",{d:"M18 8c0 3.613-3.869 7.429-5.393 8.795a1 1 0 0 1-1.214 0C9.87 15.429 6 11.613 6 8a6 6 0 0 1 12 0",key:"11u0oz"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M8.714 14h-3.71a1 1 0 0 0-.948.683l-2.004 6A1 1 0 0 0 3 22h18a1 1 0 0 0 .948-1.316l-2-6a1 1 0 0 0-.949-.684h-3.712",key:"q8zwxj"}]],W3=or("map-pinned",X3);const Y3=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],$3=or("navigation",Y3);const K3=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Vd=or("pencil",K3);const Q3=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],s1=or("plus",Q3);const J3=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],i2=or("qr-code",J3);const eT=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],A_=or("radio",eT);const tT=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],nT=or("refresh-cw",tT);const iT=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],E_=or("rotate-cw",iT);const rT=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],r2=or("route",rT);const sT=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],aT=or("save",sT);const oT=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]],lT=or("scan-line",oT);const cT=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],s2=or("search",cT);const uT=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],hT=or("share-2",uT);const dT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],a2=or("shield",dT);const fT=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],S_=or("star",fT);const pT=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],np=or("trash-2",pT);const gT=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],C_=or("trash",gT);const mT=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],yT=or("triangle-alert",mT);const xT=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],_T=or("user-plus",xT);const bT=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],vT=or("user",bT);const wT=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],AT=or("users",wT);const ET=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],vo=or("x",ET),ST=me.createContext(null);function CT(c,d){const y=Array.isArray(c)?c[0]:c?c.x:0,C=Array.isArray(c)?c[1]:c?c.y:0,D=Array.isArray(d)?d[0]:d?d.x:0,P=Array.isArray(d)?d[1]:d?d.y:0;return y===D&&C===P}function Rl(c,d){if(c===d)return!0;if(!c||!d)return!1;if(Array.isArray(c)){if(!Array.isArray(d)||c.length!==d.length)return!1;for(let y=0;y<c.length;y++)if(!Rl(c[y],d[y]))return!1;return!0}else if(Array.isArray(d))return!1;if(typeof c=="object"&&typeof d=="object"){const y=Object.keys(c),C=Object.keys(d);if(y.length!==C.length)return!1;for(const D of y)if(!d.hasOwnProperty(D)||!Rl(c[D],d[D]))return!1;return!0}return!1}function T_(c){return{longitude:c.center.lng,latitude:c.center.lat,zoom:c.zoom,pitch:c.pitch,bearing:c.bearing,padding:c.padding}}function I_(c,d){const y=d.viewState||d,C={};if("longitude"in y&&"latitude"in y&&(y.longitude!==c.center.lng||y.latitude!==c.center.lat)){const D=c.center.constructor;C.center=new D(y.longitude,y.latitude)}return"zoom"in y&&y.zoom!==c.zoom&&(C.zoom=y.zoom),"bearing"in y&&y.bearing!==c.bearing&&(C.bearing=y.bearing),"pitch"in y&&y.pitch!==c.pitch&&(C.pitch=y.pitch),y.padding&&c.padding&&!Rl(y.padding,c.padding)&&(C.padding=y.padding),C}const TT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function M_(c){if(!c)return null;if(typeof c=="string"||("toJS"in c&&(c=c.toJS()),!c.layers))return c;const d={};for(const C of c.layers)d[C.id]=C;const y=c.layers.map(C=>{let D=null;"interactive"in C&&(D=Object.assign({},C),delete D.interactive);const P=d[C.ref];if(P){D=D||Object.assign({},C),delete D.ref;for(const N of TT)N in P&&(D[N]=P[N])}return D||C});return{...c,layers:y}}const k_={version:8,sources:{},layers:[]},N_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},D_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},R_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},IT=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],MT=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class _0{constructor(d,y,C){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=D=>{const P=this.props[R_[D.type]];P?P(D):D.type==="error"&&console.error(D.error)},this._onCameraEvent=D=>{if(this._internalUpdate)return;D.viewState=this._propsedCameraUpdate||T_(this._map.transform);const P=this.props[D_[D.type]];P&&P(D)},this._onCameraUpdate=D=>this._internalUpdate?D:(this._propsedCameraUpdate=T_(D),I_(D,this.props)),this._onPointerEvent=D=>{(D.type==="mousemove"||D.type==="mouseout")&&this._updateHover(D);const P=this.props[N_[D.type]];P&&(this.props.interactiveLayerIds&&D.type!=="mouseover"&&D.type!=="mouseout"&&(D.features=this._hoveredFeatures||this._queryRenderedFeatures(D.point)),P(D),delete D.features)},this._MapClass=d,this.props=y,this._initialize(C)}get map(){return this._map}setProps(d){const y=this.props;this.props=d;const C=this._updateSettings(d,y),D=this._updateSize(d),P=this._updateViewState(d);this._updateStyle(d,y),this._updateStyleComponents(d),this._updateHandlers(d,y),(C||D||P&&!this._map.isMoving())&&this.redraw()}static reuse(d,y){const C=_0.savedMaps.pop();if(!C)return null;const D=C.map,P=D.getContainer();for(y.className=P.className;P.childNodes.length>0;)y.appendChild(P.childNodes[0]);D._container=y;const N=D._resizeObserver;N&&(N.disconnect(),N.observe(y)),C.setProps({...d,styleDiffing:!1}),D.resize();const{initialViewState:h}=d;return h&&(h.bounds?D.fitBounds(h.bounds,{...h.fitBoundsOptions,duration:0}):C._updateViewState(h)),D.isStyleLoaded()?D.fire("load"):D.once("style.load",()=>D.fire("load")),D._update(),C}_initialize(d){const{props:y}=this,{mapStyle:C=k_}=y,D={...y,...y.initialViewState,container:d,style:M_(C)},P=D.initialViewState||D.viewState||D;if(Object.assign(D,{center:[P.longitude||0,P.latitude||0],zoom:P.zoom||0,pitch:P.pitch||0,bearing:P.bearing||0}),y.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,y.gl)}const N=new this._MapClass(D);P.padding&&N.setPadding(P.padding),y.cursor&&(N.getCanvas().style.cursor=y.cursor),N.transformCameraUpdate=this._onCameraUpdate,N.on("style.load",()=>{this._styleComponents={light:N.getLight(),sky:N.getSky(),projection:N.getProjection?.(),terrain:N.getTerrain()},this._updateStyleComponents(this.props)}),N.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const h in N_)N.on(h,this._onPointerEvent);for(const h in D_)N.on(h,this._onCameraEvent);for(const h in R_)N.on(h,this._onEvent);this._map=N}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),_0.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const d=this._map;d.style&&(d._frame&&(d._frame.cancel(),d._frame=null),d._render())}_updateSize(d){const{viewState:y}=d;if(y){const C=this._map;if(y.width!==C.transform.width||y.height!==C.transform.height)return C.resize(),!0}return!1}_updateViewState(d){const y=this._map,C=y.transform;if(!y.isMoving()){const P=I_(C,d);if(Object.keys(P).length>0)return this._internalUpdate=!0,y.jumpTo(P),this._internalUpdate=!1,!0}return!1}_updateSettings(d,y){const C=this._map;let D=!1;for(const P of IT)P in d&&!Rl(d[P],y[P])&&(D=!0,C[`set${P[0].toUpperCase()}${P.slice(1)}`]?.call(C,d[P]));return D}_updateStyle(d,y){if(d.cursor!==y.cursor&&(this._map.getCanvas().style.cursor=d.cursor||""),d.mapStyle!==y.mapStyle){const{mapStyle:C=k_,styleDiffing:D=!0}=d,P={diff:D};"localIdeographFontFamily"in d&&(P.localIdeographFontFamily=d.localIdeographFontFamily),this._map.setStyle(M_(C),P)}}_updateStyleComponents({light:d,projection:y,sky:C,terrain:D}){const P=this._map,N=this._styleComponents;P.style._loaded&&(d&&!Rl(d,N.light)&&(N.light=d,P.setLight(d)),y&&!Rl(y,N.projection)&&y!==N.projection?.type&&(N.projection=typeof y=="string"?{type:y}:y,P.setProjection?.(N.projection)),C&&!Rl(C,N.sky)&&(N.sky=C,P.setSky(C)),D!==void 0&&!Rl(D,N.terrain)&&(!D||P.getSource(D.source))&&(N.terrain=D,P.setTerrain(D)))}_updateHandlers(d,y){const C=this._map;for(const D of MT){const P=d[D]??!0,N=y[D]??!0;Rl(P,N)||(P?C[D].enable(P):C[D].disable())}}_queryRenderedFeatures(d){const y=this._map,{interactiveLayerIds:C=[]}=this.props;try{return y.queryRenderedFeatures(d,{layers:C.filter(y.getLayer.bind(y))})}catch{return[]}}_updateHover(d){const{props:y}=this;if(y.interactiveLayerIds&&(y.onMouseMove||y.onMouseEnter||y.onMouseLeave)){const D=d.type,P=this._hoveredFeatures?.length>0,N=this._queryRenderedFeatures(d.point),h=N.length>0;!h&&P&&(d.type="mouseleave",this._onPointerEvent(d)),this._hoveredFeatures=N,h&&!P&&(d.type="mouseenter",this._onPointerEvent(d)),d.type=D}else this._hoveredFeatures=null}}_0.savedMaps=[];const kT=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function NT(c){if(!c)return null;const d=c.map,y={getMap:()=>d};for(const C of DT(d))!(C in y)&&!kT.includes(C)&&(y[C]=d[C].bind(d));return y}function DT(c){const d=new Set;let y=c;for(;y;){for(const C of Object.getOwnPropertyNames(y))C[0]!=="_"&&typeof c[C]=="function"&&C!=="fire"&&C!=="setEventedParent"&&d.add(C);y=Object.getPrototypeOf(y)}return Array.from(d)}const RT=typeof document<"u"?me.useLayoutEffect:me.useEffect;function PT(c,d){const{RTLTextPlugin:y,maxParallelImageRequests:C,workerCount:D,workerUrl:P}=d;if(y&&c.getRTLTextPluginStatus&&c.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:N,lazy:h=!0}=typeof y=="string"?{pluginUrl:y}:y;c.setRTLTextPlugin(N,U=>{U&&console.error(U)},h)}C!==void 0&&c.setMaxParallelImageRequests(C),D!==void 0&&c.setWorkerCount(D),P!==void 0&&c.setWorkerUrl(P)}const w0=me.createContext(null);function OT(c,d){const y=me.useContext(ST),[C,D]=me.useState(null),P=me.useRef(),{current:N}=me.useRef({mapLib:null,map:null});me.useEffect(()=>{const H=c.mapLib;let Y=!0,K;return Promise.resolve(H||Qm(()=>Promise.resolve().then(()=>JT),void 0)).then(_e=>{if(!Y)return;if(!_e)throw new Error("Invalid mapLib");const we="Map"in _e?_e:_e.default;if(!we.Map)throw new Error("Invalid mapLib");PT(we,c),c.reuseMaps&&(K=_0.reuse(c,P.current)),K||(K=new _0(we.Map,c,P.current)),N.map=NT(K),N.mapLib=we,D(K),y?.onMapMount(N.map,c.id)}).catch(_e=>{const{onError:we}=c;we?we({type:"error",target:null,originalEvent:null,error:_e}):console.error(_e)}),()=>{Y=!1,K&&(y?.onMapUnmount(c.id),c.reuseMaps?K.recycle():K.destroy())}},[]),RT(()=>{C&&C.setProps(c)}),me.useImperativeHandle(d,()=>N.map,[C]);const h=me.useMemo(()=>({position:"relative",width:"100%",height:"100%",...c.style}),[c.style]),U={height:"100%"};return me.createElement("div",{id:c.id,ref:P,style:h},C&&me.createElement(w0.Provider,{value:N},me.createElement("div",{"mapboxgl-children":"",style:U},c.children)))}const zT=me.forwardRef(OT);var o2=db();const LT=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function qh(c,d){if(!c||!d)return;const y=c.style;for(const C in d){const D=d[C];Number.isFinite(D)&&!LT.test(C)?y[C]=`${D}px`:y[C]=D}}function l2(c,d){if(c===d)return null;const y=P_(c),C=P_(d),D=[];for(const P of C)y.has(P)||D.push(P);for(const P of y)C.has(P)||D.push(P);return D.length===0?null:D}function P_(c){return new Set(c?c.trim().split(/\s+/):[])}const Pc=me.memo(me.forwardRef((c,d)=>{const{map:y,mapLib:C}=me.useContext(w0),D=me.useRef({props:c}),P=me.useMemo(()=>{let De=!1;me.Children.forEach(c.children,mt=>{mt&&(De=!0)});const Je={...c,element:De?document.createElement("div"):void 0},Xe=new C.Marker(Je);return Xe.setLngLat([c.longitude,c.latitude]),Xe.getElement().addEventListener("click",mt=>{D.current.props.onClick?.({type:"click",target:Xe,originalEvent:mt})}),Xe.on("dragstart",mt=>{const Wt=mt;Wt.lngLat=P.getLngLat(),D.current.props.onDragStart?.(Wt)}),Xe.on("drag",mt=>{const Wt=mt;Wt.lngLat=P.getLngLat(),D.current.props.onDrag?.(Wt)}),Xe.on("dragend",mt=>{const Wt=mt;Wt.lngLat=P.getLngLat(),D.current.props.onDragEnd?.(Wt)}),Xe},[]);me.useEffect(()=>(P.addTo(y.getMap()),()=>{P.remove()}),[]);const{longitude:N,latitude:h,offset:U,style:H,draggable:Y=!1,popup:K=null,rotation:_e=0,rotationAlignment:we="auto",pitchAlignment:ve="auto"}=c;me.useEffect(()=>{qh(P.getElement(),H)},[H]),me.useImperativeHandle(d,()=>P,[]);const pe=D.current.props;(P.getLngLat().lng!==N||P.getLngLat().lat!==h)&&P.setLngLat([N,h]),U&&!CT(P.getOffset(),U)&&P.setOffset(U),P.isDraggable()!==Y&&P.setDraggable(Y),P.getRotation()!==_e&&P.setRotation(_e),P.getRotationAlignment()!==we&&P.setRotationAlignment(we),P.getPitchAlignment()!==ve&&P.setPitchAlignment(ve),P.getPopup()!==K&&P.setPopup(K);const he=l2(pe.className,c.className);if(he)for(const De of he)P.toggleClassName(De);return D.current.props=c,o2.createPortal(c.children,P.getElement())}));me.memo(me.forwardRef((c,d)=>{const{map:y,mapLib:C}=me.useContext(w0),D=me.useMemo(()=>document.createElement("div"),[]),P=me.useRef({props:c}),N=me.useMemo(()=>{const h={...c},U=new C.Popup(h);return U.setLngLat([c.longitude,c.latitude]),U.once("open",H=>{P.current.props.onOpen?.(H)}),U},[]);if(me.useEffect(()=>{const h=U=>{P.current.props.onClose?.(U)};return N.on("close",h),N.setDOMContent(D).addTo(y.getMap()),()=>{N.off("close",h),N.isOpen()&&N.remove()}},[]),me.useEffect(()=>{qh(N.getElement(),c.style)},[c.style]),me.useImperativeHandle(d,()=>N,[]),N.isOpen()){const h=P.current.props;(N.getLngLat().lng!==c.longitude||N.getLngLat().lat!==c.latitude)&&N.setLngLat([c.longitude,c.latitude]),c.offset&&!Rl(h.offset,c.offset)&&N.setOffset(c.offset),(h.anchor!==c.anchor||h.maxWidth!==c.maxWidth)&&(N.options.anchor=c.anchor,N.setMaxWidth(c.maxWidth));const U=l2(h.className,c.className);if(U)for(const H of U)N.toggleClassName(H);P.current.props=c}return o2.createPortal(c.children,D)}));function sp(c,d,y,C){const D=me.useContext(w0),P=me.useMemo(()=>c(D),[]);return me.useEffect(()=>{const N=d,h=null,U=typeof d=="function"?d:null,{map:H}=D;return H.hasControl(P)||(H.addControl(P,N?.position),h&&h(D)),()=>{U&&U(D),H.hasControl(P)&&H.removeControl(P)}},[]),P}function BT(c){const d=sp(({mapLib:y})=>new y.AttributionControl(c),{position:c.position});return me.useEffect(()=>{qh(d._container,c.style)},[c.style]),null}me.memo(BT);function FT(c){const d=sp(({mapLib:y})=>new y.FullscreenControl({container:c.containerId&&document.getElementById(c.containerId)}),{position:c.position});return me.useEffect(()=>{qh(d._controlContainer,c.style)},[c.style]),null}me.memo(FT);function jT(c,d){const y=me.useRef({props:c}),C=sp(({mapLib:D})=>{const P=new D.GeolocateControl(c),N=P._setupUI;return P._setupUI=()=>{P._container.hasChildNodes()||N()},P.on("geolocate",h=>{y.current.props.onGeolocate?.(h)}),P.on("error",h=>{y.current.props.onError?.(h)}),P.on("outofmaxbounds",h=>{y.current.props.onOutOfMaxBounds?.(h)}),P.on("trackuserlocationstart",h=>{y.current.props.onTrackUserLocationStart?.(h)}),P.on("trackuserlocationend",h=>{y.current.props.onTrackUserLocationEnd?.(h)}),P},{position:c.position});return y.current.props=c,me.useImperativeHandle(d,()=>C,[]),me.useEffect(()=>{qh(C._container,c.style)},[c.style]),null}me.memo(me.forwardRef(jT));function UT(c){const d=sp(({mapLib:y})=>new y.NavigationControl(c),{position:c.position});return me.useEffect(()=>{qh(d._container,c.style)},[c.style]),null}me.memo(UT);function VT(c){const d=sp(({mapLib:P})=>new P.ScaleControl(c),{position:c.position}),y=me.useRef(c),C=y.current;y.current=c;const{style:D}=c;return c.maxWidth!==void 0&&c.maxWidth!==C.maxWidth&&(d.options.maxWidth=c.maxWidth),c.unit!==void 0&&c.unit!==C.unit&&d.setUnit(c.unit),me.useEffect(()=>{qh(d._container,D)},[D]),null}me.memo(VT);function GT(c){const d=sp(({mapLib:y})=>new y.TerrainControl(c),{position:c.position});return me.useEffect(()=>{qh(d._container,c.style)},[c.style]),null}me.memo(GT);function HT(c){const d=sp(({mapLib:y})=>new y.LogoControl(c),{position:c.position});return me.useEffect(()=>{qh(d._container,c.style)},[c.style]),null}me.memo(HT);function a1(c,d){if(!c)throw new Error(d)}let qT=0;function ZT(c,d,y){if(c.style&&c.style._loaded){const C={...y};return delete C.id,delete C.children,c.addSource(d,C),c.getSource(d)}return null}function XT(c,d,y){a1(d.id===y.id,"source id changed"),a1(d.type===y.type,"source type changed");let C="",D=0;for(const N in d)N!=="children"&&N!=="id"&&!Rl(y[N],d[N])&&(C=N,D++);if(!D)return;const P=d.type;if(P==="geojson")c.setData(d.data);else if(P==="image")c.updateImage({url:d.url,coordinates:d.coordinates});else switch(C){case"coordinates":c.setCoordinates?.(d.coordinates);break;case"url":c.setUrl?.(d.url);break;case"tiles":c.setTiles?.(d.tiles);break;default:console.warn(`Unable to update <Source> prop: ${C}`)}}function O_(c){const d=me.useContext(w0).map.getMap(),y=me.useRef(c),[,C]=me.useState(0),D=me.useMemo(()=>c.id||`jsx-source-${qT++}`,[]);me.useEffect(()=>{if(d){const N=()=>setTimeout(()=>C(h=>h+1),0);return d.on("styledata",N),N(),()=>{if(d.off("styledata",N),d.style&&d.style._loaded&&d.getSource(D)){const h=d.getStyle()?.layers;if(h)for(const U of h)U.source===D&&d.removeLayer(U.id);d.removeSource(D)}}}},[d]);let P=d&&d.style&&d.getSource(D);return P?XT(P,c,y.current):P=ZT(d,D,c),y.current=c,P&&me.Children.map(c.children,N=>N&&me.cloneElement(N,{source:D}))||null}function WT(c,d,y,C){if(a1(y.id===C.id,"layer id changed"),a1(y.type===C.type,"layer type changed"),y.type==="custom"||C.type==="custom")return;const{layout:D={},paint:P={},filter:N,minzoom:h,maxzoom:U,beforeId:H}=y;if(H!==C.beforeId&&c.moveLayer(d,H),D!==C.layout){const Y=C.layout||{};for(const K in D)Rl(D[K],Y[K])||c.setLayoutProperty(d,K,D[K]);for(const K in Y)D.hasOwnProperty(K)||c.setLayoutProperty(d,K,void 0)}if(P!==C.paint){const Y=C.paint||{};for(const K in P)Rl(P[K],Y[K])||c.setPaintProperty(d,K,P[K]);for(const K in Y)P.hasOwnProperty(K)||c.setPaintProperty(d,K,void 0)}Rl(N,C.filter)||c.setFilter(d,N),(h!==C.minzoom||U!==C.maxzoom)&&c.setLayerZoomRange(d,h,U)}function YT(c,d,y){if(c.style&&c.style._loaded&&(!("source"in y)||c.getSource(y.source))){const C={...y,id:d};delete C.beforeId,c.addLayer(C,y.beforeId)}}let $T=0;function z_(c){const d=me.useContext(w0).map.getMap(),y=me.useRef(c),[,C]=me.useState(0),D=me.useMemo(()=>c.id||`jsx-layer-${$T++}`,[]);if(me.useEffect(()=>{if(d){const N=()=>C(h=>h+1);return d.on("styledata",N),N(),()=>{d.off("styledata",N),d.style&&d.style._loaded&&d.getLayer(D)&&d.removeLayer(D)}}},[d]),d&&d.style&&d.getLayer(D))try{WT(d,D,c,y.current)}catch(N){console.warn(N)}else YT(d,D,c);return y.current=c,null}var $m={exports:{}};var KT=$m.exports,L_;function QT(){return L_||(L_=1,(function(c,d){(function(y,C){c.exports=C()})(KT,(function(){var y={},C={};function D(N,h,U){if(C[N]=U,N==="index"){var H="var sharedModule = {}; ("+C.shared+")(sharedModule); ("+C.worker+")(sharedModule);",Y={};return C.shared(Y),C.index(y,Y),typeof window<"u"&&y.setWorkerUrl(window.URL.createObjectURL(new Blob([H],{type:"text/javascript"}))),y}}D("shared",["exports"],(function(N){function h(i,e,n,l){return new(n||(n=Promise))((function(p,_){function b(B){try{R(l.next(B))}catch(G){_(G)}}function T(B){try{R(l.throw(B))}catch(G){_(G)}}function R(B){var G;B.done?p(B.value):(G=B.value,G instanceof n?G:new n((function(X){X(G)}))).then(b,T)}R((l=l.apply(i,e||[])).next())}))}function U(i,e){this.x=i,this.y=e}function H(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Y,K;typeof SuppressedError=="function"&&SuppressedError,U.prototype={clone(){return new U(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(i,e){const n=Math.cos(i),l=Math.sin(i),p=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:U},U.convert=function(i){if(i instanceof U)return i;if(Array.isArray(i))return new U(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new U(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var _e=(function(){if(K)return Y;function i(e,n,l,p){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=p}return K=1,Y=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,p=0;p<8;p++){var _=this.sampleCurveX(l)-e;if(Math.abs(_)<n)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=_/b}var T=0,R=1;for(l=e,p=0;p<20&&(_=this.sampleCurveX(l),!(Math.abs(_-e)<n));p++)e>_?T=l:R=l,l=.5*(R-T)+T;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Y})(),we=H(_e);let ve,pe;function he(){return ve==null&&(ve=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ve}function De(){if(pe==null&&(pe=!1,he())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const p=4*l;e.fillStyle=`rgb(${p},${p+1},${p+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&n[l]!==l){pe=!0;break}}}return pe||!1}var Je=1e-6,Xe=typeof Float32Array<"u"?Float32Array:Array;function mt(){var i=new Xe(9);return Xe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Wt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Et(){var i=new Xe(3);return Xe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function rt(i){var e=i[0],n=i[1],l=i[2];return Math.sqrt(e*e+n*n+l*l)}function at(i,e,n){var l=new Xe(3);return l[0]=i,l[1]=e,l[2]=n,l}function He(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function _t(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function Pe(i,e,n){var l=e[0],p=e[1],_=e[2],b=n[0],T=n[1],R=n[2];return i[0]=p*R-_*T,i[1]=_*b-l*R,i[2]=l*T-p*b,i}var ht,vt=rt;function qt(i,e,n){var l=e[0],p=e[1],_=e[2],b=e[3];return i[0]=n[0]*l+n[4]*p+n[8]*_+n[12]*b,i[1]=n[1]*l+n[5]*p+n[9]*_+n[13]*b,i[2]=n[2]*l+n[6]*p+n[10]*_+n[14]*b,i[3]=n[3]*l+n[7]*p+n[11]*_+n[15]*b,i}function ke(){var i=new Xe(4);return Xe!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Te(i,e,n,l){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",_=Math.PI/360;e*=_,l*=_,n*=_;var b=Math.sin(e),T=Math.cos(e),R=Math.sin(n),B=Math.cos(n),G=Math.sin(l),X=Math.cos(l);switch(p){case"xyz":i[0]=b*B*X+T*R*G,i[1]=T*R*X-b*B*G,i[2]=T*B*G+b*R*X,i[3]=T*B*X-b*R*G;break;case"xzy":i[0]=b*B*X-T*R*G,i[1]=T*R*X-b*B*G,i[2]=T*B*G+b*R*X,i[3]=T*B*X+b*R*G;break;case"yxz":i[0]=b*B*X+T*R*G,i[1]=T*R*X-b*B*G,i[2]=T*B*G-b*R*X,i[3]=T*B*X+b*R*G;break;case"yzx":i[0]=b*B*X+T*R*G,i[1]=T*R*X+b*B*G,i[2]=T*B*G-b*R*X,i[3]=T*B*X-b*R*G;break;case"zxy":i[0]=b*B*X-T*R*G,i[1]=T*R*X+b*B*G,i[2]=T*B*G+b*R*X,i[3]=T*B*X-b*R*G;break;case"zyx":i[0]=b*B*X-T*R*G,i[1]=T*R*X+b*B*G,i[2]=T*B*G-b*R*X,i[3]=T*B*X+b*R*G;break;default:throw new Error("Unknown angle order "+p)}return i}function Ze(){var i=new Xe(2);return Xe!=Float32Array&&(i[0]=0,i[1]=0),i}function ut(i,e){var n=new Xe(2);return n[0]=i,n[1]=e,n}Et(),ht=new Xe(4),Xe!=Float32Array&&(ht[0]=0,ht[1]=0,ht[2]=0,ht[3]=0),Et(),at(1,0,0),at(0,1,0),ke(),ke(),mt(),Ze();const Tt=8192;function sn(i,e,n){return e*(Tt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function Re(i,e){return(i%e+e)%e}function ct(i,e,n){return i*(1-n)+e*n}function kt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function bt(i,e,n,l){const p=new we(i,e,n,l);return _=>p.solve(_)}const an=bt(.25,.1,.25,1);function Bt(i,e,n){return Math.min(n,Math.max(e,i))}function Qt(i,e,n){const l=n-e,p=((i-e)%l+l)%l+e;return p===e?n:p}function un(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}let nn=1;function kn(i,e,n){const l={};for(const p in i)l[p]=e.call(this,i[p],p,i);return l}function Nn(i,e,n){const l={};for(const p in i)e.call(this,i[p],p,i)&&(l[p]=i[p]);return l}function ii(i){return Array.isArray(i)?i.map(ii):typeof i=="object"&&i?kn(i,ii):i}const En={};function si(i){En[i]||(typeof console<"u"&&console.warn(i),En[i]=!0)}function wi(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Oi(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Yn=null;function Gn(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Rn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ei(i,e,n,l,p){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const b=_?.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const T=b.startsWith("BGR"),R=new Uint8ClampedArray(l*p*4);if(yield _.copyTo(R,(function(B,G,X,$,Q){const ie=4*Math.max(-G,0),re=(Math.max(0,X)-X)*$*4+ie,ae=4*$,ye=Math.max(0,G),Be=Math.max(0,X);return{rect:{x:ye,y:Be,width:Math.min(B.width,G+$)-ye,height:Math.min(B.height,X+Q)-Be},layout:[{offset:re,stride:ae}]}})(i,e,n,l,p)),T)for(let B=0;B<R.length;B+=4){const G=R[B];R[B]=R[B+2],R[B+2]=G}return R}finally{_.close()}}))}let on,Li;function tr(i,e,n,l){return i.addEventListener(e,n,l),{unsubscribe:()=>{i.removeEventListener(e,n,l)}}}function Di(i){return i*Math.PI/180}function yr(i){return i/Math.PI*180}const yt={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},oe={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},le="AbortError";class ge extends Error{constructor(e=le){super(e instanceof Error?e.message:e),this.name=le,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Ue(i){return i.name===le}const Ye={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function At(i){return Ye.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const it="global-dispatcher";class de extends Error{constructor(e,n,l,p){super(`AJAXError: ${n} (${e}): ${l}`),this.status=e,this.statusText=n,this.url=l,this.body=p}}const qe=()=>Oi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,xt=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=At(i.url);if(l)return l(i,e);if(Oi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:it},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(qe())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,p){return h(this,void 0,void 0,(function*(){const _=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:qe(),signal:p.signal});let b,T;l.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{b=yield fetch(_)}catch(B){throw Ue(B)?B:new de(0,B.message,l.url,new Blob)}if(!b.ok){const B=yield b.blob();throw new de(b.status,b.statusText,l.url,B)}T=l.type==="arrayBuffer"||l.type==="image"?b.arrayBuffer():l.type==="json"?b.json():b.text();const R=yield T;return p.signal.throwIfAborted(),{data:R,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}}))})(i,e);if(Oi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:it},e)}var n;return(function(l,p){return new Promise(((_,b)=>{var T;const R=new XMLHttpRequest;R.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(R.responseType="arraybuffer");for(const B in l.headers)R.setRequestHeader(B,l.headers[B]);l.type==="json"&&(R.responseType="text",!((T=l.headers)===null||T===void 0)&&T.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=l.credentials==="include",R.onerror=()=>{b(new Error(R.statusText))},R.onload=()=>{if(!p.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let B=R.response;if(l.type==="json")try{B=JSON.parse(R.response)}catch(G){return void b(G)}_({data:B,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const B=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});b(new de(R.status,R.statusText,l.url,B))}},p.signal.addEventListener("abort",(()=>{R.abort(),b(new ge(p.signal.reason))})),R.send(l.body)}))})(i,e)};function Fe(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function St(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Lt(i,e,n){if(n&&n[i]){const l=n[i].indexOf(e);l!==-1&&n[i].splice(l,1)}}class bn{constructor(e,n={}){un(this,n),this.type=e}}class yn extends bn{constructor(e,n={}){super("error",un({error:e},n))}}class $n{on(e,n){return this._listeners=this._listeners||{},St(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return Lt(e,n,this._listeners),Lt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},St(e,n,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,n){typeof e=="string"&&(e=new bn(e,n||{}));const l=e.type;if(this.listens(l)){e.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const T of p)T.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const T of _)Lt(l,T,this._oneTimeListeners),T.call(this,e);const b=this._eventedParent;b&&(un(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(e))}else e instanceof yn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var dt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const ai=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Fn(i,e){const n={};for(const l in i)l!=="ref"&&(n[l]=i[l]);return ai.forEach((l=>{l in e&&(n[l]=e[l])})),n}function Jn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!Jn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!Jn(i[n],e[n]))return!1;return!0}return i===e}function pi(i,e){i.push(e)}function ur(i,e,n){pi(n,{command:"addSource",args:[i,e[i]]})}function Ti(i,e,n){pi(e,{command:"removeSource",args:[i]}),n[i]=!0}function jn(i,e,n,l){Ti(i,n,l),ur(i,e,n)}function Ni(i,e,n){let l;for(l in i[n])if(Object.prototype.hasOwnProperty.call(i[n],l)&&l!=="data"&&!Jn(i[n][l],e[n][l]))return!1;for(l in e[n])if(Object.prototype.hasOwnProperty.call(e[n],l)&&l!=="data"&&!Jn(i[n][l],e[n][l]))return!1;return!0}function Ri(i,e,n,l,p,_){i=i||{},e=e||{};for(const b in i)Object.prototype.hasOwnProperty.call(i,b)&&(Jn(i[b],e[b])||n.push({command:_,args:[l,b,e[b],p]}));for(const b in e)Object.prototype.hasOwnProperty.call(e,b)&&!Object.prototype.hasOwnProperty.call(i,b)&&(Jn(i[b],e[b])||n.push({command:_,args:[l,b,e[b],p]}))}function ji(i){return i.id}function Nr(i,e){return i[e.id]=e,i}class Jt{constructor(e,n,l,p){this.message=(e?`${e}: `:"")+l,p&&(this.identifier=p),n!=null&&n.__line__&&(this.line=n.__line__)}}function gi(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}class Sn extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class lr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,p]of n)this.bindings[l]=p}concat(e){return new lr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ke={kind:"null"},je={kind:"number"},Mt={kind:"string"},Yt={kind:"boolean"},tn={kind:"color"},Un={kind:"projectionDefinition"},Hn={kind:"object"},vn={kind:"value"},ri={kind:"collator"},ni={kind:"formatted"},Xn={kind:"padding"},Zi={kind:"colorArray"},Cn={kind:"numberArray"},Dn={kind:"resolvedImage"},Zt={kind:"variableAnchorOffsetCollection"};function ki(i,e){return{kind:"array",itemType:i,N:e}}function ln(i){if(i.kind==="array"){const e=ln(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const yi=[Ke,je,Mt,Yt,tn,Un,ni,Hn,ki(vn),Xn,Cn,Zi,Dn,Zt];function Bi(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Bi(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of yi)if(!Bi(n,e))return null}}return`Expected ${ln(i)} but found ${ln(e)} instead.`}function _i(i,e){return e.some((n=>n.kind===i.kind))}function bi(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function mi(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const li=.96422,Hi=.82521,Tr=4/29,Qn=6/29,es=3*Qn*Qn,Ts=Qn*Qn*Qn,zi=Math.PI/180,Ba=180/Math.PI;function sl(i){return(i%=360)<0&&(i+=360),i}function Vo([i,e,n,l]){let p,_;const b=Wr((.2225045*(i=Fi(i))+.7168786*(e=Fi(e))+.0606169*(n=Fi(n)))/1);i===e&&e===n?p=_=b:(p=Wr((.4360747*i+.3850649*e+.1430804*n)/li),_=Wr((.0139322*i+.0971045*e+.7141733*n)/Hi));const T=116*b-16;return[T<0?0:T,500*(p-b),200*(b-_),l]}function Fi(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Wr(i){return i>Ts?Math.pow(i,1/3):i/es+Tr}function Pt([i,e,n,l]){let p=(i+16)/116,_=isNaN(e)?p:p+e/500,b=isNaN(n)?p:p-n/200;return p=1*ti(p),_=li*ti(_),b=Hi*ti(b),[Ne(3.1338561*_-1.6168667*p-.4906146*b),Ne(-.9787684*_+1.9161415*p+.033454*b),Ne(.0719453*_-.2289914*p+1.4052427*b),l]}function Ne(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function ti(i){return i>Qn?i*i*i:es*(i-Tr)}const cs=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Is(i,e){return cs(i,e)?i[e]:void 0}function Ma(i){return parseInt(i.padEnd(2,i),16)/255}function uc(i,e){return ts(e?i/100:i,0,1)}function ts(i,e,n){return Math.min(Math.max(e,i),n)}function di(i){return!i.some(Number.isNaN)}const xr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function wo(i,e,n){return i+n*(e-i)}function al(i,e,n){return i.map(((l,p)=>wo(l,e[p],n)))}class Si{constructor(e,n,l,p=1,_=!0){this.r=e,this.g=n,this.b=l,this.a=p,_||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[e,n,l,p]))}static parse(e){if(e instanceof Si)return e;if(typeof e!="string")return;const n=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Is(xr,l);if(p){const[b,T,R]=p;return[b/255,T/255,R/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const b=l.length<6?1:2;let T=1;return[Ma(l.slice(T,T+=b)),Ma(l.slice(T,T+=b)),Ma(l.slice(T,T+=b)),Ma(l.slice(T,T+b)||"ff")]}if(l.startsWith("rgb")){const b=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,R,B,G,X,$,Q,ie,re,ae,ye,Be]=b,be=[G||" ",Q||" ",ae].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Ee=[B,$,re].join(""),Ge=Ee==="%%%"?100:Ee===""?255:0;if(Ge){const Qe=[ts(+R/Ge,0,1),ts(+X/Ge,0,1),ts(+ie/Ge,0,1),ye?uc(+ye,Be):1];if(di(Qe))return Qe}}return}}const _=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[b,T,R,B,G,X,$,Q,ie]=_,re=[R||" ",G||" ",$].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ae=[+T,ts(+B,0,100),ts(+X,0,100),Q?uc(+Q,ie):1];if(di(ae))return(function([ye,Be,be,Ee]){function Ge(Qe){const Dt=(Qe+ye/30)%12,en=Be*Math.min(be,1-be);return be-en*Math.max(-1,Math.min(Dt-3,9-Dt,1))}return ye=sl(ye),Be/=100,be/=100,[Ge(0),Ge(8),Ge(4),Ee]})(ae)}}})(e);return n?new Si(...n,!1):void 0}get rgb(){const{r:e,g:n,b:l,a:p}=this,_=p||1/0;return this.overwriteGetter("rgb",[e/_,n/_,l/_,p])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,l,p,_]=Vo(e),b=Math.sqrt(l*l+p*p);return[Math.round(1e4*b)?sl(Math.atan2(p,l)*Ba):NaN,b,n,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Vo(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,l,p]=this.rgb;return`rgba(${[e,n,l].map((_=>Math.round(255*_))).join(",")},${p})`}static interpolate(e,n,l,p="rgb"){switch(p){case"rgb":{const[_,b,T,R]=al(e.rgb,n.rgb,l);return new Si(_,b,T,R,!1)}case"hcl":{const[_,b,T,R]=e.hcl,[B,G,X,$]=n.hcl;let Q,ie;if(isNaN(_)||isNaN(B))isNaN(_)?isNaN(B)?Q=NaN:(Q=B,T!==1&&T!==0||(ie=G)):(Q=_,X!==1&&X!==0||(ie=b));else{let be=B-_;B>_&&be>180?be-=360:B<_&&_-B>180&&(be+=360),Q=_+l*be}const[re,ae,ye,Be]=(function([be,Ee,Ge,Qe]){return be=isNaN(be)?0:be*zi,Pt([Ge,Math.cos(be)*Ee,Math.sin(be)*Ee,Qe])})([Q,ie??wo(b,G,l),wo(T,X,l),wo(R,$,l)]);return new Si(re,ae,ye,Be,!1)}case"lab":{const[_,b,T,R]=Pt(al(e.lab,n.lab,l));return new Si(_,b,T,R,!1)}}}}Si.black=new Si(0,0,0,1),Si.white=new Si(1,1,1,1),Si.transparent=new Si(0,0,0,0),Si.red=new Si(1,0,0,1);class Hs{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const zl=["bottom","center","top"];class ol{constructor(e,n,l,p,_,b){this.text=e,this.image=n,this.scale=l,this.fontStack=p,this.textColor=_,this.verticalAlign=b}}class Yi{constructor(e){this.sections=e}static fromString(e){return new Yi([new ol(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Yi?e:Yi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Br{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Br)return e;if(typeof e=="number")return new Br([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Br(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new Br(al(e.values,n.values,l))}}class nr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof nr)return e;if(typeof e=="number")return new nr([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new nr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new nr(al(e.values,n.values,l))}}class gn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof gn)return e;if(typeof e=="string"){const l=Si.parse(e);return l?new gn([l]):void 0}if(!Array.isArray(e))return;const n=[];for(const l of e){if(typeof l!="string")return;const p=Si.parse(l);if(!p)return;n.push(p)}return new gn(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l,p="rgb"){const _=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let b=0;b<e.values.length;b++)_.push(Si.interpolate(e.values[b],n.values[b],l,p));return new gn(_)}}class _r extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ai=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ui{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ui)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const l=e[n],p=e[n+1];if(typeof l!="string"||!Ai.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new Ui(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){const p=e.values,_=n.values;if(p.length!==_.length)throw new _r(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const b=[];for(let T=0;T<p.length;T+=2){if(p[T]!==_[T])throw new _r(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${p[T]}, to[${T}]: ${_[T]}`);b.push(p[T]);const[R,B]=p[T+1],[G,X]=_[T+1];b.push([wo(R,G,l),wo(B,X,l)])}return new Ui(b)}}class qs{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new qs({name:e,available:!1}):null}}class Yr{constructor(e,n,l){this.from=e,this.to=n,this.transition=l}static interpolate(e,n,l){return new Yr(e,n,l)}static parse(e){return e instanceof Yr?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Yr(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Yr(e.from,e.to,e.transition):typeof e=="string"?new Yr(e,e,1):void 0}}function Zs(i,e,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,n,l]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Yr||i instanceof Si||i instanceof Hs||i instanceof Yi||i instanceof Br||i instanceof nr||i instanceof gn||i instanceof Ui||i instanceof qs)return!0;if(Array.isArray(i)){for(const e of i)if(!Bs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Bs(i[e]))return!1;return!0}return!1}function Dr(i){if(i===null)return Ke;if(typeof i=="string")return Mt;if(typeof i=="boolean")return Yt;if(typeof i=="number")return je;if(i instanceof Si)return tn;if(i instanceof Yr)return Un;if(i instanceof Hs)return ri;if(i instanceof Yi)return ni;if(i instanceof Br)return Xn;if(i instanceof nr)return Cn;if(i instanceof gn)return Zi;if(i instanceof Ui)return Zt;if(i instanceof qs)return Dn;if(Array.isArray(i)){const e=i.length;let n;for(const l of i){const p=Dr(l);if(n){if(n===p)continue;n=vn;break}n=p}return ki(n||vn,e)}return Hn}function fa(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Si||i instanceof Yr||i instanceof Yi||i instanceof Br||i instanceof nr||i instanceof gn||i instanceof Ui||i instanceof qs?i.toString():JSON.stringify(i)}class ps{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Bs(e[1]))return n.error("invalid value");const l=e[1];let p=Dr(l);const _=n.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new ps(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const va={string:Mt,number:je,boolean:Yt,object:Hn};class Ms{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,p=1;const _=e[0];if(_==="array"){let T,R;if(e.length>2){const B=e[1];if(typeof B!="string"||!(B in va)||B==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);T=va[B],p++}else T=vn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);R=e[2],p++}l=ki(T,R)}else{if(!va[_])throw new Error(`Types doesn't contain name = ${_}`);l=va[_]}const b=[];for(;p<e.length;p++){const T=n.parse(e[p],p,vn);if(!T)return null;b.push(T)}return new Ms(l,b)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!Bi(this.type,Dr(l)))return l;if(n===this.args.length-1)throw new _r(`Expected value to be of type ${ln(this.type)}, but found ${ln(Dr(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Rr={"to-boolean":Yt,"to-color":tn,"to-number":je,"to-string":Mt};class ns{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0];if(!Rr[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");const p=Rr[l],_=[];for(let b=1;b<e.length;b++){const T=n.parse(e[b],b,vn);if(!T)return null;_.push(T)}return new ns(p,_)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,l;for(const p of this.args){if(n=p.evaluate(e),l=null,n instanceof Si)return n;if(typeof n=="string"){const _=e.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Zs(n[0],n[1],n[2],n[3]),!l))return new Si(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new _r(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(e);const p=Br.parse(n);if(p)return p}throw new _r(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(e);const p=nr.parse(n);if(p)return p}throw new _r(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(e);const p=gn.parse(n);if(p)return p}throw new _r(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(e);const p=Ui.parse(n);if(p)return p}throw new _r(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const p=Number(n);if(!isNaN(p))return p}throw new _r(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Yi.fromString(fa(this.args[0].evaluate(e)));case"resolvedImage":return qs.fromString(fa(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return fa(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const rr=["Unknown","Point","LineString","Polygon"];class Ao{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=Si.parse(e),this._parseColorCache.set(e,n)),n}}class Eo{constructor(e,n,l=[],p,_=new lr,b=[]){this.registry=e,this.path=l,this.key=l.map((T=>`[${T}]`)).join(""),this.scope=_,this.errors=b,this.expectedType=p,this._isConstant=n}parse(e,n,l,p,_={}){return n?this.concat(n,l,p)._parse(e,_):this._parse(e,_)}_parse(e,n){function l(p,_,b){return b==="assert"?new Ms(_,[p]):b==="coerce"?new ns(_,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let b=_.parse(e,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,R=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||R.kind!=="value"){if(T.kind==="projectionDefinition"&&["string","array"].includes(R.kind)||["color","formatted","resolvedImage"].includes(T.kind)&&["value","string"].includes(R.kind)||["padding","numberArray"].includes(T.kind)&&["value","number","array"].includes(R.kind)||T.kind==="colorArray"&&["value","string","array"].includes(R.kind)||T.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(R.kind))b=l(b,T,n.typeAnnotation||"coerce");else if(this.checkSubtype(T,R))return null}else b=l(b,T,n.typeAnnotation||"assert")}if(!(b instanceof ps)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const T=new Ao;try{b=new ps(b.type,b.evaluate(T))}catch(R){return this.error(R.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){const p=typeof e=="number"?this.path.concat(e):this.path,_=l?this.scope.concat(l):this.scope;return new Eo(this.registry,this._isConstant,p,n||null,_,this.errors)}error(e,...n){const l=`${this.key}${n.map((p=>`[${p}]`)).join("")}`;this.errors.push(new Sn(l,e))}checkSubtype(e,n){const l=Bi(e,n);return l&&this.error(l),l}}class hr{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let _=1;_<e.length-1;_+=2){const b=e[_];if(typeof b!="string")return n.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=n.parse(e[_+1],_+1);if(!T)return null;l.push([b,T])}const p=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return p?new hr(l,p):null}outputDefined(){return this.result.outputDefined()}}class Se{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new Se(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class et{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,je),p=n.parse(e[2],2,ki(n.expectedType||vn));return l&&p?new et(p.type.itemType,l,p):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new _r(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new _r(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new _r(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class nt{constructor(e,n){this.type=Yt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,vn),p=n.parse(e[2],2,vn);return l&&p?_i(l.type,[Yt,Mt,je,Ke,vn])?new nt(l,p):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!bi(n,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${ln(Dr(n))} instead.`);if(!bi(l,["string","array"]))throw new _r(`Expected second argument to be of type array or string, but found ${ln(Dr(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class tt{constructor(e,n,l){this.type=je,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,vn),p=n.parse(e[2],2,vn);if(!l||!p)return null;if(!_i(l.type,[Yt,Mt,je,Ke,vn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(l.type)} instead`);if(e.length===4){const _=n.parse(e[3],3,je);return _?new tt(l,p,_):null}return new tt(l,p)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!bi(n,["boolean","string","number","null"]))throw new _r(`Expected first argument to be of type boolean, string, number or null, but found ${ln(Dr(n))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(e)),bi(l,["string"])){const _=l.indexOf(n,p);return _===-1?-1:[...l.slice(0,_)].length}if(bi(l,["array"]))return l.indexOf(n,p);throw new _r(`Expected second argument to be of type array or string, but found ${ln(Dr(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class wt{constructor(e,n,l,p,_,b){this.inputType=e,this.type=n,this.input=l,this.cases=p,this.outputs=_,this.otherwise=b}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,p;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);const _={},b=[];for(let B=2;B<e.length-1;B+=2){let G=e[B];const X=e[B+1];Array.isArray(G)||(G=[G]);const $=n.concat(B);if(G.length===0)return $.error("Expected at least one branch label.");for(const ie of G){if(typeof ie!="number"&&typeof ie!="string")return $.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return $.error("Numeric branch labels must be integer values.");if(l){if($.checkSubtype(l,Dr(ie)))return null}else l=Dr(ie);if(_[String(ie)]!==void 0)return $.error("Branch labels must be unique.");_[String(ie)]=b.length}const Q=n.parse(X,B,p);if(!Q)return null;p=p||Q.type,b.push(Q)}const T=n.parse(e[1],1,vn);if(!T)return null;const R=n.parse(e[e.length-1],e.length-1,p);return R?T.type.kind!=="value"&&n.concat(1).checkSubtype(l,T.type)?null:new wt(l,p,T,_,b,R):null}evaluate(e){const n=this.input.evaluate(e);return(Dr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Mn{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const p=[];for(let b=1;b<e.length-1;b+=2){const T=n.parse(e[b],b,Yt);if(!T)return null;const R=n.parse(e[b+1],b+1,l);if(!R)return null;p.push([T,R]),l=l||R.type}const _=n.parse(e[e.length-1],e.length-1,l);if(!_)return null;if(!l)throw new Error("Can't infer output type");return new Mn(l,p,_)}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class qn{constructor(e,n,l,p){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=p}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,vn),p=n.parse(e[2],2,je);if(!l||!p)return null;if(!_i(l.type,[ki(vn),Mt,vn]))return n.error(`Expected first argument to be of type array or string, but found ${ln(l.type)} instead`);if(e.length===4){const _=n.parse(e[3],3,je);return _?new qn(l.type,l,p,_):null}return new qn(l.type,l,p)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let p;if(this.endIndex&&(p=this.endIndex.evaluate(e)),bi(n,["string"]))return[...n].slice(l,p).join("");if(bi(n,["array"]))return n.slice(l,p);throw new _r(`Expected first argument to be of type array or string, but found ${ln(Dr(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Vi(i,e){const n=i.length-1;let l,p,_=0,b=n,T=0;for(;_<=b;)if(T=Math.floor((_+b)/2),l=i[T],p=i[T+1],l<=e){if(T===n||e<p)return T;_=T+1}else{if(!(l>e))throw new _r("Input is not a number.");b=T-1}return 0}class It{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[p,_]of l)this.labels.push(p),this.outputs.push(_)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,je);if(!l)return null;const p=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let b=1;b<e.length;b+=2){const T=b===1?-1/0:e[b],R=e[b+1],B=b,G=b+1;if(typeof T!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(p.length&&p[p.length-1][0]>=T)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const X=n.parse(R,G,_);if(!X)return null;_=_||X.type,p.push([T,X])}return new It(_,l,p)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const _=n.length;return p>=n[_-1]?l[_-1].evaluate(e):l[Vi(n,p)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function oi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Xi,pa,hc=(function(){if(pa)return Xi;function i(e,n,l,p){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=p}return pa=1,Xi=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,p=0;p<8;p++){var _=this.sampleCurveX(l)-e;if(Math.abs(_)<n)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=_/b}var T=0,R=1;for(l=e,p=0;p<20&&(_=this.sampleCurveX(l),!(Math.abs(_-e)<n));p++)e>_?T=l:R=l,l=.5*(R-T)+T;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Xi})(),ll=oi(hc);class ks{constructor(e,n,l,p,_){this.type=e,this.operator=n,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[b,T]of _)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(e,n,l,p){let _=0;if(e.name==="exponential")_=ws(n,e.base,l,p);else if(e.name==="linear")_=ws(n,1,l,p);else if(e.name==="cubic-bezier"){const b=e.controlPoints;_=new ll(b[0],b[1],b[2],b[3]).solve(ws(n,1,l,p))}return _}static parse(e,n){let[l,p,_,...b]=e;if(!Array.isArray(p)||p.length===0)return n.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const B=p[1];if(typeof B!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:B}}else{if(p[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const B=p.slice(1);if(B.length!==4||B.some((G=>typeof G!="number"||G<0||G>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:B}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,je),!_)return null;const T=[];let R=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==Zi?n.expectedType&&n.expectedType.kind!=="value"&&(R=n.expectedType):R=tn;for(let B=0;B<b.length;B+=2){const G=b[B],X=b[B+1],$=B+3,Q=B+4;if(typeof G!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=G)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const ie=n.parse(X,Q,R);if(!ie)return null;R=R||ie.type,T.push([G,ie])}return mi(R,je)||mi(R,Un)||mi(R,tn)||mi(R,Xn)||mi(R,Cn)||mi(R,Zi)||mi(R,Zt)||mi(R,ki(je))?new ks(R,l,p,_,T):n.error(`Type ${ln(R)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return l[0].evaluate(e);const _=n.length;if(p>=n[_-1])return l[_-1].evaluate(e);const b=Vi(n,p),T=ks.interpolationFactor(this.interpolation,p,n[b],n[b+1]),R=l[b].evaluate(e),B=l[b+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return wo(R,B,T);case"color":return Si.interpolate(R,B,T);case"padding":return Br.interpolate(R,B,T);case"colorArray":return gn.interpolate(R,B,T);case"numberArray":return nr.interpolate(R,B,T);case"variableAnchorOffsetCollection":return Ui.interpolate(R,B,T);case"array":return al(R,B,T);case"projectionDefinition":return Yr.interpolate(R,B,T)}case"interpolate-hcl":switch(this.type.kind){case"color":return Si.interpolate(R,B,T,"hcl");case"colorArray":return gn.interpolate(R,B,T,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Si.interpolate(R,B,T,"lab");case"colorArray":return gn.interpolate(R,B,T,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function ws(i,e,n,l){const p=l-n,_=i-n;return p===0?0:e===1?_/p:(Math.pow(e,_)-1)/(Math.pow(e,p)-1)}const sr={color:Si.interpolate,number:wo,padding:Br.interpolate,numberArray:nr.interpolate,colorArray:gn.interpolate,variableAnchorOffsetCollection:Ui.interpolate,array:al};class Ar{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=null;const p=n.expectedType;p&&p.kind!=="value"&&(l=p);const _=[];for(const T of e.slice(1)){const R=n.parse(T,1+_.length,l,void 0,{typeAnnotation:"omit"});if(!R)return null;l=l||R.type,_.push(R)}if(!l)throw new Error("No output type");const b=p&&_.some((T=>Bi(p,T.type)));return new Ar(b?vn:l,_)}evaluate(e){let n,l=null,p=0;for(const _ of this.args)if(p++,l=_.evaluate(e),l&&l instanceof qs&&!l.available&&(n||(n=l.name),l=null,p===this.args.length&&(l=n)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function ka(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function br(i,e,n,l){return l.compare(e,n)===0}function vr(i,e,n){const l=i!=="=="&&i!=="!=";return class c2{constructor(_,b,T){this.type=Yt,this.lhs=_,this.rhs=b,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||b.type.kind==="value"}static parse(_,b){if(_.length!==3&&_.length!==4)return b.error("Expected two or three arguments.");const T=_[0];let R=b.parse(_[1],1,vn);if(!R)return null;if(!ka(T,R.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${ln(R.type)}'.`);let B=b.parse(_[2],2,vn);if(!B)return null;if(!ka(T,B.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${ln(B.type)}'.`);if(R.type.kind!==B.type.kind&&R.type.kind!=="value"&&B.type.kind!=="value")return b.error(`Cannot compare types '${ln(R.type)}' and '${ln(B.type)}'.`);l&&(R.type.kind==="value"&&B.type.kind!=="value"?R=new Ms(B.type,[R]):R.type.kind!=="value"&&B.type.kind==="value"&&(B=new Ms(R.type,[B])));let G=null;if(_.length===4){if(R.type.kind!=="string"&&B.type.kind!=="string"&&R.type.kind!=="value"&&B.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(G=b.parse(_[3],3,ri),!G)return null}return new c2(R,B,G)}evaluate(_){const b=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(l&&this.hasUntypedArgument){const R=Dr(b),B=Dr(T);if(R.kind!==B.kind||R.kind!=="string"&&R.kind!=="number")throw new _r(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${R.kind}, ${B.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const R=Dr(b),B=Dr(T);if(R.kind!=="string"||B.kind!=="string")return e(_,b,T)}return this.collator?n(_,b,T,this.collator.evaluate(_)):e(_,b,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Fa=vr("==",(function(i,e,n){return e===n}),br),$i=vr("!=",(function(i,e,n){return e!==n}),(function(i,e,n,l){return!br(0,e,n,l)})),xi=vr("<",(function(i,e,n){return e<n}),(function(i,e,n,l){return l.compare(e,n)<0})),xu=vr(">",(function(i,e,n){return e>n}),(function(i,e,n,l){return l.compare(e,n)>0})),Ji=vr("<=",(function(i,e,n){return e<=n}),(function(i,e,n,l){return l.compare(e,n)<=0})),ja=vr(">=",(function(i,e,n){return e>=n}),(function(i,e,n,l){return l.compare(e,n)>=0}));class Na{constructor(e,n,l){this.type=ri,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const p=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Yt);if(!p)return null;const _=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Yt);if(!_)return null;let b=null;return l.locale&&(b=n.parse(l.locale,1,Mt),!b)?null:new Na(p,_,b)}evaluate(e){return new Hs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class ih{constructor(e,n,l,p,_){this.type=Mt,this.number=e,this.locale=n,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,je);if(!l)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return n.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=n.parse(p.locale,1,Mt),!_))return null;let b=null;if(p.currency&&(b=n.parse(p.currency,1,Mt),!b))return null;let T=null;if(p["min-fraction-digits"]&&(T=n.parse(p["min-fraction-digits"],1,je),!T))return null;let R=null;return p["max-fraction-digits"]&&(R=n.parse(p["max-fraction-digits"],1,je),!R)?null:new ih(l,_,b,T,R)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class wa{constructor(e){this.type=ni,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const p=[];let _=!1;for(let b=1;b<=e.length-1;++b){const T=e[b];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let R=null;if(T["font-scale"]&&(R=n.parse(T["font-scale"],1,je),!R))return null;let B=null;if(T["text-font"]&&(B=n.parse(T["text-font"],1,ki(Mt)),!B))return null;let G=null;if(T["text-color"]&&(G=n.parse(T["text-color"],1,tn),!G))return null;let X=null;if(T["vertical-align"]){if(typeof T["vertical-align"]=="string"&&!zl.includes(T["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${T["vertical-align"]}' instead.`);if(X=n.parse(T["vertical-align"],1,Mt),!X)return null}const $=p[p.length-1];$.scale=R,$.font=B,$.textColor=G,$.verticalAlign=X}else{const R=n.parse(e[b],1,vn);if(!R)return null;const B=R.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:R,scale:null,font:null,textColor:null,verticalAlign:null})}}return new wa(p)}evaluate(e){return new Yi(this.sections.map((n=>{const l=n.content.evaluate(e);return Dr(l)===Dn?new ol("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new ol(fa(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class cl{constructor(e){this.type=Dn,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Mt);return l?new cl(l):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),l=qs.fromString(n);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(n)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ll{constructor(e){this.type=je,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ln(l.type)} instead.`):new Ll(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new _r(`Expected value to be of type string or array, but found ${ln(Dr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const $r=8192;function Bl(i,e){const n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(n*p*$r),Math.round(l*p*$r)]}function Fl(i,e){const n=Math.pow(2,e.z);return[(p=(i[0]/$r+e.x)/n,360*p-180),(l=(i[1]/$r+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,p}function dc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Da(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function _u(i,e,n){const l=i[0]-e[0],p=i[1]-e[1],_=i[0]-n[0],b=i[1]-n[1];return l*b-_*p==0&&l*_<=0&&p*b<=0}function Lc(i,e,n,l){return(p=[l[0]-n[0],l[1]-n[1]])[0]*(_=[e[0]-i[0],e[1]-i[1]])[1]-p[1]*_[0]!=0&&!(!Fc(i,e,n,l)||!Fc(n,l,i,e));var p,_}function fc(i,e,n){for(const l of n)for(let p=0;p<l.length-1;++p)if(Lc(i,e,l[p],l[p+1]))return!0;return!1}function no(i,e,n=!1){let l=!1;for(const T of e)for(let R=0;R<T.length-1;R++){if(_u(i,T[R],T[R+1]))return n;(_=T[R])[1]>(p=i)[1]!=(b=T[R+1])[1]>p[1]&&p[0]<(b[0]-_[0])*(p[1]-_[1])/(b[1]-_[1])+_[0]&&(l=!l)}var p,_,b;return l}function io(i,e){for(const n of e)if(no(i,n))return!0;return!1}function Bc(i,e){for(const n of i)if(!no(n,e))return!1;for(let n=0;n<i.length-1;++n)if(fc(i[n],i[n+1],e))return!1;return!0}function Ra(i,e){for(const n of e)if(Bc(i,n))return!0;return!1}function Fc(i,e,n,l){const p=l[0]-n[0],_=l[1]-n[1],b=(i[0]-n[0])*_-p*(i[1]-n[1]),T=(e[0]-n[0])*_-p*(e[1]-n[1]);return b>0&&T<0||b<0&&T>0}function Pa(i,e,n){const l=[];for(let p=0;p<i.length;p++){const _=[];for(let b=0;b<i[p].length;b++){const T=Bl(i[p][b],n);dc(e,T),_.push(T)}l.push(_)}return l}function jl(i,e,n){const l=[];for(let p=0;p<i.length;p++){const _=Pa(i[p],e,n);l.push(_)}return l}function ul(i,e,n,l){if(i[0]<n[0]||i[0]>n[2]){const p=.5*l;let _=i[0]-n[0]>p?-l:n[0]-i[0]>p?l:0;_===0&&(_=i[0]-n[2]>p?-l:n[2]-i[0]>p?l:0),i[0]+=_}dc(e,i)}function Zh(i,e,n,l){const p=Math.pow(2,l.z)*$r,_=[l.x*$r,l.y*$r],b=[];for(const T of i)for(const R of T){const B=[R.x+_[0],R.y+_[1]];ul(B,e,n,p),b.push(B)}return b}function pc(i,e,n,l){const p=Math.pow(2,l.z)*$r,_=[l.x*$r,l.y*$r],b=[];for(const R of i){const B=[];for(const G of R){const X=[G.x+_[0],G.y+_[1]];dc(e,X),B.push(X)}b.push(B)}if(e[2]-e[0]<=p/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const R of b)for(const B of R)ul(B,e,n,p)}var T;return b}class Xs{constructor(e,n){this.type=Yt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bs(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const p=[];for(const _ of l.features){const{type:b,coordinates:T}=_.geometry;b==="Polygon"&&p.push(T),b==="MultiPolygon"&&p.push(...T)}if(p.length)return new Xs(l,{type:"MultiPolygon",coordinates:p})}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Xs(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Xs(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(l.type==="Polygon"){const T=Pa(l.coordinates,_,b),R=Zh(n.geometry(),p,_,b);if(!Da(p,_))return!1;for(const B of R)if(!no(B,T))return!1}if(l.type==="MultiPolygon"){const T=jl(l.coordinates,_,b),R=Zh(n.geometry(),p,_,b);if(!Da(p,_))return!1;for(const B of R)if(!io(B,T))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(l.type==="Polygon"){const T=Pa(l.coordinates,_,b),R=pc(n.geometry(),p,_,b);if(!Da(p,_))return!1;for(const B of R)if(!Bc(B,T))return!1}if(l.type==="MultiPolygon"){const T=jl(l.coordinates,_,b),R=pc(n.geometry(),p,_,b);if(!Da(p,_))return!1;for(const B of R)if(!Ra(B,T))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let rh=class{constructor(i=[],e=(n,l)=>n<l?-1:n>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,l=e[i];for(;i>0;){const p=i-1>>1,_=e[p];if(n(l,_)>=0)break;e[i]=_,i=p}e[i]=l}_down(i){const{data:e,compare:n}=this,l=this.length>>1,p=e[i];for(;i<l;){let _=1+(i<<1);const b=_+1;if(b<this.length&&n(e[b],e[_])<0&&(_=b),n(e[_],p)>=0)break;e[i]=e[_],i=_}e[i]=p}};function Ul(i,e,n=0,l=i.length-1,p=ar){for(;l>n;){if(l-n>600){const R=l-n+1,B=e-n+1,G=Math.log(R),X=.5*Math.exp(2*G/3),$=.5*Math.sqrt(G*X*(R-X)/R)*(B-R/2<0?-1:1);Ul(i,e,Math.max(n,Math.floor(e-B*X/R+$)),Math.min(l,Math.floor(e+(R-B)*X/R+$)),p)}const _=i[e];let b=n,T=l;for(Ua(i,n,e),p(i[l],_)>0&&Ua(i,n,l);b<T;){for(Ua(i,b,T),b++,T--;p(i[b],_)<0;)b++;for(;p(i[T],_)>0;)T--}p(i[n],_)===0?Ua(i,n,T):(T++,Ua(i,T,l)),T<=e&&(n=T+1),e<=T&&(l=T-1)}}function Ua(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function ar(i,e){return i<e?-1:i>e?1:0}function hl(i,e){if(i.length<=1)return[i];const n=[];let l,p;for(const _ of i){const b=a(_);b!==0&&(_.area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(l&&n.push(l),l=[_]):l.push(_))}if(l&&n.push(l),e>1)for(let _=0;_<n.length;_++)n[_].length<=e||(Ul(n[_],e,1,n[_].length-1,ce),n[_]=n[_].slice(0,e));return n}function ce(i,e){return e.area-i.area}function a(i){let e=0;for(let n,l,p=0,_=i.length,b=_-1;p<_;b=p++)n=i[p],l=i[b],e+=(l.x-n.x)*(n.y+l.y);return e}const u=1/298.257223563,g=u*(2-u),v=Math.PI/180;class w{constructor(e){const n=6378.137*v*1e3,l=Math.cos(e*v),p=1/(1-g*(1-l*l)),_=Math.sqrt(p);this.kx=n*_*l,this.ky=n*_*p*(1-g)}distance(e,n){const l=this.wrap(e[0]-n[0])*this.kx,p=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+p*p)}pointOnLine(e,n){let l,p,_,b,T=1/0;for(let R=0;R<e.length-1;R++){let B=e[R][0],G=e[R][1],X=this.wrap(e[R+1][0]-B)*this.kx,$=(e[R+1][1]-G)*this.ky,Q=0;X===0&&$===0||(Q=(this.wrap(n[0]-B)*this.kx*X+(n[1]-G)*this.ky*$)/(X*X+$*$),Q>1?(B=e[R+1][0],G=e[R+1][1]):Q>0&&(B+=X/this.kx*Q,G+=$/this.ky*Q)),X=this.wrap(n[0]-B)*this.kx,$=(n[1]-G)*this.ky;const ie=X*X+$*$;ie<T&&(T=ie,l=B,p=G,_=R,b=Q)}return{point:[l,p],index:_,t:Math.max(0,Math.min(1,b))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function I(i,e){return e[0]-i[0]}function O(i){return i[1]-i[0]+1}function F(i,e){return i[1]>=i[0]&&i[1]<e}function q(i,e){if(i[0]>i[1])return[null,null];const n=O(i);if(e){if(n===2)return[i,null];const p=Math.floor(n/2);return[[i[0],i[0]+p],[i[0]+p,i[1]]]}if(n===1)return[i,null];const l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function te(i,e){if(!F(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)dc(n,i[l]);return n}function ue(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const l of n)dc(e,l);return e}function xe(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Oe(i,e,n){if(!xe(i)||!xe(e))return NaN;let l=0,p=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(p=i[1]-e[3]),i[3]<e[1]&&(p=e[1]-i[3]),n.distance([0,0],[l,p])}function ot(i,e,n){const l=n.pointOnLine(e,i);return n.distance(i,l.point)}function ft(i,e,n,l,p){const _=Math.min(ot(i,[n,l],p),ot(e,[n,l],p)),b=Math.min(ot(n,[i,e],p),ot(l,[i,e],p));return Math.min(_,b)}function Rt(i,e,n,l,p){if(!F(e,i.length)||!F(l,n.length))return 1/0;let _=1/0;for(let b=e[0];b<e[1];++b){const T=i[b],R=i[b+1];for(let B=l[0];B<l[1];++B){const G=n[B],X=n[B+1];if(Lc(T,R,G,X))return 0;_=Math.min(_,ft(T,R,G,X,p))}}return _}function Ht(i,e,n,l,p){if(!F(e,i.length)||!F(l,n.length))return NaN;let _=1/0;for(let b=e[0];b<=e[1];++b)for(let T=l[0];T<=l[1];++T)if(_=Math.min(_,p.distance(i[b],n[T])),_===0)return _;return _}function An(i,e,n){if(no(i,e,!0))return 0;let l=1/0;for(const p of e){const _=p[0],b=p[p.length-1];if(_!==b&&(l=Math.min(l,ot(i,[b,_],n)),l===0))return l;const T=n.pointOnLine(p,i);if(l=Math.min(l,n.distance(i,T.point)),l===0)return l}return l}function wn(i,e,n,l){if(!F(e,i.length))return NaN;for(let _=e[0];_<=e[1];++_)if(no(i[_],n,!0))return 0;let p=1/0;for(let _=e[0];_<e[1];++_){const b=i[_],T=i[_+1];for(const R of n)for(let B=0,G=R.length,X=G-1;B<G;X=B++){const $=R[X],Q=R[B];if(Lc(b,T,$,Q))return 0;p=Math.min(p,ft(b,T,$,Q,l))}}return p}function mn(i,e){for(const n of i)for(const l of n)if(no(l,e,!0))return!0;return!1}function Ki(i,e,n,l=1/0){const p=ue(i),_=ue(e);if(l!==1/0&&Oe(p,_,n)>=l)return l;if(Da(p,_)){if(mn(i,e))return 0}else if(mn(e,i))return 0;let b=1/0;for(const T of i)for(let R=0,B=T.length,G=B-1;R<B;G=R++){const X=T[G],$=T[R];for(const Q of e)for(let ie=0,re=Q.length,ae=re-1;ie<re;ae=ie++){const ye=Q[ae],Be=Q[ie];if(Lc(X,$,ye,Be))return 0;b=Math.min(b,ft(X,$,ye,Be,n))}}return b}function Zn(i,e,n,l,p,_){if(!_)return;const b=Oe(te(l,_),p,n);b<e&&i.push([b,_,[0,0]])}function is(i,e,n,l,p,_,b){if(!_||!b)return;const T=Oe(te(l,_),te(p,b),n);T<e&&i.push([T,_,b])}function ga(i,e,n,l,p=1/0){let _=Math.min(l.distance(i[0],n[0][0]),p);if(_===0)return _;const b=new rh([[0,[0,i.length-1],[0,0]]],I),T=ue(n);for(;b.length>0;){const R=b.pop();if(R[0]>=_)continue;const B=R[1],G=e?50:100;if(O(B)<=G){if(!F(B,i.length))return NaN;if(e){const X=wn(i,B,n,l);if(isNaN(X)||X===0)return X;_=Math.min(_,X)}else for(let X=B[0];X<=B[1];++X){const $=An(i[X],n,l);if(_=Math.min(_,$),_===0)return 0}}else{const X=q(B,e);Zn(b,_,l,i,T,X[0]),Zn(b,_,l,i,T,X[1])}}return _}function Fs(i,e,n,l,p,_=1/0){let b=Math.min(_,p.distance(i[0],n[0]));if(b===0)return b;const T=new rh([[0,[0,i.length-1],[0,n.length-1]]],I);for(;T.length>0;){const R=T.pop();if(R[0]>=b)continue;const B=R[1],G=R[2],X=e?50:100,$=l?50:100;if(O(B)<=X&&O(G)<=$){if(!F(B,i.length)&&F(G,n.length))return NaN;let Q;if(e&&l)Q=Rt(i,B,n,G,p),b=Math.min(b,Q);else if(e&&!l){const ie=i.slice(B[0],B[1]+1);for(let re=G[0];re<=G[1];++re)if(Q=ot(n[re],ie,p),b=Math.min(b,Q),b===0)return b}else if(!e&&l){const ie=n.slice(G[0],G[1]+1);for(let re=B[0];re<=B[1];++re)if(Q=ot(i[re],ie,p),b=Math.min(b,Q),b===0)return b}else Q=Ht(i,B,n,G,p),b=Math.min(b,Q)}else{const Q=q(B,e),ie=q(G,l);is(T,b,p,i,n,Q[0],ie[0]),is(T,b,p,i,n,Q[0],ie[1]),is(T,b,p,i,n,Q[1],ie[0]),is(T,b,p,i,n,Q[1],ie[1])}}return b}function Er(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class rs{constructor(e,n){this.type=je,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bs(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new rs(l,l.features.map((p=>Er(p.geometry))).flat());if(l.type==="Feature")return new rs(l,Er(l.geometry));if("type"in l&&"coordinates"in l)return new rs(l,Er(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const p=n.geometry(),_=p.flat().map((R=>Fl([R.x,R.y],n.canonical)));if(p.length===0)return NaN;const b=new w(_[0][1]);let T=1/0;for(const R of l){switch(R.type){case"Point":T=Math.min(T,Fs(_,!1,[R.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Fs(_,!1,R.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,ga(_,!1,R.coordinates,b,T))}if(T===0)return T}return T})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const p=n.geometry(),_=p.flat().map((R=>Fl([R.x,R.y],n.canonical)));if(p.length===0)return NaN;const b=new w(_[0][1]);let T=1/0;for(const R of l){switch(R.type){case"Point":T=Math.min(T,Fs(_,!0,[R.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Fs(_,!0,R.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,ga(_,!0,R.coordinates,b,T))}if(T===0)return T}return T})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,l){const p=n.geometry();if(p.length===0||p[0].length===0)return NaN;const _=hl(p,0).map((R=>R.map((B=>B.map((G=>Fl([G.x,G.y],n.canonical))))))),b=new w(_[0][0][0][1]);let T=1/0;for(const R of l)for(const B of _){switch(R.type){case"Point":T=Math.min(T,ga([R.coordinates],!1,B,b,T));break;case"LineString":T=Math.min(T,ga(R.coordinates,!0,B,b,T));break;case"Polygon":T=Math.min(T,Ki(B,R.coordinates,b,T))}if(T===0)return T}return T})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ws{constructor(e){this.type=vn,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ws(l)}evaluate(e){var n;const l=(n=e.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?Is(l,this.key):null}eachChild(){}outputDefined(){return!1}}const ro={"==":Fa,"!=":$i,">":xu,"<":xi,">=":ja,"<=":Ji,array:Ms,at:et,boolean:Ms,case:Mn,coalesce:Ar,collator:Na,format:wa,image:cl,in:nt,"index-of":tt,interpolate:ks,"interpolate-hcl":ks,"interpolate-lab":ks,length:Ll,let:hr,literal:ps,match:wt,number:Ms,"number-format":ih,object:Ms,slice:qn,step:It,string:Ms,"to-boolean":ns,"to-color":ns,"to-number":ns,"to-string":ns,var:Se,within:Xs,distance:rs,"global-state":Ws};class js{constructor(e,n,l,p){this.name=e,this.type=n,this._evaluate=l,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const l=e[0],p=js.definitions[l];if(!p)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=b.filter((([B])=>!Array.isArray(B)||B.length===e.length-1));let R=null;for(const[B,G]of T){R=new Eo(n.registry,Oa,n.path,null,n.scope);const X=[];let $=!1;for(let Q=1;Q<e.length;Q++){const ie=e[Q],re=Array.isArray(B)?B[Q-1]:B.type,ae=R.parse(ie,1+X.length,re);if(!ae){$=!0;break}X.push(ae)}if(!$)if(Array.isArray(B)&&B.length!==X.length)R.error(`Expected ${B.length} arguments, but found ${X.length} instead.`);else{for(let Q=0;Q<X.length;Q++){const ie=Array.isArray(B)?B[Q]:B.type,re=X[Q];R.concat(Q+1).checkSubtype(ie,re.type)}if(R.errors.length===0)return new js(l,_,G,X)}}if(T.length===1)n.errors.push(...R.errors);else{const B=(T.length?T:b).map((([X])=>{return $=X,Array.isArray($)?`(${$.map(ln).join(", ")})`:`(${ln($.type)}...)`;var $})).join(" | "),G=[];for(let X=1;X<e.length;X++){const $=n.parse(e[X],1+G.length);if(!$)return null;G.push(ln($.type))}n.error(`Expected arguments of type ${B}, but found (${G.join(", ")}) instead.`)}return null}static register(e,n){js.definitions=n;for(const l in n)e[l]=js}}function sh(i,[e,n,l,p]){e=e.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);const _=p?p.evaluate(i):1,b=Zs(e,n,l,_);if(b)throw new _r(b);return new Si(e/255,n/255,l/255,_,!1)}function bu(i,e){return i in e}function so(i,e){const n=e[i];return n===void 0?null:n}function dl(i){return{type:i}}function Oa(i){if(i instanceof Se)return Oa(i.boundExpression);if(i instanceof js&&i.name==="error"||i instanceof Na||i instanceof Xs||i instanceof rs||i instanceof Ws)return!1;const e=i instanceof ns||i instanceof Ms;let n=!0;return i.eachChild((l=>{n=e?n&&Oa(l):n&&l instanceof ps})),!!n&&Vl(i)&&Uc(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Vl(i){if(i instanceof js&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Xs||i instanceof rs)return!1;let e=!0;return i.eachChild((n=>{e&&!Vl(n)&&(e=!1)})),e}function jc(i){if(i instanceof js&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!jc(n)&&(e=!1)})),e}function Uc(i,e){if(i instanceof js&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((l=>{n&&!Uc(l,e)&&(n=!1)})),n}function ah(i){return{result:"success",value:i}}function gc(i){return{result:"error",value:i}}function So(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function qd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function vu(i){return!!i.expression&&i.expression.interpolated}function Pi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Xh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Dr(i)===Hn}function ao(i){return i}function Wh(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),p=i.type||(vu(e)?"exponential":"interval"),_=(function(G){switch(G.type){case"color":return Si.parse;case"padding":return Br.parse;case"numberArray":return nr.parse;case"colorArray":return gn.parse;default:return null}})(e);if(_&&((i=gi({},i)).stops&&(i.stops=i.stops.map((G=>[G[0],_(G[1])]))),i.default=_(i.default?i.default:e.default)),i.colorSpace&&(b=i.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var b;const T=(function(G){switch(G){case"exponential":return mc;case"interval":return Yh;case"categorical":return ap;case"identity":return Zd;default:throw new Error(`Unknown function type "${G}"`)}})(p);let R,B;if(p==="categorical"){R=Object.create(null);for(const G of i.stops)R[G[0]]=G[1];B=typeof i.stops[0][0]}if(n){const G={},X=[];for(let ie=0;ie<i.stops.length;ie++){const re=i.stops[ie],ae=re[0].zoom;G[ae]===void 0&&(G[ae]={zoom:ae,type:i.type,property:i.property,default:i.default,stops:[]},X.push(ae)),G[ae].stops.push([re[0].value,re[1]])}const $=[];for(const ie of X)$.push([G[ie].zoom,Wh(G[ie],e)]);const Q={name:"linear"};return{kind:"composite",interpolationType:Q,interpolationFactor:ks.interpolationFactor.bind(void 0,Q),zoomStops:$.map((ie=>ie[0])),evaluate:({zoom:ie},re)=>mc({stops:$,base:i.base},e,ie).evaluate(ie,re)}}if(l){const G=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:G,interpolationFactor:ks.interpolationFactor.bind(void 0,G),zoomStops:i.stops.map((X=>X[0])),evaluate:({zoom:X})=>T(i,e,X,R,B)}}return{kind:"source",evaluate(G,X){const $=X&&X.properties?X.properties[i.property]:void 0;return $===void 0?oo(i.default,e.default):T(i,e,$,R,B)}}}function oo(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function ap(i,e,n,l,p){return oo(typeof n===p?l[n]:void 0,i.default,e.default)}function Yh(i,e,n){if(Pi(n)!=="number")return oo(i.default,e.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const p=Vi(i.stops.map((_=>_[0])),n);return i.stops[p][1]}function mc(i,e,n){const l=i.base!==void 0?i.base:1;if(Pi(n)!=="number")return oo(i.default,e.default);const p=i.stops.length;if(p===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[p-1][0])return i.stops[p-1][1];const _=Vi(i.stops.map((G=>G[0])),n),b=(function(G,X,$,Q){const ie=Q-$,re=G-$;return ie===0?0:X===1?re/ie:(Math.pow(X,re)-1)/(Math.pow(X,ie)-1)})(n,l,i.stops[_][0],i.stops[_+1][0]),T=i.stops[_][1],R=i.stops[_+1][1],B=sr[e.type]||ao;return typeof T.evaluate=="function"?{evaluate(...G){const X=T.evaluate.apply(void 0,G),$=R.evaluate.apply(void 0,G);if(X!==void 0&&$!==void 0)return B(X,$,b,i.colorSpace)}}:B(T,R,b,i.colorSpace)}function Zd(i,e,n){switch(e.type){case"color":n=Si.parse(n);break;case"formatted":n=Yi.fromString(n.toString());break;case"resolvedImage":n=qs.fromString(n.toString());break;case"padding":n=Br.parse(n);break;case"colorArray":n=gn.parse(n);break;case"numberArray":n=nr.parse(n);break;default:Pi(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return oo(n,i.default,e.default)}js.register(ro,{error:[{kind:"error"},[Mt],(i,[e])=>{throw new _r(e.evaluate(i))}],typeof:[Mt,[vn],(i,[e])=>ln(Dr(e.evaluate(i)))],"to-rgba":[ki(je,4),[tn],(i,[e])=>{const[n,l,p,_]=e.evaluate(i).rgb;return[255*n,255*l,255*p,_]}],rgb:[tn,[je,je,je],sh],rgba:[tn,[je,je,je,je],sh],has:{type:Yt,overloads:[[[Mt],(i,[e])=>bu(e.evaluate(i),i.properties())],[[Mt,Hn],(i,[e,n])=>bu(e.evaluate(i),n.evaluate(i))]]},get:{type:vn,overloads:[[[Mt],(i,[e])=>so(e.evaluate(i),i.properties())],[[Mt,Hn],(i,[e,n])=>so(e.evaluate(i),n.evaluate(i))]]},"feature-state":[vn,[Mt],(i,[e])=>so(e.evaluate(i),i.featureState||{})],properties:[Hn,[],i=>i.properties()],"geometry-type":[Mt,[],i=>i.geometryType()],id:[vn,[],i=>i.id()],zoom:[je,[],i=>i.globals.zoom],"heatmap-density":[je,[],i=>i.globals.heatmapDensity||0],elevation:[je,[],i=>i.globals.elevation||0],"line-progress":[je,[],i=>i.globals.lineProgress||0],accumulated:[vn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[je,dl(je),(i,e)=>{let n=0;for(const l of e)n+=l.evaluate(i);return n}],"*":[je,dl(je),(i,e)=>{let n=1;for(const l of e)n*=l.evaluate(i);return n}],"-":{type:je,overloads:[[[je,je],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[je],(i,[e])=>-e.evaluate(i)]]},"/":[je,[je,je],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[je,[je,je],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[je,[je],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[je,[je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[je,[je],(i,[e])=>Math.log(e.evaluate(i))],log2:[je,[je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[je,[je],(i,[e])=>Math.sin(e.evaluate(i))],cos:[je,[je],(i,[e])=>Math.cos(e.evaluate(i))],tan:[je,[je],(i,[e])=>Math.tan(e.evaluate(i))],asin:[je,[je],(i,[e])=>Math.asin(e.evaluate(i))],acos:[je,[je],(i,[e])=>Math.acos(e.evaluate(i))],atan:[je,[je],(i,[e])=>Math.atan(e.evaluate(i))],min:[je,dl(je),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[je,dl(je),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[je,[je],(i,[e])=>Math.abs(e.evaluate(i))],round:[je,[je],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[je,[je],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[je,[je],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Yt,[Mt,vn],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[Yt,[vn],(i,[e])=>i.id()===e.value],"filter-type-==":[Yt,[Mt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Yt,[Mt,vn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l<p}],"filter-id-<":[Yt,[vn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[Yt,[Mt,vn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l>p}],"filter-id->":[Yt,[vn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[Yt,[Mt,vn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[Yt,[vn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[Yt,[Mt,vn],(i,[e,n])=>{const l=i.properties()[e.value],p=n.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[Yt,[vn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[Yt,[vn],(i,[e])=>e.value in i.properties()],"filter-has-id":[Yt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Yt,[ki(Mt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Yt,[ki(vn)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Yt,[Mt,ki(vn)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Yt,[Mt,ki(vn)],(i,[e,n])=>(function(l,p,_,b){for(;_<=b;){const T=_+b>>1;if(p[T]===l)return!0;p[T]>l?b=T-1:_=T+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Yt,overloads:[[[Yt,Yt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[dl(Yt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Yt,overloads:[[[Yt,Yt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[dl(Yt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[Yt,[Yt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Yt,[Mt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Mt,[Mt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Mt,[Mt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Mt,dl(vn),(i,e)=>e.map((n=>fa(n.evaluate(i)))).join("")],"resolved-locale":[Mt,[ri],(i,[e])=>e.evaluate(i).resolvedLocale()]});class $h{constructor(e,n,l){this.expression=e,this._warningHistory={},this._evaluator=new Ao,this._defaultValue=n?(function(p){if(p.type==="color"&&Xh(p.default))return new Si(0,0,0,0);switch(p.type){case"color":return Si.parse(p.default)||null;case"padding":return Br.parse(p.default)||null;case"numberArray":return nr.parse(p.default)||null;case"colorArray":return gn.parse(p.default)||null;case"variableAnchorOffsetCollection":return Ui.parse(p.default)||null;case"projectionDefinition":return Yr.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=Js(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,p,_,b){this._globalState&&(e=Js(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new _r(`Expected value to be one of ${Object.keys(this._enumValues).map((R=>JSON.stringify(R))).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function yc(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ro}function wu(i,e,n){const l=new Eo(ro,Oa,[],e?(function(_){const b={color:tn,string:Mt,number:je,enum:Mt,boolean:Yt,formatted:ni,padding:Xn,numberArray:Cn,colorArray:Zi,projectionDefinition:Un,resolvedImage:Dn,variableAnchorOffsetCollection:Zt};return _.type==="array"?ki(b[_.value]||vn,_.length):b[_.type]})(e):void 0),p=l.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?ah(new $h(p,e,n)):gc(l.errors)}class za{constructor(e,n,l){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!jc(n.expression),this.globalStateRefs=Ys(n.expression),this._globalState=l}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=Js(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,_,b)}evaluate(e,n,l,p,_,b){return this._globalState&&(e=Js(e,this._globalState)),this._styleExpression.evaluate(e,n,l,p,_,b)}}class xc{constructor(e,n,l,p,_){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!jc(n.expression),this.globalStateRefs=Ys(n.expression),this.interpolationType=p,this._globalState=_}evaluateWithoutErrorHandling(e,n,l,p,_,b){return this._globalState&&(e=Js(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,p,_,b)}evaluate(e,n,l,p,_,b){return this._globalState&&(e=Js(e,this._globalState)),this._styleExpression.evaluate(e,n,l,p,_,b)}interpolationFactor(e,n,l){return this.interpolationType?ks.interpolationFactor(this.interpolationType,e,n,l):0}}function _c(i,e,n){const l=wu(i,e,n);if(l.result==="error")return l;const p=l.value.expression,_=Vl(p);if(!_&&!So(e))return gc([new Sn("","data expressions not supported")]);const b=Uc(p,["zoom"]);if(!b&&!qd(e))return gc([new Sn("","zoom expressions not supported")]);const T=bc(p);return T||b?T instanceof Sn?gc([T]):T instanceof ks&&!vu(e)?gc([new Sn("",'"interpolate" expressions cannot be used with this property')]):ah(T?new xc(_?"camera":"composite",l.value,T.labels,T instanceof ks?T.interpolation:void 0,n):new za(_?"constant":"source",l.value,n)):gc([new Sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Vc{constructor(e,n){this._parameters=e,this._specification=n,gi(this,Wh(this._parameters,this._specification))}static deserialize(e){return new Vc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function bc(i){let e=null;if(i instanceof hr)e=bc(i.result);else if(i instanceof Ar){for(const n of i.args)if(e=bc(n),e)break}else(i instanceof It||i instanceof ks)&&i.input instanceof js&&i.input.name==="zoom"&&(e=i);return e instanceof Sn||i.eachChild((n=>{const l=bc(n);l instanceof Sn?e=l:!e&&l?e=new Sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Sn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Ys(i,e=new Set){return i instanceof Ws&&e.add(i.key),i.eachChild((n=>{Ys(n,e)})),e}function Js(i,e){const{zoom:n,heatmapDensity:l,elevation:p,lineProgress:_,isSupportedScript:b,accumulated:T}=i??{};return{zoom:n,heatmapDensity:l,elevation:p,lineProgress:_,isSupportedScript:b,accumulated:T,globalState:e}}function fl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!fl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const pl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Va(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};fl(i)||(i=Gc(i));const n=wu(i,pl,e);if(n.result==="error")throw new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,p,_)=>n.value.evaluate(l,p,{},_),needGeometry:Xd(i),getGlobalStateRefs:()=>Ys(n.value.expression)}}function Gl(i,e){return i<e?-1:i>e?1:0}function Xd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Xd(i[e]))return!0;return!1}function Gc(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Au(i[1],i[2],"=="):e==="!="?Fr(Au(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Au(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Gc))):e==="all"?["all"].concat(i.slice(1).map(Gc)):e==="none"?["all"].concat(i.slice(1).map(Gc).map(Fr)):e==="in"?Wd(i[1],i.slice(2)):e==="!in"?Fr(Wd(i[1],i.slice(2))):e==="has"?ea(i[1]):e!=="!has"||Fr(ea(i[1]));var n}function Au(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Wd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Gl)]]:["filter-in-small",i,["literal",e]]}}function ea(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Fr(i){return["!",i]}function ir(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let p="[";for(const _ of i)p+=`${ir(_)},`;return`${p}]`}const n=Object.keys(i).sort();let l="{";for(let p=0;p<n.length;p++)l+=`${JSON.stringify(n[p])}:${ir(i[n[p]])},`;return`${l}}`}function Hl(i){let e="";for(const n of ai)e+=`/${ir(i[n])}`;return e}function lo(i){const e=i.value;return e?[new Jt(i.key,e,"constants have been deprecated as of v8")]:[]}function us(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ga(i){if(Array.isArray(i))return i.map(Ga);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Ga(i[n]);return e}return us(i)}function Ha(i){const e=i.key,n=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},_=i.style,b=i.styleSpec,T=i.validateSpec;let R=[];const B=Pi(n);if(B!=="object")return[new Jt(e,n,`object expected, ${B} found`)];for(const G in n){const X=G.split(".")[0],$=Is(l,X)||l["*"];let Q;if(Is(p,X))Q=p[X];else if(Is(l,X)){if(n[G]===void 0)continue;Q=T}else if(p["*"])Q=p["*"];else{if(!l["*"]){R.push(new Jt(e,n[G],`unknown property "${G}"`));continue}Q=T}R=R.concat(Q({key:(e&&`${e}.`)+G,value:n[G],valueSpec:$,style:_,styleSpec:b,object:n,objectKey:G,validateSpec:T},n))}for(const G in l)p[G]||l[G].required&&l[G].default===void 0&&n[G]===void 0&&R.push(new Jt(e,n,`missing required property "${G}"`));return R}function oh(i){const e=i.value,n=i.valueSpec,l=i.style,p=i.styleSpec,_=i.key,b=i.arrayElementValidator||i.validateSpec;if(Pi(e)!=="array")return[new Jt(_,e,`array expected, ${Pi(e)} found`)];if(n.length&&e.length!==n.length)return[new Jt(_,e,`array length ${n.length} expected, length ${e.length} found`)];let T={type:n.value,values:n.values};p.$version<7&&(T.function=n.function),Pi(n.value)==="object"&&(T=n.value);let R=[];for(let B=0;B<e.length;B++)R=R.concat(b({array:e,arrayIndex:B,value:e[B],valueSpec:T,validateSpec:i.validateSpec,style:l,styleSpec:p,key:`${_}[${B}]`}));return R}function gl(i){const e=i.key,n=i.value,l=i.valueSpec;let p=Pi(n);return p==="number"&&n!=n&&(p="NaN"),p!=="number"?[new Jt(e,n,`number expected, ${p} found`)]:"minimum"in l&&n<l.minimum?[new Jt(e,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new Jt(e,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function ml(i){const e=i.valueSpec,n=us(i.value.type);let l,p,_,b={};const T=n!=="categorical"&&i.value.property===void 0,R=!T,B=Pi(i.value.stops)==="array"&&Pi(i.value.stops[0])==="array"&&Pi(i.value.stops[0][0])==="object",G=Ha({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Q){if(n==="identity")return[new Jt(Q.key,Q.value,'identity function may not have a "stops" property')];let ie=[];const re=Q.value;return ie=ie.concat(oh({key:Q.key,value:re,valueSpec:Q.valueSpec,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:X})),Pi(re)==="array"&&re.length===0&&ie.push(new Jt(Q.key,re,"array must have at least one stop")),ie},default:function(Q){return Q.validateSpec({key:Q.key,value:Q.value,valueSpec:e,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec})}}});return n==="identity"&&T&&G.push(new Jt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||G.push(new Jt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!vu(i.valueSpec)&&G.push(new Jt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(R&&!So(i.valueSpec)?G.push(new Jt(i.key,i.value,"property functions not supported")):T&&!qd(i.valueSpec)&&G.push(new Jt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!B||i.value.property!==void 0||G.push(new Jt(i.key,i.value,'"property" property is required')),G;function X(Q){let ie=[];const re=Q.value,ae=Q.key;if(Pi(re)!=="array")return[new Jt(ae,re,`array expected, ${Pi(re)} found`)];if(re.length!==2)return[new Jt(ae,re,`array length 2 expected, length ${re.length} found`)];if(B){if(Pi(re[0])!=="object")return[new Jt(ae,re,`object expected, ${Pi(re[0])} found`)];if(re[0].zoom===void 0)return[new Jt(ae,re,"object stop key must have zoom")];if(re[0].value===void 0)return[new Jt(ae,re,"object stop key must have value")];if(_&&_>us(re[0].zoom))return[new Jt(ae,re[0].zoom,"stop zoom values must appear in ascending order")];us(re[0].zoom)!==_&&(_=us(re[0].zoom),p=void 0,b={}),ie=ie.concat(Ha({key:`${ae}[0]`,value:re[0],valueSpec:{zoom:{}},validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:gl,value:$}}))}else ie=ie.concat($({key:`${ae}[0]`,value:re[0],validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec},re));return yc(Ga(re[1]))?ie.concat([new Jt(`${ae}[1]`,re[1],"expressions are not allowed in function stops.")]):ie.concat(Q.validateSpec({key:`${ae}[1]`,value:re[1],valueSpec:e,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec}))}function $(Q,ie){const re=Pi(Q.value),ae=us(Q.value),ye=Q.value!==null?Q.value:ie;if(l){if(re!==l)return[new Jt(Q.key,ye,`${re} stop domain type must match previous stop domain type ${l}`)]}else l=re;if(re!=="number"&&re!=="string"&&re!=="boolean")return[new Jt(Q.key,ye,"stop domain value must be a number, string, or boolean")];if(re!=="number"&&n!=="categorical"){let Be=`number expected, ${re} found`;return So(e)&&n===void 0&&(Be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Jt(Q.key,ye,Be)]}return n!=="categorical"||re!=="number"||isFinite(ae)&&Math.floor(ae)===ae?n!=="categorical"&&re==="number"&&p!==void 0&&ae<p?[new Jt(Q.key,ye,"stop domain values must appear in ascending order")]:(p=ae,n==="categorical"&&ae in b?[new Jt(Q.key,ye,"stop domain values must be unique")]:(b[ae]=!0,[])):[new Jt(Q.key,ye,`integer expected, found ${ae}`)]}}function yl(i){const e=(i.expressionContext==="property"?_c:wu)(Ga(i.value),i.valueSpec);if(e.result==="error")return e.value.map((l=>new Jt(`${i.key}${l.key}`,i.value,l.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Jt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!jc(n))return[new Jt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!jc(n))return[new Jt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Uc(n,["zoom","feature-state"]))return[new Jt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Vl(n))return[new Jt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ql(i){const e=i.key,n=i.value,l=Pi(n);return l!=="string"?[new Jt(e,n,`color expected, ${l} found`)]:Si.parse(String(n))?[]:[new Jt(e,n,`color expected, "${n}" found`)]}function Zl(i){const e=i.key,n=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(us(n))===-1&&p.push(new Jt(e,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(us(n))===-1&&p.push(new Jt(e,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function Co(i){return fl(Ga(i.value))?yl(gi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):xl(i)}function xl(i){const e=i.value,n=i.key;if(Pi(e)!=="array")return[new Jt(n,e,`array expected, ${Pi(e)} found`)];const l=i.styleSpec;let p,_=[];if(e.length<1)return[new Jt(n,e,"filter array must have at least 1 element")];switch(_=_.concat(Zl({key:`${n}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),us(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&us(e[1])==="$type"&&_.push(new Jt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new Jt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Pi(e[1]),p!=="string"&&_.push(new Jt(`${n}[1]`,e[1],`string expected, ${p} found`)));for(let b=2;b<e.length;b++)p=Pi(e[b]),us(e[1])==="$type"?_=_.concat(Zl({key:`${n}[${b}]`,value:e[b],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Jt(`${n}[${b}]`,e[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<e.length;b++)_=_.concat(xl({key:`${n}[${b}]`,value:e[b],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Pi(e[1]),e.length!==2?_.push(new Jt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Jt(`${n}[1]`,e[1],`string expected, ${p} found`))}return _}function Xl(i,e){const n=i.key,l=i.validateSpec,p=i.style,_=i.styleSpec,b=i.value,T=i.objectKey,R=_[`${e}_${i.layerType}`];if(!R)return[];const B=T.match(/^(.*)-transition$/);if(e==="paint"&&B&&R[B[1]]&&R[B[1]].transition)return l({key:n,value:b,valueSpec:_.transition,style:p,styleSpec:_});const G=i.valueSpec||R[T];if(!G)return[new Jt(n,b,`unknown property "${T}"`)];let X;if(Pi(b)==="string"&&So(G)&&!G.tokens&&(X=/^{([^}]+)}$/.exec(b)))return[new Jt(n,b,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(X[1])} }\`.`)];const $=[];return i.layerType==="symbol"&&T==="text-font"&&Xh(Ga(b))&&us(b.type)==="identity"&&$.push(new Jt(n,b,'"text-font" does not support identity functions')),$.concat(l({key:i.key,value:b,valueSpec:G,style:p,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:T}))}function _l(i){return Xl(i,"paint")}function Kh(i){return Xl(i,"layout")}function Qh(i){let e=[];const n=i.value,l=i.key,p=i.style,_=i.styleSpec;if(Pi(n)!=="object")return[new Jt(l,n,`object expected, ${Pi(n)} found`)];n.type||n.ref||e.push(new Jt(l,n,'either "type" or "ref" is required'));let b=us(n.type);const T=us(n.ref);if(n.id){const R=us(n.id);for(let B=0;B<i.arrayIndex;B++){const G=p.layers[B];us(G.id)===R&&e.push(new Jt(l,n.id,`duplicate layer id "${n.id}", previously used at line ${G.id.__line__}`))}}if("ref"in n){let R;["type","source","source-layer","filter","layout"].forEach((B=>{B in n&&e.push(new Jt(l,n[B],`"${B}" is prohibited for ref layers`))})),p.layers.forEach((B=>{us(B.id)===T&&(R=B)})),R?R.ref?e.push(new Jt(l,n.ref,"ref cannot reference another ref layer")):b=us(R.type):e.push(new Jt(l,n.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(n.source){const R=p.sources&&p.sources[n.source],B=R&&us(R.type);R?B==="vector"&&b==="raster"?e.push(new Jt(l,n.source,`layer "${n.id}" requires a raster source`)):B!=="raster-dem"&&b==="hillshade"||B!=="raster-dem"&&b==="color-relief"?e.push(new Jt(l,n.source,`layer "${n.id}" requires a raster-dem source`)):B==="raster"&&b!=="raster"?e.push(new Jt(l,n.source,`layer "${n.id}" requires a vector source`)):B!=="vector"||n["source-layer"]?B==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?e.push(new Jt(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!n.paint||!n.paint["line-gradient"]||B==="geojson"&&R.lineMetrics||e.push(new Jt(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Jt(l,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Jt(l,n.source,`source "${n.source}" not found`))}else e.push(new Jt(l,n,'missing required property "source"'));return e=e.concat(Ha({key:l,value:n,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:n.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Co,layout:R=>Ha({layer:n,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":B=>Kh(gi({layerType:b},B))}}),paint:R=>Ha({layer:n,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":B=>_l(gi({layerType:b},B))}})}})),e}function co(i){const e=i.value,n=i.key,l=Pi(e);return l!=="string"?[new Jt(n,e,`string expected, ${l} found`)]:[]}const Eu={promoteId:function({key:i,value:e}){if(Pi(e)==="string")return co({key:i,value:e});{const n=[];for(const l in e)n.push(...co({key:`${i}.${l}`,value:e[l]}));return n}}};function Wl(i){const e=i.value,n=i.key,l=i.styleSpec,p=i.style,_=i.validateSpec;if(!e.type)return[new Jt(n,e,'"type" is required')];const b=us(e.type);let T;switch(b){case"vector":case"raster":return T=Ha({key:n,value:e,valueSpec:l[`source_${b.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Eu,validateSpec:_}),T;case"raster-dem":return T=(function(R){var B;const G=(B=R.sourceName)!==null&&B!==void 0?B:"",X=R.value,$=R.styleSpec,Q=$.source_raster_dem,ie=R.style;let re=[];const ae=Pi(X);if(X===void 0)return re;if(ae!=="object")return re.push(new Jt("source_raster_dem",X,`object expected, ${ae} found`)),re;const ye=us(X.encoding)==="custom",Be=["redFactor","greenFactor","blueFactor","baseShift"],be=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Ee in X)!ye&&Be.includes(Ee)?re.push(new Jt(Ee,X[Ee],`In "${G}": "${Ee}" is only valid when "encoding" is set to "custom". ${be} encoding found`)):Q[Ee]?re=re.concat(R.validateSpec({key:Ee,value:X[Ee],valueSpec:Q[Ee],validateSpec:R.validateSpec,style:ie,styleSpec:$})):re.push(new Jt(Ee,X[Ee],`unknown property "${Ee}"`));return re})({sourceName:n,value:e,style:i.style,styleSpec:l,validateSpec:_}),T;case"geojson":if(T=Ha({key:n,value:e,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:_,objectElementValidators:Eu}),e.cluster)for(const R in e.clusterProperties){const[B,G]=e.clusterProperties[R],X=typeof B=="string"?[B,["accumulated"],["get",R]]:B;T.push(...yl({key:`${n}.${R}.map`,value:G,expressionContext:"cluster-map"})),T.push(...yl({key:`${n}.${R}.reduce`,value:X,expressionContext:"cluster-reduce"}))}return T;case"video":return Ha({key:n,value:e,valueSpec:l.source_video,style:p,validateSpec:_,styleSpec:l});case"image":return Ha({key:n,value:e,valueSpec:l.source_image,style:p,validateSpec:_,styleSpec:l});case"canvas":return[new Jt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zl({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ns(i){const e=i.value,n=i.styleSpec,l=n.light,p=i.style;let _=[];const b=Pi(e);if(e===void 0)return _;if(b!=="object")return _=_.concat([new Jt("light",e,`object expected, ${b} found`)]),_;for(const T in e){const R=T.match(/^(.*)-transition$/);_=_.concat(R&&l[R[1]]&&l[R[1]].transition?i.validateSpec({key:T,value:e[T],valueSpec:n.transition,validateSpec:i.validateSpec,style:p,styleSpec:n}):l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],validateSpec:i.validateSpec,style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)])}return _}function lh(i){const e=i.value,n=i.styleSpec,l=n.sky,p=i.style,_=Pi(e);if(e===void 0)return[];if(_!=="object")return[new Jt("sky",e,`object expected, ${_} found`)];let b=[];for(const T in e)b=b.concat(l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)]);return b}function Jh(i){const e=i.value,n=i.styleSpec,l=n.terrain,p=i.style;let _=[];const b=Pi(e);if(e===void 0)return _;if(b!=="object")return _=_.concat([new Jt("terrain",e,`object expected, ${b} found`)]),_;for(const T in e)_=_.concat(l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],validateSpec:i.validateSpec,style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)]);return _}function Yd(i){let e=[];const n=i.value,l=i.key;if(Array.isArray(n)){const p=[],_=[];for(const b in n)n[b].id&&p.includes(n[b].id)&&e.push(new Jt(l,n,`all the sprites' ids must be unique, but ${n[b].id} is duplicated`)),p.push(n[b].id),n[b].url&&_.includes(n[b].url)&&e.push(new Jt(l,n,`all the sprites' URLs must be unique, but ${n[b].url} is duplicated`)),_.push(n[b].url),e=e.concat(Ha({key:`${l}[${b}]`,value:n[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return co({key:l,value:n})}function op(i){return!!i&&i.constructor===Object}function $d(i){return op(i.value)?[]:[new Jt(i.key,i.value,`object expected, ${Pi(i.value)} found`)]}const As={"*":()=>[],array:oh,boolean:function(i){const e=i.value,n=i.key,l=Pi(e);return l!=="boolean"?[new Jt(n,e,`boolean expected, ${l} found`)]:[]},number:gl,color:ql,constants:lo,enum:Zl,filter:Co,function:ml,layer:Qh,object:Ha,source:Wl,light:Ns,sky:lh,terrain:Jh,projection:function(i){const e=i.value,n=i.styleSpec,l=n.projection,p=i.style,_=Pi(e);if(e===void 0)return[];if(_!=="object")return[new Jt("projection",e,`object expected, ${_} found`)];let b=[];for(const T in e)b=b.concat(l[T]?i.validateSpec({key:T,value:e[T],valueSpec:l[T],style:p,styleSpec:n}):[new Jt(T,e[T],`unknown property "${T}"`)]);return b},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const l=Pi(n);return l!=="array"||(function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"})(n)||(function(p){return!!["interpolate","step","literal"].includes(p[0])})(n)?["array","string"].includes(l)?[]:[new Jt(e,n,`projection expected, invalid type "${l}" found`)]:[new Jt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:co,formatted:function(i){return co(i).length===0?[]:yl(i)},resolvedImage:function(i){return co(i).length===0?[]:yl(i)},padding:function(i){const e=i.key,n=i.value;if(Pi(n)==="array"){if(n.length<1||n.length>4)return[new Jt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let p=[];for(let _=0;_<n.length;_++)p=p.concat(i.validateSpec({key:`${e}[${_}]`,value:n[_],validateSpec:i.validateSpec,valueSpec:l}));return p}return gl({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(Pi(n)==="array"){const l={type:"number"};if(n.length<1)return[new Jt(e,n,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<n.length;_++)p=p.concat(i.validateSpec({key:`${e}[${_}]`,value:n[_],validateSpec:i.validateSpec,valueSpec:l}));return p}return gl({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(Pi(n)==="array"){if(n.length<1)return[new Jt(e,n,"array length at least 1 expected, length 0 found")];let l=[];for(let p=0;p<n.length;p++)l=l.concat(ql({key:`${e}[${p}]`,value:n[p]}));return l}return ql({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,l=Pi(n),p=i.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new Jt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let b=0;b<n.length;b+=2)_=_.concat(Zl({key:`${e}[${b}]`,value:n[b],valueSpec:p.layout_symbol["text-anchor"]})),_=_.concat(oh({key:`${e}[${b+1}]`,value:n[b+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:p}));return _},sprite:Yd,state:$d,fontFaces:function(i){const e=i.key,n=i.value,l=i.validateSpec,p=i.styleSpec,_=i.style;if(!op(n))return[new Jt(e,n,`object expected, ${Pi(n)} found`)];const b=[];for(const T in n){const R=n[T],B=Pi(R);if(B==="string")b.push(...co({key:`${e}.${T}`,value:R}));else if(B==="array"){const G={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[X,$]of R.entries())b.push(...Ha({key:`${e}.${T}[${X}]`,value:$,valueSpec:G,styleSpec:p,style:_,validateSpec:l}))}else b.push(new Jt(`${e}.${T}`,R,`string or array expected, ${B} found`))}return b}};function bl(i){const e=i.value,n=i.valueSpec,l=i.styleSpec;return i.validateSpec=bl,n.expression&&Xh(us(e))?ml(i):n.expression&&yc(Ga(e))?yl(i):n.type&&As[n.type]?As[n.type](i):Ha(gi({},i,{valueSpec:n.type?l[n.type]:n}))}function Su(i){const e=i.value,n=i.key,l=co(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Jt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Jt(n,e,'"glyphs" url must include a "{range}" token'))),l}function Aa(i,e=dt){let n=[];return n=n.concat(bl({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:bl,objectElementValidators:{glyphs:Su,"*":()=>[]}})),i.constants&&(n=n.concat(lo({key:"constants",value:i.constants}))),Hc(n)}function uo(i){return function(e){return i(Object.assign({},e,{validateSpec:bl}))}}function Hc(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function Ea(i){return function(...e){return Hc(i.apply(this,e))}}Aa.source=Ea(uo(Wl)),Aa.sprite=Ea(uo(Yd)),Aa.glyphs=Ea(uo(Su)),Aa.light=Ea(uo(Ns)),Aa.sky=Ea(uo(lh)),Aa.terrain=Ea(uo(Jh)),Aa.state=Ea(uo($d)),Aa.layer=Ea(uo(Qh)),Aa.filter=Ea(uo(Co)),Aa.paintProperty=Ea(uo(_l)),Aa.layoutProperty=Ea(uo(Kh));const A0={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Cu{constructor(e,n){this._globalState=n,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=wu(e,A0,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=Ys(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const ch=dt,$s=Aa,Go=$s.light,ed=$s.sky,td=$s.paintProperty,lp=$s.layoutProperty;function Ho(i,e){let n=!1;if(e&&e.length)for(const l of e)i.fire(new yn(new Error(l.message))),n=!0;return n}class vc{constructor(e,n,l){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const b=new Int32Array(this.arrayBuffer);e=b[0],this.d=(n=b[1])+2*(l=b[2]);for(let R=0;R<this.d*this.d;R++){const B=b[3+R],G=b[3+R+1];p.push(B===G?null:b.subarray(B,G))}const T=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=l,this.scale=n/e,this.uid=0;const _=l/n*e;this.min=-_,this.max=e+_}insert(e,n,l,p,_){this._forEachCell(n,l,p,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,l,p,_,b){this.cells[_].push(b)}query(e,n,l,p,_){const b=this.min,T=this.max;if(e<=b&&n<=b&&T<=l&&T<=p&&!_)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(e,n,l,p,this._queryCell,R,{},_),R}}_queryCell(e,n,l,p,_,b,T,R){const B=this.cells[_];if(B!==null){const G=this.keys,X=this.bboxes;for(let $=0;$<B.length;$++){const Q=B[$];if(T[Q]===void 0){const ie=4*Q;(R?R(X[ie+0],X[ie+1],X[ie+2],X[ie+3]):e<=X[ie+2]&&n<=X[ie+3]&&l>=X[ie+0]&&p>=X[ie+1])?(T[Q]=!0,b.push(G[Q])):T[Q]=!1}}}}_forEachCell(e,n,l,p,_,b,T,R){const B=this._convertToCellCoord(e),G=this._convertToCellCoord(n),X=this._convertToCellCoord(l),$=this._convertToCellCoord(p);for(let Q=B;Q<=X;Q++)for(let ie=G;ie<=$;ie++){const re=this.d*ie+Q;if((!R||R(this._convertFromCellCoord(Q),this._convertFromCellCoord(ie),this._convertFromCellCoord(Q+1),this._convertFromCellCoord(ie+1)))&&_.call(this,e,n,l,p,re,b,T,R))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let l=0;for(let b=0;b<this.cells.length;b++)l+=this.cells[b].length;const p=new Int32Array(n+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let _=n;for(let b=0;b<e.length;b++){const T=e[b];p[3+b]=_,p.set(T,_),_+=T.length}return p[3+e.length]=_,p.set(this.keys,_),_+=this.keys.length,p[3+e.length+1]=_,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer}static serialize(e,n){const l=e.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(e){return new vc(e.buffer)}}const qa={};function On(i,e,n={}){if(qa[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),qa[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}On("Object",Object),On("Set",Set),On("TransferableGridIndex",vc),On("Color",Si),On("Error",Error),On("AJAXError",de),On("ResolvedImage",qs),On("StylePropertyFunction",Vc),On("StyleExpression",$h,{omit:["_evaluator"]}),On("ZoomDependentExpression",xc),On("ZoomConstantExpression",za),On("CompoundExpression",js,{omit:["_evaluate"]});for(const i in ro)ro[i]._classRegistryKey||On(`Expression_${i}`,ro[i]);function uh(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function nd(i){return i.$name||i.constructor._classRegistryKey}function To(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=nd(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||uh(i)||Gn(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function qo(i,e){if(To(i))return(uh(i)||Gn(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const _=[];for(const b of i)_.push(qo(b,e));return _}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=nd(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!qa[n])throw new Error(`${n} is not registered.`);const{klass:l}=qa[n],p=l.serialize?l.serialize(i,e):{};if(l.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||qa[n].omit.indexOf(_)>=0)continue;const b=i[_];p[_]=qa[n].shallow.indexOf(_)>=0?b:qo(b,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(p.$name=n),p}function Tu(i){if(To(i))return i;if(Array.isArray(i))return i.map(Tu);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=nd(i)||"Object";if(!qa[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=qa[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const l=Object.create(n.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const _=i[p];l[p]=qa[e].shallow.indexOf(p)>=0?_:Tu(_)}return l}class id{constructor(){this.first=!0}update(e,n){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function vl(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function qc(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function hh(i){return/\s/u.test(String.fromCodePoint(i))}function wl(i){for(const e of i)if(qc(e.codePointAt(0)))return!0;return!1}function rd(i){for(const e of i)if(!Kd(e.codePointAt(0)))return!1;return!0}function dh(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const Al=dh(["Arab","Dupl","Mong","Ougr","Syrc"]);function Kd(i){return!Al.test(String.fromCodePoint(i))}function El(i){return!(qc(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const sd=dh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function fh(i){return sd.test(String.fromCodePoint(i))}function Sl(i,e){return!(!e&&fh(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Yl(i){for(const e of i)if(fh(e.codePointAt(0)))return!0;return!1}const Io=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Io.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,l=new Promise((_=>{this.loadScriptResolve=_}));e(n);const p=new Promise((_=>setTimeout((()=>_()),this.TIMEOUT)));if(yield Promise.race([l,p]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class Ir{constructor(e,n){this.isSupportedScript=Qd,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new id,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new id,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}function Qd(i){return(function(e,n){for(const l of e)if(!Sl(l.codePointAt(0),n))return!1;return!0})(i,Io.getRTLTextPluginStatus()==="loaded")}const $l="-transition";class wc{constructor(e,n,l){this.property=e,this.value=n,this.expression=(function(p,_,b){if(Xh(p))return new Vc(p,_);if(yc(p)){const T=_c(p,_,b);if(T.result==="error")throw new Error(T.value.map((R=>`${R.key}: ${R.message}`)).join(", "));return T.value}{let T=p;return _.type==="color"&&typeof p=="string"?T=Si.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?_.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?T=Ui.parse(p):_.type==="projectionDefinition"&&typeof p=="string"&&(T=Yr.parse(p)):T=gn.parse(p):T=nr.parse(p):T=Br.parse(p),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>T}}})(n===void 0?e.specification.default:n,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class ph{constructor(e,n){this.property=e,this.value=new wc(e,void 0,n)}transitioned(e,n){return new Zc(this.property,this.value,n,un({},e.transition,this.transition),e.now)}untransitioned(){return new Zc(this.property,this.value,null,{},0)}}class ad{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return ii(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ph(this._values[e].property,this._globalState)),this._values[e].value=new wc(this._values[e].property,n===null?void 0:ii(n),this._globalState)}getTransition(e){return ii(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ph(this._values[e].property,this._globalState)),this._values[e].transition=ii(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const p=this.getTransition(n);p!==void 0&&(e[`${n}${$l}`]=p)}return e}transitioned(e,n){const l=new gh(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(e,n._values[p]);return l}untransitioned(){const e=new gh(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Zc{constructor(e,n,l,p,_){this.property=e,this.value=n,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const p=e.now||0,_=this.value.possiblyEvaluate(e,n,l),b=this.prior;if(b){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return b.possiblyEvaluate(e,n,l);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(e,n,l),_,kt(T))}}return _}}class gh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const p=new Xc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,n,l);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Jd{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ii(this._values[e].value)}setValue(e,n){this._values[e]=new wc(this._values[e].property,n===null?void 0:ii(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const p=new Xc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,n,l);return p}}class ho{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,p){return this.property.evaluate(this.value,this.parameters,e,n,l,p)}}class Xc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Bn{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,l){const p=sr[this.specification.type];return p?p(e,n,l):e}}class ei{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,p){return new ho(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,p)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new ho(this,{kind:"constant",value:void 0},e.parameters);const p=sr[this.specification.type];if(p){const _=p(e.value.value,n.value.value,l);return new ho(this,{kind:"constant",value:_},e.parameters)}return e}evaluate(e,n,l,p,_,b){return e.kind==="constant"?e.value:e.evaluate(n,l,p,_,b)}}class Mo extends ei{possiblyEvaluate(e,n,l,p){if(e.value===void 0)return new ho(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const _=e.expression.evaluate(n,null,{},l,p),b=e.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,T=this._calculate(b,b,b,n);return new ho(this,{kind:"constant",value:T},n)}if(e.expression.kind==="camera"){const _=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new ho(this,{kind:"constant",value:_},n)}return new ho(this,e.expression,n)}evaluate(e,n,l,p,_,b){if(e.kind==="source"){const T=e.evaluate(n,l,p,_,b);return this._calculate(T,T,T,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},l,p),e.evaluate({zoom:Math.floor(n.zoom)},l,p),e.evaluate({zoom:Math.floor(n.zoom)+1},l,p),n):e.value}_calculate(e,n,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class Iu{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const _=e.expression.evaluate(n,null,{},l,p);return this._calculate(_,_,_,n)}return this._calculate(e.expression.evaluate(new Ir(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Ir(Math.floor(n.zoom),n)),e.expression.evaluate(new Ir(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class mh{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,p){return!!e.expression.evaluate(n,null,{},l,p)}interpolate(){return!1}}class Es{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const p=this.defaultPropertyValues[n]=new wc(l,void 0,void 0),_=this.defaultTransitionablePropertyValues[n]=new ph(l,void 0);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=p.possiblyEvaluate({})}}}On("DataDrivenProperty",ei),On("DataConstantProperty",Bn),On("CrossFadedDataDrivenProperty",Mo),On("CrossFadedProperty",Iu),On("ColorRampProperty",mh);class hs extends $n{constructor(e,n,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(p,_){return new Cu(p,_)})(this.visibility,l),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Va(e.filter,l)),n.layout&&(this._unevaluatedLayout=new Jd(n.layout,l)),n.paint)){this._transitionablePaint=new ad(n.paint,l);for(const p in e.paint)this.setPaintProperty(p,e.paint[p],{validate:!1});for(const p in e.layout)this.setLayoutProperty(p,e.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xc(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=Va(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())e.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const p of l.getGlobalStateRefs())e.add(p)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const p=this._transitionablePaint._values[l].value;for(const _ of p.getGlobalStateRefs()){const b=(e=n.get(_))!==null&&e!==void 0?e:[];b.push({name:l,value:p.value}),n.set(_,b)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,n,l={}){if(n==null||!this._validate(lp,`layers.${this.id}.layout.${e}`,e,n,l))return e==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,n)}getPaintProperty(e){return e.endsWith($l)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,l={}){if(n!=null&&this._validate(td,`layers.${this.id}.paint.${e}`,e,n,l))return!1;if(e.endsWith($l))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const p=this._transitionablePaint._values[e],_=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),T=p.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const R=this._transitionablePaint._values[e].value;return R.isDataDriven()||b||_||this._handleOverridablePaintPropertyUpdate(e,T,R)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e=this.minzoom,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Nn(e,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}_validate(e,n,l,p,_={}){return(!_||_.validate!==!1)&&Ho(this,e.call($s,{key:n,layerType:this.type,objectKey:l,value:p,styleSpec:dt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ho&&So(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let gs;var yh={get paint(){return gs=gs||new Es({"raster-opacity":new Bn(dt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bn(dt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bn(dt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bn(dt.paint_raster["raster-brightness-max"]),"raster-saturation":new Bn(dt.paint_raster["raster-saturation"]),"raster-contrast":new Bn(dt.paint_raster["raster-contrast"]),"raster-resampling":new Bn(dt.paint_raster["raster-resampling"]),"raster-fade-duration":new Bn(dt.paint_raster["raster-fade-duration"])})}};class Kl extends hs{constructor(e,n){super(e,yh,n)}}const qi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sr{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Gi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ss(i,e=1){let n=0,l=0;return{members:i.map((p=>{const _=qi[p.type].BYTES_PER_ELEMENT,b=n=ko(n,Math.max(e,_)),T=p.components||1;return l=Math.max(l,_),n+=_*T,{name:p.name,type:p.type,components:T,offset:b}})),size:ko(n,Math.max(l,e)),alignment:e}}function ko(i,e){return Math.ceil(i/e)*e}class Zo extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.int16[p+0]=n,this.int16[p+1]=l,e}}Zo.prototype.bytesPerElement=4,On("StructArrayLayout2i4",Zo);class Wc extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.int16[_+0]=n,this.int16[_+1]=l,this.int16[_+2]=p,e}}Wc.prototype.bytesPerElement=6,On("StructArrayLayout3i6",Wc);class Yc extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,p)}emplace(e,n,l,p,_){const b=4*e;return this.int16[b+0]=n,this.int16[b+1]=l,this.int16[b+2]=p,this.int16[b+3]=_,e}}Yc.prototype.bytesPerElement=8,On("StructArrayLayout4i8",Yc);class Ql extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=6*e;return this.int16[R+0]=n,this.int16[R+1]=l,this.int16[R+2]=p,this.int16[R+3]=_,this.int16[R+4]=b,this.int16[R+5]=T,e}}Ql.prototype.bytesPerElement=12,On("StructArrayLayout2i4i12",Ql);class ef extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=4*e,B=8*e;return this.int16[R+0]=n,this.int16[R+1]=l,this.uint8[B+4]=p,this.uint8[B+5]=_,this.uint8[B+6]=b,this.uint8[B+7]=T,e}}ef.prototype.bytesPerElement=8,On("StructArrayLayout2i4ub8",ef);class Kr extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.float32[p+0]=n,this.float32[p+1]=l,e}}Kr.prototype.bytesPerElement=8,On("StructArrayLayout2f8",Kr);class Xo extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G){const X=this.length;return this.resize(X+1),this.emplace(X,e,n,l,p,_,b,T,R,B,G)}emplace(e,n,l,p,_,b,T,R,B,G,X){const $=10*e;return this.uint16[$+0]=n,this.uint16[$+1]=l,this.uint16[$+2]=p,this.uint16[$+3]=_,this.uint16[$+4]=b,this.uint16[$+5]=T,this.uint16[$+6]=R,this.uint16[$+7]=B,this.uint16[$+8]=G,this.uint16[$+9]=X,e}}Xo.prototype.bytesPerElement=20,On("StructArrayLayout10ui20",Xo);class Mu extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R){const B=this.length;return this.resize(B+1),this.emplace(B,e,n,l,p,_,b,T,R)}emplace(e,n,l,p,_,b,T,R,B){const G=8*e;return this.uint16[G+0]=n,this.uint16[G+1]=l,this.uint16[G+2]=p,this.uint16[G+3]=_,this.uint16[G+4]=b,this.uint16[G+5]=T,this.uint16[G+6]=R,this.uint16[G+7]=B,e}}Mu.prototype.bytesPerElement=16,On("StructArrayLayout8ui16",Mu);class ku extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G,X,$){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,n,l,p,_,b,T,R,B,G,X,$)}emplace(e,n,l,p,_,b,T,R,B,G,X,$,Q){const ie=12*e;return this.int16[ie+0]=n,this.int16[ie+1]=l,this.int16[ie+2]=p,this.int16[ie+3]=_,this.uint16[ie+4]=b,this.uint16[ie+5]=T,this.uint16[ie+6]=R,this.uint16[ie+7]=B,this.int16[ie+8]=G,this.int16[ie+9]=X,this.int16[ie+10]=$,this.int16[ie+11]=Q,e}}ku.prototype.bytesPerElement=24,On("StructArrayLayout4i4ui4i24",ku);class xh extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.float32[_+0]=n,this.float32[_+1]=l,this.float32[_+2]=p,e}}xh.prototype.bytesPerElement=12,On("StructArrayLayout3f12",xh);class _h extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}_h.prototype.bytesPerElement=4,On("StructArrayLayout1ul4",_h);class bh extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,l,p,_,b,T,R,B)}emplace(e,n,l,p,_,b,T,R,B,G){const X=10*e,$=5*e;return this.int16[X+0]=n,this.int16[X+1]=l,this.int16[X+2]=p,this.int16[X+3]=_,this.int16[X+4]=b,this.int16[X+5]=T,this.uint32[$+3]=R,this.uint16[X+8]=B,this.uint16[X+9]=G,e}}bh.prototype.bytesPerElement=20,On("StructArrayLayout6i1ul2ui20",bh);class Ac extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=6*e;return this.int16[R+0]=n,this.int16[R+1]=l,this.int16[R+2]=p,this.int16[R+3]=_,this.int16[R+4]=b,this.int16[R+5]=T,e}}Ac.prototype.bytesPerElement=12,On("StructArrayLayout2i2i2i12",Ac);class Jl extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,l,p,_)}emplace(e,n,l,p,_,b){const T=4*e,R=8*e;return this.float32[T+0]=n,this.float32[T+1]=l,this.float32[T+2]=p,this.int16[R+6]=_,this.int16[R+7]=b,e}}Jl.prototype.bytesPerElement=16,On("StructArrayLayout2f1f2i16",Jl);class ma extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,l,p,_,b)}emplace(e,n,l,p,_,b,T){const R=16*e,B=4*e,G=8*e;return this.uint8[R+0]=n,this.uint8[R+1]=l,this.float32[B+1]=p,this.float32[B+2]=_,this.int16[G+6]=b,this.int16[G+7]=T,e}}ma.prototype.bytesPerElement=16,On("StructArrayLayout2ub2f2i16",ma);class as extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=l,this.uint16[_+2]=p,e}}as.prototype.bytesPerElement=6,On("StructArrayLayout3ui6",as);class Cl extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G,X,$,Q,ie,re,ae,ye){const Be=this.length;return this.resize(Be+1),this.emplace(Be,e,n,l,p,_,b,T,R,B,G,X,$,Q,ie,re,ae,ye)}emplace(e,n,l,p,_,b,T,R,B,G,X,$,Q,ie,re,ae,ye,Be){const be=24*e,Ee=12*e,Ge=48*e;return this.int16[be+0]=n,this.int16[be+1]=l,this.uint16[be+2]=p,this.uint16[be+3]=_,this.uint32[Ee+2]=b,this.uint32[Ee+3]=T,this.uint32[Ee+4]=R,this.uint16[be+10]=B,this.uint16[be+11]=G,this.uint16[be+12]=X,this.float32[Ee+7]=$,this.float32[Ee+8]=Q,this.uint8[Ge+36]=ie,this.uint8[Ge+37]=re,this.uint8[Ge+38]=ae,this.uint32[Ee+10]=ye,this.int16[be+22]=Be,e}}Cl.prototype.bytesPerElement=48,On("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Cl);class $c extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p,_,b,T,R,B,G,X,$,Q,ie,re,ae,ye,Be,be,Ee,Ge,Qe,Dt,en,Xt,hn,In,fn){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,e,n,l,p,_,b,T,R,B,G,X,$,Q,ie,re,ae,ye,Be,be,Ee,Ge,Qe,Dt,en,Xt,hn,In,fn)}emplace(e,n,l,p,_,b,T,R,B,G,X,$,Q,ie,re,ae,ye,Be,be,Ee,Ge,Qe,Dt,en,Xt,hn,In,fn,Kt){const Ut=32*e,Vn=16*e;return this.int16[Ut+0]=n,this.int16[Ut+1]=l,this.int16[Ut+2]=p,this.int16[Ut+3]=_,this.int16[Ut+4]=b,this.int16[Ut+5]=T,this.int16[Ut+6]=R,this.int16[Ut+7]=B,this.uint16[Ut+8]=G,this.uint16[Ut+9]=X,this.uint16[Ut+10]=$,this.uint16[Ut+11]=Q,this.uint16[Ut+12]=ie,this.uint16[Ut+13]=re,this.uint16[Ut+14]=ae,this.uint16[Ut+15]=ye,this.uint16[Ut+16]=Be,this.uint16[Ut+17]=be,this.uint16[Ut+18]=Ee,this.uint16[Ut+19]=Ge,this.uint16[Ut+20]=Qe,this.uint16[Ut+21]=Dt,this.uint16[Ut+22]=en,this.uint32[Vn+12]=Xt,this.float32[Vn+13]=hn,this.float32[Vn+14]=In,this.uint16[Ut+30]=fn,this.uint16[Ut+31]=Kt,e}}$c.prototype.bytesPerElement=64,On("StructArrayLayout8i15ui1ul2f2ui64",$c);class Kc extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Kc.prototype.bytesPerElement=4,On("StructArrayLayout1f4",Kc);class Nu extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=3*e;return this.uint16[6*e+0]=n,this.float32[_+1]=l,this.float32[_+2]=p,e}}Nu.prototype.bytesPerElement=12,On("StructArrayLayout1ui2f12",Nu);class Wo extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,l)}emplace(e,n,l,p){const _=4*e;return this.uint32[2*e+0]=n,this.uint16[_+2]=l,this.uint16[_+3]=p,e}}Wo.prototype.bytesPerElement=8,On("StructArrayLayout1ul2ui8",Wo);class A extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const p=2*e;return this.uint16[p+0]=n,this.uint16[p+1]=l,e}}A.prototype.bytesPerElement=4,On("StructArrayLayout2ui4",A);class t extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}t.prototype.bytesPerElement=2,On("StructArrayLayout1ui2",t);class s extends Gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,l,p)}emplace(e,n,l,p,_){const b=4*e;return this.float32[b+0]=n,this.float32[b+1]=l,this.float32[b+2]=p,this.float32[b+3]=_,e}}s.prototype.bytesPerElement=16,On("StructArrayLayout4f16",s);class f extends Sr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new U(this.anchorPointX,this.anchorPointY)}}f.prototype.size=20;class x extends bh{get(e){return new f(this,e)}}On("CollisionBoxArray",x);class S extends Sr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}S.prototype.size=48;class M extends Cl{get(e){return new S(this,e)}}On("PlacedSymbolArray",M);class z extends Sr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}z.prototype.size=64;class j extends $c{get(e){return new z(this,e)}}On("SymbolInstanceArray",j);class Z extends Kc{getoffsetX(e){return this.float32[1*e+0]}}On("GlyphOffsetArray",Z);class W extends Wc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}On("SymbolLineVertexArray",W);class ee extends Sr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class J extends Nu{get(e){return new ee(this,e)}}On("TextAnchorOffsetArray",J);class se extends Sr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}se.prototype.size=8;class fe extends Wo{get(e){return new se(this,e)}}On("FeatureIndexArray",fe);class Ce extends Zo{}class Me extends Zo{}class Ie extends Zo{}class Le extends Ql{}class $e extends ef{}class ze extends Kr{}class We extends Xo{}class st extends Mu{}class Ve extends ku{}class pt extends xh{}class Ft extends _h{}class Nt extends Ac{}class Ot extends ma{}class zt extends as{}class xn extends A{}const _n=ss([{name:"a_pos",components:2,type:"Int16"}],4),{members:cn}=_n;class Tn{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,l,p){const _=this.segments[this.segments.length-1];return e>Tn.MAX_VERTEX_ARRAY_LENGTH&&si(`Max vertices per segment is ${Tn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Tn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+e>Tn.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p?this.createNewSegment(n,l,p):_}createNewSegment(e,n,l){const p={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(p.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(e,n,l){return this.prepareSegment(0,e,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,p){return new Tn([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Mi(i,e){return 256*(i=Bt(Math.floor(i),0,255))+Bt(Math.floor(e),0,255)}Tn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,On("SegmentVector",Tn);const Cr=ss([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Hr=ss([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var jr,Qr,Pr,ds={exports:{}},Jr={exports:{}},ta={exports:{}},ms=(function(){if(Pr)return ds.exports;Pr=1;var i=(jr||(jr=1,Jr.exports=function(n,l){var p,_,b,T,R,B,G,X;for(_=n.length-(p=3&n.length),b=l,R=3432918353,B=461845907,X=0;X<_;)G=255&n.charCodeAt(X)|(255&n.charCodeAt(++X))<<8|(255&n.charCodeAt(++X))<<16|(255&n.charCodeAt(++X))<<24,++X,b=27492+(65535&(T=5*(65535&(b=(b^=G=(65535&(G=(G=(65535&G)*R+(((G>>>16)*R&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(G=0,p){case 3:G^=(255&n.charCodeAt(X+2))<<16;case 2:G^=(255&n.charCodeAt(X+1))<<8;case 1:b^=G=(65535&(G=(G=(65535&(G^=255&n.charCodeAt(X)))*R+(((G>>>16)*R&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295}return b^=n.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),Jr.exports),e=(Qr||(Qr=1,ta.exports=function(n,l){for(var p,_=n.length,b=l^_,T=0;_>=4;)p=1540483477*(65535&(p=255&n.charCodeAt(T)|(255&n.charCodeAt(++T))<<8|(255&n.charCodeAt(++T))<<16|(255&n.charCodeAt(++T))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++T;switch(_){case 3:b^=(255&n.charCodeAt(T+2))<<16;case 2:b^=(255&n.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&n.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),ta.exports);return ds.exports=i,ds.exports.murmur3=i,ds.exports.murmur2=e,ds.exports})(),ys=H(ms);class na{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,l,p){this.ids.push(Tl(e)),this.positions.push(n,l,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Tl(e);let l=0,p=this.ids.length-1;for(;l<p;){const b=l+p>>1;this.ids[b]>=n?p=b:l=b+1}const _=[];for(;this.ids[l]===n;)_.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return _}static serialize(e,n){const l=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Il(l,p,0,l.length-1),n&&n.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(e){const n=new na;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Tl(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:ys(String(i))}function Il(i,e,n,l){for(;n<l;){const p=i[n+l>>1];let _=n-1,b=l+1;for(;;){do _++;while(i[_]<p);do b--;while(i[b]>p);if(_>=b)break;Yo(i,_,b),Yo(e,3*_,3*b),Yo(e,3*_+1,3*b+1),Yo(e,3*_+2,3*b+2)}b-n<l-b?(Il(i,e,n,b),n=b+1):(Il(i,e,b+1,l),l=b)}}function Yo(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}On("FeaturePositionMap",na);class Za{constructor(e,n){this.gl=e.gl,this.location=n}}class Qc extends Za{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Du extends Za{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class $o extends Za{constructor(e,n){super(e,n),this.current=Si.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Xa=new Float32Array(16);function fo(i){return[Mi(255*i.r,255*i.g),Mi(255*i.b,255*i.a)]}class No{constructor(e,n,l){this.value=e,this.uniformNames=n.map((p=>`u_${p}`)),this.type=l}setUniform(e,n,l){e.set(l.constantOr(this.value))}getBinding(e,n,l){return this.type==="color"?new $o(e,n):new Qc(e,n)}}class Do{constructor(e,n){this.uniformNames=n.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,l,p){let _=null;p==="u_pattern_to"?_=this.patternTo:p==="u_pattern_from"?_=this.patternFrom:p==="u_dasharray_to"?_=this.dashTo:p==="u_dasharray_from"?_=this.dashFrom:p==="u_pixel_ratio_to"?_=this.pixelRatioTo:p==="u_pixel_ratio_from"&&(_=this.pixelRatioFrom),_!==null&&e.set(_)}getBinding(e,n,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Du(e,n):new Qc(e,n)}}class Mr{constructor(e,n,l,p){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((_=>({name:`a_${_}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,n,l){const p=this.paintVertexArray.length,_=this.expression.evaluate(new Ir(0,l),n,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(p,e,_)}updatePaintArray(e,n,l,p,_){const b=this.expression.evaluate(new Ir(0,_),l,p);this._setPaintValue(e,n,b)}_setPaintValue(e,n,l){if(this.type==="color"){const p=fo(l);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ur{constructor(e,n,l,p,_,b){this.expression=e,this.uniformNames=n.map((T=>`u_${T}_t`)),this.type=l,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map((T=>({name:`a_${T}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(e,n,l){const p=this.expression.evaluate(new Ir(this.zoom,l),n,{},l.canonical,[],l.formattedSection),_=this.expression.evaluate(new Ir(this.zoom+1,l),n,{},l.canonical,[],l.formattedSection),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,p,_)}updatePaintArray(e,n,l,p,_){const b=this.expression.evaluate(new Ir(this.zoom,_),l,p),T=this.expression.evaluate(new Ir(this.zoom+1,_),l,p);this._setPaintValue(e,n,b,T)}_setPaintValue(e,n,l,p){if(this.type==="color"){const _=fo(l),b=fo(p);for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,_[0],_[1],b[0],b[1])}else{for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,p=Bt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,n,l){return new Qc(e,n)}}class Ds{constructor(e,n,l,p,_,b){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,n,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,this.getPositionIds(n),l)}updatePaintArray(e,n,l,p,_){this._setPaintValues(e,n,this.getPositionIds(l),_)}_setPaintValues(e,n,l,p){const _=this.getPositions(p);if(!_||!l)return;const b=_[l.min],T=_[l.mid],R=_[l.max];if(b&&T&&R)for(let B=e;B<n;B++)this.emplace(this.zoomInPaintVertexArray,B,T,b),this.emplace(this.zoomOutPaintVertexArray,B,T,R)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Us extends Ds{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Cr.members}emplace(e,n,l,p){e.emplace(n,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],l.pixelRatio,p.pixelRatio)}}class od extends Ds{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Hr.members}emplace(e,n,l,p){e.emplace(n,0,l.y,l.height,l.width,0,p.y,p.height,p.width)}}class ld{constructor(e,n,l){this.binders={},this._buffers=[];const p=[];for(const _ in e.paint._values){if(!l(_))continue;const b=e.paint.get(_);if(!(b instanceof ho&&So(b.property.specification)))continue;const T=cp(_,e.type),R=b.value,B=b.property.specification.type,G=b.property.useIntegerZoom,X=b.property.specification["property-type"],$=X==="cross-faded"||X==="cross-faded-data-driven";if(R.kind==="constant")this.binders[_]=$?new Do(R.value,T):new No(R.value,T,B),p.push(`/u_${_}`);else if(R.kind==="source"||$){const Q=Sc(_,B,"source");this.binders[_]=$?_==="line-dasharray"?new od(R,B,G,n,Q,e.id):new Us(R,B,G,n,Q,e.id):new Mr(R,T,B,Q),p.push(`/a_${_}`)}else{const Q=Sc(_,B,"composite");this.binders[_]=new Ur(R,T,B,G,n,Q),p.push(`/z_${_}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Mr||n instanceof Ur?n.maxValue:0}populatePaintArrays(e,n,l){for(const p in this.binders){const _=this.binders[p];(_ instanceof Mr||_ instanceof Ur||_ instanceof Ds)&&_.populatePaintArray(e,n,l)}}setConstantPatternPositions(e,n){for(const l in this.binders){const p=this.binders[l];p instanceof Do&&p.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const l in this.binders){const p=this.binders[l];p instanceof Do&&p.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,l,p,_){let b=!1;for(const T in e){const R=n.getPositions(T);for(const B of R){const G=l.feature(B.index);for(const X in this.binders){const $=this.binders[X];if(($ instanceof Mr||$ instanceof Ur||$ instanceof Ds)&&$.expression.isStateDependent===!0){const Q=p.paint.get(X);$.expression=Q.value,$.updatePaintArray(B.start,B.end,G,e[T],_),b=!0}}}}return b}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof No||l instanceof Do)&&e.push(...l.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Mr||l instanceof Ur)for(let p=0;p<l.paintVertexAttributes.length;p++)e.push(l.paintVertexAttributes[p].name);else if(l instanceof Ds){const p=l.getVertexAttributes();for(const _ of p)e.push(_.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof No||l instanceof Do||l instanceof Ur)for(const p of l.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const l=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof No||_ instanceof Do||_ instanceof Ur){for(const b of _.uniformNames)if(n[b]){const T=_.getBinding(e,n[b],b);l.push({name:b,property:p,binding:T})}}}return l}setUniforms(e,n,l,p){for(const{name:_,property:b,binding:T}of n)this.binders[b].setUniform(T,p,l.get(b),_)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(e&&l instanceof Ds){const p=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof Mr||l instanceof Ur)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof Mr||l instanceof Ur||l instanceof Ds)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Mr||n instanceof Ur||n instanceof Ds)&&n.destroy()}}}class Ec{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new ld(p,n,l);this.needsUpload=!1,this._featureMap=new na,this._bufferOffset=0}populatePaintArrays(e,n,l,p){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,n,p);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,p){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,n,_,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function cp(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Sc(i,e,n){const l={color:{source:Kr,composite:s},number:{source:Kc,composite:Kr}},p=(function(_){return{"line-pattern":{source:We,composite:We},"fill-pattern":{source:We,composite:We},"fill-extrusion-pattern":{source:We,composite:We},"line-dasharray":{source:st,composite:st}}[_]})(i);return p&&p[n]||l[e][n]}On("ConstantBinder",No),On("CrossFadedConstantBinder",Do),On("SourceExpressionBinder",Mr),On("CrossFadedPatternBinder",Us),On("CrossFadedDasharrayBinder",od),On("CompositeExpressionBinder",Ur),On("ProgramConfiguration",ld,{omit:["_buffers"]}),On("ProgramConfigurationSet",Ec);const cd=Math.pow(2,14)-1,ec=-cd-1;function tc(i){const e=Tt/i.extent,n=i.loadGeometry();for(let l=0;l<n.length;l++){const p=n[l];for(let _=0;_<p.length;_++){const b=p[_],T=Math.round(b.x*e),R=Math.round(b.y*e);b.x=Bt(T,ec,cd),b.y=Bt(R,ec,cd),(T<b.x||T>b.x+1||R<b.y||R>b.y+1)&&si("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ko(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?tc(i):[]}}const ud=-32768;function vh(i,e,n,l,p){i.emplaceBack(ud+8*e+l,ud+8*n+p)}class wh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Me,this.indexArray=new zt,this.segments=new Tn,this.programConfigurations=new Ec(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){const p=this.layers[0],_=[];let b=null,T=!1,R=p.type==="heatmap";if(p.type==="circle"){const G=p;b=G.layout.get("circle-sort-key"),T=!b.isConstant(),R=R||G.paint.get("circle-pitch-alignment")==="map"}const B=R?n.subdivisionGranularity.circle:1;for(const{feature:G,id:X,index:$,sourceLayerIndex:Q}of e){const ie=this.layers[0]._featureFilter.needGeometry,re=Ko(G,ie);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),re,l))continue;const ae=T?b.evaluate(re,{},l):void 0,ye={id:X,properties:G.properties,type:G.type,sourceLayerIndex:Q,index:$,geometry:ie?re.geometry:tc(G),patterns:{},sortKey:ae};_.push(ye)}T&&_.sort(((G,X)=>G.sortKey-X.sortKey));for(const G of _){const{geometry:X,index:$,sourceLayerIndex:Q}=G,ie=e[$].feature;this.addFeature(G,X,$,l,B),n.featureIndex.insert(ie,X,$,Q,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,p,_=1){let b;switch(_){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const T=b.length;for(const R of n)for(const B of R){const G=B.x,X=B.y;if(G<0||G>=Tt||X<0||X>=Tt)continue;const $=this.segments.prepareSegment(T*T,this.layoutVertexArray,this.indexArray,e.sortKey),Q=$.vertexLength;for(let ie=0;ie<T;ie++)for(let re=0;re<T;re++)vh(this.layoutVertexArray,G,X,b[re],b[ie]);for(let ie=0;ie<T-1;ie++)for(let re=0;re<T-1;re++){const ae=Q+ie*T+re,ye=Q+(ie+1)*T+re;this.indexArray.emplaceBack(ae,ye+1,ae+1),this.indexArray.emplaceBack(ae,ye,ye+1)}$.vertexLength+=T*T,$.primitiveLength+=(T-1)*(T-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:p})}}function Ah(i,e){for(let n=0;n<i.length;n++)if(Cc(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Cc(i,e[n]))return!0;return!!ya(i,e)}function up(i,e,n){return!!Cc(i,e)||!!dp(e,i,n)}function hp(i,e){if(i.length===1)return S0(e,i[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let p=0;p<l.length;p++)if(Cc(i,l[p]))return!0}for(let n=0;n<i.length;n++)if(S0(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(ya(i,e[n]))return!0;return!1}function ia(i,e,n){if(i.length>1){if(ya(i,e))return!0;for(let l=0;l<e.length;l++)if(dp(e[l],i,n))return!0}for(let l=0;l<i.length;l++)if(dp(i[l],e,n))return!0;return!1}function ya(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const l=i[n],p=i[n+1];for(let _=0;_<e.length-1;_++)if(jg(l,p,e[_],e[_+1]))return!0}return!1}function jg(i,e,n,l){return wi(i,n,l)!==wi(e,n,l)&&wi(i,e,n)!==wi(i,e,l)}function dp(i,e,n){const l=n*n;if(e.length===1)return i.distSqr(e[0])<l;for(let p=1;p<e.length;p++)if(E0(i,e[p-1],e[p])<l)return!0;return!1}function E0(i,e,n){const l=e.distSqr(n);if(l===0)return i.distSqr(e);const p=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/l;return i.distSqr(p<0?e:p>1?n:n.sub(e)._mult(p)._add(e))}function S0(i,e){let n,l,p,_=!1;for(let b=0;b<i.length;b++){n=i[b];for(let T=0,R=n.length-1;T<n.length;R=T++)l=n[T],p=n[R],l.y>e.y!=p.y>e.y&&e.x<(p.x-l.x)*(e.y-l.y)/(p.y-l.y)+l.x&&(_=!_)}return _}function Cc(i,e){let n=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const _=i[l],b=i[p];_.y>e.y!=b.y>e.y&&e.x<(b.x-_.x)*(e.y-_.y)/(b.y-_.y)+_.x&&(n=!n)}return n}function Ug(i,e,n){const l=n[0],p=n[2];if(i.x<l.x&&e.x<l.x||i.x>p.x&&e.x>p.x||i.y<l.y&&e.y<l.y||i.y>p.y&&e.y>p.y)return!1;const _=wi(i,e,n[0]);return _!==wi(i,e,n[1])||_!==wi(i,e,n[2])||_!==wi(i,e,n[3])}function Jc(i,e,n){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(i)}function tf(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function fp(i,e,n,l,p){if(!e[0]&&!e[1])return i;const _=U.convert(e)._mult(p);n==="viewport"&&_._rotate(-l);const b=[];for(let T=0;T<i.length;T++)b.push(i[T].sub(_));return b}function pp(i){const e=[];for(let n=0;n<i.length;n++){const l=i[n],p=e.at(-1);(n===0||p&&!l.equals(p))&&e.push(l)}return e}function C0({queryGeometry:i,size:e},n){return up(i,n,e)}function Vg({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){return up(i,_,e*(n.projectTileCoordinates(_.x,_.y,l,p).signedDistanceFromCamera/n.cameraToCenterDistance))}function Gg({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){const b=n.projectTileCoordinates(_.x,_.y,l,p).signedDistanceFromCamera,T=e*(n.cameraToCenterDistance/b);return up(i,nf(_,n,l,p),T)}function Hg({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p},_){return up(i,nf(_,n,l,p),e)}function gp({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p,pitchAlignment:_="map",pitchScale:b="map"},T){const R=_==="map"?b==="map"?C0:Vg:b==="map"?Gg:Hg,B={queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:p};for(const G of T)for(const X of G)if(R(B,X))return!0;return!1}function nf(i,e,n,l){const p=e.projectTileCoordinates(i.x,i.y,n,l).point;return new U((.5*p.x+.5)*e.width,(.5*-p.y+.5)*e.height)}let mp,T0;On("CircleBucket",wh,{omit:["layers"]});var I0={get paint(){return T0=T0||new Es({"circle-radius":new ei(dt.paint_circle["circle-radius"]),"circle-color":new ei(dt.paint_circle["circle-color"]),"circle-blur":new ei(dt.paint_circle["circle-blur"]),"circle-opacity":new ei(dt.paint_circle["circle-opacity"]),"circle-translate":new Bn(dt.paint_circle["circle-translate"]),"circle-translate-anchor":new Bn(dt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bn(dt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bn(dt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ei(dt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ei(dt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ei(dt.paint_circle["circle-stroke-opacity"])})},get layout(){return mp=mp||new Es({"circle-sort-key":new ei(dt.layout_circle["circle-sort-key"])})}};class yp extends hs{constructor(e,n){super(e,I0,n)}createBucket(e){return new wh(e)}queryRadius(e){const n=e;return Jc("circle-radius",this,n)+Jc("circle-stroke-width",this,n)+tf(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,unwrappedTileID:T,getElevation:R}){const B=fp(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,b),G=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),X=this.paint.get("circle-pitch-scale"),$=this.paint.get("circle-pitch-alignment");let Q,ie;return $==="map"?(Q=B,ie=G*b):(Q=(function(re,ae,ye,Be){return re.map((be=>nf(be,ae,ye,Be)))})(B,_,T,R),ie=G),gp({queryGeometry:Q,size:ie,transform:_,unwrappedTileID:T,getElevation:R,pitchAlignment:$,pitchScale:X},p)}}class xp extends wh{}let M0;On("HeatmapBucket",xp,{omit:["layers"]});var k0={get paint(){return M0=M0||new Es({"heatmap-radius":new ei(dt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ei(dt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bn(dt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mh(dt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bn(dt.paint_heatmap["heatmap-opacity"])})}};function _p(i,{width:e,height:n},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*n*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*n*l}`)}else p=new Uint8Array(e*n*l);return i.width=e,i.height=n,i.data=p,i}function Tc(i,{width:e,height:n},l){if(e===i.width&&n===i.height)return;const p=_p({},{width:e,height:n},l);rf(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},l),i.width=e,i.height=n,i.data=p.data}function rf(i,e,n,l,p,_){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||n.x>i.width-p.width||n.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||l.x>e.width-p.width||l.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,T=e.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<p.height;R++){const B=((n.y+R)*i.width+n.x)*_,G=((l.y+R)*e.width+l.x)*_;for(let X=0;X<p.width*_;X++)T[G+X]=b[B+X]}return e}class sf{constructor(e,n){_p(this,e,1,n)}resize(e){Tc(this,e,1)}clone(){return new sf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,_){rf(e,n,l,p,_,1)}}class Wa{constructor(e,n){_p(this,e,4,n)}resize(e){Tc(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,p,_){rf(e,n,l,p,_,4)}setPixel(e,n,l){const p=4*(e*this.width+n);this.data[p+0]=Math.round(255*l.r/l.a),this.data[p+1]=Math.round(255*l.g/l.a),this.data[p+2]=Math.round(255*l.b/l.a),this.data[p+3]=Math.round(255*l.a)}}function Ic(i){const e={},n=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new Wa({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const _=(b,T,R)=>{e[i.evaluationKey]=R;const B=i.expression.evaluate(e);p.setPixel(b/4/n,T/4,B)};if(i.clips)for(let b=0,T=0;b<l;++b,T+=4*n)for(let R=0,B=0;R<n;R++,B+=4){const G=R/(n-1),{start:X,end:$}=i.clips[b];_(T,B,X*(1-G)+$*G)}else for(let b=0,T=0;b<n;b++,T+=4)_(0,T,b/(n-1));return p}On("AlphaImage",sf),On("RGBAImage",Wa);const af="big-fb";class qg extends hs{createBucket(e){return new xp(e)}constructor(e,n){super(e,k0,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ic({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(af)&&this.heatmapFbos.delete(af)}queryRadius(e){return Jc("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,unwrappedTileID:T,getElevation:R}){return gp({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,l)*b,transform:_,unwrappedTileID:T,getElevation:R},p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let of;var lf={get paint(){return of=of||new Es({"hillshade-illumination-direction":new Bn(dt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Bn(dt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Bn(dt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bn(dt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bn(dt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bn(dt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bn(dt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Bn(dt.paint_hillshade["hillshade-method"])})}};class xs extends hs{constructor(e,n){super(e,lf,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const _=Math.max(e.length,n.length,l.length,p.length);e=e.concat(Array(_-e.length).fill(e.at(-1))),n=n.concat(Array(_-n.length).fill(n.at(-1))),l=l.concat(Array(_-l.length).fill(l.at(-1))),p=p.concat(Array(_-p.length).fill(p.at(-1)));const b=n.map(Di);return{directionRadians:e.map(Di),altitudeRadians:b,shadowColor:p,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Zg;var R1={get paint(){return Zg=Zg||new Es({"color-relief-opacity":new Bn(dt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new mh(dt["paint_color-relief"]["color-relief-color"])})}};class bp{constructor(e,n,l,p){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,p)}update(e,n,l){const{width:p,height:_}=e,b=!(this.size&&this.size[0]===p&&this.size[1]===_||l),{context:T}=this,{gl:R}=T;if(this.useMipmap=!!(n&&n.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!n||n.premultiply!==!1)),b)this.size=[p,_],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gn(e)?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,e):R.texImage2D(R.TEXTURE_2D,0,this.format,p,_,0,this.format,R.UNSIGNED_BYTE,e.data);else{const{x:B,y:G}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gn(e)?R.texSubImage2D(R.TEXTURE_2D,0,B,G,R.RGBA,R.UNSIGNED_BYTE,e):R.texSubImage2D(R.TEXTURE_2D,0,B,G,p,_,R.RGBA,R.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D),T.pixelStoreUnpackFlipY.setDefault(),T.pixelStoreUnpack.setDefault(),T.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,l){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),l!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=_.LINEAR),e!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,e),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class hd{constructor(e,n,l,p=1,_=1,b=1,T=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void si(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const R=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=_,this.blueFactor=b,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let B=0;B<R;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(R,B)]=this.data[this._idx(R-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,R)]=this.data[this._idx(B,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<R;B++)for(let G=0;G<R;G++){const X=this.get(B,G);X>this.max&&(this.max=X),X<this.min&&(this.min=X)}}get(e,n){const l=new Uint8Array(this.data.buffer),p=4*this._idx(e,n);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(e+1)}unpack(e,n,l){return e*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return eu(e,this.getUnpackVector())}getPixels(){return new Wa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=n*this.dim,_=n*this.dim+this.dim,b=l*this.dim,T=l*this.dim+this.dim;switch(n){case-1:p=_-1;break;case 1:_=p+1}switch(l){case-1:b=T-1;break;case 1:T=b+1}const R=-n*this.dim,B=-l*this.dim;for(let G=b;G<T;G++)for(let X=p;X<_;X++)this.data[this._idx(X,G)]=e.data[this._idx(X+R,G+B)]}}function eu(i,e){const n=e[0],l=e[1],p=e[2],_=e[3],b=Math.min(n,l,p),T=Math.round((i+_)/b);return{r:Math.floor(T*b/n)%256,g:Math.floor(T*b/l)%256,b:Math.floor(T*b/p)%256}}On("DEMData",hd);class Xg extends hs{constructor(e,n){super(e,R1,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof za&&l._styleExpression.expression instanceof ks){this.colorRampExpression=l;const b=l._styleExpression.expression;n.elevationStops=b.labels,n.colorStops=[];for(const T of n.elevationStops)n.colorStops.push(b.evaluate({globals:{elevation:T}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[Si.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const p={elevationStops:[],colorStops:[]},_=(n.elevationStops.length-1)/(e-1);for(let b=0;b<n.elevationStops.length-.5;b+=_)p.elevationStops.push(n.elevationStops[Math.round(b)]),p.colorStops.push(n.colorStops[Math.round(b)]);return si(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(n),_=new Wa({width:p.colorStops.length,height:1}),b=new Wa({width:p.colorStops.length,height:1});for(let T=0;T<p.elevationStops.length;T++){const R=eu(p.elevationStops[T],l);b.setPixel(0,T,new Si(R.r/255,R.g/255,R.b/255,1)),_.setPixel(0,T,p.colorStops[T])}return this.colorRampTextures={elevationTexture:new bp(e,b,e.gl.RGBA),colorTexture:new bp(e,_,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Wg=ss([{name:"a_pos",components:2,type:"Int16"}],4),{members:cf}=Wg;function Qo(i,e,n){const l=n.patternDependencies;let p=!1;for(const _ of e){const b=_.paint.get(`${i}-pattern`);b.isConstant()||(p=!0);const T=b.constantOr(null);T&&(p=!0,l[T.to]=!0,l[T.from]=!0)}return p}function vp(i,e,n,l,p){const{zoom:_}=l,b=p.patternDependencies;for(const T of e){const R=T.paint.get(`${i}-pattern`).value;if(R.kind!=="constant"){let B=R.evaluate({zoom:_-1},n,{},p.availableImages),G=R.evaluate({zoom:_},n,{},p.availableImages),X=R.evaluate({zoom:_+1},n,{},p.availableImages);B=B&&B.name?B.name:B,G=G&&G.name?G.name:G,X=X&&X.name?X.name:X,b[B]=!0,b[G]=!0,b[X]=!0,n.patterns[T.id]={min:B,mid:G,max:X}}}return n}function wp(i,e,n,l,p){let _;if(p===(function(b,T,R,B){let G=0;for(let X=T,$=R-B;X<R;X+=B)G+=(b[$]-b[X])*(b[X+1]+b[$+1]),$=X;return G})(i,e,n,l)>0)for(let b=e;b<n;b+=l)_=po(b/l|0,i[b],i[b+1],_);else for(let b=n-l;b>=e;b-=l)_=po(b/l|0,i[b],i[b+1],_);return _&&Ro(_,_.next)&&(go(_),_=_.next),_}function Ru(i,e){if(!i)return i;e||(e=i);let n,l=i;do if(n=!1,l.steiner||!Ro(l,l.next)&&gr(l.prev,l,l.next)!==0)l=l.next;else{if(go(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function Eh(i,e,n,l,p,_,b){if(!i)return;!b&&_&&(function(R,B,G,X){let $=R;do $.z===0&&($.z=sa($.x,$.y,B,G,X)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==R);$.prevZ.nextZ=null,$.prevZ=null,(function(Q){let ie,re=1;do{let ae,ye=Q;Q=null;let Be=null;for(ie=0;ye;){ie++;let be=ye,Ee=0;for(let Qe=0;Qe<re&&(Ee++,be=be.nextZ,be);Qe++);let Ge=re;for(;Ee>0||Ge>0&&be;)Ee!==0&&(Ge===0||!be||ye.z<=be.z)?(ae=ye,ye=ye.nextZ,Ee--):(ae=be,be=be.nextZ,Ge--),Be?Be.nextZ=ae:Q=ae,ae.prevZ=Be,Be=ae;ye=be}Be.nextZ=null,re*=2}while(ie>1)})($)})(i,l,p,_);let T=i;for(;i.prev!==i.next;){const R=i.prev,B=i.next;if(_?Ap(i,l,p,_):N0(i))e.push(R.i,i.i,B.i),go(i),i=B.next,T=B.next;else if((i=B)===T){b?b===1?Eh(i=Yg(Ru(i),e),e,n,l,p,_,2):b===2&&tu(i,e,n,l,p,_):Eh(Ru(i),e,n,l,p,_,1);break}}}function N0(i){const e=i.prev,n=i,l=i.next;if(gr(e,n,l)>=0)return!1;const p=e.x,_=n.x,b=l.x,T=e.y,R=n.y,B=l.y,G=Math.min(p,_,b),X=Math.min(T,R,B),$=Math.max(p,_,b),Q=Math.max(T,R,B);let ie=l.next;for(;ie!==e;){if(ie.x>=G&&ie.x<=$&&ie.y>=X&&ie.y<=Q&&dd(p,T,_,R,b,B,ie.x,ie.y)&&gr(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function Ap(i,e,n,l){const p=i.prev,_=i,b=i.next;if(gr(p,_,b)>=0)return!1;const T=p.x,R=_.x,B=b.x,G=p.y,X=_.y,$=b.y,Q=Math.min(T,R,B),ie=Math.min(G,X,$),re=Math.max(T,R,B),ae=Math.max(G,X,$),ye=sa(Q,ie,e,n,l),Be=sa(re,ae,e,n,l);let be=i.prevZ,Ee=i.nextZ;for(;be&&be.z>=ye&&Ee&&Ee.z<=Be;){if(be.x>=Q&&be.x<=re&&be.y>=ie&&be.y<=ae&&be!==p&&be!==b&&dd(T,G,R,X,B,$,be.x,be.y)&&gr(be.prev,be,be.next)>=0||(be=be.prevZ,Ee.x>=Q&&Ee.x<=re&&Ee.y>=ie&&Ee.y<=ae&&Ee!==p&&Ee!==b&&dd(T,G,R,X,B,$,Ee.x,Ee.y)&&gr(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;be&&be.z>=ye;){if(be.x>=Q&&be.x<=re&&be.y>=ie&&be.y<=ae&&be!==p&&be!==b&&dd(T,G,R,X,B,$,be.x,be.y)&&gr(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;Ee&&Ee.z<=Be;){if(Ee.x>=Q&&Ee.x<=re&&Ee.y>=ie&&Ee.y<=ae&&Ee!==p&&Ee!==b&&dd(T,G,R,X,B,$,Ee.x,Ee.y)&&gr(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function Yg(i,e){let n=i;do{const l=n.prev,p=n.next.next;!Ro(l,p)&&P0(l,n,n.next,p)&&df(l,p)&&df(p,l)&&(e.push(l.i,n.i,p.i),go(n),go(n.next),n=i=p),n=n.next}while(n!==i);return Ru(n)}function tu(i,e,n,l,p,_){let b=i;do{let T=b.next.next;for(;T!==b.prev;){if(b.i!==T.i&&Ss(b,T)){let R=ff(b,T);return b=Ru(b,b.next),R=Ru(R,R.next),Eh(b,e,n,l,p,_,0),void Eh(R,e,n,l,p,_,0)}T=T.next}b=b.next}while(b!==i)}function ra(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function D0(i,e){const n=(function(p,_){let b=_;const T=p.x,R=p.y;let B,G=-1/0;if(Ro(p,b))return b;do{if(Ro(p,b.next))return b.next;if(R<=b.y&&R>=b.next.y&&b.next.y!==b.y){const re=b.x+(R-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(re<=T&&re>G&&(G=re,B=b.x<b.next.x?b:b.next,re===T))return B}b=b.next}while(b!==_);if(!B)return null;const X=B,$=B.x,Q=B.y;let ie=1/0;b=B;do{if(T>=b.x&&b.x>=$&&T!==b.x&&R0(R<Q?T:G,R,$,Q,R<Q?G:T,R,b.x,b.y)){const re=Math.abs(R-b.y)/(T-b.x);df(b,p)&&(re<ie||re===ie&&(b.x>B.x||b.x===B.x&&$g(B,b)))&&(B=b,ie=re)}b=b.next}while(b!==X);return B})(i,e);if(!n)return e;const l=ff(n,i);return Ru(l,l.next),Ru(n,n.next)}function $g(i,e){return gr(i.prev,i,e.prev)<0&&gr(e.next,i,i.next)<0}function sa(i,e,n,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function P1(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function R0(i,e,n,l,p,_,b,T){return(p-b)*(e-T)>=(i-b)*(_-T)&&(i-b)*(l-T)>=(n-b)*(e-T)&&(n-b)*(_-T)>=(p-b)*(l-T)}function dd(i,e,n,l,p,_,b,T){return!(i===b&&e===T)&&R0(i,e,n,l,p,_,b,T)}function Ss(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,l){let p=n;do{if(p.i!==n.i&&p.next.i!==n.i&&p.i!==l.i&&p.next.i!==l.i&&P0(p,p.next,n,l))return!0;p=p.next}while(p!==n);return!1})(i,e)&&(df(i,e)&&df(e,i)&&(function(n,l){let p=n,_=!1;const b=(n.x+l.x)/2,T=(n.y+l.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&b<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==n);return _})(i,e)&&(gr(i.prev,i,e.prev)||gr(i,e.prev,e))||Ro(i,e)&&gr(i.prev,i,i.next)>0&&gr(e.prev,e,e.next)>0)}function gr(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Ro(i,e){return i.x===e.x&&i.y===e.y}function P0(i,e,n,l){const p=hf(gr(i,e,n)),_=hf(gr(i,e,l)),b=hf(gr(n,l,i)),T=hf(gr(n,l,e));return p!==_&&b!==T||!(p!==0||!uf(i,n,e))||!(_!==0||!uf(i,l,e))||!(b!==0||!uf(n,i,l))||!(T!==0||!uf(n,e,l))}function uf(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function hf(i){return i>0?1:i<0?-1:0}function df(i,e){return gr(i.prev,i,i.next)<0?gr(i,e,i.next)>=0&&gr(i,i.prev,e)>=0:gr(i,e,i.prev)<0||gr(i,i.next,e)<0}function ff(i,e){const n=Ep(i.i,i.x,i.y),l=Ep(e.i,e.x,e.y),p=i.next,_=e.prev;return i.next=e,e.prev=i,n.next=p,p.prev=n,l.next=n,n.prev=l,_.next=l,l.prev=_,l}function po(i,e,n,l){const p=Ep(i,e,n);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function go(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ep(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class xa{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class pf{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}pf.noSubdivision=new pf({fill:new xa(0,0),line:new xa(0,0),tile:new xa(0,0),stencil:new xa(0,0),circle:1}),On("SubdivisionGranularityExpression",xa),On("SubdivisionGranularitySetting",pf);const Po=-32768,nc=32767;class nu{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Tt/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),p=0|Math.round(n),_=this._getKey(l,p);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,b),this._vertexBuffer.push(l,p),b}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(p,_){const b=[];for(let T=0;T<_.length;T+=3){const R=_[T],B=_[T+1],G=_[T+2],X=p[2*R],$=p[2*R+1];(p[2*B]-X)*(p[2*G+1]-$)-(p[2*B+1]-$)*(p[2*G]-X)>0?(b.push(R),b.push(G),b.push(B)):(b.push(R),b.push(B),b.push(G))}return b})(this._vertexBuffer,e);const n=[],l=e.length;for(let p=0;p<l;p+=3){const _=[e[p+0],e[p+1],e[p+2]],b=[this._vertexBuffer[2*e[p+0]+0],this._vertexBuffer[2*e[p+0]+1],this._vertexBuffer[2*e[p+1]+0],this._vertexBuffer[2*e[p+1]+1],this._vertexBuffer[2*e[p+2]+0],this._vertexBuffer[2*e[p+2]+1]];let T=1/0,R=1/0,B=-1/0,G=-1/0;for(let re=0;re<3;re++){const ae=b[2*re],ye=b[2*re+1];T=Math.min(T,ae),B=Math.max(B,ae),R=Math.min(R,ye),G=Math.max(G,ye)}if(T===B||R===G)continue;const X=Math.floor(T/this._granularityCellSize),$=Math.ceil(B/this._granularityCellSize),Q=Math.floor(R/this._granularityCellSize),ie=Math.ceil(G/this._granularityCellSize);if(X!==$||Q!==ie)for(let re=Q;re<ie;re++){const ae=this._scanlineGenerateVertexRingForCellRow(re,b,_);ic(this._vertexBuffer,ae,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(e,n,l){const p=e*this._granularityCellSize,_=p+this._granularityCellSize,b=[];for(let T=0;T<3;T++){const R=n[2*T],B=n[2*T+1],G=n[2*(T+1)%6],X=n[(2*(T+1)+1)%6],$=n[2*(T+2)%6],Q=n[(2*(T+2)+1)%6],ie=G-R,re=X-B,ae=ie===0,ye=re===0,Be=(p-B)/re,be=(_-B)/re,Ee=Math.min(Be,be),Ge=Math.max(Be,be);if(!ye&&(Ee>=1||Ge<=0)||ye&&(B<p||B>_)){X>=p&&X<=_&&b.push(l[(T+1)%3]);continue}!ye&&Ee>0&&b.push(this._vertexToIndex(R+ie*Ee,B+re*Ee));const Qe=R+ie*Math.max(Ee,0),Dt=R+ie*Math.min(Ge,1);ae||this._generateIntraEdgeVertices(b,R,B,G,X,Qe,Dt),!ye&&Ge<1&&b.push(this._vertexToIndex(R+ie*Ge,B+re*Ge)),(ye||X>=p&&X<=_)&&b.push(l[(T+1)%3]),!ye&&(X<=p||X>=_)&&this._generateInterEdgeVertices(b,R,B,G,X,$,Q,Dt,p,_)}return b}_generateIntraEdgeVertices(e,n,l,p,_,b,T){const R=p-n,B=_-l,G=B===0,X=G?Math.min(n,p):Math.min(b,T),$=G?Math.max(n,p):Math.max(b,T),Q=Math.floor(X/this._granularityCellSize)+1,ie=Math.ceil($/this._granularityCellSize)-1;if(G?n<p:b<T)for(let re=Q;re<=ie;re++){const ae=re*this._granularityCellSize;e.push(this._vertexToIndex(ae,l+B*(ae-n)/R))}else for(let re=ie;re>=Q;re--){const ae=re*this._granularityCellSize;e.push(this._vertexToIndex(ae,l+B*(ae-n)/R))}}_generateInterEdgeVertices(e,n,l,p,_,b,T,R,B,G){const X=_-l,$=b-p,Q=T-_,ie=(B-_)/Q,re=(G-_)/Q,ae=Math.min(ie,re),ye=Math.max(ie,re),Be=p+$*ae;let be=Math.floor(Math.min(Be,R)/this._granularityCellSize)+1,Ee=Math.ceil(Math.max(Be,R)/this._granularityCellSize)-1,Ge=R<Be;const Qe=Q===0;if(Qe&&(T===B||T===G))return;if(Qe||ae>=1||ye<=0){const en=l-T,Xt=b+(n-b)*Math.min((B-T)/en,(G-T)/en);be=Math.floor(Math.min(Xt,R)/this._granularityCellSize)+1,Ee=Math.ceil(Math.max(Xt,R)/this._granularityCellSize)-1,Ge=R<Xt}const Dt=X>0?G:B;if(Ge)for(let en=be;en<=Ee;en++)e.push(this._vertexToIndex(en*this._granularityCellSize,Dt));else for(let en=Ee;en>=be;en--)e.push(this._vertexToIndex(en*this._granularityCellSize,Dt))}_generateOutline(e){const n=[];for(const l of e){const p=iu(l,this._granularity,!0),_=this._pointArrayToIndices(p),b=[];for(let T=1;T<_.length;T++)b.push(_[T-1]),b.push(_[T]);n.push(b)}return n}_handlePoles(e){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(e,n,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const l=e[n+1];l===Po&&(e[n+1]=-32767),l===nc&&(e[n+1]=32766)}}_generatePoleQuad(e,n,l,p,_,b){p>_!=(b===Po)?(e.push(n),e.push(l),e.push(this._vertexToIndex(p,b)),e.push(l),e.push(this._vertexToIndex(_,b)),e.push(this._vertexToIndex(p,b))):(e.push(l),e.push(n),e.push(this._vertexToIndex(p,b)),e.push(this._vertexToIndex(_,b)),e.push(l),e.push(this._vertexToIndex(p,b)))}_fillPoles(e,n,l){const p=this._vertexBuffer,_=Tt,b=e.length;for(let T=2;T<b;T+=3){const R=e[T-2],B=e[T-1],G=e[T],X=p[2*R],$=p[2*R+1],Q=p[2*B],ie=p[2*B+1],re=p[2*G],ae=p[2*G+1];n&&($===0&&ie===0&&this._generatePoleQuad(e,R,B,X,Q,Po),ie===0&&ae===0&&this._generatePoleQuad(e,B,G,Q,re,Po),ae===0&&$===0&&this._generatePoleQuad(e,G,R,re,X,Po)),l&&($===_&&ie===_&&this._generatePoleQuad(e,R,B,X,Q,nc),ie===_&&ae===_&&this._generatePoleQuad(e,B,G,Q,re,nc),ae===_&&$===_&&this._generatePoleQuad(e,G,R,re,X,nc))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:p}=(function(T){const R=[],B=[];for(const G of T)if(G.length!==0){G!==T[0]&&R.push(B.length/2);for(let X=0;X<G.length;X++)B.push(G[X].x),B.push(G[X].y)}return{flattened:B,holeIndices:R}})(e);let _;this._initializeVertices(l);try{const T=(function(B,G,X=2){const $=G&&G.length,Q=$?G[0]*X:B.length;let ie=wp(B,0,Q,X,!0);const re=[];if(!ie||ie.next===ie.prev)return re;let ae,ye,Be;if($&&(ie=(function(be,Ee,Ge,Qe){const Dt=[];for(let en=0,Xt=Ee.length;en<Xt;en++){const hn=wp(be,Ee[en]*Qe,en<Xt-1?Ee[en+1]*Qe:be.length,Qe,!1);hn===hn.next&&(hn.steiner=!0),Dt.push(P1(hn))}Dt.sort(ra);for(let en=0;en<Dt.length;en++)Ge=D0(Dt[en],Ge);return Ge})(B,G,ie,X)),B.length>80*X){ae=B[0],ye=B[1];let be=ae,Ee=ye;for(let Ge=X;Ge<Q;Ge+=X){const Qe=B[Ge],Dt=B[Ge+1];Qe<ae&&(ae=Qe),Dt<ye&&(ye=Dt),Qe>be&&(be=Qe),Dt>Ee&&(Ee=Dt)}Be=Math.max(be-ae,Ee-ye),Be=Be!==0?32767/Be:0}return Eh(ie,re,X,ae,ye,Be,0),re})(l,p),R=this._convertIndices(l,T);_=this._subdivideTrianglesScanline(R)}catch(T){console.error(T)}let b=[];return n&&(b=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:b}}_convertIndices(e,n){const l=[];for(let p=0;p<n.length;p++)l.push(this._vertexToIndex(e[2*n[p]],e[2*n[p]+1]));return l}_pointArrayToIndices(e){const n=[];for(let l=0;l<e.length;l++){const p=e[l];n.push(this._vertexToIndex(p.x,p.y))}return n}}function Sp(i,e,n,l=!0){return new nu(n,e).subdividePolygonInternal(i,l)}function iu(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],p=i[i.length-1],_=n&&(l.x!==p.x||l.y!==p.y);if(e<2)return _?[...i,i[0]]:[...i];const b=Math.floor(Tt/e),T=[];T.push(new U(i[0].x,i[0].y));const R=i.length,B=_?R:R-1;for(let G=0;G<B;G++){const X=i[G],$=G<R-1?i[G+1]:i[0],Q=X.x,ie=X.y,re=$.x,ae=$.y,ye=Q!==re,Be=ie!==ae;if(!ye&&!Be)continue;const be=re-Q,Ee=ae-ie,Ge=Math.abs(be),Qe=Math.abs(Ee);let Dt=Q,en=ie;for(;;){const hn=be>0?(Math.floor(Dt/b)+1)*b:(Math.ceil(Dt/b)-1)*b,In=Ee>0?(Math.floor(en/b)+1)*b:(Math.ceil(en/b)-1)*b,fn=Math.abs(Dt-hn),Kt=Math.abs(en-In),Ut=Math.abs(Dt-re),Vn=Math.abs(en-ae),zn=ye?fn/Ge:Number.POSITIVE_INFINITY,Wn=Be?Kt/Qe:Number.POSITIVE_INFINITY;if((Ut<=fn||!ye)&&(Vn<=Kt||!Be))break;if(zn<Wn&&ye||!Be){Dt=hn,en+=Ee*zn;const Pn=new U(Dt,Math.round(en));T[T.length-1].x===Pn.x&&T[T.length-1].y===Pn.y||T.push(Pn)}else{Dt+=be*Wn,en=In;const Pn=new U(Math.round(Dt),en);T[T.length-1].x===Pn.x&&T[T.length-1].y===Pn.y||T.push(Pn)}}const Xt=new U(re,ae);T[T.length-1].x===Xt.x&&T[T.length-1].y===Xt.y||T.push(Xt)}return T}function ic(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,p=i[2*e[0]];for(let R=1;R<e.length;R++){const B=i[2*e[R]];B<p&&(p=B,l=R)}const _=e.length;let b=l,T=(b+1)%_;for(;;){const R=b-1>=0?b-1:_-1,B=(T+1)%_,G=i[2*e[R]],X=i[2*e[B]],$=i[2*e[b]],Q=i[2*e[b]+1],ie=i[2*e[T]+1];let re=!1;if(G<X)re=!0;else if(G>X)re=!1;else{const ae=ie-Q,ye=-(i[2*e[T]]-$),Be=Q<ie?1:-1;((G-$)*ae+(i[2*e[R]+1]-Q)*ye)*Be>((X-$)*ae+(i[2*e[B]+1]-Q)*ye)*Be&&(re=!0)}if(re){const ae=e[R],ye=e[b],Be=e[T];ae!==ye&&ae!==Be&&ye!==Be&&n.push(Be,ye,ae),b--,b<0&&(b=_-1)}else{const ae=e[B],ye=e[b],Be=e[T];ae!==ye&&ae!==Be&&ye!==Be&&n.push(Be,ye,ae),T++,T>=_&&(T=0)}if(R===B)break}}function O0(i,e,n,l,p,_,b,T,R){const B=p.length/2,G=b&&T&&R;if(B<Tn.MAX_VERTEX_ARRAY_LENGTH){const X=e.prepareSegment(B,n,l),$=X.vertexLength;for(let re=0;re<_.length;re+=3)l.emplaceBack($+_[re],$+_[re+1],$+_[re+2]);let Q,ie;X.vertexLength+=B,X.primitiveLength+=_.length/3,G&&(ie=b.prepareSegment(B,n,T),Q=ie.vertexLength,ie.vertexLength+=B);for(let re=0;re<p.length;re+=2)i(p[re],p[re+1]);if(G)for(let re=0;re<R.length;re++){const ae=R[re];for(let ye=1;ye<ae.length;ye+=2)T.emplaceBack(Q+ae[ye-1],Q+ae[ye]);ie.primitiveLength+=ae.length/2}}else(function(X,$,Q,ie,re,ae){const ye=[];for(let Qe=0;Qe<ie.length/2;Qe++)ye.push(-1);const Be={count:0};let be=0,Ee=X.getOrCreateLatestSegment($,Q),Ge=Ee.vertexLength;for(let Qe=2;Qe<re.length;Qe+=3){const Dt=re[Qe-2],en=re[Qe-1],Xt=re[Qe];let hn=ye[Dt]<be,In=ye[en]<be,fn=ye[Xt]<be;Ee.vertexLength+((hn?1:0)+(In?1:0)+(fn?1:0))>Tn.MAX_VERTEX_ARRAY_LENGTH&&(Ee=X.createNewSegment($,Q),be=Be.count,hn=!0,In=!0,fn=!0,Ge=0);const Kt=Mc(ye,ie,ae,Be,Dt,hn,Ee),Ut=Mc(ye,ie,ae,Be,en,In,Ee),Vn=Mc(ye,ie,ae,Be,Xt,fn,Ee);Q.emplaceBack(Ge+Kt-be,Ge+Ut-be,Ge+Vn-be),Ee.primitiveLength++}})(e,n,l,p,_,i),G&&(function(X,$,Q,ie,re,ae){const ye=[];for(let Qe=0;Qe<ie.length/2;Qe++)ye.push(-1);const Be={count:0};let be=0,Ee=X.getOrCreateLatestSegment($,Q),Ge=Ee.vertexLength;for(let Qe=0;Qe<re.length;Qe++){const Dt=re[Qe];for(let en=1;en<re[Qe].length;en+=2){const Xt=Dt[en-1],hn=Dt[en];let In=ye[Xt]<be,fn=ye[hn]<be;Ee.vertexLength+((In?1:0)+(fn?1:0))>Tn.MAX_VERTEX_ARRAY_LENGTH&&(Ee=X.createNewSegment($,Q),be=Be.count,In=!0,fn=!0,Ge=0);const Kt=Mc(ye,ie,ae,Be,Xt,In,Ee),Ut=Mc(ye,ie,ae,Be,hn,fn,Ee);Q.emplaceBack(Ge+Kt-be,Ge+Ut-be),Ee.primitiveLength++}}})(b,n,T,p,R,i),e.forceNewSegmentOnNextPrepare(),b?.forceNewSegmentOnNextPrepare()}function Mc(i,e,n,l,p,_,b){if(_){const T=l.count;return n(e[2*p],e[2*p+1]),i[p]=l.count,l.count++,b.vertexLength++,T}return i[p]}class Sh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Ie,this.indexArray=new zt,this.indexArray2=new xn,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new Tn,this.segments2=new Tn,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Qo("fill",this.layers,n);const p=this.layers[0].layout.get("fill-sort-key"),_=!p.isConstant(),b=[];for(const{feature:T,id:R,index:B,sourceLayerIndex:G}of e){const X=this.layers[0]._featureFilter.needGeometry,$=Ko(T,X);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),$,l))continue;const Q=_?p.evaluate($,{},l,n.availableImages):void 0,ie={id:R,properties:T.properties,type:T.type,sourceLayerIndex:G,index:B,geometry:X?$.geometry:tc(T),patterns:{},sortKey:Q};b.push(ie)}_&&b.sort(((T,R)=>T.sortKey-R.sortKey));for(const T of b){const{geometry:R,index:B,sourceLayerIndex:G}=T;if(this.hasDependencies){const X=vp("fill",this.layers,T,{zoom:this.zoom},n);this.patternFeatures.push(X)}else this.addFeature(T,R,B,l,{},n.subdivisionGranularity);n.featureIndex.insert(e[B].feature,R,B,G,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,n,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,p,_,b){for(const T of hl(n,500)){const R=Sp(T,p,b.fill.getGranularityForZoomLevel(p.z)),B=this.layoutVertexArray;O0(((G,X)=>{B.emplaceBack(G,X)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles,this.segments2,this.indexArray2,R.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,canonical:p})}}let fd,Ch;On("FillBucket",Sh,{omit:["layers","patternFeatures"]});var Kg={get paint(){return Ch=Ch||new Es({"fill-antialias":new Bn(dt.paint_fill["fill-antialias"]),"fill-opacity":new ei(dt.paint_fill["fill-opacity"]),"fill-color":new ei(dt.paint_fill["fill-color"]),"fill-outline-color":new ei(dt.paint_fill["fill-outline-color"]),"fill-translate":new Bn(dt.paint_fill["fill-translate"]),"fill-translate-anchor":new Bn(dt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mo(dt.paint_fill["fill-pattern"])})},get layout(){return fd=fd||new Es({"fill-sort-key":new ei(dt.layout_fill["fill-sort-key"])})}};class Qg extends hs{constructor(e,n){super(e,Kg,n)}recalculate(e,n){super.recalculate(e,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Sh(e)}queryRadius(){return tf(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:l,pixelsToTileUnits:p}){return hp(fp(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,p),n)}isTileClipped(){return!0}}const gf=ss([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jg=ss([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Cp}=gf;class pd{constructor(e,n,l,p,_){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=p,this._values=_,e.readFields(O1,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let p,_=1,b=0,T=0,R=0;for(;e.pos<n;){if(b<=0){const B=e.readVarint();_=7&B,b=B>>3}if(b--,_===1||_===2)T+=e.readSVarint(),R+=e.readSVarint(),_===1&&(p&&l.push(p),p=[]),p&&p.push(new U(T,R));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&l.push(p),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,p=0,_=0,b=0,T=1/0,R=-1/0,B=1/0,G=-1/0;for(;e.pos<n;){if(p<=0){const X=e.readVarint();l=7&X,p=X>>3}if(p--,l===1||l===2)_+=e.readSVarint(),b+=e.readSVarint(),_<T&&(T=_),_>R&&(R=_),b<B&&(B=b),b>G&&(G=b);else if(l!==7)throw new Error(`unknown command ${l}`)}return[T,B,R,G]}toGeoJSON(e,n,l){const p=this.extent*Math.pow(2,l),_=this.extent*e,b=this.extent*n,T=this.loadGeometry();function R($){return[360*($.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*($.y+b)/p)*Math.PI))-90]}function B($){return $.map(R)}let G;if(this.type===1){const $=[];for(const ie of T)$.push(ie[0]);const Q=B($);G=$.length===1?{type:"Point",coordinates:Q[0]}:{type:"MultiPoint",coordinates:Q}}else if(this.type===2){const $=T.map(B);G=$.length===1?{type:"LineString",coordinates:$[0]}:{type:"MultiLineString",coordinates:$}}else{if(this.type!==3)throw new Error("unknown feature type");{const $=em(T),Q=[];for(const ie of $)Q.push(ie.map(B));G=Q.length===1?{type:"Polygon",coordinates:Q[0]}:{type:"MultiPolygon",coordinates:Q}}}const X={type:"Feature",geometry:G,properties:this.properties};return this.id!=null&&(X.id=this.id),X}}function O1(i,e,n){i===1?e.id=n.readVarint():i===2?(function(l,p){const _=l.readVarint()+l.pos;for(;l.pos<_;){const b=p._keys[l.readVarint()],T=p._values[l.readVarint()];p.properties[b]=T}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function em(i){const e=i.length;if(e<=1)return[i];const n=[];let l,p;for(let _=0;_<e;_++){const b=Vr(i[_]);b!==0&&(p===void 0&&(p=b<0),p===b<0?(l&&n.push(l),l=[i[_]]):l&&l.push(i[_]))}return l&&n.push(l),n}function Vr(i){let e=0;for(let n,l,p=0,_=i.length,b=_-1;p<_;b=p++)n=i[p],l=i[b],e+=(l.x-n.x)*(n.y+l.y);return e}pd.types=["Unknown","Point","LineString","Polygon"];class os{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(dr,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new pd(this._pbf,n,this.extent,this._keys,this._values)}}function dr(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(l){let p=null;const _=l.readVarint()+l.pos;for(;l.pos<_;){const b=l.readVarint()>>3;p=b===1?l.readString():b===2?l.readFloat():b===3?l.readDouble():b===4?l.readVarint64():b===5?l.readVarint():b===6?l.readSVarint():b===7?l.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p})(n))}class fr{constructor(e,n){this.layers=e.readFields(Zr,{},n)}}function Zr(i,e,n){if(i===3){const l=new os(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const mo=Math.pow(2,13);function Ml(i,e,n,l,p,_,b,T){i.emplaceBack(e,n,2*Math.floor(l*mo)+b,p*mo*2,_*mo*2,Math.round(T))}class Pu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Le,this.centroidVertexArray=new Ce,this.indexArray=new zt,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new Tn,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.features=[],this.hasDependencies=Qo("fill-extrusion",this.layers,n);for(const{feature:p,id:_,index:b,sourceLayerIndex:T}of e){const R=this.layers[0]._featureFilter.needGeometry,B=Ko(p,R);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),B,l))continue;const G={id:_,sourceLayerIndex:T,index:b,geometry:R?B.geometry:tc(p),properties:p.properties,type:p.type,patterns:{}};this.hasDependencies?this.features.push(vp("fill-extrusion",this.layers,G,{zoom:this.zoom},n)):this.addFeature(G,G.geometry,b,l,{},n.subdivisionGranularity),n.featureIndex.insert(p,G.geometry,b,T,this.index,!0)}}addFeatures(e,n,l){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,n,l,e.subdivisionGranularity)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Jg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,l,p,_,b){for(const T of hl(n,500)){const R={x:0,y:0,sampleCount:0},B=this.layoutVertexArray.length;this.processPolygon(R,p,e,T,b);const G=this.layoutVertexArray.length-B,X=Math.floor(R.x/R.sampleCount),$=Math.floor(R.y/R.sampleCount);for(let Q=0;Q<G;Q++)this.centroidVertexArray.emplaceBack(X,$)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,canonical:p})}processPolygon(e,n,l,p,_){if(p.length<1||Rs(p[0]))return;for(const X of p)X.length!==0&&z0(e,X);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},T=_.fill.getGranularityForZoomLevel(n.z),R=pd.types[l.type]==="Polygon";for(const X of p){if(X.length===0||Rs(X))continue;const $=iu(X,T,R);this._generateSideFaces($,b)}if(!R)return;const B=Sp(p,n,T,!1),G=this.layoutVertexArray;O0(((X,$)=>{Ml(G,X,$,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,B.verticesFlattened,B.indicesTriangles)}_generateSideFaces(e,n){let l=0;for(let p=1;p<e.length;p++){const _=e[p],b=e[p-1];if(ru(_,b))continue;n.segment.vertexLength+4>Tn.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const T=_.sub(b)._perp()._unit(),R=b.dist(_);l+R>32768&&(l=0),Ml(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,0,l),Ml(this.layoutVertexArray,_.x,_.y,T.x,T.y,0,1,l),l+=R,Ml(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,0,l),Ml(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,1,l);const B=n.segment.vertexLength;this.indexArray.emplaceBack(B,B+2,B+1),this.indexArray.emplaceBack(B+1,B+2,B+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function z0(i,e){for(let n=0;n<e.length;n++){const l=e[n];n===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function ru(i,e){return i.x===e.x&&(i.x<0||i.x>Tt)||i.y===e.y&&(i.y<0||i.y>Tt)}function Rs(i){return i.every((e=>e.x<0))||i.every((e=>e.x>Tt))||i.every((e=>e.y<0))||i.every((e=>e.y>Tt))}let su;On("FillExtrusionBucket",Pu,{omit:["layers","features"]});var Th={get paint(){return su=su||new Es({"fill-extrusion-opacity":new Bn(dt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ei(dt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bn(dt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bn(dt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mo(dt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ei(dt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ei(dt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bn(dt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class L0 extends hs{constructor(e,n){super(e,Th,n)}createBucket(e){return new Pu(e)}queryRadius(){return tf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b,pixelPosMatrix:T}){const R=fp(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,b),B=this.paint.get("fill-extrusion-height").evaluate(n,l),G=this.paint.get("fill-extrusion-base").evaluate(n,l),X=(function(Q,ie){const re=[];for(const ae of Q){const ye=[ae.x,ae.y,0,1];qt(ye,ye,ie),re.push(new U(ye[0]/ye[3],ye[1]/ye[3]))}return re})(R,T),$=(function(Q,ie,re,ae){const ye=[],Be=[],be=ae[8]*ie,Ee=ae[9]*ie,Ge=ae[10]*ie,Qe=ae[11]*ie,Dt=ae[8]*re,en=ae[9]*re,Xt=ae[10]*re,hn=ae[11]*re;for(const In of Q){const fn=[],Kt=[];for(const Ut of In){const Vn=Ut.x,zn=Ut.y,Wn=ae[0]*Vn+ae[4]*zn+ae[12],Pn=ae[1]*Vn+ae[5]*zn+ae[13],hi=ae[2]*Vn+ae[6]*zn+ae[14],mr=ae[3]*Vn+ae[7]*zn+ae[15],er=hi+Ge,_s=mr+Qe,Qa=Wn+Dt,ca=Pn+en,bs=hi+Xt,fs=mr+hn,Lr=new U((Wn+be)/_s,(Pn+Ee)/_s);Lr.z=er/_s,fn.push(Lr);const Ps=new U(Qa/fs,ca/fs);Ps.z=bs/fs,Kt.push(Ps)}ye.push(fn),Be.push(Kt)}return[ye,Be]})(p,G,B,T);return(function(Q,ie,re){let ae=1/0;hp(re,ie)&&(ae=Ih(re,ie[0]));for(let ye=0;ye<ie.length;ye++){const Be=ie[ye],be=Q[ye];for(let Ee=0;Ee<Be.length-1;Ee++){const Ge=Be[Ee],Qe=[Ge,Be[Ee+1],be[Ee+1],be[Ee],Ge];Ah(re,Qe)&&(ae=Math.min(ae,Ih(re,Qe)))}}return ae!==1/0&&ae})($[0],$[1],X)}}function La(i,e){return i.x*e.x+i.y*e.y}function Ih(i,e){if(i.length===1){let n=0;const l=e[n++];let p;for(;!p||l.equals(p);)if(p=e[n++],!p)return 1/0;for(;n<e.length;n++){const _=e[n],b=i[0],T=p.sub(l),R=_.sub(l),B=b.sub(l),G=La(T,T),X=La(T,R),$=La(R,R),Q=La(B,T),ie=La(B,R),re=G*$-X*X,ae=($*Q-X*ie)/re,ye=(G*ie-X*Q)/re,Be=l.z*(1-ae-ye)+p.z*ae+_.z*ye;if(isFinite(Be))return Be}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}const mf=ss([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Oo}=mf,B0=ss([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Tp}=B0,tm=Math.cos(Math.PI/180*37.5),yf=Math.pow(2,14)/.5;class gd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new $e,this.layoutVertexArray2=new ze,this.indexArray=new zt,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new Tn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Qo("line",this.layers,n)||this.hasLineDasharray(this.layers);const p=this.layers[0].layout.get("line-sort-key"),_=!p.isConstant(),b=[];for(const{feature:T,id:R,index:B,sourceLayerIndex:G}of e){const X=this.layers[0]._featureFilter.needGeometry,$=Ko(T,X);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),$,l))continue;const Q=_?p.evaluate($,{},l):void 0,ie={id:R,properties:T.properties,type:T.type,sourceLayerIndex:G,index:B,geometry:X?$.geometry:tc(T),patterns:{},dashes:{},sortKey:Q};b.push(ie)}_&&b.sort(((T,R)=>T.sortKey-R.sortKey));for(const T of b){const{geometry:R,index:B,sourceLayerIndex:G}=T;this.hasDependencies?(Qo("line",this.layers,n)?vp("line",this.layers,T,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,T,this.zoom,n),this.patternFeatures.push(T)):this.addFeature(T,R,B,l,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[B].feature,R,B,G,this.index)}}update(e,n,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l,dashPositions:p})}addFeatures(e,n,l,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,l,p,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Tp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oo),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,p,_,b,T){const R=this.layers[0].layout,B=R.get("line-join").evaluate(e,{}),G=R.get("line-cap"),X=R.get("line-miter-limit"),$=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const Q of n)this.addLine(Q,e,B,G,X,$,p,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:_,dashPositions:b,canonical:p})}addLine(e,n,l,p,_,b,T,R){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=iu(e,T?R.line.getGranularityForZoomLevel(T.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<e.length-1;be++)this.totalDistance+=e[be].dist(e[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const B=pd.types[n.type]==="Polygon";let G=e.length;for(;G>=2&&e[G-1].equals(e[G-2]);)G--;let X=0;for(;X<G-1&&e[X].equals(e[X+1]);)X++;if(G<(B?3:2))return;l==="bevel"&&(_=1.05);const $=this.overscaling<=16?122880/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray);let ie,re,ae,ye,Be;this.e1=this.e2=-1,B&&(ie=e[G-2],Be=e[X].sub(ie)._unit()._perp());for(let be=X;be<G;be++){if(ae=be===G-1?B?e[X+1]:void 0:e[be+1],ae&&e[be].equals(ae))continue;Be&&(ye=Be),ie&&(re=ie),ie=e[be],Be=ae?ae.sub(ie)._unit()._perp():ye,ye=ye||Be;let Ee=ye.add(Be);Ee.x===0&&Ee.y===0||Ee._unit();const Ge=ye.x*Be.x+ye.y*Be.y,Qe=Ee.x*Be.x+Ee.y*Be.y,Dt=Qe!==0?1/Qe:1/0,en=2*Math.sqrt(2-2*Qe),Xt=Qe<tm&&re&&ae,hn=ye.x*Be.y-ye.y*Be.x>0;if(Xt&&be>X){const Kt=ie.dist(re);if(Kt>2*$){const Ut=ie.sub(ie.sub(re)._mult($/Kt)._round());this.updateDistance(re,Ut),this.addCurrentVertex(Ut,ye,0,0,Q),re=Ut}}const In=re&&ae;let fn=In?l:B?"butt":p;if(In&&fn==="round"&&(Dt<b?fn="miter":Dt<=2&&(fn="fakeround")),fn==="miter"&&Dt>_&&(fn="bevel"),fn==="bevel"&&(Dt>2&&(fn="flipbevel"),Dt<_&&(fn="miter")),re&&this.updateDistance(re,ie),fn==="miter")Ee._mult(Dt),this.addCurrentVertex(ie,Ee,0,0,Q);else if(fn==="flipbevel"){if(Dt>100)Ee=Be.mult(-1);else{const Kt=Dt*ye.add(Be).mag()/ye.sub(Be).mag();Ee._perp()._mult(Kt*(hn?-1:1))}this.addCurrentVertex(ie,Ee,0,0,Q),this.addCurrentVertex(ie,Ee.mult(-1),0,0,Q)}else if(fn==="bevel"||fn==="fakeround"){const Kt=-Math.sqrt(Dt*Dt-1),Ut=hn?Kt:0,Vn=hn?0:Kt;if(re&&this.addCurrentVertex(ie,ye,Ut,Vn,Q),fn==="fakeround"){const zn=Math.round(180*en/Math.PI/20);for(let Wn=1;Wn<zn;Wn++){let Pn=Wn/zn;if(Pn!==.5){const mr=Pn-.5;Pn+=Pn*mr*(Pn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*mr*mr+(.848013+Ge*(.215638*Ge-1.06021)))}const hi=Be.sub(ye)._mult(Pn)._add(ye)._unit()._mult(hn?-1:1);this.addHalfVertex(ie,hi.x,hi.y,!1,hn,0,Q)}}ae&&this.addCurrentVertex(ie,Be,-Ut,-Vn,Q)}else if(fn==="butt")this.addCurrentVertex(ie,Ee,0,0,Q);else if(fn==="square"){const Kt=re?1:-1;this.addCurrentVertex(ie,Ee,Kt,Kt,Q)}else fn==="round"&&(re&&(this.addCurrentVertex(ie,ye,0,0,Q),this.addCurrentVertex(ie,ye,1,1,Q,!0)),ae&&(this.addCurrentVertex(ie,Be,-1,-1,Q,!0),this.addCurrentVertex(ie,Be,0,0,Q)));if(Xt&&be<G-1){const Kt=ie.dist(ae);if(Kt>2*$){const Ut=ie.add(ae.sub(ie)._mult($/Kt)._round());this.updateDistance(ie,Ut),this.addCurrentVertex(Ut,Be,0,0,Q),ie=Ut}}}}addCurrentVertex(e,n,l,p,_,b=!1){const T=n.y*p-n.x,R=-n.y-n.x*p;this.addHalfVertex(e,n.x+n.y*l,n.y-n.x*l,b,!1,l,_),this.addHalfVertex(e,T,R,b,!0,-p,_),this.distance>yf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,l,p,_,b))}addHalfVertex({x:e,y:n},l,p,_,b,T,R){const B=.5*(this.lineClips?this.scaledDistance*(yf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(n<<1)+(b?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const G=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,G,this.e2),R.primitiveLength++),b?this.e2=G:this.e1=G}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const l=n.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,n,l,p){for(const _ of e){const b=_.paint.get("line-dasharray");if(!b||b.value.kind==="constant")continue;const T=_.layout.get("line-cap")==="round",R={dasharray:b.value.evaluate({zoom:l-1},n,{}),round:T},B={dasharray:b.value.evaluate({zoom:l},n,{}),round:T},G={dasharray:b.value.evaluate({zoom:l+1},n,{}),round:T},X=`${R.dasharray.join(",")},${R.round}`,$=`${B.dasharray.join(",")},${B.round}`,Q=`${G.dasharray.join(",")},${G.round}`;p.dashDependencies[X]=R,p.dashDependencies[$]=B,p.dashDependencies[Q]=G,n.dashes[_.id]={min:X,mid:$,max:Q}}}}let au,aa;On("LineBucket",gd,{omit:["layers","patternFeatures"]});var ou={get paint(){return aa=aa||new Es({"line-opacity":new ei(dt.paint_line["line-opacity"]),"line-color":new ei(dt.paint_line["line-color"]),"line-translate":new Bn(dt.paint_line["line-translate"]),"line-translate-anchor":new Bn(dt.paint_line["line-translate-anchor"]),"line-width":new ei(dt.paint_line["line-width"]),"line-gap-width":new ei(dt.paint_line["line-gap-width"]),"line-offset":new ei(dt.paint_line["line-offset"]),"line-blur":new ei(dt.paint_line["line-blur"]),"line-dasharray":new Mo(dt.paint_line["line-dasharray"]),"line-pattern":new Mo(dt.paint_line["line-pattern"]),"line-gradient":new mh(dt.paint_line["line-gradient"])})},get layout(){return au=au||new Es({"line-cap":new Bn(dt.layout_line["line-cap"]),"line-join":new ei(dt.layout_line["line-join"]),"line-miter-limit":new Bn(dt.layout_line["line-miter-limit"]),"line-round-limit":new Bn(dt.layout_line["line-round-limit"]),"line-sort-key":new ei(dt.layout_line["line-sort-key"])})}};class md extends ei{possiblyEvaluate(e,n){return n=new Ir(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,p){return n=un({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,p)}}let kl;class F0 extends hs{constructor(e,n){super(e,ou,n),this.gradientVersion=0,kl||(kl=new md(ou.paint.properties["line-width"].specification),kl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof It,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=kl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new gd(e)}queryRadius(e){const n=e,l=Ip(Jc("line-width",this,n),Jc("line-gap-width",this,n)),p=Jc("line-offset",this,n);return l/2+Math.abs(p)+tf(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:p,transform:_,pixelsToTileUnits:b}){const T=fp(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,b),R=b/2*Ip(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),B=this.paint.get("line-offset").evaluate(n,l);return B&&(p=(function(G,X){const $=[];for(let Q=0;Q<G.length;Q++){const ie=pp(G[Q]),re=[];for(let ae=0;ae<ie.length;ae++){const ye=ie[ae],Be=ie[ae-1],be=ie[ae+1],Ee=ae===0?new U(0,0):ye.sub(Be)._unit()._perp(),Ge=ae===ie.length-1?new U(0,0):be.sub(ye)._unit()._perp(),Qe=Ee._add(Ge)._unit(),Dt=Qe.x*Ge.x+Qe.y*Ge.y;Dt!==0&&Qe._mult(1/Dt),re.push(Qe._mult(X)._add(ye))}$.push(re)}return $})(p,B*b)),(function(G,X,$){for(let Q=0;Q<X.length;Q++){const ie=X[Q];if(G.length>=3){for(let re=0;re<ie.length;re++)if(Cc(G,ie[re]))return!0}if(ia(G,ie,$))return!0}return!1})(T,p,R)}isTileClipped(){return!0}}function Ip(i,e){return e>0?e+2*i:i}const nm=ss([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),xf=ss([{name:"a_projected_pos",components:3,type:"Float32"}],4);ss([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const j0=ss([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ss([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zo=ss([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),im=ss([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Lo(i,e,n){return i.sections.forEach((l=>{l.text=(function(p,_,b){const T=_.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),Io.applyArabicShaping&&(p=Io.applyArabicShaping(p)),p})(l.text,e,n)})),i}ss([{name:"triangle",components:3,type:"Uint16"}]),ss([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ss([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ss([{type:"Float32",name:"offsetX"}]),ss([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ss([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Ks=24;const yd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},z1={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ou={40:!0};function _f(i,e,n,l,p,_){if("fontStack"in e){const b=n[e.fontStack],T=b&&b[i];return T?T.metrics.advance*e.scale+p:0}{const b=l[e.imageName];return b?b.displaySize[0]*e.scale*Ks/_+p:0}}function Mp(i,e,n,l){const p=Math.pow(i-e,2);return l?i<e?p/2:2*p:p+Math.abs(n)*n}function xd(i,e,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function U0(i,e,n,l,p,_){let b=null,T=Mp(e,n,p,_);for(const R of l){const B=Mp(e-R.x,n,p,_)+R.badness;B<=T&&(b=R,T=B)}return{index:i,x:e,priorBreak:b,badness:T}}function V0(i){return i?V0(i.priorBreak).concat(i.index):[]}class Mh{constructor(e="",n=[],l=[]){this.text=e,this.sections=n,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,n){const l=new Mh;for(let p=0;p<e.sections.length;p++){const _=e.sections[p];_.image?l.addImageSection(_):l.addTextSection(_,n)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",l={premature:!0,value:void 0};const p=e[Symbol.iterator]();let _=p.next();const b=e[Symbol.iterator]();b.next();let T=b.next();for(;!_.done;)n+=!T.done&&El(T.value.codePointAt(0))&&!yd[T.value]||!l.premature&&El(l.value.codePointAt(0))&&!yd[l.value]||!yd[_.value]?_.value:yd[_.value],l={value:_.value,premature:!1},_=p.next(),T=b.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,l=this.text.match(/\S\s*$/),p=l?l[0].length-1:0;this.text=this.text.substring(n,this.text.length-p),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-p)}substring(e,n){const l=[...this.text].slice(e,n).join(""),p=this.sectionIndex.slice(e,n);return new Mh(l,this.sections,p)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,l=0;for(let p=0;p<this.length();p++){const _=this.getSection(p);if("imageName"in _){const b=e[_.imageName];if(!b)continue;const T=b.displaySize;n=Math.max(n,T[0]),l=Math.max(l,T[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void si("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):si("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,l,p,_){const b=[],T=this.determineAverageLineWidth(e,n,l,p,_),R=this.hasZeroWidthSpaces();let B=0,G=0;const X=this.text[Symbol.iterator]();let $=X.next();const Q=this.text[Symbol.iterator]();Q.next();let ie=Q.next();const re=this.text[Symbol.iterator]();re.next(),re.next();let ae=re.next();for(;!$.done;){const ye=this.getSection(G),Be=$.value.codePointAt(0);if(hh(Be)||(B+=_f(Be,ye,l,p,e,_)),!ie.done){const be=vl(Be),Ee=ie.value.codePointAt(0);(z1[Be]||be||"imageName"in ye||!ae.done&&Ou[Ee])&&b.push(U0(G+1,B,T,b,xd(Be,Ee,be&&R),!1))}G++,$=X.next(),ie=Q.next(),ae=re.next()}return V0(U0(this.length(),B,T,b,0,!0))}determineAverageLineWidth(e,n,l,p,_){let b=0,T=0;for(const R of this.text){const B=this.getSection(T);b+=_f(R.codePointAt(0),B,l,p,e,_),T++}return b/Math.max(1,Math.ceil(b/n))}}const kp=4294967296,bf=1/kp,Np=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Dp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,l=this.length){for(;this.pos<l;){const p=this.readVarint(),_=p>>3,b=this.pos;this.type=7&p,e(_,n,this),this.pos===b&&this.skip(p)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*kp;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*kp;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let l,p;return p=n[this.pos++],l=127&p,p<128?l:(p=n[this.pos++],l|=(127&p)<<7,p<128?l:(p=n[this.pos++],l|=(127&p)<<14,p<128?l:(p=n[this.pos++],l|=(127&p)<<21,p<128?l:(p=n[this.pos],l|=(15&p)<<28,(function(_,b,T){const R=T.buf;let B,G;if(G=R[T.pos++],B=(112&G)>>4,G<128||(G=R[T.pos++],B|=(127&G)<<3,G<128)||(G=R[T.pos++],B|=(127&G)<<10,G<128)||(G=R[T.pos++],B|=(127&G)<<17,G<128)||(G=R[T.pos++],B|=(127&G)<<24,G<128)||(G=R[T.pos++],B|=(1&G)<<31,G<128))return _d(_,B,b);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&Np?Np.decode(this.buf.subarray(n,e)):(function(l,p,_){let b="",T=p;for(;T<_;){const R=l[T];let B,G,X,$=null,Q=R>239?4:R>223?3:R>191?2:1;if(T+Q>_)break;Q===1?R<128&&($=R):Q===2?(B=l[T+1],(192&B)==128&&($=(31&R)<<6|63&B,$<=127&&($=null))):Q===3?(B=l[T+1],G=l[T+2],(192&B)==128&&(192&G)==128&&($=(15&R)<<12|(63&B)<<6|63&G,($<=2047||$>=55296&&$<=57343)&&($=null))):Q===4&&(B=l[T+1],G=l[T+2],X=l[T+3],(192&B)==128&&(192&G)==128&&(192&X)==128&&($=(15&R)<<18|(63&B)<<12|(63&G)<<6|63&X,($<=65535||$>=1114112)&&($=null))),$===null?($=65533,Q=1):$>65535&&($-=65536,b+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),b+=String.fromCharCode($),T+=Q}return b})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*bf),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*bf),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,l){let p,_;if(n>=0?(p=n%4294967296|0,_=n/4294967296|0):(p=~(-n%4294967296),_=~(-n/4294967296),4294967295^p?p=p+1|0:(p=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(b,T,R){R.buf[R.pos++]=127&b|128,b>>>=7,R.buf[R.pos++]=127&b|128,b>>>=7,R.buf[R.pos++]=127&b|128,b>>>=7,R.buf[R.pos++]=127&b|128,R.buf[R.pos]=127&(b>>>=7)})(p,0,l),(function(b,T){const R=(7&b)<<4;T.buf[T.pos++]|=R|((b>>>=3)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b|((b>>>=7)?128:0),b&&(T.buf[T.pos++]=127&b)))))})(_,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(p,_,b){for(let T,R,B=0;B<_.length;B++){if(T=_.charCodeAt(B),T>55295&&T<57344){if(!R){T>56319||B+1===_.length?(p[b++]=239,p[b++]=191,p[b++]=189):R=T;continue}if(T<56320){p[b++]=239,p[b++]=191,p[b++]=189,R=T;continue}T=R-55296<<10|T-56320|65536,R=null}else R&&(p[b++]=239,p[b++]=191,p[b++]=189,R=null);T<128?p[b++]=T:(T<2048?p[b++]=T>>6|192:(T<65536?p[b++]=T>>12|224:(p[b++]=T>>18|240,p[b++]=T>>12&63|128),p[b++]=T>>6&63|128),p[b++]=63&T|128)}return b})(this.buf,e,this.pos);const l=this.pos-n;l>=128&&rm(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let l=0;l<n;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,n){this.pos++;const l=this.pos;e(n,this);const p=this.pos-l;p>=128&&rm(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p}writeMessage(e,n,l){this.writeTag(e,2),this.writeRawMessage(n,l)}writePackedVarint(e,n){n.length&&this.writeMessage(e,sm,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,am,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,om,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,bd,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,Rp,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,lm,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,cm,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,um,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,hm,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function _d(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function rm(i,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let p=n.pos-1;p>=i;p--)n.buf[p+l]=n.buf[p]}function sm(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function am(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function bd(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function Rp(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function om(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function lm(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function cm(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function um(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function hm(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function dm(i,e,n){i===1&&n.readMessage(Pp,e)}function Pp(i,e,n){if(i===3){const{id:l,bitmap:p,width:_,height:b,left:T,top:R,advance:B}=n.readMessage(fm,{});e.push({id:l,bitmap:new sf({width:_+6,height:b+6},p),metrics:{width:_,height:b,left:T,top:R,advance:B}})}}function fm(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function G0(i){let e=0,n=0;for(const b of i)e+=b.w*b.h,n=Math.max(n,b.w);i.sort(((b,T)=>T.h-b.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let p=0,_=0;for(const b of i)for(let T=l.length-1;T>=0;T--){const R=l[T];if(!(b.w>R.w||b.h>R.h)){if(b.x=R.x,b.y=R.y,_=Math.max(_,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===R.w&&b.h===R.h){const B=l.pop();B&&T<l.length&&(l[T]=B)}else b.h===R.h?(R.x+=b.w,R.w-=b.w):b.w===R.w?(R.y+=b.h,R.h-=b.h):(l.push({x:R.x+b.w,y:R.y,w:R.w-b.w,h:b.h}),R.y+=b.h,R.h-=b.h);break}}return{w:p,h:_,fill:e/(p*_)||0}}class Gr{constructor(e,{pixelRatio:n,version:l,stretchX:p,stretchY:_,content:b,textFitWidth:T,textFitHeight:R}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=p,this.stretchY=_,this.content=b,this.version=l,this.textFitWidth=T,this.textFitHeight=R}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Op{constructor(e,n){const l={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,l,_),this.addImages(n,p,_);const{w:b,h:T}=G0(_),R=new Wa({width:b||1,height:T||1});for(const B in e){const G=e[B],X=l[B].paddedRect;Wa.copy(G.data,R,{x:0,y:0},{x:X.x+1,y:X.y+1},G.data)}for(const B in n){const G=n[B],X=p[B].paddedRect,$=X.x+1,Q=X.y+1,ie=G.data.width,re=G.data.height;Wa.copy(G.data,R,{x:0,y:0},{x:$,y:Q},G.data),Wa.copy(G.data,R,{x:0,y:re-1},{x:$,y:Q-1},{width:ie,height:1}),Wa.copy(G.data,R,{x:0,y:0},{x:$,y:Q+re},{width:ie,height:1}),Wa.copy(G.data,R,{x:ie-1,y:0},{x:$-1,y:Q},{width:1,height:re}),Wa.copy(G.data,R,{x:0,y:0},{x:$+ie,y:Q},{width:1,height:re})}this.image=R,this.iconPositions=l,this.patternPositions=p}addImages(e,n,l){for(const p in e){const _=e[p],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(b),n[p]=new Gr(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[p,_]=e.tl;l.update(n.data,void 0,{x:p,y:_})}}var zu;function vf(i,e,n,l,p,_,b,T,R,B,G,X,$,Q,ie){const re=Mh.fromFeature(i,p);let ae;X===N.az.vertical&&re.verticalizePunctuation();let ye=re.determineLineBreaks(B,_,e,l,Q);const{processBidirectionalText:Be,processStyledBidirectionalText:be}=Io;if(Be&&re.sections.length===1){ae=[],ye=ye.map((Dt=>re.toCodeUnitIndex(Dt)));const Qe=Be(re.toString(),ye);for(const Dt of Qe){const en=[...Dt].map((()=>0));ae.push(new Mh(Dt,re.sections,en))}}else if(be){ae=[],ye=ye.map((Xt=>re.toCodeUnitIndex(Xt)));let Qe=0;const Dt=[];for(const Xt of re.text)Dt.push(...Array(Xt.length).fill(re.sectionIndex[Qe])),Qe++;const en=be(re.text,Dt,ye);for(const Xt of en){const hn=[];let In="";for(const fn of Xt[0])hn.push(Xt[1][In.length]),In+=fn;ae.push(new Mh(Xt[0],re.sections,hn))}}else ae=(function(Qe,Dt){const en=[];let Xt=0;for(const hn of Dt)en.push(Qe.substring(Xt,hn)),Xt=hn;return Xt<Qe.length()&&en.push(Qe.substring(Xt,Qe.length())),en})(re,ye);const Ee=[],Ge={positionedLines:Ee,text:re.toString(),top:G[1],bottom:G[1],left:G[0],right:G[0],writingMode:X,iconsInText:!1,verticalizable:!1};return(function(Qe,Dt,en,Xt,hn,In,fn,Kt,Ut,Vn,zn,Wn){let Pn=0,hi=0,mr=0,er=0;const _s=Kt==="right"?1:Kt==="left"?0:.5,Qa=Ks/Wn;let ca=0;for(const Lr of hn){Lr.trim();const Ps=Lr.getMaxScale(),Gs={positionedGlyphs:[],lineOffset:0};Qe.positionedLines[ca]=Gs;const ls=Gs.positionedGlyphs;let tl=0;if(!Lr.length()){hi+=In,++ca;continue}const Ja=L1(Xt,Lr,Qa);let nl=0;for(const Ta of Lr.text){const Cs=Lr.getSection(nl),ua=Ta.codePointAt(0),Os=zp(Ut,zn,ua),Ia={glyph:ua,imageName:null,x:Pn,y:hi+-17,vertical:Os,scale:1,fontStack:"",sectionIndex:Lr.getSectionIndex(nl),metrics:null,rect:null};let Rh;if("fontStack"in Cs){if(Rh=vd(Cs,ua,Os,Ja,Dt,en),!Rh)continue;Ia.fontStack=Cs.fontStack}else{if(Qe.iconsInText=!0,Cs.scale*=Qa,Rh=q0(Cs,Os,Ps,Ja,Xt),!Rh)continue;tl=Math.max(tl,Rh.imageOffset),Ia.imageName=Cs.imageName}const{rect:fu,metrics:Sg,baselineOffset:Nd}=Rh;Ia.y+=Nd,Ia.scale=Cs.scale,Ia.metrics=Sg,Ia.rect=fu,ls.push(Ia),Os?(Qe.verticalizable=!0,Pn+=("imageName"in Cs?Sg.advance:Ks)*Cs.scale+Vn):Pn+=Sg.advance*Cs.scale+Vn,nl++}ls.length!==0&&(mr=Math.max(Pn-Vn,mr),Lp(ls,0,ls.length-1,_s)),Pn=0,Gs.lineOffset=Math.max(tl,(Ps-1)*Ks);const Dc=In*Ps+tl;hi+=Dc,er=Math.max(Dc,er),++ca}const{horizontalAlign:bs,verticalAlign:fs}=H0(fn);(function(Lr,Ps,Gs,ls,tl,Ja,nl,Dc,Ta){const Cs=(Ps-Gs)*tl;let ua=0;ua=Ja!==nl?-Dc*ls- -17:-ls*Ta*nl+.5*nl;for(const Os of Lr)for(const Ia of Os.positionedGlyphs)Ia.x+=Cs,Ia.y+=ua})(Qe.positionedLines,_s,bs,fs,mr,er,In,hi,hn.length),Qe.top+=-fs*hi,Qe.bottom=Qe.top+hi,Qe.left+=-bs*mr,Qe.right=Qe.left+mr})(Ge,e,n,l,ae,b,T,R,X,B,$,ie),!(function(Qe){for(const Dt of Qe)if(Dt.positionedGlyphs.length!==0)return!1;return!0})(Ee)&&Ge}function H0(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function L1(i,e,n){const l=e.getMaxScale()*Ks,{maxImageWidth:p,maxImageHeight:_}=e.getMaxImageSize(i),b=Math.max(l,_*n);return{verticalLineContentWidth:Math.max(l,p*n),horizontalLineContentHeight:b}}function pm(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function zp(i,e,n){return!(i===N.az.horizontal||!e&&!qc(n)||e&&(hh(n)||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function vd(i,e,n,l,p,_){const b=_[i.fontStack],T=(function(B,G,X,$){if(B&&B.rect)return B;const Q=G[X.fontStack],ie=Q&&Q[$];return ie?{rect:null,metrics:ie.metrics}:null})(b&&b[e],p,i,e);if(T===null)return null;let R;if(n)R=l.verticalLineContentWidth-i.scale*Ks;else{const B=pm(i.verticalAlign);R=(l.horizontalLineContentHeight-i.scale*Ks)*B}return{rect:T.rect,metrics:T.metrics,baselineOffset:R}}function q0(i,e,n,l,p){const _=p[i.imageName];if(!_)return null;const b=_.paddedRect,T=_.displaySize,R={width:T[0],height:T[1],left:1,top:-3,advance:e?T[1]:T[0]};let B;if(e)B=l.verticalLineContentWidth-T[1]*i.scale;else{const G=pm(i.verticalAlign);B=(l.horizontalLineContentHeight-T[1]*i.scale)*G}return{rect:b,metrics:R,baselineOffset:B,imageOffset:(e?T[0]:T[1])*i.scale-Ks*n}}function Lp(i,e,n,l){if(l===0)return;const p=i[n],_=(i[n].x+p.metrics.advance*p.scale)*l;for(let b=e;b<=n;b++)i[b].x-=_}function Z0(i,e,n){const{horizontalAlign:l,verticalAlign:p}=H0(n),_=e[0]-i.displaySize[0]*l,b=e[1]-i.displaySize[1]*p;return{image:i,top:b,bottom:b+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function lu(i){var e,n;let l=i.left,p=i.top,_=i.right-l,b=i.bottom-p;const T=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",R=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",B=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(R==="proportional"){if(T==="stretchOnly"&&_/b<B||T==="proportional"){const G=Math.ceil(b*B);l*=G/_,_=G}}else if(T==="proportional"&&R==="stretchOnly"&&B!==0&&_/b>B){const G=Math.ceil(_/B);p*=G/b,b=G}return{x1:l,y1:p,x2:l+_,y2:p+b}}function rc(i,e,n,l,p,_){const b=i.image;let T;if(b.content){const ae=b.content,ye=b.pixelRatio||1;T=[ae[0]/ye,ae[1]/ye,b.displaySize[0]-ae[2]/ye,b.displaySize[1]-ae[3]/ye]}const R=e.left*_,B=e.right*_;let G,X,$,Q;n==="width"||n==="both"?(Q=p[0]+R-l[3],X=p[0]+B+l[1]):(Q=p[0]+(R+B-b.displaySize[0])/2,X=Q+b.displaySize[0]);const ie=e.top*_,re=e.bottom*_;return n==="height"||n==="both"?(G=p[1]+ie-l[0],$=p[1]+re+l[2]):(G=p[1]+(ie+re-b.displaySize[1])/2,$=G+b.displaySize[1]),{image:b,top:G,right:X,bottom:$,left:Q,collisionPadding:T}}On("ImagePosition",Gr),On("ImageAtlas",Op),N.az=void 0,(zu=N.az||(N.az={}))[zu.none=0]="none",zu[zu.horizontal=1]="horizontal",zu[zu.vertical=2]="vertical",zu[zu.horizontalOnly=3]="horizontalOnly";const Jo=128,Lu=32640;function X0(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Ir(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=n;let _=0;for(;_<l.length&&l[_]<=i;)_++;_=Math.max(0,_-1);let b=_;for(;b<l.length&&l[b]<i+1;)b++;b=Math.min(l.length-1,b);const T=l[_],R=l[b];return n.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:R,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:R,minSize:n.evaluate(new Ir(T)),maxSize:n.evaluate(new Ir(R)),interpolationType:p}}}function Bp(i,e,n){let l="never";const p=i.get(e);return p?l=p:i.get(n)&&(l="always"),l}const gm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wf(i,e,n,l,p,_,b,T,R,B,G,X,$){const Q=T?Math.min(Lu,Math.round(T[0])):0,ie=T?Math.min(Lu,Math.round(T[1])):0;i.emplaceBack(e,n,Math.round(32*l),Math.round(32*p),_,b,(Q<<1)+(R?1:0),ie,16*B,16*G,256*X,256*$)}function W0(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Y0(i){for(const e of i.sections)if(Yl(e.text))return!0;return!1}class Fp{constructor(e){this.layoutVertexArray=new Ve,this.indexArray=new zt,this.programConfigurations=e,this.segments=new Tn,this.dynamicLayoutVertexArray=new pt,this.opacityVertexArray=new Ft,this.hasVisibleVertices=!1,this.placedSymbolArray=new M}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,xf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,gm,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}On("SymbolBuffers",Fp);class jp{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new Tn,this.collisionVertexArray=new Ot}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,j0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}On("CollisionBuffers",jp);class wd{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=X0(this.zoom,n["text-size"]),this.iconSizeData=X0(this.zoom,n["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=Bp(l,"text-overlap","text-allow-overlap")!=="never"||Bp(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((b=>N.az[b]))),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Fp(new Ec(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Fp(new Ec(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Z,this.lineVertexArray=new W,this.symbolInstances=new j,this.textAnchorOffsets=new J}calculateGlyphDependencies(e,n,l,p,_){for(const b of e)if(n[b.codePointAt(0)]=!0,(l||p)&&_){const T=yd[b];T&&(n[T.codePointAt(0)]=!0)}}populate(e,n,l){const p=this.layers[0],_=p.layout,b=_.get("text-font"),T=_.get("text-field"),R=_.get("icon-image"),B=(T.value.kind!=="constant"||T.value.value instanceof Yi&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),G=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,X=_.get("symbol-sort-key");if(this.features=[],!B&&!G)return;const $=n.iconDependencies,Q=n.glyphDependencies,ie=n.availableImages,re=new Ir(this.zoom);for(const{feature:ae,id:ye,index:Be,sourceLayerIndex:be}of e){const Ee=p._featureFilter.needGeometry,Ge=Ko(ae,Ee);if(!p._featureFilter.filter(re,Ge,l))continue;let Qe,Dt;if(Ee||(Ge.geometry=tc(ae)),B){const Xt=p.getValueAndResolveTokens("text-field",Ge,l,ie),hn=Yi.factory(Xt),In=this.hasRTLText=this.hasRTLText||Y0(hn);(!In||Io.getRTLTextPluginStatus()==="unavailable"||In&&Io.isParsed())&&(Qe=Lo(hn,p,Ge))}if(G){const Xt=p.getValueAndResolveTokens("icon-image",Ge,l,ie);Dt=Xt instanceof qs?Xt:qs.fromString(Xt)}if(!Qe&&!Dt)continue;const en=this.sortFeaturesByKey?X.evaluate(Ge,{},l):void 0;if(this.features.push({id:ye,text:Qe,icon:Dt,index:Be,sourceLayerIndex:be,geometry:Ge.geometry,properties:ae.properties,type:pd.types[ae.type],sortKey:en}),Dt&&($[Dt.name]=!0),Qe){const Xt=b.evaluate(Ge,{},l).join(","),hn=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(N.az.vertical)>=0;for(const In of Qe.sections)if(In.image)$[In.image.name]=!0;else{const fn=wl(Qe.toString()),Kt=In.fontStack||Xt,Ut=Q[Kt]=Q[Kt]||{};this.calculateGlyphDependencies(In.text,Ut,hn,this.allowVerticalPlacement,fn)}}}_.get("symbol-placement")==="line"&&(this.features=(function(ae){const ye={},Be={},be=[];let Ee=0;function Ge(Xt){be.push(ae[Xt]),Ee++}function Qe(Xt,hn,In){const fn=Be[Xt];return delete Be[Xt],Be[hn]=fn,be[fn].geometry[0].pop(),be[fn].geometry[0]=be[fn].geometry[0].concat(In[0]),fn}function Dt(Xt,hn,In){const fn=ye[hn];return delete ye[hn],ye[Xt]=fn,be[fn].geometry[0].shift(),be[fn].geometry[0]=In[0].concat(be[fn].geometry[0]),fn}function en(Xt,hn,In){const fn=In?hn[0][hn[0].length-1]:hn[0][0];return`${Xt}:${fn.x}:${fn.y}`}for(let Xt=0;Xt<ae.length;Xt++){const hn=ae[Xt],In=hn.geometry,fn=hn.text?hn.text.toString():null;if(!fn){Ge(Xt);continue}const Kt=en(fn,In),Ut=en(fn,In,!0);if(Kt in Be&&Ut in ye&&Be[Kt]!==ye[Ut]){const Vn=Dt(Kt,Ut,In),zn=Qe(Kt,Ut,be[Vn].geometry);delete ye[Kt],delete Be[Ut],Be[en(fn,be[zn].geometry,!0)]=zn,be[Vn].geometry=null}else Kt in Be?Qe(Kt,Ut,In):Ut in ye?Dt(Kt,Ut,In):(Ge(Xt),ye[Kt]=Ee-1,Be[Ut]=Ee-1)}return be.filter((Xt=>Xt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ae,ye)=>ae.sortKey-ye.sortKey))}update(e,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(n[e.segment+1]),_=e.dist(n[e.segment]);const b={};for(let T=e.segment+1;T<n.length;T++)b[T]={x:n[T].x,y:n[T].y,tileUnitDistanceFromAnchor:p},T<n.length-1&&(p+=n[T+1].dist(n[T]));for(let T=e.segment||0;T>=0;T--)b[T]={x:n[T].x,y:n[T].y,tileUnitDistanceFromAnchor:_},T>0&&(_+=n[T-1].dist(n[T]));for(let T=0;T<n.length;T++){const R=b[T];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,p,_,b,T,R,B,G,X,$){const Q=e.indexArray,ie=e.layoutVertexArray,re=e.segments.prepareSegment(4*n.length,ie,Q,this.canOverlap?b.sortKey:void 0),ae=this.glyphOffsetArray.length,ye=re.vertexLength,Be=this.allowVerticalPlacement&&T===N.az.vertical?Math.PI/2:0,be=b.text&&b.text.sections;for(let Ee=0;Ee<n.length;Ee++){const{tl:Ge,tr:Qe,bl:Dt,br:en,tex:Xt,pixelOffsetTL:hn,pixelOffsetBR:In,minFontScaleX:fn,minFontScaleY:Kt,glyphOffset:Ut,isSDF:Vn,sectionIndex:zn}=n[Ee],Wn=re.vertexLength,Pn=Ut[1];wf(ie,R.x,R.y,Ge.x,Pn+Ge.y,Xt.x,Xt.y,l,Vn,hn.x,hn.y,fn,Kt),wf(ie,R.x,R.y,Qe.x,Pn+Qe.y,Xt.x+Xt.w,Xt.y,l,Vn,In.x,hn.y,fn,Kt),wf(ie,R.x,R.y,Dt.x,Pn+Dt.y,Xt.x,Xt.y+Xt.h,l,Vn,hn.x,In.y,fn,Kt),wf(ie,R.x,R.y,en.x,Pn+en.y,Xt.x+Xt.w,Xt.y+Xt.h,l,Vn,In.x,In.y,fn,Kt),W0(e.dynamicLayoutVertexArray,R,Be),Q.emplaceBack(Wn,Wn+2,Wn+1),Q.emplaceBack(Wn+1,Wn+2,Wn+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),Ee!==n.length-1&&zn===n[Ee+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,b,b.index,{imagePositions:{},canonical:$,formattedSection:be&&be[zn]})}e.placedSymbolArray.emplaceBack(R.x,R.y,ae,this.glyphOffsetArray.length-ae,ye,B,G,R.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],T,0,!1,0,X)}_addCollisionDebugVertex(e,n,l,p,_,b){return n.emplaceBack(0,0),e.emplaceBack(l.x,l.y,p,_,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(e,n,l,p,_,b,T){const R=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),B=R.vertexLength,G=_.layoutVertexArray,X=_.collisionVertexArray,$=T.anchorX,Q=T.anchorY;this._addCollisionDebugVertex(G,X,b,$,Q,new U(e,n)),this._addCollisionDebugVertex(G,X,b,$,Q,new U(l,n)),this._addCollisionDebugVertex(G,X,b,$,Q,new U(l,p)),this._addCollisionDebugVertex(G,X,b,$,Q,new U(e,p)),R.vertexLength+=4;const ie=_.indexArray;ie.emplaceBack(B,B+1),ie.emplaceBack(B+1,B+2),ie.emplaceBack(B+2,B+3),ie.emplaceBack(B+3,B),R.primitiveLength+=4}addDebugCollisionBoxes(e,n,l,p){for(let _=e;_<n;_++){const b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jp(Nt,zo.members,xn),this.iconCollisionBox=new jp(Nt,zo.members,xn);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,l,p,_,b,T,R,B){const G={};for(let X=n;X<l;X++){const $=e.get(X);G.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.textFeatureIndex=$.featureIndex;break}for(let X=p;X<_;X++){const $=e.get(X);G.verticalTextBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.verticalTextFeatureIndex=$.featureIndex;break}for(let X=b;X<T;X++){const $=e.get(X);G.iconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.iconFeatureIndex=$.featureIndex;break}for(let X=R;X<B;X++){const $=e.get(X);G.verticalIconBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},G.verticalIconFeatureIndex=$.featureIndex;break}return G}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),p=l.vertexStartIndex+4*l.numGlyphs;for(let _=l.vertexStartIndex;_<p;_+=4)e.indexArray.emplaceBack(_,_+2,_+1),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),p=[],_=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const R=this.symbolInstances.get(T);p.push(0|Math.round(n*R.anchorX+l*R.anchorY)),_.push(R.featureIndex)}return b.sort(((T,R)=>p[T]-p[R]||_[R]-_[T])),b}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((p,_,b)=>{p>=0&&b.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Up,Vp;On("SymbolBucket",wd,{omit:["layers","collisionBoxArray","features","compareText"]}),wd.MAX_GLYPHS=65535,wd.addDynamicAttributes=W0;var $0={get paint(){return Vp=Vp||new Es({"icon-opacity":new ei(dt.paint_symbol["icon-opacity"]),"icon-color":new ei(dt.paint_symbol["icon-color"]),"icon-halo-color":new ei(dt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ei(dt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ei(dt.paint_symbol["icon-halo-blur"]),"icon-translate":new Bn(dt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bn(dt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ei(dt.paint_symbol["text-opacity"]),"text-color":new ei(dt.paint_symbol["text-color"],{runtimeType:tn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ei(dt.paint_symbol["text-halo-color"]),"text-halo-width":new ei(dt.paint_symbol["text-halo-width"]),"text-halo-blur":new ei(dt.paint_symbol["text-halo-blur"]),"text-translate":new Bn(dt.paint_symbol["text-translate"]),"text-translate-anchor":new Bn(dt.paint_symbol["text-translate-anchor"])})},get layout(){return Up=Up||new Es({"symbol-placement":new Bn(dt.layout_symbol["symbol-placement"]),"symbol-spacing":new Bn(dt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bn(dt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ei(dt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bn(dt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bn(dt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Bn(dt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Bn(dt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bn(dt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bn(dt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ei(dt.layout_symbol["icon-size"]),"icon-text-fit":new Bn(dt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bn(dt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ei(dt.layout_symbol["icon-image"]),"icon-rotate":new ei(dt.layout_symbol["icon-rotate"]),"icon-padding":new ei(dt.layout_symbol["icon-padding"]),"icon-keep-upright":new Bn(dt.layout_symbol["icon-keep-upright"]),"icon-offset":new ei(dt.layout_symbol["icon-offset"]),"icon-anchor":new ei(dt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bn(dt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bn(dt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bn(dt.layout_symbol["text-rotation-alignment"]),"text-field":new ei(dt.layout_symbol["text-field"]),"text-font":new ei(dt.layout_symbol["text-font"]),"text-size":new ei(dt.layout_symbol["text-size"]),"text-max-width":new ei(dt.layout_symbol["text-max-width"]),"text-line-height":new Bn(dt.layout_symbol["text-line-height"]),"text-letter-spacing":new ei(dt.layout_symbol["text-letter-spacing"]),"text-justify":new ei(dt.layout_symbol["text-justify"]),"text-radial-offset":new ei(dt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bn(dt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ei(dt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ei(dt.layout_symbol["text-anchor"]),"text-max-angle":new Bn(dt.layout_symbol["text-max-angle"]),"text-writing-mode":new Bn(dt.layout_symbol["text-writing-mode"]),"text-rotate":new ei(dt.layout_symbol["text-rotate"]),"text-padding":new Bn(dt.layout_symbol["text-padding"]),"text-keep-upright":new Bn(dt.layout_symbol["text-keep-upright"]),"text-transform":new ei(dt.layout_symbol["text-transform"]),"text-offset":new ei(dt.layout_symbol["text-offset"]),"text-allow-overlap":new Bn(dt.layout_symbol["text-allow-overlap"]),"text-overlap":new Bn(dt.layout_symbol["text-overlap"]),"text-ignore-placement":new Bn(dt.layout_symbol["text-ignore-placement"]),"text-optional":new Bn(dt.layout_symbol["text-optional"])})}};class mm{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Ke,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}On("FormatSectionOverride",mm,{omit:["defaultValue"]});class Bu extends hs{constructor(e,n){super(e,$0,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const _ of l)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,l,p){const _=this.layout.get(e).evaluate(n,{},l,p),b=this._unevaluatedLayout._values[e];return b.isDataDriven()||yc(b.value)||!_?_:(function(T,R){return R.replace(/{([^{}]+)}/g,((B,G)=>T&&G in T?String(T[G]):""))})(n.properties,_)}createBucket(e){return new wd(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of $0.paint.overridableProperties){if(!Bu.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new mm(n),p=new $h(l,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new za("source",p):new xc("composite",p,n.value.zoomStops),this.paint._values[e]=new ho(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&Bu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),p=$0.paint.properties[n];let _=!1;const b=T=>{for(const R of T)if(p.overrides&&p.overrides.hasOverride(R))return void(_=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Yi)b(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const T=B=>{_||(B instanceof ps&&Dr(B.value)===ni?b(B.value.sections):B instanceof wa?b(B.sections):B.eachChild(T))},R=l.value;R._styleExpression&&T(R._styleExpression.expression)}return _}}let ym;var xm={get paint(){return ym=ym||new Es({"background-color":new Bn(dt.paint_background["background-color"]),"background-pattern":new Iu(dt.paint_background["background-pattern"]),"background-opacity":new Bn(dt.paint_background["background-opacity"])})}};class pr extends hs{constructor(e,n){super(e,xm,n)}}class K0 extends hs{constructor(e,n){super(e,{},n),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Gp{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Q0={once:!0},Hp=63710088e-1;class kc{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kc(Qt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,p=e.lat*n,_=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((e.lng-this.lng)*n);return Hp*Math.acos(Math.min(_,1))}static convert(e){if(e instanceof kc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new kc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new kc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ad=2*Math.PI*Hp;function Af(i){return Ad*Math.cos(i*Math.PI/180)}function _m(i){return(180+i)/360}function J0(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function bm(i,e){return i/Af(e)}function vm(i){return 360*i-180}function Ef(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function eg(i,e){return i*Af(Ef(e))}class Or{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=kc.convert(e);return new Or(_m(l.lng),J0(l.lat),bm(n,l.lat))}toLngLat(){return new kc(vm(this.x),Ef(this.y))}toAltitude(){return eg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ad*(e=Ef(this.y),1/Math.cos(e*Math.PI/180));var e}}function qp(i,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class _a{constructor(e,n,l){if(!(function(p,_,b){return!(p<0||p>25||b<0||b>=Math.pow(2,p)||_<0||_>=Math.pow(2,p))})(e,n,l))throw new Error(`x=${n}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=l,this.key=Ed(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,l){const p=(function(b,T,R){var B=qp(256*b,256*(T=Math.pow(2,R)-T-1),R),G=qp(256*(b+1),256*(T+1),R);return B[0]+","+B[1]+","+G[0]+","+G[1]})(this.x,this.y,this.z),_=(function(b,T,R){let B,G="";for(let X=b;X>0;X--)B=1<<X-1,G+=(T&B?1:0)+(R&B?2:0);return G})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,_).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new U((e.x*n-this.x)*Tt,(e.y*n-this.y)*Tt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wm{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Ed(e,n.z,n.z,n.x,n.y)}}class Bo{constructor(e,n,l,p,_){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=n,this.canonical=new _a(l,+p,+_),this.key=Ed(n,e,l,p,_)}clone(){return new Bo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new Bo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bo(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Ed(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Ed(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Bo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new Bo(n,this.wrap,n,l,p),new Bo(n,this.wrap,n,l+1,p),new Bo(n,this.wrap,n,l,p+1),new Bo(n,this.wrap,n,l+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Bo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Bo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Or(e.x-this.wrap,e.y))}}function Ed(i,e,n,l,p){(i*=2)<0&&(i=-1*i-1);const _=1<<n;return(_*_*i+_*p+l).toString(36)+n.toString(36)+e.toString(36)}function Sf(i,e){return e?i.properties[e]:i.id}function tg(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const p=i.addOrUpdateProperties.findIndex((_=>_.key===l));p>-1&&i.addOrUpdateProperties.splice(p,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Cf(i){var e,n;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((p=>[p.id,p]))),l.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((p=>[p.id,p]))),l}On("CanonicalTileID",_a),On("OverscaledTileID",Bo,{omit:["terrainRttPosMatrix32f"]});class Fu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new Fu;return n.extend(e(new U(this.minX,this.minY))),n.extend(e(new U(this.maxX,this.minY))),n.extend(e(new U(this.minX,this.maxY))),n.extend(e(new U(this.maxX,this.maxY))),n}static fromPoints(e){const n=new Fu;for(const l of e)n.extend(l);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class ng{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Zp{constructor(e,n,l,p,_){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=p,this._z=n,this.properties=e.properties,this.id=_}projectPoint(e,n,l,p){return[360*(e.x+n)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/p)*Math.PI))-90]}projectLine(e,n,l,p){return e.map((_=>this.projectPoint(_,n,l,p)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),l=e.extent*this._x,p=e.extent*this._y,_=e.loadGeometry();switch(e.type){case 1:{const b=[];for(const R of _)b.push(R[0]);const T=this.projectLine(b,l,p,n);this._geometry=b.length===1?{type:"Point",coordinates:T[0]}:{type:"MultiPoint",coordinates:T};break}case 2:{const b=_.map((T=>this.projectLine(T,l,p,n)));this._geometry=b.length===1?{type:"LineString",coordinates:b[0]}:{type:"MultiLineString",coordinates:b};break}case 3:{const b=em(_),T=[];for(const R of b)T.push(R.map((B=>this.projectLine(B,l,p,n))));this._geometry=T.length===1?{type:"Polygon",coordinates:T[0]}:{type:"MultiPolygon",coordinates:T};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class ju{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,l){this._name=e,this.dataBuffer=n,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Xp extends ju{}class Wp extends Xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class ig extends Xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class rg extends ju{delta;constructor(e,n,l,p){super(e,n,p),this.delta=l}}class sg extends rg{constructor(e,n,l,p){super(e,Int32Array.of(n),l,p)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class ag extends ju{constructor(e,n,l){super(e,Int32Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Uu{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,l,p,_=4096){this._name=e,this._geometryVector=n,this._idVector=l,this._propertyVectors=p,this._extent=_}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const p=e?.next().value,_={};for(const b of this.propertyVectors){if(!b)continue;const T=b.name,R=b.getValue(n);R!==null&&(_[T]=R)}n++,yield{id:l,geometry:p,properties:_}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const _={coordinates:n[l],type:this.geometryVector.geometryType(l)},b={};for(const T of this.propertyVectors){if(!T)continue;const R=T.name,B=T.getValue(l);B!==null&&(b[R]=B)}e.push({id:p,geometry:_,properties:b})}return e}containsMaxSaveIntegerValues(e){return e instanceof Wp||e instanceof ag&&e instanceof sg||e instanceof ig}}class Am{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Wi,sc,Sa,ac,Vu,Ya,Vs,oa,el,yo;function la(i,e,n){const l=new Int32Array(n);let p=0,_=e.get();for(let b=0;b<l.length;b++){let T=i[_++],R=127&T;T<128||(T=i[_++],R|=(127&T)<<7,T<128||(T=i[_++],R|=(127&T)<<14,T<128||(T=i[_++],R|=(127&T)<<21,T<128||(T=i[_++],R|=(15&T)<<28)))),l[p++]=R}return e.set(_),l}function Tf(i,e,n){const l=new BigInt64Array(n);for(let p=0;p<l.length;p++)l[p]=Yp(i,e);return l}function Em(i,e){let n,l;return l=i[e.get()],e.increment(),n=127&l,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<7,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<14,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<21,l<128?n:(l=i[e.get()],n|=(15&l)<<28,(function(p,_,b){let T,R;if(R=_[b.get()],b.increment(),T=(112&R)>>4,R<128||(R=_[b.get()],b.increment(),T|=(127&R)<<3,R<128)||(R=_[b.get()],b.increment(),T|=(127&R)<<10,R<128)||(R=_[b.get()],b.increment(),T|=(127&R)<<17,R<128)||(R=_[b.get()],b.increment(),T|=(127&R)<<24,R<128)||(R=_[b.get()],b.increment(),T|=(1&R)<<31,R<128))return 4294967296*T+(p>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function Sd(i,e,n,l){throw new Error("FastPFor is not implemented yet.")}function Ca(i){return i>>>1^-(1&i)}function kh(i){return i>>1n^-(1n&i)}function Yp(i,e){let n=0n,l=0,p=e.get();for(;p<i.length;){const _=i[p++];if(n|=BigInt(127&_)<<BigInt(l),!(128&_))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(p),n}function Nc(i,e,n){const l=new Int32Array(n);let p=0;for(let _=0;_<e;_++){const b=i[_];l.fill(i[_+e],p,p+b),p+=b}return l}function Sm(i,e,n){const l=new BigInt64Array(n);let p=0;for(let _=0;_<e;_++){const b=Number(i[_]);l.fill(i[_+e],p,p+b),p+=b}return l}function Cm(i,e,n){const l=new Float64Array(n);let p=0;for(let _=0;_<e;_++){const b=i[_];l.fill(i[_+e],p,p+b),p+=b}return l}function Gu(i){const e=i.length/4*4;let n=1;if(e>=4)for(let l=i[0];n<e-4;n+=4)l=i[n]+=l,l=i[n+1]+=l,l=i[n+2]+=l,l=i[n+3]+=l;for(;n!=i.length;)i[n]+=i[n-1],++n}function og(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const l=i[n],p=i[n+1],_=i[n+2],b=i[n+3];i[n]=(l>>>1^-(1&l))+i[n-2],i[n+1]=(p>>>1^-(1&p))+i[n-1],i[n+2]=(_>>>1^-(1&_))+i[n],i[n+3]=(b>>>1^-(1&b))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(Wi||(Wi={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(sc||(sc={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(Sa||(Sa={}));class lg{_dictionaryType;_offsetType;_lengthType;constructor(e,n,l){this._dictionaryType=e,this._offsetType=n,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function $a(i,e){const n=(function(l,p){const _=l[p.get()],b=Object.values(Sa)[_>>4];let T=null;switch(b){case Sa.DATA:T=new lg(Object.values(ac)[15&_]);break;case Sa.OFFSET:T=new lg(null,Object.values(Vu)[15&_]);break;case Sa.LENGTH:T=new lg(null,null,Object.values(Ya)[15&_])}p.increment();const R=l[p.get()],B=Object.values(Wi)[R>>5],G=Object.values(Wi)[R>>2&7],X=Object.values(sc)[3&R];p.increment();const $=la(l,p,2),Q=$[0];return{physicalStreamType:b,logicalStreamType:T,logicalLevelTechnique1:B,logicalLevelTechnique2:G,physicalLevelTechnique:X,numValues:Q,byteLength:$[1],decompressedCount:Q}})(i,e);return n.logicalLevelTechnique1===Wi.MORTON?(function(l,p,_){const b=la(p,_,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:b[0],coordinateShift:b[1]}})(n,i,e):Wi.RLE!==n.logicalLevelTechnique1&&Wi.RLE!==n.logicalLevelTechnique2||sc.NONE===n.physicalLevelTechnique?n:(function(l,p,_){const b=la(p,_,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:b[1],runs:b[0],numRleValues:b[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(ac||(ac={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(Vu||(Vu={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Ya||(Ya={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Vs||(Vs={}));class oc{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const l=Math.floor(e/8);this.values[l]=this.values[l]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Ka(i,e,n,l,p){return(function(_,b,T){switch(b.logicalLevelTechnique1){case Wi.DELTA:return b.logicalLevelTechnique2===Wi.RLE?(function(R,B,G){const X=new Int32Array(G);let $=0,Q=0;for(let ie=0;ie<B;ie++){const re=R[ie],ae=Ca(R[ie+B]);for(let ye=0;ye<re;ye++)Q+=ae,X[$++]=Q}return X})(_,b.runs,b.numRleValues):((function(R){R[0]=R[0]>>>1^-(1&R[0]);const B=R.length/4*4;let G=1;if(B>=4)for(;G<B-4;G+=4){const X=R[G],$=R[G+1],Q=R[G+2],ie=R[G+3];R[G]=(X>>>1^-(1&X))+R[G-1],R[G+1]=($>>>1^-(1&$))+R[G],R[G+2]=(Q>>>1^-(1&Q))+R[G+1],R[G+3]=(ie>>>1^-(1&ie))+R[G+2]}for(;G!=R.length;++G)R[G]=(R[G]>>>1^-(1&R[G]))+R[G-1]})(_),_);case Wi.RLE:return(function(R,B,G){return G?(function(X,$,Q){const ie=new Int32Array(Q);let re=0;for(let ae=0;ae<$;ae++){const ye=X[ae];let Be=X[ae+$];Be=Be>>>1^-(1&Be),ie.fill(Be,re,re+ye),re+=ye}return ie})(R,B.runs,B.numRleValues):Nc(R,B.runs,B.numRleValues)})(_,b,T);case Wi.MORTON:return Gu(_),_;case Wi.COMPONENTWISE_DELTA:return og(_),_;case Wi.NONE:return T&&(function(R){for(let B=0;B<R.length;B++){const G=R[B];R[B]=G>>>1^-(1&G)}})(_),_;default:throw new Error(`The specified Logical level technique is not supported: ${b.logicalLevelTechnique1}`)}})($p(i,e,n),n,l)}function Hu(i,e,n){return(function(l,p){if(p.logicalLevelTechnique1===Wi.DELTA&&p.logicalLevelTechnique2===Wi.NONE)return(function(b){const T=new Int32Array(b.length+1);T[0]=0,T[1]=Ca(b[0]);let R=T[1],B=2;for(;B!=T.length;++B){const G=b[B-1];R+=G>>>1^-(1&G),T[B]=T[B-1]+R}return T})(l);if(p.logicalLevelTechnique1===Wi.RLE&&p.logicalLevelTechnique2===Wi.NONE)return(function(b,T,R){const B=new Int32Array(R+1);B[0]=0;let G=1,X=B[0];for(let $=0;$<T;$++){const Q=b[$],ie=b[$+T];for(let re=G;re<G+Q;re++)B[re]=ie+X,X=B[re];G+=Q}return B})(l,p.runs,p.numRleValues);if(p.logicalLevelTechnique1===Wi.NONE&&p.logicalLevelTechnique2===Wi.NONE){(function(b){let T=0;for(let R=0;R<b.length;R++)b[R]+=T,T=b[R]})(l);const _=new Int32Array(p.numValues+1);return _[0]=0,_.set(l,1),_}if(p.logicalLevelTechnique1===Wi.DELTA&&p.logicalLevelTechnique2===Wi.RLE){const _=(function(b,T,R){const B=new Int32Array(R+1);B[0]=0;let G=1,X=B[0];for(let $=0;$<T;$++){const Q=b[$];let ie=b[$+T];ie=ie>>>1^-(1&ie);for(let re=G;re<G+Q;re++)B[re]=ie+X,X=B[re];G+=Q}return B})(l,p.runs,p.numRleValues);return Gu(_),_}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})($p(i,e,n),n)}function $p(i,e,n){const l=n.physicalLevelTechnique;if(l===sc.FAST_PFOR)return Sd();if(l===sc.VARINT)return la(i,e,n.numValues);if(l===sc.NONE){const p=e.get();e.add(n.byteLength);const _=i.subarray(p,e.get());return new Int32Array(_)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function cg(i,e,n,l){const p=$p(i,e,n);if(p.length===1){const _=p[0];return l?Ca(_):_}return l?(function(_){return Ca(_[1])})(p):(function(_){return _[1]})(p)}function ug(i,e,n){return(function(l){if(l.length==2){const p=Ca(l[1]);return[p,p]}return[Ca(l[2]),Ca(l[3])]})($p(i,e,n))}function Nh(i,e,n){return(function(l){if(l.length==2){const p=kh(l[1]);return[p,p]}return[kh(l[2]),kh(l[3])]})(Tf(i,e,n.numValues))}function Cd(i,e,n,l){return(function(p,_,b){switch(_.logicalLevelTechnique1){case Wi.DELTA:return _.logicalLevelTechnique2===Wi.RLE?(function(T,R,B){const G=new BigInt64Array(B);let X=0,$=0n;for(let Q=0;Q<R;Q++){const ie=Number(T[Q]),re=kh(T[Q+R]);for(let ae=0;ae<ie;ae++)$+=re,G[X++]=$}return G})(p,_.runs,_.numRleValues):((function(T){T[0]=T[0]>>1n^-(1n&T[0]);const R=T.length/4*4;let B=1;if(R>=4)for(;B<R-4;B+=4){const G=T[B],X=T[B+1],$=T[B+2],Q=T[B+3];T[B]=(G>>1n^-(1n&G))+T[B-1],T[B+1]=(X>>1n^-(1n&X))+T[B],T[B+2]=($>>1n^-(1n&$))+T[B+1],T[B+3]=(Q>>1n^-(1n&Q))+T[B+2]}for(;B!=T.length;++B)T[B]=(T[B]>>1n^-(1n&T[B]))+T[B-1]})(p),p);case Wi.RLE:return(function(T,R,B){return B?(function(G,X,$){const Q=new BigInt64Array($);let ie=0;for(let re=0;re<X;re++){const ae=Number(G[re]);let ye=G[re+X];ye=ye>>1n^-(1n&ye),Q.fill(ye,ie,ie+ae),ie+=ae}return Q})(T,R.runs,R.numRleValues):Sm(T,R.runs,R.numRleValues)})(p,_,b);case Wi.NONE:return b&&(function(T){for(let R=0;R<T.length;R++){const B=T[R];T[R]=B>>1n^-(1n&B)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${_.logicalLevelTechnique1}`)}})(Tf(i,e,n.numValues),n,l)}function hg(i,e,n,l){const p=Tf(i,e,n.numValues);if(p.length===1){const _=p[0];return l?kh(_):_}return l?(function(_){return kh(_[1])})(p):(function(_){return _[1]})(p)}function dg(i,e,n,l,p){return(function(_,b,T,R){switch(b.logicalLevelTechnique1){case Wi.DELTA:return b.logicalLevelTechnique2===Wi.RLE&&(_=Nc(_,b.runs,b.numRleValues)),(function(B,G){const X=new Int32Array(B.size());let $=0;B.get(0)?(X[0]=B.get(0)?G[0]>>>1^-(1&G[0]):0,$=1):X[0]=0;let Q=1;for(;Q!=X.length;++Q)X[Q]=B.get(Q)?X[Q-1]+(G[$]>>>1^-(1&G[$++])):X[Q-1];return X})(R,_);case Wi.RLE:return(function(B,G,X,$){const Q=G;return X?(function(ie,re,ae){const ye=new Int32Array(ie.size());let Be=0;for(let be=0;be<ae;be++){const Ee=re[be];let Ge=re[be+ae];Ge=Ge>>>1^-(1&Ge);for(let Qe=Be;Qe<Be+Ee;Qe++)ie.get(Qe)?ye[Qe]=Ge:(ye[Qe]=0,Be++);Be+=Ee}return ye})($,B,Q.runs):(function(ie,re,ae){const ye=new Int32Array(ie.size());let Be=0;for(let be=0;be<ae;be++){const Ee=re[be],Ge=re[be+ae];for(let Qe=Be;Qe<Be+Ee;Qe++)ie.get(Qe)?ye[Qe]=Ge:(ye[Qe]=0,Be++);Be+=Ee}return ye})($,B,Q.runs)})(_,b,T,R);case Wi.MORTON:return Gu(_),_;case Wi.COMPONENTWISE_DELTA:return og(_),_;case Wi.NONE:return _=T?(function(B,G){const X=new Int32Array(B.size());let $=0,Q=0;for(;Q!=X.length;++Q)if(B.get(Q)){const ie=G[$++];X[Q]=ie>>>1^-(1&ie)}else X[Q]=0;return X})(R,_):(function(B,G){const X=new Int32Array(B.size());let $=0,Q=0;for(;Q!=X.length;++Q)X[Q]=B.get(Q)?G[$++]:0;return X})(R,_),_;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===sc.FAST_PFOR?Sd():la(i,e,n.numValues),n,l,p)}function cu(i,e,n,l){const p=i.logicalLevelTechnique1;if(p===Wi.RLE)return i.runs===1?Vs.CONST:Vs.FLAT;const _=e instanceof oc?e.size():e;if(p===Wi.DELTA&&i.logicalLevelTechnique2===Wi.RLE){const b=i.runs,T=2;if(i.numRleValues!==_)return Vs.FLAT;if(b===1)return Vs.SEQUENCE;if(b===2){const R=l.get();let B;if(i.physicalLevelTechnique===sc.VARINT)B=la(n,l,4);else{const G=l.get();B=new Int32Array(n.buffer,n.byteOffset+G,4)}if(l.set(R),B[2]===T&&B[3]===T)return Vs.SEQUENCE}}return i.numValues===1?Vs.CONST:Vs.FLAT}class Td extends Xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class fg extends rg{constructor(e,n,l,p){super(e,BigInt64Array.of(n),l,p)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class uu{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,l){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function If(i,e,n){return{x:Kp(i,e)-n,y:Kp(i>>1,e)-n}}function Kp(i,e){let n=0;for(let l=0;l<e;l++)n|=(i&1<<2*l)>>l;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(oa||(oa={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(el||(el={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(yo||(yo={}));class Qp{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function pg(i){const e=new Array(i.numGeometries);let n=1,l=1,p=1,_=0;const b=new Qp;let T=0,R=0;const B=i.mortonSettings,G=i.topologyVector,X=G.geometryOffsets,$=G.partOffsets,Q=G.ringOffsets,ie=i.vertexOffsets,re=i.containsPolygonGeometry(),ae=i.vertexBuffer;for(let ye=0;ye<i.numGeometries;ye++){const Be=i.geometryType(ye);if(Be===oa.POINT){if(ie&&ie.length!==0)if(i.vertexBufferType===yo.VEC_2){const be=2*ie[R++],Ee=new U(ae[be],ae[be+1]);e[_++]=b.createPoint(Ee)}else{const be=If(ae[ie[R++]],B.numBits,B.coordinateShift),Ee=new U(be.x,be.y);e[_++]=b.createPoint(Ee)}else{const be=new U(ae[T++],ae[T++]);e[_++]=b.createPoint(be)}X&&p++,$&&n++,Q&&l++}else if(Be===oa.MULTIPOINT){const be=X[p]-X[p-1];p++;const Ee=new Array(be);if(ie&&ie.length!==0){for(let Ge=0;Ge<be;Ge++){const Qe=2*ie[R++];Ee[Ge]=new U(ae[Qe],ae[Qe+1])}e[_++]=b.createMultiPoint(Ee)}else{for(let Ge=0;Ge<be;Ge++){const Qe=ae[T++],Dt=ae[T++];Ee[Ge]=new U(Qe,Dt)}e[_++]=b.createMultiPoint(Ee)}}else if(Be===oa.LINESTRING){let be,Ee=0;re?(Ee=Q[l]-Q[l-1],l++):Ee=$[n]-$[n-1],n++,ie&&ie.length!==0?(be=i.vertexBufferType===yo.VEC_2?Nf(ae,ie,R,Ee,!1):mg(ae,ie,R,Ee,!1,B),R+=Ee):(be=gg(ae,T,Ee,!1),T+=2*Ee),e[_++]=b.createLineString(be),X&&p++}else if(Be===oa.POLYGON){const be=$[n]-$[n-1];n++;const Ee=new Array(be-1);let Ge=Q[l]-Q[l-1];if(l++,ie&&ie.length!==0){const Qe=i.vertexBufferType===yo.VEC_2?Jp(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B);R+=Ge;for(let Dt=0;Dt<Ee.length;Dt++)Ge=Q[l]-Q[l-1],l++,Ee[Dt]=i.vertexBufferType===yo.VEC_2?Jp(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B),R+=Ge;e[_++]=b.createPolygon(Qe,Ee)}else{const Qe=Mf(ae,T,Ge);T+=2*Ge;for(let Dt=0;Dt<Ee.length;Dt++)Ge=Q[l]-Q[l-1],l++,Ee[Dt]=Mf(ae,T,Ge),T+=2*Ge;e[_++]=b.createPolygon(Qe,Ee)}X&&p++}else if(Be===oa.MULTILINESTRING){const be=X[p]-X[p-1];p++;const Ee=new Array(be);if(ie&&ie.length!==0){for(let Ge=0;Ge<be;Ge++){let Qe=0;re?(Qe=Q[l]-Q[l-1],l++):Qe=$[n]-$[n-1],n++;const Dt=i.vertexBufferType===yo.VEC_2?Nf(ae,ie,R,Qe,!1):mg(ae,ie,R,Qe,!1,B);Ee[Ge]=Dt,R+=Qe}e[_++]=b.createMultiLineString(Ee)}else{for(let Ge=0;Ge<be;Ge++){let Qe=0;re?(Qe=Q[l]-Q[l-1],l++):Qe=$[n]-$[n-1],n++,Ee[Ge]=gg(ae,T,Qe,!1),T+=2*Qe}e[_++]=b.createMultiLineString(Ee)}}else{if(Be!==oa.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const be=X[p]-X[p-1];p++;const Ee=new Array(be);let Ge=0;if(ie&&ie.length!==0){for(let Qe=0;Qe<be;Qe++){const Dt=$[n]-$[n-1];n++;const en=new Array(Dt-1);Ge=Q[l]-Q[l-1],l++;const Xt=i.vertexBufferType===yo.VEC_2?Jp(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B);R+=Ge;for(let hn=0;hn<en.length;hn++)Ge=Q[l]-Q[l-1],l++,en[hn]=i.vertexBufferType===yo.VEC_2?Jp(ae,ie,R,Ge):kf(ae,ie,R,Ge,0,B),R+=Ge;Ee[Qe]=b.createPolygon(Xt,en)}e[_++]=b.createMultiPolygon(Ee)}else{for(let Qe=0;Qe<be;Qe++){const Dt=$[n]-$[n-1];n++;const en=new Array(Dt-1);Ge=Q[l]-Q[l-1],l++;const Xt=Mf(ae,T,Ge);T+=2*Ge;for(let hn=0;hn<en.length;hn++){const In=Q[l]-Q[l-1];l++,en[hn]=Mf(ae,T,In),T+=2*In}Ee[Qe]=b.createPolygon(Xt,en)}e[_++]=b.createMultiPolygon(Ee)}}}}return e}function Mf(i,e,n){return gg(i,e,n,!0)}function Jp(i,e,n,l){return Nf(i,e,n,l,!0)}function kf(i,e,n,l,p,_){return mg(i,e,n,l,!0,_)}function gg(i,e,n,l){const p=new Array(l?n+1:n);for(let _=0;_<2*n;_+=2)p[_/2]=new U(i[e+_],i[e+_+1]);return l&&(p[p.length-1]=p[0]),p}function Nf(i,e,n,l,p){const _=new Array(p?l+1:l);for(let b=0;b<2*l;b+=2){const T=2*e[n+b/2];_[b/2]=new U(i[T],i[T+1])}return p&&(_[_.length-1]=_[0]),_}function mg(i,e,n,l,p,_){const b=new Array(p?l+1:l);for(let T=0;T<l;T++){const R=If(i[e[n+T]],_.numBits,_.coordinateShift);b[T]=new U(R.x,R.y)}return p&&(b[b.length-1]=b[0]),b}class Df{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,l,p,_){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=l,this._vertexBuffer=p,this._mortonSettings=_}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=pg(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=If(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return pg(this)}get mortonSettings(){return this._mortonSettings}}class Rf extends Df{_numGeometries;_geometryType;constructor(e,n,l,p,_,b,T){super(l,p,_,b,T),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===oa.POLYGON||this._geometryType===oa.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Pf extends Df{_geometryTypes;constructor(e,n,l,p,_,b){super(e,l,p,_,b),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===oa.POLYGON||this.geometryType(e)===oa.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Tm{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,l,p){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=l,this._topologyVector=p}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,l=n.partOffsets,p=n.ringOffsets,_=n.geometryOffsets;let b=0,T=1,R=1,B=1;for(let G=0;G<this.numGeometries;G++)switch(this.geometryType(G)){case oa.POLYGON:{const X=l[T]-l[T-1];T++;const $=[];for(let Q=0;Q<X;Q++){const ie=p[R]-p[R-1];R++;const re=[];for(let ae=0;ae<ie;ae++){const ye=this._vertexBuffer[b++],Be=this._vertexBuffer[b++];re.push(new U(ye,Be))}re.length>0&&re.push(re[0]),$.push(re)}e[G]=$,_&&B++}break;case oa.MULTIPOLYGON:{const X=_[B]-_[B-1];B++;const $=[];for(let Q=0;Q<X;Q++){const ie=l[T]-l[T-1];T++;for(let re=0;re<ie;re++){const ae=p[R]-p[R-1];R++;const ye=[];for(let Be=0;Be<ae;Be++){const be=this._vertexBuffer[b++],Ee=this._vertexBuffer[b++];ye.push(new U(be,Ee))}ye.length>0&&ye.push(ye[0]),$.push(ye)}}e[G]=$}}return e}[Symbol.iterator](){return null}}function Id(i,e,n,l,p,_){return new B1(i,e,n,l,p,_)}class B1 extends Tm{_numGeometries;_geometryType;constructor(e,n,l,p,_,b){super(l,p,_,b),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function yg(i,e,n,l,p){return new Im(i,e,n,l,p)}class Im extends Tm{_geometryTypes;constructor(e,n,l,p,_){super(n,l,p,_),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Mm(i,e,n,l,p){const _=$a(i,n);let b=null,T=null,R=null,B=null,G=null,X=null,$=null,Q=null;if(cu(_,l,i,n)===Vs.CONST){const re=cg(i,n,_,!1);for(let ae=0;ae<e-1;ae++){const ye=$a(i,n);switch(ye.physicalStreamType){case Sa.LENGTH:switch(ye.logicalStreamType.lengthType){case Ya.GEOMETRIES:b=Hu(i,n,ye);break;case Ya.PARTS:T=Hu(i,n,ye);break;case Ya.RINGS:R=Hu(i,n,ye);break;case Ya.TRIANGLES:$=Hu(i,n,ye)}break;case Sa.OFFSET:switch(ye.logicalStreamType.offsetType){case Vu.VERTEX:B=Ka(i,n,ye,!1);break;case Vu.INDEX:Q=Ka(i,n,ye,!1)}break;case Sa.DATA:ac.VERTEX===ye.logicalStreamType.dictionaryType?G=Ka(i,n,ye,!0):(X={numBits:ye.numBits,coordinateShift:ye.coordinateShift},G=Ka(i,n,ye,!1))}}return Q!==null?b!=null||T!=null?Id(l,re,$,Q,G,new uu(b,T,R)):Id(l,re,$,Q,G):X===null?(function(ae,ye,Be,be,Ee){return new Rf(ae,ye,yo.VEC_2,Be,be,Ee)})(l,re,new uu(b,T,R),B,G):(function(ae,ye,Be,be,Ee,Ge){return new Rf(ae,ye,yo.MORTON,Be,be,Ee,Ge)})(l,re,new uu(b,T,R),B,G,X)}const ie=Ka(i,n,_,!1);for(let re=0;re<e-1;re++){const ae=$a(i,n);switch(ae.physicalStreamType){case Sa.LENGTH:switch(ae.logicalStreamType.lengthType){case Ya.GEOMETRIES:b=Ka(i,n,ae,!1);break;case Ya.PARTS:T=Ka(i,n,ae,!1);break;case Ya.RINGS:R=Ka(i,n,ae,!1);break;case Ya.TRIANGLES:$=Hu(i,n,ae)}break;case Sa.OFFSET:switch(ae.logicalStreamType.offsetType){case Vu.VERTEX:B=Ka(i,n,ae,!1);break;case Vu.INDEX:Q=Ka(i,n,ae,!1)}break;case Sa.DATA:ac.VERTEX===ae.logicalStreamType.dictionaryType?G=Ka(i,n,ae,!0):(X={numBits:ae.numBits,coordinateShift:ae.coordinateShift},G=Ka(i,n,ae,!1))}}return Q!==null&&T===null?yg(ie,$,Q,G):(b!==null?(b=e0(ie,b,2),T!==null&&R!==null?(T=t0(ie,b,T,!1),R=(function(re,ae,ye,Be){const be=new Int32Array(ye[ye.length-1]+1);let Ee=0;be[0]=Ee;let Ge=1,Qe=1,Dt=0;for(let en=0;en<re.length;en++){const Xt=re[en],hn=ae[en+1]-ae[en];if(Xt!==0&&Xt!==3)for(let In=0;In<hn;In++){const fn=ye[Ge]-ye[Ge-1];Ge++;for(let Kt=0;Kt<fn;Kt++)Ee=be[Qe++]=Ee+Be[Dt++]}else for(let In=0;In<hn;In++)be[Qe++]=++Ee,Ge++}return be})(ie,b,T,R)):T!==null&&(T=(function(re,ae,ye){const Be=new Int32Array(ae[ae.length-1]+1);let be=0;Be[0]=be;let Ee=1,Ge=0;for(let Qe=0;Qe<re.length;Qe++){const Dt=re[Qe],en=ae[Qe+1]-ae[Qe];if(Dt===4||Dt===1)for(let Xt=0;Xt<en;Xt++)be=Be[Ee++]=be+ye[Ge++];else for(let Xt=0;Xt<en;Xt++)Be[Ee++]=++be}return Be})(ie,b,T))):T!==null&&R!==null?(T=e0(ie,T,1),R=t0(ie,T,R,!0)):T!==null&&(T=e0(ie,T,0)),Q!==null?yg(ie,$,Q,G,new uu(b,T,R)):X===null?(function(re,ae,ye,Be){return new Pf(yo.VEC_2,re,ae,ye,Be)})(ie,new uu(b,T,R),B,G):(function(re,ae,ye,Be,be){return new Pf(yo.MORTON,re,ae,ye,Be,be)})(ie,new uu(b,T,R),B,G,X))}function e0(i,e,n){const l=new Int32Array(i.length+1);let p=0;l[0]=p;let _=0;for(let b=0;b<i.length;b++)p=l[b+1]=p+(i[b]>n?e[_++]:1);return l}function t0(i,e,n,l){const p=new Int32Array(e[e.length-1]+1);let _=0;p[0]=_;let b=1,T=0;for(let R=0;R<i.length;R++){const B=i[R],G=e[R+1]-e[R];if(B===5||B===2||l&&(B===4||B===1))for(let X=0;X<G;X++)_=p[b++]=_+n[T++];else for(let X=0;X<G;X++)p[b++]=++_}return p}class km extends ju{dataVector;constructor(e,n,l){super(e,n.getBuffer(),l),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class Nm extends Xp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Of extends ju{constructor(e,n,l){super(e,BigInt64Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function zf(i,e,n){return Dm(i,Math.ceil(e/8),n)}function Dm(i,e,n){const l=new Uint8Array(e);let p=0;for(;p<e;){const _=i[n.increment()];if(_<=127){const b=_+3,T=i[n.increment()],R=p+b;l.fill(T,p,R),p=R}else{const b=256-_;for(let T=0;T<b;T++)l[p++]=i[n.increment()]}}return l}const xg=new TextDecoder;function Lf(i,e,n){return n-e>=12?xg.decode(i.subarray(e,n)):(function(l,p,_){let b="",T=p;for(;T<_;){const R=l[T];let B,G,X,$=null,Q=R>239?4:R>223?3:R>191?2:1;if(T+Q>_)break;Q===1?R<128&&($=R):Q===2?(B=l[T+1],(192&B)==128&&($=(31&R)<<6|63&B,$<=127&&($=null))):Q===3?(B=l[T+1],G=l[T+2],(192&B)==128&&(192&G)==128&&($=(15&R)<<12|(63&B)<<6|63&G,($<=2047||$>=55296&&$<=57343)&&($=null))):Q===4&&(B=l[T+1],G=l[T+2],X=l[T+3],(192&B)==128&&(192&G)==128&&(192&X)==128&&($=(15&R)<<18|(63&B)<<12|(63&G)<<6|63&X,($<=65535||$>=1114112)&&($=null))),$===null?($=65533,Q=1):$>65535&&($-=65536,b+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),b+=String.fromCharCode($),T+=Q}return b})(i,e,n)}class Md extends ju{offsetBuffer;constructor(e,n,l,p){super(e,l,p),this.offsetBuffer=n}}class n0 extends Md{textEncoder;constructor(e,n,l,p){super(e,n,l,p??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Lf(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Dh extends Md{indexBuffer;textEncoder;constructor(e,n,l,p,_){super(e,l,p,_??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Lf(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class i0 extends Md{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,l,p,_,b,T){super(e,l,p,T),this.indexBuffer=n,this.symbolOffsetBuffer=_,this.symbolTableBuffer=b,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(l,p,_){const b=[],T=new Array(p.length).fill(0);for(let R=1;R<p.length;R++)T[R]=T[R-1]+p[R-1];for(let R=0;R<_.length;R++)if(_[R]===255)b.push(_[++R]);else{const B=p[_[R]],G=T[_[R]];for(let X=0;X<B;X++)b.push(l[G+X])}return new Uint8Array(b)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Lf(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let l=e[0];for(let p=1;p<e.length;p++){const _=e[p];n[p-1]=_-l,l=_}return n}}function qu(i,e,n,l,p,_){return n.type==="scalarType"?(function(b,T,R,B,G,X){let $=null,Q=0;if(b===0)return null;if(X.nullable){const re=$a(T,R);Q=re.numValues;const ae=R.get(),ye=zf(T,Q,R);R.set(ae+re.byteLength),$=new oc(ye,re.numValues)}const ie=$??B;switch(G.physicalType){case 4:case 3:return(function(re,ae,ye,Be,be){const Ee=$a(re,ae),Ge=cu(Ee,be,re,ae),Qe=Be.physicalType===3;if(Ge===Vs.FLAT){const Dt=Nl(be)?dg(re,ae,Ee,Qe,be):Ka(re,ae,Ee,Qe);return new Wp(ye.name,Dt,be)}if(Ge===Vs.SEQUENCE){const Dt=ug(re,ae,Ee);return new sg(ye.name,Dt[0],Dt[1],Ee.numRleValues)}{const Dt=cg(re,ae,Ee,Qe);return new ag(ye.name,Dt,be)}})(T,R,X,G,ie);case 9:return(function(re,ae,ye,Be,be){let Ee=null,Ge=null,Qe=null,Dt=null,en=null,Xt=null,hn=null,In=null;for(let fn=0;fn<Be;fn++){const Kt=$a(ae,ye);if(Kt.byteLength!==0)switch(Kt.physicalStreamType){case Sa.PRESENT:{const Ut=zf(ae,Kt.numValues,ye);Xt=new oc(Ut,Kt.numValues);break}case Sa.OFFSET:Ge=be!=null||Xt!=null?dg(ae,ye,Kt,!1,be??Xt):Ka(ae,ye,Kt,!1);break;case Sa.LENGTH:{const Ut=Hu(ae,ye,Kt);Ya.DICTIONARY===Kt.logicalStreamType.lengthType?Ee=Ut:Ya.SYMBOL===Kt.logicalStreamType.lengthType?Dt=Ut:hn=Ut;break}case Sa.DATA:{const Ut=ae.subarray(ye.get(),ye.get()+Kt.byteLength);ye.add(Kt.byteLength);const Vn=Kt.logicalStreamType.dictionaryType;ac.FSST===Vn?en=Ut:ac.SINGLE===Vn||ac.SHARED===Vn?Qe=Ut:ac.NONE===Vn&&(In=Ut);break}}}return(function(fn,Kt,Ut,Vn,zn,Wn,Pn){return Kt?new i0(fn,Ut,Vn,zn,Wn,Kt,Pn):null})(re,en,Ge,Ee,Qe,Dt,be??Xt)??(function(fn,Kt,Ut,Vn,zn){return Kt?zn?new Dh(fn,Ut,Vn,Kt,zn):new Dh(fn,Ut,Vn,Kt):null})(re,Qe,Ge,Ee,be??Xt)??(function(fn,Kt,Ut,Vn,zn){if(!Kt||!Ut)return null;if(Vn)return zn?new Dh(fn,Vn,Kt,Ut,zn):new Dh(fn,Vn,Kt,Ut);if(zn&&zn.size()!==Kt.length-1){const Wn=new Int32Array(zn.size());let Pn=0;for(let hi=0;hi<zn.size();hi++)Wn[hi]=zn.get(hi)?Pn++:0;return new Dh(fn,Wn,Kt,Ut,zn)}return zn?new n0(fn,Kt,Ut,zn):new n0(fn,Kt,Ut)})(re,hn,In,Ge,be??Xt)})(X.name,T,R,X.nullable?b-1:b,$);case 0:return(function(re,ae,ye,Be,be){const Ee=$a(re,ae),Ge=Ee.numValues,Qe=ae.get(),Dt=Nl(be)?(function(Xt,hn,In,fn){const Kt=Dm(Xt,Math.ceil(hn/8),In),Ut=new oc(Kt,hn),Vn=fn.size(),zn=new oc(new Uint8Array(Vn),Vn);let Wn=0;for(let Pn=0;Pn<fn.size();Pn++){const hi=!!fn.get(Pn)&&Ut.get(Wn++);zn.set(Pn,hi)}return zn.getBuffer()})(re,Ge,ae,be):zf(re,Ge,ae);ae.set(Qe+Ee.byteLength);const en=new oc(Dt,Ge);return new km(ye.name,en,be)})(T,R,X,0,ie);case 6:case 5:return(function(re,ae,ye,Be,be){const Ee=$a(re,ae),Ge=cu(Ee,Be,re,ae),Qe=be.physicalType===5;if(Ge===Vs.FLAT){const Dt=Nl(Be)?(function(en,Xt,hn,In,fn){return(function(Kt,Ut,Vn,zn){switch(Ut.logicalLevelTechnique1){case Wi.DELTA:return Ut.logicalLevelTechnique2===Wi.RLE&&(Kt=Sm(Kt,Ut.runs,Ut.numRleValues)),(function(Wn,Pn){const hi=new BigInt64Array(Wn.size());let mr=0;Wn.get(0)?(hi[0]=Wn.get(0)?Pn[0]>>1n^-(1n&Pn[0]):0n,mr=1):hi[0]=0n;let er=1;for(;er!=hi.length;++er)hi[er]=Wn.get(er)?hi[er-1]+(Pn[mr]>>1n^-(1n&Pn[mr++])):hi[er-1];return hi})(zn,Kt);case Wi.RLE:return(function(Wn,Pn,hi,mr){const er=Pn;return hi?(function(_s,Qa,ca){const bs=new BigInt64Array(_s.size());let fs=0;for(let Lr=0;Lr<ca;Lr++){const Ps=Number(Qa[Lr]);let Gs=Qa[Lr+ca];Gs=Gs>>1n^-(1n&Gs);for(let ls=fs;ls<fs+Ps;ls++)_s.get(ls)?bs[ls]=Gs:(bs[ls]=0n,fs++);fs+=Ps}return bs})(mr,Wn,er.runs):(function(_s,Qa,ca){const bs=new BigInt64Array(_s.size());let fs=0;for(let Lr=0;Lr<ca;Lr++){const Ps=Number(Qa[Lr]),Gs=Qa[Lr+ca];for(let ls=fs;ls<fs+Ps;ls++)_s.get(ls)?bs[ls]=Gs:(bs[ls]=0n,fs++);fs+=Ps}return bs})(mr,Wn,er.runs)})(Kt,Ut,Vn,zn);case Wi.NONE:return Kt=Vn?(function(Wn,Pn){const hi=new BigInt64Array(Wn.size());let mr=0,er=0;for(;er!=hi.length;++er)if(Wn.get(er)){const _s=Pn[mr++];hi[er]=_s>>1n^-(1n&_s)}else hi[er]=0n;return hi})(zn,Kt):(function(Wn,Pn){const hi=new BigInt64Array(Wn.size());let mr=0,er=0;for(;er!=hi.length;++er)hi[er]=Wn.get(er)?Pn[mr++]:0n;return hi})(zn,Kt),Kt;default:throw new Error("The specified Logical level technique is not supported")}})(Tf(en,Xt,hn.numValues),hn,In,fn)})(re,ae,Ee,Qe,Be):Cd(re,ae,Ee,Qe);return new Td(ye.name,Dt,Be)}if(Ge===Vs.SEQUENCE){const Dt=Nh(re,ae,Ee);return new fg(ye.name,Dt[0],Dt[1],Ee.numRleValues)}{const Dt=hg(re,ae,Ee,Qe);return new Of(ye.name,Dt,Be)}})(T,R,X,ie,G);case 7:return(function(re,ae,ye,Be){const be=$a(re,ae),Ee=Nl(Be)?(function(Ge,Qe,Dt,en){const Xt=Qe.get(),hn=Xt+en*Float32Array.BYTES_PER_ELEMENT,In=new Uint8Array(Ge.subarray(Xt,hn)).buffer,fn=new Float32Array(In);Qe.set(hn);const Kt=Dt.size(),Ut=new Float32Array(Kt);let Vn=0;for(let zn=0;zn<Kt;zn++)Ut[zn]=Dt.get(zn)?fn[Vn++]:0;return Ut})(re,ae,Be,be.numValues):(function(Ge,Qe,Dt){const en=Qe.get(),Xt=en+Dt*Float32Array.BYTES_PER_ELEMENT,hn=new Uint8Array(Ge.subarray(en,Xt)).buffer,In=new Float32Array(hn);return Qe.set(Xt),In})(re,ae,be.numValues);return new Nm(ye.name,Ee,Be)})(T,R,X,ie);case 8:return(function(re,ae,ye,Be){const be=$a(re,ae),Ee=Nl(Be)?(function(Ge,Qe,Dt,en){const Xt=Qe.get(),hn=Xt+en*Float64Array.BYTES_PER_ELEMENT,In=new Uint8Array(Ge.subarray(Xt,hn)).buffer,fn=new Float64Array(In);Qe.set(hn);const Kt=Dt.size(),Ut=new Float64Array(Kt);let Vn=0;for(let zn=0;zn<Kt;zn++)Ut[zn]=Dt.get(zn)?fn[Vn++]:0;return Ut})(re,ae,Be,be.numValues):(function(Ge,Qe,Dt){const en=Qe.get(),Xt=en+Dt*Float64Array.BYTES_PER_ELEMENT,hn=new Uint8Array(Ge.subarray(en,Xt)).buffer,In=new Float64Array(hn);return Qe.set(Xt),In})(re,ae,be.numValues);return new ig(ye.name,Ee,Be)})(T,R,X,ie);default:throw new Error(`The specified data type for the field is currently not supported: ${G}`)}})(l,i,e,p,n.scalarType,n):l!=1?null:(function(b,T,R,B){let G=null,X=null,$=null,Q=null,ie=!1;for(;!ie;){const Be=$a(b,T);switch(Be.physicalStreamType){case Sa.LENGTH:Ya.DICTIONARY===Be.logicalStreamType.lengthType?G=Hu(b,T,Be):$=Hu(b,T,Be);break;case Sa.DATA:ac.SINGLE===Be.logicalStreamType.dictionaryType||ac.SHARED===Be.logicalStreamType.dictionaryType?(X=b.subarray(T.get(),T.get()+Be.byteLength),ie=!0):Q=b.subarray(T.get(),T.get()+Be.byteLength),T.add(Be.byteLength)}}const re=R.complexType.children,ae=[];let ye=0;for(const Be of re){const be=la(b,T,1)[0];if(be==0)continue;const Ee=`${R.name}${Be.name==="default"?"":":"+Be.name}`;if(be!==2||Be.type!=="scalarField"||Be.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Ge=$a(b,T),Qe=zf(b,Ge.numValues,T),Dt=$a(b,T),en=Dt.decompressedCount!==B?dg(b,T,Dt,!1,new oc(Qe,Ge.numValues)):Ka(b,T,Dt,!1);ae[ye++]=Q?new i0(Ee,en,G,X,$,Q,new oc(Qe,Ge.numValues)):new Dh(Ee,en,G,X,new oc(Qe,Ge.numValues))}return ae})(i,e,n,p)}function Nl(i){return i instanceof oc}function Zu(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Bf=new TextDecoder;function kd(i,e){const n=la(i,e,1)[0];if(n===0)return"";const l=e.get(),p=i.subarray(l,l+n);return e.add(n),Bf.decode(p)}function hu(i,e){const n=la(i,e,1)[0]>>>0,l=!!(4&n),p=!!(2&n),_=la(i,e,1)[0]>>>0,b={};if(1&n&&(b.nullable=!0),p){const T={};if(l?(T.type="logicalType",T.logicalType=_):(T.type="physicalType",T.physicalType=_),8&n){const R=la(i,e,1)[0]>>>0;T.children=new Array(R);for(let B=0;B<R;B++)T.children[B]=hu(i,e)}b.type="complexField",b.complexField=T}else{const T={};l?(T.type="logicalType",T.logicalType=_):(T.type="physicalType",T.physicalType=_),b.type="scalarField",b.scalarField=T}return b}function F1(i,e){const n=la(i,e,1)[0]>>>0,l=(function(p){switch(p){case 0:case 1:case 2:case 3:{const _={};_.nullable=!!(1&p),_.columnScope=0;const b={};return b.physicalType=p>1?6:4,b.type="physicalType",_.scalarType=b,_.type="scalarType",_}case 4:{const _={nullable:!1,columnScope:0},b={type:"physicalType",physicalType:0};return _.type="complexType",_.complexType=b,_}case 30:{const _={nullable:!1,columnScope:0},b={type:"physicalType",physicalType:1};return _.type="complexType",_.complexType=b,_}default:return(function(_){let b=null;switch(_){case 10:case 11:b=0;break;case 12:case 13:b=1;break;case 14:case 15:b=2;break;case 16:case 17:b=3;break;case 18:case 19:b=4;break;case 20:case 21:b=5;break;case 22:case 23:b=6;break;case 24:case 25:b=7;break;case 26:case 27:b=8;break;case 28:case 29:b=9;break;default:return null}const T={};T.nullable=!!(1&_),T.columnScope=0;const R={type:"physicalType"};return R.physicalType=b,T.type="scalarType",T.scalarType=R,T})(p)}})(n);if(!l)throw new Error(`Unsupported column type code: ${n}`);if((function(p){return p>=10})(n)?l.name=kd(i,e):n>=0&&n<=3?l.name="id":n===4&&(l.name="geometry"),(function(p){return p===30})(n)){const p=la(i,e,1)[0]>>>0,_=l.complexType;_.children=new Array(p);for(let b=0;b<p;b++)_.children[b]=hu(i,e)}return l}function Rm(i,e){const n={featureTables:[]},l={};l.name=kd(i,e);const p=la(i,e,1)[0]>>>0,_=la(i,e,1)[0]>>>0;l.columns=new Array(_);for(let b=0;b<_;b++)l.columns[b]=F1(i,e);return n.featureTables.push(l),[n,p]}function Ff(i,e,n,l,p,_,b=!1){const T=e.scalarType.physicalType,R=cu(p,_,i,n);if(T===4)switch(R){case Vs.FLAT:{const B=Ka(i,n,p,!1);return new Wp(l,B,_)}case Vs.SEQUENCE:{const B=ug(i,n,p);return new sg(l,B[0],B[1],p.numRleValues)}case Vs.CONST:{const B=cg(i,n,p,!1);return new ag(l,B,_)}}else switch(R){case Vs.FLAT:{if(b){const G=(function(X,$,Q,ie){const re=(function(ae,ye,Be){const be=new Float64Array(ye);for(let Ee=0;Ee<ye;Ee++)be[Ee]=Em(ae,Be);return be})(X,Q.numValues,$);return(function(ae,ye,Be){switch(ye.logicalLevelTechnique1){case Wi.DELTA:return ye.logicalLevelTechnique2===Wi.RLE&&(ae=Cm(ae,ye.runs,ye.numRleValues)),(function(be){be[0]=be[0]%2==1?(be[0]+1)/-2:be[0]/2;const Ee=be.length/4*4;let Ge=1;if(Ee>=4)for(;Ge<Ee-4;Ge+=4){const Qe=be[Ge],Dt=be[Ge+1],en=be[Ge+2],Xt=be[Ge+3];be[Ge]=(Qe%2==1?(Qe+1)/-2:Qe/2)+be[Ge-1],be[Ge+1]=(Dt%2==1?(Dt+1)/-2:Dt/2)+be[Ge],be[Ge+2]=(en%2==1?(en+1)/-2:en/2)+be[Ge+1],be[Ge+3]=(Xt%2==1?(Xt+1)/-2:Xt/2)+be[Ge+2]}for(;Ge!=be.length;++Ge)be[Ge]=(be[Ge]%2==1?(be[Ge]+1)/-2:be[Ge]/2)+be[Ge-1]})(ae),ae;case Wi.RLE:return(function(be,Ee,Ge){return Cm(be,Ee.runs,Ee.numRleValues)})(ae,ye);case Wi.NONE:return ae;default:throw new Error(`The specified Logical level technique is not supported: ${ye.logicalLevelTechnique1}`)}})(re,Q)})(i,n,p);return new ig(l,G,_)}const B=Cd(i,n,p,!1);return new Td(l,B,_)}case Vs.SEQUENCE:{const B=Nh(i,n,p);return new fg(l,B[0],B[1],p.numRleValues)}case Vs.CONST:{const B=hg(i,n,p,!1);return new Of(l,B,_)}}throw new Error("Vector type not supported for id column.")}class j1{constructor(e,n){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case oa.POINT:case oa.MULTIPOINT:this.type=1;break;case oa.LINESTRING:case oa.MULTILINESTRING:this.type=2;break;case oa.POLYGON:case oa.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const l=[];for(const p of n)l.push(new U(p.x,p.y));e.push(l)}return e}}class Pm{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new j1(this.features[e],this.extent)}}class jf{constructor(e){this.layers={};const n=(function(l,p,_=!0){const b=new Am(0),T=[];for(;b.get()<l.length;){const R=la(l,b,1)[0]>>>0,B=b.get()+R;if(B>l.length)throw new Error(`Block overruns tile: ${B} > ${l.length}`);if(la(l,b,1)[0]>>>0!=1){b.set(B);continue}const G=Rm(l,b),X=G[1],$=G[0].featureTables[0];let Q=null,ie=null;const re=[];let ae=0;for(const Be of $.columns){const be=Be.name;if(be==="id"){let Ee=null;if(Be.nullable){const Qe=$a(l,b),Dt=b.get(),en=zf(l,Qe.numValues,b);b.set(Dt+Qe.byteLength),Ee=new oc(en,Qe.numValues)}const Ge=$a(l,b);ae=Ge.decompressedCount,Q=Ff(l,Be,b,be,Ge,Ee??ae,_)}else if(be==="geometry"){const Ee=la(l,b,1)[0];if(ae===0){const Ge=b.get();ae=$a(l,b).decompressedCount,b.set(Ge)}ie=Mm(l,Ee,b,ae)}else{const Ee=Zu(Be)?la(l,b,1)[0]:1;if(Ee===0&&Be.type==="scalarType")continue;const Ge=qu(l,b,Be,Ee,ae);if(Ge)if(Array.isArray(Ge))for(const Qe of Ge)re.push(Qe);else re.push(Ge)}}const ye=new Uu($.name,ie,Q,re,X);T.push(ye),b.set(B)}return T})(new Uint8Array(e));this.layers=n.reduce(((l,p)=>Object.assign(Object.assign({},l),{[p.name]:new Pm(p)})),{})}}class Om{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of n){const p=[];for(const _ of l)p.push(new U(_[0],_[1]));e.push(p)}return e}}const Uf="_geojsonTileLayer";function r0(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let _=0;_<i.length;_++)n.feature=i.feature(_),e.writeMessage(2,s0,n);const l=n.keys;for(const _ of l)e.writeStringField(3,_);const p=n.values;for(const _ of p)e.writeMessage(4,a0,_)}function s0(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,zm,i),e.writeVarintField(3,n.type),e.writeMessage(4,bg,n)}function zm(i,e){for(const n in i.feature?.properties){let l=i.feature.properties[n],p=i.keycache[n];if(l==null)continue;p===void 0&&(i.keys.push(n),p=i.keys.length-1,i.keycache[n]=p),e.writeVarint(p),typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"&&(l=JSON.stringify(l));const _=typeof l+":"+l;let b=i.valuecache[_];b===void 0&&(i.values.push(l),b=i.values.length-1,i.valuecache[_]=b),e.writeVarint(b)}}function Xu(i,e){return(e<<3)+(7&i)}function _g(i){return i<<1^i>>31}function bg(i,e){const n=i.loadGeometry(),l=i.type;let p=0,_=0;for(const b of n){let T=1;l===1&&(T=b.length),e.writeVarint(Xu(1,T));const R=l===3?b.length-1:b.length;for(let B=0;B<R;B++){B===1&&l!==1&&e.writeVarint(Xu(2,R-1));const G=b[B].x-p,X=b[B].y-_;e.writeVarint(_g(G)),e.writeVarint(_g(X)),p+=G,_+=X}i.type===3&&e.writeVarint(Xu(7,1))}}function a0(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class vg{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vc(Tt,16,0),this.grid3D=new vc(Tt,16,0),this.featureIndexArray=new fe,this.promoteId=n}insert(e,n,l,p,_,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,_);const R=b?this.grid3D:this.grid;for(let B=0;B<n.length;B++){const G=n[B],X=[1/0,1/0,-1/0,-1/0];for(let $=0;$<G.length;$++){const Q=G[$];X[0]=Math.min(X[0],Q.x),X[1]=Math.min(X[1],Q.y),X[2]=Math.max(X[2],Q.x),X[3]=Math.max(X[3],Q.y)}X[0]<Tt&&X[1]<Tt&&X[2]>=0&&X[3]>=0&&R.insert(T,X[0],X[1],X[2],X[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new fr(new Dp(this.rawTileData)).layers:new jf(this.rawTileData).layers,this.sourceLayerCoder=new ng(this.vtLayers?Object.keys(this.vtLayers).sort():[Uf])),this.vtLayers}query(e,n,l,p){this.loadVTLayers();const _=e.params,b=Tt/e.tileSize/e.scale,T=Va(_.filter,_.globalState),R=e.queryGeometry,B=e.queryPadding*b,G=Fu.fromPoints(R),X=this.grid.query(G.minX-B,G.minY-B,G.maxX+B,G.maxY+B),$=Fu.fromPoints(e.cameraQueryGeometry).expandBy(B),Q=this.grid3D.query($.minX,$.minY,$.maxX,$.maxY,((ae,ye,Be,be)=>(function(Ee,Ge,Qe,Dt,en){for(const hn of Ee)if(Ge<=hn.x&&Qe<=hn.y&&Dt>=hn.x&&en>=hn.y)return!0;const Xt=[new U(Ge,Qe),new U(Ge,en),new U(Dt,en),new U(Dt,Qe)];if(Ee.length>2){for(const hn of Xt)if(Cc(Ee,hn))return!0}for(let hn=0;hn<Ee.length-1;hn++)if(Ug(Ee[hn],Ee[hn+1],Xt))return!0;return!1})(e.cameraQueryGeometry,ae-B,ye-B,Be+B,be+B)));for(const ae of Q)X.push(ae);X.sort(o0);const ie={};let re;for(let ae=0;ae<X.length;ae++){const ye=X[ae];if(ye===re)continue;re=ye;const Be=this.featureIndexArray.get(ye);let be=null;this.loadMatchingFeature(ie,Be.bucketIndex,Be.sourceLayerIndex,Be.featureIndex,T,_.layers,_.availableImages,n,l,p,((Ee,Ge,Qe)=>(be||(be=tc(Ee)),Ge.queryIntersectsFeature({queryGeometry:R,feature:Ee,featureState:Qe,geometry:be,zoom:this.z,transform:e.transform,pixelsToTileUnits:b,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return ie}loadMatchingFeature(e,n,l,p,_,b,T,R,B,G,X){const $=this.bucketLayerIDs[n];if(b&&!$.some((ae=>b.has(ae))))return;const Q=this.sourceLayerCoder.decode(l),ie=this.vtLayers[Q].feature(p);if(_.needGeometry){const ae=Ko(ie,!0);if(!_.filter(new Ir(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!_.filter(new Ir(this.tileID.overscaledZ),ie))return;const re=this.getId(ie,Q);for(let ae=0;ae<$.length;ae++){const ye=$[ae];if(b&&!b.has(ye))continue;const Be=R[ye];if(!Be)continue;let be={};re&&G&&(be=G.getState(Be.sourceLayer||Uf,re));const Ee=un({},B[ye]);Ee.paint=Lm(Ee.paint,Be.paint,ie,be,T),Ee.layout=Lm(Ee.layout,Be.layout,ie,be,T);const Ge=!X||X(ie,Be,be);if(!Ge)continue;const Qe=new Zp(ie,this.z,this.x,this.y,re);Qe.layer=Ee;let Dt=e[ye];Dt===void 0&&(Dt=e[ye]=[]),Dt.push({featureIndex:p,feature:Qe,intersectionZ:Ge})}}lookupSymbolFeatures(e,n,l,p,_,b,T,R){const B={};this.loadVTLayers();const G=Va(_.filterSpec,_.globalState);for(const X of e)this.loadMatchingFeature(B,l,p,X,G,b,T,R,n);return B}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){var l;let p=e.id;return this.promoteId&&(p=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(p=Number(e.properties.cluster_id))),p}}function Lm(i,e,n,l,p){return kn(i,((_,b)=>{const T=e instanceof Xc?e.get(b):null;return T&&T.evaluate?T.evaluate(n,l,p):T}))}function o0(i,e){return e-i}function r(i,e,n,l,p){const _=[];for(let b=0;b<i.length;b++){const T=i[b];let R;for(let B=0;B<T.length-1;B++){let G=T[B],X=T[B+1];G.x<e&&X.x<e||(G.x<e?G=new U(e,G.y+(e-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x<e&&(X=new U(e,G.y+(e-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y<n&&X.y<n||(G.y<n?G=new U(G.x+(n-G.y)/(X.y-G.y)*(X.x-G.x),n)._round():X.y<n&&(X=new U(G.x+(n-G.y)/(X.y-G.y)*(X.x-G.x),n)._round()),G.x>=l&&X.x>=l||(G.x>=l?G=new U(l,G.y+(l-G.x)/(X.x-G.x)*(X.y-G.y))._round():X.x>=l&&(X=new U(l,G.y+(l-G.x)/(X.x-G.x)*(X.y-G.y))._round()),G.y>=p&&X.y>=p||(G.y>=p?G=new U(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round():X.y>=p&&(X=new U(G.x+(p-G.y)/(X.y-G.y)*(X.x-G.x),p)._round()),R&&G.equals(R[R.length-1])||(R=[G],_.push(R)),R.push(X)))))}}return _}function o(i,e,n,l,p){switch(e){case 1:return(function(_,b,T,R){const B=[];for(const G of _)for(const X of G){const $=R===0?X.x:X.y;$>=b&&$<=T&&B.push([X])}return B})(i,n,l,p);case 2:return E(i,n,l,p,!1);case 3:return E(i,n,l,p,!0)}return[]}function m(i,e,n,l,p){const _=l===0?L:V;let b=[];const T=[];for(let G=0;G<i.length-1;G++){const X=i[G],$=i[G+1],Q=l===0?X.x:X.y,ie=l===0?$.x:$.y;let re=!1;Q<e?ie>e&&b.push(_(X,$,e)):Q>n?ie<n&&b.push(_(X,$,n)):b.push(X),ie<e&&Q>=e&&(b.push(_(X,$,e)),re=!0),ie>n&&Q<=n&&(b.push(_(X,$,n)),re=!0),!p&&re&&(T.push(b),b=[])}const R=i.length-1,B=l===0?i[R].x:i[R].y;return B>=e&&B<=n&&b.push(i[R]),p&&b.length>0&&!b[0].equals(b[b.length-1])&&b.push(new U(b[0].x,b[0].y)),b.length>0&&T.push(b),T}function E(i,e,n,l,p){const _=[];for(const b of i){const T=m(b,e,n,l,p);T.length>0&&_.push(...T)}return _}function L(i,e,n){return new U(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function V(i,e,n){return new U(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}On("FeatureIndex",vg,{omit:["rawTileData","sourceLayerCoder"]});class ne extends U{constructor(e,n,l,p){super(e,n),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new ne(this.x,this.y,this.angle,this.segment)}}function Ae(i,e,n,l,p){if(e.segment===void 0||n===0)return!0;let _=e,b=e.segment+1,T=0;for(;T>-n/2;){if(b--,b<0)return!1;T-=i[b].dist(_),_=i[b]}T+=i[b].dist(i[b+1]),b++;const R=[];let B=0;for(;T<n/2;){const G=i[b],X=i[b+1];if(!X)return!1;let $=i[b-1].angleTo(G)-G.angleTo(X);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:T,angleDelta:$}),B+=$;T-R[0].distance>l;)B-=R.shift().angleDelta;if(B>p)return!1;b++,T+=G.dist(X)}return!0}function lt(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function Vt(i,e,n){return i?.6*e*n:0}function rn(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function pn(i,e,n,l,p,_){const b=Vt(n,p,_),T=rn(n,l)*_;let R=0;const B=lt(i)/2;for(let G=0;G<i.length-1;G++){const X=i[G],$=i[G+1],Q=X.dist($);if(R+Q>B){const ie=(B-R)/Q,re=sr.number(X.x,$.x,ie),ae=sr.number(X.y,$.y,ie),ye=new ne(re,ae,$.angleTo(X),G);return ye._round(),!b||Ae(i,ye,T,b,e)?ye:void 0}R+=Q}}function Gt(i,e,n,l,p,_,b,T,R){const B=Vt(l,_,b),G=rn(l,p),X=G*b,$=i[0].x===0||i[0].x===R||i[0].y===0||i[0].y===R;return e-X<e/4&&(e=X+e/4),$t(i,$?e/2*T%e:(G/2+2*_)*b*T%e,e,B,n,X,$,!1,R)}function $t(i,e,n,l,p,_,b,T,R){const B=_/2,G=lt(i);let X=0,$=e-n,Q=[];for(let ie=0;ie<i.length-1;ie++){const re=i[ie],ae=i[ie+1],ye=re.dist(ae),Be=ae.angleTo(re);for(;$+n<X+ye;){$+=n;const be=($-X)/ye,Ee=sr.number(re.x,ae.x,be),Ge=sr.number(re.y,ae.y,be);if(Ee>=0&&Ee<R&&Ge>=0&&Ge<R&&$-B>=0&&$+B<=G){const Qe=new ne(Ee,Ge,Be,ie);Qe._round(),l&&!Ae(i,Qe,_,l,p)||Q.push(Qe)}}X+=ye}return T||Q.length||b||(Q=$t(i,X/2,n,l,p,_,b,!0,R)),Q}function ci(i,e,n,l){const p=[],_=i.image,b=_.pixelRatio,T=_.paddedRect.w-2,R=_.paddedRect.h-2;let B={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const G=_.stretchX||[[0,T]],X=_.stretchY||[[0,R]],$=(Ut,Vn)=>Ut+Vn[1]-Vn[0],Q=G.reduce($,0),ie=X.reduce($,0),re=T-Q,ae=R-ie;let ye=0,Be=Q,be=0,Ee=ie,Ge=0,Qe=re,Dt=0,en=ae;if(_.content&&l){const Ut=_.content,Vn=Ut[2]-Ut[0],zn=Ut[3]-Ut[1];(_.textFitWidth||_.textFitHeight)&&(B=lu(i)),ye=Ii(G,0,Ut[0]),be=Ii(X,0,Ut[1]),Be=Ii(G,Ut[0],Ut[2]),Ee=Ii(X,Ut[1],Ut[3]),Ge=Ut[0]-ye,Dt=Ut[1]-be,Qe=Vn-Be,en=zn-Ee}const Xt=B.x1,hn=B.y1,In=B.x2-Xt,fn=B.y2-hn,Kt=(Ut,Vn,zn,Wn)=>{const Pn=Ct(Ut.stretch-ye,Be,In,Xt),hi=gt(Ut.fixed-Ge,Qe,Ut.stretch,Q),mr=Ct(Vn.stretch-be,Ee,fn,hn),er=gt(Vn.fixed-Dt,en,Vn.stretch,ie),_s=Ct(zn.stretch-ye,Be,In,Xt),Qa=gt(zn.fixed-Ge,Qe,zn.stretch,Q),ca=Ct(Wn.stretch-be,Ee,fn,hn),bs=gt(Wn.fixed-Dt,en,Wn.stretch,ie),fs=new U(Pn,mr),Lr=new U(_s,mr),Ps=new U(_s,ca),Gs=new U(Pn,ca),ls=new U(hi/b,er/b),tl=new U(Qa/b,bs/b),Ja=e*Math.PI/180;if(Ja){const Ta=Math.sin(Ja),Cs=Math.cos(Ja),ua=[Cs,-Ta,Ta,Cs];fs._matMult(ua),Lr._matMult(ua),Gs._matMult(ua),Ps._matMult(ua)}const nl=Ut.stretch+Ut.fixed,Dc=Vn.stretch+Vn.fixed;return{tl:fs,tr:Lr,bl:Gs,br:Ps,tex:{x:_.paddedRect.x+1+nl,y:_.paddedRect.y+1+Dc,w:zn.stretch+zn.fixed-nl,h:Wn.stretch+Wn.fixed-Dc},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ls,pixelOffsetBR:tl,minFontScaleX:Qe/b/In,minFontScaleY:en/b/fn,isSDF:n}};if(l&&(_.stretchX||_.stretchY)){const Ut=Xr(G,re,Q),Vn=Xr(X,ae,ie);for(let zn=0;zn<Ut.length-1;zn++){const Wn=Ut[zn],Pn=Ut[zn+1];for(let hi=0;hi<Vn.length-1;hi++)p.push(Kt(Wn,Vn[hi],Pn,Vn[hi+1]))}}else p.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:R+1}));return p}function Ii(i,e,n){let l=0;for(const p of i)l+=Math.max(e,Math.min(n,p[1]))-Math.max(e,Math.min(n,p[0]));return l}function Xr(i,e,n){const l=[{fixed:-1,stretch:0}];for(const[p,_]of i){const b=l[l.length-1];l.push({fixed:p-b.stretch,stretch:b.stretch}),l.push({fixed:p-b.stretch,stretch:b.stretch+(_-p)})}return l.push({fixed:e+1,stretch:n}),l}function Ct(i,e,n,l){return i/e*n+l}function gt(i,e,n,l){return i-e*n/l}On("Anchor",ne);class jt{constructor(e,n,l,p,_,b,T,R,B,G){var X;if(this.boxStartIndex=e.length,B){let $=b.top,Q=b.bottom;const ie=b.collisionPadding;ie&&($-=ie[1],Q+=ie[3]);let re=Q-$;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{const $=!((X=b.image)===null||X===void 0)&&X.content&&(b.image.textFitWidth||b.image.textFitHeight)?lu(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};$.y1=$.y1*T-R[0],$.y2=$.y2*T+R[2],$.x1=$.x1*T-R[3],$.x2=$.x2*T+R[1];const Q=b.collisionPadding;if(Q&&($.x1-=Q[0]*T,$.y1-=Q[1]*T,$.x2+=Q[2]*T,$.y2+=Q[3]*T),G){const ie=new U($.x1,$.y1),re=new U($.x2,$.y1),ae=new U($.x1,$.y2),ye=new U($.x2,$.y2),Be=G*Math.PI/180;ie._rotate(Be),re._rotate(Be),ae._rotate(Be),ye._rotate(Be),$.x1=Math.min(ie.x,re.x,ae.x,ye.x),$.x2=Math.max(ie.x,re.x,ae.x,ye.x),$.y1=Math.min(ie.y,re.y,ae.y,ye.y),$.y2=Math.max(ie.y,re.y,ae.y,ye.y)}e.emplaceBack(n.x,n.y,$.x1,$.y1,$.x2,$.y2,l,p,_)}this.boxEndIndex=e.length}}class dn{constructor(e=[],n=(l,p)=>l<p?-1:l>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,p=n[e];for(;e>0;){const _=e-1>>1,b=n[_];if(l(p,b)>=0)break;n[e]=b,e=_}n[e]=p}_down(e){const{data:n,compare:l}=this,p=this.length>>1,_=n[e];for(;e<p;){let b=1+(e<<1);const T=b+1;if(T<this.length&&l(n[T],n[b])<0&&(b=T),l(n[b],_)>=0)break;n[e]=n[b],e=b}n[e]=_}}function Ci(i,e=1,n=!1){const l=Fu.fromPoints(i[0]),p=Math.min(l.width(),l.height());let _=p/2;const b=new dn([],zr),{minX:T,minY:R,maxX:B,maxY:G}=l;if(p===0)return new U(T,R);for(let Q=T;Q<B;Q+=p)for(let ie=R;ie<G;ie+=p)b.push(new ui(Q+_,ie+_,_,i));let X=(function(Q){let ie=0,re=0,ae=0;const ye=Q[0];for(let Be=0,be=ye.length,Ee=be-1;Be<be;Ee=Be++){const Ge=ye[Be],Qe=ye[Ee],Dt=Ge.x*Qe.y-Qe.x*Ge.y;re+=(Ge.x+Qe.x)*Dt,ae+=(Ge.y+Qe.y)*Dt,ie+=3*Dt}return new ui(re/ie,ae/ie,0,Q)})(i),$=b.length;for(;b.length;){const Q=b.pop();(Q.d>X.d||!X.d)&&(X=Q,n&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,$)),Q.max-X.d<=e||(_=Q.h/2,b.push(new ui(Q.p.x-_,Q.p.y-_,_,i)),b.push(new ui(Q.p.x+_,Q.p.y-_,_,i)),b.push(new ui(Q.p.x-_,Q.p.y+_,_,i)),b.push(new ui(Q.p.x+_,Q.p.y+_,_,i)),$+=4)}return n&&(console.log(`num probes: ${$}`),console.log(`best distance: ${X.d}`)),X.p}function zr(i,e){return e.max-i.max}function ui(i,e,n,l){this.p=new U(i,e),this.h=n,this.d=(function(p,_){let b=!1,T=1/0;for(let R=0;R<_.length;R++){const B=_[R];for(let G=0,X=B.length,$=X-1;G<X;$=G++){const Q=B[G],ie=B[$];Q.y>p.y!=ie.y>p.y&&p.x<(ie.x-Q.x)*(p.y-Q.y)/(ie.y-Q.y)+Q.x&&(b=!b),T=Math.min(T,E0(p,Q,ie))}}return(b?1:-1)*Math.sqrt(T)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var vi;N.aP=void 0,(vi=N.aP||(N.aP={}))[vi.center=1]="center",vi[vi.left=2]="left",vi[vi.right=3]="right",vi[vi.top=4]="top",vi[vi.bottom=5]="bottom",vi[vi["top-left"]=6]="top-left",vi[vi["top-right"]=7]="top-right",vi[vi["bottom-left"]=8]="bottom-left",vi[vi["bottom-right"]=9]="bottom-right";const cr=Number.POSITIVE_INFINITY;function kr(i,e){return e[1]!==cr?(function(n,l,p){let _=0,b=0;switch(l=Math.abs(l),p=Math.abs(p),n){case"top-right":case"top-left":case"top":b=p-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-p}switch(n){case"top-right":case"bottom-right":case"right":_=-l;break;case"top-left":case"bottom-left":case"left":_=l}return[_,b]})(i,e[0],e[1]):(function(n,l){let p=0,_=0;l<0&&(l=0);const b=l/Math.SQRT2;switch(n){case"top-right":case"top-left":_=b-7;break;case"bottom-right":case"bottom-left":_=7-b;break;case"bottom":_=7-l;break;case"top":_=l-7}switch(n){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=l;break;case"right":p=-l}return[p,_]})(i,e[0])}function du(i,e,n){var l;const p=i.layout,_=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},n);if(_){const T=_.values,R=[];for(let B=0;B<T.length;B+=2){const G=R[B]=T[B],X=T[B+1].map(($=>$*Ks));G.startsWith("top")?X[1]-=7:G.startsWith("bottom")&&(X[1]+=7),R[B+1]=X}return new Ui(R)}const b=p.get("text-variable-anchor");if(b){let T;T=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(e,{},n)*Ks,cr]:p.get("text-offset").evaluate(e,{},n).map((B=>B*Ks));const R=[];for(const B of b)R.push(B,kr(B,T));return new Ui(R)}return null}function wg(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function V2(i,e,n,l,p,_,b,T,R,B,G,X){let $=_.textMaxSize.evaluate(e,{});$===void 0&&($=b);const Q=i.layers[0].layout,ie=Q.get("icon-offset").evaluate(e,{},G),re=Dx(n.horizontal),ae=b/24,ye=i.tilePixelRatio*ae,Be=i.tilePixelRatio*$/24,be=i.tilePixelRatio*T,Ee=i.tilePixelRatio*Q.get("symbol-spacing"),Ge=Q.get("text-padding")*i.tilePixelRatio,Qe=(function(zn,Wn,Pn,hi=1){const mr=zn.get("icon-padding").evaluate(Wn,{},Pn),er=mr&&mr.values;return[er[0]*hi,er[1]*hi,er[2]*hi,er[3]*hi]})(Q,e,G,i.tilePixelRatio),Dt=Q.get("text-max-angle")/180*Math.PI,en=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point",Xt=Q.get("icon-rotation-alignment")==="map"&&Q.get("symbol-placement")!=="point",hn=Q.get("symbol-placement"),In=Ee/2,fn=Q.get("icon-text-fit");let Kt;l&&fn!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Kt=rc(l,n.vertical,fn,Q.get("icon-text-fit-padding"),ie,ae)),re&&(l=rc(l,re,fn,Q.get("icon-text-fit-padding"),ie,ae)));const Ut=G?X.line.getGranularityForZoomLevel(G.z):1,Vn=(zn,Wn)=>{Wn.x<0||Wn.x>=Tt||Wn.y<0||Wn.y>=Tt||(function(Pn,hi,mr,er,_s,Qa,ca,bs,fs,Lr,Ps,Gs,ls,tl,Ja,nl,Dc,Ta,Cs,ua,Os,Ia,Rh,fu,Sg){const Nd=Pn.addToLineVertexArray(hi,mr);let Vf,l0,c0,u0,zx=0,Lx=0,Bx=0,Fx=0,W1=-1,Y1=-1;const Ph={};let jx=ys("");if(Pn.allowVerticalPlacement&&er.vertical){const xo=bs.layout.get("text-rotate").evaluate(Os,{},fu)+90;c0=new jt(fs,hi,Lr,Ps,Gs,er.vertical,ls,tl,Ja,xo),ca&&(u0=new jt(fs,hi,Lr,Ps,Gs,ca,Dc,Ta,Ja,xo))}if(_s){const xo=bs.layout.get("icon-rotate").evaluate(Os,{}),lc=bs.layout.get("icon-text-fit")!=="none",Gf=ci(_s,xo,Rh,lc),gu=ca?ci(ca,xo,Rh,lc):void 0;l0=new jt(fs,hi,Lr,Ps,Gs,_s,Dc,Ta,!1,xo),zx=4*Gf.length;const Hf=Pn.iconSizeData;let Wu=null;Hf.kind==="source"?(Wu=[Jo*bs.layout.get("icon-size").evaluate(Os,{})],Wu[0]>Lu&&si(`${Pn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Hf.kind==="composite"&&(Wu=[Jo*Ia.compositeIconSizes[0].evaluate(Os,{},fu),Jo*Ia.compositeIconSizes[1].evaluate(Os,{},fu)],(Wu[0]>Lu||Wu[1]>Lu)&&si(`${Pn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Pn.addSymbols(Pn.icon,Gf,Wu,ua,Cs,Os,N.az.none,hi,Nd.lineStartIndex,Nd.lineLength,-1,fu),W1=Pn.icon.placedSymbolArray.length-1,gu&&(Lx=4*gu.length,Pn.addSymbols(Pn.icon,gu,Wu,ua,Cs,Os,N.az.vertical,hi,Nd.lineStartIndex,Nd.lineLength,-1,fu),Y1=Pn.icon.placedSymbolArray.length-1)}const Ux=Object.keys(er.horizontal);for(const xo of Ux){const lc=er.horizontal[xo];if(!Vf){jx=ys(lc.text);const gu=bs.layout.get("text-rotate").evaluate(Os,{},fu);Vf=new jt(fs,hi,Lr,Ps,Gs,lc,ls,tl,Ja,gu)}const Gf=lc.positionedLines.length===1;if(Bx+=Nx(Pn,hi,lc,Qa,bs,Ja,Os,nl,Nd,er.vertical?N.az.horizontal:N.az.horizontalOnly,Gf?Ux:[xo],Ph,W1,Ia,fu),Gf)break}er.vertical&&(Fx+=Nx(Pn,hi,er.vertical,Qa,bs,Ja,Os,nl,Nd,N.az.vertical,["vertical"],Ph,Y1,Ia,fu));const q2=Vf?Vf.boxStartIndex:Pn.collisionBoxArray.length,Z2=Vf?Vf.boxEndIndex:Pn.collisionBoxArray.length,X2=c0?c0.boxStartIndex:Pn.collisionBoxArray.length,W2=c0?c0.boxEndIndex:Pn.collisionBoxArray.length,Y2=l0?l0.boxStartIndex:Pn.collisionBoxArray.length,$2=l0?l0.boxEndIndex:Pn.collisionBoxArray.length,K2=u0?u0.boxStartIndex:Pn.collisionBoxArray.length,Q2=u0?u0.boxEndIndex:Pn.collisionBoxArray.length;let pu=-1;const Fm=(xo,lc)=>xo&&xo.circleDiameter?Math.max(xo.circleDiameter,lc):lc;pu=Fm(Vf,pu),pu=Fm(c0,pu),pu=Fm(l0,pu),pu=Fm(u0,pu);const Vx=pu>-1?1:0;Vx&&(pu*=Sg/Ks),Pn.glyphOffsetArray.length>=wd.MAX_GLYPHS&&si("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Os.sortKey!==void 0&&Pn.addToSortKeyRanges(Pn.symbolInstances.length,Os.sortKey);const J2=du(bs,Os,fu),[ew,tw]=(function(xo,lc){const Gf=xo.length,gu=lc?.values;if(gu?.length>0)for(let Hf=0;Hf<gu.length;Hf+=2){const Wu=gu[Hf+1];xo.emplaceBack(N.aP[gu[Hf]],Wu[0],Wu[1])}return[Gf,xo.length]})(Pn.textAnchorOffsets,J2);Pn.symbolInstances.emplaceBack(hi.x,hi.y,Ph.right>=0?Ph.right:-1,Ph.center>=0?Ph.center:-1,Ph.left>=0?Ph.left:-1,Ph.vertical||-1,W1,Y1,jx,q2,Z2,X2,W2,Y2,$2,K2,Q2,Lr,Bx,Fx,zx,Lx,Vx,0,ls,pu,ew,tw)})(i,Wn,zn,n,l,p,Kt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ye,[Ge,Ge,Ge,Ge],en,R,be,Qe,Xt,ie,e,_,B,G,b)};if(hn==="line")for(const zn of r(e.geometry,0,0,Tt,Tt)){const Wn=iu(zn,Ut),Pn=Gt(Wn,Ee,Dt,n.vertical||re,l,24,Be,i.overscaling,Tt);for(const hi of Pn)re&&G2(i,re.text,In,hi)||Vn(Wn,hi)}else if(hn==="line-center"){for(const zn of e.geometry)if(zn.length>1){const Wn=iu(zn,Ut),Pn=pn(Wn,Dt,n.vertical||re,l,24,Be);Pn&&Vn(Wn,Pn)}}else if(e.type==="Polygon")for(const zn of hl(e.geometry,0)){const Wn=Ci(zn,16);Vn(iu(zn[0],Ut,!0),new ne(Wn.x,Wn.y,0))}else if(e.type==="LineString")for(const zn of e.geometry){const Wn=iu(zn,Ut);Vn(Wn,new ne(Wn[0].x,Wn[0].y,0))}else if(e.type==="Point")for(const zn of e.geometry)for(const Wn of zn)Vn([Wn],new ne(Wn.x,Wn.y,0))}function Nx(i,e,n,l,p,_,b,T,R,B,G,X,$,Q,ie){const re=(function(Be,be,Ee,Ge,Qe,Dt,en,Xt){const hn=Ge.layout.get("text-rotate").evaluate(Dt,{})*Math.PI/180,In=[];for(const fn of be.positionedLines)for(const Kt of fn.positionedGlyphs){if(!Kt.rect)continue;const Ut=Kt.rect||{};let Vn=4,zn=!0,Wn=1,Pn=0;const hi=(Qe||Xt)&&Kt.vertical,mr=Kt.metrics.advance*Kt.scale/2;if(Xt&&be.verticalizable&&(Pn=fn.lineOffset/2-(Kt.imageName?-(Ks-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*Ks)),Kt.imageName){const Ta=en[Kt.imageName];zn=Ta.sdf,Wn=Ta.pixelRatio,Vn=1/Wn}const er=Qe?[Kt.x+mr,Kt.y]:[0,0];let _s=Qe?[0,0]:[Kt.x+mr+Ee[0],Kt.y+Ee[1]-Pn],Qa=[0,0];hi&&(Qa=_s,_s=[0,0]);const ca=Kt.metrics.isDoubleResolution?2:1,bs=(Kt.metrics.left-Vn)*Kt.scale-mr+_s[0],fs=(-Kt.metrics.top-Vn)*Kt.scale+_s[1],Lr=bs+Ut.w/ca*Kt.scale/Wn,Ps=fs+Ut.h/ca*Kt.scale/Wn,Gs=new U(bs,fs),ls=new U(Lr,fs),tl=new U(bs,Ps),Ja=new U(Lr,Ps);if(hi){const Ta=new U(-mr,mr- -17),Cs=-Math.PI/2,ua=12-mr,Os=new U(22-ua,-(Kt.imageName?ua:0)),Ia=new U(...Qa);Gs._rotateAround(Cs,Ta)._add(Os)._add(Ia),ls._rotateAround(Cs,Ta)._add(Os)._add(Ia),tl._rotateAround(Cs,Ta)._add(Os)._add(Ia),Ja._rotateAround(Cs,Ta)._add(Os)._add(Ia)}if(hn){const Ta=Math.sin(hn),Cs=Math.cos(hn),ua=[Cs,-Ta,Ta,Cs];Gs._matMult(ua),ls._matMult(ua),tl._matMult(ua),Ja._matMult(ua)}const nl=new U(0,0),Dc=new U(0,0);In.push({tl:Gs,tr:ls,bl:tl,br:Ja,tex:Ut,writingMode:be.writingMode,glyphOffset:er,sectionIndex:Kt.sectionIndex,isSDF:zn,pixelOffsetTL:nl,pixelOffsetBR:Dc,minFontScaleX:0,minFontScaleY:0})}return In})(0,n,T,p,_,b,l,i.allowVerticalPlacement),ae=i.textSizeData;let ye=null;ae.kind==="source"?(ye=[Jo*p.layout.get("text-size").evaluate(b,{})],ye[0]>Lu&&si(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(ye=[Jo*Q.compositeTextSizes[0].evaluate(b,{},ie),Jo*Q.compositeTextSizes[1].evaluate(b,{},ie)],(ye[0]>Lu||ye[1]>Lu)&&si(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,re,ye,T,_,b,B,e,R.lineStartIndex,R.lineLength,$,ie);for(const Be of G)X[Be]=i.text.placedSymbolArray.length-1;return 4*re.length}function Dx(i){for(const e in i)return i[e];return null}function G2(i,e,n,l){const p=i.compareText;if(e in p){const _=p[e];for(let b=_.length-1;b>=0;b--)if(l.dist(_[b])<n)return!0}else p[e]=[];return p[e].push(l),!1}const Rx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class U1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=Rx[15&l];if(!_)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(e,2,1),[T]=new Uint32Array(e,4,1);return new U1(T,b,_,e)}constructor(e,n=64,l=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=Rx.indexOf(this.ArrayType),b=2*e*this.ArrayType.BYTES_PER_ELEMENT,T=e*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-T%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+R,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+b+T+R),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+R,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return V1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:T}=this,R=[0,_.length-1,0],B=[];for(;R.length;){const G=R.pop()||0,X=R.pop()||0,$=R.pop()||0;if(X-$<=T){for(let ae=$;ae<=X;ae++){const ye=b[2*ae],Be=b[2*ae+1];ye>=e&&ye<=l&&Be>=n&&Be<=p&&B.push(_[ae])}continue}const Q=$+X>>1,ie=b[2*Q],re=b[2*Q+1];ie>=e&&ie<=l&&re>=n&&re<=p&&B.push(_[Q]),(G===0?e<=ie:n<=re)&&(R.push($),R.push(Q-1),R.push(1-G)),(G===0?l>=ie:p>=re)&&(R.push(Q+1),R.push(X),R.push(1-G))}return B}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:b}=this,T=[0,p.length-1,0],R=[],B=l*l;for(;T.length;){const G=T.pop()||0,X=T.pop()||0,$=T.pop()||0;if(X-$<=b){for(let ae=$;ae<=X;ae++)Ox(_[2*ae],_[2*ae+1],e,n)<=B&&R.push(p[ae]);continue}const Q=$+X>>1,ie=_[2*Q],re=_[2*Q+1];Ox(ie,re,e,n)<=B&&R.push(p[Q]),(G===0?e-l<=ie:n-l<=re)&&(T.push($),T.push(Q-1),T.push(1-G)),(G===0?e+l>=ie:n+l>=re)&&(T.push(Q+1),T.push(X),T.push(1-G))}return R}}function V1(i,e,n,l,p,_){if(p-l<=n)return;const b=l+p>>1;Px(i,e,b,l,p,_),V1(i,e,n,l,b-1,1-_),V1(i,e,n,b+1,p,1-_)}function Px(i,e,n,l,p,_){for(;p>l;){if(p-l>600){const B=p-l+1,G=n-l+1,X=Math.log(B),$=.5*Math.exp(2*X/3),Q=.5*Math.sqrt(X*$*(B-$)/B)*(G-B/2<0?-1:1);Px(i,e,n,Math.max(l,Math.floor(n-G*$/B+Q)),Math.min(p,Math.floor(n+(B-G)*$/B+Q)),_)}const b=e[2*n+_];let T=l,R=p;for(Ag(i,e,l,n),e[2*p+_]>b&&Ag(i,e,l,p);T<R;){for(Ag(i,e,T,R),T++,R--;e[2*T+_]<b;)T++;for(;e[2*R+_]>b;)R--}e[2*l+_]===b?Ag(i,e,l,R):(R++,Ag(i,e,R,p)),R<=n&&(l=R+1),n<=R&&(p=R-1)}}function Ag(i,e,n,l){G1(i,n,l),G1(e,2*n,2*l),G1(e,2*n+1,2*l+1)}function G1(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function Ox(i,e,n,l){const p=i-n,_=e-l;return p*p+_*_}var H1;N.cH=void 0,(H1=N.cH||(N.cH={})).create="create",H1.load="load",H1.fullLoad="fullLoad";let Bm=null,Eg=[];const q1=1e3/60,Z1="loadTime",X1="fullLoadTime",H2={mark(i){performance.mark(i)},frame(i){const e=i;Bm!=null&&Eg.push(e-Bm),Bm=e},clearMetrics(){Bm=null,Eg=[],performance.clearMeasures(Z1),performance.clearMeasures(X1);for(const i in N.cH)performance.clearMarks(N.cH[i])},getPerformanceMetrics(){performance.measure(Z1,N.cH.create,N.cH.load),performance.measure(X1,N.cH.create,N.cH.fullLoad);const i=performance.getEntriesByName(Z1)[0].duration,e=performance.getEntriesByName(X1)[0].duration,n=Eg.length,l=1/(Eg.reduce(((_,b)=>_+b),0)/n/1e3),p=Eg.filter((_=>_>q1)).reduce(((_,b)=>_+(b-q1)/q1),0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:p/(n+p)*100,totalFrames:n}}};N.$=he,N.A=Xe,N.B=Ho,N.C=$s,N.D=Bn,N.E=$n,N.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},N.G=sr,N.H=Ir,N.I=Gr,N.J=ed,N.K=function(i){if(Yn==null){const e=i.navigator?i.navigator.userAgent:null;Yn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Yn},N.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Gp((()=>this.process())),this.subscription=tr(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Oi(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,l)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=e?tr(e.signal,"abort",(()=>{_?.unsubscribe(),delete this.resolveRejects[p];const R={id:p,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(R)}),Q0):null;this.resolveRejects[p]={resolve:R=>{_?.unsubscribe(),n(R)},reject:R=>{_?.unsubscribe(),l(R)}};const b=[],T=Object.assign(Object.assign({},i),{id:p,sourceMapId:this.mapId,origin:location.origin,data:qo(i.data,b)});this.target.postMessage(T,{transfer:b})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(Oi(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return h(this,void 0,void 0,(function*(){if(e.type==="<response>"){const p=this.resolveRejects[i];return delete this.resolveRejects[i],p?void(e.error?p.reject(Tu(e.error)):p.resolve(Tu(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Tu(e.data),l=new AbortController;this.abortControllers[i]=l;try{const p=yield this.messageHandlers[e.type](e.sourceMapId,n,l);this.completeTask(i,null,p)}catch(p){this.completeTask(i,p)}}))}completeTask(i,e,n){const l=[];delete this.abortControllers[i];const p={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?qo(e):null,data:qo(n,l)};this.target.postMessage(p,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},N.M=it,N.N=function(){var i=new Xe(16);return Xe!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},N.O=function(i,e,n){var l,p,_,b,T,R,B,G,X,$,Q,ie,re=n[0],ae=n[1],ye=n[2];return e===i?(i[12]=e[0]*re+e[4]*ae+e[8]*ye+e[12],i[13]=e[1]*re+e[5]*ae+e[9]*ye+e[13],i[14]=e[2]*re+e[6]*ae+e[10]*ye+e[14],i[15]=e[3]*re+e[7]*ae+e[11]*ye+e[15]):(p=e[1],_=e[2],b=e[3],T=e[4],R=e[5],B=e[6],G=e[7],X=e[8],$=e[9],Q=e[10],ie=e[11],i[0]=l=e[0],i[1]=p,i[2]=_,i[3]=b,i[4]=T,i[5]=R,i[6]=B,i[7]=G,i[8]=X,i[9]=$,i[10]=Q,i[11]=ie,i[12]=l*re+T*ae+X*ye+e[12],i[13]=p*re+R*ae+$*ye+e[13],i[14]=_*re+B*ae+Q*ye+e[14],i[15]=b*re+G*ae+ie*ye+e[15]),i},N.P=U,N.Q=function(i,e,n){var l=n[0],p=n[1],_=n[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*_,i[9]=e[9]*_,i[10]=e[10]*_,i[11]=e[11]*_,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},N.R=Wa,N.S=function(i,e,n){var l=e[0],p=e[1],_=e[2],b=e[3],T=e[4],R=e[5],B=e[6],G=e[7],X=e[8],$=e[9],Q=e[10],ie=e[11],re=e[12],ae=e[13],ye=e[14],Be=e[15],be=n[0],Ee=n[1],Ge=n[2],Qe=n[3];return i[0]=be*l+Ee*T+Ge*X+Qe*re,i[1]=be*p+Ee*R+Ge*$+Qe*ae,i[2]=be*_+Ee*B+Ge*Q+Qe*ye,i[3]=be*b+Ee*G+Ge*ie+Qe*Be,i[4]=(be=n[4])*l+(Ee=n[5])*T+(Ge=n[6])*X+(Qe=n[7])*re,i[5]=be*p+Ee*R+Ge*$+Qe*ae,i[6]=be*_+Ee*B+Ge*Q+Qe*ye,i[7]=be*b+Ee*G+Ge*ie+Qe*Be,i[8]=(be=n[8])*l+(Ee=n[9])*T+(Ge=n[10])*X+(Qe=n[11])*re,i[9]=be*p+Ee*R+Ge*$+Qe*ae,i[10]=be*_+Ee*B+Ge*Q+Qe*ye,i[11]=be*b+Ee*G+Ge*ie+Qe*Be,i[12]=(be=n[12])*l+(Ee=n[13])*T+(Ge=n[14])*X+(Qe=n[15])*re,i[13]=be*p+Ee*R+Ge*$+Qe*ae,i[14]=be*_+Ee*B+Ge*Q+Qe*ye,i[15]=be*b+Ee*G+Ge*ie+Qe*Be,i},N.T=bp,N.U=function(i,e){const n={};for(let l=0;l<e.length;l++){const p=e[l];p in i&&(n[p]=i[p])}return n},N.V=kc,N.W=Qt,N.X=J0,N.Y=_m,N.Z=Ue,N._=h,N.a=ge,N.a$=_t,N.a0=De,N.a1=Ei,N.a2=Bo,N.a3=vm,N.a4=Ef,N.a5=Tt,N.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const l=Cf(i),p=Cf(e);(function(b,T){T.removeAll&&(b.add.clear(),b.update.clear(),b.remove.clear(),T.remove.clear());for(const R of T.remove)b.add.delete(R),b.update.delete(R);for(const[R,B]of T.update){const G=b.update.get(R);G&&(T.update.set(R,tg(G,B)),b.update.delete(R))}})(l,p);const _={};if((l.removeAll||p.removeAll)&&(_.removeAll=!0),_.remove=new Set([...l.remove,...p.remove]),_.add=new Map([...l.add,...p.add]),_.update=new Map([...l.update,...p.update]),_.remove.size&&_.add.size)for(const b of _.add.keys())_.remove.delete(b);return(function(b){const T={};return b.removeAll&&(T.removeAll=b.removeAll),b.remove&&(T.remove=Array.from(b.remove)),b.add&&(T.add=Array.from(b.add.values())),b.update&&(T.update=Array.from(b.update.values())),T})(_)},N.a7=function(i,e){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const l=Sf(i,e);return l==null?void 0:(n.set(l,i),n)}if(i.type==="FeatureCollection"){const l=new Set;for(const p of i.features){const _=Sf(p,e);if(_==null||l.has(_))return;l.add(_),n.set(_,p)}return n}},N.a8=function(i,e,n){var l,p;const _=[];if(e.removeAll)i.clear();else if(e.remove)for(const b of e.remove){const T=i.get(b);T&&(_.push(T.geometry),i.delete(b))}if(e.add)for(const b of e.add){const T=Sf(b,n);if(T==null)continue;const R=i.get(T);R&&_.push(R.geometry),_.push(b.geometry),i.set(T,b)}if(e.update)for(const b of e.update){const T=i.get(b.id);if(!T)continue;const R=!!b.newGeometry,B=b.removeAllProperties||((l=b.removeProperties)===null||l===void 0?void 0:l.length)>0||((p=b.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0;if(!R&&!B)continue;_.push(T.geometry);const G=Object.assign({},T);if(i.set(b.id,G),R&&(_.push(b.newGeometry),G.geometry=b.newGeometry),B){if(G.properties=b.removeAllProperties?{}:Object.assign({},G.properties||{}),b.removeProperties)for(const X of b.removeProperties)delete G.properties[X];if(b.addOrUpdateProperties)for(const{key:X,value:$}of b.addOrUpdateProperties)G.properties[X]=$}}return _},N.a9=Or,N.aA=function(i,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/Jo:i.kind==="composite"?sr.number(l/Jo,p/Jo,n):e},N.aB=function(i,e){var n=e[0],l=e[1],p=e[2],_=e[3],b=e[4],T=e[5],R=e[6],B=e[7],G=e[8],X=e[9],$=e[10],Q=e[11],ie=e[12],re=e[13],ae=e[14],ye=e[15],Be=n*T-l*b,be=n*R-p*b,Ee=n*B-_*b,Ge=l*R-p*T,Qe=l*B-_*T,Dt=p*B-_*R,en=G*re-X*ie,Xt=G*ae-$*ie,hn=G*ye-Q*ie,In=X*ae-$*re,fn=X*ye-Q*re,Kt=$*ye-Q*ae,Ut=Be*Kt-be*fn+Ee*In+Ge*hn-Qe*Xt+Dt*en;return Ut?(i[0]=(T*Kt-R*fn+B*In)*(Ut=1/Ut),i[1]=(p*fn-l*Kt-_*In)*Ut,i[2]=(re*Dt-ae*Qe+ye*Ge)*Ut,i[3]=($*Qe-X*Dt-Q*Ge)*Ut,i[4]=(R*hn-b*Kt-B*Xt)*Ut,i[5]=(n*Kt-p*hn+_*Xt)*Ut,i[6]=(ae*Ee-ie*Dt-ye*be)*Ut,i[7]=(G*Dt-$*Ee+Q*be)*Ut,i[8]=(b*fn-T*hn+B*en)*Ut,i[9]=(l*hn-n*fn-_*en)*Ut,i[10]=(ie*Qe-re*Ee+ye*Be)*Ut,i[11]=(X*Ee-G*Qe-Q*Be)*Ut,i[12]=(T*Xt-b*In-R*en)*Ut,i[13]=(n*In-l*Xt+p*en)*Ut,i[14]=(re*be-ie*Ge-ae*Be)*Ut,i[15]=(G*Ge-X*be+$*Be)*Ut,i):null},N.aC=Ze,N.aD=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},N.aE=function(i){return i[0]=0,i[1]=0,i},N.aF=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},N.aG=W0,N.aH=qt,N.aI=function(i,e,n,l){const p=e.y-i.y,_=e.x-i.x,b=l.y-n.y,T=l.x-n.x,R=b*_-T*p;if(R===0)return null;const B=(T*(i.y-n.y)-b*(i.x-n.x))/R;return new U(i.x+B*_,i.y+B*p)},N.aJ=r,N.aK=Ah,N.aL=function(i){let e=1/0,n=1/0,l=-1/0,p=-1/0;for(const _ of i)e=Math.min(e,_.x),n=Math.min(n,_.y),l=Math.max(l,_.x),p=Math.max(p,_.y);return[e,n,l,p]},N.aM=Ks,N.aN=sn,N.aO=function(i,e,n,l,p=!1){if(!n[0]&&!n[1])return[0,0];const _=p?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(_){const b=Math.sin(_),T=Math.cos(_);n=[n[0]*T-n[1]*b,n[0]*b+n[1]*T]}return[p?n[0]:sn(e,n[0],i.zoom),p?n[1]:sn(e,n[1],i.zoom)]},N.aQ=Bp,N.aR=wg,N.aS=H0,N.aT=U1,N.aU=ss,N.aV=pf,N.aW=Ce,N.aX=Tn,N.aY=zt,N.aZ=yr,N.a_=eg,N.aa=Fu,N.ab=25,N.ac=_a,N.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const l of i){const p=window.document.createElement("source");Fe(l)||(e.crossOrigin="Anonymous"),p.src=l,e.appendChild(p)}}))},N.ae=Jt,N.af=function(){return nn++},N.ag=x,N.ah=wd,N.ai=Uf,N.aj=Va,N.ak=Ko,N.al=Zp,N.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,p,_)=>{const b=p||_;return e[l]=!b||b.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},N.an=Bt,N.ao=85.051129,N.ap=Di,N.aq=function(i){return Math.pow(2,i)},N.ar=Wt,N.as=bm,N.at=function(i){return Math.log(i)/Math.LN2},N.au=function(i){var e=i[0],n=i[1];return e*e+n*n},N.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((R=>R.canonical.z)));let n=1/0,l=-1/0,p=1/0,_=-1/0;const b=[];for(const R of i){const{x:B,y:G,z:X}=R.canonical,$=Math.pow(2,e-X),Q=B*$,ie=G*$;b.push({id:R,x:Q,y:ie}),Q<n&&(n=Q),Q>l&&(l=Q),ie<p&&(p=ie),ie>_&&(_=ie)}const T=new Set;for(const R of b)R.x!==n&&R.x!==l&&R.y!==p&&R.y!==_||T.add(R.id);return T},N.aw=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},N.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const p={value:e,timeout:void 0};if(n!==void 0&&(p.timeout=setTimeout((()=>{this.remove(i,p)}),n)),this.data[l].push(p),this.order.push(l),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,l=e===void 0?0:this.data[n].indexOf(e),p=this.data[n][l];return this.data[n].splice(l,1),p.timeout&&clearTimeout(p.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(p.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const l of this.data[n])i(l.value)||e.push(l);for(const n of e)this.remove(n.value.tileID,n)}},N.ay=function(i,e){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:b}=i,T=p?Bt(ks.interpolationFactor(p,e,_,b),0,1):0;i.kind==="camera"?l=sr.number(i.minSize,i.maxSize,T):n=T}return{uSizeT:n,uSize:l}},N.b=Gn,N.b$=$o,N.b0=He,N.b1=function(i){var e=new Xe(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},N.b2=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},N.b3=function(i,e){var n=e[0],l=e[1],p=e[2],_=n*n+l*l+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=e[0]*_,i[1]=e[1]*_,i[2]=e[2]*_,i},N.b4=Pe,N.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},N.b6=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},N.b7=rt,N.b8=function(i,e,n){const l=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return l===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/l},N.b9=vt,N.bA=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i},N.bB=Te,N.bC=function(i,e,n){var l=n[0],p=n[1],_=n[2],b=n[3],T=e[0],R=e[1],B=e[2],G=p*B-_*R,X=_*T-l*B,$=l*R-p*T;return i[0]=T+b*(G+=G)+p*($+=$)-_*(X+=X),i[1]=R+b*X+_*G-l*$,i[2]=B+b*$+l*X-p*G,i},N.bD=function(i,e,n){const l=(function(R){var B=R[3],G=R[4],X=R[5],$=R[6],Q=R[7],ie=R[8];return R[0]*(ie*G-X*Q)+R[1]*(-ie*B+X*$)+R[2]*(Q*B-G*$)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(l===0)return null;const p=Pe([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),_=Pe([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),b=Pe([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),T=_t([],p,-i[3]);return He(T,T,_t([],_,-e[3])),He(T,T,_t([],b,-n[3])),_t(T,T,1/l),T},N.bE=Hp,N.bF=function(){return new Float64Array(4)},N.bG=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[0]*Math.cos(l)-p[1]*Math.sin(l),_[1]=p[0]*Math.sin(l)+p[1]*Math.cos(l),_[2]=p[2],i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},N.bH=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[0],_[1]=p[1]*Math.cos(l)-p[2]*Math.sin(l),_[2]=p[1]*Math.sin(l)+p[2]*Math.cos(l),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},N.bI=function(i,e,n,l){var p=[],_=[];return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],_[0]=p[2]*Math.sin(l)+p[0]*Math.cos(l),_[1]=p[1],_[2]=p[2]*Math.cos(l)-p[0]*Math.sin(l),i[0]=_[0]+n[0],i[1]=_[1]+n[1],i[2]=_[2]+n[2],i},N.bJ=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[0],b=e[1],T=e[2],R=e[3],B=e[8],G=e[9],X=e[10],$=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*p-B*l,i[1]=b*p-G*l,i[2]=T*p-X*l,i[3]=R*p-$*l,i[8]=_*l+B*p,i[9]=b*l+G*p,i[10]=T*l+X*p,i[11]=R*l+$*p,i},N.bK=function(i,e){const n=Re(i,360),l=Re(e,360),p=l-n,_=l>n?p-360:p+360;return Math.abs(p)<Math.abs(_)?p:_},N.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},N.bM=function(i,e,n,l){const p=Math.sqrt(i*i+e*e),_=Math.sqrt(n*n+l*l);i/=p,e/=p,n/=_,l/=_;const b=Math.acos(i*n+e*l);return-e*n+i*l>0?b:-b},N.bN=function(i,e){const n=Re(i,2*Math.PI),l=Re(e,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},N.bO=function(){const i={},e=dt.$version;for(const n in dt.$root){const l=dt.$root[n];if(l.required){let p=null;p=n==="version"?e:l.type==="array"?[]:{},p!=null&&(i[n]=p)}}return i},N.bP=qe,N.bQ=id,N.bR=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],n[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const l in e)if(!i(e[l],n[l]))return!1;return!0}return e===n},N.bS=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Fn(i[n],e[i[n].ref]));return i},N.bT=function(i,e){if(i.type==="custom")return new K0(i,e);switch(i.type){case"background":return new pr(i,e);case"circle":return new yp(i,e);case"color-relief":return new Xg(i,e);case"fill":return new Qg(i,e);case"fill-extrusion":return new L0(i,e);case"heatmap":return new qg(i,e);case"hillshade":return new xs(i,e);case"line":return new F0(i,e);case"raster":return new Kl(i,e);case"symbol":return new Bu(i,e)}},N.bU=i=>i.type==="raster",N.bV=ii,N.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!Jn(i.version,e.version))return[{command:"setStyle",args:[e]}];Jn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),Jn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),Jn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Jn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),Jn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),Jn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),Jn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),Jn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),Jn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),Jn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),Jn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),Jn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),Jn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),Jn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const l={},p=[];(function(b,T,R,B){let G;for(G in T=T||{},b=b||{})Object.prototype.hasOwnProperty.call(b,G)&&(Object.prototype.hasOwnProperty.call(T,G)||Ti(G,R,B));for(G in T)Object.prototype.hasOwnProperty.call(T,G)&&(Object.prototype.hasOwnProperty.call(b,G)?Jn(b[G],T[G])||(b[G].type==="geojson"&&T[G].type==="geojson"&&Ni(b,T,G)?pi(R,{command:"setGeoJSONSourceData",args:[G,T[G].data]}):jn(G,T,R,B)):ur(G,T,R))})(i.sources,e.sources,p,l);const _=[];i.layers&&i.layers.forEach((b=>{"source"in b&&l[b.source]?n.push({command:"removeLayer",args:[b.id]}):_.push(b)})),n=n.concat(p),(function(b,T,R){T=T||[];const B=(b=b||[]).map(ji),G=T.map(ji),X=b.reduce(Nr,{}),$=T.reduce(Nr,{}),Q=B.slice(),ie=Object.create(null);let re,ae,ye,Be,be;for(let Ee=0,Ge=0;Ee<B.length;Ee++)re=B[Ee],Object.prototype.hasOwnProperty.call($,re)?Ge++:(pi(R,{command:"removeLayer",args:[re]}),Q.splice(Q.indexOf(re,Ge),1));for(let Ee=0,Ge=0;Ee<G.length;Ee++)re=G[G.length-1-Ee],Q[Q.length-1-Ee]!==re&&(Object.prototype.hasOwnProperty.call(X,re)?(pi(R,{command:"removeLayer",args:[re]}),Q.splice(Q.lastIndexOf(re,Q.length-Ge),1)):Ge++,Be=Q[Q.length-Ee],pi(R,{command:"addLayer",args:[$[re],Be]}),Q.splice(Q.length-Ee,0,re),ie[re]=!0);for(let Ee=0;Ee<G.length;Ee++)if(re=G[Ee],ae=X[re],ye=$[re],!ie[re]&&!Jn(ae,ye))if(Jn(ae.source,ye.source)&&Jn(ae["source-layer"],ye["source-layer"])&&Jn(ae.type,ye.type)){for(be in Ri(ae.layout,ye.layout,R,re,null,"setLayoutProperty"),Ri(ae.paint,ye.paint,R,re,null,"setPaintProperty"),Jn(ae.filter,ye.filter)||pi(R,{command:"setFilter",args:[re,ye.filter]}),Jn(ae.minzoom,ye.minzoom)&&Jn(ae.maxzoom,ye.maxzoom)||pi(R,{command:"setLayerZoomRange",args:[re,ye.minzoom,ye.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ri(ae[be],ye[be],R,re,be.slice(6),"setPaintProperty"):Jn(ae[be],ye[be])||pi(R,{command:"setLayerProperty",args:[re,be,ye[be]]}));for(be in ye)Object.prototype.hasOwnProperty.call(ye,be)&&!Object.prototype.hasOwnProperty.call(ae,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ri(ae[be],ye[be],R,re,be.slice(6),"setPaintProperty"):Jn(ae[be],ye[be])||pi(R,{command:"setLayerProperty",args:[re,be,ye[be]]}))}else pi(R,{command:"removeLayer",args:[re]}),Be=Q[Q.lastIndexOf(re)+1],pi(R,{command:"addLayer",args:[ye,Be]})})(_,e.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[e]}]}return n},N.bX=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},N.bY=kn,N.bZ=Nn,N.b_=class extends Za{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},N.ba=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},N.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},N.bc=wm,N.bd=Ed,N.be=function(i,e,n,l,p){var _=1/Math.tan(e/2);if(i[0]=_/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0){var b=1/(l-p);i[10]=(p+l)*b,i[14]=2*p*l*b}else i[10]=-1,i[14]=-2*l;return i},N.bf=function(i){var e=new Xe(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},N.bg=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[0],b=e[1],T=e[2],R=e[3],B=e[4],G=e[5],X=e[6],$=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*p+B*l,i[1]=b*p+G*l,i[2]=T*p+X*l,i[3]=R*p+$*l,i[4]=B*p-_*l,i[5]=G*p-b*l,i[6]=X*p-T*l,i[7]=$*p-R*l,i},N.bh=function(i,e,n){var l=Math.sin(n),p=Math.cos(n),_=e[4],b=e[5],T=e[6],R=e[7],B=e[8],G=e[9],X=e[10],$=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=_*p+B*l,i[5]=b*p+G*l,i[6]=T*p+X*l,i[7]=R*p+$*l,i[8]=B*p-_*l,i[9]=G*p-b*l,i[10]=X*p-T*l,i[11]=$*p-R*l,i},N.bi=function(){const i=new Float32Array(16);return Wt(i),i},N.bj=function(){const i=new Float64Array(16);return Wt(i),i},N.bk=function(){return new Float64Array(16)},N.bl=function(i,e,n){const l=new Float64Array(4);return Te(l,i,e-90,n),l},N.bm=function(i,e,n,l){var p,_,b,T,R,B=e[0],G=e[1],X=e[2],$=e[3],Q=n[0],ie=n[1],re=n[2],ae=n[3];return(_=B*Q+G*ie+X*re+$*ae)<0&&(_=-_,Q=-Q,ie=-ie,re=-re,ae=-ae),1-_>Je?(p=Math.acos(_),b=Math.sin(p),T=Math.sin((1-l)*p)/b,R=Math.sin(l*p)/b):(T=1-l,R=l),i[0]=T*B+R*Q,i[1]=T*G+R*ie,i[2]=T*X+R*re,i[3]=T*$+R*ae,i},N.bn=function(i){const e=new Float64Array(9);(function(_,b){var T=b[0],R=b[1],B=b[2],G=b[3],X=T+T,$=R+R,Q=B+B,ie=T*X,re=R*X,ae=R*$,ye=B*X,Be=B*$,be=B*Q,Ee=G*X,Ge=G*$,Qe=G*Q;_[0]=1-ae-be,_[3]=re-Qe,_[6]=ye+Ge,_[1]=re+Qe,_[4]=1-ie-be,_[7]=Be-Ee,_[2]=ye-Ge,_[5]=Be+Ee,_[8]=1-ie-ae})(e,i);const n=yr(-Math.asin(Bt(e[2],-1,1)));let l,p;return Math.hypot(e[5],e[8])<.001?(l=0,p=-yr(Math.atan2(e[3],e[4]))):(l=yr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),p=yr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:l,pitch:n+90,bearing:p}},N.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},N.bp=Si,N.bq=Qc,N.br=Po,N.bs=nc,N.bt=xa,N.bu=ct,N.bv=kt,N.bw=Yr,N.bx=function(i,e,n,l,p){return ct(l,p,Bt((i-e)/(n-e),0,1))},N.by=Re,N.bz=function(){return new Float64Array(3)},N.c=Ye,N.c$=function(i,e,n,l,p){return h(this,void 0,void 0,(function*(){if(De())try{return yield Ei(i,e,n,l,p)}catch{}return(function(_,b,T,R,B){const G=_.width,X=_.height;on&&Li||(on=new OffscreenCanvas(G,X),Li=on.getContext("2d",{willReadFrequently:!0})),on.width=G,on.height=X,Li.drawImage(_,0,0,G,X);const $=Li.getImageData(b,T,R,B);return Li.clearRect(0,0,G,X),$.data})(i,e,n,l,p)}))},N.c0=class extends Za{constructor(i,e){super(i,e),this.current=Xa}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},N.c1=Du,N.c2=class extends Za{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},N.c3=class extends Za{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},N.c4=mt,N.c5=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=0,i[3]=-n,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},N.c6=function(i,e,n){var l=e[0],p=e[1],_=e[2];return i[0]=l*n[0]+p*n[3]+_*n[6],i[1]=l*n[1]+p*n[4]+_*n[7],i[2]=l*n[2]+p*n[5]+_*n[8],i},N.c7=function(i,e,n,l,p,_,b){var T=1/(e-n),R=1/(l-p),B=1/(_-b);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*R,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*B,i[11]=0,i[12]=(e+n)*T,i[13]=(p+l)*R,i[14]=(b+_)*B,i[15]=1,i},N.c8=class extends Za{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},N.c9=class extends Za{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},N.cA=function(i,e){return yt[e]&&"touches"in i},N.cB=function(i){return yt[i]||oe[i]},N.cC=function(i,e,n){var l=e[0],p=e[1];return i[0]=n[0]*l+n[4]*p+n[12],i[1]=n[1]*l+n[5]*p+n[13],i},N.cD=function(i,e){const{x:n,y:l}=Or.fromLngLat(e);return!(i<0||i>25||l<0||l>=1||n<0||n>=1)},N.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},N.cF=class extends Wc{},N.cG=H2,N.cI=de,N.cJ=function(i,e){Ye.REGISTERED_PROTOCOLS[i]=e},N.cK=function(i){delete Ye.REGISTERED_PROTOCOLS[i]},N.cL=function(i,e){const n={};for(let p=0;p<i.length;p++){const _=e&&e[i[p].id]||Hl(i[p]);e&&(e[i[p].id]=_);let b=n[_];b||(b=n[_]=[]),b.push(i[p])}const l=[];for(const p in n)l.push(n[p]);return l},N.cM=On,N.cN=ng,N.cO=vg,N.cP=Op,N.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Tt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,l=e._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new Ir(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Ir(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Ir(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:G}=i.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Ir(B),i.canonical),l["text-size"].possiblyEvaluate(new Ir(G),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:G}=i.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Ir(B),i.canonical),l["icon-size"].possiblyEvaluate(new Ir(G),i.canonical)]}const _=n.get("text-line-height")*Ks,b=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",T=n.get("text-keep-upright"),R=n.get("text-size");for(const B of i.bucket.features){const G=n.get("text-font").evaluate(B,{},i.canonical).join(","),X=R.evaluate(B,{},i.canonical),$=p.layoutTextSize.evaluate(B,{},i.canonical),Q=p.layoutIconSize.evaluate(B,{},i.canonical),ie={horizontal:{},vertical:void 0},re=B.text;let ae,ye=[0,0];if(re){const Ee=re.toString(),Ge=n.get("text-letter-spacing").evaluate(B,{},i.canonical)*Ks,Qe=rd(Ee)?Ge:0,Dt=n.get("text-anchor").evaluate(B,{},i.canonical),en=du(e,B,i.canonical);if(!en){const fn=n.get("text-radial-offset").evaluate(B,{},i.canonical);ye=fn?kr(Dt,[fn*Ks,cr]):n.get("text-offset").evaluate(B,{},i.canonical).map((Kt=>Kt*Ks))}let Xt=b?"center":n.get("text-justify").evaluate(B,{},i.canonical);const hn=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(B,{},i.canonical)*Ks:1/0,In=()=>{i.bucket.allowVerticalPlacement&&wl(Ee)&&(ie.vertical=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,hn,_,Dt,"left",Qe,ye,N.az.vertical,!0,$,X))};if(!b&&en){const fn=new Set;if(Xt==="auto")for(let Ut=0;Ut<en.values.length;Ut+=2)fn.add(wg(en.values[Ut]));else fn.add(Xt);let Kt=!1;for(const Ut of fn)if(!ie.horizontal[Ut])if(Kt)ie.horizontal[Ut]=ie.horizontal[0];else{const Vn=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,hn,_,"center",Ut,Qe,ye,N.az.horizontal,!1,$,X);Vn&&(ie.horizontal[Ut]=Vn,Kt=Vn.positionedLines.length===1)}In()}else{Xt==="auto"&&(Xt=wg(Dt));const fn=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,hn,_,Dt,Xt,Qe,ye,N.az.horizontal,!1,$,X);fn&&(ie.horizontal[Xt]=fn),In(),wl(Ee)&&b&&T&&(ie.vertical=vf(re,i.glyphMap,i.glyphPositions,i.imagePositions,G,hn,_,Dt,Xt,Qe,ye,N.az.vertical,!1,$,X))}}let Be=!1;if(B.icon&&B.icon.name){const Ee=i.imageMap[B.icon.name];Ee&&(ae=Z0(i.imagePositions[B.icon.name],n.get("icon-offset").evaluate(B,{},i.canonical),n.get("icon-anchor").evaluate(B,{},i.canonical)),Be=!!Ee.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Be:i.bucket.sdfIcons!==Be&&si("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ee.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const be=Dx(ie.horizontal)||ie.vertical;i.bucket.iconsInText=!!be&&be.iconsInText,(be||ae)&&V2(i.bucket,B,ie,ae,i.imageMap,p,$,Q,ye,Be,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},N.cR=Sh,N.cS=Pu,N.cT=gd,N.cU=function(i){const e=new Dp;return(function(n,l){for(const p in n.layers)l.writeMessage(3,r0,n.layers[p])})(i,e),e.finish()},N.cV=function(i,e,n,l,p,_){let b=o(i,e,n,p,0);return b=o(b,e,l,_,1),b},N.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},N.cX=fr,N.cY=Dp,N.cZ=jf,N.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},N.ca=class extends Jl{},N.cb=im,N.cc=class extends as{},N.cd=af,N.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},N.cf=Ic,N.cg=function(i,e,n){var l=e[0],p=e[1],_=e[2],b=n[3]*l+n[7]*p+n[11]*_+n[15];return i[0]=(n[0]*l+n[4]*p+n[8]*_+n[12])/(b=b||1),i[1]=(n[1]*l+n[5]*p+n[9]*_+n[13])/b,i[2]=(n[2]*l+n[6]*p+n[10]*_+n[14])/b,i},N.ch=class extends Yc{},N.ci=class extends t{},N.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},N.ck=function(i,e){var n=i[0],l=i[1],p=i[2],_=i[3],b=i[4],T=i[5],R=i[6],B=i[7],G=i[8],X=i[9],$=i[10],Q=i[11],ie=i[12],re=i[13],ae=i[14],ye=i[15],Be=e[0],be=e[1],Ee=e[2],Ge=e[3],Qe=e[4],Dt=e[5],en=e[6],Xt=e[7],hn=e[8],In=e[9],fn=e[10],Kt=e[11],Ut=e[12],Vn=e[13],zn=e[14],Wn=e[15];return Math.abs(n-Be)<=Je*Math.max(1,Math.abs(n),Math.abs(Be))&&Math.abs(l-be)<=Je*Math.max(1,Math.abs(l),Math.abs(be))&&Math.abs(p-Ee)<=Je*Math.max(1,Math.abs(p),Math.abs(Ee))&&Math.abs(_-Ge)<=Je*Math.max(1,Math.abs(_),Math.abs(Ge))&&Math.abs(b-Qe)<=Je*Math.max(1,Math.abs(b),Math.abs(Qe))&&Math.abs(T-Dt)<=Je*Math.max(1,Math.abs(T),Math.abs(Dt))&&Math.abs(R-en)<=Je*Math.max(1,Math.abs(R),Math.abs(en))&&Math.abs(B-Xt)<=Je*Math.max(1,Math.abs(B),Math.abs(Xt))&&Math.abs(G-hn)<=Je*Math.max(1,Math.abs(G),Math.abs(hn))&&Math.abs(X-In)<=Je*Math.max(1,Math.abs(X),Math.abs(In))&&Math.abs($-fn)<=Je*Math.max(1,Math.abs($),Math.abs(fn))&&Math.abs(Q-Kt)<=Je*Math.max(1,Math.abs(Q),Math.abs(Kt))&&Math.abs(ie-Ut)<=Je*Math.max(1,Math.abs(ie),Math.abs(Ut))&&Math.abs(re-Vn)<=Je*Math.max(1,Math.abs(re),Math.abs(Vn))&&Math.abs(ae-zn)<=Je*Math.max(1,Math.abs(ae),Math.abs(zn))&&Math.abs(ye-Wn)<=Je*Math.max(1,Math.abs(ye),Math.abs(Wn))},N.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},N.cm=i=>i.type==="symbol",N.cn=i=>i.type==="circle",N.co=i=>i.type==="heatmap",N.cp=i=>i.type==="line",N.cq=i=>i.type==="fill",N.cr=i=>i.type==="fill-extrusion",N.cs=i=>i.type==="hillshade",N.ct=i=>i.type==="color-relief",N.cu=i=>i.type==="background",N.cv=i=>i.type==="custom",N.cw=bt,N.cx=function(i,e,n){const l=ut(e.x-n.x,e.y-n.y),p=ut(i.x-n.x,i.y-n.y),_=Math.atan2(l[0]*p[1]-l[1]*p[0],(function(b,T){return b[0]*T[0]+b[1]*T[1]})(l,p));return yr(_)},N.cy=an,N.cz=function(i,e){return oe[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},N.d=Fe,N.d0=hd,N.d1=H,N.d2=class{constructor(i,e){this.layers={[Uf]:this},this.name=Uf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new Om(this.features[i],this.extent)}},N.d3=wu,N.d4=Io,N.e=un,N.f=i=>h(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),N.g=At,N.h=i=>new Promise(((e,n)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=Rn}))},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(p):Rn})),N.i=Oi,N.j=(i,e)=>xt(un(i,{type:"json"}),e),N.k=yn,N.l=bn,N.m=xt,N.n=(i,e)=>xt(un(i,{type:"arrayBuffer"}),e),N.o=function(i){return new Dp(i).readFields(dm,[])},N.p=G0,N.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},N.r=sf,N.s=tr,N.t=Es,N.u=dt,N.v=ch,N.w=si,N.x=ad,N.y=Go,N.z=$l})),D("worker",["./shared"],(function(N){class h{constructor(oe,le){this.keyCache={},oe&&this.replace(oe,le)}replace(oe,le){this._layerConfigs={},this._layers={},this.update(oe,[],le)}update(oe,le,ge){for(const Ye of oe){this._layerConfigs[Ye.id]=Ye;const At=this._layers[Ye.id]=N.bT(Ye,ge);At._featureFilter=N.aj(At.filter,ge),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id]}for(const Ye of le)delete this.keyCache[Ye],delete this._layerConfigs[Ye],delete this._layers[Ye];this.familiesBySource={};const Ue=N.cL(Object.values(this._layerConfigs),this.keyCache);for(const Ye of Ue){const At=Ye.map((St=>this._layers[St.id])),it=At[0];if(it.isHidden())continue;const de=it.source||"";let qe=this.familiesBySource[de];qe||(qe=this.familiesBySource[de]={});const xt=it.sourceLayer||N.ai;let Fe=qe[xt];Fe||(Fe=qe[xt]=[]),Fe.push(At)}}}class U{constructor(oe){const le={},ge=[];for(const it in oe){const de=oe[it],qe=le[it]={};for(const xt in de){const Fe=de[+xt];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const St={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};ge.push(St),qe[xt]={rect:St,metrics:Fe.metrics}}}const{w:Ue,h:Ye}=N.p(ge),At=new N.r({width:Ue||1,height:Ye||1});for(const it in oe){const de=oe[it];for(const qe in de){const xt=de[+qe];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const Fe=le[it][qe].rect;N.r.copy(xt.bitmap,At,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},xt.bitmap)}}this.image=At,this.positions=le}}N.cM("GlyphAtlas",U);class H{constructor(oe){this.tileID=new N.a2(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.uid=oe.uid,this.zoom=oe.zoom,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.collectResourceTiming,this.returnDependencies=!!oe.returnDependencies,this.promoteId=oe.promoteId,this.inFlightDependencies=[]}parse(oe,le,ge,Ue,Ye){return N._(this,void 0,void 0,(function*(){this.status="parsing",this.data=oe,this.collisionBoxArray=new N.ag;const At=new N.cN(Object.keys(oe.layers).sort()),it=new N.cO(this.tileID,this.promoteId);it.bucketLayerIDs=[];const de={},qe={featureIndex:it,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ge,subdivisionGranularity:Ye},xt=le.familiesBySource[this.source];for(const Ni in xt){const Ri=oe.layers[Ni];if(!Ri)continue;Ri.version===1&&N.w(`Vector tile source "${this.source}" layer "${Ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ji=At.encode(Ni),Nr=[];for(let Jt=0;Jt<Ri.length;Jt++){const gi=Ri.feature(Jt),Sn=it.getId(gi,Ni);Nr.push({feature:gi,id:Sn,index:Jt,sourceLayerIndex:ji})}for(const Jt of xt[Ni]){const gi=Jt[0];gi.source!==this.source&&N.w(`layer.source = ${gi.source} does not equal this.source = ${this.source}`),gi.isHidden(this.zoom,!0)||(Y(Jt,this.zoom,ge),(de[gi.id]=gi.createBucket({index:it.bucketLayerIDs.length,layers:Jt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ji,sourceID:this.source})).populate(Nr,qe,this.tileID.canonical),it.bucketLayerIDs.push(Jt.map((Sn=>Sn.id))))}}const Fe=N.bY(qe.glyphDependencies,(Ni=>Object.keys(Ni).map(Number)));this.inFlightDependencies.forEach((Ni=>Ni?.abort())),this.inFlightDependencies=[];let St=Promise.resolve({});if(Object.keys(Fe).length){const Ni=new AbortController;this.inFlightDependencies.push(Ni),St=Ue.sendAsync({type:"GG",data:{stacks:Fe,source:this.source,tileID:this.tileID,type:"glyphs"}},Ni)}const Lt=Object.keys(qe.iconDependencies);let bn=Promise.resolve({});if(Lt.length){const Ni=new AbortController;this.inFlightDependencies.push(Ni),bn=Ue.sendAsync({type:"GI",data:{icons:Lt,source:this.source,tileID:this.tileID,type:"icons"}},Ni)}const yn=Object.keys(qe.patternDependencies);let $n=Promise.resolve({});if(yn.length){const Ni=new AbortController;this.inFlightDependencies.push(Ni),$n=Ue.sendAsync({type:"GI",data:{icons:yn,source:this.source,tileID:this.tileID,type:"patterns"}},Ni)}const dt=qe.dashDependencies;let ai=Promise.resolve({});if(Object.keys(dt).length){const Ni=new AbortController;this.inFlightDependencies.push(Ni),ai=Ue.sendAsync({type:"GDA",data:{dashes:dt}},Ni)}const[Fn,Jn,pi,ur]=yield Promise.all([St,bn,$n,ai]),Ti=new U(Fn),jn=new N.cP(Jn,pi);for(const Ni in de){const Ri=de[Ni];Ri instanceof N.ah?(Y(Ri.layers,this.zoom,ge),N.cQ({bucket:Ri,glyphMap:Fn,glyphPositions:Ti.positions,imageMap:Jn,imagePositions:jn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:qe.subdivisionGranularity})):Ri.hasDependencies&&(Ri instanceof N.cR||Ri instanceof N.cS||Ri instanceof N.cT)&&(Y(Ri.layers,this.zoom,ge),Ri.addFeatures(qe,this.tileID.canonical,jn.patternPositions,ur))}return this.status="done",{buckets:Object.values(de).filter((Ni=>!Ni.isEmpty())),featureIndex:it,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ti.image,imageAtlas:jn,dashPositions:ur,glyphMap:this.returnDependencies?Fn:null,iconMap:this.returnDependencies?Jn:null,glyphPositions:this.returnDependencies?Ti.positions:null}}))}}function Y(yt,oe,le){const ge=new N.H(oe);for(const Ue of yt)Ue.recalculate(ge,le)}class K{constructor(oe,le,ge,Ue,Ye){this.type=oe,this.properties=ge||{},this.extent=Ye,this.pointsArray=le,this.id=Ue}loadGeometry(){return this.pointsArray.map((oe=>oe.map((le=>new N.P(le.x,le.y)))))}}class _e{constructor(oe,le,ge){this.version=2,this._myFeatures=oe,this.name=le,this.length=oe.length,this.extent=ge}feature(oe){return this._myFeatures[oe]}}class we{constructor(){this.layers={}}addLayer(oe){this.layers[oe.name]=oe}}function ve(yt){let oe=N.cU(yt);return oe.byteOffset===0&&oe.byteLength===oe.buffer.byteLength||(oe=new Uint8Array(oe)),{vectorTile:yt,rawData:oe.buffer}}function pe(yt,oe,le){const{extent:ge}=yt,Ue=Math.pow(2,le.z-oe.z),Ye=(le.x-oe.x*Ue)*ge,At=(le.y-oe.y*Ue)*ge,it=[];for(let de=0;de<yt.length;de++){const qe=yt.feature(de);let xt=qe.loadGeometry();for(const St of xt)for(const Lt of St)Lt.x=Lt.x*Ue-Ye,Lt.y=Lt.y*Ue-At;const Fe=128;xt=N.cV(xt,qe.type,-Fe,-Fe,ge+Fe,ge+Fe),xt.length!==0&&it.push(new K(qe.type,xt,qe.properties,qe.id,ge))}return new _e(it,yt.name,ge)}class he{constructor(oe,le,ge){this.actor=oe,this.layerIndex=le,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new N.cW(1e3)}loadVectorTile(oe,le){return N._(this,void 0,void 0,(function*(){const ge=yield N.n(oe.request,le);try{return{vectorTile:oe.encoding!=="mlt"?new N.cX(new N.cY(ge.data)):new N.cZ(ge.data),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(Ue){const Ye=new Uint8Array(ge.data);let At=`Unable to parse the tile at ${oe.request.url}, `;throw At+=Ye[0]===31&&Ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ue.message}`,new Error(At)}}))}loadTile(oe){return N._(this,void 0,void 0,(function*(){const{uid:le,overzoomParameters:ge}=oe;ge&&(oe.request=ge.overzoomRequest);const Ue=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new N.c_(oe.request),Ye=new H(oe);this.loading[le]=Ye;const At=new AbortController;Ye.abort=At;try{const it=yield this.loadVectorTile(oe,At);if(delete this.loading[le],!it)return null;if(ge){const St=this._getOverzoomTile(oe,it.vectorTile);it.rawData=St.rawData,it.vectorTile=St.vectorTile}const de=it.rawData,qe={};it.expires&&(qe.expires=it.expires),it.cacheControl&&(qe.cacheControl=it.cacheControl);const xt={};if(Ue){const St=Ue.finish();St&&(xt.resourceTiming=JSON.parse(JSON.stringify(St)))}Ye.vectorTile=it.vectorTile;const Fe=Ye.parse(it.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);this.loaded[le]=Ye,this.fetching[le]={rawTileData:de,cacheControl:qe,resourceTiming:xt};try{const St=yield Fe;return N.e({rawTileData:de.slice(0),encoding:oe.encoding},St,qe,xt)}finally{delete this.fetching[le]}}catch(it){throw delete this.loading[le],Ye.status="done",this.loaded[le]=Ye,it}}))}_getOverzoomTile(oe,le){const{tileID:ge,source:Ue,overzoomParameters:Ye}=oe,{maxZoomTileID:At}=Ye,it=`${At.key}_${ge.key}`,de=this.overzoomedTileResultCache.get(it);if(de)return de;const qe=new we,xt=this.layerIndex.familiesBySource[Ue];for(const St in xt){const Lt=le.layers[St];if(!Lt)continue;const bn=pe(Lt,At,ge.canonical);bn.length>0&&qe.addLayer(bn)}const Fe=ve(qe);return this.overzoomedTileResultCache.set(it,Fe),Fe}reloadTile(oe){return N._(this,void 0,void 0,(function*(){const le=oe.uid;if(!this.loaded||!this.loaded[le])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[le];if(ge.showCollisionBoxes=oe.showCollisionBoxes,ge.status==="parsing"){const Ue=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);let Ye;if(this.fetching[le]){const{rawTileData:At,cacheControl:it,resourceTiming:de}=this.fetching[le];delete this.fetching[le],Ye=N.e({rawTileData:At.slice(0),encoding:oe.encoding},Ue,it,de)}else Ye=Ue;return Ye}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity)}))}abortTile(oe){return N._(this,void 0,void 0,(function*(){const le=this.loading,ge=oe.uid;le&&le[ge]&&le[ge].abort&&(le[ge].abort.abort(),delete le[ge])}))}removeTile(oe){return N._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[oe.uid]&&delete this.loaded[oe.uid]}))}}class De{constructor(){this.loaded={}}loadTile(oe){return N._(this,void 0,void 0,(function*(){const{uid:le,encoding:ge,rawImageData:Ue,redFactor:Ye,greenFactor:At,blueFactor:it,baseShift:de}=oe,qe=Ue.width+2,xt=Ue.height+2,Fe=N.b(Ue)?new N.R({width:qe,height:xt},yield N.c$(Ue,-1,-1,qe,xt)):Ue,St=new N.d0(le,Fe,ge,Ye,At,it,de);return this.loaded=this.loaded||{},this.loaded[le]=St,St}))}removeTile(oe){const le=this.loaded,ge=oe.uid;le&&le[ge]&&delete le[ge]}}var Je,Xe,mt=(function(){if(Xe)return Je;function yt(le,ge){if(le.length!==0){oe(le[0],ge);for(var Ue=1;Ue<le.length;Ue++)oe(le[Ue],!ge)}}function oe(le,ge){for(var Ue=0,Ye=0,At=0,it=le.length,de=it-1;At<it;de=At++){var qe=(le[At][0]-le[de][0])*(le[de][1]+le[At][1]),xt=Ue+qe;Ye+=Math.abs(Ue)>=Math.abs(qe)?Ue-xt+qe:qe-xt+Ue,Ue=xt}Ue+Ye>=0!=!!ge&&le.reverse()}return Xe=1,Je=function le(ge,Ue){var Ye,At=ge&&ge.type;if(At==="FeatureCollection")for(Ye=0;Ye<ge.features.length;Ye++)le(ge.features[Ye],Ue);else if(At==="GeometryCollection")for(Ye=0;Ye<ge.geometries.length;Ye++)le(ge.geometries[Ye],Ue);else if(At==="Feature")le(ge.geometry,Ue);else if(At==="Polygon")yt(ge.coordinates,Ue);else if(At==="MultiPolygon")for(Ye=0;Ye<ge.coordinates.length;Ye++)yt(ge.coordinates[Ye],Ue);return ge}})(),Wt=N.d1(mt);const Et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:yt=>yt},rt=Math.fround||(at=new Float32Array(1),yt=>(at[0]=+yt,at[0]));var at;class He{constructor(oe){this.options=Object.assign(Object.create(Et),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:le,minZoom:ge,maxZoom:Ue}=this.options;le&&console.time("total time");const Ye=`prepare ${oe.length} points`;le&&console.time(Ye),this.points=oe;const At=[];for(let de=0;de<oe.length;de++){const qe=oe[de];if(!qe.geometry)continue;const[xt,Fe]=qe.geometry.coordinates,St=rt(ht(xt)),Lt=rt(vt(Fe));At.push(St,Lt,1/0,de,-1,1),this.options.reduce&&At.push(0)}let it=this.trees[Ue+1]=this._createTree(At);le&&console.timeEnd(Ye);for(let de=Ue;de>=ge;de--){const qe=+Date.now();it=this.trees[de]=this._createTree(this._cluster(it,de)),le&&console.log("z%d: %d clusters in %dms",de,it.numItems,+Date.now()-qe)}return le&&console.timeEnd("total time"),this}getClusters(oe,le){let ge=((oe[0]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,oe[1]));let Ye=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const At=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)ge=-180,Ye=180;else if(ge>Ye){const Fe=this.getClusters([ge,Ue,180,At],le),St=this.getClusters([-180,Ue,Ye,At],le);return Fe.concat(St)}const it=this.trees[this._limitZoom(le)],de=it.range(ht(ge),vt(At),ht(Ye),vt(Ue)),qe=it.data,xt=[];for(const Fe of de){const St=this.stride*Fe;xt.push(qe[St+5]>1?_t(qe,St,this.clusterProps):this.points[qe[St+3]])}return xt}getChildren(oe){const le=this._getOriginId(oe),ge=this._getOriginZoom(oe),Ue="No cluster with the specified id.",Ye=this.trees[ge];if(!Ye)throw new Error(Ue);const At=Ye.data;if(le*this.stride>=At.length)throw new Error(Ue);const it=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),de=Ye.within(At[le*this.stride],At[le*this.stride+1],it),qe=[];for(const xt of de){const Fe=xt*this.stride;At[Fe+4]===oe&&qe.push(At[Fe+5]>1?_t(At,Fe,this.clusterProps):this.points[At[Fe+3]])}if(qe.length===0)throw new Error(Ue);return qe}getLeaves(oe,le,ge){const Ue=[];return this._appendLeaves(Ue,oe,le=le||10,ge=ge||0,0),Ue}getTile(oe,le,ge){const Ue=this.trees[this._limitZoom(oe)],Ye=Math.pow(2,oe),{extent:At,radius:it}=this.options,de=it/At,qe=(ge-de)/Ye,xt=(ge+1+de)/Ye,Fe={features:[]};return this._addTileFeatures(Ue.range((le-de)/Ye,qe,(le+1+de)/Ye,xt),Ue.data,le,ge,Ye,Fe),le===0&&this._addTileFeatures(Ue.range(1-de/Ye,qe,1,xt),Ue.data,Ye,ge,Ye,Fe),le===Ye-1&&this._addTileFeatures(Ue.range(0,qe,de/Ye,xt),Ue.data,-1,ge,Ye,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(oe){let le=this._getOriginZoom(oe)-1;for(;le<=this.options.maxZoom;){const ge=this.getChildren(oe);if(le++,ge.length!==1)break;oe=ge[0].properties.cluster_id}return le}_appendLeaves(oe,le,ge,Ue,Ye){const At=this.getChildren(le);for(const it of At){const de=it.properties;if(de&&de.cluster?Ye+de.point_count<=Ue?Ye+=de.point_count:Ye=this._appendLeaves(oe,de.cluster_id,ge,Ue,Ye):Ye<Ue?Ye++:oe.push(it),oe.length===ge)break}return Ye}_createTree(oe){const le=new N.aT(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<oe.length;ge+=this.stride)le.add(oe[ge],oe[ge+1]);return le.finish(),le.data=oe,le}_addTileFeatures(oe,le,ge,Ue,Ye,At){for(const it of oe){const de=it*this.stride,qe=le[de+5]>1;let xt,Fe,St;if(qe)xt=Pe(le,de,this.clusterProps),Fe=le[de],St=le[de+1];else{const yn=this.points[le[de+3]];xt=yn.properties;const[$n,dt]=yn.geometry.coordinates;Fe=ht($n),St=vt(dt)}const Lt={type:1,geometry:[[Math.round(this.options.extent*(Fe*Ye-ge)),Math.round(this.options.extent*(St*Ye-Ue))]],tags:xt};let bn;bn=qe||this.options.generateId?le[de+3]:this.points[le[de+3]].id,bn!==void 0&&(Lt.id=bn),At.features.push(Lt)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,le){const{radius:ge,extent:Ue,reduce:Ye,minPoints:At}=this.options,it=ge/(Ue*Math.pow(2,le)),de=oe.data,qe=[],xt=this.stride;for(let Fe=0;Fe<de.length;Fe+=xt){if(de[Fe+2]<=le)continue;de[Fe+2]=le;const St=de[Fe],Lt=de[Fe+1],bn=oe.within(de[Fe],de[Fe+1],it),yn=de[Fe+5];let $n=yn;for(const dt of bn){const ai=dt*xt;de[ai+2]>le&&($n+=de[ai+5])}if($n>yn&&$n>=At){let dt,ai=St*yn,Fn=Lt*yn,Jn=-1;const pi=(Fe/xt<<5)+(le+1)+this.points.length;for(const ur of bn){const Ti=ur*xt;if(de[Ti+2]<=le)continue;de[Ti+2]=le;const jn=de[Ti+5];ai+=de[Ti]*jn,Fn+=de[Ti+1]*jn,de[Ti+4]=pi,Ye&&(dt||(dt=this._map(de,Fe,!0),Jn=this.clusterProps.length,this.clusterProps.push(dt)),Ye(dt,this._map(de,Ti)))}de[Fe+4]=pi,qe.push(ai/$n,Fn/$n,1/0,pi,-1,$n),Ye&&qe.push(Jn)}else{for(let dt=0;dt<xt;dt++)qe.push(de[Fe+dt]);if($n>1)for(const dt of bn){const ai=dt*xt;if(!(de[ai+2]<=le)){de[ai+2]=le;for(let Fn=0;Fn<xt;Fn++)qe.push(de[ai+Fn])}}}}return qe}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,le,ge){if(oe[le+5]>1){const At=this.clusterProps[oe[le+6]];return ge?Object.assign({},At):At}const Ue=this.points[oe[le+3]].properties,Ye=this.options.map(Ue);return ge&&Ye===Ue?Object.assign({},Ye):Ye}}function _t(yt,oe,le){return{type:"Feature",id:yt[oe+3],properties:Pe(yt,oe,le),geometry:{type:"Point",coordinates:[(ge=yt[oe],360*(ge-.5)),qt(yt[oe+1])]}};var ge}function Pe(yt,oe,le){const ge=yt[oe+5],Ue=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ye=yt[oe+6],At=Ye===-1?{}:Object.assign({},le[Ye]);return Object.assign(At,{cluster:!0,cluster_id:yt[oe+3],point_count:ge,point_count_abbreviated:Ue})}function ht(yt){return yt/360+.5}function vt(yt){const oe=Math.sin(yt*Math.PI/180),le=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return le<0?0:le>1?1:le}function qt(yt){const oe=(180-360*yt)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function ke(yt,oe,le,ge){let Ue=ge;const Ye=oe+(le-oe>>1);let At,it=le-oe;const de=yt[oe],qe=yt[oe+1],xt=yt[le],Fe=yt[le+1];for(let St=oe+3;St<le;St+=3){const Lt=Te(yt[St],yt[St+1],de,qe,xt,Fe);if(Lt>Ue)At=St,Ue=Lt;else if(Lt===Ue){const bn=Math.abs(St-Ye);bn<it&&(At=St,it=bn)}}Ue>ge&&(At-oe>3&&ke(yt,oe,At,ge),yt[At+2]=Ue,le-At>3&&ke(yt,At,le,ge))}function Te(yt,oe,le,ge,Ue,Ye){let At=Ue-le,it=Ye-ge;if(At!==0||it!==0){const de=((yt-le)*At+(oe-ge)*it)/(At*At+it*it);de>1?(le=Ue,ge=Ye):de>0&&(le+=At*de,ge+=it*de)}return At=yt-le,it=oe-ge,At*At+it*it}function Ze(yt,oe,le,ge){const Ue={id:yt??null,type:oe,geometry:le,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")ut(Ue,le);else if(oe==="Polygon")ut(Ue,le[0]);else if(oe==="MultiLineString")for(const Ye of le)ut(Ue,Ye);else if(oe==="MultiPolygon")for(const Ye of le)ut(Ue,Ye[0]);return Ue}function ut(yt,oe){for(let le=0;le<oe.length;le+=3)yt.minX=Math.min(yt.minX,oe[le]),yt.minY=Math.min(yt.minY,oe[le+1]),yt.maxX=Math.max(yt.maxX,oe[le]),yt.maxY=Math.max(yt.maxY,oe[le+1])}function Tt(yt,oe,le,ge){if(!oe.geometry)return;const Ue=oe.geometry.coordinates;if(Ue&&Ue.length===0)return;const Ye=oe.geometry.type,At=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let it=[],de=oe.id;if(le.promoteId?de=oe.properties[le.promoteId]:le.generateId&&(de=ge||0),Ye==="Point")sn(Ue,it);else if(Ye==="MultiPoint")for(const qe of Ue)sn(qe,it);else if(Ye==="LineString")Re(Ue,it,At,!1);else if(Ye==="MultiLineString"){if(le.lineMetrics){for(const qe of Ue)it=[],Re(qe,it,At,!1),yt.push(Ze(de,"LineString",it,oe.properties));return}ct(Ue,it,At,!1)}else if(Ye==="Polygon")ct(Ue,it,At,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(const qe of oe.geometry.geometries)Tt(yt,{id:de,geometry:qe,properties:oe.properties},le,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of Ue){const xt=[];ct(qe,xt,At,!0),it.push(xt)}}yt.push(Ze(de,Ye,it,oe.properties))}function sn(yt,oe){oe.push(kt(yt[0]),bt(yt[1]),0)}function Re(yt,oe,le,ge){let Ue,Ye,At=0;for(let de=0;de<yt.length;de++){const qe=kt(yt[de][0]),xt=bt(yt[de][1]);oe.push(qe,xt,0),de>0&&(At+=ge?(Ue*xt-qe*Ye)/2:Math.sqrt(Math.pow(qe-Ue,2)+Math.pow(xt-Ye,2))),Ue=qe,Ye=xt}const it=oe.length-3;oe[2]=1,ke(oe,0,it,le),oe[it+2]=1,oe.size=Math.abs(At),oe.start=0,oe.end=oe.size}function ct(yt,oe,le,ge){for(let Ue=0;Ue<yt.length;Ue++){const Ye=[];Re(yt[Ue],Ye,le,ge),oe.push(Ye)}}function kt(yt){return yt/360+.5}function bt(yt){const oe=Math.sin(yt*Math.PI/180),le=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return le<0?0:le>1?1:le}function an(yt,oe,le,ge,Ue,Ye,At,it){if(ge/=oe,Ye>=(le/=oe)&&At<ge)return yt;if(At<le||Ye>=ge)return null;const de=[];for(const qe of yt){const xt=qe.geometry;let Fe=qe.type;const St=Ue===0?qe.minX:qe.minY,Lt=Ue===0?qe.maxX:qe.maxY;if(St>=le&&Lt<ge){de.push(qe);continue}if(Lt<le||St>=ge)continue;let bn=[];if(Fe==="Point"||Fe==="MultiPoint")Bt(xt,bn,le,ge,Ue);else if(Fe==="LineString")Qt(xt,bn,le,ge,Ue,!1,it.lineMetrics);else if(Fe==="MultiLineString")nn(xt,bn,le,ge,Ue,!1);else if(Fe==="Polygon")nn(xt,bn,le,ge,Ue,!0);else if(Fe==="MultiPolygon")for(const yn of xt){const $n=[];nn(yn,$n,le,ge,Ue,!0),$n.length&&bn.push($n)}if(bn.length){if(it.lineMetrics&&Fe==="LineString"){for(const yn of bn)de.push(Ze(qe.id,Fe,yn,qe.tags));continue}Fe!=="LineString"&&Fe!=="MultiLineString"||(bn.length===1?(Fe="LineString",bn=bn[0]):Fe="MultiLineString"),Fe!=="Point"&&Fe!=="MultiPoint"||(Fe=bn.length===3?"Point":"MultiPoint"),de.push(Ze(qe.id,Fe,bn,qe.tags))}}return de.length?de:null}function Bt(yt,oe,le,ge,Ue){for(let Ye=0;Ye<yt.length;Ye+=3){const At=yt[Ye+Ue];At>=le&&At<=ge&&kn(oe,yt[Ye],yt[Ye+1],yt[Ye+2])}}function Qt(yt,oe,le,ge,Ue,Ye,At){let it=un(yt);const de=Ue===0?Nn:ii;let qe,xt,Fe=yt.start;for(let $n=0;$n<yt.length-3;$n+=3){const dt=yt[$n],ai=yt[$n+1],Fn=yt[$n+2],Jn=yt[$n+3],pi=yt[$n+4],ur=Ue===0?dt:ai,Ti=Ue===0?Jn:pi;let jn=!1;At&&(qe=Math.sqrt(Math.pow(dt-Jn,2)+Math.pow(ai-pi,2))),ur<le?Ti>le&&(xt=de(it,dt,ai,Jn,pi,le),At&&(it.start=Fe+qe*xt)):ur>ge?Ti<ge&&(xt=de(it,dt,ai,Jn,pi,ge),At&&(it.start=Fe+qe*xt)):kn(it,dt,ai,Fn),Ti<le&&ur>=le&&(xt=de(it,dt,ai,Jn,pi,le),jn=!0),Ti>ge&&ur<=ge&&(xt=de(it,dt,ai,Jn,pi,ge),jn=!0),!Ye&&jn&&(At&&(it.end=Fe+qe*xt),oe.push(it),it=un(yt)),At&&(Fe+=qe)}let St=yt.length-3;const Lt=yt[St],bn=yt[St+1],yn=Ue===0?Lt:bn;yn>=le&&yn<=ge&&kn(it,Lt,bn,yt[St+2]),St=it.length-3,Ye&&St>=3&&(it[St]!==it[0]||it[St+1]!==it[1])&&kn(it,it[0],it[1],it[2]),it.length&&oe.push(it)}function un(yt){const oe=[];return oe.size=yt.size,oe.start=yt.start,oe.end=yt.end,oe}function nn(yt,oe,le,ge,Ue,Ye){for(const At of yt)Qt(At,oe,le,ge,Ue,Ye,!1)}function kn(yt,oe,le,ge){yt.push(oe,le,ge)}function Nn(yt,oe,le,ge,Ue,Ye){const At=(Ye-oe)/(ge-oe);return kn(yt,Ye,le+(Ue-le)*At,1),At}function ii(yt,oe,le,ge,Ue,Ye){const At=(Ye-le)/(Ue-le);return kn(yt,oe+(ge-oe)*At,Ye,1),At}function En(yt,oe){const le=[];for(let ge=0;ge<yt.length;ge++){const Ue=yt[ge],Ye=Ue.type;let At;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")At=si(Ue.geometry,oe);else if(Ye==="MultiLineString"||Ye==="Polygon"){At=[];for(const it of Ue.geometry)At.push(si(it,oe))}else if(Ye==="MultiPolygon"){At=[];for(const it of Ue.geometry){const de=[];for(const qe of it)de.push(si(qe,oe));At.push(de)}}le.push(Ze(Ue.id,Ye,At,Ue.tags))}return le}function si(yt,oe){const le=[];le.size=yt.size,yt.start!==void 0&&(le.start=yt.start,le.end=yt.end);for(let ge=0;ge<yt.length;ge+=3)le.push(yt[ge]+oe,yt[ge+1],yt[ge+2]);return le}function wi(yt,oe){if(yt.transformed)return yt;const le=1<<yt.z,ge=yt.x,Ue=yt.y;for(const Ye of yt.features){const At=Ye.geometry,it=Ye.type;if(Ye.geometry=[],it===1)for(let de=0;de<At.length;de+=2)Ye.geometry.push(Oi(At[de],At[de+1],oe,le,ge,Ue));else for(let de=0;de<At.length;de++){const qe=[];for(let xt=0;xt<At[de].length;xt+=2)qe.push(Oi(At[de][xt],At[de][xt+1],oe,le,ge,Ue));Ye.geometry.push(qe)}}return yt.transformed=!0,yt}function Oi(yt,oe,le,ge,Ue,Ye){return[Math.round(le*(yt*ge-Ue)),Math.round(le*(oe*ge-Ye))]}function Yn(yt,oe,le,ge,Ue){const Ye=oe===Ue.maxZoom?0:Ue.tolerance/((1<<oe)*Ue.extent),At={features:[],numPoints:0,numSimplified:0,numFeatures:yt.length,source:null,x:le,y:ge,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const it of yt)Gn(At,it,Ye,Ue);return At}function Gn(yt,oe,le,ge){const Ue=oe.geometry,Ye=oe.type,At=[];if(yt.minX=Math.min(yt.minX,oe.minX),yt.minY=Math.min(yt.minY,oe.minY),yt.maxX=Math.max(yt.maxX,oe.maxX),yt.maxY=Math.max(yt.maxY,oe.maxY),Ye==="Point"||Ye==="MultiPoint")for(let it=0;it<Ue.length;it+=3)At.push(Ue[it],Ue[it+1]),yt.numPoints++,yt.numSimplified++;else if(Ye==="LineString")Rn(At,Ue,yt,le,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(let it=0;it<Ue.length;it++)Rn(At,Ue[it],yt,le,Ye==="Polygon",it===0);else if(Ye==="MultiPolygon")for(let it=0;it<Ue.length;it++){const de=Ue[it];for(let qe=0;qe<de.length;qe++)Rn(At,de[qe],yt,le,!0,qe===0)}if(At.length){let it=oe.tags||null;if(Ye==="LineString"&&ge.lineMetrics){it={};for(const qe in oe.tags)it[qe]=oe.tags[qe];it.mapbox_clip_start=Ue.start/Ue.size,it.mapbox_clip_end=Ue.end/Ue.size}const de={geometry:At,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:it};oe.id!==null&&(de.id=oe.id),yt.features.push(de)}}function Rn(yt,oe,le,ge,Ue,Ye){const At=ge*ge;if(ge>0&&oe.size<(Ue?At:ge))return void(le.numPoints+=oe.length/3);const it=[];for(let de=0;de<oe.length;de+=3)(ge===0||oe[de+2]>At)&&(le.numSimplified++,it.push(oe[de],oe[de+1])),le.numPoints++;Ue&&(function(de,qe){let xt=0;for(let Fe=0,St=de.length,Lt=St-2;Fe<St;Lt=Fe,Fe+=2)xt+=(de[Fe]-de[Lt])*(de[Fe+1]+de[Lt+1]);if(xt>0===qe)for(let Fe=0,St=de.length;Fe<St/2;Fe+=2){const Lt=de[Fe],bn=de[Fe+1];de[Fe]=de[St-2-Fe],de[Fe+1]=de[St-1-Fe],de[St-2-Fe]=Lt,de[St-1-Fe]=bn}})(it,Ye),yt.push(it)}const Ei={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class on{constructor(oe,le){const ge=(le=this.options=(function(Ye,At){for(const it in At)Ye[it]=At[it];return Ye})(Object.create(Ei),le)).debug;if(ge&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ue=(function(Ye,At){const it=[];if(Ye.type==="FeatureCollection")for(let de=0;de<Ye.features.length;de++)Tt(it,Ye.features[de],At,de);else Tt(it,Ye.type==="Feature"?Ye:{geometry:Ye},At);return it})(oe,le);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ue=(function(Ye,At){const it=At.buffer/At.extent;let de=Ye;const qe=an(Ye,1,-1-it,it,0,-1,2,At),xt=an(Ye,1,1-it,2+it,0,-1,2,At);return(qe||xt)&&(de=an(Ye,1,-it,1+it,0,-1,2,At)||[],qe&&(de=En(qe,1).concat(de)),xt&&(de=de.concat(En(xt,-1)))),de})(Ue,le),Ue.length&&this.splitTile(Ue,0,0,0),ge&&(Ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,le,ge,Ue,Ye,At,it){const de=[oe,le,ge,Ue],qe=this.options,xt=qe.debug;for(;de.length;){Ue=de.pop(),ge=de.pop(),le=de.pop(),oe=de.pop();const Fe=1<<le,St=Li(le,ge,Ue);let Lt=this.tiles[St];if(!Lt&&(xt>1&&console.time("creation"),Lt=this.tiles[St]=Yn(oe,le,ge,Ue,qe),this.tileCoords.push({z:le,x:ge,y:Ue}),xt)){xt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,ge,Ue,Lt.numFeatures,Lt.numPoints,Lt.numSimplified),console.timeEnd("creation"));const jn=`z${le}`;this.stats[jn]=(this.stats[jn]||0)+1,this.total++}if(Lt.source=oe,Ye==null){if(le===qe.indexMaxZoom||Lt.numPoints<=qe.indexMaxPoints)continue}else{if(le===qe.maxZoom||le===Ye)continue;if(Ye!=null){const jn=Ye-le;if(ge!==At>>jn||Ue!==it>>jn)continue}}if(Lt.source=null,oe.length===0)continue;xt>1&&console.time("clipping");const bn=.5*qe.buffer/qe.extent,yn=.5-bn,$n=.5+bn,dt=1+bn;let ai=null,Fn=null,Jn=null,pi=null,ur=an(oe,Fe,ge-bn,ge+$n,0,Lt.minX,Lt.maxX,qe),Ti=an(oe,Fe,ge+yn,ge+dt,0,Lt.minX,Lt.maxX,qe);oe=null,ur&&(ai=an(ur,Fe,Ue-bn,Ue+$n,1,Lt.minY,Lt.maxY,qe),Fn=an(ur,Fe,Ue+yn,Ue+dt,1,Lt.minY,Lt.maxY,qe),ur=null),Ti&&(Jn=an(Ti,Fe,Ue-bn,Ue+$n,1,Lt.minY,Lt.maxY,qe),pi=an(Ti,Fe,Ue+yn,Ue+dt,1,Lt.minY,Lt.maxY,qe),Ti=null),xt>1&&console.timeEnd("clipping"),de.push(ai||[],le+1,2*ge,2*Ue),de.push(Fn||[],le+1,2*ge,2*Ue+1),de.push(Jn||[],le+1,2*ge+1,2*Ue),de.push(pi||[],le+1,2*ge+1,2*Ue+1)}}getTile(oe,le,ge){oe=+oe,le=+le,ge=+ge;const Ue=this.options,{extent:Ye,debug:At}=Ue;if(oe<0||oe>24)return null;const it=1<<oe,de=Li(oe,le=le+it&it-1,ge);if(this.tiles[de])return wi(this.tiles[de],Ye);At>1&&console.log("drilling down to z%d-%d-%d",oe,le,ge);let qe,xt=oe,Fe=le,St=ge;for(;!qe&&xt>0;)xt--,Fe>>=1,St>>=1,qe=this.tiles[Li(xt,Fe,St)];return qe&&qe.source?(At>1&&(console.log("found parent tile z%d-%d-%d",xt,Fe,St),console.time("drilling down")),this.splitTile(qe.source,xt,Fe,St,oe,le,ge),At>1&&console.timeEnd("drilling down"),this.tiles[de]?wi(this.tiles[de],Ye):null):null}}function Li(yt,oe,le){return 32*((1<<yt)*le+oe)+yt}class tr extends he{constructor(oe,le,ge,Ue=Di){super(oe,le,ge),this._dataUpdateable=new Map,this._createGeoJSONIndex=Ue}loadVectorTile(oe,le){return N._(this,void 0,void 0,(function*(){const ge=oe.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ue=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);return Ue?ve(new N.d2(Ue.features,{version:2,extent:N.a5})):null}))}loadData(oe){return N._(this,void 0,void 0,(function*(){var le;(le=this._pendingRequest)===null||le===void 0||le.abort();const ge=this._startPerformance(oe);this._pendingRequest=new AbortController;try{(!this._pendingData||oe.request||oe.data||oe.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(oe,this._pendingRequest));const Ue=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Ue,oe),this.loaded={};const Ye={};return oe.request&&(Ye.data=Ue),this._finishPerformance(ge,oe,Ye),Ye}catch(Ue){if(delete this._pendingRequest,N.Z(Ue))return{abandoned:!0};throw Ue}}))}_startPerformance(oe){var le;if(!((le=oe?.request)===null||le===void 0)&&le.collectResourceTiming)return new N.c_(oe.request)}_finishPerformance(oe,le,ge){if(!oe)return;const Ue=oe.finish();Ue&&(ge.resourceTiming={},ge.resourceTiming[le.source]=JSON.parse(JSON.stringify(Ue)))}getData(){return N._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(oe){const le=this.loaded;return le&&le[oe.uid]?super.reloadTile(oe):this.loadTile(oe)}loadAndProcessGeoJSON(oe,le){return N._(this,void 0,void 0,(function*(){let ge;if(oe.request?ge=yield this.loadGeoJSONFromUrl(oe.request,oe.promoteId,le):oe.data?ge=this._loadGeoJSONFromObject(oe.data,oe.promoteId):oe.dataDiff&&(ge=this._loadGeoJSONFromDiff(oe.dataDiff,oe.promoteId,oe.source)),delete this._pendingRequest,typeof ge!="object")throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`);return Wt(ge,!0),oe.filter&&(ge=this._filterGeoJSON(ge,oe.filter)),ge}))}loadGeoJSONFromUrl(oe,le,ge){return N._(this,void 0,void 0,(function*(){const Ue=yield N.j(oe,ge);return this._dataUpdateable=N.a7(Ue.data,le),Ue.data}))}_loadGeoJSONFromObject(oe,le){return this._dataUpdateable=N.a7(oe,le),oe}_loadGeoJSONFromDiff(oe,le,ge){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ge}`);N.a8(this._dataUpdateable,oe,le);const Ue=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Ue)}_filterGeoJSON(oe,le){const ge=N.d3(le,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map((Ye=>`${Ye.key}: ${Ye.message}`)).join(", "));const Ue=oe.features.filter((Ye=>ge.value.evaluate({zoom:0},Ye)));return this._toFeatureCollection(Ue)}_toFeatureCollection(oe){return{type:"FeatureCollection",features:oe}}removeSource(oe){return N._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(oe){return this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId)}getClusterChildren(oe){return this._geoJSONIndex.getChildren(oe.clusterId)}getClusterLeaves(oe){return this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset)}}function Di(yt,oe){return oe.cluster?new He((function({superclusterOptions:le,clusterProperties:ge}){if(!ge||!le)return le;const Ue={},Ye={},At={accumulated:null,zoom:0},it={properties:null},de=Object.keys(ge);for(const qe of de){const[xt,Fe]=ge[qe],St=N.d3(Fe),Lt=N.d3(typeof xt=="string"?[xt,["accumulated"],["get",qe]]:xt);Ue[qe]=St.value,Ye[qe]=Lt.value}return le.map=qe=>{it.properties=qe;const xt={};for(const Fe of de)xt[Fe]=Ue[Fe].evaluate(At,it);return xt},le.reduce=(qe,xt)=>{it.properties=xt;for(const Fe of de)At.accumulated=qe[Fe],qe[Fe]=Ye[Fe].evaluate(At,it)},le})(oe)).load(yt.features):(function(le,ge){return new on(le,ge)})(yt,oe.geojsonVtOptions)}class yr{constructor(oe){this.self=oe,this.actor=new N.L(oe),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(le,ge)=>{if(this.externalWorkerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.externalWorkerSourceTypes[le]=ge},this.self.addProtocol=N.cJ,this.self.removeProtocol=N.cK,this.self.registerRTLTextPlugin=le=>{N.d4.setMethods(le)},this.actor.registerMessageHandler("LDT",((le,ge)=>this._getDEMWorkerSource(le,ge.source).loadTile(ge))),this.actor.registerMessageHandler("RDT",((le,ge)=>N._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(le,ge.source).removeTile(ge)})))),this.actor.registerMessageHandler("GCEZ",((le,ge)=>N._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,ge.type,ge.source).getClusterExpansionZoom(ge)})))),this.actor.registerMessageHandler("GCC",((le,ge)=>N._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,ge.type,ge.source).getClusterChildren(ge)})))),this.actor.registerMessageHandler("GCL",((le,ge)=>N._(this,void 0,void 0,(function*(){return this._getWorkerSource(le,ge.type,ge.source).getClusterLeaves(ge)})))),this.actor.registerMessageHandler("LD",((le,ge)=>this._getWorkerSource(le,ge.type,ge.source).loadData(ge))),this.actor.registerMessageHandler("GD",((le,ge)=>this._getWorkerSource(le,ge.type,ge.source).getData())),this.actor.registerMessageHandler("LT",((le,ge)=>this._getWorkerSource(le,ge.type,ge.source).loadTile(ge))),this.actor.registerMessageHandler("RT",((le,ge)=>this._getWorkerSource(le,ge.type,ge.source).reloadTile(ge))),this.actor.registerMessageHandler("AT",((le,ge)=>this._getWorkerSource(le,ge.type,ge.source).abortTile(ge))),this.actor.registerMessageHandler("RMT",((le,ge)=>this._getWorkerSource(le,ge.type,ge.source).removeTile(ge))),this.actor.registerMessageHandler("RS",((le,ge)=>N._(this,void 0,void 0,(function*(){if(!this.workerSources[le]||!this.workerSources[le][ge.type]||!this.workerSources[le][ge.type][ge.source])return;const Ue=this.workerSources[le][ge.type][ge.source];delete this.workerSources[le][ge.type][ge.source],Ue.removeSource!==void 0&&Ue.removeSource(ge)})))),this.actor.registerMessageHandler("RM",(le=>N._(this,void 0,void 0,(function*(){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le],this.globalStates.delete(le)})))),this.actor.registerMessageHandler("SR",((le,ge)=>N._(this,void 0,void 0,(function*(){this.referrer=ge})))),this.actor.registerMessageHandler("SRPS",((le,ge)=>this._syncRTLPluginState(le,ge))),this.actor.registerMessageHandler("IS",((le,ge)=>N._(this,void 0,void 0,(function*(){this.self.importScripts(ge)})))),this.actor.registerMessageHandler("SI",((le,ge)=>this._setImages(le,ge))),this.actor.registerMessageHandler("UL",((le,ge)=>N._(this,void 0,void 0,(function*(){this._getLayerIndex(le).update(ge.layers,ge.removedIds,this._getGlobalState(le))})))),this.actor.registerMessageHandler("UGS",((le,ge)=>N._(this,void 0,void 0,(function*(){const Ue=this._getGlobalState(le);for(const Ye in ge)Ue[Ye]=ge[Ye]})))),this.actor.registerMessageHandler("SL",((le,ge)=>N._(this,void 0,void 0,(function*(){this._getLayerIndex(le).replace(ge,this._getGlobalState(le))}))))}_getGlobalState(oe){let le=this.globalStates.get(oe);return le||(le={},this.globalStates.set(oe,le)),le}_setImages(oe,le){return N._(this,void 0,void 0,(function*(){this.availableImages[oe]=le;for(const ge in this.workerSources[oe]){const Ue=this.workerSources[oe][ge];for(const Ye in Ue)Ue[Ye].availableImages=le}}))}_syncRTLPluginState(oe,le){return N._(this,void 0,void 0,(function*(){return yield N.d4.syncState(le,this.self.importScripts)}))}_getAvailableImages(oe){let le=this.availableImages[oe];return le||(le=[]),le}_getLayerIndex(oe){let le=this.layerIndexes[oe];return le||(le=this.layerIndexes[oe]=new h),le}_getWorkerSource(oe,le,ge){if(this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][le]||(this.workerSources[oe][le]={}),!this.workerSources[oe][le][ge]){const Ue={sendAsync:(Ye,At)=>(Ye.targetMapId=oe,this.actor.sendAsync(Ye,At))};switch(le){case"vector":this.workerSources[oe][le][ge]=new he(Ue,this._getLayerIndex(oe),this._getAvailableImages(oe));break;case"geojson":this.workerSources[oe][le][ge]=new tr(Ue,this._getLayerIndex(oe),this._getAvailableImages(oe));break;default:this.workerSources[oe][le][ge]=new this.externalWorkerSourceTypes[le](Ue,this._getLayerIndex(oe),this._getAvailableImages(oe))}}return this.workerSources[oe][le][ge]}_getDEMWorkerSource(oe,le){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][le]||(this.demWorkerSources[oe][le]=new De),this.demWorkerSources[oe][le]}}return N.i(self)&&(self.worker=new yr(self)),yr})),D("index",["exports","./shared"],(function(N,h){var U="5.15.0";function H(){var A=new h.A(4);return h.A!=Float32Array&&(A[1]=0,A[2]=0),A[0]=1,A[3]=1,A}let Y,K,_e;const we={frame(A,t,s){const f=requestAnimationFrame((S=>{x(),t(S)})),{unsubscribe:x}=h.s(A.signal,"abort",(()=>{x(),cancelAnimationFrame(f),s(new h.a(A.signal.reason))}),!1)},frameAsync(A){return new Promise(((t,s)=>{this.frame(A,t,s)}))},getImageData(A,t=0){return this.getImageCanvasContext(A).getImageData(-t,-t,A.width+2*t,A.height+2*t)},getImageCanvasContext(A){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=A.width,t.height=A.height,s.drawImage(A,0,0,A.width,A.height),s},resolveURL:A=>(Y||(Y=document.createElement("a")),Y.href=A,Y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return _e!==void 0?_e:!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)},set prefersReducedMotion(A){_e=A}},ve=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(A){this._frozenAt=A}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function pe(){return ve.getCurrentTime()}class he{static testProp(t){if(!he.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in he.docStyle)return t[s];return t[0]}static create(t,s,f){const x=window.document.createElement(t);return s!==void 0&&(x.className=s),f&&f.appendChild(x),x}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){he.docStyle&&he.selectProp&&(he.userSelect=he.docStyle[he.selectProp],he.docStyle[he.selectProp]="none")}static enableDrag(){he.docStyle&&he.selectProp&&(he.docStyle[he.selectProp]=he.userSelect)}static setTransform(t,s){t.style[he.transformProp]=s}static addEventListener(t,s,f,x={}){t.addEventListener(s,f,"passive"in x?x:x.capture)}static removeEventListener(t,s,f,x={}){t.removeEventListener(s,f,"passive"in x?x:x.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",he.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",he.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",he.suppressClickInternal,!0)}),0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,f){const x=s.boundingClientRect;return new h.P((f.clientX-x.left)/s.x-t.clientLeft,(f.clientY-x.top)/s.y-t.clientTop)}static mousePos(t,s){const f=he.getScale(t);return he.getPoint(t,f,s)}static touchPos(t,s){const f=[],x=he.getScale(t);for(let S=0;S<s.length;S++)f.push(he.getPoint(t,x,s[S]));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const s=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),f=s.querySelectorAll("script");for(const x of f)x.remove();return he.clean(s),s.innerHTML}static isPossiblyDangerous(t,s){const f=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!f.includes("javascript:")&&!f.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const s=t.children;for(const f of s)he.removeAttributes(f),he.clean(f)}static removeAttributes(t){for(const{name:s,value:f}of t.attributes)he.isPossiblyDangerous(s,f)&&t.removeAttribute(s)}}he.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,he.selectProp=he.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),he.transformProp=he.testProp(["transform","WebkitTransform"]);const De={supported:!1,testSupport:function(A){!mt&&Xe&&(Wt?Et(A):Je=A)}};let Je,Xe,mt=!1,Wt=!1;function Et(A){const t=A.createTexture();A.bindTexture(A.TEXTURE_2D,t);try{if(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,Xe),A.isContextLost())return;De.supported=!0}catch{}A.deleteTexture(t),mt=!0}var rt;typeof document<"u"&&(Xe=document.createElement("img"),Xe.onload=()=>{Je&&Et(Je),Je=null,Wt=!0},Xe.onerror=()=>{mt=!0,Je=null},Xe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(A){let t,s,f,x;A.resetRequestQueue=()=>{t=[],s=0,f=0,x={}},A.addThrottleControl=j=>{const Z=f++;return x[Z]=j,Z},A.removeThrottleControl=j=>{delete x[j],M()},A.getImage=(j,Z,W=!0)=>new Promise(((ee,J)=>{De.supported&&(j.headers||(j.headers={}),j.headers.accept="image/webp,*/*"),h.e(j,{type:"image"}),t.push({abortController:Z,requestParameters:j,supportImageRefresh:W,state:"queued",onError:se=>{J(se)},onSuccess:se=>{ee(se)}}),M()}));const S=j=>h._(this,void 0,void 0,(function*(){j.state="running";const{requestParameters:Z,supportImageRefresh:W,onError:ee,onSuccess:J,abortController:se}=j,fe=W===!1&&!h.i(self)&&!h.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce(((Ie,Le)=>Ie&&Le==="accept"),!0));s++;const Ce=fe?z(Z,se):h.m(Z,se);try{const Ie=yield Ce;delete j.abortController,j.state="completed",Ie.data instanceof HTMLImageElement||h.b(Ie.data)?J(Ie):Ie.data&&J({data:yield(Me=Ie.data,typeof createImageBitmap=="function"?h.f(Me):h.h(Me)),cacheControl:Ie.cacheControl,expires:Ie.expires})}catch(Ie){delete j.abortController,ee(Ie)}finally{s--,M()}var Me})),M=()=>{const j=(()=>{for(const Z of Object.keys(x))if(x[Z]())return!0;return!1})()?h.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=s;Z<j&&t.length>0;Z++){const W=t.shift();W.abortController.signal.aborted?Z--:S(W)}},z=(j,Z)=>new Promise(((W,ee)=>{const J=new Image,se=j.url,fe=j.credentials;fe&&fe==="include"?J.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!h.d(se))&&(J.crossOrigin="anonymous"),Z.signal.addEventListener("abort",(()=>{J.src="",ee(new h.a(Z.signal.reason))})),J.fetchPriority="high",J.onload=()=>{J.onerror=J.onload=null,W({data:J})},J.onerror=()=>{J.onerror=J.onload=null,Z.signal.aborted||ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},J.src=se}))})(rt||(rt={})),rt.resetRequestQueue();class at{constructor(t){this._transformRequestFn=t??null}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function He(A){const t=[];if(typeof A=="string")t.push({id:"default",url:A});else if(A&&A.length>0){const s=[];for(const{id:f,url:x}of A){const S=`${f}${x}`;s.indexOf(S)===-1&&(s.push(S),t.push({id:f,url:x}))}}return t}function _t(A,t,s){try{const f=new URL(A);return f.pathname+=`${t}${s}`,f.toString()}catch{throw new Error(`Invalid sprite URL "${A}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Pe(A){const{userImage:t}=A;return!!(t&&t.render&&t.render())&&(A.data.replace(new Uint8Array(t.data.buffer)),!0)}class ht extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:f}of this.requestors)f(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const f=s.spriteData;s.data=new h.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let f=!0;const x=s.data||s.spriteData;return this._validateStretch(s.stretchX,x&&x.width)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(s.stretchY,x&&x.height)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(s.content,s)||(this.fire(new h.k(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,s){if(!t)return!0;let f=0;for(const x of t){if(x[0]<f||x[1]<x[0]||s<x[1])return!1;f=x[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const f=s.spriteData,x=f&&f.width||s.data.width,S=f&&f.height||s.data.height;return!(t[0]<0||x<t[0]||t[1]<0||S<t[1]||t[2]<0||x<t[2]||t[3]<0||S<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,f=!0){const x=this.getImage(t);if(f&&(x.data.width!==s.data.width||x.data.height!==s.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=x.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((s,f)=>{let x=!0;if(!this.isLoaded())for(const S of t)this.images[S]||(x=!1);this.isLoaded()||x?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})}))}_getImagesForIds(t){const s={};for(const f of t){let x=this.getImage(f);x||(this.fire(new h.l("styleimagemissing",{id:f})),x=this.getImage(f)),x?s[f]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:h.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],f=this.getImage(t);if(!f)return null;if(s&&s.position.version===f.version)return s.position;if(s)s.position.version=f.version;else{const x={w:f.data.width+2,h:f.data.height+2,x:0,y:0},S=new h.I(x,f);this.patterns[t]={bin:x,position:S}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const S in this.patterns)t.push(this.patterns[S].bin);const{w:s,h:f}=h.p(t),x=this.atlasImage;x.resize({width:s||1,height:f||1});for(const S in this.patterns){const{bin:M}=this.patterns[S],z=M.x+1,j=M.y+1,Z=this.getImage(S).data,W=Z.width,ee=Z.height;h.R.copy(Z,x,{x:0,y:0},{x:z,y:j},{width:W,height:ee}),h.R.copy(Z,x,{x:0,y:ee-1},{x:z,y:j-1},{width:W,height:1}),h.R.copy(Z,x,{x:0,y:0},{x:z,y:j+ee},{width:W,height:1}),h.R.copy(Z,x,{x:W-1,y:0},{x:z-1,y:j},{width:1,height:ee}),h.R.copy(Z,x,{x:0,y:0},{x:z+W,y:j},{width:1,height:ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const f=this.getImage(s);f||h.w(`Image with ID: "${s}" was not found`),Pe(f)&&this.updateImage(s,f)}}cloneImages(){const t={};for(const s in this.images){const f=this.images[s];t[s]=Object.assign(Object.assign({},f),{data:f.data?f.data.clone():null})}return t}}const vt=1e20;function qt(A,t,s,f,x,S,M,z,j){for(let Z=t;Z<t+f;Z++)ke(A,s*S+Z,S,x,M,z,j);for(let Z=s;Z<s+x;Z++)ke(A,Z*S+t,1,f,M,z,j)}function ke(A,t,s,f,x,S,M){S[0]=0,M[0]=-vt,M[1]=vt,x[0]=A[t];for(let z=1,j=0,Z=0;z<f;z++){x[z]=A[t+z*s];const W=z*z;do{const ee=S[j];Z=(x[z]-x[ee]+W-ee*ee)/(z-ee)/2}while(Z<=M[j]&&--j>-1);j++,S[j]=z,M[j]=Z,M[j+1]=vt}for(let z=0,j=0;z<f;z++){for(;M[j+1]<z;)j++;const Z=S[j],W=z-Z;A[t+z*s]=x[Z]+W*W}}const Te=h.v.layout_symbol["text-font"].default.join(",");class Ze{constructor(t,s,f){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={},this.lang=f}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,(function*(){const s=[];for(const S in t)for(const M of t[S])s.push(this._getAndCacheGlyphsPromise(S,M));const f=yield Promise.all(s),x={};for(const{stack:S,id:M,glyph:z}of f)x[S]||(x[S]={}),x[S][M]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return x}))}_getAndCacheGlyphsPromise(t,s){return h._(this,void 0,void 0,(function*(){let f=this.entries[t];f||(f=this.entries[t]={glyphs:{},requests:{},ranges:{}});let x=f.glyphs[s];return x!==void 0?{stack:t,id:s,glyph:x}:!this.url||this._charUsesLocalIdeographFontFamily(s)?(x=f.glyphs[s]=this._drawGlyph(f,t,s),{stack:t,id:s,glyph:x}):yield this._downloadAndCacheRangePromise(t,s)}))}_downloadAndCacheRangePromise(t,s){return h._(this,void 0,void 0,(function*(){const f=this.entries[t],x=Math.floor(s/256);if(f.ranges[x])return{stack:t,id:s,glyph:null};if(!f.requests[x]){const S=Ze.loadGlyphRange(t,x,this.url,this.requestManager);f.requests[x]=S}try{const S=yield f.requests[x];for(const M in S)f.glyphs[+M]=S[+M];return f.ranges[x]=!0,{stack:t,id:s,glyph:S[s]||null}}catch(S){const M=f.glyphs[s]=this._drawGlyph(f,t,s);return this._warnOnMissingGlyphRange(M,x,s,S),{stack:t,id:s,glyph:M}}}))}_warnOnMissingGlyphRange(t,s,f,x){const S=256*s,M=S+255,z=f.toString(16).padStart(4,"0").toUpperCase();h.w(`Unable to load glyph range ${s}, ${S}-${M}. Rendering codepoint U+${z} locally instead. ${x}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&h.q(t)}_drawGlyph(t,s,f){const x=s===Te&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(f),S=x?"ideographTinySDF":"tinySDF";t[S]||(t[S]=this._createTinySDF(x?this.localIdeographFontFamily:s));const M=t[S].draw(String.fromCodePoint(f));return{id:f,bitmap:new h.r({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const s=t?t.split(","):[];s.push("sans-serif");const f=s.map((x=>/[-\w]+/.test(x)?x:`'${CSS.escape(x)}'`)).join(",");return new Ze.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:this._fontWeight(s[0]),fontStyle:this._fontStyle(s[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const s={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let f;for(const[x,S]of Object.entries(s))new RegExp(`\\b${x}\\b`,"i").test(t)&&(f=`${S}`);return f}destroy(){for(const t in this.entries){const s=this.entries[t];s.tinySDF&&(s.tinySDF=null),s.ideographTinySDF&&(s.ideographTinySDF=null),s.glyphs={},s.requests={},s.ranges={}}this.entries={}}}Ze.loadGlyphRange=function(A,t,s,f){return h._(this,void 0,void 0,(function*(){const x=256*t,S=x+255,M=f.transformRequest(s.replace("{fontstack}",A).replace("{range}",`${x}-${S}`),"Glyphs"),z=yield h.n(M,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${t}, ${x}-${S}`);const j={};for(const Z of h.o(z.data))j[Z.id]=Z;return j}))},Ze.TinySDF=class{constructor({fontSize:A=24,buffer:t=3,radius:s=8,cutoff:f=.25,fontFamily:x="sans-serif",fontWeight:S="normal",fontStyle:M="normal",lang:z=null}={}){this.buffer=t,this.cutoff=f,this.radius=s,this.lang=z;const j=this.size=A+4*t,Z=this._createCanvas(j),W=this.ctx=Z.getContext("2d",{willReadFrequently:!0});W.font=`${M} ${S} ${A}px ${x}`,W.textBaseline="alphabetic",W.textAlign="left",W.fillStyle="black",this.gridOuter=new Float64Array(j*j),this.gridInner=new Float64Array(j*j),this.f=new Float64Array(j),this.z=new Float64Array(j+1),this.v=new Uint16Array(j)}_createCanvas(A){const t=document.createElement("canvas");return t.width=t.height=A,t}draw(A){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:f,actualBoundingBoxLeft:x,actualBoundingBoxRight:S}=this.ctx.measureText(A),M=Math.ceil(s),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-x))),j=Math.min(this.size-this.buffer,M+Math.ceil(f)),Z=z+2*this.buffer,W=j+2*this.buffer,ee=Math.max(Z*W,0),J=new Uint8ClampedArray(ee),se={data:J,width:Z,height:W,glyphWidth:z,glyphHeight:j,glyphTop:M,glyphLeft:0,glyphAdvance:t};if(z===0||j===0)return se;const{ctx:fe,buffer:Ce,gridInner:Me,gridOuter:Ie}=this;this.lang&&(fe.lang=this.lang),fe.clearRect(Ce,Ce,z,j),fe.fillText(A,Ce,Ce+M);const Le=fe.getImageData(Ce,Ce,z,j);Ie.fill(vt,0,ee),Me.fill(0,0,ee);for(let $e=0;$e<j;$e++)for(let ze=0;ze<z;ze++){const We=Le.data[4*($e*z+ze)+3]/255;if(We===0)continue;const st=($e+Ce)*Z+ze+Ce;if(We===1)Ie[st]=0,Me[st]=vt;else{const Ve=.5-We;Ie[st]=Ve>0?Ve*Ve:0,Me[st]=Ve<0?Ve*Ve:0}}qt(Ie,0,0,Z,W,Z,this.f,this.v,this.z),qt(Me,Ce,Ce,z,j,Z,this.f,this.v,this.z);for(let $e=0;$e<ee;$e++){const ze=Math.sqrt(Ie[$e])-Math.sqrt(Me[$e]);J[$e]=Math.round(255-255*(ze/this.radius+this.cutoff))}return se}};class ut{constructor(){this.specification=h.u.light.position}possiblyEvaluate(t,s){return h.F(t.expression.evaluate(s))}interpolate(t,s,f){return{x:h.G.number(t.x,s.x,f),y:h.G.number(t.y,s.y,f),z:h.G.number(t.z,s.z,f)}}}let Tt;class sn extends h.E{constructor(t){super(),Tt=Tt||new h.t({anchor:new h.D(h.u.light.anchor),position:new ut,color:new h.D(h.u.light.color),intensity:new h.D(h.u.light.intensity)}),this._transitionable=new h.x(Tt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(h.y,t,s))for(const f in t){const x=t[f];f.endsWith(h.z)?this._transitionable.setTransition(f.slice(0,-h.z.length),x):this._transitionable.setValue(f,x)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,f){return(!f||f.validate!==!1)&&h.B(this,t.call(h.C,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.u}))}}const Re=new h.t({"sky-color":new h.D(h.u.sky["sky-color"]),"horizon-color":new h.D(h.u.sky["horizon-color"]),"fog-color":new h.D(h.u.sky["fog-color"]),"fog-ground-blend":new h.D(h.u.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.u.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.u.sky["atmosphere-blend"])});class ct extends h.E{constructor(t){super(),this._transitionable=new h.x(Re,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0))}setSky(t,s={}){if(!this._validate(h.J,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in t){const x=t[f];f.endsWith(h.z)?this._transitionable.setTransition(f.slice(0,-h.z.length),x):this._transitionable.setValue(f,x)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,f={}){return f?.validate!==!1&&h.B(this,t.call(h.C,h.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class kt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const f=t.join(",")+String(s);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(t,s)),this.dashEntry[f]}getDashRanges(t,s,f){const x=[];let S=t.length%2==1?-t[t.length-1]*f:0,M=t[0]*f,z=!0;x.push({left:S,right:M,isDash:z,zeroLength:t[0]===0});let j=t[0];for(let Z=1;Z<t.length;Z++){z=!z;const W=t[Z];S=j*f,j+=W,M=j*f,x.push({left:S,right:M,isDash:z,zeroLength:W===0})}return x}addRoundDash(t,s,f){const x=s/2;for(let S=-f;S<=f;S++){const M=this.width*(this.nextRow+f+S);let z=0,j=t[z];for(let Z=0;Z<this.width;Z++){Z/j.right>1&&(j=t[++z]);const W=Math.abs(Z-j.left),ee=Math.abs(Z-j.right),J=Math.min(W,ee);let se;const fe=S/f*(x+1);if(j.isDash){const Ce=x-Math.abs(fe);se=Math.sqrt(J*J+Ce*Ce)}else se=x-Math.sqrt(J*J+fe*fe);this.data[M+Z]=Math.max(0,Math.min(255,se+128))}}}addRegularDash(t){for(let z=t.length-1;z>=0;--z){const j=t[z],Z=t[z+1];j.zeroLength?t.splice(z,1):Z&&Z.isDash===j.isDash&&(Z.left=j.left,t.splice(z,1))}const s=t[0],f=t[t.length-1];s.isDash===f.isDash&&(s.left=f.left-this.width,f.right=s.right+this.width);const x=this.width*this.nextRow;let S=0,M=t[S];for(let z=0;z<this.width;z++){z/M.right>1&&(M=t[++S]);const j=Math.abs(z-M.left),Z=Math.abs(z-M.right),W=Math.min(j,Z);this.data[x+z]=Math.max(0,Math.min(255,(M.isDash?W:-W)+128))}}addDash(t,s){const f=s?7:0,x=2*f+1;if(this.nextRow+x>this.height)return h.w("LineAtlas out of space"),null;let S=0;for(let z=0;z<t.length;z++)S+=t[z];if(S!==0){const z=this.width/S,j=this.getDashRanges(t,this.width,z);s?this.addRoundDash(j,z,f):this.addRegularDash(j)}const M={y:this.nextRow+f,height:2*f,width:S};return this.nextRow+=x,this.dirty=!0,M}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const bt="maplibre_preloaded_worker_pool";class an{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<an.workerCount;)this.workers.push(new Worker(h.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[bt]}numActive(){return Object.keys(this.active).length}}const Bt=Math.floor(we.hardwareConcurrency/2);let Qt,un;function nn(){return Qt||(Qt=new an),Qt}an.workerCount=h.K(globalThis)?Math.max(Math.min(Bt,3),1):1;class kn{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const f=this.workerPool.acquire(s);for(let x=0;x<f.length;x++){const S=new h.L(f[x],s);S.name=`Worker ${x}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const f=[];for(const x of this.actors)f.push(x.sendAsync({type:t,data:s}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const f of this.actors)f.registerMessageHandler(t,s)}unregisterMessageHandler(t){for(const s of this.actors)s.unregisterMessageHandler(t)}}function Nn(){return un||(un=new kn(nn(),h.M),un.registerMessageHandler("GR",((A,t,s)=>h.m(t,s)))),un}function ii(A,t){const s=h.N();return h.O(s,s,[1,1,0]),h.Q(s,s,[.5*A.width,.5*A.height,1]),A.calculatePosMatrix?h.S(s,s,A.calculatePosMatrix(t.toUnwrapped())):s}function En(A,t,s,f,x,S,M){var z;const j=(function(J,se,fe){if(J)for(const Ce of J){const Me=se[Ce];if(Me&&Me.source===fe&&Me.type==="fill-extrusion")return!0}else for(const Ce in se){const Me=se[Ce];if(Me.source===fe&&Me.type==="fill-extrusion")return!0}return!1})((z=x?.layers)!==null&&z!==void 0?z:null,t,A.id),Z=S.maxPitchScaleFactor(),W=A.tilesIn(f,Z,j);W.sort(si);const ee=[];for(const J of W)ee.push({wrappedTileID:J.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(t,s,A.getState(),J.queryGeometry,J.cameraQueryGeometry,J.scale,x,S,Z,ii(S,J.tileID),M?(se,fe)=>M(J.tileID,se,fe):void 0)});return(function(J,se){for(const fe in J)for(const Ce of J[fe])wi(Ce,se);return J})((function(J){const se={},fe={};for(const Ce of J){const Me=Ce.queryResults,Ie=Ce.wrappedTileID,Le=fe[Ie]=fe[Ie]||{};for(const $e in Me){const ze=Me[$e],We=Le[$e]=Le[$e]||{},st=se[$e]=se[$e]||[];for(const Ve of ze)We[Ve.featureIndex]||(We[Ve.featureIndex]=!0,st.push(Ve))}}return se})(ee),A)}function si(A,t){const s=A.tileID,f=t.tileID;return s.overscaledZ-f.overscaledZ||s.canonical.y-f.canonical.y||s.wrap-f.wrap||s.canonical.x-f.canonical.x}function wi(A,t){const s=A.feature,f=t.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=f}function Oi(A,t,s){return h._(this,void 0,void 0,(function*(){let f=A;if(A.url?f=(yield h.j(t.transformRequest(A.url,"Source"),s)).data:yield we.frameAsync(s),!f)return null;const x=h.U(h.e(f,A),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(x.vectorLayerIds=f.vector_layers.map((S=>S.id))),x}))}class Yn{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.V?new h.V(t.lng,t.lat):h.V.convert(t),this}extend(t){const s=this._sw,f=this._ne;let x,S;if(t instanceof h.V)x=t,S=t;else{if(!(t instanceof Yn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Yn.convert(t)):this.extend(h.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.V.convert(t)):this;if(x=t._sw,S=t._ne,!x||!S)return this}return s||f?(s.lng=Math.min(x.lng,s.lng),s.lat=Math.min(x.lat,s.lat),f.lng=Math.max(S.lng,f.lng),f.lat=Math.max(S.lat,f.lat)):(this._sw=new h.V(x.lng,x.lat),this._ne=new h.V(S.lng,S.lat)),this}getCenter(){return new h.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.V(this.getWest(),this.getNorth())}getSouthEast(){return new h.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:f}=h.V.convert(t);let x=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&x}intersects(t){if(!((t=Yn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const s=Math.abs(this.getEast()-this.getWest()),f=Math.abs(t.getEast()-t.getWest());if(s>=360||f>=360)return!0;const x=h.W(this.getWest(),-180,180),S=h.W(this.getEast(),-180,180),M=h.W(t.getWest(),-180,180),z=h.W(t.getEast(),-180,180),j=x>=S,Z=M>=z;return!(!j||!Z)||(j?z>=x||M<=S:Z?S>=M||x<=z:M<=S&&z>=x)}static convert(t){return t instanceof Yn?t:t&&new Yn(t)}static fromLngLat(t,s=0){const f=360*s/40075017,x=f/Math.cos(Math.PI/180*t.lat);return new Yn(new h.V(t.lng-x,t.lat-f),new h.V(t.lng+x,t.lat+f))}adjustAntiMeridian(){const t=new h.V(this._sw.lng,this._sw.lat),s=new h.V(this._ne.lng,this._ne.lat);return new Yn(t,t.lng>s.lng?new h.V(s.lng+360,s.lat):s)}}class Gn{constructor(t,s,f){this.bounds=Yn.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),f=Math.floor(h.Y(this.bounds.getWest())*s),x=Math.floor(h.X(this.bounds.getNorth())*s),S=Math.ceil(h.Y(this.bounds.getEast())*s),M=Math.ceil(h.X(this.bounds.getSouth())*s);return t.x>=f&&t.x<S&&t.y>=x&&t.y<M}}class Rn extends h.E{constructor(t,s,f,x){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.U(s,["url","scheme","tileSize","promoteId","encoding"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Oi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new Gn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,h.Z(t)||this.fire(new h.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};f.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((S,M)=>{t.reloadPromise={resolve:S,reject:M}}))}else t.actor=this.dispatcher.getActor(),x="LT";t.abortController=new AbortController;try{const S=yield t.actor.sendAsync({type:x,data:f},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,S)}catch(S){if(delete t.abortController,t.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const s=t.tileID.scaledTo(this.maxzoom).canonical,f=s.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:s,overzoomRequest:this.map._requestManager.transformRequest(f,"Tile")}}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const f=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(f.resolve).catch(f.reject)}}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Ei extends h.E{constructor(t,s,f,x){super(),this.id=t,this.dispatcher=f,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.U(s,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Oi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(h.e(this,s),s.bounds&&(this.tileBounds=new Gn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,h.Z(s)||this.fire(new h.k(s))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const f=yield rt.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const x=this.map.painter.context,S=x.gl,M=f.data;t.texture=this.map.painter.getTileTexture(M.width),t.texture?t.texture.update(M,{useMipmap:!0}):(t.texture=new h.T(x,M,S.RGBA,{useMipmap:!0}),t.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class on extends Ei{constructor(t,s,f,x){super(t,s,f,x),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const x=yield rt.getImage(f,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(x&&x.data){const S=x.data;this.map._refreshExpiredTiles&&(x.cacheControl||x.expires)&&t.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const M=h.b(S)&&h.$()?S:yield this.readImageNow(S),z={type:this.type,uid:t.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const j=yield t.actor.sendAsync({type:"LDT",data:z});t.dem=j,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(x){if(delete t.abortController,t.aborted)t.state="unloaded";else if(x)throw t.state="errored",x}}))}readImageNow(t){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.a0()){const s=t.width+2,f=t.height+2;try{return new h.R({width:s,height:f},yield h.a1(t,-1,-1,s,f))}catch{}}return we.getImageData(t,1)}))}_getNeighboringTiles(t){const s=t.canonical,f=Math.pow(2,s.z),x=(s.x-1+f)%f,S=s.x===0?t.wrap-1:t.wrap,M=(s.x+1+f)%f,z=s.x+1===f?t.wrap+1:t.wrap,j={};return j[new h.a2(t.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,M,s.y).key]={backfilled:!1},s.y>0&&(j[new h.a2(t.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,M,s.y-1).key]={backfilled:!1}),s.y+1<f&&(j[new h.a2(t.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},j[new h.a2(t.overscaledZ,z,s.z,M,s.y+1).key]={backfilled:!1}),j}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Li(A){return A.type==="GeometryCollection"?A.geometries.map((t=>t.coordinates)).flat(1/0):A.coordinates.flat(1/0)}function tr(A){const t=new Yn;let s;switch(A.type){case"FeatureCollection":s=A.features.map((f=>Li(f.geometry))).flat(1/0);break;case"Feature":s=Li(A.geometry);break;default:s=Li(A)}if(s.length==0)return t;for(let f=0;f<s.length-1;f+=2)t.extend([s[f],s[f+1]]);return t}class Di extends h.E{constructor(t,s,f,x){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=f.getActor(),this.setEventedParent(x),this._data=typeof s.data=="string"?{url:s.data}:{geojson:s.data},this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:h.a5,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.a5,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(h.a5/this.tileSize)}_getClusterMaxZoom(t){const s=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${s}"`),s}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,s){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const f=this._updateWorkerData();return s?f:this}updateData(t,s){this._pendingWorkerUpdate.diff=h.a6(this._pendingWorkerUpdate.diff,t);const f=this._updateWorkerData();return s?f:this}getData(){return h._(this,void 0,void 0,(function*(){const t=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return h._(this,void 0,void 0,(function*(){return tr(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:f}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void h.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:s}=this._pendingWorkerUpdate,f=h.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(f.request=this.map._requestManager.transformRequest(we.resolveURL(t),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=t,this._pendingWorkerUpdate.data=void 0):s&&(f.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const x=yield this.actor.sendAsync({type:"LD",data:f});if(this._isUpdatingWorker=!1,this._removed||x.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));x.data&&(this._data={geojson:x.data});const S=this._applyDiffToSource(s),M=this._getShouldReloadTileOptions(S);let z=null;x.resourceTiming&&x.resourceTiming[this.id]&&(z=x.resourceTiming[this.id].slice(0));const j={dataType:"source"};this._collectResourceTiming&&z&&z.length>0&&h.e(j,{resourceTiming:z}),this.fire(new h.l("data",Object.assign(Object.assign({},j),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},j),{sourceDataType:"content",shouldReloadTileOptions:M})))}catch(x){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(x))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const s=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const x=h.a7(this._data.geojson,s);if(!x)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:x}}if(!this._data.updateable)return;const f=h.a8(this._data.updateable,t,s);return t.removeAll||this._options.cluster?void 0:f}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((s=>tr(s)))}}shouldReloadTile(t,{affectedBounds:s}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:f,extent:x}=this.workerOptions.geojsonVtOptions,S=(function({x:M,y:z,z:j},Z=0){const W=h.a3((M-Z)/Math.pow(2,j)),ee=h.a4((z+1+Z)/Math.pow(2,j)),J=h.a3((M+1+Z)/Math.pow(2,j)),se=h.a4((z-Z)/Math.pow(2,j));return new Yn([W,ee],[J,se])})(t.tileID.canonical,f/x);for(const M of s)if(S.intersects(M))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return h._(this,void 0,void 0,(function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const x=yield this.actor.sendAsync({type:s,data:f},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(x,this.map.painter,s==="RT")}))}abortTile(t){return h._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return h._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class yr extends h.E{constructor(t,s,f,x){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=f,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=s}load(t){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield rt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,h.Z(s)||this.fire(new h.k(s))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(h.a9.fromLngLat);var f;return this.tileID=(function(x){const S=h.aa.fromPoints(x),M=S.width(),z=S.height(),j=Math.max(M,z),Z=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),W=Math.pow(2,Z);return new h.ac(Z,Math.floor((S.minX+S.maxX)/2*W),Math.floor((S.minY+S.maxY)/2*W))})(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map((x=>this.tileID.getTilePoint(x)._round())),this.flippedWindingOrder=((f=this.tileCoords)[1].x-f[0].x)*(f[2].y-f[0].y)-(f[1].y-f[0].y)*(f[2].x-f[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture||(this.texture=new h.T(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:s,minY:f,maxX:x,maxY:S}=h.aa.fromPoints(t),M={};for(let z=0;z<=h.ab;z++){const j=Math.pow(2,z),Z=Math.floor(s*j),W=Math.floor(f*j),ee=Math.floor(x*j),J=Math.floor(S*j);M[z]={minTileX:Z,minTileY:W,maxTileX:ee,maxTileY:J}}return M}}class yt extends yr{constructor(t,s,f,x){super(t,s,f,x),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.ad(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.k(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new h.k(new h.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,f=!0)}f&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class oe extends yr{constructor(t,s,f,x){super(t,s,f,x),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((M=>typeof M!="number"))))||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.k(new h.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,f=s.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new h.T(s,this.canvas,f.RGBA,{premultiply:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let x=!1;for(const S in this.tiles){const M=this.tiles[S];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,x=!0)}x&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const le={},ge=A=>{switch(A){case"geojson":return Di;case"image":return yr;case"raster":return Ei;case"raster-dem":return on;case"vector":return Rn;case"video":return yt;case"canvas":return oe}return le[A]},Ue="RTLPluginLoaded";class Ye extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Nn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,(function*(s,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=we.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(Ue))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let At=null;function it(){return At||(At=new Ye),At}var de,qe;(function(A){A[A.Base=0]="Base",A[A.Parent=1]="Parent"})(de||(de={})),(function(A){A[A.Departing=0]="Departing",A[A.Incoming=1]="Incoming"})(qe||(qe={}));class xt{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=h.af(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:s,fadingParentID:f,fadeEndTime:x}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=s,this.fadingParentID=f,this.fadeEndTime=x}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=pe(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(x,S){const M={};if(!S)return M;for(const z of x){const j=z.layerIds.map((Z=>S.getLayer(Z))).filter(Boolean);if(j.length!==0){z.layers=j,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map((Z=>j.filter((W=>W.id===Z))[0])));for(const Z of j)M[Z.id]=z}}return M})(t.buckets,s?.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof h.ah){if(this.hasSymbolBuckets=!0,!f)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof h.ah&&S.hasRTLText){this.hasRTLText=!0,it().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(x).queryRadius(S))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new h.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const x=this.buckets[f];x.uploadPending()&&x.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,f,x,S,M,z,j,Z,W,ee){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:S,scale:M,tileSize:this.tileSize,pixelPosMatrix:W,transform:j,params:z,queryPadding:this.queryPadding*Z,getElevation:ee},t,s,f):{}}querySourceFeatures(t,s){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const x=f.loadVTLayers(),S=s&&s.sourceLayer?s.sourceLayer:"",M=x[h.ai]||x[S];if(!M)return;const z=h.aj(s?.filter,s?.globalState),{z:j,x:Z,y:W}=this.tileID.canonical,ee={z:j,x:Z,y:W};for(let J=0;J<M.length;J++){const se=M.feature(J);if(z.needGeometry){const Me=h.ak(se,!0);if(!z.filter(new h.H(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!z.filter(new h.H(this.tileID.overscaledZ),se))continue;const fe=f.getId(se,S),Ce=new h.al(se,j,Z,W,fe);Ce.tile=ee,t.push(Ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const f=h.am(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let x=!1;if(this.expirationTime>f)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{const S=this.expirationTime-s;S?this.expirationTime=f+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!s.style.hasLayer(x))continue;const S=this.buckets[x],M=S.layers[0].sourceLayer||h.ai,z=f[M],j=t[M];if(!z||!j||Object.keys(j).length===0)continue;S.update(j,z,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const Z=s&&s.style&&s.style.getLayer(x);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(S)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pe()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=pe()+t}setDependencies(t,s){const f={};for(const x of s)f[x]=!0;this.dependencies[t]=f}hasDependency(t,s){for(const f of t){const x=this.dependencies[f];if(x){for(const S of s)if(x[S])return!0}}return!1}}class Fe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,f){const x=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][x]=this.stateChanges[t][x]||{},h.e(this.stateChanges[t][x],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const S in this.state[t])S!==x&&(this.deletedStates[t][S]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][x]===null){this.deletedStates[t][x]={};for(const S in this.state[t][x])f[S]||(this.deletedStates[t][x][S]=null)}else for(const S in f)this.deletedStates[t]&&this.deletedStates[t][x]&&this.deletedStates[t][x][S]===null&&delete this.deletedStates[t][x][S]}removeFeatureState(t,s,f){if(this.deletedStates[t]===null)return;const x=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&s!==void 0)this.deletedStates[t][x]!==null&&(this.deletedStates[t][x]=this.deletedStates[t][x]||{},this.deletedStates[t][x][f]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][x])for(f in this.deletedStates[t][x]={},this.stateChanges[t][x])this.deletedStates[t][x][f]=null;else this.deletedStates[t][x]=null;else this.deletedStates[t]=null}getState(t,s){const f=String(s),x=h.e({},(this.state[t]||{})[f],(this.stateChanges[t]||{})[f]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const S=this.deletedStates[t][s];if(S===null)return{};for(const M in S)delete x[M]}return x}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const f={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const M in this.stateChanges[x])this.state[x][M]||(this.state[x][M]={}),h.e(this.state[x][M],this.stateChanges[x][M]),S[M]=this.state[x][M];f[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const M in this.state[x])S[M]={},this.state[x][M]={};else for(const M in this.deletedStates[x]){if(this.deletedStates[x][M]===null)this.state[x][M]={};else for(const z of Object.keys(this.deletedStates[x][M]))delete this.state[x][M][z];S[M]=this.state[x][M]}f[x]=f[x]||{},h.e(f[x],S)}this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0&&t.setFeatureState(f,s)}}const St=89.25;function Lt(A,t){const s=h.an(t.lat,-h.ao,h.ao);return new h.P(h.Y(t.lng)*A,h.X(s)*A)}function bn(A,t){return new h.a9(t.x/A,t.y/A).toLngLat()}function yn(A){return A.cameraToCenterDistance*Math.min(.85*Math.tan(h.ap(90-A.pitch)),Math.tan(h.ap(St-A.pitch)))}function $n(A,t){const s=A.canonical,f=t/h.aq(s.z),x=s.x+Math.pow(2,s.z)*A.wrap,S=h.ar(new Float64Array(16));return h.O(S,S,[x*f,s.y*f,0]),h.Q(S,S,[f/h.a5,f/h.a5,1]),S}function dt(A,t,s,f,x){const S=h.a9.fromLngLat(A,t),M=x*h.as(1,A.lat),{x:z,y:j,z:Z}=ai(s,f);return new h.a9(S.x+M*-z,S.y+M*-j,S.z+M*-Z)}function ai(A,t){const s=h.ap(A),f=h.ap(t),x=Math.cos(-s),S=Math.sin(s);return{x:S*Math.sin(f),y:-S*Math.cos(f),z:x}}function Fn(A,t,s){const f=t.intersectsFrustum(A);if(!s||f===0)return f;const x=t.intersectsPlane(s);return x===0?0:f===2&&x===2?2:1}function Jn(A,t,s){let f=0;const x=(s-t)/10;for(let S=0;S<10;S++)f+=x*Math.pow(Math.cos(t+(S+.5)/10*(s-t)),A);return f}function pi(A,t){return function(s,f,x,S,M){const z=2*((A-1)/h.at(Math.cos(h.ap(St-M))/Math.cos(h.ap(St)))-1),j=Math.acos(x/S),Z=2*Jn(z-1,0,h.ap(M/2)),W=Math.min(h.ap(St),j+h.ap(M/2)),ee=Jn(z-1,Math.min(W,j-h.ap(M/2)),W),J=Math.atan(f/x),se=Math.hypot(f,x);let fe=s;return fe+=h.at(S/se/Math.max(.5,Math.cos(h.ap(M/2)))),fe+=z*h.at(Math.cos(J))/2,fe-=h.at(Math.max(1,ee/Z/t))/2,fe}}const ur=pi(9.314,3);function Ti(A,t){const s=(t.roundZoom?Math.round:Math.floor)(A.zoom+h.at(A.tileSize/t.tileSize));return Math.max(0,s)}function jn(A,t){const s=A.getCameraFrustum(),f=A.getClippingPlane(),x=A.screenPointToMercatorCoordinate(A.getCameraPoint()),S=h.a9.fromLngLat(A.center,A.elevation);x.z=S.z+Math.cos(A.pitchInRadians)*A.cameraToCenterDistance/A.worldSize;const M=A.getCoveringTilesDetailsProvider(),z=M.allowVariableZoom(A,t),j=Ti(A,t),Z=t.minzoom||0,W=t.maxzoom!==void 0?t.maxzoom:A.maxZoom,ee=Math.min(Math.max(0,j),W),J=Math.pow(2,ee),se=[J*x.x,J*x.y,0],fe=[J*S.x,J*S.y,0],Ce=Math.hypot(S.x-x.x,S.y-x.y),Me=Math.abs(S.z-x.z),Ie=Math.hypot(Ce,Me),Le=We=>({zoom:0,x:0,y:0,wrap:We,fullyVisible:!1}),$e=[],ze=[];if(A.renderWorldCopies&&M.allowWorldCopies())for(let We=1;We<=3;We++)$e.push(Le(-We)),$e.push(Le(We));for($e.push(Le(0));$e.length>0;){const We=$e.pop(),st=We.x,Ve=We.y;let pt=We.fullyVisible;const Ft={x:st,y:Ve,z:We.zoom},Nt=M.getTileBoundingVolume(Ft,We.wrap,A.elevation,t);if(!pt){const _n=Fn(s,Nt,f);if(_n===0)continue;pt=_n===2}const Ot=M.distanceToTile2d(x.x,x.y,Ft,Nt);let zt=j;z&&(zt=(t.calculateTileZoom||ur)(A.zoom+h.at(A.tileSize/t.tileSize),Ot,Me,Ie,A.fov)),zt=(t.roundZoom?Math.round:Math.floor)(zt),zt=Math.max(0,zt);const xn=Math.min(zt,W);if(We.wrap=M.getWrap(S,Ft,We.wrap),We.zoom>=xn){if(We.zoom<Z)continue;const _n=ee-We.zoom,cn=se[0]-.5-(st<<_n),Tn=se[1]-.5-(Ve<<_n),Mi=t.reparseOverscaled?Math.max(We.zoom,zt):We.zoom;ze.push({tileID:new h.a2(We.zoom===W?Mi:We.zoom,We.wrap,We.zoom,st,Ve),distanceSq:h.au([fe[0]-.5-st,fe[1]-.5-Ve]),tileDistanceToCamera:Math.sqrt(cn*cn+Tn*Tn)})}else for(let _n=0;_n<4;_n++)$e.push({zoom:We.zoom+1,x:(st<<1)+_n%2,y:(Ve<<1)+(_n>>1),wrap:We.wrap,fullyVisible:pt})}return ze.sort(((We,st)=>We.distanceSq-st.distanceSq)).map((We=>We.tileID))}const Ni=h.aa.fromPoints([new h.P(0,0),new h.P(h.a5,h.a5)]);function Ri(A){return A==="raster"||A==="image"||A==="video"}function ji(A,t,s,f,x,S,M){if(!t.hasData())return!1;const{tileID:z,fadingRole:j,fadingDirection:Z,fadingParentID:W}=t;if(j===de.Base&&Z===qe.Incoming&&W)return s[W.key]=W,!0;const ee=Math.max(z.overscaledZ-x,S);for(let J=z.overscaledZ-1;J>=ee;J--){const se=z.scaledTo(J),fe=A.getLoadedTile(se);if(fe)return t.setCrossFadeLogic({fadingRole:de.Base,fadingDirection:qe.Incoming,fadingParentID:fe.tileID,fadeEndTime:f+M}),fe.setCrossFadeLogic({fadingRole:de.Parent,fadingDirection:qe.Departing,fadeEndTime:f+M}),s[se.key]=se,!0}return!1}function Nr(A,t,s,f,x,S){if(!t.hasData())return!1;const M=t.tileID.children(x);let z=Jt(A,t,M,s,f,x,S);if(z)return!0;for(const j of M)Jt(A,t,j.children(x),s,f,x,S)&&(z=!0);return z}function Jt(A,t,s,f,x,S,M){if(s[0].overscaledZ>=S)return!1;let z=!1;for(const j of s){const Z=A.getLoadedTile(j);if(!Z)continue;const{fadingRole:W,fadingDirection:ee,fadingParentID:J}=Z;W===de.Base&&ee===qe.Departing&&J||(Z.setCrossFadeLogic({fadingRole:de.Base,fadingDirection:qe.Departing,fadingParentID:t.tileID,fadeEndTime:x+M}),t.setCrossFadeLogic({fadingRole:de.Parent,fadingDirection:qe.Incoming,fadeEndTime:x+M})),f[j.key]=j,z=!0}return z}function gi(A,t,s,f){const x=A.tileID;return!!A.selfFading||!A.hasData()&&!!t.has(x)&&(A.setSelfFadeLogic(s+f),!0)}function Sn(A,t){var s;A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0;let f=t.tileID.canonical.x-A.tileID.canonical.x;const x=t.tileID.canonical.y-A.tileID.canonical.y,S=Math.pow(2,A.tileID.canonical.z),M=t.tileID.key;f===0&&x===0||Math.abs(x)>1||(Math.abs(f)>1&&(Math.abs(f+S)===1?f+=S:Math.abs(f-S)===1&&(f-=S)),t.dem&&A.dem&&(A.dem.backfillBorder(t.dem,f,x),!((s=A.neighboringTiles)===null||s===void 0)&&s[M]&&(A.neighboringTiles[M].backfilled=!0)))}class lr{constructor(){this._tiles={}}handleWrapJump(t){const s={};for(const f in this._tiles){const x=this._tiles[f];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+t),s[x.tileID.key]=x}this._tiles=s}setFeatureState(t,s){for(const f in this._tiles)this._tiles[f].setFeatureState(t,s)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((s=>s.tileID)).sort(h.aw).map((s=>s.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,s){this._tiles[t]=s}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const s=this.getTileById(t.key);return s?.hasData()?s:null}isIdRenderable(t,s=!1){var f;return(f=this.getTileById(t))===null||f===void 0?void 0:f.isRenderable(s)}getRenderableIds(t=0,s){const f=[];for(const x of this.getAllIds())this.isIdRenderable(x,s)&&f.push(this.getTileById(x));return s?f.sort(((x,S)=>{const M=x.tileID,z=S.tileID,j=new h.P(M.canonical.x,M.canonical.y)._rotate(-t),Z=new h.P(z.canonical.x,z.canonical.y)._rotate(-t);return M.overscaledZ-z.overscaledZ||Z.y-j.y||Z.x-j.x})).map((x=>x.tileID.key)):f.map((x=>x.tileID)).sort(h.aw).map((x=>x.key))}}class Ke extends h.E{constructor(t,s,f){super(),this.id=t,this.dispatcher=f,this.on("data",(x=>this._dataHandler(x))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((x,S,M,z)=>{const j=new(ge(S.type))(x,S,M,z);if(j.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${j.id}`);return j})(t,s,f,this),this._inViewTiles=new lr,this._outOfViewCache=new h.ax(0,(x=>this._unloadTile(x))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Fe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const s of this._inViewTiles.getAllTiles())s.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new lr}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,f){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,f)}catch(x){t.state="errored",x.status!==404?this._source.fire(new h.k(x,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const s of this._inViewTiles.getAllTiles())s.upload(t),s.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var s;return this._inViewTiles.getRenderableIds((s=this.transform)===null||s===void 0?void 0:s.bearingInRadians,t)}hasRenderableParent(t){const s=t.overscaledZ-1;if(s>=this._source.minzoom){const f=this.getLoadedTile(t.scaledTo(s));if(f)return this._inViewTiles.isIdRenderable(f.tileID.key)}return!1}reload(t,s=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const f of this._inViewTiles.getAllIds()){const x=this._inViewTiles.getTileById(f);s&&!this._source.shouldReloadTile(x,s)||(t?this._reloadTile(f,"expired"):x.state!=="errored"&&this._reloadTile(f,"reloading"))}}}_reloadTile(t,s){return h._(this,void 0,void 0,(function*(){const f=this._inViewTiles.getTileById(t);f&&(f.state!=="loading"&&(f.state=s),yield this._loadTile(f,t,s))}))}_tileLoaded(t,s,f){t.timeAdded=pe(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&(function(x,S){var M,z;const j=S.getRenderableIds();for(const Z of j){if(!x.neighboringTiles||!x.neighboringTiles[Z])continue;const W=S.getTileById(Z);x.neighboringTiles[Z].backfilled||Sn(x,W),!((z=(M=W.neighboringTiles)===null||M===void 0?void 0:M[x.tileID.key])===null||z===void 0)&&z.backfilled||Sn(W,x)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,s){const f=this._getLoadedDescendents(s),x=new Set;for(const S of s){const M=f[S.key];if(!M?.length){x.add(S);continue}const z=S.overscaledZ+Ke.maxOverzooming,j=M.filter((ee=>ee.tileID.overscaledZ<=z));if(!j.length){x.add(S);continue}const Z=Math.min(...j.map((ee=>ee.tileID.overscaledZ))),W=j.filter((ee=>ee.tileID.overscaledZ===Z)).map((ee=>ee.tileID));for(const ee of W)t[ee.key]=ee;this._areDescendentsComplete(W,Z,S.overscaledZ)||x.add(S)}return x}_getLoadedDescendents(t){var s;const f={};for(const x of this._inViewTiles.getAllTiles().filter((S=>S.hasData())))for(const S of t)x.tileID.isChildOf(S)&&(f[s=S.key]||(f[s]=[])).push(x);return f}_areDescendentsComplete(t,s,f){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===s:Math.pow(4,s-f)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,f=Math.ceil(t.height/this._source.tileSize)+1,x=Math.floor(s*f*(this._maxTileCacheZoomLevels===null?h.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._outOfViewCache.setMaxSize(S)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,s&&(this._inViewTiles.handleWrapJump(s),this._resetTileReloadTimers())}update(t,s){if(!this._sourceLoaded||this._paused)return;let f;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((j=>new h.a2(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y))):(f=jn(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(f=f.filter((j=>this._source.hasTile(j))))):f=[],this.usedForTerrain&&(f=this._addTerrainIdealTiles(f));const x=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=Ti(t,this._source),M=this._updateRetainedTiles(f,S),z=Ri(this._source.type);z&&this._rasterFadeDuration>0&&!s&&(function(j,Z,W,ee,J,se,fe){const Ce=pe(),Me=h.av(Z);for(const Ie of Z){const Le=j.getTileById(Ie.key);Le.fadingDirection!==qe.Departing&&Le.fadeOpacity!==0||Le.resetFadeLogic(),ji(j,Le,W,Ce,ee,J,fe)||Nr(j,Le,W,Ce,se,fe)||gi(Le,Me,Ce,fe)||Le.resetFadeLogic()}})(this._inViewTiles,f,M,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),z?this._cleanUpRasterTiles(M):this._cleanUpVectorTiles(M)}_cleanUpRasterTiles(t){for(const s of this._inViewTiles.getAllIds())t[s]||this._removeTile(s)}_cleanUpVectorTiles(t){for(const s of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(s);t[s]?f.clearSymbolFadeHold():f.hasSymbolBuckets?f.holdingForSymbolFade()?f.symbolFadeFinished()&&this._removeTile(s):f.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(s)}}_addTerrainIdealTiles(t){const s=[];for(const f of t)if(f.canonical.z>this._source.minzoom){const x=f.scaledTo(f.canonical.z-1);s.push(x);const S=f.scaledTo(Math.max(this._source.minzoom,Math.min(f.canonical.z,5)));s.push(S)}return t.concat(s)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var f;const x=new Set;for(const Z of t)this._addTile(Z).hasData()||x.add(Z);const S=t.reduce(((Z,W)=>(Z[W.key]=W,Z)),{}),M=this._retainLoadedChildren(S,x),z={},j=Math.max(s-Ke.maxUnderzooming,this._source.minzoom);for(const Z of M){let W=this._inViewTiles.getTileById(Z.key),ee=W?.wasRequested();for(let J=Z.overscaledZ-1;J>=j;--J){const se=Z.scaledTo(J);if(z[se.key])break;if(z[se.key]=!0,W=this.getTile(se),!W&&ee&&(W=this._addTile(se)),W){const fe=W.hasData();if((fe||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||ee)&&(S[se.key]=se),ee=W.wasRequested(),fe)break}}}return S}_addTile(t){let s=this._inViewTiles.getTileById(t.key);if(s)return s;s=this._outOfViewCache.getAndRemove(t),s&&(s.resetFadeLogic(),this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null));const f=s;return s||(s=new xt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._inViewTiles.setTile(t.key,s),f||this._source.fire(new h.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){this._clearTileReloadTimer(t);const f=s.getExpiryTimeout();f&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),f))}_clearTileReloadTimer(t){const s=this._timers[t];s&&(clearTimeout(s),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const s=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,s)}}refreshTiles(t){for(const s of this._inViewTiles.getAllIds()){const f=this._inViewTiles.getTileById(s);(this._inViewTiles.isIdRenderable(s)||f.state=="errored")&&t.some((x=>x.equals(f.tileID.canonical)))&&this._reloadTile(s,"expired")}}_removeTile(t){const s=this._inViewTiles.getTileById(t);s&&(s.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._outOfViewCache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,s,f){const x=[],S=this.transform;if(!S)return x;const M=S.getCoveringTilesDetailsProvider().allowWorldCopies(),z=f?S.getCameraQueryGeometry(t):t,j=se=>S.screenPointToMercatorCoordinate(se,this.terrain),Z=this.transformBbox(t,j,!M),W=this.transformBbox(z,j,!M),ee=this.getIds(),J=h.aa.fromPoints(W);for(let se=0;se<ee.length;se++){const fe=this._inViewTiles.getTileById(ee[se]);if(fe.holdingForSymbolFade())continue;const Ce=M?[fe.tileID]:[fe.tileID.unwrapTo(-1),fe.tileID.unwrapTo(0)],Me=Math.pow(2,S.zoom-fe.tileID.overscaledZ),Ie=s*fe.queryPadding*h.a5/fe.tileSize/Me;for(const Le of Ce){const $e=J.map((ze=>Le.getTilePoint(new h.a9(ze.x,ze.y))));if($e.expandBy(Ie),$e.intersects(Ni)){const ze=Z.map((st=>Le.getTilePoint(st))),We=W.map((st=>Le.getTilePoint(st)));x.push({tile:fe,tileID:M?Le:Le.unwrapTo(0),queryGeometry:ze,cameraQueryGeometry:We,scale:Me})}}}return x}transformBbox(t,s,f){let x=t.map(s);if(f){const S=h.aa.fromPoints(t);S.shrinkBy(.001*Math.min(S.width(),S.height()));const M=S.map(s);h.aa.fromPoints(x).covers(M)||(x=x.map((z=>z.x>.5?new h.a9(z.x-1,z.y,z.z):z)))}return x}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map((f=>this._inViewTiles.getTileById(f).tileID));return this.transform&&this.transform.populateCache(s),s}hasTransition(){return!!this._source.hasTransition()||!(!Ri(this._source.type)||!(function(t,s){if(s<=0)return!1;const f=pe();for(const x of t.getAllTiles())if(x.fadeEndTime>=f)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,s,f){this._state.updateState(t=t||h.ai,s,f)}removeFeatureState(t,s,f){this._state.removeFeatureState(t=t||h.ai,s,f)}getFeatureState(t,s){return this._state.getState(t=t||h.ai,s)}setDependencies(t,s,f){const x=this._inViewTiles.getTileById(t);x&&x.setDependencies(s,f)}reloadTilesForDependencies(t,s){for(const f of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(f).hasDependency(t,s)&&this._reloadTile(f,"reloading");this._outOfViewCache.filter((f=>!f.hasDependency(t,s)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Ke.maxUnderzooming=10,Ke.maxOverzooming=3;class je{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.an(t,0,1);let s=1,f=this._distances[s];const x=t*this.paddedLength+this.padding;for(;f<x&&s<this._distances.length;)f=this._distances[++s];const S=s-1,M=this._distances[S],z=f-M,j=z>0?(x-M)/z:0;return this.points[S].mult(1-j).add(this.points[s].mult(j))}}function Mt(A,t){let s=!0;return A==="always"||A!=="never"&&t!=="never"||(s=!1),s}class Yt{constructor(t,s,f){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(s/f);for(let M=0;M<this.xCellCount*this.yCellCount;M++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,f,x,S){this._forEachCell(s,f,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(t,s,f,x){this._forEachCell(s-x,f-x,s+x,f+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(f),this.circles.push(x)}_insertBoxCell(t,s,f,x,S,M){this.boxCells[S].push(M)}_insertCircleCell(t,s,f,x,S,M){this.circleCells[S].push(M)}_query(t,s,f,x,S,M,z){if(f<0||t>this.width||x<0||s>this.height)return[];const j=[];if(t<=0&&s<=0&&this.width<=f&&this.height<=x){if(S)return[{key:null,x1:t,y1:s,x2:f,y2:x}];for(let Z=0;Z<this.boxKeys.length;Z++)j.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const W=this.circles[3*Z],ee=this.circles[3*Z+1],J=this.circles[3*Z+2];j.push({key:this.circleKeys[Z],x1:W-J,y1:ee-J,x2:W+J,y2:ee+J})}}else this._forEachCell(t,s,f,x,this._queryCell,j,{hitTest:S,overlapMode:M,seenUids:{box:{},circle:{}}},z);return j}query(t,s,f,x){return this._query(t,s,f,x,!1,null)}hitTest(t,s,f,x,S,M){return this._query(t,s,f,x,!0,S,M).length>0}hitTestCircle(t,s,f,x,S){const M=t-f,z=t+f,j=s-f,Z=s+f;if(z<0||M>this.width||Z<0||j>this.height)return!1;const W=[];return this._forEachCell(M,j,z,Z,this._queryCellCircle,W,{hitTest:!0,overlapMode:x,circle:{x:t,y:s,radius:f},seenUids:{box:{},circle:{}}},S),W.length>0}_queryCell(t,s,f,x,S,M,z,j){const{seenUids:Z,hitTest:W,overlapMode:ee}=z,J=this.boxCells[S];if(J!==null){const fe=this.bboxes;for(const Ce of J)if(!Z.box[Ce]){Z.box[Ce]=!0;const Me=4*Ce,Ie=this.boxKeys[Ce];if(t<=fe[Me+2]&&s<=fe[Me+3]&&f>=fe[Me+0]&&x>=fe[Me+1]&&(!j||j(Ie))&&(!W||!Mt(ee,Ie.overlapMode))&&(M.push({key:Ie,x1:fe[Me],y1:fe[Me+1],x2:fe[Me+2],y2:fe[Me+3]}),W))return!0}}const se=this.circleCells[S];if(se!==null){const fe=this.circles;for(const Ce of se)if(!Z.circle[Ce]){Z.circle[Ce]=!0;const Me=3*Ce,Ie=this.circleKeys[Ce];if(this._circleAndRectCollide(fe[Me],fe[Me+1],fe[Me+2],t,s,f,x)&&(!j||j(Ie))&&(!W||!Mt(ee,Ie.overlapMode))){const Le=fe[Me],$e=fe[Me+1],ze=fe[Me+2];if(M.push({key:Ie,x1:Le-ze,y1:$e-ze,x2:Le+ze,y2:$e+ze}),W)return!0}}}return!1}_queryCellCircle(t,s,f,x,S,M,z,j){const{circle:Z,seenUids:W,overlapMode:ee}=z,J=this.boxCells[S];if(J!==null){const fe=this.bboxes;for(const Ce of J)if(!W.box[Ce]){W.box[Ce]=!0;const Me=4*Ce,Ie=this.boxKeys[Ce];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,fe[Me+0],fe[Me+1],fe[Me+2],fe[Me+3])&&(!j||j(Ie))&&!Mt(ee,Ie.overlapMode))return M.push(!0),!0}}const se=this.circleCells[S];if(se!==null){const fe=this.circles;for(const Ce of se)if(!W.circle[Ce]){W.circle[Ce]=!0;const Me=3*Ce,Ie=this.circleKeys[Ce];if(this._circlesCollide(fe[Me],fe[Me+1],fe[Me+2],Z.x,Z.y,Z.radius)&&(!j||j(Ie))&&!Mt(ee,Ie.overlapMode))return M.push(!0),!0}}}_forEachCell(t,s,f,x,S,M,z,j){const Z=this._convertToXCellCoord(t),W=this._convertToYCellCoord(s),ee=this._convertToXCellCoord(f),J=this._convertToYCellCoord(x);for(let se=Z;se<=ee;se++)for(let fe=W;fe<=J;fe++)if(S.call(this,t,s,f,x,this.xCellCount*fe+se,M,z,j))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,f,x,S,M){const z=x-t,j=S-s,Z=f+M;return Z*Z>z*z+j*j}_circleAndRectCollide(t,s,f,x,S,M,z){const j=(M-x)/2,Z=Math.abs(t-(x+j));if(Z>j+f)return!1;const W=(z-S)/2,ee=Math.abs(s-(S+W));if(ee>W+f)return!1;if(Z<=j||ee<=W)return!0;const J=Z-j,se=ee-W;return J*J+se*se<=f*f}}function tn(A,t,s){const f=h.N();if(!A){const{vecSouth:ee,vecEast:J}=Hn(t),se=H();se[0]=J[0],se[1]=J[1],se[2]=ee[0],se[3]=ee[1],x=se,(W=(M=(S=se)[0])*(Z=S[3])-(j=S[2])*(z=S[1]))&&(x[0]=Z*(W=1/W),x[1]=-z*W,x[2]=-j*W,x[3]=M*W),f[0]=se[0],f[1]=se[1],f[4]=se[2],f[5]=se[3]}var x,S,M,z,j,Z,W;return h.Q(f,f,[1/s,1/s,1]),f}function Un(A,t,s,f){if(A){const x=h.N();if(!t){const{vecSouth:S,vecEast:M}=Hn(s);x[0]=M[0],x[1]=M[1],x[4]=S[0],x[5]=S[1]}return h.Q(x,x,[f,f,1]),x}return s.pixelsToClipSpaceMatrix}function Hn(A){const t=Math.cos(A.rollInRadians),s=Math.sin(A.rollInRadians),f=Math.cos(A.pitchInRadians),x=Math.cos(A.bearingInRadians),S=Math.sin(A.bearingInRadians),M=h.aC();M[0]=-x*f*s-S*t,M[1]=-S*f*s+x*t;const z=h.aD(M);z<1e-9?h.aE(M):h.aF(M,M,1/z);const j=h.aC();j[0]=x*f*t-S*s,j[1]=S*f*t+x*s;const Z=h.aD(j);return Z<1e-9?h.aE(j):h.aF(j,j,1/Z),{vecEast:j,vecSouth:M}}function vn(A,t,s,f){let x;f?(x=[A,t,f(A,t),1],h.aH(x,x,s)):(x=[A,t,0,1],Tr(x,x,s));const S=x[3];return{point:new h.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function ri(A,t){return .5+A/t*.5}function ni(A,t){return A.x>=-t[0]&&A.x<=t[0]&&A.y>=-t[1]&&A.y<=t[1]}function Xn(A,t,s,f,x,S,M,z,j,Z,W,ee,J){const se=s?A.textSizeData:A.iconSizeData,fe=h.ay(se,t.transform.zoom),Ce=[256/t.width*2+1,256/t.height*2+1],Me=s?A.text.dynamicLayoutVertexArray:A.icon.dynamicLayoutVertexArray;Me.clear();const Ie=A.lineVertexArray,Le=s?A.text.placedSymbolArray:A.icon.placedSymbolArray,$e=t.transform.width/t.transform.height;let ze=!1;for(let We=0;We<Le.length;We++){const st=Le.get(We);if(st.hidden||st.writingMode===h.az.vertical&&!ze){Hi(st.numGlyphs,Me);continue}ze=!1;const Ve=new h.P(st.anchorX,st.anchorY),pt={getElevation:J,pitchedLabelPlaneMatrix:f,lineVertexArray:Ie,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Ve,unwrappedTileID:j,width:Z,height:W,translation:ee},Ft=Bi(st.anchorX,st.anchorY,pt);if(!ni(Ft.point,Ce)){Hi(st.numGlyphs,Me);continue}const Nt=ri(t.transform.cameraToCenterDistance,Ft.signedDistanceFromCamera),Ot=h.aA(se,fe,st),zt=S?Ot*t.transform.getPitchedTextCorrection(st.anchorX,st.anchorY,j)/Nt:Ot*Nt,xn=Dn({projectionContext:pt,pitchedLabelPlaneMatrixInverse:x,symbol:st,fontSize:zt,flip:!1,keepUpright:M,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:Me,aspectRatio:$e,rotateToLine:z});ze=xn.useVertical,(xn.notEnoughRoom||ze||xn.needsFlipping&&Dn({projectionContext:pt,pitchedLabelPlaneMatrixInverse:x,symbol:st,fontSize:zt,flip:!0,keepUpright:M,glyphOffsetArray:A.glyphOffsetArray,dynamicLayoutVertexArray:Me,aspectRatio:$e,rotateToLine:z}).notEnoughRoom)&&Hi(st.numGlyphs,Me)}s?A.text.dynamicLayoutVertexBuffer.updateData(Me):A.icon.dynamicLayoutVertexBuffer.updateData(Me)}function Zi(A,t,s,f,x,S,M,z){const j=S.glyphStartIndex+S.numGlyphs,Z=S.lineStartIndex,W=S.lineStartIndex+S.lineLength,ee=t.getoffsetX(S.glyphStartIndex),J=t.getoffsetX(j-1),se=mi(A*ee,s,f,x,S.segment,Z,W,z,M);if(!se)return null;const fe=mi(A*J,s,f,x,S.segment,Z,W,z,M);return fe?z.projectionCache.anyProjectionOccluded?null:{first:se,last:fe}:null}function Cn(A,t,s,f){return A===h.az.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*f?{useVertical:!0}:(A===h.az.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function Dn(A){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:s,symbol:f,fontSize:x,flip:S,keepUpright:M,glyphOffsetArray:z,dynamicLayoutVertexArray:j,aspectRatio:Z,rotateToLine:W}=A,ee=x/24,J=f.lineOffsetX*ee,se=f.lineOffsetY*ee;let fe;if(f.numGlyphs>1){const Ce=f.glyphStartIndex+f.numGlyphs,Me=f.lineStartIndex,Ie=f.lineStartIndex+f.lineLength,Le=Zi(ee,z,J,se,S,f,W,t);if(!Le)return{notEnoughRoom:!0};const $e=yi(Le.first.point.x,Le.first.point.y,t,s),ze=yi(Le.last.point.x,Le.last.point.y,t,s);if(M&&!S){const We=Cn(f.writingMode,$e,ze,Z);if(We)return We}fe=[Le.first];for(let We=f.glyphStartIndex+1;We<Ce-1;We++){const st=mi(ee*z.getoffsetX(We),J,se,S,f.segment,Me,Ie,t,W);if(!st)return{notEnoughRoom:!0};fe.push(st)}fe.push(Le.last)}else{if(M&&!S){const Me=ln(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Ie=f.lineStartIndex+f.segment+1,Le=new h.P(t.lineVertexArray.getx(Ie),t.lineVertexArray.gety(Ie)),$e=ln(Le.x,Le.y,t),ze=$e.signedDistanceFromCamera>0?$e.point:Zt(t.tileAnchorPoint,Le,Me,1,t),We=yi(Me.x,Me.y,t,s),st=yi(ze.x,ze.y,t,s),Ve=Cn(f.writingMode,We,st,Z);if(Ve)return Ve}const Ce=mi(ee*z.getoffsetX(f.glyphStartIndex),J,se,S,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,t,W);if(!Ce||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};fe=[Ce]}for(const Ce of fe)h.aG(j,Ce.point,Ce.angle);return{}}function Zt(A,t,s,f,x){const S=A.add(A.sub(t)._unit()),M=ln(S.x,S.y,x).point,z=s.sub(M);return s.add(z._mult(f/z.mag()))}function ki(A,t,s){const f=t.projectionCache;if(f.projections[A])return f.projections[A];const x=new h.P(t.lineVertexArray.getx(A),t.lineVertexArray.gety(A)),S=ln(x.x,x.y,t);if(S.signedDistanceFromCamera>0)return f.projections[A]=S.point,f.anyProjectionOccluded=f.anyProjectionOccluded||S.isOccluded,S.point;const M=A-s.direction;return Zt(s.distanceFromAnchor===0?t.tileAnchorPoint:new h.P(t.lineVertexArray.getx(M),t.lineVertexArray.gety(M)),x,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function ln(A,t,s){const f=A+s.translation[0],x=t+s.translation[1];let S;return s.pitchWithMap?(S=vn(f,x,s.pitchedLabelPlaneMatrix,s.getElevation),S.isOccluded=!1):(S=s.transform.projectTileCoordinates(f,x,s.unwrappedTileID,s.getElevation),S.point.x=(.5*S.point.x+.5)*s.width,S.point.y=(.5*-S.point.y+.5)*s.height),S}function yi(A,t,s,f){if(s.pitchWithMap){const x=[A,t,0,1];return h.aH(x,x,f),s.transform.projectTileCoordinates(x[0]/x[3],x[1]/x[3],s.unwrappedTileID,s.getElevation).point}return{x:A/s.width*2-1,y:1-t/s.height*2}}function Bi(A,t,s){return s.transform.projectTileCoordinates(A,t,s.unwrappedTileID,s.getElevation)}function _i(A,t,s){return A._unit()._perp()._mult(t*s)}function bi(A,t,s,f,x,S,M,z,j){if(z.projectionCache.offsets[A])return z.projectionCache.offsets[A];const Z=s.add(t);if(A+j.direction<f||A+j.direction>=x)return z.projectionCache.offsets[A]=Z,Z;const W=ki(A+j.direction,z,j),ee=_i(W.sub(s),M,j.direction),J=s.add(ee),se=W.add(ee);return z.projectionCache.offsets[A]=h.aI(S,Z,J,se)||Z,z.projectionCache.offsets[A]}function mi(A,t,s,f,x,S,M,z,j){const Z=f?A-t:A+t;let W=Z>0?1:-1,ee=0;f&&(W*=-1,ee=Math.PI),W<0&&(ee+=Math.PI);let J,se=W>0?S+x:S+x+1;z.projectionCache.cachedAnchorPoint?J=z.projectionCache.cachedAnchorPoint:(J=ln(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=J);let fe,Ce,Me=J,Ie=J,Le=0,$e=0;const ze=Math.abs(Z),We=[];let st;for(;Le+$e<=ze;){if(se+=W,se<S||se>=M)return null;Le+=$e,Ie=Me,Ce=fe;const Ft={absOffsetX:ze,direction:W,distanceFromAnchor:Le,previousVertex:Ie};if(Me=ki(se,z,Ft),s===0)We.push(Ie),st=Me.sub(Ie);else{let Nt;const Ot=Me.sub(Ie);Nt=Ot.mag()===0?_i(ki(se+W,z,Ft).sub(Me),s,W):_i(Ot,s,W),Ce||(Ce=Ie.add(Nt)),fe=bi(se,Nt,Me,S,M,Ce,s,z,Ft),We.push(Ce),st=fe.sub(Ce)}$e=st.mag()}const Ve=st._mult((ze-Le)/$e)._add(Ce||Ie),pt=ee+Math.atan2(Me.y-Ie.y,Me.x-Ie.x);return We.push(Ve),{point:Ve,angle:j?pt:0,path:We}}const li=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Hi(A,t){for(let s=0;s<A;s++){const f=t.length;t.resize(f+4),t.float32.set(li,3*f)}}function Tr(A,t,s){const f=t[0],x=t[1];return A[0]=s[0]*f+s[4]*x+s[12],A[1]=s[1]*f+s[5]*x+s[13],A[3]=s[3]*f+s[7]*x+s[15],A}const Qn=100;class es{constructor(t,s=new Yt(t.width+200,t.height+200,25),f=new Yt(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=f,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Qn,this.screenBottomBoundary=t.height+Qn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,f,x,S,M,z,j,Z,W,ee,J){const se=this.projectAndGetPerspectiveRatio(t.anchorPointX+j[0],t.anchorPointY+j[1],S,W,J),fe=f*se.perspectiveRatio;let Ce;if(M||z)Ce=this._projectCollisionBox(t,fe,x,S,M,z,j,se,W,ee,J);else{const st=se.x+(ee?ee.x*fe:0),Ve=se.y+(ee?ee.y*fe:0);Ce={allPointsOccluded:!1,box:[st+t.x1*fe,Ve+t.y1*fe,st+t.x2*fe,Ve+t.y2*fe]}}const[Me,Ie,Le,$e]=Ce.box,ze=M?Ce.allPointsOccluded:se.isOccluded;let We=ze;return We||(We=se.perspectiveRatio<this.perspectiveRatioCutoff),We||(We=!this.isInsideGrid(Me,Ie,Le,$e)),We||s!=="always"&&this.grid.hitTest(Me,Ie,Le,$e,s,Z)?{box:[Me,Ie,Le,$e],placeable:!1,offscreen:!1,occluded:ze}:{box:[Me,Ie,Le,$e],placeable:!0,offscreen:this.isOffscreen(Me,Ie,Le,$e),occluded:ze}}placeCollisionCircles(t,s,f,x,S,M,z,j,Z,W,ee,J,se,fe){const Ce=[],Me=new h.P(s.anchorX,s.anchorY),Ie=this.getPerspectiveRatio(Me.x,Me.y,M,fe),Le=(Z?S*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,M)/Ie:S*Ie)/h.aM,$e={getElevation:fe,pitchedLabelPlaneMatrix:z,lineVertexArray:f,pitchWithMap:Z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Me,unwrappedTileID:M,width:this.transform.width,height:this.transform.height,translation:se},ze=Zi(Le,x,s.lineOffsetX*Le,s.lineOffsetY*Le,!1,s,!1,$e);let We=!1,st=!1,Ve=!0;if(ze){const pt=.5*ee*Ie+J,Ft=new h.P(-100,-100),Nt=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Ot=new je,zt=ze.first,xn=ze.last;let _n=[];for(let Mi=zt.path.length-1;Mi>=1;Mi--)_n.push(zt.path[Mi]);for(let Mi=1;Mi<xn.path.length;Mi++)_n.push(xn.path[Mi]);const cn=2.5*pt;if(Z){const Mi=this.projectPathToScreenSpace(_n,$e);_n=Mi.some((Cr=>Cr.signedDistanceFromCamera<=0))?[]:Mi.map((Cr=>Cr.point))}let Tn=[];if(_n.length>0){const Mi=_n[0].clone(),Cr=_n[0].clone();for(let Hr=1;Hr<_n.length;Hr++)Mi.x=Math.min(Mi.x,_n[Hr].x),Mi.y=Math.min(Mi.y,_n[Hr].y),Cr.x=Math.max(Cr.x,_n[Hr].x),Cr.y=Math.max(Cr.y,_n[Hr].y);Tn=Mi.x>=Ft.x&&Cr.x<=Nt.x&&Mi.y>=Ft.y&&Cr.y<=Nt.y?[_n]:Cr.x<Ft.x||Mi.x>Nt.x||Cr.y<Ft.y||Mi.y>Nt.y?[]:h.aJ([_n],Ft.x,Ft.y,Nt.x,Nt.y)}for(const Mi of Tn){Ot.reset(Mi,.25*pt);let Cr=0;Cr=Ot.length<=.5*pt?1:Math.ceil(Ot.paddedLength/cn)+1;for(let Hr=0;Hr<Cr;Hr++){const jr=Hr/Math.max(Cr-1,1),Qr=Ot.lerp(jr),Pr=Qr.x+Qn,ds=Qr.y+Qn;Ce.push(Pr,ds,pt,0);const Jr=Pr-pt,ta=ds-pt,ms=Pr+pt,ys=ds+pt;if(Ve=Ve&&this.isOffscreen(Jr,ta,ms,ys),st=st||this.isInsideGrid(Jr,ta,ms,ys),t!=="always"&&this.grid.hitTestCircle(Pr,ds,pt,t,W)&&(We=!0,!j))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!j&&We||!st||Ie<this.perspectiveRatioCutoff?[]:Ce,offscreen:Ve,collisionDetected:We}}projectPathToScreenSpace(t,s){const f=(function(x,S){const M=h.N();return h.aB(M,S.pitchedLabelPlaneMatrix),x.map((z=>{const j=vn(z.x,z.y,M,S.getElevation),Z=S.transform.projectTileCoordinates(j.point.x,j.point.y,S.unwrappedTileID,S.getElevation);return Z.point.x=(.5*Z.point.x+.5)*S.width,Z.point.y=(.5*-Z.point.y+.5)*S.height,Z}))})(t,s);return(function(x){let S=0,M=0,z=0,j=0;for(let Z=0;Z<x.length;Z++)x[Z].isOccluded?(z=Z+1,j=0):(j++,j>M&&(M=j,S=z));return x.slice(S,S+M)})(f)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],f=new h.aa;for(const ee of t){const J=new h.P(ee.x+Qn,ee.y+Qn);f.extend(J),s.push(J)}const{minX:x,minY:S,maxX:M,maxY:z}=f,j=this.grid.query(x,S,M,z).concat(this.ignoredGrid.query(x,S,M,z)),Z={},W={};for(const ee of j){const J=ee.key;if(Z[J.bucketInstanceId]===void 0&&(Z[J.bucketInstanceId]={}),Z[J.bucketInstanceId][J.featureIndex])continue;const se=[new h.P(ee.x1,ee.y1),new h.P(ee.x2,ee.y1),new h.P(ee.x2,ee.y2),new h.P(ee.x1,ee.y2)];h.aK(s,se)&&(Z[J.bucketInstanceId][J.featureIndex]=!0,W[J.bucketInstanceId]===void 0&&(W[J.bucketInstanceId]=[]),W[J.bucketInstanceId].push(J.featureIndex))}return W}insertCollisionBox(t,s,f,x,S,M){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:S,collisionGroupID:M,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,f,x,S,M){const z=f?this.ignoredGrid:this.grid,j={bucketInstanceId:x,featureIndex:S,collisionGroupID:M,overlapMode:s};for(let Z=0;Z<t.length;Z+=4)z.insertCircle(j,t[Z],t[Z+1],t[Z+2])}projectAndGetPerspectiveRatio(t,s,f,x,S){if(S){let M;x?(M=[t,s,x(t,s),1],h.aH(M,M,S)):(M=[t,s,0,1],Tr(M,M,S));const z=M[3];return{x:(M[0]/z+1)/2*this.transform.width+Qn,y:(-M[1]/z+1)/2*this.transform.height+Qn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/z*.5,isOccluded:!1,signedDistanceFromCamera:z}}{const M=this.transform.projectTileCoordinates(t,s,f,x);return{x:(M.point.x+1)/2*this.transform.width+Qn,y:(1-M.point.y)/2*this.transform.height+Qn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M.signedDistanceFromCamera*.5,isOccluded:M.isOccluded,signedDistanceFromCamera:M.signedDistanceFromCamera}}}getPerspectiveRatio(t,s,f,x){const S=this.transform.projectTileCoordinates(t,s,f,x);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(t,s,f,x){return f<Qn||t>=this.screenRightBoundary||x<Qn||s>this.screenBottomBoundary}isInsideGrid(t,s,f,x){return f>=0&&t<this.gridRightBoundary&&x>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=h.ar([]);return h.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,f,x,S,M,z,j,Z,W,ee){let J=1,se=0,fe=0,Ce=1;const Me=t.anchorPointX+z[0],Ie=t.anchorPointY+z[1];if(M&&!S){const _n=this.projectAndGetPerspectiveRatio(Me+1,Ie,x,Z,ee),cn=_n.x-j.x,Tn=Math.atan((_n.y-j.y)/cn)+(cn<0?Math.PI:0),Mi=Math.sin(Tn),Cr=Math.cos(Tn);J=Cr,se=Mi,fe=-Mi,Ce=Cr}else if(!M&&S){const _n=Hn(this.transform);J=_n.vecEast[0],se=_n.vecEast[1],fe=_n.vecSouth[0],Ce=_n.vecSouth[1]}let Le=j.x,$e=j.y,ze=s;S&&(Le=Me,$e=Ie,ze=Math.pow(2,-(this.transform.zoom-f.overscaledZ)),ze*=this.transform.getPitchedTextCorrection(Me,Ie,x),W||(ze*=h.an(.5+j.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),W&&(Le+=J*W.x*ze+fe*W.y*ze,$e+=se*W.x*ze+Ce*W.y*ze);const We=t.x1*ze,st=t.x2*ze,Ve=(We+st)/2,pt=t.y1*ze,Ft=t.y2*ze,Nt=(pt+Ft)/2,Ot=[{offsetX:We,offsetY:pt},{offsetX:Ve,offsetY:pt},{offsetX:st,offsetY:pt},{offsetX:st,offsetY:Nt},{offsetX:st,offsetY:Ft},{offsetX:Ve,offsetY:Ft},{offsetX:We,offsetY:Ft},{offsetX:We,offsetY:Nt}];let zt=[];for(const{offsetX:_n,offsetY:cn}of Ot)zt.push(new h.P(Le+J*_n+fe*cn,$e+se*_n+Ce*cn));let xn=!1;if(S){const _n=zt.map((cn=>this.projectAndGetPerspectiveRatio(cn.x,cn.y,x,Z,ee)));xn=_n.some((cn=>!cn.isOccluded)),zt=_n.map((cn=>new h.P(cn.x,cn.y)))}else xn=!0;return{box:h.aL(zt),allPointsOccluded:!xn}}}class Ts{constructor(t,s,f,x){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):x&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class zi{constructor(t,s,f,x,S){this.text=new Ts(t?t.text:null,s,f,S),this.icon=new Ts(t?t.icon:null,s,x,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ba{constructor(t,s,f){this.text=t,this.icon=s,this.skipFade=f}}class sl{constructor(t,s,f,x,S){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=f,this.bucketIndex=x,this.tileID=S}}class Vo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:f=>f.collisionGroupID===s}}return this.collisionGroups[t]}}function Fi(A,t,s,f,x){const{horizontalAlign:S,verticalAlign:M}=h.aS(A);return new h.P(-(S-.5)*t+f[0]*x,-(M-.5)*s+f[1]*x)}class Wr{constructor(t,s,f,x,S){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new es(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Vo(x),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(f,x)=>s.getElevation(t,f,x):null}getBucketParts(t,s,f,x){const S=f.getBucket(s),M=f.latestFeatureIndex;if(!S||!M||s.id!==S.layerIds[0])return;const z=f.collisionBoxArray,j=S.layers[0].layout,Z=S.layers[0].paint,W=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),ee=f.tileSize/h.a5,J=f.tileID.toUnwrapped(),se=j.get("text-rotation-alignment")==="map",fe=h.aN(f,1,this.transform.zoom),Ce=h.aO(this.collisionIndex.transform,f,Z.get("text-translate"),Z.get("text-translate-anchor")),Me=h.aO(this.collisionIndex.transform,f,Z.get("icon-translate"),Z.get("icon-translate-anchor")),Ie=tn(se,this.transform,fe);this.retainedQueryData[S.bucketInstanceId]=new sl(S.bucketInstanceId,M,S.sourceLayerIndex,S.index,f.tileID);const Le={bucket:S,layout:j,translationText:Ce,translationIcon:Me,unwrappedTileID:J,pitchedLabelPlaneMatrix:Ie,scale:W,textPixelRatio:ee,holdingForFade:f.holdingForSymbolFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:h.ay(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(x)for(const $e of S.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:We,symbolInstanceEnd:st}=$e;t.push({sortKey:ze,symbolInstanceStart:We,symbolInstanceEnd:st,parameters:Le})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(t,s,f,x,S,M,z,j,Z,W,ee,J,se,fe,Ce,Me,Ie,Le,$e,ze){const We=h.aP[t.textAnchor],st=[t.textOffset0,t.textOffset1],Ve=Fi(We,f,x,st,S),pt=this.collisionIndex.placeCollisionBox(s,J,j,Z,W,z,M,Me,ee.predicate,$e,Ve,ze);if((!Le||this.collisionIndex.placeCollisionBox(Le,J,j,Z,W,z,M,Ie,ee.predicate,$e,Ve,ze).placeable)&&pt.placeable){let Ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ft=this.prevPlacement.variableOffsets[se.crossTileID].anchor),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[se.crossTileID]={textOffset:st,width:f,height:x,anchor:We,textBoxScale:S,prevAnchor:Ft},this.markUsedJustification(fe,We,se,Ce),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,Ce,se),this.placedOrientations[se.crossTileID]=Ce),{shift:Ve,placedGlyphBoxes:pt}}}placeLayerBucketPart(t,s,f){const{bucket:x,layout:S,translationText:M,translationIcon:z,unwrappedTileID:j,pitchedLabelPlaneMatrix:Z,textPixelRatio:W,holdingForFade:ee,collisionBoxArray:J,partiallyEvaluatedTextSize:se,collisionGroup:fe}=t.parameters,Ce=S.get("text-optional"),Me=S.get("icon-optional"),Ie=h.aQ(S,"text-overlap","text-allow-overlap"),Le=Ie==="always",$e=h.aQ(S,"icon-overlap","icon-allow-overlap"),ze=$e==="always",We=S.get("text-rotation-alignment")==="map",st=S.get("text-pitch-alignment")==="map",Ve=S.get("icon-text-fit")!=="none",pt=S.get("symbol-z-order")==="viewport-y",Ft=Le&&(ze||!x.hasIconData()||Me),Nt=ze&&(Le||!x.hasTextData()||Ce);!x.collisionArrays&&J&&x.deserializeCollisionBoxes(J);const Ot=this.retainedQueryData[x.bucketInstanceId].tileID,zt=this._getTerrainElevationFunc(Ot),xn=this.transform.getFastPathSimpleProjectionMatrix(Ot),_n=(cn,Tn,Mi)=>{var Cr,Hr;if(s[cn.crossTileID])return;if(ee)return void(this.placements[cn.crossTileID]=new Ba(!1,!1,!1));let jr=!1,Qr=!1,Pr=!0,ds=null,Jr={box:null,placeable:!1,offscreen:null,occluded:!1},ta={placeable:!1},ms=null,ys=null,na=null,Tl=0,Il=0,Yo=0;Tn.textFeatureIndex?Tl=Tn.textFeatureIndex:cn.useRuntimeCollisionCircles&&(Tl=cn.featureIndex),Tn.verticalTextFeatureIndex&&(Il=Tn.verticalTextFeatureIndex);const Za=Tn.textBox;if(Za){const Xa=Mr=>{let Ur=h.az.horizontal;if(x.allowVerticalPlacement&&!Mr&&this.prevPlacement){const Ds=this.prevPlacement.placedOrientations[cn.crossTileID];Ds&&(this.placedOrientations[cn.crossTileID]=Ds,Ur=Ds,this.markUsedOrientation(x,Ur,cn))}return Ur},fo=(Mr,Ur)=>{if(x.allowVerticalPlacement&&cn.numVerticalGlyphVertices>0&&Tn.verticalTextBox){for(const Ds of x.writingModes)if(Ds===h.az.vertical?(Jr=Ur(),ta=Jr):Jr=Mr(),Jr&&Jr.placeable)break}else Jr=Mr()},No=cn.textAnchorOffsetStartIndex,Do=cn.textAnchorOffsetEndIndex;if(Do===No){const Mr=(Ur,Ds)=>{const Us=this.collisionIndex.placeCollisionBox(Ur,Ie,W,Ot,j,st,We,M,fe.predicate,zt,void 0,xn);return Us&&Us.placeable&&(this.markUsedOrientation(x,Ds,cn),this.placedOrientations[cn.crossTileID]=Ds),Us};fo((()=>Mr(Za,h.az.horizontal)),(()=>{const Ur=Tn.verticalTextBox;return x.allowVerticalPlacement&&cn.numVerticalGlyphVertices>0&&Ur?Mr(Ur,h.az.vertical):{box:null,offscreen:null}})),Xa(Jr&&Jr.placeable)}else{let Mr=h.aP[(Hr=(Cr=this.prevPlacement)===null||Cr===void 0?void 0:Cr.variableOffsets[cn.crossTileID])===null||Hr===void 0?void 0:Hr.anchor];const Ur=(Us,od,ld)=>{const Ec=Us.x2-Us.x1,cp=Us.y2-Us.y1,Sc=cn.textBoxScale,cd=Ve&&$e==="never"?od:null;let ec=null,tc=Ie==="never"?1:2,Ko="never";Mr&&tc++;for(let ud=0;ud<tc;ud++){for(let vh=No;vh<Do;vh++){const wh=x.textAnchorOffsets.get(vh);if(Mr&&wh.textAnchor!==Mr)continue;const Ah=this.attemptAnchorPlacement(wh,Us,Ec,cp,Sc,We,st,W,Ot,j,fe,Ko,cn,x,ld,M,z,cd,zt);if(Ah&&(ec=Ah.placedGlyphBoxes,ec&&ec.placeable))return jr=!0,ds=Ah.shift,ec}Mr?Mr=null:Ko=Ie}return f&&!ec&&(ec={box:this.collisionIndex.placeCollisionBox(Za,"always",W,Ot,j,st,We,M,fe.predicate,zt,void 0,xn).box,offscreen:!1,placeable:!1,occluded:!1}),ec};fo((()=>Ur(Za,Tn.iconBox,h.az.horizontal)),(()=>{const Us=Tn.verticalTextBox;return x.allowVerticalPlacement&&(!Jr||!Jr.placeable)&&cn.numVerticalGlyphVertices>0&&Us?Ur(Us,Tn.verticalIconBox,h.az.vertical):{box:null,occluded:!0,offscreen:null}})),Jr&&(jr=Jr.placeable,Pr=Jr.offscreen);const Ds=Xa(Jr&&Jr.placeable);if(!jr&&this.prevPlacement){const Us=this.prevPlacement.variableOffsets[cn.crossTileID];Us&&(this.variableOffsets[cn.crossTileID]=Us,this.markUsedJustification(x,Us.anchor,cn,Ds))}}}if(ms=Jr,jr=ms&&ms.placeable,Pr=ms&&ms.offscreen,cn.useRuntimeCollisionCircles&&cn.centerJustifiedTextSymbolIndex>=0){const Xa=x.text.placedSymbolArray.get(cn.centerJustifiedTextSymbolIndex),fo=h.aA(x.textSizeData,se,Xa),No=S.get("text-padding");ys=this.collisionIndex.placeCollisionCircles(Ie,Xa,x.lineVertexArray,x.glyphOffsetArray,fo,j,Z,f,st,fe.predicate,cn.collisionCircleDiameter,No,M,zt),ys.circles.length&&ys.collisionDetected&&!f&&h.w("Collisions detected, but collision boxes are not shown"),jr=Le||ys.circles.length>0&&!ys.collisionDetected,Pr=Pr&&ys.offscreen}if(Tn.iconFeatureIndex&&(Yo=Tn.iconFeatureIndex),Tn.iconBox){const Xa=fo=>this.collisionIndex.placeCollisionBox(fo,$e,W,Ot,j,st,We,z,fe.predicate,zt,Ve&&ds?ds:void 0,xn);ta&&ta.placeable&&Tn.verticalIconBox?(na=Xa(Tn.verticalIconBox),Qr=na.placeable):(na=Xa(Tn.iconBox),Qr=na.placeable),Pr=Pr&&na.offscreen}const Qc=Ce||cn.numHorizontalGlyphVertices===0&&cn.numVerticalGlyphVertices===0,Du=Me||cn.numIconVertices===0;Qc||Du?Du?Qc||(Qr=Qr&&jr):jr=Qr&&jr:Qr=jr=Qr&&jr;const $o=Qr&&na.placeable;if(jr&&ms.placeable&&this.collisionIndex.insertCollisionBox(ms.box,Ie,S.get("text-ignore-placement"),x.bucketInstanceId,ta&&ta.placeable&&Il?Il:Tl,fe.ID),$o&&this.collisionIndex.insertCollisionBox(na.box,$e,S.get("icon-ignore-placement"),x.bucketInstanceId,Yo,fe.ID),ys&&jr&&this.collisionIndex.insertCollisionCircles(ys.circles,Ie,S.get("text-ignore-placement"),x.bucketInstanceId,Tl,fe.ID),f&&this.storeCollisionData(x.bucketInstanceId,Mi,Tn,ms,na,ys),cn.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[cn.crossTileID]=new Ba((jr||Ft)&&!ms?.occluded,(Qr||Nt)&&!na?.occluded,Pr||x.justReloaded),s[cn.crossTileID]=!0};if(pt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const cn=x.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Tn=cn.length-1;Tn>=0;--Tn){const Mi=cn[Tn];_n(x.symbolInstances.get(Mi),x.collisionArrays[Mi],Mi)}}else for(let cn=t.symbolInstanceStart;cn<t.symbolInstanceEnd;cn++)_n(x.symbolInstances.get(cn),x.collisionArrays[cn],cn);x.justReloaded=!1}storeCollisionData(t,s,f,x,S,M){if(f.textBox||f.iconBox){let z,j;this.collisionBoxArrays.has(t)?z=this.collisionBoxArrays.get(t):(z=new Map,this.collisionBoxArrays.set(t,z)),z.has(s)?j=z.get(s):(j={text:null,icon:null},z.set(s,j)),f.textBox&&(j.text=x.box),f.iconBox&&(j.icon=S.box)}if(M){let z=this.collisionCircleArrays[t];z===void 0&&(z=this.collisionCircleArrays[t]=[]);for(let j=0;j<M.circles.length;j+=4)z.push(M.circles[j+0]-Qn),z.push(M.circles[j+1]-Qn),z.push(M.circles[j+2]),z.push(M.collisionDetected?1:0)}}markUsedJustification(t,s,f,x){let S;S=x===h.az.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[h.aR(s)];const M=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const z of M)z>=0&&(t.text.placedSymbolArray.get(z).crossTileID=S>=0&&z!==S?0:f.crossTileID)}markUsedOrientation(t,s,f){const x=s===h.az.horizontal||s===h.az.horizontalOnly?s:0,S=s===h.az.vertical?s:0,M=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const z of M)t.text.placedSymbolArray.get(z).placedOrientation=x;f.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let f=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const x=s?s.symbolFadeChange(t):1,S=s?s.opacities:{},M=s?s.variableOffsets:{},z=s?s.placedOrientations:{};for(const j in this.placements){const Z=this.placements[j],W=S[j];W?(this.opacities[j]=new zi(W,x,Z.text,Z.icon),f=f||Z.text!==W.text.placed||Z.icon!==W.icon.placed):(this.opacities[j]=new zi(null,x,Z.text,Z.icon,Z.skipFade),f=f||Z.text||Z.icon)}for(const j in S){const Z=S[j];if(!this.opacities[j]){const W=new zi(Z,x,!1,!1);W.isHidden()||(this.opacities[j]=W,f=f||Z.text.placed||Z.icon.placed)}}for(const j in M)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=M[j]);for(const j in z)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=z[j]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const f={};for(const x of s){const S=x.getBucket(t);S&&x.latestFeatureIndex&&t.id===S.layerIds[0]&&this.updateBucketOpacities(S,x.tileID,f,x.collisionBoxArray)}}updateBucketOpacities(t,s,f,x){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const S=t.layers[0],M=S.layout,z=new zi(null,0,!1,!1,!0),j=M.get("text-allow-overlap"),Z=M.get("icon-allow-overlap"),W=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ee=M.get("text-rotation-alignment")==="map",J=M.get("text-pitch-alignment")==="map",se=M.get("icon-text-fit")!=="none",fe=new zi(null,0,j&&(Z||!t.hasIconData()||M.get("icon-optional")),Z&&(j||!t.hasTextData()||M.get("text-optional")),!0);!t.collisionArrays&&x&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(x);const Ce=(Ie,Le,$e)=>{for(let ze=0;ze<Le/4;ze++)Ie.opacityVertexArray.emplaceBack($e);Ie.hasVisibleVertices=Ie.hasVisibleVertices||$e!==xr},Me=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Ie=0;Ie<t.symbolInstances.length;Ie++){const Le=t.symbolInstances.get(Ie),{numHorizontalGlyphVertices:$e,numVerticalGlyphVertices:ze,crossTileID:We}=Le;let st=this.opacities[We];f[We]?st=z:st||(st=fe,this.opacities[We]=st),f[We]=!0;const Ve=Le.numIconVertices>0,pt=this.placedOrientations[Le.crossTileID],Ft=pt===h.az.vertical,Nt=pt===h.az.horizontal||pt===h.az.horizontalOnly;if($e>0||ze>0){const zt=di(st.text);Ce(t.text,$e,Ft?xr:zt),Ce(t.text,ze,Nt?xr:zt);const xn=st.text.isHidden();[Le.rightJustifiedTextSymbolIndex,Le.centerJustifiedTextSymbolIndex,Le.leftJustifiedTextSymbolIndex].forEach((Tn=>{Tn>=0&&(t.text.placedSymbolArray.get(Tn).hidden=xn||Ft?1:0)})),Le.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Le.verticalPlacedTextSymbolIndex).hidden=xn||Nt?1:0);const _n=this.variableOffsets[Le.crossTileID];_n&&this.markUsedJustification(t,_n.anchor,Le,pt);const cn=this.placedOrientations[Le.crossTileID];cn&&(this.markUsedJustification(t,"left",Le,cn),this.markUsedOrientation(t,cn,Le))}if(Ve){const zt=di(st.icon),xn=!(se&&Le.verticalPlacedIconSymbolIndex&&Ft);Le.placedIconSymbolIndex>=0&&(Ce(t.icon,Le.numIconVertices,xn?zt:xr),t.icon.placedSymbolArray.get(Le.placedIconSymbolIndex).hidden=st.icon.isHidden()),Le.verticalPlacedIconSymbolIndex>=0&&(Ce(t.icon,Le.numVerticalIconVertices,xn?xr:zt),t.icon.placedSymbolArray.get(Le.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}const Ot=Me&&Me.has(Ie)?Me.get(Ie):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const zt=t.collisionArrays[Ie];if(zt){let xn=new h.P(0,0);if(zt.textBox||zt.verticalTextBox){let _n=!0;if(W){const cn=this.variableOffsets[We];cn?(xn=Fi(cn.anchor,cn.width,cn.height,cn.textOffset,cn.textBoxScale),ee&&xn._rotate(J?-this.transform.bearingInRadians:this.transform.bearingInRadians)):_n=!1}if(zt.textBox||zt.verticalTextBox){let cn;zt.textBox&&(cn=Ft),zt.verticalTextBox&&(cn=Nt),Pt(t.textCollisionBox.collisionVertexArray,st.text.placed,!_n||cn,Ot.text,xn.x,xn.y)}}if(zt.iconBox||zt.verticalIconBox){const _n=!!(!Nt&&zt.verticalIconBox);let cn;zt.iconBox&&(cn=_n),zt.verticalIconBox&&(cn=!_n),Pt(t.iconCollisionBox.collisionVertexArray,st.icon.placed,cn,Ot.icon,se?xn.x:0,se?xn.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const f=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Pt(A,t,s,f,x,S){f&&f.length!==0||(f=[0,0,0,0]);const M=f[0]-Qn,z=f[1]-Qn,j=f[2]-Qn,Z=f[3]-Qn;A.emplaceBack(t?1:0,s?1:0,x||0,S||0,M,z),A.emplaceBack(t?1:0,s?1:0,x||0,S||0,j,z),A.emplaceBack(t?1:0,s?1:0,x||0,S||0,j,Z),A.emplaceBack(t?1:0,s?1:0,x||0,S||0,M,Z)}const Ne=Math.pow(2,25),ti=Math.pow(2,24),cs=Math.pow(2,17),Is=Math.pow(2,16),Ma=Math.pow(2,9),uc=Math.pow(2,8),ts=Math.pow(2,1);function di(A){if(A.opacity===0&&!A.placed)return 0;if(A.opacity===1&&A.placed)return 4294967295;const t=A.placed?1:0,s=Math.floor(127*A.opacity);return s*Ne+t*ti+s*cs+t*Is+s*Ma+t*uc+s*ts+t}const xr=0;class wo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,f,x,S){const M=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(M,x,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(((z,j)=>z.sortKey-j.sortKey)));this._currentPartIndex<M.length;)if(s.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1}}class al{constructor(t,s,f,x,S,M,z,j){this.placement=new Wr(t,s,M,z,j),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(t,s,f){const x=pe(),S=()=>!this._forceFullPlacement&&pe()-x>2;for(;this._currentPlacementIndex>=0;){const M=s[t[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=z)&&(!M.maxzoom||M.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new wo(M)),this._inProgressLayer.continuePlacement(f[M.source],this.placement,this._showCollisionBoxes,M,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Si=512/h.a5/2;class Hs{constructor(t,s,f){this.tileID=t,this.bucketInstanceId=f,this._symbolsByKey={};const x=new Map;for(let S=0;S<s.length;S++){const M=s.get(S),z=M.key,j=x.get(z);j?j.push(M):x.set(z,[M])}for(const[S,M]of x){const z={positions:M.map((j=>({x:Math.floor(j.anchorX*Si),y:Math.floor(j.anchorY*Si)}))),crossTileIDs:M.map((j=>j.crossTileID))};if(z.positions.length>128){const j=new h.aT(z.positions.length,16,Uint16Array);for(const{x:Z,y:W}of z.positions)j.add(Z,W);j.finish(),delete z.positions,z.index=j}this._symbolsByKey[S]=z}}getScaledCoordinates(t,s){const{x:f,y:x,z:S}=this.tileID.canonical,{x:M,y:z,z:j}=s.canonical,Z=Si/Math.pow(2,j-S),W=(z*h.a5+t.anchorY)*Z,ee=x*h.a5*Si;return{x:Math.floor((M*h.a5+t.anchorX)*Z-f*h.a5*Si),y:Math.floor(W-ee)}}findMatches(t,s,f){const x=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let S=0;S<t.length;S++){const M=t.get(S);if(M.crossTileID)continue;const z=this._symbolsByKey[M.key];if(!z)continue;const j=this.getScaledCoordinates(M,s);if(z.index){const Z=z.index.range(j.x-x,j.y-x,j.x+x,j.y+x).sort();for(const W of Z){const ee=z.crossTileIDs[W];if(!f[ee]){f[ee]=!0,M.crossTileID=ee;break}}}else if(z.positions)for(let Z=0;Z<z.positions.length;Z++){const W=z.positions[Z],ee=z.crossTileIDs[Z];if(Math.abs(W.x-j.x)<=x&&Math.abs(W.y-j.y)<=x&&!f[ee]){f[ee]=!0,M.crossTileID=ee;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class zl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ol{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const f in this.indexes){const x=this.indexes[f],S={};for(const M in x){const z=x[M];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+s),S[z.tileID.key]=z}this.indexes[f]=S}this.lng=t}addBucket(t,s,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let S=0;S<s.symbolInstances.length;S++)s.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const x=this.usedCrossTileIDs[t.overscaledZ];for(const S in this.indexes){const M=this.indexes[S];if(Number(S)>t.overscaledZ)for(const z in M){const j=M[z];j.tileID.isChildOf(t)&&j.findMatches(s.symbolInstances,t,x)}else{const z=M[t.scaledTo(Number(S)).key];z&&z.findMatches(s.symbolInstances,t,x)}}for(let S=0;S<s.symbolInstances.length;S++){const M=s.symbolInstances.get(S);M.crossTileID||(M.crossTileID=f.generate(),x[M.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Hs(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const f of s.getCrossTileIDsLists())for(const x of f)delete this.usedCrossTileIDs[t][x]}removeStaleBuckets(t){let s=!1;for(const f in this.indexes){const x=this.indexes[f];for(const S in x)t[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,x[S]),delete x[S],s=!0)}return s}}class Yi{constructor(){this.layerIndexes={},this.crossTileIDs=new zl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,f){let x=this.layerIndexes[t.id];x===void 0&&(x=this.layerIndexes[t.id]=new ol);let S=!1;const M={};x.handleWrapJump(f);for(const z of s){const j=z.getBucket(t);j&&t.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(z.tileID,j,this.crossTileIDs)&&(S=!0),M[j.bucketInstanceId]=!0)}return x.removeStaleBuckets(M)&&(S=!0),S}pruneUnusedLayers(t){const s={};t.forEach((f=>{s[f]=!0}));for(const f in this.layerIndexes)s[f]||delete this.layerIndexes[f]}}var Br="void main() {fragColor=vec4(1.0);}";const nr={prelude:gn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:gn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:gn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:gn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:gn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:gn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:gn(Br,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:gn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:gn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:gn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:gn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:gn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:gn(Br,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:gn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:gn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:gn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:gn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:gn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:gn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:gn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:gn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:gn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:gn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:gn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:gn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:gn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:gn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:gn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:gn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:gn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:gn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:gn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:gn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:gn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:gn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function gn(A,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=t.match(/in ([\w]+) ([\w]+)/g),x=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=S?S.concat(x):x,z={};return{fragmentSource:A=A.replace(s,((j,Z,W,ee,J)=>(z[J]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
in ${W} ${ee} ${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = u_${J};
#endif
`))),vertexSource:t=t.replace(s,((j,Z,W,ee,J)=>{const se=ee==="float"?"vec2":"vec4",fe=J.match(/color/)?"color":se;return z[J]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${W} ${se} a_${J};
out ${W} ${ee} ${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
in ${W} ${se} a_${J};
#else
uniform ${W} ${ee} u_${J};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = a_${J};
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${W} ${ee} ${J} = unpack_mix_${fe}(a_${J}, u_${J}_t);
#else
    ${W} ${ee} ${J} = u_${J};
#endif
`})),staticAttributes:f,staticUniforms:M}}class _r{constructor(t,s,f){this.vertexBuffer=t,this.indexBuffer=s,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ai=h.aU([{name:"a_pos",type:"Int16",components:2}]);const Ui="#define PROJECTION_MERCATOR",qs="mercator";class Yr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return qs}get shaderDefine(){return Ui}get shaderPreludeCode(){return nr.projectionMercator}get vertexShaderPreludeCode(){return nr.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,s,f,x,S){if(this._cachedMesh)return this._cachedMesh;const M=new h.aW;M.emplaceBack(0,0),M.emplaceBack(h.a5,0),M.emplaceBack(0,h.a5),M.emplaceBack(h.a5,h.a5);const z=t.createVertexBuffer(M,Ai.members),j=h.aX.simpleSegment(0,0,4,2),Z=new h.aY;Z.emplaceBack(1,0,2),Z.emplaceBack(1,2,3);const W=t.createIndexBuffer(Z);return this._cachedMesh=new _r(z,W,j),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Zs{constructor(t=0,s=0,f=0,x=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(f)||f<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=f,this.right=x}interpolate(t,s,f){return s.top!=null&&t.top!=null&&(this.top=h.G.number(t.top,s.top,f)),s.bottom!=null&&t.bottom!=null&&(this.bottom=h.G.number(t.bottom,s.bottom,f)),s.left!=null&&t.left!=null&&(this.left=h.G.number(t.left,s.left,f)),s.right!=null&&t.right!=null&&(this.right=h.G.number(t.right,s.right,f)),this}getCenter(t,s){const f=h.an((this.left+t-this.right)/2,0,t),x=h.an((this.top+s-this.bottom)/2,0,s);return new h.P(f,x)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bs(A,t){if(!A.renderWorldCopies||A.lngRange)return;const s=t.lng-A.center.lng;t.lng+=s>180?-360:s<-180?360:0}function Dr(A){return Math.max(0,Math.floor(A))}class fa{constructor(t,s){var f;this.applyConstrain=(x,S)=>this._constrainOverride!==null?this._constrainOverride(x,S):this._callbacks.defaultConstrain(x,S),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=s?.renderWorldCopies===void 0||!!s?.renderWorldCopies,this._minZoom=s?.minZoom||0,this._maxZoom=s?.maxZoom||22,this._minPitch=s?.minPitch==null?0:s?.minPitch,this._maxPitch=s?.maxPitch==null?60:s?.maxPitch,this._constrainOverride=(f=s?.constrainOverride)!==null&&f!==void 0?f:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Dr(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Zs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,s,f){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Dr(this._zoom),this._scale=h.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Zs(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!f&&t.autoCalculateNearFarZ,s&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const s=h.W(t,-180,180)*Math.PI/180;var f,x,S,M,z,j,Z,W,ee;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=H(),f=this._rotationMatrix,S=-this._bearingInRadians,M=(x=this._rotationMatrix)[0],z=x[1],j=x[2],Z=x[3],W=Math.sin(S),ee=Math.cos(S),f[0]=M*ee+j*W,f[1]=z*ee+Z*W,f[2]=M*-W+j*ee,f[3]=z*-W+Z*ee)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const s=h.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const s=t/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aZ(this._fovInRadians)}setFov(t){t=h.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=h.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const s=this.applyConstrain(this._center,t).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=h.aq(s),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,s){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,f){this._unmodified=!1,this._edgeInsets.interpolate(t,s,f),this.constrainInternal(),this._calcMatrices()}resize(t,s,f=!0){this._width=t,this._height=s,f&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Yn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-h.ao,h.ao])}getCameraQueryGeometry(t,s){if(s.length===1)return[s[0],t];{const{minX:f,minY:x,maxX:S,maxY:M}=h.aa.fromPoints(s).extend(t);return[new h.P(f,x),new h.P(S,x),new h.P(S,M),new h.P(f,M),new h.P(f,x)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:f}=this.applyConstrain(this.center,this.zoom);this.setCenter(s),this.setZoom(f),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=h.ar(new Float64Array(16));h.Q(t,t,[this._width/2,-this._height/2,1]),h.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=h.ar(new Float64Array(16)),h.Q(t,t,[1,-1,1]),h.O(t,t,[-1,-1,0]),h.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,s,f,x){const S=f!==void 0?f:this.bearing,M=x=x!==void 0?x:this.pitch,{distanceToCenter:z,clampedElevation:j}=this._distanceToCenterFromAltElevationPitch(s,this.elevation,M),{x:Z,y:W}=ai(M,S),ee=h.a9.fromLngLat(t,s);let J,se,fe=h.a_(1,ee.y),Ce=0;do{if(Ce+=1,Ce>10)break;se=z/fe,J=new h.a9(ee.x+Z*se,ee.y+W*se),fe=1/J.meterInMercatorCoordinateUnits()}while(Math.abs(z-se*fe)>1e-12);return{center:J.toLngLat(),elevation:j,zoom:h.at(this.height/2/Math.tan(this.fovInRadians/2)/se/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const s=1/this.worldSize,f=h.as(1,this.center.lat)*this.worldSize,x=h.a9.fromLngLat(this.center,this.elevation),S=x.x/s,M=x.y/s,z=x.z/s,j=this.pitch,Z=this.bearing,{x:W,y:ee,z:J}=ai(j,Z),se=this.cameraToCenterDistance,fe=S+se*-W,Ce=M+se*-ee,Me=z+se*J,{distanceToCenter:Ie,clampedElevation:Le}=this._distanceToCenterFromAltElevationPitch(Me/f,t,j),$e=Ie*f,ze=new h.a9((fe+W*$e)*s,(Ce+ee*$e)*s,0).toLngLat(),We=h.as(1,ze.lat),st=h.at(this.height/2/Math.tan(this.fovInRadians/2)/Ie/We/this.tileSize);this._elevation=Le,this._center=ze,this.setZoom(st)}_distanceToCenterFromAltElevationPitch(t,s,f){const x=-Math.cos(h.ap(f)),S=t-s;let M,z=s;return x*S>=0||Math.abs(x)<.1?(M=1e4,z=t+M*x):M=-S/x,{distanceToCenter:M,clampedElevation:z}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const s=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/s,t.canonical.y/s,1/s/h.a5,1/s/h.a5]}}class ps{constructor(t,s){this.min=t,this.max=s,this.center=h.a$([],h.b0([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],f=h.b1(this.min),x=h.b1(this.max);for(let S=0;S<s.length;S++)f[S]=s[S]?this.min[S]:this.center[S],x[S]=s[S]?this.center[S]:this.max[S];return x[2]=this.max[2],new ps(f,x)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let s=!0;for(let f=0;f<t.planes.length;f++){const x=this.intersectsPlane(t.planes[f]);if(x===0)return 0;x===1&&(s=!1)}return s?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let s=t[3],f=t[3];for(let x=0;x<3;x++)t[x]>0?(s+=t[x]*this.min[x],f+=t[x]*this.max[x]):(f+=t[x]*this.min[x],s+=t[x]*this.max[x]);return s>=0?2:f<0?0:1}}class va{distanceToTile2d(t,s,f,x){const S=x.distanceX([t,s]),M=x.distanceY([t,s]);return Math.hypot(S,M)}getWrap(t,s,f){return f}getTileBoundingVolume(t,s,f,x){var S,M;let z=0,j=0;if(x?.terrain){const W=new h.a2(t.z,s,t.z,t.x,t.y),ee=x.terrain.getMinMaxElevation(W);z=(S=ee.minElevation)!==null&&S!==void 0?S:Math.min(0,f),j=(M=ee.maxElevation)!==null&&M!==void 0?M:Math.max(0,f)}const Z=1<<t.z;return new ps([s+t.x/Z,t.y/Z,z],[s+(t.x+1)/Z,(t.y+1)/Z,j])}allowVariableZoom(t,s){const f=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,x=h.an(78.5-f/2,0,60);return!!s.terrain||t.pitch>x}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ms{constructor(t,s,f){this.points=t,this.planes=s,this.aabb=f}static fromInvProjectionMatrix(t,s=1,f=0,x,S){const M=S?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],z=Math.pow(2,f),j=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((J=>(function(se,fe,Ce,Me){const Ie=h.aH([],se,fe),Le=1/Ie[3]/Ce*Me;return h.b6(Ie,Ie,[Le,Le,1/Ie[3],Le])})(J,t,s,z)));x&&(function(J,se,fe,Ce){const Me=Ce?4:0,Ie=Ce?0:4;let Le=0;const $e=[],ze=[];for(let Ve=0;Ve<4;Ve++){const pt=h.b2([],J[Ve+Ie],J[Ve+Me]),Ft=h.b7(pt);h.a$(pt,pt,1/Ft),$e.push(Ft),ze.push(pt)}for(let Ve=0;Ve<4;Ve++){const pt=h.b8(J[Ve+Me],ze[Ve],fe);Le=pt!==null&&pt>=0?Math.max(Le,pt):Math.max(Le,$e[Ve])}const We=(function(Ve,pt){const Ft=h.b2([],Ve[pt[0]],Ve[pt[1]]),Nt=h.b2([],Ve[pt[2]],Ve[pt[1]]),Ot=[0,0,0,0];return h.b3(Ot,h.b4([],Ft,Nt)),Ot[3]=-h.b5(Ot,Ve[pt[0]]),Ot})(J,se),st=(function(Ve,pt){const Ft=h.b9(Ve),Nt=h.ba([],Ve,1/Ft),Ot=h.b2([],pt,h.a$([],Nt,h.b5(pt,Nt))),zt=h.b9(Ot);if(zt>0){const xn=Math.sqrt(1-Nt[3]*Nt[3]),_n=h.a$([],Nt,-Nt[3]),cn=h.b0([],_n,h.a$([],Ot,xn/zt));return h.bb(pt,cn)}return null})(fe,We);if(st!==null){const Ve=st/h.b5(ze[0],We);Le=Math.min(Le,Ve)}for(let Ve=0;Ve<4;Ve++){const pt=Math.min(Le,$e[Ve]);J[Ve+Ie]=[J[Ve+Me][0]+ze[Ve][0]*pt,J[Ve+Me][1]+ze[Ve][1]*pt,J[Ve+Me][2]+ze[Ve][2]*pt,1]}})(j,M[0],x,S);const Z=M.map((J=>{const se=h.b2([],j[J[0]],j[J[1]]),fe=h.b2([],j[J[2]],j[J[1]]),Ce=h.b3([],h.b4([],se,fe)),Me=-h.b5(Ce,j[J[1]]);return Ce.concat(Me)})),W=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],ee=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const J of j)for(let se=0;se<3;se++)W[se]=Math.min(W[se],J[se]),ee[se]=Math.max(ee[se],J[se]);return new Ms(j,Z,new ps(W,ee))}}class Rr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,f=!0){this._helper.resize(t,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,s){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(s,f)=>{f=h.an(+f,this.minZoom,this.maxZoom);const x={center:new h.V(s.lng,s.lat),zoom:f};let S=this._helper._lngRange;if(!this._helper._renderWorldCopies&&S===null){const ze=179.9999999999;S=[-ze,ze]}const M=this.tileSize*h.aq(x.zoom);let z=0,j=M,Z=0,W=M,ee=0,J=0;const{x:se,y:fe}=this.size;if(this._helper._latRange){const ze=this._helper._latRange;z=h.X(ze[1])*M,j=h.X(ze[0])*M,j-z<fe&&(ee=fe/(j-z))}S&&(Z=h.W(h.Y(S[0])*M,0,M),W=h.W(h.Y(S[1])*M,0,M),W<Z&&(W+=M),W-Z<se&&(J=se/(W-Z)));const{x:Ce,y:Me}=Lt(M,s);let Ie,Le;const $e=Math.max(J||0,ee||0);if($e){const ze=new h.P(J?(W+Z)/2:Ce,ee?(j+z)/2:Me);return x.center=bn(M,ze).wrap(),x.zoom+=h.at($e),x}if(this._helper._latRange){const ze=fe/2;Me-ze<z&&(Le=z+ze),Me+ze>j&&(Le=j-ze)}if(S){const ze=(Z+W)/2;let We=Ce;this._helper._renderWorldCopies&&(We=h.W(Ce,ze-M/2,ze+M/2));const st=se/2;We-st<Z&&(Ie=Z+st),We+st>W&&(Ie=W-st)}if(Ie!==void 0||Le!==void 0){const ze=new h.P(Ie??Ce,Le??Me);x.center=bn(M,ze).wrap()}return x},this.applyConstrain=(s,f)=>this._helper.applyConstrain(s,f),this._helper=new fa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,f)=>this.defaultConstrain(s,f)},t),this._coveringTilesDetailsProvider=new va}clone(){const t=new Rr;return t.apply(this),t}apply(t,s,f){this._helper.apply(t,s,f)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const s=[new h.bc(0,t)];if(this._helper._renderWorldCopies){const f=this.screenPointToMercatorCoordinate(new h.P(0,0)),x=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),M=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),z=Math.floor(Math.min(f.x,x.x,S.x,M.x)),j=Math.floor(Math.max(f.x,x.x,S.x,M.x)),Z=1;for(let W=z-Z;W<=j+Z;W++)W!==0&&s.push(new h.bc(W,t))}return s}getCameraFrustum(){return Ms.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const s=this.screenPointToLocation(this.centerPoint,t),f=t?t.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(f)}setLocationAtPoint(t,s){const f=h.as(this.elevation,this.center.lat),x=this.screenPointToMercatorCoordinateAtZ(s,f),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,f),M=h.a9.fromLngLat(t),z=new h.a9(M.x-(x.x-S.x),M.y-(x.y-S.y));this.setCenter(z?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,s){return s?this.coordinatePoint(h.a9.fromLngLat(t),s.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(h.a9.fromLngLat(t))}screenPointToLocation(t,s){var f;return(f=this.screenPointToMercatorCoordinate(t,s))===null||f===void 0?void 0:f.toLngLat()}screenPointToMercatorCoordinate(t,s){if(s){const f=s.pointCoordinate(t);if(f!=null)return f}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,s){const f=s||0,x=[t.x,t.y,0,1],S=[t.x,t.y,1,1];h.aH(x,x,this._pixelMatrixInverse),h.aH(S,S,this._pixelMatrixInverse);const M=x[3],z=S[3],j=x[1]/M,Z=S[1]/z,W=x[2]/M,ee=S[2]/z,J=W===ee?0:(f-W)/(ee-W);return new h.a9(h.G.number(x[0]/M,S[0]/z,J)/this.worldSize,h.G.number(j,Z,J)/this.worldSize,f)}coordinatePoint(t,s=0,f=this._pixelMatrix){const x=[t.x*this.worldSize,t.y*this.worldSize,s,1];return h.aH(x,x,f),new h.P(x[0]/x[3],x[1]/x[3])}getBounds(){const t=Math.max(0,this._helper._height/2-yn(this));return new Yn().extend(this.screenPointToLocation(new h.P(0,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,t))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(t,s){return s?s.pointCoordinate(t)!=null:t.y>this.height/2-yn(this)}calculatePosMatrix(t,s=!1,f){var x;const S=(x=t.key)!==null&&x!==void 0?x:h.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),M=s?this._alignedPosMatrixCache:this._posMatrixCache;if(M.has(S)){const Z=M.get(S);return f?Z.f32:Z.f64}const z=$n(t,this.worldSize);h.S(z,s?this._alignedProjMatrix:this._viewProjMatrix,z);const j={f64:z,f32:new Float32Array(z)};return M.set(S,j),f?j.f32:j.f64}calculateFogMatrix(t){const s=t.key,f=this._fogMatrixCacheF32;if(f.has(s))return f.get(s);const x=$n(t,this.worldSize);return h.S(x,this._fogMatrix,x),f.set(s,new Float32Array(x)),f.get(s)}calculateCenterFromCameraLngLatAlt(t,s,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,x)}_calculateNearFarZIfNeeded(t,s,f){if(!this._helper.autoCalculateNearFarZ)return;const x=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=t-x*this._helper._pixelPerMeter/Math.cos(s),M=x<0?S:t,z=Math.PI/2+this.pitchInRadians,j=h.ap(this.fov)*(Math.abs(Math.cos(h.ap(this.roll)))*this.height+Math.abs(Math.sin(h.ap(this.roll)))*this.width)/this.height*(.5+f.y/this.height),Z=Math.sin(j)*M/Math.sin(h.an(Math.PI-z-j,.01,Math.PI-.01)),W=yn(this),ee=Math.atan(W/this._helper.cameraToCenterDistance),J=h.ap(.75),se=ee>J?2*ee*(.5+f.y/(2*W)):J,fe=Math.sin(se)*M/Math.sin(h.an(Math.PI-z-se,.01,Math.PI-.01)),Ce=Math.min(Z,fe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*Ce+M),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,s=Lt(this.worldSize,this.center),f=s.x,x=s.y;this._helper._pixelPerMeter=h.as(1,this.center.lat)*this.worldSize;const S=h.ap(Math.min(this.pitch,St)),M=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let z;this._calculateNearFarZIfNeeded(M,S,t),z=new Float64Array(16),h.be(z,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aB(this._invProjMatrix,z),z[8]=2*-t.x/this._helper._width,z[9]=2*t.y/this._helper._height,this._projectionMatrix=h.bf(z),h.Q(z,z,[1,-1,1]),h.O(z,z,[0,0,-this._helper.cameraToCenterDistance]),h.bg(z,z,-this.rollInRadians),h.bh(z,z,this.pitchInRadians),h.bg(z,z,-this.bearingInRadians),h.O(z,z,[-f,-x,0]),this._mercatorMatrix=h.Q([],z,[this.worldSize,this.worldSize,this.worldSize]),h.Q(z,z,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z),h.O(z,z,[0,0,-this.elevation]),this._viewProjMatrix=z,this._invViewProjMatrix=h.aB([],z);const j=[0,0,-1,1];h.aH(j,j,this._invViewProjMatrix),this._cameraPosition=[j[0]/j[3],j[1]/j[3],j[2]/j[3]],this._fogMatrix=new Float64Array(16),h.be(this._fogMatrix,this.fovInRadians,this.width/this.height,M,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,h.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.O(this._fogMatrix,this._fogMatrix,[-f,-x,0]),h.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z);const Z=this._helper._width%2/2,W=this._helper._height%2/2,ee=Math.cos(this.bearingInRadians),J=Math.sin(-this.bearingInRadians),se=f-Math.round(f)+ee*Z+J*W,fe=x-Math.round(x)+ee*W+J*Z,Ce=new Float64Array(z);if(h.O(Ce,Ce,[se>.5?se-1:se,fe>.5?fe-1:fe,0]),this._alignedProjMatrix=Ce,z=h.aB(new Float64Array(16),this._pixelMatrix),!z)throw new Error("failed to invert matrix");this._pixelMatrixInverse=z,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new h.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.aH(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=h.as(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,s){const f=h.a9.fromLngLat(t),x=[f.x*this.worldSize,f.y*this.worldSize,s,1];return h.aH(x,x,this._viewProjMatrix),x[2]/x[3]}getProjectionData(t){const{overscaledTileID:s,aligned:f,applyTerrainMatrix:x}=t,S=this._helper.getMercatorTileCoordinates(s),M=s?this.calculatePosMatrix(s,f,!0):null;let z;return z=s&&s.terrainRttPosMatrix32f&&x?s.terrainRttPosMatrix32f:M||h.bi(),{mainMatrix:z,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:z}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,s,f){return 1}transformLightDirection(t){return h.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,s,f,x){const S=this.calculatePosMatrix(f);let M;x?(M=[t,s,x(t,s),1],h.aH(M,M,S)):(M=[t,s,0,1],Tr(M,M,S));const z=M[3];return{point:new h.P(M[0]/z,M[1]/z),signedDistanceFromCamera:z,isOccluded:!1}}populateCache(t){for(const s of t)this.calculatePosMatrix(s)}getMatrixForModel(t,s){const f=h.a9.fromLngLat(t,s),x=f.meterInMercatorCoordinateUnits(),S=h.bj();return h.O(S,S,[f.x,f.y,f.z]),h.bg(S,S,Math.PI),h.bh(S,S,Math.PI/2),h.Q(S,S,[-x,x,x]),S}getProjectionDataForCustomLayer(t=!0){const s=new h.a2(0,0,0,0,0),f=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:t}),x=$n(s,this.worldSize);h.S(x,this._viewProjMatrix,x),f.tileMercatorCoords=[0,0,1,1];const S=[h.a5,h.a5,this.worldSize/this._helper.pixelsPerMeter],M=h.bk();return h.Q(M,x,S),f.fallbackMatrix=M,f.mainMatrix=M,f}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ns(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function rr(A){if(A.useSlerp)if(A.k<1){const t=h.bl(A.startEulerAngles.roll,A.startEulerAngles.pitch,A.startEulerAngles.bearing),s=h.bl(A.endEulerAngles.roll,A.endEulerAngles.pitch,A.endEulerAngles.bearing),f=new Float64Array(4);h.bm(f,t,s,A.k);const x=h.bn(f);A.tr.setRoll(x.roll),A.tr.setPitch(x.pitch),A.tr.setBearing(x.bearing)}else A.tr.setRoll(A.endEulerAngles.roll),A.tr.setPitch(A.endEulerAngles.pitch),A.tr.setBearing(A.endEulerAngles.bearing);else A.tr.setRoll(h.G.number(A.startEulerAngles.roll,A.endEulerAngles.roll,A.k)),A.tr.setPitch(h.G.number(A.startEulerAngles.pitch,A.endEulerAngles.pitch,A.k)),A.tr.setBearing(h.G.number(A.startEulerAngles.bearing,A.endEulerAngles.bearing,A.k))}function Ao(A,t,s,f,x){const S=x.padding,M=Lt(x.worldSize,s.getNorthWest()),z=Lt(x.worldSize,s.getNorthEast()),j=Lt(x.worldSize,s.getSouthEast()),Z=Lt(x.worldSize,s.getSouthWest()),W=h.ap(-f),ee=M.rotate(W),J=z.rotate(W),se=j.rotate(W),fe=Z.rotate(W),Ce=new h.P(Math.max(ee.x,J.x,fe.x,se.x),Math.max(ee.y,J.y,fe.y,se.y)),Me=new h.P(Math.min(ee.x,J.x,fe.x,se.x),Math.min(ee.y,J.y,fe.y,se.y)),Ie=Ce.sub(Me),Le=(x.width-(S.left+S.right+t.left+t.right))/Ie.x,$e=(x.height-(S.top+S.bottom+t.top+t.bottom))/Ie.y;if($e<0||Le<0)return void ns();const ze=Math.min(h.at(x.scale*Math.min(Le,$e)),A.maxZoom),We=h.P.convert(A.offset),st=new h.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(h.ap(f)),Ve=We.add(st).mult(x.scale/h.aq(ze));return{center:bn(x.worldSize,M.add(j).div(2).sub(Ve)),zoom:ze,bearing:f}}class Eo{get useGlobeControls(){return!1}handlePanInertia(t,s){const f=t.mag(),x=Math.abs(yn(s));return{easingOffset:t.mult(Math.min(.75*x/f,1)),easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(t,s){t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta),t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta)}handleMapControlsPan(t,s,f){t.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(f,t.around)}cameraForBoxAndBearing(t,s,f,x,S){return Ao(t,s,f,x,S)}handleJumpToCenterZoom(t,s){t.zoom!==(s.zoom!==void 0?+s.zoom:t.zoom)&&t.setZoom(+s.zoom),s.center!==void 0&&t.setCenter(h.V.convert(s.center))}handleEaseTo(t,s){const f=t.zoom,x=t.padding,S={roll:t.roll,pitch:t.pitch,bearing:t.bearing},M={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},z=s.zoom!==void 0,j=!t.isPaddingEqual(s.padding);let Z=!1;const W=z?+s.zoom:t.zoom;let ee=t.centerPoint.add(s.offsetAsPoint);const J=t.screenPointToLocation(ee),{center:se,zoom:fe}=t.applyConstrain(h.V.convert(s.center||J),W??f);Bs(t,se);const Ce=Lt(t.worldSize,J),Me=Lt(t.worldSize,se).sub(Ce),Ie=h.aq(fe-f);return Z=fe!==f,{easeFunc:Le=>{if(Z&&t.setZoom(h.G.number(f,fe,Le)),h.bo(S,M)||rr({startEulerAngles:S,endEulerAngles:M,tr:t,k:Le,useSlerp:S.roll!=M.roll}),j&&(t.interpolatePadding(x,s.padding,Le),ee=t.centerPoint.add(s.offsetAsPoint)),s.around)t.setLocationAtPoint(s.around,s.aroundPoint);else{const $e=h.aq(t.zoom-f),ze=fe>f?Math.min(2,Ie):Math.max(.5,Ie),We=Math.pow(ze,1-Le),st=bn(t.worldSize,Ce.add(Me.mult(Le*We)).mult($e));t.setLocationAtPoint(t.renderWorldCopies?st.wrap():st,ee)}},isZooming:Z,elevationCenter:se}}handleFlyTo(t,s){const f=s.zoom!==void 0,x=t.zoom,S=t.applyConstrain(h.V.convert(s.center||s.locationAtOffset),f?+s.zoom:x),M=S.center,z=S.zoom;Bs(t,M);const j=Lt(t.worldSize,s.locationAtOffset),Z=Lt(t.worldSize,M).sub(j),W=Z.mag(),ee=h.aq(z-x);let J;if(s.minZoom!==void 0){const se=Math.min(+s.minZoom,x,z),fe=t.applyConstrain(M,se).zoom;J=h.aq(fe-x)}return{easeFunc:(se,fe,Ce,Me)=>{t.setZoom(se===1?z:x+h.at(fe));const Ie=se===1?M:bn(t.worldSize,j.add(Z.mult(Ce)).mult(fe));t.setLocationAtPoint(t.renderWorldCopies?Ie.wrap():Ie,Me)},scaleOfZoom:ee,targetCenter:M,scaleOfMinZoom:J,pixelPathLength:W}}}class hr{constructor(t,s,f){this.blendFunction=t,this.blendColor=s,this.mask=f}}hr.Replace=[1,0],hr.disabled=new hr(hr.Replace,h.bp.transparent,[!1,!1,!1,!1]),hr.unblended=new hr(hr.Replace,h.bp.transparent,[!0,!0,!0,!0]),hr.alphaBlended=new hr([1,771],h.bp.transparent,[!0,!0,!0,!0]);const Se=2305;class et{constructor(t,s,f){this.enable=t,this.mode=s,this.frontFace=f}}et.disabled=new et(!1,1029,Se),et.backCCW=new et(!0,1029,Se),et.frontCCW=new et(!0,1028,Se);class nt{constructor(t,s,f){this.func=t,this.mask=s,this.range=f}}nt.ReadOnly=!1,nt.ReadWrite=!0,nt.disabled=new nt(519,nt.ReadOnly,[0,1]);const tt=7680;class wt{constructor(t,s,f,x,S,M){this.test=t,this.ref=s,this.mask=f,this.fail=x,this.depthFail=S,this.pass=M}}wt.disabled=new wt({func:519,mask:0},0,0,tt,tt,tt);const Mn=new WeakMap;function qn(A){var t;if(Mn.has(A))return Mn.get(A);{const s=(t=A.getParameter(A.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Mn.set(A,s),s}}class Vi{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const s=t.context,f=s.gl;this._texFormat=f.RGBA,this._texType=f.UNSIGNED_BYTE;const x=new h.aW;x.emplaceBack(-1,-1),x.emplaceBack(2,-1),x.emplaceBack(-1,2);const S=new h.aY;S.emplaceBack(0,1,2),this._fullscreenTriangle=new _r(s.createVertexBuffer(x,Ai.members),s.createIndexBuffer(S),h.aX.simpleSegment(0,0,x.length,S.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(f.TEXTURE1);const M=f.createTexture();f.bindTexture(f.TEXTURE_2D,M),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texImage2D(f.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(M),qn(f)&&(this._pbo=f.createBuffer(),f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.bufferData(f.PIXEL_PACK_BUFFER,4,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,s){const f=this._updateCount;return this._readbackQueue?f>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():f>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,s=t.gl;t.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,s){const f=this._cachedRenderContext.context,x=f.gl;if(this._bindFramebuffer(),f.viewport.set([0,0,this._texWidth,this._texHeight]),f.clear({color:h.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(f,x.TRIANGLES,nt.disabled,wt.disabled,hr.unblended,et.disabled,((S,M)=>({u_input:S,u_output_expected:M}))(t,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&qn(x)){x.bindBuffer(x.PIXEL_PACK_BUFFER,this._pbo),x.readBuffer(x.COLOR_ATTACHMENT0),x.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),x.bindBuffer(x.PIXEL_PACK_BUFFER,null);const S=x.fenceSync(x.SYNC_GPU_COMMANDS_COMPLETE,0);x.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&qn(t)){const s=t.clientWaitSync(this._readbackQueue.sync,0,0);if(s===t.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Vi._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let s=0;return s+=t[0]/256,s+=t[1]/65536,s+=t[2]/16777216,t[3]<127&&(s=-s),s/128}}const It=h.a5/128;function oi(A,t){const s=A.granularity!==void 0?Math.max(A.granularity,1):1,f=s+(A.generateBorders?2:0),x=s+(A.extendToNorthPole||A.generateBorders?1:0)+(A.extendToSouthPole||A.generateBorders?1:0),S=f+1,M=x+1,z=A.generateBorders?-1:0,j=A.generateBorders||A.extendToNorthPole?-1:0,Z=s+(A.generateBorders?1:0),W=s+(A.generateBorders||A.extendToSouthPole?1:0),ee=S*M,J=f*x*6,se=S*M>65536;if(se&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const fe=se||t==="32bit",Ce=new Int16Array(2*ee);let Me=0;for(let $e=j;$e<=W;$e++)for(let ze=z;ze<=Z;ze++){let We=ze/s*h.a5;ze===-1&&(We=-It),ze===s+1&&(We=h.a5+It);let st=$e/s*h.a5;$e===-1&&(st=A.extendToNorthPole?h.br:-It),$e===s+1&&(st=A.extendToSouthPole?h.bs:h.a5+It),Ce[Me++]=We,Ce[Me++]=st}const Ie=fe?new Uint32Array(J):new Uint16Array(J);let Le=0;for(let $e=0;$e<x;$e++)for(let ze=0;ze<f;ze++){const We=ze+1+$e*S,st=ze+($e+1)*S,Ve=ze+1+($e+1)*S;Ie[Le++]=ze+$e*S,Ie[Le++]=st,Ie[Le++]=We,Ie[Le++]=We,Ie[Le++]=st,Ie[Le++]=Ve}return{vertices:Ce.buffer.slice(0),indices:Ie.buffer.slice(0),uses32bitIndices:fe}}const Xi=new h.aV({fill:new h.bt(128,2),line:new h.bt(512,0),tile:new h.bt(128,32),stencil:new h.bt(128,1),circle:3});class pa{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return nr.projectionGlobe}get vertexShaderPreludeCode(){return nr.projectionMercator.vertexSource}get subdivisionGranularity(){return Xi}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Vi(t));const s=h.X(this._errorQueryLatitudeDegrees),f=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,x=this._errorMeasurement.updateErrorLoop(s,f),S=pe();x!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=x,this._errorMeasurementLastChangeTime=S);const M=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bv(M))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,s,f,x,S){const M=(S==="stencil"?Xi.stencil:Xi.tile).getGranularityForZoomLevel(s.z);return this._getMesh(t,{granularity:M,generateBorders:f,extendToNorthPole:s.y===0&&x,extendToSouthPole:s.y===(1<<s.z)-1&&x})}_getMesh(t,s){const f=this._getMeshKey(s);if(f in this._tileMeshCache)return this._tileMeshCache[f];const x=(function(S,M){const z=oi(M,"16bit"),j=h.aW.deserialize({arrayBuffer:z.vertices,length:z.vertices.byteLength/2/2}),Z=h.aY.deserialize({arrayBuffer:z.indices,length:z.indices.byteLength/2/3});return new _r(S.createVertexBuffer(j,Ai.members),S.createIndexBuffer(Z),h.aX.simpleSegment(0,0,j.length,Z.length))})(t,s);return this._tileMeshCache[f]=x,x}recalculate(t){}hasTransition(){const t=pe();let s=!1;return s=s||(t-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const hc=new h.t({type:new h.D(h.u.projection.type)});class ll extends h.E{constructor(t){super(),this._transitionable=new h.x(hc,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.H(0)),this._mercatorProjection=new Yr,this._verticalPerspectiveProjection=new pa}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof h.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,s,f,x,S){return this.currentProjection.getMeshFromTileID(t,s,f,x,S)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function ks(A){const t=Ar(A.worldSize,A.center.lat);return 2*Math.PI*t}function ws(A,t,s,f,x){const S=1/(1<<x),M=t/h.a5*S+f*S,z=h.by((A/h.a5*S+s*S)*Math.PI*2+Math.PI,2*Math.PI),j=2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI,Z=Math.cos(j),W=new Float64Array(3);return W[0]=Math.sin(z)*Z,W[1]=Math.sin(j),W[2]=Math.cos(z)*Z,W}function sr(A){return(function(t,s){const f=Math.cos(s),x=new Float64Array(3);return x[0]=Math.sin(t)*f,x[1]=Math.sin(s),x[2]=Math.cos(t)*f,x})(A.lng*Math.PI/180,A.lat*Math.PI/180)}function Ar(A,t){return A/(2*Math.PI)/Math.cos(t*Math.PI/180)}function ka(A){const t=Math.asin(A[1])/Math.PI*180,s=Math.sqrt(A[0]*A[0]+A[2]*A[2]);if(s>1e-6){const f=A[0]/s,x=Math.acos(A[2]/s),S=(f>0?x:-x)/Math.PI*180;return new h.V(h.W(S,-180,180),t)}return new h.V(0,t)}function br(A){return Math.cos(A*Math.PI/180)}function vr(A,t){const s=br(A),f=br(t);return h.at(f/s)}function Fa(A,t){const s=A.rotate(t.bearingInRadians),f=t.zoom+vr(t.center.lat,0),x=h.bu(1/br(t.center.lat),1/br(Math.min(Math.abs(t.center.lat),60)),h.bx(f,7,3,0,1)),S=360/ks({worldSize:t.worldSize,center:{lat:t.center.lat}});return new h.V(t.center.lng-s.x*S*x,h.an(t.center.lat+s.y*S,-h.ao,h.ao))}function $i(A){const t=.5*A,s=Math.sin(t),f=Math.cos(t);return Math.log(s+f)-Math.log(f-s)}function xi(A,t,s,f){const x=A.lat+s*f;if(Math.abs(s)>1){const S=(Math.sign(A.lat+s)!==Math.sign(A.lat)?-Math.abs(A.lat):Math.abs(A.lat))*Math.PI/180,M=Math.abs(A.lat+s)*Math.PI/180,z=$i(S+f*(M-S)),j=$i(S),Z=$i(M);return new h.V(A.lng+t*((z-j)/(Z-j)),x)}return new h.V(A.lng+t*f,x)}class xu{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,s,f,x){const S=`${t.z}_${t.x}_${t.y}_${x?.terrain?"t":""}`,M=this._cache.get(S);if(M)return M;const z=this._cachePrevious.get(S);if(z)return this._cache.set(S,z),z;const j=this._boundingVolumeFactory(t,s,f,x);return this._cache.set(S,j),this._hadAnyChanges=!0,j}}class Ji{constructor(t,s,f,x){this.min=f,this.max=x,this.points=t,this.planes=s}static fromAabb(t,s){const f=[];for(let x=0;x<8;x++)f.push([1&~x?t[0]:s[0],(x>>1&1)==1?s[1]:t[1],(x>>2&1)==1?s[2]:t[2]]);return new Ji(f,[[-1,0,0,s[0]],[1,0,0,-t[0]],[0,-1,0,s[1]],[0,1,0,-t[1]],[0,0,-1,s[2]],[0,0,1,-t[2]]],t,s)}static fromCenterSizeAngles(t,s,f){const x=h.bB([],f[0],f[1],f[2]),S=h.bC([],[s[0],0,0],x),M=h.bC([],[0,s[1],0],x),z=h.bC([],[0,0,s[2]],x),j=[...t],Z=[...t];for(let ee=0;ee<8;ee++)for(let J=0;J<3;J++){const se=t[J]+S[J]*(1&~ee?-1:1)+M[J]*((ee>>1&1)==1?1:-1)+z[J]*((ee>>2&1)==1?1:-1);j[J]=Math.min(j[J],se),Z[J]=Math.max(Z[J],se)}const W=[];for(let ee=0;ee<8;ee++){const J=[...t];h.b0(J,J,h.a$([],S,1&~ee?-1:1)),h.b0(J,J,h.a$([],M,(ee>>1&1)==1?1:-1)),h.b0(J,J,h.a$([],z,(ee>>2&1)==1?1:-1)),W.push(J)}return new Ji(W,[[...S,-h.b5(S,W[0])],[...M,-h.b5(M,W[0])],[...z,-h.b5(z,W[0])],[-S[0],-S[1],-S[2],-h.b5(S,W[7])],[-M[0],-M[1],-M[2],-h.b5(M,W[7])],[-z[0],-z[1],-z[2],-h.b5(z,W[7])]],j,Z)}intersectsFrustum(t){let s=!0;const f=this.points.length,x=this.planes.length,S=t.planes.length,M=t.points.length;for(let z=0;z<S;z++){const j=t.planes[z];let Z=0;for(let W=0;W<f;W++){const ee=this.points[W];j[0]*ee[0]+j[1]*ee[1]+j[2]*ee[2]+j[3]>=0&&Z++}if(Z===0)return 0;Z<f&&(s=!1)}if(s)return 2;for(let z=0;z<x;z++){const j=this.planes[z];let Z=0;for(let W=0;W<M;W++){const ee=t.points[W];j[0]*ee[0]+j[1]*ee[1]+j[2]*ee[2]+j[3]>=0&&Z++}if(Z===0)return 0}return 1}intersectsPlane(t){const s=this.points.length;let f=0;for(let x=0;x<s;x++){const S=this.points[x];t[0]*S[0]+t[1]*S[1]+t[2]*S[2]+t[3]>=0&&f++}return f===s?2:f===0?0:1}}function ja(A,t,s){const f=A-t;return f<0?-f:Math.max(0,f-s)}function Na(A,t,s,f,x){const S=A-s;let M;return M=S<0?Math.min(-S,1+S-x):S>1?Math.min(Math.max(S-x,0),1-S):0,Math.max(M,ja(t,f,x))}class ih{constructor(){this._boundingVolumeCache=new xu(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,s,f,x){const S=1<<f.z,M=1/S,z=f.x/S,j=f.y/S;let Z=2;return Z=Math.min(Z,Na(t,s,z,j,M)),Z=Math.min(Z,Na(t,s,z+.5,-j-M,M)),Z=Math.min(Z,Na(t,s,z+.5,2-j-M,M)),Z}getWrap(t,s,f){const x=1<<s.z,S=1/x,M=s.x/x,z=ja(t.x,M,S),j=ja(t.x,M-1,S),Z=ja(t.x,M+1,S),W=Math.min(z,j,Z);return W===Z?1:W===j?-1:0}allowVariableZoom(t,s){return Ti(t,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,s,f,x){return this._boundingVolumeCache.getTileBoundingVolume(t,s,f,x)}_computeTileBoundingVolume(t,s,f,x){var S,M;let z=0,j=0;if(x?.terrain){const Z=new h.a2(t.z,s,t.z,t.x,t.y),W=x.terrain.getMinMaxElevation(Z);z=(S=W.minElevation)!==null&&S!==void 0?S:Math.min(0,f),j=(M=W.maxElevation)!==null&&M!==void 0?M:Math.max(0,f)}if(z/=h.bE,j/=h.bE,z+=1,j+=1,t.z<=0)return Ji.fromAabb([-j,-j,-j],[j,j,j]);if(t.z===1)return Ji.fromAabb([t.x===0?-j:0,t.y===0?0:-j,-j],[t.x===0?0:j,t.y===0?j:0,j]);{const Z=[ws(0,0,t.x,t.y,t.z),ws(h.a5,0,t.x,t.y,t.z),ws(h.a5,h.a5,t.x,t.y,t.z),ws(0,h.a5,t.x,t.y,t.z)],W=[];for(const Ot of Z)W.push(h.a$([],Ot,j));if(j!==z)for(const Ot of Z)W.push(h.a$([],Ot,z));t.y===0&&W.push([0,1,0]),t.y===(1<<t.z)-1&&W.push([0,-1,0]);const ee=[1,1,1],J=[-1,-1,-1];for(const Ot of W)for(let zt=0;zt<3;zt++)ee[zt]=Math.min(ee[zt],Ot[zt]),J[zt]=Math.max(J[zt],Ot[zt]);const se=ws(h.a5/2,h.a5/2,t.x,t.y,t.z),fe=h.b4([],[0,1,0],se);h.b3(fe,fe);const Ce=h.b4([],se,fe);h.b3(Ce,Ce);const Me=h.b4([],Z[2],Z[1]);h.b3(Me,Me);const Ie=h.b4([],Z[0],Z[3]);h.b3(Ie,Ie),W.push(h.a$([],se,j)),t.y>=(1<<t.z)/2&&W.push(h.a$([],ws(h.a5/2,0,t.x,t.y,t.z),j)),t.y<(1<<t.z)/2&&W.push(h.a$([],ws(h.a5/2,h.a5,t.x,t.y,t.z),j));const Le=wa(se,W),$e=wa(Ce,W),ze=[-se[0],-se[1],-se[2],Le.max],We=[se[0],se[1],se[2],-Le.min],st=[-Ce[0],-Ce[1],-Ce[2],$e.max],Ve=[Ce[0],Ce[1],Ce[2],-$e.min],pt=[...Me,0],Ft=[...Ie,0],Nt=[];return t.y===0?Nt.push(h.bD(Ft,pt,ze),h.bD(Ft,pt,We)):Nt.push(h.bD(st,pt,ze),h.bD(st,pt,We),h.bD(st,Ft,ze),h.bD(st,Ft,We)),t.y===(1<<t.z)-1?Nt.push(h.bD(Ft,pt,ze),h.bD(Ft,pt,We)):Nt.push(h.bD(Ve,pt,ze),h.bD(Ve,pt,We),h.bD(Ve,Ft,ze),h.bD(Ve,Ft,We)),new Ji(Nt,[ze,We,st,Ve,pt,Ft],ee,J)}}}function wa(A,t){let s=1/0,f=-1/0;for(const x of t){const S=h.b5(A,x);s=Math.min(s,S),f=Math.max(f,S)}return{min:s,max:f}}class cl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s){this._helper.resize(t,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=h.bF(),this._projectionMatrix=h.bj(),this._globeViewProjMatrix32f=h.bi(),this._globeViewProjMatrixNoCorrection=h.bj(),this._globeViewProjMatrixNoCorrectionInverted=h.bj(),this._globeProjMatrixInverted=h.bj(),this._cameraPosition=h.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(s,f)=>{const x=h.an(s.lat,-h.ao,h.ao),S=h.an(+f,this.minZoom+vr(0,x),this.maxZoom);return{center:new h.V(s.lng,x),zoom:S}},this.applyConstrain=(s,f)=>this._helper.applyConstrain(s,f),this._helper=new fa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,f)=>this.defaultConstrain(s,f)},t),this._coveringTilesDetailsProvider=new ih}clone(){const t=new cl;return t.apply(this),t}apply(t,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=h.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:s,applyGlobeMatrix:f}=t,x=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:x,clippingPlane:this._cachedClippingPlane,projectionTransition:f?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const s=this.pitchInRadians,f=this.cameraToCenterDistance/t,x=Math.sin(s)*f,S=Math.cos(s)*f+1,M=1/Math.sqrt(x*x+S*S)*1;let z=-x,j=S;const Z=Math.sqrt(z*z+j*j);z/=Z,j/=Z;const W=[0,z,j];h.bG(W,W,[0,0,0],-this.bearingInRadians),h.bH(W,W,[0,0,0],-1*this.center.lat*Math.PI/180),h.bI(W,W,[0,0,0],this.center.lng*Math.PI/180);const ee=1/h.b7(W);return h.a$(W,W,ee),[...W,-M*ee]}isLocationOccluded(t){return!this.isSurfacePointVisible(sr(t))}transformLightDirection(t){const s=this._helper._center.lng*Math.PI/180,f=this._helper._center.lat*Math.PI/180,x=Math.cos(f),S=[Math.sin(s)*x,Math.sin(f),Math.cos(s)*x],M=[S[2],0,-S[0]],z=[0,0,0];h.b4(z,M,S),h.b3(M,M),h.b3(z,z);const j=[0,0,0];return h.b3(j,[M[0]*t[0]+z[0]*t[1]+S[0]*t[2],M[1]*t[0]+z[1]*t[1]+S[1]*t[2],M[2]*t[0]+z[2]*t[1]+S[2]*t[2]]),j}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,s,f){const x=(function(z,j,Z){const W=1/(1<<Z.z);return new h.a9(z/h.a5*W+Z.x*W,j/h.a5*W+Z.y*W)})(t,s,f.canonical),S=(M=x.y,[h.by(x.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI]);var M;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(t,s,f,x){const S=f.canonical,M=ws(t,s,S.x,S.y,S.z),z=1+(x?x(t,s):0)/h.bE,j=[M[0]*z,M[1]*z,M[2]*z,1];h.aH(j,j,this._globeViewProjMatrixNoCorrection);const Z=this._cachedClippingPlane,W=Z[0]*M[0]+Z[1]*M[1]+Z[2]*M[2]+Z[3]<0;return{point:new h.P(j[0]/j[3],j[1]/j[3]),signedDistanceFromCamera:j[3],isOccluded:W}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Ar(this.worldSize,this.center.lat),s=h.bk(),f=h.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),h.be(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const x=this.centerOffset;s[8]=2*-x.x/this._helper._width,s[9]=2*x.y/this._helper._height,this._projectionMatrix=h.bf(s),this._globeProjMatrixInverted=h.bk(),h.aB(this._globeProjMatrixInverted,s),h.O(s,s,[0,0,-this.cameraToCenterDistance]),h.bg(s,s,this.rollInRadians),h.bh(s,s,-this.pitchInRadians),h.bg(s,s,this.bearingInRadians),h.O(s,s,[0,0,-t]);const S=h.bz();S[0]=t,S[1]=t,S[2]=t,h.bh(f,s,this.center.lat*Math.PI/180),h.bJ(f,f,-this.center.lng*Math.PI/180),h.Q(f,f,S),this._globeViewProjMatrixNoCorrection=f,h.bh(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bJ(s,s,-this.center.lng*Math.PI/180),h.Q(s,s,S),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=h.bk(),h.aB(this._globeViewProjMatrixNoCorrectionInverted,f);const M=h.bz();this._cameraPosition=h.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,h.bG(this._cameraPosition,this._cameraPosition,M,-this.rollInRadians),h.bH(this._cameraPosition,this._cameraPosition,M,this.pitchInRadians),h.bG(this._cameraPosition,this._cameraPosition,M,-this.bearingInRadians),h.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bH(this._cameraPosition,this._cameraPosition,M,-this.center.lat*Math.PI/180),h.bI(this._cameraPosition,this._cameraPosition,M,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const z=h.bf(this._globeViewProjMatrixNoCorrectionInverted);h.Q(z,z,[1,1,-1]),this._cachedFrustum=Ms.fromInvProjectionMatrix(z,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){h.w("calculateFogMatrix is not supported on globe projection.");const s=h.bk();return h.ar(s),s}getVisibleUnwrappedCoordinates(t){return[new h.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const f=sr(t);h.a$(f,f,1+s/h.bE);const x=h.bF();return h.aH(x,[f[0],f[1],f[2],1],this._globeViewProjMatrixNoCorrection),x[2]/x[3]}populateCache(t){}getBounds(){const t=.5*this.width,s=.5*this.height,f=[new h.P(0,0),new h.P(t,0),new h.P(this.width,0),new h.P(this.width,s),new h.P(this.width,this.height),new h.P(t,this.height),new h.P(0,this.height),new h.P(0,s)],x=[];for(const ee of f)x.push(this.unprojectScreenPoint(ee));let S=0,M=0,z=0,j=0;const Z=this.center;for(const ee of x){const J=h.bK(Z.lng,ee.lng),se=h.bK(Z.lat,ee.lat);J<M&&(M=J),J>S&&(S=J),se<j&&(j=se),se>z&&(z=se)}const W=[Z.lng+M,Z.lat+j,Z.lng+S,Z.lat+z];return this.isSurfacePointOnScreen([0,1,0])&&(W[3]=90,W[0]=-180,W[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(W[1]=-90,W[0]=-180,W[2]=180),new Yn(W)}calculateCenterFromCameraLngLatAlt(t,s,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,x)}setLocationAtPoint(t,s){const f=sr(this.unprojectScreenPoint(s)),x=sr(t),S=h.bz();h.bL(S);const M=h.bz();h.bI(M,f,S,-this.center.lng*Math.PI/180),h.bH(M,M,S,this.center.lat*Math.PI/180);const z=x[0]*x[0]+x[2]*x[2],j=M[0]*M[0];if(z<j)return;const Z=Math.sqrt(z-j),W=-Z,ee=h.bM(x[0],x[2],M[0],Z),J=h.bM(x[0],x[2],M[0],W),se=h.bz();h.bI(se,x,S,-ee);const fe=h.bM(se[1],se[2],M[1],M[2]),Ce=h.bz();h.bI(Ce,x,S,-J);const Me=h.bM(Ce[1],Ce[2],M[1],M[2]),Ie=.5*Math.PI,Le=fe>=-Ie&&fe<=Ie,$e=Me>=-Ie&&Me<=Ie;let ze,We;if(Le&&$e){const Ft=this.center.lng*Math.PI/180,Nt=this.center.lat*Math.PI/180;h.bN(ee,Ft)+h.bN(fe,Nt)<h.bN(J,Ft)+h.bN(Me,Nt)?(ze=ee,We=fe):(ze=J,We=Me)}else if(Le)ze=ee,We=fe;else{if(!$e)return;ze=J,We=Me}const st=ze/Math.PI*180,Ve=We/Math.PI*180,pt=this.center.lat;this.setCenter(new h.V(st,h.an(Ve,-90,90))),this.setZoom(this.zoom+vr(pt,this.center.lat))}locationToScreenPoint(t,s){const f=sr(t);if(s){const x=s.getElevationForLngLatZoom(t,this._helper._tileZoom);h.a$(f,f,1+x/h.bE)}return this._projectSurfacePointToScreen(f)}_projectSurfacePointToScreen(t){const s=h.bF();return h.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new h.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,s){if(s){const f=s.pointCoordinate(t);if(f)return f}return h.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,s){var f;return(f=this.screenPointToMercatorCoordinate(t,s))===null||f===void 0?void 0:f.toLngLat()}isPointOnMapSurface(t,s){const f=this._cameraPosition,x=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(f,x)}getRayDirectionFromPixel(t){const s=h.bF();s[0]=t.x/this.width*2-1,s[1]=-1*(t.y/this.height*2-1),s[2]=1,s[3]=1,h.aH(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const f=h.bz();f[0]=s[0]-this._cameraPosition[0],f[1]=s[1]-this._cameraPosition[1],f[2]=s[2]-this._cameraPosition[2];const x=h.bz();return h.b3(x,f),x}isSurfacePointVisible(t){const s=this._cachedClippingPlane;return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const s=h.bF();return h.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(t,s){const f=h.b5(t,s),x=h.bz(),S=h.bz();h.a$(S,s,f),h.b2(x,t,S);const M=1-h.b5(x,x);if(M<0)return null;const z=h.b5(t,t)-1,j=-f+(f<0?1:-1)*Math.sqrt(M),Z=z/j,W=j;return{tMin:Math.min(Z,W),tMax:Math.max(Z,W)}}unprojectScreenPoint(t){const s=this._cameraPosition,f=this.getRayDirectionFromPixel(t),x=this.rayPlanetIntersection(s,f);if(x){const W=h.bz();h.b0(W,s,[f[0]*x.tMin,f[1]*x.tMin,f[2]*x.tMin]);const ee=h.bz();return h.b3(ee,W),ka(ee)}const S=this._cachedClippingPlane,M=S[0]*f[0]+S[1]*f[1]+S[2]*f[2],z=-h.bb(S,s)/M,j=h.bz();if(z>0)h.b0(j,s,[f[0]*z,f[1]*z,f[2]*z]);else{const W=h.bz();h.b0(W,s,[2*f[0],2*f[1],2*f[2]]);const ee=h.bb(this._cachedClippingPlane,W);h.b2(j,W,[this._cachedClippingPlane[0]*ee,this._cachedClippingPlane[1]*ee,this._cachedClippingPlane[2]*ee])}const Z=(function(W){const ee=h.bz();return ee[0]=W[0]*-W[3],ee[1]=W[1]*-W[3],ee[2]=W[2]*-W[3],{center:ee,radius:Math.sqrt(1-W[3]*W[3])}})(S);return ka((function(W,ee,J){const se=h.bz();h.b2(se,J,W);const fe=h.bz();return h.bA(fe,W,se,ee/h.b9(se)),fe})(Z.center,Z.radius,j))}getMatrixForModel(t,s){const f=h.V.convert(t),x=1/h.bE,S=h.bj();return h.bJ(S,S,f.lng/180*Math.PI),h.bh(S,S,-f.lat/180*Math.PI),h.O(S,S,[0,0,1+s/h.bE]),h.bh(S,S,.5*Math.PI),h.Q(S,S,[x,x,x]),S}getProjectionDataForCustomLayer(t=!0){const s=this.getProjectionData({overscaledTileID:new h.a2(0,0,0,0,0),applyGlobeMatrix:t});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(t){}}class Ll{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,f=!0){this._helper.resize(t,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,s){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(s,f)=>this.currentTransform.defaultConstrain(s,f),this.applyConstrain=(s,f)=>this._helper.applyConstrain(s,f),this._helper=new fa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,f)=>this.defaultConstrain(s,f)},t),this._globeness=1,this._mercatorTransform=new Rr,this._verticalPerspectiveTransform=new cl}clone(){const t=new Ll;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const s=this._mercatorTransform.getProjectionData(t),f=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?f.mainMatrix:s.mainMatrix,clippingPlane:f.clippingPlane,tileMercatorCoords:f.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return h.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,s,f){const x=this._mercatorTransform.getPitchedTextCorrection(t,s,f),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,s,f);return h.bu(x,S,this._globeness)}projectTileCoordinates(t,s,f,x){return this.currentTransform.projectTileCoordinates(t,s,f,x)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){return this.currentTransform.lngLatToCameraDepth(t,s)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,s,f,x){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,x)}setLocationAtPoint(t,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,s){return this.currentTransform.locationToScreenPoint(t,s)}screenPointToMercatorCoordinate(t,s){return this.currentTransform.screenPointToMercatorCoordinate(t,s)}screenPointToLocation(t,s){return this.currentTransform.screenPointToLocation(t,s)}isPointOnMapSurface(t,s){return this.currentTransform.isPointOnMapSurface(t,s)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,s){return this.currentTransform.getMatrixForModel(t,s)}getProjectionDataForCustomLayer(t=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return s;const f=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return f.fallbackMatrix=s.mainMatrix,f}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class $r{get useGlobeControls(){return!0}handlePanInertia(t,s){const f=Fa(t,s);return Math.abs(f.lng-s.center.lng)>180&&(f.lng=s.center.lng+179.5*Math.sign(f.lng-s.center.lng)),{easingCenter:f,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,s){const f=t.around,x=s.screenPointToLocation(f);t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta);const S=s.zoom;t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta);const M=s.zoom-S;if(M===0)return;const z=h.bK(s.center.lng,x.lng),j=z/(Math.abs(z/180)+1),Z=h.bK(s.center.lat,x.lat),W=s.getRayDirectionFromPixel(f),ee=s.cameraPosition,J=-1*h.b5(ee,W),se=h.bz();h.b0(se,ee,[W[0]*J,W[1]*J,W[2]*J]);const fe=h.b7(se)-1,Ce=Math.exp(.5*-Math.max(fe-.3,0)),Me=Ar(s.worldSize,s.center.lat)/Math.min(s.width,s.height),Ie=h.bx(Me,.9,.5,1,.25),Le=(1-h.aq(-M))*Math.min(Ce,Ie),$e=s.center.lat,ze=s.zoom,We=new h.V(s.center.lng+j*Le,h.an(s.center.lat+Z*Le,-h.ao,h.ao));s.setLocationAtPoint(x,f);const st=s.center,Ve=h.bx(Math.abs(z),45,85,0,1),pt=h.bx(Me,.75,.35,0,1),Ft=Math.pow(Math.max(Ve,pt),.25),Nt=h.bK(st.lng,We.lng),Ot=h.bK(st.lat,We.lat);s.setCenter(new h.V(st.lng+Nt*Ft,st.lat+Ot*Ft).wrap()),s.setZoom(ze+vr($e,s.center.lat))}handleMapControlsPan(t,s,f){if(!t.panDelta)return;const x=s.center.lat,S=s.zoom;s.setCenter(Fa(t.panDelta,s).wrap()),s.setZoom(S+vr(x,s.center.lat))}cameraForBoxAndBearing(t,s,f,x,S){const M=Ao(t,s,f,x,S),z=s.left/S.width*2-1,j=(S.width-s.right)/S.width*2-1,Z=s.top/S.height*-2+1,W=(S.height-s.bottom)/S.height*-2+1,ee=h.bK(f.getWest(),f.getEast())<0,J=ee?f.getEast():f.getWest(),se=ee?f.getWest():f.getEast(),fe=Math.max(f.getNorth(),f.getSouth()),Ce=Math.min(f.getNorth(),f.getSouth()),Me=J+.5*h.bK(J,se),Ie=fe+.5*h.bK(fe,Ce),Le=S.clone();Le.setCenter(M.center),Le.setBearing(M.bearing),Le.setPitch(0),Le.setRoll(0),Le.setZoom(M.zoom);const $e=Le.modelViewProjectionMatrix,ze=[sr(f.getNorthWest()),sr(f.getNorthEast()),sr(f.getSouthWest()),sr(f.getSouthEast()),sr(new h.V(se,Ie)),sr(new h.V(J,Ie)),sr(new h.V(Me,fe)),sr(new h.V(Me,Ce))],We=sr(M.center);let st=Number.POSITIVE_INFINITY;for(const Ve of ze)z<0&&(st=$r.getLesserNonNegativeNonNull(st,$r.solveVectorScale(Ve,We,$e,"x",z))),j>0&&(st=$r.getLesserNonNegativeNonNull(st,$r.solveVectorScale(Ve,We,$e,"x",j))),Z>0&&(st=$r.getLesserNonNegativeNonNull(st,$r.solveVectorScale(Ve,We,$e,"y",Z))),W<0&&(st=$r.getLesserNonNegativeNonNull(st,$r.solveVectorScale(Ve,We,$e,"y",W)));if(Number.isFinite(st)&&st!==0)return M.zoom=Le.zoom+h.at(st),M;ns()}handleJumpToCenterZoom(t,s){const f=t.center.lat,x=t.applyConstrain(s.center?h.V.convert(s.center):t.center,t.zoom).center;t.setCenter(x.wrap());const S=s.zoom!==void 0?+s.zoom:t.zoom+vr(f,x.lat);t.zoom!==S&&t.setZoom(S)}handleEaseTo(t,s){const f=t.zoom,x=t.center,S=t.padding,M={roll:t.roll,pitch:t.pitch,bearing:t.bearing},z={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},j=s.zoom!==void 0,Z=!t.isPaddingEqual(s.padding);let W=!1;const ee=s.center?h.V.convert(s.center):x,J=t.applyConstrain(ee,f).center;Bs(t,J);const se=t.clone();se.setCenter(J),se.setZoom(j?+s.zoom:f+vr(x.lat,ee.lat)),se.setBearing(s.bearing);const fe=new h.P(h.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));se.setLocationAtPoint(J,fe);const Ce=(s.offset&&s.offsetAsPoint.mag())>0?se.center:J,Me=j?+s.zoom:f+vr(x.lat,Ce.lat),Ie=f+vr(x.lat,0),Le=Me+vr(Ce.lat,0),$e=h.bK(x.lng,Ce.lng),ze=h.bK(x.lat,Ce.lat),We=h.aq(Le-Ie);return W=Me!==f,{easeFunc:st=>{if(h.bo(M,z)||rr({startEulerAngles:M,endEulerAngles:z,tr:t,k:st,useSlerp:M.roll!=z.roll}),Z&&t.interpolatePadding(S,s.padding,st),s.around)h.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(s.around,s.aroundPoint);else{const Ve=Le>Ie?Math.min(2,We):Math.max(.5,We),pt=Math.pow(Ve,1-st),Ft=xi(x,$e,ze,st*pt);t.setCenter(Ft.wrap())}if(W){const Ve=h.G.number(Ie,Le,st)+vr(0,t.center.lat);t.setZoom(Ve)}},isZooming:W,elevationCenter:Ce}}handleFlyTo(t,s){const f=s.zoom!==void 0,x=t.center,S=t.zoom,M=t.padding,z=!t.isPaddingEqual(s.padding),j=t.applyConstrain(h.V.convert(s.center||s.locationAtOffset),S).center,Z=f?+s.zoom:t.zoom+vr(t.center.lat,j.lat),W=t.clone();W.setCenter(j),W.setZoom(Z),W.setBearing(s.bearing);const ee=new h.P(h.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),h.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));W.setLocationAtPoint(j,ee);const J=W.center;Bs(t,J);const se=(function(ze,We,st){const Ve=sr(We),pt=sr(st),Ft=h.b5(Ve,pt),Nt=Math.acos(Ft),Ot=ks(ze);return Nt/(2*Math.PI)*Ot})(t,x,J),fe=S+vr(x.lat,0),Ce=Z+vr(J.lat,0),Me=h.aq(Ce-fe);let Ie;if(typeof s.minZoom=="number"){const ze=+s.minZoom+vr(J.lat,0),We=Math.min(ze,fe,Ce)+vr(0,J.lat),st=t.applyConstrain(J,We).zoom+vr(J.lat,0);Ie=h.aq(st-fe)}const Le=h.bK(x.lng,J.lng),$e=h.bK(x.lat,J.lat);return{easeFunc:(ze,We,st,Ve)=>{const pt=xi(x,Le,$e,st);z&&t.interpolatePadding(M,s.padding,ze);const Ft=ze===1?J:pt;t.setCenter(Ft.wrap());const Nt=fe+h.at(We);t.setZoom(ze===1?Z:Nt+vr(0,Ft.lat))},scaleOfZoom:Me,targetCenter:J,scaleOfMinZoom:Ie,pixelPathLength:se}}static solveVectorScale(t,s,f,x,S){const M=x==="x"?[f[0],f[4],f[8],f[12]]:[f[1],f[5],f[9],f[13]],z=[f[3],f[7],f[11],f[15]],j=t[0]*M[0]+t[1]*M[1]+t[2]*M[2],Z=t[0]*z[0]+t[1]*z[1]+t[2]*z[2],W=s[0]*M[0]+s[1]*M[1]+s[2]*M[2],ee=s[0]*z[0]+s[1]*z[1]+s[2]*z[2];return W+S*Z===j+S*ee||z[3]*(j-W)+M[3]*(ee-Z)+j*ee==W*Z?null:(W+M[3]-S*ee-S*z[3])/(W-j-S*ee+S*Z)}static getLesserNonNegativeNonNull(t,s){return s!==null&&s>=0&&s<t?s:t}}class Bl{constructor(t){this._globe=t,this._mercatorCameraHelper=new Eo,this._verticalPerspectiveCameraHelper=new $r}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,s){return this.currentHelper.handlePanInertia(t,s)}handleMapControlsRollPitchBearingZoom(t,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,s)}handleMapControlsPan(t,s,f){this.currentHelper.handleMapControlsPan(t,s,f)}cameraForBoxAndBearing(t,s,f,x,S){return this.currentHelper.cameraForBoxAndBearing(t,s,f,x,S)}handleJumpToCenterZoom(t,s){this.currentHelper.handleJumpToCenterZoom(t,s)}handleEaseTo(t,s){return this.currentHelper.handleEaseTo(t,s)}handleFlyTo(t,s){return this.currentHelper.handleFlyTo(t,s)}}const Fl=(A,t)=>h.B(A,t&&t.filter((s=>s.identifier!=="source.canvas"))),dc=h.bO();class Da extends h.E{constructor(t,s={}){var f,x;super(),this._rtlPluginLoaded=()=>{for(const M in this.tileManagers){const z=this.tileManagers[M].getSource().type;z!=="vector"&&z!=="geojson"||this.tileManagers[M].reload()}},this.map=t,this.dispatcher=new kn(nn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((M,z)=>this.getGlyphs(M,z))),this.dispatcher.registerMessageHandler("GI",((M,z)=>this.getImages(M,z))),this.dispatcher.registerMessageHandler("GDA",((M,z)=>this.getDashes(M,z))),this.imageManager=new ht,this.imageManager.setEventedParent(this);const S=((f=t._container)===null||f===void 0?void 0:f.lang)||typeof document<"u"&&((x=document.documentElement)===null||x===void 0?void 0:x.lang)||void 0;this.glyphManager=new Ze(t._requestManager,s.localIdeographFontFamily,S),this.lineAtlas=new kt(256,512),this.crossTileSymbolIndex=new Yi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",h.bP()),it().on(Ue,this._rtlPluginLoaded),this.on("data",(M=>{if(M.dataType!=="source"||M.sourceDataType!=="metadata")return;const z=this.tileManagers[M.sourceId];if(!z)return;const j=z.getSource();if(j&&j.vectorLayerIds)for(const Z in this._layers){const W=this._layers[Z];W.source===j.id&&this._validateLayer(W)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new h.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,s){var f,x,S;this._checkLoaded();const M=s===null?(S=(x=(f=this.stylesheet.state)===null||f===void 0?void 0:f[t])===null||x===void 0?void 0:x.default)!==null&&S!==void 0?S:null:s;if(h.bR(M,this._globalState[t]))return this;this._globalState[t]=M,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const s=[];for(const f in t)!h.bR(this._globalState[f],t[f].default)&&(s.push(f),this._globalState[f]=t[f].default);this._applyGlobalStateChanges(s)}_applyGlobalStateChanges(t){if(t.length===0)return;const s=new Set,f={};for(const x of t){f[x]=this._globalState[x];for(const S in this._layers){const M=this._layers[S],z=M.getLayoutAffectingGlobalStateRefs(),j=M.getPaintAffectingGlobalStateRefs(),Z=M.getVisibilityAffectingGlobalStateRefs();if(z.has(x)&&s.add(M.source),j.has(x))for(const{name:W,value:ee}of j.get(x))this._updatePaintProperty(M,W,ee);Z?.has(x)&&(M.recalculateVisibility(),this._updateLayer(M))}}this.dispatcher.broadcast("UGS",f);for(const x in this.tileManagers)s.has(x)&&(this._reloadSource(x),this._changed=!0)}loadURL(t,s={},f){this.fire(new h.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const x=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;h.j(x,this._loadStyleRequest).then((M=>{this._loadStyleRequest=null,this._load(M.data,s,f)})).catch((M=>{this._loadStyleRequest=null,M&&!S.signal.aborted&&this.fire(new h.k(M))}))}loadJSON(t,s={},f){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,f)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(dc,{validate:!1})}_load(t,s,f){var x,S;let M=s.transformStyle?s.transformStyle(f,t):t;if(!s.validate||!Fl(this,h.C(M))){M=Object.assign({},M),this._loaded=!0,this.stylesheet=M;for(const z in M.sources)this.addSource(z,M.sources[z],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new sn(this.stylesheet.light),this._setProjectionInternal(((x=this.stylesheet.projection)===null||x===void 0?void 0:x.type)||"mercator"),this.sky=new ct(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var t,s,f;const x=h.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",x),this._order=x.map((S=>S.id)),this._layers={},this._serializedLayers=null;for(const S of x){const M=h.bT(S,this._globalState);if(M.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=M,h.bU(M)&&this.tileManagers[M.source]){const z=(f=(s=S.paint)===null||s===void 0?void 0:s["raster-fade-duration"])!==null&&f!==void 0?f:M.paint.get("raster-fade-duration");this.tileManagers[M.source].setRasterFadeDuration(z)}}}_loadSprite(t,s=!1,f=void 0){this.imageManager.setLoaded(!1);const x=new AbortController;let S;this._spriteRequest=x,(function(M,z,j,Z){return h._(this,void 0,void 0,(function*(){const W=He(M),ee=j>1?"@2x":"",J={},se={};for(const{id:fe,url:Ce}of W){const Me=z.transformRequest(_t(Ce,ee,".json"),"SpriteJSON");J[fe]=h.j(Me,Z);const Ie=z.transformRequest(_t(Ce,ee,".png"),"SpriteImage");se[fe]=rt.getImage(Ie,Z)}return yield Promise.all([...Object.values(J),...Object.values(se)]),(function(fe,Ce){return h._(this,void 0,void 0,(function*(){const Me={};for(const Ie in fe){Me[Ie]={};const Le=we.getImageCanvasContext((yield Ce[Ie]).data),$e=(yield fe[Ie]).data;for(const ze in $e){const{width:We,height:st,x:Ve,y:pt,sdf:Ft,pixelRatio:Nt,stretchX:Ot,stretchY:zt,content:xn,textFitWidth:_n,textFitHeight:cn}=$e[ze];Me[Ie][ze]={data:null,pixelRatio:Nt,sdf:Ft,stretchX:Ot,stretchY:zt,content:xn,textFitWidth:_n,textFitHeight:cn,spriteData:{width:We,height:st,x:Ve,y:pt,context:Le}}}}return Me}))})(J,se)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((M=>{if(this._spriteRequest=null,M)for(const z in M){this._spritesImagesIds[z]=[];const j=this._spritesImagesIds[z]?this._spritesImagesIds[z].filter((Z=>!(Z in M))):[];for(const Z of j)this.imageManager.removeImage(Z),this._changedImages[Z]=!0;for(const Z in M[z]){const W=z==="default"?Z:`${z}:${Z}`;this._spritesImagesIds[z].push(W),W in this.imageManager.images?this.imageManager.updateImage(W,M[z][Z],!1):this.imageManager.addImage(W,M[z][Z]),s&&(this._changedImages[W]=!0)}}})).catch((M=>{this._spriteRequest=null,S=M,x.signal.aborted||this.fire(new h.k(S))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),f&&f(S)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(t){const s=this.tileManagers[t.source];if(!s)return;const f=t.sourceLayer;if(!f)return;const x=s.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(f)===-1)&&this.fire(new h.k(new Error(`Source layer "${f}" does not exist on source "${x.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const f=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?h.bV(f):f);const x=[];for(const S of t)if(f[S]){const M=s?h.bV(f[S]):f[S];x.push(M)}return x}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const f of s){const x=this._layers[f];x.type!=="custom"&&(t[f]=x.serialize())}return t}hasTransitions(){var t,s,f;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((f=this.projection)===null||f===void 0)&&f.hasTransition())return!0;for(const x in this.tileManagers)if(this.tileManagers[x].hasTransition())return!0;for(const x in this._layers)if(this._layers[x].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(x.length||S.length)&&this._updateWorkerLayers(x,S);for(const M in this._updatedSources){const z=this._updatedSources[M];if(z==="reload")this._reloadSource(M);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const f={};for(const x in this.tileManagers){const S=this.tileManagers[x];f[x]=S.used,S.used=!1}for(const x of this._order){const S=this._layers[x];S.recalculate(t,this._availableImages),!S.isHidden(t.zoom)&&S.source&&(this.tileManagers[S.source].used=!0)}for(const x in f){const S=this.tileManagers[x];!!f[x]!=!!S.used&&S.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,s&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var f;this._checkLoaded();const x=this.serialize();if(t=s.transformStyle?s.transformStyle(x,t):t,((f=s.validate)===null||f===void 0||f)&&Fl(this,h.C(t)))return!1;(t=h.bV(t)).layers=h.bS(t.layers);const S=h.bW(x,t),M=this._getOperationsToPerform(S);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const z of M.operations)z();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],f=[];for(const x of t)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,x.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,x.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,x.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,x.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,x.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,x.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,x.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,x.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,x.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,x.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,x.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,x.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,x.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,x.args)));break;case"setProjection":this.setProjection.apply(this,x.args);break;case"setGlobalState":s.push((()=>this.setGlobalState.apply(this,x.args)));break;case"setTransition":s.push((()=>{}));break;default:f.push(x.command)}return{operations:s,unimplemented:f}}addImage(t,s){if(this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,f={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.C.source,`sources.${t}`,s,null,f))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const x=this.tileManagers[t]=new Ke(t,s,this.dispatcher);x.style=this,x.setEventedParent(this,(()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:t}))),x.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new h.k(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));const s=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],s.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const f=this.tileManagers[t].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(s),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,s,f={}){this._checkLoaded();const x=t.id;if(this.getLayer(x))return void this.fire(new h.k(new Error(`Layer "${x}" already exists on this map.`)));let S;if(t.type==="custom"){if(Fl(this,h.bX(t)))return;S=h.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(x,t.source),t=h.bV(t),t=h.e(t,{source:x})),this._validate(h.C.layer,`layers.${x}`,t,{arrayIndex:-1},f))return;S=h.bT(t,this._globalState),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}const M=s?this._order.indexOf(s):this._order.length;if(s&&M===-1)this.fire(new h.k(new Error(`Cannot add layer "${x}" before non-existing layer "${s}".`)));else{if(this._order.splice(M,0,x),this._layerOrderChanged=!0,this._layers[x]=S,this._removedLayers[x]&&S.source&&S.type!=="custom"){const z=this._removedLayers[x];delete this._removedLayers[x],z.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.tileManagers[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const f=this._order.indexOf(t);this._order.splice(f,1);const x=s?this._order.indexOf(s):this._order.length;s&&x===-1?this.fire(new h.k(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(x,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,f){this._checkLoaded();const x=this.getLayer(t);x?x.minzoom===s&&x.maxzoom===f||(s!=null&&(x.minzoom=s),f!=null&&(x.maxzoom=f),this._updateLayer(x)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,f={}){this._checkLoaded();const x=this.getLayer(t);if(x){if(!h.bR(x.filter,s))return s==null?(x.setFilter(void 0),void this._updateLayer(x)):void(this._validate(h.C.filter,`layers.${x.id}.filter`,s,null,f)||(x.setFilter(h.bV(s)),this._updateLayer(x)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.bV(this.getLayer(t).filter)}setLayoutProperty(t,s,f,x={}){this._checkLoaded();const S=this.getLayer(t);S?h.bR(S.getLayoutProperty(s),f)||(S.setLayoutProperty(s,f,x),this._updateLayer(S)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const f=this.getLayer(t);if(f)return f.getLayoutProperty(s);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,f,x={}){this._checkLoaded();const S=this.getLayer(t);S?h.bR(S.getPaintProperty(s),f)||this._updatePaintProperty(S,s,f,x):this.fire(new h.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,s,f,x={}){t.setPaintProperty(s,f,x)&&this._updateLayer(t),h.bU(t)&&s==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(f),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const f=t.source,x=t.sourceLayer,S=this.tileManagers[f];if(S===void 0)return void this.fire(new h.k(new Error(`The source '${f}' does not exist in the map's style.`)));const M=S.getSource().type;M==="geojson"&&x?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||x?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(x,t.id,s)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const f=t.source,x=this.tileManagers[f];if(x===void 0)return void this.fire(new h.k(new Error(`The source '${f}' does not exist in the map's style.`)));const S=x.getSource().type,M=S==="vector"?t.sourceLayer:void 0;S!=="vector"||M?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(M,t.id,s):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,f=t.sourceLayer,x=this.tileManagers[s];if(x!==void 0)return x.getSource().type!=="vector"||f?(t.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),x.getFeatureState(f,t.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.bY(this.tileManagers,(S=>S.serialize())),s=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,x=this.stylesheet;return h.bZ({version:x.version,name:x.name,metadata:x.metadata,light:x.light,sky:x.sky,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,projection:x.projection,sources:t,layers:s,terrain:f},(S=>S!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=M=>this._layers[M].type==="fill-extrusion",f={},x=[];for(let M=this._order.length-1;M>=0;M--){const z=this._order[M];if(s(z)){f[z]=M;for(const j of t){const Z=j[z];if(Z)for(const W of Z)x.push(W)}}}x.sort(((M,z)=>z.intersectionZ-M.intersectionZ));const S=[];for(let M=this._order.length-1;M>=0;M--){const z=this._order[M];if(s(z))for(let j=x.length-1;j>=0;j--){const Z=x[j].feature;if(f[Z.layer.id]<M)break;S.push(Z),x.pop()}else for(const j of t){const Z=j[z];if(Z)for(const W of Z)S.push(W.feature)}}return S}queryRenderedFeatures(t,s,f){s&&s.filter&&this._validate(h.C.filter,"queryRenderedFeatures.filter",s.filter,null,s);const x={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const Z of s.layers){const W=this._layers[Z];if(!W)return this.fire(new h.k(new Error(`The layer '${Z}' does not exist in the map's style and cannot be queried for features.`))),[];x[W.source]=!0}}const S=[];s.availableImages=this._availableImages;const M=this._serializedAllLayers(),z=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,j=Object.assign(Object.assign({},s),{layers:z,globalState:this._globalState});for(const Z in this.tileManagers)s.layers&&!x[Z]||S.push(En(this.tileManagers[Z],this._layers,M,t,j,f,this.map.terrain?(W,ee,J)=>this.map.terrain.getElevation(W,ee,J):void 0));return this.placement&&S.push((function(Z,W,ee,J,se,fe,Ce){const Me={},Ie=fe.queryRenderedSymbols(J),Le=[];for(const $e of Object.keys(Ie).map(Number))Le.push(Ce[$e]);Le.sort(si);for(const $e of Le){const ze=$e.featureIndex.lookupSymbolFeatures(Ie[$e.bucketInstanceId],W,$e.bucketIndex,$e.sourceLayerIndex,{filterSpec:se.filter,globalState:se.globalState},se.layers,se.availableImages,Z);for(const We in ze){const st=Me[We]=Me[We]||[],Ve=ze[We];Ve.sort(((pt,Ft)=>{const Nt=$e.featureSortOrder;if(Nt){const Ot=Nt.indexOf(pt.featureIndex);return Nt.indexOf(Ft.featureIndex)-Ot}return Ft.featureIndex-pt.featureIndex}));for(const pt of Ve)st.push(pt)}}return(function($e,ze,We){for(const st in $e)for(const Ve of $e[st])wi(Ve,We[ze[st].source]);return $e})(Me,Z,ee)})(this._layers,M,this.tileManagers,t,j,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(t,s){s?.filter&&this._validate(h.C.filter,"querySourceFeatures.filter",s.filter,null,s);const f=this.tileManagers[t];return f?(function(x,S){const M=x.getRenderableIds().map((Z=>x.getTileByID(Z))),z=[],j={};for(let Z=0;Z<M.length;Z++){const W=M[Z],ee=W.tileID.canonical.key;j[ee]||(j[ee]=!0,W.querySourceFeatures(z,S))}return z})(f,s?Object.assign(Object.assign({},s),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const f=this.light.getLight();let x=!1;for(const M in t)if(!h.bR(t[M],f[M])){x=!0;break}if(!x)return;const S={now:pe(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(S)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){this._checkLoaded();const f=this.getSky();let x=!1;if(!t&&!f)return;if(t&&!f)x=!0;else if(!t&&f)x=!0;else for(const M in t)if(!h.bR(t[M],f[M])){x=!0;break}if(!x)return;const S={now:pe(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(S)}_setProjectionInternal(t){const s=(function(f,x){const S={constrainOverride:x};if(Array.isArray(f)){const M=new ll({type:f});return{projection:M,transform:new Ll(S),cameraHelper:new Bl(M)}}switch(f){case"mercator":return{projection:new Yr,transform:new Rr(S),cameraHelper:new Eo};case"globe":{const M=new ll({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:M,transform:new Ll(S),cameraHelper:new Bl(M)}}case"vertical-perspective":return{projection:new pa,transform:new cl(S),cameraHelper:new $r};default:return h.w(`Unknown projection name: ${f}. Falling back to mercator projection.`),{projection:new Yr,transform:new Rr(S),cameraHelper:new Eo}}})(t,this.map.transformConstrain);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const f in this.tileManagers)this.tileManagers[f].reload()}_validate(t,s,f,x,S={}){return(!S||S.validate!==!1)&&Fl(this,t.call(h.C,h.e({key:s,style:this.serialize(),value:f,styleSpec:h.u},x)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),it().off(Ue,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.tileManagers){const f=this.tileManagers[s];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const s in this.tileManagers)this.tileManagers[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,s,f,x,S=!1){let M=!1,z=!1;const j={};for(const Z of this._order){const W=this._layers[Z];if(W.type!=="symbol")continue;if(!j[W.source]){const J=this.tileManagers[W.source];j[W.source]=J.getRenderableIds(!0).map((se=>J.getTileByID(se))).sort(((se,fe)=>fe.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(fe.tileID)?-1:1)))}const ee=this.crossTileSymbolIndex.addLayer(W,j[W.source],t.center.lng);M=M||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(pe(),t.zoom))&&(this.pauseablePlacement=new al(t,this.map.terrain,this._order,S,s,f,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(pe()),z=!0),M&&this.pauseablePlacement.placement.setStale()),z||M)for(const Z of this._order){const W=this._layers[Z];W.type==="symbol"&&this.placement.updateLayerOpacities(W,j[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(pe())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,s){return h._(this,void 0,void 0,(function*(){const f=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const x=this.tileManagers[s.source];return x&&x.setDependencies(s.tileID.key,s.type,s.icons),f}))}getGlyphs(t,s){return h._(this,void 0,void 0,(function*(){const f=yield this.glyphManager.getGlyphs(s.stacks),x=this.tileManagers[s.source];return x&&x.setDependencies(s.tileID.key,s.type,[""]),f}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(h.C.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,s){return h._(this,void 0,void 0,(function*(){const f={};for(const[x,S]of Object.entries(s.dashes))f[x]=this.lineAtlas.getDash(S.dasharray,S.round);return f}))}addSprite(t,s,f={},x){this._checkLoaded();const S=[{id:t,url:s}],M=[...He(this.stylesheet.sprite),...S];this._validate(h.C.sprite,"sprite",M,null,f)||(this.stylesheet.sprite=M,this._loadSprite(S,!0,x))}removeSprite(t){this._checkLoaded();const s=He(this.stylesheet.sprite);if(s.find((f=>f.id===t))){if(this._spritesImagesIds[t])for(const f of this._spritesImagesIds[t])this.imageManager.removeImage(f),this._changedImages[f]=!0;s.splice(s.findIndex((f=>f.id===t)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return He(this.stylesheet.sprite)}setSprite(t,s={},f){this._checkLoaded(),t&&this._validate(h.C.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,f):(this._unloadSprite(),f&&f(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const s=this.tileManagers[t];s.setEventedParent(null),s.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const s=this._layers[t];s.setEventedParent(null),s.onRemove&&s.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var _u=h.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Lc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,f,x,S,M,z,j,Z){this.context=t;let W=this.boundPaintVertexBuffers.length!==x.length;for(let ee=0;!W&&ee<x.length;ee++)this.boundPaintVertexBuffers[ee]!==x[ee]&&(W=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==f||W||this.boundIndexBuffer!==S||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==j||this.boundDynamicVertexBuffer3!==Z?this.freshBind(s,f,x,S,M,z,j,Z):(t.bindVertexArray.set(this.vao),z&&z.bind(),S&&S.dynamicDraw&&S.bind(),j&&j.bind(),Z&&Z.bind())}freshBind(t,s,f,x,S,M,z,j){const Z=t.numAttributes,W=this.context,ee=W.gl;this.vao&&this.destroy(),this.vao=W.createVertexArray(),W.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=j,s.enableAttributes(ee,t);for(const J of f)J.enableAttributes(ee,t);M&&M.enableAttributes(ee,t),z&&z.enableAttributes(ee,t),j&&j.enableAttributes(ee,t),s.bind(),s.setVertexAttribPointers(ee,t,S);for(const J of f)J.bind(),J.setVertexAttribPointers(ee,t,S);M&&(M.bind(),M.setVertexAttribPointers(ee,t,S)),x&&x.bind(),z&&(z.bind(),z.setVertexAttribPointers(ee,t,S)),j&&(j.bind(),j.setVertexAttribPointers(ee,t,S)),W.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const fc=(A,t,s,f,x)=>({u_texture:0,u_ele_delta:A,u_fog_matrix:t,u_fog_color:s?s.properties.get("fog-color"):h.bp.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:x?0:s?s.calculateFogBlendOpacity(f):0,u_horizon_color:s?s.properties.get("horizon-color"):h.bp.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:x?1:0}),no={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function io(A){const t=[];for(let s=0;s<A.length;s++){if(A[s]===null)continue;const f=A[s].split(" ");t.push(f.pop())}return t}class Bc{constructor(t,s,f,x,S,M,z,j,Z=[]){const W=t.gl;this.program=W.createProgram();const ee=io(s.staticAttributes),J=f?f.getBinderAttributes():[],se=ee.concat(J),fe=nr.prelude.staticUniforms?io(nr.prelude.staticUniforms):[],Ce=z.staticUniforms?io(z.staticUniforms):[],Me=s.staticUniforms?io(s.staticUniforms):[],Ie=f?f.getBinderUniforms():[],Le=fe.concat(Ce).concat(Me).concat(Ie),$e=[];for(const Nt of Le)$e.indexOf(Nt)<0&&$e.push(Nt);const ze=f?f.defines():[];qn(W)&&ze.unshift("#version 300 es"),S&&ze.push("#define OVERDRAW_INSPECTOR;"),M&&ze.push("#define TERRAIN3D;"),j&&ze.push(j),Z&&ze.push(...Z);let We=ze.concat(nr.prelude.fragmentSource,z.fragmentSource,s.fragmentSource).join(`
`),st=ze.concat(nr.prelude.vertexSource,z.vertexSource,s.vertexSource).join(`
`);qn(W)||(We=(function(Nt){return Nt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(We),st=(function(Nt){return Nt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(st));const Ve=W.createShader(W.FRAGMENT_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(Ve,We),W.compileShader(Ve),!W.getShaderParameter(Ve,W.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${W.getShaderInfoLog(Ve)}`);W.attachShader(this.program,Ve);const pt=W.createShader(W.VERTEX_SHADER);if(W.isContextLost())return void(this.failedToCreate=!0);if(W.shaderSource(pt,st),W.compileShader(pt),!W.getShaderParameter(pt,W.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${W.getShaderInfoLog(pt)}`);W.attachShader(this.program,pt),this.attributes={};const Ft={};this.numAttributes=se.length;for(let Nt=0;Nt<this.numAttributes;Nt++)se[Nt]&&(W.bindAttribLocation(this.program,Nt,se[Nt]),this.attributes[se[Nt]]=Nt);if(W.linkProgram(this.program),!W.getProgramParameter(this.program,W.LINK_STATUS))throw new Error(`Program failed to link: ${W.getProgramInfoLog(this.program)}`);W.deleteShader(pt),W.deleteShader(Ve);for(let Nt=0;Nt<$e.length;Nt++){const Ot=$e[Nt];if(Ot&&!Ft[Ot]){const zt=W.getUniformLocation(this.program,Ot);zt&&(Ft[Ot]=zt)}}this.fixedUniforms=x(t,Ft),this.terrainUniforms=((Nt,Ot)=>({u_depth:new h.b_(Nt,Ot.u_depth),u_terrain:new h.b_(Nt,Ot.u_terrain),u_terrain_dim:new h.bq(Nt,Ot.u_terrain_dim),u_terrain_matrix:new h.c0(Nt,Ot.u_terrain_matrix),u_terrain_unpack:new h.c1(Nt,Ot.u_terrain_unpack),u_terrain_exaggeration:new h.bq(Nt,Ot.u_terrain_exaggeration)}))(t,Ft),this.projectionUniforms=((Nt,Ot)=>({u_projection_matrix:new h.c0(Nt,Ot.u_projection_matrix),u_projection_tile_mercator_coords:new h.c1(Nt,Ot.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.c1(Nt,Ot.u_projection_clipping_plane),u_projection_transition:new h.bq(Nt,Ot.u_projection_transition),u_projection_fallback_matrix:new h.c0(Nt,Ot.u_projection_fallback_matrix)}))(t,Ft),this.binderUniforms=f?f.getUniforms(t,Ft):[]}draw(t,s,f,x,S,M,z,j,Z,W,ee,J,se,fe,Ce,Me,Ie,Le,$e){const ze=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(f),t.setStencilMode(x),t.setColorMode(S),t.setCullFace(M),j){t.activeTexture.set(ze.TEXTURE2),ze.bindTexture(ze.TEXTURE_2D,j.depthTexture),t.activeTexture.set(ze.TEXTURE3),ze.bindTexture(ze.TEXTURE_2D,j.texture);for(const st in this.terrainUniforms)this.terrainUniforms[st].set(j[st])}if(Z)for(const st in Z)this.projectionUniforms[no[st]].set(Z[st]);if(z)for(const st in this.fixedUniforms)this.fixedUniforms[st].set(z[st]);Me&&Me.setUniforms(t,this.binderUniforms,fe,{zoom:Ce});let We=0;switch(s){case ze.LINES:We=2;break;case ze.TRIANGLES:We=3;break;case ze.LINE_STRIP:We=1}for(const st of se.get()){const Ve=st.vaos||(st.vaos={});(Ve[W]||(Ve[W]=new Lc)).bind(t,this,ee,Me?Me.getPaintVertexBuffers():[],J,st.vertexOffset,Ie,Le,$e),ze.drawElements(s,st.primitiveLength*We,ze.UNSIGNED_SHORT,st.primitiveOffset*We*2)}}}function Ra(A,t,s){const f=1/h.aN(s,1,t.transform.tileZoom),x=Math.pow(2,s.tileID.overscaledZ),S=s.tileSize*Math.pow(2,t.transform.tileZoom)/x,M=S*(s.tileID.canonical.x+s.tileID.wrap*x),z=S*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[f,A.fromScale,A.toScale],u_fade:A.t,u_pixel_coord_upper:[M>>16,z>>16],u_pixel_coord_lower:[65535&M,65535&z]}}const Fc=(A,t,s,f)=>{const x=A.style.light,S=x.properties.get("position"),M=[S.x,S.y,S.z],z=h.c4();x.properties.get("anchor")==="viewport"&&h.c5(z,A.transform.bearingInRadians),h.c6(M,M,z);const j=A.transform.transformLightDirection(M),Z=x.properties.get("color");return{u_lightpos:M,u_lightpos_globe:j,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+t,u_opacity:s,u_fill_translate:f}},Pa=(A,t,s,f,x,S,M)=>h.e(Fc(A,t,s,f),Ra(S,A,M),{u_height_factor:-Math.pow(2,x.overscaledZ)/M.tileSize/8}),jl=(A,t,s,f)=>h.e(Ra(t,A,s),{u_fill_translate:f}),ul=(A,t)=>({u_world:A,u_fill_translate:t}),Zh=(A,t,s,f,x)=>h.e(jl(A,t,s,x),{u_world:f}),pc=(A,t,s,f,x)=>{const S=A.transform;let M,z,j=0;if(s.paint.get("circle-pitch-alignment")==="map"){const Z=h.aN(t,1,S.zoom);M=!0,z=[Z,Z],j=Z/(h.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*x}else M=!1,z=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+M,u_device_pixel_ratio:A.pixelRatio,u_extrude_scale:z,u_globe_extrude_scale:j,u_translate:f}},Xs=A=>({u_pixel_extrude_scale:[1/A.width,1/A.height]}),rh=A=>({u_viewport_size:[A.width,A.height]}),Ul=(A,t=1)=>({u_color:A,u_overlay:0,u_overlay_scale:t}),Ua=(A,t,s,f)=>{const x=h.aN(A,1,t)/(h.a5*Math.pow(2,A.tileID.overscaledZ))*2*Math.PI*f;return{u_extrude_scale:h.aN(A,1,t),u_intensity:s,u_globe_extrude_scale:x}},ar=(A,t,s,f)=>{const x=h.N();h.c7(x,0,A.width,A.height,0,0,1);const S=A.context.gl;return{u_matrix:x,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:s,u_color_ramp:f,u_opacity:t.paint.get("heatmap-opacity")}},hl=(A,t,s)=>{const f=s.paint.get("hillshade-accent-color");let x;switch(s.paint.get("hillshade-method")){case"basic":x=4;break;case"combined":x=1;break;case"igor":x=2;break;case"multidirectional":x=3;break;default:x=0}const S=s.getIlluminationProperties();for(let M=0;M<S.directionRadians.length;M++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(S.directionRadians[M]+=A.transform.bearingInRadians);return{u_image:0,u_latrange:a(0,t.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:S.altitudeRadians,u_azimuths:S.directionRadians,u_accent:f,u_method:x,u_highlights:S.highlightColor,u_shadows:S.shadowColor}},ce=(A,t)=>{const s=t.stride,f=h.N();return h.c7(f,0,h.a5,-h.a5,0,0,1),h.O(f,f,[0,-h.a5,0]),{u_matrix:f,u_image:1,u_dimension:[s,s],u_zoom:A.overscaledZ,u_unpack:t.getUnpackVector()}};function a(A,t){const s=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new h.a9(0,f/s).toLngLat().lat,new h.a9(0,(f+1)/s).toLngLat().lat]}const u=(A,t,s=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:A.paint.get("color-relief-opacity")}),g=(A,t,s,f)=>{const x=A.transform;return{u_translation:q(A,t,s),u_ratio:f/h.aN(t,1,x.zoom),u_device_pixel_ratio:A.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},v=(A,t,s,f,x)=>h.e(g(A,t,s,f),{u_image:0,u_image_height:x}),w=(A,t,s,f,x)=>{const S=A.transform,M=F(t,S);return{u_translation:q(A,t,s),u_texsize:t.imageAtlasTexture.size,u_ratio:f/h.aN(t,1,S.zoom),u_device_pixel_ratio:A.pixelRatio,u_image:0,u_scale:[M,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},I=(A,t,s,f,x)=>{const S=F(t,A.transform);return h.e(g(A,t,s,f),{u_tileratio:S,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image:0,u_mix:x.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})},O=(A,t,s,f,x,S)=>{const M=F(t,A.transform);return h.e(g(A,t,s,f),{u_image:0,u_image_height:S,u_tileratio:M,u_crossfade_from:x.fromScale,u_crossfade_to:x.toScale,u_image_dash:1,u_mix:x.t,u_lineatlas_width:A.lineAtlas.width,u_lineatlas_height:A.lineAtlas.height})};function F(A,t){return 1/h.aN(A,1,t.tileZoom)}function q(A,t,s){return h.aO(A.transform,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const te=(A,t,s,f,x)=>{return{u_tl_parent:A,u_scale_parent:t,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(M=f.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(S=f.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ue(f.paint.get("raster-hue-rotate")),u_coords_top:[x[0].x,x[0].y,x[1].x,x[1].y],u_coords_bottom:[x[3].x,x[3].y,x[2].x,x[2].y]};var S,M};function ue(A){A*=Math.PI/180;const t=Math.sin(A),s=Math.cos(A);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const xe=(A,t,s,f,x,S,M,z,j,Z,W,ee,J)=>{const se=M.transform;return{u_is_size_zoom_constant:+(A==="constant"||A==="source"),u_is_size_feature_constant:+(A==="constant"||A==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_pitch:se.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:se.width/se.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_label_plane_matrix:z,u_coord_matrix:j,u_is_text:+W,u_pitch_with_map:+f,u_is_along_line:x,u_is_variable_anchor:S,u_texsize:ee,u_texture:0,u_translation:Z,u_pitched_scale:J}},Oe=(A,t,s,f,x,S,M,z,j,Z,W,ee,J,se)=>{const fe=M.transform;return h.e(xe(A,t,s,f,x,S,M,z,j,Z,W,ee,se),{u_gamma_scale:f?Math.cos(fe.pitch*Math.PI/180)*fe.cameraToCenterDistance:1,u_device_pixel_ratio:M.pixelRatio,u_is_halo:1})},ot=(A,t,s,f,x,S,M,z,j,Z,W,ee,J)=>h.e(Oe(A,t,s,f,x,S,M,z,j,Z,!0,W,0,J),{u_texsize_icon:ee,u_texture_icon:1}),ft=(A,t)=>({u_opacity:A,u_color:t}),Rt=(A,t,s,f,x)=>h.e((function(S,M,z,j){const Z=z.imageManager.getPattern(S.from.toString()),W=z.imageManager.getPattern(S.to.toString()),{width:ee,height:J}=z.imageManager.getPixelSize(),se=Math.pow(2,j.tileID.overscaledZ),fe=j.tileSize*Math.pow(2,z.transform.tileZoom)/se,Ce=fe*(j.tileID.canonical.x+j.tileID.wrap*se),Me=fe*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Z.tl,u_pattern_br_a:Z.br,u_pattern_tl_b:W.tl,u_pattern_br_b:W.br,u_texsize:[ee,J],u_mix:M.t,u_pattern_size_a:Z.displaySize,u_pattern_size_b:W.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/h.aN(j,1,z.transform.tileZoom),u_pixel_coord_upper:[Ce>>16,Me>>16],u_pixel_coord_lower:[65535&Ce,65535&Me]}})(s,x,t,f),{u_opacity:A}),Ht=(A,t)=>{},An={fillExtrusion:(A,t)=>({u_lightpos:new h.c2(A,t.u_lightpos),u_lightpos_globe:new h.c2(A,t.u_lightpos_globe),u_lightintensity:new h.bq(A,t.u_lightintensity),u_lightcolor:new h.c2(A,t.u_lightcolor),u_vertical_gradient:new h.bq(A,t.u_vertical_gradient),u_opacity:new h.bq(A,t.u_opacity),u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillExtrusionPattern:(A,t)=>({u_lightpos:new h.c2(A,t.u_lightpos),u_lightpos_globe:new h.c2(A,t.u_lightpos_globe),u_lightintensity:new h.bq(A,t.u_lightintensity),u_lightcolor:new h.c2(A,t.u_lightcolor),u_vertical_gradient:new h.bq(A,t.u_vertical_gradient),u_height_factor:new h.bq(A,t.u_height_factor),u_opacity:new h.bq(A,t.u_opacity),u_fill_translate:new h.c3(A,t.u_fill_translate),u_image:new h.b_(A,t.u_image),u_texsize:new h.c3(A,t.u_texsize),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade)}),fill:(A,t)=>({u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillPattern:(A,t)=>({u_image:new h.b_(A,t.u_image),u_texsize:new h.c3(A,t.u_texsize),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade),u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillOutline:(A,t)=>({u_world:new h.c3(A,t.u_world),u_fill_translate:new h.c3(A,t.u_fill_translate)}),fillOutlinePattern:(A,t)=>({u_world:new h.c3(A,t.u_world),u_image:new h.b_(A,t.u_image),u_texsize:new h.c3(A,t.u_texsize),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade),u_fill_translate:new h.c3(A,t.u_fill_translate)}),circle:(A,t)=>({u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_scale_with_map:new h.b_(A,t.u_scale_with_map),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_extrude_scale:new h.c3(A,t.u_extrude_scale),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_globe_extrude_scale:new h.bq(A,t.u_globe_extrude_scale),u_translate:new h.c3(A,t.u_translate)}),collisionBox:(A,t)=>({u_pixel_extrude_scale:new h.c3(A,t.u_pixel_extrude_scale)}),collisionCircle:(A,t)=>({u_viewport_size:new h.c3(A,t.u_viewport_size)}),debug:(A,t)=>({u_color:new h.b$(A,t.u_color),u_overlay:new h.b_(A,t.u_overlay),u_overlay_scale:new h.bq(A,t.u_overlay_scale)}),depth:Ht,clippingMask:Ht,heatmap:(A,t)=>({u_extrude_scale:new h.bq(A,t.u_extrude_scale),u_intensity:new h.bq(A,t.u_intensity),u_globe_extrude_scale:new h.bq(A,t.u_globe_extrude_scale)}),heatmapTexture:(A,t)=>({u_matrix:new h.c0(A,t.u_matrix),u_world:new h.c3(A,t.u_world),u_image:new h.b_(A,t.u_image),u_color_ramp:new h.b_(A,t.u_color_ramp),u_opacity:new h.bq(A,t.u_opacity)}),hillshade:(A,t)=>({u_image:new h.b_(A,t.u_image),u_latrange:new h.c3(A,t.u_latrange),u_exaggeration:new h.bq(A,t.u_exaggeration),u_altitudes:new h.c9(A,t.u_altitudes),u_azimuths:new h.c9(A,t.u_azimuths),u_accent:new h.b$(A,t.u_accent),u_method:new h.b_(A,t.u_method),u_shadows:new h.c8(A,t.u_shadows),u_highlights:new h.c8(A,t.u_highlights)}),hillshadePrepare:(A,t)=>({u_matrix:new h.c0(A,t.u_matrix),u_image:new h.b_(A,t.u_image),u_dimension:new h.c3(A,t.u_dimension),u_zoom:new h.bq(A,t.u_zoom),u_unpack:new h.c1(A,t.u_unpack)}),colorRelief:(A,t)=>({u_image:new h.b_(A,t.u_image),u_unpack:new h.c1(A,t.u_unpack),u_dimension:new h.c3(A,t.u_dimension),u_elevation_stops:new h.b_(A,t.u_elevation_stops),u_color_stops:new h.b_(A,t.u_color_stops),u_color_ramp_size:new h.b_(A,t.u_color_ramp_size),u_opacity:new h.bq(A,t.u_opacity)}),line:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels)}),lineGradient:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_image:new h.b_(A,t.u_image),u_image_height:new h.bq(A,t.u_image_height)}),linePattern:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_texsize:new h.c3(A,t.u_texsize),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_image:new h.b_(A,t.u_image),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_scale:new h.c2(A,t.u_scale),u_fade:new h.bq(A,t.u_fade)}),lineSDF:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_image:new h.b_(A,t.u_image),u_mix:new h.bq(A,t.u_mix),u_tileratio:new h.bq(A,t.u_tileratio),u_crossfade_from:new h.bq(A,t.u_crossfade_from),u_crossfade_to:new h.bq(A,t.u_crossfade_to),u_lineatlas_width:new h.bq(A,t.u_lineatlas_width),u_lineatlas_height:new h.bq(A,t.u_lineatlas_height)}),lineGradientSDF:(A,t)=>({u_translation:new h.c3(A,t.u_translation),u_ratio:new h.bq(A,t.u_ratio),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_units_to_pixels:new h.c3(A,t.u_units_to_pixels),u_image:new h.b_(A,t.u_image),u_image_height:new h.bq(A,t.u_image_height),u_tileratio:new h.bq(A,t.u_tileratio),u_crossfade_from:new h.bq(A,t.u_crossfade_from),u_crossfade_to:new h.bq(A,t.u_crossfade_to),u_image_dash:new h.b_(A,t.u_image_dash),u_mix:new h.bq(A,t.u_mix),u_lineatlas_width:new h.bq(A,t.u_lineatlas_width),u_lineatlas_height:new h.bq(A,t.u_lineatlas_height)}),raster:(A,t)=>({u_tl_parent:new h.c3(A,t.u_tl_parent),u_scale_parent:new h.bq(A,t.u_scale_parent),u_buffer_scale:new h.bq(A,t.u_buffer_scale),u_fade_t:new h.bq(A,t.u_fade_t),u_opacity:new h.bq(A,t.u_opacity),u_image0:new h.b_(A,t.u_image0),u_image1:new h.b_(A,t.u_image1),u_brightness_low:new h.bq(A,t.u_brightness_low),u_brightness_high:new h.bq(A,t.u_brightness_high),u_saturation_factor:new h.bq(A,t.u_saturation_factor),u_contrast_factor:new h.bq(A,t.u_contrast_factor),u_spin_weights:new h.c2(A,t.u_spin_weights),u_coords_top:new h.c1(A,t.u_coords_top),u_coords_bottom:new h.c1(A,t.u_coords_bottom)}),symbolIcon:(A,t)=>({u_is_size_zoom_constant:new h.b_(A,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(A,t.u_is_size_feature_constant),u_size_t:new h.bq(A,t.u_size_t),u_size:new h.bq(A,t.u_size),u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_pitch:new h.bq(A,t.u_pitch),u_rotate_symbol:new h.b_(A,t.u_rotate_symbol),u_aspect_ratio:new h.bq(A,t.u_aspect_ratio),u_fade_change:new h.bq(A,t.u_fade_change),u_label_plane_matrix:new h.c0(A,t.u_label_plane_matrix),u_coord_matrix:new h.c0(A,t.u_coord_matrix),u_is_text:new h.b_(A,t.u_is_text),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_is_along_line:new h.b_(A,t.u_is_along_line),u_is_variable_anchor:new h.b_(A,t.u_is_variable_anchor),u_texsize:new h.c3(A,t.u_texsize),u_texture:new h.b_(A,t.u_texture),u_translation:new h.c3(A,t.u_translation),u_pitched_scale:new h.bq(A,t.u_pitched_scale)}),symbolSDF:(A,t)=>({u_is_size_zoom_constant:new h.b_(A,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(A,t.u_is_size_feature_constant),u_size_t:new h.bq(A,t.u_size_t),u_size:new h.bq(A,t.u_size),u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_pitch:new h.bq(A,t.u_pitch),u_rotate_symbol:new h.b_(A,t.u_rotate_symbol),u_aspect_ratio:new h.bq(A,t.u_aspect_ratio),u_fade_change:new h.bq(A,t.u_fade_change),u_label_plane_matrix:new h.c0(A,t.u_label_plane_matrix),u_coord_matrix:new h.c0(A,t.u_coord_matrix),u_is_text:new h.b_(A,t.u_is_text),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_is_along_line:new h.b_(A,t.u_is_along_line),u_is_variable_anchor:new h.b_(A,t.u_is_variable_anchor),u_texsize:new h.c3(A,t.u_texsize),u_texture:new h.b_(A,t.u_texture),u_gamma_scale:new h.bq(A,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_is_halo:new h.b_(A,t.u_is_halo),u_translation:new h.c3(A,t.u_translation),u_pitched_scale:new h.bq(A,t.u_pitched_scale)}),symbolTextAndIcon:(A,t)=>({u_is_size_zoom_constant:new h.b_(A,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.b_(A,t.u_is_size_feature_constant),u_size_t:new h.bq(A,t.u_size_t),u_size:new h.bq(A,t.u_size),u_camera_to_center_distance:new h.bq(A,t.u_camera_to_center_distance),u_pitch:new h.bq(A,t.u_pitch),u_rotate_symbol:new h.b_(A,t.u_rotate_symbol),u_aspect_ratio:new h.bq(A,t.u_aspect_ratio),u_fade_change:new h.bq(A,t.u_fade_change),u_label_plane_matrix:new h.c0(A,t.u_label_plane_matrix),u_coord_matrix:new h.c0(A,t.u_coord_matrix),u_is_text:new h.b_(A,t.u_is_text),u_pitch_with_map:new h.b_(A,t.u_pitch_with_map),u_is_along_line:new h.b_(A,t.u_is_along_line),u_is_variable_anchor:new h.b_(A,t.u_is_variable_anchor),u_texsize:new h.c3(A,t.u_texsize),u_texsize_icon:new h.c3(A,t.u_texsize_icon),u_texture:new h.b_(A,t.u_texture),u_texture_icon:new h.b_(A,t.u_texture_icon),u_gamma_scale:new h.bq(A,t.u_gamma_scale),u_device_pixel_ratio:new h.bq(A,t.u_device_pixel_ratio),u_is_halo:new h.b_(A,t.u_is_halo),u_translation:new h.c3(A,t.u_translation),u_pitched_scale:new h.bq(A,t.u_pitched_scale)}),background:(A,t)=>({u_opacity:new h.bq(A,t.u_opacity),u_color:new h.b$(A,t.u_color)}),backgroundPattern:(A,t)=>({u_opacity:new h.bq(A,t.u_opacity),u_image:new h.b_(A,t.u_image),u_pattern_tl_a:new h.c3(A,t.u_pattern_tl_a),u_pattern_br_a:new h.c3(A,t.u_pattern_br_a),u_pattern_tl_b:new h.c3(A,t.u_pattern_tl_b),u_pattern_br_b:new h.c3(A,t.u_pattern_br_b),u_texsize:new h.c3(A,t.u_texsize),u_mix:new h.bq(A,t.u_mix),u_pattern_size_a:new h.c3(A,t.u_pattern_size_a),u_pattern_size_b:new h.c3(A,t.u_pattern_size_b),u_scale_a:new h.bq(A,t.u_scale_a),u_scale_b:new h.bq(A,t.u_scale_b),u_pixel_coord_upper:new h.c3(A,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.c3(A,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bq(A,t.u_tile_units_to_pixels)}),terrain:(A,t)=>({u_texture:new h.b_(A,t.u_texture),u_ele_delta:new h.bq(A,t.u_ele_delta),u_fog_matrix:new h.c0(A,t.u_fog_matrix),u_fog_color:new h.b$(A,t.u_fog_color),u_fog_ground_blend:new h.bq(A,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bq(A,t.u_fog_ground_blend_opacity),u_horizon_color:new h.b$(A,t.u_horizon_color),u_horizon_fog_blend:new h.bq(A,t.u_horizon_fog_blend),u_is_globe_mode:new h.bq(A,t.u_is_globe_mode)}),terrainDepth:(A,t)=>({u_ele_delta:new h.bq(A,t.u_ele_delta)}),terrainCoords:(A,t)=>({u_texture:new h.b_(A,t.u_texture),u_terrain_coords_id:new h.bq(A,t.u_terrain_coords_id),u_ele_delta:new h.bq(A,t.u_ele_delta)}),projectionErrorMeasurement:(A,t)=>({u_input:new h.bq(A,t.u_input),u_output_expected:new h.bq(A,t.u_output_expected)}),atmosphere:(A,t)=>({u_sun_pos:new h.c2(A,t.u_sun_pos),u_atmosphere_blend:new h.bq(A,t.u_atmosphere_blend),u_globe_position:new h.c2(A,t.u_globe_position),u_globe_radius:new h.bq(A,t.u_globe_radius),u_inv_proj_matrix:new h.c0(A,t.u_inv_proj_matrix)}),sky:(A,t)=>({u_sky_color:new h.b$(A,t.u_sky_color),u_horizon_color:new h.b$(A,t.u_horizon_color),u_horizon:new h.c3(A,t.u_horizon),u_horizon_normal:new h.c3(A,t.u_horizon_normal),u_sky_horizon_blend:new h.bq(A,t.u_sky_horizon_blend),u_sky_blend:new h.bq(A,t.u_sky_blend)})};class wn{constructor(t,s,f){this.context=t;const x=t.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const mn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ki{constructor(t,s,f,x){this.length=s.length,this.attributes=f,this.itemSize=s.bytesPerElement,this.dynamicDraw=x,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let f=0;f<this.attributes.length;f++){const x=s.attributes[this.attributes[f].name];x!==void 0&&t.enableVertexAttribArray(x)}}setVertexAttribPointers(t,s,f){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],M=s.attributes[S.name];M!==void 0&&t.vertexAttribPointer(M,S.components,t[mn[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class is extends Zn{getDefault(){return h.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ga extends Zn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Fs extends Zn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Er extends Zn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class rs extends Zn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ws extends Zn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ro extends Zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class js extends Zn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class sh extends Zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class bu extends Zn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class so extends Zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class dl extends Zn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Oa extends Zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Vl extends Zn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class jc extends Zn{getDefault(){return h.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Uc extends Zn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ah extends Zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class gc extends Zn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class So extends Zn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class qd extends Zn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class vu extends Zn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Pi extends Zn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Xh extends Zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ao extends Zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wh extends Zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class oo extends Zn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ap extends Zn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Yh extends Zn{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const f=this.gl;qn(f)?f.bindVertexArray(t):(s=f.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class mc extends Zn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Zd extends Zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class $h extends Zn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class yc extends Zn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class wu extends yc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class za extends yc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class xc extends yc{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const _c="Framebuffer is not complete";class Vc{constructor(t,s,f,x,S){this.context=t,this.width=s,this.height=f;const M=t.gl,z=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new wu(t,z),x)this.depthAttachment=S?new xc(t,z):new za(t,z);else if(S)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error(_c)}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const f=this.depthAttachment.get();f&&t.deleteRenderbuffer(f)}t.deleteFramebuffer(this.framebuffer)}}class bc{constructor(t){var s,f;if(this.gl=t,this.clearColor=new is(this),this.clearDepth=new ga(this),this.clearStencil=new Fs(this),this.colorMask=new Er(this),this.depthMask=new rs(this),this.stencilMask=new Ws(this),this.stencilFunc=new ro(this),this.stencilOp=new js(this),this.stencilTest=new sh(this),this.depthRange=new bu(this),this.depthTest=new so(this),this.depthFunc=new dl(this),this.blend=new Oa(this),this.blendFunc=new Vl(this),this.blendColor=new jc(this),this.blendEquation=new Uc(this),this.cullFace=new ah(this),this.cullFaceSide=new gc(this),this.frontFace=new So(this),this.program=new qd(this),this.activeTexture=new vu(this),this.viewport=new Pi(this),this.bindFramebuffer=new Xh(this),this.bindRenderbuffer=new ao(this),this.bindTexture=new Wh(this),this.bindVertexBuffer=new oo(this),this.bindElementBuffer=new ap(this),this.bindVertexArray=new Yh(this),this.pixelStoreUnpack=new mc(this),this.pixelStoreUnpackPremultiplyAlpha=new Zd(this),this.pixelStoreUnpackFlipY=new $h(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),qn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const x=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:x?.RGBA16F_EXT,this.RGB16F=(f=t.RGB16F)!==null&&f!==void 0?f:x?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const x=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=x?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new wn(this,t,s)}createVertexBuffer(t,s,f){return new Ki(this,t,s,f)}createRenderbuffer(t,s,f){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,t,s,f),this.bindRenderbuffer.set(null),S}createFramebuffer(t,s,f,x){return new Vc(this,t,s,f,x)}clear({color:t,depth:s,stencil:f}){const x=this.gl;let S=0;t&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),f!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.bR(t.blendFunction,hr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return qn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return qn(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ys;function Js(A,t,s,f,x){const S=A.context,M=A.transform,z=S.gl,j=A.useProgram("collisionBox"),Z=[];let W=0,ee=0;for(let Ie=0;Ie<f.length;Ie++){const Le=f[Ie],$e=t.getTile(Le).getBucket(s);if(!$e)continue;const ze=x?$e.textCollisionBox:$e.iconCollisionBox,We=$e.collisionCircleArray;We.length>0&&(Z.push({circleArray:We,circleOffset:ee,coord:Le}),W+=We.length/4,ee=W),ze&&j.draw(S,z.LINES,nt.disabled,wt.disabled,A.colorModeForRenderPass(),et.disabled,Xs(A.transform),A.style.map.terrain&&A.style.map.terrain.getTerrainData(Le),M.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,A.transform.zoom,null,null,ze.collisionVertexBuffer)}if(!x||!Z.length)return;const J=A.useProgram("collisionCircle"),se=new h.ca;se.resize(4*W),se._trim();let fe=0;for(const Ie of Z)for(let Le=0;Le<Ie.circleArray.length/4;Le++){const $e=4*Le,ze=Ie.circleArray[$e+0],We=Ie.circleArray[$e+1],st=Ie.circleArray[$e+2],Ve=Ie.circleArray[$e+3];se.emplace(fe++,ze,We,st,Ve,0),se.emplace(fe++,ze,We,st,Ve,1),se.emplace(fe++,ze,We,st,Ve,2),se.emplace(fe++,ze,We,st,Ve,3)}(!Ys||Ys.length<2*W)&&(Ys=(function(Ie){const Le=2*Ie,$e=new h.cc;$e.resize(Le),$e._trim();for(let ze=0;ze<Le;ze++){const We=6*ze;$e.uint16[We+0]=4*ze+0,$e.uint16[We+1]=4*ze+1,$e.uint16[We+2]=4*ze+2,$e.uint16[We+3]=4*ze+2,$e.uint16[We+4]=4*ze+3,$e.uint16[We+5]=4*ze+0}return $e})(W));const Ce=S.createIndexBuffer(Ys,!0),Me=S.createVertexBuffer(se,h.cb.members,!0);for(const Ie of Z){const Le=rh(A.transform);J.draw(S,z.TRIANGLES,nt.disabled,wt.disabled,A.colorModeForRenderPass(),et.disabled,Le,A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ie.coord),null,s.id,Me,Ce,h.aX.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,A.transform.zoom,null,null,null)}Me.destroy(),Ce.destroy()}const fl=h.ar(new Float32Array(16));function pl(A,t,s,f,x,S){const{horizontalAlign:M,verticalAlign:z}=h.aS(A);return new h.P((-(M-.5)*t/x+f[0])*S,(-(z-.5)*s/x+f[1])*S)}function Va(A,t,s,f,x,S){const M=t.tileAnchorPoint.add(new h.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let z=f.mult(S);s||(z=z.rotate(-x));const j=M.add(z);return vn(j.x,j.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(s){const z=ln(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(A),j=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return A.add(f.rotate(j))}return A.add(f)}function Gl(A,t,s,f,x,S,M,z,j,Z,W,ee){const J=A.text.placedSymbolArray,se=A.text.dynamicLayoutVertexArray,fe=A.icon.dynamicLayoutVertexArray,Ce={};se.clear();for(let Me=0;Me<J.length;Me++){const Ie=J.get(Me),Le=Ie.hidden||!Ie.crossTileID||A.allowVerticalPlacement&&!Ie.placedOrientation?null:f[Ie.crossTileID];if(Le){const $e=new h.P(Ie.anchorX,Ie.anchorY),ze={getElevation:ee,width:x.width,height:x.height,pitchedLabelPlaneMatrix:S,pitchWithMap:s,transform:x,tileAnchorPoint:$e,translation:Z,unwrappedTileID:W},We=s?Bi($e.x,$e.y,ze):ln($e.x,$e.y,ze),st=ri(x.cameraToCenterDistance,We.signedDistanceFromCamera);let Ve=h.aA(A.textSizeData,z,Ie)*st/h.aM;s&&(Ve*=A.tilePixelRatio/M);const{width:pt,height:Ft,anchor:Nt,textOffset:Ot,textBoxScale:zt}=Le,xn=pl(Nt,pt,Ft,Ot,zt,Ve),_n=x.getPitchedTextCorrection($e.x+Z[0],$e.y+Z[1],W),cn=Va(We.point,ze,t,xn,-x.bearingInRadians,_n),Tn=A.allowVerticalPlacement&&Ie.placedOrientation===h.az.vertical?Math.PI/2:0;for(let Mi=0;Mi<Ie.numGlyphs;Mi++)h.aG(se,cn,Tn);j&&Ie.associatedIconIndex>=0&&(Ce[Ie.associatedIconIndex]={shiftedAnchor:cn,angle:Tn})}else Hi(Ie.numGlyphs,se)}if(j){fe.clear();const Me=A.icon.placedSymbolArray;for(let Ie=0;Ie<Me.length;Ie++){const Le=Me.get(Ie);if(Le.hidden)Hi(Le.numGlyphs,fe);else{const $e=Ce[Ie];if($e)for(let ze=0;ze<Le.numGlyphs;ze++)h.aG(fe,$e.shiftedAnchor,$e.angle);else Hi(Le.numGlyphs,fe)}}A.icon.dynamicLayoutVertexBuffer.updateData(fe)}A.text.dynamicLayoutVertexBuffer.updateData(se)}function Xd(A,t,s){return s.iconsInText&&t?"symbolTextAndIcon":A?"symbolSDF":"symbolIcon"}function Gc(A,t,s,f,x,S,M,z,j,Z,W,ee,J){const se=A.context,fe=se.gl,Ce=A.transform,Me=z==="map",Ie=j==="map",Le=z!=="viewport"&&s.layout.get("symbol-placement")!=="point",$e=Me&&!Ie&&!Le,ze=!s.layout.get("symbol-sort-key").isConstant();let We=!1;const st=A.getDepthModeForSublayer(0,nt.ReadOnly),Ve=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),pt=[],Ft=Ce.getCircleRadiusCorrection();for(const Nt of f){const Ot=t.getTile(Nt),zt=Ot.getBucket(s);if(!zt)continue;const xn=x?zt.text:zt.icon;if(!xn||!xn.segments.get().length||!xn.hasVisibleVertices)continue;const _n=xn.programConfigurations.get(s.id),cn=x||zt.sdfIcons,Tn=x?zt.textSizeData:zt.iconSizeData,Mi=Ie||Ce.pitch!==0,Cr=A.useProgram(Xd(cn,x,zt),_n),Hr=h.ay(Tn,Ce.zoom),jr=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Nt);let Qr,Pr,ds,Jr,ta=[0,0],ms=null;if(x)Pr=Ot.glyphAtlasTexture,ds=fe.LINEAR,Qr=Ot.glyphAtlasTexture.size,zt.iconsInText&&(ta=Ot.imageAtlasTexture.size,ms=Ot.imageAtlasTexture,Jr=Mi||A.options.rotating||A.options.zooming||Tn.kind==="composite"||Tn.kind==="camera"?fe.LINEAR:fe.NEAREST);else{const Mr=s.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear;Pr=Ot.imageAtlasTexture,ds=cn||A.options.rotating||A.options.zooming||Mr||Mi?fe.LINEAR:fe.NEAREST,Qr=Ot.imageAtlasTexture.size}const ys=h.aN(Ot,1,A.transform.zoom),na=tn(Me,A.transform,ys),Tl=h.N();h.aB(Tl,na);const Il=Un(Ie,Me,A.transform,ys),Yo=h.aO(Ce,Ot,S,M),Za=Ce.getProjectionData({overscaledTileID:Nt,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),Qc=Ve&&zt.hasTextData(),Du=s.layout.get("icon-text-fit")!=="none"&&Qc&&zt.hasIconData();if(Le){const Mr=A.style.map.terrain?(Ds,Us)=>A.style.map.terrain.getElevation(Nt,Ds,Us):null,Ur=s.layout.get("text-rotation-alignment")==="map";Xn(zt,A,x,na,Tl,Ie,Z,Ur,Nt.toUnwrapped(),Ce.width,Ce.height,Yo,Mr)}const $o=x&&Ve||Du,Xa=Le||$o?fl:Ie?na:A.transform.clipSpaceToPixelsMatrix,fo=cn&&s.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let No;No=cn?zt.iconsInText?ot(Tn.kind,Hr,$e,Ie,Le,$o,A,Xa,Il,Yo,Qr,ta,Ft):Oe(Tn.kind,Hr,$e,Ie,Le,$o,A,Xa,Il,Yo,x,Qr,0,Ft):xe(Tn.kind,Hr,$e,Ie,Le,$o,A,Xa,Il,Yo,x,Qr,Ft);const Do={program:Cr,buffers:xn,uniformValues:No,projectionData:Za,atlasTexture:Pr,atlasTextureIcon:ms,atlasInterpolation:ds,atlasInterpolationIcon:Jr,isSDF:cn,hasHalo:fo};if(ze&&zt.canOverlap){We=!0;const Mr=xn.segments.get();for(const Ur of Mr)pt.push({segments:new h.aX([Ur]),sortKey:Ur.sortKey,state:Do,terrainData:jr})}else pt.push({segments:xn.segments,sortKey:0,state:Do,terrainData:jr})}We&&pt.sort(((Nt,Ot)=>Nt.sortKey-Ot.sortKey));for(const Nt of pt){const Ot=Nt.state;if(se.activeTexture.set(fe.TEXTURE0),Ot.atlasTexture.bind(Ot.atlasInterpolation,fe.CLAMP_TO_EDGE),Ot.atlasTextureIcon&&(se.activeTexture.set(fe.TEXTURE1),Ot.atlasTextureIcon&&Ot.atlasTextureIcon.bind(Ot.atlasInterpolationIcon,fe.CLAMP_TO_EDGE)),Ot.isSDF){const zt=Ot.uniformValues;Ot.hasHalo&&(zt.u_is_halo=1,Au(Ot.buffers,Nt.segments,s,A,Ot.program,st,W,ee,zt,Ot.projectionData,Nt.terrainData)),zt.u_is_halo=0}Au(Ot.buffers,Nt.segments,s,A,Ot.program,st,W,ee,Ot.uniformValues,Ot.projectionData,Nt.terrainData)}}function Au(A,t,s,f,x,S,M,z,j,Z,W){const ee=f.context;x.draw(ee,ee.gl.TRIANGLES,S,M,z,et.backCCW,j,W,Z,s.id,A.layoutVertexBuffer,A.indexBuffer,t,s.paint,f.transform.zoom,A.programConfigurations.get(s.id),A.dynamicLayoutVertexBuffer,A.opacityVertexBuffer)}function Wd(A,t,s,f,x){const S=A.context,M=S.gl,z=wt.disabled,j=new hr([M.ONE,M.ONE],h.bp.transparent,[!0,!0,!0,!0]),Z=t.getBucket(s);if(!Z)return;const W=f.key;let ee=s.heatmapFbos.get(W);ee||(ee=Fr(S,t.tileSize,t.tileSize),s.heatmapFbos.set(W,ee)),S.bindFramebuffer.set(ee.framebuffer),S.viewport.set([0,0,t.tileSize,t.tileSize]),S.clear({color:h.bp.transparent});const J=Z.programConfigurations.get(s.id),se=A.useProgram("heatmap",J,!x),fe=A.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ce=A.style.map.terrain.getTerrainData(f);se.draw(S,M.TRIANGLES,nt.disabled,z,j,et.disabled,Ua(t,A.transform.zoom,s.paint.get("heatmap-intensity"),1),Ce,fe,s.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,s.paint,A.transform.zoom,J)}function ea(A,t,s,f,x){const S=A.context,M=S.gl,z=A.transform;S.setColorMode(A.colorModeForRenderPass());const j=ir(S,t),Z=s.key,W=t.heatmapFbos.get(Z);if(!W)return;S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,W.colorAttachment.get()),S.activeTexture.set(M.TEXTURE1),j.bind(M.LINEAR,M.CLAMP_TO_EDGE);const ee=z.getProjectionData({overscaledTileID:s,applyTerrainMatrix:x,applyGlobeMatrix:!f});A.useProgram("heatmapTexture").draw(S,M.TRIANGLES,nt.disabled,wt.disabled,A.colorModeForRenderPass(),et.disabled,ar(A,t,0,1),null,ee,t.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments,t.paint,z.zoom),W.destroy(),t.heatmapFbos.delete(Z)}function Fr(A,t,s){var f,x;const S=A.gl,M=S.createTexture();S.bindTexture(S.TEXTURE_2D,M),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const z=(f=A.HALF_FLOAT)!==null&&f!==void 0?f:S.UNSIGNED_BYTE,j=(x=A.RGBA16F)!==null&&x!==void 0?x:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,j,t,s,0,S.RGBA,z,null);const Z=A.createFramebuffer(t,s,!1,!1);return Z.colorAttachment.set(M),Z}function ir(A,t){return t.colorRampTexture||(t.colorRampTexture=new h.T(A,t.colorRamp,A.gl.RGBA)),t.colorRampTexture}function Hl(A,t,s,f,x,S,M,z){let j=256;if(x.stepInterpolant){const Z=t.getSource().maxzoom,W=M.canonical.z===Z?Math.ceil(1<<A.transform.maxZoom-M.canonical.z):1;j=h.an(h.ce(S.maxLineLength/h.a5*1024*W),256,s.maxTextureSize)}return z.gradient=h.cf({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:j,image:z.gradient||void 0,clips:S.lineClipsArray}),z.texture?z.texture.update(z.gradient):z.texture=new h.T(s,z.gradient,f.RGBA),z.version=x.gradientVersion,z.texture}function lo(A,t,s,f,x){A.activeTexture.set(t.TEXTURE0),s.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),f.updatePaintBuffers(x)}function us(A,t,s,f,x,S){(x||A.lineAtlas.dirty)&&(t.activeTexture.set(s.TEXTURE0),A.lineAtlas.bind(t)),f.updatePaintBuffers(S)}function Ga(A,t,s,f,x,S,M){const z=S.gradients[x.id];let j=z.texture;x.gradientVersion!==z.version&&(j=Hl(A,t,s,f,x,S,M,z)),s.activeTexture.set(f.TEXTURE0),j.bind(x.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE)}function Ha(A,t,s,f,x,S,M,z,j){const Z=S.gradients[x.id];let W=Z.texture;x.gradientVersion!==Z.version&&(W=Hl(A,t,s,f,x,S,M,Z)),s.activeTexture.set(f.TEXTURE0),W.bind(x.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE),s.activeTexture.set(f.TEXTURE1),A.lineAtlas.bind(s),z.updatePaintBuffers(j)}function oh(A,t,s,f,x){if(!s||!f||!f.imageAtlas)return;const S=f.imageAtlas.patternPositions;let M=S[s.to.toString()],z=S[s.from.toString()];if(!M&&z&&(M=z),!z&&M&&(z=M),!M||!z){const j=x.getPaintProperty(t);M=S[j],z=S[j]}M&&z&&A.setConstantPatternPositions(M,z)}function gl(A,t,s,f,x,S,M,z){const j=A.context.gl,Z="fill-pattern",W=s.paint.get(Z),ee=W&&W.constantOr(1),J=s.getCrossfadeParameters();let se,fe,Ce,Me,Ie;const Le=A.transform,$e=s.paint.get("fill-translate"),ze=s.paint.get("fill-translate-anchor");M?(fe=ee&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",se=j.LINES):(fe=ee?"fillPattern":"fill",se=j.TRIANGLES);const We=W.constantOr(null);for(const st of f){const Ve=t.getTile(st);if(ee&&!Ve.patternsLoaded())continue;const pt=Ve.getBucket(s);if(!pt)continue;const Ft=pt.programConfigurations.get(s.id),Nt=A.useProgram(fe,Ft),Ot=A.style.map.terrain&&A.style.map.terrain.getTerrainData(st);ee&&(A.context.activeTexture.set(j.TEXTURE0),Ve.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ft.updatePaintBuffers(J)),oh(Ft,Z,We,Ve,s);const zt=Le.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),xn=h.aO(Le,Ve,$e,ze);if(M){Me=pt.indexBuffer2,Ie=pt.segments2;const cn=[j.drawingBufferWidth,j.drawingBufferHeight];Ce=fe==="fillOutlinePattern"&&ee?Zh(A,J,Ve,cn,xn):ul(cn,xn)}else Me=pt.indexBuffer,Ie=pt.segments,Ce=ee?jl(A,J,Ve,xn):{u_fill_translate:xn};const _n=A.stencilModeForClipping(st);Nt.draw(A.context,se,x,_n,S,et.backCCW,Ce,Ot,zt,s.id,pt.layoutVertexBuffer,Me,Ie,s.paint,A.transform.zoom,Ft)}}function ml(A,t,s,f,x,S,M,z){const j=A.context,Z=j.gl,W="fill-extrusion-pattern",ee=s.paint.get(W),J=ee.constantOr(1),se=s.getCrossfadeParameters(),fe=s.paint.get("fill-extrusion-opacity"),Ce=ee.constantOr(null),Me=A.transform;for(const Ie of f){const Le=t.getTile(Ie),$e=Le.getBucket(s);if(!$e)continue;const ze=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ie),We=$e.programConfigurations.get(s.id),st=A.useProgram(J?"fillExtrusionPattern":"fillExtrusion",We);J&&(A.context.activeTexture.set(Z.TEXTURE0),Le.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),We.updatePaintBuffers(se));const Ve=Me.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!z,applyTerrainMatrix:!0});oh(We,W,Ce,Le,s);const pt=h.aO(Me,Le,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ft=s.paint.get("fill-extrusion-vertical-gradient"),Nt=J?Pa(A,Ft,fe,pt,Ie,se,Le):Fc(A,Ft,fe,pt);st.draw(j,j.gl.TRIANGLES,x,S,M,et.backCCW,Nt,ze,Ve,s.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,s.paint,A.transform.zoom,We,A.style.map.terrain&&$e.centroidVertexBuffer)}}function yl(A,t,s,f,x,S,M,z,j){var Z;const W=A.style.projection,ee=A.context,J=A.transform,se=ee.gl,fe=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],Ce=A.useProgram("hillshade",null,!1,fe),Me=!A.options.moving;for(const Ie of f){const Le=t.getTile(Ie),$e=Le.fbo;if(!$e)continue;const ze=W.getMeshFromTileID(ee,Ie.canonical,z,!0,"raster"),We=(Z=A.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(Ie);ee.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,$e.colorAttachment.get());const st=J.getProjectionData({overscaledTileID:Ie,aligned:Me,applyGlobeMatrix:!j,applyTerrainMatrix:!0});Ce.draw(ee,se.TRIANGLES,S,x[Ie.overscaledZ],M,et.backCCW,hl(A,Le,s),We,st,s.id,ze.vertexBuffer,ze.indexBuffer,ze.segments)}}function ql(A,t,s,f,x,S,M,z,j){var Z;const W=A.style.projection,ee=A.context,J=A.transform,se=ee.gl,fe=A.useProgram("colorRelief"),Ce=!A.options.moving;let Me=!0,Ie=0;for(const Le of f){const $e=t.getTile(Le),ze=$e.dem;if(Me){const Nt=se.getParameter(se.MAX_TEXTURE_SIZE),{elevationTexture:Ot,colorTexture:zt}=s.getColorRampTextures(ee,Nt,ze.getUnpackVector());ee.activeTexture.set(se.TEXTURE1),Ot.bind(se.NEAREST,se.CLAMP_TO_EDGE),ee.activeTexture.set(se.TEXTURE4),zt.bind(se.LINEAR,se.CLAMP_TO_EDGE),Me=!1,Ie=Ot.size[0]}if(!ze||!ze.data)continue;const We=ze.stride,st=ze.getPixels();if(ee.activeTexture.set(se.TEXTURE0),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),$e.demTexture=$e.demTexture||A.getTileTexture(We),$e.demTexture){const Nt=$e.demTexture;Nt.update(st,{premultiply:!1}),Nt.bind(se.LINEAR,se.CLAMP_TO_EDGE)}else $e.demTexture=new h.T(ee,st,se.RGBA,{premultiply:!1}),$e.demTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const Ve=W.getMeshFromTileID(ee,Le.canonical,z,!0,"raster"),pt=(Z=A.style.map.terrain)===null||Z===void 0?void 0:Z.getTerrainData(Le),Ft=J.getProjectionData({overscaledTileID:Le,aligned:Ce,applyGlobeMatrix:!j,applyTerrainMatrix:!0});fe.draw(ee,se.TRIANGLES,S,x[Le.overscaledZ],M,et.backCCW,u(s,$e.dem,Ie),pt,Ft,s.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}const Zl=[new h.P(0,0),new h.P(h.a5,0),new h.P(h.a5,h.a5),new h.P(0,h.a5)];function Co(A,t,s,f,x,S,M,z,j=!1,Z=!1){const W=f[f.length-1].overscaledZ,ee=A.context,J=ee.gl,se=A.useProgram("raster"),fe=A.transform,Ce=A.style.projection,Me=A.colorModeForRenderPass(),Ie=!A.options.moving,Le=s.paint.get("raster-opacity"),$e=s.paint.get("raster-resampling"),ze=s.paint.get("raster-fade-duration"),We=!!A.style.map.terrain;for(const st of f){const Ve=A.getDepthModeForSublayer(st.overscaledZ-W,Le===1?nt.ReadWrite:nt.ReadOnly,J.LESS),pt=t.getTile(st),Ft=$e==="nearest"?J.NEAREST:J.LINEAR;ee.activeTexture.set(J.TEXTURE0),pt.texture.bind(Ft,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),ee.activeTexture.set(J.TEXTURE1);const{parentTile:Nt,parentScaleBy:Ot,parentTopLeft:zt,fadeValues:xn}=xl(pt,t,ze,We);pt.fadeOpacity=xn.tileOpacity,Nt?(Nt.fadeOpacity=xn.parentTileOpacity,Nt.texture.bind(Ft,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST)):pt.texture.bind(Ft,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),pt.texture.useMipmap&&ee.extTextureFilterAnisotropic&&A.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const _n=A.style.map.terrain&&A.style.map.terrain.getTerrainData(st),cn=fe.getProjectionData({overscaledTileID:st,aligned:Ie,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Tn=te(zt,Ot,xn.fadeMix,s,z),Mi=Ce.getMeshFromTileID(ee,st.canonical,S,M,"raster");se.draw(ee,J.TRIANGLES,Ve,x?x[st.overscaledZ]:wt.disabled,Me,j?et.frontCCW:et.backCCW,Tn,_n,cn,s.id,Mi.vertexBuffer,Mi.indexBuffer,Mi.segments)}}function xl(A,t,s,f){const x={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(s===0||f)return x;if(A.fadingParentID){const S=t.getLoadedTile(A.fadingParentID);if(!S)return x;const M=Math.pow(2,S.tileID.overscaledZ-A.tileID.overscaledZ),z=[A.tileID.canonical.x*M%1,A.tileID.canonical.y*M%1],j=(function(Z,W,ee){const J=pe(),se=(J-W.timeAdded)/ee,fe=Z.fadingDirection===qe.Incoming,Ce=h.an((J-Z.timeAdded)/ee,0,1),Me=h.an(1-se,0,1),Ie=fe?Ce:Me;return{tileOpacity:Ie,parentTileOpacity:fe?Me:Ce,fadeMix:{opacity:1,mix:1-Ie}}})(A,S,s);return{parentTile:S,parentScaleBy:M,parentTopLeft:z,fadeValues:j}}if(A.selfFading){const S=(function(M,z){const j=(pe()-M.timeAdded)/z,Z=h.an(j,0,1);return{tileOpacity:Z,fadeMix:{opacity:Z,mix:0}}})(A,s);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:S}}return x}const Xl=new h.bp(1,0,0,1),_l=new h.bp(0,1,0,1),Kh=new h.bp(0,0,1,1),Qh=new h.bp(1,0,1,1),co=new h.bp(0,1,1,1);function Eu(A,t,s,f){Ns(A,0,t+s/2,A.transform.width,s,f)}function Wl(A,t,s,f){Ns(A,t-s/2,0,s,A.transform.height,f)}function Ns(A,t,s,f,x,S){const M=A.context,z=M.gl;z.enable(z.SCISSOR_TEST),z.scissor(t*A.pixelRatio,s*A.pixelRatio,f*A.pixelRatio,x*A.pixelRatio),M.clear({color:S}),z.disable(z.SCISSOR_TEST)}function lh(A,t,s){const f=A.context,x=f.gl,S=A.useProgram("debug"),M=nt.disabled,z=wt.disabled,j=A.colorModeForRenderPass(),Z="$debug",W=A.style.map.terrain&&A.style.map.terrain.getTerrainData(s);f.activeTexture.set(x.TEXTURE0);const ee=t.getTileByID(s.key).latestRawTileData,J=Math.floor((ee&&ee.byteLength||0)/1024),se=t.getTile(s).tileSize,fe=512/Math.min(se,512)*(s.overscaledZ/A.transform.zoom)*.5;let Ce=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Ce+=` => ${s.overscaledZ}`),(function(Ie,Le){Ie.initDebugOverlayCanvas();const $e=Ie.debugOverlayCanvas,ze=Ie.context.gl,We=Ie.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,$e.width,$e.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(Le,5,5),We.strokeText(Le,5,5),Ie.debugOverlayTexture.update($e),Ie.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)})(A,`${Ce} ${J}kB`);const Me=A.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(f,x.TRIANGLES,M,z,hr.alphaBlended,et.disabled,Ul(h.bp.transparent,fe),null,Me,Z,A.debugBuffer,A.quadTriangleIndexBuffer,A.debugSegments),S.draw(f,x.LINE_STRIP,M,z,j,et.disabled,Ul(h.bp.red),W,Me,Z,A.debugBuffer,A.tileBorderIndexBuffer,A.debugSegments)}function Jh(A,t,s,f){const{isRenderingGlobe:x}=f,S=A.context,M=S.gl,z=A.transform,j=A.colorModeForRenderPass(),Z=A.getDepthModeFor3D(),W=A.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,A.width,A.height]);for(const ee of s){const J=t.getTerrainMesh(ee.tileID),se=A.renderToTexture.getTexture(ee),fe=t.getTerrainData(ee.tileID);S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,se.texture);const Ce=t.getMeshFrameDelta(z.zoom),Me=z.calculateFogMatrix(ee.tileID.toUnwrapped()),Ie=fc(Ce,Me,A.style.sky,z.pitch,x),Le=z.getProjectionData({overscaledTileID:ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});W.draw(S,M.TRIANGLES,Z,wt.disabled,j,et.backCCW,Ie,fe,Le,"terrain",J.vertexBuffer,J.indexBuffer,J.segments)}}function Yd(A,t){if(!t.mesh){const s=new h.aW;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const f=new h.aY;f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),t.mesh=new _r(A.createVertexBuffer(s,Ai.members),A.createIndexBuffer(f),h.aX.simpleSegment(0,0,s.length,f.length))}return t.mesh}class op{constructor(t,s){this.context=new bc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ke.maxOverzooming+Ke.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yi}resize(t,s,f){if(this.width=Math.floor(t*f),this.height=Math.floor(s*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const t=this.context,s=new h.aW;s.emplaceBack(0,0),s.emplaceBack(h.a5,0),s.emplaceBack(0,h.a5),s.emplaceBack(h.a5,h.a5),this.tileExtentBuffer=t.createVertexBuffer(s,Ai.members),this.tileExtentSegments=h.aX.simpleSegment(0,0,4,2);const f=new h.aW;f.emplaceBack(0,0),f.emplaceBack(h.a5,0),f.emplaceBack(0,h.a5),f.emplaceBack(h.a5,h.a5),this.debugBuffer=t.createVertexBuffer(f,Ai.members),this.debugSegments=h.aX.simpleSegment(0,0,4,5);const x=new h.ch;x.emplaceBack(0,0,0,0),x.emplaceBack(h.a5,0,h.a5,0),x.emplaceBack(0,h.a5,0,h.a5),x.emplaceBack(h.a5,h.a5,h.a5,h.a5),this.rasterBoundsBuffer=t.createVertexBuffer(x,_u.members),this.rasterBoundsSegments=h.aX.simpleSegment(0,0,4,2);const S=new h.aW;S.emplaceBack(0,0),S.emplaceBack(h.a5,0),S.emplaceBack(0,h.a5),S.emplaceBack(h.a5,h.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(S,Ai.members),this.rasterBoundsSegmentsPosOnly=h.aX.simpleSegment(0,0,4,5);const M=new h.aW;M.emplaceBack(0,0),M.emplaceBack(1,0),M.emplaceBack(0,1),M.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(M,Ai.members),this.viewportSegments=h.aX.simpleSegment(0,0,4,2);const z=new h.ci;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(z);const j=new h.aY;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(j);const Z=this.context.gl;this.stencilClearMode=new wt({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO),this.tileExtentMesh=new _r(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=h.N();h.c7(f,0,this.width,this.height,0,0,1),h.Q(f,f,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const x={mainMatrix:f,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:f};this.useProgram("clippingMask",null,!0).draw(t,s.TRIANGLES,nt.disabled,this.stencilClearMode,hr.disabled,et.disabled,null,null,x,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,f){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source,this.nextStencilID+s.length>256&&this.clearStencil();const x=this.context;x.setColorMode(hr.disabled),x.setDepthMode(nt.disabled);const S={};for(const M of s)S[M.key]=this.nextStencilID++;this._renderTileMasks(S,s,f,!0),this._renderTileMasks(S,s,f,!1),this._tileClippingMaskIDs=S}_renderTileMasks(t,s,f,x){const S=this.context,M=S.gl,z=this.style.projection,j=this.transform,Z=this.useProgram("clippingMask");for(const W of s){const ee=t[W.key],J=this.style.map.terrain&&this.style.map.terrain.getTerrainData(W),se=z.getMeshFromTileID(this.context,W.canonical,x,!0,"stencil"),fe=j.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!f,applyTerrainMatrix:!0});Z.draw(S,M.TRIANGLES,nt.disabled,new wt({func:M.ALWAYS,mask:0},ee,255,M.KEEP,M.KEEP,M.REPLACE),hr.disabled,f?et.disabled:et.backCCW,null,J,fe,"$clipping",se.vertexBuffer,se.indexBuffer,se.segments)}}_renderTilesDepthBuffer(){const t=this.context,s=t.gl,f=this.style.projection,x=this.transform,S=this.useProgram("depth"),M=this.getDepthModeFor3D(),z=jn(x,{tileSize:x.tileSize});for(const j of z){const Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j),W=f.getMeshFromTileID(this.context,j.canonical,!0,!0,"raster"),ee=x.getProjectionData({overscaledTileID:j,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(t,s.TRIANGLES,M,wt.disabled,hr.disabled,et.backCCW,null,Z,ee,"$clipping",W.vertexBuffer,W.indexBuffer,W.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new wt({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new wt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const s=this.context.gl,f=t.sort(((M,z)=>z.overscaledZ-M.overscaledZ)),x=f[f.length-1].overscaledZ,S=f[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const M={};for(let z=0;z<S;z++)M[z+x]=new wt({func:s.GEQUAL,mask:255},z+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=S,[M,f]}return[{[x]:wt.disabled},f]}stencilConfigForOverlapTwoPass(t){const s=this.context.gl,f=t.sort(((M,z)=>z.overscaledZ-M.overscaledZ)),x=f[f.length-1].overscaledZ,S=f[0].overscaledZ-x+1;if(this.clearStencil(),S>1){const M={},z={};for(let j=0;j<S;j++)M[j+x]=new wt({func:s.GREATER,mask:255},S+1+j,255,s.KEEP,s.KEEP,s.REPLACE),z[j+x]=new wt({func:s.GREATER,mask:255},1+j,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*S+1,[M,z,f]}return this.nextStencilID=3,[{[x]:new wt({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[x]:new wt({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new hr([t.CONSTANT_COLOR,t.ONE],new h.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hr.unblended:hr.alphaBlended}getDepthModeForSublayer(t,s,f){if(!this.opaquePassEnabledForLayer())return nt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new nt(f||this.context.gl.LEQUAL,s,[x,x])}getDepthModeFor3D(){return new nt(this.context.gl.LEQUAL,nt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){var f,x;this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(pe()),this.imageManager.beginFrame();const S=this.style._order,M=this.style.tileManagers,z={},j={},Z={},W={isRenderingToTexture:!1,isRenderingGlobe:((f=t.projection)===null||f===void 0?void 0:f.transitionState)>0};for(const J in M){const se=M[J];se.used&&se.prepare(this.context),z[J]=se.getVisibleCoordinates(!1),j[J]=z[J].slice().reverse(),Z[J]=se.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let J=0;J<S.length;J++)if(this.style._layers[S[J]].is3D()){this.opaquePassCutoff=J;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const J of S){const se=this.style._layers[J];if(!se.hasOffscreenPass()||se.isHidden(this.transform.zoom))continue;const fe=j[se.source];(se.type==="custom"||fe.length)&&this.renderLayer(this,M[se.source],se,fe,W)}if((x=this.style.projection)===null||x===void 0||x.updateGPUdependent({context:this.context,useProgram:J=>this.useProgram(J)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.bp.black:h.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(J,se){const fe=J.context,Ce=fe.gl,Me=((st,Ve,pt)=>{const Ft=Math.cos(Ve.rollInRadians),Nt=Math.sin(Ve.rollInRadians),Ot=yn(Ve),zt=Ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:st.properties.get("sky-color"),u_horizon_color:st.properties.get("horizon-color"),u_horizon:[(Ve.width/2-Ot*Nt)*pt,(Ve.height/2+Ot*Ft)*pt],u_horizon_normal:[-Nt,Ft],u_sky_horizon_blend:st.properties.get("sky-horizon-blend")*Ve.height/2*pt,u_sky_blend:zt}})(se,J.style.map.transform,J.pixelRatio),Ie=new nt(Ce.LEQUAL,nt.ReadWrite,[0,1]),Le=wt.disabled,$e=J.colorModeForRenderPass(),ze=J.useProgram("sky"),We=Yd(fe,se);ze.draw(fe,Ce.TRIANGLES,Ie,Le,$e,et.disabled,Me,null,void 0,"sky",We.vertexBuffer,We.indexBuffer,We.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const J=this.style._layers[S[this.currentLayer]],se=M[J.source],fe=z[J.source];this._renderTileClippingMasks(J,fe,!1),this.renderLayer(this,se,J,fe,W)}this.renderPass="translucent";let ee=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const J=this.style._layers[S[this.currentLayer]],se=M[J.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(J,W))continue;this.opaquePassEnabledForLayer()||ee||(ee=!0,W.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const fe=(J.type==="symbol"?Z:j)[J.source];this._renderTileClippingMasks(J,z[J.source],!!this.renderToTexture),this.renderLayer(this,se,J,fe,W)}if(W.isRenderingGlobe&&(function(J,se,fe){const Ce=J.context,Me=Ce.gl,Ie=J.useProgram("atmosphere"),Le=new nt(Me.LEQUAL,nt.ReadOnly,[0,1]),$e=J.transform,ze=(function(zt,xn){const _n=zt.properties.get("position"),cn=[-_n.x,-_n.y,-_n.z],Tn=h.ar(new Float64Array(16));return zt.properties.get("anchor")==="map"&&(h.bg(Tn,Tn,xn.rollInRadians),h.bh(Tn,Tn,-xn.pitchInRadians),h.bg(Tn,Tn,xn.bearingInRadians),h.bh(Tn,Tn,xn.center.lat*Math.PI/180),h.bJ(Tn,Tn,-xn.center.lng*Math.PI/180)),h.cg(cn,cn,Tn),cn})(fe,J.transform),We=$e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),st=se.properties.get("atmosphere-blend")*We.projectionTransition;if(st===0)return;const Ve=Ar($e.worldSize,$e.center.lat),pt=$e.inverseProjectionMatrix,Ft=new Float64Array(4);Ft[3]=1,h.aH(Ft,Ft,$e.modelViewProjectionMatrix),Ft[0]/=Ft[3],Ft[1]/=Ft[3],Ft[2]/=Ft[3],Ft[3]=1,h.aH(Ft,Ft,pt),Ft[0]/=Ft[3],Ft[1]/=Ft[3],Ft[2]/=Ft[3],Ft[3]=1;const Nt=((zt,xn,_n,cn,Tn)=>({u_sun_pos:zt,u_atmosphere_blend:xn,u_globe_position:_n,u_globe_radius:cn,u_inv_proj_matrix:Tn}))(ze,st,[Ft[0],Ft[1],Ft[2]],Ve,pt),Ot=Yd(Ce,se);Ie.draw(Ce,Me.TRIANGLES,Le,wt.disabled,hr.alphaBlended,et.disabled,Nt,null,null,"atmosphere",Ot.vertexBuffer,Ot.indexBuffer,Ot.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const J=(function(se,fe){let Ce=null;const Me=Object.values(se._layers).flatMap((ze=>ze.source&&!ze.isHidden(fe)?[se.tileManagers[ze.source]]:[])),Ie=Me.filter((ze=>ze.getSource().type==="vector")),Le=Me.filter((ze=>ze.getSource().type!=="vector")),$e=ze=>{(!Ce||Ce.getSource().maxzoom<ze.getSource().maxzoom)&&(Ce=ze)};return Ie.forEach((ze=>$e(ze))),Ce||Le.forEach((ze=>$e(ze))),Ce})(this.style,this.transform.zoom);J&&(function(se,fe,Ce){for(let Me=0;Me<Ce.length;Me++)lh(se,fe,Ce[Me])})(this,J,J.getVisibleCoordinates())}this.options.showPadding&&(function(J){const se=J.transform.padding;Eu(J,J.transform.height-(se.top||0),3,Xl),Eu(J,se.bottom||0,3,_l),Wl(J,se.left||0,3,Kh),Wl(J,J.transform.width-(se.right||0),3,Qh);const fe=J.transform.centerPoint;(function(Ce,Me,Ie,Le){Ns(Ce,Me-1,Ie-10,2,20,Le),Ns(Ce,Me-10,Ie-1,20,2,Le)})(J,fe.x,J.transform.height-fe.y,co)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=t?!h.cj(s,f):!h.ck(s,f)),x||(x=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),x&&(h.cl(s,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(S,M){const z=S.context,j=z.gl,Z=S.transform,W=hr.unblended,ee=new nt(j.LEQUAL,nt.ReadWrite,[0,1]),J=M.tileManager.getRenderableTiles(),se=S.useProgram("terrainDepth");z.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:h.bp.transparent,depth:1});for(const fe of J){const Ce=M.getTerrainMesh(fe.tileID),Me=M.getTerrainData(fe.tileID),Ie=Z.getProjectionData({overscaledTileID:fe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Le={u_ele_delta:M.getMeshFrameDelta(Z.zoom)};se.draw(z,j.TRIANGLES,ee,wt.disabled,W,et.backCCW,Le,Me,Ie,"terrain",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain),(function(S,M){const z=S.context,j=z.gl,Z=S.transform,W=hr.unblended,ee=new nt(j.LEQUAL,nt.ReadWrite,[0,1]),J=M.getCoordsTexture(),se=M.tileManager.getRenderableTiles(),fe=S.useProgram("terrainCoords");z.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:h.bp.transparent,depth:1}),M.coordsIndex=[];for(const Ce of se){const Me=M.getTerrainMesh(Ce.tileID),Ie=M.getTerrainData(Ce.tileID);z.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,J.texture);const Le={u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(Z.zoom)},$e=Z.getProjectionData({overscaledTileID:Ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});fe.draw(z,j.TRIANGLES,ee,wt.disabled,W,et.backCCW,Le,Ie,$e,"terrain",Me.vertexBuffer,Me.indexBuffer,Me.segments),M.coordsIndex.push(Ce.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain))}renderLayer(t,s,f,x,S){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(x||[]).length)&&(this.id=f.id,h.cm(f)?(function(M,z,j,Z,W,ee){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:J}=ee,se=wt.disabled,fe=M.colorModeForRenderPass();(j._unevaluatedLayout.hasValue("text-variable-anchor")||j._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Ce,Me,Ie,Le,$e,ze,We,st,Ve){const pt=Me.transform,Ft=Me.style.map.terrain,Nt=$e==="map",Ot=ze==="map";for(const zt of Ce){const xn=Le.getTile(zt),_n=xn.getBucket(Ie);if(!_n||!_n.text||!_n.text.segments.get().length)continue;const cn=h.ay(_n.textSizeData,pt.zoom),Tn=h.aN(xn,1,Me.transform.zoom),Mi=tn(Nt,Me.transform,Tn),Cr=Ie.layout.get("icon-text-fit")!=="none"&&_n.hasIconData();if(cn){const Hr=Math.pow(2,pt.zoom-xn.tileID.overscaledZ),jr=Ft?(Qr,Pr)=>Ft.getElevation(zt,Qr,Pr):null;Gl(_n,Nt,Ot,Ve,pt,Mi,Hr,cn,Cr,h.aO(pt,xn,We,st),zt.toUnwrapped(),jr)}}})(Z,M,j,z,j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),W),j.paint.get("icon-opacity").constantOr(1)!==0&&Gc(M,z,j,Z,!1,j.paint.get("icon-translate"),j.paint.get("icon-translate-anchor"),j.layout.get("icon-rotation-alignment"),j.layout.get("icon-pitch-alignment"),j.layout.get("icon-keep-upright"),se,fe,J),j.paint.get("text-opacity").constantOr(1)!==0&&Gc(M,z,j,Z,!0,j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.layout.get("text-keep-upright"),se,fe,J),z.map.showCollisionBoxes&&(Js(M,z,j,Z,!0),Js(M,z,j,Z,!1))})(t,s,f,x,this.style.placement.variableOffsets,S):h.cn(f)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=j.paint.get("circle-opacity"),se=j.paint.get("circle-stroke-width"),fe=j.paint.get("circle-stroke-opacity"),Ce=!j.layout.get("circle-sort-key").isConstant();if(J.constantOr(1)===0&&(se.constantOr(1)===0||fe.constantOr(1)===0))return;const Me=M.context,Ie=Me.gl,Le=M.transform,$e=M.getDepthModeForSublayer(0,nt.ReadOnly),ze=wt.disabled,We=M.colorModeForRenderPass(),st=[],Ve=Le.getCircleRadiusCorrection();for(let pt=0;pt<Z.length;pt++){const Ft=Z[pt],Nt=z.getTile(Ft),Ot=Nt.getBucket(j);if(!Ot)continue;const zt=j.paint.get("circle-translate"),xn=j.paint.get("circle-translate-anchor"),_n=h.aO(Le,Nt,zt,xn),cn=Ot.programConfigurations.get(j.id),Tn=M.useProgram("circle",cn),Mi=Ot.layoutVertexBuffer,Cr=Ot.indexBuffer,Hr=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Ft),jr={programConfiguration:cn,program:Tn,layoutVertexBuffer:Mi,indexBuffer:Cr,uniformValues:pc(M,Nt,j,_n,Ve),terrainData:Hr,projectionData:Le.getProjectionData({overscaledTileID:Ft,applyGlobeMatrix:!ee,applyTerrainMatrix:!0})};if(Ce){const Qr=Ot.segments.get();for(const Pr of Qr)st.push({segments:new h.aX([Pr]),sortKey:Pr.sortKey,state:jr})}else st.push({segments:Ot.segments,sortKey:0,state:jr})}Ce&&st.sort(((pt,Ft)=>pt.sortKey-Ft.sortKey));for(const pt of st){const{programConfiguration:Ft,program:Nt,layoutVertexBuffer:Ot,indexBuffer:zt,uniformValues:xn,terrainData:_n,projectionData:cn}=pt.state;Nt.draw(Me,Ie.TRIANGLES,$e,ze,We,et.backCCW,xn,_n,cn,j.id,Ot,zt,pt.segments,j.paint,M.transform.zoom,Ft)}})(t,s,f,x,S):h.co(f)?(function(M,z,j,Z,W){if(j.paint.get("heatmap-opacity")===0)return;const ee=M.context,{isRenderingToTexture:J,isRenderingGlobe:se}=W;if(M.style.map.terrain){for(const fe of Z){const Ce=z.getTile(fe);z.hasRenderableParent(fe)||(M.renderPass==="offscreen"?Wd(M,Ce,j,fe,se):M.renderPass==="translucent"&&ea(M,j,fe,J,se))}ee.viewport.set([0,0,M.width,M.height])}else M.renderPass==="offscreen"?(function(fe,Ce,Me,Ie){const Le=fe.context,$e=Le.gl,ze=fe.transform,We=wt.disabled,st=new hr([$e.ONE,$e.ONE],h.bp.transparent,[!0,!0,!0,!0]);(function(Ve,pt,Ft){const Nt=Ve.gl;Ve.activeTexture.set(Nt.TEXTURE1),Ve.viewport.set([0,0,pt.width/4,pt.height/4]);let Ot=Ft.heatmapFbos.get(h.cd);Ot?(Nt.bindTexture(Nt.TEXTURE_2D,Ot.colorAttachment.get()),Ve.bindFramebuffer.set(Ot.framebuffer)):(Ot=Fr(Ve,pt.width/4,pt.height/4),Ft.heatmapFbos.set(h.cd,Ot))})(Le,fe,Me),Le.clear({color:h.bp.transparent});for(let Ve=0;Ve<Ie.length;Ve++){const pt=Ie[Ve];if(Ce.hasRenderableParent(pt))continue;const Ft=Ce.getTile(pt),Nt=Ft.getBucket(Me);if(!Nt)continue;const Ot=Nt.programConfigurations.get(Me.id),zt=fe.useProgram("heatmap",Ot),xn=ze.getProjectionData({overscaledTileID:pt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),_n=ze.getCircleRadiusCorrection();zt.draw(Le,$e.TRIANGLES,nt.disabled,We,st,et.backCCW,Ua(Ft,ze.zoom,Me.paint.get("heatmap-intensity"),_n),null,xn,Me.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,Me.paint,ze.zoom,Ot)}Le.viewport.set([0,0,fe.width,fe.height])})(M,z,j,Z):M.renderPass==="translucent"&&(function(fe,Ce){const Me=fe.context,Ie=Me.gl;Me.setColorMode(fe.colorModeForRenderPass());const Le=Ce.heatmapFbos.get(h.cd);Le&&(Me.activeTexture.set(Ie.TEXTURE0),Ie.bindTexture(Ie.TEXTURE_2D,Le.colorAttachment.get()),Me.activeTexture.set(Ie.TEXTURE1),ir(Me,Ce).bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),fe.useProgram("heatmapTexture").draw(Me,Ie.TRIANGLES,nt.disabled,wt.disabled,fe.colorModeForRenderPass(),et.disabled,ar(fe,Ce,0,1),null,null,Ce.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments,Ce.paint,fe.transform.zoom))})(M,j)})(t,s,f,x,S):h.cp(f)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=j.paint.get("line-opacity"),se=j.paint.get("line-width");if(J.constantOr(1)===0||se.constantOr(1)===0)return;const fe=M.getDepthModeForSublayer(0,nt.ReadOnly),Ce=M.colorModeForRenderPass(),Me=j.paint.get("line-dasharray"),Ie=Me.constantOr(1),Le=j.paint.get("line-pattern"),$e=Le.constantOr(1),ze=j.paint.get("line-gradient"),We=j.getCrossfadeParameters();let st;st=$e?"linePattern":Ie&&ze?"lineGradientSDF":Ie?"lineSDF":ze?"lineGradient":"line";const Ve=M.context,pt=Ve.gl,Ft=M.transform;let Nt=!0;for(const Ot of Z){const zt=z.getTile(Ot);if($e&&!zt.patternsLoaded())continue;const xn=zt.getBucket(j);if(!xn)continue;const _n=xn.programConfigurations.get(j.id),cn=M.context.program.get(),Tn=M.useProgram(st,_n),Mi=Nt||Tn.program!==cn,Cr=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Ot),Hr=Le.constantOr(null),jr=Me&&Me.constantOr(null);if(Hr&&zt.imageAtlas){const ta=zt.imageAtlas,ms=ta.patternPositions[Hr.to.toString()],ys=ta.patternPositions[Hr.from.toString()];ms&&ys&&_n.setConstantPatternPositions(ms,ys)}else if(jr){const ta=j.layout.get("line-cap")==="round",ms=M.lineAtlas.getDash(jr.to,ta),ys=M.lineAtlas.getDash(jr.from,ta);_n.setConstantDashPositions(ms,ys)}const Qr=Ft.getProjectionData({overscaledTileID:Ot,applyGlobeMatrix:!ee,applyTerrainMatrix:!0}),Pr=Ft.getPixelScale();let ds;$e?(ds=w(M,zt,j,Pr,We),lo(Ve,pt,zt,_n,We)):Ie&&ze?(ds=O(M,zt,j,Pr,We,xn.lineClipsArray.length),Ha(M,z,Ve,pt,j,xn,Ot,_n,We)):Ie?(ds=I(M,zt,j,Pr,We),us(M,Ve,pt,_n,Mi,We)):ze?(ds=v(M,zt,j,Pr,xn.lineClipsArray.length),Ga(M,z,Ve,pt,j,xn,Ot)):ds=g(M,zt,j,Pr);const Jr=M.stencilModeForClipping(Ot);Tn.draw(Ve,pt.TRIANGLES,fe,Jr,Ce,et.disabled,ds,Cr,Qr,j.id,xn.layoutVertexBuffer,xn.indexBuffer,xn.segments,j.paint,M.transform.zoom,_n,xn.layoutVertexBuffer2),Nt=!1}})(t,s,f,x,S):h.cq(f)?(function(M,z,j,Z,W){const ee=j.paint.get("fill-color"),J=j.paint.get("fill-opacity");if(J.constantOr(1)===0)return;const{isRenderingToTexture:se}=W,fe=M.colorModeForRenderPass(),Ce=j.paint.get("fill-pattern"),Me=M.opaquePassEnabledForLayer()&&!Ce.constantOr(1)&&ee.constantOr(h.bp.transparent).a===1&&J.constantOr(0)===1?"opaque":"translucent";if(M.renderPass===Me){const Ie=M.getDepthModeForSublayer(1,M.renderPass==="opaque"?nt.ReadWrite:nt.ReadOnly);gl(M,z,j,Z,Ie,fe,!1,se)}if(M.renderPass==="translucent"&&j.paint.get("fill-antialias")){const Ie=M.getDepthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,nt.ReadOnly);gl(M,z,j,Z,Ie,fe,!0,se)}})(t,s,f,x,S):h.cr(f)?(function(M,z,j,Z,W){const ee=j.paint.get("fill-extrusion-opacity");if(ee===0)return;const{isRenderingToTexture:J}=W;if(M.renderPass==="translucent"){const se=new nt(M.context.gl.LEQUAL,nt.ReadWrite,M.depthRangeFor3D);if(ee!==1||j.paint.get("fill-extrusion-pattern").constantOr(1))ml(M,z,j,Z,se,wt.disabled,hr.disabled,J),ml(M,z,j,Z,se,M.stencilModeFor3D(),M.colorModeForRenderPass(),J);else{const fe=M.colorModeForRenderPass();ml(M,z,j,Z,se,wt.disabled,fe,J)}}})(t,s,f,x,S):h.cs(f)?(function(M,z,j,Z,W){if(M.renderPass!=="offscreen"&&M.renderPass!=="translucent")return;const{isRenderingToTexture:ee}=W,J=M.context,se=M.style.projection.useSubdivision,fe=M.getDepthModeForSublayer(0,nt.ReadOnly),Ce=M.colorModeForRenderPass();if(M.renderPass==="offscreen")(function(Me,Ie,Le,$e,ze,We,st){const Ve=Me.context,pt=Ve.gl;for(const Ft of Le){const Nt=Ie.getTile(Ft),Ot=Nt.dem;if(!Ot||!Ot.data||!Nt.needsHillshadePrepare)continue;const zt=Ot.dim,xn=Ot.stride,_n=Ot.getPixels();if(Ve.activeTexture.set(pt.TEXTURE1),Ve.pixelStoreUnpackPremultiplyAlpha.set(!1),Nt.demTexture=Nt.demTexture||Me.getTileTexture(xn),Nt.demTexture){const Tn=Nt.demTexture;Tn.update(_n,{premultiply:!1}),Tn.bind(pt.NEAREST,pt.CLAMP_TO_EDGE)}else Nt.demTexture=new h.T(Ve,_n,pt.RGBA,{premultiply:!1}),Nt.demTexture.bind(pt.NEAREST,pt.CLAMP_TO_EDGE);Ve.activeTexture.set(pt.TEXTURE0);let cn=Nt.fbo;if(!cn){const Tn=new h.T(Ve,{width:zt,height:zt,data:null},pt.RGBA);Tn.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),cn=Nt.fbo=Ve.createFramebuffer(zt,zt,!0,!1),cn.colorAttachment.set(Tn.texture)}Ve.bindFramebuffer.set(cn.framebuffer),Ve.viewport.set([0,0,zt,zt]),Me.useProgram("hillshadePrepare").draw(Ve,pt.TRIANGLES,ze,We,st,et.disabled,ce(Nt.tileID,Ot),null,null,$e.id,Me.rasterBoundsBuffer,Me.quadTriangleIndexBuffer,Me.rasterBoundsSegments),Nt.needsHillshadePrepare=!1}})(M,z,Z,j,fe,wt.disabled,Ce),J.viewport.set([0,0,M.width,M.height]);else if(M.renderPass==="translucent")if(se){const[Me,Ie,Le]=M.stencilConfigForOverlapTwoPass(Z);yl(M,z,j,Le,Me,fe,Ce,!1,ee),yl(M,z,j,Le,Ie,fe,Ce,!0,ee)}else{const[Me,Ie]=M.getStencilConfigForOverlapAndUpdateStencilID(Z);yl(M,z,j,Ie,Me,fe,Ce,!1,ee)}})(t,s,f,x,S):h.ct(f)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent"||!Z.length)return;const{isRenderingToTexture:ee}=W,J=M.style.projection.useSubdivision,se=M.getDepthModeForSublayer(0,nt.ReadOnly),fe=M.colorModeForRenderPass();if(J){const[Ce,Me,Ie]=M.stencilConfigForOverlapTwoPass(Z);ql(M,z,j,Ie,Ce,se,fe,!1,ee),ql(M,z,j,Ie,Me,se,fe,!0,ee)}else{const[Ce,Me]=M.getStencilConfigForOverlapAndUpdateStencilID(Z);ql(M,z,j,Me,Ce,se,fe,!1,ee)}})(t,s,f,x,S):h.bU(f)?(function(M,z,j,Z,W){if(M.renderPass!=="translucent"||j.paint.get("raster-opacity")===0||!Z.length)return;const{isRenderingToTexture:ee}=W,J=z.getSource(),se=M.style.projection.useSubdivision;if(J instanceof yr)Co(M,z,j,Z,null,!1,!1,J.tileCoords,J.flippedWindingOrder,ee);else if(se){const[fe,Ce,Me]=M.stencilConfigForOverlapTwoPass(Z);Co(M,z,j,Me,fe,!1,!0,Zl,!1,ee),Co(M,z,j,Me,Ce,!0,!0,Zl,!1,ee)}else{const[fe,Ce]=M.getStencilConfigForOverlapAndUpdateStencilID(Z);Co(M,z,j,Ce,fe,!1,!0,Zl,!1,ee)}})(t,s,f,x,S):h.cu(f)?(function(M,z,j,Z,W){const ee=j.paint.get("background-color"),J=j.paint.get("background-opacity");if(J===0)return;const{isRenderingToTexture:se}=W,fe=M.context,Ce=fe.gl,Me=M.style.projection,Ie=M.transform,Le=Ie.tileSize,$e=j.paint.get("background-pattern");if(M.isPatternMissing($e))return;const ze=!$e&&ee.a===1&&J===1&&M.opaquePassEnabledForLayer()?"opaque":"translucent";if(M.renderPass!==ze)return;const We=wt.disabled,st=M.getDepthModeForSublayer(0,ze==="opaque"?nt.ReadWrite:nt.ReadOnly),Ve=M.colorModeForRenderPass(),pt=M.useProgram($e?"backgroundPattern":"background"),Ft=Z||jn(Ie,{tileSize:Le,terrain:M.style.map.terrain});$e&&(fe.activeTexture.set(Ce.TEXTURE0),M.imageManager.bind(M.context));const Nt=j.getCrossfadeParameters();for(const Ot of Ft){const zt=Ie.getProjectionData({overscaledTileID:Ot,applyGlobeMatrix:!se,applyTerrainMatrix:!0}),xn=$e?Rt(J,M,$e,{tileID:Ot,tileSize:Le},Nt):ft(J,ee),_n=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Ot),cn=Me.getMeshFromTileID(fe,Ot.canonical,!1,!0,"raster");pt.draw(fe,Ce.TRIANGLES,st,We,Ve,et.backCCW,xn,_n,zt,j.id,cn.vertexBuffer,cn.indexBuffer,cn.segments)}})(t,0,f,x,S):h.cv(f)&&(function(M,z,j,Z){const{isRenderingGlobe:W}=Z,ee=M.context,J=j.implementation,se=M.style.projection,fe=M.transform,Ce=fe.getProjectionDataForCustomLayer(W),Me={farZ:fe.farZ,nearZ:fe.nearZ,fov:fe.fov*Math.PI/180,modelViewProjectionMatrix:fe.modelViewProjectionMatrix,projectionMatrix:fe.projectionMatrix,shaderData:{variantName:se.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${se.shaderPreludeCode.vertexSource}`,define:se.shaderDefine},defaultProjectionData:Ce},Ie=J.renderingMode?J.renderingMode:"2d";if(M.renderPass==="offscreen"){const Le=J.prerender;Le&&(M.setCustomLayerDefaults(),ee.setColorMode(M.colorModeForRenderPass()),Le.call(J,ee.gl,Me),ee.setDirty(),M.setBaseState())}else if(M.renderPass==="translucent"){M.setCustomLayerDefaults(),ee.setColorMode(M.colorModeForRenderPass()),ee.setStencilMode(wt.disabled);const Le=Ie==="3d"?M.getDepthModeFor3D():M.getDepthModeForSublayer(0,nt.ReadOnly);ee.setDepthMode(Le),J.render(ee.gl,Me),ee.setDirty(),M.setBaseState(),ee.bindFramebuffer.set(null)}})(t,0,f,S))}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),f=this.imageManager.getPattern(t.to.toString());return!s||!f}useProgram(t,s,f=!1,x=[]){this.cache=this.cache||{};const S=!!this.style.map.terrain,M=this.style.projection,z=f?nr.projectionMercator:M.shaderPreludeCode,j=f?Ui:M.shaderDefine,Z=t+(s?s.cacheKey:"")+`/${f?qs:M.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(S?"/terrain":"")+(x?`/${x.join("/")}`:"");return this.cache[Z]||(this.cache[Z]=new Bc(this.context,nr[t],s,An[t],this._showOverdrawInspector,S,z,j,x)),this.cache[Z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,s;if(this._tileTextures){for(const f in this._tileTextures){const x=this._tileTextures[f];if(x)for(const S of x)S.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((s=this.tileExtentMesh.indexBuffer)===null||s===void 0||s.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const f in this.cache){const x=this.cache[f];x&&x.program&&this.context.gl.deleteProgram(x.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}function $d(A,t){let s,f=!1,x=null,S=null;const M=()=>{x=null,f&&(A.apply(S,s),x=setTimeout(M,t),f=!1)};return(...z)=>(f=!0,S=this,s=z,x||M(),x)}class As{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let f;return s.split("&").map((x=>x.split("="))).forEach((x=>{x[0]===this._hashName&&(f=x)})),(f&&f[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:f,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const f=s.join("/");let x=f;x.split("&").length>0&&(x=x.split("&")[0]),this._hashName&&(x=`${this._hashName}=${f}`);let S=window.location.hash.replace(x,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let M=window.location.href.replace(/(#.+)?$/,S);M=M.replace("&&","&"),window.history.replaceState(window.history.state,null,M)},this._updateHash=$d(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,x=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),M=Math.round(s.lng*S)/S,z=Math.round(s.lat*S)/S,j=this._map.getBearing(),Z=this._map.getPitch();let W="";if(W+=t?`/${M}/${z}/${f}`:`${f}/${z}/${M}`,(j||Z)&&(W+="/"+Math.round(10*j)/10),Z&&(W+=`/${Math.round(Z)}`),this._hashName){const ee=this._hashName;let J=!1;const se=window.location.hash.slice(1).split("&").map((fe=>{const Ce=fe.split("=")[0];return Ce===ee?(J=!0,`${Ce}=${W}`):fe})).filter((fe=>fe));return J||se.push(`${ee}=${W}`),`#${se.join("&")}`}return`#${W}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new h.V(+t[2],+t[1])}catch{return!1}const s=+t[0],f=+(t[3]||0),x=+(t[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&f>=-180&&f<=180&&x>=this._map.getMinPitch()&&x<=this._map.getMaxPitch()}}const bl={linearity:.3,easing:h.cw(0,0,.3,1)},Su=h.e({deceleration:2500,maxSpeed:1400},bl),Aa=h.e({deceleration:20,maxSpeed:1400},bl),uo=h.e({deceleration:1e3,maxSpeed:360},bl),Hc=h.e({deceleration:1e3,maxSpeed:90},bl),Ea=h.e({deceleration:1e3,maxSpeed:360},bl);class A0{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:pe(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=pe();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)s.zoom+=S.zoomDelta||0,s.bearing+=S.bearingDelta||0,s.pitch+=S.pitchDelta||0,s.roll+=S.rollDelta||0,S.panDelta&&s.pan._add(S.panDelta),S.around&&(s.around=S.around),S.pinchAround&&(s.pinchAround=S.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(s.pan.mag()){const S=ch(s.pan.mag(),f,h.e({},Su,t||{})),M=s.pan.mult(S.amount/s.pan.mag()),z=this._map.cameraHelper.handlePanInertia(M,this._map.transform);x.center=z.easingCenter,x.offset=z.easingOffset,Cu(x,S)}if(s.zoom){const S=ch(s.zoom,f,Aa);x.zoom=this._map.transform.zoom+S.amount,Cu(x,S)}if(s.bearing){const S=ch(s.bearing,f,uo);x.bearing=this._map.transform.bearing+h.an(S.amount,-179,179),Cu(x,S)}if(s.pitch){const S=ch(s.pitch,f,Hc);x.pitch=this._map.transform.pitch+S.amount,Cu(x,S)}if(s.roll){const S=ch(s.roll,f,Ea);x.roll=this._map.transform.roll+h.an(S.amount,-179,179),Cu(x,S)}if(x.zoom||x.bearing){const S=s.pinchAround===void 0?s.around:s.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),h.e(x,{noMoveStart:!0})}}function Cu(A,t){(!A.duration||A.duration<t.duration)&&(A.duration=t.duration,A.easing=t.easing)}function ch(A,t,s){const{maxSpeed:f,linearity:x,deceleration:S}=s,M=h.an(A*x/(t/1e3),-f,f),z=Math.abs(M)/(S*x);return{easing:s.easing,duration:1e3*z,amount:M*(z/2)}}class $s extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f,x={}){f=f instanceof MouseEvent?f:new MouseEvent(t,f);const S=he.mousePos(s.getCanvas(),f),M=s.unproject(S);super(t,h.e({point:S,lngLat:M,originalEvent:f},x)),this._defaultPrevented=!1,this.target=s}}class Go extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f){const x=t==="touchend"?f.changedTouches:f.touches,S=he.touchPos(s.getCanvasContainer(),x),M=S.map((j=>s.unproject(j))),z=S.reduce(((j,Z,W,ee)=>j.add(Z.div(ee.length))),new h.P(0,0));super(t,{points:S,point:z,lngLats:M,lngLat:s.unproject(z),originalEvent:f}),this._defaultPrevented=!1}}class ed extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f){super(t,{originalEvent:f}),this._defaultPrevented=!1}}class td{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ed(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new $s(t.type,this._map,t))}mouseup(t){this._map.fire(new $s(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new $s(t.type,this._map,t))}dblclick(t){return this._firePreventable(new $s(t.type,this._map,t))}mouseover(t){this._map.fire(new $s(t.type,this._map,t))}mouseout(t){this._map.fire(new $s(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Go(t.type,this._map,t))}touchmove(t){this._map.fire(new Go(t.type,this._map,t))}touchend(t){this._map.fire(new Go(t.type,this._map,t))}touchcancel(t){this._map.fire(new Go(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new $s(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $s("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new $s(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ho{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(h.P.convert(t),this._map.terrain)}}class vc{constructor(t,s){this._map=t,this._tr=new Ho(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(he.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const f=s;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=f,this._box||(this._box=he.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(x.x,f.x),M=Math.max(x.x,f.x),z=Math.min(x.y,f.y),j=Math.max(x.y,f.y);he.setTransform(this._box,`translate(${S}px,${z}px)`),this._box.style.width=M-S+"px",this._box.style.height=j-z+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const f=this._startPos,x=s;if(this.reset(),he.suppressClick(),f.x!==x.x||f.y!==x.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:t})),{cameraAnimation:S=>S.fitScreenCoordinates(f,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new h.l(t,{originalEvent:s}))}}function qa(A,t){if(A.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${A.length}, points ${t.length}`);const s={};for(let f=0;f<A.length;f++)s[A[f].identifier]=t[f];return s}class On{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=(function(x){const S=new h.P(0,0);for(const M of x)S._add(M);return S.div(x.length)})(s),this.touches=qa(f,s)))}touchmove(t,s,f){if(this.aborted||!this.centroid)return;const x=qa(f,s);for(const S in this.touches){const M=x[S];(!M||M.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(t,s,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class uh{constructor(t){this.singleTap=new On(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,f){this.singleTap.touchstart(t,s,f)}touchmove(t,s,f){this.singleTap.touchmove(t,s,f)}touchend(t,s,f){const x=this.singleTap.touchend(t,s,f);if(x){const S=t.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(x)<30;if(S&&M||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class nd{constructor(t){this._tr=new Ho(t),this._zoomIn=new uh({numTouches:1,numTaps:2}),this._zoomOut=new uh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,f){this._zoomIn.touchstart(t,s,f),this._zoomOut.touchstart(t,s,f)}touchmove(t,s,f){this._zoomIn.touchmove(t,s,f),this._zoomOut.touchmove(t,s,f)}touchend(t,s,f){const x=this._zoomIn.touchend(t,s,f),S=this._zoomOut.touchend(t,s,f),M=this._tr;return x?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(x)},{originalEvent:t})}):S?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(S)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class To{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const x=Array.isArray(s)?s[0]:s;return!this._moved&&x.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(f,x))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&he.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const qo=0,Tu=2,id={[qo]:1,[Tu]:2};class vl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=he.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(s,f){const x=id[f];return s.buttons===void 0||(s.buttons&x)!==x})(t,this._eventButton)}isValidEndEvent(t){return he.mouseButton(t)===this._eventButton}}class qc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class hh{constructor(t=new vl({checkCorrectEvent:()=>!0}),s=new qc){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(t,s,f){return t instanceof MouseEvent?s(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?f(t):void 0}startMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.startMove(s)),(s=>this.oneFingerTouchMoveStateManager.startMove(s)))}endMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.endMove(s)),(s=>this.oneFingerTouchMoveStateManager.endMove(s)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidStartEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidMoveEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidEndEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s)))}}const wl=A=>{A.mousedown=A.dragStart,A.mousemoveWindow=A.dragMove,A.mouseup=A.dragEnd,A.contextmenu=t=>{t.preventDefault()}};class rd{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,f){return this._calculateTransform(t,s,f)}touchmove(t,s,f){if(this._active){if(!this._shouldBePrevented(f.length))return t.preventDefault(),this._calculateTransform(t,s,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,f){this._calculateTransform(t,s,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,f){f.length>0&&(this._active=!0);const x=qa(f,s),S=new h.P(0,0),M=new h.P(0,0);let z=0;for(const Z in x){const W=x[Z],ee=this._touches[Z];ee&&(S._add(W),M._add(W.sub(ee)),z++,x[Z]=W)}if(this._touches=x,this._shouldBePrevented(z)||!M.mag())return;const j=M.div(z);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(z),panDelta:j}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,f){if(!this._firstTwoTouches)return;t.preventDefault();const[x,S]=this._firstTwoTouches,M=Al(f,s,x),z=Al(f,s,S);if(!M||!z)return;const j=this._aroundCenter?null:M.add(z).div(2);return this._move([M,z],j,t)}touchend(t,s,f){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,M=Al(f,s,x),z=Al(f,s,S);M&&z||(this._active&&he.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Al(A,t,s){for(let f=0;f<A.length;f++)if(A[f].identifier===s)return t[f]}function Kd(A,t){return Math.log(A/t)/Math.LN2}class El extends dh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Kd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kd(this._distance,f),pinchAround:s}}}function sd(A,t){return 180*A.angleWith(t)/Math.PI}class fh extends dh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,f){const x=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:sd(this._vector,x),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,f=sd(t,this._startVector);return Math.abs(f)<s}}function Sl(A){return Math.abs(A.y)>Math.abs(A.x)}class Yl extends dh{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,f){super.touchstart(t,s,f),this._currentTouchCount=f.length}_start(t){this._lastPoints=t,Sl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=t[0].sub(this._lastPoints[0]),S=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,S,f.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,f){if(this._valid!==void 0)return this._valid;const x=t.mag()>=2,S=s.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const M=t.y>0==s.y>0;return Sl(t)&&Sl(s)&&M}}const Io={panStep:100,bearingStep:15,pitchStep:10};class Ir{constructor(t){this._tr=new Ho(t);const s=Io;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,f=0,x=0,S=0,M=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),S=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),S=1);break;case 38:t.shiftKey?x=1:(t.preventDefault(),M=-1);break;case 40:t.shiftKey?x=-1:(t.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(f=0,x=0),{cameraAnimation:z=>{const j=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:Qd,zoom:s?Math.round(j.zoom)+s*(t.shiftKey?2:1):j.zoom,bearing:j.bearing+f*this._bearingStep,pitch:j.pitch+x*this._pitchStep,offset:[-S*this._panStep,-M*this._panStep],center:j.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qd(A){return A*(2-A)}const $l=4.000244140625,wc=1/450;class ph{constructor(t,s){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=t,this._tr=new Ho(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=wc}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=pe(),x=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,s!==0&&s%$l==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(x*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=he.mousePos(this._map.getCanvas(),t),f=this._tr;this._aroundPoint=this._aroundCenter?f.transform.locationToScreenPoint(h.V.convert(f.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const z=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=z),typeof this._targetZoom=="number"&&(this._targetZoom+=z)}if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>$l?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&j!==0&&(j=1/j);const Z=typeof this._targetZoom!="number"?t.scale:h.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),h.at(Z*j)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,f=this._startZoom,x=this._easing;let S,M=!1;if(this._type==="wheel"&&f&&x){const z=pe()-this._lastWheelEventTime,j=Math.min((z+5)/200,1),Z=x(j);S=h.G.number(f,s,Z),j<1?this._frameId||(this._frameId=!0):M=!0}else S=s,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!M,zoomDelta:S-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=h.cy;if(this._prevEase){const f=this._prevEase,x=(pe()-f.start)/f.duration,S=f.easing(x+.01)-f.easing(x),M=.27/Math.sqrt(S*S+1e-4)*.01,z=Math.sqrt(.0729-M*M);s=h.cw(M,z,.25,1)}return this._prevEase={start:pe(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ad{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zc{constructor(t){this._tr=new Ho(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gh{constructor(){this._tap=new uh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,f){if(!this._swipePoint)if(this._tapTime){const x=s[0],S=t.timeStamp-this._tapTime<500,M=this._tapPoint.dist(x)<30;S&&M?f.length>0&&(this._swipePoint=x,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(t,s,f)}touchmove(t,s,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const x=s[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,t.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(t,s,f)}touchend(t,s,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const x=this._tap.touchend(t,s,f);x&&(this._tapTime=t.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jd{constructor(t,s,f){this._el=t,this._mousePan=s,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ho{constructor(t,s,f,x){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=s,this._mousePitch=f,this._mouseRoll=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Xc{constructor(t,s,f,x){this._el=t,this._touchZoom=s,this._touchRotate=f,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Bn{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=he.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=s,this._container.appendChild(x);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=f,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(he.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ei=A=>A.zoom||A.drag||A.roll||A.pitch||A.rotate;class Mo extends h.l{}function Iu(A){return A.panDelta&&A.panDelta.mag()||A.zoomDelta||A.bearingDelta||A.pitchDelta||A.rollDelta}class mh{constructor(t,s){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,S)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=x.type==="renderFrame"?void 0:x,z={needsRenderFrame:!1},j={},Z={};for(const{handlerName:J,handler:se,allowed:fe}of this._handlers){if(!se.isEnabled())continue;let Ce;if(this._blockedByActive(Z,fe,J))se.reset();else if(se[S||x.type]){if(h.cz(x,S||x.type)){const Me=he.mousePos(this._map.getCanvas(),x);Ce=se[S||x.type](x,Me)}else if(h.cA(x,S||x.type)){const Me=this._getMapTouches(x.touches),Ie=he.touchPos(this._map.getCanvas(),Me);Ce=se[S||x.type](x,Ie,Me)}else h.cB(S||x.type)||(Ce=se[S||x.type](x));this.mergeHandlerResult(z,j,Ce,J,M),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()}(Ce||se.isActive())&&(Z[J]=se)}const W={};for(const J in this._previousActiveHandlers)Z[J]||(W[J]=M);this._previousActiveHandlers=Z,(Object.keys(W).length||Iu(z))&&(this._changes.push([z,j,W]),this._triggerRenderFrame()),(Object.keys(Z).length||Iu(z))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=z;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new A0(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,M]of this._listeners)he.addEventListener(x,S,x===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[t,s,f]of this._listeners)he.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(t){const s=this._map,f=s.getCanvasContainer();this._add("mapEvent",new td(s,t));const x=s.boxZoom=new vc(s,t);this._add("boxZoom",x),t.interactive&&t.boxZoom&&x.enable();const S=s.cooperativeGestures=new Bn(s,t.cooperativeGestures);this._add("cooperativeGestures",S),t.cooperativeGestures&&S.enable();const M=new nd(s),z=new Zc(s);s.doubleClickZoom=new ad(z,M),this._add("tapZoom",M),this._add("clickZoom",z),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const j=new gh;this._add("tapDragZoom",j);const Z=s.touchPitch=new Yl(s);this._add("touchPitch",Z),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const W=()=>s.project(s.getCenter()),ee=(function({enable:ze,clickTolerance:We,aroundCenter:st=!0,minPixelCenterThreshold:Ve=100,rotateDegreesPerPixelMoved:pt=.8},Ft){const Nt=new vl({checkCorrectEvent:Ot=>he.mouseButton(Ot)===0&&Ot.ctrlKey||he.mouseButton(Ot)===2&&!Ot.ctrlKey});return new To({clickTolerance:We,move:(Ot,zt)=>{const xn=Ft();if(st&&Math.abs(xn.y-Ot.y)>Ve)return{bearingDelta:h.cx(new h.P(Ot.x,zt.y),zt,xn)};let _n=(zt.x-Ot.x)*pt;return st&&zt.y<xn.y&&(_n=-_n),{bearingDelta:_n}},moveStateManager:Nt,enable:ze,assignEvents:wl})})(t,W),J=(function({enable:ze,clickTolerance:We,pitchDegreesPerPixelMoved:st=-.5}){const Ve=new vl({checkCorrectEvent:pt=>he.mouseButton(pt)===0&&pt.ctrlKey||he.mouseButton(pt)===2});return new To({clickTolerance:We,move:(pt,Ft)=>({pitchDelta:(Ft.y-pt.y)*st}),moveStateManager:Ve,enable:ze,assignEvents:wl})})(t),se=(function({enable:ze,clickTolerance:We,rollDegreesPerPixelMoved:st=.3},Ve){const pt=new vl({checkCorrectEvent:Ft=>he.mouseButton(Ft)===2&&Ft.ctrlKey});return new To({clickTolerance:We,move:(Ft,Nt)=>{const Ot=Ve();let zt=(Nt.x-Ft.x)*st;return Nt.y<Ot.y&&(zt=-zt),{rollDelta:zt}},moveStateManager:pt,enable:ze,assignEvents:wl})})(t,W);s.dragRotate=new ho(t,ee,J,se),this._add("mouseRotate",ee,["mousePitch"]),this._add("mousePitch",J,["mouseRotate","mouseRoll"]),this._add("mouseRoll",se,["mousePitch"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const fe=(function({enable:ze,clickTolerance:We}){const st=new vl({checkCorrectEvent:Ve=>he.mouseButton(Ve)===0&&!Ve.ctrlKey});return new To({clickTolerance:We,move:(Ve,pt)=>({around:pt,panDelta:pt.sub(Ve)}),activateOnStart:!0,moveStateManager:st,enable:ze,assignEvents:wl})})(t),Ce=new rd(t,s);s.dragPan=new Jd(f,fe,Ce),this._add("mousePan",fe),this._add("touchPan",Ce,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const Me=new fh,Ie=new El;s.touchZoomRotate=new Xc(f,Ie,Me,j),this._add("touchRotate",Me,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new lp(s));const Le=s.scrollZoom=new ph(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Le,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const $e=s.keyboard=new Ir(s);this._add("keyboard",$e),t.interactive&&t.keyboard&&s.keyboard.enable()}_add(t,s,f){this._handlers.push({handlerName:t,handler:s,allowed:f}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ei(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,f){for(const x in t)if(x!==f&&(!s||s.indexOf(x)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const f of t)this._el.contains(f.target)&&s.push(f);return s}mergeHandlerResult(t,s,f,x,S){if(!f)return;h.e(t,f);const M={handlerName:x,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(s.zoom=M),f.panDelta!==void 0&&(s.drag=M),f.rollDelta!==void 0&&(s.roll=M),f.pitchDelta!==void 0&&(s.pitch=M),f.bearingDelta!==void 0&&(s.rotate=M)}_applyChanges(){const t={},s={},f={};for(const[x,S,M]of this._changes)x.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(x.panDelta)),x.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+x.pitchDelta),x.rollDelta&&(t.rollDelta=(t.rollDelta||0)+x.rollDelta),x.around!==void 0&&(t.around=x.around),x.pinchAround!==void 0&&(t.pinchAround=x.pinchAround),x.noInertia&&(t.noInertia=x.noInertia),h.e(s,S),h.e(f,M);this._updateMapTransform(t,s,f),this._changes=[]}_updateMapTransform(t,s,f){const x=this._map,S=x._getTransformForUpdate(),M=x.terrain;if(!(Iu(t)||M&&this._terrainMovement))return this._fireEvents(s,f,!0);x._stop(!0);let{panDelta:z,zoomDelta:j,bearingDelta:Z,pitchDelta:W,rollDelta:ee,around:J,pinchAround:se}=t;se!==void 0&&(J=se),J=J||x.transform.centerPoint,M&&!S.isPointOnMapSurface(J)&&(J=S.centerPoint);const fe={panDelta:z,zoomDelta:j,rollDelta:ee,pitchDelta:W,bearingDelta:Z,around:J};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(J)&&(J=S.centerPoint);const Ce=J.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(z?J.sub(z):J);this._handleMapControls({terrain:M,tr:S,deltasForHelper:fe,preZoomAroundLoc:Ce,combinedEventsInProgress:s,panDelta:z}),x._applyUpdatedTransform(S),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,f,!0)}_handleMapControls({terrain:t,tr:s,deltasForHelper:f,preZoomAroundLoc:x,combinedEventsInProgress:S,panDelta:M}){const z=this._map.cameraHelper;if(z.handleMapControlsRollPitchBearingZoom(f,s),t)return z.useGlobeControls?(this._terrainMovement||!S.drag&&!S.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void z.handleMapControlsPan(f,s,x)):this._terrainMovement||!S.drag&&!S.zoom?void(S.drag&&this._terrainMovement&&M?s.setCenter(s.screenPointToLocation(s.centerPoint.sub(M))):z.handleMapControlsPan(f,s,x)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void z.handleMapControlsPan(f,s,x));z.handleMapControlsPan(f,s,x)}_fireEvents(t,s,f){const x=ei(this._eventsInProgress),S=ei(t),M={};for(const ee in t){const{originalEvent:J}=t[ee];this._eventsInProgress[ee]||(M[`${ee}start`]=J),this._eventsInProgress[ee]=t[ee]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const ee in M)this._fireEvent(ee,M[ee]);S&&this._fireEvent("move",S.originalEvent);for(const ee in t){const{originalEvent:J}=t[ee];this._fireEvent(ee,J)}const z={};let j;for(const ee in this._eventsInProgress){const{handlerName:J,originalEvent:se}=this._eventsInProgress[ee];this._handlersById[J].isActive()||(delete this._eventsInProgress[ee],j=s[J]||se,z[`${ee}end`]=j)}for(const ee in z)this._fireEvent(ee,z[ee]);const Z=ei(this._eventsInProgress),W=(x||S)&&!Z;if(W&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const ee=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ee.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ee)}if(f&&W){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;!ee||!ee.essential&&we.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:j})),J(this._map.getBearing())&&this._map.resetNorth()):(J(ee.bearing||this._map.getBearing())&&(ee.bearing=0),ee.freezeElevation=!0,this._map.easeTo(ee,{originalEvent:j})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new h.l(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Mo("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Es extends h.E{constructor(t,s,f){super(),this._renderFrameCallback=()=>{const x=Math.min((pe()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=f.bearingSnap,this.cameraHelper=s,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,s){t.apply(this.transform),this.transform=t,this.cameraHelper=s}getCenter(){return new h.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,s){return this.jumpTo({elevation:t},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,s,f){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},s),f)}panTo(t,s,f){return this.easeTo(h.e({center:t},s),f)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,f){return this.easeTo(h.e({zoom:t},s),f)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,s){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new h.l("movestart",s)).fire(new h.l("move",s)).fire(new h.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,f){return this.easeTo(h.e({bearing:t},s),f)}resetNorth(t,s){return this.rotateTo(0,h.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}getRoll(){return this.transform.roll}setRoll(t,s){return this.jumpTo({roll:t},s),this}cameraForBounds(t,s){t=Yn.convert(t).adjustAntiMeridian();const f=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),f,s)}_cameraForBoxAndBearing(t,s,f,x){const S={top:0,bottom:0,right:0,left:0};if(typeof(x=h.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const Z=x.padding;x.padding={top:Z,bottom:Z,right:Z,left:Z}}const M=h.e(S,x.padding);x.padding=M;const z=this.transform,j=new Yn(t,s);return this.cameraHelper.cameraForBoxAndBearing(x,M,j,f,z)}fitBounds(t,s,f){return this._fitInternal(this.cameraForBounds(t,s),s,f)}fitScreenCoordinates(t,s,f,x,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(t)),this.transform.screenPointToLocation(h.P.convert(s)),f,x),x,S)}_fitInternal(t,s,f){return t?(delete(s=h.e(t,s)).padding,s.linear?this.easeTo(s,f):this.flyTo(s,f)):this}jumpTo(t,s){this.stop();const f=this._getTransformForUpdate();let x=!1,S=!1,M=!1;const z=f.zoom;this.cameraHelper.handleJumpToCenterZoom(f,t);const j=f.zoom!==z;return"elevation"in t&&f.elevation!==+t.elevation&&f.setElevation(+t.elevation),"bearing"in t&&f.bearing!==+t.bearing&&(x=!0,f.setBearing(+t.bearing)),"pitch"in t&&f.pitch!==+t.pitch&&(S=!0,f.setPitch(+t.pitch)),"roll"in t&&f.roll!==+t.roll&&(M=!0,f.setRoll(+t.roll)),t.padding==null||f.isPaddingEqual(t.padding)||f.setPadding(t.padding),this._applyUpdatedTransform(f),this.fire(new h.l("movestart",s)).fire(new h.l("move",s)),j&&this.fire(new h.l("zoomstart",s)).fire(new h.l("zoom",s)).fire(new h.l("zoomend",s)),x&&this.fire(new h.l("rotatestart",s)).fire(new h.l("rotate",s)).fire(new h.l("rotateend",s)),S&&this.fire(new h.l("pitchstart",s)).fire(new h.l("pitch",s)).fire(new h.l("pitchend",s)),M&&this.fire(new h.l("rollstart",s)).fire(new h.l("roll",s)).fire(new h.l("rollend",s)),this.fire(new h.l("moveend",s))}calculateCameraOptionsFromTo(t,s,f,x=0){const S=h.a9.fromLngLat(t,s),M=h.a9.fromLngLat(f,x),z=M.x-S.x,j=M.y-S.y,Z=M.z-S.z,W=Math.hypot(z,j,Z);if(W===0)throw new Error("Can't calculate camera options with same From and To");const ee=Math.hypot(z,j),J=h.at(this.transform.cameraToCenterDistance/W/this.transform.tileSize),se=180*Math.atan2(z,-j)/Math.PI;let fe=180*Math.acos(ee/W)/Math.PI;return fe=Z<0?90-fe:90+fe,{center:M.toLngLat(),elevation:x,zoom:J,pitch:fe,bearing:se}}calculateCameraOptionsFromCameraLngLatAltRotation(t,s,f,x,S){const M=this.transform.calculateCenterFromCameraLngLatAlt(t,s,f,x);return{center:M.center,elevation:M.elevation,zoom:M.zoom,bearing:f,pitch:x,roll:S}}easeTo(t,s){this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.cy},t)).animate===!1||!t.essential&&we.prefersReducedMotion)&&(t.duration=0);const f=this._getTransformForUpdate(),x=this.getBearing(),S=f.pitch,M=f.roll,z="bearing"in t?this._normalizeBearing(t.bearing,x):x,j="pitch"in t?+t.pitch:S,Z="roll"in t?this._normalizeBearing(t.roll,M):M,W="padding"in t?t.padding:f.padding,ee=h.P.convert(t.offset);let J,se;t.around&&(J=h.V.convert(t.around),se=f.locationToScreenPoint(J));const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Ce=this.cameraHelper.handleEaseTo(f,{bearing:z,pitch:j,roll:Z,padding:W,around:J,aroundPoint:se,offsetAsPoint:ee,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||x!==z,this._pitching=this._pitching||j!==S,this._rolling=this._rolling||Z!==M,this._padding=!f.isPaddingEqual(W),this._zooming=this._zooming||Ce.isZooming,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,fe),this.terrain&&this._prepareElevation(Ce.elevationCenter),this._ease((Me=>{Ce.easeFunc(Me),this.terrain&&!t.freezeElevation&&this._updateElevation(Me),this._applyUpdatedTransform(f),this._fireMoveEvents(s)}),(Me=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Me)}),t),this}_prepareEase(t,s,f={}){this._moving=!0,s||f.moving||this.fire(new h.l("movestart",t)),this._zooming&&!f.zooming&&this.fire(new h.l("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new h.l("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new h.l("pitchstart",t)),this._rolling&&!f.rolling&&this.fire(new h.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(f-(s-(f*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.setElevation(h.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const s=t.getCameraLngLat(),f=t.getCameraAltitude(),x=this.terrain?this.terrain.getElevationForLngLatZoom(s,t.zoom):0;if(f<x){const S=this.calculateCameraOptionsFromTo(s,x,t.center,t.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(s.push((x=>this._elevateCameraIfInsideTerrain(x))),this.transformCameraUpdate&&s.push((x=>this.transformCameraUpdate(x))),!s.length)return;const f=t.clone();for(const x of s){const S=f.clone(),{center:M,zoom:z,roll:j,pitch:Z,bearing:W,elevation:ee}=x(S);M&&S.setCenter(M),ee!==void 0&&S.setElevation(ee),z!==void 0&&S.setZoom(z),j!==void 0&&S.setRoll(j),Z!==void 0&&S.setPitch(Z),W!==void 0&&S.setBearing(W),f.apply(S)}this.transform.apply(f)}_fireMoveEvents(t){this.fire(new h.l("move",t)),this._zooming&&this.fire(new h.l("zoom",t)),this._rotating&&this.fire(new h.l("rotate",t)),this._pitching&&this.fire(new h.l("pitch",t)),this._rolling&&this.fire(new h.l("roll",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const f=this._zooming,x=this._rotating,S=this._pitching,M=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,f&&this.fire(new h.l("zoomend",t)),x&&this.fire(new h.l("rotateend",t)),S&&this.fire(new h.l("pitchend",t)),M&&this.fire(new h.l("rollend",t)),this.fire(new h.l("moveend",t))}flyTo(t,s){if(!t.essential&&we.prefersReducedMotion){const zt=h.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(zt,s)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.cy},t);const f=this._getTransformForUpdate(),x=f.bearing,S=f.pitch,M=f.roll,z=f.padding,j="bearing"in t?this._normalizeBearing(t.bearing,x):x,Z="pitch"in t?+t.pitch:S,W="roll"in t?this._normalizeBearing(t.roll,M):M,ee="padding"in t?t.padding:f.padding,J=h.P.convert(t.offset);let se=f.centerPoint.add(J);const fe=f.screenPointToLocation(se),Ce=this.cameraHelper.handleFlyTo(f,{bearing:j,pitch:Z,roll:W,padding:ee,locationAtOffset:fe,offsetAsPoint:J,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Me=t.curve;const Ie=Math.max(f.width,f.height),Le=Ie/Ce.scaleOfZoom,$e=Ce.pixelPathLength;typeof Ce.scaleOfMinZoom=="number"&&(Me=Math.sqrt(Ie/Ce.scaleOfMinZoom/$e*2));const ze=Me*Me;function We(zt){const xn=(Le*Le-Ie*Ie+(zt?-1:1)*ze*ze*$e*$e)/(2*(zt?Le:Ie)*ze*$e);return Math.log(Math.sqrt(xn*xn+1)-xn)}function st(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function Ve(zt){return(Math.exp(zt)+Math.exp(-zt))/2}const pt=We(!1);let Ft=function(zt){return Ve(pt)/Ve(pt+Me*zt)},Nt=function(zt){return Ie*((Ve(pt)*(st(xn=pt+Me*zt)/Ve(xn))-st(pt))/ze)/$e;var xn},Ot=(We(!0)-pt)/Me;if(Math.abs($e)<2e-6||!isFinite(Ot)){if(Math.abs(Ie-Le)<1e-6)return this.easeTo(t,s);const zt=Le<Ie?-1:1;Ot=Math.abs(Math.log(Le/Ie))/Me,Nt=()=>0,Ft=xn=>Math.exp(zt*Me*xn)}return t.duration="duration"in t?+t.duration:1e3*Ot/("screenSpeed"in t?+t.screenSpeed/Me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=x!==j,this._pitching=Z!==S,this._rolling=W!==M,this._padding=!f.isPaddingEqual(ee),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Ce.targetCenter),this._ease((zt=>{const xn=zt*Ot,_n=1/Ft(xn),cn=Nt(xn);this._rotating&&f.setBearing(h.G.number(x,j,zt)),this._pitching&&f.setPitch(h.G.number(S,Z,zt)),this._rolling&&f.setRoll(h.G.number(M,W,zt)),this._padding&&(f.interpolatePadding(z,ee,zt),se=f.centerPoint.add(J)),Ce.easeFunc(zt,_n,cn,se),this.terrain&&!t.freezeElevation&&this._updateElevation(zt),this._applyUpdatedTransform(f),this._fireMoveEvents(s)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,s)}return t||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(t,s,f){f.animate===!1||f.duration===0?(t(1),s()):(this._easeStart=pe(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=h.W(t,-180,180);const f=Math.abs(t-s);return Math.abs(t-360-s)<f&&(t-=360),Math.abs(t+360-s)<f&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(h.V.convert(t),this.transform):null}}const hs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class gs{constructor(t=hs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=he.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=he.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const f=this._map._getUIString(`AttributionControl.${s}`);t.title=f,t.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((x=>typeof x!="string"?"":x))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const s=this._map.style.tileManagers;for(const x in s){const S=s[x];if(S.used||S.usedForTerrain){const M=S.getSource();M.attribution&&t.indexOf(M.attribution)<0&&t.push(M.attribution)}}t=t.filter((x=>String(x).trim())),t.sort(((x,S)=>x.length-S.length)),t=t.filter(((x,S)=>{for(let M=S+1;M<t.length;M++)if(t[M].indexOf(x)>=0)return!1;return!0}));const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=he.sanitize(f),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yh{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const f=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=he.create("div","maplibregl-ctrl");const s=he.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){he.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Kl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,f=s?this._queue.concat(s):this._queue;for(const x of f)if(x.id===t)return void(x.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const f of s)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var qi=h.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Sr extends h.E{constructor(t){super(),this._lastTilesetChange=pe(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,s){this.tileManager.update(t,s),this._renderableTilesKeys=[];const f={};for(const x of jn(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.tileManager._source.calculateTileZoom}))f[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.terrainRttPosMatrix32f=new Float64Array(16),h.c7(x.terrainRttPosMatrix32f,0,h.a5,h.a5,0,0,1),this._tiles[x.key]=new xt(x,this.tileSize),this._lastTilesetChange=pe());for(const x in this._tiles)f[x]||delete this._tiles[x]}freeRtt(t){for(const s in this._tiles){const f=this._tiles[s];(!t||f.tileID.equals(t)||f.tileID.isChildOf(t)||t.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,s){return s?this._getTerrainCoordsForTileRanges(t,s):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const s={};for(const f of this._renderableTilesKeys){const x=this._tiles[f].tileID,S=t.clone(),M=h.bk();if(x.canonical.equals(t.canonical))h.c7(M,0,h.a5,h.a5,0,0,1);else if(x.canonical.isChildOf(t.canonical)){const z=x.canonical.z-t.canonical.z,j=x.canonical.x-(x.canonical.x>>z<<z),Z=x.canonical.y-(x.canonical.y>>z<<z),W=h.a5>>z;h.c7(M,0,W,W,0,0,1),h.O(M,M,[-j*W,-Z*W,0])}else{if(!t.canonical.isChildOf(x.canonical))continue;{const z=t.canonical.z-x.canonical.z,j=t.canonical.x-(t.canonical.x>>z<<z),Z=t.canonical.y-(t.canonical.y>>z<<z),W=h.a5>>z;h.c7(M,0,h.a5,h.a5,0,0,1),h.O(M,M,[j*W,Z*W,0]),h.Q(M,M,[1/2**z,1/2**z,0])}}S.terrainRttPosMatrix32f=new Float32Array(M),s[f]=S}return s}_getTerrainCoordsForTileRanges(t,s){const f={};for(const x of this._renderableTilesKeys){const S=this._tiles[x].tileID;if(!this._isWithinTileRanges(S,s))continue;const M=t.clone(),z=h.bk();if(S.canonical.z===t.canonical.z){const j=t.canonical.x-S.canonical.x,Z=t.canonical.y-S.canonical.y;h.c7(z,0,h.a5,h.a5,0,0,1),h.O(z,z,[j*h.a5,Z*h.a5,0])}else if(S.canonical.z>t.canonical.z){const j=S.canonical.z-t.canonical.z,Z=S.canonical.x-(S.canonical.x>>j<<j),W=S.canonical.y-(S.canonical.y>>j<<j),ee=t.canonical.x-(S.canonical.x>>j),J=t.canonical.y-(S.canonical.y>>j),se=h.a5>>j;h.c7(z,0,se,se,0,0,1),h.O(z,z,[-Z*se+ee*h.a5,-W*se+J*h.a5,0])}else{const j=t.canonical.z-S.canonical.z,Z=t.canonical.x-(t.canonical.x>>j<<j),W=t.canonical.y-(t.canonical.y>>j<<j),ee=(t.canonical.x>>j)-S.canonical.x,J=(t.canonical.y>>j)-S.canonical.y,se=h.a5<<j;h.c7(z,0,se,se,0,0,1),h.O(z,z,[Z*h.a5+ee*se,W*h.a5+J*se,0])}M.terrainRttPosMatrix32f=new Float32Array(z),f[x]=M}return f}getSourceTile(t,s){const f=this.tileManager._source;let x=t.overscaledZ-this.deltaZoom;if(x>f.maxzoom&&(x=f.maxzoom),x<f.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(x).key);let S=this.findTileInCaches(this._sourceTileCache[t.key]);if(!S?.dem&&s)for(;x>=f.minzoom&&!S?.dem;)S=this.findTileInCaches(t.scaledTo(x--).key);return S}findTileInCaches(t){let s=this.tileManager.getTileByID(t);return s||(s=this.tileManager._outOfViewCache.getByKey(t),s)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,s){return s[t.canonical.z]&&t.canonical.x>=s[t.canonical.z].minTileX&&t.canonical.x<=s[t.canonical.z].maxTileX&&t.canonical.y>=s[t.canonical.z].minTileY&&t.canonical.y<=s[t.canonical.z].maxTileY}}class Gi{constructor(t,s,f){this._meshCache={},this.painter=t,this.tileManager=new Sr(s),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,f,x=h.a5){var S;if(!(s>=0&&s<x&&f>=0&&f<x))return 0;const M=this.getTerrainData(t),z=(S=M.tile)===null||S===void 0?void 0:S.dem;if(!z)return 0;const j=h.cC([],[s/x*h.a5,f/x*h.a5],M.u_terrain_matrix),Z=[j[0]*z.dim,j[1]*z.dim],W=Math.floor(Z[0]),ee=Math.floor(Z[1]),J=Z[0]-W,se=Z[1]-ee;return z.get(W,ee)*(1-J)*(1-se)+z.get(W+1,ee)*J*(1-se)+z.get(W,ee+1)*(1-J)*se+z.get(W+1,ee+1)*J*se}getElevationForLngLatZoom(t,s){if(!h.cD(s,t.wrap()))return 0;const{tileID:f,mercatorX:x,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(f,x%h.a5,S%h.a5,h.a5)}getElevationForLngLat(t,s){const f=jn(s,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let x=0;for(const S of f)S.canonical.z>x&&(x=Math.min(S.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,x)}getElevation(t,s,f,x=h.a5){return this.getDEMElevation(t,s,f,x)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const x=this.painter.context,S=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(x,S,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(x,new h.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ar([])}const s=this.tileManager.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const x=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new h.T(x,s.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),s.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const f=s&&s.toString()+s.tileID.key+t.key;if(f&&!this._demMatrixCache[f]){const x=this.tileManager.getSource().maxzoom;let S=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=x?S=t.canonical.z-x:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=t.canonical.x-(t.canonical.x>>S<<S),z=t.canonical.y-(t.canonical.y>>S<<S),j=h.cE(new Float64Array(16),[1/(h.a5<<S),1/(h.a5<<S),0]);h.O(j,j,[M*h.a5,z*h.a5,0]),this._demMatrixCache[t.key]={matrix:j,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,f=s.width/devicePixelRatio,x=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(s.context,{width:f,height:x,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(s.context,{width:f,height:x,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(f,x,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,f,x))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,M=0;S<this._coordsTextureSize;S++)for(let z=0;z<this._coordsTextureSize;z++,M+=4)s[M+0]=255&z,s[M+1]=255&S,s[M+2]=z>>8<<4|S>>8,s[M+3]=0;const f=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),x=new h.T(t,f,t.gl.RGBA,{premultiply:!1});return x.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),f=this.painter.context,x=f.gl,S=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(S,z-M-1,1,1,x.RGBA,x.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null);const j=s[0]+(s[2]>>4<<8),Z=s[1]+((15&s[2])<<8),W=this.coordsIndex[255-s[3]],ee=W&&this.tileManager.getTileByID(W);if(!ee)return null;const J=this._coordsTextureSize,se=(1<<ee.tileID.canonical.z)*J;return new h.a9((ee.tileID.canonical.x*J+j)/se+ee.tileID.wrap,(ee.tileID.canonical.y*J+Z)/se,this.getElevation(ee.tileID,j,Z,J))}depthAtPoint(t){const s=new Uint8Array(4),f=this.painter.context,x=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(t){var s;const f=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,x=f&&t.canonical.y===0,S=f&&t.canonical.y===(1<<t.canonical.z)-1,M=`m_${x?"n":""}_${S?"s":""}`;if(this._meshCache[M])return this._meshCache[M];const z=this.painter.context,j=new h.cF,Z=new h.aY,W=this.meshSize,ee=h.a5/W,J=W*W;for(let Ve=0;Ve<=W;Ve++)for(let pt=0;pt<=W;pt++)j.emplaceBack(pt*ee,Ve*ee,0);for(let Ve=0;Ve<J;Ve+=W+1)for(let pt=0;pt<W;pt++)Z.emplaceBack(pt+Ve,W+pt+Ve+1,W+pt+Ve+2),Z.emplaceBack(pt+Ve,W+pt+Ve+2,pt+Ve+1);const se=j.length,fe=se+(W+1),Ce=(W+1)*W,Me=x?h.br:0,Ie=x?0:1,Le=S?h.bs:h.a5,$e=S?0:1;for(let Ve=0;Ve<=W;Ve++)j.emplaceBack(Ve*ee,Me,Ie);for(let Ve=0;Ve<=W;Ve++)j.emplaceBack(Ve*ee,Le,$e);for(let Ve=0;Ve<W;Ve++)Z.emplaceBack(Ce+Ve,fe+Ve,fe+Ve+1),Z.emplaceBack(Ce+Ve,fe+Ve+1,Ce+Ve+1),Z.emplaceBack(0+Ve,se+Ve+1,se+Ve),Z.emplaceBack(0+Ve,0+Ve+1,se+Ve+1);const ze=j.length,We=ze+2*(W+1);for(const Ve of[0,1])for(let pt=0;pt<=W;pt++)for(const Ft of[0,1])j.emplaceBack(Ve*h.a5,pt*ee,Ft);for(let Ve=0;Ve<2*W;Ve+=2)Z.emplaceBack(ze+Ve,ze+Ve+1,ze+Ve+3),Z.emplaceBack(ze+Ve,ze+Ve+3,ze+Ve+2),Z.emplaceBack(We+Ve,We+Ve+3,We+Ve+1),Z.emplaceBack(We+Ve,We+Ve+2,We+Ve+3);const st=new _r(z.createVertexBuffer(j,qi.members),z.createIndexBuffer(Z),h.aX.simpleSegment(0,0,j.length,Z.length));return this._meshCache[M]=st,st}getMeshFrameDelta(t){return 2*Math.PI*h.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,s){var f;if(!h.cD(s,t.wrap()))return 0;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(f=this.getMinMaxElevation(x).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,f={minElevation:null,maxElevation:null};return s&&s.dem&&(f.minElevation=s.dem.min*this.exaggeration,f.maxElevation=s.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(t,s){const f=h.a9.fromLngLat(t.wrap()),x=(1<<s)*h.a5,S=f.x*x,M=f.y*x,z=Math.floor(S/h.a5),j=Math.floor(M/h.a5);return{tileID:new h.a2(s,0,s,z,j),mercatorX:S,mercatorY:M}}}class ss{constructor(t,s,f){this._context=t,this._size=s,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(f.texture),{id:t,fbo:s,texture:f,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>t.id!==s)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const ko={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Zo{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new ss(t.context,30,s.tileManager.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((f=>!t._layers[f].isHidden(s))),this._coordsAscending={};for(const f in t.tileManagers){this._coordsAscending[f]={};const x=t.tileManagers[f].getVisibleCoordinates(),S=t.tileManagers[f].getSource(),M=S instanceof yr?S.terrainTileRanges:null;for(const z of x){const j=this.terrain.tileManager.getTerrainCoords(z,M);for(const Z in j)this._coordsAscending[f][Z]||(this._coordsAscending[f][Z]=[]),this._coordsAscending[f][Z].push(j[Z])}}this._coordsAscendingStr={};for(const f of t._order){const x=t._layers[f],S=x.source;if(ko[x.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(const M in this._coordsAscending[S])this._coordsAscendingStr[S][M]=this._coordsAscending[S][M].map((z=>z.key)).sort().join()}}for(const f of this._renderableTiles)for(const x in this._coordsAscendingStr){const S=this._coordsAscendingStr[x][f.tileID.key];S&&S!==f.rttCoords[x]&&(f.rtt=[])}}renderLayer(t,s){if(t.isHidden(this.painter.transform.zoom))return!1;const f=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),x=t.type,S=this.painter,M=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ko[x]&&(this._prevType&&ko[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(t.id),!M))return!0;if(ko[this._prevType]||ko[x]&&M){this._prevType=x;const z=this._stacks.length-1,j=this._stacks[z]||[];for(const Z of this._renderableTiles){if(this.pool.isFull()&&(Jh(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Z),Z.rtt[z]){const ee=this.pool.getObjectForId(Z.rtt[z].id);if(ee.stamp===Z.rtt[z].stamp){this.pool.useObject(ee);continue}}const W=this.pool.getOrCreateFreeObject();this.pool.useObject(W),this.pool.stampObject(W),Z.rtt[z]={id:W.id,stamp:W.stamp},S.context.bindFramebuffer.set(W.fbo.framebuffer),S.context.clear({color:h.bp.transparent,stencil:0}),S.currentStencilSource=void 0;for(let ee=0;ee<j.length;ee++){const J=S.style._layers[j[ee]],se=J.source?this._coordsAscending[J.source][Z.tileID.key]:[Z.tileID];S.context.viewport.set([0,0,W.fbo.width,W.fbo.height]),S._renderTileClippingMasks(J,se,!0),S.renderLayer(S,S.style.tileManagers[J.source],J,se,f),J.source&&(Z.rttCoords[J.source]=this._coordsAscendingStr[J.source][Z.tileID.key])}}return Jh(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects(),ko[x]}return!1}}const Wc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Yc=U,Ql={hash:!1,interactive:!0,bearingSnap:7,attributionControl:hs,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},ef={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Kr{constructor(t,s,f=!1){this.mousedown=S=>{this.startMove(S,he.mousePos(this.element,S)),he.addEventListener(window,"mousemove",this.mousemove),he.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,he.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHandler.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),he.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const x=new hh;this._rotatePitchHandler=new To({clickTolerance:3,move:(S,M)=>{const z=s.getBoundingClientRect(),j=new h.P((z.bottom-z.top)/2,(z.right-z.left)/2);return{bearingDelta:h.cx(new h.P(S.x,M.y),M,j),pitchDelta:f?-.5*(M.y-S.y):void 0}},moveStateManager:x,enable:!0,assignEvents:()=>{}}),this.map=t,he.addEventListener(s,"mousedown",this.mousedown),he.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(s,"touchcancel",this.reset)}startMove(t,s){this._rotatePitchHandler.dragStart(t,s),he.disableDrag()}move(t,s){const f=this.map,{bearingDelta:x,pitchDelta:S}=this._rotatePitchHandler.dragMove(t,s)||{};x&&f.setBearing(f.getBearing()+x),S&&f.setPitch(f.getPitch()+S)}off(){const t=this.element;he.removeEventListener(t,"mousedown",this.mousedown),he.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend),he.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){he.enableDrag(),he.removeEventListener(window,"mousemove",this.mousemove),he.removeEventListener(window,"mouseup",this.mouseup),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend)}}let Xo;function Mu(A,t,s,f=!1){if(f||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return A?.wrap();const x=new h.V(A.lng,A.lat);if(A=new h.V(A.lng,A.lat),t){const S=new h.V(A.lng-360,A.lat),M=new h.V(A.lng+360,A.lat),z=s.locationToScreenPoint(A).distSqr(t);s.locationToScreenPoint(S).distSqr(t)<z?A=S:s.locationToScreenPoint(M).distSqr(t)<z&&(A=M)}for(;Math.abs(A.lng-s.center.lng)>180;){const S=s.locationToScreenPoint(A);if(S.x>=0&&S.y>=0&&S.x<=s.width&&S.y<=s.height)break;A.lng>s.center.lng?A.lng-=360:A.lng+=360}return A.lng!==x.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(A))?A:x}const ku={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xh(A,t,s){const f=A.classList;for(const x in ku)f.remove(`maplibregl-${s}-anchor-${x}`);f.add(`maplibregl-${s}-anchor-${t}`)}class _h extends h.E{constructor(t){if(super(),this._onKeyPress=s=>{const f=s.code,x=s.charCode||s.keyCode;f!=="Space"&&f!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=s=>{const f=s.originalEvent.target,x=this._element;this._popup&&(f===x||x.contains(f))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=Mu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,`${ku[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${x}`),we.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div");const s=he.createNS("http://www.w3.org/2000/svg","svg"),f=41,x=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${f}px`),s.setAttributeNS(null,"width",`${x}px`),s.setAttributeNS(null,"viewBox",`0 0 ${x} ${f}`);const S=he.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const M=he.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const z=he.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of j){const Le=he.createNS("http://www.w3.org/2000/svg","ellipse");Le.setAttributeNS(null,"opacity","0.04"),Le.setAttributeNS(null,"cx","10.5"),Le.setAttributeNS(null,"cy","5.80029008"),Le.setAttributeNS(null,"rx",Ie.rx),Le.setAttributeNS(null,"ry",Ie.ry),z.appendChild(Le)}const Z=he.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const W=he.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(W);const ee=he.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"fill","#000000");const J=he.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ee.appendChild(J);const se=he.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const fe=he.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ce=he.createNS("http://www.w3.org/2000/svg","circle");Ce.setAttributeNS(null,"fill","#000000"),Ce.setAttributeNS(null,"opacity","0.25"),Ce.setAttributeNS(null,"cx","5.5"),Ce.setAttributeNS(null,"cy","5.5"),Ce.setAttributeNS(null,"r","5.4999962");const Me=he.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#FFFFFF"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962"),fe.appendChild(Ce),fe.appendChild(Me),M.appendChild(z),M.appendChild(Z),M.appendChild(ee),M.appendChild(se),M.appendChild(fe),s.appendChild(M),s.setAttributeNS(null,"height",f*this._scale+"px"),s.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),xh(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const x=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,f;const x=(s=this._map)===null||s===void 0?void 0:s.terrain,S=this._map.transform.isLocationOccluded(this._lngLat);if(!x||S){const se=S?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==se&&(this._element.style.opacity=se))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const M=this._map,z=M.terrain.depthAtPoint(this._pos),j=M.terrain.getElevationForLngLat(this._lngLat,M.transform);if(M.transform.lngLatToCameraDepth(this._lngLat,j)-z<.006)return void(this._element.style.opacity=this._opacity);const Z=-this._offset.y/M.transform.pixelsPerMeter,W=Math.sin(M.getPitch()*Math.PI/180)*Z,ee=M.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),J=M.transform.lngLatToCameraDepth(this._lngLat,j+W)-ee>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&J&&this._popup.remove(),this._element.style.opacity=J?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return(this._opacity===void 0||t===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const bh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ac=0,Jl=!1;const ma={maxWidth:100,unit:"metric"};function as(A,t,s){const f=s&&s.maxWidth||100,x=A._container.clientHeight/2,S=A._container.clientWidth/2,M=A.unproject([S-f/2,x]),z=A.unproject([S+f/2,x]),j=Math.round(A.project(z).x-A.project(M).x),Z=Math.min(f,j,A._container.clientWidth),W=M.distanceTo(z);if(s&&s.unit==="imperial"){const ee=3.2808*W;ee>5280?Cl(t,Z,ee/5280,A._getUIString("ScaleControl.Miles")):Cl(t,Z,ee,A._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Cl(t,Z,W/1852,A._getUIString("ScaleControl.NauticalMiles")):W>=1e3?Cl(t,Z,W/1e3,A._getUIString("ScaleControl.Kilometers")):Cl(t,Z,W,A._getUIString("ScaleControl.Meters"))}function Cl(A,t,s,f){const x=(function(S){const M=Math.pow(10,`${Math.floor(S)}`.length-1);let z=S/M;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:(function(j){const Z=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*Z)/Z})(z),M*z})(s);A.style.width=t*(x/s)+"px",A.innerHTML=`${x}&nbsp;${f}`}const $c={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Kc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(A){if(A){if(typeof A=="number"){const t=Math.round(Math.abs(A)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,A),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-A),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(A,0),right:new h.P(-A,0)}}if(A instanceof h.P||Array.isArray(A)){const t=h.P.convert(A);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(A.center||[0,0]),top:h.P.convert(A.top||[0,0]),"top-left":h.P.convert(A["top-left"]||[0,0]),"top-right":h.P.convert(A["top-right"]||[0,0]),bottom:h.P.convert(A.bottom||[0,0]),"bottom-left":h.P.convert(A["bottom-left"]||[0,0]),"bottom-right":h.P.convert(A["bottom-right"]||[0,0]),left:h.P.convert(A.left||[0,0]),right:h.P.convert(A.right||[0,0])}}return Nu(new h.P(0,0))}const Wo=U;N.AJAXError=h.cI,N.Event=h.l,N.Evented=h.E,N.LngLat=h.V,N.MercatorCoordinate=h.a9,N.Point=h.P,N.addProtocol=h.cJ,N.config=h.c,N.removeProtocol=h.cK,N.AttributionControl=gs,N.BoxZoomHandler=vc,N.CanvasSource=oe,N.CooperativeGesturesHandler=Bn,N.DoubleClickZoomHandler=ad,N.DragPanHandler=Jd,N.DragRotateHandler=ho,N.EdgeInsets=Zs,N.FullscreenControl=class extends h.E{constructor(A={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,A&&A.container&&(A.container instanceof HTMLElement?this._container=A.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(A){return this._map=A,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){he.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const A=this._fullscreenButton=he.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);he.create("span","maplibregl-ctrl-icon",A).setAttribute("aria-hidden","true"),A.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const A=this._getTitle();this._fullscreenButton.setAttribute("aria-label",A),this._fullscreenButton.title=A}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},N.GeoJSONSource=Di,N.GeolocateControl=class extends h.E{constructor(A){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new h.V(t.coords.longitude,t.coords.latitude),f=t.coords.accuracy,x=this._map.getBearing(),S=h.e({bearing:x},this.options.fitBoundsOptions),M=Yn.fromLngLat(s,f);this._map.fitBounds(M,S,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new h.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Jl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=he.create("button","maplibregl-ctrl-geolocate",this._container),he.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _h({element:this._dotElement}),this._circleElement=he.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _h({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{const f=s?.[0]instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},bh,A)}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(t=!1){if(Xo!==void 0&&!t)return Xo;if(window.navigator.permissions===void 0)return Xo=!!window.navigator.geolocation,Xo;try{Xo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Xo=!!window.navigator.geolocation}return Xo}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ac=0,Jl=!1}_isOutOfMapMaxBounds(A){const t=this._map.getMaxBounds(),s=A.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const A=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&A))return;const t=this._map.project(A),s=this._map.unproject([t.x+100,t.y]),f=A.distanceTo(s)/100,x=2*this._accuracy/f;this._circleElement.style.width=`${x.toFixed(2)}px`,this._circleElement.style.height=`${x.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ac--,Jl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let A;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ac++,Ac>1?(A={maximumAge:6e5,timeout:0},Jl=!0):(A=this.options.positionOptions,Jl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,A)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},N.GlobeControl=class{constructor(){this._toggleProjection=()=>{var A;const t=(A=this._map.getProjection())===null||A===void 0?void 0:A.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var A;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((A=this._map.getProjection())===null||A===void 0?void 0:A.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=he.create("button","maplibregl-ctrl-globe",this._container),he.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},N.Hash=As,N.ImageSource=yr,N.KeyboardHandler=Ir,N.LngLatBounds=Yn,N.LogoControl=yh,N.Map=class extends Es{constructor(A){var t,s;h.cG.mark(h.cH.create);const f=Object.assign(Object.assign(Object.assign({},Ql),A),{canvasContextAttributes:Object.assign(Object.assign({},Ql.canvasContextAttributes),A.canvasContextAttributes)});if(f.minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const x=new Rr,S=new Eo;if(f.minZoom!==void 0&&x.setMinZoom(f.minZoom),f.maxZoom!==void 0&&x.setMaxZoom(f.maxZoom),f.minPitch!==void 0&&x.setMinPitch(f.minPitch),f.maxPitch!==void 0&&x.setMaxPitch(f.maxPitch),f.renderWorldCopies!==void 0&&x.setRenderWorldCopies(f.renderWorldCopies),f.transformConstrain!==null&&x.setConstrainOverride(f.transformConstrain),super(x,S,{bearingSnap:f.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Kl,this._controls=[],this._mapId=h.af(),this._lostContextStyle={style:null,images:null},this._contextLost=z=>{z.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const j of Object.values(this.style._layers))if(j.type==="custom"&&console.warn(`Custom layer with id '${j.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),j._listeners)for(const[Z]of Object.entries(j._listeners))console.warn(`Custom layer with id '${j.id}' had event listeners for event '${Z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new h.l("webglcontextlost",{originalEvent:z}))},this._contextRestored=z=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:z}))},this._onMapScroll=z=>{if(z.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},f.canvasContextAttributes),this._trackResize=f.trackResize===!0,this._bearingSnap=f.bearingSnap,this._centerClampedToGround=f.centerClampedToGround,this._refreshExpiredTiles=f.refreshExpiredTiles===!0,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions===!0,this._collectResourceTiming=f.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Wc),f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this._zoomLevelsToOverscale=f.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=f.transformCameraUpdate,this.transformConstrain=f.transformConstrain,this.cancelPendingTileRequestsWhileZooming=f.cancelPendingTileRequestsWhileZooming===!0,f.reduceMotion!==void 0&&(we.prefersReducedMotion=f.reduceMotion),this._imageQueueHandle=rt.addThrottleControl((()=>this.isMoving())),this._requestManager=new at(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let z=!1;const j=$d((Z=>{this._trackResize&&!this._removed&&(this.resize(Z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((Z=>{z?j(Z):z=!0})),this._resizeObserver.observe(this._container)}this.handlers=new mh(this,f),this._hash=f.hash&&new As(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,roll:f.roll}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,h.e({},f.fitBoundsOptions,{duration:0}))));const M=typeof f.style=="string"||((s=(t=f.style)===null||t===void 0?void 0:t.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,M),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new gs(typeof f.attributionControl=="boolean"?void 0:f.attributionControl)),f.maplibreLogo&&this.addControl(new yh,f.logoPosition),this.on("style.load",(()=>{if(M||this._resizeTransform(),this.transform.unmodified){const z=h.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(z)}})),this.on("data",(z=>{this._update(z.dataType==="style"),this.fire(new h.l(`${z.dataType}data`,z))})),this.on("dataloading",(z=>{this.fire(new h.l(`${z.dataType}dataloading`,z))})),this.on("dataabort",(z=>{this.fire(new h.l("sourcedataabort",z))}))}_getMapId(){return this._mapId}setGlobalStateProperty(A,t){return this.style.setGlobalStateProperty(A,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(A,t){if(t===void 0&&(t=A.getDefaultPosition?A.getDefaultPosition():"top-right"),!A||!A.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=A.onAdd(this);this._controls.push(A);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(s,f.firstChild):f.appendChild(s),this}removeControl(A){if(!A||!A.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(A);return t>-1&&this._controls.splice(t,1),A.onRemove(this),this}hasControl(A){return this._controls.indexOf(A)>-1}coveringTiles(A){return jn(this.transform,A)}calculateCameraOptionsFromTo(A,t,s,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLat(s,this.transform)),super.calculateCameraOptionsFromTo(A,t,s,f)}resize(A,t=!0){const[s,f]=this._containerDimensions(),x=this._getClampedPixelRatio(s,f);if(this._resizeCanvas(s,f,x),this.painter.resize(s,f,x),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const z=this._getClampedPixelRatio(s,f);this._resizeCanvas(s,f,z),this.painter.resize(s,f,z)}this._resizeTransform(t);const S=!this._moving;return S&&(this.stop(),this.fire(new h.l("movestart",A)).fire(new h.l("move",A))),this.fire(new h.l("resize",A)),S&&this.fire(new h.l("moveend",A)),this}_resizeTransform(A=!0){var t;const[s,f]=this._containerDimensions();this.transform.resize(s,f,A),(t=this._requestedCameraState)===null||t===void 0||t.resize(s,f,A)}_getClampedPixelRatio(A,t){const{0:s,1:f}=this._maxCanvasSize,x=this.getPixelRatio(),S=A*x,M=t*x;return Math.min(S>s?s/S:1,M>f?f/M:1)*x}getPixelRatio(){var A;return(A=this._overridePixelRatio)!==null&&A!==void 0?A:devicePixelRatio}setPixelRatio(A){this._overridePixelRatio=A,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(A){return this.transform.setMaxBounds(Yn.convert(A)),this._update()}setMinZoom(A){if((A=A??-2)>=-2&&A<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(A),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(A){if((A=A??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(A),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(A){if((A=A??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(A>=0&&A<=this.transform.maxPitch)return this.transform.setMinPitch(A),this._update(),this.getPitch()<A&&this.setPitch(A),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(A){if((A=A??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(A>=this.transform.minPitch)return this.transform.setMaxPitch(A),this._update(),this.getPitch()>A&&this.setPitch(A),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(A){return this.transform.setRenderWorldCopies(A),this._update()}setTransformConstrain(A){return this.transform.setConstrainOverride(A),this._update()}project(A){return this.transform.locationToScreenPoint(h.V.convert(A),this.style&&this.terrain)}unproject(A){return this.transform.screenPointToLocation(h.P.convert(A),this.terrain)}isMoving(){var A;return this._moving||((A=this.handlers)===null||A===void 0?void 0:A.isMoving())}isZooming(){var A;return this._zooming||((A=this.handlers)===null||A===void 0?void 0:A.isZooming())}isRotating(){var A;return this._rotating||((A=this.handlers)===null||A===void 0?void 0:A.isRotating())}_createDelegatedListener(A,t,s){if(A==="mouseenter"||A==="mouseover"){let f=!1;return{layers:t,listener:s,delegates:{mousemove:S=>{const M=t.filter((j=>this.getLayer(j))),z=M.length!==0?this.queryRenderedFeatures(S.point,{layers:M}):[];z.length?f||(f=!0,s.call(this,new $s(A,this,S.originalEvent,{features:z}))):f=!1},mouseout:()=>{f=!1}}}}if(A==="mouseleave"||A==="mouseout"){let f=!1;return{layers:t,listener:s,delegates:{mousemove:M=>{const z=t.filter((j=>this.getLayer(j)));(z.length!==0?this.queryRenderedFeatures(M.point,{layers:z}):[]).length?f=!0:f&&(f=!1,s.call(this,new $s(A,this,M.originalEvent)))},mouseout:M=>{f&&(f=!1,s.call(this,new $s(A,this,M.originalEvent)))}}}}{const f=x=>{const S=t.filter((z=>this.getLayer(z))),M=S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[];M.length&&(x.features=M,s.call(this,x),delete x.features)};return{layers:t,listener:s,delegates:{[A]:f}}}}_saveDelegatedListener(A,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[A]=this._delegatedListeners[A]||[],this._delegatedListeners[A].push(t)}_removeDelegatedListener(A,t,s){if(!this._delegatedListeners||!this._delegatedListeners[A])return;const f=this._delegatedListeners[A];for(let x=0;x<f.length;x++){const S=f[x];if(S.listener===s&&S.layers.length===t.length&&S.layers.every((M=>t.includes(M)))){for(const M in S.delegates)this.off(M,S.delegates[M]);return void f.splice(x,1)}}}on(A,t,s){if(s===void 0)return super.on(A,t);const f=typeof t=="string"?[t]:t,x=this._createDelegatedListener(A,f,s);this._saveDelegatedListener(A,x);for(const S in x.delegates)this.on(S,x.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(A,f,s)}}}once(A,t,s){if(s===void 0)return super.once(A,t);const f=typeof t=="string"?[t]:t,x=this._createDelegatedListener(A,f,s);for(const S in x.delegates){const M=x.delegates[S];x.delegates[S]=(...z)=>{this._removeDelegatedListener(A,f,s),M(...z)}}this._saveDelegatedListener(A,x);for(const S in x.delegates)this.once(S,x.delegates[S]);return this}off(A,t,s){return s===void 0?super.off(A,t):(this._removeDelegatedListener(A,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(A,t){if(!this.style)return[];let s;const f=A instanceof h.P||Array.isArray(A),x=f?A:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(f?{}:A)||{},x instanceof h.P||typeof x[0]=="number")s=[h.P.convert(x)];else{const S=h.P.convert(x[0]),M=h.P.convert(x[1]);s=[S,new h.P(M.x,S.y),M,new h.P(S.x,M.y),S]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(A,t){return this.style.querySourceFeatures(A,t)}setStyle(A,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&A?(this._diffStyle(A,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(A,t))}setTransformRequest(A){return this._requestManager.setTransformRequest(A),this}_getUIString(A){const t=this._locale[A];if(t==null)throw new Error(`Missing UI string '${A}'`);return t}_updateStyle(A,t){var s,f;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(A,t)));const x=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!A)),A?(this.style=new Da(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof A=="string"?this.style.loadURL(A,t,x):this.style.loadJSON(A,t,x),this):((f=(s=this.style)===null||s===void 0?void 0:s.projection)===null||f===void 0||f.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Da(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(A,t){if(typeof A=="string"){const s=this._requestManager.transformRequest(A,"Style");h.j(s,new AbortController).then((f=>{this._updateDiff(f.data,t)})).catch((f=>{f&&this.fire(new h.k(f))}))}else typeof A=="object"&&this._updateDiff(A,t)}_updateDiff(A,t){try{this.style.setState(A,t)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(A,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(A,t){return this._lazyInitEmptyStyle(),this.style.addSource(A,t),this._update(!0)}isSourceLoaded(A){const t=this.style&&this.style.tileManagers[A];if(t!==void 0)return t.loaded();this.fire(new h.k(new Error(`There is no tile manager with ID '${A}'`)))}setTerrain(A){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),A){const t=this.style.tileManagers[A.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${A.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const f=this.style._layers[s];f.type==="hillshade"&&f.source===A.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),f.type==="color-relief"&&f.source===A.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gi(this.painter,t,A),this.painter.renderToTexture=new Zo(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var f;s.dataType==="style"?this.terrain.tileManager.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==A.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((f=s.source)===null||f===void 0?void 0:f.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:A})),this}getTerrain(){var A,t;return(t=(A=this.terrain)===null||A===void 0?void 0:A.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const A=this.style&&this.style.tileManagers;for(const t of Object.values(A))if(!t.areTilesLoaded())return!1;return!0}removeSource(A){return this.style.removeSource(A),this._update(!0)}getSource(A){return this.style.getSource(A)}setSourceTileLodParams(A,t,s){if(s){const f=this.getSource(s);if(!f)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);f.calculateTileZoom=pi(Math.max(1,A),Math.max(1,t))}else for(const f in this.style.tileManagers)this.style.tileManagers[f].getSource().calculateTileZoom=pi(Math.max(1,A),Math.max(1,t));return this._update(!0),this}refreshTiles(A,t){const s=this.style.tileManagers[A];if(!s)throw new Error(`There is no tile manager with ID "${A}", cannot refresh tile`);t===void 0?s.reload(!0):s.refreshTiles(t.map((f=>new h.ac(f.z,f.x,f.y))))}addImage(A,t,s={}){const{pixelRatio:f=1,sdf:x=!1,stretchX:S,stretchY:M,content:z,textFitWidth:j,textFitHeight:Z}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:W,height:ee,data:J}=t,se=t;return this.style.addImage(A,{data:new h.R({width:W,height:ee},new Uint8Array(J)),pixelRatio:f,stretchX:S,stretchY:M,content:z,textFitWidth:j,textFitHeight:Z,sdf:x,version:0,userImage:se}),se.onAdd&&se.onAdd(this,A),this}}{const{width:W,height:ee,data:J}=we.getImageData(t);this.style.addImage(A,{data:new h.R({width:W,height:ee},J),pixelRatio:f,stretchX:S,stretchY:M,content:z,textFitWidth:j,textFitHeight:Z,sdf:x,version:0})}}updateImage(A,t){const s=this.style.getImage(A);if(!s)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||h.b(t)?we.getImageData(t):t,{width:x,height:S,data:M}=f;if(x===void 0||S===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==s.data.width||S!==s.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const z=!(t instanceof HTMLImageElement||h.b(t));return s.data.replace(M,z),this.style.updateImage(A,s),this}getImage(A){return this.style.getImage(A)}hasImage(A){return A?!!this.style.getImage(A):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(A){this.style.removeImage(A)}loadImage(A){return rt.getImage(this._requestManager.transformRequest(A,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(A,t){return this._lazyInitEmptyStyle(),this.style.addLayer(A,t),this._update(!0)}moveLayer(A,t){return this.style.moveLayer(A,t),this._update(!0)}removeLayer(A){return this.style.removeLayer(A),this._update(!0)}getLayer(A){return this.style.getLayer(A)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(A,t,s){return this.style.setLayerZoomRange(A,t,s),this._update(!0)}setFilter(A,t,s={}){return this.style.setFilter(A,t,s),this._update(!0)}getFilter(A){return this.style.getFilter(A)}setPaintProperty(A,t,s,f={}){return this.style.setPaintProperty(A,t,s,f),this._update(!0)}getPaintProperty(A,t){return this.style.getPaintProperty(A,t)}setLayoutProperty(A,t,s,f={}){return this.style.setLayoutProperty(A,t,s,f),this._update(!0)}getLayoutProperty(A,t){return this.style.getLayoutProperty(A,t)}setGlyphs(A,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(A,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(A,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(A,t,s,(f=>{f||this._update(!0)})),this}removeSprite(A){return this._lazyInitEmptyStyle(),this.style.removeSprite(A),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(A,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(A,t,(s=>{s||this._update(!0)})),this}setLight(A,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(A,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(A,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(A,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(A,t){return this.style.setFeatureState(A,t),this._update()}removeFeatureState(A,t){return this.style.removeFeatureState(A,t),this._update()}getFeatureState(A){return this.style.getFeatureState(A)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let A=0,t=0;return this._container&&(A=this._container.clientWidth||400,t=this._container.clientHeight||300),[A,t]}_setupContainer(){const A=this._container;A.classList.add("maplibregl-map");const t=this._canvasContainer=he.create("div","maplibregl-canvas-container",A);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=he.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),f=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],f);const x=this._controlContainer=he.create("div","maplibregl-control-container",A),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((M=>{S[M]=he.create("div",`maplibregl-ctrl-${M} `,x)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(A,t,s){this._canvas.width=Math.floor(s*A),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${A}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const A=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(f=>{t={requestedAttributes:A},f&&(t.statusMessage=f.statusMessage,t.type=f.type)}),{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,A):this._canvas.getContext("webgl2",A)||this._canvas.getContext("webgl",A),!s){const f="Failed to initialize WebGL";throw t?(t.message=f,new Error(JSON.stringify(t))):new Error(f)}this.painter=new op(s,this.transform),De.testSupport(s)}migrateProjection(A,t){super.migrateProjection(A,t),this.painter.transform=A,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(A){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||A,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(A){return this._update(),this._renderTaskQueue.add(A)}_cancelRenderFrame(A){this._renderTaskQueue.remove(A)}_render(A){var t,s,f,x,S;const M=this._idleTriggered?this._fadeDuration:0,z=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(A),this._removed)return;let j=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const ee=this.transform.zoom,J=pe();this.style.zoomHistory.update(ee,J);const se=new h.H(ee,{now:J,fadeDuration:M,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),fe=se.crossFadingFactor();fe===1&&fe===this._crossFadingFactor||(j=!0,this._crossFadingFactor=fe),this.style.update(se)}const Z=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==z;(f=this.style.projection)===null||f===void 0||f.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((x=this.style.projection)===null||x===void 0?void 0:x.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||Z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,Z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cG.mark(h.cH.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||j)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const W=this._sourcesDirty||this._styleDirty||this._placementDirty;return W||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||W||(this._fullyLoaded=!0,h.cG.mark(h.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var A;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),rt.removeThrottleControl(this._imageQueueHandle),(A=this._resizeObserver)===null||A===void 0||A.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),he.remove(this._canvasContainer),he.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cG.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,we.frame(this._frameRequest,(A=>{h.cG.frame(A),this._frameRequest=null;try{this._render(A)}catch(t){if(!h.Z(t)&&!(function(s){return s.message===_c})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(A){this._showTileBoundaries!==A&&(this._showTileBoundaries=A,this._update())}get showPadding(){return!!this._showPadding}set showPadding(A){this._showPadding!==A&&(this._showPadding=A,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(A){this._showCollisionBoxes!==A&&(this._showCollisionBoxes=A,A?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(A){this._showOverdrawInspector!==A&&(this._showOverdrawInspector=A,this._update())}get repaint(){return!!this._repaint}set repaint(A){this._repaint!==A&&(this._repaint=A,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(A){this._vertices=A,this._update()}get version(){return Yc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(A){return this._lazyInitEmptyStyle(),this.style.setProjection(A),this._update(!0)}},N.MapMouseEvent=$s,N.MapTouchEvent=Go,N.MapWheelEvent=ed,N.Marker=_h,N.NavigationControl=class{constructor(A){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),f=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,s)=>{const f=this._map._getUIString(`NavigationControl.${s}`);t.title=f,t.setAttribute("aria-label",f)},this.options=h.e({},ef,A),this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),he.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),he.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=he.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(A){return this._map=A,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Kr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(A,t){const s=he.create("button",A,this._container);return s.type="button",s.addEventListener("click",t),s}},N.Popup=class extends h.E{constructor(A){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=he.create("div","maplibregl-popup",this._map.getContainer()),this._tip=he.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Mu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const s=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let f=this.options.anchor;const x=Nu(this.options.offset);if(!f){const M=this._container.offsetWidth,z=this._container.offsetHeight;let j;j=s.y+x.bottom.y<z?["top"]:s.y>this._map.transform.height-z?["bottom"]:[],s.x<M/2?j.push("left"):s.x>this._map.transform.width-M/2&&j.push("right"),f=j.length===0?"bottom":j.join("-")}let S=s.add(x[f]);this.options.subpixelPositioning||(S=S.round()),he.setTransform(this._container,`${ku[f]} translate(${S.x}px,${S.y}px)`),xh(this._container,f,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create($c),A)}addTo(A){return this._map&&this.remove(),this._map=A,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=h.V.convert(A),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(A){return this.setDOMContent(document.createTextNode(A))}setHTML(A){const t=document.createDocumentFragment(),s=document.createElement("body");let f;for(s.innerHTML=A;f=s.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){var A;return(A=this._container)===null||A===void 0?void 0:A.style.maxWidth}setMaxWidth(A){return this.options.maxWidth=A,this._update(),this}setDOMContent(A){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(A),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(A){return this._container&&this._container.classList.add(A),this}removeClassName(A){return this._container&&this._container.classList.remove(A),this}setOffset(A){return this.options.offset=A,this._update(),this}toggleClassName(A){if(this._container)return this._container.classList.toggle(A)}setSubpixelPositioning(A){this.options.subpixelPositioning=A}_createCloseButton(){this.options.closeButton&&(this._closeButton=he.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const A=this._container.querySelector(Kc);A&&A.focus()}},N.RasterDEMTileSource=on,N.RasterTileSource=Ei,N.ScaleControl=class{constructor(A){this._onMove=()=>{as(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,as(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ma),A)}getDefaultPosition(){return"bottom-left"}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-scale",A.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},N.ScrollZoomHandler=ph,N.Style=Da,N.TerrainControl=class{constructor(A){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=A}onAdd(A){return this._map=A,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=he.create("button","maplibregl-ctrl-terrain",this._container),he.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){he.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},N.TwoFingersTouchPitchHandler=Yl,N.TwoFingersTouchRotateHandler=fh,N.TwoFingersTouchZoomHandler=El,N.TwoFingersTouchZoomRotateHandler=Xc,N.VectorTileSource=Rn,N.VideoSource=yt,N.addSourceType=(A,t)=>h._(void 0,void 0,void 0,(function*(){if(ge(A))throw new Error(`A source type called "${A}" already exists.`);((s,f)=>{le[s]=f})(A,t)})),N.clearPrewarmedResources=function(){const A=Qt;A&&(A.isPreloaded()&&A.numActive()===1?(A.release(bt),Qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},N.createTileMesh=oi,N.getMaxParallelImageRequests=function(){return h.c.MAX_PARALLEL_IMAGE_REQUESTS},N.getRTLTextPluginStatus=function(){return it().getRTLTextPluginStatus()},N.getVersion=function(){return Wo},N.getWorkerCount=function(){return an.workerCount},N.getWorkerUrl=function(){return h.c.WORKER_URL},N.importScriptInWorkers=function(A){return Nn().broadcast("IS",A)},N.isTimeFrozen=function(){return ve.isFrozen()},N.now=pe,N.prewarm=function(){nn().acquire(bt)},N.restoreNow=function(){ve.restoreNow()},N.setMaxParallelImageRequests=function(A){h.c.MAX_PARALLEL_IMAGE_REQUESTS=A},N.setNow=function(A){ve.setNow(A)},N.setRTLTextPlugin=function(A,t){return it().setRTLTextPlugin(A,t)},N.setWorkerCount=function(A){an.workerCount=A},N.setWorkerUrl=function(A){h.c.WORKER_URL=A}}));var P=y;return P}))})($m)),$m.exports}var u2=QT();const h2=rp(u2),JT=hb({__proto__:null,default:h2},[u2]);var gy={},B_;function e4(){if(B_)return gy;B_=1;var c=function(){},d="+",y=8,C="0",D="23456789CFGHJMPQRVWX",P=D.length,N=90,h=180,U=10,H=[20,1,.05,.0025,125e-6],Y=4,K=5,_e=125e-6,we=6;c.prototype.isValid=function(at){if(!at||at.indexOf(d)==-1||at.indexOf(d)!=at.lastIndexOf(d)||at.length==1||at.indexOf(d)>y||at.indexOf(d)%2==1)return!1;if(at.indexOf(C)>-1){if(at.indexOf(C)==0)return!1;var He=at.match(new RegExp("("+C+"+)","g"));if(He.length>1||He[0].length%2==1||He[0].length>y-2||at.charAt(at.length-1)!=d)return!1}if(at.length-at.indexOf(d)-1==1)return!1;at=at.replace(new RegExp("\\"+d+"+"),"").replace(new RegExp(C+"+"),"");for(var _t=0,Pe=at.length;_t<Pe;_t++){var ht=at.charAt(_t).toUpperCase();if(ht!=d&&D.indexOf(ht)==-1)return!1}return!0},c.prototype.isShort=function(at){return this.isValid(at)?at.indexOf(d)>=0&&at.indexOf(d)<y:!1},c.prototype.isFull=function(at){if(!this.isValid(at)||this.isShort(at))return!1;var He=D.indexOf(at.charAt(0).toUpperCase())*P;if(He>=N*2)return!1;if(at.length>1){var _t=D.indexOf(at.charAt(1).toUpperCase())*P;if(_t>=h*2)return!1}return!0},c.prototype.encode=function(at,He,_t){if(typeof _t>"u"&&(_t=U),_t<2||_t<y&&_t%2==1)throw"IllegalArgumentException: Invalid Open Location Code length";at=ve(at),He=he(He),at==90&&(at=at-pe(_t));var Pe=De(at,He,Math.min(_t,U));return _t>U&&(Pe+=Je(at,He,_t-U)),Pe},c.prototype.decode=function(at){if(!this.isFull(at))throw"IllegalArgumentException: Passed Open Location Code is not a valid full code: "+at;at=at.replace(d,""),at=at.replace(new RegExp(C+"+"),""),at=at.toUpperCase();var He=Xe(at.substring(0,U));if(at.length<=U)return He;var _t=Wt(at.substring(U));return Et(He.latitudeLo+_t.latitudeLo,He.longitudeLo+_t.longitudeLo,He.latitudeLo+_t.latitudeHi,He.longitudeLo+_t.longitudeHi,He.codeLength+_t.codeLength)},c.prototype.recoverNearest=function(at,He,_t){if(!this.isShort(at)){if(this.isFull(at))return at;throw"ValueError: Passed short code is not valid: "+at}He=ve(He),_t=he(_t),at=at.toUpperCase();var Pe=y-at.indexOf(d),ht=Math.pow(20,2-Pe/2),vt=ht/2,qt=Math.floor(He/ht)*ht,ke=Math.floor(_t/ht)*ht,Te=this.decode(this.encode(qt,ke).substr(0,Pe)+at),Ze=Te.latitudeCenter-He;return Ze>vt?Te.latitudeCenter-=ht:Ze<-vt&&(Te.latitudeCenter+=ht),Ze=Te.longitudeCenter-_t,Ze>vt?Te.longitudeCenter-=ht:Ze<-vt&&(Te.longitudeCenter+=ht),this.encode(Te.latitudeCenter,Te.longitudeCenter,Te.codeLength)},c.prototype.shorten=function(Pe,He,_t){if(!this.isFull(Pe))throw"ValueError: Passed code is not valid and full: "+Pe;if(Pe.indexOf(C)!=-1)throw"ValueError: Cannot shorten padded codes: "+Pe;var Pe=Pe.toUpperCase(),ht=this.decode(Pe);if(ht.codeLength<we)throw"ValueError: Code length must be at least "+we;He=ve(He),_t=he(_t);for(var vt=Math.max(Math.abs(ht.latitudeCenter-He),Math.abs(ht.longitudeCenter-_t)),qt=H.length-2;qt>=1;qt--)if(vt<H[qt]*.3)return Pe.substring((qt+1)*2);return Pe};var ve=function(at){return Math.min(90,Math.max(-90,at))},pe=function(at){return at<=10?Math.pow(20,Math.floor(at/-2+2)):Math.pow(20,-3)/Math.pow(K,at-10)},he=function(at){for(;at<-180;)at=at+360;for(;at>=180;)at=at-360;return at},De=function(at,He,_t){for(var Pe="",ht=at+N,vt=He+h,qt=0;qt<_t;){var ke=H[Math.floor(qt/2)],Te=Math.floor(ht/ke);ht-=Te*ke,Pe+=D.charAt(Te),qt+=1,Te=Math.floor(vt/ke),vt-=Te*ke,Pe+=D.charAt(Te),qt+=1,qt==y&&qt<_t&&(Pe+=d)}return Pe.length<y&&(Pe=Pe+Array(y-Pe.length+1).join(C)),Pe.length==y&&(Pe=Pe+d),Pe},Je=function(at,He,_t){for(var Pe="",ht=_e,vt=_e,qt=(at+N)%ht,ke=(He+h)%vt,Te=0;Te<_t;Te++){var Ze=Math.floor(qt/(ht/K)),ut=Math.floor(ke/(vt/Y));ht/=K,vt/=Y,qt-=Ze*ht,ke-=ut*vt,Pe+=D.charAt(Ze*Y+ut)}return Pe},Xe=function(at){var He=mt(at,0),_t=mt(at,1);return new Et(He[0]-N,_t[0]-h,He[1]-N,_t[1]-h,at.length)},mt=function(at,He){for(var _t=0,Pe=0;_t*2+He<at.length;)Pe+=D.indexOf(at.charAt(_t*2+He))*H[_t],_t+=1;return[Pe,Pe+H[_t-1]]},Wt=function(at){for(var He=0,_t=0,Pe=_e,ht=_e,vt=0;vt<at.length;){var qt=D.indexOf(at.charAt(vt)),ke=Math.floor(qt/Y),Te=qt%Y;Pe/=K,ht/=Y,He+=ke*Pe,_t+=Te*ht,vt+=1}return Et(He,_t,He+Pe,_t+ht,at.length)},Et=c.prototype.CodeArea=function(at,He,_t,Pe,ht){return new rt.init(at,He,_t,Pe,ht)},rt={init:function(at,He,_t,Pe,ht){this.latitudeLo=at,this.longitudeLo=He,this.latitudeHi=_t,this.longitudeHi=Pe,this.codeLength=ht,this.latitudeCenter=Math.min(at+(_t-at)/2,N),this.longitudeCenter=Math.min(He+(Pe-He)/2,h)}};return gy.OpenLocationCode=c,gy}var t4=e4();const n4=rp(t4);function Pl(c,d,y=10){const C=[16,8,4,2,1],D="0123456789bcdefghjkmnpqrstuvwxyz";let P=!0,N=-90,h=90,U=-180,H=180,Y="",K=0,_e=0;for(;Y.length<y;){if(P){const we=(U+H)/2;d>we?(_e|=C[K],U=we):H=we}else{const we=(N+h)/2;c>we?(_e|=C[K],N=we):h=we}P=!P,K<4?K++:(Y+=D[_e],K=0,_e=0)}return Y}function i4(c,d){return`${c.toFixed(6)}, ${d.toFixed(6)}`}function r4(c,d,y=5){const C=Pl(c,d,y),D=y===5?.02:y===6?.005:.001,P=y===5?.04:y===6?.01:.002,N=new Set;N.add(C);const h=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[U,H]of h){const Y=c+U*D,K=d+H*P;N.add(Pl(Y,K,y))}return Array.from(N)}const my=n4,s4=my.OpenLocationCode||my.default?.OpenLocationCode||my,il=new s4;function Dl(c){const d=c.trim();if(d.replace(//g,"").replace(/,/g," ").split(/\s+/).filter(D=>D.length>0).length>=2){let D=null,P=null;const N=d.match(/^(-?\d+(\.\d+)?)[,\s]+(-?\d+(\.\d+)?)$/);if(N)D=parseFloat(N[1]),P=parseFloat(N[3]);else{const h=d.matchAll(/([0-9.-]+)\s*?\s*([NSEWnsew])?/g),U=Array.from(h);if(U.length===2){const H=parseFloat(U[0][1]),Y=U[0][2]?.toUpperCase(),K=parseFloat(U[1][1]),_e=U[1][2]?.toUpperCase(),we=(he,De)=>{let Je=he;return(De==="S"||De==="W")&&(Je=-he),De==="N"||De==="S"?{type:"lat",val:Je}:De==="E"||De==="W"?{type:"lon",val:Je}:{type:"unknown",val:Je}},ve=we(H,Y),pe=we(K,_e);ve.type==="lat"&&pe.type==="lon"?(D=ve.val,P=pe.val):ve.type==="lon"&&pe.type==="lat"?(P=ve.val,D=pe.val):ve.type==="unknown"&&pe.type==="unknown"&&(D=ve.val,P=pe.val)}}if(D!==null&&P!==null&&!isNaN(D)&&!isNaN(P)&&D>=-90&&D<=90&&P>=-180&&P<=180)return{lat:D,lon:P,type:"coordinate"}}try{const P=d.split(/[\s,]+/)[0];if(il&&il.isValid&&il.isValid(d)&&il.isFull(d)){const N=il.decode(d);return{lat:N.latitudeCenter,lon:N.longitudeCenter,type:"plus_code"}}if(P.length>=6&&P.includes("+")&&il&&il.isValid&&il.isValid(P)&&il.isFull(P)){const N=il.decode(P);return{lat:N.latitudeCenter,lon:N.longitudeCenter,type:"plus_code"}}if(!d.includes("+")){const N=d.toUpperCase().replace(/\s+/g,"+");if(il&&il.isValid&&il.isValid(N)&&il.isFull(N)){const h=il.decode(N);return{lat:h.latitudeCenter,lon:h.longitudeCenter,type:"plus_code"}}}}catch{}return null}function F_(c,d,y,C){const P=(y-c)*Math.PI/180,N=(C-d)*Math.PI/180,h=Math.sin(P/2)*Math.sin(P/2)+Math.cos(c*Math.PI/180)*Math.cos(y*Math.PI/180)*Math.sin(N/2)*Math.sin(N/2);return 6371*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}async function Dg(c,d,y,C=5){if(!c||c.length<3)return[];try{let D=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(c)}&format=json&limit=${C}&addressdetails=1`;if(d&&(D+=`&countrycodes=${d}`),y){const U=y[1]-1,H=y[1]+1,Y=y[0]+1,K=y[0]-1;D+=`&viewbox=${U},${Y},${H},${K}`}const N=await(await fetch(D)).json();return Array.isArray(N)?N:[]}catch(D){return console.error("[Parlens] Suggestion fetch error:",D),[]}}async function I1(c,d,y){const C=JSON.stringify(c);if(y){const D=zg.getConversationKey(y,d);return zg.encrypt(C,D)}else if(window.nostr?.nip44?.encrypt)return await window.nostr.nip44.encrypt(d,C);throw new Error("No encryption method available")}async function Cx(c,d,y){let C;if(y){const D=zg.getConversationKey(y,d);C=zg.decrypt(c,D)}else if(window.nostr?.nip44?.decrypt)C=await window.nostr.nip44.decrypt(d,c);else throw new Error("No decryption method available");return JSON.parse(C)}const o1={IN:"INR",US:"USD",GB:"GBP",DE:"EUR",FR:"EUR",ES:"EUR",IT:"EUR",NL:"EUR",BE:"EUR",AT:"EUR",PT:"EUR",IE:"EUR",JP:"JPY",CA:"CAD",AU:"AUD",CN:"CNY",AE:"AED",SG:"SGD",HK:"HKD",CH:"CHF",SE:"SEK",NO:"NOK",DK:"DKK",NZ:"NZD",MX:"MXN",BR:"BRL",ZA:"ZAR",KR:"KRW",TH:"THB",MY:"MYR",PH:"PHP",ID:"IDR",VN:"VND",RU:"RUB",PL:"PLN",TR:"TRY",SA:"SAR",EG:"EGP"};async function d2(c,d){try{const y=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${c}&lon=${d}&zoom=3`,{headers:{"User-Agent":"Parlens-PWA/1.0"}});if(!y.ok)throw new Error("Geocoding failed");const D=(await y.json()).address?.country_code?.toUpperCase();return D&&o1[D]?o1[D]:"USD"}catch(y){return console.warn("Currency detection failed, using locale fallback:",y),f2()}}function f2(){try{const d=window.navigator.language.split("-")[1]?.toUpperCase();return d&&o1[d]?o1[d]:"USD"}catch{return"USD"}}function m0(c){try{return 0 .toLocaleString(window.navigator.language,{style:"currency",currency:c,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}catch{return{INR:"",USD:"$",GBP:"",EUR:"",JPY:"",CAD:"C$",AUD:"A$",CNY:"",AED:".",SGD:"S$"}[c]||"$"}}const a4={INR:"IN",USD:"US",GBP:"GB",EUR:"EU",JPY:"JP",CAD:"CA",AUD:"AU",CNY:"CN",AED:"AE",SGD:"SG",HKD:"HK",CHF:"CH",SEK:"SE",NOK:"NO",DKK:"DK",NZD:"NZ",MXN:"MX",BRL:"BR",ZAR:"ZA",KRW:"KR",THB:"TH",MYR:"MY",PHP:"PH",IDR:"ID",VND:"VN",RUB:"RU",PLN:"PL",TRY:"TR",SAR:"SA",EGP:"EG"};function o4(c){return(a4[c]||"US").toUpperCase().replace(/./g,y=>String.fromCodePoint(y.charCodeAt(0)+127397))}var Wf=Symbol("verified"),l4=c=>c instanceof Object;function p2(c){if(!l4(c)||typeof c.kind!="number"||typeof c.content!="string"||typeof c.created_at!="number"||typeof c.pubkey!="string"||!c.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(c.tags))return!1;for(let d=0;d<c.tags.length;d++){let y=c.tags[d];if(!Array.isArray(y))return!1;for(let C=0;C<y.length;C++)if(typeof y[C]!="string")return!1}return!0}new TextDecoder("utf-8");var c4=new TextEncoder,u4=class{generateSecretKey(){return Ku.utils.randomPrivateKey()}getPublicKey(c){return vs(Ku.getPublicKey(c))}finalizeEvent(c,d){const y=c;return y.pubkey=vs(Ku.getPublicKey(d)),y.id=Km(y),y.sig=vs(Ku.sign(Km(y),d)),y[Wf]=!0,y}verifyEvent(c){if(typeof c[Wf]=="boolean")return c[Wf];const d=Km(c);if(d!==c.id)return c[Wf]=!1,!1;try{const y=Ku.verify(c.sig,d,c.pubkey);return c[Wf]=y,y}catch{return c[Wf]=!1,!1}}};function g2(c){if(!p2(c))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,c.pubkey,c.created_at,c.kind,c.tags,c.content])}function Km(c){let d=Gd(c4.encode(g2(c)));return vs(d)}var M1=new u4,m2=M1.generateSecretKey,h4=M1.getPublicKey,y2=M1.finalizeEvent;M1.verifyEvent;const Oy=Object.freeze(Object.defineProperty({__proto__:null,finalizeEvent:y2,generateSecretKey:m2,getEventHash:Km,getPublicKey:h4,serializeEvent:g2,validateEvent:p2,verifiedSymbol:Wf},Symbol.toStringTag,{value:"Module"})),d4=Qs.memo(({status:c,setStatus:d,searchLocation:y,userLocation:C,vehicleType:D,setOpenSpots:P,parkLocation:N,setParkLocation:h,sessionStart:U,setSessionStart:H,listedParkingSession:Y,onQRScan:K,onSpotStatusUpdate:_e})=>{const{pubkey:we,pool:ve,signEvent:pe}=nh(),[he,De]=me.useState(!1),[Je,Xe]=me.useState("0"),[mt,Wt]=me.useState(""),[Et,rt]=me.useState("USD"),[at,He]=me.useState("$"),[_t,Pe]=me.useState("00:00:00"),[ht,vt]=me.useState(new Set),[qt,ke]=me.useState(new Set),Te=me.useRef(new Map),Ze=me.useRef(null),ut=me.useRef(new Set);me.useEffect(()=>{try{const ct=localStorage.getItem("parlens-hidden-items");if(ct){const kt=JSON.parse(ct);vt(new Set(kt.map(bt=>bt.id)))}}catch(ct){console.error("Error loading hidden items:",ct)}},[]),me.useEffect(()=>{if(c==="parked"&&U){const ct=()=>{const an=Math.floor(Date.now()/1e3)-U,Bt=Math.floor(an/3600),Qt=Math.floor(an%3600/60),un=an%60;Pe(`${Bt.toString().padStart(2,"0")}:${Qt.toString().padStart(2,"0")}:${un.toString().padStart(2,"0")}`)},kt=setInterval(ct,1e3);return ct(),()=>clearInterval(kt)}},[c,U]),me.useEffect(()=>{if(c==="search"&&y){const ct=Pl(y[0],y[1],5);if(ct===Ze.current)return;Ze.current=ct;const kt=r4(y[0],y[1],5);ke(bt=>{const an=new Set(bt);return kt.forEach(Bt=>an.add(Bt)),an.size!==bt.size?an:bt})}else c==="idle"&&(ke(new Set),Te.current.clear(),P([]),Ze.current=null)},[c,y,P]),me.useEffect(()=>{if(ve&&c==="search"&&qt.size>0){let ct=function(){const Qt=Array.from(Te.current.values()),un=new Map;Qt.forEach(nn=>{if(nn.listing_a_tag)if(un.has(nn.listing_a_tag)){const kn=un.get(nn.listing_a_tag);kn.count+=1,nn.created_at>kn.created_at&&(kn.created_at=nn.created_at)}else un.set(nn.listing_a_tag,{...nn,count:1,id:nn.listing_a_tag});else un.set(nn.id,nn)}),P(Array.from(un.values()))};console.log("[Parlens] Subscribing to spots in geohashes:",Array.from(qt));const kt=Math.floor(Date.now()/1e3),bt=(Qt,un=!1)=>{try{const nn=Math.floor(Date.now()/1e3);if(Qt.kind===Ln.PARKING_AREA_INDICATOR){const Rn=Qt.tags.find(Ei=>Ei[0]==="expiration");if(Rn&&parseInt(Rn[1])<nn)return}if(ht.has(Qt.pubkey))return;let kn,Nn,ii,En="car",si=0,wi="USD";const Oi=Qt.tags.find(Rn=>Rn[0]==="location");let Yn=0,Gn=0;if(Oi)[Yn,Gn]=Oi[1].split(",").map(Number);else return;if(Qt.kind===Ln.LISTED_SPOT_LOG){const Rn=Qt.tags.find(ge=>ge[0]==="a"&&ge[3]==="root")?.[1];if(Rn){const ge=Rn.split(":");if(ge.length===3){kn=ge[2],Nn=Rn;const Ue=ge[1];if(ht.has(Ue)||kn&&ht.has(kn))return}}const Ei=Qt.tags.find(ge=>ge[0]==="status");let on=Qt.id;const Li=Qt.tags.find(ge=>ge[0]==="a")?.[1];if(Li&&(on=Li),_e&&Y&&Y.spotATag===on&&_e(on,Ei?.[1]||"unknown",Qt),Ei?.[1]!=="open"){Te.current.has(on)&&(Te.current.delete(on),un&&ct());return}const tr=Qt.tags.find(ge=>ge[0]==="type"),Di=Qt.tags.find(ge=>ge[0]==="hourly_rate"),yr=Qt.tags.find(ge=>ge[0]==="currency"),yt=Qt.tags.find(ge=>ge[0]==="listing_name");if(En=tr?.[1]||"car",si=Di&&Number(Di[1])||0,wi=yr?.[1]||"USD",ii=yt?.[1],En!==D)return;const oe=Te.current.get(on);if(oe&&oe.created_at>Qt.created_at)return;const le={id:Qt.id,lat:Yn,lon:Gn,price:si,currency:wi,type:En,count:1,kind:Qt.kind,created_at:Qt.created_at,listing_name:ii,listing_id:kn,listing_a_tag:Nn,tags:Qt.tags};Te.current.set(on,le)}else if(Qt.kind===Ln.PARKING_AREA_INDICATOR){const Rn=Qt.tags.find(tr=>tr[0]==="hourly_rate"),Ei=Qt.tags.find(tr=>tr[0]==="currency"),on=Qt.tags.find(tr=>tr[0]==="type");si=Rn&&Number(Rn[1])||0,wi=Ei?Ei[1]:"USD",En=on?on[1]:"car";const Li={id:Qt.id,lat:Yn,lon:Gn,price:si,currency:wi,type:En,count:1,kind:Qt.kind,created_at:Qt.created_at,tags:Qt.tags};Te.current.set(Qt.id,Li)}un&&ct()}catch(nn){console.warn("[Parlens] Error parsing spot event:",nn)}};(async()=>{const Qt=Array.from(qt);if(Qt.length!==0){try{const un=localStorage.getItem("parlens_parking_area_filter")||"all";let nn=kt-604800;un==="today"?nn=kt-86400:un==="month"?nn=kt-2592e3:un==="year"?nn=kt-31536e3:un==="all"&&(nn=0);const kn=Date.now(),Nn=await ve.querySync(Kn,{kinds:[Ln.PARKING_AREA_INDICATOR],"#g":Qt,since:nn}),ii=Date.now()-kn;Kn.forEach(En=>_o.recordSuccess(En,ii));for(const En of Nn)bt(En);Te.current.size>0&&P(Array.from(Te.current.values())),console.log("[Parlens] Batch 1 (Kind 31714) loaded:",Nn.length,"events in",ii,"ms")}catch(un){Kn.forEach(nn=>_o.recordFailure(nn)),console.error("[Parlens] Batch 1 (Kind 31714) failed:",un)}try{const un=await ve.querySync(Kn,{kinds:[Ln.LABEL],"#g":Qt,"#L":["parlens"],"#l":["no-parking"]});for(const nn of un){const kn=nn.tags.find(En=>En[0]==="g")?.[1],Nn=nn.tags.find(En=>En[0]==="location")?.[1];if(!kn)continue;const ii={id:nn.id,kind:Ln.LABEL,tags:nn.tags,lat:Nn?parseFloat(Nn.split(",")[0]):0,lon:Nn?parseFloat(Nn.split(",")[1]):0,price:0,currency:"INR",created_at:nn.created_at,pubkey:nn.pubkey};Te.current.set(nn.id,ii)}un.length>0&&(P(Array.from(Te.current.values())),console.log("[Parlens] Batch 1.5 (Kind 1985 no-parking) loaded:",un.length,"labels"))}catch(un){console.error("[Parlens] Batch 1.5 (Kind 1985 no-parking) failed:",un)}try{const un=Date.now(),nn=await ve.querySync(Kn,{kinds:[Ln.LISTED_SPOT_LOG],"#g":Qt}),kn=Date.now()-un;Kn.forEach(En=>_o.recordSuccess(En,kn)),console.log("[Parlens] Batch 2 (Kind 1714) loaded:",nn.length,"events in",kn,"ms");const Nn=new Map,ii=new Set;for(const En of nn){const si=En.tags.find(Yn=>Yn[0]==="a")?.[1];if(!si)continue;const wi=En.tags.find(Yn=>Yn[0]==="a"&&Yn[3]==="root")?.[1];wi&&wi.split(":").length===3&&ii.add(wi);const Oi=Nn.get(si);(!Oi||Oi.created_at<En.created_at)&&Nn.set(si,En)}if(ii.size>0){const En=Array.from(ii),si=new Set,wi=new Set;En.forEach(Gn=>{const Rn=Gn.split(":");Rn.length===3&&(wi.add(Rn[1]),si.add(Rn[2]))});const Oi=await ve.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],"#d":Array.from(si),authors:Array.from(wi)}),Yn=new Set;Oi.forEach(Gn=>{const Rn=Gn.tags.find(Ei=>Ei[0]==="d")?.[1];Rn&&Yn.add(`${Ln.LISTED_PARKING_METADATA}:${Gn.pubkey}:${Rn}`)});try{const Gn=await ve.querySync(Kn,{kinds:[Ln.LABEL],authors:[zd],"#l":["approved"]});ut.current=new Set;for(const Rn of Gn){const Ei=Rn.tags.find(on=>on[0]==="a")?.[1];Ei&&ut.current.add(Ei)}console.log("[Parlens] Found",ut.current.size,"approved listings from approver")}catch(Gn){console.error("[Parlens] Failed to fetch approval labels:",Gn)}for(const Gn of Nn.values()){const Rn=Gn.tags.find(Ei=>Ei[0]==="a"&&Ei[3]==="root")?.[1];if(Rn&&Yn.has(Rn)){const on=Rn.split(":")[1]===zd,Li=ut.current.has(Rn);(on||Li)&&bt(Gn)}}}Te.current.size>0?ct():P([]),console.log("[Parlens] Batch 2 (Kind 1714 + orphan validation) completed")}catch(un){Kn.forEach(nn=>_o.recordFailure(nn)),console.error("[Parlens] Batch 2 (Kind 1714 + orphan validation) failed:",un)}}})();const Bt=ve.subscribeMany(Kn,[{kinds:[Ln.PARKING_AREA_INDICATOR,Ln.LISTED_SPOT_LOG],"#g":Array.from(qt),since:kt}],{onevent(Qt){bt(Qt,!0)},oneose(){}});return()=>{console.log("[Parlens] Unsubscribing from spots"),Bt.close()}}},[c,qt,ve,P]);const Tt=me.useRef(!1);me.useEffect(()=>{(async()=>{if(Tt.current)return;const kt=f2();if(rt(kt),He(m0(kt)),y){Tt.current=!0;try{const bt=await d2(y[0],y[1]);rt(bt),He(m0(bt))}catch{console.warn("GPS currency detection failed")}}})()},[y]);const sn=async()=>{c==="idle"?d("search"):c==="search"?(H(Math.floor(Date.now()/1e3)),h(C?[C[0],C[1]]:null),d("parked")):c==="parked"&&(Y?K?.():(Xe("0"),De(!0)))},Re=async()=>{d("idle"),De(!1);const ct=N?N[0]:y?y[0]:0,kt=N?N[1]:y?y[1]:0,bt=Pl(ct,kt,5),an=Math.floor(Date.now()/1e3),Bt=U||an;try{const Qt={status:"vacated",lat:ct,lon:kt,geohash:bt,fee:Je,currency:Et,type:D,note:mt||void 0,started_at:Bt,finished_at:an},un=localStorage.getItem("parlens_privkey"),nn=un?new Uint8Array(un.match(/.{1,2}/g).map(Yn=>parseInt(Yn,16))):void 0,kn=await I1(Qt,we,nn),Nn={kind:Ln.PARKING_LOG,content:kn,tags:[["d",`session_${Bt}`],["client","parlens"]],created_at:an,pubkey:we},ii=await pe(Nn);console.log("Publishing log:",ii.id,"to",Kn);const En=await Promise.allSettled(ve.publish(Kn,ii)),si=En.filter(Yn=>Yn.status==="fulfilled").length,wi=En.filter(Yn=>Yn.status==="rejected").length;if(console.log(`[Parlens] Publish results: ${si}/${En.length} succeeded, ${wi} failed`),En.forEach((Yn,Gn)=>{Yn.status==="rejected"&&console.warn(`[Parlens] Relay ${Kn[Gn]} failed:`,Yn.reason)}),si===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)"),console.log("Log published"),await new Promise(Yn=>setTimeout(Yn,300)),window.dispatchEvent(new Event("parking-log-updated")),localStorage.getItem("parlens_share_parking_areas")==="true"){const Yn=m2(),Gn=an-Bt,Rn=Math.max(Math.ceil(Gn/3600),1),Ei=String(Math.round(parseFloat(Je)/Rn)),on={kind:Ln.PARKING_AREA_INDICATOR,content:"",tags:[["d",`spot_${bt}_${an}`],["g",bt],...Array.from({length:Math.min(bt.length,10)},(tr,Di)=>["g",bt.substring(0,Di+1)]).filter(tr=>tr[1].length<bt.length),["location",`${ct},${kt}`],["hourly_rate",Ei],["currency",Et],["type",D],["session_start",String(Bt)],["session_end",String(an)],["client","parlens"]],created_at:an},Li=y2(on,Yn);console.log("[Parlens] *** BROADCASTING OPEN SPOT (User opted in) ***"),console.log("[Parlens] Geohash:",bt),console.log("[Parlens] Location:",`${ct},${kt}`),console.log("[Parlens] Event ID:",Li.id),console.log("[Parlens] Pubkey:",Li.pubkey.substring(0,20)+"..."),ve.publish(Kn,Li)}else console.log("[Parlens] Parking area reporting is disabled. Skipping Kind 31714 broadcast.");H(null),h(null),Wt("")}catch(Qt){console.error("Persistence error:",Qt),alert("Could not save to Nostr. Check relay connections.")}};return k.jsxs("div",{className:"relative flex flex-col items-end gap-4 pointer-events-none",children:[k.jsxs("div",{className:"flex items-center gap-4",children:[c==="search"&&k.jsx("button",{onClick:()=>d("idle"),className:"h-14 px-8 rounded-full bg-red-500/90 text-white font-bold text-xs tracking-widest shadow-2xl backdrop-blur-md animate-in slide-in-from-left-8 pointer-events-auto",children:"CANCEL"}),c==="parked"&&k.jsx("div",{className:"h-14 px-6 rounded-full bg-white/90 dark:bg-zinc-800/90 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-2xl flex items-center justify-center animate-in slide-in-from-left-8 pointer-events-none",children:k.jsx("span",{className:"font-mono text-xl font-bold tabular-nums text-zinc-900 dark:text-white",children:_t})}),k.jsxs("button",{onClick:sn,className:`h-20 w-20 flex items-center justify-center rounded-[2.5rem] shadow-2xl transition-all active:scale-90 pointer-events-auto ${c==="idle"?"bg-[#007AFF] text-white shadow-blue-500/20":c==="search"?"bg-[#FF9500] text-white shadow-orange-500/20":"bg-[#34C759] text-white shadow-green-500/20"}`,children:[c==="idle"&&k.jsx(s2,{size:32,strokeWidth:2.5}),c==="search"&&k.jsx(eo,{size:32,strokeWidth:2.5,className:"animate-pulse"}),c==="parked"&&(D==="bicycle"?k.jsx("span",{className:"text-3xl",children:""}):D==="motorcycle"?k.jsx("span",{className:"text-3xl",children:""}):k.jsx("span",{className:"text-3xl",children:""}))]})]}),he&&k.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4 pointer-events-auto",children:k.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[k.jsxs("div",{className:"text-center space-y-1",children:[k.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),k.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee, 0 if free parking"})]}),k.jsxs("div",{className:"flex items-center gap-4",children:[k.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[k.jsx("span",{className:"text-2xl font-bold text-blue-500",children:at}),k.jsx("input",{type:"number",value:Je,onChange:ct=>Xe(ct.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),k.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:Et})]}),k.jsxs("div",{className:"flex flex-col gap-1.5",children:[k.jsx("button",{onClick:()=>Xe(String(Math.max(0,parseFloat(Je||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(T1,{size:22,className:"text-zinc-600 dark:text-white/70"})}),k.jsx("button",{onClick:()=>Xe(String(Math.max(0,parseFloat(Je||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(Fd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),k.jsx("input",{type:"text",value:mt,onChange:ct=>Wt(ct.target.value),placeholder:"Add a note (optional)",className:"w-full bg-zinc-100 dark:bg-white/5 px-4 py-3 rounded-xl border border-black/5 dark:border-white/5 text-sm text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-[#007AFF]/50"}),k.jsxs("div",{className:"w-full space-y-3",children:[k.jsxs("button",{onClick:Re,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",k.jsx(e2,{size:20})]}),k.jsx("button",{onClick:()=>De(!1),className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})});function f4(){const{pool:c,pubkey:d}=nh(),[y,C]=me.useState([]),[D,P]=me.useState(!0),N=me.useRef(new Set),h=me.useCallback(async()=>{if(!(!d||!c)){P(!0),console.log("[useParkingLogs] Fetching logs for",d);try{const H=await c.querySync(Kn,{kinds:[Ln.PARKING_LOG,5],authors:[d],limit:100});console.log("[useParkingLogs] Fetched",H.length,"events");const Y=new Set,K=H.filter(pe=>pe.kind===5);for(const pe of K)for(const he of pe.tags)he[0]==="a"&&Y.add(he[1]);const we=H.filter(pe=>pe.kind===Ln.PARKING_LOG).filter(pe=>{const he=pe.tags?.find(Je=>Je[0]==="d")?.[1];if(!he)return!0;if(N.current.has(he))return!1;const De=`${pe.kind}:${pe.pubkey}:${he}`;return!Y.has(De)});console.log("[useParkingLogs] Valid logs after filtering:",we.length);const ve=we.sort((pe,he)=>he.created_at-pe.created_at);C(ve)}catch(H){console.error("[useParkingLogs] Fetch error:",H)}finally{P(!1)}}},[c,d]),U=me.useCallback(H=>{console.log("[useParkingLogs] Marking deleted:",H),N.current.add(H)},[]);return me.useEffect(()=>{d&&h()},[d,h]),me.useEffect(()=>{const H=()=>{console.log("[useParkingLogs] Received update event, refetching..."),h()};return window.addEventListener("parking-log-updated",H),window.addEventListener("visibility-refresh",H),()=>{window.removeEventListener("parking-log-updated",H),window.removeEventListener("visibility-refresh",H)}},[h]),{logs:y,loading:D,refetch:h,markDeleted:U}}var p4=Object.defineProperty,l1=Object.getOwnPropertySymbols,x2=Object.prototype.hasOwnProperty,_2=Object.prototype.propertyIsEnumerable,j_=(c,d,y)=>d in c?p4(c,d,{enumerable:!0,configurable:!0,writable:!0,value:y}):c[d]=y,zy=(c,d)=>{for(var y in d||(d={}))x2.call(d,y)&&j_(c,y,d[y]);if(l1)for(var y of l1(d))_2.call(d,y)&&j_(c,y,d[y]);return c},Ly=(c,d)=>{var y={};for(var C in c)x2.call(c,C)&&d.indexOf(C)<0&&(y[C]=c[C]);if(c!=null&&l1)for(var C of l1(c))d.indexOf(C)<0&&_2.call(c,C)&&(y[C]=c[C]);return y};var ip;(c=>{const d=class wr{constructor(U,H,Y,K){if(this.version=U,this.errorCorrectionLevel=H,this.modules=[],this.isFunction=[],U<wr.MIN_VERSION||U>wr.MAX_VERSION)throw new RangeError("Version value out of range");if(K<-1||K>7)throw new RangeError("Mask value out of range");this.size=U*4+17;let _e=[];for(let ve=0;ve<this.size;ve++)_e.push(!1);for(let ve=0;ve<this.size;ve++)this.modules.push(_e.slice()),this.isFunction.push(_e.slice());this.drawFunctionPatterns();const we=this.addEccAndInterleave(Y);if(this.drawCodewords(we),K==-1){let ve=1e9;for(let pe=0;pe<8;pe++){this.applyMask(pe),this.drawFormatBits(pe);const he=this.getPenaltyScore();he<ve&&(K=pe,ve=he),this.applyMask(pe)}}D(0<=K&&K<=7),this.mask=K,this.applyMask(K),this.drawFormatBits(K),this.isFunction=[]}static encodeText(U,H){const Y=c.QrSegment.makeSegments(U);return wr.encodeSegments(Y,H)}static encodeBinary(U,H){const Y=c.QrSegment.makeBytes(U);return wr.encodeSegments([Y],H)}static encodeSegments(U,H,Y=1,K=40,_e=-1,we=!0){if(!(wr.MIN_VERSION<=Y&&Y<=K&&K<=wr.MAX_VERSION)||_e<-1||_e>7)throw new RangeError("Invalid value");let ve,pe;for(ve=Y;;ve++){const Xe=wr.getNumDataCodewords(ve,H)*8,mt=N.getTotalBits(U,ve);if(mt<=Xe){pe=mt;break}if(ve>=K)throw new RangeError("Data too long")}for(const Xe of[wr.Ecc.MEDIUM,wr.Ecc.QUARTILE,wr.Ecc.HIGH])we&&pe<=wr.getNumDataCodewords(ve,Xe)*8&&(H=Xe);let he=[];for(const Xe of U){y(Xe.mode.modeBits,4,he),y(Xe.numChars,Xe.mode.numCharCountBits(ve),he);for(const mt of Xe.getData())he.push(mt)}D(he.length==pe);const De=wr.getNumDataCodewords(ve,H)*8;D(he.length<=De),y(0,Math.min(4,De-he.length),he),y(0,(8-he.length%8)%8,he),D(he.length%8==0);for(let Xe=236;he.length<De;Xe^=253)y(Xe,8,he);let Je=[];for(;Je.length*8<he.length;)Je.push(0);return he.forEach((Xe,mt)=>Je[mt>>>3]|=Xe<<7-(mt&7)),new wr(ve,H,Je,_e)}getModule(U,H){return 0<=U&&U<this.size&&0<=H&&H<this.size&&this.modules[H][U]}getModules(){return this.modules}drawFunctionPatterns(){for(let Y=0;Y<this.size;Y++)this.setFunctionModule(6,Y,Y%2==0),this.setFunctionModule(Y,6,Y%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const U=this.getAlignmentPatternPositions(),H=U.length;for(let Y=0;Y<H;Y++)for(let K=0;K<H;K++)Y==0&&K==0||Y==0&&K==H-1||Y==H-1&&K==0||this.drawAlignmentPattern(U[Y],U[K]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(U){const H=this.errorCorrectionLevel.formatBits<<3|U;let Y=H;for(let _e=0;_e<10;_e++)Y=Y<<1^(Y>>>9)*1335;const K=(H<<10|Y)^21522;D(K>>>15==0);for(let _e=0;_e<=5;_e++)this.setFunctionModule(8,_e,C(K,_e));this.setFunctionModule(8,7,C(K,6)),this.setFunctionModule(8,8,C(K,7)),this.setFunctionModule(7,8,C(K,8));for(let _e=9;_e<15;_e++)this.setFunctionModule(14-_e,8,C(K,_e));for(let _e=0;_e<8;_e++)this.setFunctionModule(this.size-1-_e,8,C(K,_e));for(let _e=8;_e<15;_e++)this.setFunctionModule(8,this.size-15+_e,C(K,_e));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let U=this.version;for(let Y=0;Y<12;Y++)U=U<<1^(U>>>11)*7973;const H=this.version<<12|U;D(H>>>18==0);for(let Y=0;Y<18;Y++){const K=C(H,Y),_e=this.size-11+Y%3,we=Math.floor(Y/3);this.setFunctionModule(_e,we,K),this.setFunctionModule(we,_e,K)}}drawFinderPattern(U,H){for(let Y=-4;Y<=4;Y++)for(let K=-4;K<=4;K++){const _e=Math.max(Math.abs(K),Math.abs(Y)),we=U+K,ve=H+Y;0<=we&&we<this.size&&0<=ve&&ve<this.size&&this.setFunctionModule(we,ve,_e!=2&&_e!=4)}}drawAlignmentPattern(U,H){for(let Y=-2;Y<=2;Y++)for(let K=-2;K<=2;K++)this.setFunctionModule(U+K,H+Y,Math.max(Math.abs(K),Math.abs(Y))!=1)}setFunctionModule(U,H,Y){this.modules[H][U]=Y,this.isFunction[H][U]=!0}addEccAndInterleave(U){const H=this.version,Y=this.errorCorrectionLevel;if(U.length!=wr.getNumDataCodewords(H,Y))throw new RangeError("Invalid argument");const K=wr.NUM_ERROR_CORRECTION_BLOCKS[Y.ordinal][H],_e=wr.ECC_CODEWORDS_PER_BLOCK[Y.ordinal][H],we=Math.floor(wr.getNumRawDataModules(H)/8),ve=K-we%K,pe=Math.floor(we/K);let he=[];const De=wr.reedSolomonComputeDivisor(_e);for(let Xe=0,mt=0;Xe<K;Xe++){let Wt=U.slice(mt,mt+pe-_e+(Xe<ve?0:1));mt+=Wt.length;const Et=wr.reedSolomonComputeRemainder(Wt,De);Xe<ve&&Wt.push(0),he.push(Wt.concat(Et))}let Je=[];for(let Xe=0;Xe<he[0].length;Xe++)he.forEach((mt,Wt)=>{(Xe!=pe-_e||Wt>=ve)&&Je.push(mt[Xe])});return D(Je.length==we),Je}drawCodewords(U){if(U.length!=Math.floor(wr.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let H=0;for(let Y=this.size-1;Y>=1;Y-=2){Y==6&&(Y=5);for(let K=0;K<this.size;K++)for(let _e=0;_e<2;_e++){const we=Y-_e,pe=(Y+1&2)==0?this.size-1-K:K;!this.isFunction[pe][we]&&H<U.length*8&&(this.modules[pe][we]=C(U[H>>>3],7-(H&7)),H++)}}D(H==U.length*8)}applyMask(U){if(U<0||U>7)throw new RangeError("Mask value out of range");for(let H=0;H<this.size;H++)for(let Y=0;Y<this.size;Y++){let K;switch(U){case 0:K=(Y+H)%2==0;break;case 1:K=H%2==0;break;case 2:K=Y%3==0;break;case 3:K=(Y+H)%3==0;break;case 4:K=(Math.floor(Y/3)+Math.floor(H/2))%2==0;break;case 5:K=Y*H%2+Y*H%3==0;break;case 6:K=(Y*H%2+Y*H%3)%2==0;break;case 7:K=((Y+H)%2+Y*H%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[H][Y]&&K&&(this.modules[H][Y]=!this.modules[H][Y])}}getPenaltyScore(){let U=0;for(let _e=0;_e<this.size;_e++){let we=!1,ve=0,pe=[0,0,0,0,0,0,0];for(let he=0;he<this.size;he++)this.modules[_e][he]==we?(ve++,ve==5?U+=wr.PENALTY_N1:ve>5&&U++):(this.finderPenaltyAddHistory(ve,pe),we||(U+=this.finderPenaltyCountPatterns(pe)*wr.PENALTY_N3),we=this.modules[_e][he],ve=1);U+=this.finderPenaltyTerminateAndCount(we,ve,pe)*wr.PENALTY_N3}for(let _e=0;_e<this.size;_e++){let we=!1,ve=0,pe=[0,0,0,0,0,0,0];for(let he=0;he<this.size;he++)this.modules[he][_e]==we?(ve++,ve==5?U+=wr.PENALTY_N1:ve>5&&U++):(this.finderPenaltyAddHistory(ve,pe),we||(U+=this.finderPenaltyCountPatterns(pe)*wr.PENALTY_N3),we=this.modules[he][_e],ve=1);U+=this.finderPenaltyTerminateAndCount(we,ve,pe)*wr.PENALTY_N3}for(let _e=0;_e<this.size-1;_e++)for(let we=0;we<this.size-1;we++){const ve=this.modules[_e][we];ve==this.modules[_e][we+1]&&ve==this.modules[_e+1][we]&&ve==this.modules[_e+1][we+1]&&(U+=wr.PENALTY_N2)}let H=0;for(const _e of this.modules)H=_e.reduce((we,ve)=>we+(ve?1:0),H);const Y=this.size*this.size,K=Math.ceil(Math.abs(H*20-Y*10)/Y)-1;return D(0<=K&&K<=9),U+=K*wr.PENALTY_N4,D(0<=U&&U<=2568888),U}getAlignmentPatternPositions(){if(this.version==1)return[];{const U=Math.floor(this.version/7)+2,H=this.version==32?26:Math.ceil((this.version*4+4)/(U*2-2))*2;let Y=[6];for(let K=this.size-7;Y.length<U;K-=H)Y.splice(1,0,K);return Y}}static getNumRawDataModules(U){if(U<wr.MIN_VERSION||U>wr.MAX_VERSION)throw new RangeError("Version number out of range");let H=(16*U+128)*U+64;if(U>=2){const Y=Math.floor(U/7)+2;H-=(25*Y-10)*Y-55,U>=7&&(H-=36)}return D(208<=H&&H<=29648),H}static getNumDataCodewords(U,H){return Math.floor(wr.getNumRawDataModules(U)/8)-wr.ECC_CODEWORDS_PER_BLOCK[H.ordinal][U]*wr.NUM_ERROR_CORRECTION_BLOCKS[H.ordinal][U]}static reedSolomonComputeDivisor(U){if(U<1||U>255)throw new RangeError("Degree out of range");let H=[];for(let K=0;K<U-1;K++)H.push(0);H.push(1);let Y=1;for(let K=0;K<U;K++){for(let _e=0;_e<H.length;_e++)H[_e]=wr.reedSolomonMultiply(H[_e],Y),_e+1<H.length&&(H[_e]^=H[_e+1]);Y=wr.reedSolomonMultiply(Y,2)}return H}static reedSolomonComputeRemainder(U,H){let Y=H.map(K=>0);for(const K of U){const _e=K^Y.shift();Y.push(0),H.forEach((we,ve)=>Y[ve]^=wr.reedSolomonMultiply(we,_e))}return Y}static reedSolomonMultiply(U,H){if(U>>>8||H>>>8)throw new RangeError("Byte out of range");let Y=0;for(let K=7;K>=0;K--)Y=Y<<1^(Y>>>7)*285,Y^=(H>>>K&1)*U;return D(Y>>>8==0),Y}finderPenaltyCountPatterns(U){const H=U[1];D(H<=this.size*3);const Y=H>0&&U[2]==H&&U[3]==H*3&&U[4]==H&&U[5]==H;return(Y&&U[0]>=H*4&&U[6]>=H?1:0)+(Y&&U[6]>=H*4&&U[0]>=H?1:0)}finderPenaltyTerminateAndCount(U,H,Y){return U&&(this.finderPenaltyAddHistory(H,Y),H=0),H+=this.size,this.finderPenaltyAddHistory(H,Y),this.finderPenaltyCountPatterns(Y)}finderPenaltyAddHistory(U,H){H[0]==0&&(U+=this.size),H.pop(),H.unshift(U)}};d.MIN_VERSION=1,d.MAX_VERSION=40,d.PENALTY_N1=3,d.PENALTY_N2=3,d.PENALTY_N3=40,d.PENALTY_N4=10,d.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],d.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],c.QrCode=d;function y(h,U,H){if(U<0||U>31||h>>>U)throw new RangeError("Value out of range");for(let Y=U-1;Y>=0;Y--)H.push(h>>>Y&1)}function C(h,U){return(h>>>U&1)!=0}function D(h){if(!h)throw new Error("Assertion error")}const P=class ha{constructor(U,H,Y){if(this.mode=U,this.numChars=H,this.bitData=Y,H<0)throw new RangeError("Invalid argument");this.bitData=Y.slice()}static makeBytes(U){let H=[];for(const Y of U)y(Y,8,H);return new ha(ha.Mode.BYTE,U.length,H)}static makeNumeric(U){if(!ha.isNumeric(U))throw new RangeError("String contains non-numeric characters");let H=[];for(let Y=0;Y<U.length;){const K=Math.min(U.length-Y,3);y(parseInt(U.substring(Y,Y+K),10),K*3+1,H),Y+=K}return new ha(ha.Mode.NUMERIC,U.length,H)}static makeAlphanumeric(U){if(!ha.isAlphanumeric(U))throw new RangeError("String contains unencodable characters in alphanumeric mode");let H=[],Y;for(Y=0;Y+2<=U.length;Y+=2){let K=ha.ALPHANUMERIC_CHARSET.indexOf(U.charAt(Y))*45;K+=ha.ALPHANUMERIC_CHARSET.indexOf(U.charAt(Y+1)),y(K,11,H)}return Y<U.length&&y(ha.ALPHANUMERIC_CHARSET.indexOf(U.charAt(Y)),6,H),new ha(ha.Mode.ALPHANUMERIC,U.length,H)}static makeSegments(U){return U==""?[]:ha.isNumeric(U)?[ha.makeNumeric(U)]:ha.isAlphanumeric(U)?[ha.makeAlphanumeric(U)]:[ha.makeBytes(ha.toUtf8ByteArray(U))]}static makeEci(U){let H=[];if(U<0)throw new RangeError("ECI assignment value out of range");if(U<128)y(U,8,H);else if(U<16384)y(2,2,H),y(U,14,H);else if(U<1e6)y(6,3,H),y(U,21,H);else throw new RangeError("ECI assignment value out of range");return new ha(ha.Mode.ECI,0,H)}static isNumeric(U){return ha.NUMERIC_REGEX.test(U)}static isAlphanumeric(U){return ha.ALPHANUMERIC_REGEX.test(U)}getData(){return this.bitData.slice()}static getTotalBits(U,H){let Y=0;for(const K of U){const _e=K.mode.numCharCountBits(H);if(K.numChars>=1<<_e)return 1/0;Y+=4+_e+K.bitData.length}return Y}static toUtf8ByteArray(U){U=encodeURI(U);let H=[];for(let Y=0;Y<U.length;Y++)U.charAt(Y)!="%"?H.push(U.charCodeAt(Y)):(H.push(parseInt(U.substring(Y+1,Y+3),16)),Y+=2);return H}};P.NUMERIC_REGEX=/^[0-9]*$/,P.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,P.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let N=P;c.QrSegment=P})(ip||(ip={}));(c=>{(d=>{const y=class{constructor(D,P){this.ordinal=D,this.formatBits=P}};y.LOW=new y(0,1),y.MEDIUM=new y(1,0),y.QUARTILE=new y(2,3),y.HIGH=new y(3,2),d.Ecc=y})(c.QrCode||(c.QrCode={}))})(ip||(ip={}));(c=>{(d=>{const y=class{constructor(D,P){this.modeBits=D,this.numBitsCharCount=P}numCharCountBits(D){return this.numBitsCharCount[Math.floor((D+7)/17)]}};y.NUMERIC=new y(1,[10,12,14]),y.ALPHANUMERIC=new y(2,[9,11,13]),y.BYTE=new y(4,[8,16,16]),y.KANJI=new y(8,[8,10,12]),y.ECI=new y(7,[0,0,0]),d.Mode=y})(c.QrSegment||(c.QrSegment={}))})(ip||(ip={}));var f0=ip;var g4={L:f0.QrCode.Ecc.LOW,M:f0.QrCode.Ecc.MEDIUM,Q:f0.QrCode.Ecc.QUARTILE,H:f0.QrCode.Ecc.HIGH},b2=128,v2="L",w2="#FFFFFF",A2="#000000",E2=!1,S2=1,m4=4,y4=0,x4=.1;function C2(c,d=0){const y=[];return c.forEach(function(C,D){let P=null;C.forEach(function(N,h){if(!N&&P!==null){y.push(`M${P+d} ${D+d}h${h-P}v1H${P+d}z`),P=null;return}if(h===C.length-1){if(!N)return;P===null?y.push(`M${h+d},${D+d} h1v1H${h+d}z`):y.push(`M${P+d},${D+d} h${h+1-P}v1H${P+d}z`);return}N&&P===null&&(P=h)})}),y.join("")}function T2(c,d){return c.slice().map((y,C)=>C<d.y||C>=d.y+d.h?y:y.map((D,P)=>P<d.x||P>=d.x+d.w?D:!1))}function _4(c,d,y,C){if(C==null)return null;const D=c.length+y*2,P=Math.floor(d*x4),N=D/d,h=(C.width||P)*N,U=(C.height||P)*N,H=C.x==null?c.length/2-h/2:C.x*N,Y=C.y==null?c.length/2-U/2:C.y*N,K=C.opacity==null?1:C.opacity;let _e=null;if(C.excavate){let ve=Math.floor(H),pe=Math.floor(Y),he=Math.ceil(h+H-ve),De=Math.ceil(U+Y-pe);_e={x:ve,y:pe,w:he,h:De}}const we=C.crossOrigin;return{x:H,y:Y,h:U,w:h,excavation:_e,opacity:K,crossOrigin:we}}function b4(c,d){return d!=null?Math.max(Math.floor(d),0):c?m4:y4}function I2({value:c,level:d,minVersion:y,includeMargin:C,marginSize:D,imageSettings:P,size:N,boostLevel:h}){let U=Qs.useMemo(()=>{const ve=(Array.isArray(c)?c:[c]).reduce((pe,he)=>(pe.push(...f0.QrSegment.makeSegments(he)),pe),[]);return f0.QrCode.encodeSegments(ve,g4[d],y,void 0,void 0,h)},[c,d,y,h]);const{cells:H,margin:Y,numCells:K,calculatedImageSettings:_e}=Qs.useMemo(()=>{let we=U.getModules();const ve=b4(C,D),pe=we.length+ve*2,he=_4(we,N,ve,P);return{cells:we,margin:ve,numCells:pe,calculatedImageSettings:he}},[U,N,P,C,D]);return{qrcode:U,margin:Y,cells:H,numCells:K,calculatedImageSettings:_e}}var v4=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),w4=Qs.forwardRef(function(d,y){const C=d,{value:D,size:P=b2,level:N=v2,bgColor:h=w2,fgColor:U=A2,includeMargin:H=E2,minVersion:Y=S2,boostLevel:K,marginSize:_e,imageSettings:we}=C,pe=Ly(C,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:he}=pe,De=Ly(pe,["style"]),Je=we?.src,Xe=Qs.useRef(null),mt=Qs.useRef(null),Wt=Qs.useCallback(qt=>{Xe.current=qt,typeof y=="function"?y(qt):y&&(y.current=qt)},[y]),[Et,rt]=Qs.useState(!1),{margin:at,cells:He,numCells:_t,calculatedImageSettings:Pe}=I2({value:D,level:N,minVersion:Y,boostLevel:K,includeMargin:H,marginSize:_e,imageSettings:we,size:P});Qs.useEffect(()=>{if(Xe.current!=null){const qt=Xe.current,ke=qt.getContext("2d");if(!ke)return;let Te=He;const Ze=mt.current,ut=Pe!=null&&Ze!==null&&Ze.complete&&Ze.naturalHeight!==0&&Ze.naturalWidth!==0;ut&&Pe.excavation!=null&&(Te=T2(He,Pe.excavation));const Tt=window.devicePixelRatio||1;qt.height=qt.width=P*Tt;const sn=P/_t*Tt;ke.scale(sn,sn),ke.fillStyle=h,ke.fillRect(0,0,_t,_t),ke.fillStyle=U,v4?ke.fill(new Path2D(C2(Te,at))):He.forEach(function(Re,ct){Re.forEach(function(kt,bt){kt&&ke.fillRect(bt+at,ct+at,1,1)})}),Pe&&(ke.globalAlpha=Pe.opacity),ut&&ke.drawImage(Ze,Pe.x+at,Pe.y+at,Pe.w,Pe.h)}}),Qs.useEffect(()=>{rt(!1)},[Je]);const ht=zy({height:P,width:P},he);let vt=null;return Je!=null&&(vt=Qs.createElement("img",{src:Je,key:Je,style:{display:"none"},onLoad:()=>{rt(!0)},ref:mt,crossOrigin:Pe?.crossOrigin})),Qs.createElement(Qs.Fragment,null,Qs.createElement("canvas",zy({style:ht,height:P,width:P,ref:Wt,role:"img"},De)),vt)});w4.displayName="QRCodeCanvas";var k1=Qs.forwardRef(function(d,y){const C=d,{value:D,size:P=b2,level:N=v2,bgColor:h=w2,fgColor:U=A2,includeMargin:H=E2,minVersion:Y=S2,boostLevel:K,title:_e,marginSize:we,imageSettings:ve}=C,pe=Ly(C,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:he,cells:De,numCells:Je,calculatedImageSettings:Xe}=I2({value:D,level:N,minVersion:Y,boostLevel:K,includeMargin:H,marginSize:we,imageSettings:ve,size:P});let mt=De,Wt=null;ve!=null&&Xe!=null&&(Xe.excavation!=null&&(mt=T2(De,Xe.excavation)),Wt=Qs.createElement("image",{href:ve.src,height:Xe.h,width:Xe.w,x:Xe.x+he,y:Xe.y+he,preserveAspectRatio:"none",opacity:Xe.opacity,crossOrigin:Xe.crossOrigin}));const Et=C2(mt,he);return Qs.createElement("svg",zy({height:P,width:P,viewBox:`0 0 ${Je} ${Je}`,ref:y,role:"img"},pe),!!_e&&Qs.createElement("title",null,_e),Qs.createElement("path",{fill:h,d:`M0,0 h${Je}v${Je}H0z`,shapeRendering:"crispEdges"}),Qs.createElement("path",{fill:U,d:Et,shapeRendering:"crispEdges"}),Wt)});k1.displayName="QRCodeSVG";const A4=({setHistorySpots:c,onOpenChange:d,onHelpClick:y})=>{const{pubkey:C,logout:D,deleteAccount:P,pool:N,signEvent:h,refreshConnections:U}=nh(),{logs:H,markDeleted:Y}=f4(),[K,_e]=me.useState(!1),[we,ve]=me.useState(!1),[pe,he]=me.useState(!1),[De,Je]=me.useState(!1),[Xe,mt]=me.useState(!1),[Wt,Et]=me.useState(""),[rt,at]=me.useState([...Kn]),[He,_t]=me.useState(!1),[Pe,ht]=me.useState(!1),[vt,qt]=me.useState(""),[ke,Te]=me.useState(!1),[Ze,ut]=me.useState(null),[Tt,sn]=me.useState(new Map);me.useEffect(()=>_o.subscribe(de=>{sn(new Map(de))}),[]);const[Re,ct]=me.useState([]),[kt,bt]=me.useState(!1);me.useEffect(()=>{if(K)try{const de=localStorage.getItem("parlens-hidden-items");de&&ct(JSON.parse(de))}catch{}},[K]);const an=de=>{const qe=Re.filter(xt=>xt.id!==de);ct(qe),localStorage.setItem("parlens-hidden-items",JSON.stringify(qe))};me.useEffect(()=>{d?.(K)},[K,d]);const[Bt,Qt]=me.useState(null),[un,nn]=me.useState([]),[kn,Nn]=me.useState(!1),[ii,En]=me.useState(()=>{const de=localStorage.getItem("parlens_show_parking_areas");return de?JSON.parse(de):!0}),[si,wi]=me.useState(()=>localStorage.getItem("parlens_parking_area_filter")||"all"),[Oi,Yn]=me.useState(()=>{const de=localStorage.getItem("parlens_share_parking_areas");return de?JSON.parse(de):!1}),[Gn,Rn]=me.useState("all"),[Ei,on]=me.useState(null),[Li,tr]=me.useState(""),[Di,yr]=me.useState(!1),yt=async de=>{if(!(!C||!confirm("Are you sure you want to delete this parking entry? This action cannot be undone."))){ve(!0);try{const qe=de.tags?.find(St=>St[0]==="d")?.[1];if(!qe)throw new Error("Missing d tag on event");const xt={kind:5,content:"Deleted by user",tags:[["a",`${Ln.PARKING_LOG}:${C}:${qe}`],["k",String(Ln.PARKING_LOG)]],created_at:Math.floor(Date.now()/1e3),pubkey:C},Fe=await h(xt);await Promise.allSettled(N.publish(Kn,Fe)),Y(qe),nn(St=>St.filter(Lt=>Lt.id!==de.id))}catch(qe){console.error("Failed to delete parking log:",qe),alert("Failed to delete. Please try again.")}finally{ve(!1)}}};me.useEffect(()=>{C&&(async()=>{const qe=await N.get(Kn,{kinds:[0],authors:[C]});if(qe)try{const xt=JSON.parse(qe.content);Qt({name:xt.name||xt.display_name||"Nostr User",npub:Qf.npubEncode(C),picture:xt.picture})}catch(xt){console.error("Error parsing profile:",xt)}else Bt||Qt({name:"Nostr User",npub:Qf.npubEncode(C),picture:`https://api.dicebear.com/7.x/bottts/svg?seed=${C}`})})()},[C,N]),me.useEffect(()=>{(async()=>{if(!C||!H.length)return;const qe=localStorage.getItem("parlens_privkey"),xt=qe?new Uint8Array(qe.match(/.{1,2}/g).map(St=>parseInt(St,16))):void 0,Fe=await Promise.all(H.map(async St=>{try{const Lt=await Cx(St.content,C,xt);return{...St,decryptedContent:Lt}}catch{return{...St,decryptedContent:null}}}));nn(Fe.filter(St=>St.decryptedContent))})()},[H,C]),me.useEffect(()=>{c&&c(kn?un:[])},[kn,un,c]);const oe=()=>{const de=localStorage.getItem("parlens_privkey");if(de){const qe=Qf.nsecEncode(new Uint8Array(de.match(/.{1,2}/g).map(xt=>parseInt(xt,16))));navigator.clipboard.writeText(qe),alert("Copied to clipboard")}},le=(de,qe)=>{if(!de)return"Unknown";const xt=qe.getTime()-de.getTime(),Fe=Math.floor(xt/(1e3*60));if(Fe<60)return`${Fe}m`;const St=Math.floor(Fe/60),Lt=Fe%60;return Lt>0?`${St}h ${Lt}m`:`${St}h`},ge=async(de,qe)=>{if(!(!C||!h)){yr(!0);try{const xt=de.tags?.find(dt=>dt[0]==="d")?.[1];if(!xt)throw new Error("Missing d tag");const Fe=localStorage.getItem("parlens_privkey"),St=Fe?new Uint8Array(Fe.match(/.{1,2}/g).map(dt=>parseInt(dt,16))):void 0,Lt={...de.decryptedContent,note:qe},bn=await I1(Lt,C,St),yn={kind:Ln.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",xt],["client","parlens"]],content:bn},$n=await h(yn);await Promise.allSettled(N.publish(Kn,$n)),nn(dt=>dt.map(ai=>ai.id===de.id?{...ai,decryptedContent:Lt}:ai)),on(null),tr("")}catch(xt){console.error("Failed to update note:",xt),alert("Failed to save note")}finally{yr(!1)}}},Ue=me.useMemo(()=>un.filter(de=>{const xt=de.decryptedContent.type||"car";return!(Gn!=="all"&&xt!==Gn)}),[un,Gn]),Ye=async de=>{if(!N||!C||!h)return;const qe={kind:Ln.RELAY_LIST,created_at:Math.floor(Date.now()/1e3),tags:de.map(Fe=>["r",Fe]),content:""},xt=await h(qe);await Promise.allSettled(N.publish(Kn,xt)),at(de)},At=async()=>{const de=vt.trim();if(ut(null),!de.startsWith("wss://")){ut("Relay URL must start with wss://");return}if(rt.includes(de)){ut("This relay is already in your list");return}Te(!0);try{await Ye([...rt,de]),qt(""),ht(!1)}catch(qe){console.error("Error adding relay:",qe),ut("Failed to add relay")}finally{Te(!1)}},it=async de=>{if(confirm(`Are you sure you want to remove this relay?

${de}

This action cannot be undone.`)){Te(!0);try{await Ye(rt.filter(qe=>qe!==de))}catch(qe){console.error("Error removing relay:",qe),alert("Failed to remove relay")}finally{Te(!1)}}};return k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:()=>{_e(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Activity Log",children:k.jsx(vT,{size:20})}),K&&k.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[k.jsx("button",{onClick:()=>_e(!1),className:"absolute inset-0 z-0 cursor-default"}),we&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:k.jsxs("div",{className:"flex flex-col items-center gap-3",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),k.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),pe&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm animate-in fade-in",onClick:()=>he(!1),children:k.jsxs("div",{className:"w-[90%] max-w-sm bg-white dark:bg-[#1c1c1e] rounded-2xl p-6 space-y-4 border border-black/5 dark:border-white/10 shadow-2xl animate-in zoom-in-95",onClick:de=>de.stopPropagation(),children:[k.jsxs("div",{className:"flex items-center gap-3 text-red-500",children:[k.jsx(yT,{size:24}),k.jsx("h3",{className:"text-lg font-bold",children:"Delete Account?"})]}),k.jsx("p",{className:"text-zinc-600 dark:text-white/70 text-sm leading-relaxed",children:"This action is permanent and cannot be undone."}),k.jsxs("div",{className:"flex gap-3 pt-2",children:[k.jsx("button",{onClick:()=>he(!1),className:"flex-1 py-3 rounded-xl bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white font-bold",children:"Cancel"}),k.jsx("button",{onClick:async()=>{he(!1),ve(!0),await P(),ve(!1),_e(!1)},className:"flex-1 py-3 rounded-xl bg-red-500 text-white font-bold shadow-lg shadow-red-500/20",children:"Delete"})]})]})}),k.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[k.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent truncate max-w-[180px]",children:Bt?.name||"Nostr User"}),k.jsx("button",{onClick:()=>Je(!De),className:"w-10 h-10 flex items-center justify-center rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform shrink-0",title:De?"Back to profile":"Show npub QR Code",children:De?k.jsx(Ax,{size:20}):k.jsx(i2,{size:20})})]}),k.jsxs("div",{className:"flex gap-4 items-center",children:[k.jsx("button",{onClick:()=>y?.(),className:"w-10 h-10 flex items-center justify-center rounded-full bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 active:scale-95 transition-all",children:k.jsx("span",{className:"text-xl font-bold",children:"?"})}),k.jsx("button",{onClick:()=>_e(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform",children:k.jsx(vo,{size:20})})]})]}),Xe&&k.jsx("div",{className:"fixed inset-0 z-[2100] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in",children:k.jsxs("div",{className:"w-[90%] max-w-xs bg-white dark:bg-zinc-800 rounded-2xl p-5 shadow-xl border border-black/10 dark:border-white/10 space-y-4",children:[k.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white text-center",children:"Edit Username"}),k.jsx("input",{type:"text",value:Wt,onChange:de=>Et(de.target.value),className:"w-full px-4 py-3 rounded-xl bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white text-center font-medium focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onFocus:de=>de.target.select(),placeholder:"Enter username"}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:()=>mt(!1),className:"flex-1 py-2.5 rounded-xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-medium active:scale-95 transition-transform",children:"Cancel"}),k.jsx("button",{onClick:async()=>{if(!(!N||!h||!C))try{const de={kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:Wt.trim()||"Nostr User"})},qe=await h(de);await Promise.allSettled(N.publish(Kn,qe)),mt(!1)}catch(de){console.error("Failed to update username:",de),alert("Failed to update username")}},className:"flex-1 py-2.5 rounded-xl bg-[#007AFF] text-white font-medium active:scale-95 transition-transform",children:"Confirm"})]})]})}),De?k.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center gap-4",children:[k.jsx(k1,{value:Bt?.npub||"",size:200,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-zinc-900 dark:text-white"}),k.jsx("button",{onClick:()=>{navigator.clipboard.writeText(Bt?.npub||""),alert("npub copied to clipboard")},className:"text-xs text-zinc-500 dark:text-zinc-400 font-mono break-all text-center px-4 active:text-zinc-900 dark:active:text-white transition-colors",children:Bt?.npub}),k.jsxs("button",{onClick:()=>{Et(Bt?.name||""),mt(!0)},className:"flex items-center gap-2 px-4 py-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform text-sm font-medium",children:[k.jsx(Vd,{size:14}),"Edit Username"]})]}):k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"My Keys"}),k.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer",onClick:()=>{navigator.clipboard.writeText(Bt?.npub),alert("Copied to clipboard")},children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400",children:k.jsx(Py,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),k.jsx(tp,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),localStorage.getItem("parlens_privkey")&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),k.jsxs("div",{onClick:oe,className:"flex items-center justify-between p-4 cursor-pointer transition-colors active:bg-black/10 dark:active:bg-white/10",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-500",children:k.jsx(a2,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),k.jsx(tp,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:"Store your npub and nsec securely. These are your account access keys and cannot be recovered if lost. Use these keys to login to any Nostr client."})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"flex items-center justify-between ml-2 pr-2",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:"Preferred Relays"}),k.jsx("button",{onClick:async de=>{de.stopPropagation(),Te(!0);try{await U()}catch(qe){console.error("Refresh failed:",qe)}finally{Te(!1)}},disabled:ke,className:`p-1.5 rounded-full bg-zinc-100 dark:bg-white/5 text-zinc-400 dark:text-white/30 active:scale-95 transition-all flex items-center justify-center ${ke?"text-zinc-500 dark:text-white/50 cursor-not-allowed":""}`,title:"Refresh Connections",children:k.jsx(nT,{size:14,className:`origin-center ${ke?"animate-spin":""}`})})]}),k.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[k.jsxs("button",{onClick:()=>_t(!He),className:"w-full p-5 flex items-center justify-between transition-colors",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-green-500/10 dark:bg-green-500/20 text-green-500 dark:text-green-400",children:k.jsx(A_,{size:20})}),k.jsxs("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:["Manage Relays (",rt.length,")"]})]}),k.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:He?"Hide":"Show"})]}),He&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),k.jsx("div",{className:"p-4 space-y-2",children:ke&&rt.length===0?k.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):k.jsxs(k.Fragment,{children:[rt.map(de=>k.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[k.jsx(A_,{size:16,className:`shrink-0 ${Tt.get(de)?.connected?"text-green-500":"text-zinc-400"}`}),k.jsx("span",{className:"text-sm text-zinc-700 dark:text-white truncate",children:de.replace("wss://","")})]}),k.jsx("button",{onClick:()=>it(de),disabled:rt.length<=1,className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform disabled:opacity-30 disabled:cursor-not-allowed",title:rt.length<=1?"At least one relay is required":"Remove relay",children:k.jsx(np,{size:16})})]},de)),k.jsxs("button",{onClick:()=>{ht(!0),ut(null),qt("")},className:"w-full p-3 flex items-center justify-center gap-2 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors active:scale-[0.98]",children:[k.jsx(s1,{size:16,className:"text-blue-500"}),k.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Relay"})]})]})})]})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed",children:"Relay address(es) listed in this section tell Parlens where to look for and store data. Parlens requires a connection to at least one relay to work."}),Pe&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",onClick:()=>ht(!1),children:k.jsxs("div",{className:"w-[90%] max-w-sm bg-white dark:bg-[#2c2c2e] rounded-2xl p-5 space-y-4 animate-in zoom-in-95 duration-200",onClick:de=>de.stopPropagation(),children:[k.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Add Relay"}),k.jsxs("div",{className:"space-y-2",children:[k.jsx("input",{type:"text",value:vt,onChange:de=>{qt(de.target.value),ut(null)},placeholder:"wss://relay.example.com",className:"w-full h-12 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0,onKeyDown:de=>{de.key==="Enter"&&At(),de.key==="Escape"&&ht(!1)}}),Ze&&k.jsx("p",{className:"text-xs text-red-500 ml-1",children:Ze})]}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:()=>ht(!1),className:"flex-1 h-11 rounded-xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-medium transition-all active:scale-95",children:"Cancel"}),k.jsx("button",{onClick:At,disabled:ke||!vt.trim(),className:"flex-1 h-11 rounded-xl bg-[#007AFF] text-white font-medium disabled:opacity-50 transition-all active:scale-95",children:ke?"...":"Add"})]})]})}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Hide List"}),k.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-zinc-50 dark:bg-white/[0.03] border border-black/5 dark:border-white/5",children:[k.jsxs("button",{onClick:()=>bt(!kt),className:"w-full p-5 flex items-center justify-between transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-amber-500/10 dark:bg-amber-500/20 text-amber-500",children:k.jsx(Sx,{size:20})}),k.jsxs("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:["Manage List (",Re.length,")"]})]}),k.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:kt?"Hide":"Show"})]}),kt&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),k.jsx("div",{className:"p-4 space-y-2",children:Re.length===0?k.jsx("p",{className:"text-sm text-zinc-400 dark:text-white/40 text-center py-2",children:"No hidden items"}):Re.map(de=>k.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[k.jsx("span",{className:"shrink-0",children:de.type==="listing"?"":""}),k.jsx("span",{className:"text-sm text-zinc-600 dark:text-white/70 truncate",children:de.name}),k.jsx("span",{className:"shrink-0 text-[10px] uppercase px-1.5 py-0.5 rounded-full bg-zinc-100 dark:bg-white/10 text-zinc-400",children:de.type})]}),k.jsx("button",{onClick:()=>an(de.id),className:"p-2 text-zinc-400 hover:text-green-500 transition-colors shrink-0",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(Jf,{size:16})})]},de.id))})]})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 text-left ml-2",children:"Items you hide in the listed parking page can be managed here."})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking Areas"}),k.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-xl bg-zinc-500/10 dark:bg-zinc-500/20 text-zinc-500 dark:text-zinc-400",children:k.jsx("span",{className:"text-base font-bold",children:"P"})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show parking areas on map"})]}),k.jsx("button",{onClick:()=>{const de=!ii;En(de),localStorage.setItem("parlens_show_parking_areas",JSON.stringify(de))},className:`w-12 h-7 rounded-full transition-colors relative ${ii?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:k.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${ii?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),ii&&k.jsxs("div",{className:"flex items-center justify-between ml-2",children:[k.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/30",children:"See areas reported since:"}),k.jsxs("select",{value:si,onChange:de=>{const qe=de.target.value;wi(qe),localStorage.setItem("parlens_parking_area_filter",qe)},className:"px-2 py-1.5 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6",children:[k.jsx("option",{value:"today",children:"Today"}),k.jsx("option",{value:"week",children:"This Week"}),k.jsx("option",{value:"month",children:"This Month"}),k.jsx("option",{value:"year",children:"This Year"}),k.jsx("option",{value:"all",children:"All Time"})]})]}),k.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-xl bg-green-500/10 dark:bg-green-500/20 text-green-500 dark:text-green-400",children:k.jsx(hT,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Share parking area reports"})]}),k.jsx("button",{onClick:()=>{const de=!Oi;Yn(de),localStorage.setItem("parlens_share_parking_areas",JSON.stringify(de))},className:`w-12 h-7 rounded-full transition-colors relative ${Oi?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:k.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${Oi?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 text-left ml-2 leading-relaxed",children:"Parking areas are reported anonymously shortly after you complete a session. Sharing reports will help other users know where to find parking when visiting the area."})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsx("h4",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Parking History"}),c&&k.jsxs("div",{className:"flex items-center justify-between p-4 bg-zinc-50 dark:bg-white/5 rounded-[2rem] border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"w-10 h-10 flex items-center justify-center rounded-xl bg-purple-500/10 dark:bg-purple-500/20 text-purple-500 dark:text-purple-400",children:k.jsx(eo,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-700 dark:text-white",children:"Show logs on map"})]}),k.jsx("button",{onClick:()=>Nn(!kn),className:`w-12 h-7 rounded-full transition-colors relative ${kn?"bg-[#007AFF]":"bg-zinc-200 dark:bg-white/20"}`,children:k.jsx("div",{className:`absolute top-1 bottom-1 w-5 h-5 rounded-full bg-white transition-transform ${kn?"left-[calc(100%-1.25rem-0.25rem)]":"left-1"}`})})]}),k.jsx("div",{className:"space-y-3",children:k.jsx("div",{className:"flex justify-between items-center gap-2 p-1 bg-zinc-100 dark:bg-white/5 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:["all","bicycle","motorcycle","car"].map(de=>k.jsx("button",{onClick:()=>Rn(de),className:`flex-1 flex items-center justify-center py-2.5 rounded-[1.2rem] text-sm transition-all active:scale-95 ${Gn===de?"bg-white dark:bg-white/10 text-zinc-900 dark:text-white font-bold shadow-sm":"text-zinc-400 dark:text-white/40 hover:text-zinc-600 dark:hover:text-white/60"}`,children:de==="all"?"All":k.jsx("span",{className:"text-xl",children:de==="bicycle"?"":de==="motorcycle"?"":""})},de))})}),Ue.length>0?Ue.map(de=>{const qe=de.decryptedContent,xt=m0(qe.currency||"USD"),Fe=qe.started_at?new Date(qe.started_at*1e3):null,St=qe.finished_at?new Date(qe.finished_at*1e3):new Date(de.created_at*1e3),Lt=qe.lat&&qe.lon?`${qe.lat.toFixed(5)}, ${qe.lon.toFixed(5)}`:null,bn=le(Fe,St),yn=Fe?Fe.toLocaleDateString(void 0,{month:"short",day:"numeric"}):St.toLocaleDateString(void 0,{month:"short",day:"numeric"}),$n=qe.type||"car",dt=$n==="bicycle"?"":$n==="motorcycle"?"":"",ai=Ei===de.id;return k.jsxs("div",{className:"p-5 rounded-[2rem] bg-zinc-50 dark:bg-white/[0.03] space-y-3 border border-black/5 dark:border-white/5 text-zinc-900 dark:text-white",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("span",{className:"text-2xl",children:dt}),k.jsx("p",{className:"font-bold text-xl",children:`${xt}${qe.fee||"0"}`})]}),k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"text-2xl",children:o4(qe.currency||"USD")}),k.jsx("button",{onClick:()=>yt(de),className:"p-1.5 text-zinc-400 dark:text-white/30 transition-colors",title:"Delete entry",children:k.jsx(np,{size:16})})]})]}),k.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[k.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 dark:text-white/50",children:[k.jsx(t2,{size:12,className:"text-green-500 dark:text-green-400"}),k.jsx("span",{className:"font-semibold",children:bn})]}),k.jsx("span",{className:"text-zinc-400 dark:text-white/30",children:yn})]}),Lt&&k.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[k.jsx(eo,{size:12,className:"text-[#007AFF]"}),k.jsx("span",{className:"font-mono",children:Lt})]}),k.jsx("div",{className:"flex items-center gap-2 text-xs text-zinc-500 dark:text-white/50 bg-zinc-100 dark:bg-white/5 rounded-lg px-3 py-2",children:ai?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:Li,onChange:Fn=>tr(Fn.target.value),placeholder:"Add note",className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-[#007AFF]",autoFocus:!0,onFocus:Fn=>Fn.currentTarget.select(),onKeyDown:Fn=>{Fn.key==="Enter"&&ge(de,Li),Fn.key==="Escape"&&on(null)}}),k.jsx("button",{onClick:()=>ge(de,Li),disabled:Di,className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors disabled:opacity-50",children:k.jsx(Jf,{size:16})}),k.jsx("button",{onClick:()=>on(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:k.jsx(vo,{size:16})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:`flex-1 text-left cursor-pointer ${qe.note?"":"text-zinc-400 dark:text-white/30"}`,onClick:()=>{on(de.id),tr(qe.note||"")},children:qe.note||"Add note"}),k.jsx("button",{onClick:()=>{on(de.id),tr(qe.note||"")},className:"p-1 text-zinc-400 dark:text-white/30 shrink-0",children:k.jsx(Vd,{size:12})})]})})]},de.id)}):k.jsx("div",{className:"p-10 rounded-[2.5rem] border-2 border-dashed border-black/5 dark:border-white/5 text-center",children:k.jsx("p",{className:"text-sm font-medium text-zinc-400 dark:text-white/10",children:un.length>0?"No entries match filters":"No recent activity"})})]})]}),k.jsx("button",{onClick:()=>{confirm("Are you sure you want to logout?")&&(D(),_e(!1))},className:"w-full py-4 rounded-[1.5rem] bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 font-bold tracking-wide border border-black/5 dark:border-white/5 transition-all active:scale-95 text-center mt-4",children:"Logout"}),k.jsx("button",{onClick:()=>he(!0),className:"w-full py-4 rounded-[1.5rem] text-red-500 font-bold tracking-wide transition-all active:scale-95 text-center active:bg-red-500/5",children:"Delete Account"})]})]})]})]})},E4=({vehicleType:c,onRouteChange:d,currentLocation:y,onDropPinModeChange:C,pendingWaypoints:D,onDropPinConsumed:P,onOpenChange:N,onWaypointsChange:h,onRequestOrientationPermission:U,isOpen:H,onClose:Y,hideTrigger:K,onRouteCreated:_e})=>{const{pool:we,pubkey:ve,signEvent:pe}=nh(),[he,De]=me.useState(!1),Je=H!==void 0?H:he,Xe=Fe=>{De(Fe),!Fe&&Y&&Y()};me.useEffect(()=>{N?.(Je)},[Je,N]);const[mt,Wt]=me.useState([]);me.useEffect(()=>{h?.(mt)},[mt,h]);const[Et,rt]=me.useState(""),[at,He]=me.useState(!1),[_t,Pe]=me.useState(null),[ht,vt]=me.useState(null),[qt,ke]=me.useState(!1),Te=me.useRef(null),Ze=me.useRef(!1),[ut,Tt]=me.useState([]),[sn,Re]=me.useState(""),[ct,kt]=me.useState(!1),[bt,an]=me.useState(!1),[Bt,Qt]=me.useState(!1),[un,nn]=me.useState(!1),[kn,Nn]=me.useState(null),[ii,En]=me.useState(""),[si,wi]=me.useState(!1),[Oi,Yn]=me.useState(null),[Gn,Rn]=me.useState({}),[Ei,on]=me.useState([]);me.useEffect(()=>{if(!Et||Et.length<3){on([]);return}if(Dl(Et))return;const Fe=setTimeout(()=>{Dg(Et,Oi,y,1).then(on).catch(console.error)},500);return()=>clearTimeout(Fe)},[Et,Oi,y]);const Li=me.useRef(new Set);me.useEffect(()=>{(async()=>{if(!(!y||Oi))try{const Lt=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${y[0]}&lon=${y[1]}&format=json`)).json();Lt&&Lt.address&&Lt.address.country_code&&(console.log("[Parlens] Detected Country:",Lt.address.country_code),Yn(Lt.address.country_code))}catch(St){console.error("[Parlens] Failed to detect country:",St)}})()},[y,Oi]);const tr=Qs.useMemo(()=>{if(!Et||Et.length<2)return[];const Fe=Et.toLowerCase(),St=[];for(const Lt of ut)for(const bn of Lt.decryptedContent.waypoints)bn.name.toLowerCase().includes(Fe)&&(St.find(yn=>yn.name.toLowerCase()===bn.name.toLowerCase())||St.push({name:bn.name,lat:bn.lat,lon:bn.lon}));return St.slice(0,5)},[Et,ut]),Di=Fe=>{const St=mt.filter(Lt=>Lt.id!==Fe);Wt(St),Pe(null),vt(null),He(!1),d(null,null,St,!1)},yr=()=>{Wt([]),Pe(null),vt(null),He(!1),d(null,null,[],!1)},yt=(Fe,St)=>{if(Fe+St<0||Fe+St>=mt.length)return;const Lt=[...mt];[Lt[Fe],Lt[Fe+St]]=[Lt[Fe+St],Lt[Fe]],Wt(Lt),Pe(null),vt(null),He(!1),d(null,null,Lt,!1)},oe=()=>{const Fe=[...mt].reverse();Wt(Fe),Pe(null),vt(null),He(!1),d(null,null,Fe,!1)},le=async()=>{if(mt.length<2){alert("Add at least 2 waypoints to create a route");return}ke(!0);try{const St={bicycle:"bike",motorcycle:"driving",car:"driving"}[c],Lt=[],bn=[],yn={};for(let Fn=0;Fn<mt.length-1;Fn++){const Jn=mt[Fn],pi=mt[Fn+1],ur=`${Jn.lon},${Jn.lat};${pi.lon},${pi.lat}`;console.log(`[Parlens] Fetching segment ${Fn+1}: ${Jn.name}  ${pi.name}`);const Ti=await fetch(`https://router.project-osrm.org/route/v1/${St}/${ur}?overview=full&geometries=geojson&alternatives=true`);if(!Ti.ok)throw new Error(`OSRM error: ${Ti.status}`);const jn=await Ti.json();if(jn.code==="Ok"&&jn.routes&&jn.routes[0]){if(jn.waypoints&&jn.waypoints.length>=2){const Ri=jn.waypoints[0].location,ji=jn.waypoints[1].location;yn[Fn]||(yn[Fn]={lat:Ri[1],lon:Ri[0]}),yn[Fn+1]={lat:ji[1],lon:ji[0]}}const Ni=jn.routes[0].geometry.coordinates.map(Ri=>[Ri[1],Ri[0]]);if(Lt.push(Ni),jn.routes.length>1){const Ri=jn.routes[1].geometry.coordinates.map(ji=>[ji[1],ji[0]]);bn.push(Ri),console.log(`[Parlens] Segment ${Fn+1} has alternate route`)}else bn.push(Ni),console.log(`[Parlens] Segment ${Fn+1} has no alternate, using primary`)}else throw new Error(`No route found for segment ${Fn+1}`)}const $n=[],dt=[];for(let Fn=0;Fn<Lt.length;Fn++){const Jn=Fn===0?0:1;$n.push(...Lt[Fn].slice(Jn)),dt.push(...bn[Fn].slice(Jn))}console.log("[Parlens] Combined primary route:",$n.length,"points"),console.log("[Parlens] Combined alternate route:",dt.length,"points"),Pe($n),vt(dt),Rn(yn),He(!0);const ai=Object.keys(yn).length===mt.length?mt.map((Fn,Jn)=>({...Fn,...yn[Jn]})):mt;d($n,dt,ai.map(Fn=>({lat:Fn.lat,lon:Fn.lon})),!0),U&&U(),Xe(!1),_e?.()}catch(Fe){console.error("Route creation error:",Fe);const St=mt.map(Lt=>[Lt.lat,Lt.lon]);Pe(St),vt(null),Rn({}),He(!0),d(St,null,mt.map(Lt=>({lat:Lt.lat,lon:Lt.lon})),!0),Xe(!1),_e?.()}finally{ke(!1)}},ge=()=>{const Fe=!at;He(Fe);const St=Object.keys(Gn).length===mt.length?mt.map((Lt,bn)=>({...Lt,...Gn[bn]})):mt;d(_t,ht,St.map(Lt=>({lat:Lt.lat,lon:Lt.lon})),Fe)},Ue=me.useCallback(async()=>{if(!(!we||!ve)){an(!0);try{const Fe=await we.querySync(Kn,{kinds:[Ln.ROUTE_LOG],authors:[ve]});console.log("[Parlens] Fetched route events:",Fe.length);const St=localStorage.getItem("parlens_privkey"),Lt=St?new Uint8Array(St.match(/.{1,2}/g).map(yn=>parseInt(yn,16))):void 0,bn=[];for(const yn of Fe){if(yn.tags.find(dt=>dt[0]==="deleted"))continue;const $n=yn.tags.find(dt=>dt[0]==="d")?.[1]||"";if(!($n&&Li.current.has($n))&&yn.content)try{const dt=await Cx(yn.content,ve,Lt);if(dt){const ai=yn.tags.find(Fn=>Fn[0]==="d")?.[1]||"";bn.push({id:yn.id,dTag:ai,decryptedContent:dt,created_at:yn.created_at})}}catch(dt){console.warn("[Parlens] Failed to decrypt route:",dt)}}Tt(yn=>{const $n=new Map;yn.forEach(ai=>$n.set(ai.id,ai)),bn.forEach(ai=>$n.set(ai.id,ai));const dt=Array.from($n.values()).sort((ai,Fn)=>Fn.created_at-ai.created_at);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(dt))}catch(ai){console.warn("[Parlens] Failed to cache routes:",ai)}return dt})}catch(Fe){console.error("Error fetching saved routes:",Fe)}finally{an(!1)}}},[we,ve]);me.useEffect(()=>{if(Je&&ve){try{const Fe=localStorage.getItem("parlens_route_cache_v1");if(Fe){const St=JSON.parse(Fe);Tt(St)}}catch(Fe){console.warn("[Parlens] Failed to load cached routes:",Fe)}Ue()}},[Je,ve,Ue]);const Ye=()=>{const Fe=!un;nn(Fe),C?.(Fe),Fe&&(Xe(!1),h?.(mt))};me.useEffect(()=>{if(D){if(D.length>0){const Fe=D.some(yn=>yn.name==="Current Location"),St=D.map((yn,$n)=>({id:crypto.randomUUID(),name:yn.name||`Pin ${(Fe?0:mt.length)+$n+1}`,lat:yn.lat,lon:yn.lon})),Lt=Fe?St:[...mt,...St],bn=Lt.length;Wt(Lt),Pe(null),vt(null),He(!1),d(null,null,Lt,!1),Rn({}),Fe&&bn>=2&&(Ze.current=!0)}P?.(),Ze.current||Xe(!0),C?.(!1)}},[D,P,C,d]),me.useEffect(()=>{Ze.current&&mt.length>=2&&(Ze.current=!1,le())},[mt]);const At=async()=>{if(!we||!ve||!pe||!_t||mt.length<2){alert("Please create a route first");return}const Fe=sn.trim()||`Route ${new Date().toLocaleDateString()}`;kt(!0);try{const St=Object.keys(Gn).length===mt.length?mt.map((jn,Ni)=>({name:jn.name,lat:Gn[Ni].lat,lon:Gn[Ni].lon})):mt.map(jn=>({name:jn.name,lat:jn.lat,lon:jn.lon})),Lt={name:Fe,waypoints:St,routeCoords:_t,alternateRouteCoords:ht||void 0,vehicleType:c,created_at:Math.floor(Date.now()/1e3)},bn=localStorage.getItem("parlens_privkey"),yn=bn?new Uint8Array(bn.match(/.{1,2}/g).map(jn=>parseInt(jn,16))):void 0,$n=await I1(Lt,ve,yn),dt=`route_${Date.now()}`,ai=new Set;St.forEach(jn=>{const Ni=Pl(jn.lat,jn.lon,10);for(let Ri=1;Ri<=10;Ri++)ai.add(Ni.substring(0,Ri))});const Fn={kind:Ln.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",dt],["client","parlens"],...Array.from(ai).map(jn=>["g",jn])],content:$n},Jn=await pe(Fn);console.log("[Parlens] Signed route event:",Jn);const pi=await Promise.allSettled(we.publish(Kn,Jn)),ur=pi.filter(jn=>jn.status==="fulfilled").length;console.log("[Parlens] Route published:",ur,"of",pi.length,"relays"),ur===0&&console.warn("[Parlens] All relays reported failure, but data may still be saved (iOS quirk)");const Ti={id:Jn.id,dTag:dt,decryptedContent:Lt,created_at:Jn.created_at};Tt(jn=>{const Ni=[Ti,...jn];try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(Ni))}catch(Ri){console.warn("Cache update failed",Ri)}return Ni}),Re("")}catch(St){console.error("[Parlens] Error saving route:",St),alert("Failed to save route, try again later")}finally{kt(!1)}},it=(Fe,St)=>{Wt(Lt=>Lt.map(bn=>bn.id===Fe?{...bn,name:St}:bn)),Nn(null),En("")},de=Fe=>{Nn(Fe.id),En(Fe.name)},qe=async Fe=>{const St=Fe.decryptedContent;if(!St.routeCoords||St.routeCoords.length===0){alert("Failed to load route. Route data is missing or corrupted. Please try creating the route again.");return}const Lt=St.waypoints.map(bn=>({id:crypto.randomUUID(),name:bn.name,lat:bn.lat,lon:bn.lon}));Wt(Lt),Pe(St.routeCoords),vt(St.alternateRouteCoords||null),Rn({}),He(!0),Qt(!1),d(St.routeCoords,St.alternateRouteCoords||null,St.waypoints.map(bn=>({lat:bn.lat,lon:bn.lon})),!0),Xe(!1)},xt=async Fe=>{if(!(!we||!ve||!pe)&&confirm("Are you sure you want to delete this route? This action cannot be undone.")){wi(!0);try{const St={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Fe.id],["a",`${Ln.ROUTE_LOG}:${ve}:${Fe.dTag}`]],content:"Deleted by user"},Lt=await pe(St);await Promise.allSettled(we.publish(Kn,Lt));const bn={kind:Ln.ROUTE_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",Fe.dTag],["deleted","true"]],content:""},yn=await pe(bn);await Promise.allSettled(we.publish(Kn,yn)),Li.current.add(Fe.dTag),Tt($n=>{const dt=$n.filter(ai=>ai.id!==Fe.id);try{localStorage.setItem("parlens_route_cache_v1",JSON.stringify(dt))}catch(ai){console.warn("Cache update failed",ai)}return dt})}catch(St){console.error("Error deleting route:",St),alert("Failed to delete route")}finally{wi(!1)}}};return k.jsxs(k.Fragment,{children:[!K&&k.jsx("button",{onClick:()=>Xe(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-white/10 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10",title:"Create Route",children:k.jsx(r2,{size:20})}),Je&&k.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 pt-2 px-4 pb-4",children:[k.jsx("button",{onClick:()=>Xe(!1),className:"absolute inset-0 z-0 cursor-default"}),si&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:k.jsxs("div",{className:"flex flex-col items-center gap-3",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),k.jsx("p",{className:"text-sm font-medium text-white",children:"Deleting..."})]})}),ct&&k.jsx("div",{className:"fixed inset-0 z-[3000] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:k.jsxs("div",{className:"flex flex-col items-center gap-3",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-white/20 border-t-white animate-spin"}),k.jsx("p",{className:"text-sm font-medium text-white",children:"Saving..."})]})}),k.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col gap-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar border border-black/5 dark:border-white/5 transition-colors",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent",children:"Create Route"}),k.jsx("button",{onClick:()=>Xe(!1),className:"p-2 rounded-full bg-black/5 dark:bg-white/10 transition-colors",children:k.jsx(vo,{size:20,className:"text-black/60 dark:text-white/60"})})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20 ml-2",children:"Add Waypoint"}),k.jsxs("div",{className:"relative z-[2000]",children:[k.jsx("input",{ref:Te,type:"text",placeholder:"Search waypoint",value:Et,onChange:Fe=>rt(Fe.target.value),className:`w-full h-14 bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 px-4 pr-12 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500 ${tr.length>0||Ei.length>0||Dl(Et)?"rounded-t-xl rounded-b-none":"rounded-xl"}`}),Et&&k.jsx("button",{onClick:()=>rt(""),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 text-zinc-400 dark:text-white/40 active:opacity-50 transition-opacity",children:k.jsx(vo,{size:16})}),(tr.length>0||Ei.length>0||Dl(Et))&&k.jsx("div",{className:"absolute top-full left-0 right-0 bg-white dark:bg-zinc-900 rounded-b-xl shadow-xl border-x border-b border-black/5 dark:border-white/5 overflow-hidden z-[3000]",children:k.jsxs("div",{className:"max-h-[50vh] overflow-y-auto",children:[k.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-white/5 border-t border-black/5 dark:border-white/5 flex items-center gap-2 overflow-x-auto",children:[Dl(Et)&&k.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 dark:from-blue-500/20 dark:to-cyan-500/20 text-[10px] font-bold text-blue-600 dark:text-blue-300 uppercase tracking-wider border border-blue-200 dark:border-blue-500/20",children:Dl(Et)?.type==="plus_code"?"Plus Code":"Coordinate"}),tr.length>0&&k.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-emerald-500/10 to-teal-500/10 dark:from-emerald-500/20 dark:to-teal-500/20 text-[10px] font-bold text-emerald-600 dark:text-emerald-300 uppercase tracking-wider border border-emerald-200 dark:border-emerald-500/20",children:"Saved Places"}),Ei.length>0&&k.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-violet-500/10 to-fuchsia-500/10 dark:from-violet-500/20 dark:to-fuchsia-500/20 text-[10px] font-bold text-violet-600 dark:text-violet-300 uppercase tracking-wider border border-violet-200 dark:border-violet-500/20",children:"OSM Search"})]}),(()=>{const Fe=Dl(Et);return Fe?k.jsxs("button",{onClick:()=>{const St={id:crypto.randomUUID(),name:Fe.type==="plus_code"?`Plus Code: ${Et}`:`Loc: ${i4(Fe.lat,Fe.lon)}`,lat:Fe.lat,lon:Fe.lon};Wt(Lt=>[...Lt,St]),rt(""),Pe(null),vt(null),He(!1),d(null,null,null,!1),Rn({})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-blue-50 dark:bg-blue-500/10 text-blue-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 shrink-0 transition-colors",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:"Add Location"}),k.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:[Fe.lat.toFixed(6),", ",Fe.lon.toFixed(6)]})]})]}):null})(),tr.map((Fe,St)=>k.jsxs("button",{onClick:()=>{const Lt={id:crypto.randomUUID(),name:Fe.name,lat:Fe.lat,lon:Fe.lon};Wt(bn=>[...bn,Lt]),rt(""),Pe(null),vt(null),He(!1),d(null,null,null,!1),Rn({})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 shrink-0 transition-colors",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Fe.name}),k.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:"Saved from your routes"})]})]},`saved-${St}`)),Ei.map(Fe=>k.jsxs("button",{onClick:()=>{const St={id:crypto.randomUUID(),name:Fe.display_name.split(",")[0],lat:parseFloat(Fe.lat),lon:parseFloat(Fe.lon)};Wt(Lt=>[...Lt,St]),rt(""),Pe(null),vt(null),He(!1),d(null,null,null,!1),Rn({})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-violet-50 dark:bg-violet-500/10 text-violet-500 group-hover:text-violet-600 dark:group-hover:text-violet-400 shrink-0 transition-colors",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Fe.display_name.split(",")[0]}),k.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:Fe.display_name.split(",").slice(1).join(",")})]})]},Fe.place_id))]})})]}),y&&k.jsxs("button",{onClick:()=>{const Fe={id:crypto.randomUUID(),name:"Current Location",lat:y[0],lon:y[1]};Wt(St=>[...St,Fe]),Pe(null),vt(null),He(!1),d(null,null,null,!1),Rn({})},className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-blue-500/10 dark:bg-blue-500/20 border border-blue-500/20 transition-colors",children:[k.jsx($3,{size:16,className:"text-blue-500"}),k.jsx("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:"Add Current Location"})]}),k.jsxs("button",{onClick:Ye,className:"w-full p-3 flex items-center gap-3 rounded-2xl bg-orange-500/10 dark:bg-orange-500/20 border border-orange-500/20 transition-colors",children:[k.jsx(W3,{size:16,className:"text-orange-500"}),k.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Drop Pin on Map"})]})]}),k.jsxs("div",{className:"space-y-2 flex-1",children:[k.jsxs("div",{className:"flex items-center justify-between ml-2 mr-2",children:[k.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Waypoints (",mt.length,")"]}),mt.length>1&&k.jsx("button",{onClick:oe,className:"p-1 rounded-md transition-colors",title:"Reverse Order",children:k.jsx(S3,{size:14,className:"text-zinc-400 dark:text-white/30"})})]}),mt.length===0?k.jsx("div",{className:"p-8 text-center text-zinc-400 dark:text-white/30 text-sm",children:"No waypoints added yet."}):k.jsx("div",{className:"space-y-2",children:mt.map((Fe,St)=>k.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"flex flex-col gap-0.5 -ml-1 mr-1",children:[k.jsx("button",{onClick:()=>yt(St,-1),disabled:St===0,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(T1,{size:12})}),k.jsx("button",{onClick:()=>yt(St,1),disabled:St===mt.length-1,className:"p-0.5 text-zinc-400 dark:text-white/30 disabled:opacity-20 outline-none focus:outline-none",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(Fd,{size:12})})]}),k.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] text-white text-xs font-bold flex items-center justify-center shrink-0",children:St+1}),kn===Fe.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:ii,onChange:Lt=>En(Lt.target.value),className:"flex-1 min-w-0 text-sm bg-white dark:bg-white/10 rounded-lg px-2 py-1 text-zinc-700 dark:text-white border border-blue-500",autoFocus:!0,onFocus:Lt=>Lt.currentTarget.select(),onKeyDown:Lt=>{Lt.key==="Enter"&&it(Fe.id,ii),Lt.key==="Escape"&&Nn(null)}}),k.jsx("button",{onClick:()=>it(Fe.id,ii),className:"p-2 rounded-xl text-green-500 bg-green-500/10 transition-colors",children:k.jsx(Jf,{size:16})}),k.jsx("button",{onClick:()=>Nn(null),className:"p-2 rounded-xl text-zinc-400 bg-zinc-500/10 transition-colors",children:k.jsx(vo,{size:16})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"flex-1 text-sm text-zinc-700 dark:text-white font-medium truncate",children:Fe.name}),k.jsx("button",{onClick:()=>de(Fe),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:k.jsx(Vd,{size:14})}),k.jsx("button",{onClick:()=>Di(Fe.id),className:"p-2 rounded-xl text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:k.jsx(np,{size:16})})]})]},Fe.id))})]}),_t&&k.jsxs("div",{className:"flex items-center justify-between p-4 rounded-2xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[at?k.jsx(F3,{size:20,className:"text-blue-500"}):k.jsx(Sx,{size:20,className:"text-zinc-400"}),k.jsx("span",{className:"font-medium text-zinc-700 dark:text-white",children:"Show on Map"})]}),k.jsx("button",{onClick:ge,className:`w-14 h-8 rounded-full transition-colors ${at?"bg-[#007AFF]":"bg-zinc-300 dark:bg-white/20"}`,children:k.jsx("div",{className:`w-6 h-6 rounded-full bg-white shadow-md transition-transform ${at?"translate-x-7":"translate-x-1"}`})})]}),_t&&ve&&k.jsxs("div",{className:"space-y-3 p-4 rounded-2xl bg-green-500/5 dark:bg-green-500/10 border border-green-500/20",children:[k.jsxs("label",{className:"text-xs font-bold uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2",children:[k.jsx(aT,{size:14}),"Save Route"]}),k.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[k.jsx("input",{type:"text",value:sn,onChange:Fe=>Re(Fe.target.value),placeholder:"Route name (optional)",className:"w-full sm:flex-1 p-3 rounded-xl bg-white dark:bg-white/5 border border-black/5 dark:border-white/10 text-zinc-700 dark:text-white placeholder-zinc-400 dark:placeholder-white/40 text-sm"}),k.jsx("button",{onClick:At,disabled:ct,className:"w-full sm:w-auto px-6 rounded-xl bg-green-500 text-white font-bold disabled:opacity-50 transition-all active:scale-95 py-3 sm:py-0",children:ct?"...":"Save"})]})]}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:yr,disabled:mt.length===0,className:"flex-1 h-14 rounded-2xl bg-zinc-200 dark:bg-white/10 text-zinc-600 dark:text-white/70 font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:"Clear Route"}),k.jsx("button",{onClick:le,disabled:mt.length<2||qt,className:"flex-1 h-14 rounded-2xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-95",children:qt?"Creating...":"Create Route"})]}),!_t&&mt.length>=2&&ve&&k.jsx("p",{className:"text-xs text-center text-zinc-400 dark:text-white/40",children:" Save option will appear after you create the route"}),ve&&k.jsxs("div",{className:"space-y-3 border-t border-black/5 dark:border-white/10 pt-4",children:[k.jsxs("button",{onClick:()=>Qt(!Bt),className:"w-full flex items-center justify-between",children:[k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx(U3,{size:18,className:"text-zinc-500 dark:text-white/50"}),k.jsxs("span",{className:"text-xs font-bold uppercase tracking-widest text-zinc-400 dark:text-white/20",children:["Saved Routes (",ut.length,")"]})]}),k.jsx("span",{className:"text-xs text-zinc-400 dark:text-white/40",children:Bt?"Hide":"Show"})]}),Bt&&k.jsx("div",{className:"space-y-2",children:bt?k.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"Loading..."}):ut.length===0?k.jsx("div",{className:"text-center text-zinc-400 dark:text-white/40 text-sm py-4",children:"No saved routes yet"}):ut.map(Fe=>k.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10",children:[k.jsxs("button",{onClick:()=>qe(Fe),className:"flex-1 text-left",children:[k.jsx("div",{className:"font-medium text-sm text-zinc-700 dark:text-white truncate",children:Fe.decryptedContent.name}),k.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-400 dark:text-white/40",children:[k.jsxs("span",{children:[Fe.decryptedContent.waypoints.length," stops"]}),k.jsx("span",{children:""}),k.jsx(t2,{size:12}),k.jsx("span",{children:new Date(Fe.created_at*1e3).toLocaleDateString()})]})]}),k.jsx("button",{onClick:()=>xt(Fe),className:"p-2 rounded-lg text-zinc-400 dark:text-white/40 active:scale-95 transition-transform",children:k.jsx(np,{size:16})})]},Fe.id))})]}),k.jsx("div",{className:"p-3 rounded-xl bg-amber-500/10 dark:bg-amber-500/5 border border-amber-500/20",children:k.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400/80 leading-relaxed",children:[k.jsx("strong",{children:"Tip:"})," If place name does not return results, use coordinate or Google Maps plus code in waypoint search. Edit waypoint names to label locations. When you save routes, waypoint names become searchable."]})})]})]})]})};function S4(c){return c>=10?7:c>=7?6:c>=4?5:4}function Hm(c,d,y=!0,C=8){if((!y||c.length<2)&&!c.some(H=>(H.count||1)>1)&&c.length<2)return c;const D=S4(d),P=Math.min(D,C),N=new Map;for(const U of c){const K=`${d>=15&&P>=8?`${U.lat.toFixed(4)},${U.lon.toFixed(4)}`:Pl(U.lat,U.lon,P)}:${U.currency}`,_e=U.count||1;if(N.has(K)){const we=N.get(K);we.spots.push(U),we.count+=_e,we.minPrice=Math.min(we.minPrice,U.price),we.maxPrice=Math.max(we.maxPrice,U.price);const ve=we.spots.length;we.lat=we.spots.reduce((pe,he)=>pe+Number(he.lat),0)/ve,we.lon=we.spots.reduce((pe,he)=>pe+Number(he.lon),0)/ve}else N.set(K,{id:`cluster-${K}`,lat:U.lat,lon:U.lon,spots:[U],minPrice:U.price,maxPrice:U.price,currency:U.currency,count:_e})}const h=[];for(const U of N.values())U.spots.length===1?h.push(U.spots[0]):h.push(U);return h}function Mg(c){return"spots"in c&&Array.isArray(c.spots)&&c.spots.length>1}var yy,U_;function C4(){if(U_)return yy;U_=1;for(var c="0123456789bcdefghjkmnpqrstuvwxyz",d={},y=0;y<c.length;y++)d[c.charAt(y)]=y;var C="auto",D=-90,P=90,N=-180,h=180,U=[0,5,7,8,11,12,13,15,16,17,18],H=function(He,_t,Pe){if(Pe===C){if(typeof He=="number"||typeof _t=="number")throw new Error("string notation required for auto precision.");var ht=He.split(".")[1].length,vt=_t.split(".")[1].length,qt=Math.max(ht,vt);Pe=U[qt]}else Pe===void 0&&(Pe=9);for(var ke=[],Te=0,Ze=0,ut=0,Tt=P,sn=D,Re=h,ct=N,kt;ke.length<Pe;)if(Ze%2===0?(kt=(Re+ct)/2,_t>kt?(ut=(ut<<1)+1,ct=kt):(ut=(ut<<1)+0,Re=kt)):(kt=(Tt+sn)/2,He>kt?(ut=(ut<<1)+1,sn=kt):(ut=(ut<<1)+0,Tt=kt)),Te++,Ze++,Te===5){var bt=c[ut];ke.push(bt),Te=0,ut=0}return ke.join("")},Y=function(He,_t,Pe){Pe=Pe||52;for(var ht=0,vt=P,qt=D,ke=h,Te=N,Ze,ut=0;ht<Pe;)ut*=2,ht%2===0?(Ze=(ke+Te)/2,_t>Ze?(ut+=1,Te=Ze):ke=Ze):(Ze=(vt+qt)/2,He>Ze?(ut+=1,qt=Ze):vt=Ze),ht++;return ut},K=function(He){for(var _t=!0,Pe=P,ht=D,vt=h,qt=N,ke,Te=0,Ze=0,ut=He.length;Ze<ut;Ze++){var Tt=He[Ze].toLowerCase();Te=d[Tt];for(var sn=4;sn>=0;sn--){var Re=Te>>sn&1;_t?(ke=(vt+qt)/2,Re===1?qt=ke:vt=ke):(ke=(Pe+ht)/2,Re===1?ht=ke:Pe=ke),_t=!_t}}return[ht,qt,Pe,vt]},_e=function(He,_t){_t=_t||52;for(var Pe=P,ht=D,vt=h,qt=N,ke=0,Te=0,Ze=_t/2,ut=0;ut<Ze;ut++)Te=we(He,(Ze-ut)*2-1),ke=we(He,(Ze-ut)*2-2),ke===0?Pe=(Pe+ht)/2:ht=(Pe+ht)/2,Te===0?vt=(vt+qt)/2:qt=(vt+qt)/2;return[ht,qt,Pe,vt]};function we(He,_t){return He/Math.pow(2,_t)&1}var ve=function(He){var _t=K(He),Pe=(_t[0]+_t[2])/2,ht=(_t[1]+_t[3])/2,vt=_t[2]-Pe,qt=_t[3]-ht;return{latitude:Pe,longitude:ht,error:{latitude:vt,longitude:qt}}},pe=function(He,_t){var Pe=_e(He,_t),ht=(Pe[0]+Pe[2])/2,vt=(Pe[1]+Pe[3])/2,qt=Pe[2]-ht,ke=Pe[3]-vt;return{latitude:ht,longitude:vt,error:{latitude:qt,longitude:ke}}},he=function(He,_t){var Pe=ve(He),ht=Pe.latitude+_t[0]*Pe.error.latitude*2,vt=Pe.longitude+_t[1]*Pe.error.longitude*2;return vt=Et(vt),ht=rt(ht),H(ht,vt,He.length)},De=function(He,_t,Pe){Pe=Pe||52;var ht=pe(He,Pe),vt=ht.latitude+_t[0]*ht.error.latitude*2,qt=ht.longitude+_t[1]*ht.error.longitude*2;return qt=Et(qt),vt=rt(vt),Y(vt,qt,Pe)},Je=function(He){var _t=He.length,Pe=ve(He),ht=Pe.latitude,vt=Pe.longitude,qt=Pe.error.latitude*2,ke=Pe.error.longitude*2,Te,Ze,ut=[Tt(1,0),Tt(1,1),Tt(0,1),Tt(-1,1),Tt(-1,0),Tt(-1,-1),Tt(0,-1),Tt(1,-1)];function Tt(sn,Re){return Te=ht+sn*qt,Ze=vt+Re*ke,Ze=Et(Ze),Te=rt(Te),H(Te,Ze,_t)}return ut},Xe=function(He,_t){_t=_t||52;var Pe=pe(He,_t),ht=Pe.latitude,vt=Pe.longitude,qt=Pe.error.latitude*2,ke=Pe.error.longitude*2,Te,Ze,ut=[Tt(1,0),Tt(1,1),Tt(0,1),Tt(-1,1),Tt(-1,0),Tt(-1,-1),Tt(0,-1),Tt(1,-1)];function Tt(sn,Re){return Te=ht+sn*qt,Ze=vt+Re*ke,Ze=Et(Ze),Te=rt(Te),Y(Te,Ze,_t)}return ut},mt=function(He,_t,Pe,ht,vt){vt=vt||9;for(var qt=H(He,_t,vt),ke=H(Pe,ht,vt),Te=ve(qt),Ze=Te.error.latitude*2,ut=Te.error.longitude*2,Tt=K(qt),sn=K(ke),Re=Math.round((sn[0]-Tt[0])/Ze),ct=Math.round((sn[1]-Tt[1])/ut),kt=[],bt=0;bt<=Re;bt++)for(var an=0;an<=ct;an++)kt.push(he(qt,[bt,an]));return kt},Wt=function(He,_t,Pe,ht,vt){vt=vt||52;for(var qt=Y(He,_t,vt),ke=Y(Pe,ht,vt),Te=pe(qt,vt),Ze=Te.error.latitude*2,ut=Te.error.longitude*2,Tt=_e(qt,vt),sn=_e(ke,vt),Re=Math.round((sn[0]-Tt[0])/Ze),ct=Math.round((sn[1]-Tt[1])/ut),kt=[],bt=0;bt<=Re;bt++)for(var an=0;an<=ct;an++)kt.push(De(qt,[bt,an],vt));return kt};function Et(He){return He>h?N+He%h:He<N?h+He%h:He}function rt(He){return He>P?P:He<D?D:He}var at={ENCODE_AUTO:C,encode:H,encode_uint64:Y,encode_int:Y,decode:ve,decode_int:pe,decode_uint64:pe,decode_bbox:K,decode_bbox_uint64:_e,decode_bbox_int:_e,neighbor:he,neighbor_int:De,neighbors:Je,neighbors_int:Xe,bboxes:mt,bboxes_int:Wt};return yy=at,yy}var T4=C4();const Zf=rp(T4);class xy{q;r;x;p;k;initialized=!1;constructor(d=1e-5,y=.001){this.q=d,this.r=y,this.x=0,this.p=1,this.k=0}filter(d){return this.initialized?(this.p=this.p+this.q,this.k=this.p/(this.p+this.r),this.x=this.x+this.k*(d-this.x),this.p=(1-this.k)*this.p,this.x):(this.x=d,this.initialized=!0,d)}reset(){this.initialized=!1,this.x=0,this.p=1}}class I4{latFilter;lonFilter;bearingFilter;hasLastBearing=!1;constructor(){this.latFilter=new xy(1e-5,.002),this.lonFilter=new xy(1e-5,.002),this.bearingFilter=new xy(.005,.8)}cumulativeBearing=0;lastInputBearing=0;smoothLocation(d,y){return[this.latFilter.filter(d),this.lonFilter.filter(y)]}smoothBearing(d,y,C=!1){if(!C&&y<2)return null;const D=(d%360+360)%360;if(!this.hasLastBearing)return this.lastInputBearing=D,this.cumulativeBearing=D,this.hasLastBearing=!0,this.bearingFilter.reset(),this.bearingFilter.filter(D),D;let P=D-this.lastInputBearing;return P>180?P-=360:P<-180&&(P+=360),this.cumulativeBearing+=P,this.lastInputBearing=D,(this.bearingFilter.filter(this.cumulativeBearing)%360+360)%360}reset(){this.latFilter.reset(),this.lonFilter.reset(),this.bearingFilter.reset(),this.cumulativeBearing=0,this.lastInputBearing=0,this.hasLastBearing=!1}}class M4{currentRotation=0;lastRawBearing=0;initialized=!1;setBearing(d){const y=(d%360+360)%360;if(!this.initialized)return this.currentRotation=y,this.lastRawBearing=y,this.initialized=!0,this.currentRotation;let C=y-this.lastRawBearing;return C>180?C-=360:C<-180&&(C+=360),this.currentRotation+=C,this.lastRawBearing=y,this.currentRotation}getCurrentRotation(){return this.currentRotation}reset(d=0){this.currentRotation=d,this.lastRawBearing=(d%360+360)%360,this.initialized=!0}}class k4{startLat=0;startLon=0;targetLat=0;targetLon=0;currentLat=0;currentLon=0;startTime=0;duration=300;animationId=null;onUpdate=null;setUpdateCallback(d){this.onUpdate=d}animateTo(d,y,C=300){if(this.animationId!==null&&cancelAnimationFrame(this.animationId),this.targetLat===0&&this.targetLon===0){this.targetLat=d,this.targetLon=y,this.currentLat=d,this.currentLon=y,this.onUpdate&&this.onUpdate(d,y);return}this.startLat=this.currentLat||this.targetLat,this.startLon=this.currentLon||this.targetLon,this.targetLat=d,this.targetLon=y,this.startTime=performance.now(),this.duration=C,this.animate()}animate=()=>{const y=performance.now()-this.startTime,C=Math.min(y/this.duration,1),D=1-Math.pow(1-C,3),P=this.startLat+(this.targetLat-this.startLat)*D,N=this.startLon+(this.targetLon-this.startLon)*D;this.currentLat=P,this.currentLon=N,this.onUpdate&&this.onUpdate(P,N),C<1?this.animationId=requestAnimationFrame(this.animate):this.animationId=null};stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class N4{anchorLat=0;anchorLon=0;displayLat=0;displayLon=0;lastRawLat=0;lastRawLon=0;lastUpdateTime=0;speedHistory=[];currentSpeedClass="stationary";predictedBearing=0;directionChangeBuffer=[];initialized=!1;bufferZones={stationary:15,walking:8,vehicle:5,fast_vehicle:3};pollIntervals={stationary:15e3,walking:5e3,vehicle:2e3,fast_vehicle:1e3};animationDurations={stationary:1200,walking:800,vehicle:400,fast_vehicle:200};haversineDistance(d,y,C,D){const N=(C-d)*Math.PI/180,h=(D-y)*Math.PI/180,U=Math.sin(N/2)*Math.sin(N/2)+Math.cos(d*Math.PI/180)*Math.cos(C*Math.PI/180)*Math.sin(h/2)*Math.sin(h/2);return 6371e3*(2*Math.atan2(Math.sqrt(U),Math.sqrt(1-U)))}calculateBearing(d,y,C,D){const P=(D-y)*Math.PI/180,N=Math.sin(P)*Math.cos(C*Math.PI/180),h=Math.cos(d*Math.PI/180)*Math.sin(C*Math.PI/180)-Math.sin(d*Math.PI/180)*Math.cos(C*Math.PI/180)*Math.cos(P);return(Math.atan2(N,h)*180/Math.PI+360)%360}updateLocation(d,y){const C=Date.now();if(!this.initialized)return this.anchorLat=d,this.anchorLon=y,this.displayLat=d,this.displayLon=y,this.lastRawLat=d,this.lastRawLon=y,this.lastUpdateTime=C,this.initialized=!0,{displayLat:d,displayLon:y,speed:0,speedClass:"stationary",shouldUpdate:!0,animationDuration:0,bearing:null};const D=this.haversineDistance(this.anchorLat,this.anchorLon,d,y),P=(C-this.lastUpdateTime)/1e3,N=this.haversineDistance(this.lastRawLat,this.lastRawLon,d,y),h=P>0?N/P:0;this.speedHistory.push(h),this.speedHistory.length>5&&this.speedHistory.shift();const U=this.speedHistory.reduce((ve,pe)=>ve+pe,0)/this.speedHistory.length;let H;U<.5?H="stationary":U<2?H="walking":U<10?H="vehicle":H="fast_vehicle",this.currentSpeedClass=H;const Y=this.bufferZones[H];if(N>1){const ve=this.calculateBearing(this.lastRawLat,this.lastRawLon,d,y);this.directionChangeBuffer.push(ve),this.directionChangeBuffer.length>3&&this.directionChangeBuffer.shift(),this.predictedBearing=this.directionChangeBuffer.reduce((pe,he)=>pe+he,0)/this.directionChangeBuffer.length}this.lastRawLat=d,this.lastRawLon=y,this.lastUpdateTime=C;let K=!1,_e=this.displayLat,we=this.displayLon;return D>Y?(this.anchorLat=d,this.anchorLon=y,_e=d,we=y,K=!0):(_e=this.anchorLat,we=this.anchorLon,K=!1),K&&(this.displayLat=_e,this.displayLon=we),{displayLat:this.displayLat,displayLon:this.displayLon,speed:U,speedClass:H,shouldUpdate:K,animationDuration:this.animationDurations[H],bearing:this.predictedBearing}}getPollingInterval(){return this.pollIntervals[this.currentSpeedClass]}getSpeedClass(){return this.currentSpeedClass}getPredictedBearing(){return this.predictedBearing}lastAccuracy=10;updateLocationWithAccuracy(d,y,C){this.lastAccuracy=C;const D=this.updateLocation(d,y);if(D.speedClass==="stationary"){const P=Math.max(this.bufferZones.stationary,C*1.5);if(this.haversineDistance(this.anchorLat,this.anchorLon,d,y)<=P)return{...D,displayLat:this.displayLat,displayLon:this.displayLon,shouldUpdate:!1,accuracy:C}}return{...D,accuracy:C}}getLastAccuracy(){return this.lastAccuracy}getSpeedHistoryAverage(){return this.speedHistory.length===0?0:this.speedHistory.reduce((d,y)=>d+y,0)/this.speedHistory.length}reset(){this.initialized=!1,this.anchorLat=0,this.anchorLon=0,this.displayLat=0,this.displayLon=0,this.speedHistory=[],this.currentSpeedClass="stationary",this.directionChangeBuffer=[]}}var _y,V_;function D4(){return V_||(V_=1,_y={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"}),_y}var by,G_;function R4(){if(G_)return by;G_=1;const{webm:c,mp4:d}=D4(),y=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,C=()=>"wakeLock"in navigator;class D{constructor(){if(this.enabled=!1,C()){this._wakeLock=null;const N=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",N),document.addEventListener("fullscreenchange",N)}else y()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",c),this._addSourceToVideo(this.noSleepVideo,"mp4",d),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(N,h,U){var H=document.createElement("source");H.src=U,H.type=`video/${h}`,N.appendChild(H)}get isEnabled(){return this.enabled}enable(){return C()?navigator.wakeLock.request("screen").then(N=>{this._wakeLock=N,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(N=>{throw this.enabled=!1,console.error(`${N.name}, ${N.message}`),N}):y()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(h=>(this.enabled=!0,h)).catch(h=>{throw this.enabled=!1,h})}disable(){C()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):y()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}return by=D,by}var P4=R4();const O4=rp(P4),z4=()=>{const c=me.useRef(null),d=me.useRef(!1),[y,C]=me.useState(!1);me.useEffect(()=>(c.current=new O4,()=>{c.current&&c.current.disable()}),[]);const D=me.useCallback(async()=>{if(d.current=!0,c.current)try{await c.current.enable(),C(!0),console.log("[Parlens] NoSleep Wake Lock acquired (cross-browser)")}catch(N){console.warn("[Parlens] Failed to acquire NoSleep Wake Lock:",N),C(!1)}},[]),P=me.useCallback(async()=>{if(d.current=!1,c.current)try{c.current.disable(),C(!1),console.log("[Parlens] NoSleep Wake Lock released")}catch(N){console.warn("[Parlens] Failed to release NoSleep Wake Lock:",N)}},[]);return me.useEffect(()=>{const N=async()=>{document.visibilityState==="visible"&&d.current&&await D()};return document.addEventListener("visibilitychange",N),()=>{document.removeEventListener("visibilitychange",N)}},[D]),{requestLock:D,releaseLock:P,isLocked:y}};var qm=new TextDecoder("utf-8");new TextEncoder;var M2=5e3;function L4(c){let{prefix:d,words:y}=th.decode(c,M2),C=new Uint8Array(th.fromWords(y));switch(d){case"nprofile":{let D=vy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:vs(D[0][0]),relays:D[1]?D[1].map(P=>qm.decode(P)):[]}}}case"nevent":{let D=vy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for nevent");if(D[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(D[2]&&D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(D[3]&&D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:vs(D[0][0]),relays:D[1]?D[1].map(P=>qm.decode(P)):[],author:D[2]?.[0]?vs(D[2][0]):void 0,kind:D[3]?.[0]?parseInt(vs(D[3][0]),16):void 0}}}case"naddr":{let D=vy(C);if(!D[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!D[2]?.[0])throw new Error("missing TLV 2 for naddr");if(D[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!D[3]?.[0])throw new Error("missing TLV 3 for naddr");if(D[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:qm.decode(D[0][0]),pubkey:vs(D[2][0]),kind:parseInt(vs(D[3][0]),16),relays:D[1]?D[1].map(P=>qm.decode(P)):[]}}}case"nsec":return{type:d,data:C};case"npub":case"note":return{type:d,data:vs(C)};default:throw new Error(`unknown prefix ${d}`)}}function vy(c){let d={},y=c;for(;y.length>0;){let C=y[0],D=y[1],P=y.slice(2,2+D);if(y=y.slice(2+D),P.length<D)throw new Error(`not enough data to read on TLV ${C}`);d[C]=d[C]||[],d[C].push(P)}return d}function H_(c){return F4("npub",Ud(c))}function B4(c,d){let y=th.toWords(d);return th.encode(c,y,M2)}function F4(c,d){return B4(c,d)}const j4=({onClose:c,currentLocation:d,countryCode:y,onPickLocation:C,pickedLocation:D})=>{const{pubkey:P,pool:N,signEvent:h}=nh(),[U,H]=me.useState("public"),[Y,K]=me.useState(null),[_e,we]=me.useState(!1),[ve,pe]=me.useState(()=>{if(!d)return!0;const Ke=Pl(d[0],d[1],5);return sessionStorage.getItem("parlens_last_fetch_hash")!==Ke}),[he,De]=me.useState(()=>{if(!d)return!0;const Ke=Pl(d[0],d[1],5);return sessionStorage.getItem("parlens_last_fetch_hash")!==Ke}),[Je,Xe]=me.useState([]),[mt,Wt]=me.useState([]),[Et,rt]=me.useState(new Map),[at,He]=me.useState(new Map),[_t,Pe]=me.useState(null),[ht,vt]=me.useState(null),[qt,ke]=me.useState(!1),[Te,Ze]=me.useState("all"),[ut,Tt]=me.useState(""),[sn,Re]=me.useState(""),[ct,kt]=me.useState(new Map),[bt,an]=me.useState(null),[Bt,Qt]=me.useState("all"),[un,nn]=me.useState("all"),[kn,Nn]=me.useState(!1),[ii,En]=me.useState(10),[si,wi]=me.useState(null),[Oi,Yn]=me.useState(()=>{try{const Ke=localStorage.getItem("parlens-saved-listings");return Ke?new Set(JSON.parse(Ke)):new Set}catch{return new Set}}),[Gn,Rn]=me.useState(!1),Ei=P===zd,[on,Li]=me.useState(()=>new Map),[tr,Di]=me.useState("all"),[yr,yt]=me.useState(!1),oe=me.useRef(null),le=me.useRef(!1),ge=Ke=>{Yn(je=>{const Mt=new Set(je);return Mt.has(Ke)?Mt.delete(Ke):Mt.add(Ke),localStorage.setItem("parlens-saved-listings",JSON.stringify(Array.from(Mt))),Mt})},Ue=me.useCallback(async Ke=>{if(!N||!h||!Ei)return;const je=`${Ln.LISTED_PARKING_METADATA}:${Ke.pubkey}:${Ke.d}`,Mt=on.has(je);yt(!0);try{if(Mt){const Yt=on.get(je);if(Yt){const tn={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Yt]],content:"Revoking listing approval"},Un=await h(tn);await Promise.allSettled(N.publish(Kn,Un)),Li(Hn=>{const vn=new Map(Hn);return vn.delete(je),vn}),console.log("[Parlens] Approval revoked for:",Ke.listing_name)}}else{const Yt={kind:Ln.LABEL,created_at:Math.floor(Date.now()/1e3),tags:[["l","approved","parlens"],["a",je],["p",Ke.pubkey||""]],content:"Approved public listing"},tn=await h(Yt);await Promise.allSettled(N.publish(Kn,tn)),Li(Un=>{const Hn=new Map(Un);return Hn.set(je,tn.id),Hn}),console.log("[Parlens] Approved listing:",Ke.listing_name)}}catch(Yt){console.error("[Parlens] Failed to toggle approval:",Yt),alert("Failed to update approval. Please try again.")}finally{yt(!1)}},[N,h,Ei,on]),[Ye,At]=me.useState([]),[it,de]=me.useState(null),[qe,xt]=me.useState([]),[Fe,St]=me.useState(!1),Lt=me.useRef(null);me.useEffect(()=>{d&&!it&&(de(d),xt([]))},[d]),me.useEffect(()=>{const Ke=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=Ke}},[]),me.useEffect(()=>{if(!N)return;(async()=>{try{const je=await N.querySync(Kn,{kinds:[Ln.LABEL],authors:[zd],"#l":["approved"]}),Mt=new Map;for(const Yt of je){const tn=Yt.tags.find(Un=>Un[0]==="a")?.[1];tn&&(Mt.get(tn)||Mt.set(tn,Yt.id))}Li(Mt),console.log("[Parlens] Loaded",Mt.size,"approval labels from approver")}catch(je){console.error("[Parlens] Failed to fetch approval labels:",je)}})()},[N]);const[bn,yn]=me.useState([]);me.useEffect(()=>{(async()=>{try{const je=localStorage.getItem("parlens-saved-routes");if(je){const Mt=JSON.parse(je),Yt=await Promise.all(Mt.map(async tn=>{try{if(!P)return null;const Un=await Cx(tn.content,P);return{id:tn.id,dTag:tn.dTag,decryptedContent:Un,created_at:tn.created_at}}catch{return null}}));yn(Yt.filter(Boolean))}}catch(je){console.error("Error loading saved routes:",je)}})()},[P]);const $n=me.useMemo(()=>{if(!ut||ut.length<2)return[];const Ke=ut.toLowerCase(),je=[];for(const Mt of bn)for(const Yt of Mt.decryptedContent.waypoints)Yt.name.toLowerCase().includes(Ke)&&(je.find(tn=>tn.name.toLowerCase()===Yt.name.toLowerCase())||je.push({name:Yt.name,lat:Yt.lat,lon:Yt.lon}));return je.slice(0,3)},[ut,bn]),dt=me.useMemo(()=>{if(!ut||ut.length<2)return[];const Ke=ut.toLowerCase(),je=[],Mt=new Set;for(const Yt of Je){const tn=Yt.local_area||Yt.city;if(!tn)continue;if(tn.toLowerCase().includes(Ke)&&!Mt.has(tn.toLowerCase())){const[Hn,vn]=(Yt.location||"").split(",").map(Number);!isNaN(Hn)&&!isNaN(vn)&&(Mt.add(tn.toLowerCase()),je.push({name:tn,lat:Hn,lon:vn}))}}return je.slice(0,3)},[ut,Je]),ai=Ke=>{const je=Ke.target.value;if(Tt(je),Lt.current&&clearTimeout(Lt.current),je.length<3){xt([]);return}Lt.current=setTimeout(async()=>{St(!0);const Mt=await Dg(je,y,d,1);xt(Mt),St(!1)},500)},Fn=Ke=>{const je=parseFloat(Ke.lat),Mt=parseFloat(Ke.lon);console.log("[Parlens] Selected suggestion:",Ke.display_name),!isNaN(je)&&!isNaN(Mt)&&(de([je,Mt]),oe.current=[je,Mt],Re(""),Tt(Ke.display_name.split(",")[0]),xt([]),jn())},Jn=async()=>{if(Lt.current&&clearTimeout(Lt.current),qe.length>0){Fn(qe[0]);return}if(!ut){Re(""),d&&(de(d),oe.current=d),xt([]),jn();return}St(!0);try{const Ke=await Dg(ut,y,d,1);if(Ke&&Ke.length>0){console.log("[Parlens] Search result:",Ke[0].display_name);const je=parseFloat(Ke[0].lat),Mt=parseFloat(Ke[0].lon);if(!isNaN(je)&&!isNaN(Mt)){de([je,Mt]),oe.current=[je,Mt],Re(""),xt([]),pe(!1),jn();return}}if(console.log("[Parlens] Location not found, falling back to text filter"),ut.length>2){const je=await Dg(ut,y,d,1);if(je.length>0){Fn(je[0]),pe(!1);return}}Re(ut),d&&de(d),xt([])}catch(Ke){console.error("Search failed:",Ke),Re(ut)}finally{St(!1),pe(!1)}};me.useEffect(()=>{try{const Ke=localStorage.getItem("parlens-hidden-items");if(Ke)At(JSON.parse(Ke));else{const je=JSON.parse(localStorage.getItem("parlens-hidden-listings")||"[]"),Mt=JSON.parse(localStorage.getItem("parlens-blocked-pubkeys")||"[]"),Yt=[...je.map(tn=>({id:tn,name:"Unknown Listing",type:"listing"})),...Mt.map(tn=>({id:tn,name:tn.slice(0,12)+"...",type:"owner"}))];Yt.length>0&&(At(Yt),localStorage.setItem("parlens-hidden-items",JSON.stringify(Yt)),localStorage.removeItem("parlens-hidden-listings"),localStorage.removeItem("parlens-blocked-pubkeys"))}}catch{}},[]);const pi=(Ke,je)=>{if(Ye.some(Yt=>Yt.id===Ke))return;const Mt=[...Ye,{id:Ke,name:je,type:"listing"}];At(Mt),localStorage.setItem("parlens-hidden-items",JSON.stringify(Mt)),wi(null)};me.useEffect(()=>{if(!si)return;const Ke=()=>wi(null);return window.addEventListener("click",Ke),()=>window.removeEventListener("click",Ke)},[si]);const ur=(Ke,je)=>{if(Ye.some(Yt=>Yt.id===Ke))return;const Mt=[...Ye,{id:Ke,name:je,type:"owner"}];At(Mt),localStorage.setItem("parlens-hidden-items",JSON.stringify(Mt)),wi(null)},Ti=(Ke,je)=>Ye.some(Mt=>Mt.id===Ke||je&&Mt.id===je),jn=me.useCallback(async Ke=>{if(!N)return;typeof Ke=="boolean"&&Ke||(pe(!0),De(!0));try{let Mt=[];if(P){const Cn=Date.now(),Dn=N.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],authors:[P]}),Zt=N.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],"#p":[P]}),[ki,ln]=await Promise.all([Dn,Zt]),yi=Date.now()-Cn;Kn.forEach(_i=>_o.recordSuccess(_i,yi));const Bi=new Map;[...ki,...ln].forEach(_i=>Bi.set(_i.id,_i)),Mt=Array.from(Bi.values()),console.log("[Parlens] Phase A: Fetched",Mt.length,"user/managed/member listings in",yi,"ms")}try{const Cn=JSON.parse(localStorage.getItem("parlens-saved-refs")||"[]");if(Cn.length>0){console.log("[Parlens] Phase B: Fetching",Cn.length,"saved listing refs");const Dn=Date.now(),Zt=await N.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],"#a":Cn}),ki=Date.now()-Dn;Kn.forEach(yi=>_o.recordSuccess(yi,ki));const ln=new Set(Mt.map(yi=>yi.id));Zt.forEach(yi=>{ln.has(yi.id)||(Mt.push(yi),ln.add(yi.id))}),console.log("[Parlens] Phase B: Merged",Zt.length,"saved listings in",ki,"ms. Total:",Mt.length)}}catch(Cn){Kn.forEach(Dn=>_o.recordFailure(Dn)),console.warn("[Parlens] Phase B: Failed to fetch saved refs:",Cn)}let Yt=oe.current;it&&(Yt=it);let tn=[];if(Yt){const[Cn,Dn]=Yt,Zt=Pl(Cn,Dn,10),ki=[];for(let Bi=1;Bi<=10;Bi++)ki.push(Zt.substring(0,Bi));console.log("[Parlens] Phase C: Using hierarchical geohash prefixes:",ki);const ln=Date.now();tn=await N.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],"#g":ki,limit:100});const yi=Date.now()-ln;Kn.forEach(Bi=>_o.recordSuccess(Bi,yi)),console.log("[Parlens] Phase C: Hierarchical query returned",tn.length,"events in",yi,"ms"),tn.length===0&&(console.log("[Parlens] Phase B: No hierarchical hits, falling back to global query"),tn=await N.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],limit:100}))}else console.log("[Parlens] Phase B: No location context, using global query"),tn=await N.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],limit:100});let Un=[];if(Ei){console.log("[Parlens] Phase D: Fetching global public listings for Approver");try{const Cn=Date.now();Un=await N.querySync(Kn,{kinds:[Ln.LISTED_PARKING_METADATA],limit:100});const Dn=Date.now()-Cn;console.log("[Parlens] Phase D: Found",Un.length,"global listings for approver in",Dn,"ms")}catch(Cn){console.warn("[Parlens] Phase D failed:",Cn)}}const Hn=[...Mt,...tn,...Un],vn=new Map;Hn.forEach(Cn=>{vn.has(Cn.id)||vn.set(Cn.id,Cn)});const ri=new Map;Array.from(vn.values()).forEach(Cn=>{const Dn=Cn.tags.find(ki=>ki[0]==="d")?.[1];if(!Dn||Cn.content==="Deleted")return;const Zt=`${Cn.pubkey}:${Dn}`;(!ri.has(Zt)||ri.get(Zt).created_at<Cn.created_at)&&ri.set(Zt,Cn)});const ni=Array.from(ri.values()).map(Cn=>{const Dn=li=>Cn.tags.find(Hi=>Hi[0]===li)?.[1]||"",Zt=li=>Cn.tags.filter(Hi=>Hi[0]===li).map(Hi=>Hi[1]),ki=Cn.tags.filter(li=>li[0]==="p"&&li[2]==="admin").map(li=>li[1]),ln=Cn.tags.filter(li=>li[0]==="p"&&li[2]==="write").map(li=>li[1]),yi=Cn.tags.filter(li=>li[0]==="p"&&li[2]==="read").map(li=>li[1]),Bi=Zt("relay"),_i=Dn("floor_plan"),bi=_i?JSON.parse(_i):void 0;let mi;try{const li=Dn("rates");li&&(mi=JSON.parse(li))}catch{}return{id:Cn.id,pubkey:Cn.pubkey,d:Dn("d"),listing_name:Dn("listing_name")||"Unnamed",location:Dn("location"),g:Dn("g"),floors:Dn("floors"),floor_plan:bi,total_spots:parseInt(Dn("total_spots")||"0"),rates:mi,listing_type:Dn("listing_type")||"public",qr_type:Dn("qr_type")||"static",status:Dn("status")||"open",owners:ki,managers:ln,members:yi,relays:Bi,local_area:Dn("local_area"),city:Dn("city"),zipcode:Dn("zipcode"),website:Dn("r")||Cn.content,created_at:Cn.created_at,originalEvent:Cn}}).filter(Cn=>Cn.listing_name!=="Unnamed"&&Cn.listing_name.trim()!=="");let Xn=ni;const Zi=oe.current;if(Zi){const Cn=Pl(Zi[0],Zi[1],5);Xn=ni.sort((Dn,Zt)=>{const ki=Dn.g||"",ln=Zt.g||"",yi=ki.startsWith(Cn),Bi=ln.startsWith(Cn);return yi&&!Bi?-1:!yi&&Bi?1:(Zt.created_at||0)-(Dn.created_at||0)})}else Xn=ni.sort((Cn,Dn)=>(Dn.created_at||0)-(Cn.created_at||0));Xe(Xn),pe(!1);try{for(let Dn=0;Dn<Xn.length;Dn+=10){const Zt=Xn.slice(Dn,Dn+10),ki=Zt.map(li=>`${Ln.LISTED_PARKING_METADATA}:${li.pubkey}:${li.d}`);if(ki.length===0)continue;const ln=Date.now(),yi=await N.querySync(Kn,{kinds:[Ln.LISTED_SPOT_LOG],"#a":ki}),Bi=Date.now()-ln;Kn.forEach(li=>_o.recordSuccess(li,Bi));const _i=new Map;yi.forEach(li=>{const Hi=li.tags.find(Tr=>Tr[0]==="a"&&Tr[1]?.startsWith(`${Ln.PARKING_SPOT_LISTING}:`))?.[1];Hi&&(!_i.has(Hi)||_i.get(Hi).created_at<li.created_at)&&_i.set(Hi,li)});const bi=new Map;Zt.forEach(li=>{bi.set(li.d,{car:{open:0,occupied:0,closed:0,total:0,rate:li.rates?.car?.hourly||0},motorcycle:{open:0,occupied:0,closed:0,total:0,rate:li.rates?.motorcycle?.hourly||0},bicycle:{open:0,occupied:0,closed:0,total:0,rate:li.rates?.bicycle?.hourly||0}})}),_i.forEach(li=>{const Hi=li.tags.find(zi=>zi[0]==="a"&&zi[3]==="root")?.[1];if(!Hi)return;const Tr=Hi.split(":")[2],Qn=bi.get(Tr);if(!Qn)return;const es=li.tags.find(zi=>zi[0]==="status")?.[1]||"open",Ts=li.tags.find(zi=>zi[0]==="type")?.[1]||"car";Qn[Ts]&&(Qn[Ts].total++,es==="occupied"?Qn[Ts].occupied++:es==="closed"?Qn[Ts].closed++:Qn[Ts].open++)});const mi=new Map;_i.forEach((li,Hi)=>{const Tr=Hi.split(":")[2],Qn=li.tags.find(zi=>zi[0]==="a"&&zi[3]==="root")?.[1];if(!Qn)return;const es=Qn.split(":")[2],Ts=li.tags.find(zi=>zi[0]==="type")?.[1]||"car";mi.set(Tr,{listingId:es,type:Ts})}),kt(li=>{const Hi=new Map(li);return bi.forEach((Tr,Qn)=>{Hi.set(Qn,Tr)}),Hi}),He(li=>{const Hi=new Map(li);return mi.forEach((Tr,Qn)=>{Hi.set(Qn,Tr)}),Hi})}}catch(Cn){console.error("[Parlens] Status batch fetching failed (listings still displayed):",Cn)}}catch(Mt){console.error("Error fetching listings:",Mt)}finally{pe(!1),De(!1)}},[N,it]),Ni=me.useCallback(async Ke=>{if(N){Wt([]),De(!0);try{const je=`${Ln.LISTED_PARKING_METADATA}:${Ke.pubkey}:${Ke.d}`,Mt=Date.now(),Yt=await N.querySync(Kn,{kinds:[Ln.PARKING_SPOT_LISTING],"#a":[je]}),tn=Date.now()-Mt;Kn.forEach(Hn=>_o.recordSuccess(Hn,tn)),console.log("[Parlens] Kind 37141 a-tag query:",Yt.length,"spots in",tn,"ms");const Un=Ri(Yt,Ke);Wt(Un),Un.length>0&&await ji(Un),console.log(`[Parlens] Spots loaded for ${Ke.listing_name}:`,Un.length)}catch(je){Kn.forEach(Mt=>_o.recordFailure(Mt)),console.error("Error fetching spots:",je)}finally{De(!1)}}},[N]),Ri=(Ke,je)=>Ke.map(Mt=>{const Yt=tn=>Mt.tags.find(Un=>Un[0]===tn)?.[1]||"";return{id:Mt.id,pubkey:Mt.pubkey,d:Yt("d"),a:Yt("a"),spot_number:Yt("spot_number"),floor:Yt("floor"),short_name:Yt("short_name"),type:Yt("type")||"car",location:Yt("location"),g:Yt("g"),content:Mt.content,rates:je.rates?.[Yt("type")||"car"]}}),ji=async Ke=>{if(!N||Ke.length===0)return;const je=Ke.flatMap(vn=>{const ri=`${Ln.PARKING_SPOT_LISTING}:${vn.pubkey}:${vn.d}`;return[ri,ri+""]}),Mt=Date.now(),Yt=await N.querySync(Kn,{kinds:[Ln.LISTED_SPOT_LOG],"#a":je}),tn=Date.now()-Mt;Kn.forEach(vn=>_o.recordSuccess(vn,tn));const Un=new Map;Yt.forEach(vn=>{const ri=vn.tags.find(ni=>ni[0]==="a")?.[1];(!Un.has(ri)||Un.get(ri).created_at<vn.created_at)&&Un.set(ri,vn)});const Hn=new Map;Un.forEach((vn,ri)=>{const ni=Ke.find(Xn=>`${Ln.PARKING_SPOT_LISTING}:${Xn.pubkey}:${Xn.d}`===ri);if(ni){const Xn=Zi=>vn.tags.find(Cn=>Cn[0]===Zi)?.[1]||"";Hn.set(ni.d,{id:vn.id,pubkey:vn.pubkey,a:Xn("a"),status:Xn("status")||"open",updated_by:Xn("updated_by"),authorizer:Xn("authorizer"),created_at:vn.created_at})}}),rt(vn=>{const ri=new Map(vn);return Hn.forEach((ni,Xn)=>{const Zi=ri.get(Xn);(!Zi||Zi.created_at<ni.created_at)&&ri.set(Xn,ni)}),ri})};me.useEffect(()=>{d&&!oe.current&&(oe.current=d),!le.current&&oe.current&&(le.current=!0,jn())},[jn,d]),me.useEffect(()=>{if(!N)return;console.log("[Parlens] Setting up real-time listing subscription");const Ke=N.subscribeMany(Kn,[{kinds:[Ln.LISTED_PARKING_METADATA],since:Math.floor(Date.now()/1e3)}],{onevent(je){const Mt=je.tags.find(Yt=>Yt[0]==="d")?.[1];!Mt||je.content==="Deleted"||je.content==="Parlens Relay Check"||Mt.startsWith("test-relay-check-")||(console.log("[Parlens] New listing event received:",Mt),Xe(Yt=>{const tn=`${je.pubkey}:${Mt}`,Un=Yt.findIndex(ln=>`${ln.pubkey}:${ln.d}`===tn),Hn=ln=>je.tags.find(yi=>yi[0]===ln)?.[1]||"",vn=ln=>je.tags.filter(yi=>yi[0]===ln).map(yi=>yi[1]),ri=je.tags.filter(ln=>ln[0]==="p"&&ln[2]==="admin").map(ln=>ln[1]),ni=je.tags.filter(ln=>ln[0]==="p"&&ln[2]==="write").map(ln=>ln[1]),Xn=je.tags.filter(ln=>ln[0]==="p"&&ln[2]==="read").map(ln=>ln[1]),Zi=vn("relay"),Cn=Hn("floor_plan"),Dn=Cn?JSON.parse(Cn):void 0;let Zt;try{const ln=Hn("rates");ln&&(Zt=JSON.parse(ln))}catch{}const ki={id:je.id,pubkey:je.pubkey,d:Hn("d"),listing_name:Hn("listing_name")||"Unnamed",location:Hn("location"),g:Hn("g"),floors:Hn("floors"),floor_plan:Dn,rates:Zt,listing_type:Hn("listing_type")||"public",qr_type:Hn("qr_type")||"static",status:Hn("status")||"open",owners:ri,managers:ni,members:Xn,relays:Zi,local_area:Hn("local_area"),city:Hn("city"),zipcode:Hn("zipcode"),website:Hn("r")||je.content,created_at:je.created_at,originalEvent:je};if(Un>=0&&Yt[Un]){if((Yt[Un]?.created_at??0)<je.created_at){const yi=[...Yt];return yi[Un]=ki,yi}return Yt}else return[ki,...Yt]}))},oneose(){console.log("[Parlens] Listing subscription active")}});return()=>{console.log("[Parlens] Closing listing subscription"),Ke.close()}},[N]),me.useEffect(()=>{if(!N)return;let Ke=[];if(mt.length>0)Ke=mt.map(tn=>`${Ln.PARKING_SPOT_LISTING}:${tn.pubkey}:${tn.d}`);else return;if(Ke.length===0)return;console.log("[Parlens] Subscribing to status updates for",Ke.length,"spots");const je=new Map,Mt=N.subscribeMany(Kn,[{kinds:[Ln.LISTED_SPOT_LOG],"#a":Ke}],{onevent(tn){const Un=tn.tags.find(ri=>ri[0]==="a")?.[1],Hn=tn.tags.find(ri=>ri[0]==="status")?.[1];if(!Un||!Hn)return;const vn=je.get(Un);vn&&vn.created_at>=tn.created_at||(je.set(Un,{status:Hn,created_at:tn.created_at}),rt(ri=>{const ni=Un.split(":").pop();if(!ni)return ri;const Xn=new Map(ri),Zi=Xn.get(ni);if((!Zi||Zi.created_at<tn.created_at)&&(Xn.set(ni,{id:tn.id,pubkey:tn.pubkey,a:Un,status:Hn,updated_by:tn.tags.find(Cn=>Cn[0]==="updated_by")?.[1]||"",authorizer:tn.tags.find(Cn=>Cn[0]==="authorizer")?.[1]||"",created_at:tn.created_at}),ni)){const Cn=at.get(ni);Cn&&kt(Dn=>{const Zt=Dn.get(Cn.listingId);if(!Zt)return Dn;const ki=new Map(Dn),ln={...Zt[Cn.type]},yi=Zi?.status||"open",Bi=Hn;return yi==="occupied"?ln.occupied=Math.max(0,ln.occupied-1):yi==="closed"?ln.closed=Math.max(0,ln.closed-1):ln.open=Math.max(0,ln.open-1),Bi==="occupied"?ln.occupied++:Bi==="closed"?ln.closed++:ln.open++,ki.set(Cn.listingId,{...Zt,[Cn.type]:ln}),ki})}return Xn}))},oneose(){console.log("[Parlens] Real-time subscription active, status data received"),De(!1)}}),Yt=setTimeout(()=>{De(!1)},3e3);return()=>{console.log("[Parlens] Closing real-time status subscription"),clearTimeout(Yt),Mt.close()}},[N,mt,at]),me.useEffect(()=>{Y&&Ni(Y)},[Y,Ni]),me.useEffect(()=>{if(!Y||mt.length===0)return;const Ke={car:{open:0,occupied:0,closed:0,total:0,rate:Y.rates?.car?.hourly||0},motorcycle:{open:0,occupied:0,closed:0,total:0,rate:Y.rates?.motorcycle?.hourly||0},bicycle:{open:0,occupied:0,closed:0,total:0,rate:Y.rates?.bicycle?.hourly||0}};for(const je of mt){const Mt=je.type||"car",Yt=Et.get(je.d)?.status||"open";Ke[Mt]&&(Ke[Mt].total++,Yt==="occupied"?Ke[Mt].occupied++:Yt==="closed"?Ke[Mt].closed++:Ke[Mt].open++)}kt(je=>{const Mt=new Map(je);return Mt.set(Y.d,Ke),Mt})},[Et,Y,mt]);const Nr=async Ke=>{if(!(!N||!P||!h)&&confirm(`Delete "${Ke.listing_name}" ? This will delete all spots.`)){ke(!0);try{const je=`${Ln.LISTED_PARKING_METADATA}:${Ke.pubkey}:${Ke.d}`,Mt=Date.now(),Yt=await N.querySync(Kn,{kinds:[Ln.PARKING_SPOT_LISTING],"#a":[je]}),tn=Date.now()-Mt;Kn.forEach(Hn=>_o.recordSuccess(Hn,tn)),console.log("[Parlens] Kind 37141 delete query:",Yt.length,"spots in",tn,"ms");for(const Hn of Yt){const vn=Hn.tags.find(ri=>ri[0]==="d")?.[1];if(vn){const ri={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Hn.id],["a",`${Ln.PARKING_SPOT_LISTING}:${P}:${vn}`]],content:"Deleted"};await Promise.allSettled(N.publish(Kn,await h(ri)))}}const Un={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",Ke.id],["a",`${Ln.LISTED_PARKING_METADATA}:${P}:${Ke.d}`]],content:"Deleted"};await Promise.allSettled(N.publish(Kn,await h(Un))),Xe(Hn=>Hn.filter(vn=>vn.id!==Ke.id)),K(null)}catch(je){console.error(je)}finally{ke(!1)}}},Jt=me.useMemo(()=>{let Ke=Je.filter(je=>{if(Gn&&!Oi.has(je.id))return!1;let Mt=!1;if(U==="public"){const Yt=je.pubkey===zd,tn=`${Ln.LISTED_PARKING_METADATA}:${je.pubkey}:${je.d}`,Un=on.has(tn);Mt=je.listing_type==="public"&&(Yt||Un)}else if(U==="private")Mt=je.listing_type==="private"&&(je.members.includes(P)||je.owners.includes(P)||je.managers.includes(P));else if(U==="my"){const Yt=je.owners.includes(P)||je.managers.includes(P),tn=`${Ln.LISTED_PARKING_METADATA}:${je.pubkey}:${je.d}`,Un=je.pubkey===zd,Hn=on.has(tn),vn=je.listing_type==="public"&&!Un&&!Hn,ri=je.listing_type==="public"&&(Un||Hn);if(!Ei)Mt=Yt;else switch(tr){case"my":Mt=Yt;break;case"approved":Mt=!Yt&&ri;break;case"pending":Mt=vn;break;default:Mt=Yt||je.listing_type==="public";break}}if(!Mt||U!=="my"&&Ti(je.id,je.pubkey))return!1;if(sn){const Yt=sn.toLowerCase();if(!(je.listing_name.toLowerCase().includes(Yt)||je.local_area?.toLowerCase().includes(Yt)||je.city?.toLowerCase().includes(Yt)||je.zipcode?.toLowerCase().includes(Yt)))return!1}return!0});return Ke.sort((je,Mt)=>{if(sn){const ni=sn.toLowerCase(),Xn=je.listing_name.toLowerCase()===ni,Zi=Mt.listing_name.toLowerCase()===ni;if(Xn&&!Zi)return-1;if(!Xn&&Zi)return 1}const Yt=it||d;if(Yt&&je.location&&Mt.location){const[ni,Xn]=je.location.split(",").map(Dn=>parseFloat(Dn.trim())),[Zi,Cn]=Mt.location.split(",").map(Dn=>parseFloat(Dn.trim()));if(!isNaN(ni)&&!isNaN(Xn)&&!isNaN(Zi)&&!isNaN(Cn)){const Dn=F_(Yt[0],Yt[1],ni,Xn),Zt=F_(Yt[0],Yt[1],Zi,Cn);if(Math.abs(Dn-Zt)>.1)return Dn-Zt}}const tn=ct.get(je.d),Un=ct.get(Mt.d),Hn=ni=>ni?Te==="all"?ni.car.open+ni.motorcycle.open+ni.bicycle.open:ni[Te]?.open||0:0,vn=Hn(tn),ri=Hn(Un);return vn!==ri?ri-vn:je.listing_name.localeCompare(Mt.listing_name)}),Ke},[Je,U,P,ut,ct,Te,d,Oi,Gn,sn,it,tr,Ei,on]),gi=me.useMemo(()=>Jt.slice(0,ii),[Jt,ii]),Sn=me.useMemo(()=>{const Ke=new Set;return mt.forEach(je=>{je.floor&&Ke.add(je.floor)}),Array.from(Ke).sort()},[mt]),lr=me.useMemo(()=>{const Ke=Y&&P&&(Y.owners.includes(P)||Y.managers.includes(P));return mt.filter(je=>{if(Te!=="all"&&je.type!==Te||Bt!=="all"&&je.floor!==Bt)return!1;const Yt=Et.get(je.d)?.status||"open";return!(!Ke&&Yt!=="open"||un!=="all"&&Yt!==un)}).sort((je,Mt)=>parseInt(je.spot_number||"0")-parseInt(Mt.spot_number||"0"))},[mt,Te,Bt,un,Et,Y,P]);return k.jsxs("div",{className:"fixed inset-0 z-[3000] bg-zinc-50 dark:bg-black flex flex-col transition-colors",children:[kn&&k.jsxs("div",{className:"fixed inset-0 z-[6000] flex items-center justify-center bg-black/60 backdrop-blur-sm flex-col animate-in fade-in duration-200",children:[k.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-white/20 border-t-white rounded-full"}),k.jsx("div",{className:"text-white font-bold mt-4 animate-pulse",children:"Updating Status..."})]}),qt&&k.jsxs("div",{className:"fixed inset-0 z-[3100] flex items-center justify-center bg-black/50 backdrop-blur-sm flex-col",children:[k.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-white/20 border-t-white rounded-full"}),k.jsx("div",{className:"text-white font-bold mt-4",children:"Deleting..."})]}),k.jsx("div",{className:"bg-white dark:bg-[#1c1c1e] border-b border-black/5 dark:border-white/10",children:k.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("button",{onClick:Y?()=>K(null):c,className:"p-2 rounded-full bg-black/5 dark:bg-white/10 active:scale-95 transition-transform",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(tp,{size:20,className:"text-black/60 dark:text-white/60 rotate-180"})}),k.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 bg-clip-text text-transparent",children:Y?Y.listing_name:"Listed Parking"})]}),k.jsxs("div",{className:"flex items-center gap-2",children:[!Y&&k.jsx("button",{onClick:()=>we(!0),className:"p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full shadow-lg shadow-blue-500/20 active:scale-95 transition-transform",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(s1,{size:20})}),k.jsx("button",{onClick:async()=>{he||(console.log("[Parlens] Refreshing data and connections..."),De(!0),setTimeout(async()=>{d&&(oe.current=d);const Ke=[jn(!0)];Y&&Ke.push(Ni(Y)),await Promise.all(Ke)},50))},className:`p-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full shadow-lg shadow-blue-500/20 active:scale-95 transition-transform ${he?"opacity-70 cursor-not-allowed":""}`,style:{WebkitTapHighlightColor:"transparent"},title:"Refresh",children:k.jsx(E_,{size:20,className:he?"animate-spin":""})})]})]})}),k.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:Y?k.jsxs("div",{className:"flex-1 flex flex-col p-4 bg-zinc-50 dark:bg-black/50 min-h-0",children:[k.jsxs("div",{className:"flex gap-2 mb-4 shrink-0",children:[k.jsxs("select",{value:Te,onChange:Ke=>Ze(Ke.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[k.jsx("option",{value:"all",children:"All Types"}),k.jsx("option",{value:"car",children:" Car"}),k.jsx("option",{value:"motorcycle",children:" Motorcycle"}),k.jsx("option",{value:"bicycle",children:" Bicycle"})]}),k.jsxs("select",{value:Bt,onChange:Ke=>Qt(Ke.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[k.jsx("option",{value:"all",children:"All Floors"}),Sn.map(Ke=>k.jsx("option",{value:Ke,children:Ke},Ke))]}),k.jsxs("select",{value:un,onChange:Ke=>nn(Ke.target.value),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 min-w-0 px-2 py-2 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl text-[11px] font-medium text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.5rem_center] pr-6 truncate",children:[k.jsx("option",{value:"all",children:"All Status"}),k.jsx("option",{value:"open",children:" Open"}),k.jsx("option",{value:"occupied",children:" Occupied"}),k.jsx("option",{value:"closed",children:" Closed"})]})]}),k.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:k.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:[lr.map(Ke=>{const je=Et.get(Ke.d),Mt=je?.status==="occupied"?"bg-red-500/10 border-red-500/20 text-red-600 dark:text-red-400":je?.status==="closed"?"bg-zinc-500/10 border-zinc-500/20 text-zinc-600 dark:text-zinc-400":"bg-green-500/10 border-green-500/20 text-green-600 dark:text-green-400";return k.jsxs("button",{onClick:()=>Pe(Ke),className:`p-3 rounded-2xl border ${Mt} text-center active:scale-[0.98] transition-transform relative`,children:[k.jsx("div",{className:"text-3xl mb-1",children:Ke.type==="car"?"":Ke.type==="motorcycle"?"":""}),k.jsx("p",{className:"font-bold text-sm text-zinc-900 dark:text-white",children:Ke.short_name||`#${Ke.spot_number}`}),Ke.floor&&k.jsx("p",{className:"text-xs opacity-60",children:Ke.floor}),k.jsx("p",{className:"mt-1 text-[10px] font-bold uppercase tracking-wider opacity-80",children:je?.status||"Open"})]},Ke.id)}),he&&k.jsx("div",{className:"flex items-center justify-center p-6 bg-zinc-50 dark:bg-white/5 rounded-2xl border-2 border-dashed border-zinc-200 dark:border-white/10 min-h-[100px]",children:k.jsx("div",{className:"animate-spin w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500"})})]})})]}):k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"px-4 py-2 bg-white dark:bg-[#1c1c1e] border-t border-black/5 dark:border-white/10",children:k.jsx("div",{className:"flex justify-between items-center gap-2",children:["public","private","my"].map(Ke=>k.jsx("button",{onClick:()=>H(Ke),className:`flex-1 flex items-center justify-center py-2 text-sm transition-all active:scale-95 ${U===Ke?"text-zinc-900 dark:text-white font-bold border-b-2 border-blue-500":"text-zinc-400 dark:text-white/40"}`,children:Ke==="public"?"Public":Ke==="private"?"Private":"My Listings"},Ke))})}),k.jsx("div",{className:"relative px-4 py-3 bg-white dark:bg-[#1c1c1e] border-b border-black/5 dark:border-white/10 z-[3001]",children:k.jsxs("div",{className:"relative z-[4000]",children:[k.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400 z-10",children:Fe?k.jsx(E_,{size:18,className:"animate-spin"}):k.jsx(s2,{size:18})}),k.jsx("input",{value:ut,onChange:ai,onKeyDown:Ke=>{Ke.key==="Enter"&&Jn()},placeholder:"Search for listings near...",className:`w-full pl-10 pr-10 py-3 bg-zinc-100 dark:bg-zinc-800 text-sm font-medium text-zinc-900 dark:text-white border-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-zinc-400 dark:placeholder:text-zinc-500 ${qe.length>0||$n.length>0||dt.length>0?"rounded-t-xl rounded-b-none":"rounded-xl"}`}),ut&&k.jsx("button",{onClick:()=>{Tt(""),xt([]),Re(""),d&&de(d)},className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-full text-zinc-400 active:text-zinc-600 dark:active:text-zinc-200 z-10",children:k.jsx(vo,{size:16})}),(qe.length>0||$n.length>0||dt.length>0)&&k.jsx("div",{className:"absolute top-full left-0 right-0 bg-white dark:bg-zinc-900 rounded-b-xl shadow-xl border-x border-b border-black/5 dark:border-white/5 overflow-hidden z-[4000] mt-0",children:k.jsxs("div",{className:"max-h-[60vh] overflow-y-auto",children:[k.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-white/5 border-t border-black/5 dark:border-white/5 flex items-center gap-2",children:[dt.length>0&&k.jsx("span",{className:"inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 dark:from-blue-500/20 dark:to-cyan-500/20 text-[10px] font-bold text-blue-600 dark:text-blue-300 uppercase tracking-wider border border-blue-200 dark:border-blue-500/20",children:"Locality"}),qe.length>0&&k.jsx("span",{className:"inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-violet-500/10 to-fuchsia-500/10 dark:from-violet-500/20 dark:to-fuchsia-500/20 text-[10px] font-bold text-violet-600 dark:text-violet-300 uppercase tracking-wider border border-violet-200 dark:border-violet-500/20",children:"OSM Search"}),$n.length>0&&k.jsx("span",{className:"inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-emerald-500/10 to-teal-500/10 dark:from-emerald-500/20 dark:to-teal-500/20 text-[10px] font-bold text-emerald-600 dark:text-emerald-300 uppercase tracking-wider border border-emerald-200 dark:border-emerald-500/20",children:"Saved Places"})]}),dt.map((Ke,je)=>k.jsxs("button",{onClick:()=>{const Mt={place_id:parseInt(Ke.lat.toString().replace(".","")),display_name:Ke.name,lat:Ke.lat.toString(),lon:Ke.lon.toString()};Fn(Mt)},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-blue-50 dark:bg-blue-500/10 text-blue-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 shrink-0 transition-colors",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ke.name}),k.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:"Parking listings nearby"})]})]},`listing-${je}`)),$n.map((Ke,je)=>k.jsxs("button",{onClick:()=>{const Mt={place_id:parseInt(Ke.lat.toString().replace(".","")),display_name:Ke.name,lat:Ke.lat.toString(),lon:Ke.lon.toString()};Fn(Mt)},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 shrink-0 transition-colors",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ke.name}),k.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:"Saved from your routes"})]})]},`saved-${je}`)),qe.map(Ke=>k.jsxs("button",{onClick:()=>Fn(Ke),className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full shrink-0 transition-colors bg-violet-50 dark:bg-violet-500/10 text-violet-500 group-hover:text-violet-600 dark:group-hover:text-violet-400",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Ke.display_name.split(",")[0]}),k.jsx("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate",children:Ke.display_name.split(",").slice(1).join(",")})]})]},Ke.place_id))]})})]})}),k.jsxs("div",{className:"flex items-center justify-between text-[10px] font-bold uppercase tracking-wider text-zinc-500 px-4 py-2 overflow-x-auto shrink-0",children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"Open"]}),U==="my"&&k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),"Occupied"]}),k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("div",{className:"w-2 h-2 rounded-full bg-zinc-400"}),"Closed"]})]})]}),Ei&&U==="my"&&k.jsxs("select",{value:tr,onChange:Ke=>Di(Ke.target.value),className:"pl-2 pr-6 py-1 rounded-full border border-transparent bg-zinc-100 dark:bg-white/5 text-zinc-500 dark:text-zinc-400 text-[10px] font-bold uppercase tracking-wider appearance-none cursor-pointer transition-colors active:bg-zinc-200 dark:active:bg-white/10 outline-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 6px center",backgroundSize:"12px"},children:[k.jsx("option",{value:"all",children:"All"}),k.jsx("option",{value:"my",children:"Mine"}),k.jsx("option",{value:"approved",children:"Approved"}),k.jsx("option",{value:"pending",children:"Pending"})]}),U!=="my"&&k.jsxs("button",{onClick:()=>Rn(!Gn),className:`flex items-center gap-1 px-2 py-1 rounded-full border transition-colors text-[10px] font-bold uppercase tracking-wider ${Gn?"bg-yellow-500/10 border-yellow-500/20 text-yellow-600 dark:text-yellow-400":"bg-zinc-100 dark:bg-white/5 border-transparent text-zinc-500 active:bg-zinc-200 dark:active:bg-white/10"}`,children:[k.jsx(S_,{size:12,className:Gn?"fill-yellow-500 stroke-yellow-500":"fill-transparent stroke-zinc-400"}),Gn?"Saved":"All"]})]}),k.jsx("div",{className:"flex-1 overflow-y-auto pt-2 px-4 pb-4 space-y-3",children:ve?k.jsx("div",{className:"flex justify-center p-8",children:k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"})}):Jt.length===0?k.jsx("div",{className:"text-center py-10 text-zinc-400",children:"No listings found"}):k.jsxs(k.Fragment,{children:[gi.map(Ke=>{const je=ct.get(Ke.d);let Mt=Ke.status==="closed";if(je){const tn=(je.car?.open||0)+(je.motorcycle?.open||0)+(je.bicycle?.open||0),Un=(je.car?.occupied||0)+(je.motorcycle?.occupied||0)+(je.bicycle?.occupied||0);(je.car?.total||0)+(je.motorcycle?.total||0)+(je.bicycle?.total||0)>0&&(Mt=tn+Un===0)}const Yt=je;return k.jsxs("div",{className:`group relative bg-white dark:bg-[#1c1c1e] rounded-2xl p-2.5 border border-black/5 dark:border-white/10 shadow-sm transition-all hover:shadow-md active:scale-[0.99] cursor-pointer ${si===Ke.id?"z-50":""}`,onClick:()=>K(Ke),children:[k.jsxs("div",{className:"flex flex-col items-start gap-1 mb-2",children:[k.jsxs("div",{className:"flex items-center justify-between w-full gap-1.5",children:[k.jsx("div",{className:"min-w-0 flex items-center h-full",children:k.jsx("h3",{className:"font-bold text-zinc-900 dark:text-white text-base leading-tight truncate",children:Ke.listing_name})}),k.jsxs("div",{className:"flex items-center gap-1 h-full",children:[U!=="my"&&k.jsx("button",{onClick:tn=>{tn.stopPropagation(),ge(Ke.id)},className:"p-2 rounded-full active:scale-95 transition-transform flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent"},children:k.jsx(S_,{size:16,className:Oi.has(Ke.id)?"fill-yellow-500 stroke-yellow-500 text-yellow-500":"text-zinc-400"})}),k.jsx("button",{onClick:tn=>{tn.stopPropagation(),an(Ke)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:k.jsx(AT,{size:16})}),U==="my"&&(Ke.owners.includes(P)||Ke.managers.includes(P))?k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:tn=>{tn.stopPropagation(),vt(Ke),we(!0)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:k.jsx(Vd,{size:16})}),k.jsx("button",{onClick:tn=>{tn.stopPropagation(),Nr(Ke)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:k.jsx(np,{size:16})})]}):k.jsxs("div",{className:"relative flex items-center",children:[k.jsx("button",{onClick:tn=>{tn.stopPropagation(),wi(si===Ke.id?null:Ke.id)},style:{WebkitTapHighlightColor:"transparent"},className:"p-1.5 text-zinc-400 flex items-center justify-center",children:k.jsx(z3,{size:16})}),si===Ke.id&&k.jsxs(k.Fragment,{children:[k.jsx("style",{children:`
                                                                            @keyframes menuFadeIn {
                                                                                from { opacity: 0; transform: scale(0.95); }
                                                                                to { opacity: 1; transform: scale(1); }
                                                                            }
                                                                        `}),k.jsxs("div",{className:"absolute right-0 top-8 bg-white dark:bg-zinc-800 border border-black/10 dark:border-white/20 rounded-xl shadow-xl z-50 overflow-hidden min-w-[200px]",style:{animation:"menuFadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards",transformOrigin:"top right"},onClick:tn=>tn.stopPropagation(),children:[Ke.website&&k.jsxs("a",{href:Ke.website.startsWith("http")?Ke.website:`https://${Ke.website}`,target:"_blank",rel:"noopener noreferrer",onClick:tn=>{tn.stopPropagation(),wi(null)},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 border-b border-black/5 dark:border-white/10",children:[k.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:""})," Visit Website"]}),k.jsxs("button",{onClick:tn=>{tn.stopPropagation(),pi(Ke.id,Ke.listing_name)},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2",children:[k.jsx(Sx,{size:16})," Hide this listing"]}),Ke.pubkey&&k.jsxs("button",{onClick:tn=>{tn.stopPropagation(),ur(Ke.pubkey,Ke.listing_name+" (owner)")},className:"w-full px-4 py-3 text-left text-sm text-zinc-700 dark:text-white hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 border-t border-black/5 dark:border-white/10",children:[k.jsx(Ex,{size:16})," Hide all from owner"]})]})]})]})]})]}),k.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[k.jsx("span",{className:`shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider ${Ke.listing_type==="public"?"bg-green-500/10 text-green-600":"bg-purple-500/10 text-purple-600"}`,children:Ke.listing_type}),Mt&&k.jsx("span",{className:"shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider bg-zinc-500/10 text-zinc-500 dark:text-zinc-400",children:"CLOSED"}),(Ke.local_area||Ke.city)&&k.jsx("span",{className:"shrink-0 px-2 py-0.5 rounded-full text-[9px] uppercase tracking-wider bg-blue-500/10 text-blue-500",children:Ke.local_area||Ke.city})]})]}),k.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{type:"car",icon:"",data:Yt?.car,rate:Ke.rates?.car},{type:"motorcycle",icon:"",data:Yt?.motorcycle,rate:Ke.rates?.motorcycle},{type:"bicycle",icon:"",data:Yt?.bicycle,rate:Ke.rates?.bicycle}].map(tn=>{const Un=(tn.data?.total||0)>0,Hn=tn.rate||{hourly:0,currency:"INR"},vn=!!tn.rate||Un;return k.jsxs("div",{className:`bg-zinc-50 dark:bg-white/10 rounded-xl p-2 text-center flex flex-col items-center justify-center min-h-[80px] ${Mt?"opacity-50":""}`,children:[k.jsx("div",{className:"text-3xl mb-1",children:tn.icon}),he?k.jsx("div",{className:"text-xl font-bold text-zinc-300 dark:text-white/20",children:"..."}):Un?k.jsxs("div",{className:"flex flex-col items-center w-full",children:[U==="my"?k.jsxs("div",{className:"font-bold text-sm flex items-center gap-1.5 mb-1.5",children:[k.jsx("span",{className:"text-green-500",children:tn.data?.open||0}),k.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),k.jsx("span",{className:"text-red-500",children:tn.data?.occupied||0}),k.jsx("span",{className:"text-zinc-300 dark:text-white/20",children:"|"}),k.jsx("span",{className:"text-zinc-400",children:tn.data?.closed||0})]}):k.jsx("div",{className:"font-bold text-lg text-green-500 mb-1.5",children:tn.data?.open||0}),vn&&k.jsx("div",{className:"w-full bg-black/5 dark:bg-white/5 rounded-lg py-0.5 px-2",children:k.jsxs("div",{className:"text-zinc-900 dark:text-white font-bold text-sm",children:[Hn.currency==="USD"?"$":Hn.currency==="EUR"?"":Hn.currency==="GBP"?"":"",Hn.hourly,k.jsx("span",{className:"text-[10px] font-normal opacity-60",children:"/hr"})]})})]}):k.jsx("div",{className:"text-xs text-zinc-400 dark:text-white/30 font-medium",children:"Not Available"})]},tn.type)})}),Ei&&Ke.listing_type==="public"&&Ke.pubkey!==zd&&(()=>{const tn=`${Ln.LISTED_PARKING_METADATA}:${Ke.pubkey}:${Ke.d}`,Un=on.has(tn);return k.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5 dark:border-white/5 flex items-center justify-between",onClick:Hn=>Hn.stopPropagation(),children:[k.jsx("span",{className:`text-sm font-semibold ${Un?"text-blue-600 dark:text-blue-400":"text-zinc-500 dark:text-white/50"}`,children:Un?"Approved":"Pending Approval"}),k.jsx("button",{onClick:()=>Ue(Ke),disabled:yr,className:`relative h-7 w-12 rounded-full transition-colors ${Un?"bg-blue-500":"bg-zinc-200 dark:bg-white/10"} ${yr?"opacity-50 cursor-wait":""}`,style:{WebkitTapHighlightColor:"transparent"},children:k.jsx("span",{className:`block h-5 w-5 rounded-full bg-white shadow-sm transition-transform ${Un?"translate-x-[26px]":"translate-x-[4px]"}`})})]})})(),U==="my"&&(Ke.owners.includes(P)||Ke.managers.includes(P))&&k.jsxs("div",{className:"mt-3 pt-3 border-t border-black/5 dark:border-white/5 flex items-center justify-between relative",onClick:tn=>tn.stopPropagation(),children:[k.jsx("span",{className:`text-sm font-semibold ${Mt?"text-zinc-500 dark:text-white/50":"text-green-600 dark:text-green-400"}`,children:Mt?"Listing Closed":"Listing Open"}),k.jsx("button",{onClick:async()=>{const tn=Mt?"open":"closed";if(confirm(tn==="closed"?"This will mark ALL spots as CLOSED. Continue?":"This will mark ALL spots as OPEN. Continue?")){Nn(!0);try{const Hn=`${Ln.LISTED_PARKING_METADATA}:${Ke.pubkey}:${Ke.d}`,vn=Date.now(),ri=await N.querySync(Kn,{kinds:[Ln.PARKING_SPOT_LISTING],"#a":[Hn]}),ni=Date.now()-vn;Kn.forEach(ln=>_o.recordSuccess(ln,ni)),console.log("[Parlens] Kind 37141 toggle query:",ri.length,"spots in",ni,"ms");const Xn={car:{open:0,occupied:0,total:0,closed:0,rate:0},motorcycle:{open:0,occupied:0,total:0,closed:0,rate:0},bicycle:{open:0,occupied:0,total:0,closed:0,rate:0}},Zi=ct.get(Ke.d),Cn=ri.map(async ln=>{const yi=ln.tags.find(Ts=>Ts[0]==="d")?.[1];let Bi=ln.tags.find(Ts=>Ts[0]==="type")?.[1]?.toLowerCase()||"car";["car","motorcycle","bicycle"].includes(Bi)||(Bi="car");const _i=`${Ln.PARKING_SPOT_LISTING}:${ln.pubkey}:${yi}`;Xn[Bi]&&(Xn[Bi].total++,tn==="closed"?Xn[Bi].closed++:Xn[Bi].open++,Zi&&Zi[Bi]&&(Xn[Bi].rate=Zi[Bi].rate));const bi=Ke.rates?.[Bi]?.hourly||Zi?.[Bi]?.rate||0,mi=Ke.rates?.[Bi]?.currency||"USD",[li,Hi]=Ke.location.split(",").map(Ts=>parseFloat(Ts.trim())),Tr=Pl(li,Hi,10),Qn={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["a",_i],["a",Hn,"","root"],["status",tn],["updated_by",P],...Array.from({length:10},(Ts,zi)=>["g",Tr.substring(0,zi+1)]),["location",Ke.location],["type",Bi],["hourly_rate",String(bi)],["currency",mi],["client","parlens"]],content:JSON.stringify({hourly_rate:bi,currency:mi})},es=await h(Qn);return N.publish(Kn,es)});await Promise.allSettled(Cn);const Dn=Ke.originalEvent.tags.filter(ln=>ln[0]!=="status");Dn.push(["status",tn]);const Zt={...Ke.originalEvent,created_at:Math.floor(Date.now()/1e3),tags:Dn},ki=await h(Zt);await Promise.allSettled(N.publish(Kn,ki)),await new Promise(ln=>setTimeout(ln,1500)),await jn(!0)}catch(Hn){console.error("Failed to update status:",Hn),alert("Failed to update status")}finally{Nn(!1)}}},className:`relative h-7 w-12 rounded-full transition-colors ${Mt?"bg-zinc-200 dark:bg-white/10":"bg-green-500"}`,children:k.jsx("span",{className:`block h-5 w-5 rounded-full bg-white shadow-sm transition-transform ${Mt?"translate-x-[4px]":"translate-x-[26px]"}`})})]})]},Ke.id)}),ii<Jt.length&&k.jsx("button",{onClick:()=>En(Ke=>Ke+10),className:"flex items-center justify-center gap-1 w-full py-3 rounded-full border transition-colors text-sm font-bold bg-zinc-100 dark:bg-white/5 border-transparent text-zinc-500 active:bg-zinc-200 dark:active:bg-white/10",children:"Load More"})]})})]})}),_e&&k.jsx(U4,{editing:ht,currentLocation:d,countryCode:y,onPickLocation:C,pickedLocation:D,onClose:()=>{we(!1),vt(null)},onCreated:()=>{we(!1),vt(null),jn()}}),_t&&Y&&k.jsx(V4,{spot:_t,listing:Je.find(Ke=>Ke.d===_t.a.split(":")[2]),status:Et.get(_t.d),isManager:Je.find(Ke=>Ke.d===_t.a.split(":")[2]).owners.includes(P||"")||Je.find(Ke=>Ke.d===_t.a.split(":")[2]).managers.includes(P||""),listingStats:ct,setListingStats:kt,setSpotStatuses:rt,onSpotUpdate:()=>jn(!0),onClose:()=>Pe(null)}),bt&&k.jsx(G4,{listing:bt,onClose:()=>an(null)})]})},U4=({editing:c,onClose:d,onCreated:y,currentLocation:C,countryCode:D,onPickLocation:P,pickedLocation:N})=>{const{pubkey:h,signEvent:U,pool:H}=nh(),[Y,K]=me.useState(1),[_e,we]=me.useState(!1),[ve,pe]=me.useState(!1),he=me.useMemo(()=>c?.floor_plan?c.floor_plan:[],[c]),[De,Je]=me.useState({listing_name:c?.listing_name||"",website:c?.website||"",location:c?.location||"",local_area:c?.local_area||"",city:c?.city||"",zipcode:c?.zipcode||"",country:c?.country||"",listing_type:c?.listing_type||"public",qr_type:c?.qr_type||"static",owners:c?.owners?.join(", ")||"",managers:c?.managers?.join(", ")||"",members:c?.members?.join(", ")||"",relays:c?.relays?.join(", ")||"",currency:"USD"}),[Xe,mt]=me.useState(he),[Wt,Et]=me.useState({name:"",counts:{car:0,motorcycle:0,bicycle:0},rates:{car:0,motorcycle:0,bicycle:0}});me.useEffect(()=>{if(!c&&D){const Pe={US:"USD",GB:"GBP",EU:"EUR",IN:"INR"};Je(ht=>({...ht,currency:Pe[D]||"USD"}))}else c?.rates?.car?.currency&&Je(Pe=>({...Pe,currency:c.rates.car.currency}))},[D,c]),me.useEffect(()=>{N&&(Je(Pe=>({...Pe,location:`${N.lat.toFixed(6)}, ${N.lon.toFixed(6)} `})),d2(N.lat,N.lon).then(Pe=>{Pe&&Pe!==De.currency&&Je(ht=>({...ht,currency:Pe}))}))},[N]),me.useEffect(()=>{const Pe=document.getElementById("create-listing-content");Pe&&Pe.scrollTo({top:0,behavior:"smooth"})},[Y]),me.useEffect(()=>{const Pe=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=Pe}},[]);const rt=Pe=>{if(!Pe)return null;const ht=Pe.split(",").map(vt=>vt.trim()).filter(Boolean);return ht.length===0?null:k.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ht.map((vt,qt)=>k.jsx("span",{className:"px-2 py-1 bg-zinc-200 dark:bg-white/10 rounded-lg text-[10px] font-mono text-zinc-600 dark:text-zinc-400 flex items-center gap-1 max-w-full",children:k.jsx("span",{className:"truncate max-w-[150px]",children:vt})},qt))})},at=()=>{Wt.name&&(mt([...Xe,{...Wt,id:crypto.randomUUID()}]),Et(Pe=>({...Pe,name:"",counts:{car:0,motorcycle:0,bicycle:0}})))},He=Pe=>{mt(Xe.filter((ht,vt)=>vt!==Pe))},_t=async()=>{if(!De.listing_name)return;let Pe=[...Xe];if(Wt.name&&(Wt.counts.car>0||Wt.counts.motorcycle>0||Wt.counts.bicycle>0)&&ve&&(console.log("[Parlens] Auto-adding pending floor from open form:",Wt.name),Pe.push({...Wt,id:crypto.randomUUID()})),Pe.length===0){alert("Please add at least one floor with parking spots.");return}let ht="";if(De.location){const[ut,Tt]=De.location.split(",").map(sn=>parseFloat(sn.trim()));!isNaN(ut)&&!isNaN(Tt)&&(ht=Pl(ut,Tt,10))}const vt=(c?.d||crypto.randomUUID()).trim();console.log("[Parlens] Submitting Listing ID:",vt);const qt=ut=>ut.split(",").map(Tt=>Tt.trim()).filter(Boolean).map(Tt=>{if(Tt.startsWith("npub"))try{const{data:sn}=L4(Tt);return sn}catch{return console.error("Invalid npub:",Tt),Tt}return Tt});let ke=0;const Te={};Pe.forEach(ut=>{ke+=(ut.counts.car||0)+(ut.counts.motorcycle||0)+(ut.counts.bicycle||0),!Te.car&&ut.rates.car!==void 0&&(Te.car={hourly:ut.rates.car||0,currency:De.currency}),!Te.motorcycle&&ut.rates.motorcycle!==void 0&&(Te.motorcycle={hourly:ut.rates.motorcycle||0,currency:De.currency}),!Te.bicycle&&ut.rates.bicycle!==void 0&&(Te.bicycle={hourly:ut.rates.bicycle||0,currency:De.currency})});const Ze={kind:Ln.LISTED_PARKING_METADATA,created_at:Math.floor(Date.now()/1e3),tags:[["d",vt],["listing_name",De.listing_name.slice(0,25)],["location",De.location],["g",ht],...Array.from({length:Math.min(ht.length,10)},(ut,Tt)=>["g",ht.substring(0,Tt+1)]).filter(ut=>ut[1].length<ht.length),["local_area",De.local_area||""],["city",De.city||""],["zipcode",De.zipcode||""],["country",De.country||""],["floors",Pe.map(ut=>ut.name).join(", ")],["floor_plan",JSON.stringify(Pe)],["total_spots",String(ke+(c&&!c.floor_plan&&c.total_spots||0))],["rates",JSON.stringify(Te)],["listing_type",De.listing_type],["qr_type",De.qr_type],["client","parlens"],...De.website?[["r",De.website]]:[],...qt(De.owners).map(ut=>["p",ut,"admin"]),...qt(De.managers).map(ut=>["p",ut,"write"]),...qt(De.members).map(ut=>["p",ut,"read"]),...qt(De.relays).map(ut=>["relay",ut])],content:""};Ze.tags.find(ut=>ut[0]==="p"&&ut[1]===h&&ut[2]==="admin")||Ze.tags.push(["p",h,"admin"]),we(!0);try{if(await Promise.allSettled(H.publish(Kn,await U(Ze))),!c){console.log("[Parlens] Creating spots for floors:",Pe.length);let ut=1;for(const Tt of Pe)for(const[sn,Re]of Object.entries(Tt.counts)){console.log(`[Parlens] Floor ${Tt.name} Type ${sn} Count ${Re}`);for(let ct=0;ct<Re;ct++){const kt=`${vt}-spot-${ut}`,bt=`${Ln.LISTED_PARKING_METADATA}:${h}:${vt}`,an={kind:Ln.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:[["d",kt],["a",bt],["spot_number",String(ut)],["floor",Tt.name],["type",sn],["location",De.location],["g",ht],["client","parlens"]],content:`${De.listing_name} #${ut}`};await Promise.allSettled(H.publish(Kn,await U(an)));try{const Bt=`${Ln.PARKING_SPOT_LISTING}:${h}:${kt}`,[Qt,un]=De.location.split(",").map(En=>parseFloat(En.trim())),nn=Te[sn]?.hourly||0,kn=Te[sn]?.currency||De.currency,Nn=Pl(Qt,un,10),ii={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["a",Bt],["a",bt,"","root"],["status","open"],["updated_by",h],...Array.from({length:10},(En,si)=>["g",Nn.substring(0,si+1)]),["location",De.location],["type",sn],["hourly_rate",String(nn)],["currency",kn],["listing_name",De.listing_name],["client","parlens"]],content:JSON.stringify({hourly_rate:nn,currency:kn})};await Promise.allSettled(H.publish(Kn,await U(ii)))}catch(Bt){console.warn("[Parlens] Failed to publish initial status for spot:",kt,Bt)}ut++}}}y()}catch(ut){console.error("Failed to save listing:",ut),alert("Failed to save listing. Please try again.")}finally{we(!1)}};return k.jsx("div",{className:"fixed inset-0 z-[4000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:k.jsxs("div",{id:"create-listing-content",className:"w-full max-w-lg bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 shadow-2xl overflow-y-auto max-h-[90vh]",children:[_e&&k.jsxs("div",{className:"absolute inset-0 z-50 bg-white/50 dark:bg-black/50 backdrop-blur-[2px] flex flex-col items-center justify-center rounded-3xl",children:[k.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),k.jsx("div",{className:"text-zinc-900 dark:text-white font-bold animate-pulse",children:"Saving Listing..."})]}),k.jsxs("div",{className:"flex justify-between items-center mb-6",children:[k.jsx("h2",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:c?"Edit Listing":"Create Listing"}),k.jsx("button",{onClick:d,children:k.jsx(vo,{className:"text-zinc-500 dark:text-white"})})]}),Y===1?k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Listing Name (25 chars max)"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",value:De.listing_name,maxLength:25,onChange:Pe=>Je({...De,listing_name:Pe.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Business Website"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"https://example.com",value:De.website,onChange:Pe=>Je({...De,website:Pe.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Location"}),k.jsxs("div",{className:"flex gap-2",children:[k.jsx("input",{className:"flex-1 min-w-0 p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"lat, lon",value:De.location,onChange:Pe=>Je({...De,location:Pe.target.value})}),k.jsx("button",{onClick:C?()=>Je({...De,location:`${C[0].toFixed(6)}, ${C[1].toFixed(6)}`}):void 0,className:"shrink-0 p-3 bg-blue-500/10 text-blue-500 rounded-xl",children:k.jsx(H3,{size:20})}),P&&k.jsx("button",{onClick:P,className:"shrink-0 p-3 bg-orange-500/10 text-orange-600 dark:text-orange-400 border border-orange-500/20 rounded-xl",children:k.jsx(eo,{size:20})})]})]}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Local Area"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. Indiranagar",value:De.local_area,onChange:Pe=>Je({...De,local_area:Pe.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"City"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. Bangalore",value:De.city,onChange:Pe=>Je({...De,city:Pe.target.value})})]})]}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Zipcode"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. 560038",value:De.zipcode,onChange:Pe=>Je({...De,zipcode:Pe.target.value})})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Country"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"e.g. India",value:De.country,onChange:Pe=>Je({...De,country:Pe.target.value})})]})]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Access Type"}),k.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[k.jsx("button",{onClick:()=>Je({...De,listing_type:"public"}),className:`p-3 rounded-xl font-bold transition-colors ${De.listing_type==="public"?"bg-green-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white"}`,children:"Public"}),k.jsx("button",{onClick:()=>Je({...De,listing_type:"private"}),className:`p-3 rounded-xl font-bold transition-colors ${De.listing_type==="private"?"bg-purple-500 text-white":"bg-zinc-100 text-zinc-600 dark:bg-white/5 dark:text-white"}`,children:"Private"})]})]}),k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl space-y-2",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400",children:"QR Code Type"}),k.jsxs("div",{className:"flex gap-4",children:[k.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[k.jsx("input",{type:"radio",checked:De.qr_type==="static",onChange:()=>Je({...De,qr_type:"static"})})," Static (Standard)"]}),k.jsxs("label",{className:"flex items-center gap-2 text-zinc-900 dark:text-white font-medium text-sm",children:[k.jsx("input",{type:"radio",checked:De.qr_type==="dynamic",onChange:()=>Je({...De,qr_type:"dynamic"})})," Dynamic (Rotating)"]})]})]}),De.listing_type==="private"&&k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Members"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys (comma separated)",value:De.members,onChange:Pe=>Je({...De,members:Pe.target.value})}),rt(De.members)]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Relays"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"URLs (comma separated)",value:De.relays,onChange:Pe=>Je({...De,relays:Pe.target.value})})]})]}),k.jsxs("div",{className:"space-y-2",children:[k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Owners"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Additional Pubkeys",value:De.owners,onChange:Pe=>Je({...De,owners:Pe.target.value})}),rt(De.owners)]}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Managers"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400",placeholder:"Pubkeys",value:De.managers,onChange:Pe=>Je({...De,managers:Pe.target.value})}),rt(De.managers)]})]}),k.jsxs("button",{onClick:()=>K(2),className:"w-full py-3 bg-[#007AFF] text-white rounded-xl font-bold flex items-center justify-center gap-2",children:["Next ",k.jsx(tp,{size:16})]})]}):k.jsxs("div",{className:"space-y-6",children:[k.jsxs("div",{className:"flex justify-between items-center",children:[k.jsx("h3",{className:"font-bold dark:text-white",children:"Floors & Spots"}),k.jsxs("select",{className:"pl-3 pr-8 py-2 bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 rounded-xl text-zinc-900 dark:text-white text-sm font-medium appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 bg-[url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Cpath%20fill%3D%22%23888%22%20d%3D%22M2%204l4%204%204-4z%22%2F%3E%3C%2Fsvg%3E')] bg-no-repeat bg-[right_0.75rem_center]",value:De.currency,onChange:Pe=>Je({...De,currency:Pe.target.value}),children:[k.jsx("option",{value:"USD",children:"USD ($)"}),k.jsx("option",{value:"EUR",children:"EUR ()"}),k.jsx("option",{value:"GBP",children:"GBP ()"}),k.jsx("option",{value:"INR",children:"INR ()"}),k.jsx("option",{value:"JPY",children:"JPY ()"}),k.jsx("option",{value:"CAD",children:"CAD (C$)"}),k.jsx("option",{value:"AUD",children:"AUD (A$)"}),k.jsx("option",{value:"CNY",children:"CNY ()"}),k.jsx("option",{value:"AED",children:"AED (.)"}),k.jsx("option",{value:"SGD",children:"SGD (S$)"}),k.jsx("option",{value:"CHF",children:"CHF (Fr)"}),k.jsx("option",{value:"HKD",children:"HKD (HK$)"}),k.jsx("option",{value:"SEK",children:"SEK (kr)"}),k.jsx("option",{value:"NOK",children:"NOK (kr)"}),k.jsx("option",{value:"DKK",children:"DKK (kr)"}),k.jsx("option",{value:"NZD",children:"NZD (NZ$)"}),k.jsx("option",{value:"MXN",children:"MXN ($)"}),k.jsx("option",{value:"BRL",children:"BRL (R$)"}),k.jsx("option",{value:"ZAR",children:"ZAR (R)"}),k.jsx("option",{value:"KRW",children:"KRW ()"}),k.jsx("option",{value:"THB",children:"THB ()"}),k.jsx("option",{value:"MYR",children:"MYR (RM)"}),k.jsx("option",{value:"PHP",children:"PHP ()"}),k.jsx("option",{value:"IDR",children:"IDR (Rp)"}),k.jsx("option",{value:"VND",children:"VND ()"}),k.jsx("option",{value:"RUB",children:"RUB ()"}),k.jsx("option",{value:"PLN",children:"PLN (z)"}),k.jsx("option",{value:"TRY",children:"TRY ()"}),k.jsx("option",{value:"SAR",children:"SAR ()"}),k.jsx("option",{value:"EGP",children:"EGP (E)"})]})]}),k.jsx("div",{className:"space-y-3",children:Xe.map((Pe,ht)=>k.jsxs("div",{className:"p-3 bg-zinc-50 dark:bg-white/5 rounded-xl flex justify-between items-center group touch-none",children:[k.jsxs("div",{className:"flex-1 min-w-0 mr-2",onClick:()=>{if(ve){alert("Please save or cancel current floor edit first");return}He(ht),Et(Pe),pe(!0)},children:[k.jsx("div",{className:"font-bold dark:text-white truncate",children:Pe.name}),k.jsxs("div",{className:"text-xs text-zinc-500 truncate",children:[Pe.counts.car>0&&` ${Pe.counts.car} `,Pe.counts.motorcycle>0&&` ${Pe.counts.motorcycle} `,Pe.counts.bicycle>0&&` ${Pe.counts.bicycle} `]})]}),k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("button",{onClick:()=>{if(ve){alert("Finish current floor first");return}He(ht),Et(Pe),pe(!0)},className:"p-2 text-zinc-400 hover:text-blue-500 transition-colors",children:k.jsx(Vd,{size:18})}),k.jsx("button",{onClick:()=>He(ht),style:{WebkitTapHighlightColor:"transparent"},className:"p-2 text-zinc-400",children:k.jsx(np,{size:18})})]})]},ht))}),ve?k.jsxs("div",{className:"p-4 border border-blue-500/30 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl space-y-4",children:[k.jsx("h4",{className:"font-bold text-sm dark:text-white",children:"New Floor Details"}),k.jsxs("div",{className:"space-y-1",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400 ml-1",children:"Floor Name"}),k.jsx("input",{className:"w-full p-2 bg-white dark:bg-white/5 rounded-lg text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"e.g. B1, Ground",value:Wt.name,onChange:Pe=>Et({...Wt,name:Pe.target.value})})]}),["car","motorcycle","bicycle"].map(Pe=>k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("span",{className:"text-2xl w-8",children:Pe==="car"?"":Pe==="motorcycle"?"":""}),k.jsxs("div",{className:"flex-1",children:[k.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Spots"}),k.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Wt.counts[Pe]||"",onChange:ht=>Et(vt=>({...vt,counts:{...vt.counts,[Pe]:parseInt(ht.target.value)||0}}))})]}),k.jsxs("div",{className:"flex-1",children:[k.jsx("label",{className:"text-[10px] font-bold uppercase text-zinc-400",children:"Rate"}),k.jsx("input",{type:"number",className:"w-full p-1 bg-white dark:bg-white/5 rounded text-zinc-900 dark:text-white border border-zinc-200 dark:border-white/10",placeholder:"0",value:Wt.rates[Pe]||"",onChange:ht=>Et(vt=>({...vt,rates:{...vt.rates,[Pe]:parseFloat(ht.target.value)||0}}))})]})]},Pe)),k.jsxs("div",{className:"flex gap-2",children:[k.jsx("button",{onClick:()=>pe(!1),className:"flex-1 py-2 bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300 rounded-xl font-bold text-sm",children:"Cancel"}),k.jsx("button",{onClick:()=>{at(),pe(!1)},className:"flex-1 py-2 bg-blue-500 text-white rounded-xl font-bold text-sm",children:"Save Floor"})]})]}):k.jsx("button",{onClick:()=>pe(!0),className:"w-full py-4 border-2 border-dashed border-zinc-200 dark:border-white/10 rounded-2xl text-zinc-400 font-bold hover:bg-zinc-50 dark:hover:bg-white/5 transition-colors",children:"+ Add Floor"}),k.jsxs("div",{className:"flex gap-2 pt-2",children:[k.jsx("button",{onClick:()=>K(1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Back"}),k.jsx("button",{onClick:_t,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save Listing"})]})]})]})})},V4=({spot:c,listing:d,status:y,onClose:C,isManager:D,listingStats:P,setListingStats:N,setSpotStatuses:h,onSpotUpdate:U,...H})=>{const{pubkey:Y,signEvent:K,pool:_e}=nh(),we=Y===zd,ve=`${Ln.PARKING_SPOT_LISTING}:${c.pubkey}:${c.d}`,pe=d.location?d.location.split(",").map(bt=>parseFloat(bt.trim())):void 0,he=`${Ln.LISTED_PARKING_METADATA}:${d.pubkey}:${d.d}`,De=JSON.stringify({a:ve,listingATag:he,authorizer:d.owners?.[0]||Y,auth:`static - ${c.d}`,listingName:d.listing_name,floor:c.floor||"",spotNumber:c.spot_number,shortName:c.short_name,listingLocation:pe,spotType:c.type||"car",hourlyRate:c.rates?.hourly||d.rates?.[c.type]?.hourly||0,currency:c.rates?.currency||d.rates?.[c.type]?.currency||d.rates?.car?.currency||"INR"}),[Je,Xe]=me.useState(!1),[mt,Wt]=me.useState(!1),[Et,rt]=me.useState({short_name:c.short_name||"",type:c.type,rate:c.rates?.hourly||0}),[at,He]=me.useState([]),[_t,Pe]=me.useState(new Map),[ht,vt]=me.useState(!0),[qt,ke]=me.useState(""),[Te,Ze]=me.useState(!1),[ut,Tt]=me.useState(!1),sn=me.useCallback(async()=>{if(_e){vt(!0);try{const bt=await _e.querySync(Kn,{kinds:[Ln.LISTED_SPOT_LOG,Ln.PRIVATE_LOG_NOTE],"#a":[ve],limit:50}),an=bt.filter(un=>un.kind===Ln.LISTED_SPOT_LOG).sort((un,nn)=>nn.created_at-un.created_at),Bt=bt.filter(un=>un.kind===Ln.PRIVATE_LOG_NOTE),Qt=new Map;Bt.forEach(un=>{const nn=un.tags.find(kn=>kn[0]==="e")?.[1];if(nn){const kn=Qt.get(nn)||[];kn.push(un),Qt.set(nn,kn)}}),He(an),Pe(Qt)}catch(bt){console.error("Failed to fetch spot history:",bt)}finally{vt(!1)}}},[_e,ve]);me.useEffect(()=>{(D||we)&&sn()},[sn,D,we]);const Re=async bt=>{Tt(!0);try{const an=JSON.stringify({status:bt,hourly_rate:c.rates?.hourly||0,currency:c.rates?.currency||"USD",type:c.type||"car",updated_at:Math.floor(Date.now()/1e3)}),Bt=`${Ln.LISTED_PARKING_METADATA}:${d.pubkey}:${d.d}`,Qt=[["a",ve],["a",Bt,"","root"],["status",bt],["updated_by",Y],["client","parlens"]];if(d.location){Qt.push(["location",d.location]);const[kn,Nn]=d.location.split(",").map(Number),ii=Pl(kn,Nn,10);for(let En=1;En<=10;En++)Qt.push(["g",ii.substring(0,En)])}c.type&&Qt.push(["type",c.type]),Qt.push(["hourly_rate",String(c.rates?.hourly||0)]),Qt.push(["currency",c.rates?.currency||"USD"]),Kn.forEach(kn=>Qt.push(["r",kn]));const un={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:Qt,content:an},nn=await K(un);await Promise.allSettled(_e.publish(Kn,nn)),await new Promise(kn=>setTimeout(kn,1500)),await sn(),H.onSpotUpdate&&H.onSpotUpdate()}catch(an){console.error("Failed to update spot:",an),alert("Failed to update status")}finally{Tt(!1)}},ct=async(bt,an)=>{const Bt=an||qt;if(!Bt.trim())return;const Qt=bt||at[0]?.id;if(!Qt){alert("No activity log found to attach note to.");return}const un={kind:Ln.PRIVATE_LOG_NOTE,created_at:Math.floor(Date.now()/1e3),tags:[["e",Qt],["a",ve],["a",he],["p",Y],["client","parlens"]],content:Bt};try{const nn=await K(un);await Promise.allSettled(_e.publish(Kn,nn)),an||ke(""),Pe(kn=>{const Nn=new Map(kn),ii=Nn.get(Qt)||[];return Nn.set(Qt,[...ii,nn]),Nn})}catch{alert("Failed to add note")}},kt=async()=>{const bt=[["d",c.d],["a",c.a],["spot_number",c.spot_number],["floor",c.floor||""],["type",Et.type],["short_name",Et.short_name],["location",c.location],["g",c.g],["client","parlens"]];Et.rate;const an={kind:Ln.PARKING_SPOT_LISTING,created_at:Math.floor(Date.now()/1e3),tags:bt,content:Et.short_name||`${d.listing_name} #${c.spot_number} `};await Promise.allSettled(_e.publish(Kn,await K(an))),Wt(!1)};return mt?k.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:C,children:k.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative",onClick:bt=>bt.stopPropagation(),children:[k.jsx("button",{onClick:()=>Wt(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:k.jsx(vo,{size:20})}),k.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Edit Spot"}),k.jsxs("div",{className:"space-y-2 text-left",children:[k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Name / Short Code"}),k.jsx("input",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white",value:Et.short_name,onChange:bt=>rt({...Et,short_name:bt.target.value}),placeholder:`#${c.spot_number} `}),k.jsx("label",{className:"text-xs font-bold uppercase text-zinc-400",children:"Type"}),k.jsxs("select",{className:"w-full p-3 bg-zinc-100 dark:bg-white/5 rounded-xl dark:text-white",value:Et.type,onChange:bt=>rt({...Et,type:bt.target.value}),children:[k.jsx("option",{value:"car",children:" Car"}),k.jsx("option",{value:"motorcycle",children:" Motorcycle"}),k.jsx("option",{value:"bicycle",children:" Bicycle"})]})]}),k.jsxs("div",{className:"flex gap-2",children:[k.jsx("button",{onClick:()=>Wt(!1),className:"flex-1 py-3 bg-zinc-200 dark:bg-white/10 text-zinc-800 dark:text-white rounded-xl font-bold",children:"Cancel"}),k.jsx("button",{onClick:kt,className:"flex-1 py-3 bg-[#007AFF] text-white rounded-xl font-bold",children:"Save"})]})]})}):k.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 flex items-center justify-center p-4 text-center",onClick:C,children:k.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-4 relative max-h-[85vh] overflow-y-auto min-h-[400px]",onClick:bt=>bt.stopPropagation(),children:[ut&&k.jsxs("div",{className:"fixed inset-0 z-[6000] flex items-center justify-center bg-black/60 backdrop-blur-sm flex-col animate-in fade-in duration-200",children:[k.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-white/20 border-t-white rounded-full"}),k.jsx("div",{className:"text-white font-bold mt-4 animate-pulse",children:"Updating Status..."})]}),Te?k.jsxs("div",{className:"flex flex-col h-full space-y-4 animate-in fade-in slide-in-from-right-4",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("button",{onClick:()=>Ze(!1),className:"p-2 -ml-2 rounded-full text-zinc-600 dark:text-white hover:bg-black/5 dark:hover:bg-white/10",children:k.jsx(Ax,{size:24})}),k.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Status Log"}),k.jsx("div",{className:"w-10"})," "]}),k.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 min-h-[300px]",children:ht?k.jsx("div",{className:"text-center text-zinc-400 py-8",children:"Loading logs..."}):at.length===0?k.jsxs("div",{className:"text-center text-zinc-400 py-8 flex flex-col items-center gap-2",children:[k.jsx("div",{className:"text-4xl opacity-20",children:""}),k.jsx("p",{children:"No activity yet"})]}):at.map((bt,an)=>{const Bt=bt.tags?.find(Nn=>Nn[0]==="status")?.[1],Qt=bt.tags?.find(Nn=>Nn[0]==="updated_by")?.[1],un=bt.tags?.find(Nn=>Nn[0]==="authorizer")?.[1],nn=new Date(bt.created_at*1e3),kn=_t.get(bt.id)||[];return k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left border border-black/5 dark:border-white/5",children:[k.jsxs("div",{className:"flex items-center justify-between mb-2",children:[k.jsxs("div",{className:`font - bold capitalize flex items - center gap - 2 ${Bt==="open"?"text-green-500":Bt==="occupied"?"text-red-500":"text-zinc-500"} `,children:[k.jsx("div",{className:`w - 2 h - 2 rounded - full ${Bt==="open"?"bg-green-500":Bt==="occupied"?"bg-red-500":"bg-zinc-500"} `}),Bt||"unknown"]}),k.jsxs("div",{className:"text-xs text-zinc-400 font-medium tabular-nums",children:[nn.toLocaleDateString(void 0,{month:"short",day:"numeric"}),"  ",nn.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})]})]}),k.jsxs("div",{className:"text-xs text-zinc-500 dark:text-white/40 flex flex-col gap-1",children:[k.jsxs("div",{children:["By: ",Qt?Qt===Y?"You":`${Qt.slice(0,8)}...`:"Unknown"]}),un&&k.jsxs("div",{children:["Auth: ",un.slice(0,8),"..."]})]}),D&&k.jsxs(k.Fragment,{children:[k.jsxs("div",{className:"mt-2 flex gap-2",children:[k.jsx("input",{id:`note-input-${bt.id}`,placeholder:"Add a note",className:"flex-1 p-2.5 bg-white dark:bg-white/10 rounded-xl text-sm text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-zinc-400",onKeyDown:Nn=>{Nn.key==="Enter"&&Nn.target.value.trim()&&(ct(bt.id,Nn.target.value),Nn.target.value="")}}),k.jsx("button",{onClick:()=>{const Nn=document.getElementById(`note-input-${bt.id}`);Nn&&Nn.value.trim()&&(ct(bt.id,Nn.value),Nn.value="")},className:"p-2.5 bg-[#007AFF] text-white rounded-xl",children:k.jsx(s1,{size:20})})]}),kn.length>0&&k.jsx("div",{className:"mt-3 space-y-2 pt-3 border-t border-black/5 dark:border-white/5",children:kn.map(Nn=>k.jsx("div",{className:"text-xs bg-yellow-50 dark:bg-yellow-900/10 p-2 rounded-lg text-zinc-700 dark:text-yellow-100/80",children:Nn.content},Nn.id))})]})]},bt.id||an)})})]}):k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:C,className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:k.jsx(vo,{size:20})}),k.jsx("h2",{className:"text-xl font-bold dark:text-white pr-8 text-left",children:c.short_name||c.content}),D&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"p-4 rounded-3xl flex justify-center",children:k.jsx(k1,{value:De,size:180,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-black dark:text-white"})}),k.jsxs("div",{onClick:()=>{navigator.clipboard.writeText(De),Xe(!0),setTimeout(()=>Xe(!1),2e3)},className:"flex justify-center items-center gap-2 text-[#007AFF] font-bold cursor-pointer py-2 hover:opacity-80 transition-opacity",children:[Je?k.jsx(Jf,{size:18}):k.jsx(n2,{size:18})," ",Je?"Copied":"Copy Auth Code"]})]}),k.jsxs("div",{className:"grid grid-cols-2 gap-3 text-left",children:[k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Rate"}),k.jsxs("div",{className:"text-lg font-bold dark:text-white tabular-nums",children:[c.rates?.currency||d.rates?.car?.currency||"$",c.rates?.hourly||d.rates?.[c.type]?.hourly,"/hr"]})]}),k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Status"}),(()=>{const bt=at.length>0?at[0]:null,an=bt?.tags.find(un=>un[0]==="status")?.[1];let Bt;if(bt&&y?Bt=bt.created_at>=y.created_at?an:y.status:Bt=an||y?.status,!Bt&&ht)return k.jsx("div",{className:"text-lg font-bold text-zinc-400 animate-pulse",children:"..."});const Qt=Bt||"open";return k.jsx("div",{className:`text-lg font-bold capitalize ${Qt==="occupied"?"text-red-500":Qt==="closed"?"text-zinc-500":"text-green-500"}`,children:Qt})})()]})]}),D&&k.jsxs("div",{className:"p-4 bg-zinc-50 dark:bg-white/5 rounded-2xl text-left space-y-2",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 mb-1",children:"Latest Note"}),(()=>{let bt=null,an=0;return _t.forEach(Bt=>{Bt.forEach(Qt=>{Qt.created_at>an&&(bt=Qt,an=Qt.created_at)})}),bt?k.jsxs("div",{className:"text-sm dark:text-white italic",children:['"',bt.content,'" ',k.jsxs("span",{className:"text-xs text-zinc-400 not-italic",children:["- ",new Date(bt.created_at*1e3).toLocaleDateString()]})]}):k.jsx("div",{className:"text-sm text-zinc-400 italic",children:"No notes added yet"})})(),k.jsxs("div",{className:"flex gap-2 pt-2",children:[k.jsx("input",{value:qt,onChange:bt=>ke(bt.target.value),placeholder:"Add a note",className:"flex-1 p-2.5 bg-white dark:bg-white/10 rounded-xl text-sm text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder:text-zinc-400",onKeyDown:bt=>{bt.key==="Enter"&&ct()}}),k.jsx("button",{onClick:()=>ct(),disabled:!qt.trim(),className:"p-2.5 bg-[#007AFF] text-white rounded-xl disabled:opacity-50",children:k.jsx(s1,{size:20})})]})]}),(D||we)&&k.jsxs("div",{className:"space-y-4 pt-2",children:[D&&k.jsxs("div",{className:"flex gap-2",children:[k.jsx("button",{onClick:()=>Re("open"),className:"flex-1 py-3 bg-green-500/10 border border-green-500/20 text-green-600 dark:text-green-400 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Open"}),k.jsx("button",{onClick:()=>Re("occupied"),className:"flex-1 py-3 bg-red-500/10 border border-red-500/20 text-red-500 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Occupied"}),k.jsx("button",{onClick:()=>Re("closed"),className:"flex-1 py-3 bg-zinc-500/10 border border-zinc-500/20 text-zinc-500 dark:text-zinc-400 font-bold text-sm rounded-xl active:scale-95 transition-all",children:"Closed"})]}),k.jsxs("button",{onClick:()=>Ze(!0),className:"w-full py-4 bg-blue-500/10 border border-blue-500/20 text-[#007AFF] font-bold rounded-2xl flex items-center justify-center gap-2 active:scale-[0.98] transition-transform",children:["View Status Log ",k.jsx(tp,{size:18})]}),D&&k.jsxs("div",{className:"flex gap-3 pt-2 border-t border-black/5 dark:border-white/5",children:[k.jsxs("button",{onClick:()=>Wt(!0),style:{WebkitTapHighlightColor:"transparent"},className:"flex-1 py-3 bg-zinc-100 dark:bg-white/10 border border-zinc-200 dark:border-white/10 text-zinc-600 dark:text-zinc-300 font-bold text-sm flex items-center justify-center gap-2 rounded-xl transition-transform active:scale-95",children:[k.jsx(Vd,{size:16})," Edit"]}),k.jsxs("button",{onClick:async()=>{if(confirm("Delete this spot?"))try{const bt={kind:5,pubkey:Y,created_at:Math.floor(Date.now()/1e3),tags:[["e",c.id]],content:"deleted"};await Promise.allSettled(_e.publish(Kn,await K(bt))),C()}catch{alert("Failed to delete")}},style:{WebkitTapHighlightColor:"transparent"},className:"mt-0 p-3 bg-red-500/10 border border-red-500/20 text-red-500 rounded-xl active:scale-95 transition-transform flex items-center justify-center",children:[k.jsx(np,{size:20})," ",k.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})]})]})]})})},G4=({listing:c,onClose:d})=>{const y=(C,D)=>!D||D.length===0?null:k.jsxs("div",{className:"space-y-2",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:C}),k.jsx("div",{className:"space-y-1",children:D.map(P=>k.jsxs("div",{className:"flex items-center justify-between p-3 bg-zinc-50 dark:bg-white/5 rounded-xl",children:[k.jsx("div",{className:"flex flex-col overflow-hidden",children:P.startsWith("npub")?k.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:P}):k.jsx("div",{className:"text-xs font-mono truncate max-w-[200px] text-zinc-600 dark:text-zinc-300",children:(()=>{try{return H_(P)}catch{return P}})()})}),k.jsx("button",{onClick:()=>{const N=P.startsWith("npub")?P:(()=>{try{return H_(P)}catch{return P}})();navigator.clipboard.writeText(N),alert("Copied")},className:"p-2 text-blue-500 bg-blue-500/10 rounded-full hover:bg-blue-500/20 active:scale-95 transition-all",children:k.jsx(n2,{size:16})})]},P))})]});return k.jsx("div",{className:"fixed inset-0 z-[5000] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in",onClick:d,children:k.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] rounded-3xl p-6 w-full max-w-sm space-y-6 relative border border-black/5 dark:border-white/10 shadow-2xl",onClick:C=>C.stopPropagation(),children:[k.jsxs("div",{className:"flex justify-between items-center",children:[k.jsx("h2",{className:"text-xl font-bold dark:text-white",children:"Access List"}),k.jsx("button",{onClick:d,children:k.jsx(vo,{className:"text-zinc-400 hover:text-zinc-600 dark:hover:text-white"})})]}),k.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:[y("Owners",c.owners),y("Managers",c.managers),y("Members",c.members),y("Relays",c.relays||[]),!c.owners?.length&&!c.managers?.length&&!c.members?.length&&k.jsx("div",{className:"text-center text-zinc-400 py-8",children:"No access details found"})]})]})})},q_={light:"https://tiles.openfreemap.org/styles/positron",dark:"https://tiles.openfreemap.org/styles/dark"},Tx=me.memo(({bgClass:c,borderClass:d,stemClass:y,icon:C,iconClass:D="",size:P=32})=>k.jsxs("div",{className:"flex flex-col items-center pointer-events-auto transition-transform active:scale-95 group",children:[k.jsx("div",{className:`flex items-center justify-center rounded-full border-2 shadow-md ${c} ${d}`,style:{width:P,height:P},children:k.jsx("div",{className:D,children:C})}),k.jsx("div",{className:`w-0.5 h-2 ${y}`})]})),Zm=me.memo(({isHistory:c=!1,variant:d})=>{const y=d||(c?"history":"default"),C=y==="no-parking",D=y==="area",P=y==="history";let N="bg-[#007AFF]",h="border-white",U="bg-white",H="text-white font-bold text-sm",Y=k.jsx("span",{children:"P"});return C?(N="bg-red-500",h="border-white",U="bg-white",H="text-white",Y=k.jsx(Ex,{size:16})):D?(N="bg-white",h="border-red-500",U="bg-red-500",H="text-black font-bold text-sm",Y=k.jsx("span",{children:"P"})):P&&(N="bg-white",h="border-zinc-500",U="bg-zinc-500",H="text-zinc-500 font-bold text-sm",Y=k.jsx("span",{children:"P"})),k.jsx(Tx,{bgClass:N,borderClass:h,stemClass:U,icon:Y,iconClass:H})}),By=me.memo(({bearing:c,mapBearing:d,isNavigationMode:y})=>{const C=c-d,D=me.useRef(0),P=me.useRef(0),N=C-P.current;Math.abs(N)>180&&(N>0?D.current-=360:D.current+=360),P.current=C;const h=C+D.current;return k.jsx("div",{style:{transform:`rotate(${h}deg) scale(1)`,transition:"transform 0.2s ease-out",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:k.jsx("div",{style:{width:28,height:28,background:"#007AFF",border:"3px solid white",borderRadius:"50%",boxShadow:`0 0 0 ${y?3:2}px rgba(0,122,255,${y?.5:.4}), 0 4px 12px rgba(0,0,0,0.4)`,display:"flex",alignItems:"center",justifyContent:"center"},children:k.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"translateY(-1px)"},children:k.jsx("path",{d:"M7 0L14 14L7 12L0 14L7 0Z",fill:"white"})})})})});By.displayName="UserLocationMarker";const kg=me.memo(({type:c})=>{const d=c==="area",y=c==="history",C=c==="no-parking";let D="bg-[#007AFF]",P="border-white",N="bg-white",h="text-white font-bold text-sm",U=k.jsx("span",{children:"P"});return C?(D="bg-red-500",P="border-white",N="bg-white",h="text-white",U=k.jsx(Ex,{size:16})):d?(D="bg-white",P="border-red-500",N="bg-red-500",h="text-black font-bold text-sm",U=k.jsx("span",{children:"P"})):y&&(D="bg-white",P="border-zinc-500",N="bg-zinc-500",h="text-zinc-500 font-bold text-sm",U=k.jsx("span",{children:"P"})),k.jsx(Tx,{bgClass:D,borderClass:P,stemClass:N,icon:U,iconClass:h})});kg.displayName="ClusterMarkerContent";const k2=me.memo(({type:c,items:d,onClose:y,isPinned:C,onTogglePin:D,onCreateRoute:P,onFlagNoParking:N,isFlaggedByUser:h,noParkingFlagCount:U,isFlagging:H})=>{const Y="bg-white dark:bg-zinc-800 rounded-xl shadow-xl border border-black/10 dark:border-white/10 p-3 w-[240px] animate-in zoom-in-95 fade-in duration-150 pointer-events-auto relative",K=()=>k.jsx("button",{onClick:y,className:"absolute top-2 right-2 p-1 text-zinc-400 active:text-zinc-600 dark:active:text-zinc-300 z-10 bg-white/50 dark:bg-black/20 rounded-full",children:k.jsx(vo,{size:14})});if(c==="history"){const _e=d.reduce((we,ve)=>we+(ve.timesParked||1),0);return k.jsxs("div",{className:Y,onClick:we=>we.stopPropagation(),children:[k.jsx(K,{}),k.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Parking History"}),k.jsxs("div",{className:"space-y-1.5 text-xs",children:[k.jsxs("div",{className:"flex justify-between gap-4",children:[k.jsx("span",{className:"text-zinc-500",children:"Times Parked:"}),k.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white",children:_e})]}),(()=>{const we=d.map(Xe=>{const mt=Number(Xe.hourly_rate??Xe.price??Xe.properties?.hourly_rate??NaN);return isNaN(mt)?void 0:mt}).filter(Xe=>Xe!==void 0);if(we.length===0)return null;const ve=Math.min(...we),pe=Math.max(...we),he=d[0]?.currency||d[0]?.properties?.currency||"USD",De=m0(he),Je=ve===pe?`${De}${ve}`:`${De}${ve}-${pe}`;return k.jsxs("div",{className:"flex justify-between gap-4",children:[k.jsx("span",{className:"text-zinc-500",children:"Fees Reported:"}),k.jsxs("span",{className:"font-semibold text-zinc-900 dark:text-white",children:[Je,"/hr"]})]})})()]}),P&&k.jsx("button",{onClick:P,className:"mt-3 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",children:"Create Route"})]})}if(c==="area"){const _e=d.length,we=d.map(Je=>Je.original?.created_at||Je.created_at).filter(Boolean),ve=we.length>0?Math.min(...we):null,pe=d.map(Je=>{const Xe=Number(Je.hourly_rate??Je.price??Je.properties?.hourly_rate??NaN);return isNaN(Xe)?void 0:Xe}).filter(Je=>Je!==void 0);let he=null;if(pe.length>0){const Je=Math.min(...pe),Xe=Math.max(...pe),mt=d[0]?.currency||d[0]?.properties?.currency||"USD",Wt=m0(mt);he=Je===Xe?`${Wt}${Je}`:`${Wt}${Je}-${Xe}`}const De=()=>{if(!ve)return null;const Je=Math.floor(Date.now()/1e3),Xe=Math.floor((Je-ve)/86400);return Xe===0?"1 day":`${Xe+1} days`};return k.jsxs("div",{className:Y,onClick:Je=>Je.stopPropagation(),children:[k.jsx(K,{}),k.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Parking Area"}),k.jsxs("div",{className:"space-y-1.5 text-xs",children:[k.jsxs("div",{className:"flex justify-between gap-4",children:[k.jsx("span",{className:"text-zinc-500",children:"Reports:"}),k.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white",children:_e})]}),he&&k.jsxs("div",{className:"flex justify-between gap-4",children:[k.jsx("span",{className:"text-zinc-500",children:"Fees Reported:"}),k.jsxs("span",{className:"font-semibold text-zinc-900 dark:text-white",children:[he,"/hr"]})]}),De()&&k.jsxs("div",{className:"flex justify-between gap-4",children:[k.jsx("span",{className:"text-zinc-500",children:"Reported over:"}),k.jsx("span",{className:"font-semibold text-zinc-900 dark:text-white",children:De()})]}),U!==void 0&&k.jsxs("div",{className:"flex justify-between gap-4",children:[k.jsx("span",{className:"text-zinc-500",children:"Flagged No Parking:"}),k.jsx("span",{className:`font-semibold ${U>0?"text-red-600":"text-zinc-400"}`,children:U})]})]}),N&&k.jsxs("button",{onClick:N,disabled:H,className:`mt-3 w-full py-1.5 rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-2 ${h?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-red-500/10 text-red-600 active:bg-red-500/20"} ${H?"opacity-50 cursor-not-allowed":""}`,style:{touchAction:"manipulation"},children:[H&&k.jsxs("svg",{className:"animate-spin h-3 w-3",viewBox:"0 0 24 24",children:[k.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),k.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),H?"Updating...":h?"Remove No Parking Flag":"Flag No Parking"]}),D&&k.jsx("button",{onClick:D,className:`mt-2 w-full py-1.5 rounded-lg text-xs font-medium transition-colors ${C?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-amber-500/10 text-amber-600 active:bg-amber-500/20"}`,style:{touchAction:"manipulation"},children:C?"Remove from Map":"Keep on Map"}),P&&k.jsx("button",{onClick:P,className:"mt-2 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",style:{touchAction:"manipulation"},children:"Create Route"})]})}return k.jsxs("div",{className:Y,onClick:_e=>_e.stopPropagation(),children:[k.jsx(K,{}),k.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Listed Parking"}),k.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:d.map((_e,we)=>k.jsxs("div",{className:`flex items-center justify-between gap-2 ${we>0?"pt-2 border-t border-black/5 dark:border-white/10":""}`,children:[k.jsx("div",{className:"font-semibold text-xs text-zinc-900 dark:text-white truncate flex-1",children:_e.listing_name||_e.original?.listing_name||"Parking Spot"}),k.jsxs("div",{className:"text-xs text-zinc-500 whitespace-nowrap",children:[m0(_e.currency),Math.round(_e.price),"/hr"]}),k.jsxs("div",{className:"text-xs text-green-600 font-medium whitespace-nowrap",children:[_e.openSpots||_e.original?.openSpots||_e.count||1," open"]})]},we))}),D&&k.jsx("button",{onClick:D,className:`mt-3 w-full py-1.5 rounded-lg text-xs font-medium transition-colors ${C?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-amber-500/10 text-amber-600 active:bg-amber-500/20"}`,children:C?"Remove from Map":"Keep on Map"}),P&&k.jsx("button",{onClick:P,className:"mt-2 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",children:"Create Route"})]})});k2.displayName="MarkerPopup";const N2=me.memo(({})=>k.jsx(Tx,{bgClass:"bg-[#34C759]",borderClass:"border-white",stemClass:"bg-white",icon:k.jsx("span",{children:"P"}),iconClass:"text-white font-bold text-sm"}));N2.displayName="ActiveSessionMarkerContent";const D2=me.memo(({vehicleType:c,onVehicleChange:d,disabled:y})=>{const[C,D]=me.useState(!1),P=["bicycle","motorcycle","car"],N={bicycle:"",motorcycle:"",car:""};return k.jsx("div",{className:"flex flex-col rounded-[2rem] bg-white/80 dark:bg-white/10 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg overflow-hidden transition-all duration-300 pointer-events-auto",children:C?k.jsxs("div",{className:"flex flex-col gap-1 p-1",children:[P.map(h=>k.jsx("button",{onClick:()=>{y?y&&alert("Please end your current session before changing vehicle type."):(d(h),D(!1))},className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${c===h?"bg-blue-500/20 shadow-inner":"transition-colors"}`,children:k.jsx("span",{className:`text-lg ${c===h?"":"opacity-50"}`,children:N[h]})},h)),k.jsx("button",{onClick:()=>D(!1),className:"w-10 h-6 flex items-center justify-center text-zinc-400 dark:text-white/40 transition-colors",children:k.jsx(T1,{size:16})})]}):k.jsxs("button",{onClick:()=>D(!0),className:"flex flex-col items-center p-1 transition-all",children:[k.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-500/20",children:k.jsx("span",{className:"text-lg",children:N[c]})}),k.jsx(Fd,{size:14,className:"text-zinc-400 dark:text-white/40 mt-0.5"})]})})});D2.displayName="VehicleToggle";const H4=({onRequestScan:c,initialScannedCode:d,onScannedCodeConsumed:y})=>{const{pubkey:C,signEvent:D,pool:P}=nh(),N=me.useRef(null),[h,U]=me.useState(()=>{const Se=localStorage.getItem("parlens_last_location");return Se?JSON.parse(Se):null}),H=me.useRef(new I4),Y=me.useRef(new M4),K=me.useRef(new k4),[_e,we]=me.useState(null),[ve,pe]=me.useState("idle"),[he,De]=me.useState("fixed"),[Je,Xe]=me.useState(!1),[mt,Wt]=me.useState(!1),[Et,rt]=me.useState(!1),[at,He]=me.useState(!!d),[_t,Pe]=me.useState(()=>{const Se=localStorage.getItem("parlens_vehicle_type");return Se==="bicycle"||Se==="motorcycle"||Se==="car"?Se:"car"}),[ht,vt]=me.useState([]),[qt,ke]=me.useState([]),[Te,Ze]=me.useState(new Set),ut=me.useMemo(()=>{const et=[...ht.filter(nt=>!Te.has(nt.id))];return qt.forEach(nt=>{et.find(tt=>tt.id===nt.id)||et.push(nt)}),et},[ht,qt,Te]),[Tt,sn]=me.useState([]),[Re,ct]=me.useState(null),[kt,bt]=me.useState(()=>{const Se=localStorage.getItem("parlens_listed_parking_session");return Se?JSON.parse(Se):null}),[an,Bt]=me.useState(null),[Qt,un]=me.useState(!1),[nn,kn]=me.useState(null),[Nn,ii]=me.useState(()=>new Map),[En,si]=me.useState(()=>new Map),[wi,Oi]=me.useState(!1);me.useEffect(()=>{if(!P||!C)return;(async()=>{try{const et=await P.querySync(Kn,{kinds:[Ln.LABEL],authors:[C],"#L":["parlens"]}),nt=new Map;for(const tt of et){if(!tt.tags.some(qn=>qn[0]==="l"&&qn[1]==="no-parking"&&qn[2]==="parlens"))continue;const Mn=tt.tags.find(qn=>qn[0]==="g")?.[1];if(Mn){const qn=nt.get(Mn),Vi=et.find(It=>It.id===qn);(!qn||tt.created_at>(Vi?.created_at||0))&&nt.set(Mn,tt.id)}}nt.size>0&&(ii(nt),console.log("[Parlens] Loaded",nt.size,"user no-parking flags from relays"))}catch(et){console.error("[Parlens] Failed to fetch user no-parking flags:",et)}})()},[P,C]),me.useEffect(()=>{if(ht.length===0&&En.size===0)return;const Se=new Map;let et=!1;ht.forEach(nt=>{if(nt.kind===Ln.LABEL&&nt.tags?.some(wt=>wt[0]==="l"&&wt[1]==="no-parking"&&wt[2]==="parlens")){const wt=nt.tags.find(Mn=>Mn[0]==="g")?.[1];wt&&(Se.set(wt,(Se.get(wt)||0)+1),et=!0)}if(nt.kind===Ln.PARKING_AREA_INDICATOR&&nt.tags?.some(wt=>wt[0]==="no-parking-flag"&&wt[1]==="true")){const wt=nt.tags.find(Mn=>Mn[0]==="g")?.[1];wt&&(Se.set(wt,(Se.get(wt)||0)+1),et=!0)}}),(et||En.size>0)&&(si(Se),et&&console.log("[Parlens] Aggregated no-parking flags from",Se.size,"areas (source: relay)"))},[ht]),me.useEffect(()=>{d&&(console.log("[LandingPage] Processing scanned code from QRScanPage:",d),qe(d),y?.())},[d,y]);const[Yn,Gn]=me.useState(!1),[Rn,Ei]=me.useState(!1),[on,Li]=me.useState(""),[tr,Di]=me.useState([]),[yr,yt]=me.useState(!1),[oe,le]=me.useState(null),[ge,Ue]=me.useState(!1);me.useEffect(()=>{oe&&Ue(!0)},[oe]),me.useEffect(()=>{(ve==="idle"||ve==="parked")&&(le(null),Ue(!1))},[ve]);const[Ye]=me.useState(()=>{try{const Se=localStorage.getItem("parlens_route_cache_v1");return Se?JSON.parse(Se):[]}catch{return[]}}),At=me.useMemo(()=>{if(!on||on.length<2)return[];const Se=on.toLowerCase(),et=[];for(const nt of Ye){const tt=nt.decryptedContent?.waypoints||[];for(const wt of tt)wt.name&&wt.name.toLowerCase().includes(Se)&&(et.find(Mn=>Mn.name.toLowerCase()===wt.name.toLowerCase())||et.push({name:wt.name,lat:wt.lat,lon:wt.lon}))}return et.slice(0,3)},[on,Ye]),[it,de]=me.useState(()=>{try{const Se=localStorage.getItem("parlens_pinned_markers");return Se?JSON.parse(Se):[]}catch{return[]}}),qe=me.useCallback(async Se=>{He(!0),console.log("[Parlens] Processing scanned code:",Se);try{const{generateSecretKey:et,finalizeEvent:nt,getPublicKey:tt}=await Qm(async()=>{const{generateSecretKey:Ji,finalizeEvent:ja,getPublicKey:Na}=await Promise.resolve().then(()=>Oy);return{generateSecretKey:Ji,finalizeEvent:ja,getPublicKey:Na}},void 0);let wt;try{wt=JSON.parse(Se)}catch{wt={a:Se,authorizer:"",auth:""}}if(!wt.a){alert("Invalid QR code format");return}if(C&&wt.authorizer&&wt.authorizer===C){alert("Owners and managers cannot use QR authentication to park at their own listing. Please use the spot card to update status directly.");return}const Mn="parlens_listed_parking_session",qn=localStorage.getItem(Mn);let Vi=!1;qn&&JSON.parse(qn).spotATag===wt.a&&(Vi=!0);const It=et(),oi=tt(It);if(Vi){const Ji=JSON.parse(qn);mi({authData:wt,session:Ji,tempPrivkey:It,tempPubkey:oi}),ki(!0);return}const Xi="occupied",pa=wt.a.split(":"),ll=(pa[2]||"").replace(/-spot-\d+$/,""),ks=`${Ln.LISTED_PARKING_METADATA}:${pa[1]}:${ll} `,ws=[["a",wt.a],["a",ks,"","root"],["status",Xi],["updated_by",oi],["authorizer",wt.authorizer||C||""],...wt.auth?[["auth",wt.auth]]:[],["client","parlens"]],sr=wt.listingLocation||null;if(sr){ws.push(["location",`${sr[0]},${sr[1]} `]);try{const Ji=Zf.encode(sr[0],sr[1],5);ws.push(["g",Ji])}catch{}}wt.spotType&&ws.push(["type",wt.spotType]),wt.hourlyRate!==void 0&&(ws.push(["hourly_rate",String(wt.hourlyRate)]),ws.push(["currency",wt.currency||"USD"]));const Ar={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:ws,content:JSON.stringify({hourly_rate:wt.hourlyRate||0,currency:wt.currency||"USD",type:wt.spotType||"car"})},ka=nt(Ar,It);await Promise.allSettled(P.publish(Kn,ka)),console.log("[Parlens] Status update published:",ka.id);const br=`parking - ${Date.now()} `,vr=wt.listingLocation||h,Fa=JSON.stringify({spotATag:wt.a,listingATag:wt.listingATag||"",location:wt.listingName||"",statusLogEventId:ka.id,listingName:wt.listingName||"",floor:wt.floor||"",spotNumber:wt.spotNumber||"",shortName:wt.shortName||"",tempPubkey:oi,started_at:Date.now()}),$i={kind:Ln.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",br],["status","parked"],["client","parlens"]],content:Fa},xi=await D($i);await Promise.allSettled(P.publish(Kn,xi));const xu={spotATag:wt.a,dTag:br,startTime:Date.now(),listingATag:wt.listingATag||"",authorizer:wt.authorizer,tempPubkey:oi,listingName:wt.listingName||"",floor:wt.floor||"",spotNumber:wt.spotNumber||"",shortName:wt.shortName||"",listingLocation:vr||void 0,spotType:wt.spotType||"car",hourlyRate:wt.hourlyRate||0,currency:wt.currency||"USD"};localStorage.setItem(Mn,JSON.stringify(xu)),bt(xu),pe("parked"),ct(vr||null),jn(Math.floor(Date.now()/1e3)),console.log("[Parlens] Listed parking started:",xi.id)}catch(et){console.error("Failed to process QR code:",et),alert("Failed to process parking. Please try again.")}finally{He(!1)}},[C,D,P,h,pe]),xt=async()=>{if(!bi)return;const{authData:Se,session:et,tempPrivkey:nt,tempPubkey:tt}=bi;try{const{finalizeEvent:wt}=await Qm(async()=>{const{finalizeEvent:$i}=await Promise.resolve().then(()=>Oy);return{finalizeEvent:$i}},void 0),Mn=Se.a.split(":"),Vi=(Mn[2]||"").replace(/-spot-\d+$/,""),It=`${Ln.LISTED_PARKING_METADATA}:${Mn[1]}:${Vi} `,oi=[["a",Se.a],["a",It,"","root"],["status","open"],["updated_by",tt],["authorizer",Se.authorizer||C||""],...Se.auth?[["auth",Se.auth]]:[],["client","parlens"]],Xi=Se.listingLocation||et.listingLocation;if(Xi){oi.push(["location",`${Xi[0]},${Xi[1]} `]);try{const $i=Zf.encode(Xi[0],Xi[1],5);oi.push(["g",$i])}catch{}}const pa=Se.spotType||et.spotType||"car",hc=Se.hourlyRate??et.hourlyRate??0,ll=Se.currency||et.currency||"USD";oi.push(["type",pa]),oi.push(["hourly_rate",String(hc)]),oi.push(["currency",ll]);const ks={kind:Ln.LISTED_SPOT_LOG,created_at:Math.floor(Date.now()/1e3),tags:oi,content:JSON.stringify({hourly_rate:hc,currency:ll,type:pa})},ws=wt(ks,nt);await Promise.allSettled(P.publish(Kn,ws));const sr={spotATag:Se.a,listingATag:et.listingATag||"",location:et.listingName||"",statusLogEventId:ws.id,listingName:et.listingName||"",floor:et.floor||"",spotNumber:et.spotNumber||"",shortName:et.shortName||"",started_at:Ti||Date.now(),finished_at:Date.now(),fee:ln,note:Bi,currency:"USD",type:et.spotType||"car"},Ar=localStorage.getItem("parlens_privkey"),ka=Ar?new Uint8Array(Ar.match(/.{1,2}/g).map($i=>parseInt($i,16))):void 0,br=await I1(sr,C,ka),vr={kind:Ln.PARKING_LOG,created_at:Math.floor(Date.now()/1e3),tags:[["d",et.dTag||`session_${Date.now()}`],["status","idle"],["client","parlens"]],content:br},Fa=await D(vr);await Promise.allSettled(P.publish(Kn,Fa)),window.dispatchEvent(new Event("parking-log-updated")),localStorage.removeItem("parlens_listed_parking_session"),bt(null),pe("idle"),ct(null),jn(null),ki(!1),mi(null),yi("0"),console.log("[Parlens] Listed parking ended")}catch(wt){console.error("Failed to end listed session:",wt),alert("Failed to end session. Please try again.")}},[Fe,St]=me.useState(!1),[Lt,bn]=me.useState(17),[yn,$n]=me.useState(null),[dt,ai]=me.useState(null),[Fn,Jn]=me.useState(null),[pi,ur]=me.useState(!1),[Ti,jn]=me.useState(null),[Ni,Ri]=me.useState(!1),[ji,Nr]=me.useState({longitude:77.5946,latitude:12.9716,zoom:17,bearing:0,pitch:0}),Jt=me.useRef(!1),gi=me.useRef(!1),Sn=window.matchMedia("(prefers-color-scheme: dark)").matches,[lr,Ke]=me.useState(!1),[je,Mt]=me.useState([]),[Yt,tn]=me.useState(null),[Un,Hn]=me.useState(null),[vn,ri]=me.useState(null),[ni,Xn]=me.useState(""),[,Zi]=me.useState(!1),[Cn,Dn]=me.useState([]),[Zt,ki]=me.useState(!1),[ln,yi]=me.useState("0"),[Bi,_i]=me.useState(""),[bi,mi]=me.useState(null),[li,Hi]=me.useState(!1),[Tr,Qn]=me.useState(null),[es,Ts]=me.useState(null);me.useEffect(()=>{const et=setTimeout(async()=>{if(!(!h||es))try{const tt=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${h[0]}&lon=${h[1]}&format=json`)).json();tt&&tt.address&&tt.address.country_code&&(console.log("[Parlens] Detected Country:",tt.address.country_code),Ts(tt.address.country_code.toUpperCase()))}catch(nt){console.error("[Parlens] Failed to detect country:",nt)}},2e3);return()=>clearTimeout(et)},[h,es]);const zi=me.useCallback((Se,et,nt)=>{(et==="open"||et==="closed")&&(console.log("[Parlens] Remote cancellation detected:",et),alert("The listing owner has updated the spot status. Your session continues as a regular parking session."),Ti&&Re&&localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Ti,parkLocation:Re})),localStorage.removeItem("parlens_listed_parking_session"),bt(null),pe("parked"),ki(!1),mi(null))},[pe,Ti,Re]),Ba=me.useCallback(()=>{const Se=ji;if(yr){const tt=Se.latitude,wt=Se.longitude;le({lat:tt,lon:wt,name:`${tt.toFixed(4)}, ${wt.toFixed(4)}`}),N.current&&(gi.current=!0,N.current.flyTo({center:[wt,tt],zoom:16,duration:1200,essential:!0}),setTimeout(()=>{gi.current=!1,pe("search")},1300)),yt(!1),Ke(!1);return}const et=Cn.length+je.length+1,nt={id:crypto.randomUUID(),lat:Se.latitude,lon:Se.longitude,name:`Waypoint ${et}`};Mt(tt=>[...tt,nt])},[ji,Cn.length,je.length,yr]),sl=(Se,et)=>{Mt(nt=>nt.map(tt=>tt.id===Se?{...tt,name:et}:tt))},Vo=Se=>{Mt(et=>et.filter(tt=>tt.id!==Se).map((tt,wt)=>tt.name.startsWith("Waypoint ")?{...tt,name:`Waypoint ${wt+1}`}:tt)),Un===Se&&Hn(null)},Fi=me.useCallback(Se=>{Li(Se)},[]);me.useEffect(()=>{if(!on||on.length<2){Di([]);return}const Se=setTimeout(async()=>{try{const et=await Dg(on,es,h,1);Di(et)}catch(et){console.error("[Parlens] Parking search error:",et),Di([])}},300);return()=>clearTimeout(Se)},[on,es,h]);const Wr=me.useCallback(Se=>{Ei(!1),Li(""),Di([]);const et=parseFloat(Se.lat),nt=parseFloat(Se.lon),tt=Se.display_name||`${et.toFixed(4)}, ${nt.toFixed(4)}`;N.current&&!isNaN(et)&&!isNaN(nt)&&(le({lat:et,lon:nt,name:tt}),gi.current=!0,N.current.flyTo({center:[nt,et],zoom:16,duration:1200,essential:!0}),setTimeout(()=>{gi.current=!1,pe("search")},1300))},[]),Pt=me.useCallback(()=>{if(yr){Ke(!1),yt(!1),Ei(!0);return}const Se=je.map(et=>({lat:et.lat,lon:et.lon,name:et.name}));tn(Se),Mt([]),Ke(!1),Gn(!0)},[je,yr]),[Ne,ti]=me.useState(!1),[cs,Is]=me.useState(0),[Ma,uc]=me.useState(0),{requestLock:ts,releaseLock:di}=z4(),xr=me.useRef(new N4),[wo,al]=me.useState(0),Si=me.useRef(!1),Hs=me.useRef(0),zl=me.useRef(0);me.useEffect(()=>{if(ve==="parked"){De("fixed");const Se=N.current?.getBearing()||0,et=Math.round(Se/360)*360;N.current?.rotateTo(et,{duration:800})}},[ve]),me.useEffect(()=>(ts(),()=>{di()}),[ts,di]),me.useEffect(()=>{if(!navigator.geolocation){we("Geolocation is not supported by your browser");return}const Se=navigator.geolocation.watchPosition(et=>{const{latitude:nt,longitude:tt,accuracy:wt}=et.coords,Mn=xr.current.updateLocationWithAccuracy(nt,tt,wt);al(Mn.speed),Hs.current=Mn.speed,localStorage.setItem("parlens_last_location",JSON.stringify([nt,tt])),Mn.speedClass==="stationary"?Mn.shouldUpdate&&K.current.animateTo(Mn.displayLat,Mn.displayLon,Mn.animationDuration):K.current.animateTo(nt,tt,300),Si.current||(Si.current=!0,U([Mn.displayLat,Mn.displayLon]),Nr(qn=>({...qn,latitude:Mn.displayLat,longitude:Mn.displayLon})))},et=>{let nt="Unable to get your location";et.code===1?nt="Location access denied. Please enable location services.":et.code===2?nt="Location unavailable. Check your GPS settings.":et.code===3&&(nt="Location request timed out."),we(nt)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});return K.current.setUpdateCallback((et,nt)=>{U([et,nt]),De(tt=>{if((tt==="auto"||tt==="recentre")&&!Jt.current){if(Hs.current<.3&&tt!=="recentre")return tt;Nr(wt=>{const Mn=N.current?.getZoom()??wt.zoom,qn=.1,Vi=wt.latitude+(et-wt.latitude)*qn,It=wt.longitude+(nt-wt.longitude)*qn;return{...wt,latitude:Vi,longitude:It,zoom:Mn}})}return tt})}),()=>{navigator.geolocation.clearWatch(Se),K.current.stop()}},[]),me.useEffect(()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&ti(!0);const Se=et=>{if(Jt.current)return;let nt=null;if(et.webkitCompassHeading?nt=et.webkitCompassHeading:et.alpha!==null&&(nt=360-et.alpha),nt!==null){const tt=window.screen.orientation?.angle??window.orientation??0;nt=(nt+tt)%360}if(nt!==null){zl.current=nt,uc(wt=>{let qn=nt-wt;return qn>180&&(qn-=360),qn<-180&&(qn+=360),Math.abs(qn)<2?wt:wt+qn*.1});const tt=H.current.smoothBearing(nt,0,!0);if(tt!==null){const wt=Y.current.setBearing(tt);Is(wt)}}};return window.addEventListener("deviceorientation",Se,!0),()=>{window.removeEventListener("deviceorientation",Se,!0)}},[]);const ol=async()=>{typeof DeviceOrientationEvent.requestPermission=="function"&&await DeviceOrientationEvent.requestPermission()==="granted"&&ti(!1)};me.useEffect(()=>{!Jt.current&&!gi.current&&h&&(he==="auto"||he==="recentre")&&Nr(Se=>{const et=N.current?.getZoom()??Se.zoom,nt={...Se,longitude:h[1],latitude:h[0],zoom:et,pitch:0};if(lr)return Se;if(he==="auto"){nt.bearing=cs;const tt=et>=17?300:et>=15?200:150;nt.transitionDuration=tt}else if(he==="recentre"){const tt=et>=17?400:et>=15?300:200;nt.transitionDuration=tt}return nt})},[h,cs,he,pi,lr]),me.useEffect(()=>(ts(),()=>{di()}),[ts,di]),me.useEffect(()=>{const Se=localStorage.getItem("parlens_listed_parking_session");if(Se)try{const nt=JSON.parse(Se);if(console.log("[Parlens] Restoring listed session:",nt),nt.startTime){jn(nt.startTime),nt.listingLocation&&ct(nt.listingLocation),pe("parked");return}}catch(nt){console.warn("[Parlens] Failed to restore listed session:",nt)}const et=localStorage.getItem("parlens_session");if(et)try{const nt=JSON.parse(et);nt.status==="parked"&&nt.parkLocation&&nt.sessionStart?(console.log("[Parlens] Restoring parked session:",nt),jn(nt.sessionStart),ct(nt.parkLocation),pe("parked")):nt.status==="search"&&(console.log("[Parlens] Restoring search session"),pe("search"))}catch(nt){console.warn("[Parlens] Failed to restore session:",nt),localStorage.removeItem("parlens_session")}},[]),me.useEffect(()=>{ve==="parked"&&Ti&&Re?localStorage.setItem("parlens_session",JSON.stringify({status:"parked",sessionStart:Ti,parkLocation:Re})):ve==="search"?localStorage.setItem("parlens_session",JSON.stringify({status:"search"})):ve==="idle"&&(localStorage.removeItem("parlens_session"),jn(null))},[ve,Ti,Re]),me.useEffect(()=>{Bt(ve==="search"?[ji.latitude,ji.longitude]:null)},[ve]),me.useEffect(()=>{if(!h){St(!1);return}const[Se,et]=h,nt=Math.sqrt(Math.pow(ji.latitude-Se,2)+Math.pow(ji.longitude-et,2));St(nt>5e-4)},[h,ji.latitude,ji.longitude]);const Yi=me.useCallback(Se=>{Nr(Se.viewState);let et=!1;if(N.current&&(gn.current&&(et=!0),N.current.isZooming()&&(et=!0),Se&&Se.originalEvent&&Se.originalEvent.touches&&Se.originalEvent.touches.length>1&&(et=!0)),Jt.current&&(he==="auto"||he==="recentre")&&!et){let nt=1;h&&(nt=Math.sqrt(Math.pow(Se.viewState.longitude-h[1],2)+Math.pow(Se.viewState.latitude-h[0],2))),nt>1e-4&&De("fixed")}},[h,he,Fe]),Br=me.useCallback(Se=>{Se.originalEvent&&(Jt.current=!0,K.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1))},[]),nr=me.useCallback(()=>{setTimeout(()=>{Jt.current=!1},1e3),bn(ji.zoom),ve==="search"&&Bt([ji.latitude,ji.longitude])},[ji.zoom,ji.latitude,ji.longitude,ve]),gn=me.useRef(!1),_r=me.useCallback(()=>{gn.current=!0,Jt.current=!0,K.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1)},[]),Ai=me.useCallback(()=>{gn.current=!1,setTimeout(()=>{gn.current||(Jt.current=!1)},1e3)},[]),Ui=Se=>{if(ve!=="idle"){alert("Please end your current session before changing vehicle type.");return}Pe(Se),localStorage.setItem("parlens_vehicle_type",Se)},qs=me.useCallback(async(Se,et)=>{if(!P||!D||!C){alert("Please sign in to flag parking areas.");return}const nt=Se[0];if(!nt)return;const tt=nt.lat,wt=nt.lon,Mn=Zf.encode(tt,wt,7);Oi(!0);try{if(et){const qn=Nn.get(Mn);if(qn){const Vi={kind:5,created_at:Math.floor(Date.now()/1e3),tags:[["e",qn]],content:""},It=await D(Vi);P.publish(Kn,It),ii(oi=>{const Xi=new Map(oi);return Xi.delete(Mn),Xi}),Ze(oi=>{const Xi=new Set(oi);return Xi.add(qn),Xi}),console.log("[Parlens] Unflagged no-parking for geohash:",Mn)}}else{const qn=Mn.substring(0,5),Vi={kind:Ln.LABEL,created_at:Math.floor(Date.now()/1e3),tags:[["L","parlens"],["l","no-parking","parlens"],["g",Mn],["g",qn],["location",`${tt},${wt}`],["client","parlens"]],content:""},It=await D(Vi);P.publish(Kn,It),ii(Xi=>{const pa=new Map(Xi);return pa.set(Mn,It.id),pa});const oi={id:It.id,kind:Ln.LABEL,tags:It.tags,lat:tt,lon:wt,price:0,currency:"INR",created_at:It.created_at,pubkey:It.pubkey};ke(Xi=>[...Xi,oi]),console.log("[Parlens] Flagged no-parking for geohash:",Mn)}}catch(qn){console.error("[Parlens] Failed to toggle no-parking flag:",qn),alert("Failed to update no-parking flag. Please try again.")}finally{Oi(!1)}},[P,D,C,Nn]),Yr=me.useCallback((Se,et,nt,tt)=>{if($n(Se),ai(et),Jn(nt),ur(tt),Se&&Se.length>1&&N.current&&tt){const wt=[...Se];et&&et.length>0&&wt.push(...et);const Mn=wt.map(It=>It[1]),qn=wt.map(It=>It[0]),Vi=new h2.LngLatBounds([Math.min(...Mn),Math.min(...qn)],[Math.max(...Mn),Math.max(...qn)]);gi.current=!0,N.current.fitBounds(Vi,{padding:50,duration:1e3}),De("fixed"),setTimeout(()=>{gi.current=!1,typeof DeviceOrientationEvent.requestPermission=="function"&&ti(!0)},1200)}},[]),Zs=me.useMemo(()=>{const Se=Tt.filter(nt=>(nt.decryptedContent?.type||"car")===_t),et=new Map;for(const nt of Se){const tt=nt.decryptedContent;if(!tt||!tt.lat||!tt.lon)continue;const wt=parseFloat(tt.lat.toFixed(6)),Mn=parseFloat(tt.lon.toFixed(6)),qn=`${wt},${Mn}`;if(et.has(qn)){const Vi=et.get(qn);Vi.timesParked+=1,Vi.logs.push(nt),nt.created_at>Vi.created_at&&(Vi.created_at=nt.created_at)}else et.set(qn,{id:nt.id,lat:wt,lon:Mn,price:parseFloat(tt.fee)||0,currency:tt.currency||"USD",original:nt,timesParked:1,logs:[nt],created_at:nt.created_at})}return Array.from(et.values())},[Tt,_t]),Bs=me.useMemo(()=>Hm(Zs,Lt,!0,7),[Zs,Lt]),Dr=me.useMemo(()=>{const Se=it.filter(tt=>tt.markerType==="listed").map(tt=>{const Mn=ut.find(qn=>qn.id===tt.id)||tt;return{id:tt.id||`pinned-${tt.lat}-${tt.lon}`,lat:tt.lat,lon:tt.lon,price:Mn.price??0,currency:Mn.currency||"INR",count:Mn.count,kind:Ln.LISTED_SPOT_LOG,listing_name:Mn.listing_name||tt.listing_name,listing_id:Mn.listing_id||tt.listing_id,listing_a_tag:Mn.listing_a_tag||tt.listing_a_tag,openSpots:Mn.openSpots||Mn.count||tt.openSpots||1,original:Mn,isPinned:!0}});if(ve!=="search")return Se;const et=ut.filter(tt=>tt.kind===Ln.LISTED_SPOT_LOG&&(tt.type||"car")===_t).map(tt=>({id:tt.id,lat:tt.lat,lon:tt.lon,price:tt.price??0,currency:tt.currency||"INR",count:tt.count,kind:tt.kind,listing_name:tt.listing_name,listing_id:tt.listing_id,listing_a_tag:tt.listing_a_tag,openSpots:tt.count||1,original:tt})),nt=new Map;return Se.forEach(tt=>nt.set(tt.id,tt)),et.forEach(tt=>nt.set(tt.id,tt)),Array.from(nt.values())},[ut,_t,ve,it]),fa=me.useMemo(()=>{const Se=it.filter(tt=>tt.markerType==="area").map(tt=>{const Mn=ut.find(qn=>qn.id===tt.id)||tt;return{id:tt.id||`pinned-area-${tt.lat}-${tt.lon}`,lat:tt.lat,lon:tt.lon,price:Mn.price||0,currency:Mn.currency||"INR",count:Mn.count||1,kind:Ln.PARKING_AREA_INDICATOR,created_at:Mn.created_at||tt.created_at,original:Mn,isPinned:!0}});if(ve!=="search")return Se;try{if(!JSON.parse(localStorage.getItem("parlens_show_parking_areas")||"true"))return Se}catch{}const et=ut.filter(tt=>tt.kind===Ln.PARKING_AREA_INDICATOR&&(tt.type||"car")===_t).map(tt=>({id:tt.id,lat:tt.lat,lon:tt.lon,price:tt.price,currency:tt.currency,count:tt.count,kind:tt.kind,created_at:tt.created_at,original:tt})),nt=new Map;return Se.forEach(tt=>nt.set(tt.id,tt)),et.forEach(tt=>nt.set(tt.id,tt)),Array.from(nt.values())},[ut,_t,ve,it]),ps=me.useMemo(()=>Hm(Dr,Lt,!0,7),[Dr,Lt]),{regularAreaSpots:va,noParkingSpots:Ms}=me.useMemo(()=>{const Se=[],et=[];for(const nt of fa){const tt=Zf.encode(nt.lat,nt.lon,7);Nn.has(tt)?et.push(nt):Se.push(nt)}return{regularAreaSpots:Se,noParkingSpots:et}},[fa,Nn]),Rr=me.useMemo(()=>Hm(va,Lt,!0,7),[va,Lt]),ns=me.useMemo(()=>Hm(Ms,Lt,!0,7),[Ms,Lt]),rr=me.useMemo(()=>{if(!nn)return[];const Se=nn.type==="listed"?ps:[...Rr,...ns],et=nn.items[0]?.id;if(!et)return nn.items;for(const nt of Se){const tt=Mg(nt)?nt.spots:[nt];if(tt.some(wt=>wt.id===et))return tt}return nn.items},[nn,ps,Rr,ns]);me.useEffect(()=>{ve!=="search"&&kn(null)},[ve]);const Ao=Sn?q_.dark:q_.light,Eo={id:"route",type:"line",paint:{"line-color":"#007AFF","line-width":5,"line-opacity":.9}},hr={id:"alternate-route",type:"line",paint:{"line-color":"#007AFF","line-width":3,"line-opacity":.4,"line-dasharray":[2,2]}};return k.jsxs("div",{className:"fixed inset-0 overflow-hidden bg-gray-50 dark:bg-black transition-colors duration-300",children:[(!h&&!_e||!Ni)&&k.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:k.jsx("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:_e?k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center",children:k.jsx("span",{className:"text-2xl",children:""})}),k.jsx("p",{className:"text-sm font-medium text-red-500 dark:text-red-400",children:_e}),k.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-6 py-2 rounded-full bg-[#007AFF] text-white text-sm font-medium active:scale-95 transition-transform",children:"Try Again"})]}):k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-blue-500/20 border-t-blue-500 animate-spin"}),k.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Locating..."})]})})}),at&&k.jsx("div",{className:"absolute inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500",children:k.jsxs("div",{className:"flex flex-col items-center gap-4 animate-in fade-in duration-700 px-8 max-w-sm text-center",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-green-500/20 border-t-green-500 animate-spin"}),k.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Verifying..."})]})}),he==="auto"&&h&&k.jsx("div",{className:"absolute top-1/2 left-1/2 z-[900] pointer-events-none flex items-center justify-center",style:{transform:"translate(-50%, -50%)",width:"40px",height:"40px"},children:k.jsx(By,{bearing:Ma,mapBearing:ji.bearing,isNavigationMode:!0})}),k.jsxs("div",{className:"absolute inset-0",onPointerDownCapture:()=>{Jt.current=!0,K.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1)},onTouchStartCapture:()=>{Jt.current=!0,K.current.stop(),gi.current&&(N.current?.stop(),gi.current=!1)},onWheelCapture:()=>{Jt.current=!0,gi.current&&(N.current?.stop(),gi.current=!1),window.wheelDebounce&&clearTimeout(window.wheelDebounce),window.wheelDebounce=setTimeout(()=>{Jt.current=!1},1e3)},style:{touchAction:"none"},children:[k.jsxs(zT,{ref:N,...ji,maxPitch:0,pitchWithRotate:!1,onStyleData:Se=>{const et=Se.target;et&&(et.getStyle().layers?.forEach(wt=>{(wt.id.includes("oneway")||wt.id.includes("arrow")||wt.id.includes("direction"))&&et.getLayoutProperty(wt.id,"visibility")!=="none"&&et.setLayoutProperty(wt.id,"visibility","none")}),Object.entries({"icon-bus":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M4 6C4 4.89543 4.89543 4 6 4H18C19.1046 4 20 4.89543 20 6V17C20 18.1046 19.1046 19 18 19H16.5L17.5 21H15.5L14.5 19H9.5L8.5 21H6.5L7.5 19H6C4.89543 19 4 18.1046 4 17V6ZM6 6V10H18V6H6ZM6 12V16H18V12H6ZM8 14C8.55228 14 9 13.5523 9 13C9 12.4477 8.55228 12 8 12C7.44772 12 7 12.4477 7 13C7 13.5523 7.44772 14 8 14ZM16 14C16.5523 14 17 13.5523 17 13C17 12.4477 16.5523 12 16 12C15.4477 12 15 12.4477 15 13C15 13.5523 15.4477 14 16 14Z"/></svg>',"icon-train":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C8 2 4 2.5 4 6V15.5C4 17.433 5.567 19 7.5 19L6 20.5V21H18V20.5L16.5 19C18.433 19 20 17.433 20 15.5V6C20 2.5 16 2 12 2ZM12 4C14.5 4 18 4.5 18 6V10H6V6C6 4.5 9.5 4 12 4ZM12 17C10.8954 17 10 16.1046 10 15C10 13.8954 10.8954 13 12 13C13.1046 13 14 13.8954 14 15C14 16.1046 13.1046 17 12 17ZM7.5 17C6.67157 17 6 16.3284 6 15.5V12H9.05C9.02 12.3 9 12.64 9 13C9 14.6569 10.3431 16 12 16C13.6569 16 15 14.6569 15 13C15 12.64 14.98 12.3 14.95 12H18V15.5C18 16.3284 17.3284 17 16.5 17H7.5Z"/></svg>',"icon-subway":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M17.8 2.8C16 2.09 13.86 2 12 2C10.14 2 8 2.09 6.2 2.8C4.30002 3.55 3.00002 4.97 3.00002 6.5V15.5C3.00002 17.4 4.40002 19.34 6.6 19.89L5.00002 21.5V22H19V21.5L17.4 19.89C19.6 19.34 21 17.4 21 15.5V6.5C21 4.97 19.7 3.55 17.8 2.8ZM16.5 16C15.12 16 14 14.88 14 13.5C14 12.12 15.12 11 16.5 11C17.88 11 19 12.12 19 13.5C19 14.88 17.88 16 16.5 16ZM12 9C7.58 9 6 6.5 6 6.5C6 6.5 8 5.5 12 5.5C16 5.5 18 6.5 18 6.5C18 6.5 16.42 9 12 9ZM7.5 16C6.12 16 5.00002 14.88 5.00002 13.5C5.00002 12.12 6.12 11 7.5 11C8.88 11 10 12.12 10 13.5C10 14.88 8.88 16 7.5 16Z"/></svg>',"icon-tram":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M13 5.5V2H11V5.5L7 8H17L13 5.5ZM5 9V17.5C5 18.7 5.7 19.7 6.8 20.2L6 21H8L9 20H15L16 21H18L17.2 20.2C18.3 19.7 19 18.7 19 17.5V9H5ZM16 16.5C16 17.05 15.55 17.5 15 17.5H9C8.45 17.5 8 17.05 8 16.5V14H16V16.5ZM16 12.5H8V10.5H16V12.5Z"/></svg>',"icon-stop":'<svg viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="6" stroke="white" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="white"/></svg>'}).forEach(([wt,Mn])=>{if(!et.hasImage(wt)){const qn=new Image(24,24);qn.onload=()=>et.addImage(wt,qn,{sdf:!0}),qn.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(Mn)}}),et.getLayer("transit-stops")||et.addLayer({id:"transit-stops",type:"symbol",source:"openmaptiles","source-layer":"poi",minzoom:12,filter:["match",["get","class"],["bus_station","railway","bus_stop","tram_stop","subway","rail","train_station"],!0,!1],layout:{"icon-image":["match",["get","class"],"bus_station","icon-bus","bus_stop","icon-stop","railway","icon-train","rail","icon-train","train_station","icon-train","tram_stop","icon-tram","subway","icon-subway","icon-stop"],"icon-size":["interpolate",["linear"],["zoom"],12,.5,14,.6,18,1],"icon-allow-overlap":!1,"icon-padding":2,"text-field":["upcase",["coalesce",["get","name_en"],["get","name"]]],"text-size":11,"text-offset":[0,1.2],"text-anchor":"top","text-font":["Noto Sans Regular"],"text-optional":!0},paint:{"icon-color":Sn?"#999999":"#555555","icon-halo-color":Sn?"rgba(0,0,0,0.5)":"#ffffff","icon-halo-width":1,"text-color":Sn?"#aaaaaa":"#666666","text-halo-color":Sn?"rgba(0,0,0,0.8)":"#ffffff","text-halo-width":1,"text-opacity":["interpolate",["linear"],["zoom"],13.5,0,14,1]}}))},onLoad:Se=>{Ri(!0);const et=Se.target;et&&et.getStyle().layers?.forEach(tt=>{(tt.id.includes("oneway")||tt.id.includes("arrow")||tt.id.includes("direction"))&&et.setLayoutProperty(tt.id,"visibility","none"),(tt.id.includes("admin")||tt.id.includes("boundary"))&&et.setLayoutProperty(tt.id,"visibility","none"),(tt.id.includes("housenum")||tt.id.includes("road_label"))&&tt.id.includes("housenum")&&et.setLayoutProperty(tt.id,"visibility","none");const wt=et.getLayoutProperty(tt.id,"text-font");if(wt&&Array.isArray(wt)){const Mn=wt.map(qn=>qn.replace("Italic","Regular"));Mn.join(",")!==wt.join(",")&&et.setLayoutProperty(tt.id,"text-font",Mn)}})},onMove:Yi,onMoveStart:Br,onMoveEnd:nr,onZoomStart:_r,onZoomEnd:Ai,onRotateStart:()=>{Jt.current=!0,K.current.stop()},onRotateEnd:nr,onPitchStart:()=>{Jt.current=!0,K.current.stop()},onPitchEnd:nr,style:{width:"100%",height:"100%"},mapStyle:Ao,attributionControl:!1,dragPan:!gi.current,minZoom:3,maxZoom:20,renderWorldCopies:!0,maxTileCacheSize:1e3,children:[pi&&dt&&dt.length>1&&k.jsx(O_,{id:"alternate-route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:dt.map(Se=>[Se[1],Se[0]])}},children:k.jsx(z_,{...hr})}),pi&&yn&&yn.length>1&&k.jsx(O_,{id:"route",type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:yn.map(Se=>[Se[1],Se[0]])}},children:k.jsx(z_,{...Eo})}),ps.map(Se=>{const et=Mg(Se);return k.jsx(Pc,{longitude:Se.lon,latitude:Se.lat,anchor:"bottom",style:{willChange:"transform",zIndex:N.current?.project([Se.lon,Se.lat]).y?Math.floor(N.current.project([Se.lon,Se.lat]).y):void 0},onClick:nt=>{nt.originalEvent.stopPropagation(),Ue(!1),kn(et?{type:"listed",lat:Se.lat,lon:Se.lon,items:Se.spots||[Se]}:{type:"listed",lat:Se.lat,lon:Se.lon,items:[Se]})},children:et?k.jsx(kg,{minPrice:Se.minPrice,maxPrice:Se.maxPrice,currency:Se.currency,type:"open"}):k.jsx(Zm,{price:Se.price,currency:Se.currency,variant:"default"})},`listed-${Se.id}`)}),Rr.map(Se=>{const et=Mg(Se);return k.jsx(Pc,{longitude:Se.lon,latitude:Se.lat,anchor:"bottom",style:{willChange:"transform",zIndex:N.current?.project([Se.lon,Se.lat]).y?Math.floor(N.current.project([Se.lon,Se.lat]).y):void 0},onClick:nt=>{nt.originalEvent.stopPropagation(),Ue(!1),kn(et?{type:"area",lat:Se.lat,lon:Se.lon,items:Se.spots||[Se]}:{type:"area",lat:Se.lat,lon:Se.lon,items:[Se]})},children:et?k.jsx(kg,{minPrice:Se.minPrice,maxPrice:Se.maxPrice,currency:Se.currency,type:"area"}):k.jsx(Zm,{price:Se.price,currency:Se.currency,variant:"area"})},`area-${Se.id}`)}),ns.map(Se=>{const et=Mg(Se);return k.jsx(Pc,{longitude:Se.lon,latitude:Se.lat,anchor:"bottom",style:{willChange:"transform",zIndex:N.current?.project([Se.lon,Se.lat]).y?Math.floor(N.current.project([Se.lon,Se.lat]).y):void 0},onClick:nt=>{nt.originalEvent.stopPropagation(),Ue(!1),kn(et?{type:"area",lat:Se.lat,lon:Se.lon,items:Se.spots||[Se]}:{type:"area",lat:Se.lat,lon:Se.lon,items:[Se]})},children:et?k.jsx(kg,{minPrice:Se.minPrice,maxPrice:Se.maxPrice,currency:Se.currency,type:"no-parking"}):k.jsx(Zm,{price:Se.price,currency:Se.currency,variant:"no-parking"})},`noparking-${Se.id}`)}),(pi||lr)&&(Fn||Cn.length>0)&&k.jsx(k.Fragment,{children:(lr?Cn.length>0?Cn:Fn||[]:Fn||[]).map((Se,et)=>k.jsx(Pc,{longitude:Se.lon,latitude:Se.lat,anchor:"center",onClick:nt=>{nt.originalEvent?.preventDefault(),nt.originalEvent?.stopPropagation();const tt=Se.id;Hn(Un===tt?null:tt),Xn(Se.name||`Stop ${et+1}`)},className:"cursor-pointer",style:{zIndex:Un===Se.id?200:100},children:k.jsxs("div",{className:"relative flex flex-col items-center",children:[lr&&k.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[200]",onClick:nt=>nt.stopPropagation(),children:vn===Se.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:ni,onChange:nt=>Xn(nt.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:nt=>nt.currentTarget.select(),onKeyDown:nt=>{if(nt.key==="Enter"){const tt=Se.id;tt&&Dn(wt=>wt.map(Mn=>Mn.id===tt?{...Mn,name:ni}:Mn)),ri(null)}}}),k.jsx("button",{onClick:()=>{const nt=Se.id;nt&&Dn(tt=>tt.map(wt=>wt.id===nt?{...wt,name:ni}:wt)),ri(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:k.jsx(Jf,{size:12,strokeWidth:3})}),k.jsx("button",{onClick:()=>ri(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:k.jsx(vo,{size:12})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Se.name||`Stop ${et+1}`}),k.jsx("button",{onClick:()=>{Xn(Se.name||`Stop ${et+1}`),ri(Se.id)},className:"p-1 rounded-lg transition-colors",children:k.jsx(Vd,{size:12})}),k.jsx("button",{onClick:()=>{const nt=Se.id;nt&&Dn(tt=>tt.filter(wt=>wt.id!==nt))},className:"p-1 rounded-lg transition-colors",children:k.jsx(C_,{size:12})})]})}),k.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",style:{zIndex:10},children:et+1})]})},`wp-${Se.id||et}`))}),lr&&je.map((Se,et)=>{const nt=Cn.length+et+1;return k.jsx(Pc,{longitude:Se.lon,latitude:Se.lat,anchor:"center",onClick:tt=>{tt.originalEvent?.preventDefault(),tt.originalEvent?.stopPropagation(),Hn(Un===Se.id?null:Se.id),Xn(Se.name)},className:"cursor-pointer",style:{zIndex:Un===Se.id?2e3:1e3},children:k.jsxs("div",{className:"relative flex flex-col items-center",children:[k.jsx("div",{className:"absolute bottom-full mb-1 bg-[#1c1c1e] text-white rounded-xl shadow-2xl flex items-center gap-1 p-1.5 min-w-[max-content] border border-white/10 z-[2000]",onClick:tt=>tt.stopPropagation(),children:vn===Se.id?k.jsxs(k.Fragment,{children:[k.jsx("input",{type:"text",value:ni,onChange:tt=>Xn(tt.target.value),className:"w-28 bg-zinc-800 rounded-lg px-2 py-1 text-xs outline-none border border-zinc-600 focus:border-blue-500 transition-colors",autoFocus:!0,onFocus:tt=>tt.currentTarget.select(),onKeyDown:tt=>{tt.key==="Enter"&&(sl(Se.id,ni),ri(null))}}),k.jsx("button",{onClick:()=>{sl(Se.id,ni),ri(null)},className:"p-1 bg-green-500/20 text-green-500 hover:bg-green-500 hover:text-white rounded-lg transition-colors",children:k.jsx(Jf,{size:12,strokeWidth:3})}),k.jsx("button",{onClick:()=>ri(null),className:"p-1 bg-zinc-700 text-zinc-400 hover:bg-zinc-600 hover:text-white rounded-lg transition-colors",children:k.jsx(vo,{size:12})})]}):k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"font-semibold text-xs px-1 max-w-[120px] truncate",children:Se.name}),k.jsx("button",{onClick:()=>{Xn(Se.name),ri(Se.id)},className:"p-1 rounded-lg transition-colors",children:k.jsx(Vd,{size:12})}),k.jsx("button",{onClick:()=>Vo(Se.id),className:"p-1 rounded-lg transition-colors",children:k.jsx(C_,{size:12})})]})}),k.jsx("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] border-2 border-white shadow-md flex items-center justify-center text-white font-bold text-xs",children:nt})]})},Se.id)}),"     ",Bs.map(Se=>{const et=Mg(Se);return k.jsx(Pc,{longitude:Se.lon,latitude:Se.lat,anchor:"bottom",style:{willChange:"transform"},onClick:nt=>{nt.originalEvent.stopPropagation(),Ue(!1),kn(et?{lat:Se.lat,lon:Se.lon,type:"history",id:Se.id,items:Se.spots||[Se]}:{lat:Se.lat,lon:Se.lon,type:"history",id:Se.id,items:[Se]})},children:et?k.jsx(kg,{minPrice:Se.minPrice,maxPrice:Se.maxPrice,currency:Se.currency,type:"history"}):k.jsx(Zm,{price:Se.price,currency:Se.currency,isHistory:!0})},`history-${Se.id}`)}),ve==="parked"&&Re&&!kt&&k.jsx(Pc,{longitude:Re[1],latitude:Re[0],anchor:"bottom",children:k.jsx(N2,{vehicleType:_t})}),kt&&(kt.listingLocation||Re)&&k.jsx(Pc,{longitude:(kt.listingLocation||Re)[1],latitude:(kt.listingLocation||Re)[0],anchor:"bottom",onClick:Se=>{Se.originalEvent.stopPropagation(),Ue(!1),un(!0)},style:{zIndex:20},children:k.jsxs("div",{className:"flex flex-col items-center",children:[k.jsx("div",{className:"bg-[#34C759] p-2 rounded-full shadow-xl border-2 border-white cursor-pointer hover:scale-110 transition-transform",children:k.jsx(i2,{size:16,className:"text-white"})}),k.jsx("div",{className:"w-0.5 h-3 bg-white"})]})}),it.filter(Se=>Se.markerType==="location_pin").map((Se,et)=>k.jsx(Pc,{longitude:Se.lon,latitude:Se.lat,anchor:"bottom",style:{zIndex:90},onClick:nt=>{nt.originalEvent.stopPropagation(),le({lat:Se.lat,lon:Se.lon,name:Se.name}),kn(null)},children:k.jsxs("div",{className:"flex flex-col items-center pointer-events-auto transition-transform",children:[k.jsx("div",{className:"p-2 rounded-full bg-white dark:bg-zinc-800 border-2 border-orange-500",children:k.jsx(eo,{size:16,className:"text-orange-500"})}),k.jsx("div",{className:"w-0.5 h-2 bg-orange-500/50"})]})},Se.id||`pin-${et}`)),oe&&k.jsx(Pc,{longitude:oe.lon,latitude:oe.lat,anchor:"bottom",style:{zIndex:1e3},children:k.jsxs("div",{className:"flex flex-col items-center pointer-events-auto animate-in zoom-in-75 fade-in duration-200",onClick:Se=>{Se.stopPropagation(),Ue(!0),kn(null)},children:[ge&&k.jsxs("div",{className:"bg-white dark:bg-zinc-800 rounded-xl shadow-xl border border-black/10 dark:border-white/10 p-3 w-[240px] mb-2 relative cursor-default",onClick:Se=>Se.stopPropagation(),children:[k.jsx("button",{onClick:()=>Ue(!1),className:"absolute top-2 right-2 p-1 text-zinc-400 active:text-zinc-600 dark:active:text-zinc-300 z-10 bg-white/50 dark:bg-black/20 rounded-full",children:k.jsx(vo,{size:14})}),k.jsx("div",{className:"text-[10px] font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-wider mb-2",children:"Location Pin"}),k.jsx("div",{className:"font-semibold text-xs text-zinc-900 dark:text-white truncate",children:(/[a-zA-Z]/.test(oe.name)?oe.name.split(",")[0]:oe.name)||`${oe.lat.toFixed(5)}, ${oe.lon.toFixed(5)}`}),k.jsxs("div",{className:"mt-2",children:[(()=>{const Se=it.some(et=>et.lat===oe.lat&&et.lon===oe.lon);return k.jsx("button",{onClick:()=>{if(Se){const et=it.filter(nt=>!(nt.lat===oe.lat&&nt.lon===oe.lon));de(et),localStorage.setItem("parlens_pinned_markers",JSON.stringify(et)),le(null),Ue(!1)}else{const et={id:`location-pin-${Date.now()}`,lat:oe.lat,lon:oe.lon,name:(/[a-zA-Z]/.test(oe.name)?oe.name.split(",")[0]:oe.name)||`Pin ${oe.lat.toFixed(4)},${oe.lon.toFixed(4)}`,markerType:"location_pin"};de(nt=>[...nt,et]),localStorage.setItem("parlens_pinned_markers",JSON.stringify([...it,et]))}},className:`mt-3 w-full py-1.5 rounded-lg text-xs font-medium transition-colors ${Se?"bg-zinc-500/10 text-zinc-600 active:bg-zinc-500/20 dark:text-zinc-400":"bg-amber-500/10 text-amber-600 active:bg-amber-500/20"}`,children:Se?"Remove from Map":"Keep on Map"})})(),k.jsx("button",{onClick:()=>{const{lat:Se,lon:et,name:nt}=oe,tt=(/[a-zA-Z]/.test(nt)?nt.split(",")[0]:nt)||`Pin ${Se.toFixed(4)},${et.toFixed(4)}`;if(!it.some(Mn=>Mn.lat===Se&&Mn.lon===et)){const Mn={id:`location-pin-${Date.now()}`,lat:Se,lon:et,name:tt,markerType:"location_pin"};de(qn=>[...qn,Mn]),localStorage.setItem("parlens_pinned_markers",JSON.stringify([...it,Mn]))}le(null),tn([{lat:h?.[0]||Se,lon:h?.[1]||et,name:"Current Location"},{lat:Se,lon:et,name:tt}])},className:"mt-2 w-full py-1.5 rounded-lg text-xs font-medium bg-blue-500/10 text-blue-600 active:bg-blue-500/20 transition-colors",children:"Create Route"})]})]}),k.jsx("div",{className:"p-2 rounded-full bg-white dark:bg-zinc-800 border-2 border-orange-500",children:k.jsx(eo,{size:16,className:"text-orange-500"})}),k.jsx("div",{className:"w-0.5 h-2 bg-orange-500/50"})]})}),nn&&k.jsx(Pc,{longitude:nn.lon,latitude:nn.lat,anchor:"bottom",offset:[0,-48],style:{zIndex:1e3},children:k.jsx("div",{className:"relative",children:k.jsx(k2,{type:nn.type,items:rr,onClose:()=>kn(null),isPinned:rr.length>0&&rr.every(Se=>it.some(et=>et.id===Se.id)),onTogglePin:()=>{const Se=rr.length>0&&rr.every(nt=>it.some(tt=>tt.id===nt.id));let et;if(Se){const nt=new Set(rr.map(tt=>tt.id));et=it.filter(tt=>!nt.has(tt.id))}else{const nt=new Set(it.map(wt=>wt.id)),tt=rr.filter(wt=>!nt.has(wt.id)).map(wt=>({...wt,lat:wt.lat,lon:wt.lon,markerType:nn.type}));et=[...it,...tt]}if(de(et),localStorage.setItem("parlens_pinned_markers",JSON.stringify(et)),nn.type==="listed"&&!Se)try{const nt=new Set(JSON.parse(localStorage.getItem("parlens-saved-listings")||"[]")),tt=new Set(JSON.parse(localStorage.getItem("parlens-saved-refs")||"[]"));rr.forEach(wt=>{wt.listing_id&&nt.add(wt.listing_id),wt.listing_a_tag&&tt.add(wt.listing_a_tag)}),localStorage.setItem("parlens-saved-listings",JSON.stringify(Array.from(nt))),localStorage.setItem("parlens-saved-refs",JSON.stringify(Array.from(tt))),console.log("[Parlens] Synced pinned markers to saved listings and refs")}catch(nt){console.error("[Parlens] Failed to sync saved listings:",nt)}kn(null)},onCreateRoute:()=>{if(!(rr.length>0&&rr.every(wt=>it.some(Mn=>Mn.id===wt.id)))&&rr.length>0){const wt=new Set(it.map(Vi=>Vi.id)),Mn=rr.filter(Vi=>!wt.has(Vi.id)).map(Vi=>({...Vi,lat:Vi.lat,lon:Vi.lon,markerType:nn.type})),qn=[...it,...Mn];if(de(qn),localStorage.setItem("parlens_pinned_markers",JSON.stringify(qn)),console.log("[Parlens] Auto-pinned marker for route creation"),nn.type==="listed")try{const Vi=new Set(JSON.parse(localStorage.getItem("parlens-saved-listings")||"[]")),It=new Set(JSON.parse(localStorage.getItem("parlens-saved-refs")||"[]"));Mn.forEach(oi=>{oi.listing_id&&Vi.add(oi.listing_id),oi.listing_a_tag&&It.add(oi.listing_a_tag)}),localStorage.setItem("parlens-saved-listings",JSON.stringify(Array.from(Vi))),localStorage.setItem("parlens-saved-refs",JSON.stringify(Array.from(It))),console.log("[Parlens] Synced auto-pinned marker to saved listings and refs")}catch(Vi){console.error("[Parlens] Failed to sync saved listings:",Vi)}}const et=nn.lat,nt=nn.lon,tt=[];h&&tt.push({lat:h[0],lon:h[1],name:"Current Location"}),tt.push({lat:et,lon:nt,name:"Destination"}),Yr(null,null,[],!1),tn(tt),kn(null)},onFlagNoParking:nn.type==="area"?()=>{const Se=rr[0];if(Se){const et=Zf.encode(Se.lat,Se.lon,7),nt=Nn.has(et);qs(rr,nt)}}:void 0,isFlaggedByUser:nn.type==="area"?(()=>{const Se=rr[0];if(Se){const et=Zf.encode(Se.lat,Se.lon,7);return Nn.has(et)}return!1})():void 0,noParkingFlagCount:nn.type==="area"?(()=>{const Se=rr[0];if(Se){const et=Zf.encode(Se.lat,Se.lon,7);return En.get(et)||0}return 0})():void 0,isFlagging:wi})})}),Qt&&kt&&k.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in",onClick:()=>un(!1),children:k.jsxs("div",{className:"bg-white dark:bg-[#1c1c1e] w-full max-w-sm rounded-[2rem] shadow-2xl p-6 space-y-6 relative border border-black/5 dark:border-white/10",onClick:Se=>Se.stopPropagation(),children:[k.jsx("button",{onClick:()=>un(!1),className:"absolute top-4 right-4 p-2 rounded-full text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/60",children:k.jsx(vo,{size:24})}),k.jsxs("div",{className:"text-center space-y-1",children:[k.jsx("div",{className:"text-xs font-bold uppercase text-zinc-400 tracking-wider",children:"Active Session"}),k.jsx("h2",{className:"text-2xl font-bold dark:text-white leading-tight",children:kt.listingName||"Parking Spot"}),k.jsx("div",{className:"text-lg text-blue-500 font-bold",children:kt.shortName||`#${kt.spotNumber}`}),kt.floor&&k.jsx("div",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:kt.floor})]}),k.jsx("div",{className:"space-y-4",children:k.jsx("div",{className:"p-6 bg-zinc-50 dark:bg-white/5 rounded-3xl flex justify-center border border-black/5 dark:border-white/5",children:k.jsx(k1,{value:JSON.stringify({a:kt.spotATag,authorizer:kt.authorizer}),size:180,level:"M",bgColor:"transparent",fgColor:"currentColor",className:"text-black dark:text-white"})})}),k.jsx("button",{onClick:()=>un(!1),className:"w-full py-4 bg-zinc-100 dark:bg-white/10 text-zinc-900 dark:text-white font-bold rounded-2xl",children:"Close"})]})}),h&&he!=="auto"&&k.jsx(Pc,{longitude:h[1],latitude:h[0],anchor:"center",style:{zIndex:1e3},children:k.jsx(By,{bearing:Ma,mapBearing:ji.bearing,isNavigationMode:!1})})]}),k.jsxs("div",{className:`absolute top-4 left-1/2 -translate-x-1/2 z-[1000] flex items-center gap-2 transition-all duration-300 pointer-events-none ${ve!=="idle"?"opacity-100":""}`,children:[ve==="search"&&k.jsxs("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:[k.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500/30 border-t-blue-500 rounded-full"}),k.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white whitespace-nowrap",children:"Searching for spots..."})]}),ve==="parked"&&k.jsxs("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:[k.jsx("div",{className:"w-4 h-4 rounded-full bg-green-500 shadow-md"}),k.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white",children:"Session Active"})]}),ve==="idle"&&!lr&&!li&&k.jsx("div",{className:"bg-white dark:bg-zinc-800 shadow-lg rounded-full px-4 py-2 flex items-center gap-2 border border-black/5 dark:border-white/10 animate-in fade-in zoom-in slide-in-from-top-4 pointer-events-auto",children:k.jsxs("button",{onClick:()=>Ei(!0),className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[k.jsx("div",{className:"w-4 h-4 rounded-full bg-[#007AFF] shadow-sm"}),k.jsx("span",{className:"text-sm font-medium text-zinc-900 dark:text-white whitespace-nowrap",children:"Search for Parking"})]})})]}),lr&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1600]",children:k.jsxs("div",{className:"relative flex items-center justify-center",children:[k.jsx("div",{className:"absolute w-8 h-8 rounded-full bg-orange-500/10 dark:bg-orange-400/10 animate-pulse"}),k.jsx("div",{className:"w-1.5 h-1.5 bg-orange-500 rounded-full shadow-sm z-10"}),k.jsx("div",{className:"absolute w-6 h-[1.5px] bg-orange-500/60 rounded-full"}),k.jsx("div",{className:"absolute h-6 w-[1.5px] bg-orange-500/60 rounded-full"})]})}),k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 translate-y-12 z-[1500]",children:k.jsxs("button",{onClick:Ba,className:"bg-white dark:bg-zinc-800 text-orange-500 px-6 py-2.5 rounded-full font-bold text-sm shadow-xl backdrop-blur-md active:scale-95 transition-all flex items-center gap-2 border border-black/5 dark:border-white/10",children:[k.jsx(eo,{size:16,className:"fill-current"}),"Drop Pin Here"]})}),k.jsx("div",{className:"absolute top-4 right-4 z-[2000] animate-in slide-in-from-top-4 fade-in",children:k.jsxs("button",{onClick:Pt,className:"bg-gradient-to-r from-amber-500 to-orange-500 text-white px-6 py-2.5 rounded-full font-bold shadow-lg shadow-amber-500/30 flex items-center gap-2 transition-transform active:scale-95",children:[k.jsx(Jf,{size:18,strokeWidth:3}),"Done"]})})]})]}),k.jsxs("div",{className:`absolute z-[1000] flex flex-col items-start gap-3 animate-in slide-in-from-left-6 transition-opacity duration-300 pointer-events-none ${lr||li?"opacity-0":"opacity-100"}`,style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",left:"max(1rem, env(safe-area-inset-left))"},children:[k.jsx(D2,{vehicleType:_t,onVehicleChange:Ui,disabled:ve!=="idle"}),k.jsx("button",{onClick:()=>c?.(),onContextMenu:Se=>{Se.preventDefault();const et=prompt("Enter Parking Code manually:");et&&qe(et)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95 pointer-events-auto",title:"Scan QR Code (Long press for manual)",children:k.jsx("div",{className:"relative",children:k.jsx(lT,{size:20})})}),k.jsx("button",{onClick:()=>{if(ve==="search"){alert("Please cancel the active search to view Listed Parking.");return}rt(!0)},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md border border-black/5 dark:border-white/10 shadow-lg text-zinc-600 dark:text-white/70 transition-all active:scale-95 pointer-events-auto",title:"Listed Parking",children:k.jsx("span",{className:"text-3xl font-light leading-none pb-1",children:""})})]}),k.jsxs("div",{className:`absolute z-[1000] flex flex-col items-end gap-3 animate-in slide-in-from-right-6 transition-opacity duration-300 pointer-events-none ${li?"opacity-0":"opacity-100"}`,style:{bottom:"max(1.5rem, calc(env(safe-area-inset-bottom) + 0.5rem))",right:"max(1rem, env(safe-area-inset-right))"},children:[Math.abs(ji.bearing)>5&&he!=="auto"&&k.jsx("button",{onClick:()=>{const Se=N.current?.getBearing()||0,et=Math.round(Se/360)*360;N.current?.rotateTo(et,{duration:400}),Nr(nt=>({...nt,pitch:0}))},className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 pointer-events-auto",title:"Reset to true north",children:k.jsxs("div",{className:"flex flex-col items-center justify-center",style:{transform:`rotate(${-ji.bearing}deg)`},children:[k.jsx("div",{style:{width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"10px solid rgb(239 68 68)"}}),k.jsx("span",{className:"text-sm font-bold text-zinc-600 dark:text-white/70",style:{marginTop:"-2px"},children:"N"})]})}),k.jsx("button",{onClick:async()=>{if(Ne){await ol();return}if(Li(""),Di([]),lr){h&&N.current?.flyTo({center:[h[1],h[0]],zoom:17,duration:800,essential:!0});return}N.current?.stop(),gi.current=!1;const Se=ji.zoom,et=17;if(Fe){if(h){const nt=Se<et?et:Se;gi.current=!0,N.current?.flyTo({center:[h[1],h[0]],zoom:nt,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1})}De("recentre"),St(!1);return}if((he==="fixed"||he==="recentre")&&h&&(gi.current=!0,N.current?.flyTo({center:[h[1],h[0]],zoom:Se<et?et:Se,bearing:Math.round((N.current?.getBearing()||0)/360)*360,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1,he==="fixed"&&De("recentre")})),he==="recentre"){if(ve==="parked"){gi.current=!0,N.current?.flyTo({bearing:Math.round((N.current?.getBearing()||0)/360)*360,pitch:0,zoom:16.5,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1}),De("fixed");return}const nt=Ma||0;gi.current=!0,Xe(!0),N.current?.rotateTo(nt,{duration:800}),N.current?.once("moveend",()=>{gi.current=!1,Xe(!1),Y.current.reset(nt),De("auto")});return}De(nt=>{if(nt==="auto"){const tt=N.current?.getBearing()||0,wt=Math.round(tt/360)*360;return gi.current=!0,N.current?.flyTo({bearing:wt,pitch:0,zoom:16.5,duration:800,essential:!0}),N.current?.once("moveend",()=>{gi.current=!1}),Xe(!1),"fixed"}return"recentre"})},className:`h-12 w-12 flex items-center justify-center rounded-[1.5rem] backdrop-blur-md transition-all active:scale-95 border shadow-lg pointer-events-auto ${Ne?"bg-orange-500/20 border-orange-500/50 text-orange-500 animate-pulse":"bg-white/80 dark:bg-zinc-800/80 border-black/5 dark:border-white/10 text-zinc-600 dark:text-white/70"}`,children:Ne?k.jsx(Gm,{size:20,className:"text-orange-500 animate-pulse"}):lr?k.jsx(Gm,{size:20,className:"text-zinc-600 dark:text-white/70"}):he==="auto"||Je?k.jsx(T3,{size:20,className:"text-blue-500"}):he==="recentre"?k.jsx(Gm,{size:20,fill:"currentColor",className:"text-green-500"}):k.jsx(Gm,{size:20,className:`text-zinc-600 dark:text-white/70 ${Fe?"opacity-50":""}`})}),!lr&&k.jsx("button",{onClick:()=>Gn(!0),className:"h-12 w-12 flex items-center justify-center rounded-[1.5rem] bg-white/80 dark:bg-zinc-800/80 backdrop-blur-md text-zinc-600 dark:text-white/70 active:scale-95 transition-all shadow-lg border border-black/5 dark:border-white/10 pointer-events-auto",title:"Create Route",children:k.jsx(r2,{size:20})}),k.jsx("div",{className:`relative z-[1010] pointer-events-auto ${lr?"hidden":"block"}`,children:k.jsx(A4,{setHistorySpots:sn,onHelpClick:()=>Wt(!0)})}),k.jsx("div",{className:lr?"hidden":"block",children:k.jsx(d4,{status:ve,setStatus:pe,searchLocation:oe?[oe.lat,oe.lon]:ve==="search"?an||[ji.latitude,ji.longitude]:h,userLocation:h,vehicleType:_t,setOpenSpots:vt,parkLocation:Re,setParkLocation:ct,sessionStart:Ti,setSessionStart:jn,listedParkingSession:kt,onQRScan:c,onSpotStatusUpdate:zi})})]}),k.jsx("div",{className:lr?"hidden":"block",children:k.jsx(E4,{vehicleType:_t,onRouteChange:Yr,currentLocation:h,onDropPinModeChange:Ke,pendingWaypoints:Yt,onDropPinConsumed:()=>tn(null),onOpenChange:Zi,onWaypointsChange:Dn,onRequestOrientationPermission:ol,isOpen:Yn,onClose:()=>Gn(!1),hideTrigger:!0,onRouteCreated:()=>{ve==="search"&&(pe("idle"),vt([]))}})}),mt&&k.jsxs("div",{className:"fixed inset-0 z-[2000] flex flex-col items-center justify-start bg-black/60 backdrop-blur-xl pt-2 px-4 pb-4 animate-in fade-in",children:[k.jsx("button",{onClick:()=>Wt(!1),className:"absolute inset-0 z-0 cursor-default"}),k.jsxs("div",{className:"relative z-10 w-full max-w-md bg-white dark:bg-[#1c1c1e] rounded-[2rem] border border-black/5 dark:border-white/5 shadow-2xl p-6 space-y-6 animate-in slide-in-from-bottom-10 duration-300 h-[calc(100vh-1.5rem)] overflow-y-auto no-scrollbar transition-colors",style:{overscrollBehaviorY:"contain"},children:[k.jsx("button",{onClick:()=>Wt(!1),className:"absolute top-6 right-6 p-2 rounded-full bg-black/5 dark:bg-white/10 text-zinc-600 dark:text-white/60 active:scale-95 transition-transform",children:k.jsx(Ax,{size:20})}),k.jsxs("div",{className:"text-center space-y-2 pt-4",children:[k.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4",children:k.jsx("span",{className:"text-3xl font-bold",children:"?"})}),k.jsx("h2",{className:"text-2xl font-bold text-zinc-900 dark:text-white",children:"How to use Parlens"}),k.jsx("p",{className:"text-sm text-zinc-500 dark:text-zinc-400",children:"Decentralised Parking Management"})]}),k.jsxs("div",{className:"space-y-3",children:[k.jsx("h3",{className:"text-center font-bold text-zinc-600 dark:text-white/90",children:"Add to your homescreen"}),k.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[k.jsxs("button",{onClick:()=>{document.getElementById("android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Browser Menu (Android)"}),k.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsxs("div",{id:"android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:[k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white",children:"Chrome & Brave:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add to Home screen"})]}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add"})," to confirm"]})]}),k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white mt-3",children:"Firefox:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Install"})]})]})]})]}),k.jsxs("div",{className:"rounded-2xl bg-zinc-100 dark:bg-white/5",children:[k.jsxs("button",{onClick:()=>{document.getElementById("ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-zinc-200 transition-colors rounded-2xl",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Share Button (iOS)"}),k.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsx("div",{id:"ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/70 space-y-2",children:k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsxs("li",{children:["Tap the ",k.jsx("strong",{children:"Share"})," button in Safari menu bar."]}),k.jsxs("li",{children:["Scroll down and tap ",k.jsx("strong",{children:"Add to Home Screen"}),"."]}),k.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]}),k.jsxs("div",{className:"space-y-4 text-sm text-zinc-600 dark:text-white/80 leading-relaxed pt-4 border-t border-black/5 dark:border-white/10",children:[k.jsxs("div",{children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Seekers"}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select Vehicle Type"}),"Use the vertical toggle to switch between Bicycle , Motorcycle , or Car . Your vehicle type determines what parking spots you see on the map."]}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Find Parking"}),"Click the blue search button to find parking around you or plan ahead by searching for parking near your destination by clicking the search for parking bubble at the top of your screen."]}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Mark Your Spot"}),"Once you find a spot, click the amber parking location button to mark your parked location and start your session. Click the session active bubble centre the map your parking marker at any time during the session."]}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Log Your Session"}),"When youre ready to leave, click the green vehicle button to remove the marker, report the fees and log the session in your parking history."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Share Parking Reports (Optional)"}),"Anonymously report parking details to help other users know where to find parking; and build more parking features in the future. The opt-in switch is available in the parking areas section on the profile page."]})]}),k.jsxs("div",{className:"mt-8 pt-4",children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Service Providers"}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Listed Parking"}),"Users who oversee one or more parking spots can create a listing to simplify spot discovery and management. Click the parking services button () and select listed parking.",k.jsx("br",{}),k.jsx("br",{}),"Click the + button to create a listing and provide the details as requested in the form to create one or more online spots to match your real world location."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Valet Parking"}),"Users who park for others can enable valet mode to manage multiple parking sessions at the same time. Click the parking services button () and select valet parking to get started.",k.jsx("br",{}),k.jsx("br",{}),"Click the + button to create a new valet session. Ask your clients to scan the QR code using the Parlens app to see the parking location and let you know when theyre ready to leave."]})]}),k.jsxs("div",{className:"mt-6 pt-4 space-y-6",children:[k.jsxs("div",{children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"User Privacy"}),k.jsx("p",{className:"mb-4",children:"Parlens does not collect or share any personal data. Parking history and saved routes are encrypted by your keys and only accessible by you. If you ever feel like your privacy is compromised, delete your account, abandon your keys and create a new account."})]}),k.jsxs("div",{children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"License"}),k.jsx("p",{children:"This project is licensed under the GNU General Public License v3.0."})]})]})]})]})]}),Rn&&k.jsx("div",{className:"fixed top-0 left-0 right-0 z-[1800] flex flex-col items-center px-4 pt-16 pointer-events-none animate-in fade-in",children:k.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl border border-black/10 dark:border-white/10 overflow-hidden pointer-events-auto",children:[k.jsxs("div",{className:"flex items-center gap-2 p-3 border-b border-zinc-200 dark:border-white/10",children:[k.jsxs("div",{className:"flex-1 flex items-center h-12 bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 rounded-xl overflow-hidden focus-within:ring-2 focus-within:ring-blue-500",children:[k.jsx("input",{type:"text",value:on,onChange:Se=>Fi(Se.target.value),placeholder:"Search for parking near...",className:"flex-1 h-full bg-transparent px-4 text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/40 text-base focus:outline-none",autoFocus:!0}),k.jsx("button",{onClick:()=>{Ei(!1),Li(""),Di([]),yt(!0),Ke(!0)},className:"px-3 h-full flex items-center text-orange-500 hover:bg-orange-500/10 transition-colors",title:"Drop Pin",children:k.jsx(eo,{size:18})})]}),k.jsx("button",{onClick:()=>{Ei(!1),Li(""),Di([])},className:"p-2 text-zinc-400 hover:text-zinc-600 dark:text-white/40 dark:hover:text-white/80",children:k.jsx(vo,{size:20})})]}),(Dl(on)||At.length>0||tr.length>0)&&k.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[k.jsxs("div",{className:"px-4 py-2 bg-zinc-50 dark:bg-white/5 border-b border-black/5 dark:border-white/5 flex items-center gap-2 overflow-x-auto",children:[Dl(on)&&k.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 dark:from-blue-500/20 dark:to-cyan-500/20 text-[10px] font-bold text-blue-600 dark:text-blue-300 uppercase tracking-wider border border-blue-200 dark:border-blue-500/20",children:Dl(on)?.type==="plus_code"?"Plus Code":"Coordinate"}),At.length>0&&k.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-emerald-500/10 to-teal-500/10 dark:from-emerald-500/20 dark:to-teal-500/20 text-[10px] font-bold text-emerald-600 dark:text-emerald-300 uppercase tracking-wider border border-emerald-200 dark:border-emerald-500/20",children:"Saved Places"}),tr.length>0&&k.jsx("span",{className:"shrink-0 inline-block px-2.5 py-1 rounded-lg bg-gradient-to-r from-violet-500/10 to-fuchsia-500/10 dark:from-violet-500/20 dark:to-fuchsia-500/20 text-[10px] font-bold text-violet-600 dark:text-violet-300 uppercase tracking-wider border border-violet-200 dark:border-violet-500/20",children:"OSM Search"})]}),Dl(on)&&k.jsxs("button",{onClick:()=>{const Se=Dl(on);Se&&Wr({lat:String(Se.lat),lon:String(Se.lon),display_name:`${Se.lat.toFixed(6)}, ${Se.lon.toFixed(6)}`})},className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-blue-50 dark:bg-blue-500/10 text-blue-500 group-hover:text-blue-600 dark:group-hover:text-blue-400 shrink-0 transition-colors",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsxs("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:[Dl(on)?.lat.toFixed(6),", ",Dl(on)?.lon.toFixed(6)]}),k.jsx("div",{className:"text-[10px] text-zinc-400 dark:text-white/40 mt-0.5 uppercase tracking-wider",children:Dl(on)?.type==="plus_code"?"Plus Code":"Coordinate"})]})]}),At.map((Se,et)=>k.jsxs("button",{onClick:()=>Wr({lat:String(Se.lat),lon:String(Se.lon),display_name:Se.name}),className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-500 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 shrink-0 transition-colors",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Se.name}),k.jsx("div",{className:"text-[10px] text-zinc-400 dark:text-white/40 mt-0.5 uppercase tracking-wider",children:"Saved Waypoint"})]})]},`saved-${et}`)),tr.map((Se,et)=>k.jsxs("button",{onClick:()=>Wr(Se),className:"w-full flex items-start gap-3 p-4 text-left hover:bg-zinc-50 dark:hover:bg-white/5 active:bg-zinc-100 transition-colors border-t border-black/5 dark:border-white/5 first:border-t-0 group",children:[k.jsx("div",{className:"mt-0.5 p-2 rounded-full shrink-0 transition-colors bg-violet-50 dark:bg-violet-500/10 text-violet-500 group-hover:text-violet-600 dark:group-hover:text-violet-400",children:k.jsx(eo,{size:16})}),k.jsxs("div",{className:"flex-1 min-w-0",children:[k.jsx("div",{className:"text-sm font-semibold text-zinc-900 dark:text-white truncate",children:Se.display_name?.split(",")[0]}),k.jsx("div",{className:"text-xs text-zinc-500 dark:text-white/60 truncate",children:Se.display_name?.split(",").slice(1).join(",")})]})]},`osm-${et}`))]})]})}),k.jsx("div",{style:{display:Et&&!li?"block":"none"},children:Et&&k.jsx(j4,{onClose:()=>rt(!1),currentLocation:h,countryCode:es,onPickLocation:()=>Hi(!0),pickedLocation:Tr,routeWaypoints:Fn||void 0})}),li&&k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-[1500]",children:k.jsxs("div",{className:"relative",children:[k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-4 bg-black/50"}),k.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-1 bg-black/50"}),k.jsx("div",{className:"w-8 h-8 border-2 border-amber-500 rounded-full flex items-center justify-center bg-white/20 backdrop-blur-sm shadow-xl animate-in zoom-in spin-in-180 duration-500",children:k.jsx(eo,{size:16,className:"text-amber-600 fill-current"})})]})}),k.jsxs("div",{className:"absolute bottom-10 left-0 right-0 z-[2000] flex justify-center gap-4 px-4 pb-safe animate-in slide-in-from-bottom",children:[k.jsx("button",{onClick:()=>Hi(!1),className:"px-6 py-3 rounded-full bg-white text-zinc-900 font-bold shadow-lg",children:"Cancel"}),k.jsx("button",{onClick:()=>{Qn({lat:ji.latitude,lon:ji.longitude}),Hi(!1)},className:"px-6 py-3 rounded-full bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold shadow-lg shadow-amber-500/30",children:"Confirm Location"})]})]}),Zt&&k.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/60 backdrop-blur-xl animate-in fade-in duration-300 p-4",children:k.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-[#1c1c1e] rounded-[2rem] shadow-2xl p-6 flex flex-col items-center space-y-5 animate-in zoom-in-95 border border-black/5 dark:border-white/10 transition-colors",children:[k.jsxs("div",{className:"text-center space-y-1",children:[k.jsx("h3",{className:"text-2xl font-bold tracking-tight text-zinc-900 dark:text-white",children:"End Session"}),k.jsx("p",{className:"text-xs font-medium text-zinc-500 dark:text-white/40",children:"Enter total parking fee"})]}),k.jsxs("div",{className:"flex items-center gap-4",children:[k.jsxs("div",{className:"flex items-center gap-3 bg-zinc-100 dark:bg-white/5 px-5 py-4 rounded-[1.5rem] border border-black/5 dark:border-white/5",children:[k.jsx("span",{className:"text-2xl font-bold text-blue-500",children:(bi?.session?.currency||kt?.currency)==="INR"?"":(bi?.session?.currency||kt?.currency)==="EUR"?"":(bi?.session?.currency||kt?.currency)==="GBP"?"":"$"}),k.jsx("input",{type:"number",value:ln,onChange:Se=>yi(Se.target.value),autoFocus:!0,className:"w-20 bg-transparent text-4xl font-black text-center text-zinc-900 dark:text-white focus:outline-none placeholder:text-zinc-300 dark:placeholder:text-white/10 appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none [-moz-appearance:textfield]",min:"0"}),k.jsx("span",{className:"text-sm font-bold text-zinc-400 dark:text-white/20",children:bi?.session?.currency||kt?.currency||"USD"})]}),k.jsxs("div",{className:"flex flex-col gap-1.5",children:[k.jsx("button",{onClick:()=>yi(String(Math.max(0,parseFloat(ln||"0")+1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(T1,{size:22,className:"text-zinc-600 dark:text-white/70"})}),k.jsx("button",{onClick:()=>yi(String(Math.max(0,parseFloat(ln||"0")-1))),className:"h-10 w-10 rounded-xl bg-zinc-100 dark:bg-white/10 active:scale-95 transition-all flex items-center justify-center",children:k.jsx(Fd,{size:22,className:"text-zinc-600 dark:text-white/70"})})]})]}),k.jsxs("div",{className:"w-full space-y-3",children:[k.jsx("input",{type:"text",value:Bi,onChange:Se=>_i(Se.target.value),placeholder:"Add a note (optional)",className:"w-full px-4 py-3 bg-zinc-100 dark:bg-white/5 rounded-xl text-zinc-900 dark:text-white placeholder:text-zinc-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"}),k.jsxs("button",{onClick:xt,className:"w-full h-14 rounded-[1.5rem] bg-[#007AFF] text-white text-lg font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:["Log Parking ",k.jsx(e2,{size:20})]}),k.jsx("button",{onClick:()=>{ki(!1),mi(null),yi("0"),_i("")},className:"w-full text-xs font-bold text-zinc-400 dark:text-white/30 tracking-widest uppercase py-3 transition-colors",children:"Cancel"})]})]})})]})};var fi;(function(c){c[c.QR_CODE=0]="QR_CODE",c[c.AZTEC=1]="AZTEC",c[c.CODABAR=2]="CODABAR",c[c.CODE_39=3]="CODE_39",c[c.CODE_93=4]="CODE_93",c[c.CODE_128=5]="CODE_128",c[c.DATA_MATRIX=6]="DATA_MATRIX",c[c.MAXICODE=7]="MAXICODE",c[c.ITF=8]="ITF",c[c.EAN_13=9]="EAN_13",c[c.EAN_8=10]="EAN_8",c[c.PDF_417=11]="PDF_417",c[c.RSS_14=12]="RSS_14",c[c.RSS_EXPANDED=13]="RSS_EXPANDED",c[c.UPC_A=14]="UPC_A",c[c.UPC_E=15]="UPC_E",c[c.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(fi||(fi={}));var Z_=new Map([[fi.QR_CODE,"QR_CODE"],[fi.AZTEC,"AZTEC"],[fi.CODABAR,"CODABAR"],[fi.CODE_39,"CODE_39"],[fi.CODE_93,"CODE_93"],[fi.CODE_128,"CODE_128"],[fi.DATA_MATRIX,"DATA_MATRIX"],[fi.MAXICODE,"MAXICODE"],[fi.ITF,"ITF"],[fi.EAN_13,"EAN_13"],[fi.EAN_8,"EAN_8"],[fi.PDF_417,"PDF_417"],[fi.RSS_14,"RSS_14"],[fi.RSS_EXPANDED,"RSS_EXPANDED"],[fi.UPC_A,"UPC_A"],[fi.UPC_E,"UPC_E"],[fi.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),X_;(function(c){c[c.UNKNOWN=0]="UNKNOWN",c[c.URL=1]="URL"})(X_||(X_={}));function q4(c){return Object.values(fi).includes(c)}var c1;(function(c){c[c.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",c[c.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(c1||(c1={}));var Z4=(function(){function c(){}return c.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",c.SCAN_DEFAULT_FPS=2,c.DEFAULT_DISABLE_FLIP=!1,c.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,c.DEFAULT_SUPPORTED_SCAN_TYPE=[c1.SCAN_TYPE_CAMERA,c1.SCAN_TYPE_FILE],c})(),R2=(function(){function c(d,y){this.format=d,this.formatName=y}return c.prototype.toString=function(){return this.formatName},c.create=function(d){if(!Z_.has(d))throw"".concat(d," not in html5QrcodeSupportedFormatsTextMap");return new c(d,Z_.get(d))},c})(),W_=(function(){function c(){}return c.createFromText=function(d){var y={text:d};return{decodedText:d,result:y}},c.createFromQrcodeResult=function(d){return{decodedText:d.text,result:d}},c})(),Fy;(function(c){c[c.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",c[c.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",c[c.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Fy||(Fy={}));var X4=(function(){function c(){}return c.createFrom=function(d){return{errorMessage:d,type:Fy.UNKWOWN_ERROR}},c})(),W4=(function(){function c(d){this.verbose=d}return c.prototype.log=function(d){this.verbose&&console.log(d)},c.prototype.warn=function(d){this.verbose&&console.warn(d)},c.prototype.logError=function(d,y){(this.verbose||y===!0)&&console.error(d)},c.prototype.logErrors=function(d){if(d.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(d)},c})();function Lh(c){return typeof c>"u"||c===null}var p0=(function(){function c(){}return c.codeParseError=function(d){return"QR code parse error, error = ".concat(d)},c.errorGettingUserMedia=function(d){return"Error getting userMedia, error = ".concat(d)},c.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},c.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},c.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},c.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},c.scannerPaused=function(){return"Scanner paused"},c})(),P2=(function(){function c(){}return c.isMediaStreamConstraintsValid=function(d,y){if(typeof d!="object"){var C=typeof d;return y.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(C,"."),!0),!1}for(var D=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],P=new Set(D),N=Object.keys(d),h=0,U=N;h<U.length;h++){var H=U[h];if(P.has(H))return y.logError("".concat(H," is not supported videoConstaints."),!0),!1}return!0},c})(),Ng={exports:{}},Y4=Ng.exports,Y_;function $4(){return Y_||(Y_=1,(function(c,d){(function(y,C){C(d)})(Y4,(function(y){function C(ce){return ce==null}var D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ce,a){ce.__proto__=a}||function(ce,a){for(var u in a)a.hasOwnProperty(u)&&(ce[u]=a[u])};function P(ce,a){D(ce,a);function u(){this.constructor=ce}ce.prototype=a===null?Object.create(a):(u.prototype=a.prototype,new u)}function N(ce,a){var u=Object.setPrototypeOf;u?u(ce,a):ce.__proto__=a}function h(ce,a){a===void 0&&(a=ce.constructor);var u=Error.captureStackTrace;u&&u(ce,a)}var U=(function(ce){P(a,ce);function a(u){var g=this.constructor,v=ce.call(this,u)||this;return Object.defineProperty(v,"name",{value:g.name,enumerable:!1}),N(v,g.prototype),h(v),v}return a})(Error);class H extends U{constructor(a=void 0){super(a),this.message=a}getKind(){return this.constructor.kind}}H.kind="Exception";class Y extends H{}Y.kind="ArgumentException";class K extends H{}K.kind="IllegalArgumentException";class _e{constructor(a){if(this.binarizer=a,a===null)throw new K("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(a,u){return this.binarizer.getBlackRow(a,u)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(a,u,g,v){const w=this.binarizer.getLuminanceSource().crop(a,u,g,v);return new _e(this.binarizer.createBinarizer(w))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const a=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new _e(this.binarizer.createBinarizer(a))}rotateCounterClockwise45(){const a=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new _e(this.binarizer.createBinarizer(a))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class we extends H{static getChecksumInstance(){return new we}}we.kind="ChecksumException";class ve{constructor(a){this.source=a}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class pe{static arraycopy(a,u,g,v,w){for(;w--;)g[v++]=a[u++]}static currentTimeMillis(){return Date.now()}}class he extends H{}he.kind="IndexOutOfBoundsException";class De extends he{constructor(a=void 0,u=void 0){super(u),this.index=a,this.message=u}}De.kind="ArrayIndexOutOfBoundsException";class Je{static fill(a,u){for(let g=0,v=a.length;g<v;g++)a[g]=u}static fillWithin(a,u,g,v){Je.rangeCheck(a.length,u,g);for(let w=u;w<g;w++)a[w]=v}static rangeCheck(a,u,g){if(u>g)throw new K("fromIndex("+u+") > toIndex("+g+")");if(u<0)throw new De(u);if(g>a)throw new De(g)}static asList(...a){return a}static create(a,u,g){return Array.from({length:a}).map(w=>Array.from({length:u}).fill(g))}static createInt32Array(a,u,g){return Array.from({length:a}).map(w=>Int32Array.from({length:u}).fill(g))}static equals(a,u){if(!a||!u||!a.length||!u.length||a.length!==u.length)return!1;for(let g=0,v=a.length;g<v;g++)if(a[g]!==u[g])return!1;return!0}static hashCode(a){if(a===null)return 0;let u=1;for(const g of a)u=31*u+g;return u}static fillUint8Array(a,u){for(let g=0;g!==a.length;g++)a[g]=u}static copyOf(a,u){return a.slice(0,u)}static copyOfUint8Array(a,u){if(a.length<=u){const g=new Uint8Array(u);return g.set(a),g}return a.slice(0,u)}static copyOfRange(a,u,g){const v=g-u,w=new Int32Array(v);return pe.arraycopy(a,u,w,0,v),w}static binarySearch(a,u,g){g===void 0&&(g=Je.numberComparator);let v=0,w=a.length-1;for(;v<=w;){const I=w+v>>1,O=g(u,a[I]);if(O>0)v=I+1;else if(O<0)w=I-1;else return I}return-v-1}static numberComparator(a,u){return a-u}}class Xe{static numberOfTrailingZeros(a){let u;if(a===0)return 32;let g=31;return u=a<<16,u!==0&&(g-=16,a=u),u=a<<8,u!==0&&(g-=8,a=u),u=a<<4,u!==0&&(g-=4,a=u),u=a<<2,u!==0&&(g-=2,a=u),g-(a<<1>>>31)}static numberOfLeadingZeros(a){if(a===0)return 32;let u=1;return a>>>16||(u+=16,a<<=16),a>>>24||(u+=8,a<<=8),a>>>28||(u+=4,a<<=4),a>>>30||(u+=2,a<<=2),u-=a>>>31,u}static toHexString(a){return a.toString(16)}static toBinaryString(a){return String(parseInt(String(a),2))}static bitCount(a){return a=a-(a>>>1&1431655765),a=(a&858993459)+(a>>>2&858993459),a=a+(a>>>4)&252645135,a=a+(a>>>8),a=a+(a>>>16),a&63}static truncDivision(a,u){return Math.trunc(a/u)}static parseInt(a,u=void 0){return parseInt(a,u)}}Xe.MIN_VALUE_32_BITS=-2147483648,Xe.MAX_VALUE=Number.MAX_SAFE_INTEGER;class mt{constructor(a,u){a===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=a,u==null?this.bits=mt.makeArray(a):this.bits=u)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(a){if(a>this.bits.length*32){const u=mt.makeArray(a);pe.arraycopy(this.bits,0,u,0,this.bits.length),this.bits=u}}get(a){return(this.bits[Math.floor(a/32)]&1<<(a&31))!==0}set(a){this.bits[Math.floor(a/32)]|=1<<(a&31)}flip(a){this.bits[Math.floor(a/32)]^=1<<(a&31)}getNextSet(a){const u=this.size;if(a>=u)return u;const g=this.bits;let v=Math.floor(a/32),w=g[v];w&=~((1<<(a&31))-1);const I=g.length;for(;w===0;){if(++v===I)return u;w=g[v]}const O=v*32+Xe.numberOfTrailingZeros(w);return O>u?u:O}getNextUnset(a){const u=this.size;if(a>=u)return u;const g=this.bits;let v=Math.floor(a/32),w=~g[v];w&=~((1<<(a&31))-1);const I=g.length;for(;w===0;){if(++v===I)return u;w=~g[v]}const O=v*32+Xe.numberOfTrailingZeros(w);return O>u?u:O}setBulk(a,u){this.bits[Math.floor(a/32)]=u}setRange(a,u){if(u<a||a<0||u>this.size)throw new K;if(u===a)return;u--;const g=Math.floor(a/32),v=Math.floor(u/32),w=this.bits;for(let I=g;I<=v;I++){const O=I>g?0:a&31,q=(2<<(I<v?31:u&31))-(1<<O);w[I]|=q}}clear(){const a=this.bits.length,u=this.bits;for(let g=0;g<a;g++)u[g]=0}isRange(a,u,g){if(u<a||a<0||u>this.size)throw new K;if(u===a)return!0;u--;const v=Math.floor(a/32),w=Math.floor(u/32),I=this.bits;for(let O=v;O<=w;O++){const F=O>v?0:a&31,te=(2<<(O<w?31:u&31))-(1<<F)&4294967295;if((I[O]&te)!==(g?te:0))return!1}return!0}appendBit(a){this.ensureCapacity(this.size+1),a&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(a,u){if(u<0||u>32)throw new K("Num bits must be between 0 and 32");this.ensureCapacity(this.size+u);for(let g=u;g>0;g--)this.appendBit((a>>g-1&1)===1)}appendBitArray(a){const u=a.size;this.ensureCapacity(this.size+u);for(let g=0;g<u;g++)this.appendBit(a.get(g))}xor(a){if(this.size!==a.size)throw new K("Sizes don't match");const u=this.bits;for(let g=0,v=u.length;g<v;g++)u[g]^=a.bits[g]}toBytes(a,u,g,v){for(let w=0;w<v;w++){let I=0;for(let O=0;O<8;O++)this.get(a)&&(I|=1<<7-O),a++;u[g+w]=I}}getBitArray(){return this.bits}reverse(){const a=new Int32Array(this.bits.length),u=Math.floor((this.size-1)/32),g=u+1,v=this.bits;for(let w=0;w<g;w++){let I=v[w];I=I>>1&1431655765|(I&1431655765)<<1,I=I>>2&858993459|(I&858993459)<<2,I=I>>4&252645135|(I&252645135)<<4,I=I>>8&16711935|(I&16711935)<<8,I=I>>16&65535|(I&65535)<<16,a[u-w]=I}if(this.size!==g*32){const w=g*32-this.size;let I=a[0]>>>w;for(let O=1;O<g;O++){const F=a[O];I|=F<<32-w,a[O-1]=I,I=F>>>w}a[g-1]=I}this.bits=a}static makeArray(a){return new Int32Array(Math.floor((a+31)/32))}equals(a){if(!(a instanceof mt))return!1;const u=a;return this.size===u.size&&Je.equals(this.bits,u.bits)}hashCode(){return 31*this.size+Je.hashCode(this.bits)}toString(){let a="";for(let u=0,g=this.size;u<g;u++)(u&7)===0&&(a+=" "),a+=this.get(u)?"X":".";return a}clone(){return new mt(this.size,this.bits.slice())}}var Wt;(function(ce){ce[ce.OTHER=0]="OTHER",ce[ce.PURE_BARCODE=1]="PURE_BARCODE",ce[ce.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",ce[ce.TRY_HARDER=3]="TRY_HARDER",ce[ce.CHARACTER_SET=4]="CHARACTER_SET",ce[ce.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",ce[ce.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",ce[ce.ASSUME_GS1=7]="ASSUME_GS1",ce[ce.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",ce[ce.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",ce[ce.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(Wt||(Wt={}));var Et=Wt;class rt extends H{static getFormatInstance(){return new rt}}rt.kind="FormatException";var at;(function(ce){ce[ce.Cp437=0]="Cp437",ce[ce.ISO8859_1=1]="ISO8859_1",ce[ce.ISO8859_2=2]="ISO8859_2",ce[ce.ISO8859_3=3]="ISO8859_3",ce[ce.ISO8859_4=4]="ISO8859_4",ce[ce.ISO8859_5=5]="ISO8859_5",ce[ce.ISO8859_6=6]="ISO8859_6",ce[ce.ISO8859_7=7]="ISO8859_7",ce[ce.ISO8859_8=8]="ISO8859_8",ce[ce.ISO8859_9=9]="ISO8859_9",ce[ce.ISO8859_10=10]="ISO8859_10",ce[ce.ISO8859_11=11]="ISO8859_11",ce[ce.ISO8859_13=12]="ISO8859_13",ce[ce.ISO8859_14=13]="ISO8859_14",ce[ce.ISO8859_15=14]="ISO8859_15",ce[ce.ISO8859_16=15]="ISO8859_16",ce[ce.SJIS=16]="SJIS",ce[ce.Cp1250=17]="Cp1250",ce[ce.Cp1251=18]="Cp1251",ce[ce.Cp1252=19]="Cp1252",ce[ce.Cp1256=20]="Cp1256",ce[ce.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",ce[ce.UTF8=22]="UTF8",ce[ce.ASCII=23]="ASCII",ce[ce.Big5=24]="Big5",ce[ce.GB18030=25]="GB18030",ce[ce.EUC_KR=26]="EUC_KR"})(at||(at={}));class He{constructor(a,u,g,...v){this.valueIdentifier=a,this.name=g,typeof u=="number"?this.values=Int32Array.from([u]):this.values=u,this.otherEncodingNames=v,He.VALUE_IDENTIFIER_TO_ECI.set(a,this),He.NAME_TO_ECI.set(g,this);const w=this.values;for(let I=0,O=w.length;I!==O;I++){const F=w[I];He.VALUES_TO_ECI.set(F,this)}for(const I of v)He.NAME_TO_ECI.set(I,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(a){if(a<0||a>=900)throw new rt("incorect value");const u=He.VALUES_TO_ECI.get(a);if(u===void 0)throw new rt("incorect value");return u}static getCharacterSetECIByName(a){const u=He.NAME_TO_ECI.get(a);if(u===void 0)throw new rt("incorect value");return u}equals(a){if(!(a instanceof He))return!1;const u=a;return this.getName()===u.getName()}}He.VALUE_IDENTIFIER_TO_ECI=new Map,He.VALUES_TO_ECI=new Map,He.NAME_TO_ECI=new Map,He.Cp437=new He(at.Cp437,Int32Array.from([0,2]),"Cp437"),He.ISO8859_1=new He(at.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),He.ISO8859_2=new He(at.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),He.ISO8859_3=new He(at.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),He.ISO8859_4=new He(at.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),He.ISO8859_5=new He(at.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),He.ISO8859_6=new He(at.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),He.ISO8859_7=new He(at.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),He.ISO8859_8=new He(at.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),He.ISO8859_9=new He(at.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),He.ISO8859_10=new He(at.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),He.ISO8859_11=new He(at.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),He.ISO8859_13=new He(at.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),He.ISO8859_14=new He(at.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),He.ISO8859_15=new He(at.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),He.ISO8859_16=new He(at.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),He.SJIS=new He(at.SJIS,20,"SJIS","Shift_JIS"),He.Cp1250=new He(at.Cp1250,21,"Cp1250","windows-1250"),He.Cp1251=new He(at.Cp1251,22,"Cp1251","windows-1251"),He.Cp1252=new He(at.Cp1252,23,"Cp1252","windows-1252"),He.Cp1256=new He(at.Cp1256,24,"Cp1256","windows-1256"),He.UnicodeBigUnmarked=new He(at.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),He.UTF8=new He(at.UTF8,26,"UTF8","UTF-8"),He.ASCII=new He(at.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),He.Big5=new He(at.Big5,28,"Big5"),He.GB18030=new He(at.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),He.EUC_KR=new He(at.EUC_KR,30,"EUC_KR","EUC-KR");class _t extends H{}_t.kind="UnsupportedOperationException";class Pe{static decode(a,u){const g=this.encodingName(u);return this.customDecoder?this.customDecoder(a,g):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(g)?this.decodeFallback(a,g):new TextDecoder(g).decode(a)}static shouldDecodeOnFallback(a){return!Pe.isBrowser()&&a==="ISO-8859-1"}static encode(a,u){const g=this.encodingName(u);return this.customEncoder?this.customEncoder(a,g):typeof TextEncoder>"u"?this.encodeFallback(a):new TextEncoder().encode(a)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(a){return typeof a=="string"?a:a.getName()}static encodingCharacterSet(a){return a instanceof He?a:He.getCharacterSetECIByName(a)}static decodeFallback(a,u){const g=this.encodingCharacterSet(u);if(Pe.isDecodeFallbackSupported(g)){let v="";for(let w=0,I=a.length;w<I;w++){let O=a[w].toString(16);O.length<2&&(O="0"+O),v+="%"+O}return decodeURIComponent(v)}if(g.equals(He.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(a.buffer));throw new _t(`Encoding ${this.encodingName(u)} not supported by fallback.`)}static isDecodeFallbackSupported(a){return a.equals(He.UTF8)||a.equals(He.ISO8859_1)||a.equals(He.ASCII)}static encodeFallback(a){const g=btoa(unescape(encodeURIComponent(a))).split(""),v=[];for(let w=0;w<g.length;w++)v.push(g[w].charCodeAt(0));return new Uint8Array(v)}}class ht{static castAsNonUtf8Char(a,u=null){const g=u?u.getName():this.ISO88591;return Pe.decode(new Uint8Array([a]),g)}static guessEncoding(a,u){if(u!=null&&u.get(Et.CHARACTER_SET)!==void 0)return u.get(Et.CHARACTER_SET).toString();const g=a.length;let v=!0,w=!0,I=!0,O=0,F=0,q=0,te=0,ue=0,xe=0,Oe=0,ot=0,ft=0,Rt=0,Ht=0;const An=a.length>3&&a[0]===239&&a[1]===187&&a[2]===191;for(let wn=0;wn<g&&(v||w||I);wn++){const mn=a[wn]&255;I&&(O>0?(mn&128)===0?I=!1:O--:(mn&128)!==0&&((mn&64)===0?I=!1:(O++,(mn&32)===0?F++:(O++,(mn&16)===0?q++:(O++,(mn&8)===0?te++:I=!1))))),v&&(mn>127&&mn<160?v=!1:mn>159&&(mn<192||mn===215||mn===247)&&Ht++),w&&(ue>0?mn<64||mn===127||mn>252?w=!1:ue--:mn===128||mn===160||mn>239?w=!1:mn>160&&mn<224?(xe++,ot=0,Oe++,Oe>ft&&(ft=Oe)):mn>127?(ue++,Oe=0,ot++,ot>Rt&&(Rt=ot)):(Oe=0,ot=0))}return I&&O>0&&(I=!1),w&&ue>0&&(w=!1),I&&(An||F+q+te>0)?ht.UTF8:w&&(ht.ASSUME_SHIFT_JIS||ft>=3||Rt>=3)?ht.SHIFT_JIS:v&&w?ft===2&&xe===2||Ht*10>=g?ht.SHIFT_JIS:ht.ISO88591:v?ht.ISO88591:w?ht.SHIFT_JIS:I?ht.UTF8:ht.PLATFORM_DEFAULT_ENCODING}static format(a,...u){let g=-1;function v(I,O,F,q,te,ue){if(I==="%%")return"%";if(u[++g]===void 0)return;I=q?parseInt(q.substr(1)):void 0;let xe=te?parseInt(te.substr(1)):void 0,Oe;switch(ue){case"s":Oe=u[g];break;case"c":Oe=u[g][0];break;case"f":Oe=parseFloat(u[g]).toFixed(I);break;case"p":Oe=parseFloat(u[g]).toPrecision(I);break;case"e":Oe=parseFloat(u[g]).toExponential(I);break;case"x":Oe=parseInt(u[g]).toString(xe||16);break;case"d":Oe=parseFloat(parseInt(u[g],xe||10).toPrecision(I)).toFixed(0);break}Oe=typeof Oe=="object"?JSON.stringify(Oe):(+Oe).toString(xe);let ot=parseInt(F),ft=F&&F[0]+""=="0"?"0":" ";for(;Oe.length<ot;)Oe=O!==void 0?Oe+ft:ft+Oe;return Oe}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return a.replace(w,v)}static getBytes(a,u){return Pe.encode(a,u)}static getCharCode(a,u=0){return a.charCodeAt(u)}static getCharAt(a){return String.fromCharCode(a)}}ht.SHIFT_JIS=He.SJIS.getName(),ht.GB2312="GB2312",ht.ISO88591=He.ISO8859_1.getName(),ht.EUC_JP="EUC_JP",ht.UTF8=He.UTF8.getName(),ht.PLATFORM_DEFAULT_ENCODING=ht.UTF8,ht.ASSUME_SHIFT_JIS=!1;class vt{constructor(a=""){this.value=a}enableDecoding(a){return this.encoding=a,this}append(a){return typeof a=="string"?this.value+=a.toString():this.encoding?this.value+=ht.castAsNonUtf8Char(a,this.encoding):this.value+=String.fromCharCode(a),this}appendChars(a,u,g){for(let v=u;u<u+g;v++)this.append(a[v]);return this}length(){return this.value.length}charAt(a){return this.value.charAt(a)}deleteCharAt(a){this.value=this.value.substr(0,a)+this.value.substring(a+1)}setCharAt(a,u){this.value=this.value.substr(0,a)+u+this.value.substr(a+1)}substring(a,u){return this.value.substring(a,u)}setLengthToZero(){this.value=""}toString(){return this.value}insert(a,u){this.value=this.value.substr(0,a)+u+this.value.substr(a+u.length)}}class qt{constructor(a,u,g,v){if(this.width=a,this.height=u,this.rowSize=g,this.bits=v,u==null&&(u=a),this.height=u,a<1||u<1)throw new K("Both dimensions must be greater than 0");g==null&&(g=Math.floor((a+31)/32)),this.rowSize=g,v==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(a){const u=a.length,g=a[0].length,v=new qt(g,u);for(let w=0;w<u;w++){const I=a[w];for(let O=0;O<g;O++)I[O]&&v.set(O,w)}return v}static parseFromString(a,u,g){if(a===null)throw new K("stringRepresentation cannot be null");const v=new Array(a.length);let w=0,I=0,O=-1,F=0,q=0;for(;q<a.length;)if(a.charAt(q)===`
`||a.charAt(q)==="\r"){if(w>I){if(O===-1)O=w-I;else if(w-I!==O)throw new K("row lengths do not match");I=w,F++}q++}else if(a.substring(q,q+u.length)===u)q+=u.length,v[w]=!0,w++;else if(a.substring(q,q+g.length)===g)q+=g.length,v[w]=!1,w++;else throw new K("illegal character encountered: "+a.substring(q));if(w>I){if(O===-1)O=w-I;else if(w-I!==O)throw new K("row lengths do not match");F++}const te=new qt(O,F);for(let ue=0;ue<w;ue++)v[ue]&&te.set(Math.floor(ue%O),Math.floor(ue/O));return te}get(a,u){const g=u*this.rowSize+Math.floor(a/32);return(this.bits[g]>>>(a&31)&1)!==0}set(a,u){const g=u*this.rowSize+Math.floor(a/32);this.bits[g]|=1<<(a&31)&4294967295}unset(a,u){const g=u*this.rowSize+Math.floor(a/32);this.bits[g]&=~(1<<(a&31)&4294967295)}flip(a,u){const g=u*this.rowSize+Math.floor(a/32);this.bits[g]^=1<<(a&31)&4294967295}xor(a){if(this.width!==a.getWidth()||this.height!==a.getHeight()||this.rowSize!==a.getRowSize())throw new K("input matrix dimensions do not match");const u=new mt(Math.floor(this.width/32)+1),g=this.rowSize,v=this.bits;for(let w=0,I=this.height;w<I;w++){const O=w*g,F=a.getRow(w,u).getBitArray();for(let q=0;q<g;q++)v[O+q]^=F[q]}}clear(){const a=this.bits,u=a.length;for(let g=0;g<u;g++)a[g]=0}setRegion(a,u,g,v){if(u<0||a<0)throw new K("Left and top must be nonnegative");if(v<1||g<1)throw new K("Height and width must be at least 1");const w=a+g,I=u+v;if(I>this.height||w>this.width)throw new K("The region must fit inside the matrix");const O=this.rowSize,F=this.bits;for(let q=u;q<I;q++){const te=q*O;for(let ue=a;ue<w;ue++)F[te+Math.floor(ue/32)]|=1<<(ue&31)&4294967295}}getRow(a,u){u==null||u.getSize()<this.width?u=new mt(this.width):u.clear();const g=this.rowSize,v=this.bits,w=a*g;for(let I=0;I<g;I++)u.setBulk(I*32,v[w+I]);return u}setRow(a,u){pe.arraycopy(u.getBitArray(),0,this.bits,a*this.rowSize,this.rowSize)}rotate180(){const a=this.getWidth(),u=this.getHeight();let g=new mt(a),v=new mt(a);for(let w=0,I=Math.floor((u+1)/2);w<I;w++)g=this.getRow(w,g),v=this.getRow(u-1-w,v),g.reverse(),v.reverse(),this.setRow(w,v),this.setRow(u-1-w,g)}getEnclosingRectangle(){const a=this.width,u=this.height,g=this.rowSize,v=this.bits;let w=a,I=u,O=-1,F=-1;for(let q=0;q<u;q++)for(let te=0;te<g;te++){const ue=v[q*g+te];if(ue!==0){if(q<I&&(I=q),q>F&&(F=q),te*32<w){let xe=0;for(;(ue<<31-xe&4294967295)===0;)xe++;te*32+xe<w&&(w=te*32+xe)}if(te*32+31>O){let xe=31;for(;!(ue>>>xe);)xe--;te*32+xe>O&&(O=te*32+xe)}}}return O<w||F<I?null:Int32Array.from([w,I,O-w+1,F-I+1])}getTopLeftOnBit(){const a=this.rowSize,u=this.bits;let g=0;for(;g<u.length&&u[g]===0;)g++;if(g===u.length)return null;const v=g/a;let w=g%a*32;const I=u[g];let O=0;for(;(I<<31-O&4294967295)===0;)O++;return w+=O,Int32Array.from([w,v])}getBottomRightOnBit(){const a=this.rowSize,u=this.bits;let g=u.length-1;for(;g>=0&&u[g]===0;)g--;if(g<0)return null;const v=Math.floor(g/a);let w=Math.floor(g%a)*32;const I=u[g];let O=31;for(;!(I>>>O);)O--;return w+=O,Int32Array.from([w,v])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(a){if(!(a instanceof qt))return!1;const u=a;return this.width===u.width&&this.height===u.height&&this.rowSize===u.rowSize&&Je.equals(this.bits,u.bits)}hashCode(){let a=this.width;return a=31*a+this.width,a=31*a+this.height,a=31*a+this.rowSize,a=31*a+Je.hashCode(this.bits),a}toString(a="X ",u="  ",g=`
`){return this.buildToString(a,u,g)}buildToString(a,u,g){let v=new vt;for(let w=0,I=this.height;w<I;w++){for(let O=0,F=this.width;O<F;O++)v.append(this.get(O,w)?a:u);v.append(g)}return v.toString()}clone(){return new qt(this.width,this.height,this.rowSize,this.bits.slice())}}class ke extends H{static getNotFoundInstance(){return new ke}}ke.kind="NotFoundException";class Te extends ve{constructor(a){super(a),this.luminances=Te.EMPTY,this.buckets=new Int32Array(Te.LUMINANCE_BUCKETS)}getBlackRow(a,u){const g=this.getLuminanceSource(),v=g.getWidth();u==null||u.getSize()<v?u=new mt(v):u.clear(),this.initArrays(v);const w=g.getRow(a,this.luminances),I=this.buckets;for(let F=0;F<v;F++)I[(w[F]&255)>>Te.LUMINANCE_SHIFT]++;const O=Te.estimateBlackPoint(I);if(v<3)for(let F=0;F<v;F++)(w[F]&255)<O&&u.set(F);else{let F=w[0]&255,q=w[1]&255;for(let te=1;te<v-1;te++){const ue=w[te+1]&255;(q*4-F-ue)/2<O&&u.set(te),F=q,q=ue}}return u}getBlackMatrix(){const a=this.getLuminanceSource(),u=a.getWidth(),g=a.getHeight(),v=new qt(u,g);this.initArrays(u);const w=this.buckets;for(let F=1;F<5;F++){const q=Math.floor(g*F/5),te=a.getRow(q,this.luminances),ue=Math.floor(u*4/5);for(let xe=Math.floor(u/5);xe<ue;xe++){const Oe=te[xe]&255;w[Oe>>Te.LUMINANCE_SHIFT]++}}const I=Te.estimateBlackPoint(w),O=a.getMatrix();for(let F=0;F<g;F++){const q=F*u;for(let te=0;te<u;te++)(O[q+te]&255)<I&&v.set(te,F)}return v}createBinarizer(a){return new Te(a)}initArrays(a){this.luminances.length<a&&(this.luminances=new Uint8ClampedArray(a));const u=this.buckets;for(let g=0;g<Te.LUMINANCE_BUCKETS;g++)u[g]=0}static estimateBlackPoint(a){const u=a.length;let g=0,v=0,w=0;for(let te=0;te<u;te++)a[te]>w&&(v=te,w=a[te]),a[te]>g&&(g=a[te]);let I=0,O=0;for(let te=0;te<u;te++){const ue=te-v,xe=a[te]*ue*ue;xe>O&&(I=te,O=xe)}if(v>I){const te=v;v=I,I=te}if(I-v<=u/16)throw new ke;let F=I-1,q=-1;for(let te=I-1;te>v;te--){const ue=te-v,xe=ue*ue*(I-te)*(g-a[te]);xe>q&&(F=te,q=xe)}return F<<Te.LUMINANCE_SHIFT}}Te.LUMINANCE_BITS=5,Te.LUMINANCE_SHIFT=8-Te.LUMINANCE_BITS,Te.LUMINANCE_BUCKETS=1<<Te.LUMINANCE_BITS,Te.EMPTY=Uint8ClampedArray.from([0]);class Ze extends Te{constructor(a){super(a),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const a=this.getLuminanceSource(),u=a.getWidth(),g=a.getHeight();if(u>=Ze.MINIMUM_DIMENSION&&g>=Ze.MINIMUM_DIMENSION){const v=a.getMatrix();let w=u>>Ze.BLOCK_SIZE_POWER;(u&Ze.BLOCK_SIZE_MASK)!==0&&w++;let I=g>>Ze.BLOCK_SIZE_POWER;(g&Ze.BLOCK_SIZE_MASK)!==0&&I++;const O=Ze.calculateBlackPoints(v,w,I,u,g),F=new qt(u,g);Ze.calculateThresholdForBlock(v,w,I,u,g,O,F),this.matrix=F}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(a){return new Ze(a)}static calculateThresholdForBlock(a,u,g,v,w,I,O){const F=w-Ze.BLOCK_SIZE,q=v-Ze.BLOCK_SIZE;for(let te=0;te<g;te++){let ue=te<<Ze.BLOCK_SIZE_POWER;ue>F&&(ue=F);const xe=Ze.cap(te,2,g-3);for(let Oe=0;Oe<u;Oe++){let ot=Oe<<Ze.BLOCK_SIZE_POWER;ot>q&&(ot=q);const ft=Ze.cap(Oe,2,u-3);let Rt=0;for(let An=-2;An<=2;An++){const wn=I[xe+An];Rt+=wn[ft-2]+wn[ft-1]+wn[ft]+wn[ft+1]+wn[ft+2]}const Ht=Rt/25;Ze.thresholdBlock(a,ot,ue,Ht,v,O)}}}static cap(a,u,g){return a<u?u:a>g?g:a}static thresholdBlock(a,u,g,v,w,I){for(let O=0,F=g*w+u;O<Ze.BLOCK_SIZE;O++,F+=w)for(let q=0;q<Ze.BLOCK_SIZE;q++)(a[F+q]&255)<=v&&I.set(u+q,g+O)}static calculateBlackPoints(a,u,g,v,w){const I=w-Ze.BLOCK_SIZE,O=v-Ze.BLOCK_SIZE,F=new Array(g);for(let q=0;q<g;q++){F[q]=new Int32Array(u);let te=q<<Ze.BLOCK_SIZE_POWER;te>I&&(te=I);for(let ue=0;ue<u;ue++){let xe=ue<<Ze.BLOCK_SIZE_POWER;xe>O&&(xe=O);let Oe=0,ot=255,ft=0;for(let Ht=0,An=te*v+xe;Ht<Ze.BLOCK_SIZE;Ht++,An+=v){for(let wn=0;wn<Ze.BLOCK_SIZE;wn++){const mn=a[An+wn]&255;Oe+=mn,mn<ot&&(ot=mn),mn>ft&&(ft=mn)}if(ft-ot>Ze.MIN_DYNAMIC_RANGE)for(Ht++,An+=v;Ht<Ze.BLOCK_SIZE;Ht++,An+=v)for(let wn=0;wn<Ze.BLOCK_SIZE;wn++)Oe+=a[An+wn]&255}let Rt=Oe>>Ze.BLOCK_SIZE_POWER*2;if(ft-ot<=Ze.MIN_DYNAMIC_RANGE&&(Rt=ot/2,q>0&&ue>0)){const Ht=(F[q-1][ue]+2*F[q][ue-1]+F[q-1][ue-1])/4;ot<Ht&&(Rt=Ht)}F[q][ue]=Rt}}return F}}Ze.BLOCK_SIZE_POWER=3,Ze.BLOCK_SIZE=1<<Ze.BLOCK_SIZE_POWER,Ze.BLOCK_SIZE_MASK=Ze.BLOCK_SIZE-1,Ze.MINIMUM_DIMENSION=Ze.BLOCK_SIZE*5,Ze.MIN_DYNAMIC_RANGE=24;class ut{constructor(a,u){this.width=a,this.height=u}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(a,u,g,v){throw new _t("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new _t("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new _t("This luminance source does not support rotation by 45 degrees.")}toString(){const a=new Uint8ClampedArray(this.width);let u=new vt;for(let g=0;g<this.height;g++){const v=this.getRow(g,a);for(let w=0;w<this.width;w++){const I=v[w]&255;let O;I<64?O="#":I<128?O="+":I<192?O=".":O=" ",u.append(O)}u.append(`
`)}return u.toString()}}class Tt extends ut{constructor(a){super(a.getWidth(),a.getHeight()),this.delegate=a}getRow(a,u){const g=this.delegate.getRow(a,u),v=this.getWidth();for(let w=0;w<v;w++)g[w]=255-(g[w]&255);return g}getMatrix(){const a=this.delegate.getMatrix(),u=this.getWidth()*this.getHeight(),g=new Uint8ClampedArray(u);for(let v=0;v<u;v++)g[v]=255-(a[v]&255);return g}isCropSupported(){return this.delegate.isCropSupported()}crop(a,u,g,v){return new Tt(this.delegate.crop(a,u,g,v))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new Tt(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new Tt(this.delegate.rotateCounterClockwise45())}}class sn extends ut{constructor(a){super(a.width,a.height),this.canvas=a,this.tempCanvasElement=null,this.buffer=sn.makeBufferFromCanvasImageData(a)}static makeBufferFromCanvasImageData(a){const u=a.getContext("2d").getImageData(0,0,a.width,a.height);return sn.toGrayscaleBuffer(u.data,a.width,a.height)}static toGrayscaleBuffer(a,u,g){const v=new Uint8ClampedArray(u*g);for(let w=0,I=0,O=a.length;w<O;w+=4,I++){let F;if(a[w+3]===0)F=255;else{const te=a[w],ue=a[w+1],xe=a[w+2];F=306*te+601*ue+117*xe+512>>10}v[I]=F}return v}getRow(a,u){if(a<0||a>=this.getHeight())throw new K("Requested row is outside the image: "+a);const g=this.getWidth(),v=a*g;return u===null?u=this.buffer.slice(v,v+g):(u.length<g&&(u=new Uint8ClampedArray(g)),u.set(this.buffer.slice(v,v+g))),u}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(a,u,g,v){return super.crop(a,u,g,v),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const a=this.canvas.ownerDocument.createElement("canvas");a.width=this.canvas.width,a.height=this.canvas.height,this.tempCanvasElement=a}return this.tempCanvasElement}rotate(a){const u=this.getTempCanvasElement(),g=u.getContext("2d"),v=a*sn.DEGREE_TO_RADIANS,w=this.canvas.width,I=this.canvas.height,O=Math.ceil(Math.abs(Math.cos(v))*w+Math.abs(Math.sin(v))*I),F=Math.ceil(Math.abs(Math.sin(v))*w+Math.abs(Math.cos(v))*I);return u.width=O,u.height=F,g.translate(O/2,F/2),g.rotate(v),g.drawImage(this.canvas,w/-2,I/-2),this.buffer=sn.makeBufferFromCanvasImageData(u),this}invert(){return new Tt(this)}}sn.DEGREE_TO_RADIANS=Math.PI/180;class Re{constructor(a,u,g){this.deviceId=a,this.label=u,this.kind="videoinput",this.groupId=g||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var ct=(globalThis||jm||self||window||void 0)&&(globalThis||jm||self||window||void 0).__awaiter||function(ce,a,u,g){function v(w){return w instanceof u?w:new u(function(I){I(w)})}return new(u||(u=Promise))(function(w,I){function O(te){try{q(g.next(te))}catch(ue){I(ue)}}function F(te){try{q(g.throw(te))}catch(ue){I(ue)}}function q(te){te.done?w(te.value):v(te.value).then(O,F)}q((g=g.apply(ce,a||[])).next())})};class kt{constructor(a,u=500,g){this.reader=a,this.timeBetweenScansMillis=u,this._hints=g,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(a){this._timeBetweenDecodingAttempts=a<0?0:a}set hints(a){this._hints=a||null}get hints(){return this._hints}listVideoInputDevices(){return ct(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const a=yield navigator.mediaDevices.enumerateDevices(),u=[];for(const g of a){const v=g.kind==="video"?"videoinput":g.kind;if(v!=="videoinput")continue;const w=g.deviceId||g.id,I=g.label||`Video device ${u.length+1}`,O=g.groupId,F={deviceId:w,label:I,kind:v,groupId:O};u.push(F)}return u})}getVideoInputDevices(){return ct(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(u=>new Re(u.deviceId,u.label))})}findDeviceById(a){return ct(this,void 0,void 0,function*(){const u=yield this.listVideoInputDevices();return u?u.find(g=>g.deviceId===a):null})}decodeFromInputVideoDevice(a,u){return ct(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(a,u)})}decodeOnceFromVideoDevice(a,u){return ct(this,void 0,void 0,function*(){this.reset();let g;a?g={deviceId:{exact:a}}:g={facingMode:"environment"};const v={video:g};return yield this.decodeOnceFromConstraints(v,u)})}decodeOnceFromConstraints(a,u){return ct(this,void 0,void 0,function*(){const g=yield navigator.mediaDevices.getUserMedia(a);return yield this.decodeOnceFromStream(g,u)})}decodeOnceFromStream(a,u){return ct(this,void 0,void 0,function*(){this.reset();const g=yield this.attachStreamToVideo(a,u);return yield this.decodeOnce(g)})}decodeFromInputVideoDeviceContinuously(a,u,g){return ct(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(a,u,g)})}decodeFromVideoDevice(a,u,g){return ct(this,void 0,void 0,function*(){let v;a?v={deviceId:{exact:a}}:v={facingMode:"environment"};const w={video:v};return yield this.decodeFromConstraints(w,u,g)})}decodeFromConstraints(a,u,g){return ct(this,void 0,void 0,function*(){const v=yield navigator.mediaDevices.getUserMedia(a);return yield this.decodeFromStream(v,u,g)})}decodeFromStream(a,u,g){return ct(this,void 0,void 0,function*(){this.reset();const v=yield this.attachStreamToVideo(a,u);return yield this.decodeContinuously(v,g)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(a,u){return ct(this,void 0,void 0,function*(){const g=this.prepareVideoElement(u);return this.addVideoSource(g,a),this.videoElement=g,this.stream=a,yield this.playVideoOnLoadAsync(g),g})}playVideoOnLoadAsync(a){return new Promise((u,g)=>this.playVideoOnLoad(a,()=>u()))}playVideoOnLoad(a,u){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(a),a.addEventListener("ended",this.videoEndedListener),a.addEventListener("canplay",this.videoCanPlayListener),a.addEventListener("playing",u),this.tryPlayVideo(a)}isVideoPlaying(a){return a.currentTime>0&&!a.paused&&!a.ended&&a.readyState>2}tryPlayVideo(a){return ct(this,void 0,void 0,function*(){if(this.isVideoPlaying(a)){console.warn("Trying to play video that is already playing.");return}try{yield a.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(a,u){const g=document.getElementById(a);if(!g)throw new Y(`element with id '${a}' not found`);if(g.nodeName.toLowerCase()!==u.toLowerCase())throw new Y(`element with id '${a}' must be an ${u} element`);return g}decodeFromImage(a,u){if(!a&&!u)throw new Y("either imageElement with a src set or an url must be provided");return u&&!a?this.decodeFromImageUrl(u):this.decodeFromImageElement(a)}decodeFromVideo(a,u){if(!a&&!u)throw new Y("Either an element with a src set or an URL must be provided");return u&&!a?this.decodeFromVideoUrl(u):this.decodeFromVideoElement(a)}decodeFromVideoContinuously(a,u,g){if(a===void 0&&u===void 0)throw new Y("Either an element with a src set or an URL must be provided");return u&&!a?this.decodeFromVideoUrlContinuously(u,g):this.decodeFromVideoElementContinuously(a,g)}decodeFromImageElement(a){if(!a)throw new Y("An image element must be provided.");this.reset();const u=this.prepareImageElement(a);this.imageElement=u;let g;return this.isImageLoaded(u)?g=this.decodeOnce(u,!1,!0):g=this._decodeOnLoadImage(u),g}decodeFromVideoElement(a){const u=this._decodeFromVideoElementSetup(a);return this._decodeOnLoadVideo(u)}decodeFromVideoElementContinuously(a,u){const g=this._decodeFromVideoElementSetup(a);return this._decodeOnLoadVideoContinuously(g,u)}_decodeFromVideoElementSetup(a){if(!a)throw new Y("A video element must be provided.");this.reset();const u=this.prepareVideoElement(a);return this.videoElement=u,u}decodeFromImageUrl(a){if(!a)throw new Y("An URL must be provided.");this.reset();const u=this.prepareImageElement();this.imageElement=u;const g=this._decodeOnLoadImage(u);return u.src=a,g}decodeFromVideoUrl(a){if(!a)throw new Y("An URL must be provided.");this.reset();const u=this.prepareVideoElement(),g=this.decodeFromVideoElement(u);return u.src=a,g}decodeFromVideoUrlContinuously(a,u){if(!a)throw new Y("An URL must be provided.");this.reset();const g=this.prepareVideoElement(),v=this.decodeFromVideoElementContinuously(g,u);return g.src=a,v}_decodeOnLoadImage(a){return new Promise((u,g)=>{this.imageLoadedListener=()=>this.decodeOnce(a,!1,!0).then(u,g),a.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(a){return ct(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(a),yield this.decodeOnce(a)})}_decodeOnLoadVideoContinuously(a,u){return ct(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(a),this.decodeContinuously(a,u)})}isImageLoaded(a){return!(!a.complete||a.naturalWidth===0)}prepareImageElement(a){let u;return typeof a>"u"&&(u=document.createElement("img"),u.width=200,u.height=200),typeof a=="string"&&(u=this.getMediaElement(a,"img")),a instanceof HTMLImageElement&&(u=a),u}prepareVideoElement(a){let u;return!a&&typeof document<"u"&&(u=document.createElement("video"),u.width=200,u.height=200),typeof a=="string"&&(u=this.getMediaElement(a,"video")),a instanceof HTMLVideoElement&&(u=a),u.setAttribute("autoplay","true"),u.setAttribute("muted","true"),u.setAttribute("playsinline","true"),u}decodeOnce(a,u=!0,g=!0){this._stopAsyncDecode=!1;const v=(w,I)=>{if(this._stopAsyncDecode){I(new ke("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const O=this.decode(a);w(O)}catch(O){const F=u&&O instanceof ke,te=(O instanceof we||O instanceof rt)&&g;if(F||te)return setTimeout(v,this._timeBetweenDecodingAttempts,w,I);I(O)}};return new Promise((w,I)=>v(w,I))}decodeContinuously(a,u){this._stopContinuousDecode=!1;const g=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const v=this.decode(a);u(v,null),setTimeout(g,this.timeBetweenScansMillis)}catch(v){u(null,v);const w=v instanceof we||v instanceof rt,I=v instanceof ke;(w||I)&&setTimeout(g,this._timeBetweenDecodingAttempts)}};g()}decode(a){const u=this.createBinaryBitmap(a);return this.decodeBitmap(u)}_isHTMLVideoElement(a){return a.videoWidth!==0}drawFrameOnCanvas(a,u,g){u||(u={sx:0,sy:0,sWidth:a.videoWidth,sHeight:a.videoHeight,dx:0,dy:0,dWidth:a.videoWidth,dHeight:a.videoHeight}),g||(g=this.captureCanvasContext),g.drawImage(a,u.sx,u.sy,u.sWidth,u.sHeight,u.dx,u.dy,u.dWidth,u.dHeight)}drawImageOnCanvas(a,u,g=this.captureCanvasContext){u||(u={sx:0,sy:0,sWidth:a.naturalWidth,sHeight:a.naturalHeight,dx:0,dy:0,dWidth:a.naturalWidth,dHeight:a.naturalHeight}),g||(g=this.captureCanvasContext),g.drawImage(a,u.sx,u.sy,u.sWidth,u.sHeight,u.dx,u.dy,u.dWidth,u.dHeight)}createBinaryBitmap(a){this.getCaptureCanvasContext(a),this._isHTMLVideoElement(a)?this.drawFrameOnCanvas(a):this.drawImageOnCanvas(a);const u=this.getCaptureCanvas(a),g=new sn(u),v=new Ze(g);return new _e(v)}getCaptureCanvasContext(a){if(!this.captureCanvasContext){const g=this.getCaptureCanvas(a).getContext("2d");this.captureCanvasContext=g}return this.captureCanvasContext}getCaptureCanvas(a){if(!this.captureCanvas){const u=this.createCaptureCanvas(a);this.captureCanvas=u}return this.captureCanvas}decodeBitmap(a){return this.reader.decode(a,this._hints)}createCaptureCanvas(a){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const u=document.createElement("canvas");let g,v;return typeof a<"u"&&(a instanceof HTMLVideoElement?(g=a.videoWidth,v=a.videoHeight):a instanceof HTMLImageElement&&(g=a.naturalWidth||a.width,v=a.naturalHeight||a.height)),u.style.width=g+"px",u.style.height=v+"px",u.width=g,u.height=v,u}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(a=>a.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(a,u){try{a.srcObject=u}catch{a.src=URL.createObjectURL(u)}}cleanVideoSource(a){try{a.srcObject=null}catch{a.src=""}this.videoElement.removeAttribute("src")}}class bt{constructor(a,u,g=u==null?0:8*u.length,v,w,I=pe.currentTimeMillis()){this.text=a,this.rawBytes=u,this.numBits=g,this.resultPoints=v,this.format=w,this.timestamp=I,this.text=a,this.rawBytes=u,g==null?this.numBits=u==null?0:8*u.length:this.numBits=g,this.resultPoints=v,this.format=w,this.resultMetadata=null,I==null?this.timestamp=pe.currentTimeMillis():this.timestamp=I}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(a,u){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(a,u)}putAllMetadata(a){a!==null&&(this.resultMetadata===null?this.resultMetadata=a:this.resultMetadata=new Map(a))}addResultPoints(a){const u=this.resultPoints;if(u===null)this.resultPoints=a;else if(a!==null&&a.length>0){const g=new Array(u.length+a.length);pe.arraycopy(u,0,g,0,u.length),pe.arraycopy(a,0,g,u.length,a.length),this.resultPoints=g}}getTimestamp(){return this.timestamp}toString(){return this.text}}var an;(function(ce){ce[ce.AZTEC=0]="AZTEC",ce[ce.CODABAR=1]="CODABAR",ce[ce.CODE_39=2]="CODE_39",ce[ce.CODE_93=3]="CODE_93",ce[ce.CODE_128=4]="CODE_128",ce[ce.DATA_MATRIX=5]="DATA_MATRIX",ce[ce.EAN_8=6]="EAN_8",ce[ce.EAN_13=7]="EAN_13",ce[ce.ITF=8]="ITF",ce[ce.MAXICODE=9]="MAXICODE",ce[ce.PDF_417=10]="PDF_417",ce[ce.QR_CODE=11]="QR_CODE",ce[ce.RSS_14=12]="RSS_14",ce[ce.RSS_EXPANDED=13]="RSS_EXPANDED",ce[ce.UPC_A=14]="UPC_A",ce[ce.UPC_E=15]="UPC_E",ce[ce.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(an||(an={}));var Bt=an,Qt;(function(ce){ce[ce.OTHER=0]="OTHER",ce[ce.ORIENTATION=1]="ORIENTATION",ce[ce.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",ce[ce.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",ce[ce.ISSUE_NUMBER=4]="ISSUE_NUMBER",ce[ce.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",ce[ce.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",ce[ce.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",ce[ce.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",ce[ce.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",ce[ce.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Qt||(Qt={}));var un=Qt;class nn{constructor(a,u,g,v,w=-1,I=-1){this.rawBytes=a,this.text=u,this.byteSegments=g,this.ecLevel=v,this.structuredAppendSequenceNumber=w,this.structuredAppendParity=I,this.numBits=a==null?0:8*a.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(a){this.numBits=a}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(a){this.errorsCorrected=a}getErasures(){return this.erasures}setErasures(a){this.erasures=a}getOther(){return this.other}setOther(a){this.other=a}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class kn{exp(a){return this.expTable[a]}log(a){if(a===0)throw new K;return this.logTable[a]}static addOrSubtract(a,u){return a^u}}class Nn{constructor(a,u){if(u.length===0)throw new K;this.field=a;const g=u.length;if(g>1&&u[0]===0){let v=1;for(;v<g&&u[v]===0;)v++;v===g?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(g-v),pe.arraycopy(u,v,this.coefficients,0,this.coefficients.length))}else this.coefficients=u}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(a){return this.coefficients[this.coefficients.length-1-a]}evaluateAt(a){if(a===0)return this.getCoefficient(0);const u=this.coefficients;let g;if(a===1){g=0;for(let I=0,O=u.length;I!==O;I++){const F=u[I];g=kn.addOrSubtract(g,F)}return g}g=u[0];const v=u.length,w=this.field;for(let I=1;I<v;I++)g=kn.addOrSubtract(w.multiply(a,g),u[I]);return g}addOrSubtract(a){if(!this.field.equals(a.field))throw new K("GenericGFPolys do not have same GenericGF field");if(this.isZero())return a;if(a.isZero())return this;let u=this.coefficients,g=a.coefficients;if(u.length>g.length){const I=u;u=g,g=I}let v=new Int32Array(g.length);const w=g.length-u.length;pe.arraycopy(g,0,v,0,w);for(let I=w;I<g.length;I++)v[I]=kn.addOrSubtract(u[I-w],g[I]);return new Nn(this.field,v)}multiply(a){if(!this.field.equals(a.field))throw new K("GenericGFPolys do not have same GenericGF field");if(this.isZero()||a.isZero())return this.field.getZero();const u=this.coefficients,g=u.length,v=a.coefficients,w=v.length,I=new Int32Array(g+w-1),O=this.field;for(let F=0;F<g;F++){const q=u[F];for(let te=0;te<w;te++)I[F+te]=kn.addOrSubtract(I[F+te],O.multiply(q,v[te]))}return new Nn(O,I)}multiplyScalar(a){if(a===0)return this.field.getZero();if(a===1)return this;const u=this.coefficients.length,g=this.field,v=new Int32Array(u),w=this.coefficients;for(let I=0;I<u;I++)v[I]=g.multiply(w[I],a);return new Nn(g,v)}multiplyByMonomial(a,u){if(a<0)throw new K;if(u===0)return this.field.getZero();const g=this.coefficients,v=g.length,w=new Int32Array(v+a),I=this.field;for(let O=0;O<v;O++)w[O]=I.multiply(g[O],u);return new Nn(I,w)}divide(a){if(!this.field.equals(a.field))throw new K("GenericGFPolys do not have same GenericGF field");if(a.isZero())throw new K("Divide by 0");const u=this.field;let g=u.getZero(),v=this;const w=a.getCoefficient(a.getDegree()),I=u.inverse(w);for(;v.getDegree()>=a.getDegree()&&!v.isZero();){const O=v.getDegree()-a.getDegree(),F=u.multiply(v.getCoefficient(v.getDegree()),I),q=a.multiplyByMonomial(O,F),te=u.buildMonomial(O,F);g=g.addOrSubtract(te),v=v.addOrSubtract(q)}return[g,v]}toString(){let a="";for(let u=this.getDegree();u>=0;u--){let g=this.getCoefficient(u);if(g!==0){if(g<0?(a+=" - ",g=-g):a.length>0&&(a+=" + "),u===0||g!==1){const v=this.field.log(g);v===0?a+="1":v===1?a+="a":(a+="a^",a+=v)}u!==0&&(u===1?a+="x":(a+="x^",a+=u))}}return a}}class ii extends H{}ii.kind="ArithmeticException";class En extends kn{constructor(a,u,g){super(),this.primitive=a,this.size=u,this.generatorBase=g;const v=new Int32Array(u);let w=1;for(let O=0;O<u;O++)v[O]=w,w*=2,w>=u&&(w^=a,w&=u-1);this.expTable=v;const I=new Int32Array(u);for(let O=0;O<u-1;O++)I[v[O]]=O;this.logTable=I,this.zero=new Nn(this,Int32Array.from([0])),this.one=new Nn(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(a,u){if(a<0)throw new K;if(u===0)return this.zero;const g=new Int32Array(a+1);return g[0]=u,new Nn(this,g)}inverse(a){if(a===0)throw new ii;return this.expTable[this.size-this.logTable[a]-1]}multiply(a,u){return a===0||u===0?0:this.expTable[(this.logTable[a]+this.logTable[u])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Xe.toHexString(this.primitive)+","+this.size+")"}equals(a){return a===this}}En.AZTEC_DATA_12=new En(4201,4096,1),En.AZTEC_DATA_10=new En(1033,1024,1),En.AZTEC_DATA_6=new En(67,64,1),En.AZTEC_PARAM=new En(19,16,1),En.QR_CODE_FIELD_256=new En(285,256,0),En.DATA_MATRIX_FIELD_256=new En(301,256,1),En.AZTEC_DATA_8=En.DATA_MATRIX_FIELD_256,En.MAXICODE_FIELD_64=En.AZTEC_DATA_6;class si extends H{}si.kind="ReedSolomonException";class wi extends H{}wi.kind="IllegalStateException";class Oi{constructor(a){this.field=a}decode(a,u){const g=this.field,v=new Nn(g,a),w=new Int32Array(u);let I=!0;for(let Oe=0;Oe<u;Oe++){const ot=v.evaluateAt(g.exp(Oe+g.getGeneratorBase()));w[w.length-1-Oe]=ot,ot!==0&&(I=!1)}if(I)return;const O=new Nn(g,w),F=this.runEuclideanAlgorithm(g.buildMonomial(u,1),O,u),q=F[0],te=F[1],ue=this.findErrorLocations(q),xe=this.findErrorMagnitudes(te,ue);for(let Oe=0;Oe<ue.length;Oe++){const ot=a.length-1-g.log(ue[Oe]);if(ot<0)throw new si("Bad error location");a[ot]=En.addOrSubtract(a[ot],xe[Oe])}}runEuclideanAlgorithm(a,u,g){if(a.getDegree()<u.getDegree()){const Oe=a;a=u,u=Oe}const v=this.field;let w=a,I=u,O=v.getZero(),F=v.getOne();for(;I.getDegree()>=(g/2|0);){let Oe=w,ot=O;if(w=I,O=F,w.isZero())throw new si("r_{i-1} was zero");I=Oe;let ft=v.getZero();const Rt=w.getCoefficient(w.getDegree()),Ht=v.inverse(Rt);for(;I.getDegree()>=w.getDegree()&&!I.isZero();){const An=I.getDegree()-w.getDegree(),wn=v.multiply(I.getCoefficient(I.getDegree()),Ht);ft=ft.addOrSubtract(v.buildMonomial(An,wn)),I=I.addOrSubtract(w.multiplyByMonomial(An,wn))}if(F=ft.multiply(O).addOrSubtract(ot),I.getDegree()>=w.getDegree())throw new wi("Division algorithm failed to reduce polynomial?")}const q=F.getCoefficient(0);if(q===0)throw new si("sigmaTilde(0) was zero");const te=v.inverse(q),ue=F.multiplyScalar(te),xe=I.multiplyScalar(te);return[ue,xe]}findErrorLocations(a){const u=a.getDegree();if(u===1)return Int32Array.from([a.getCoefficient(1)]);const g=new Int32Array(u);let v=0;const w=this.field;for(let I=1;I<w.getSize()&&v<u;I++)a.evaluateAt(I)===0&&(g[v]=w.inverse(I),v++);if(v!==u)throw new si("Error locator degree does not match number of roots");return g}findErrorMagnitudes(a,u){const g=u.length,v=new Int32Array(g),w=this.field;for(let I=0;I<g;I++){const O=w.inverse(u[I]);let F=1;for(let q=0;q<g;q++)if(I!==q){const te=w.multiply(u[q],O),ue=(te&1)===0?te|1:te&-2;F=w.multiply(F,ue)}v[I]=w.multiply(a.evaluateAt(O),w.inverse(F)),w.getGeneratorBase()!==0&&(v[I]=w.multiply(v[I],O))}return v}}var Yn;(function(ce){ce[ce.UPPER=0]="UPPER",ce[ce.LOWER=1]="LOWER",ce[ce.MIXED=2]="MIXED",ce[ce.DIGIT=3]="DIGIT",ce[ce.PUNCT=4]="PUNCT",ce[ce.BINARY=5]="BINARY"})(Yn||(Yn={}));class Gn{decode(a){this.ddata=a;let u=a.getBits(),g=this.extractBits(u),v=this.correctBits(g),w=Gn.convertBoolArrayToByteArray(v),I=Gn.getEncodedData(v),O=new nn(w,I,null,null);return O.setNumBits(v.length),O}static highLevelDecode(a){return this.getEncodedData(a)}static getEncodedData(a){let u=a.length,g=Yn.UPPER,v=Yn.UPPER,w="",I=0;for(;I<u;)if(v===Yn.BINARY){if(u-I<5)break;let O=Gn.readCode(a,I,5);if(I+=5,O===0){if(u-I<11)break;O=Gn.readCode(a,I,11)+31,I+=11}for(let F=0;F<O;F++){if(u-I<8){I=u;break}const q=Gn.readCode(a,I,8);w+=ht.castAsNonUtf8Char(q),I+=8}v=g}else{let O=v===Yn.DIGIT?4:5;if(u-I<O)break;let F=Gn.readCode(a,I,O);I+=O;let q=Gn.getCharacter(v,F);q.startsWith("CTRL_")?(g=v,v=Gn.getTable(q.charAt(5)),q.charAt(6)==="L"&&(g=v)):(w+=q,v=g)}return w}static getTable(a){switch(a){case"L":return Yn.LOWER;case"P":return Yn.PUNCT;case"M":return Yn.MIXED;case"D":return Yn.DIGIT;case"B":return Yn.BINARY;default:return Yn.UPPER}}static getCharacter(a,u){switch(a){case Yn.UPPER:return Gn.UPPER_TABLE[u];case Yn.LOWER:return Gn.LOWER_TABLE[u];case Yn.MIXED:return Gn.MIXED_TABLE[u];case Yn.PUNCT:return Gn.PUNCT_TABLE[u];case Yn.DIGIT:return Gn.DIGIT_TABLE[u];default:throw new wi("Bad table")}}correctBits(a){let u,g;this.ddata.getNbLayers()<=2?(g=6,u=En.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(g=8,u=En.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(g=10,u=En.AZTEC_DATA_10):(g=12,u=En.AZTEC_DATA_12);let v=this.ddata.getNbDatablocks(),w=a.length/g;if(w<v)throw new rt;let I=a.length%g,O=new Int32Array(w);for(let xe=0;xe<w;xe++,I+=g)O[xe]=Gn.readCode(a,I,g);try{new Oi(u).decode(O,w-v)}catch(xe){throw new rt(xe)}let F=(1<<g)-1,q=0;for(let xe=0;xe<v;xe++){let Oe=O[xe];if(Oe===0||Oe===F)throw new rt;(Oe===1||Oe===F-1)&&q++}let te=new Array(v*g-q),ue=0;for(let xe=0;xe<v;xe++){let Oe=O[xe];if(Oe===1||Oe===F-1)te.fill(Oe>1,ue,ue+g-1),ue+=g-1;else for(let ot=g-1;ot>=0;--ot)te[ue++]=(Oe&1<<ot)!==0}return te}extractBits(a){let u=this.ddata.isCompact(),g=this.ddata.getNbLayers(),v=(u?11:14)+g*4,w=new Int32Array(v),I=new Array(this.totalBitsInLayer(g,u));if(u)for(let O=0;O<w.length;O++)w[O]=O;else{let O=v+1+2*Xe.truncDivision(Xe.truncDivision(v,2)-1,15),F=v/2,q=Xe.truncDivision(O,2);for(let te=0;te<F;te++){let ue=te+Xe.truncDivision(te,15);w[F-te-1]=q-ue-1,w[F+te]=q+ue+1}}for(let O=0,F=0;O<g;O++){let q=(g-O)*4+(u?9:12),te=O*2,ue=v-1-te;for(let xe=0;xe<q;xe++){let Oe=xe*2;for(let ot=0;ot<2;ot++)I[F+Oe+ot]=a.get(w[te+ot],w[te+xe]),I[F+2*q+Oe+ot]=a.get(w[te+xe],w[ue-ot]),I[F+4*q+Oe+ot]=a.get(w[ue-ot],w[ue-xe]),I[F+6*q+Oe+ot]=a.get(w[ue-xe],w[te+ot])}F+=q*8}return I}static readCode(a,u,g){let v=0;for(let w=u;w<u+g;w++)v<<=1,a[w]&&(v|=1);return v}static readByte(a,u){let g=a.length-u;return g>=8?Gn.readCode(a,u,8):Gn.readCode(a,u,g)<<8-g}static convertBoolArrayToByteArray(a){let u=new Uint8Array((a.length+7)/8);for(let g=0;g<u.length;g++)u[g]=Gn.readByte(a,8*g);return u}totalBitsInLayer(a,u){return((u?88:112)+16*a)*a}}Gn.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],Gn.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],Gn.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],Gn.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],Gn.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class Rn{constructor(){}static round(a){return a===NaN?0:a<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:a>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:a+(a<0?-.5:.5)|0}static distance(a,u,g,v){const w=a-g,I=u-v;return Math.sqrt(w*w+I*I)}static sum(a){let u=0;for(let g=0,v=a.length;g!==v;g++){const w=a[g];u+=w}return u}}class Ei{static floatToIntBits(a){return a}}Ei.MAX_VALUE=Number.MAX_SAFE_INTEGER;class on{constructor(a,u){this.x=a,this.y=u}getX(){return this.x}getY(){return this.y}equals(a){if(a instanceof on){const u=a;return this.x===u.x&&this.y===u.y}return!1}hashCode(){return 31*Ei.floatToIntBits(this.x)+Ei.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(a){const u=this.distance(a[0],a[1]),g=this.distance(a[1],a[2]),v=this.distance(a[0],a[2]);let w,I,O;if(g>=u&&g>=v?(I=a[0],w=a[1],O=a[2]):v>=g&&v>=u?(I=a[1],w=a[0],O=a[2]):(I=a[2],w=a[0],O=a[1]),this.crossProductZ(w,I,O)<0){const F=w;w=O,O=F}a[0]=w,a[1]=I,a[2]=O}static distance(a,u){return Rn.distance(a.x,a.y,u.x,u.y)}static crossProductZ(a,u,g){const v=u.x,w=u.y;return(g.x-v)*(a.y-w)-(g.y-w)*(a.x-v)}}class Li{constructor(a,u){this.bits=a,this.points=u}getBits(){return this.bits}getPoints(){return this.points}}class tr extends Li{constructor(a,u,g,v,w){super(a,u),this.compact=g,this.nbDatablocks=v,this.nbLayers=w}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Di{constructor(a,u,g,v){this.image=a,this.height=a.getHeight(),this.width=a.getWidth(),u==null&&(u=Di.INIT_SIZE),g==null&&(g=a.getWidth()/2|0),v==null&&(v=a.getHeight()/2|0);const w=u/2|0;if(this.leftInit=g-w,this.rightInit=g+w,this.upInit=v-w,this.downInit=v+w,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new ke}detect(){let a=this.leftInit,u=this.rightInit,g=this.upInit,v=this.downInit,w=!1,I=!0,O=!1,F=!1,q=!1,te=!1,ue=!1;const xe=this.width,Oe=this.height;for(;I;){I=!1;let ot=!0;for(;(ot||!F)&&u<xe;)ot=this.containsBlackPoint(g,v,u,!1),ot?(u++,I=!0,F=!0):F||u++;if(u>=xe){w=!0;break}let ft=!0;for(;(ft||!q)&&v<Oe;)ft=this.containsBlackPoint(a,u,v,!0),ft?(v++,I=!0,q=!0):q||v++;if(v>=Oe){w=!0;break}let Rt=!0;for(;(Rt||!te)&&a>=0;)Rt=this.containsBlackPoint(g,v,a,!1),Rt?(a--,I=!0,te=!0):te||a--;if(a<0){w=!0;break}let Ht=!0;for(;(Ht||!ue)&&g>=0;)Ht=this.containsBlackPoint(a,u,g,!0),Ht?(g--,I=!0,ue=!0):ue||g--;if(g<0){w=!0;break}I&&(O=!0)}if(!w&&O){const ot=u-a;let ft=null;for(let wn=1;ft===null&&wn<ot;wn++)ft=this.getBlackPointOnSegment(a,v-wn,a+wn,v);if(ft==null)throw new ke;let Rt=null;for(let wn=1;Rt===null&&wn<ot;wn++)Rt=this.getBlackPointOnSegment(a,g+wn,a+wn,g);if(Rt==null)throw new ke;let Ht=null;for(let wn=1;Ht===null&&wn<ot;wn++)Ht=this.getBlackPointOnSegment(u,g+wn,u-wn,g);if(Ht==null)throw new ke;let An=null;for(let wn=1;An===null&&wn<ot;wn++)An=this.getBlackPointOnSegment(u,v-wn,u-wn,v);if(An==null)throw new ke;return this.centerEdges(An,ft,Ht,Rt)}else throw new ke}getBlackPointOnSegment(a,u,g,v){const w=Rn.round(Rn.distance(a,u,g,v)),I=(g-a)/w,O=(v-u)/w,F=this.image;for(let q=0;q<w;q++){const te=Rn.round(a+q*I),ue=Rn.round(u+q*O);if(F.get(te,ue))return new on(te,ue)}return null}centerEdges(a,u,g,v){const w=a.getX(),I=a.getY(),O=u.getX(),F=u.getY(),q=g.getX(),te=g.getY(),ue=v.getX(),xe=v.getY(),Oe=Di.CORR;return w<this.width/2?[new on(ue-Oe,xe+Oe),new on(O+Oe,F+Oe),new on(q-Oe,te-Oe),new on(w+Oe,I-Oe)]:[new on(ue+Oe,xe+Oe),new on(O+Oe,F-Oe),new on(q-Oe,te+Oe),new on(w-Oe,I-Oe)]}containsBlackPoint(a,u,g,v){const w=this.image;if(v){for(let I=a;I<=u;I++)if(w.get(I,g))return!0}else for(let I=a;I<=u;I++)if(w.get(g,I))return!0;return!1}}Di.INIT_SIZE=10,Di.CORR=1;class yr{static checkAndNudgePoints(a,u){const g=a.getWidth(),v=a.getHeight();let w=!0;for(let I=0;I<u.length&&w;I+=2){const O=Math.floor(u[I]),F=Math.floor(u[I+1]);if(O<-1||O>g||F<-1||F>v)throw new ke;w=!1,O===-1?(u[I]=0,w=!0):O===g&&(u[I]=g-1,w=!0),F===-1?(u[I+1]=0,w=!0):F===v&&(u[I+1]=v-1,w=!0)}w=!0;for(let I=u.length-2;I>=0&&w;I-=2){const O=Math.floor(u[I]),F=Math.floor(u[I+1]);if(O<-1||O>g||F<-1||F>v)throw new ke;w=!1,O===-1?(u[I]=0,w=!0):O===g&&(u[I]=g-1,w=!0),F===-1?(u[I+1]=0,w=!0):F===v&&(u[I+1]=v-1,w=!0)}}}class yt{constructor(a,u,g,v,w,I,O,F,q){this.a11=a,this.a21=u,this.a31=g,this.a12=v,this.a22=w,this.a32=I,this.a13=O,this.a23=F,this.a33=q}static quadrilateralToQuadrilateral(a,u,g,v,w,I,O,F,q,te,ue,xe,Oe,ot,ft,Rt){const Ht=yt.quadrilateralToSquare(a,u,g,v,w,I,O,F);return yt.squareToQuadrilateral(q,te,ue,xe,Oe,ot,ft,Rt).times(Ht)}transformPoints(a){const u=a.length,g=this.a11,v=this.a12,w=this.a13,I=this.a21,O=this.a22,F=this.a23,q=this.a31,te=this.a32,ue=this.a33;for(let xe=0;xe<u;xe+=2){const Oe=a[xe],ot=a[xe+1],ft=w*Oe+F*ot+ue;a[xe]=(g*Oe+I*ot+q)/ft,a[xe+1]=(v*Oe+O*ot+te)/ft}}transformPointsWithValues(a,u){const g=this.a11,v=this.a12,w=this.a13,I=this.a21,O=this.a22,F=this.a23,q=this.a31,te=this.a32,ue=this.a33,xe=a.length;for(let Oe=0;Oe<xe;Oe++){const ot=a[Oe],ft=u[Oe],Rt=w*ot+F*ft+ue;a[Oe]=(g*ot+I*ft+q)/Rt,u[Oe]=(v*ot+O*ft+te)/Rt}}static squareToQuadrilateral(a,u,g,v,w,I,O,F){const q=a-g+w-O,te=u-v+I-F;if(q===0&&te===0)return new yt(g-a,w-g,a,v-u,I-v,u,0,0,1);{const ue=g-w,xe=O-w,Oe=v-I,ot=F-I,ft=ue*ot-xe*Oe,Rt=(q*ot-xe*te)/ft,Ht=(ue*te-q*Oe)/ft;return new yt(g-a+Rt*g,O-a+Ht*O,a,v-u+Rt*v,F-u+Ht*F,u,Rt,Ht,1)}}static quadrilateralToSquare(a,u,g,v,w,I,O,F){return yt.squareToQuadrilateral(a,u,g,v,w,I,O,F).buildAdjoint()}buildAdjoint(){return new yt(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(a){return new yt(this.a11*a.a11+this.a21*a.a12+this.a31*a.a13,this.a11*a.a21+this.a21*a.a22+this.a31*a.a23,this.a11*a.a31+this.a21*a.a32+this.a31*a.a33,this.a12*a.a11+this.a22*a.a12+this.a32*a.a13,this.a12*a.a21+this.a22*a.a22+this.a32*a.a23,this.a12*a.a31+this.a22*a.a32+this.a32*a.a33,this.a13*a.a11+this.a23*a.a12+this.a33*a.a13,this.a13*a.a21+this.a23*a.a22+this.a33*a.a23,this.a13*a.a31+this.a23*a.a32+this.a33*a.a33)}}class oe extends yr{sampleGrid(a,u,g,v,w,I,O,F,q,te,ue,xe,Oe,ot,ft,Rt,Ht,An,wn){const mn=yt.quadrilateralToQuadrilateral(v,w,I,O,F,q,te,ue,xe,Oe,ot,ft,Rt,Ht,An,wn);return this.sampleGridWithTransform(a,u,g,mn)}sampleGridWithTransform(a,u,g,v){if(u<=0||g<=0)throw new ke;const w=new qt(u,g),I=new Float32Array(2*u);for(let O=0;O<g;O++){const F=I.length,q=O+.5;for(let te=0;te<F;te+=2)I[te]=te/2+.5,I[te+1]=q;v.transformPoints(I),yr.checkAndNudgePoints(a,I);try{for(let te=0;te<F;te+=2)a.get(Math.floor(I[te]),Math.floor(I[te+1]))&&w.set(te/2,O)}catch{throw new ke}}return w}}class le{static setGridSampler(a){le.gridSampler=a}static getInstance(){return le.gridSampler}}le.gridSampler=new oe;class ge{constructor(a,u){this.x=a,this.y=u}toResultPoint(){return new on(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Ue{constructor(a){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=a}detect(){return this.detectMirror(!1)}detectMirror(a){let u=this.getMatrixCenter(),g=this.getBullsEyeCorners(u);if(a){let I=g[0];g[0]=g[2],g[2]=I}this.extractParameters(g);let v=this.sampleGrid(this.image,g[this.shift%4],g[(this.shift+1)%4],g[(this.shift+2)%4],g[(this.shift+3)%4]),w=this.getMatrixCornerPoints(g);return new tr(v,w,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(a){if(!this.isValidPoint(a[0])||!this.isValidPoint(a[1])||!this.isValidPoint(a[2])||!this.isValidPoint(a[3]))throw new ke;let u=2*this.nbCenterLayers,g=new Int32Array([this.sampleLine(a[0],a[1],u),this.sampleLine(a[1],a[2],u),this.sampleLine(a[2],a[3],u),this.sampleLine(a[3],a[0],u)]);this.shift=this.getRotation(g,u);let v=0;for(let I=0;I<4;I++){let O=g[(this.shift+I)%4];this.compact?(v<<=7,v+=O>>1&127):(v<<=10,v+=(O>>2&992)+(O>>1&31))}let w=this.getCorrectedParameterData(v,this.compact);this.compact?(this.nbLayers=(w>>6)+1,this.nbDataBlocks=(w&63)+1):(this.nbLayers=(w>>11)+1,this.nbDataBlocks=(w&2047)+1)}getRotation(a,u){let g=0;a.forEach((v,w,I)=>{let O=(v>>u-2<<1)+(v&1);g=(g<<3)+O}),g=((g&1)<<11)+(g>>1);for(let v=0;v<4;v++)if(Xe.bitCount(g^this.EXPECTED_CORNER_BITS[v])<=2)return v;throw new ke}getCorrectedParameterData(a,u){let g,v;u?(g=7,v=2):(g=10,v=4);let w=g-v,I=new Int32Array(g);for(let F=g-1;F>=0;--F)I[F]=a&15,a>>=4;try{new Oi(En.AZTEC_PARAM).decode(I,w)}catch{throw new ke}let O=0;for(let F=0;F<v;F++)O=(O<<4)+I[F];return O}getBullsEyeCorners(a){let u=a,g=a,v=a,w=a,I=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let ue=this.getFirstDifferent(u,I,1,-1),xe=this.getFirstDifferent(g,I,1,1),Oe=this.getFirstDifferent(v,I,-1,1),ot=this.getFirstDifferent(w,I,-1,-1);if(this.nbCenterLayers>2){let ft=this.distancePoint(ot,ue)*this.nbCenterLayers/(this.distancePoint(w,u)*(this.nbCenterLayers+2));if(ft<.75||ft>1.25||!this.isWhiteOrBlackRectangle(ue,xe,Oe,ot))break}u=ue,g=xe,v=Oe,w=ot,I=!I}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new ke;this.compact=this.nbCenterLayers===5;let O=new on(u.getX()+.5,u.getY()-.5),F=new on(g.getX()+.5,g.getY()+.5),q=new on(v.getX()-.5,v.getY()+.5),te=new on(w.getX()-.5,w.getY()-.5);return this.expandSquare([O,F,q,te],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let a,u,g,v;try{let O=new Di(this.image).detect();a=O[0],u=O[1],g=O[2],v=O[3]}catch{let F=this.image.getWidth()/2,q=this.image.getHeight()/2;a=this.getFirstDifferent(new ge(F+7,q-7),!1,1,-1).toResultPoint(),u=this.getFirstDifferent(new ge(F+7,q+7),!1,1,1).toResultPoint(),g=this.getFirstDifferent(new ge(F-7,q+7),!1,-1,1).toResultPoint(),v=this.getFirstDifferent(new ge(F-7,q-7),!1,-1,-1).toResultPoint()}let w=Rn.round((a.getX()+v.getX()+u.getX()+g.getX())/4),I=Rn.round((a.getY()+v.getY()+u.getY()+g.getY())/4);try{let O=new Di(this.image,15,w,I).detect();a=O[0],u=O[1],g=O[2],v=O[3]}catch{a=this.getFirstDifferent(new ge(w+7,I-7),!1,1,-1).toResultPoint(),u=this.getFirstDifferent(new ge(w+7,I+7),!1,1,1).toResultPoint(),g=this.getFirstDifferent(new ge(w-7,I+7),!1,-1,1).toResultPoint(),v=this.getFirstDifferent(new ge(w-7,I-7),!1,-1,-1).toResultPoint()}return w=Rn.round((a.getX()+v.getX()+u.getX()+g.getX())/4),I=Rn.round((a.getY()+v.getY()+u.getY()+g.getY())/4),new ge(w,I)}getMatrixCornerPoints(a){return this.expandSquare(a,2*this.nbCenterLayers,this.getDimension())}sampleGrid(a,u,g,v,w){let I=le.getInstance(),O=this.getDimension(),F=O/2-this.nbCenterLayers,q=O/2+this.nbCenterLayers;return I.sampleGrid(a,O,O,F,F,q,F,q,q,F,q,u.getX(),u.getY(),g.getX(),g.getY(),v.getX(),v.getY(),w.getX(),w.getY())}sampleLine(a,u,g){let v=0,w=this.distanceResultPoint(a,u),I=w/g,O=a.getX(),F=a.getY(),q=I*(u.getX()-a.getX())/w,te=I*(u.getY()-a.getY())/w;for(let ue=0;ue<g;ue++)this.image.get(Rn.round(O+ue*q),Rn.round(F+ue*te))&&(v|=1<<g-ue-1);return v}isWhiteOrBlackRectangle(a,u,g,v){let w=3;a=new ge(a.getX()-w,a.getY()+w),u=new ge(u.getX()-w,u.getY()-w),g=new ge(g.getX()+w,g.getY()-w),v=new ge(v.getX()+w,v.getY()+w);let I=this.getColor(v,a);if(I===0)return!1;let O=this.getColor(a,u);return O!==I||(O=this.getColor(u,g),O!==I)?!1:(O=this.getColor(g,v),O===I)}getColor(a,u){let g=this.distancePoint(a,u),v=(u.getX()-a.getX())/g,w=(u.getY()-a.getY())/g,I=0,O=a.getX(),F=a.getY(),q=this.image.get(a.getX(),a.getY()),te=Math.ceil(g);for(let xe=0;xe<te;xe++)O+=v,F+=w,this.image.get(Rn.round(O),Rn.round(F))!==q&&I++;let ue=I/g;return ue>.1&&ue<.9?0:ue<=.1===q?1:-1}getFirstDifferent(a,u,g,v){let w=a.getX()+g,I=a.getY()+v;for(;this.isValid(w,I)&&this.image.get(w,I)===u;)w+=g,I+=v;for(w-=g,I-=v;this.isValid(w,I)&&this.image.get(w,I)===u;)w+=g;for(w-=g;this.isValid(w,I)&&this.image.get(w,I)===u;)I+=v;return I-=v,new ge(w,I)}expandSquare(a,u,g){let v=g/(2*u),w=a[0].getX()-a[2].getX(),I=a[0].getY()-a[2].getY(),O=(a[0].getX()+a[2].getX())/2,F=(a[0].getY()+a[2].getY())/2,q=new on(O+v*w,F+v*I),te=new on(O-v*w,F-v*I);w=a[1].getX()-a[3].getX(),I=a[1].getY()-a[3].getY(),O=(a[1].getX()+a[3].getX())/2,F=(a[1].getY()+a[3].getY())/2;let ue=new on(O+v*w,F+v*I),xe=new on(O-v*w,F-v*I);return[q,ue,te,xe]}isValid(a,u){return a>=0&&a<this.image.getWidth()&&u>0&&u<this.image.getHeight()}isValidPoint(a){let u=Rn.round(a.getX()),g=Rn.round(a.getY());return this.isValid(u,g)}distancePoint(a,u){return Rn.distance(a.getX(),a.getY(),u.getX(),u.getY())}distanceResultPoint(a,u){return Rn.distance(a.getX(),a.getY(),u.getX(),u.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Xe.truncDivision(this.nbLayers-4,8)+1)+15}}class Ye{decode(a,u=null){let g=null,v=new Ue(a.getBlackMatrix()),w=null,I=null;try{let te=v.detectMirror(!1);w=te.getPoints(),this.reportFoundResultPoints(u,w),I=new Gn().decode(te)}catch(te){g=te}if(I==null)try{let te=v.detectMirror(!0);w=te.getPoints(),this.reportFoundResultPoints(u,w),I=new Gn().decode(te)}catch(te){throw g??te}let O=new bt(I.getText(),I.getRawBytes(),I.getNumBits(),w,Bt.AZTEC,pe.currentTimeMillis()),F=I.getByteSegments();F!=null&&O.putMetadata(un.BYTE_SEGMENTS,F);let q=I.getECLevel();return q!=null&&O.putMetadata(un.ERROR_CORRECTION_LEVEL,q),O}reportFoundResultPoints(a,u){if(a!=null){let g=a.get(Et.NEED_RESULT_POINT_CALLBACK);g!=null&&u.forEach((v,w,I)=>{g.foundPossibleResultPoint(v)})}}reset(){}}class At extends kt{constructor(a=500){super(new Ye,a)}}class it{decode(a,u){try{return this.doDecode(a,u)}catch{if(u&&u.get(Et.TRY_HARDER)===!0&&a.isRotateSupported()){const w=a.rotateCounterClockwise(),I=this.doDecode(w,u),O=I.getResultMetadata();let F=270;O!==null&&O.get(un.ORIENTATION)===!0&&(F=F+O.get(un.ORIENTATION)%360),I.putMetadata(un.ORIENTATION,F);const q=I.getResultPoints();if(q!==null){const te=w.getHeight();for(let ue=0;ue<q.length;ue++)q[ue]=new on(te-q[ue].getY()-1,q[ue].getX())}return I}else throw new ke}}reset(){}doDecode(a,u){const g=a.getWidth(),v=a.getHeight();let w=new mt(g);const I=u&&u.get(Et.TRY_HARDER)===!0,O=Math.max(1,v>>(I?8:5));let F;I?F=v:F=15;const q=Math.trunc(v/2);for(let te=0;te<F;te++){const ue=Math.trunc((te+1)/2),xe=(te&1)===0,Oe=q+O*(xe?ue:-ue);if(Oe<0||Oe>=v)break;try{w=a.getBlackRow(Oe,w)}catch{continue}for(let ot=0;ot<2;ot++){if(ot===1&&(w.reverse(),u&&u.get(Et.NEED_RESULT_POINT_CALLBACK)===!0)){const ft=new Map;u.forEach((Rt,Ht)=>ft.set(Ht,Rt)),ft.delete(Et.NEED_RESULT_POINT_CALLBACK),u=ft}try{const ft=this.decodeRow(Oe,w,u);if(ot===1){ft.putMetadata(un.ORIENTATION,180);const Rt=ft.getResultPoints();Rt!==null&&(Rt[0]=new on(g-Rt[0].getX()-1,Rt[0].getY()),Rt[1]=new on(g-Rt[1].getX()-1,Rt[1].getY()))}return ft}catch{}}}throw new ke}static recordPattern(a,u,g){const v=g.length;for(let q=0;q<v;q++)g[q]=0;const w=a.getSize();if(u>=w)throw new ke;let I=!a.get(u),O=0,F=u;for(;F<w;){if(a.get(F)!==I)g[O]++;else{if(++O===v)break;g[O]=1,I=!I}F++}if(!(O===v||O===v-1&&F===w))throw new ke}static recordPatternInReverse(a,u,g){let v=g.length,w=a.get(u);for(;u>0&&v>=0;)a.get(--u)!==w&&(v--,w=!w);if(v>=0)throw new ke;it.recordPattern(a,u+1,g)}static patternMatchVariance(a,u,g){const v=a.length;let w=0,I=0;for(let q=0;q<v;q++)w+=a[q],I+=u[q];if(w<I)return Number.POSITIVE_INFINITY;const O=w/I;g*=O;let F=0;for(let q=0;q<v;q++){const te=a[q],ue=u[q]*O,xe=te>ue?te-ue:ue-te;if(xe>g)return Number.POSITIVE_INFINITY;F+=xe}return F/w}}class de extends it{static findStartPattern(a){const u=a.getSize(),g=a.getNextSet(0);let v=0,w=Int32Array.from([0,0,0,0,0,0]),I=g,O=!1;const F=6;for(let q=g;q<u;q++)if(a.get(q)!==O)w[v]++;else{if(v===F-1){let te=de.MAX_AVG_VARIANCE,ue=-1;for(let xe=de.CODE_START_A;xe<=de.CODE_START_C;xe++){const Oe=it.patternMatchVariance(w,de.CODE_PATTERNS[xe],de.MAX_INDIVIDUAL_VARIANCE);Oe<te&&(te=Oe,ue=xe)}if(ue>=0&&a.isRange(Math.max(0,I-(q-I)/2),I,!1))return Int32Array.from([I,q,ue]);I+=w[0]+w[1],w=w.slice(2,w.length-1),w[v-1]=0,w[v]=0,v--}else v++;w[v]=1,O=!O}throw new ke}static decodeCode(a,u,g){it.recordPattern(a,g,u);let v=de.MAX_AVG_VARIANCE,w=-1;for(let I=0;I<de.CODE_PATTERNS.length;I++){const O=de.CODE_PATTERNS[I],F=this.patternMatchVariance(u,O,de.MAX_INDIVIDUAL_VARIANCE);F<v&&(v=F,w=I)}if(w>=0)return w;throw new ke}decodeRow(a,u,g){const v=g&&g.get(Et.ASSUME_GS1)===!0,w=de.findStartPattern(u),I=w[2];let O=0;const F=new Uint8Array(20);F[O++]=I;let q;switch(I){case de.CODE_START_A:q=de.CODE_CODE_A;break;case de.CODE_START_B:q=de.CODE_CODE_B;break;case de.CODE_START_C:q=de.CODE_CODE_C;break;default:throw new rt}let te=!1,ue=!1,xe="",Oe=w[0],ot=w[1];const ft=Int32Array.from([0,0,0,0,0,0]);let Rt=0,Ht=0,An=I,wn=0,mn=!0,Ki=!1,Zn=!1;for(;!te;){const js=ue;switch(ue=!1,Rt=Ht,Ht=de.decodeCode(u,ft,ot),F[O++]=Ht,Ht!==de.CODE_STOP&&(mn=!0),Ht!==de.CODE_STOP&&(wn++,An+=wn*Ht),Oe=ot,ot+=ft.reduce((sh,bu)=>sh+bu,0),Ht){case de.CODE_START_A:case de.CODE_START_B:case de.CODE_START_C:throw new rt}switch(q){case de.CODE_CODE_A:if(Ht<64)Zn===Ki?xe+=String.fromCharCode(32+Ht):xe+=String.fromCharCode(32+Ht+128),Zn=!1;else if(Ht<96)Zn===Ki?xe+=String.fromCharCode(Ht-64):xe+=String.fromCharCode(Ht+64),Zn=!1;else switch(Ht!==de.CODE_STOP&&(mn=!1),Ht){case de.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case de.CODE_FNC_2:case de.CODE_FNC_3:break;case de.CODE_FNC_4_A:!Ki&&Zn?(Ki=!0,Zn=!1):Ki&&Zn?(Ki=!1,Zn=!1):Zn=!0;break;case de.CODE_SHIFT:ue=!0,q=de.CODE_CODE_B;break;case de.CODE_CODE_B:q=de.CODE_CODE_B;break;case de.CODE_CODE_C:q=de.CODE_CODE_C;break;case de.CODE_STOP:te=!0;break}break;case de.CODE_CODE_B:if(Ht<96)Zn===Ki?xe+=String.fromCharCode(32+Ht):xe+=String.fromCharCode(32+Ht+128),Zn=!1;else switch(Ht!==de.CODE_STOP&&(mn=!1),Ht){case de.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case de.CODE_FNC_2:case de.CODE_FNC_3:break;case de.CODE_FNC_4_B:!Ki&&Zn?(Ki=!0,Zn=!1):Ki&&Zn?(Ki=!1,Zn=!1):Zn=!0;break;case de.CODE_SHIFT:ue=!0,q=de.CODE_CODE_A;break;case de.CODE_CODE_A:q=de.CODE_CODE_A;break;case de.CODE_CODE_C:q=de.CODE_CODE_C;break;case de.CODE_STOP:te=!0;break}break;case de.CODE_CODE_C:if(Ht<100)Ht<10&&(xe+="0"),xe+=Ht;else switch(Ht!==de.CODE_STOP&&(mn=!1),Ht){case de.CODE_FNC_1:v&&(xe.length===0?xe+="]C1":xe+="");break;case de.CODE_CODE_A:q=de.CODE_CODE_A;break;case de.CODE_CODE_B:q=de.CODE_CODE_B;break;case de.CODE_STOP:te=!0;break}break}js&&(q=q===de.CODE_CODE_A?de.CODE_CODE_B:de.CODE_CODE_A)}const is=ot-Oe;if(ot=u.getNextUnset(ot),!u.isRange(ot,Math.min(u.getSize(),ot+(ot-Oe)/2),!1))throw new ke;if(An-=wn*Rt,An%103!==Rt)throw new we;const ga=xe.length;if(ga===0)throw new ke;ga>0&&mn&&(q===de.CODE_CODE_C?xe=xe.substring(0,ga-2):xe=xe.substring(0,ga-1));const Fs=(w[1]+w[0])/2,Er=Oe+is/2,rs=F.length,Ws=new Uint8Array(rs);for(let js=0;js<rs;js++)Ws[js]=F[js];const ro=[new on(Fs,a),new on(Er,a)];return new bt(xe,Ws,0,ro,Bt.CODE_128,new Date().getTime())}}de.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],de.MAX_AVG_VARIANCE=.25,de.MAX_INDIVIDUAL_VARIANCE=.7,de.CODE_SHIFT=98,de.CODE_CODE_C=99,de.CODE_CODE_B=100,de.CODE_CODE_A=101,de.CODE_FNC_1=102,de.CODE_FNC_2=97,de.CODE_FNC_3=96,de.CODE_FNC_4_A=101,de.CODE_FNC_4_B=100,de.CODE_START_A=103,de.CODE_START_B=104,de.CODE_START_C=105,de.CODE_STOP=106;class qe extends it{constructor(a=!1,u=!1){super(),this.usingCheckDigit=a,this.extendedMode=u,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(a,u,g){let v=this.counters;v.fill(0),this.decodeRowResult="";let w=qe.findAsteriskPattern(u,v),I=u.getNextSet(w[1]),O=u.getSize(),F,q;do{qe.recordPattern(u,I,v);let ft=qe.toNarrowWidePattern(v);if(ft<0)throw new ke;F=qe.patternToChar(ft),this.decodeRowResult+=F,q=I;for(let Rt of v)I+=Rt;I=u.getNextSet(I)}while(F!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let te=0;for(let ft of v)te+=ft;let ue=I-q-te;if(I!==O&&ue*2<te)throw new ke;if(this.usingCheckDigit){let ft=this.decodeRowResult.length-1,Rt=0;for(let Ht=0;Ht<ft;Ht++)Rt+=qe.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Ht));if(this.decodeRowResult.charAt(ft)!==qe.ALPHABET_STRING.charAt(Rt%43))throw new we;this.decodeRowResult=this.decodeRowResult.substring(0,ft)}if(this.decodeRowResult.length===0)throw new ke;let xe;this.extendedMode?xe=qe.decodeExtended(this.decodeRowResult):xe=this.decodeRowResult;let Oe=(w[1]+w[0])/2,ot=q+te/2;return new bt(xe,null,0,[new on(Oe,a),new on(ot,a)],Bt.CODE_39,new Date().getTime())}static findAsteriskPattern(a,u){let g=a.getSize(),v=a.getNextSet(0),w=0,I=v,O=!1,F=u.length;for(let q=v;q<g;q++)if(a.get(q)!==O)u[w]++;else{if(w===F-1){if(this.toNarrowWidePattern(u)===qe.ASTERISK_ENCODING&&a.isRange(Math.max(0,I-Math.floor((q-I)/2)),I,!1))return[I,q];I+=u[0]+u[1],u.copyWithin(0,2,2+w-1),u[w-1]=0,u[w]=0,w--}else w++;u[w]=1,O=!O}throw new ke}static toNarrowWidePattern(a){let u=a.length,g=0,v;do{let w=2147483647;for(let F of a)F<w&&F>g&&(w=F);g=w,v=0;let I=0,O=0;for(let F=0;F<u;F++){let q=a[F];q>g&&(O|=1<<u-1-F,v++,I+=q)}if(v===3){for(let F=0;F<u&&v>0;F++){let q=a[F];if(q>g&&(v--,q*2>=I))return-1}return O}}while(v>3);return-1}static patternToChar(a){for(let u=0;u<qe.CHARACTER_ENCODINGS.length;u++)if(qe.CHARACTER_ENCODINGS[u]===a)return qe.ALPHABET_STRING.charAt(u);if(a===qe.ASTERISK_ENCODING)return"*";throw new ke}static decodeExtended(a){let u=a.length,g="";for(let v=0;v<u;v++){let w=a.charAt(v);if(w==="+"||w==="$"||w==="%"||w==="/"){let I=a.charAt(v+1),O="\0";switch(w){case"+":if(I>="A"&&I<="Z")O=String.fromCharCode(I.charCodeAt(0)+32);else throw new rt;break;case"$":if(I>="A"&&I<="Z")O=String.fromCharCode(I.charCodeAt(0)-64);else throw new rt;break;case"%":if(I>="A"&&I<="E")O=String.fromCharCode(I.charCodeAt(0)-38);else if(I>="F"&&I<="J")O=String.fromCharCode(I.charCodeAt(0)-11);else if(I>="K"&&I<="O")O=String.fromCharCode(I.charCodeAt(0)+16);else if(I>="P"&&I<="T")O=String.fromCharCode(I.charCodeAt(0)+43);else if(I==="U")O="\0";else if(I==="V")O="@";else if(I==="W")O="`";else if(I==="X"||I==="Y"||I==="Z")O="";else throw new rt;break;case"/":if(I>="A"&&I<="O")O=String.fromCharCode(I.charCodeAt(0)-32);else if(I==="Z")O=":";else throw new rt;break}g+=O,v++}else g+=w}return g}}qe.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",qe.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],qe.ASTERISK_ENCODING=148;class xt extends it{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(a,u,g){let v=this.decodeStart(u),w=this.decodeEnd(u),I=new vt;xt.decodeMiddle(u,v[1],w[0],I);let O=I.toString(),F=null;g!=null&&(F=g.get(Et.ALLOWED_LENGTHS)),F==null&&(F=xt.DEFAULT_ALLOWED_LENGTHS);let q=O.length,te=!1,ue=0;for(let ot of F){if(q===ot){te=!0;break}ot>ue&&(ue=ot)}if(!te&&q>ue&&(te=!0),!te)throw new rt;const xe=[new on(v[1],a),new on(w[0],a)];return new bt(O,null,0,xe,Bt.ITF,new Date().getTime())}static decodeMiddle(a,u,g,v){let w=new Int32Array(10),I=new Int32Array(5),O=new Int32Array(5);for(w.fill(0),I.fill(0),O.fill(0);u<g;){it.recordPattern(a,u,w);for(let q=0;q<5;q++){let te=2*q;I[q]=w[te],O[q]=w[te+1]}let F=xt.decodeDigit(I);v.append(F.toString()),F=this.decodeDigit(O),v.append(F.toString()),w.forEach(function(q){u+=q})}}decodeStart(a){let u=xt.skipWhiteSpace(a),g=xt.findGuardPattern(a,u,xt.START_PATTERN);return this.narrowLineWidth=(g[1]-g[0])/4,this.validateQuietZone(a,g[0]),g}validateQuietZone(a,u){let g=this.narrowLineWidth*10;g=g<u?g:u;for(let v=u-1;g>0&&v>=0&&!a.get(v);v--)g--;if(g!==0)throw new ke}static skipWhiteSpace(a){const u=a.getSize(),g=a.getNextSet(0);if(g===u)throw new ke;return g}decodeEnd(a){a.reverse();try{let u=xt.skipWhiteSpace(a),g;try{g=xt.findGuardPattern(a,u,xt.END_PATTERN_REVERSED[0])}catch(w){w instanceof ke&&(g=xt.findGuardPattern(a,u,xt.END_PATTERN_REVERSED[1]))}this.validateQuietZone(a,g[0]);let v=g[0];return g[0]=a.getSize()-g[1],g[1]=a.getSize()-v,g}finally{a.reverse()}}static findGuardPattern(a,u,g){let v=g.length,w=new Int32Array(v),I=a.getSize(),O=!1,F=0,q=u;w.fill(0);for(let te=u;te<I;te++)if(a.get(te)!==O)w[F]++;else{if(F===v-1){if(it.patternMatchVariance(w,g,xt.MAX_INDIVIDUAL_VARIANCE)<xt.MAX_AVG_VARIANCE)return[q,te];q+=w[0]+w[1],pe.arraycopy(w,2,w,0,F-1),w[F-1]=0,w[F]=0,F--}else F++;w[F]=1,O=!O}throw new ke}static decodeDigit(a){let u=xt.MAX_AVG_VARIANCE,g=-1,v=xt.PATTERNS.length;for(let w=0;w<v;w++){let I=xt.PATTERNS[w],O=it.patternMatchVariance(a,I,xt.MAX_INDIVIDUAL_VARIANCE);O<u?(u=O,g=w):O===u&&(g=-1)}if(g>=0)return g%10;throw new ke}}xt.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],xt.MAX_AVG_VARIANCE=.38,xt.MAX_INDIVIDUAL_VARIANCE=.5,xt.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],xt.START_PATTERN=Int32Array.from([1,1,1,1]),xt.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Fe extends it{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(a){let u=!1,g,v=0,w=Int32Array.from([0,0,0]);for(;!u;){w=Int32Array.from([0,0,0]),g=Fe.findGuardPattern(a,v,!1,this.START_END_PATTERN,w);let I=g[0];v=g[1];let O=I-(v-I);O>=0&&(u=a.isRange(O,I,!1))}return g}static checkChecksum(a){return Fe.checkStandardUPCEANChecksum(a)}static checkStandardUPCEANChecksum(a){let u=a.length;if(u===0)return!1;let g=parseInt(a.charAt(u-1),10);return Fe.getStandardUPCEANChecksum(a.substring(0,u-1))===g}static getStandardUPCEANChecksum(a){let u=a.length,g=0;for(let v=u-1;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new rt;g+=w}g*=3;for(let v=u-2;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new rt;g+=w}return(1e3-g)%10}static decodeEnd(a,u){return Fe.findGuardPattern(a,u,!1,Fe.START_END_PATTERN,new Int32Array(Fe.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(a,u,g,v){return this.findGuardPattern(a,u,g,v,new Int32Array(v.length))}static findGuardPattern(a,u,g,v,w){let I=a.getSize();u=g?a.getNextUnset(u):a.getNextSet(u);let O=0,F=u,q=v.length,te=g;for(let ue=u;ue<I;ue++)if(a.get(ue)!==te)w[O]++;else{if(O===q-1){if(it.patternMatchVariance(w,v,Fe.MAX_INDIVIDUAL_VARIANCE)<Fe.MAX_AVG_VARIANCE)return Int32Array.from([F,ue]);F+=w[0]+w[1];let xe=w.slice(2,w.length-1);for(let Oe=0;Oe<O-1;Oe++)w[Oe]=xe[Oe];w[O-1]=0,w[O]=0,O--}else O++;w[O]=1,te=!te}throw new ke}static decodeDigit(a,u,g,v){this.recordPattern(a,g,u);let w=this.MAX_AVG_VARIANCE,I=-1,O=v.length;for(let F=0;F<O;F++){let q=v[F],te=it.patternMatchVariance(u,q,Fe.MAX_INDIVIDUAL_VARIANCE);te<w&&(w=te,I=F)}if(I>=0)return I;throw new ke}}Fe.MAX_AVG_VARIANCE=.48,Fe.MAX_INDIVIDUAL_VARIANCE=.7,Fe.START_END_PATTERN=Int32Array.from([1,1,1]),Fe.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Fe.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Fe.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class St{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(a,u,g){let v=this.decodeRowStringBuffer,w=this.decodeMiddle(u,g,v),I=v.toString(),O=St.parseExtensionString(I),F=[new on((g[0]+g[1])/2,a),new on(w,a)],q=new bt(I,null,0,F,Bt.UPC_EAN_EXTENSION,new Date().getTime());return O!=null&&q.putAllMetadata(O),q}decodeMiddle(a,u,g){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],O=0;for(let q=0;q<5&&I<w;q++){let te=Fe.decodeDigit(a,v,I,Fe.L_AND_G_PATTERNS);g+=String.fromCharCode(48+te%10);for(let ue of v)I+=ue;te>=10&&(O|=1<<4-q),q!==4&&(I=a.getNextSet(I),I=a.getNextUnset(I))}if(g.length!==5)throw new ke;let F=this.determineCheckDigit(O);if(St.extensionChecksum(g.toString())!==F)throw new ke;return I}static extensionChecksum(a){let u=a.length,g=0;for(let v=u-2;v>=0;v-=2)g+=a.charAt(v).charCodeAt(0)-48;g*=3;for(let v=u-1;v>=0;v-=2)g+=a.charAt(v).charCodeAt(0)-48;return g*=3,g%10}determineCheckDigit(a){for(let u=0;u<10;u++)if(a===this.CHECK_DIGIT_ENCODINGS[u])return u;throw new ke}static parseExtensionString(a){if(a.length!==5)return null;let u=St.parseExtension5String(a);return u==null?null:new Map([[un.SUGGESTED_PRICE,u]])}static parseExtension5String(a){let u;switch(a.charAt(0)){case"0":u="";break;case"5":u="$";break;case"9":switch(a){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}u="";break;default:u="";break}let g=parseInt(a.substring(1)),v=(g/100).toString(),w=g%100,I=w<10?"0"+w:w.toString();return u+v+"."+I}}class Lt{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(a,u,g){let v=this.decodeRowStringBuffer,w=this.decodeMiddle(u,g,v),I=v.toString(),O=Lt.parseExtensionString(I),F=[new on((g[0]+g[1])/2,a),new on(w,a)],q=new bt(I,null,0,F,Bt.UPC_EAN_EXTENSION,new Date().getTime());return O!=null&&q.putAllMetadata(O),q}decodeMiddle(a,u,g){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],O=0;for(let F=0;F<2&&I<w;F++){let q=Fe.decodeDigit(a,v,I,Fe.L_AND_G_PATTERNS);g+=String.fromCharCode(48+q%10);for(let te of v)I+=te;q>=10&&(O|=1<<1-F),F!==1&&(I=a.getNextSet(I),I=a.getNextUnset(I))}if(g.length!==2)throw new ke;if(parseInt(g.toString())%4!==O)throw new ke;return I}static parseExtensionString(a){return a.length!==2?null:new Map([[un.ISSUE_NUMBER,parseInt(a)]])}}class bn{static decodeRow(a,u,g){let v=Fe.findGuardPattern(u,g,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new St().decodeRow(a,u,v)}catch{return new Lt().decodeRow(a,u,v)}}}bn.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class yn extends Fe{constructor(){super(),this.decodeRowStringBuffer="",yn.L_AND_G_PATTERNS=yn.L_PATTERNS.map(a=>Int32Array.from(a));for(let a=10;a<20;a++){let u=yn.L_PATTERNS[a-10],g=new Int32Array(u.length);for(let v=0;v<u.length;v++)g[v]=u[u.length-v-1];yn.L_AND_G_PATTERNS[a]=g}}decodeRow(a,u,g){let v=yn.findStartGuardPattern(u),w=g==null?null:g.get(Et.NEED_RESULT_POINT_CALLBACK);if(w!=null){const mn=new on((v[0]+v[1])/2,a);w.foundPossibleResultPoint(mn)}let I=this.decodeMiddle(u,v,this.decodeRowStringBuffer),O=I.rowOffset,F=I.resultString;if(w!=null){const mn=new on(O,a);w.foundPossibleResultPoint(mn)}let q=this.decodeEnd(u,O);if(w!=null){const mn=new on((q[0]+q[1])/2,a);w.foundPossibleResultPoint(mn)}let te=q[1],ue=te+(te-q[0]);if(ue>=u.getSize()||!u.isRange(te,ue,!1))throw new ke;let xe=F.toString();if(xe.length<8)throw new rt;if(!yn.checkChecksum(xe))throw new we;let Oe=(v[1]+v[0])/2,ot=(q[1]+q[0])/2,ft=this.getBarcodeFormat(),Rt=[new on(Oe,a),new on(ot,a)],Ht=new bt(xe,null,0,Rt,ft,new Date().getTime()),An=0;try{let mn=bn.decodeRow(a,u,q[1]);Ht.putMetadata(un.UPC_EAN_EXTENSION,mn.getText()),Ht.putAllMetadata(mn.getResultMetadata()),Ht.addResultPoints(mn.getResultPoints()),An=mn.getText().length}catch{}let wn=g==null?null:g.get(Et.ALLOWED_EAN_EXTENSIONS);if(wn!=null){let mn=!1;for(let Ki in wn)if(An.toString()===Ki){mn=!0;break}if(!mn)throw new ke}return Ht}decodeEnd(a,u){return yn.findGuardPattern(a,u,!1,yn.START_END_PATTERN,new Int32Array(yn.START_END_PATTERN.length).fill(0))}static checkChecksum(a){return yn.checkStandardUPCEANChecksum(a)}static checkStandardUPCEANChecksum(a){let u=a.length;if(u===0)return!1;let g=parseInt(a.charAt(u-1),10);return yn.getStandardUPCEANChecksum(a.substring(0,u-1))===g}static getStandardUPCEANChecksum(a){let u=a.length,g=0;for(let v=u-1;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new rt;g+=w}g*=3;for(let v=u-2;v>=0;v-=2){let w=a.charAt(v).charCodeAt(0)-48;if(w<0||w>9)throw new rt;g+=w}return(1e3-g)%10}}class $n extends yn{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(a,u,g){let v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1],O=0;for(let q=0;q<6&&I<w;q++){let te=yn.decodeDigit(a,v,I,yn.L_AND_G_PATTERNS);g+=String.fromCharCode(48+te%10);for(let ue of v)I+=ue;te>=10&&(O|=1<<5-q)}g=$n.determineFirstDigit(g,O),I=yn.findGuardPattern(a,I,!0,yn.MIDDLE_PATTERN,new Int32Array(yn.MIDDLE_PATTERN.length).fill(0))[1];for(let q=0;q<6&&I<w;q++){let te=yn.decodeDigit(a,v,I,yn.L_PATTERNS);g+=String.fromCharCode(48+te);for(let ue of v)I+=ue}return{rowOffset:I,resultString:g}}getBarcodeFormat(){return Bt.EAN_13}static determineFirstDigit(a,u){for(let g=0;g<10;g++)if(u===this.FIRST_DIGIT_ENCODINGS[g])return a=String.fromCharCode(48+g)+a,a;throw new ke}}$n.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class dt extends yn{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(a,u,g){const v=this.decodeMiddleCounters;v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I=u[1];for(let F=0;F<4&&I<w;F++){let q=yn.decodeDigit(a,v,I,yn.L_PATTERNS);g+=String.fromCharCode(48+q);for(let te of v)I+=te}I=yn.findGuardPattern(a,I,!0,yn.MIDDLE_PATTERN,new Int32Array(yn.MIDDLE_PATTERN.length).fill(0))[1];for(let F=0;F<4&&I<w;F++){let q=yn.decodeDigit(a,v,I,yn.L_PATTERNS);g+=String.fromCharCode(48+q);for(let te of v)I+=te}return{rowOffset:I,resultString:g}}getBarcodeFormat(){return Bt.EAN_8}}class ai extends yn{constructor(){super(...arguments),this.ean13Reader=new $n}getBarcodeFormat(){return Bt.UPC_A}decode(a,u){return this.maybeReturnResult(this.ean13Reader.decode(a))}decodeRow(a,u,g){return this.maybeReturnResult(this.ean13Reader.decodeRow(a,u,g))}decodeMiddle(a,u,g){return this.ean13Reader.decodeMiddle(a,u,g)}maybeReturnResult(a){let u=a.getText();if(u.charAt(0)==="0"){let g=new bt(u.substring(1),null,null,a.getResultPoints(),Bt.UPC_A);return a.getResultMetadata()!=null&&g.putAllMetadata(a.getResultMetadata()),g}else throw new ke}reset(){this.ean13Reader.reset()}}class Fn extends yn{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(a,u,g){const v=this.decodeMiddleCounters.map(q=>q);v[0]=0,v[1]=0,v[2]=0,v[3]=0;const w=a.getSize();let I=u[1],O=0;for(let q=0;q<6&&I<w;q++){const te=Fn.decodeDigit(a,v,I,Fn.L_AND_G_PATTERNS);g+=String.fromCharCode(48+te%10);for(let ue of v)I+=ue;te>=10&&(O|=1<<5-q)}let F=Fn.determineNumSysAndCheckDigit(g,O);return{rowOffset:I,resultString:F}}decodeEnd(a,u){return Fn.findGuardPatternWithoutCounters(a,u,!0,Fn.MIDDLE_END_PATTERN)}checkChecksum(a){return yn.checkChecksum(Fn.convertUPCEtoUPCA(a))}static determineNumSysAndCheckDigit(a,u){for(let g=0;g<=1;g++)for(let v=0;v<10;v++)if(u===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[g][v]){let w=String.fromCharCode(48+g),I=String.fromCharCode(48+v);return w+a+I}throw ke.getNotFoundInstance()}getBarcodeFormat(){return Bt.UPC_E}static convertUPCEtoUPCA(a){const u=a.slice(1,7).split("").map(w=>w.charCodeAt(0)),g=new vt;g.append(a.charAt(0));let v=u[5];switch(v){case 0:case 1:case 2:g.appendChars(u,0,2),g.append(v),g.append("0000"),g.appendChars(u,2,3);break;case 3:g.appendChars(u,0,3),g.append("00000"),g.appendChars(u,3,2);break;case 4:g.appendChars(u,0,4),g.append("00000"),g.append(u[4]);break;default:g.appendChars(u,0,5),g.append("0000"),g.append(v);break}return a.length>=8&&g.append(a.charAt(7)),g.toString()}}Fn.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Fn.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Jn extends it{constructor(a){super();let u=a==null?null:a.get(Et.POSSIBLE_FORMATS),g=[];C(u)?(g.push(new $n),g.push(new ai),g.push(new dt),g.push(new Fn)):(u.indexOf(Bt.EAN_13)>-1&&g.push(new $n),u.indexOf(Bt.UPC_A)>-1&&g.push(new ai),u.indexOf(Bt.EAN_8)>-1&&g.push(new dt),u.indexOf(Bt.UPC_E)>-1&&g.push(new Fn)),this.readers=g}decodeRow(a,u,g){for(let v of this.readers)try{const w=v.decodeRow(a,u,g),I=w.getBarcodeFormat()===Bt.EAN_13&&w.getText().charAt(0)==="0",O=g==null?null:g.get(Et.POSSIBLE_FORMATS),F=O==null||O.includes(Bt.UPC_A);if(I&&F){const q=w.getRawBytes(),te=new bt(w.getText().substring(1),q,q?q.length:null,w.getResultPoints(),Bt.UPC_A);return te.putAllMetadata(w.getResultMetadata()),te}return w}catch{}throw new ke}reset(){for(let a of this.readers)a.reset()}}class pi extends it{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(a,u){for(let g=0;g<u.length;g++)if(it.patternMatchVariance(a,u[g],pi.MAX_INDIVIDUAL_VARIANCE)<pi.MAX_AVG_VARIANCE)return g;throw new ke}static count(a){return Rn.sum(new Int32Array(a))}static increment(a,u){let g=0,v=u[0];for(let w=1;w<a.length;w++)u[w]>v&&(v=u[w],g=w);a[g]++}static decrement(a,u){let g=0,v=u[0];for(let w=1;w<a.length;w++)u[w]<v&&(v=u[w],g=w);a[g]--}static isFinderPattern(a){let u=a[0]+a[1],g=u+a[2]+a[3],v=u/g;if(v>=pi.MIN_FINDER_PATTERN_RATIO&&v<=pi.MAX_FINDER_PATTERN_RATIO){let w=Number.MAX_SAFE_INTEGER,I=Number.MIN_SAFE_INTEGER;for(let O of a)O>I&&(I=O),O<w&&(w=O);return I<10*w}return!1}}pi.MAX_AVG_VARIANCE=.2,pi.MAX_INDIVIDUAL_VARIANCE=.45,pi.MIN_FINDER_PATTERN_RATIO=9.5/12,pi.MAX_FINDER_PATTERN_RATIO=12.5/14;class ur{constructor(a,u){this.value=a,this.checksumPortion=u}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(a){if(!(a instanceof ur))return!1;const u=a;return this.value===u.value&&this.checksumPortion===u.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Ti{constructor(a,u,g,v,w){this.value=a,this.startEnd=u,this.value=a,this.startEnd=u,this.resultPoints=new Array,this.resultPoints.push(new on(g,w)),this.resultPoints.push(new on(v,w))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(a){if(!(a instanceof Ti))return!1;const u=a;return this.value===u.value}hashCode(){return this.value}}class jn{constructor(){}static getRSSvalue(a,u,g){let v=0;for(let F of a)v+=F;let w=0,I=0,O=a.length;for(let F=0;F<O-1;F++){let q;for(q=1,I|=1<<F;q<a[F];q++,I&=~(1<<F)){let te=jn.combins(v-q-1,O-F-2);if(g&&I===0&&v-q-(O-F-1)>=O-F-1&&(te-=jn.combins(v-q-(O-F),O-F-2)),O-F-1>1){let ue=0;for(let xe=v-q-(O-F-2);xe>u;xe--)ue+=jn.combins(v-q-xe-1,O-F-3);te-=ue*(O-1-F)}else v-q>u&&te--;w+=te}v-=q}return w}static combins(a,u){let g,v;a-u>u?(v=u,g=a-u):(v=a-u,g=u);let w=1,I=1;for(let O=a;O>g;O--)w*=O,I<=v&&(w/=I,I++);for(;I<=v;)w/=I,I++;return w}}class Ni{static buildBitArray(a){let u=a.length*2-1;a[a.length-1].getRightChar()==null&&(u-=1);let g=12*u,v=new mt(g),w=0,O=a[0].getRightChar().getValue();for(let F=11;F>=0;--F)(O&1<<F)!=0&&v.set(w),w++;for(let F=1;F<a.length;++F){let q=a[F],te=q.getLeftChar().getValue();for(let ue=11;ue>=0;--ue)(te&1<<ue)!=0&&v.set(w),w++;if(q.getRightChar()!=null){let ue=q.getRightChar().getValue();for(let xe=11;xe>=0;--xe)(ue&1<<xe)!=0&&v.set(w),w++}}return v}}class Ri{constructor(a,u){u?this.decodedInformation=null:(this.finished=a,this.decodedInformation=u)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class ji{constructor(a){this.newPosition=a}getNewPosition(){return this.newPosition}}class Nr extends ji{constructor(a,u){super(a),this.value=u}getValue(){return this.value}isFNC1(){return this.value===Nr.FNC1}}Nr.FNC1="$";class Jt extends ji{constructor(a,u,g){super(a),g?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=u}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class gi extends ji{constructor(a,u,g){if(super(a),u<0||u>10||g<0||g>10)throw new rt;this.firstDigit=u,this.secondDigit=g}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===gi.FNC1}isSecondDigitFNC1(){return this.secondDigit===gi.FNC1}isAnyFNC1(){return this.firstDigit===gi.FNC1||this.secondDigit===gi.FNC1}}gi.FNC1=10;class Sn{constructor(){}static parseFieldsInGeneralPurpose(a){if(!a)return null;if(a.length<2)throw new ke;let u=a.substring(0,2);for(let w of Sn.TWO_DIGIT_DATA_LENGTH)if(w[0]===u)return w[1]===Sn.VARIABLE_LENGTH?Sn.processVariableAI(2,w[2],a):Sn.processFixedAI(2,w[1],a);if(a.length<3)throw new ke;let g=a.substring(0,3);for(let w of Sn.THREE_DIGIT_DATA_LENGTH)if(w[0]===g)return w[1]===Sn.VARIABLE_LENGTH?Sn.processVariableAI(3,w[2],a):Sn.processFixedAI(3,w[1],a);for(let w of Sn.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(w[0]===g)return w[1]===Sn.VARIABLE_LENGTH?Sn.processVariableAI(4,w[2],a):Sn.processFixedAI(4,w[1],a);if(a.length<4)throw new ke;let v=a.substring(0,4);for(let w of Sn.FOUR_DIGIT_DATA_LENGTH)if(w[0]===v)return w[1]===Sn.VARIABLE_LENGTH?Sn.processVariableAI(4,w[2],a):Sn.processFixedAI(4,w[1],a);throw new ke}static processFixedAI(a,u,g){if(g.length<a)throw new ke;let v=g.substring(0,a);if(g.length<a+u)throw new ke;let w=g.substring(a,a+u),I=g.substring(a+u),O="("+v+")"+w,F=Sn.parseFieldsInGeneralPurpose(I);return F==null?O:O+F}static processVariableAI(a,u,g){let v=g.substring(0,a),w;g.length<a+u?w=g.length:w=a+u;let I=g.substring(a,w),O=g.substring(w),F="("+v+")"+I,q=Sn.parseFieldsInGeneralPurpose(O);return q==null?F:F+q}}Sn.VARIABLE_LENGTH=[],Sn.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Sn.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Sn.VARIABLE_LENGTH,20],["22",Sn.VARIABLE_LENGTH,29],["30",Sn.VARIABLE_LENGTH,8],["37",Sn.VARIABLE_LENGTH,8],["90",Sn.VARIABLE_LENGTH,30],["91",Sn.VARIABLE_LENGTH,30],["92",Sn.VARIABLE_LENGTH,30],["93",Sn.VARIABLE_LENGTH,30],["94",Sn.VARIABLE_LENGTH,30],["95",Sn.VARIABLE_LENGTH,30],["96",Sn.VARIABLE_LENGTH,30],["97",Sn.VARIABLE_LENGTH,3],["98",Sn.VARIABLE_LENGTH,30],["99",Sn.VARIABLE_LENGTH,30]],Sn.THREE_DIGIT_DATA_LENGTH=[["240",Sn.VARIABLE_LENGTH,30],["241",Sn.VARIABLE_LENGTH,30],["242",Sn.VARIABLE_LENGTH,6],["250",Sn.VARIABLE_LENGTH,30],["251",Sn.VARIABLE_LENGTH,30],["253",Sn.VARIABLE_LENGTH,17],["254",Sn.VARIABLE_LENGTH,20],["400",Sn.VARIABLE_LENGTH,30],["401",Sn.VARIABLE_LENGTH,30],["402",17],["403",Sn.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Sn.VARIABLE_LENGTH,20],["421",Sn.VARIABLE_LENGTH,15],["422",3],["423",Sn.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Sn.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Sn.VARIABLE_LENGTH,15],["391",Sn.VARIABLE_LENGTH,18],["392",Sn.VARIABLE_LENGTH,15],["393",Sn.VARIABLE_LENGTH,18],["703",Sn.VARIABLE_LENGTH,30]],Sn.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Sn.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Sn.VARIABLE_LENGTH,20],["8003",Sn.VARIABLE_LENGTH,30],["8004",Sn.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Sn.VARIABLE_LENGTH,30],["8008",Sn.VARIABLE_LENGTH,12],["8018",18],["8020",Sn.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Sn.VARIABLE_LENGTH,70],["8200",Sn.VARIABLE_LENGTH,70]];class lr{constructor(a){this.buffer=new vt,this.information=a}decodeAllCodes(a,u){let g=u,v=null;do{let w=this.decodeGeneralPurposeField(g,v),I=Sn.parseFieldsInGeneralPurpose(w.getNewString());if(I!=null&&a.append(I),w.isRemaining()?v=""+w.getRemainingValue():v=null,g===w.getNewPosition())break;g=w.getNewPosition()}while(!0);return a.toString()}isStillNumeric(a){if(a+7>this.information.getSize())return a+4<=this.information.getSize();for(let u=a;u<a+3;++u)if(this.information.get(u))return!0;return this.information.get(a+3)}decodeNumeric(a){if(a+7>this.information.getSize()){let w=this.extractNumericValueFromBitArray(a,4);return w===0?new gi(this.information.getSize(),gi.FNC1,gi.FNC1):new gi(this.information.getSize(),w-1,gi.FNC1)}let u=this.extractNumericValueFromBitArray(a,7),g=(u-8)/11,v=(u-8)%11;return new gi(a+7,g,v)}extractNumericValueFromBitArray(a,u){return lr.extractNumericValueFromBitArray(this.information,a,u)}static extractNumericValueFromBitArray(a,u,g){let v=0;for(let w=0;w<g;++w)a.get(u+w)&&(v|=1<<g-w-1);return v}decodeGeneralPurposeField(a,u){this.buffer.setLengthToZero(),u!=null&&this.buffer.append(u),this.current.setPosition(a);let g=this.parseBlocks();return g!=null&&g.isRemaining()?new Jt(this.current.getPosition(),this.buffer.toString(),g.getRemainingValue()):new Jt(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let a,u;do{let g=this.current.getPosition();if(this.current.isAlpha()?(u=this.parseAlphaBlock(),a=u.isFinished()):this.current.isIsoIec646()?(u=this.parseIsoIec646Block(),a=u.isFinished()):(u=this.parseNumericBlock(),a=u.isFinished()),!(g!==this.current.getPosition())&&!a)break}while(!a);return u.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let a=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFirstDigitFNC1()){let u;return a.isSecondDigitFNC1()?u=new Jt(this.current.getPosition(),this.buffer.toString()):u=new Jt(this.current.getPosition(),this.buffer.toString(),a.getSecondDigit()),new Ri(!0,u)}if(this.buffer.append(a.getFirstDigit()),a.isSecondDigitFNC1()){let u=new Jt(this.current.getPosition(),this.buffer.toString());return new Ri(!0,u)}this.buffer.append(a.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Ri(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let a=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFNC1()){let u=new Jt(this.current.getPosition(),this.buffer.toString());return new Ri(!0,u)}this.buffer.append(a.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Ri(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let a=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(a.getNewPosition()),a.isFNC1()){let u=new Jt(this.current.getPosition(),this.buffer.toString());return new Ri(!0,u)}this.buffer.append(a.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Ri(!1)}isStillIsoIec646(a){if(a+5>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(a,5);if(u>=5&&u<16)return!0;if(a+7>this.information.getSize())return!1;let g=this.extractNumericValueFromBitArray(a,7);if(g>=64&&g<116)return!0;if(a+8>this.information.getSize())return!1;let v=this.extractNumericValueFromBitArray(a,8);return v>=232&&v<253}decodeIsoIec646(a){let u=this.extractNumericValueFromBitArray(a,5);if(u===15)return new Nr(a+5,Nr.FNC1);if(u>=5&&u<15)return new Nr(a+5,"0"+(u-5));let g=this.extractNumericValueFromBitArray(a,7);if(g>=64&&g<90)return new Nr(a+7,""+(g+1));if(g>=90&&g<116)return new Nr(a+7,""+(g+7));let v=this.extractNumericValueFromBitArray(a,8),w;switch(v){case 232:w="!";break;case 233:w='"';break;case 234:w="%";break;case 235:w="&";break;case 236:w="'";break;case 237:w="(";break;case 238:w=")";break;case 239:w="*";break;case 240:w="+";break;case 241:w=",";break;case 242:w="-";break;case 243:w=".";break;case 244:w="/";break;case 245:w=":";break;case 246:w=";";break;case 247:w="<";break;case 248:w="=";break;case 249:w=">";break;case 250:w="?";break;case 251:w="_";break;case 252:w=" ";break;default:throw new rt}return new Nr(a+8,w)}isStillAlpha(a){if(a+5>this.information.getSize())return!1;let u=this.extractNumericValueFromBitArray(a,5);if(u>=5&&u<16)return!0;if(a+6>this.information.getSize())return!1;let g=this.extractNumericValueFromBitArray(a,6);return g>=16&&g<63}decodeAlphanumeric(a){let u=this.extractNumericValueFromBitArray(a,5);if(u===15)return new Nr(a+5,Nr.FNC1);if(u>=5&&u<15)return new Nr(a+5,"0"+(u-5));let g=this.extractNumericValueFromBitArray(a,6);if(g>=32&&g<58)return new Nr(a+6,""+(g+33));let v;switch(g){case 58:v="*";break;case 59:v=",";break;case 60:v="-";break;case 61:v=".";break;case 62:v="/";break;default:throw new wi("Decoding invalid alphanumeric value: "+g)}return new Nr(a+6,v)}isAlphaTo646ToAlphaLatch(a){if(a+1>this.information.getSize())return!1;for(let u=0;u<5&&u+a<this.information.getSize();++u)if(u===2){if(!this.information.get(a+2))return!1}else if(this.information.get(a+u))return!1;return!0}isAlphaOr646ToNumericLatch(a){if(a+3>this.information.getSize())return!1;for(let u=a;u<a+3;++u)if(this.information.get(u))return!1;return!0}isNumericToAlphaNumericLatch(a){if(a+1>this.information.getSize())return!1;for(let u=0;u<4&&u+a<this.information.getSize();++u)if(this.information.get(a+u))return!1;return!0}}class Ke{constructor(a){this.information=a,this.generalDecoder=new lr(a)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class je extends Ke{constructor(a){super(a)}encodeCompressedGtin(a,u){a.append("(01)");let g=a.length();a.append("9"),this.encodeCompressedGtinWithoutAI(a,u,g)}encodeCompressedGtinWithoutAI(a,u,g){for(let v=0;v<4;++v){let w=this.getGeneralDecoder().extractNumericValueFromBitArray(u+10*v,10);w/100===0&&a.append("0"),w/10===0&&a.append("0"),a.append(w)}je.appendCheckDigit(a,g)}static appendCheckDigit(a,u){let g=0;for(let v=0;v<13;v++){let w=a.charAt(v+u).charCodeAt(0)-48;g+=(v&1)===0?3*w:w}g=10-g%10,g===10&&(g=0),a.append(g)}}je.GTIN_SIZE=40;class Mt extends je{constructor(a){super(a)}parseInformation(){let a=new vt;a.append("(01)");let u=a.length(),g=this.getGeneralDecoder().extractNumericValueFromBitArray(Mt.HEADER_SIZE,4);return a.append(g),this.encodeCompressedGtinWithoutAI(a,Mt.HEADER_SIZE+4,u),this.getGeneralDecoder().decodeAllCodes(a,Mt.HEADER_SIZE+44)}}Mt.HEADER_SIZE=4;class Yt extends Ke{constructor(a){super(a)}parseInformation(){let a=new vt;return this.getGeneralDecoder().decodeAllCodes(a,Yt.HEADER_SIZE)}}Yt.HEADER_SIZE=5;class tn extends je{constructor(a){super(a)}encodeCompressedWeight(a,u,g){let v=this.getGeneralDecoder().extractNumericValueFromBitArray(u,g);this.addWeightCode(a,v);let w=this.checkWeight(v),I=1e5;for(let O=0;O<5;++O)w/I===0&&a.append("0"),I/=10;a.append(w)}}class Un extends tn{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()!=Un.HEADER_SIZE+tn.GTIN_SIZE+Un.WEIGHT_SIZE)throw new ke;let a=new vt;return this.encodeCompressedGtin(a,Un.HEADER_SIZE),this.encodeCompressedWeight(a,Un.HEADER_SIZE+tn.GTIN_SIZE,Un.WEIGHT_SIZE),a.toString()}}Un.HEADER_SIZE=5,Un.WEIGHT_SIZE=15;class Hn extends Un{constructor(a){super(a)}addWeightCode(a,u){a.append("(3103)")}checkWeight(a){return a}}class vn extends Un{constructor(a){super(a)}addWeightCode(a,u){u<1e4?a.append("(3202)"):a.append("(3203)")}checkWeight(a){return a<1e4?a:a-1e4}}class ri extends je{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()<ri.HEADER_SIZE+je.GTIN_SIZE)throw new ke;let a=new vt;this.encodeCompressedGtin(a,ri.HEADER_SIZE);let u=this.getGeneralDecoder().extractNumericValueFromBitArray(ri.HEADER_SIZE+je.GTIN_SIZE,ri.LAST_DIGIT_SIZE);a.append("(392"),a.append(u),a.append(")");let g=this.getGeneralDecoder().decodeGeneralPurposeField(ri.HEADER_SIZE+je.GTIN_SIZE+ri.LAST_DIGIT_SIZE,null);return a.append(g.getNewString()),a.toString()}}ri.HEADER_SIZE=8,ri.LAST_DIGIT_SIZE=2;class ni extends je{constructor(a){super(a)}parseInformation(){if(this.getInformation().getSize()<ni.HEADER_SIZE+je.GTIN_SIZE)throw new ke;let a=new vt;this.encodeCompressedGtin(a,ni.HEADER_SIZE);let u=this.getGeneralDecoder().extractNumericValueFromBitArray(ni.HEADER_SIZE+je.GTIN_SIZE,ni.LAST_DIGIT_SIZE);a.append("(393"),a.append(u),a.append(")");let g=this.getGeneralDecoder().extractNumericValueFromBitArray(ni.HEADER_SIZE+je.GTIN_SIZE+ni.LAST_DIGIT_SIZE,ni.FIRST_THREE_DIGITS_SIZE);g/100==0&&a.append("0"),g/10==0&&a.append("0"),a.append(g);let v=this.getGeneralDecoder().decodeGeneralPurposeField(ni.HEADER_SIZE+je.GTIN_SIZE+ni.LAST_DIGIT_SIZE+ni.FIRST_THREE_DIGITS_SIZE,null);return a.append(v.getNewString()),a.toString()}}ni.HEADER_SIZE=8,ni.LAST_DIGIT_SIZE=2,ni.FIRST_THREE_DIGITS_SIZE=10;class Xn extends tn{constructor(a,u,g){super(a),this.dateCode=g,this.firstAIdigits=u}parseInformation(){if(this.getInformation().getSize()!=Xn.HEADER_SIZE+Xn.GTIN_SIZE+Xn.WEIGHT_SIZE+Xn.DATE_SIZE)throw new ke;let a=new vt;return this.encodeCompressedGtin(a,Xn.HEADER_SIZE),this.encodeCompressedWeight(a,Xn.HEADER_SIZE+Xn.GTIN_SIZE,Xn.WEIGHT_SIZE),this.encodeCompressedDate(a,Xn.HEADER_SIZE+Xn.GTIN_SIZE+Xn.WEIGHT_SIZE),a.toString()}encodeCompressedDate(a,u){let g=this.getGeneralDecoder().extractNumericValueFromBitArray(u,Xn.DATE_SIZE);if(g==38400)return;a.append("("),a.append(this.dateCode),a.append(")");let v=g%32;g/=32;let w=g%12+1;g/=12;let I=g;I/10==0&&a.append("0"),a.append(I),w/10==0&&a.append("0"),a.append(w),v/10==0&&a.append("0"),a.append(v)}addWeightCode(a,u){a.append("("),a.append(this.firstAIdigits),a.append(u/1e5),a.append(")")}checkWeight(a){return a%1e5}}Xn.HEADER_SIZE=8,Xn.WEIGHT_SIZE=20,Xn.DATE_SIZE=16;function Zi(ce){try{if(ce.get(1))return new Mt(ce);if(!ce.get(2))return new Yt(ce);switch(lr.extractNumericValueFromBitArray(ce,1,4)){case 4:return new Hn(ce);case 5:return new vn(ce)}switch(lr.extractNumericValueFromBitArray(ce,1,5)){case 12:return new ri(ce);case 13:return new ni(ce)}switch(lr.extractNumericValueFromBitArray(ce,1,7)){case 56:return new Xn(ce,"310","11");case 57:return new Xn(ce,"320","11");case 58:return new Xn(ce,"310","13");case 59:return new Xn(ce,"320","13");case 60:return new Xn(ce,"310","15");case 61:return new Xn(ce,"320","15");case 62:return new Xn(ce,"310","17");case 63:return new Xn(ce,"320","17")}}catch(a){throw console.log(a),new wi("unknown decoder: "+ce)}}class Cn{constructor(a,u,g,v){this.leftchar=a,this.rightchar=u,this.finderpattern=g,this.maybeLast=v}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(a,u){return a instanceof Cn?Cn.equalsOrNull(a.leftchar,u.leftchar)&&Cn.equalsOrNull(a.rightchar,u.rightchar)&&Cn.equalsOrNull(a.finderpattern,u.finderpattern):!1}static equalsOrNull(a,u){return a===null?u===null:Cn.equals(a,u)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class Dn{constructor(a,u,g){this.pairs=a,this.rowNumber=u,this.wasReversed=g}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(a){return this.checkEqualitity(this,a)}toString(){return"{ "+this.pairs+" }"}equals(a,u){return a instanceof Dn?this.checkEqualitity(a,u)&&a.wasReversed===u.wasReversed:!1}checkEqualitity(a,u){if(!a||!u)return;let g;return a.forEach((v,w)=>{u.forEach(I=>{v.getLeftChar().getValue()===I.getLeftChar().getValue()&&v.getRightChar().getValue()===I.getRightChar().getValue()&&v.getFinderPatter().getValue()===I.getFinderPatter().getValue()&&(g=!0)})}),g}}class Zt extends pi{constructor(a){super(...arguments),this.pairs=new Array(Zt.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=a===!0}decodeRow(a,u,g){this.pairs.length=0,this.startFromEven=!1;try{return Zt.constructResult(this.decodeRow2pairs(a,u))}catch(v){this.verbose&&console.log(v)}return this.pairs.length=0,this.startFromEven=!0,Zt.constructResult(this.decodeRow2pairs(a,u))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(a,u){let g=!1;for(;!g;)try{this.pairs.push(this.retrieveNextPair(u,this.pairs,a))}catch(w){if(w instanceof ke){if(!this.pairs.length)throw new ke;g=!0}}if(this.checkChecksum())return this.pairs;let v;if(this.rows.length?v=!0:v=!1,this.storeRow(a,!1),v){let w=this.checkRowsBoolean(!1);if(w!=null||(w=this.checkRowsBoolean(!0),w!=null))return w}throw new ke}checkRowsBoolean(a){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,a&&(this.rows=this.rows.reverse());let u=null;try{u=this.checkRows(new Array,0)}catch(g){this.verbose&&console.log(g)}return a&&(this.rows=this.rows.reverse()),u}checkRows(a,u){for(let g=u;g<this.rows.length;g++){let v=this.rows[g];this.pairs.length=0;for(let I of a)this.pairs.push(I.getPairs());if(this.pairs.push(v.getPairs()),!Zt.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let w=new Array(a);w.push(v);try{return this.checkRows(w,g+1)}catch(I){this.verbose&&console.log(I)}}throw new ke}static isValidSequence(a){for(let u of Zt.FINDER_PATTERN_SEQUENCES){if(a.length>u.length)continue;let g=!0;for(let v=0;v<a.length;v++)if(a[v].getFinderPattern().getValue()!=u[v]){g=!1;break}if(g)return!0}return!1}storeRow(a,u){let g=0,v=!1,w=!1;for(;g<this.rows.length;){let I=this.rows[g];if(I.getRowNumber()>a){w=I.isEquivalent(this.pairs);break}v=I.isEquivalent(this.pairs),g++}w||v||Zt.isPartialRow(this.pairs,this.rows)||(this.rows.push(g,new Dn(this.pairs,a,u)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(a,u){for(let g of u)if(g.getPairs().length!==a.length){for(let v of g.getPairs())for(let w of a)if(Cn.equals(v,w))break}}static isPartialRow(a,u){for(let g of u){let v=!0;for(let w of a){let I=!1;for(let O of g.getPairs())if(w.equals(O)){I=!0;break}if(!I){v=!1;break}}if(v)return!0}return!1}getRows(){return this.rows}static constructResult(a){let u=Ni.buildBitArray(a),v=Zi(u).parseInformation(),w=a[0].getFinderPattern().getResultPoints(),I=a[a.length-1].getFinderPattern().getResultPoints(),O=[w[0],w[1],I[0],I[1]];return new bt(v,null,null,O,Bt.RSS_EXPANDED,null)}checkChecksum(){let a=this.pairs.get(0),u=a.getLeftChar(),g=a.getRightChar();if(g==null)return!1;let v=g.getChecksumPortion(),w=2;for(let O=1;O<this.pairs.size();++O){let F=this.pairs.get(O);v+=F.getLeftChar().getChecksumPortion(),w++;let q=F.getRightChar();q!=null&&(v+=q.getChecksumPortion(),w++)}return v%=211,211*(w-4)+v==u.getValue()}static getNextSecondBar(a,u){let g;return a.get(u)?(g=a.getNextUnset(u),g=a.getNextSet(g)):(g=a.getNextSet(u),g=a.getNextUnset(g)),g}retrieveNextPair(a,u,g){let v=u.length%2==0;this.startFromEven&&(v=!v);let w,I=!0,O=-1;do this.findNextPair(a,u,O),w=this.parseFoundFinderPattern(a,g,v),w==null?O=Zt.getNextSecondBar(a,this.startEnd[0]):I=!1;while(I);let F=this.decodeDataCharacter(a,w,v,!0);if(!this.isEmptyPair(u)&&u[u.length-1].mustBeLast())throw new ke;let q;try{q=this.decodeDataCharacter(a,w,v,!1)}catch(te){q=null,this.verbose&&console.log(te)}return new Cn(F,q,w,!0)}isEmptyPair(a){return a.length===0}findNextPair(a,u,g){let v=this.getDecodeFinderCounters();v[0]=0,v[1]=0,v[2]=0,v[3]=0;let w=a.getSize(),I;g>=0?I=g:this.isEmptyPair(u)?I=0:I=u[u.length-1].getFinderPattern().getStartEnd()[1];let O=u.length%2!=0;this.startFromEven&&(O=!O);let F=!1;for(;I<w&&(F=!a.get(I),!!F);)I++;let q=0,te=I;for(let ue=I;ue<w;ue++)if(a.get(ue)!=F)v[q]++;else{if(q==3){if(O&&Zt.reverseCounters(v),Zt.isFinderPattern(v)){this.startEnd[0]=te,this.startEnd[1]=ue;return}O&&Zt.reverseCounters(v),te+=v[0]+v[1],v[0]=v[2],v[1]=v[3],v[2]=0,v[3]=0,q--}else q++;v[q]=1,F=!F}throw new ke}static reverseCounters(a){let u=a.length;for(let g=0;g<u/2;++g){let v=a[g];a[g]=a[u-g-1],a[u-g-1]=v}}parseFoundFinderPattern(a,u,g){let v,w,I;if(g){let q=this.startEnd[0]-1;for(;q>=0&&!a.get(q);)q--;q++,v=this.startEnd[0]-q,w=q,I=this.startEnd[1]}else w=this.startEnd[0],I=a.getNextUnset(this.startEnd[1]+1),v=I-this.startEnd[1];let O=this.getDecodeFinderCounters();pe.arraycopy(O,0,O,1,O.length-1),O[0]=v;let F;try{F=this.parseFinderValue(O,Zt.FINDER_PATTERNS)}catch{return null}return new Ti(F,[w,I],w,I,u)}decodeDataCharacter(a,u,g,v){let w=this.getDataCharacterCounters();for(let Er=0;Er<w.length;Er++)w[Er]=0;if(v)Zt.recordPatternInReverse(a,u.getStartEnd()[0],w);else{Zt.recordPattern(a,u.getStartEnd()[1],w);for(let Er=0,rs=w.length-1;Er<rs;Er++,rs--){let Ws=w[Er];w[Er]=w[rs],w[rs]=Ws}}let I=17,O=Rn.sum(new Int32Array(w))/I,F=(u.getStartEnd()[1]-u.getStartEnd()[0])/15;if(Math.abs(O-F)/F>.3)throw new ke;let q=this.getOddCounts(),te=this.getEvenCounts(),ue=this.getOddRoundingErrors(),xe=this.getEvenRoundingErrors();for(let Er=0;Er<w.length;Er++){let rs=1*w[Er]/O,Ws=rs+.5;if(Ws<1){if(rs<.3)throw new ke;Ws=1}else if(Ws>8){if(rs>8.7)throw new ke;Ws=8}let ro=Er/2;(Er&1)==0?(q[ro]=Ws,ue[ro]=rs-Ws):(te[ro]=Ws,xe[ro]=rs-Ws)}this.adjustOddEvenCounts(I);let Oe=4*u.getValue()+(g?0:2)+(v?0:1)-1,ot=0,ft=0;for(let Er=q.length-1;Er>=0;Er--){if(Zt.isNotA1left(u,g,v)){let rs=Zt.WEIGHTS[Oe][2*Er];ft+=q[Er]*rs}ot+=q[Er]}let Rt=0;for(let Er=te.length-1;Er>=0;Er--)if(Zt.isNotA1left(u,g,v)){let rs=Zt.WEIGHTS[Oe][2*Er+1];Rt+=te[Er]*rs}let Ht=ft+Rt;if((ot&1)!=0||ot>13||ot<4)throw new ke;let An=(13-ot)/2,wn=Zt.SYMBOL_WIDEST[An],mn=9-wn,Ki=jn.getRSSvalue(q,wn,!0),Zn=jn.getRSSvalue(te,mn,!1),is=Zt.EVEN_TOTAL_SUBSET[An],ga=Zt.GSUM[An],Fs=Ki*is+Zn+ga;return new ur(Fs,Ht)}static isNotA1left(a,u,g){return!(a.getValue()==0&&u&&g)}adjustOddEvenCounts(a){let u=Rn.sum(new Int32Array(this.getOddCounts())),g=Rn.sum(new Int32Array(this.getEvenCounts())),v=!1,w=!1;u>13?w=!0:u<4&&(v=!0);let I=!1,O=!1;g>13?O=!0:g<4&&(I=!0);let F=u+g-a,q=(u&1)==1,te=(g&1)==0;if(F==1)if(q){if(te)throw new ke;w=!0}else{if(!te)throw new ke;O=!0}else if(F==-1)if(q){if(te)throw new ke;v=!0}else{if(!te)throw new ke;I=!0}else if(F==0){if(q){if(!te)throw new ke;u<g?(v=!0,O=!0):(w=!0,I=!0)}else if(te)throw new ke}else throw new ke;if(v){if(w)throw new ke;Zt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(w&&Zt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),I){if(O)throw new ke;Zt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}O&&Zt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Zt.SYMBOL_WIDEST=[7,5,4,3,1],Zt.EVEN_TOTAL_SUBSET=[4,20,52,104,204],Zt.GSUM=[0,348,1388,2948,3988],Zt.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],Zt.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],Zt.FINDER_PAT_A=0,Zt.FINDER_PAT_B=1,Zt.FINDER_PAT_C=2,Zt.FINDER_PAT_D=3,Zt.FINDER_PAT_E=4,Zt.FINDER_PAT_F=5,Zt.FINDER_PATTERN_SEQUENCES=[[Zt.FINDER_PAT_A,Zt.FINDER_PAT_A],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_B,Zt.FINDER_PAT_B],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_C,Zt.FINDER_PAT_B,Zt.FINDER_PAT_D],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_E,Zt.FINDER_PAT_B,Zt.FINDER_PAT_D,Zt.FINDER_PAT_C],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_E,Zt.FINDER_PAT_B,Zt.FINDER_PAT_D,Zt.FINDER_PAT_D,Zt.FINDER_PAT_F],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_E,Zt.FINDER_PAT_B,Zt.FINDER_PAT_D,Zt.FINDER_PAT_E,Zt.FINDER_PAT_F,Zt.FINDER_PAT_F],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_A,Zt.FINDER_PAT_B,Zt.FINDER_PAT_B,Zt.FINDER_PAT_C,Zt.FINDER_PAT_C,Zt.FINDER_PAT_D,Zt.FINDER_PAT_D],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_A,Zt.FINDER_PAT_B,Zt.FINDER_PAT_B,Zt.FINDER_PAT_C,Zt.FINDER_PAT_C,Zt.FINDER_PAT_D,Zt.FINDER_PAT_E,Zt.FINDER_PAT_E],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_A,Zt.FINDER_PAT_B,Zt.FINDER_PAT_B,Zt.FINDER_PAT_C,Zt.FINDER_PAT_C,Zt.FINDER_PAT_D,Zt.FINDER_PAT_E,Zt.FINDER_PAT_F,Zt.FINDER_PAT_F],[Zt.FINDER_PAT_A,Zt.FINDER_PAT_A,Zt.FINDER_PAT_B,Zt.FINDER_PAT_B,Zt.FINDER_PAT_C,Zt.FINDER_PAT_D,Zt.FINDER_PAT_D,Zt.FINDER_PAT_E,Zt.FINDER_PAT_E,Zt.FINDER_PAT_F,Zt.FINDER_PAT_F]],Zt.MAX_PAIRS=11;class ki extends ur{constructor(a,u,g){super(a,u),this.count=0,this.finderPattern=g}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ln extends pi{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(a,u,g){const v=this.decodePair(u,!1,a,g);ln.addOrTally(this.possibleLeftPairs,v),u.reverse();let w=this.decodePair(u,!0,a,g);ln.addOrTally(this.possibleRightPairs,w),u.reverse();for(let I of this.possibleLeftPairs)if(I.getCount()>1){for(let O of this.possibleRightPairs)if(O.getCount()>1&&ln.checkChecksum(I,O))return ln.constructResult(I,O)}throw new ke}static addOrTally(a,u){if(u==null)return;let g=!1;for(let v of a)if(v.getValue()===u.getValue()){v.incrementCount(),g=!0;break}g||a.push(u)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(a,u){let g=4537077*a.getValue()+u.getValue(),v=new String(g).toString(),w=new vt;for(let q=13-v.length;q>0;q--)w.append("0");w.append(v);let I=0;for(let q=0;q<13;q++){let te=w.charAt(q).charCodeAt(0)-48;I+=(q&1)===0?3*te:te}I=10-I%10,I===10&&(I=0),w.append(I.toString());let O=a.getFinderPattern().getResultPoints(),F=u.getFinderPattern().getResultPoints();return new bt(w.toString(),null,0,[O[0],O[1],F[0],F[1]],Bt.RSS_14,new Date().getTime())}static checkChecksum(a,u){let g=(a.getChecksumPortion()+16*u.getChecksumPortion())%79,v=9*a.getFinderPattern().getValue()+u.getFinderPattern().getValue();return v>72&&v--,v>8&&v--,g===v}decodePair(a,u,g,v){try{let w=this.findFinderPattern(a,u),I=this.parseFoundFinderPattern(a,g,u,w),O=v==null?null:v.get(Et.NEED_RESULT_POINT_CALLBACK);if(O!=null){let te=(w[0]+w[1])/2;u&&(te=a.getSize()-1-te),O.foundPossibleResultPoint(new on(te,g))}let F=this.decodeDataCharacter(a,I,!0),q=this.decodeDataCharacter(a,I,!1);return new ki(1597*F.getValue()+q.getValue(),F.getChecksumPortion()+4*q.getChecksumPortion(),I)}catch{return null}}decodeDataCharacter(a,u,g){let v=this.getDataCharacterCounters();for(let Rt=0;Rt<v.length;Rt++)v[Rt]=0;if(g)it.recordPatternInReverse(a,u.getStartEnd()[0],v);else{it.recordPattern(a,u.getStartEnd()[1]+1,v);for(let Rt=0,Ht=v.length-1;Rt<Ht;Rt++,Ht--){let An=v[Rt];v[Rt]=v[Ht],v[Ht]=An}}let w=g?16:15,I=Rn.sum(new Int32Array(v))/w,O=this.getOddCounts(),F=this.getEvenCounts(),q=this.getOddRoundingErrors(),te=this.getEvenRoundingErrors();for(let Rt=0;Rt<v.length;Rt++){let Ht=v[Rt]/I,An=Math.floor(Ht+.5);An<1?An=1:An>8&&(An=8);let wn=Math.floor(Rt/2);(Rt&1)===0?(O[wn]=An,q[wn]=Ht-An):(F[wn]=An,te[wn]=Ht-An)}this.adjustOddEvenCounts(g,w);let ue=0,xe=0;for(let Rt=O.length-1;Rt>=0;Rt--)xe*=9,xe+=O[Rt],ue+=O[Rt];let Oe=0,ot=0;for(let Rt=F.length-1;Rt>=0;Rt--)Oe*=9,Oe+=F[Rt],ot+=F[Rt];let ft=xe+3*Oe;if(g){if((ue&1)!==0||ue>12||ue<4)throw new ke;let Rt=(12-ue)/2,Ht=ln.OUTSIDE_ODD_WIDEST[Rt],An=9-Ht,wn=jn.getRSSvalue(O,Ht,!1),mn=jn.getRSSvalue(F,An,!0),Ki=ln.OUTSIDE_EVEN_TOTAL_SUBSET[Rt],Zn=ln.OUTSIDE_GSUM[Rt];return new ur(wn*Ki+mn+Zn,ft)}else{if((ot&1)!==0||ot>10||ot<4)throw new ke;let Rt=(10-ot)/2,Ht=ln.INSIDE_ODD_WIDEST[Rt],An=9-Ht,wn=jn.getRSSvalue(O,Ht,!0),mn=jn.getRSSvalue(F,An,!1),Ki=ln.INSIDE_ODD_TOTAL_SUBSET[Rt],Zn=ln.INSIDE_GSUM[Rt];return new ur(mn*Ki+wn+Zn,ft)}}findFinderPattern(a,u){let g=this.getDecodeFinderCounters();g[0]=0,g[1]=0,g[2]=0,g[3]=0;let v=a.getSize(),w=!1,I=0;for(;I<v&&(w=!a.get(I),u!==w);)I++;let O=0,F=I;for(let q=I;q<v;q++)if(a.get(q)!==w)g[O]++;else{if(O===3){if(pi.isFinderPattern(g))return[F,q];F+=g[0]+g[1],g[0]=g[2],g[1]=g[3],g[2]=0,g[3]=0,O--}else O++;g[O]=1,w=!w}throw new ke}parseFoundFinderPattern(a,u,g,v){let w=a.get(v[0]),I=v[0]-1;for(;I>=0&&w!==a.get(I);)I--;I++;const O=v[0]-I,F=this.getDecodeFinderCounters(),q=new Int32Array(F.length);pe.arraycopy(F,0,q,1,F.length-1),q[0]=O;const te=this.parseFinderValue(q,ln.FINDER_PATTERNS);let ue=I,xe=v[1];return g&&(ue=a.getSize()-1-ue,xe=a.getSize()-1-xe),new Ti(te,[I,v[1]],ue,xe,u)}adjustOddEvenCounts(a,u){let g=Rn.sum(new Int32Array(this.getOddCounts())),v=Rn.sum(new Int32Array(this.getEvenCounts())),w=!1,I=!1,O=!1,F=!1;a?(g>12?I=!0:g<4&&(w=!0),v>12?F=!0:v<4&&(O=!0)):(g>11?I=!0:g<5&&(w=!0),v>10?F=!0:v<4&&(O=!0));let q=g+v-u,te=(g&1)===(a?1:0),ue=(v&1)===1;if(q===1)if(te){if(ue)throw new ke;I=!0}else{if(!ue)throw new ke;F=!0}else if(q===-1)if(te){if(ue)throw new ke;w=!0}else{if(!ue)throw new ke;O=!0}else if(q===0){if(te){if(!ue)throw new ke;g<v?(w=!0,F=!0):(I=!0,O=!0)}else if(ue)throw new ke}else throw new ke;if(w){if(I)throw new ke;pi.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(I&&pi.decrement(this.getOddCounts(),this.getOddRoundingErrors()),O){if(F)throw new ke;pi.increment(this.getEvenCounts(),this.getOddRoundingErrors())}F&&pi.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ln.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ln.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ln.OUTSIDE_GSUM=[0,161,961,2015,2715],ln.INSIDE_GSUM=[0,336,1036,1516],ln.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ln.INSIDE_ODD_WIDEST=[2,4,6,8],ln.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class yi extends it{constructor(a,u){super(),this.readers=[],this.verbose=u===!0;const g=a?a.get(Et.POSSIBLE_FORMATS):null,v=a&&a.get(Et.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;g?((g.includes(Bt.EAN_13)||g.includes(Bt.UPC_A)||g.includes(Bt.EAN_8)||g.includes(Bt.UPC_E))&&this.readers.push(new Jn(a)),g.includes(Bt.CODE_39)&&this.readers.push(new qe(v)),g.includes(Bt.CODE_128)&&this.readers.push(new de),g.includes(Bt.ITF)&&this.readers.push(new xt),g.includes(Bt.RSS_14)&&this.readers.push(new ln),g.includes(Bt.RSS_EXPANDED)&&this.readers.push(new Zt(this.verbose))):(this.readers.push(new Jn(a)),this.readers.push(new qe),this.readers.push(new Jn(a)),this.readers.push(new de),this.readers.push(new xt),this.readers.push(new ln),this.readers.push(new Zt(this.verbose)))}decodeRow(a,u,g){for(let v=0;v<this.readers.length;v++)try{return this.readers[v].decodeRow(a,u,g)}catch{}throw new ke}reset(){this.readers.forEach(a=>a.reset())}}class Bi extends kt{constructor(a=500,u){super(new yi(u),a,u)}}class _i{constructor(a,u,g){this.ecCodewords=a,this.ecBlocks=[u],g&&this.ecBlocks.push(g)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class bi{constructor(a,u){this.count=a,this.dataCodewords=u}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class mi{constructor(a,u,g,v,w,I){this.versionNumber=a,this.symbolSizeRows=u,this.symbolSizeColumns=g,this.dataRegionSizeRows=v,this.dataRegionSizeColumns=w,this.ecBlocks=I;let O=0;const F=I.getECCodewords(),q=I.getECBlocks();for(let te of q)O+=te.getCount()*(te.getDataCodewords()+F);this.totalCodewords=O}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(a,u){if((a&1)!==0||(u&1)!==0)throw new rt;for(let g of mi.VERSIONS)if(g.symbolSizeRows===a&&g.symbolSizeColumns===u)return g;throw new rt}toString(){return""+this.versionNumber}static buildVersions(){return[new mi(1,10,10,8,8,new _i(5,new bi(1,3))),new mi(2,12,12,10,10,new _i(7,new bi(1,5))),new mi(3,14,14,12,12,new _i(10,new bi(1,8))),new mi(4,16,16,14,14,new _i(12,new bi(1,12))),new mi(5,18,18,16,16,new _i(14,new bi(1,18))),new mi(6,20,20,18,18,new _i(18,new bi(1,22))),new mi(7,22,22,20,20,new _i(20,new bi(1,30))),new mi(8,24,24,22,22,new _i(24,new bi(1,36))),new mi(9,26,26,24,24,new _i(28,new bi(1,44))),new mi(10,32,32,14,14,new _i(36,new bi(1,62))),new mi(11,36,36,16,16,new _i(42,new bi(1,86))),new mi(12,40,40,18,18,new _i(48,new bi(1,114))),new mi(13,44,44,20,20,new _i(56,new bi(1,144))),new mi(14,48,48,22,22,new _i(68,new bi(1,174))),new mi(15,52,52,24,24,new _i(42,new bi(2,102))),new mi(16,64,64,14,14,new _i(56,new bi(2,140))),new mi(17,72,72,16,16,new _i(36,new bi(4,92))),new mi(18,80,80,18,18,new _i(48,new bi(4,114))),new mi(19,88,88,20,20,new _i(56,new bi(4,144))),new mi(20,96,96,22,22,new _i(68,new bi(4,174))),new mi(21,104,104,24,24,new _i(56,new bi(6,136))),new mi(22,120,120,18,18,new _i(68,new bi(6,175))),new mi(23,132,132,20,20,new _i(62,new bi(8,163))),new mi(24,144,144,22,22,new _i(62,new bi(8,156),new bi(2,155))),new mi(25,8,18,6,16,new _i(7,new bi(1,5))),new mi(26,8,32,6,14,new _i(11,new bi(1,10))),new mi(27,12,26,10,24,new _i(14,new bi(1,16))),new mi(28,12,36,10,16,new _i(18,new bi(1,22))),new mi(29,16,36,14,16,new _i(24,new bi(1,32))),new mi(30,16,48,14,22,new _i(28,new bi(1,49)))]}}mi.VERSIONS=mi.buildVersions();class li{constructor(a){const u=a.getHeight();if(u<8||u>144||(u&1)!==0)throw new rt;this.version=li.readVersion(a),this.mappingBitMatrix=this.extractDataRegion(a),this.readMappingMatrix=new qt(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(a){const u=a.getHeight(),g=a.getWidth();return mi.getVersionForDimensions(u,g)}readCodewords(){const a=new Int8Array(this.version.getTotalCodewords());let u=0,g=4,v=0;const w=this.mappingBitMatrix.getHeight(),I=this.mappingBitMatrix.getWidth();let O=!1,F=!1,q=!1,te=!1;do if(g===w&&v===0&&!O)a[u++]=this.readCorner1(w,I)&255,g-=2,v+=2,O=!0;else if(g===w-2&&v===0&&(I&3)!==0&&!F)a[u++]=this.readCorner2(w,I)&255,g-=2,v+=2,F=!0;else if(g===w+4&&v===2&&(I&7)===0&&!q)a[u++]=this.readCorner3(w,I)&255,g-=2,v+=2,q=!0;else if(g===w-2&&v===0&&(I&7)===4&&!te)a[u++]=this.readCorner4(w,I)&255,g-=2,v+=2,te=!0;else{do g<w&&v>=0&&!this.readMappingMatrix.get(v,g)&&(a[u++]=this.readUtah(g,v,w,I)&255),g-=2,v+=2;while(g>=0&&v<I);g+=1,v+=3;do g>=0&&v<I&&!this.readMappingMatrix.get(v,g)&&(a[u++]=this.readUtah(g,v,w,I)&255),g+=2,v-=2;while(g<w&&v>=0);g+=3,v+=1}while(g<w||v<I);if(u!==this.version.getTotalCodewords())throw new rt;return a}readModule(a,u,g,v){return a<0&&(a+=g,u+=4-(g+4&7)),u<0&&(u+=v,a+=4-(v+4&7)),this.readMappingMatrix.set(u,a),this.mappingBitMatrix.get(u,a)}readUtah(a,u,g,v){let w=0;return this.readModule(a-2,u-2,g,v)&&(w|=1),w<<=1,this.readModule(a-2,u-1,g,v)&&(w|=1),w<<=1,this.readModule(a-1,u-2,g,v)&&(w|=1),w<<=1,this.readModule(a-1,u-1,g,v)&&(w|=1),w<<=1,this.readModule(a-1,u,g,v)&&(w|=1),w<<=1,this.readModule(a,u-2,g,v)&&(w|=1),w<<=1,this.readModule(a,u-1,g,v)&&(w|=1),w<<=1,this.readModule(a,u,g,v)&&(w|=1),w}readCorner1(a,u){let g=0;return this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,1,a,u)&&(g|=1),g<<=1,this.readModule(a-1,2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g<<=1,this.readModule(2,u-1,a,u)&&(g|=1),g<<=1,this.readModule(3,u-1,a,u)&&(g|=1),g}readCorner2(a,u){let g=0;return this.readModule(a-3,0,a,u)&&(g|=1),g<<=1,this.readModule(a-2,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(0,u-4,a,u)&&(g|=1),g<<=1,this.readModule(0,u-3,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g}readCorner3(a,u){let g=0;return this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,u-1,a,u)&&(g|=1),g<<=1,this.readModule(0,u-3,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-3,a,u)&&(g|=1),g<<=1,this.readModule(1,u-2,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g}readCorner4(a,u){let g=0;return this.readModule(a-3,0,a,u)&&(g|=1),g<<=1,this.readModule(a-2,0,a,u)&&(g|=1),g<<=1,this.readModule(a-1,0,a,u)&&(g|=1),g<<=1,this.readModule(0,u-2,a,u)&&(g|=1),g<<=1,this.readModule(0,u-1,a,u)&&(g|=1),g<<=1,this.readModule(1,u-1,a,u)&&(g|=1),g<<=1,this.readModule(2,u-1,a,u)&&(g|=1),g<<=1,this.readModule(3,u-1,a,u)&&(g|=1),g}extractDataRegion(a){const u=this.version.getSymbolSizeRows(),g=this.version.getSymbolSizeColumns();if(a.getHeight()!==u)throw new K("Dimension of bitMatrix must match the version size");const v=this.version.getDataRegionSizeRows(),w=this.version.getDataRegionSizeColumns(),I=u/v|0,O=g/w|0,F=I*v,q=O*w,te=new qt(q,F);for(let ue=0;ue<I;++ue){const xe=ue*v;for(let Oe=0;Oe<O;++Oe){const ot=Oe*w;for(let ft=0;ft<v;++ft){const Rt=ue*(v+2)+1+ft,Ht=xe+ft;for(let An=0;An<w;++An){const wn=Oe*(w+2)+1+An;if(a.get(wn,Rt)){const mn=ot+An;te.set(mn,Ht)}}}}}return te}}class Hi{constructor(a,u){this.numDataCodewords=a,this.codewords=u}static getDataBlocks(a,u){const g=u.getECBlocks();let v=0;const w=g.getECBlocks();for(let ft of w)v+=ft.getCount();const I=new Array(v);let O=0;for(let ft of w)for(let Rt=0;Rt<ft.getCount();Rt++){const Ht=ft.getDataCodewords(),An=g.getECCodewords()+Ht;I[O++]=new Hi(Ht,new Uint8Array(An))}const q=I[0].codewords.length-g.getECCodewords(),te=q-1;let ue=0;for(let ft=0;ft<te;ft++)for(let Rt=0;Rt<O;Rt++)I[Rt].codewords[ft]=a[ue++];const xe=u.getVersionNumber()===24,Oe=xe?8:O;for(let ft=0;ft<Oe;ft++)I[ft].codewords[q-1]=a[ue++];const ot=I[0].codewords.length;for(let ft=q;ft<ot;ft++)for(let Rt=0;Rt<O;Rt++){const Ht=xe?(Rt+8)%O:Rt,An=xe&&Ht>7?ft-1:ft;I[Ht].codewords[An]=a[ue++]}if(ue!==a.length)throw new K;return I}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Tr{constructor(a){this.bytes=a,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(a){if(a<1||a>32||a>this.available())throw new K(""+a);let u=0,g=this.bitOffset,v=this.byteOffset;const w=this.bytes;if(g>0){const I=8-g,O=a<I?a:I,F=I-O,q=255>>8-O<<F;u=(w[v]&q)>>F,a-=O,g+=O,g===8&&(g=0,v++)}if(a>0){for(;a>=8;)u=u<<8|w[v]&255,v++,a-=8;if(a>0){const I=8-a,O=255>>I<<I;u=u<<a|(w[v]&O)>>I,g+=a}}return this.bitOffset=g,this.byteOffset=v,u}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Qn;(function(ce){ce[ce.PAD_ENCODE=0]="PAD_ENCODE",ce[ce.ASCII_ENCODE=1]="ASCII_ENCODE",ce[ce.C40_ENCODE=2]="C40_ENCODE",ce[ce.TEXT_ENCODE=3]="TEXT_ENCODE",ce[ce.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",ce[ce.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",ce[ce.BASE256_ENCODE=6]="BASE256_ENCODE"})(Qn||(Qn={}));class es{static decode(a){const u=new Tr(a),g=new vt,v=new vt,w=new Array;let I=Qn.ASCII_ENCODE;do if(I===Qn.ASCII_ENCODE)I=this.decodeAsciiSegment(u,g,v);else{switch(I){case Qn.C40_ENCODE:this.decodeC40Segment(u,g);break;case Qn.TEXT_ENCODE:this.decodeTextSegment(u,g);break;case Qn.ANSIX12_ENCODE:this.decodeAnsiX12Segment(u,g);break;case Qn.EDIFACT_ENCODE:this.decodeEdifactSegment(u,g);break;case Qn.BASE256_ENCODE:this.decodeBase256Segment(u,g,w);break;default:throw new rt}I=Qn.ASCII_ENCODE}while(I!==Qn.PAD_ENCODE&&u.available()>0);return v.length()>0&&g.append(v.toString()),new nn(a,g.toString(),w.length===0?null:w,null)}static decodeAsciiSegment(a,u,g){let v=!1;do{let w=a.readBits(8);if(w===0)throw new rt;if(w<=128)return v&&(w+=128),u.append(String.fromCharCode(w-1)),Qn.ASCII_ENCODE;if(w===129)return Qn.PAD_ENCODE;if(w<=229){const I=w-130;I<10&&u.append("0"),u.append(""+I)}else switch(w){case 230:return Qn.C40_ENCODE;case 231:return Qn.BASE256_ENCODE;case 232:u.append("");break;case 233:case 234:break;case 235:v=!0;break;case 236:u.append("[)>05"),g.insert(0,"");break;case 237:u.append("[)>06"),g.insert(0,"");break;case 238:return Qn.ANSIX12_ENCODE;case 239:return Qn.TEXT_ENCODE;case 240:return Qn.EDIFACT_ENCODE;case 241:break;default:if(w!==254||a.available()!==0)throw new rt;break}}while(a.available()>0);return Qn.ASCII_ENCODE}static decodeC40Segment(a,u){let g=!1;const v=[];let w=0;do{if(a.available()===8)return;const I=a.readBits(8);if(I===254)return;this.parseTwoBytes(I,a.readBits(8),v);for(let O=0;O<3;O++){const F=v[O];switch(w){case 0:if(F<3)w=F+1;else if(F<this.C40_BASIC_SET_CHARS.length){const q=this.C40_BASIC_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else throw new rt;break;case 1:g?(u.append(String.fromCharCode(F+128)),g=!1):u.append(String.fromCharCode(F)),w=0;break;case 2:if(F<this.C40_SHIFT2_SET_CHARS.length){const q=this.C40_SHIFT2_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else switch(F){case 27:u.append("");break;case 30:g=!0;break;default:throw new rt}w=0;break;case 3:g?(u.append(String.fromCharCode(F+224)),g=!1):u.append(String.fromCharCode(F+96)),w=0;break;default:throw new rt}}}while(a.available()>0)}static decodeTextSegment(a,u){let g=!1,v=[],w=0;do{if(a.available()===8)return;const I=a.readBits(8);if(I===254)return;this.parseTwoBytes(I,a.readBits(8),v);for(let O=0;O<3;O++){const F=v[O];switch(w){case 0:if(F<3)w=F+1;else if(F<this.TEXT_BASIC_SET_CHARS.length){const q=this.TEXT_BASIC_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else throw new rt;break;case 1:g?(u.append(String.fromCharCode(F+128)),g=!1):u.append(String.fromCharCode(F)),w=0;break;case 2:if(F<this.TEXT_SHIFT2_SET_CHARS.length){const q=this.TEXT_SHIFT2_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q)}else switch(F){case 27:u.append("");break;case 30:g=!0;break;default:throw new rt}w=0;break;case 3:if(F<this.TEXT_SHIFT3_SET_CHARS.length){const q=this.TEXT_SHIFT3_SET_CHARS[F];g?(u.append(String.fromCharCode(q.charCodeAt(0)+128)),g=!1):u.append(q),w=0}else throw new rt;break;default:throw new rt}}}while(a.available()>0)}static decodeAnsiX12Segment(a,u){const g=[];do{if(a.available()===8)return;const v=a.readBits(8);if(v===254)return;this.parseTwoBytes(v,a.readBits(8),g);for(let w=0;w<3;w++){const I=g[w];switch(I){case 0:u.append("\r");break;case 1:u.append("*");break;case 2:u.append(">");break;case 3:u.append(" ");break;default:if(I<14)u.append(String.fromCharCode(I+44));else if(I<40)u.append(String.fromCharCode(I+51));else throw new rt;break}}}while(a.available()>0)}static parseTwoBytes(a,u,g){let v=(a<<8)+u-1,w=Math.floor(v/1600);g[0]=w,v-=w*1600,w=Math.floor(v/40),g[1]=w,g[2]=v-w*40}static decodeEdifactSegment(a,u){do{if(a.available()<=16)return;for(let g=0;g<4;g++){let v=a.readBits(6);if(v===31){const w=8-a.getBitOffset();w!==8&&a.readBits(w);return}(v&32)===0&&(v|=64),u.append(String.fromCharCode(v))}}while(a.available()>0)}static decodeBase256Segment(a,u,g){let v=1+a.getByteOffset();const w=this.unrandomize255State(a.readBits(8),v++);let I;if(w===0?I=a.available()/8|0:w<250?I=w:I=250*(w-249)+this.unrandomize255State(a.readBits(8),v++),I<0)throw new rt;const O=new Uint8Array(I);for(let F=0;F<I;F++){if(a.available()<8)throw new rt;O[F]=this.unrandomize255State(a.readBits(8),v++)}g.push(O);try{u.append(Pe.decode(O,ht.ISO88591))}catch(F){throw new wi("Platform does not support required encoding: "+F.message)}}static unrandomize255State(a,u){const g=149*u%255+1,v=a-g;return v>=0?v:v+256}}es.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],es.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],es.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],es.TEXT_SHIFT2_SET_CHARS=es.C40_SHIFT2_SET_CHARS,es.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class Ts{constructor(){this.rsDecoder=new Oi(En.DATA_MATRIX_FIELD_256)}decode(a){const u=new li(a),g=u.getVersion(),v=u.readCodewords(),w=Hi.getDataBlocks(v,g);let I=0;for(let q of w)I+=q.getNumDataCodewords();const O=new Uint8Array(I),F=w.length;for(let q=0;q<F;q++){const te=w[q],ue=te.getCodewords(),xe=te.getNumDataCodewords();this.correctErrors(ue,xe);for(let Oe=0;Oe<xe;Oe++)O[Oe*F+q]=ue[Oe]}return es.decode(O)}correctErrors(a,u){const g=new Int32Array(a);try{this.rsDecoder.decode(g,a.length-u)}catch{throw new we}for(let v=0;v<u;v++)a[v]=g[v]}}class zi{constructor(a){this.image=a,this.rectangleDetector=new Di(this.image)}detect(){const a=this.rectangleDetector.detect();let u=this.detectSolid1(a);if(u=this.detectSolid2(u),u[3]=this.correctTopRight(u),!u[3])throw new ke;u=this.shiftToModuleCenter(u);const g=u[0],v=u[1],w=u[2],I=u[3];let O=this.transitionsBetween(g,I)+1,F=this.transitionsBetween(w,I)+1;(O&1)===1&&(O+=1),(F&1)===1&&(F+=1),4*O<7*F&&4*F<7*O&&(O=F=Math.max(O,F));let q=zi.sampleGrid(this.image,g,v,w,I,O,F);return new Li(q,[g,v,w,I])}static shiftPoint(a,u,g){let v=(u.getX()-a.getX())/(g+1),w=(u.getY()-a.getY())/(g+1);return new on(a.getX()+v,a.getY()+w)}static moveAway(a,u,g){let v=a.getX(),w=a.getY();return v<u?v-=1:v+=1,w<g?w-=1:w+=1,new on(v,w)}detectSolid1(a){let u=a[0],g=a[1],v=a[3],w=a[2],I=this.transitionsBetween(u,g),O=this.transitionsBetween(g,v),F=this.transitionsBetween(v,w),q=this.transitionsBetween(w,u),te=I,ue=[w,u,g,v];return te>O&&(te=O,ue[0]=u,ue[1]=g,ue[2]=v,ue[3]=w),te>F&&(te=F,ue[0]=g,ue[1]=v,ue[2]=w,ue[3]=u),te>q&&(ue[0]=v,ue[1]=w,ue[2]=u,ue[3]=g),ue}detectSolid2(a){let u=a[0],g=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w),O=zi.shiftPoint(g,v,(I+1)*4),F=zi.shiftPoint(v,g,(I+1)*4),q=this.transitionsBetween(O,u),te=this.transitionsBetween(F,w);return q<te?(a[0]=u,a[1]=g,a[2]=v,a[3]=w):(a[0]=g,a[1]=v,a[2]=w,a[3]=u),a}correctTopRight(a){let u=a[0],g=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w),O=this.transitionsBetween(g,w),F=zi.shiftPoint(u,g,(O+1)*4),q=zi.shiftPoint(v,g,(I+1)*4);I=this.transitionsBetween(F,w),O=this.transitionsBetween(q,w);let te=new on(w.getX()+(v.getX()-g.getX())/(I+1),w.getY()+(v.getY()-g.getY())/(I+1)),ue=new on(w.getX()+(u.getX()-g.getX())/(O+1),w.getY()+(u.getY()-g.getY())/(O+1));if(!this.isValid(te))return this.isValid(ue)?ue:null;if(!this.isValid(ue))return te;let xe=this.transitionsBetween(F,te)+this.transitionsBetween(q,te),Oe=this.transitionsBetween(F,ue)+this.transitionsBetween(q,ue);return xe>Oe?te:ue}shiftToModuleCenter(a){let u=a[0],g=a[1],v=a[2],w=a[3],I=this.transitionsBetween(u,w)+1,O=this.transitionsBetween(v,w)+1,F=zi.shiftPoint(u,g,O*4),q=zi.shiftPoint(v,g,I*4);I=this.transitionsBetween(F,w)+1,O=this.transitionsBetween(q,w)+1,(I&1)===1&&(I+=1),(O&1)===1&&(O+=1);let te=(u.getX()+g.getX()+v.getX()+w.getX())/4,ue=(u.getY()+g.getY()+v.getY()+w.getY())/4;u=zi.moveAway(u,te,ue),g=zi.moveAway(g,te,ue),v=zi.moveAway(v,te,ue),w=zi.moveAway(w,te,ue);let xe,Oe;return F=zi.shiftPoint(u,g,O*4),F=zi.shiftPoint(F,w,I*4),xe=zi.shiftPoint(g,u,O*4),xe=zi.shiftPoint(xe,v,I*4),q=zi.shiftPoint(v,w,O*4),q=zi.shiftPoint(q,g,I*4),Oe=zi.shiftPoint(w,v,O*4),Oe=zi.shiftPoint(Oe,u,I*4),[F,xe,q,Oe]}isValid(a){return a.getX()>=0&&a.getX()<this.image.getWidth()&&a.getY()>0&&a.getY()<this.image.getHeight()}static sampleGrid(a,u,g,v,w,I,O){return le.getInstance().sampleGrid(a,I,O,.5,.5,I-.5,.5,I-.5,O-.5,.5,O-.5,u.getX(),u.getY(),w.getX(),w.getY(),v.getX(),v.getY(),g.getX(),g.getY())}transitionsBetween(a,u){let g=Math.trunc(a.getX()),v=Math.trunc(a.getY()),w=Math.trunc(u.getX()),I=Math.trunc(u.getY()),O=Math.abs(I-v)>Math.abs(w-g);if(O){let ft=g;g=v,v=ft,ft=w,w=I,I=ft}let F=Math.abs(w-g),q=Math.abs(I-v),te=-F/2,ue=v<I?1:-1,xe=g<w?1:-1,Oe=0,ot=this.image.get(O?v:g,O?g:v);for(let ft=g,Rt=v;ft!==w;ft+=xe){let Ht=this.image.get(O?Rt:ft,O?ft:Rt);if(Ht!==ot&&(Oe++,ot=Ht),te+=q,te>0){if(Rt===I)break;Rt+=ue,te-=F}}return Oe}}class Ba{constructor(){this.decoder=new Ts}decode(a,u=null){let g,v;if(u!=null&&u.has(Et.PURE_BARCODE)){const q=Ba.extractPureBits(a.getBlackMatrix());g=this.decoder.decode(q),v=Ba.NO_POINTS}else{const q=new zi(a.getBlackMatrix()).detect();g=this.decoder.decode(q.getBits()),v=q.getPoints()}const w=g.getRawBytes(),I=new bt(g.getText(),w,8*w.length,v,Bt.DATA_MATRIX,pe.currentTimeMillis()),O=g.getByteSegments();O!=null&&I.putMetadata(un.BYTE_SEGMENTS,O);const F=g.getECLevel();return F!=null&&I.putMetadata(un.ERROR_CORRECTION_LEVEL,F),I}reset(){}static extractPureBits(a){const u=a.getTopLeftOnBit(),g=a.getBottomRightOnBit();if(u==null||g==null)throw new ke;const v=this.moduleSize(u,a);let w=u[1];const I=g[1];let O=u[0];const q=(g[0]-O+1)/v,te=(I-w+1)/v;if(q<=0||te<=0)throw new ke;const ue=v/2;w+=ue,O+=ue;const xe=new qt(q,te);for(let Oe=0;Oe<te;Oe++){const ot=w+Oe*v;for(let ft=0;ft<q;ft++)a.get(O+ft*v,ot)&&xe.set(ft,Oe)}return xe}static moduleSize(a,u){const g=u.getWidth();let v=a[0];const w=a[1];for(;v<g&&u.get(v,w);)v++;if(v===g)throw new ke;const I=v-a[0];if(I===0)throw new ke;return I}}Ba.NO_POINTS=[];class sl extends kt{constructor(a=500){super(new Ba,a)}}var Vo;(function(ce){ce[ce.L=0]="L",ce[ce.M=1]="M",ce[ce.Q=2]="Q",ce[ce.H=3]="H"})(Vo||(Vo={}));class Fi{constructor(a,u,g){this.value=a,this.stringValue=u,this.bits=g,Fi.FOR_BITS.set(g,this),Fi.FOR_VALUE.set(a,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(a){switch(a){case"L":return Fi.L;case"M":return Fi.M;case"Q":return Fi.Q;case"H":return Fi.H;default:throw new Y(a+"not available")}}toString(){return this.stringValue}equals(a){if(!(a instanceof Fi))return!1;const u=a;return this.value===u.value}static forBits(a){if(a<0||a>=Fi.FOR_BITS.size)throw new K;return Fi.FOR_BITS.get(a)}}Fi.FOR_BITS=new Map,Fi.FOR_VALUE=new Map,Fi.L=new Fi(Vo.L,"L",1),Fi.M=new Fi(Vo.M,"M",0),Fi.Q=new Fi(Vo.Q,"Q",3),Fi.H=new Fi(Vo.H,"H",2);class Wr{constructor(a){this.errorCorrectionLevel=Fi.forBits(a>>3&3),this.dataMask=a&7}static numBitsDiffering(a,u){return Xe.bitCount(a^u)}static decodeFormatInformation(a,u){const g=Wr.doDecodeFormatInformation(a,u);return g!==null?g:Wr.doDecodeFormatInformation(a^Wr.FORMAT_INFO_MASK_QR,u^Wr.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(a,u){let g=Number.MAX_SAFE_INTEGER,v=0;for(const w of Wr.FORMAT_INFO_DECODE_LOOKUP){const I=w[0];if(I===a||I===u)return new Wr(w[1]);let O=Wr.numBitsDiffering(a,I);O<g&&(v=w[1],g=O),a!==u&&(O=Wr.numBitsDiffering(u,I),O<g&&(v=w[1],g=O))}return g<=3?new Wr(v):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(a){if(!(a instanceof Wr))return!1;const u=a;return this.errorCorrectionLevel===u.errorCorrectionLevel&&this.dataMask===u.dataMask}}Wr.FORMAT_INFO_MASK_QR=21522,Wr.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Pt{constructor(a,...u){this.ecCodewordsPerBlock=a,this.ecBlocks=u}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let a=0;const u=this.ecBlocks;for(const g of u)a+=g.getCount();return a}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class Ne{constructor(a,u){this.count=a,this.dataCodewords=u}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ti{constructor(a,u,...g){this.versionNumber=a,this.alignmentPatternCenters=u,this.ecBlocks=g;let v=0;const w=g[0].getECCodewordsPerBlock(),I=g[0].getECBlocks();for(const O of I)v+=O.getCount()*(O.getDataCodewords()+w);this.totalCodewords=v}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(a){return this.ecBlocks[a.getValue()]}static getProvisionalVersionForDimension(a){if(a%4!==1)throw new rt;try{return this.getVersionForNumber((a-17)/4)}catch{throw new rt}}static getVersionForNumber(a){if(a<1||a>40)throw new K;return ti.VERSIONS[a-1]}static decodeVersionInformation(a){let u=Number.MAX_SAFE_INTEGER,g=0;for(let v=0;v<ti.VERSION_DECODE_INFO.length;v++){const w=ti.VERSION_DECODE_INFO[v];if(w===a)return ti.getVersionForNumber(v+7);const I=Wr.numBitsDiffering(a,w);I<u&&(g=v+7,u=I)}return u<=3?ti.getVersionForNumber(g):null}buildFunctionPattern(){const a=this.getDimensionForVersion(),u=new qt(a);u.setRegion(0,0,9,9),u.setRegion(a-8,0,8,9),u.setRegion(0,a-8,9,8);const g=this.alignmentPatternCenters.length;for(let v=0;v<g;v++){const w=this.alignmentPatternCenters[v]-2;for(let I=0;I<g;I++)v===0&&(I===0||I===g-1)||v===g-1&&I===0||u.setRegion(this.alignmentPatternCenters[I]-2,w,5,5)}return u.setRegion(6,9,1,a-17),u.setRegion(9,6,a-17,1),this.versionNumber>6&&(u.setRegion(a-11,0,3,6),u.setRegion(0,a-11,6,3)),u}toString(){return""+this.versionNumber}}ti.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),ti.VERSIONS=[new ti(1,new Int32Array(0),new Pt(7,new Ne(1,19)),new Pt(10,new Ne(1,16)),new Pt(13,new Ne(1,13)),new Pt(17,new Ne(1,9))),new ti(2,Int32Array.from([6,18]),new Pt(10,new Ne(1,34)),new Pt(16,new Ne(1,28)),new Pt(22,new Ne(1,22)),new Pt(28,new Ne(1,16))),new ti(3,Int32Array.from([6,22]),new Pt(15,new Ne(1,55)),new Pt(26,new Ne(1,44)),new Pt(18,new Ne(2,17)),new Pt(22,new Ne(2,13))),new ti(4,Int32Array.from([6,26]),new Pt(20,new Ne(1,80)),new Pt(18,new Ne(2,32)),new Pt(26,new Ne(2,24)),new Pt(16,new Ne(4,9))),new ti(5,Int32Array.from([6,30]),new Pt(26,new Ne(1,108)),new Pt(24,new Ne(2,43)),new Pt(18,new Ne(2,15),new Ne(2,16)),new Pt(22,new Ne(2,11),new Ne(2,12))),new ti(6,Int32Array.from([6,34]),new Pt(18,new Ne(2,68)),new Pt(16,new Ne(4,27)),new Pt(24,new Ne(4,19)),new Pt(28,new Ne(4,15))),new ti(7,Int32Array.from([6,22,38]),new Pt(20,new Ne(2,78)),new Pt(18,new Ne(4,31)),new Pt(18,new Ne(2,14),new Ne(4,15)),new Pt(26,new Ne(4,13),new Ne(1,14))),new ti(8,Int32Array.from([6,24,42]),new Pt(24,new Ne(2,97)),new Pt(22,new Ne(2,38),new Ne(2,39)),new Pt(22,new Ne(4,18),new Ne(2,19)),new Pt(26,new Ne(4,14),new Ne(2,15))),new ti(9,Int32Array.from([6,26,46]),new Pt(30,new Ne(2,116)),new Pt(22,new Ne(3,36),new Ne(2,37)),new Pt(20,new Ne(4,16),new Ne(4,17)),new Pt(24,new Ne(4,12),new Ne(4,13))),new ti(10,Int32Array.from([6,28,50]),new Pt(18,new Ne(2,68),new Ne(2,69)),new Pt(26,new Ne(4,43),new Ne(1,44)),new Pt(24,new Ne(6,19),new Ne(2,20)),new Pt(28,new Ne(6,15),new Ne(2,16))),new ti(11,Int32Array.from([6,30,54]),new Pt(20,new Ne(4,81)),new Pt(30,new Ne(1,50),new Ne(4,51)),new Pt(28,new Ne(4,22),new Ne(4,23)),new Pt(24,new Ne(3,12),new Ne(8,13))),new ti(12,Int32Array.from([6,32,58]),new Pt(24,new Ne(2,92),new Ne(2,93)),new Pt(22,new Ne(6,36),new Ne(2,37)),new Pt(26,new Ne(4,20),new Ne(6,21)),new Pt(28,new Ne(7,14),new Ne(4,15))),new ti(13,Int32Array.from([6,34,62]),new Pt(26,new Ne(4,107)),new Pt(22,new Ne(8,37),new Ne(1,38)),new Pt(24,new Ne(8,20),new Ne(4,21)),new Pt(22,new Ne(12,11),new Ne(4,12))),new ti(14,Int32Array.from([6,26,46,66]),new Pt(30,new Ne(3,115),new Ne(1,116)),new Pt(24,new Ne(4,40),new Ne(5,41)),new Pt(20,new Ne(11,16),new Ne(5,17)),new Pt(24,new Ne(11,12),new Ne(5,13))),new ti(15,Int32Array.from([6,26,48,70]),new Pt(22,new Ne(5,87),new Ne(1,88)),new Pt(24,new Ne(5,41),new Ne(5,42)),new Pt(30,new Ne(5,24),new Ne(7,25)),new Pt(24,new Ne(11,12),new Ne(7,13))),new ti(16,Int32Array.from([6,26,50,74]),new Pt(24,new Ne(5,98),new Ne(1,99)),new Pt(28,new Ne(7,45),new Ne(3,46)),new Pt(24,new Ne(15,19),new Ne(2,20)),new Pt(30,new Ne(3,15),new Ne(13,16))),new ti(17,Int32Array.from([6,30,54,78]),new Pt(28,new Ne(1,107),new Ne(5,108)),new Pt(28,new Ne(10,46),new Ne(1,47)),new Pt(28,new Ne(1,22),new Ne(15,23)),new Pt(28,new Ne(2,14),new Ne(17,15))),new ti(18,Int32Array.from([6,30,56,82]),new Pt(30,new Ne(5,120),new Ne(1,121)),new Pt(26,new Ne(9,43),new Ne(4,44)),new Pt(28,new Ne(17,22),new Ne(1,23)),new Pt(28,new Ne(2,14),new Ne(19,15))),new ti(19,Int32Array.from([6,30,58,86]),new Pt(28,new Ne(3,113),new Ne(4,114)),new Pt(26,new Ne(3,44),new Ne(11,45)),new Pt(26,new Ne(17,21),new Ne(4,22)),new Pt(26,new Ne(9,13),new Ne(16,14))),new ti(20,Int32Array.from([6,34,62,90]),new Pt(28,new Ne(3,107),new Ne(5,108)),new Pt(26,new Ne(3,41),new Ne(13,42)),new Pt(30,new Ne(15,24),new Ne(5,25)),new Pt(28,new Ne(15,15),new Ne(10,16))),new ti(21,Int32Array.from([6,28,50,72,94]),new Pt(28,new Ne(4,116),new Ne(4,117)),new Pt(26,new Ne(17,42)),new Pt(28,new Ne(17,22),new Ne(6,23)),new Pt(30,new Ne(19,16),new Ne(6,17))),new ti(22,Int32Array.from([6,26,50,74,98]),new Pt(28,new Ne(2,111),new Ne(7,112)),new Pt(28,new Ne(17,46)),new Pt(30,new Ne(7,24),new Ne(16,25)),new Pt(24,new Ne(34,13))),new ti(23,Int32Array.from([6,30,54,78,102]),new Pt(30,new Ne(4,121),new Ne(5,122)),new Pt(28,new Ne(4,47),new Ne(14,48)),new Pt(30,new Ne(11,24),new Ne(14,25)),new Pt(30,new Ne(16,15),new Ne(14,16))),new ti(24,Int32Array.from([6,28,54,80,106]),new Pt(30,new Ne(6,117),new Ne(4,118)),new Pt(28,new Ne(6,45),new Ne(14,46)),new Pt(30,new Ne(11,24),new Ne(16,25)),new Pt(30,new Ne(30,16),new Ne(2,17))),new ti(25,Int32Array.from([6,32,58,84,110]),new Pt(26,new Ne(8,106),new Ne(4,107)),new Pt(28,new Ne(8,47),new Ne(13,48)),new Pt(30,new Ne(7,24),new Ne(22,25)),new Pt(30,new Ne(22,15),new Ne(13,16))),new ti(26,Int32Array.from([6,30,58,86,114]),new Pt(28,new Ne(10,114),new Ne(2,115)),new Pt(28,new Ne(19,46),new Ne(4,47)),new Pt(28,new Ne(28,22),new Ne(6,23)),new Pt(30,new Ne(33,16),new Ne(4,17))),new ti(27,Int32Array.from([6,34,62,90,118]),new Pt(30,new Ne(8,122),new Ne(4,123)),new Pt(28,new Ne(22,45),new Ne(3,46)),new Pt(30,new Ne(8,23),new Ne(26,24)),new Pt(30,new Ne(12,15),new Ne(28,16))),new ti(28,Int32Array.from([6,26,50,74,98,122]),new Pt(30,new Ne(3,117),new Ne(10,118)),new Pt(28,new Ne(3,45),new Ne(23,46)),new Pt(30,new Ne(4,24),new Ne(31,25)),new Pt(30,new Ne(11,15),new Ne(31,16))),new ti(29,Int32Array.from([6,30,54,78,102,126]),new Pt(30,new Ne(7,116),new Ne(7,117)),new Pt(28,new Ne(21,45),new Ne(7,46)),new Pt(30,new Ne(1,23),new Ne(37,24)),new Pt(30,new Ne(19,15),new Ne(26,16))),new ti(30,Int32Array.from([6,26,52,78,104,130]),new Pt(30,new Ne(5,115),new Ne(10,116)),new Pt(28,new Ne(19,47),new Ne(10,48)),new Pt(30,new Ne(15,24),new Ne(25,25)),new Pt(30,new Ne(23,15),new Ne(25,16))),new ti(31,Int32Array.from([6,30,56,82,108,134]),new Pt(30,new Ne(13,115),new Ne(3,116)),new Pt(28,new Ne(2,46),new Ne(29,47)),new Pt(30,new Ne(42,24),new Ne(1,25)),new Pt(30,new Ne(23,15),new Ne(28,16))),new ti(32,Int32Array.from([6,34,60,86,112,138]),new Pt(30,new Ne(17,115)),new Pt(28,new Ne(10,46),new Ne(23,47)),new Pt(30,new Ne(10,24),new Ne(35,25)),new Pt(30,new Ne(19,15),new Ne(35,16))),new ti(33,Int32Array.from([6,30,58,86,114,142]),new Pt(30,new Ne(17,115),new Ne(1,116)),new Pt(28,new Ne(14,46),new Ne(21,47)),new Pt(30,new Ne(29,24),new Ne(19,25)),new Pt(30,new Ne(11,15),new Ne(46,16))),new ti(34,Int32Array.from([6,34,62,90,118,146]),new Pt(30,new Ne(13,115),new Ne(6,116)),new Pt(28,new Ne(14,46),new Ne(23,47)),new Pt(30,new Ne(44,24),new Ne(7,25)),new Pt(30,new Ne(59,16),new Ne(1,17))),new ti(35,Int32Array.from([6,30,54,78,102,126,150]),new Pt(30,new Ne(12,121),new Ne(7,122)),new Pt(28,new Ne(12,47),new Ne(26,48)),new Pt(30,new Ne(39,24),new Ne(14,25)),new Pt(30,new Ne(22,15),new Ne(41,16))),new ti(36,Int32Array.from([6,24,50,76,102,128,154]),new Pt(30,new Ne(6,121),new Ne(14,122)),new Pt(28,new Ne(6,47),new Ne(34,48)),new Pt(30,new Ne(46,24),new Ne(10,25)),new Pt(30,new Ne(2,15),new Ne(64,16))),new ti(37,Int32Array.from([6,28,54,80,106,132,158]),new Pt(30,new Ne(17,122),new Ne(4,123)),new Pt(28,new Ne(29,46),new Ne(14,47)),new Pt(30,new Ne(49,24),new Ne(10,25)),new Pt(30,new Ne(24,15),new Ne(46,16))),new ti(38,Int32Array.from([6,32,58,84,110,136,162]),new Pt(30,new Ne(4,122),new Ne(18,123)),new Pt(28,new Ne(13,46),new Ne(32,47)),new Pt(30,new Ne(48,24),new Ne(14,25)),new Pt(30,new Ne(42,15),new Ne(32,16))),new ti(39,Int32Array.from([6,26,54,82,110,138,166]),new Pt(30,new Ne(20,117),new Ne(4,118)),new Pt(28,new Ne(40,47),new Ne(7,48)),new Pt(30,new Ne(43,24),new Ne(22,25)),new Pt(30,new Ne(10,15),new Ne(67,16))),new ti(40,Int32Array.from([6,30,58,86,114,142,170]),new Pt(30,new Ne(19,118),new Ne(6,119)),new Pt(28,new Ne(18,47),new Ne(31,48)),new Pt(30,new Ne(34,24),new Ne(34,25)),new Pt(30,new Ne(20,15),new Ne(61,16)))];var cs;(function(ce){ce[ce.DATA_MASK_000=0]="DATA_MASK_000",ce[ce.DATA_MASK_001=1]="DATA_MASK_001",ce[ce.DATA_MASK_010=2]="DATA_MASK_010",ce[ce.DATA_MASK_011=3]="DATA_MASK_011",ce[ce.DATA_MASK_100=4]="DATA_MASK_100",ce[ce.DATA_MASK_101=5]="DATA_MASK_101",ce[ce.DATA_MASK_110=6]="DATA_MASK_110",ce[ce.DATA_MASK_111=7]="DATA_MASK_111"})(cs||(cs={}));class Is{constructor(a,u){this.value=a,this.isMasked=u}unmaskBitMatrix(a,u){for(let g=0;g<u;g++)for(let v=0;v<u;v++)this.isMasked(g,v)&&a.flip(v,g)}}Is.values=new Map([[cs.DATA_MASK_000,new Is(cs.DATA_MASK_000,(ce,a)=>(ce+a&1)===0)],[cs.DATA_MASK_001,new Is(cs.DATA_MASK_001,(ce,a)=>(ce&1)===0)],[cs.DATA_MASK_010,new Is(cs.DATA_MASK_010,(ce,a)=>a%3===0)],[cs.DATA_MASK_011,new Is(cs.DATA_MASK_011,(ce,a)=>(ce+a)%3===0)],[cs.DATA_MASK_100,new Is(cs.DATA_MASK_100,(ce,a)=>(Math.floor(ce/2)+Math.floor(a/3)&1)===0)],[cs.DATA_MASK_101,new Is(cs.DATA_MASK_101,(ce,a)=>ce*a%6===0)],[cs.DATA_MASK_110,new Is(cs.DATA_MASK_110,(ce,a)=>ce*a%6<3)],[cs.DATA_MASK_111,new Is(cs.DATA_MASK_111,(ce,a)=>(ce+a+ce*a%3&1)===0)]]);class Ma{constructor(a){const u=a.getHeight();if(u<21||(u&3)!==1)throw new rt;this.bitMatrix=a}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let a=0;for(let w=0;w<6;w++)a=this.copyBit(w,8,a);a=this.copyBit(7,8,a),a=this.copyBit(8,8,a),a=this.copyBit(8,7,a);for(let w=5;w>=0;w--)a=this.copyBit(8,w,a);const u=this.bitMatrix.getHeight();let g=0;const v=u-7;for(let w=u-1;w>=v;w--)g=this.copyBit(8,w,g);for(let w=u-8;w<u;w++)g=this.copyBit(w,8,g);if(this.parsedFormatInfo=Wr.decodeFormatInformation(a,g),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new rt}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const a=this.bitMatrix.getHeight(),u=Math.floor((a-17)/4);if(u<=6)return ti.getVersionForNumber(u);let g=0;const v=a-11;for(let I=5;I>=0;I--)for(let O=a-9;O>=v;O--)g=this.copyBit(O,I,g);let w=ti.decodeVersionInformation(g);if(w!==null&&w.getDimensionForVersion()===a)return this.parsedVersion=w,w;g=0;for(let I=5;I>=0;I--)for(let O=a-9;O>=v;O--)g=this.copyBit(I,O,g);if(w=ti.decodeVersionInformation(g),w!==null&&w.getDimensionForVersion()===a)return this.parsedVersion=w,w;throw new rt}copyBit(a,u,g){return(this.isMirror?this.bitMatrix.get(u,a):this.bitMatrix.get(a,u))?g<<1|1:g<<1}readCodewords(){const a=this.readFormatInformation(),u=this.readVersion(),g=Is.values.get(a.getDataMask()),v=this.bitMatrix.getHeight();g.unmaskBitMatrix(this.bitMatrix,v);const w=u.buildFunctionPattern();let I=!0;const O=new Uint8Array(u.getTotalCodewords());let F=0,q=0,te=0;for(let ue=v-1;ue>0;ue-=2){ue===6&&ue--;for(let xe=0;xe<v;xe++){const Oe=I?v-1-xe:xe;for(let ot=0;ot<2;ot++)w.get(ue-ot,Oe)||(te++,q<<=1,this.bitMatrix.get(ue-ot,Oe)&&(q|=1),te===8&&(O[F++]=q,te=0,q=0))}I=!I}if(F!==u.getTotalCodewords())throw new rt;return O}remask(){if(this.parsedFormatInfo===null)return;const a=Is.values[this.parsedFormatInfo.getDataMask()],u=this.bitMatrix.getHeight();a.unmaskBitMatrix(this.bitMatrix,u)}setMirror(a){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=a}mirror(){const a=this.bitMatrix;for(let u=0,g=a.getWidth();u<g;u++)for(let v=u+1,w=a.getHeight();v<w;v++)a.get(u,v)!==a.get(v,u)&&(a.flip(v,u),a.flip(u,v))}}class uc{constructor(a,u){this.numDataCodewords=a,this.codewords=u}static getDataBlocks(a,u,g){if(a.length!==u.getTotalCodewords())throw new K;const v=u.getECBlocksForLevel(g);let w=0;const I=v.getECBlocks();for(const ot of I)w+=ot.getCount();const O=new Array(w);let F=0;for(const ot of I)for(let ft=0;ft<ot.getCount();ft++){const Rt=ot.getDataCodewords(),Ht=v.getECCodewordsPerBlock()+Rt;O[F++]=new uc(Rt,new Uint8Array(Ht))}const q=O[0].codewords.length;let te=O.length-1;for(;te>=0&&O[te].codewords.length!==q;)te--;te++;const ue=q-v.getECCodewordsPerBlock();let xe=0;for(let ot=0;ot<ue;ot++)for(let ft=0;ft<F;ft++)O[ft].codewords[ot]=a[xe++];for(let ot=te;ot<F;ot++)O[ot].codewords[ue]=a[xe++];const Oe=O[0].codewords.length;for(let ot=ue;ot<Oe;ot++)for(let ft=0;ft<F;ft++){const Rt=ft<te?ot:ot+1;O[ft].codewords[Rt]=a[xe++]}return O}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var ts;(function(ce){ce[ce.TERMINATOR=0]="TERMINATOR",ce[ce.NUMERIC=1]="NUMERIC",ce[ce.ALPHANUMERIC=2]="ALPHANUMERIC",ce[ce.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",ce[ce.BYTE=4]="BYTE",ce[ce.ECI=5]="ECI",ce[ce.KANJI=6]="KANJI",ce[ce.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",ce[ce.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",ce[ce.HANZI=9]="HANZI"})(ts||(ts={}));class di{constructor(a,u,g,v){this.value=a,this.stringValue=u,this.characterCountBitsForVersions=g,this.bits=v,di.FOR_BITS.set(v,this),di.FOR_VALUE.set(a,this)}static forBits(a){const u=di.FOR_BITS.get(a);if(u===void 0)throw new K;return u}getCharacterCountBits(a){const u=a.getVersionNumber();let g;return u<=9?g=0:u<=26?g=1:g=2,this.characterCountBitsForVersions[g]}getValue(){return this.value}getBits(){return this.bits}equals(a){if(!(a instanceof di))return!1;const u=a;return this.value===u.value}toString(){return this.stringValue}}di.FOR_BITS=new Map,di.FOR_VALUE=new Map,di.TERMINATOR=new di(ts.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),di.NUMERIC=new di(ts.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),di.ALPHANUMERIC=new di(ts.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),di.STRUCTURED_APPEND=new di(ts.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),di.BYTE=new di(ts.BYTE,"BYTE",Int32Array.from([8,16,16]),4),di.ECI=new di(ts.ECI,"ECI",Int32Array.from([0,0,0]),7),di.KANJI=new di(ts.KANJI,"KANJI",Int32Array.from([8,10,12]),8),di.FNC1_FIRST_POSITION=new di(ts.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),di.FNC1_SECOND_POSITION=new di(ts.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),di.HANZI=new di(ts.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class xr{static decode(a,u,g,v){const w=new Tr(a);let I=new vt;const O=new Array;let F=-1,q=-1;try{let te=null,ue=!1,xe;do{if(w.available()<4)xe=di.TERMINATOR;else{const Oe=w.readBits(4);xe=di.forBits(Oe)}switch(xe){case di.TERMINATOR:break;case di.FNC1_FIRST_POSITION:case di.FNC1_SECOND_POSITION:ue=!0;break;case di.STRUCTURED_APPEND:if(w.available()<16)throw new rt;F=w.readBits(8),q=w.readBits(8);break;case di.ECI:const Oe=xr.parseECIValue(w);if(te=He.getCharacterSetECIByValue(Oe),te===null)throw new rt;break;case di.HANZI:const ot=w.readBits(4),ft=w.readBits(xe.getCharacterCountBits(u));ot===xr.GB2312_SUBSET&&xr.decodeHanziSegment(w,I,ft);break;default:const Rt=w.readBits(xe.getCharacterCountBits(u));switch(xe){case di.NUMERIC:xr.decodeNumericSegment(w,I,Rt);break;case di.ALPHANUMERIC:xr.decodeAlphanumericSegment(w,I,Rt,ue);break;case di.BYTE:xr.decodeByteSegment(w,I,Rt,te,O,v);break;case di.KANJI:xr.decodeKanjiSegment(w,I,Rt);break;default:throw new rt}break}}while(xe!==di.TERMINATOR)}catch{throw new rt}return new nn(a,I.toString(),O.length===0?null:O,g===null?null:g.toString(),F,q)}static decodeHanziSegment(a,u,g){if(g*13>a.available())throw new rt;const v=new Uint8Array(2*g);let w=0;for(;g>0;){const I=a.readBits(13);let O=I/96<<8&4294967295|I%96;O<959?O+=41377:O+=42657,v[w]=O>>8&255,v[w+1]=O&255,w+=2,g--}try{u.append(Pe.decode(v,ht.GB2312))}catch(I){throw new rt(I)}}static decodeKanjiSegment(a,u,g){if(g*13>a.available())throw new rt;const v=new Uint8Array(2*g);let w=0;for(;g>0;){const I=a.readBits(13);let O=I/192<<8&4294967295|I%192;O<7936?O+=33088:O+=49472,v[w]=O>>8,v[w+1]=O,w+=2,g--}try{u.append(Pe.decode(v,ht.SHIFT_JIS))}catch(I){throw new rt(I)}}static decodeByteSegment(a,u,g,v,w,I){if(8*g>a.available())throw new rt;const O=new Uint8Array(g);for(let q=0;q<g;q++)O[q]=a.readBits(8);let F;v===null?F=ht.guessEncoding(O,I):F=v.getName();try{u.append(Pe.decode(O,F))}catch(q){throw new rt(q)}w.push(O)}static toAlphaNumericChar(a){if(a>=xr.ALPHANUMERIC_CHARS.length)throw new rt;return xr.ALPHANUMERIC_CHARS[a]}static decodeAlphanumericSegment(a,u,g,v){const w=u.length();for(;g>1;){if(a.available()<11)throw new rt;const I=a.readBits(11);u.append(xr.toAlphaNumericChar(Math.floor(I/45))),u.append(xr.toAlphaNumericChar(I%45)),g-=2}if(g===1){if(a.available()<6)throw new rt;u.append(xr.toAlphaNumericChar(a.readBits(6)))}if(v)for(let I=w;I<u.length();I++)u.charAt(I)==="%"&&(I<u.length()-1&&u.charAt(I+1)==="%"?u.deleteCharAt(I+1):u.setCharAt(I,""))}static decodeNumericSegment(a,u,g){for(;g>=3;){if(a.available()<10)throw new rt;const v=a.readBits(10);if(v>=1e3)throw new rt;u.append(xr.toAlphaNumericChar(Math.floor(v/100))),u.append(xr.toAlphaNumericChar(Math.floor(v/10)%10)),u.append(xr.toAlphaNumericChar(v%10)),g-=3}if(g===2){if(a.available()<7)throw new rt;const v=a.readBits(7);if(v>=100)throw new rt;u.append(xr.toAlphaNumericChar(Math.floor(v/10))),u.append(xr.toAlphaNumericChar(v%10))}else if(g===1){if(a.available()<4)throw new rt;const v=a.readBits(4);if(v>=10)throw new rt;u.append(xr.toAlphaNumericChar(v))}}static parseECIValue(a){const u=a.readBits(8);if((u&128)===0)return u&127;if((u&192)===128){const g=a.readBits(8);return(u&63)<<8&4294967295|g}if((u&224)===192){const g=a.readBits(16);return(u&31)<<16&4294967295|g}throw new rt}}xr.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",xr.GB2312_SUBSET=1;class wo{constructor(a){this.mirrored=a}isMirrored(){return this.mirrored}applyMirroredCorrection(a){if(!this.mirrored||a===null||a.length<3)return;const u=a[0];a[0]=a[2],a[2]=u}}class al{constructor(){this.rsDecoder=new Oi(En.QR_CODE_FIELD_256)}decodeBooleanArray(a,u){return this.decodeBitMatrix(qt.parseFromBooleanArray(a),u)}decodeBitMatrix(a,u){const g=new Ma(a);let v=null;try{return this.decodeBitMatrixParser(g,u)}catch(w){v=w}try{g.remask(),g.setMirror(!0),g.readVersion(),g.readFormatInformation(),g.mirror();const w=this.decodeBitMatrixParser(g,u);return w.setOther(new wo(!0)),w}catch(w){throw v!==null?v:w}}decodeBitMatrixParser(a,u){const g=a.readVersion(),v=a.readFormatInformation().getErrorCorrectionLevel(),w=a.readCodewords(),I=uc.getDataBlocks(w,g,v);let O=0;for(const te of I)O+=te.getNumDataCodewords();const F=new Uint8Array(O);let q=0;for(const te of I){const ue=te.getCodewords(),xe=te.getNumDataCodewords();this.correctErrors(ue,xe);for(let Oe=0;Oe<xe;Oe++)F[q++]=ue[Oe]}return xr.decode(F,g,v,u)}correctErrors(a,u){const g=new Int32Array(a);try{this.rsDecoder.decode(g,a.length-u)}catch{throw new we}for(let v=0;v<u;v++)a[v]=g[v]}}class Si extends on{constructor(a,u,g){super(a,u),this.estimatedModuleSize=g}aboutEquals(a,u,g){if(Math.abs(u-this.getY())<=a&&Math.abs(g-this.getX())<=a){const v=Math.abs(a-this.estimatedModuleSize);return v<=1||v<=this.estimatedModuleSize}return!1}combineEstimate(a,u,g){const v=(this.getX()+u)/2,w=(this.getY()+a)/2,I=(this.estimatedModuleSize+g)/2;return new Si(v,w,I)}}class Hs{constructor(a,u,g,v,w,I,O){this.image=a,this.startX=u,this.startY=g,this.width=v,this.height=w,this.moduleSize=I,this.resultPointCallback=O,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const a=this.startX,u=this.height,g=this.width,v=a+g,w=this.startY+u/2,I=new Int32Array(3),O=this.image;for(let F=0;F<u;F++){const q=w+((F&1)===0?Math.floor((F+1)/2):-Math.floor((F+1)/2));I[0]=0,I[1]=0,I[2]=0;let te=a;for(;te<v&&!O.get(te,q);)te++;let ue=0;for(;te<v;){if(O.get(te,q))if(ue===1)I[1]++;else if(ue===2){if(this.foundPatternCross(I)){const xe=this.handlePossibleCenter(I,q,te);if(xe!==null)return xe}I[0]=I[2],I[1]=1,I[2]=0,ue=1}else I[++ue]++;else ue===1&&ue++,I[ue]++;te++}if(this.foundPatternCross(I)){const xe=this.handlePossibleCenter(I,q,v);if(xe!==null)return xe}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new ke}static centerFromEnd(a,u){return u-a[2]-a[1]/2}foundPatternCross(a){const u=this.moduleSize,g=u/2;for(let v=0;v<3;v++)if(Math.abs(u-a[v])>=g)return!1;return!0}crossCheckVertical(a,u,g,v){const w=this.image,I=w.getHeight(),O=this.crossCheckStateCount;O[0]=0,O[1]=0,O[2]=0;let F=a;for(;F>=0&&w.get(u,F)&&O[1]<=g;)O[1]++,F--;if(F<0||O[1]>g)return NaN;for(;F>=0&&!w.get(u,F)&&O[0]<=g;)O[0]++,F--;if(O[0]>g)return NaN;for(F=a+1;F<I&&w.get(u,F)&&O[1]<=g;)O[1]++,F++;if(F===I||O[1]>g)return NaN;for(;F<I&&!w.get(u,F)&&O[2]<=g;)O[2]++,F++;if(O[2]>g)return NaN;const q=O[0]+O[1]+O[2];return 5*Math.abs(q-v)>=2*v?NaN:this.foundPatternCross(O)?Hs.centerFromEnd(O,F):NaN}handlePossibleCenter(a,u,g){const v=a[0]+a[1]+a[2],w=Hs.centerFromEnd(a,g),I=this.crossCheckVertical(u,w,2*a[1],v);if(!isNaN(I)){const O=(a[0]+a[1]+a[2])/3;for(const q of this.possibleCenters)if(q.aboutEquals(O,I,w))return q.combineEstimate(I,w,O);const F=new Si(w,I,O);this.possibleCenters.push(F),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(F)}return null}}class zl extends on{constructor(a,u,g,v){super(a,u),this.estimatedModuleSize=g,this.count=v,v===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(a,u,g){if(Math.abs(u-this.getY())<=a&&Math.abs(g-this.getX())<=a){const v=Math.abs(a-this.estimatedModuleSize);return v<=1||v<=this.estimatedModuleSize}return!1}combineEstimate(a,u,g){const v=this.count+1,w=(this.count*this.getX()+u)/v,I=(this.count*this.getY()+a)/v,O=(this.count*this.estimatedModuleSize+g)/v;return new zl(w,I,O,v)}}class ol{constructor(a){this.bottomLeft=a[0],this.topLeft=a[1],this.topRight=a[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Yi{constructor(a,u){this.image=a,this.resultPointCallback=u,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=u}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(a){const u=a!=null&&a.get(Et.TRY_HARDER)!==void 0,g=a!=null&&a.get(Et.PURE_BARCODE)!==void 0,v=this.image,w=v.getHeight(),I=v.getWidth();let O=Math.floor(3*w/(4*Yi.MAX_MODULES));(O<Yi.MIN_SKIP||u)&&(O=Yi.MIN_SKIP);let F=!1;const q=new Int32Array(5);for(let ue=O-1;ue<w&&!F;ue+=O){q[0]=0,q[1]=0,q[2]=0,q[3]=0,q[4]=0;let xe=0;for(let Oe=0;Oe<I;Oe++)if(v.get(Oe,ue))(xe&1)===1&&xe++,q[xe]++;else if((xe&1)===0)if(xe===4)if(Yi.foundPatternCross(q)){if(this.handlePossibleCenter(q,ue,Oe,g)===!0)if(O=2,this.hasSkipped===!0)F=this.haveMultiplyConfirmedCenters();else{const ft=this.findRowSkip();ft>q[2]&&(ue+=ft-q[2]-O,Oe=I-1)}else{q[0]=q[2],q[1]=q[3],q[2]=q[4],q[3]=1,q[4]=0,xe=3;continue}xe=0,q[0]=0,q[1]=0,q[2]=0,q[3]=0,q[4]=0}else q[0]=q[2],q[1]=q[3],q[2]=q[4],q[3]=1,q[4]=0,xe=3;else q[++xe]++;else q[xe]++;Yi.foundPatternCross(q)&&this.handlePossibleCenter(q,ue,I,g)===!0&&(O=q[0],this.hasSkipped&&(F=this.haveMultiplyConfirmedCenters()))}const te=this.selectBestPatterns();return on.orderBestPatterns(te),new ol(te)}static centerFromEnd(a,u){return u-a[4]-a[3]-a[2]/2}static foundPatternCross(a){let u=0;for(let w=0;w<5;w++){const I=a[w];if(I===0)return!1;u+=I}if(u<7)return!1;const g=u/7,v=g/2;return Math.abs(g-a[0])<v&&Math.abs(g-a[1])<v&&Math.abs(3*g-a[2])<3*v&&Math.abs(g-a[3])<v&&Math.abs(g-a[4])<v}getCrossCheckStateCount(){const a=this.crossCheckStateCount;return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a}crossCheckDiagonal(a,u,g,v){const w=this.getCrossCheckStateCount();let I=0;const O=this.image;for(;a>=I&&u>=I&&O.get(u-I,a-I);)w[2]++,I++;if(a<I||u<I)return!1;for(;a>=I&&u>=I&&!O.get(u-I,a-I)&&w[1]<=g;)w[1]++,I++;if(a<I||u<I||w[1]>g)return!1;for(;a>=I&&u>=I&&O.get(u-I,a-I)&&w[0]<=g;)w[0]++,I++;if(w[0]>g)return!1;const F=O.getHeight(),q=O.getWidth();for(I=1;a+I<F&&u+I<q&&O.get(u+I,a+I);)w[2]++,I++;if(a+I>=F||u+I>=q)return!1;for(;a+I<F&&u+I<q&&!O.get(u+I,a+I)&&w[3]<g;)w[3]++,I++;if(a+I>=F||u+I>=q||w[3]>=g)return!1;for(;a+I<F&&u+I<q&&O.get(u+I,a+I)&&w[4]<g;)w[4]++,I++;if(w[4]>=g)return!1;const te=w[0]+w[1]+w[2]+w[3]+w[4];return Math.abs(te-v)<2*v&&Yi.foundPatternCross(w)}crossCheckVertical(a,u,g,v){const w=this.image,I=w.getHeight(),O=this.getCrossCheckStateCount();let F=a;for(;F>=0&&w.get(u,F);)O[2]++,F--;if(F<0)return NaN;for(;F>=0&&!w.get(u,F)&&O[1]<=g;)O[1]++,F--;if(F<0||O[1]>g)return NaN;for(;F>=0&&w.get(u,F)&&O[0]<=g;)O[0]++,F--;if(O[0]>g)return NaN;for(F=a+1;F<I&&w.get(u,F);)O[2]++,F++;if(F===I)return NaN;for(;F<I&&!w.get(u,F)&&O[3]<g;)O[3]++,F++;if(F===I||O[3]>=g)return NaN;for(;F<I&&w.get(u,F)&&O[4]<g;)O[4]++,F++;if(O[4]>=g)return NaN;const q=O[0]+O[1]+O[2]+O[3]+O[4];return 5*Math.abs(q-v)>=2*v?NaN:Yi.foundPatternCross(O)?Yi.centerFromEnd(O,F):NaN}crossCheckHorizontal(a,u,g,v){const w=this.image,I=w.getWidth(),O=this.getCrossCheckStateCount();let F=a;for(;F>=0&&w.get(F,u);)O[2]++,F--;if(F<0)return NaN;for(;F>=0&&!w.get(F,u)&&O[1]<=g;)O[1]++,F--;if(F<0||O[1]>g)return NaN;for(;F>=0&&w.get(F,u)&&O[0]<=g;)O[0]++,F--;if(O[0]>g)return NaN;for(F=a+1;F<I&&w.get(F,u);)O[2]++,F++;if(F===I)return NaN;for(;F<I&&!w.get(F,u)&&O[3]<g;)O[3]++,F++;if(F===I||O[3]>=g)return NaN;for(;F<I&&w.get(F,u)&&O[4]<g;)O[4]++,F++;if(O[4]>=g)return NaN;const q=O[0]+O[1]+O[2]+O[3]+O[4];return 5*Math.abs(q-v)>=v?NaN:Yi.foundPatternCross(O)?Yi.centerFromEnd(O,F):NaN}handlePossibleCenter(a,u,g,v){const w=a[0]+a[1]+a[2]+a[3]+a[4];let I=Yi.centerFromEnd(a,g),O=this.crossCheckVertical(u,Math.floor(I),a[2],w);if(!isNaN(O)&&(I=this.crossCheckHorizontal(Math.floor(I),Math.floor(O),a[2],w),!isNaN(I)&&(!v||this.crossCheckDiagonal(Math.floor(O),Math.floor(I),a[2],w)))){const F=w/7;let q=!1;const te=this.possibleCenters;for(let ue=0,xe=te.length;ue<xe;ue++){const Oe=te[ue];if(Oe.aboutEquals(F,O,I)){te[ue]=Oe.combineEstimate(O,I,F),q=!0;break}}if(!q){const ue=new zl(I,O,F);te.push(ue),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(ue)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let u=null;for(const g of this.possibleCenters)if(g.getCount()>=Yi.CENTER_QUORUM)if(u==null)u=g;else return this.hasSkipped=!0,Math.floor((Math.abs(u.getX()-g.getX())-Math.abs(u.getY()-g.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let a=0,u=0;const g=this.possibleCenters.length;for(const I of this.possibleCenters)I.getCount()>=Yi.CENTER_QUORUM&&(a++,u+=I.getEstimatedModuleSize());if(a<3)return!1;const v=u/g;let w=0;for(const I of this.possibleCenters)w+=Math.abs(I.getEstimatedModuleSize()-v);return w<=.05*u}selectBestPatterns(){const a=this.possibleCenters.length;if(a<3)throw new ke;const u=this.possibleCenters;let g;if(a>3){let v=0,w=0;for(const F of this.possibleCenters){const q=F.getEstimatedModuleSize();v+=q,w+=q*q}g=v/a;let I=Math.sqrt(w/a-g*g);u.sort((F,q)=>{const te=Math.abs(q.getEstimatedModuleSize()-g),ue=Math.abs(F.getEstimatedModuleSize()-g);return te<ue?-1:te>ue?1:0});const O=Math.max(.2*g,I);for(let F=0;F<u.length&&u.length>3;F++){const q=u[F];Math.abs(q.getEstimatedModuleSize()-g)>O&&(u.splice(F,1),F--)}}if(u.length>3){let v=0;for(const w of u)v+=w.getEstimatedModuleSize();g=v/u.length,u.sort((w,I)=>{if(I.getCount()===w.getCount()){const O=Math.abs(I.getEstimatedModuleSize()-g),F=Math.abs(w.getEstimatedModuleSize()-g);return O<F?1:O>F?-1:0}else return I.getCount()-w.getCount()}),u.splice(3)}return[u[0],u[1],u[2]]}}Yi.CENTER_QUORUM=2,Yi.MIN_SKIP=3,Yi.MAX_MODULES=57;class Br{constructor(a){this.image=a}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(a){this.resultPointCallback=a==null?null:a.get(Et.NEED_RESULT_POINT_CALLBACK);const g=new Yi(this.image,this.resultPointCallback).find(a);return this.processFinderPatternInfo(g)}processFinderPatternInfo(a){const u=a.getTopLeft(),g=a.getTopRight(),v=a.getBottomLeft(),w=this.calculateModuleSize(u,g,v);if(w<1)throw new ke("No pattern found in proccess finder.");const I=Br.computeDimension(u,g,v,w),O=ti.getProvisionalVersionForDimension(I),F=O.getDimensionForVersion()-7;let q=null;if(O.getAlignmentPatternCenters().length>0){const Oe=g.getX()-u.getX()+v.getX(),ot=g.getY()-u.getY()+v.getY(),ft=1-3/F,Rt=Math.floor(u.getX()+ft*(Oe-u.getX())),Ht=Math.floor(u.getY()+ft*(ot-u.getY()));for(let An=4;An<=16;An<<=1)try{q=this.findAlignmentInRegion(w,Rt,Ht,An);break}catch(wn){if(!(wn instanceof ke))throw wn}}const te=Br.createTransform(u,g,v,q,I),ue=Br.sampleGrid(this.image,te,I);let xe;return q===null?xe=[v,u,g]:xe=[v,u,g,q],new Li(ue,xe)}static createTransform(a,u,g,v,w){const I=w-3.5;let O,F,q,te;return v!==null?(O=v.getX(),F=v.getY(),q=I-3,te=q):(O=u.getX()-a.getX()+g.getX(),F=u.getY()-a.getY()+g.getY(),q=I,te=I),yt.quadrilateralToQuadrilateral(3.5,3.5,I,3.5,q,te,3.5,I,a.getX(),a.getY(),u.getX(),u.getY(),O,F,g.getX(),g.getY())}static sampleGrid(a,u,g){return le.getInstance().sampleGridWithTransform(a,g,g,u)}static computeDimension(a,u,g,v){const w=Rn.round(on.distance(a,u)/v),I=Rn.round(on.distance(a,g)/v);let O=Math.floor((w+I)/2)+7;switch(O&3){case 0:O++;break;case 2:O--;break;case 3:throw new ke("Dimensions could be not found.")}return O}calculateModuleSize(a,u,g){return(this.calculateModuleSizeOneWay(a,u)+this.calculateModuleSizeOneWay(a,g))/2}calculateModuleSizeOneWay(a,u){const g=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(a.getX()),Math.floor(a.getY()),Math.floor(u.getX()),Math.floor(u.getY())),v=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(u.getX()),Math.floor(u.getY()),Math.floor(a.getX()),Math.floor(a.getY()));return isNaN(g)?v/7:isNaN(v)?g/7:(g+v)/14}sizeOfBlackWhiteBlackRunBothWays(a,u,g,v){let w=this.sizeOfBlackWhiteBlackRun(a,u,g,v),I=1,O=a-(g-a);O<0?(I=a/(a-O),O=0):O>=this.image.getWidth()&&(I=(this.image.getWidth()-1-a)/(O-a),O=this.image.getWidth()-1);let F=Math.floor(u-(v-u)*I);return I=1,F<0?(I=u/(u-F),F=0):F>=this.image.getHeight()&&(I=(this.image.getHeight()-1-u)/(F-u),F=this.image.getHeight()-1),O=Math.floor(a+(O-a)*I),w+=this.sizeOfBlackWhiteBlackRun(a,u,O,F),w-1}sizeOfBlackWhiteBlackRun(a,u,g,v){const w=Math.abs(v-u)>Math.abs(g-a);if(w){let Oe=a;a=u,u=Oe,Oe=g,g=v,v=Oe}const I=Math.abs(g-a),O=Math.abs(v-u);let F=-I/2;const q=a<g?1:-1,te=u<v?1:-1;let ue=0;const xe=g+q;for(let Oe=a,ot=u;Oe!==xe;Oe+=q){const ft=w?ot:Oe,Rt=w?Oe:ot;if(ue===1===this.image.get(ft,Rt)){if(ue===2)return Rn.distance(Oe,ot,a,u);ue++}if(F+=O,F>0){if(ot===v)break;ot+=te,F-=I}}return ue===2?Rn.distance(g+q,v,a,u):NaN}findAlignmentInRegion(a,u,g,v){const w=Math.floor(v*a),I=Math.max(0,u-w),O=Math.min(this.image.getWidth()-1,u+w);if(O-I<a*3)throw new ke("Alignment top exceeds estimated module size.");const F=Math.max(0,g-w),q=Math.min(this.image.getHeight()-1,g+w);if(q-F<a*3)throw new ke("Alignment bottom exceeds estimated module size.");return new Hs(this.image,I,F,O-I,q-F,a,this.resultPointCallback).find()}}class nr{constructor(){this.decoder=new al}getDecoder(){return this.decoder}decode(a,u){let g,v;if(u!=null&&u.get(Et.PURE_BARCODE)!==void 0){const F=nr.extractPureBits(a.getBlackMatrix());g=this.decoder.decodeBitMatrix(F,u),v=nr.NO_POINTS}else{const F=new Br(a.getBlackMatrix()).detect(u);g=this.decoder.decodeBitMatrix(F.getBits(),u),v=F.getPoints()}g.getOther()instanceof wo&&g.getOther().applyMirroredCorrection(v);const w=new bt(g.getText(),g.getRawBytes(),void 0,v,Bt.QR_CODE,void 0),I=g.getByteSegments();I!==null&&w.putMetadata(un.BYTE_SEGMENTS,I);const O=g.getECLevel();return O!==null&&w.putMetadata(un.ERROR_CORRECTION_LEVEL,O),g.hasStructuredAppend()&&(w.putMetadata(un.STRUCTURED_APPEND_SEQUENCE,g.getStructuredAppendSequenceNumber()),w.putMetadata(un.STRUCTURED_APPEND_PARITY,g.getStructuredAppendParity())),w}reset(){}static extractPureBits(a){const u=a.getTopLeftOnBit(),g=a.getBottomRightOnBit();if(u===null||g===null)throw new ke;const v=this.moduleSize(u,a);let w=u[1],I=g[1],O=u[0],F=g[0];if(O>=F||w>=I)throw new ke;if(I-w!==F-O&&(F=O+(I-w),F>=a.getWidth()))throw new ke;const q=Math.round((F-O+1)/v),te=Math.round((I-w+1)/v);if(q<=0||te<=0)throw new ke;if(te!==q)throw new ke;const ue=Math.floor(v/2);w+=ue,O+=ue;const xe=O+Math.floor((q-1)*v)-F;if(xe>0){if(xe>ue)throw new ke;O-=xe}const Oe=w+Math.floor((te-1)*v)-I;if(Oe>0){if(Oe>ue)throw new ke;w-=Oe}const ot=new qt(q,te);for(let ft=0;ft<te;ft++){const Rt=w+Math.floor(ft*v);for(let Ht=0;Ht<q;Ht++)a.get(O+Math.floor(Ht*v),Rt)&&ot.set(Ht,ft)}return ot}static moduleSize(a,u){const g=u.getHeight(),v=u.getWidth();let w=a[0],I=a[1],O=!0,F=0;for(;w<v&&I<g;){if(O!==u.get(w,I)){if(++F===5)break;O=!O}w++,I++}if(w===v||I===g)throw new ke;return(w-a[0])/7}}nr.NO_POINTS=new Array;class gn{PDF417Common(){}static getBitCountSum(a){return Rn.sum(a)}static toIntArray(a){if(a==null||!a.length)return gn.EMPTY_INT_ARRAY;const u=new Int32Array(a.length);let g=0;for(const v of a)u[g++]=v;return u}static getCodeword(a){const u=Je.binarySearch(gn.SYMBOL_TABLE,a&262143);return u<0?-1:(gn.CODEWORD_TABLE[u]-1)%gn.NUMBER_OF_CODEWORDS}}gn.NUMBER_OF_CODEWORDS=929,gn.MAX_CODEWORDS_IN_BARCODE=gn.NUMBER_OF_CODEWORDS-1,gn.MIN_ROWS_IN_BARCODE=3,gn.MAX_ROWS_IN_BARCODE=90,gn.MODULES_IN_CODEWORD=17,gn.MODULES_IN_STOP_PATTERN=18,gn.BARS_IN_MODULE=8,gn.EMPTY_INT_ARRAY=new Int32Array([]),gn.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),gn.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class _r{constructor(a,u){this.bits=a,this.points=u}getBits(){return this.bits}getPoints(){return this.points}}class Ai{static detectMultiple(a,u,g){let v=a.getBlackMatrix(),w=Ai.detect(g,v);return w.length||(v=v.clone(),v.rotate180(),w=Ai.detect(g,v)),new _r(v,w)}static detect(a,u){const g=new Array;let v=0,w=0,I=!1;for(;v<u.getHeight();){const O=Ai.findVertices(u,v,w);if(O[0]==null&&O[3]==null){if(!I)break;I=!1,w=0;for(const F of g)F[1]!=null&&(v=Math.trunc(Math.max(v,F[1].getY()))),F[3]!=null&&(v=Math.max(v,Math.trunc(F[3].getY())));v+=Ai.ROW_STEP;continue}if(I=!0,g.push(O),!a)break;O[2]!=null?(w=Math.trunc(O[2].getX()),v=Math.trunc(O[2].getY())):(w=Math.trunc(O[4].getX()),v=Math.trunc(O[4].getY()))}return g}static findVertices(a,u,g){const v=a.getHeight(),w=a.getWidth(),I=new Array(8);return Ai.copyToResult(I,Ai.findRowsWithPattern(a,v,w,u,g,Ai.START_PATTERN),Ai.INDEXES_START_PATTERN),I[4]!=null&&(g=Math.trunc(I[4].getX()),u=Math.trunc(I[4].getY())),Ai.copyToResult(I,Ai.findRowsWithPattern(a,v,w,u,g,Ai.STOP_PATTERN),Ai.INDEXES_STOP_PATTERN),I}static copyToResult(a,u,g){for(let v=0;v<g.length;v++)a[g[v]]=u[v]}static findRowsWithPattern(a,u,g,v,w,I){const O=new Array(4);let F=!1;const q=new Int32Array(I.length);for(;v<u;v+=Ai.ROW_STEP){let ue=Ai.findGuardPattern(a,w,v,g,!1,I,q);if(ue!=null){for(;v>0;){const xe=Ai.findGuardPattern(a,w,--v,g,!1,I,q);if(xe!=null)ue=xe;else{v++;break}}O[0]=new on(ue[0],v),O[1]=new on(ue[1],v),F=!0;break}}let te=v+1;if(F){let ue=0,xe=Int32Array.from([Math.trunc(O[0].getX()),Math.trunc(O[1].getX())]);for(;te<u;te++){const Oe=Ai.findGuardPattern(a,xe[0],te,g,!1,I,q);if(Oe!=null&&Math.abs(xe[0]-Oe[0])<Ai.MAX_PATTERN_DRIFT&&Math.abs(xe[1]-Oe[1])<Ai.MAX_PATTERN_DRIFT)xe=Oe,ue=0;else{if(ue>Ai.SKIPPED_ROW_COUNT_MAX)break;ue++}}te-=ue+1,O[2]=new on(xe[0],te),O[3]=new on(xe[1],te)}return te-v<Ai.BARCODE_MIN_HEIGHT&&Je.fill(O,null),O}static findGuardPattern(a,u,g,v,w,I,O){Je.fillWithin(O,0,O.length,0);let F=u,q=0;for(;a.get(F,g)&&F>0&&q++<Ai.MAX_PIXEL_DRIFT;)F--;let te=F,ue=0,xe=I.length;for(let Oe=w;te<v;te++)if(a.get(te,g)!==Oe)O[ue]++;else{if(ue===xe-1){if(Ai.patternMatchVariance(O,I,Ai.MAX_INDIVIDUAL_VARIANCE)<Ai.MAX_AVG_VARIANCE)return new Int32Array([F,te]);F+=O[0]+O[1],pe.arraycopy(O,2,O,0,ue-1),O[ue-1]=0,O[ue]=0,ue--}else ue++;O[ue]=1,Oe=!Oe}return ue===xe-1&&Ai.patternMatchVariance(O,I,Ai.MAX_INDIVIDUAL_VARIANCE)<Ai.MAX_AVG_VARIANCE?new Int32Array([F,te-1]):null}static patternMatchVariance(a,u,g){let v=a.length,w=0,I=0;for(let q=0;q<v;q++)w+=a[q],I+=u[q];if(w<I)return 1/0;let O=w/I;g*=O;let F=0;for(let q=0;q<v;q++){let te=a[q],ue=u[q]*O,xe=te>ue?te-ue:ue-te;if(xe>g)return 1/0;F+=xe}return F/w}}Ai.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Ai.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Ai.MAX_AVG_VARIANCE=.42,Ai.MAX_INDIVIDUAL_VARIANCE=.8,Ai.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Ai.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Ai.MAX_PIXEL_DRIFT=3,Ai.MAX_PATTERN_DRIFT=5,Ai.SKIPPED_ROW_COUNT_MAX=25,Ai.ROW_STEP=5,Ai.BARCODE_MIN_HEIGHT=10;class Ui{constructor(a,u){if(u.length===0)throw new K;this.field=a;let g=u.length;if(g>1&&u[0]===0){let v=1;for(;v<g&&u[v]===0;)v++;v===g?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(g-v),pe.arraycopy(u,v,this.coefficients,0,this.coefficients.length))}else this.coefficients=u}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(a){return this.coefficients[this.coefficients.length-1-a]}evaluateAt(a){if(a===0)return this.getCoefficient(0);if(a===1){let v=0;for(let w of this.coefficients)v=this.field.add(v,w);return v}let u=this.coefficients[0],g=this.coefficients.length;for(let v=1;v<g;v++)u=this.field.add(this.field.multiply(a,u),this.coefficients[v]);return u}add(a){if(!this.field.equals(a.field))throw new K("ModulusPolys do not have same ModulusGF field");if(this.isZero())return a;if(a.isZero())return this;let u=this.coefficients,g=a.coefficients;if(u.length>g.length){let I=u;u=g,g=I}let v=new Int32Array(g.length),w=g.length-u.length;pe.arraycopy(g,0,v,0,w);for(let I=w;I<g.length;I++)v[I]=this.field.add(u[I-w],g[I]);return new Ui(this.field,v)}subtract(a){if(!this.field.equals(a.field))throw new K("ModulusPolys do not have same ModulusGF field");return a.isZero()?this:this.add(a.negative())}multiply(a){return a instanceof Ui?this.multiplyOther(a):this.multiplyScalar(a)}multiplyOther(a){if(!this.field.equals(a.field))throw new K("ModulusPolys do not have same ModulusGF field");if(this.isZero()||a.isZero())return new Ui(this.field,new Int32Array([0]));let u=this.coefficients,g=u.length,v=a.coefficients,w=v.length,I=new Int32Array(g+w-1);for(let O=0;O<g;O++){let F=u[O];for(let q=0;q<w;q++)I[O+q]=this.field.add(I[O+q],this.field.multiply(F,v[q]))}return new Ui(this.field,I)}negative(){let a=this.coefficients.length,u=new Int32Array(a);for(let g=0;g<a;g++)u[g]=this.field.subtract(0,this.coefficients[g]);return new Ui(this.field,u)}multiplyScalar(a){if(a===0)return new Ui(this.field,new Int32Array([0]));if(a===1)return this;let u=this.coefficients.length,g=new Int32Array(u);for(let v=0;v<u;v++)g[v]=this.field.multiply(this.coefficients[v],a);return new Ui(this.field,g)}multiplyByMonomial(a,u){if(a<0)throw new K;if(u===0)return new Ui(this.field,new Int32Array([0]));let g=this.coefficients.length,v=new Int32Array(g+a);for(let w=0;w<g;w++)v[w]=this.field.multiply(this.coefficients[w],u);return new Ui(this.field,v)}toString(){let a=new vt;for(let u=this.getDegree();u>=0;u--){let g=this.getCoefficient(u);g!==0&&(g<0?(a.append(" - "),g=-g):a.length()>0&&a.append(" + "),(u===0||g!==1)&&a.append(g),u!==0&&(u===1?a.append("x"):(a.append("x^"),a.append(u))))}return a.toString()}}class qs{add(a,u){return(a+u)%this.modulus}subtract(a,u){return(this.modulus+a-u)%this.modulus}exp(a){return this.expTable[a]}log(a){if(a===0)throw new K;return this.logTable[a]}inverse(a){if(a===0)throw new ii;return this.expTable[this.modulus-this.logTable[a]-1]}multiply(a,u){return a===0||u===0?0:this.expTable[(this.logTable[a]+this.logTable[u])%(this.modulus-1)]}getSize(){return this.modulus}equals(a){return a===this}}class Yr extends qs{constructor(a,u){super(),this.modulus=a,this.expTable=new Int32Array(a),this.logTable=new Int32Array(a);let g=1;for(let v=0;v<a;v++)this.expTable[v]=g,g=g*u%a;for(let v=0;v<a-1;v++)this.logTable[this.expTable[v]]=v;this.zero=new Ui(this,new Int32Array([0])),this.one=new Ui(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(a,u){if(a<0)throw new K;if(u===0)return this.zero;let g=new Int32Array(a+1);return g[0]=u,new Ui(this,g)}}Yr.PDF417_GF=new Yr(gn.NUMBER_OF_CODEWORDS,3);class Zs{constructor(){this.field=Yr.PDF417_GF}decode(a,u,g){let v=new Ui(this.field,a),w=new Int32Array(u),I=!1;for(let ot=u;ot>0;ot--){let ft=v.evaluateAt(this.field.exp(ot));w[u-ot]=ft,ft!==0&&(I=!0)}if(!I)return 0;let O=this.field.getOne();if(g!=null)for(const ot of g){let ft=this.field.exp(a.length-1-ot),Rt=new Ui(this.field,new Int32Array([this.field.subtract(0,ft),1]));O=O.multiply(Rt)}let F=new Ui(this.field,w),q=this.runEuclideanAlgorithm(this.field.buildMonomial(u,1),F,u),te=q[0],ue=q[1],xe=this.findErrorLocations(te),Oe=this.findErrorMagnitudes(ue,te,xe);for(let ot=0;ot<xe.length;ot++){let ft=a.length-1-this.field.log(xe[ot]);if(ft<0)throw we.getChecksumInstance();a[ft]=this.field.subtract(a[ft],Oe[ot])}return xe.length}runEuclideanAlgorithm(a,u,g){if(a.getDegree()<u.getDegree()){let xe=a;a=u,u=xe}let v=a,w=u,I=this.field.getZero(),O=this.field.getOne();for(;w.getDegree()>=Math.round(g/2);){let xe=v,Oe=I;if(v=w,I=O,v.isZero())throw we.getChecksumInstance();w=xe;let ot=this.field.getZero(),ft=v.getCoefficient(v.getDegree()),Rt=this.field.inverse(ft);for(;w.getDegree()>=v.getDegree()&&!w.isZero();){let Ht=w.getDegree()-v.getDegree(),An=this.field.multiply(w.getCoefficient(w.getDegree()),Rt);ot=ot.add(this.field.buildMonomial(Ht,An)),w=w.subtract(v.multiplyByMonomial(Ht,An))}O=ot.multiply(I).subtract(Oe).negative()}let F=O.getCoefficient(0);if(F===0)throw we.getChecksumInstance();let q=this.field.inverse(F),te=O.multiply(q),ue=w.multiply(q);return[te,ue]}findErrorLocations(a){let u=a.getDegree(),g=new Int32Array(u),v=0;for(let w=1;w<this.field.getSize()&&v<u;w++)a.evaluateAt(w)===0&&(g[v]=this.field.inverse(w),v++);if(v!==u)throw we.getChecksumInstance();return g}findErrorMagnitudes(a,u,g){let v=u.getDegree(),w=new Int32Array(v);for(let q=1;q<=v;q++)w[v-q]=this.field.multiply(q,u.getCoefficient(q));let I=new Ui(this.field,w),O=g.length,F=new Int32Array(O);for(let q=0;q<O;q++){let te=this.field.inverse(g[q]),ue=this.field.subtract(0,a.evaluateAt(te)),xe=this.field.inverse(I.evaluateAt(te));F[q]=this.field.multiply(ue,xe)}return F}}class Bs{constructor(a,u,g,v,w){a instanceof Bs?this.constructor_2(a):this.constructor_1(a,u,g,v,w)}constructor_1(a,u,g,v,w){const I=u==null||g==null,O=v==null||w==null;if(I&&O)throw new ke;I?(u=new on(0,v.getY()),g=new on(0,w.getY())):O&&(v=new on(a.getWidth()-1,u.getY()),w=new on(a.getWidth()-1,g.getY())),this.image=a,this.topLeft=u,this.bottomLeft=g,this.topRight=v,this.bottomRight=w,this.minX=Math.trunc(Math.min(u.getX(),g.getX())),this.maxX=Math.trunc(Math.max(v.getX(),w.getX())),this.minY=Math.trunc(Math.min(u.getY(),v.getY())),this.maxY=Math.trunc(Math.max(g.getY(),w.getY()))}constructor_2(a){this.image=a.image,this.topLeft=a.getTopLeft(),this.bottomLeft=a.getBottomLeft(),this.topRight=a.getTopRight(),this.bottomRight=a.getBottomRight(),this.minX=a.getMinX(),this.maxX=a.getMaxX(),this.minY=a.getMinY(),this.maxY=a.getMaxY()}static merge(a,u){return a==null?u:u==null?a:new Bs(a.image,a.topLeft,a.bottomLeft,u.topRight,u.bottomRight)}addMissingRows(a,u,g){let v=this.topLeft,w=this.bottomLeft,I=this.topRight,O=this.bottomRight;if(a>0){let F=g?this.topLeft:this.topRight,q=Math.trunc(F.getY()-a);q<0&&(q=0);let te=new on(F.getX(),q);g?v=te:I=te}if(u>0){let F=g?this.bottomLeft:this.bottomRight,q=Math.trunc(F.getY()+u);q>=this.image.getHeight()&&(q=this.image.getHeight()-1);let te=new on(F.getX(),q);g?w=te:O=te}return new Bs(this.image,v,w,I,O)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Dr{constructor(a,u,g,v){this.columnCount=a,this.errorCorrectionLevel=v,this.rowCountUpperPart=u,this.rowCountLowerPart=g,this.rowCount=u+g}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class fa{constructor(){this.buffer=""}static form(a,u){let g=-1;function v(I,O,F,q,te,ue){if(I==="%%")return"%";if(u[++g]===void 0)return;I=q?parseInt(q.substr(1)):void 0;let xe=te?parseInt(te.substr(1)):void 0,Oe;switch(ue){case"s":Oe=u[g];break;case"c":Oe=u[g][0];break;case"f":Oe=parseFloat(u[g]).toFixed(I);break;case"p":Oe=parseFloat(u[g]).toPrecision(I);break;case"e":Oe=parseFloat(u[g]).toExponential(I);break;case"x":Oe=parseInt(u[g]).toString(xe||16);break;case"d":Oe=parseFloat(parseInt(u[g],xe||10).toPrecision(I)).toFixed(0);break}Oe=typeof Oe=="object"?JSON.stringify(Oe):(+Oe).toString(xe);let ot=parseInt(F),ft=F&&F[0]+""=="0"?"0":" ";for(;Oe.length<ot;)Oe=O!==void 0?Oe+ft:ft+Oe;return Oe}let w=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return a.replace(w,v)}format(a,...u){this.buffer+=fa.form(a,u)}toString(){return this.buffer}}class ps{constructor(a){this.boundingBox=new Bs(a),this.codewords=new Array(a.getMaxY()-a.getMinY()+1)}getCodewordNearby(a){let u=this.getCodeword(a);if(u!=null)return u;for(let g=1;g<ps.MAX_NEARBY_DISTANCE;g++){let v=this.imageRowToCodewordIndex(a)-g;if(v>=0&&(u=this.codewords[v],u!=null)||(v=this.imageRowToCodewordIndex(a)+g,v<this.codewords.length&&(u=this.codewords[v],u!=null)))return u}return null}imageRowToCodewordIndex(a){return a-this.boundingBox.getMinY()}setCodeword(a,u){this.codewords[this.imageRowToCodewordIndex(a)]=u}getCodeword(a){return this.codewords[this.imageRowToCodewordIndex(a)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const a=new fa;let u=0;for(const g of this.codewords){if(g==null){a.format("%3d:    |   %n",u++);continue}a.format("%3d: %3d|%3d%n",u++,g.getRowNumber(),g.getValue())}return a.toString()}}ps.MAX_NEARBY_DISTANCE=5;class va{constructor(){this.values=new Map}setValue(a){a=Math.trunc(a);let u=this.values.get(a);u==null&&(u=0),u++,this.values.set(a,u)}getValue(){let a=-1,u=new Array;for(const[g,v]of this.values.entries()){const w={getKey:()=>g,getValue:()=>v};w.getValue()>a?(a=w.getValue(),u=[],u.push(w.getKey())):w.getValue()===a&&u.push(w.getKey())}return gn.toIntArray(u)}getConfidence(a){return this.values.get(a)}}class Ms extends ps{constructor(a,u){super(a),this._isLeft=u}setRowNumbers(){for(let a of this.getCodewords())a?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(a){let u=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(u,a);let g=this.getBoundingBox(),v=this._isLeft?g.getTopLeft():g.getTopRight(),w=this._isLeft?g.getBottomLeft():g.getBottomRight(),I=this.imageRowToCodewordIndex(Math.trunc(v.getY())),O=this.imageRowToCodewordIndex(Math.trunc(w.getY())),F=-1,q=1,te=0;for(let ue=I;ue<O;ue++){if(u[ue]==null)continue;let xe=u[ue],Oe=xe.getRowNumber()-F;if(Oe===0)te++;else if(Oe===1)q=Math.max(q,te),te=1,F=xe.getRowNumber();else if(Oe<0||xe.getRowNumber()>=a.getRowCount()||Oe>ue)u[ue]=null;else{let ot;q>2?ot=(q-2)*Oe:ot=Oe;let ft=ot>=ue;for(let Rt=1;Rt<=ot&&!ft;Rt++)ft=u[ue-Rt]!=null;ft?u[ue]=null:(F=xe.getRowNumber(),te=1)}}}getRowHeights(){let a=this.getBarcodeMetadata();if(a==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(a);let u=new Int32Array(a.getRowCount());for(let g of this.getCodewords())if(g!=null){let v=g.getRowNumber();if(v>=u.length)continue;u[v]++}return u}adjustIncompleteIndicatorColumnRowNumbers(a){let u=this.getBoundingBox(),g=this._isLeft?u.getTopLeft():u.getTopRight(),v=this._isLeft?u.getBottomLeft():u.getBottomRight(),w=this.imageRowToCodewordIndex(Math.trunc(g.getY())),I=this.imageRowToCodewordIndex(Math.trunc(v.getY())),O=this.getCodewords(),F=-1;for(let q=w;q<I;q++){if(O[q]==null)continue;let te=O[q];te.setRowNumberAsRowIndicatorColumn();let ue=te.getRowNumber()-F;ue===0||(ue===1?F=te.getRowNumber():te.getRowNumber()>=a.getRowCount()?O[q]=null:F=te.getRowNumber())}}getBarcodeMetadata(){let a=this.getCodewords(),u=new va,g=new va,v=new va,w=new va;for(let O of a){if(O==null)continue;O.setRowNumberAsRowIndicatorColumn();let F=O.getValue()%30,q=O.getRowNumber();switch(this._isLeft||(q+=2),q%3){case 0:g.setValue(F*3+1);break;case 1:w.setValue(F/3),v.setValue(F%3);break;case 2:u.setValue(F+1);break}}if(u.getValue().length===0||g.getValue().length===0||v.getValue().length===0||w.getValue().length===0||u.getValue()[0]<1||g.getValue()[0]+v.getValue()[0]<gn.MIN_ROWS_IN_BARCODE||g.getValue()[0]+v.getValue()[0]>gn.MAX_ROWS_IN_BARCODE)return null;let I=new Dr(u.getValue()[0],g.getValue()[0],v.getValue()[0],w.getValue()[0]);return this.removeIncorrectCodewords(a,I),I}removeIncorrectCodewords(a,u){for(let g=0;g<a.length;g++){let v=a[g];if(a[g]==null)continue;let w=v.getValue()%30,I=v.getRowNumber();if(I>u.getRowCount()){a[g]=null;continue}switch(this._isLeft||(I+=2),I%3){case 0:w*3+1!==u.getRowCountUpperPart()&&(a[g]=null);break;case 1:(Math.trunc(w/3)!==u.getErrorCorrectionLevel()||w%3!==u.getRowCountLowerPart())&&(a[g]=null);break;case 2:w+1!==u.getColumnCount()&&(a[g]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Rr{constructor(a,u){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=a,this.barcodeColumnCount=a.getColumnCount(),this.boundingBox=u,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let a=gn.MAX_CODEWORDS_IN_BARCODE,u;do u=a,a=this.adjustRowNumbersAndGetCount();while(a>0&&a<u);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(a){a?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let a=this.adjustRowNumbersByRow();if(a===0)return 0;for(let u=1;u<this.barcodeColumnCount+1;u++){let g=this.detectionResultColumns[u].getCodewords();for(let v=0;v<g.length;v++)g[v]!=null&&(g[v].hasValidRowNumber()||this.adjustRowNumbers(u,v,g))}return a}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let a=this.detectionResultColumns[0].getCodewords(),u=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let g=0;g<a.length;g++)if(a[g]!=null&&u[g]!=null&&a[g].getRowNumber()===u[g].getRowNumber())for(let v=1;v<=this.barcodeColumnCount;v++){let w=this.detectionResultColumns[v].getCodewords()[g];w!=null&&(w.setRowNumber(a[g].getRowNumber()),w.hasValidRowNumber()||(this.detectionResultColumns[v].getCodewords()[g]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let a=0,u=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let g=0;g<u.length;g++){if(u[g]==null)continue;let v=u[g].getRowNumber(),w=0;for(let I=this.barcodeColumnCount+1;I>0&&w<this.ADJUST_ROW_NUMBER_SKIP;I--){let O=this.detectionResultColumns[I].getCodewords()[g];O!=null&&(w=Rr.adjustRowNumberIfValid(v,w,O),O.hasValidRowNumber()||a++)}}return a}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let a=0,u=this.detectionResultColumns[0].getCodewords();for(let g=0;g<u.length;g++){if(u[g]==null)continue;let v=u[g].getRowNumber(),w=0;for(let I=1;I<this.barcodeColumnCount+1&&w<this.ADJUST_ROW_NUMBER_SKIP;I++){let O=this.detectionResultColumns[I].getCodewords()[g];O!=null&&(w=Rr.adjustRowNumberIfValid(v,w,O),O.hasValidRowNumber()||a++)}}return a}static adjustRowNumberIfValid(a,u,g){return g==null||g.hasValidRowNumber()||(g.isValidRowNumber(a)?(g.setRowNumber(a),u=0):++u),u}adjustRowNumbers(a,u,g){if(!this.detectionResultColumns[a-1])return;let v=g[u],w=this.detectionResultColumns[a-1].getCodewords(),I=w;this.detectionResultColumns[a+1]!=null&&(I=this.detectionResultColumns[a+1].getCodewords());let O=new Array(14);O[2]=w[u],O[3]=I[u],u>0&&(O[0]=g[u-1],O[4]=w[u-1],O[5]=I[u-1]),u>1&&(O[8]=g[u-2],O[10]=w[u-2],O[11]=I[u-2]),u<g.length-1&&(O[1]=g[u+1],O[6]=w[u+1],O[7]=I[u+1]),u<g.length-2&&(O[9]=g[u+2],O[12]=w[u+2],O[13]=I[u+2]);for(let F of O)if(Rr.adjustRowNumber(v,F))return}static adjustRowNumber(a,u){return u==null?!1:u.hasValidRowNumber()&&u.getBucket()===a.getBucket()?(a.setRowNumber(u.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(a){this.boundingBox=a}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(a,u){this.detectionResultColumns[a]=u}getDetectionResultColumn(a){return this.detectionResultColumns[a]}toString(){let a=this.detectionResultColumns[0];a==null&&(a=this.detectionResultColumns[this.barcodeColumnCount+1]);let u=new fa;for(let g=0;g<a.getCodewords().length;g++){u.format("CW %3d:",g);for(let v=0;v<this.barcodeColumnCount+2;v++){if(this.detectionResultColumns[v]==null){u.format("    |   ");continue}let w=this.detectionResultColumns[v].getCodewords()[g];if(w==null){u.format("    |   ");continue}u.format(" %3d|%3d",w.getRowNumber(),w.getValue())}u.format("%n")}return u.toString()}}class ns{constructor(a,u,g,v){this.rowNumber=ns.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(a),this.endX=Math.trunc(u),this.bucket=Math.trunc(g),this.value=Math.trunc(v)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(a){return a!==ns.BARCODE_ROW_UNKNOWN&&this.bucket===a%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(a){this.rowNumber=a}toString(){return this.rowNumber+"|"+this.value}}ns.BARCODE_ROW_UNKNOWN=-1;class rr{static initialize(){for(let a=0;a<gn.SYMBOL_TABLE.length;a++){let u=gn.SYMBOL_TABLE[a],g=u&1;for(let v=0;v<gn.BARS_IN_MODULE;v++){let w=0;for(;(u&1)===g;)w+=1,u>>=1;g=u&1,rr.RATIOS_TABLE[a]||(rr.RATIOS_TABLE[a]=new Array(gn.BARS_IN_MODULE)),rr.RATIOS_TABLE[a][gn.BARS_IN_MODULE-v-1]=Math.fround(w/gn.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(a){let u=rr.getDecodedCodewordValue(rr.sampleBitCounts(a));return u!==-1?u:rr.getClosestDecodedValue(a)}static sampleBitCounts(a){let u=Rn.sum(a),g=new Int32Array(gn.BARS_IN_MODULE),v=0,w=0;for(let I=0;I<gn.MODULES_IN_CODEWORD;I++){let O=u/(2*gn.MODULES_IN_CODEWORD)+I*u/gn.MODULES_IN_CODEWORD;w+a[v]<=O&&(w+=a[v],v++),g[v]++}return g}static getDecodedCodewordValue(a){let u=rr.getBitValue(a);return gn.getCodeword(u)===-1?-1:u}static getBitValue(a){let u=0;for(let g=0;g<a.length;g++)for(let v=0;v<a[g];v++)u=u<<1|(g%2===0?1:0);return Math.trunc(u)}static getClosestDecodedValue(a){let u=Rn.sum(a),g=new Array(gn.BARS_IN_MODULE);if(u>1)for(let I=0;I<g.length;I++)g[I]=Math.fround(a[I]/u);let v=Ei.MAX_VALUE,w=-1;this.bSymbolTableReady||rr.initialize();for(let I=0;I<rr.RATIOS_TABLE.length;I++){let O=0,F=rr.RATIOS_TABLE[I];for(let q=0;q<gn.BARS_IN_MODULE;q++){let te=Math.fround(F[q]-g[q]);if(O+=Math.fround(te*te),O>=v)break}O<v&&(v=O,w=gn.SYMBOL_TABLE[I])}return w}}rr.bSymbolTableReady=!1,rr.RATIOS_TABLE=new Array(gn.SYMBOL_TABLE.length).map(ce=>new Array(gn.BARS_IN_MODULE));class Ao{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(a){this.segmentIndex=a}getFileId(){return this.fileId}setFileId(a){this.fileId=a}getOptionalData(){return this.optionalData}setOptionalData(a){this.optionalData=a}isLastSegment(){return this.lastSegment}setLastSegment(a){this.lastSegment=a}getSegmentCount(){return this.segmentCount}setSegmentCount(a){this.segmentCount=a}getSender(){return this.sender||null}setSender(a){this.sender=a}getAddressee(){return this.addressee||null}setAddressee(a){this.addressee=a}getFileName(){return this.fileName}setFileName(a){this.fileName=a}getFileSize(){return this.fileSize}setFileSize(a){this.fileSize=a}getChecksum(){return this.checksum}setChecksum(a){this.checksum=a}getTimestamp(){return this.timestamp}setTimestamp(a){this.timestamp=a}}class Eo{static parseLong(a,u=void 0){return parseInt(a,u)}}class hr extends H{}hr.kind="NullPointerException";class Se{writeBytes(a){this.writeBytesOffset(a,0,a.length)}writeBytesOffset(a,u,g){if(a==null)throw new hr;if(u<0||u>a.length||g<0||u+g>a.length||u+g<0)throw new he;if(g===0)return;for(let v=0;v<g;v++)this.write(a[u+v])}flush(){}close(){}}class et extends H{}class nt extends Se{constructor(a=32){if(super(),this.count=0,a<0)throw new K("Negative initial size: "+a);this.buf=new Uint8Array(a)}ensureCapacity(a){a-this.buf.length>0&&this.grow(a)}grow(a){let g=this.buf.length<<1;if(g-a<0&&(g=a),g<0){if(a<0)throw new et;g=Xe.MAX_VALUE}this.buf=Je.copyOfUint8Array(this.buf,g)}write(a){this.ensureCapacity(this.count+1),this.buf[this.count]=a,this.count+=1}writeBytesOffset(a,u,g){if(u<0||u>a.length||g<0||u+g-a.length>0)throw new he;this.ensureCapacity(this.count+g),pe.arraycopy(a,u,this.buf,this.count,g),this.count+=g}writeTo(a){a.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return Je.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(a){return a?typeof a=="string"?this.toString_string(a):this.toString_number(a):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(a){return new String(this.buf).toString()}toString_number(a){return new String(this.buf).toString()}close(){}}var tt;(function(ce){ce[ce.ALPHA=0]="ALPHA",ce[ce.LOWER=1]="LOWER",ce[ce.MIXED=2]="MIXED",ce[ce.PUNCT=3]="PUNCT",ce[ce.ALPHA_SHIFT=4]="ALPHA_SHIFT",ce[ce.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(tt||(tt={}));function wt(){if(typeof window<"u")return window.BigInt||null;if(typeof jm<"u")return jm.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Mn;function qn(ce){if(typeof Mn>"u"&&(Mn=wt()),Mn===null)throw new Error("BigInt is not supported!");return Mn(ce)}function Vi(){let ce=[];ce[0]=qn(1);let a=qn(900);ce[1]=a;for(let u=2;u<16;u++)ce[u]=ce[u-1]*a;return ce}class It{static decode(a,u){let g=new vt(""),v=He.ISO8859_1;g.enableDecoding(v);let w=1,I=a[w++],O=new Ao;for(;w<a[0];){switch(I){case It.TEXT_COMPACTION_MODE_LATCH:w=It.textCompaction(a,w,g);break;case It.BYTE_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:w=It.byteCompaction(I,a,v,w,g);break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(a[w++]);break;case It.NUMERIC_COMPACTION_MODE_LATCH:w=It.numericCompaction(a,w,g);break;case It.ECI_CHARSET:He.getCharacterSetECIByValue(a[w++]);break;case It.ECI_GENERAL_PURPOSE:w+=2;break;case It.ECI_USER_DEFINED:w++;break;case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:w=It.decodeMacroBlock(a,w,O);break;case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:throw new rt;default:w--,w=It.textCompaction(a,w,g);break}if(w<a.length)I=a[w++];else throw rt.getFormatInstance()}if(g.length()===0)throw rt.getFormatInstance();let F=new nn(null,g.toString(),null,u);return F.setOther(O),F}static decodeMacroBlock(a,u,g){if(u+It.NUMBER_OF_SEQUENCE_CODEWORDS>a[0])throw rt.getFormatInstance();let v=new Int32Array(It.NUMBER_OF_SEQUENCE_CODEWORDS);for(let O=0;O<It.NUMBER_OF_SEQUENCE_CODEWORDS;O++,u++)v[O]=a[u];g.setSegmentIndex(Xe.parseInt(It.decodeBase900toBase10(v,It.NUMBER_OF_SEQUENCE_CODEWORDS)));let w=new vt;u=It.textCompaction(a,u,w),g.setFileId(w.toString());let I=-1;for(a[u]===It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(I=u+1);u<a[0];)switch(a[u]){case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(u++,a[u]){case It.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let O=new vt;u=It.textCompaction(a,u+1,O),g.setFileName(O.toString());break;case It.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let F=new vt;u=It.textCompaction(a,u+1,F),g.setSender(F.toString());break;case It.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let q=new vt;u=It.textCompaction(a,u+1,q),g.setAddressee(q.toString());break;case It.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let te=new vt;u=It.numericCompaction(a,u+1,te),g.setSegmentCount(Xe.parseInt(te.toString()));break;case It.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let ue=new vt;u=It.numericCompaction(a,u+1,ue),g.setTimestamp(Eo.parseLong(ue.toString()));break;case It.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let xe=new vt;u=It.numericCompaction(a,u+1,xe),g.setChecksum(Xe.parseInt(xe.toString()));break;case It.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let Oe=new vt;u=It.numericCompaction(a,u+1,Oe),g.setFileSize(Eo.parseLong(Oe.toString()));break;default:throw rt.getFormatInstance()}break;case It.MACRO_PDF417_TERMINATOR:u++,g.setLastSegment(!0);break;default:throw rt.getFormatInstance()}if(I!==-1){let O=u-I;g.isLastSegment()&&O--,g.setOptionalData(Je.copyOfRange(a,I,I+O))}return u}static textCompaction(a,u,g){let v=new Int32Array((a[0]-u)*2),w=new Int32Array((a[0]-u)*2),I=0,O=!1;for(;u<a[0]&&!O;){let F=a[u++];if(F<It.TEXT_COMPACTION_MODE_LATCH)v[I]=F/30,v[I+1]=F%30,I+=2;else switch(F){case It.TEXT_COMPACTION_MODE_LATCH:v[I++]=It.TEXT_COMPACTION_MODE_LATCH;break;case It.BYTE_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.NUMERIC_COMPACTION_MODE_LATCH:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:u--,O=!0;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v[I]=It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,F=a[u++],w[I]=F,I++;break}}return It.decodeTextCompaction(v,w,I,g),u}static decodeTextCompaction(a,u,g,v){let w=tt.ALPHA,I=tt.ALPHA,O=0;for(;O<g;){let F=a[O],q="";switch(w){case tt.ALPHA:if(F<26)q=String.fromCharCode(65+F);else switch(F){case 26:q=" ";break;case It.LL:w=tt.LOWER;break;case It.ML:w=tt.MIXED;break;case It.PS:I=w,w=tt.PUNCT_SHIFT;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=tt.ALPHA;break}break;case tt.LOWER:if(F<26)q=String.fromCharCode(97+F);else switch(F){case 26:q=" ";break;case It.AS:I=w,w=tt.ALPHA_SHIFT;break;case It.ML:w=tt.MIXED;break;case It.PS:I=w,w=tt.PUNCT_SHIFT;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=tt.ALPHA;break}break;case tt.MIXED:if(F<It.PL)q=It.MIXED_CHARS[F];else switch(F){case It.PL:w=tt.PUNCT;break;case 26:q=" ";break;case It.LL:w=tt.LOWER;break;case It.AL:w=tt.ALPHA;break;case It.PS:I=w,w=tt.PUNCT_SHIFT;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=tt.ALPHA;break}break;case tt.PUNCT:if(F<It.PAL)q=It.PUNCT_CHARS[F];else switch(F){case It.PAL:w=tt.ALPHA;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=tt.ALPHA;break}break;case tt.ALPHA_SHIFT:if(w=I,F<26)q=String.fromCharCode(65+F);else switch(F){case 26:q=" ";break;case It.TEXT_COMPACTION_MODE_LATCH:w=tt.ALPHA;break}break;case tt.PUNCT_SHIFT:if(w=I,F<It.PAL)q=It.PUNCT_CHARS[F];else switch(F){case It.PAL:w=tt.ALPHA;break;case It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:v.append(u[O]);break;case It.TEXT_COMPACTION_MODE_LATCH:w=tt.ALPHA;break}break}q!==""&&v.append(q),O++}}static byteCompaction(a,u,g,v,w){let I=new nt,O=0,F=0,q=!1;switch(a){case It.BYTE_COMPACTION_MODE_LATCH:let te=new Int32Array(6),ue=u[v++];for(;v<u[0]&&!q;)switch(te[O++]=ue,F=900*F+ue,ue=u[v++],ue){case It.TEXT_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH:case It.NUMERIC_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:v--,q=!0;break;default:if(O%5===0&&O>0){for(let xe=0;xe<6;++xe)I.write(Number(qn(F)>>qn(8*(5-xe))));F=0,O=0}break}v===u[0]&&ue<It.TEXT_COMPACTION_MODE_LATCH&&(te[O++]=ue);for(let xe=0;xe<O;xe++)I.write(te[xe]);break;case It.BYTE_COMPACTION_MODE_LATCH_6:for(;v<u[0]&&!q;){let xe=u[v++];if(xe<It.TEXT_COMPACTION_MODE_LATCH)O++,F=900*F+xe;else switch(xe){case It.TEXT_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH:case It.NUMERIC_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:v--,q=!0;break}if(O%5===0&&O>0){for(let Oe=0;Oe<6;++Oe)I.write(Number(qn(F)>>qn(8*(5-Oe))));F=0,O=0}}break}return w.append(Pe.decode(I.toByteArray(),g)),v}static numericCompaction(a,u,g){let v=0,w=!1,I=new Int32Array(It.MAX_NUMERIC_CODEWORDS);for(;u<a[0]&&!w;){let O=a[u++];if(u===a[0]&&(w=!0),O<It.TEXT_COMPACTION_MODE_LATCH)I[v]=O,v++;else switch(O){case It.TEXT_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH:case It.BYTE_COMPACTION_MODE_LATCH_6:case It.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case It.MACRO_PDF417_TERMINATOR:u--,w=!0;break}(v%It.MAX_NUMERIC_CODEWORDS===0||O===It.NUMERIC_COMPACTION_MODE_LATCH||w)&&v>0&&(g.append(It.decodeBase900toBase10(I,v)),v=0)}return u}static decodeBase900toBase10(a,u){let g=qn(0);for(let w=0;w<u;w++)g+=It.EXP900[u-w-1]*qn(a[w]);let v=g.toString();if(v.charAt(0)!=="1")throw new rt;return v.substring(1)}}It.TEXT_COMPACTION_MODE_LATCH=900,It.BYTE_COMPACTION_MODE_LATCH=901,It.NUMERIC_COMPACTION_MODE_LATCH=902,It.BYTE_COMPACTION_MODE_LATCH_6=924,It.ECI_USER_DEFINED=925,It.ECI_GENERAL_PURPOSE=926,It.ECI_CHARSET=927,It.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,It.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,It.MACRO_PDF417_TERMINATOR=922,It.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,It.MAX_NUMERIC_CODEWORDS=15,It.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,It.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,It.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,It.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,It.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,It.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,It.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,It.PL=25,It.LL=27,It.AS=27,It.ML=28,It.AL=28,It.PS=29,It.PAL=29,It.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,It.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",It.EXP900=wt()?Vi():[],It.NUMBER_OF_SEQUENCE_CODEWORDS=2;class oi{constructor(){}static decode(a,u,g,v,w,I,O){let F=new Bs(a,u,g,v,w),q=null,te=null,ue;for(let ot=!0;;ot=!1){if(u!=null&&(q=oi.getRowIndicatorColumn(a,F,u,!0,I,O)),v!=null&&(te=oi.getRowIndicatorColumn(a,F,v,!1,I,O)),ue=oi.merge(q,te),ue==null)throw ke.getNotFoundInstance();let ft=ue.getBoundingBox();if(ot&&ft!=null&&(ft.getMinY()<F.getMinY()||ft.getMaxY()>F.getMaxY()))F=ft;else break}ue.setBoundingBox(F);let xe=ue.getBarcodeColumnCount()+1;ue.setDetectionResultColumn(0,q),ue.setDetectionResultColumn(xe,te);let Oe=q!=null;for(let ot=1;ot<=xe;ot++){let ft=Oe?ot:xe-ot;if(ue.getDetectionResultColumn(ft)!==void 0)continue;let Rt;ft===0||ft===xe?Rt=new Ms(F,ft===0):Rt=new ps(F),ue.setDetectionResultColumn(ft,Rt);let Ht=-1,An=Ht;for(let wn=F.getMinY();wn<=F.getMaxY();wn++){if(Ht=oi.getStartColumn(ue,ft,wn,Oe),Ht<0||Ht>F.getMaxX()){if(An===-1)continue;Ht=An}let mn=oi.detectCodeword(a,F.getMinX(),F.getMaxX(),Oe,Ht,wn,I,O);mn!=null&&(Rt.setCodeword(wn,mn),An=Ht,I=Math.min(I,mn.getWidth()),O=Math.max(O,mn.getWidth()))}}return oi.createDecoderResult(ue)}static merge(a,u){if(a==null&&u==null)return null;let g=oi.getBarcodeMetadata(a,u);if(g==null)return null;let v=Bs.merge(oi.adjustBoundingBox(a),oi.adjustBoundingBox(u));return new Rr(g,v)}static adjustBoundingBox(a){if(a==null)return null;let u=a.getRowHeights();if(u==null)return null;let g=oi.getMax(u),v=0;for(let O of u)if(v+=g-O,O>0)break;let w=a.getCodewords();for(let O=0;v>0&&w[O]==null;O++)v--;let I=0;for(let O=u.length-1;O>=0&&(I+=g-u[O],!(u[O]>0));O--);for(let O=w.length-1;I>0&&w[O]==null;O--)I--;return a.getBoundingBox().addMissingRows(v,I,a.isLeft())}static getMax(a){let u=-1;for(let g of a)u=Math.max(u,g);return u}static getBarcodeMetadata(a,u){let g;if(a==null||(g=a.getBarcodeMetadata())==null)return u==null?null:u.getBarcodeMetadata();let v;return u==null||(v=u.getBarcodeMetadata())==null?g:g.getColumnCount()!==v.getColumnCount()&&g.getErrorCorrectionLevel()!==v.getErrorCorrectionLevel()&&g.getRowCount()!==v.getRowCount()?null:g}static getRowIndicatorColumn(a,u,g,v,w,I){let O=new Ms(u,v);for(let F=0;F<2;F++){let q=F===0?1:-1,te=Math.trunc(Math.trunc(g.getX()));for(let ue=Math.trunc(Math.trunc(g.getY()));ue<=u.getMaxY()&&ue>=u.getMinY();ue+=q){let xe=oi.detectCodeword(a,0,a.getWidth(),v,te,ue,w,I);xe!=null&&(O.setCodeword(ue,xe),v?te=xe.getStartX():te=xe.getEndX())}}return O}static adjustCodewordCount(a,u){let g=u[0][1],v=g.getValue(),w=a.getBarcodeColumnCount()*a.getBarcodeRowCount()-oi.getNumberOfECCodeWords(a.getBarcodeECLevel());if(v.length===0){if(w<1||w>gn.MAX_CODEWORDS_IN_BARCODE)throw ke.getNotFoundInstance();g.setValue(w)}else v[0]!==w&&g.setValue(w)}static createDecoderResult(a){let u=oi.createBarcodeMatrix(a);oi.adjustCodewordCount(a,u);let g=new Array,v=new Int32Array(a.getBarcodeRowCount()*a.getBarcodeColumnCount()),w=[],I=new Array;for(let F=0;F<a.getBarcodeRowCount();F++)for(let q=0;q<a.getBarcodeColumnCount();q++){let te=u[F][q+1].getValue(),ue=F*a.getBarcodeColumnCount()+q;te.length===0?g.push(ue):te.length===1?v[ue]=te[0]:(I.push(ue),w.push(te))}let O=new Array(w.length);for(let F=0;F<O.length;F++)O[F]=w[F];return oi.createDecoderResultFromAmbiguousValues(a.getBarcodeECLevel(),v,gn.toIntArray(g),gn.toIntArray(I),O)}static createDecoderResultFromAmbiguousValues(a,u,g,v,w){let I=new Int32Array(v.length),O=100;for(;O-- >0;){for(let F=0;F<I.length;F++)u[v[F]]=w[F][I[F]];try{return oi.decodeCodewords(u,a,g)}catch(F){if(!(F instanceof we))throw F}if(I.length===0)throw we.getChecksumInstance();for(let F=0;F<I.length;F++)if(I[F]<w[F].length-1){I[F]++;break}else if(I[F]=0,F===I.length-1)throw we.getChecksumInstance()}throw we.getChecksumInstance()}static createBarcodeMatrix(a){let u=Array.from({length:a.getBarcodeRowCount()},()=>new Array(a.getBarcodeColumnCount()+2));for(let v=0;v<u.length;v++)for(let w=0;w<u[v].length;w++)u[v][w]=new va;let g=0;for(let v of a.getDetectionResultColumns()){if(v!=null){for(let w of v.getCodewords())if(w!=null){let I=w.getRowNumber();if(I>=0){if(I>=u.length)continue;u[I][g].setValue(w.getValue())}}}g++}return u}static isValidBarcodeColumn(a,u){return u>=0&&u<=a.getBarcodeColumnCount()+1}static getStartColumn(a,u,g,v){let w=v?1:-1,I=null;if(oi.isValidBarcodeColumn(a,u-w)&&(I=a.getDetectionResultColumn(u-w).getCodeword(g)),I!=null)return v?I.getEndX():I.getStartX();if(I=a.getDetectionResultColumn(u).getCodewordNearby(g),I!=null)return v?I.getStartX():I.getEndX();if(oi.isValidBarcodeColumn(a,u-w)&&(I=a.getDetectionResultColumn(u-w).getCodewordNearby(g)),I!=null)return v?I.getEndX():I.getStartX();let O=0;for(;oi.isValidBarcodeColumn(a,u-w);){u-=w;for(let F of a.getDetectionResultColumn(u).getCodewords())if(F!=null)return(v?F.getEndX():F.getStartX())+w*O*(F.getEndX()-F.getStartX());O++}return v?a.getBoundingBox().getMinX():a.getBoundingBox().getMaxX()}static detectCodeword(a,u,g,v,w,I,O,F){w=oi.adjustCodewordStartColumn(a,u,g,v,w,I);let q=oi.getModuleBitCount(a,u,g,v,w,I);if(q==null)return null;let te,ue=Rn.sum(q);if(v)te=w+ue;else{for(let ot=0;ot<q.length/2;ot++){let ft=q[ot];q[ot]=q[q.length-1-ot],q[q.length-1-ot]=ft}te=w,w=te-ue}if(!oi.checkCodewordSkew(ue,O,F))return null;let xe=rr.getDecodedValue(q),Oe=gn.getCodeword(xe);return Oe===-1?null:new ns(w,te,oi.getCodewordBucketNumber(xe),Oe)}static getModuleBitCount(a,u,g,v,w,I){let O=w,F=new Int32Array(8),q=0,te=v?1:-1,ue=v;for(;(v?O<g:O>=u)&&q<F.length;)a.get(O,I)===ue?(F[q]++,O+=te):(q++,ue=!ue);return q===F.length||O===(v?g:u)&&q===F.length-1?F:null}static getNumberOfECCodeWords(a){return 2<<a}static adjustCodewordStartColumn(a,u,g,v,w,I){let O=w,F=v?-1:1;for(let q=0;q<2;q++){for(;(v?O>=u:O<g)&&v===a.get(O,I);){if(Math.abs(w-O)>oi.CODEWORD_SKEW_SIZE)return w;O+=F}F=-F,v=!v}return O}static checkCodewordSkew(a,u,g){return u-oi.CODEWORD_SKEW_SIZE<=a&&a<=g+oi.CODEWORD_SKEW_SIZE}static decodeCodewords(a,u,g){if(a.length===0)throw rt.getFormatInstance();let v=1<<u+1,w=oi.correctErrors(a,g,v);oi.verifyCodewordCount(a,v);let I=It.decode(a,""+u);return I.setErrorsCorrected(w),I.setErasures(g.length),I}static correctErrors(a,u,g){if(u!=null&&u.length>g/2+oi.MAX_ERRORS||g<0||g>oi.MAX_EC_CODEWORDS)throw we.getChecksumInstance();return oi.errorCorrection.decode(a,g,u)}static verifyCodewordCount(a,u){if(a.length<4)throw rt.getFormatInstance();let g=a[0];if(g>a.length)throw rt.getFormatInstance();if(g===0)if(u<a.length)a[0]=a.length-u;else throw rt.getFormatInstance()}static getBitCountForCodeword(a){let u=new Int32Array(8),g=0,v=u.length-1;for(;!((a&1)!==g&&(g=a&1,v--,v<0));)u[v]++,a>>=1;return u}static getCodewordBucketNumber(a){return a instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(a):this.getCodewordBucketNumber_number(a)}static getCodewordBucketNumber_number(a){return oi.getCodewordBucketNumber(oi.getBitCountForCodeword(a))}static getCodewordBucketNumber_Int32Array(a){return(a[0]-a[2]+a[4]-a[6]+9)%9}static toString(a){let u=new fa;for(let g=0;g<a.length;g++){u.format("Row %2d: ",g);for(let v=0;v<a[g].length;v++){let w=a[g][v];w.getValue().length===0?u.format("        ",null):u.format("%4d(%2d)",w.getValue()[0],w.getConfidence(w.getValue()[0]))}u.format("%n")}return u.toString()}}oi.CODEWORD_SKEW_SIZE=2,oi.MAX_ERRORS=3,oi.MAX_EC_CODEWORDS=512,oi.errorCorrection=new Zs;class Xi{decode(a,u=null){let g=Xi.decode(a,u,!1);if(g==null||g.length===0||g[0]==null)throw ke.getNotFoundInstance();return g[0]}decodeMultiple(a,u=null){try{return Xi.decode(a,u,!0)}catch(g){throw g instanceof rt||g instanceof we?ke.getNotFoundInstance():g}}static decode(a,u,g){const v=new Array,w=Ai.detectMultiple(a,u,g);for(const I of w.getPoints()){const O=oi.decode(w.getBits(),I[4],I[5],I[6],I[7],Xi.getMinCodewordWidth(I),Xi.getMaxCodewordWidth(I)),F=new bt(O.getText(),O.getRawBytes(),void 0,I,Bt.PDF_417);F.putMetadata(un.ERROR_CORRECTION_LEVEL,O.getECLevel());const q=O.getOther();q!=null&&F.putMetadata(un.PDF417_EXTRA_METADATA,q),v.push(F)}return v.map(I=>I)}static getMaxWidth(a,u){return a==null||u==null?0:Math.trunc(Math.abs(a.getX()-u.getX()))}static getMinWidth(a,u){return a==null||u==null?Xe.MAX_VALUE:Math.trunc(Math.abs(a.getX()-u.getX()))}static getMaxCodewordWidth(a){return Math.floor(Math.max(Math.max(Xi.getMaxWidth(a[0],a[4]),Xi.getMaxWidth(a[6],a[2])*gn.MODULES_IN_CODEWORD/gn.MODULES_IN_STOP_PATTERN),Math.max(Xi.getMaxWidth(a[1],a[5]),Xi.getMaxWidth(a[7],a[3])*gn.MODULES_IN_CODEWORD/gn.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(a){return Math.floor(Math.min(Math.min(Xi.getMinWidth(a[0],a[4]),Xi.getMinWidth(a[6],a[2])*gn.MODULES_IN_CODEWORD/gn.MODULES_IN_STOP_PATTERN),Math.min(Xi.getMinWidth(a[1],a[5]),Xi.getMinWidth(a[7],a[3])*gn.MODULES_IN_CODEWORD/gn.MODULES_IN_STOP_PATTERN)))}reset(){}}class pa extends H{}pa.kind="ReaderException";class hc{constructor(a,u){this.verbose=a===!0,u&&this.setHints(u)}decode(a,u){return u&&this.setHints(u),this.decodeInternal(a)}decodeWithState(a){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(a)}setHints(a){this.hints=a;const u=!C(a)&&a.get(Et.TRY_HARDER)===!0,g=C(a)?null:a.get(Et.POSSIBLE_FORMATS),v=new Array;if(!C(g)){const w=g.some(I=>I===Bt.UPC_A||I===Bt.UPC_E||I===Bt.EAN_13||I===Bt.EAN_8||I===Bt.CODABAR||I===Bt.CODE_39||I===Bt.CODE_93||I===Bt.CODE_128||I===Bt.ITF||I===Bt.RSS_14||I===Bt.RSS_EXPANDED);w&&!u&&v.push(new yi(a,this.verbose)),g.includes(Bt.QR_CODE)&&v.push(new nr),g.includes(Bt.DATA_MATRIX)&&v.push(new Ba),g.includes(Bt.AZTEC)&&v.push(new Ye),g.includes(Bt.PDF_417)&&v.push(new Xi),w&&u&&v.push(new yi(a,this.verbose))}v.length===0&&(u||v.push(new yi(a,this.verbose)),v.push(new nr),v.push(new Ba),v.push(new Ye),v.push(new Xi),u&&v.push(new yi(a,this.verbose))),this.readers=v}reset(){if(this.readers!==null)for(const a of this.readers)a.reset()}decodeInternal(a){if(this.readers===null)throw new pa("No readers where selected, nothing can be read.");for(const u of this.readers)try{return u.decode(a,this.hints)}catch(g){if(g instanceof pa)continue}throw new ke("No MultiFormat Readers were able to detect the code.")}}class ll extends kt{constructor(a=null,u=500){const g=new hc;g.setHints(a),super(g,u)}decodeBitmap(a){return this.reader.decodeWithState(a)}}class ks extends kt{constructor(a=500){super(new Xi,a)}}class ws extends kt{constructor(a=500){super(new nr,a)}}var sr;(function(ce){ce[ce.ERROR_CORRECTION=0]="ERROR_CORRECTION",ce[ce.CHARACTER_SET=1]="CHARACTER_SET",ce[ce.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",ce[ce.MIN_SIZE=3]="MIN_SIZE",ce[ce.MAX_SIZE=4]="MAX_SIZE",ce[ce.MARGIN=5]="MARGIN",ce[ce.PDF417_COMPACT=6]="PDF417_COMPACT",ce[ce.PDF417_COMPACTION=7]="PDF417_COMPACTION",ce[ce.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",ce[ce.AZTEC_LAYERS=9]="AZTEC_LAYERS",ce[ce.QR_VERSION=10]="QR_VERSION"})(sr||(sr={}));var Ar=sr;class ka{constructor(a){this.field=a,this.cachedGenerators=[],this.cachedGenerators.push(new Nn(a,Int32Array.from([1])))}buildGenerator(a){const u=this.cachedGenerators;if(a>=u.length){let g=u[u.length-1];const v=this.field;for(let w=u.length;w<=a;w++){const I=g.multiply(new Nn(v,Int32Array.from([1,v.exp(w-1+v.getGeneratorBase())])));u.push(I),g=I}}return u[a]}encode(a,u){if(u===0)throw new K("No error correction bytes");const g=a.length-u;if(g<=0)throw new K("No data bytes provided");const v=this.buildGenerator(u),w=new Int32Array(g);pe.arraycopy(a,0,w,0,g);let I=new Nn(this.field,w);I=I.multiplyByMonomial(u,1);const F=I.divide(v)[1].getCoefficients(),q=u-F.length;for(let te=0;te<q;te++)a[g+te]=0;pe.arraycopy(F,0,a,g+q,F.length)}}class br{constructor(){}static applyMaskPenaltyRule1(a){return br.applyMaskPenaltyRule1Internal(a,!0)+br.applyMaskPenaltyRule1Internal(a,!1)}static applyMaskPenaltyRule2(a){let u=0;const g=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let I=0;I<w-1;I++){const O=g[I];for(let F=0;F<v-1;F++){const q=O[F];q===O[F+1]&&q===g[I+1][F]&&q===g[I+1][F+1]&&u++}}return br.N2*u}static applyMaskPenaltyRule3(a){let u=0;const g=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let I=0;I<w;I++)for(let O=0;O<v;O++){const F=g[I];O+6<v&&F[O]===1&&F[O+1]===0&&F[O+2]===1&&F[O+3]===1&&F[O+4]===1&&F[O+5]===0&&F[O+6]===1&&(br.isWhiteHorizontal(F,O-4,O)||br.isWhiteHorizontal(F,O+7,O+11))&&u++,I+6<w&&g[I][O]===1&&g[I+1][O]===0&&g[I+2][O]===1&&g[I+3][O]===1&&g[I+4][O]===1&&g[I+5][O]===0&&g[I+6][O]===1&&(br.isWhiteVertical(g,O,I-4,I)||br.isWhiteVertical(g,O,I+7,I+11))&&u++}return u*br.N3}static isWhiteHorizontal(a,u,g){u=Math.max(u,0),g=Math.min(g,a.length);for(let v=u;v<g;v++)if(a[v]===1)return!1;return!0}static isWhiteVertical(a,u,g,v){g=Math.max(g,0),v=Math.min(v,a.length);for(let w=g;w<v;w++)if(a[w][u]===1)return!1;return!0}static applyMaskPenaltyRule4(a){let u=0;const g=a.getArray(),v=a.getWidth(),w=a.getHeight();for(let F=0;F<w;F++){const q=g[F];for(let te=0;te<v;te++)q[te]===1&&u++}const I=a.getHeight()*a.getWidth();return Math.floor(Math.abs(u*2-I)*10/I)*br.N4}static getDataMaskBit(a,u,g){let v,w;switch(a){case 0:v=g+u&1;break;case 1:v=g&1;break;case 2:v=u%3;break;case 3:v=(g+u)%3;break;case 4:v=Math.floor(g/2)+Math.floor(u/3)&1;break;case 5:w=g*u,v=(w&1)+w%3;break;case 6:w=g*u,v=(w&1)+w%3&1;break;case 7:w=g*u,v=w%3+(g+u&1)&1;break;default:throw new K("Invalid mask pattern: "+a)}return v===0}static applyMaskPenaltyRule1Internal(a,u){let g=0;const v=u?a.getHeight():a.getWidth(),w=u?a.getWidth():a.getHeight(),I=a.getArray();for(let O=0;O<v;O++){let F=0,q=-1;for(let te=0;te<w;te++){const ue=u?I[O][te]:I[te][O];ue===q?F++:(F>=5&&(g+=br.N1+(F-5)),F=1,q=ue)}F>=5&&(g+=br.N1+(F-5))}return g}}br.N1=3,br.N2=3,br.N3=40,br.N4=10;class vr{constructor(a,u){this.width=a,this.height=u;const g=new Array(u);for(let v=0;v!==u;v++)g[v]=new Uint8Array(a);this.bytes=g}getHeight(){return this.height}getWidth(){return this.width}get(a,u){return this.bytes[u][a]}getArray(){return this.bytes}setNumber(a,u,g){this.bytes[u][a]=g}setBoolean(a,u,g){this.bytes[u][a]=g?1:0}clear(a){for(const u of this.bytes)Je.fill(u,a)}equals(a){if(!(a instanceof vr))return!1;const u=a;if(this.width!==u.width||this.height!==u.height)return!1;for(let g=0,v=this.height;g<v;++g){const w=this.bytes[g],I=u.bytes[g];for(let O=0,F=this.width;O<F;++O)if(w[O]!==I[O])return!1}return!0}toString(){const a=new vt;for(let u=0,g=this.height;u<g;++u){const v=this.bytes[u];for(let w=0,I=this.width;w<I;++w)switch(v[w]){case 0:a.append(" 0");break;case 1:a.append(" 1");break;default:a.append("  ");break}a.append(`
`)}return a.toString()}}class Fa{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const a=new vt;return a.append(`<<
`),a.append(" mode: "),a.append(this.mode?this.mode.toString():"null"),a.append(`
 ecLevel: `),a.append(this.ecLevel?this.ecLevel.toString():"null"),a.append(`
 version: `),a.append(this.version?this.version.toString():"null"),a.append(`
 maskPattern: `),a.append(this.maskPattern.toString()),this.matrix?(a.append(`
 matrix:
`),a.append(this.matrix.toString())):a.append(`
 matrix: null
`),a.append(`>>
`),a.toString()}setMode(a){this.mode=a}setECLevel(a){this.ecLevel=a}setVersion(a){this.version=a}setMaskPattern(a){this.maskPattern=a}setMatrix(a){this.matrix=a}static isValidMaskPattern(a){return a>=0&&a<Fa.NUM_MASK_PATTERNS}}Fa.NUM_MASK_PATTERNS=8;class $i extends H{}$i.kind="WriterException";class xi{constructor(){}static clearMatrix(a){a.clear(255)}static buildMatrix(a,u,g,v,w){xi.clearMatrix(w),xi.embedBasicPatterns(g,w),xi.embedTypeInfo(u,v,w),xi.maybeEmbedVersionInfo(g,w),xi.embedDataBits(a,v,w)}static embedBasicPatterns(a,u){xi.embedPositionDetectionPatternsAndSeparators(u),xi.embedDarkDotAtLeftBottomCorner(u),xi.maybeEmbedPositionAdjustmentPatterns(a,u),xi.embedTimingPatterns(u)}static embedTypeInfo(a,u,g){const v=new mt;xi.makeTypeInfoBits(a,u,v);for(let w=0,I=v.getSize();w<I;++w){const O=v.get(v.getSize()-1-w),F=xi.TYPE_INFO_COORDINATES[w],q=F[0],te=F[1];if(g.setBoolean(q,te,O),w<8){const ue=g.getWidth()-w-1;g.setBoolean(ue,8,O)}else{const xe=g.getHeight()-7+(w-8);g.setBoolean(8,xe,O)}}}static maybeEmbedVersionInfo(a,u){if(a.getVersionNumber()<7)return;const g=new mt;xi.makeVersionInfoBits(a,g);let v=17;for(let w=0;w<6;++w)for(let I=0;I<3;++I){const O=g.get(v);v--,u.setBoolean(w,u.getHeight()-11+I,O),u.setBoolean(u.getHeight()-11+I,w,O)}}static embedDataBits(a,u,g){let v=0,w=-1,I=g.getWidth()-1,O=g.getHeight()-1;for(;I>0;){for(I===6&&(I-=1);O>=0&&O<g.getHeight();){for(let F=0;F<2;++F){const q=I-F;if(!xi.isEmpty(g.get(q,O)))continue;let te;v<a.getSize()?(te=a.get(v),++v):te=!1,u!==255&&br.getDataMaskBit(u,q,O)&&(te=!te),g.setBoolean(q,O,te)}O+=w}w=-w,O+=w,I-=2}if(v!==a.getSize())throw new $i("Not all bits consumed: "+v+"/"+a.getSize())}static findMSBSet(a){return 32-Xe.numberOfLeadingZeros(a)}static calculateBCHCode(a,u){if(u===0)throw new K("0 polynomial");const g=xi.findMSBSet(u);for(a<<=g-1;xi.findMSBSet(a)>=g;)a^=u<<xi.findMSBSet(a)-g;return a}static makeTypeInfoBits(a,u,g){if(!Fa.isValidMaskPattern(u))throw new $i("Invalid mask pattern");const v=a.getBits()<<3|u;g.appendBits(v,5);const w=xi.calculateBCHCode(v,xi.TYPE_INFO_POLY);g.appendBits(w,10);const I=new mt;if(I.appendBits(xi.TYPE_INFO_MASK_PATTERN,15),g.xor(I),g.getSize()!==15)throw new $i("should not happen but we got: "+g.getSize())}static makeVersionInfoBits(a,u){u.appendBits(a.getVersionNumber(),6);const g=xi.calculateBCHCode(a.getVersionNumber(),xi.VERSION_INFO_POLY);if(u.appendBits(g,12),u.getSize()!==18)throw new $i("should not happen but we got: "+u.getSize())}static isEmpty(a){return a===255}static embedTimingPatterns(a){for(let u=8;u<a.getWidth()-8;++u){const g=(u+1)%2;xi.isEmpty(a.get(u,6))&&a.setNumber(u,6,g),xi.isEmpty(a.get(6,u))&&a.setNumber(6,u,g)}}static embedDarkDotAtLeftBottomCorner(a){if(a.get(8,a.getHeight()-8)===0)throw new $i;a.setNumber(8,a.getHeight()-8,1)}static embedHorizontalSeparationPattern(a,u,g){for(let v=0;v<8;++v){if(!xi.isEmpty(g.get(a+v,u)))throw new $i;g.setNumber(a+v,u,0)}}static embedVerticalSeparationPattern(a,u,g){for(let v=0;v<7;++v){if(!xi.isEmpty(g.get(a,u+v)))throw new $i;g.setNumber(a,u+v,0)}}static embedPositionAdjustmentPattern(a,u,g){for(let v=0;v<5;++v){const w=xi.POSITION_ADJUSTMENT_PATTERN[v];for(let I=0;I<5;++I)g.setNumber(a+I,u+v,w[I])}}static embedPositionDetectionPattern(a,u,g){for(let v=0;v<7;++v){const w=xi.POSITION_DETECTION_PATTERN[v];for(let I=0;I<7;++I)g.setNumber(a+I,u+v,w[I])}}static embedPositionDetectionPatternsAndSeparators(a){const u=xi.POSITION_DETECTION_PATTERN[0].length;xi.embedPositionDetectionPattern(0,0,a),xi.embedPositionDetectionPattern(a.getWidth()-u,0,a),xi.embedPositionDetectionPattern(0,a.getWidth()-u,a);const g=8;xi.embedHorizontalSeparationPattern(0,g-1,a),xi.embedHorizontalSeparationPattern(a.getWidth()-g,g-1,a),xi.embedHorizontalSeparationPattern(0,a.getWidth()-g,a);const v=7;xi.embedVerticalSeparationPattern(v,0,a),xi.embedVerticalSeparationPattern(a.getHeight()-v-1,0,a),xi.embedVerticalSeparationPattern(v,a.getHeight()-v,a)}static maybeEmbedPositionAdjustmentPatterns(a,u){if(a.getVersionNumber()<2)return;const g=a.getVersionNumber()-1,v=xi.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[g];for(let w=0,I=v.length;w!==I;w++){const O=v[w];if(O>=0)for(let F=0;F!==I;F++){const q=v[F];q>=0&&xi.isEmpty(u.get(q,O))&&xi.embedPositionAdjustmentPattern(q-2,O-2,u)}}}}xi.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),xi.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),xi.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),xi.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),xi.VERSION_INFO_POLY=7973,xi.TYPE_INFO_POLY=1335,xi.TYPE_INFO_MASK_PATTERN=21522;class xu{constructor(a,u){this.dataBytes=a,this.errorCorrectionBytes=u}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Ji{constructor(){}static calculateMaskPenalty(a){return br.applyMaskPenaltyRule1(a)+br.applyMaskPenaltyRule2(a)+br.applyMaskPenaltyRule3(a)+br.applyMaskPenaltyRule4(a)}static encode(a,u,g=null){let v=Ji.DEFAULT_BYTE_MODE_ENCODING;const w=g!==null&&g.get(Ar.CHARACTER_SET)!==void 0;w&&(v=g.get(Ar.CHARACTER_SET).toString());const I=this.chooseMode(a,v),O=new mt;if(I===di.BYTE&&(w||Ji.DEFAULT_BYTE_MODE_ENCODING!==v)){const wn=He.getCharacterSetECIByName(v);wn!==void 0&&this.appendECI(wn,O)}this.appendModeInfo(I,O);const F=new mt;this.appendBytes(a,I,F,v);let q;if(g!==null&&g.get(Ar.QR_VERSION)!==void 0){const wn=Number.parseInt(g.get(Ar.QR_VERSION).toString(),10);q=ti.getVersionForNumber(wn);const mn=this.calculateBitsNeeded(I,O,F,q);if(!this.willFit(mn,q,u))throw new $i("Data too big for requested version")}else q=this.recommendVersion(u,I,O,F);const te=new mt;te.appendBitArray(O);const ue=I===di.BYTE?F.getSizeInBytes():a.length;this.appendLengthInfo(ue,q,I,te),te.appendBitArray(F);const xe=q.getECBlocksForLevel(u),Oe=q.getTotalCodewords()-xe.getTotalECCodewords();this.terminateBits(Oe,te);const ot=this.interleaveWithECBytes(te,q.getTotalCodewords(),Oe,xe.getNumBlocks()),ft=new Fa;ft.setECLevel(u),ft.setMode(I),ft.setVersion(q);const Rt=q.getDimensionForVersion(),Ht=new vr(Rt,Rt),An=this.chooseMaskPattern(ot,u,q,Ht);return ft.setMaskPattern(An),xi.buildMatrix(ot,u,q,An,Ht),ft.setMatrix(Ht),ft}static recommendVersion(a,u,g,v){const w=this.calculateBitsNeeded(u,g,v,ti.getVersionForNumber(1)),I=this.chooseVersion(w,a),O=this.calculateBitsNeeded(u,g,v,I);return this.chooseVersion(O,a)}static calculateBitsNeeded(a,u,g,v){return u.getSize()+a.getCharacterCountBits(v)+g.getSize()}static getAlphanumericCode(a){return a<Ji.ALPHANUMERIC_TABLE.length?Ji.ALPHANUMERIC_TABLE[a]:-1}static chooseMode(a,u=null){if(He.SJIS.getName()===u&&this.isOnlyDoubleByteKanji(a))return di.KANJI;let g=!1,v=!1;for(let w=0,I=a.length;w<I;++w){const O=a.charAt(w);if(Ji.isDigit(O))g=!0;else if(this.getAlphanumericCode(O.charCodeAt(0))!==-1)v=!0;else return di.BYTE}return v?di.ALPHANUMERIC:g?di.NUMERIC:di.BYTE}static isOnlyDoubleByteKanji(a){let u;try{u=Pe.encode(a,He.SJIS)}catch{return!1}const g=u.length;if(g%2!==0)return!1;for(let v=0;v<g;v+=2){const w=u[v]&255;if((w<129||w>159)&&(w<224||w>235))return!1}return!0}static chooseMaskPattern(a,u,g,v){let w=Number.MAX_SAFE_INTEGER,I=-1;for(let O=0;O<Fa.NUM_MASK_PATTERNS;O++){xi.buildMatrix(a,u,g,O,v);let F=this.calculateMaskPenalty(v);F<w&&(w=F,I=O)}return I}static chooseVersion(a,u){for(let g=1;g<=40;g++){const v=ti.getVersionForNumber(g);if(Ji.willFit(a,v,u))return v}throw new $i("Data too big")}static willFit(a,u,g){const v=u.getTotalCodewords(),I=u.getECBlocksForLevel(g).getTotalECCodewords(),O=v-I,F=(a+7)/8;return O>=F}static terminateBits(a,u){const g=a*8;if(u.getSize()>g)throw new $i("data bits cannot fit in the QR Code"+u.getSize()+" > "+g);for(let I=0;I<4&&u.getSize()<g;++I)u.appendBit(!1);const v=u.getSize()&7;if(v>0)for(let I=v;I<8;I++)u.appendBit(!1);const w=a-u.getSizeInBytes();for(let I=0;I<w;++I)u.appendBits((I&1)===0?236:17,8);if(u.getSize()!==g)throw new $i("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(a,u,g,v,w,I){if(v>=g)throw new $i("Block ID too large");const O=a%g,F=g-O,q=Math.floor(a/g),te=q+1,ue=Math.floor(u/g),xe=ue+1,Oe=q-ue,ot=te-xe;if(Oe!==ot)throw new $i("EC bytes mismatch");if(g!==F+O)throw new $i("RS blocks mismatch");if(a!==(ue+Oe)*F+(xe+ot)*O)throw new $i("Total bytes mismatch");v<F?(w[0]=ue,I[0]=Oe):(w[0]=xe,I[0]=ot)}static interleaveWithECBytes(a,u,g,v){if(a.getSizeInBytes()!==g)throw new $i("Number of bits and data bytes does not match");let w=0,I=0,O=0;const F=new Array;for(let te=0;te<v;++te){const ue=new Int32Array(1),xe=new Int32Array(1);Ji.getNumDataBytesAndNumECBytesForBlockID(u,g,v,te,ue,xe);const Oe=ue[0],ot=new Uint8Array(Oe);a.toBytes(8*w,ot,0,Oe);const ft=Ji.generateECBytes(ot,xe[0]);F.push(new xu(ot,ft)),I=Math.max(I,Oe),O=Math.max(O,ft.length),w+=ue[0]}if(g!==w)throw new $i("Data bytes does not match offset");const q=new mt;for(let te=0;te<I;++te)for(const ue of F){const xe=ue.getDataBytes();te<xe.length&&q.appendBits(xe[te],8)}for(let te=0;te<O;++te)for(const ue of F){const xe=ue.getErrorCorrectionBytes();te<xe.length&&q.appendBits(xe[te],8)}if(u!==q.getSizeInBytes())throw new $i("Interleaving error: "+u+" and "+q.getSizeInBytes()+" differ.");return q}static generateECBytes(a,u){const g=a.length,v=new Int32Array(g+u);for(let I=0;I<g;I++)v[I]=a[I]&255;new ka(En.QR_CODE_FIELD_256).encode(v,u);const w=new Uint8Array(u);for(let I=0;I<u;I++)w[I]=v[g+I];return w}static appendModeInfo(a,u){u.appendBits(a.getBits(),4)}static appendLengthInfo(a,u,g,v){const w=g.getCharacterCountBits(u);if(a>=1<<w)throw new $i(a+" is bigger than "+((1<<w)-1));v.appendBits(a,w)}static appendBytes(a,u,g,v){switch(u){case di.NUMERIC:Ji.appendNumericBytes(a,g);break;case di.ALPHANUMERIC:Ji.appendAlphanumericBytes(a,g);break;case di.BYTE:Ji.append8BitBytes(a,g,v);break;case di.KANJI:Ji.appendKanjiBytes(a,g);break;default:throw new $i("Invalid mode: "+u)}}static getDigit(a){return a.charCodeAt(0)-48}static isDigit(a){const u=Ji.getDigit(a);return u>=0&&u<=9}static appendNumericBytes(a,u){const g=a.length;let v=0;for(;v<g;){const w=Ji.getDigit(a.charAt(v));if(v+2<g){const I=Ji.getDigit(a.charAt(v+1)),O=Ji.getDigit(a.charAt(v+2));u.appendBits(w*100+I*10+O,10),v+=3}else if(v+1<g){const I=Ji.getDigit(a.charAt(v+1));u.appendBits(w*10+I,7),v+=2}else u.appendBits(w,4),v++}}static appendAlphanumericBytes(a,u){const g=a.length;let v=0;for(;v<g;){const w=Ji.getAlphanumericCode(a.charCodeAt(v));if(w===-1)throw new $i;if(v+1<g){const I=Ji.getAlphanumericCode(a.charCodeAt(v+1));if(I===-1)throw new $i;u.appendBits(w*45+I,11),v+=2}else u.appendBits(w,6),v++}}static append8BitBytes(a,u,g){let v;try{v=Pe.encode(a,g)}catch(w){throw new $i(w)}for(let w=0,I=v.length;w!==I;w++){const O=v[w];u.appendBits(O,8)}}static appendKanjiBytes(a,u){let g;try{g=Pe.encode(a,He.SJIS)}catch(w){throw new $i(w)}const v=g.length;for(let w=0;w<v;w+=2){const I=g[w]&255,O=g[w+1]&255,F=I<<8&4294967295|O;let q=-1;if(F>=33088&&F<=40956?q=F-33088:F>=57408&&F<=60351&&(q=F-49472),q===-1)throw new $i("Invalid byte sequence");const te=(q>>8)*192+(q&255);u.appendBits(te,13)}}static appendECI(a,u){u.appendBits(di.ECI.getBits(),4),u.appendBits(a.getValue(),8)}}Ji.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Ji.DEFAULT_BYTE_MODE_ENCODING=He.UTF8.getName();class ja{write(a,u,g,v=null){if(a.length===0)throw new K("Found empty contents");if(u<0||g<0)throw new K("Requested dimensions are too small: "+u+"x"+g);let w=Fi.L,I=ja.QUIET_ZONE_SIZE;v!==null&&(v.get(Ar.ERROR_CORRECTION)!==void 0&&(w=Fi.fromString(v.get(Ar.ERROR_CORRECTION).toString())),v.get(Ar.MARGIN)!==void 0&&(I=Number.parseInt(v.get(Ar.MARGIN).toString(),10)));const O=Ji.encode(a,w,v);return this.renderResult(O,u,g,I)}writeToDom(a,u,g,v,w=null){typeof a=="string"&&(a=document.querySelector(a));const I=this.write(u,g,v,w);a&&a.appendChild(I)}renderResult(a,u,g,v){const w=a.getMatrix();if(w===null)throw new wi;const I=w.getWidth(),O=w.getHeight(),F=I+v*2,q=O+v*2,te=Math.max(u,F),ue=Math.max(g,q),xe=Math.min(Math.floor(te/F),Math.floor(ue/q)),Oe=Math.floor((te-I*xe)/2),ot=Math.floor((ue-O*xe)/2),ft=this.createSVGElement(te,ue);for(let Rt=0,Ht=ot;Rt<O;Rt++,Ht+=xe)for(let An=0,wn=Oe;An<I;An++,wn+=xe)if(w.get(An,Rt)===1){const mn=this.createSvgRectElement(wn,Ht,xe,xe);ft.appendChild(mn)}return ft}createSVGElement(a,u){const g=document.createElementNS(ja.SVG_NS,"svg");return g.setAttributeNS(null,"height",a.toString()),g.setAttributeNS(null,"width",u.toString()),g}createSvgRectElement(a,u,g,v){const w=document.createElementNS(ja.SVG_NS,"rect");return w.setAttributeNS(null,"x",a.toString()),w.setAttributeNS(null,"y",u.toString()),w.setAttributeNS(null,"height",g.toString()),w.setAttributeNS(null,"width",v.toString()),w.setAttributeNS(null,"fill","#000000"),w}}ja.QUIET_ZONE_SIZE=4,ja.SVG_NS="http://www.w3.org/2000/svg";class Na{encode(a,u,g,v,w){if(a.length===0)throw new K("Found empty contents");if(u!==Bt.QR_CODE)throw new K("Can only encode QR_CODE, but got "+u);if(g<0||v<0)throw new K(`Requested dimensions are too small: ${g}x${v}`);let I=Fi.L,O=Na.QUIET_ZONE_SIZE;w!==null&&(w.get(Ar.ERROR_CORRECTION)!==void 0&&(I=Fi.fromString(w.get(Ar.ERROR_CORRECTION).toString())),w.get(Ar.MARGIN)!==void 0&&(O=Number.parseInt(w.get(Ar.MARGIN).toString(),10)));const F=Ji.encode(a,I,w);return Na.renderResult(F,g,v,O)}static renderResult(a,u,g,v){const w=a.getMatrix();if(w===null)throw new wi;const I=w.getWidth(),O=w.getHeight(),F=I+v*2,q=O+v*2,te=Math.max(u,F),ue=Math.max(g,q),xe=Math.min(Math.floor(te/F),Math.floor(ue/q)),Oe=Math.floor((te-I*xe)/2),ot=Math.floor((ue-O*xe)/2),ft=new qt(te,ue);for(let Rt=0,Ht=ot;Rt<O;Rt++,Ht+=xe)for(let An=0,wn=Oe;An<I;An++,wn+=xe)w.get(An,Rt)===1&&ft.setRegion(wn,Ht,xe,xe);return ft}}Na.QUIET_ZONE_SIZE=4;class ih{encode(a,u,g,v,w){let I;if(u===Bt.QR_CODE)I=new Na;else throw new K("No encoder available for format "+u);return I.encode(a,u,g,v,w)}}class wa extends ut{constructor(a,u,g,v,w,I,O,F){if(super(I,O),this.yuvData=a,this.dataWidth=u,this.dataHeight=g,this.left=v,this.top=w,v+I>u||w+O>g)throw new K("Crop rectangle does not fit within image data.");F&&this.reverseHorizontal(I,O)}getRow(a,u){if(a<0||a>=this.getHeight())throw new K("Requested row is outside the image: "+a);const g=this.getWidth();(u==null||u.length<g)&&(u=new Uint8ClampedArray(g));const v=(a+this.top)*this.dataWidth+this.left;return pe.arraycopy(this.yuvData,v,u,0,g),u}getMatrix(){const a=this.getWidth(),u=this.getHeight();if(a===this.dataWidth&&u===this.dataHeight)return this.yuvData;const g=a*u,v=new Uint8ClampedArray(g);let w=this.top*this.dataWidth+this.left;if(a===this.dataWidth)return pe.arraycopy(this.yuvData,w,v,0,g),v;for(let I=0;I<u;I++){const O=I*a;pe.arraycopy(this.yuvData,w,v,O,a),w+=this.dataWidth}return v}isCropSupported(){return!0}crop(a,u,g,v){return new wa(this.yuvData,this.dataWidth,this.dataHeight,this.left+a,this.top+u,g,v,!1)}renderThumbnail(){const a=this.getWidth()/wa.THUMBNAIL_SCALE_FACTOR,u=this.getHeight()/wa.THUMBNAIL_SCALE_FACTOR,g=new Int32Array(a*u),v=this.yuvData;let w=this.top*this.dataWidth+this.left;for(let I=0;I<u;I++){const O=I*a;for(let F=0;F<a;F++){const q=v[w+F*wa.THUMBNAIL_SCALE_FACTOR]&255;g[O+F]=4278190080|q*65793}w+=this.dataWidth*wa.THUMBNAIL_SCALE_FACTOR}return g}getThumbnailWidth(){return this.getWidth()/wa.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/wa.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(a,u){const g=this.yuvData;for(let v=0,w=this.top*this.dataWidth+this.left;v<u;v++,w+=this.dataWidth){const I=w+a/2;for(let O=w,F=w+a-1;O<I;O++,F--){const q=g[O];g[O]=g[F],g[F]=q}}}invert(){return new Tt(this)}}wa.THUMBNAIL_SCALE_FACTOR=2;class cl extends ut{constructor(a,u,g,v,w,I,O){if(super(u,g),this.dataWidth=v,this.dataHeight=w,this.left=I,this.top=O,a.BYTES_PER_ELEMENT===4){const F=u*g,q=new Uint8ClampedArray(F);for(let te=0;te<F;te++){const ue=a[te],xe=ue>>16&255,Oe=ue>>7&510,ot=ue&255;q[te]=(xe+Oe+ot)/4&255}this.luminances=q}else this.luminances=a;if(v===void 0&&(this.dataWidth=u),w===void 0&&(this.dataHeight=g),I===void 0&&(this.left=0),O===void 0&&(this.top=0),this.left+u>this.dataWidth||this.top+g>this.dataHeight)throw new K("Crop rectangle does not fit within image data.")}getRow(a,u){if(a<0||a>=this.getHeight())throw new K("Requested row is outside the image: "+a);const g=this.getWidth();(u==null||u.length<g)&&(u=new Uint8ClampedArray(g));const v=(a+this.top)*this.dataWidth+this.left;return pe.arraycopy(this.luminances,v,u,0,g),u}getMatrix(){const a=this.getWidth(),u=this.getHeight();if(a===this.dataWidth&&u===this.dataHeight)return this.luminances;const g=a*u,v=new Uint8ClampedArray(g);let w=this.top*this.dataWidth+this.left;if(a===this.dataWidth)return pe.arraycopy(this.luminances,w,v,0,g),v;for(let I=0;I<u;I++){const O=I*a;pe.arraycopy(this.luminances,w,v,O,a),w+=this.dataWidth}return v}isCropSupported(){return!0}crop(a,u,g,v){return new cl(this.luminances,g,v,this.dataWidth,this.dataHeight,this.left+a,this.top+u)}invert(){return new Tt(this)}}class Ll extends He{static forName(a){return this.getCharacterSetECIByName(a)}}class $r{}$r.ISO_8859_1=He.ISO8859_1;class Bl{isCompact(){return this.compact}setCompact(a){this.compact=a}getSize(){return this.size}setSize(a){this.size=a}getLayers(){return this.layers}setLayers(a){this.layers=a}getCodeWords(){return this.codeWords}setCodeWords(a){this.codeWords=a}getMatrix(){return this.matrix}setMatrix(a){this.matrix=a}}class Fl{static singletonList(a){return[a]}static min(a,u){return a.sort(u)[0]}}class dc{constructor(a){this.previous=a}getPrevious(){return this.previous}}class Da extends dc{constructor(a,u,g){super(a),this.value=u,this.bitCount=g}appendTo(a,u){a.appendBits(this.value,this.bitCount)}add(a,u){return new Da(this,a,u)}addBinaryShift(a,u){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Da(this,a,u)}toString(){let a=this.value&(1<<this.bitCount)-1;return a|=1<<this.bitCount,"<"+Xe.toBinaryString(a|1<<this.bitCount).substring(1)+">"}}class _u extends Da{constructor(a,u,g){super(a,0,0),this.binaryShiftStart=u,this.binaryShiftByteCount=g}appendTo(a,u){for(let g=0;g<this.binaryShiftByteCount;g++)(g===0||g===31&&this.binaryShiftByteCount<=62)&&(a.appendBits(31,5),this.binaryShiftByteCount>62?a.appendBits(this.binaryShiftByteCount-31,16):g===0?a.appendBits(Math.min(this.binaryShiftByteCount,31),5):a.appendBits(this.binaryShiftByteCount-31,5)),a.appendBits(u[this.binaryShiftStart+g],8)}addBinaryShift(a,u){return new _u(this,a,u)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Lc(ce,a,u){return new _u(ce,a,u)}function fc(ce,a,u){return new Da(ce,a,u)}const no=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],io=0,Bc=1,Ra=2,Fc=3,Pa=4,jl=new Da(null,0,0),ul=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function Zh(ce){for(let a of ce)Je.fill(a,-1);return ce[io][Pa]=0,ce[Bc][Pa]=0,ce[Bc][io]=28,ce[Fc][Pa]=0,ce[Ra][Pa]=0,ce[Ra][io]=15,ce}const pc=Zh(Je.createInt32Array(6,6));class Xs{constructor(a,u,g,v){this.token=a,this.mode=u,this.binaryShiftByteCount=g,this.bitCount=v}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(a,u){let g=this.bitCount,v=this.token;if(a!==this.mode){let I=ul[this.mode][a];v=fc(v,I&65535,I>>16),g+=I>>16}let w=a===Ra?4:5;return v=fc(v,u,w),new Xs(v,a,0,g+w)}shiftAndAppend(a,u){let g=this.token,v=this.mode===Ra?4:5;return g=fc(g,pc[this.mode][a],v),g=fc(g,u,5),new Xs(g,this.mode,0,this.bitCount+v+5)}addBinaryShiftChar(a){let u=this.token,g=this.mode,v=this.bitCount;if(this.mode===Pa||this.mode===Ra){let O=ul[g][io];u=fc(u,O&65535,O>>16),v+=O>>16,g=io}let w=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,I=new Xs(u,g,this.binaryShiftByteCount+1,v+w);return I.binaryShiftByteCount===2078&&(I=I.endBinaryShift(a+1)),I}endBinaryShift(a){if(this.binaryShiftByteCount===0)return this;let u=this.token;return u=Lc(u,a-this.binaryShiftByteCount,this.binaryShiftByteCount),new Xs(u,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(a){let u=this.bitCount+(ul[this.mode][a.mode]>>16);return this.binaryShiftByteCount<a.binaryShiftByteCount?u+=Xs.calculateBinaryShiftCost(a)-Xs.calculateBinaryShiftCost(this):this.binaryShiftByteCount>a.binaryShiftByteCount&&a.binaryShiftByteCount>0&&(u+=10),u<=a.bitCount}toBitArray(a){let u=[];for(let v=this.endBinaryShift(a.length).token;v!==null;v=v.getPrevious())u.unshift(v);let g=new mt;for(const v of u)v.appendTo(g,a);return g}toString(){return ht.format("%s bits=%d bytes=%d",no[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(a){return a.binaryShiftByteCount>62?21:a.binaryShiftByteCount>31?20:a.binaryShiftByteCount>0?10:0}}Xs.INITIAL_STATE=new Xs(jl,io,0,0);function rh(ce){const a=ht.getCharCode(" "),u=ht.getCharCode("."),g=ht.getCharCode(",");ce[io][a]=1;const v=ht.getCharCode("Z"),w=ht.getCharCode("A");for(let xe=w;xe<=v;xe++)ce[io][xe]=xe-w+2;ce[Bc][a]=1;const I=ht.getCharCode("z"),O=ht.getCharCode("a");for(let xe=O;xe<=I;xe++)ce[Bc][xe]=xe-O+2;ce[Ra][a]=1;const F=ht.getCharCode("9"),q=ht.getCharCode("0");for(let xe=q;xe<=F;xe++)ce[Ra][xe]=xe-q+2;ce[Ra][g]=12,ce[Ra][u]=13;const te=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let xe=0;xe<te.length;xe++)ce[Fc][ht.getCharCode(te[xe])]=xe;const ue=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let xe=0;xe<ue.length;xe++)ht.getCharCode(ue[xe])>0&&(ce[Pa][ht.getCharCode(ue[xe])]=xe);return ce}const Ul=rh(Je.createInt32Array(5,256));class Ua{constructor(a){this.text=a}encode(){const a=ht.getCharCode(" "),u=ht.getCharCode(`
`);let g=Fl.singletonList(Xs.INITIAL_STATE);for(let w=0;w<this.text.length;w++){let I,O=w+1<this.text.length?this.text[w+1]:0;switch(this.text[w]){case ht.getCharCode("\r"):I=O===u?2:0;break;case ht.getCharCode("."):I=O===a?3:0;break;case ht.getCharCode(","):I=O===a?4:0;break;case ht.getCharCode(":"):I=O===a?5:0;break;default:I=0}I>0?(g=Ua.updateStateListForPair(g,w,I),w++):g=this.updateStateListForChar(g,w)}return Fl.min(g,(w,I)=>w.getBitCount()-I.getBitCount()).toBitArray(this.text)}updateStateListForChar(a,u){const g=[];for(let v of a)this.updateStateForChar(v,u,g);return Ua.simplifyStates(g)}updateStateForChar(a,u,g){let v=this.text[u]&255,w=Ul[a.getMode()][v]>0,I=null;for(let O=0;O<=Pa;O++){let F=Ul[O][v];if(F>0){if(I==null&&(I=a.endBinaryShift(u)),!w||O===a.getMode()||O===Ra){const q=I.latchAndAppend(O,F);g.push(q)}if(!w&&pc[a.getMode()][O]>=0){const q=I.shiftAndAppend(O,F);g.push(q)}}}if(a.getBinaryShiftByteCount()>0||Ul[a.getMode()][v]===0){let O=a.addBinaryShiftChar(u);g.push(O)}}static updateStateListForPair(a,u,g){const v=[];for(let w of a)this.updateStateForPair(w,u,g,v);return this.simplifyStates(v)}static updateStateForPair(a,u,g,v){let w=a.endBinaryShift(u);if(v.push(w.latchAndAppend(Pa,g)),a.getMode()!==Pa&&v.push(w.shiftAndAppend(Pa,g)),g===3||g===4){let I=w.latchAndAppend(Ra,16-g).latchAndAppend(Ra,1);v.push(I)}if(a.getBinaryShiftByteCount()>0){let I=a.addBinaryShiftChar(u).addBinaryShiftChar(u+1);v.push(I)}}static simplifyStates(a){let u=[];for(const g of a){let v=!0;for(const w of u){if(w.isBetterThanOrEqualTo(g)){v=!1;break}g.isBetterThanOrEqualTo(w)&&(u=u.filter(I=>I!==w))}v&&u.push(g)}return u}}class ar{constructor(){}static encodeBytes(a){return ar.encode(a,ar.DEFAULT_EC_PERCENT,ar.DEFAULT_AZTEC_LAYERS)}static encode(a,u,g){let v=new Ua(a).encode(),w=Xe.truncDivision(v.getSize()*u,100)+11,I=v.getSize()+w,O,F,q,te,ue;if(g!==ar.DEFAULT_AZTEC_LAYERS){if(O=g<0,F=Math.abs(g),F>(O?ar.MAX_NB_BITS_COMPACT:ar.MAX_NB_BITS))throw new K(ht.format("Illegal value %s for layers",g));q=ar.totalBitsInLayer(F,O),te=ar.WORD_SIZE[F];let mn=q-q%te;if(ue=ar.stuffBits(v,te),ue.getSize()+w>mn)throw new K("Data to large for user specified layer");if(O&&ue.getSize()>te*64)throw new K("Data to large for user specified layer")}else{te=0,ue=null;for(let mn=0;;mn++){if(mn>ar.MAX_NB_BITS)throw new K("Data too large for an Aztec code");if(O=mn<=3,F=O?mn+1:mn,q=ar.totalBitsInLayer(F,O),I>q)continue;(ue==null||te!==ar.WORD_SIZE[F])&&(te=ar.WORD_SIZE[F],ue=ar.stuffBits(v,te));let Ki=q-q%te;if(!(O&&ue.getSize()>te*64)&&ue.getSize()+w<=Ki)break}}let xe=ar.generateCheckWords(ue,q,te),Oe=ue.getSize()/te,ot=ar.generateModeMessage(O,F,Oe),ft=(O?11:14)+F*4,Rt=new Int32Array(ft),Ht;if(O){Ht=ft;for(let mn=0;mn<Rt.length;mn++)Rt[mn]=mn}else{Ht=ft+1+2*Xe.truncDivision(Xe.truncDivision(ft,2)-1,15);let mn=Xe.truncDivision(ft,2),Ki=Xe.truncDivision(Ht,2);for(let Zn=0;Zn<mn;Zn++){let is=Zn+Xe.truncDivision(Zn,15);Rt[mn-Zn-1]=Ki-is-1,Rt[mn+Zn]=Ki+is+1}}let An=new qt(Ht);for(let mn=0,Ki=0;mn<F;mn++){let Zn=(F-mn)*4+(O?9:12);for(let is=0;is<Zn;is++){let ga=is*2;for(let Fs=0;Fs<2;Fs++)xe.get(Ki+ga+Fs)&&An.set(Rt[mn*2+Fs],Rt[mn*2+is]),xe.get(Ki+Zn*2+ga+Fs)&&An.set(Rt[mn*2+is],Rt[ft-1-mn*2-Fs]),xe.get(Ki+Zn*4+ga+Fs)&&An.set(Rt[ft-1-mn*2-Fs],Rt[ft-1-mn*2-is]),xe.get(Ki+Zn*6+ga+Fs)&&An.set(Rt[ft-1-mn*2-is],Rt[mn*2+Fs])}Ki+=Zn*8}if(ar.drawModeMessage(An,O,Ht,ot),O)ar.drawBullsEye(An,Xe.truncDivision(Ht,2),5);else{ar.drawBullsEye(An,Xe.truncDivision(Ht,2),7);for(let mn=0,Ki=0;mn<Xe.truncDivision(ft,2)-1;mn+=15,Ki+=16)for(let Zn=Xe.truncDivision(Ht,2)&1;Zn<Ht;Zn+=2)An.set(Xe.truncDivision(Ht,2)-Ki,Zn),An.set(Xe.truncDivision(Ht,2)+Ki,Zn),An.set(Zn,Xe.truncDivision(Ht,2)-Ki),An.set(Zn,Xe.truncDivision(Ht,2)+Ki)}let wn=new Bl;return wn.setCompact(O),wn.setSize(Ht),wn.setLayers(F),wn.setCodeWords(Oe),wn.setMatrix(An),wn}static drawBullsEye(a,u,g){for(let v=0;v<g;v+=2)for(let w=u-v;w<=u+v;w++)a.set(w,u-v),a.set(w,u+v),a.set(u-v,w),a.set(u+v,w);a.set(u-g,u-g),a.set(u-g+1,u-g),a.set(u-g,u-g+1),a.set(u+g,u-g),a.set(u+g,u-g+1),a.set(u+g,u+g-1)}static generateModeMessage(a,u,g){let v=new mt;return a?(v.appendBits(u-1,2),v.appendBits(g-1,6),v=ar.generateCheckWords(v,28,4)):(v.appendBits(u-1,5),v.appendBits(g-1,11),v=ar.generateCheckWords(v,40,4)),v}static drawModeMessage(a,u,g,v){let w=Xe.truncDivision(g,2);if(u)for(let I=0;I<7;I++){let O=w-3+I;v.get(I)&&a.set(O,w-5),v.get(I+7)&&a.set(w+5,O),v.get(20-I)&&a.set(O,w+5),v.get(27-I)&&a.set(w-5,O)}else for(let I=0;I<10;I++){let O=w-5+I+Xe.truncDivision(I,5);v.get(I)&&a.set(O,w-7),v.get(I+10)&&a.set(w+7,O),v.get(29-I)&&a.set(O,w+7),v.get(39-I)&&a.set(w-7,O)}}static generateCheckWords(a,u,g){let v=a.getSize()/g,w=new ka(ar.getGF(g)),I=Xe.truncDivision(u,g),O=ar.bitsToWords(a,g,I);w.encode(O,I-v);let F=u%g,q=new mt;q.appendBits(0,F);for(const te of Array.from(O))q.appendBits(te,g);return q}static bitsToWords(a,u,g){let v=new Int32Array(g),w,I;for(w=0,I=a.getSize()/u;w<I;w++){let O=0;for(let F=0;F<u;F++)O|=a.get(w*u+F)?1<<u-F-1:0;v[w]=O}return v}static getGF(a){switch(a){case 4:return En.AZTEC_PARAM;case 6:return En.AZTEC_DATA_6;case 8:return En.AZTEC_DATA_8;case 10:return En.AZTEC_DATA_10;case 12:return En.AZTEC_DATA_12;default:throw new K("Unsupported word size "+a)}}static stuffBits(a,u){let g=new mt,v=a.getSize(),w=(1<<u)-2;for(let I=0;I<v;I+=u){let O=0;for(let F=0;F<u;F++)(I+F>=v||a.get(I+F))&&(O|=1<<u-1-F);(O&w)===w?(g.appendBits(O&w,u),I--):(O&w)===0?(g.appendBits(O|1,u),I--):g.appendBits(O,u)}return g}static totalBitsInLayer(a,u){return((u?88:112)+16*a)*a}}ar.DEFAULT_EC_PERCENT=33,ar.DEFAULT_AZTEC_LAYERS=0,ar.MAX_NB_BITS=32,ar.MAX_NB_BITS_COMPACT=4,ar.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class hl{encode(a,u,g,v){return this.encodeWithHints(a,u,g,v,null)}encodeWithHints(a,u,g,v,w){let I=$r.ISO_8859_1,O=ar.DEFAULT_EC_PERCENT,F=ar.DEFAULT_AZTEC_LAYERS;return w!=null&&(w.has(Ar.CHARACTER_SET)&&(I=Ll.forName(w.get(Ar.CHARACTER_SET).toString())),w.has(Ar.ERROR_CORRECTION)&&(O=Xe.parseInt(w.get(Ar.ERROR_CORRECTION).toString())),w.has(Ar.AZTEC_LAYERS)&&(F=Xe.parseInt(w.get(Ar.AZTEC_LAYERS).toString()))),hl.encodeLayers(a,u,g,v,I,O,F)}static encodeLayers(a,u,g,v,w,I,O){if(u!==Bt.AZTEC)throw new K("Can only encode AZTEC, but got "+u);let F=ar.encode(ht.getBytes(a,w),I,O);return hl.renderResult(F,g,v)}static renderResult(a,u,g){let v=a.getMatrix();if(v==null)throw new wi;let w=v.getWidth(),I=v.getHeight(),O=Math.max(u,w),F=Math.max(g,I),q=Math.min(O/w,F/I),te=(O-w*q)/2,ue=(F-I*q)/2,xe=new qt(O,F);for(let Oe=0,ot=ue;Oe<I;Oe++,ot+=q)for(let ft=0,Rt=te;ft<w;ft++,Rt+=q)v.get(ft,Oe)&&xe.setRegion(Rt,ot,q,q);return xe}}y.AbstractExpandedDecoder=Ke,y.ArgumentException=Y,y.ArithmeticException=ii,y.AztecCode=Bl,y.AztecCodeReader=Ye,y.AztecCodeWriter=hl,y.AztecDecoder=Gn,y.AztecDetector=Ue,y.AztecDetectorResult=tr,y.AztecEncoder=ar,y.AztecHighLevelEncoder=Ua,y.AztecPoint=ge,y.BarcodeFormat=Bt,y.Binarizer=ve,y.BinaryBitmap=_e,y.BitArray=mt,y.BitMatrix=qt,y.BitSource=Tr,y.BrowserAztecCodeReader=At,y.BrowserBarcodeReader=Bi,y.BrowserCodeReader=kt,y.BrowserDatamatrixCodeReader=sl,y.BrowserMultiFormatReader=ll,y.BrowserPDF417Reader=ks,y.BrowserQRCodeReader=ws,y.BrowserQRCodeSvgWriter=ja,y.CharacterSetECI=He,y.ChecksumException=we,y.Code128Reader=de,y.Code39Reader=qe,y.DataMatrixDecodedBitStreamParser=es,y.DataMatrixReader=Ba,y.DecodeHintType=Et,y.DecoderResult=nn,y.DefaultGridSampler=oe,y.DetectorResult=Li,y.EAN13Reader=$n,y.EncodeHintType=Ar,y.Exception=H,y.FormatException=rt,y.GenericGF=En,y.GenericGFPoly=Nn,y.GlobalHistogramBinarizer=Te,y.GridSampler=yr,y.GridSamplerInstance=le,y.HTMLCanvasElementLuminanceSource=sn,y.HybridBinarizer=Ze,y.ITFReader=xt,y.IllegalArgumentException=K,y.IllegalStateException=wi,y.InvertedLuminanceSource=Tt,y.LuminanceSource=ut,y.MathUtils=Rn,y.MultiFormatOneDReader=yi,y.MultiFormatReader=hc,y.MultiFormatWriter=ih,y.NotFoundException=ke,y.OneDReader=it,y.PDF417DecodedBitStreamParser=It,y.PDF417DecoderErrorCorrection=Zs,y.PDF417Reader=Xi,y.PDF417ResultMetadata=Ao,y.PerspectiveTransform=yt,y.PlanarYUVLuminanceSource=wa,y.QRCodeByteMatrix=vr,y.QRCodeDataMask=Is,y.QRCodeDecodedBitStreamParser=xr,y.QRCodeDecoderErrorCorrectionLevel=Fi,y.QRCodeDecoderFormatInformation=Wr,y.QRCodeEncoder=Ji,y.QRCodeEncoderQRCode=Fa,y.QRCodeMaskUtil=br,y.QRCodeMatrixUtil=xi,y.QRCodeMode=di,y.QRCodeReader=nr,y.QRCodeVersion=ti,y.QRCodeWriter=Na,y.RGBLuminanceSource=cl,y.RSS14Reader=ln,y.RSSExpandedReader=Zt,y.ReaderException=pa,y.ReedSolomonDecoder=Oi,y.ReedSolomonEncoder=ka,y.ReedSolomonException=si,y.Result=bt,y.ResultMetadataType=un,y.ResultPoint=on,y.StringUtils=ht,y.UnsupportedOperationException=_t,y.VideoInputDevice=Re,y.WhiteRectangleDetector=Di,y.WriterException=$i,y.ZXingArrays=Je,y.ZXingCharset=Ll,y.ZXingInteger=Xe,y.ZXingStandardCharsets=$r,y.ZXingStringBuilder=vt,y.ZXingStringEncoding=Pe,y.ZXingSystem=pe,y.createAbstractExpandedDecoder=Zi,Object.defineProperty(y,"__esModule",{value:!0})}))})(Ng,Ng.exports)),Ng.exports}var zs=$4();const K4=rp(zs),Q4=hb({__proto__:null,default:K4},[zs]);var $_=(function(){function c(d,y,C){if(this.formatMap=new Map([[fi.QR_CODE,zs.BarcodeFormat.QR_CODE],[fi.AZTEC,zs.BarcodeFormat.AZTEC],[fi.CODABAR,zs.BarcodeFormat.CODABAR],[fi.CODE_39,zs.BarcodeFormat.CODE_39],[fi.CODE_93,zs.BarcodeFormat.CODE_93],[fi.CODE_128,zs.BarcodeFormat.CODE_128],[fi.DATA_MATRIX,zs.BarcodeFormat.DATA_MATRIX],[fi.MAXICODE,zs.BarcodeFormat.MAXICODE],[fi.ITF,zs.BarcodeFormat.ITF],[fi.EAN_13,zs.BarcodeFormat.EAN_13],[fi.EAN_8,zs.BarcodeFormat.EAN_8],[fi.PDF_417,zs.BarcodeFormat.PDF_417],[fi.RSS_14,zs.BarcodeFormat.RSS_14],[fi.RSS_EXPANDED,zs.BarcodeFormat.RSS_EXPANDED],[fi.UPC_A,zs.BarcodeFormat.UPC_A],[fi.UPC_E,zs.BarcodeFormat.UPC_E],[fi.UPC_EAN_EXTENSION,zs.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Q4)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=y,this.logger=C;var D=this.createZXingFormats(d),P=new Map;P.set(zs.DecodeHintType.POSSIBLE_FORMATS,D),P.set(zs.DecodeHintType.TRY_HARDER,!1),this.hints=P}return c.prototype.decodeAsync=function(d){var y=this;return new Promise(function(C,D){try{C(y.decode(d))}catch(P){D(P)}})},c.prototype.decode=function(d){var y=new zs.MultiFormatReader(this.verbose,this.hints),C=new zs.HTMLCanvasElementLuminanceSource(d),D=new zs.BinaryBitmap(new zs.HybridBinarizer(C)),P=y.decode(D);return{text:P.text,format:R2.create(this.toHtml5QrcodeSupportedFormats(P.format)),debugData:this.createDebugData()}},c.prototype.createReverseFormatMap=function(){var d=new Map;return this.formatMap.forEach(function(y,C,D){d.set(y,C)}),d},c.prototype.toHtml5QrcodeSupportedFormats=function(d){if(!this.reverseFormatMap.has(d))throw"reverseFormatMap doesn't have ".concat(d);return this.reverseFormatMap.get(d)},c.prototype.createZXingFormats=function(d){for(var y=[],C=0,D=d;C<D.length;C++){var P=D[C];this.formatMap.has(P)?y.push(this.formatMap.get(P)):this.logger.logError("".concat(P," is not supported by")+"ZXingHtml5QrcodeShim")}return y},c.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},c})(),J4=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(K){N(K)}}function U(Y){try{H(C.throw(Y))}catch(K){N(K)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},eI=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},K_=(function(){function c(d,y,C){if(this.formatMap=new Map([[fi.QR_CODE,"qr_code"],[fi.AZTEC,"aztec"],[fi.CODABAR,"codabar"],[fi.CODE_39,"code_39"],[fi.CODE_93,"code_93"],[fi.CODE_128,"code_128"],[fi.DATA_MATRIX,"data_matrix"],[fi.ITF,"itf"],[fi.EAN_13,"ean_13"],[fi.EAN_8,"ean_8"],[fi.PDF_417,"pdf417"],[fi.UPC_A,"upc_a"],[fi.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!c.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=y,this.logger=C;var D=this.createBarcodeDetectorFormats(d);if(this.detector=new BarcodeDetector(D),!this.detector)throw"BarcodeDetector detector not supported"}return c.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var d=new BarcodeDetector({formats:["qr_code"]});return typeof d<"u"},c.prototype.decodeAsync=function(d){return J4(this,void 0,void 0,function(){var y,C;return eI(this,function(D){switch(D.label){case 0:return[4,this.detector.detect(d)];case 1:if(y=D.sent(),!y||y.length===0)throw"No barcode or QR code detected.";return C=this.selectLargestBarcode(y),[2,{text:C.rawValue,format:R2.create(this.toHtml5QrcodeSupportedFormats(C.format)),debugData:this.createDebugData()}]}})})},c.prototype.selectLargestBarcode=function(d){for(var y=null,C=0,D=0,P=d;D<P.length;D++){var N=P[D],h=N.boundingBox.width*N.boundingBox.height;h>C&&(C=h,y=N)}if(!y)throw"No largest barcode found";return y},c.prototype.createBarcodeDetectorFormats=function(d){for(var y=[],C=0,D=d;C<D.length;C++){var P=D[C];this.formatMap.has(P)?y.push(this.formatMap.get(P)):this.logger.warn("".concat(P," is not supported by")+"BarcodeDetectorDelegate")}return{formats:y}},c.prototype.toHtml5QrcodeSupportedFormats=function(d){if(!this.reverseFormatMap.has(d))throw"reverseFormatMap doesn't have ".concat(d);return this.reverseFormatMap.get(d)},c.prototype.createReverseFormatMap=function(){var d=new Map;return this.formatMap.forEach(function(y,C,D){d.set(y,C)}),d},c.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},c})(),Q_=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(K){N(K)}}function U(Y){try{H(C.throw(Y))}catch(K){N(K)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},J_=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},tI=(function(){function c(d,y,C,D){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=C,y&&K_.isSupported()?(this.primaryDecoder=new K_(d,C,D),this.secondaryDecoder=new $_(d,C,D)):this.primaryDecoder=new $_(d,C,D)}return c.prototype.decodeAsync=function(d){return Q_(this,void 0,void 0,function(){var y;return J_(this,function(C){switch(C.label){case 0:y=performance.now(),C.label=1;case 1:return C.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(d)];case 2:return[2,C.sent()];case 3:return this.possiblyLogPerformance(y),[7];case 4:return[2]}})})},c.prototype.decodeRobustlyAsync=function(d){return Q_(this,void 0,void 0,function(){var y,C;return J_(this,function(D){switch(D.label){case 0:y=performance.now(),D.label=1;case 1:return D.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(d)];case 2:return[2,D.sent()];case 3:if(C=D.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(d)];throw C;case 4:return this.possiblyLogPerformance(y),[7];case 5:return[2]}})})},c.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},c.prototype.possiblyLogPerformance=function(d){if(this.verbose){var y=performance.now()-d;this.executionResults.push(y),this.executions++,this.possiblyFlushPerformanceReport()}},c.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var d=0,y=0,C=this.executionResults;y<C.length;y++){var D=C[y];d+=D}var P=d/this.executionResults.length;console.log("".concat(P," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},c})(),Ix=(function(){var c=function(d,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,D){C.__proto__=D}||function(C,D){for(var P in D)Object.prototype.hasOwnProperty.call(D,P)&&(C[P]=D[P])},c(d,y)};return function(d,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(d,y);function C(){this.constructor=d}d.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)}})(),u1=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(K){N(K)}}function U(Y){try{H(C.throw(Y))}catch(K){N(K)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},h1=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},O2=(function(){function c(d,y){this.name=d,this.track=y}return c.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},c.prototype.apply=function(d){var y={};y[this.name]=d;var C={advanced:[y]};return this.track.applyConstraints(C)},c.prototype.value=function(){var d=this.track.getSettings();if(this.name in d){var y=d[this.name];return y}return null},c})(),nI=(function(c){Ix(d,c);function d(y,C){return c.call(this,y,C)||this}return d.prototype.min=function(){return this.getCapabilities().min},d.prototype.max=function(){return this.getCapabilities().max},d.prototype.step=function(){return this.getCapabilities().step},d.prototype.apply=function(y){var C={};C[this.name]=y;var D={advanced:[C]};return this.track.applyConstraints(D)},d.prototype.getCapabilities=function(){this.failIfNotSupported();var y=this.track.getCapabilities(),C=y[this.name];return{min:C.min,max:C.max,step:C.step}},d.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},d})(O2),iI=(function(c){Ix(d,c);function d(y){return c.call(this,"zoom",y)||this}return d})(nI),rI=(function(c){Ix(d,c);function d(y){return c.call(this,"torch",y)||this}return d})(O2),sI=(function(){function c(d){this.track=d}return c.prototype.zoomFeature=function(){return new iI(this.track)},c.prototype.torchFeature=function(){return new rI(this.track)},c})(),aI=(function(){function c(d,y,C){this.isClosed=!1,this.parentElement=d,this.mediaStream=y,this.callbacks=C,this.surface=this.createVideoElement(this.parentElement.clientWidth),d.append(this.surface)}return c.prototype.createVideoElement=function(d){var y=document.createElement("video");return y.style.width="".concat(d,"px"),y.style.display="block",y.muted=!0,y.setAttribute("muted","true"),y.playsInline=!0,y},c.prototype.setupSurface=function(){var d=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var y=function(){var C=d.surface.clientWidth,D=d.surface.clientHeight;d.callbacks.onRenderSurfaceReady(C,D),d.surface.removeEventListener("playing",y)};this.surface.addEventListener("playing",y),this.surface.srcObject=this.mediaStream,this.surface.play()},c.create=function(d,y,C,D){return u1(this,void 0,void 0,function(){var P,N;return h1(this,function(h){switch(h.label){case 0:return P=new c(d,y,D),C.aspectRatio?(N={aspectRatio:C.aspectRatio},[4,P.getFirstTrackOrFail().applyConstraints(N)]):[3,2];case 1:h.sent(),h.label=2;case 2:return P.setupSurface(),[2,P]}})})},c.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},c.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},c.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},c.prototype.resume=function(d){this.failIfClosed();var y=this,C=function(){setTimeout(d,200),y.surface.removeEventListener("playing",C)};this.surface.addEventListener("playing",C),this.surface.play()},c.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},c.prototype.getSurface=function(){return this.failIfClosed(),this.surface},c.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},c.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},c.prototype.applyVideoConstraints=function(d){return u1(this,void 0,void 0,function(){return h1(this,function(y){if("aspectRatio"in d)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(d)]})})},c.prototype.close=function(){if(this.isClosed)return Promise.resolve();var d=this;return new Promise(function(y,C){var D=d.mediaStream.getVideoTracks(),P=D.length,N=0;d.mediaStream.getVideoTracks().forEach(function(h){d.mediaStream.removeTrack(h),h.stop(),++N,N>=P&&(d.isClosed=!0,d.parentElement.removeChild(d.surface),y())})})},c.prototype.getCapabilities=function(){return new sI(this.getFirstTrackOrFail())},c})(),oI=(function(){function c(d){this.mediaStream=d}return c.prototype.render=function(d,y,C){return u1(this,void 0,void 0,function(){return h1(this,function(D){return[2,aI.create(d,this.mediaStream,y,C)]})})},c.create=function(d){return u1(this,void 0,void 0,function(){var y,C;return h1(this,function(D){switch(D.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return y={audio:!1,video:d},[4,navigator.mediaDevices.getUserMedia(y)];case 1:return C=D.sent(),[2,new c(C)]}})})},c})(),eb=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(K){N(K)}}function U(Y){try{H(C.throw(Y))}catch(K){N(K)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},tb=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},lI=(function(){function c(){}return c.failIfNotSupported=function(){return eb(this,void 0,void 0,function(){return tb(this,function(d){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new c]})})},c.prototype.create=function(d){return eb(this,void 0,void 0,function(){return tb(this,function(y){return[2,oI.create(d)]})})},c})(),cI=function(c,d,y,C){function D(P){return P instanceof y?P:new y(function(N){N(P)})}return new(y||(y=Promise))(function(P,N){function h(Y){try{H(C.next(Y))}catch(K){N(K)}}function U(Y){try{H(C.throw(Y))}catch(K){N(K)}}function H(Y){Y.done?P(Y.value):D(Y.value).then(h,U)}H((C=C.apply(c,d||[])).next())})},uI=function(c,d){var y={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,D,P,N;return N={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function h(H){return function(Y){return U([H,Y])}}function U(H){if(C)throw new TypeError("Generator is already executing.");for(;N&&(N=0,H[0]&&(y=0)),y;)try{if(C=1,D&&(P=H[0]&2?D.return:H[0]?D.throw||((P=D.return)&&P.call(D),0):D.next)&&!(P=P.call(D,H[1])).done)return P;switch(D=0,P&&(H=[H[0]&2,P.value]),H[0]){case 0:case 1:P=H;break;case 4:return y.label++,{value:H[1],done:!1};case 5:y.label++,D=H[1],H=[0];continue;case 7:H=y.ops.pop(),y.trys.pop();continue;default:if(P=y.trys,!(P=P.length>0&&P[P.length-1])&&(H[0]===6||H[0]===2)){y=0;continue}if(H[0]===3&&(!P||H[1]>P[0]&&H[1]<P[3])){y.label=H[1];break}if(H[0]===6&&y.label<P[1]){y.label=P[1],P=H;break}if(P&&y.label<P[2]){y.label=P[2],y.ops.push(H);break}P[2]&&y.ops.pop(),y.trys.pop();continue}H=d.call(c,y)}catch(Y){H=[6,Y],D=0}finally{C=P=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}},hI=(function(){function c(){}return c.retrieve=function(){if(navigator.mediaDevices)return c.getCamerasFromMediaDevices();var d=MediaStreamTrack;return MediaStreamTrack&&d.getSources?c.getCamerasFromMediaStreamTrack():c.rejectWithError()},c.rejectWithError=function(){var d=p0.unableToQuerySupportedDevices();return c.isHttpsOrLocalhost()||(d=p0.insecureContextCameraQueryError()),Promise.reject(d)},c.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var d=location.host.split(":")[0];return d==="127.0.0.1"||d==="localhost"},c.getCamerasFromMediaDevices=function(){return cI(this,void 0,void 0,function(){var d,y,C,D,P,N,h;return uI(this,function(U){switch(U.label){case 0:return d=function(H){for(var Y=H.getVideoTracks(),K=0,_e=Y;K<_e.length;K++){var we=_e[K];we.enabled=!1,we.stop(),H.removeTrack(we)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return y=U.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(C=U.sent(),D=[],P=0,N=C;P<N.length;P++)h=N[P],h.kind==="videoinput"&&D.push({id:h.deviceId,label:h.label});return d(y),[2,D]}})})},c.getCamerasFromMediaStreamTrack=function(){return new Promise(function(d,y){var C=function(P){for(var N=[],h=0,U=P;h<U.length;h++){var H=U[h];H.kind==="video"&&N.push({id:H.id,label:H.label})}d(N)},D=MediaStreamTrack;D.getSources(C)})},c})(),da;(function(c){c[c.UNKNOWN=0]="UNKNOWN",c[c.NOT_STARTED=1]="NOT_STARTED",c[c.SCANNING=2]="SCANNING",c[c.PAUSED=3]="PAUSED"})(da||(da={}));var dI=(function(){function c(){this.state=da.NOT_STARTED,this.onGoingTransactionNewState=da.UNKNOWN}return c.prototype.directTransition=function(d){this.failIfTransitionOngoing(),this.validateTransition(d),this.state=d},c.prototype.startTransition=function(d){return this.failIfTransitionOngoing(),this.validateTransition(d),this.onGoingTransactionNewState=d,this},c.prototype.execute=function(){if(this.onGoingTransactionNewState===da.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var d=this.onGoingTransactionNewState;this.onGoingTransactionNewState=da.UNKNOWN,this.directTransition(d)},c.prototype.cancel=function(){if(this.onGoingTransactionNewState===da.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=da.UNKNOWN},c.prototype.getState=function(){return this.state},c.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==da.UNKNOWN)throw"Cannot transition to a new state, already under transition"},c.prototype.validateTransition=function(d){switch(this.state){case da.UNKNOWN:throw"Transition from unknown is not allowed";case da.NOT_STARTED:this.failIfNewStateIs(d,[da.PAUSED]);break;case da.SCANNING:break;case da.PAUSED:break}},c.prototype.failIfNewStateIs=function(d,y){for(var C=0,D=y;C<D.length;C++){var P=D[C];if(d===P)throw"Cannot transition from ".concat(this.state," to ").concat(d)}},c})(),fI=(function(){function c(d){this.stateManager=d}return c.prototype.startTransition=function(d){return this.stateManager.startTransition(d)},c.prototype.directTransition=function(d){this.stateManager.directTransition(d)},c.prototype.getState=function(){return this.stateManager.getState()},c.prototype.canScanFile=function(){return this.stateManager.getState()===da.NOT_STARTED},c.prototype.isScanning=function(){return this.stateManager.getState()!==da.NOT_STARTED},c.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===da.SCANNING},c.prototype.isPaused=function(){return this.stateManager.getState()===da.PAUSED},c})(),pI=(function(){function c(){}return c.create=function(){return new fI(new dI)},c})(),gI=(function(){var c=function(d,y){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,D){C.__proto__=D}||function(C,D){for(var P in D)Object.prototype.hasOwnProperty.call(D,P)&&(C[P]=D[P])},c(d,y)};return function(d,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");c(d,y);function C(){this.constructor=d}d.prototype=y===null?Object.create(y):(C.prototype=y.prototype,new C)}})(),cc=(function(c){gI(d,c);function d(){return c!==null&&c.apply(this,arguments)||this}return d.DEFAULT_WIDTH=300,d.DEFAULT_WIDTH_OFFSET=2,d.FILE_SCAN_MIN_HEIGHT=300,d.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,d.MIN_QR_BOX_SIZE=50,d.SHADED_LEFT=1,d.SHADED_RIGHT=2,d.SHADED_TOP=3,d.SHADED_BOTTOM=4,d.SHADED_REGION_ELEMENT_ID="qr-shaded-region",d.VERBOSE=!1,d.BORDER_SHADER_DEFAULT_COLOR="#ffffff",d.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",d})(Z4),mI=(function(){function c(d,y){this.logger=y,this.fps=cc.SCAN_DEFAULT_FPS,d?(d.fps&&(this.fps=d.fps),this.disableFlip=d.disableFlip===!0,this.qrbox=d.qrbox,this.aspectRatio=d.aspectRatio,this.videoConstraints=d.videoConstraints):this.disableFlip=cc.DEFAULT_DISABLE_FLIP}return c.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?P2.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},c.prototype.isShadedBoxEnabled=function(){return!Lh(this.qrbox)},c.create=function(d,y){return new c(d,y)},c})(),yI=(function(){function c(d,y){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(d))throw"HTML Element with id=".concat(d," not found");this.elementId=d,this.verbose=!1;var C;typeof y=="boolean"?this.verbose=y===!0:y&&(C=y,this.verbose=C.verbose===!0,C.experimentalFeatures),this.logger=new W4(this.verbose),this.qrcode=new tI(this.getSupportedFormats(y),this.getUseBarCodeDetectorIfSupported(C),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=pI.create()}return c.prototype.start=function(d,y,C,D){var P=this;if(!d)throw"cameraIdOrConfig is required";if(!C||typeof C!="function")throw"qrCodeSuccessCallback is required and should be a function.";var N;D?N=D:N=this.verbose?this.logger.log:function(){};var h=mI.create(y,this.logger);this.clearElement();var U=!1;h.videoConstraints&&(h.isMediaStreamConstraintsValid()?U=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var H=U,Y=document.getElementById(this.elementId);Y.clientWidth?Y.clientWidth:cc.DEFAULT_WIDTH,Y.style.position="relative",this.shouldScan=!0,this.element=Y;var K=this,_e=this.stateManagerProxy.startTransition(da.SCANNING);return new Promise(function(we,ve){var pe=H?h.videoConstraints:K.createVideoConstraints(d);if(!pe){_e.cancel(),ve("videoConstraints should be defined");return}var he={};(!H||h.aspectRatio)&&(he.aspectRatio=h.aspectRatio);var De={onRenderSurfaceReady:function(Je,Xe){K.setupUi(Je,Xe,h),K.isScanning=!0,K.foreverScan(h,C,N)}};lI.failIfNotSupported().then(function(Je){Je.create(pe).then(function(Xe){return Xe.render(P.element,he,De).then(function(mt){K.renderedCamera=mt,_e.execute(),we(null)}).catch(function(mt){_e.cancel(),ve(mt)})}).catch(function(Xe){_e.cancel(),ve(p0.errorGettingUserMedia(Xe))})}).catch(function(Je){_e.cancel(),ve(p0.cameraStreamingNotSupported())})})},c.prototype.pause=function(d){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(da.PAUSED),this.showPausedState(),(Lh(d)||d!==!0)&&(d=!1),d&&this.renderedCamera&&this.renderedCamera.pause()},c.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var d=this,y=function(){d.stateManagerProxy.directTransition(da.SCANNING),d.hidePausedState()};if(!this.renderedCamera.isPaused()){y();return}this.renderedCamera.resume(function(){y()})},c.prototype.getState=function(){return this.stateManagerProxy.getState()},c.prototype.stop=function(){var d=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var y=this.stateManagerProxy.startTransition(da.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var C=function(){if(d.element){var P=document.getElementById(cc.SHADED_REGION_ELEMENT_ID);P&&d.element.removeChild(P)}},D=this;return this.renderedCamera.close().then(function(){return D.renderedCamera=null,D.element&&(D.element.removeChild(D.canvasElement),D.canvasElement=null),C(),D.qrRegion&&(D.qrRegion=null),D.context&&(D.context=null),y.execute(),D.hidePausedState(),D.isScanning=!1,Promise.resolve()})},c.prototype.scanFile=function(d,y){return this.scanFileV2(d,y).then(function(C){return C.decodedText})},c.prototype.scanFileV2=function(d,y){var C=this;if(!d||!(d instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Lh(y)&&(y=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(D,P){C.possiblyCloseLastScanImageFile(),C.clearElement(),C.lastScanImageFile=URL.createObjectURL(d);var N=new Image;N.onload=function(){var h=N.width,U=N.height,H=document.getElementById(C.elementId),Y=H.clientWidth?H.clientWidth:cc.DEFAULT_WIDTH,K=Math.max(H.clientHeight?H.clientHeight:U,cc.FILE_SCAN_MIN_HEIGHT),_e=C.computeCanvasDrawConfig(h,U,Y,K);if(y){var we=C.createCanvasElement(Y,K,"qr-canvas-visible");we.style.display="inline-block",H.appendChild(we);var ve=we.getContext("2d");if(!ve)throw"Unable to get 2d context from canvas";ve.canvas.width=Y,ve.canvas.height=K,ve.drawImage(N,0,0,h,U,_e.x,_e.y,_e.width,_e.height)}var pe=cc.FILE_SCAN_HIDDEN_CANVAS_PADDING,he=Math.max(N.width,_e.width),De=Math.max(N.height,_e.height),Je=he+2*pe,Xe=De+2*pe,mt=C.createCanvasElement(Je,Xe);H.appendChild(mt);var Wt=mt.getContext("2d");if(!Wt)throw"Unable to get 2d context from canvas";Wt.canvas.width=Je,Wt.canvas.height=Xe,Wt.drawImage(N,0,0,h,U,pe,pe,he,De);try{C.qrcode.decodeRobustlyAsync(mt).then(function(Et){D(W_.createFromQrcodeResult(Et))}).catch(P)}catch(Et){P("QR code parse error, error = ".concat(Et))}},N.onerror=P,N.onabort=P,N.onstalled=P,N.onsuspend=P,N.src=URL.createObjectURL(d)})},c.prototype.clear=function(){this.clearElement()},c.getCameras=function(){return hI.retrieve()},c.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},c.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},c.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},c.prototype.applyVideoConstraints=function(d){if(d){if(!P2.isMediaStreamConstraintsValid(d,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(d)},c.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},c.prototype.getSupportedFormats=function(d){var y=[fi.QR_CODE,fi.AZTEC,fi.CODABAR,fi.CODE_39,fi.CODE_93,fi.CODE_128,fi.DATA_MATRIX,fi.MAXICODE,fi.ITF,fi.EAN_13,fi.EAN_8,fi.PDF_417,fi.RSS_14,fi.RSS_EXPANDED,fi.UPC_A,fi.UPC_E,fi.UPC_EAN_EXTENSION];if(!d||typeof d=="boolean"||!d.formatsToSupport)return y;if(!Array.isArray(d.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(d.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var C=[],D=0,P=d.formatsToSupport;D<P.length;D++){var N=P[D];q4(N)?C.push(N):this.logger.warn("Invalid format: ".concat(N," passed in config, ignoring."))}if(C.length===0)throw"None of formatsToSupport match supported values.";return C},c.prototype.getUseBarCodeDetectorIfSupported=function(d){if(Lh(d))return!0;if(!Lh(d.useBarCodeDetectorIfSupported))return d.useBarCodeDetectorIfSupported!==!1;if(Lh(d.experimentalFeatures))return!0;var y=d.experimentalFeatures;return Lh(y.useBarCodeDetectorIfSupported)?!0:y.useBarCodeDetectorIfSupported!==!1},c.prototype.validateQrboxSize=function(d,y,C){var D=this,P=C.qrbox;this.validateQrboxConfig(P);var N=this.toQrdimensions(d,y,P),h=function(H){if(H<cc.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(cc.MIN_QR_BOX_SIZE,"px.")},U=function(H){return H>d&&(D.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),H=d),H};h(N.width),h(N.height),N.width=U(N.width)},c.prototype.validateQrboxConfig=function(d){if(typeof d!="number"&&typeof d!="function"&&(d.width===void 0||d.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},c.prototype.toQrdimensions=function(d,y,C){if(typeof C=="number")return{width:C,height:C};if(typeof C=="function")try{return C(d,y)}catch(D){throw new Error("qrbox config was passed as a function but it failed with unknown error"+D)}return C},c.prototype.setupUi=function(d,y,C){C.isShadedBoxEnabled()&&this.validateQrboxSize(d,y,C);var D=Lh(C.qrbox)?{width:d,height:y}:C.qrbox;this.validateQrboxConfig(D);var P=this.toQrdimensions(d,y,D);P.height>y&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var N=C.isShadedBoxEnabled()&&P.height<=y,h={x:0,y:0,width:d,height:y},U=N?this.getShadedRegionBounds(d,y,P):h,H=this.createCanvasElement(U.width,U.height),Y={willReadFrequently:!0},K=H.getContext("2d",Y);K.canvas.width=U.width,K.canvas.height=U.height,this.element.append(H),N&&this.possiblyInsertShadingElement(this.element,d,y,P),this.createScannerPausedUiElement(this.element),this.qrRegion=U,this.context=K,this.canvasElement=H},c.prototype.createScannerPausedUiElement=function(d){var y=document.createElement("div");y.innerText=p0.scannerPaused(),y.style.display="none",y.style.position="absolute",y.style.top="0px",y.style.zIndex="1",y.style.background="rgba(9, 9, 9, 0.46)",y.style.color="#FFECEC",y.style.textAlign="center",y.style.width="100%",d.appendChild(y),this.scannerPausedUiElement=y},c.prototype.scanContext=function(d,y){var C=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(D){return d(D.text,W_.createFromQrcodeResult(D)),C.possiblyUpdateShaders(!0),!0}).catch(function(D){C.possiblyUpdateShaders(!1);var P=p0.codeParseError(D);return y(P,X4.createFrom(P)),!1})},c.prototype.foreverScan=function(d,y,C){var D=this;if(this.shouldScan&&this.renderedCamera){var P=this.renderedCamera.getSurface(),N=P.videoWidth/P.clientWidth,h=P.videoHeight/P.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var U=this.qrRegion.width*N,H=this.qrRegion.height*h,Y=this.qrRegion.x*N,K=this.qrRegion.y*h;this.context.drawImage(P,Y,K,U,H,0,0,this.qrRegion.width,this.qrRegion.height);var _e=function(){D.foreverScanTimeout=setTimeout(function(){D.foreverScan(d,y,C)},D.getTimeoutFps(d.fps))};this.scanContext(y,C).then(function(we){!we&&d.disableFlip!==!0?(D.context.translate(D.context.canvas.width,0),D.context.scale(-1,1),D.scanContext(y,C).finally(function(){_e()})):_e()}).catch(function(we){D.logger.logError("Error happend while scanning context",we),_e()})}},c.prototype.createVideoConstraints=function(d){if(typeof d=="string")return{deviceId:{exact:d}};if(typeof d=="object"){var y="facingMode",C="deviceId",D={user:!0,environment:!0},P="exact",N=function(ve){if(ve in D)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(ve,"'")},h=Object.keys(d);if(h.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(h.length," keys");var U=Object.keys(d)[0];if(U!==y&&U!==C)throw"Only '".concat(y,"' and '").concat(C,"' ")+" are supported for 'cameraIdOrConfig'";if(U===y){var H=d.facingMode;if(typeof H=="string"){if(N(H))return{facingMode:H}}else if(typeof H=="object")if(P in H){if(N(H["".concat(P)]))return{facingMode:{exact:H["".concat(P)]}}}else throw"'facingMode' should be string or object with"+" ".concat(P," as key.");else{var Y=typeof H;throw"Invalid type of 'facingMode' = ".concat(Y)}}else{var K=d.deviceId;if(typeof K=="string")return{deviceId:K};if(typeof K=="object"){if(P in K)return{deviceId:{exact:K["".concat(P)]}};throw"'deviceId' should be string or object with"+" ".concat(P," as key.")}else{var _e=typeof K;throw"Invalid type of 'deviceId' = ".concat(_e)}}}var we=typeof d;throw"Invalid type of 'cameraIdOrConfig' = ".concat(we)},c.prototype.computeCanvasDrawConfig=function(d,y,C,D){if(d<=C&&y<=D){var P=(C-d)/2,N=(D-y)/2;return{x:P,y:N,width:d,height:y}}else{var h=d,U=y;return d>C&&(y=C/d*y,d=C),y>D&&(d=D/y*d,y=D),this.logger.log("Image downsampled from "+"".concat(h,"X").concat(U)+" to ".concat(d,"X").concat(y,".")),this.computeCanvasDrawConfig(d,y,C,D)}},c.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var d=document.getElementById(this.elementId);d&&(d.innerHTML="")},c.prototype.possiblyUpdateShaders=function(d){this.qrMatch!==d&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(y){y.style.backgroundColor=d?cc.BORDER_SHADER_MATCH_COLOR:cc.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=d)},c.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},c.prototype.createCanvasElement=function(d,y,C){var D=d,P=y,N=document.createElement("canvas");return N.style.width="".concat(D,"px"),N.style.height="".concat(P,"px"),N.style.display="none",N.id=Lh(C)?"qr-canvas":C,N},c.prototype.getShadedRegionBounds=function(d,y,C){if(C.width>d||C.height>y)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(d-C.width)/2,y:(y-C.height)/2,width:C.width,height:C.height}},c.prototype.possiblyInsertShadingElement=function(d,y,C,D){if(!(y-D.width<1||C-D.height<1)){var P=document.createElement("div");P.style.position="absolute";var N=(y-D.width)/2,h=(C-D.height)/2;if(P.style.borderLeft="".concat(N,"px solid rgba(0, 0, 0, 0.48)"),P.style.borderRight="".concat(N,"px solid rgba(0, 0, 0, 0.48)"),P.style.borderTop="".concat(h,"px solid rgba(0, 0, 0, 0.48)"),P.style.borderBottom="".concat(h,"px solid rgba(0, 0, 0, 0.48)"),P.style.boxSizing="border-box",P.style.top="0px",P.style.bottom="0px",P.style.left="0px",P.style.right="0px",P.id="".concat(cc.SHADED_REGION_ELEMENT_ID),y-D.width<11||C-D.height<11)this.hasBorderShaders=!1;else{var U=5,H=40;this.insertShaderBorders(P,H,U,-U,null,0,!0),this.insertShaderBorders(P,H,U,-U,null,0,!1),this.insertShaderBorders(P,H,U,null,-U,0,!0),this.insertShaderBorders(P,H,U,null,-U,0,!1),this.insertShaderBorders(P,U,H+U,-U,null,-U,!0),this.insertShaderBorders(P,U,H+U,null,-U,-U,!0),this.insertShaderBorders(P,U,H+U,-U,null,-U,!1),this.insertShaderBorders(P,U,H+U,null,-U,-U,!1),this.hasBorderShaders=!0}d.append(P)}},c.prototype.insertShaderBorders=function(d,y,C,D,P,N,h){var U=document.createElement("div");U.style.position="absolute",U.style.backgroundColor=cc.BORDER_SHADER_DEFAULT_COLOR,U.style.width="".concat(y,"px"),U.style.height="".concat(C,"px"),D!==null&&(U.style.top="".concat(D,"px")),P!==null&&(U.style.bottom="".concat(P,"px")),h?U.style.left="".concat(N,"px"):U.style.right="".concat(N,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(U),d.appendChild(U)},c.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},c.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},c.prototype.getTimeoutFps=function(d){return 1e3/d},c})(),nb;(function(c){c[c.STATUS_DEFAULT=0]="STATUS_DEFAULT",c[c.STATUS_SUCCESS=1]="STATUS_SUCCESS",c[c.STATUS_WARNING=2]="STATUS_WARNING",c[c.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(nb||(nb={}));const xI=({onCancel:c,onScan:d,isProcessing:y=!1})=>{const C=me.useRef(null),[D,P]=me.useState(null),[N,h]=me.useState(!0),U=me.useRef(!1);me.useEffect(()=>{let Y=!0;const _e=setTimeout(async()=>{try{const we=new yI("qr-reader-element",{verbose:!1});C.current=we,await we.start({facingMode:"environment"},{fps:10,qrbox:(ve,pe)=>{const he=Math.min(ve,pe),De=Math.floor(he*.75);return{width:De,height:De}},aspectRatio:1},ve=>{U.current||(U.current=!0,we.stop().then(()=>{d(ve)}).catch(console.error))},()=>{}),Y&&h(!1)}catch(we){console.error("[QRScanPage] Camera error:",we),Y&&(P(we.message||"Failed to access camera"),h(!1))}},150);return()=>{Y=!1,clearTimeout(_e),C.current&&(C.current.stop().catch(()=>{}),C.current=null)}},[d]);const H=async()=>{if(C.current){try{await C.current.stop()}catch{}C.current=null}c()};return y?null:k.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black flex flex-col",children:[k.jsx("button",{onClick:H,className:"absolute top-6 right-6 p-3 rounded-full bg-white/10 text-white z-20",children:k.jsx(vo,{size:24})}),k.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[N&&k.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:k.jsx("div",{className:"text-white/60 text-sm animate-pulse",children:"Starting camera..."})}),D?k.jsxs("div",{className:"p-6 bg-red-500/10 border border-red-500/30 rounded-2xl text-center",children:[k.jsx("div",{className:"text-red-400 font-bold mb-2",children:"Camera Error"}),k.jsx("div",{className:"text-red-300/80 text-sm mb-4",children:D}),k.jsx("button",{onClick:H,className:"px-4 py-2 bg-red-500 text-white rounded-lg font-bold",children:"Go Back"})]}):k.jsxs(k.Fragment,{children:[k.jsx("div",{id:"qr-reader-element",className:"w-full h-full"}),k.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[k.jsx("div",{className:"absolute top-0 left-0 right-0 h-[20%] bg-black/60"}),k.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[20%] bg-black/60"}),k.jsx("div",{className:"absolute top-[20%] left-0 w-[12.5%] h-[60%] bg-black/60"}),k.jsx("div",{className:"absolute top-[20%] right-0 w-[12.5%] h-[60%] bg-black/60"}),k.jsx("div",{className:"absolute top-[20%] left-[12.5%] right-[12.5%] h-[60%] border-2 border-white/50 rounded-2xl"})]})]})]}),k.jsxs("div",{className:"p-6 text-center shrink-0",children:[k.jsx("p",{className:"text-white/60 text-sm",children:"Point camera at a Parlens QR code"}),k.jsx("button",{onClick:async()=>{const Y=prompt("Enter QR code manually:");if(Y){if(U.current)return;if(U.current=!0,C.current){try{await C.current.stop()}catch{}C.current=null}d(Y)}},className:"mt-4 text-blue-400 text-sm font-bold",children:"Enter code manually"})]})]})},_I=()=>{const{login:c}=nh(),[d,y]=me.useState(""),[C,D]=me.useState(""),[P,N]=me.useState(!1),[h,U]=me.useState("landing"),[H,Y]=me.useState(""),[K,_e]=me.useState(null),we=async De=>{N(!0),D("");try{await c(De,De==="nsec"?d:void 0)}catch(Je){D(Je.message)}finally{N(!1)}},ve=()=>{U("setup")},pe=async()=>{if(!H.trim()){D("Please enter a username");return}N(!0);try{const{generateSecretKey:De,getPublicKey:Je}=await Qm(async()=>{const{generateSecretKey:at,getPublicKey:He}=await Promise.resolve().then(()=>Oy);return{generateSecretKey:at,getPublicKey:He}},void 0),Xe=at=>Array.from(at).map(He=>He.toString(16).padStart(2,"0")).join(""),mt=De(),Wt=Je(mt);localStorage.setItem("parlens_privkey",Xe(mt)),localStorage.setItem("parlens_pubkey",Wt),localStorage.setItem("parlens_pending_username",H);const Et=Qf.npubEncode(Wt),rt=Qf.nsecEncode(mt);_e({npub:Et,nsec:rt}),U("backup")}catch(De){D(De.message)}finally{N(!1)}},he=async()=>{N(!0);try{const De=localStorage.getItem("parlens_pending_username");await c("create",void 0,De||H),localStorage.removeItem("parlens_pending_username")}catch(De){D(De.message)}finally{N(!1)}};return k.jsx("div",{className:"min-h-screen bg-zinc-50 dark:bg-black p-6 text-zinc-900 dark:text-white text-center overflow-y-auto no-scrollbar flex flex-col items-center justify-center transition-colors duration-300",style:{paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:k.jsxs("div",{className:"w-full max-w-sm space-y-12 animate-in fade-in zoom-in-95 duration-700",children:[k.jsxs("div",{className:"space-y-4",children:[k.jsx("img",{src:"/parlens-pwa/pwa-512x512.png",alt:"Parlens",className:"mx-auto h-24 w-24 rounded-[22%] shadow-2xl shadow-[#007AFF]/20"}),k.jsx("h1",{className:"text-5xl font-extrabold tracking-tighter text-zinc-900 dark:text-white",children:"Parlens"}),k.jsx("p",{className:"text-sm font-medium text-zinc-500 dark:text-white/40 tracking-tight",children:"Decentralised Parking Management"})]}),k.jsxs("div",{className:"space-y-4",children:[h==="landing"?k.jsxs(k.Fragment,{children:[k.jsx("button",{onClick:ve,disabled:P,className:"w-full h-16 rounded-3xl bg-white dark:bg-white text-black font-bold text-lg shadow-xl shadow-black/5 dark:shadow-none active:scale-95 transition-all flex items-center justify-center gap-3 border border-black/5 dark:border-transparent",children:P?"Creating...":k.jsxs(k.Fragment,{children:[k.jsx(_T,{size:20,strokeWidth:3}),"Create a New Account"]})}),k.jsxs("button",{onClick:()=>U("nsec"),disabled:P,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold text-lg shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:[k.jsx(Py,{size:18}),"Login with Nostr Account"]})]}):h==="setup"?k.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-right-4",children:[k.jsxs("div",{className:"text-center pb-2",children:[k.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:"Pick a Username"}),k.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm",children:"This will be your identity on Nostr"})]}),k.jsx("input",{type:"text",placeholder:"Username",value:H,onChange:De=>Y(De.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 text-left leading-relaxed mt-2 pl-2",children:"Your username can be any combination of letters, numbers or special characters and doesnt have to be unique."}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:()=>U("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),k.jsx("button",{onClick:pe,disabled:P||!H,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:P?"Creating...":"Continue"})]})]}):h==="backup"?k.jsxs("div",{className:"space-y-6 pt-4 animate-in slide-in-from-right-4 text-left",children:[k.jsxs("div",{className:"text-center pb-2",children:[k.jsx("h3",{className:"text-xl font-bold text-zinc-900 dark:text-white",children:" Account Created!"}),k.jsx("p",{className:"text-zinc-500 dark:text-white/40 text-sm mt-1",children:"Backup your keys before continuing"})]}),k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"space-y-0.5 rounded-[2rem] overflow-hidden bg-white dark:bg-white/[0.03] border border-black/5 dark:border-white/10 shadow-sm dark:shadow-none",children:[k.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{K&&(navigator.clipboard.writeText(K.npub),alert("Copied to clipboard"))},children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-blue-500/10 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400",children:k.jsx(Py,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Public Key (Npub)"})]}),k.jsx(tp,{size:18,className:"text-zinc-400 dark:text-white/20"})]}),k.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 mx-4"}),k.jsxs("div",{className:"p-5 flex items-center justify-between transition-colors cursor-pointer active:bg-black/5 dark:active:bg-white/10",onClick:()=>{K&&(navigator.clipboard.writeText(K.nsec),alert("Copied to clipboard"))},children:[k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"p-2.5 rounded-xl bg-red-500/10 dark:bg-red-500/20 text-red-600 dark:text-red-500",children:k.jsx(a2,{size:20})}),k.jsx("span",{className:"font-semibold text-sm text-zinc-900 dark:text-white",children:"Copy Nostr Secret Key (Nsec)"})]}),k.jsx(tp,{size:18,className:"text-zinc-400 dark:text-white/20"})]})]}),k.jsx("p",{className:"text-xs text-zinc-400 dark:text-white/30 mt-2 ml-2 leading-relaxed text-left",children:"Your keys manage your identity on Nostr. Npub is your unique public identifier. It is used to link your data to your account. Nsec is the password that proves your ownership of the account. It validates and encrypts your data."})]}),k.jsxs("div",{className:"space-y-6 pt-6 border-t border-black/5 dark:border-white/10",children:[k.jsxs("div",{className:"space-y-2",children:[k.jsx("h3",{className:"text-lg font-bold text-zinc-900 dark:text-white",children:"Getting Started"}),k.jsx("p",{className:"text-sm text-zinc-500 dark:text-white/60",children:"Follow these steps to get the most out of Parlens."})]}),k.jsxs("div",{className:"space-y-4 text-sm text-zinc-600 dark:text-white/60 leading-relaxed",children:[k.jsxs("div",{children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Seekers"}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Select Vehicle Type"}),"Use the vertical toggle to switch between Bicycle , Motorcycle , or Car . Your vehicle type determines what parking spots you see on the map."]}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Find Parking"}),"Click the blue search button to find parking around you or plan ahead by searching for parking near your destination by clicking the search for parking bubble at the top of your screen."]}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"3. Mark Your Spot"}),"Once you find a spot, click the amber parking location button to mark your parked location and start your session. Click the session active bubble centre the map your parking marker at any time during the session."]}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"4. Log Your Session"}),"When youre ready to leave, click the green vehicle button to remove the marker, report the fees and log the session in your parking history."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"5. Share Parking Reports (Optional)"}),"Anonymously report parking details to help other users know where to find parking; and build more parking features in the future. The opt-in switch is available in the parking areas section on the profile page."]})]}),k.jsxs("div",{className:"mt-8 pt-4",children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-4",children:"Parking Service Providers"}),k.jsxs("p",{className:"mb-4",children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"1. Listed Parking"}),"Users who oversee one or more parking spots can create a listing to simplify spot discovery and management. Click the parking services button () and select listed parking.",k.jsx("br",{}),k.jsx("br",{}),"Click the + button to create a listing and provide the details as requested in the form to create one or more online spots to match your real world location."]}),k.jsxs("p",{children:[k.jsx("strong",{className:"text-zinc-900 dark:text-white block mb-1",children:"2. Valet Parking"}),"Users who park for others can enable valet mode to manage multiple parking sessions at the same time. Click the parking services button () and select valet parking to get started.",k.jsx("br",{}),k.jsx("br",{}),"Click the + button to create a new valet session. Ask your clients to scan the QR code using the Parlens app to see the parking location and let you know when theyre ready to leave."]})]}),k.jsxs("div",{className:"mt-6 pt-4 space-y-6",children:[k.jsxs("div",{children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"User Privacy"}),k.jsx("p",{className:"mb-4",children:"Parlens does not collect or share any personal data. Parking history and saved routes are encrypted by your keys and only accessible by you. If you ever feel like your privacy is compromised, delete your account, abandon your keys and create a new account."})]}),k.jsxs("div",{children:[k.jsx("h4",{className:"font-bold text-zinc-900 dark:text-white text-base mb-2",children:"License"}),k.jsx("p",{children:"This project is licensed under the GNU General Public License v3.0."})]})]})]})]}),k.jsx("button",{onClick:he,disabled:P,className:"w-full h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg shadow-[#007AFF]/20 active:scale-95 transition-all flex items-center justify-center gap-2",children:P?"Starting...":"Start Using Parlens"})]}):k.jsxs("div",{className:"space-y-4 pt-4 animate-in slide-in-from-bottom-4",children:[k.jsx("input",{type:"password",placeholder:"Paste your nsec...",value:d,onChange:De=>y(De.target.value),className:"w-full h-16 rounded-3xl bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/10 px-6 text-zinc-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#007AFF] placeholder:text-zinc-400 dark:placeholder:text-white/20 shadow-sm dark:shadow-none",autoFocus:!0}),k.jsxs("div",{className:"flex gap-3",children:[k.jsx("button",{onClick:()=>U("landing"),className:"h-16 px-6 rounded-3xl bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white border border-black/5 dark:border-white/10 font-bold shadow-sm dark:shadow-none",children:"Back"}),k.jsx("button",{onClick:()=>we("nsec"),disabled:P||!d,className:"flex-1 h-16 rounded-3xl bg-[#007AFF] text-white font-bold shadow-lg active:scale-95 transition-all",children:P?"Decrypting...":"Login with Key"})]})]}),C&&k.jsx("div",{className:"p-4 rounded-3xl bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-500 text-xs font-bold text-center animate-in fade-in slide-in-from-top-2",children:C}),k.jsxs("div",{className:"space-y-3 pt-6 border-t border-black/5 dark:border-white/10",children:[k.jsx("h3",{className:"text-center font-bold text-zinc-500 dark:text-white/70 text-sm",children:"Add to your homescreen for fullscreen experience"}),k.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[k.jsxs("button",{onClick:()=>{document.getElementById("login-android-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Browser Menu (Android)"}),k.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsxs("div",{id:"login-android-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:[k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80",children:"Chrome & Brave:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add to Home screen"})]}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Add"})," to confirm"]})]}),k.jsx("p",{className:"font-semibold text-zinc-900 dark:text-white/80 mt-3",children:"Firefox:"}),k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsx("li",{children:"Tap menu button (three dots)"}),k.jsxs("li",{children:["Tap ",k.jsx("strong",{children:"Install"})]})]})]})]}),k.jsxs("div",{className:"rounded-2xl bg-white dark:bg-white/5 overflow-hidden shadow-sm dark:shadow-none border border-black/5 dark:border-transparent",children:[k.jsxs("button",{onClick:()=>{document.getElementById("login-ios-guide")?.classList.toggle("hidden")},className:"w-full flex items-center justify-between p-4 font-bold text-sm text-left text-zinc-800 dark:text-white/80 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:[k.jsx("span",{children:"Using Share Button (iOS)"}),k.jsx(Fd,{size:16,className:"text-zinc-400 dark:text-white/50"})]}),k.jsx("div",{id:"login-ios-guide",className:"hidden p-4 pt-0 text-xs text-zinc-600 dark:text-white/60 space-y-2 text-left",children:k.jsxs("ol",{className:"list-decimal pl-5 space-y-1",children:[k.jsxs("li",{children:["Tap the ",k.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Share"})," button in Safari menu bar."]}),k.jsxs("li",{children:["Scroll down and tap ",k.jsx("strong",{className:"text-zinc-900 dark:text-white/80",children:"Add to Home Screen"}),"."]}),k.jsx("li",{children:"Launch Parlens from your home screen."})]})})]})]})]})]})})},bI=()=>{const{pubkey:c,refreshConnections:d}=nh(),[y,C]=me.useState("home"),[D,P]=me.useState(null),[N,h]=me.useState(!1);return Qs.useEffect(()=>{let U=0;const H=()=>{if(document.visibilityState==="hidden")U=Date.now(),console.log("[App] Backgrounded at",new Date().toISOString());else if(document.visibilityState==="visible"&&U>0){const K=Date.now()-U;console.log("[App] Foregrounded after",K,"ms"),K>5e3&&(console.log("[App] Dispatching visibility-refresh event"),window.dispatchEvent(new Event("visibility-refresh")))}},Y=K=>{K.persisted&&(console.log("[App] Page restored from bfcache, triggering refresh"),window.dispatchEvent(new Event("visibility-refresh")))};return document.addEventListener("visibilitychange",H),window.addEventListener("pageshow",Y),()=>{document.removeEventListener("visibilitychange",H),window.removeEventListener("pageshow",Y)}},[]),c?N?k.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-gray-50 dark:bg-black transition-colors duration-300 animate-in fade-in",children:k.jsxs("div",{className:"flex flex-col items-center gap-4",children:[k.jsx("div",{className:"w-8 h-8 rounded-full border-4 border-green-500/20 border-t-green-500 animate-spin"}),k.jsx("p",{className:"text-sm font-semibold text-zinc-400 dark:text-white/40 tracking-tight",children:"Verifying..."})]})}):y==="scan"?k.jsx(xI,{onCancel:()=>{d(),C("home")},onScan:async U=>{h(!0);try{await d()}catch(H){console.warn("Connection refresh failed, proceeding anyway:",H)}P(U),C("home"),h(!1)},isProcessing:N}):k.jsx(H4,{onRequestScan:()=>C("scan"),initialScannedCode:D,onScannedCodeConsumed:()=>P(null)}):k.jsx(_I,{})};var N1=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(c){return this.listeners.add(c),this.onSubscribe(),()=>{this.listeners.delete(c),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},vI={setTimeout:(c,d)=>setTimeout(c,d),clearTimeout:c=>clearTimeout(c),setInterval:(c,d)=>setInterval(c,d),clearInterval:c=>clearInterval(c)},wI=class{#e=vI;#t=!1;setTimeoutProvider(c){this.#e=c}setTimeout(c,d){return this.#e.setTimeout(c,d)}clearTimeout(c){this.#e.clearTimeout(c)}setInterval(c,d){return this.#e.setInterval(c,d)}clearInterval(c){this.#e.clearInterval(c)}},jy=new wI;function AI(c){setTimeout(c,0)}var D1=typeof window>"u"||"Deno"in globalThis;function mu(){}function EI(c,d){return typeof c=="function"?c(d):c}function SI(c){return typeof c=="number"&&c>=0&&c!==1/0}function CI(c,d){return Math.max(c+(d||0)-Date.now(),0)}function Uy(c,d){return typeof c=="function"?c(d):c}function TI(c,d){return typeof c=="function"?c(d):c}function ib(c,d){const{type:y="all",exact:C,fetchStatus:D,predicate:P,queryKey:N,stale:h}=c;if(N){if(C){if(d.queryHash!==Mx(N,d.options))return!1}else if(!Bg(d.queryKey,N))return!1}if(y!=="all"){const U=d.isActive();if(y==="active"&&!U||y==="inactive"&&U)return!1}return!(typeof h=="boolean"&&d.isStale()!==h||D&&D!==d.state.fetchStatus||P&&!P(d))}function rb(c,d){const{exact:y,status:C,predicate:D,mutationKey:P}=c;if(P){if(!d.options.mutationKey)return!1;if(y){if(Lg(d.options.mutationKey)!==Lg(P))return!1}else if(!Bg(d.options.mutationKey,P))return!1}return!(C&&d.state.status!==C||D&&!D(d))}function Mx(c,d){return(d?.queryKeyHashFn||Lg)(c)}function Lg(c){return JSON.stringify(c,(d,y)=>Vy(y)?Object.keys(y).sort().reduce((C,D)=>(C[D]=y[D],C),{}):y)}function Bg(c,d){return c===d?!0:typeof c!=typeof d?!1:c&&d&&typeof c=="object"&&typeof d=="object"?Object.keys(d).every(y=>Bg(c[y],d[y])):!1}var II=Object.prototype.hasOwnProperty;function z2(c,d){if(c===d)return c;const y=sb(c)&&sb(d);if(!y&&!(Vy(c)&&Vy(d)))return d;const D=(y?c:Object.keys(c)).length,P=y?d:Object.keys(d),N=P.length,h=y?new Array(N):{};let U=0;for(let H=0;H<N;H++){const Y=y?H:P[H],K=c[Y],_e=d[Y];if(K===_e){h[Y]=K,(y?H<D:II.call(c,Y))&&U++;continue}if(K===null||_e===null||typeof K!="object"||typeof _e!="object"){h[Y]=_e;continue}const we=z2(K,_e);h[Y]=we,we===K&&U++}return D===N&&U===D?c:h}function sb(c){return Array.isArray(c)&&c.length===Object.keys(c).length}function Vy(c){if(!ab(c))return!1;const d=c.constructor;if(d===void 0)return!0;const y=d.prototype;return!(!ab(y)||!y.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(c)!==Object.prototype)}function ab(c){return Object.prototype.toString.call(c)==="[object Object]"}function MI(c){return new Promise(d=>{jy.setTimeout(d,c)})}function kI(c,d,y){return typeof y.structuralSharing=="function"?y.structuralSharing(c,d):y.structuralSharing!==!1?z2(c,d):d}function NI(c,d,y=0){const C=[...c,d];return y&&C.length>y?C.slice(1):C}function DI(c,d,y=0){const C=[d,...c];return y&&C.length>y?C.slice(0,-1):C}var kx=Symbol();function L2(c,d){return!c.queryFn&&d?.initialPromise?()=>d.initialPromise:!c.queryFn||c.queryFn===kx?()=>Promise.reject(new Error(`Missing queryFn: '${c.queryHash}'`)):c.queryFn}var RI=class extends N1{#e;#t;#n;constructor(){super(),this.#n=c=>{if(!D1&&window.addEventListener){const d=()=>c();return window.addEventListener("visibilitychange",d,!1),()=>{window.removeEventListener("visibilitychange",d)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(c){this.#n=c,this.#t?.(),this.#t=c(d=>{typeof d=="boolean"?this.setFocused(d):this.onFocus()})}setFocused(c){this.#e!==c&&(this.#e=c,this.onFocus())}onFocus(){const c=this.isFocused();this.listeners.forEach(d=>{d(c)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},B2=new RI;function PI(){let c,d;const y=new Promise((D,P)=>{c=D,d=P});y.status="pending",y.catch(()=>{});function C(D){Object.assign(y,D),delete y.resolve,delete y.reject}return y.resolve=D=>{C({status:"fulfilled",value:D}),c(D)},y.reject=D=>{C({status:"rejected",reason:D}),d(D)},y}var OI=AI;function zI(){let c=[],d=0,y=h=>{h()},C=h=>{h()},D=OI;const P=h=>{d?c.push(h):D(()=>{y(h)})},N=()=>{const h=c;c=[],h.length&&D(()=>{C(()=>{h.forEach(U=>{y(U)})})})};return{batch:h=>{let U;d++;try{U=h()}finally{d--,d||N()}return U},batchCalls:h=>(...U)=>{P(()=>{h(...U)})},schedule:P,setNotifyFunction:h=>{y=h},setBatchNotifyFunction:h=>{C=h},setScheduler:h=>{D=h}}}var rl=zI(),LI=class extends N1{#e=!0;#t;#n;constructor(){super(),this.#n=c=>{if(!D1&&window.addEventListener){const d=()=>c(!0),y=()=>c(!1);return window.addEventListener("online",d,!1),window.addEventListener("offline",y,!1),()=>{window.removeEventListener("online",d),window.removeEventListener("offline",y)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(c){this.#n=c,this.#t?.(),this.#t=c(this.setOnline.bind(this))}setOnline(c){this.#e!==c&&(this.#e=c,this.listeners.forEach(y=>{y(c)}))}isOnline(){return this.#e}},d1=new LI;function BI(c){return Math.min(1e3*2**c,3e4)}function F2(c){return(c??"online")==="online"?d1.isOnline():!0}var Gy=class extends Error{constructor(c){super("CancelledError"),this.revert=c?.revert,this.silent=c?.silent}};function j2(c){let d=!1,y=0,C;const D=PI(),P=()=>D.status!=="pending",N=pe=>{if(!P()){const he=new Gy(pe);_e(he),c.onCancel?.(he)}},h=()=>{d=!0},U=()=>{d=!1},H=()=>B2.isFocused()&&(c.networkMode==="always"||d1.isOnline())&&c.canRun(),Y=()=>F2(c.networkMode)&&c.canRun(),K=pe=>{P()||(C?.(),D.resolve(pe))},_e=pe=>{P()||(C?.(),D.reject(pe))},we=()=>new Promise(pe=>{C=he=>{(P()||H())&&pe(he)},c.onPause?.()}).then(()=>{C=void 0,P()||c.onContinue?.()}),ve=()=>{if(P())return;let pe;const he=y===0?c.initialPromise:void 0;try{pe=he??c.fn()}catch(De){pe=Promise.reject(De)}Promise.resolve(pe).then(K).catch(De=>{if(P())return;const Je=c.retry??(D1?0:3),Xe=c.retryDelay??BI,mt=typeof Xe=="function"?Xe(y,De):Xe,Wt=Je===!0||typeof Je=="number"&&y<Je||typeof Je=="function"&&Je(y,De);if(d||!Wt){_e(De);return}y++,c.onFail?.(y,De),MI(mt).then(()=>H()?void 0:we()).then(()=>{d?_e(De):ve()})})};return{promise:D,status:()=>D.status,cancel:N,continue:()=>(C?.(),D),cancelRetry:h,continueRetry:U,canStart:Y,start:()=>(Y()?ve():we().then(ve),D)}}var U2=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),SI(this.gcTime)&&(this.#e=jy.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(c){this.gcTime=Math.max(this.gcTime||0,c??(D1?1/0:300*1e3))}clearGcTimeout(){this.#e&&(jy.clearTimeout(this.#e),this.#e=void 0)}},FI=class extends U2{#e;#t;#n;#r;#i;#a;#o;constructor(c){super(),this.#o=!1,this.#a=c.defaultOptions,this.setOptions(c.options),this.observers=[],this.#r=c.client,this.#n=this.#r.getQueryCache(),this.queryKey=c.queryKey,this.queryHash=c.queryHash,this.#e=lb(this.options),this.state=c.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(c){if(this.options={...this.#a,...c},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const d=lb(this.options);d.data!==void 0&&(this.setState(ob(d.data,d.dataUpdatedAt)),this.#e=d)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(c,d){const y=kI(this.state.data,c,this.options);return this.#s({data:y,type:"success",dataUpdatedAt:d?.updatedAt,manual:d?.manual}),y}setState(c,d){this.#s({type:"setState",state:c,setStateOptions:d})}cancel(c){const d=this.#i?.promise;return this.#i?.cancel(c),d?d.then(mu).catch(mu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(c=>TI(c.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===kx||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(c=>Uy(c.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(c=>c.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(c=0){return this.state.data===void 0?!0:c==="static"?!1:this.state.isInvalidated?!0:!CI(this.state.dataUpdatedAt,c)}onFocus(){this.observers.find(d=>d.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(d=>d.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(c){this.observers.includes(c)||(this.observers.push(c),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:c}))}removeObserver(c){this.observers.includes(c)&&(this.observers=this.observers.filter(d=>d!==c),this.observers.length||(this.#i&&(this.#o?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:c}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(c,d){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&d?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(c&&this.setOptions(c),!this.options.queryFn){const h=this.observers.find(U=>U.options.queryFn);h&&this.setOptions(h.options)}const y=new AbortController,C=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(this.#o=!0,y.signal)})},D=()=>{const h=L2(this.options,d),H=(()=>{const Y={client:this.#r,queryKey:this.queryKey,meta:this.meta};return C(Y),Y})();return this.#o=!1,this.options.persister?this.options.persister(h,H,this):h(H)},N=(()=>{const h={fetchOptions:d,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:D};return C(h),h})();this.options.behavior?.onFetch(N,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==N.fetchOptions?.meta)&&this.#s({type:"fetch",meta:N.fetchOptions?.meta}),this.#i=j2({initialPromise:d?.initialPromise,fn:N.fetchFn,onCancel:h=>{h instanceof Gy&&h.revert&&this.setState({...this.#t,fetchStatus:"idle"}),y.abort()},onFail:(h,U)=>{this.#s({type:"failed",failureCount:h,error:U})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:N.options.retry,retryDelay:N.options.retryDelay,networkMode:N.options.networkMode,canRun:()=>!0});try{const h=await this.#i.start();if(h===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(h),this.#n.config.onSuccess?.(h,this),this.#n.config.onSettled?.(h,this.state.error,this),h}catch(h){if(h instanceof Gy){if(h.silent)return this.#i.promise;if(h.revert){if(this.state.data===void 0)throw h;return this.state.data}}throw this.#s({type:"error",error:h}),this.#n.config.onError?.(h,this),this.#n.config.onSettled?.(this.state.data,h,this),h}finally{this.scheduleGc()}}#s(c){const d=y=>{switch(c.type){case"failed":return{...y,fetchFailureCount:c.failureCount,fetchFailureReason:c.error};case"pause":return{...y,fetchStatus:"paused"};case"continue":return{...y,fetchStatus:"fetching"};case"fetch":return{...y,...jI(y.data,this.options),fetchMeta:c.meta??null};case"success":const C={...y,...ob(c.data,c.dataUpdatedAt),dataUpdateCount:y.dataUpdateCount+1,...!c.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=c.manual?C:void 0,C;case"error":const D=c.error;return{...y,error:D,errorUpdateCount:y.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:y.fetchFailureCount+1,fetchFailureReason:D,fetchStatus:"idle",status:"error"};case"invalidate":return{...y,isInvalidated:!0};case"setState":return{...y,...c.state}}};this.state=d(this.state),rl.batch(()=>{this.observers.forEach(y=>{y.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:c})})}};function jI(c,d){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:F2(d.networkMode)?"fetching":"paused",...c===void 0&&{error:null,status:"pending"}}}function ob(c,d){return{data:c,dataUpdatedAt:d??Date.now(),error:null,isInvalidated:!1,status:"success"}}function lb(c){const d=typeof c.initialData=="function"?c.initialData():c.initialData,y=d!==void 0,C=y?typeof c.initialDataUpdatedAt=="function"?c.initialDataUpdatedAt():c.initialDataUpdatedAt:0;return{data:d,dataUpdateCount:0,dataUpdatedAt:y?C??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:y?"success":"pending",fetchStatus:"idle"}}function cb(c){return{onFetch:(d,y)=>{const C=d.options,D=d.fetchOptions?.meta?.fetchMore?.direction,P=d.state.data?.pages||[],N=d.state.data?.pageParams||[];let h={pages:[],pageParams:[]},U=0;const H=async()=>{let Y=!1;const K=ve=>{Object.defineProperty(ve,"signal",{enumerable:!0,get:()=>(d.signal.aborted?Y=!0:d.signal.addEventListener("abort",()=>{Y=!0}),d.signal)})},_e=L2(d.options,d.fetchOptions),we=async(ve,pe,he)=>{if(Y)return Promise.reject();if(pe==null&&ve.pages.length)return Promise.resolve(ve);const Je=(()=>{const Et={client:d.client,queryKey:d.queryKey,pageParam:pe,direction:he?"backward":"forward",meta:d.options.meta};return K(Et),Et})(),Xe=await _e(Je),{maxPages:mt}=d.options,Wt=he?DI:NI;return{pages:Wt(ve.pages,Xe,mt),pageParams:Wt(ve.pageParams,pe,mt)}};if(D&&P.length){const ve=D==="backward",pe=ve?UI:ub,he={pages:P,pageParams:N},De=pe(C,he);h=await we(he,De,ve)}else{const ve=c??P.length;do{const pe=U===0?N[0]??C.initialPageParam:ub(C,h);if(U>0&&pe==null)break;h=await we(h,pe),U++}while(U<ve)}return h};d.options.persister?d.fetchFn=()=>d.options.persister?.(H,{client:d.client,queryKey:d.queryKey,meta:d.options.meta,signal:d.signal},y):d.fetchFn=H}}}function ub(c,{pages:d,pageParams:y}){const C=d.length-1;return d.length>0?c.getNextPageParam(d[C],d,y[C],y):void 0}function UI(c,{pages:d,pageParams:y}){return d.length>0?c.getPreviousPageParam?.(d[0],d,y[0],y):void 0}var VI=class extends U2{#e;#t;#n;#r;constructor(c){super(),this.#e=c.client,this.mutationId=c.mutationId,this.#n=c.mutationCache,this.#t=[],this.state=c.state||GI(),this.setOptions(c.options),this.scheduleGc()}setOptions(c){this.options=c,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(c){this.#t.includes(c)||(this.#t.push(c),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:c}))}removeObserver(c){this.#t=this.#t.filter(d=>d!==c),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:c})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(c){const d=()=>{this.#i({type:"continue"})},y={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=j2({fn:()=>this.options.mutationFn?this.options.mutationFn(c,y):Promise.reject(new Error("No mutationFn found")),onFail:(P,N)=>{this.#i({type:"failed",failureCount:P,error:N})},onPause:()=>{this.#i({type:"pause"})},onContinue:d,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const C=this.state.status==="pending",D=!this.#r.canStart();try{if(C)d();else{this.#i({type:"pending",variables:c,isPaused:D}),await this.#n.config.onMutate?.(c,this,y);const N=await this.options.onMutate?.(c,y);N!==this.state.context&&this.#i({type:"pending",context:N,variables:c,isPaused:D})}const P=await this.#r.start();return await this.#n.config.onSuccess?.(P,c,this.state.context,this,y),await this.options.onSuccess?.(P,c,this.state.context,y),await this.#n.config.onSettled?.(P,null,this.state.variables,this.state.context,this,y),await this.options.onSettled?.(P,null,c,this.state.context,y),this.#i({type:"success",data:P}),P}catch(P){try{throw await this.#n.config.onError?.(P,c,this.state.context,this,y),await this.options.onError?.(P,c,this.state.context,y),await this.#n.config.onSettled?.(void 0,P,this.state.variables,this.state.context,this,y),await this.options.onSettled?.(void 0,P,c,this.state.context,y),P}finally{this.#i({type:"error",error:P})}}finally{this.#n.runNext(this)}}#i(c){const d=y=>{switch(c.type){case"failed":return{...y,failureCount:c.failureCount,failureReason:c.error};case"pause":return{...y,isPaused:!0};case"continue":return{...y,isPaused:!1};case"pending":return{...y,context:c.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:c.isPaused,status:"pending",variables:c.variables,submittedAt:Date.now()};case"success":return{...y,data:c.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...y,data:void 0,error:c.error,failureCount:y.failureCount+1,failureReason:c.error,isPaused:!1,status:"error"}}};this.state=d(this.state),rl.batch(()=>{this.#t.forEach(y=>{y.onMutationUpdate(c)}),this.#n.notify({mutation:this,type:"updated",action:c})})}};function GI(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var HI=class extends N1{constructor(c={}){super(),this.config=c,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(c,d,y){const C=new VI({client:c,mutationCache:this,mutationId:++this.#n,options:c.defaultMutationOptions(d),state:y});return this.add(C),C}add(c){this.#e.add(c);const d=Xm(c);if(typeof d=="string"){const y=this.#t.get(d);y?y.push(c):this.#t.set(d,[c])}this.notify({type:"added",mutation:c})}remove(c){if(this.#e.delete(c)){const d=Xm(c);if(typeof d=="string"){const y=this.#t.get(d);if(y)if(y.length>1){const C=y.indexOf(c);C!==-1&&y.splice(C,1)}else y[0]===c&&this.#t.delete(d)}}this.notify({type:"removed",mutation:c})}canRun(c){const d=Xm(c);if(typeof d=="string"){const C=this.#t.get(d)?.find(D=>D.state.status==="pending");return!C||C===c}else return!0}runNext(c){const d=Xm(c);return typeof d=="string"?this.#t.get(d)?.find(C=>C!==c&&C.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){rl.batch(()=>{this.#e.forEach(c=>{this.notify({type:"removed",mutation:c})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(c){const d={exact:!0,...c};return this.getAll().find(y=>rb(d,y))}findAll(c={}){return this.getAll().filter(d=>rb(c,d))}notify(c){rl.batch(()=>{this.listeners.forEach(d=>{d(c)})})}resumePausedMutations(){const c=this.getAll().filter(d=>d.state.isPaused);return rl.batch(()=>Promise.all(c.map(d=>d.continue().catch(mu))))}};function Xm(c){return c.options.scope?.id}var qI=class extends N1{constructor(c={}){super(),this.config=c,this.#e=new Map}#e;build(c,d,y){const C=d.queryKey,D=d.queryHash??Mx(C,d);let P=this.get(D);return P||(P=new FI({client:c,queryKey:C,queryHash:D,options:c.defaultQueryOptions(d),state:y,defaultOptions:c.getQueryDefaults(C)}),this.add(P)),P}add(c){this.#e.has(c.queryHash)||(this.#e.set(c.queryHash,c),this.notify({type:"added",query:c}))}remove(c){const d=this.#e.get(c.queryHash);d&&(c.destroy(),d===c&&this.#e.delete(c.queryHash),this.notify({type:"removed",query:c}))}clear(){rl.batch(()=>{this.getAll().forEach(c=>{this.remove(c)})})}get(c){return this.#e.get(c)}getAll(){return[...this.#e.values()]}find(c){const d={exact:!0,...c};return this.getAll().find(y=>ib(d,y))}findAll(c={}){const d=this.getAll();return Object.keys(c).length>0?d.filter(y=>ib(c,y)):d}notify(c){rl.batch(()=>{this.listeners.forEach(d=>{d(c)})})}onFocus(){rl.batch(()=>{this.getAll().forEach(c=>{c.onFocus()})})}onOnline(){rl.batch(()=>{this.getAll().forEach(c=>{c.onOnline()})})}},ZI=class{#e;#t;#n;#r;#i;#a;#o;#s;constructor(c={}){this.#e=c.queryCache||new qI,this.#t=c.mutationCache||new HI,this.#n=c.defaultOptions||{},this.#r=new Map,this.#i=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=B2.subscribe(async c=>{c&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=d1.subscribe(async c=>{c&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#s?.(),this.#s=void 0)}isFetching(c){return this.#e.findAll({...c,fetchStatus:"fetching"}).length}isMutating(c){return this.#t.findAll({...c,status:"pending"}).length}getQueryData(c){const d=this.defaultQueryOptions({queryKey:c});return this.#e.get(d.queryHash)?.state.data}ensureQueryData(c){const d=this.defaultQueryOptions(c),y=this.#e.build(this,d),C=y.state.data;return C===void 0?this.fetchQuery(c):(c.revalidateIfStale&&y.isStaleByTime(Uy(d.staleTime,y))&&this.prefetchQuery(d),Promise.resolve(C))}getQueriesData(c){return this.#e.findAll(c).map(({queryKey:d,state:y})=>{const C=y.data;return[d,C]})}setQueryData(c,d,y){const C=this.defaultQueryOptions({queryKey:c}),P=this.#e.get(C.queryHash)?.state.data,N=EI(d,P);if(N!==void 0)return this.#e.build(this,C).setData(N,{...y,manual:!0})}setQueriesData(c,d,y){return rl.batch(()=>this.#e.findAll(c).map(({queryKey:C})=>[C,this.setQueryData(C,d,y)]))}getQueryState(c){const d=this.defaultQueryOptions({queryKey:c});return this.#e.get(d.queryHash)?.state}removeQueries(c){const d=this.#e;rl.batch(()=>{d.findAll(c).forEach(y=>{d.remove(y)})})}resetQueries(c,d){const y=this.#e;return rl.batch(()=>(y.findAll(c).forEach(C=>{C.reset()}),this.refetchQueries({type:"active",...c},d)))}cancelQueries(c,d={}){const y={revert:!0,...d},C=rl.batch(()=>this.#e.findAll(c).map(D=>D.cancel(y)));return Promise.all(C).then(mu).catch(mu)}invalidateQueries(c,d={}){return rl.batch(()=>(this.#e.findAll(c).forEach(y=>{y.invalidate()}),c?.refetchType==="none"?Promise.resolve():this.refetchQueries({...c,type:c?.refetchType??c?.type??"active"},d)))}refetchQueries(c,d={}){const y={...d,cancelRefetch:d.cancelRefetch??!0},C=rl.batch(()=>this.#e.findAll(c).filter(D=>!D.isDisabled()&&!D.isStatic()).map(D=>{let P=D.fetch(void 0,y);return y.throwOnError||(P=P.catch(mu)),D.state.fetchStatus==="paused"?Promise.resolve():P}));return Promise.all(C).then(mu)}fetchQuery(c){const d=this.defaultQueryOptions(c);d.retry===void 0&&(d.retry=!1);const y=this.#e.build(this,d);return y.isStaleByTime(Uy(d.staleTime,y))?y.fetch(d):Promise.resolve(y.state.data)}prefetchQuery(c){return this.fetchQuery(c).then(mu).catch(mu)}fetchInfiniteQuery(c){return c.behavior=cb(c.pages),this.fetchQuery(c)}prefetchInfiniteQuery(c){return this.fetchInfiniteQuery(c).then(mu).catch(mu)}ensureInfiniteQueryData(c){return c.behavior=cb(c.pages),this.ensureQueryData(c)}resumePausedMutations(){return d1.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(c){this.#n=c}setQueryDefaults(c,d){this.#r.set(Lg(c),{queryKey:c,defaultOptions:d})}getQueryDefaults(c){const d=[...this.#r.values()],y={};return d.forEach(C=>{Bg(c,C.queryKey)&&Object.assign(y,C.defaultOptions)}),y}setMutationDefaults(c,d){this.#i.set(Lg(c),{mutationKey:c,defaultOptions:d})}getMutationDefaults(c){const d=[...this.#i.values()],y={};return d.forEach(C=>{Bg(c,C.mutationKey)&&Object.assign(y,C.defaultOptions)}),y}defaultQueryOptions(c){if(c._defaulted)return c;const d={...this.#n.queries,...this.getQueryDefaults(c.queryKey),...c,_defaulted:!0};return d.queryHash||(d.queryHash=Mx(d.queryKey,d)),d.refetchOnReconnect===void 0&&(d.refetchOnReconnect=d.networkMode!=="always"),d.throwOnError===void 0&&(d.throwOnError=!!d.suspense),!d.networkMode&&d.persister&&(d.networkMode="offlineFirst"),d.queryFn===kx&&(d.enabled=!1),d}defaultMutationOptions(c){return c?._defaulted?c:{...this.#n.mutations,...c?.mutationKey&&this.getMutationDefaults(c.mutationKey),...c,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},XI=me.createContext(void 0),WI=({client:c,children:d})=>(me.useEffect(()=>(c.mount(),()=>{c.unmount()}),[c]),k.jsx(XI.Provider,{value:c,children:d}));const YI=new ZI;hw.createRoot(document.getElementById("root")).render(k.jsx(Qs.StrictMode,{children:k.jsx(WI,{client:YI,children:k.jsx(m3,{children:k.jsx(bI,{})})})}));
